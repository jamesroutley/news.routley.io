<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://www.righto.com/2024/07/pentium-standard-cells.html">Original</a>
    <h1>Standard cells: Looking at individual gates in the Pentium processor</h1>
    
    <div id="readability-page-1" class="page"><div id="post-body-8644726036352101624" itemprop="description articleBody">
<p>Intel released the powerful Pentium processor in 1993,
a <a href="https://www.nytimes.com/1993/04/04/business/the-executive-computer-to-pentium-or-not-to-pentium-the-question-looms.html">chip</a>
to &#34;separate the really power-hungry folks from ordinary mortals.&#34;
The original Pentium was followed by the Pentium Pro, the Pentium II, and others, spawning a long-running brand of high-performance processors, Intel&#39;s flagship line until the Core processors took
over in 2006.
The Pentium eventually <a href="https://arstechnica.com/features/2004/07/pentium-1/#:~:text=in%20fact%2C%20in%20its%20heyday%20%22Pentium%22%20became%20virtually%20synonymous%20with%20%22PC.%22">became</a> virtually synonymous with &#34;PC&#34; and
even made it into
<a href="https://www.youtube.com/watch?v=qpMvS1Q1sos">pop culture</a>.</p>
<p>Even though the Pentium is a complex chip with 3.3 million transistors, its transistors are
visible under a microscope, unlike modern chips.
By examining the chip, we can see the interesting circuits used for gates, flip-flops, and other circuits, including
the use of an unusual technology called BiCMOS.
In this article, I take a close look at the original Pentium chip<span id="fnref:versions"><a href="#fn:versions">1</a></span>, showing how much of its circuitry was
built out of structured rows of tiny transistors, a technique known as standard-cell design.</p>
<p>The die photo below shows the Pentium&#39;s fingernail-sized silicon die under a microscope.
I removed the chip&#39;s four metal layers to show the underlying silicon, revealing the individual transistors, 
which are obscured in most die photos by the layers of metal.
Standard-cell circuitry, indicated by red boxes, is recognizable because the circuitry is arranged in uniform columns of cells, giving it a
characteristic striped appearance.
In contrast, the chip&#39;s manually-optimized functional blocks are denser and more structured, giving them a darker appearance.
Examples are the caches on the left, the datapaths in the middle, and the microcode ROMs on the right.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/die-regions2.jpg"><img alt="Die photo of the Intel Pentium processor with standard cells highlighted in red. The edges of the chip suffered some damage when I removed the metal layers. Click this image (or any other) for a larger version." height="652" src="https://static.righto.com/images/pentium-stdcell/die-regions2-w600.jpg" title="Die photo of the Intel Pentium processor with standard cells highlighted in red. The edges of the chip suffered some damage when I removed the metal layers. Click this image (or any other) for a larger version." width="600"/></a></p><p>Die photo of the Intel Pentium processor with standard cells highlighted in red. The edges of the chip suffered some damage when I removed the metal layers. Click this image (or any other) for a larger version.</p>
<h2>Standard-cell design</h2>
<p>Early processors in the 1970s were usually designed by manually laying out every transistor individually, fitting transistors
together like puzzle pieces to optimize their layout.
While this was tedious, it resulted in a highly dense layout.
<a href="https://archive.computerhistory.org/resources/text/Oral_History/Zilog_Z80/102658073.05.01.pdf#page=20">Federico Faggin</a>,
designer of the popular Z80 processor, was almost done when he ran into a problem.
The last few transistors wouldn&#39;t fit, so he had to erase
three weeks of work and start over.
The closeup of the resulting Z80 layout below
shows that each transistor has a different, complex shape, optimized to pack the transistors as tightly as possible.<span id="fnref:regularity"><a href="#fn:regularity">2</a></span></p>
<p><a href="https://static.righto.com/images/pentium-stdcell/z80.jpg"><img alt="A closeup of transistors in the Zilog Z80 processor (1976). This chip is NMOS, not CMOS, which provides more layout flexibility. The metal and polysilicon layers have been removed to expose the underlying silicon. The lighter stripes over active silicon indicate where the polysilicon gates were. I think this photo is from the Visual 6502 project but I&#39;m not sure." height="377" src="https://static.righto.com/images/pentium-stdcell/z80-w350.jpg" title="A closeup of transistors in the Zilog Z80 processor (1976). This chip is NMOS, not CMOS, which provides more layout flexibility. The metal and polysilicon layers have been removed to expose the underlying silicon. The lighter stripes over active silicon indicate where the polysilicon gates were. I think this photo is from the Visual 6502 project but I&#39;m not sure." width="350"/></a></p><p>A closeup of transistors in the Zilog Z80 processor (1976). This chip is NMOS, not CMOS, which provides more layout flexibility. The metal and polysilicon layers have been removed to expose the underlying silicon. The lighter stripes over active silicon indicate where the polysilicon gates were. I think this photo is from the Visual 6502 project but I&#39;m not sure.</p>
<!--
![A closeup of transistors in the Intel 8086 processor. This chip is NMOS, not CMOS, which provides more layout flexibility. The metal and polysilicon layers have been removed to expose the underlying silicon.](8086-transistors.jpg "w400")
-->

<p>Because manual layout is slow, difficult, and error-prone, people developed automated approaches such as standard-cell.<span id="fnref:gate-arrays"><a href="#fn:gate-arrays">3</a></span>
The idea behind standard-cell is to create a standard library of blocks (cells) to implement each type of gate, flip-flop, and other low-level
component.
To use a particular circuit, instead of arranging each transistor, you use the standard design from the library.
Each cell has a fixed height but the width varies as needed, so the standard cells can be arranged in rows.
The Pentium die photo below seven cells in a row.
(The rectangular blobs are doped silicon while the long, thin vertical lines are polysilicon.)
Compare the orderly arrangement of these transistors with the Z80 transistors above.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/stdcells-100.jpg"><img alt="Some standard cell circuitry in the Pentium.
I removed the metal to show the underlying silicon and polysilicon." height="329" src="https://static.righto.com/images/pentium-stdcell/stdcells-100-w400.jpg" title="Some standard cell circuitry in the Pentium.
I removed the metal to show the underlying silicon and polysilicon." width="400"/></a></p><p>Some standard cell circuitry in the Pentium.
I removed the metal to show the underlying silicon and polysilicon.</p>
<p>The photo below zooms out to show five rows of standard cells (the dark bands) and the wiring in between.
Because CMOS circuitry uses two types of transistors (NMOS and PMOS), each standard-cell row appears as two closely-spaced bands:
one of NMOS transistors and one of PMOS transistors.
The space between rows is used as a &#34;wiring channel&#34; that holds the wiring between the cells.
Power and ground for the circuitry run along the top and bottom of each row.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/stdcells.jpg"><img alt="Some standard cells in the Pentium processor." height="484" src="https://static.righto.com/images/pentium-stdcell/stdcells-w600.jpg" title="Some standard cells in the Pentium processor." width="600"/></a></p><p>Some standard cells in the Pentium processor.</p>
<!--
The big problem with standard cells is that placing the cells and routing the wiring is a very difficult
optimization task.
Cells that are part of the same circuit should be placed close to each other to minimize wire length.
And the connections must be routed without wires blocking each other.
(This was especially difficult when chips only had one or two layers of metal.)

I find the dies of standard cell chips are less interesting because there aren't visible structures but
just a random sea of gates. https://riscv.org/wp-content/uploads/2018/05/14.15-14.40-FlorianZaruba_riscv_workshop-1.pdf#page=22

The Intel 386 processor was implemented with standard cell logic for the "random" logic and manual layout
for structured or critical circuitry.
("Random logic" is not literally random, of course, but refers to circuitry that appears random because
it doesn't have a higher-level structure like an ALU or memory, for instance.)
-->

<p>The fixed structure of standard cell design makes it suitable for automation, with the layout generated by
&#34;automatic place and route&#34; software.
The first step, placement,
consists of determining
an arrangement of cells that minimizes the distance between connected cells.
Running long wires between cells wastes space on the die, since you end up with a lot of unnecessary metal wiring.
But more importantly, long paths have higher resistance, slowing down the signals.
Once the cells are placed in their positions, the &#34;routing&#34; step generates the wiring to connect the calls.
Placement and routing are both difficult optimization problems that are <a href="https://dl.acm.org/doi/10.1145/103724.103725">NP-complete</a>.</p>
<p>Intel started using automated place and route techniques for the 386 processor, since it was much faster than manual layout
and dramatically reduced the number of errors.
Placement was done with a program called Timberwolf, developed by a Berkeley grad student. As one member of the 386 team said, &#34;If management had known that we were using a tool by some grad student as a key part of the methodology, they would never have let us use it.&#34; 
Intel developed custom software for routing, using an iterative heuristic approach.
Standard-cell design is still used in current processors, but the software is much more advanced.</p>
<h2>A brief overview of CMOS</h2>
<p>Before looking at the standard cell circuits in detail, I&#39;ll give a quick overview of how CMOS circuits are implemented.
Modern processors are built from CMOS circuitry, which uses two types of transistors: NMOS and PMOS.
The diagram below shows how an NMOS transistor is constructed.
The transistor can be considered a switch between the source and drain, controlled by the gate.
The source and drain regions (green) consist of silicon doped with impurities to change its semiconductor properties, forming N+ silicon.
The gate consists of a layer of polysilicon (red), separated from the silicon by a very thin insulating oxide layer.
Whenever polysilicon crosses active silicon, a transistor is formed.
<a href="https://static.righto.com/images/pentium-stdcell/mosfet-n.jpg"><img alt="Diagram showing the structure of an NMOS transistor." height="231" src="https://static.righto.com/images/pentium-stdcell/mosfet-n-w400.jpg" title="Diagram showing the structure of an NMOS transistor." width="400"/></a></p><p>Diagram showing the structure of an NMOS transistor.</p>
<p>The NMOS and PMOS transistors are opposite in their construction and operation.
A PMOS transistor swaps the N-type and P-type silicon, so it consists of P+ regions in a substrate of N silicon.
In operation, an NMOS transistor turns on when the gate is high, while a PMOS transistor turns on when the gate is low.<span id="fnref:mos-disclaimer"><a href="#fn:mos-disclaimer">4</a></span>
An NMOS transistor is best at pulling its output low, while a PMOS transistor is best at pulling its output high.
In a CMOS circuit, the transistors work as a team, pulling the output high or low as needed;
the &#34;C&#34; in CMOS indicates this &#34;Complementary&#34; approach.
NMOS and PMOS transistors are not entirely symmetrical, however, due to the underlying semiconductor physics.
Instead, PMOS transistors need to be larger
than NMOS transistors, which helps to distinguish PMOS transistors from NMOS transistors on the die. </p>
<h2>The layers of circuitry in the Pentium</h2>
<p>The construction of the Pentium is more complicated than the diagram above, with four layers of metal
wiring that connect the transistors.<span id="fnref:wiring"><a href="#fn:wiring">5</a></span>
Starting at the surface of the silicon die,
the Pentium&#39;s transistors are similar to the diagram, with regions of silicon doped to change their semiconductor properties.
Polysilicon wiring is created on top of the silicon. The most important role of the polysilicon is that when it crosses
doped silicon, a transistor is formed, with the polysilicon as the gate.
However, polysilicon is also used as wiring over short distances.</p>
<p>Above the silicon,
four layers of metal connect the components:
multiple metal layers allow signals to crisscross the chip without running into each other.
The metal layers are numbered M1 through M4, with M1 on the bottom.
A few rules control the wiring:
a metal layer can connect with the layer above or below through a tungsten plug called a &#34;via&#34;.
Only the bottom metal, M1, can connect to the silicon or polysilicon, through a &#34;contact&#34;.
The layers usually alternate between horizontal wiring and vertical wiring (at least locally).
Thus, a signal from a transistor may travel through M1, bounce up to M2 and M3 to cross other signals, and then go back down to M1
to connect to another transistor.
As you can see, automated place and route software has a complicated task, producing millions of complicated wiring paths
as densely as possible.</p>
<p>The diagram below shows how the layers appear on the chip.
(This photo shows one of the rare spots on the chip where all the layers are visible.)
The M4 metal layer on top of the chip is the thickest, so it is mostly used for power, ground, and clock signals rather than data.
An M4 ground wire covers the top of this photo.
The next layer down is M3. In this part of the chip, M3 lines run vertically.
(Due to optical effects, the vertical M3 lines may look like they are on top of M4, but they are below.)
The horizontal M2 metal lines are lower and appear brown rather than golden, due to the oxide layers that cover them.
The bottom metal layer is M1. The vertical M1 lines are thick in this part of the chip because they provide power
to the circuitry.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/layers-metal.jpg"><img alt="The Pentium is constructed with four layers of metal. Because the chip has a three-dimensional structure, I used focus stacking to get a clearer image." height="331" src="https://static.righto.com/images/pentium-stdcell/layers-metal-w600.jpg" title="The Pentium is constructed with four layers of metal. Because the chip has a three-dimensional structure, I used focus stacking to get a clearer image." width="600"/></a></p><p>The Pentium is constructed with four layers of metal. Because the chip has a three-dimensional structure, I used focus stacking to get a clearer image.</p>
<p>The silicon and polysilicon are mostly obscured in the above photo.
By removing all the metal layers, I obtained the image below.
This image shows the same region as the image above, but it is hard to see the correlation because the metal layers almost completely obscure the silicon.
The orderly columns of transistors reveal the standard-cell design.
The irregular dark regions are doped silicon, which forms the chip&#39;s transistors.
The dark or shiny horizontal bands are polysilicon.
I will explain below how these regions form gates and other circuits.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/layers-si.jpg"><img alt="A closeup of the silicon and polysilicon." height="276" src="https://static.righto.com/images/pentium-stdcell/layers-si-w500.jpg" title="A closeup of the silicon and polysilicon." width="500"/></a></p><p>A closeup of the silicon and polysilicon.</p>
<h2>Inverter</h2>
<p>The fundamental CMOS gate is an inverter, shown in the schematic below. The inverter is built from one PMOS transistor (top) and one NMOS transistor (bottom).
If the gate input is a &#34;1&#34;, the bottom transistor turns on, pulling the output to ground (0). A &#34;0&#34; input turns on the top transistor, pulling the output high (1).
Thus, this two-transistor circuit implements an inverter.<span id="fnref:slow-buffer"><a href="#fn:slow-buffer">10</a></span></p>
<p><a href="https://static.righto.com/images/pentium-stdcell/inverter.jpg"><img alt="Schematic diagram of a CMOS inverter." height="189" src="https://static.righto.com/images/pentium-stdcell/inverter-w150.jpg" title="Schematic diagram of a CMOS inverter." width="150"/></a></p><p>Schematic diagram of a CMOS inverter.</p>
<p>The diagram below shows two views of how a standard-cell inverter appears on the Pentium die, with and without metal.
The inverter consists of two transistors, just like the schematic above.
The input is connected to the two polysilicon gates of the transistors.
The metal output wire is connected to the two transistors (the left sides, specifically).</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/inverter-diagram.jpg"><img alt="A standard-cell CMOS inverter in the Pentium." height="369" src="https://static.righto.com/images/pentium-stdcell/inverter-diagram-w400.jpg" title="A standard-cell CMOS inverter in the Pentium." width="400"/></a></p><p>A standard-cell CMOS inverter in the Pentium.</p>
<p>In more detail, 
the image on the left includes the bottom (M1) metal layer, but I removed the other metal layers.
Two thick metal lines at the top and bottom provide power and ground to the standard cells.
The multiple dark circles are contacts between the M1 metal layer and the metal layer on top (M2), providing a path for power
and ground that eventually reaches the top (M4) metal layer and then the chip&#39;s pins.
(The power and ground wires are thick to provide sufficient current to the circuitry while minimizing voltage drops and noise.)
The small, lighter circles are vias that connect the M1 metal layer to the underlying silicon or polysilicon.
The input to the gate is provided from the M2 metal, which connects to the M1 layer at the indicated contact.
The smaller black dots at the top and bottom of this metal strip are vias, connections to the underlying silicon.</p>
<p>For the image on the right, I removed all four metal layers, revealing the polysilicon and doped silicon.
Recall that a transistor is constructed from regions of doped silicon with a stripe of polysilicon between the regions, forming the
transistor&#39;s gate.
The diagram shows the two transistors that form the inverter. When combined with the metal wiring, they form the
inverter schematic shown earlier.
The final feature is the &#34;well tap&#34;. The PMOS transistors are constructed in a &#34;well&#34; of N-doped silicon.
The well must be kept at a positive voltage, so periodic &#34;taps&#34; connect the well to the +3.3V supply.
As mentioned earlier, the PMOS transistor is larger than the NMOS transistor, which allowed me to figure out the transistor
types in the photo.</p>
<p>By the way, the chip is built with a 600 nm process, so the width of the polysilicon lines is approximately 600 nm.
For comparison, the wavelength of visible light is 400 to 700 nm, with 600 nm corresponding to orange light.
This explains why the microscope photos are somewhat fuzzy; the features are the size of the wavelength of light.<span id="fnref:oil"><a href="#fn:oil">6</a></span></p>
<h2>NAND gate</h2>
<p>Another common gate in the Pentium is the NAND gate.
The schematic below shows a NAND gate with two PMOS transistors above and two NMOS transistors below.
If both inputs are high, the two NMOS transistors turn on, pulling the output low.
If either input is low, a PMOS transistor turns on, pulling the output high.
(Recall that NMOS and PMOS are opposites: a high voltage turns an NMOS transistor on while a low voltage turns
a PMOS transistor on.)
Thus, the CMOS circuit below produces the desired output for the NAND function.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/nand.jpg"><img alt="Schematic of a CMOS NAND gate." height="252" src="https://static.righto.com/images/pentium-stdcell/nand-w230.jpg" title="Schematic of a CMOS NAND gate." width="230"/></a></p><p>Schematic of a CMOS NAND gate.</p>
<p>The implementation of the gate as a standard cell, below, follows the schematic.
The left photo shows the circuit with one layer of metal (M1).
A thick metal line provides 3.3 volts to the gate; it has two contacts that provide power to the two PMOS transistors.
The metal line for ground is similar, except only one NMOS transistor is grounded.
The thinner metal in the middle has two contacts to get the transistor outputs and a via to connect the output to the
M2 metal layer on top.
Finally, two tiny bits of M1 metal connect the inputs from the M2 layer to the underlying polysilicon.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/nand-die.jpg"><img alt="Implementation of a CMOS NAND gate as a standard cell." height="482" src="https://static.righto.com/images/pentium-stdcell/nand-die-w400.jpg" title="Implementation of a CMOS NAND gate as a standard cell." width="400"/></a></p><p>Implementation of a CMOS NAND gate as a standard cell.</p>
<p>The right photo shows the circuit with all metal removed,
showing the polysilicon and silicon.
Since a transistor is formed where a polysilicon line crosses doped silicon,
the two polysilicon lines create four transistors.
Polysilicon functions both as local wiring and as the transistor
gates.
In particular, the inputs can be connected at the top or bottom of the circuit (or both), depending on what works best for
wiring the circuitry.
Note that the transistors are squashed together so the silicon in the middle is part of two transistors.
An important asymmetry is that the output is taken from the middle of the PMOS transistors, wiring them in parallel, while the
output is taken from the right side of the NMOS transistors, wiring them in series.</p>
<p>Zooming out a bit, the photo below shows three NAND gates.
Although the underlying standard cell is the same for each one, there are differences between the gates.
At the top, horizontal wiring links the inputs to M2 through vias. The length of each polysilicon line depends on the
position of the metal.
Moreover, in the middle of each gate, the metal connection to the output is positioned differently.
Finally, note that the power wiring shifts upward in the upper right corner; this is to make room for a larger cell
to the right.
The point is that the standard cells aren&#39;t simply copies of each other, but are adjusted in each case to put the inputs,
outputs, and power in the right location.
Also note that these standard cells are not isolated, but are squeezed together so the PMOS transistors are touching.
This optimization slightly increases the density.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/nands.jpg"><img alt="Three NAND gates in the Pentium." height="371" src="https://static.righto.com/images/pentium-stdcell/nands-w180.jpg" title="Three NAND gates in the Pentium." width="180"/></a></p><p>Three NAND gates in the Pentium.</p>
<h2>OR-NAND gate</h2>
<p>The standard cell library includes some complex gates. For instance, the gate below is a 5-input OR-NAND gate, computing
<code>~((A+B+C+D)⋅E)</code>.
In the NMOS circuit, transistors <code>A</code> through <code>D</code> are paralleled while <code>E</code> is in series.
The PMOS circuit is the opposite, with <code>A</code> through <code>D</code> in series and <code>E</code> in parallel.
To provide sufficient current, the PMOS circuit has two sets of transistors for <code>A</code> through <code>D</code>, so the PMOS block is
much larger than the NMOS block.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/or-nand.jpg"><img alt="The OR-NAND gate as it appears on the die. The left image shows the M1 metal layer while the right image shows the silicon
and polysilicon." height="315" src="https://static.righto.com/images/pentium-stdcell/or-nand-w500.jpg" title="The OR-NAND gate as it appears on the die. The left image shows the M1 metal layer while the right image shows the silicon
and polysilicon." width="500"/></a></p><p>The OR-NAND gate as it appears on the die. The left image shows the M1 metal layer while the right image shows the silicon
and polysilicon.</p>
<h2>Latch</h2>
<p>One of the key building blocks of the Pentium&#39;s circuitry is the latch.
The idea of the latch is to hold one bit, controlled by the clock signal.
A latch is &#34;transparent&#34;:
the latch&#39;s input immediately appears on the output while the clock is high. But when the clock is low, the latch holds its previous value.
The latch is implemented with a feedback loop that passes the latch&#39;s output back into the latch.
The heart of this latch circuit is the multiplexer (mux), which selects either the previous output (when the clock is low) or the new input (when the clock is high).
The inverters amplify the feedback signal so it doesn&#39;t decay in the loop. An inverter also amplifies the output so it can
drive other circuitry.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/latch.jpg"><img alt="The circuit for a latch." height="155" src="https://static.righto.com/images/pentium-stdcell/latch-w450.jpg" title="The circuit for a latch." width="450"/></a></p><p>The circuit for a latch.</p>
<p>The circuit for a multiplexer is interesting since it uses &#34;pass transistors&#34;. That is, the transistors simply pass their
input through to the output, rather than pulling a signal to power or ground as in a typical logic gate.
The schematic shows how this works.
First, suppose that the <code>select</code> line is low. This will turn on the two transistors connected to the first input, allowing
its level to flow to the output. Meanwhile, both transistors connected to the second input will be turned off, blocking
that signal.
But if the <code>select</code> line is high, everything switches. Now, the two transistors connected to the second input turn on, passing
its level to the output.
Thus, the multiplexer selects the first input if the control signal is low, and the second input if the control signal is high.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/mux.jpg"><img alt="A multiplexer and its implementation in CMOS." height="402" src="https://static.righto.com/images/pentium-stdcell/mux-w450.jpg" title="A multiplexer and its implementation in CMOS." width="450"/></a></p><p>A multiplexer and its implementation in CMOS.</p>
<p>The diagram below shows a multiplexer, part of a latch. On the left, an inverter feeds into one input of the multiplexer.<span id="fnref:mux"><a href="#fn:mux">7</a></span>
On the right is the other input to the multiplexer. The output is taken from the middle, between the pairs of the transistors.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/mux-diagram.jpg"><img alt="A multiplexer as it appears on the Pentium die." height="455" src="https://static.righto.com/images/pentium-stdcell/mux-diagram-w300.jpg" title="A multiplexer as it appears on the Pentium die." width="300"/></a></p><p>A multiplexer as it appears on the Pentium die.</p>
<p>Note that the multiplexer&#39;s circuit is opposite, in a way, to a logic gate.
In a logic gate, you want either the NMOS transistor on or the PMOS transistor on, so the output is pulled low or
high respectively.
This is accomplished by giving the signals on the transistor gates the <em>same</em> polarity, so the same polysilicon line
runs through both transistors.
In a multiplexer, however, you want the corresponding PMOS and NMOS transistors to turn on at the same time,
so they can pass the
signal. This requires the signals on the transistor gates to have <em>opposite</em> polarity.
One polysilicon line runs through the right PMOS transistor and the left NMOS transistor. The other polysilicon line runs
through the left PMOS transistor and the right NMOS transistor, connected by metal wiring (not shown).
The multiplexer includes an inverter to provide the necessary signal, but I cropped it out of the diagram below.</p>
<h2>The flip-flop</h2>
<p>The Pentium makes extensive use of flip-flops. 
A flip-flop is similar to a latch, except its clock input is edge-sensitive instead of level-sensitive.
That is, the flip-flop &#34;remembers&#34; its input at the moment the clock goes from low to high, and provides that value as its
output.
This difference may seem unimportant, but it turns out to make the flip-flop more useful in counters, state machines, and
other clocked circuits.</p>
<p>In the Pentium, a flip-flop is constructed from two latches: a primary latch and a secondary latch.
The primary latch passes its value through while the clock is low and holds its value when the clock is high.
The output of the primary latch is fed into the secondary latch, which has the opposite clock behavior.
The result is that when the clock switches from low to high, the primary latch stops updating its output at the same time
that the secondary starts passing this value through, providing the desired flip-flop behavior.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/flip-flop.jpg"><img alt="A standard-cell flip-flop." height="335" src="https://static.righto.com/images/pentium-stdcell/flip-flop-w300.jpg" title="A standard-cell flip-flop." width="300"/></a></p><p>A standard-cell flip-flop.</p>
<p>The photo above shows a standard-cell flop-flop, with an intricate pattern of metal wiring connecting the various sub-components. There are a few variants; with minor logic changes, the flip-flop
can have &#34;set&#34; or &#34;reset&#34; inputs, bypassing the clock to force the output to the desired state.
(Set and reset functions are useful for initializing flip-flops to a desired value, for example when the processor starts up.)</p>
<h2>The BiCMOS buffer</h2>
<p>Although I&#39;ve been discussing CMOS circuits so far, the Pentium was built with BiCMOS, a process that allows circuits to
use bipolar transistors in addition to CMOS.
By adding a few extra processing steps to the regular CMOS manufacturing process, bipolar (NPN and PNP) transistors can be created.
The Pentium made extensive use of BiCMOS circuits since they reduced signal delays by up to 35%.
Intel also used BiCMOS for the Pentium Pro, Pentium II, Pentium III, and Xeon processors
(but not the Pentium MMX).
However, as chip voltages dropped, the benefit from bipolar transistors dropped too and BiCMOS was eventually abandoned.</p>
<p>The schematic below shows a standard-cell BiCMOS buffer in the Pentium chip.<span id="fnref:bicmos"><a href="#fn:bicmos">8</a></span>
This circuit is more complex than a CMOS buffer: it uses two inverters, an NPN pull-up transistor, an NMOS pull-down transistor, and a PMOS pull-up transistor.<span id="fnref:bicmos-inv"><a href="#fn:bicmos-inv">9</a></span></p>
<p><a href="https://static.righto.com/images/pentium-stdcell/bicmos-schematic.jpg"><img alt="Reverse-engineered schematic of the BiCMOS buffer." height="193" src="https://static.righto.com/images/pentium-stdcell/bicmos-schematic-w300.jpg" title="Reverse-engineered schematic of the BiCMOS buffer." width="300"/></a></p><p>Reverse-engineered schematic of the BiCMOS buffer.</p>
<p>In the die images below,
note the circular structure of the NPN transistor, very different from the linear structure of the NMOS and PMOS transistors and considerably larger.
A sign of the buffer&#39;s high-current drive capacity is the output&#39;s thick metal wiring, much thicker than the typical signal wiring.</p>
<p><a href="https://static.righto.com/images/pentium-stdcell/bicmos.jpg"><img alt="A BiCMOS buffer in the Pentium." height="355" src="https://static.righto.com/images/pentium-stdcell/bicmos-w600.jpg" title="A BiCMOS buffer in the Pentium." width="600"/></a></p><p>A BiCMOS buffer in the Pentium.</p>
<h2>Conclusions</h2>
<p>Standard-cell layout is extensively used in modern chips. 
Modern processors, with their nanometer-scale transistors, are much too small to study under a microscope.
The Pentium, on the other hand, has features large enough that its circuits can be observed and reverse engineered.
Of course, with 3.3 million transistors, the Pentium is too much for me to reverse engineer in depth, but I still find it interesting
to study small-scale circuits and see how they were implemented.
This post presented a small sample of the standard cells in the Pentium. 
The full standard-cell library is much larger,
with dozens, if not hundreds, of different cells: many types of logic gates in a variety of sizes and drive
strengths.
But the fundamental design and layout principles are the same as the cells described here.</p>
<p>One unusual feature of the Pentium is its use of BiCMOS circuitry, which had a peak of popularity in the 1990s,
right around the era of the Pentium.
Although changing tradeoffs made BiCMOS impractical for digital circuitry, BiCMOS still has an important role in analog
ICs, especially high-frequency applications.
The Pentium in a sense is a time capsule with its use of BiCMOS.</p>
<p>I hope that you have enjoyed this look at some of the Pentium&#39;s circuits.
I find it reassuring to see that even complex processors are made up of simple transistor circuits and
you can observe and understand these circuits if you look closely.</p>
<p>For more on standard-cell circuits, I wrote about <a href="https://www.righto.com/2021/03/reverse-engineering-standard-cell-logic.html">standard cells in an IBM chip</a> and <a href="https://www.righto.com/2024/01/intel-386-standard-cells.html">standard cells in the 386</a> (the 386 article has a lot of overlap with this one).
Follow me on Twitter <a href="https://twitter.com/kenshirriff">@kenshirriff</a> or <a href="http://www.righto.com/feeds/posts/default">RSS</a> for updates.
I&#39;m also on Mastodon occasionally as <a href="https://oldbytes.space/@kenshirriff">@<span data-cfemail="8be0eee5f8e3e2f9f9e2ededcbe4e7efe9f2ffeef8a5f8fbeae8ee">[email protected]</span></a>.</p>
<h2>Notes and references</h2>


</div></div>
  </body>
</html>
