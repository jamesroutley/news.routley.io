<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/spiraldb/vortex">Original</a>
    <h1>Show HN: Vortex â€“ a high-performance columnar file format</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://github.com/spiraldb/vortex/actions"><img src="https://github.com/fulcrum-so/vortex/actions/workflows/ci.yml/badge.svg" alt="Build Status"/></a>
<a href="https://crates.io/crates/vortex-array" rel="nofollow"><img src="https://camo.githubusercontent.com/5e4c7b2bac2564f0b28006fdc5832127a05ecfe4c324a299deca48c113f2539a/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f766f727465782d61727261792e737667" alt="Crates.io" data-canonical-src="https://img.shields.io/crates/v/vortex-array.svg"/></a>
<a href="https://docs.rs/vortex-array" rel="nofollow"><img src="https://camo.githubusercontent.com/bb82ef82b46a0d868cb2eaa855fb1724ffd3d9d614d5ff26be508aec779e9792/68747470733a2f2f646f63732e72732f766f727465782d61727261792f62616467652e737667" alt="Documentation" data-canonical-src="https://docs.rs/vortex-array/badge.svg"/></a>
<a href="https://pypi.org/project/vortex-array/" rel="nofollow"><img src="https://camo.githubusercontent.com/506d8e3db54d4420bdf98ef197df095cb9bf0b76bf29d032704d00cb6e4f4198/68747470733a2f2f696d672e736869656c64732e696f2f707970692f707976657273696f6e732f766f727465782d6172726179" alt="PyPI - Python Version" data-canonical-src="https://img.shields.io/pypi/pyversions/vortex-array"/></a></p>
<p dir="auto">Vortex is a toolkit for working with compressed Apache Arrow arrays in-memory, on-disk, and over-the-wire.</p>
<p dir="auto">Vortex is designed to be to columnar file formats what Apache DataFusion is to query engines (or, analogously,
what LLVM + Clang are to compilers): a highly extensible &amp; extremely fast <em>framework</em> for building a modern
columnar file format, with a state-of-the-art, &#34;batteries included&#34; reference implementation.</p>
<p dir="auto">Vortex is an aspiring successor to Apache Parquet, with dramatically faster random access reads (100-200x faster)
and scans (2-10x faster), while preserving approximately the same compression ratio and write throughput. It will also support very wide
tables (at least 10s of thousands of columns) and (eventually) on-device decompression on GPUs.</p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Caution</p><p dir="auto">This library is still under rapid development and is a work in progress!</p>
<p dir="auto">Some key features are not yet implemented, both the API and the serialized format are likely to change in breaking ways,
and we cannot yet guarantee correctness in all cases.</p>
</div>
<p dir="auto">The major features of Vortex are:</p>
<ul dir="auto">
<li><strong>Logical Types</strong> - a schema definition that makes no assertions about physical layout.</li>
<li><strong>Zero-Copy to Arrow</strong> - &#34;canonicalized&#34; (i.e., fully decompressed) Vortex arrays can be zero-copy converted to/from Apache Arrow arrays.</li>
<li><strong>Extensible Encodings</strong> - a pluggable set of physical layouts. In addition to the builtin set of Arrow-compatible encodings,
the Vortex repository includes a number of state-of-the-art encodings (e.g., FastLanes, ALP, FSST, etc.) that are implemented
as extensions. While arbitrary encodings can be implemented as extensions, we have intentionally chosen a small set
of encodings that are highly data-parallel, which in turn allows for efficient vectorized decoding, random access reads,
and (in the future) decompression on GPUs.</li>
<li><strong>Cascading Compression</strong> - data can be recursively compressed with multiple nested encodings.</li>
<li><strong>Pluggable Compression Strategies</strong> - the built-in Compressor is based on BtrBlocks, but other strategies can trivially be used instead.</li>
<li><strong>Compute</strong> - basic compute kernels that can operate over encoded data (e.g., for filter pushdown).</li>
<li><strong>Statistics</strong> - each array carries around lazily computed summary statistics, optionally populated at read-time.
These are available to compute kernels as well as to the compressor.</li>
<li><strong>Serialization</strong> - Zero-copy serialization of arrays, both for IPC and for file formats.</li>
<li><strong>Columnar File Format (in progress)</strong> - A modern file format that uses the Vortex serde library to store compressed array data.
Optimized for random access reads and extremely fast scans; an aspiring successor to Apache Parquet.</li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">Overview: Logical vs Physical</h2><a id="user-content-overview-logical-vs-physical" aria-label="Permalink: Overview: Logical vs Physical" href="#overview-logical-vs-physical"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">One of the core design principles in Vortex is strict separation of logical and physical concerns.</p>
<p dir="auto">For example, a Vortex array is defined by a logical data type (i.e., the type of scalar elements) as well as a physical encoding
(the type of the array itself). Vortex ships with several built-in encodings, as well as several extension encodings.</p>
<p dir="auto">The built-in encodings are primarily designed to model the Apache Arrow in-memory format, enabling us to construct
Vortex arrays with zero-copy from Arrow arrays. There are also several built-in encodings (e.g., <code>sparse</code> and
<code>chunked</code>) that are useful building blocks for other encodings. The included extension encodings are mostly designed
to model compressed in-memory arrays, such as run-length or dictionary encoding.</p>
<p dir="auto">Analogously, <code>vortex-serde</code> is designed to handle the low-level physical details of reading and writing Vortex arrays. Choices
about which encodings to use or how to logically chunk data are left up to the <code>Compressor</code> implementation.</p>
<p dir="auto">One of the unique attributes of the (in-progress) Vortex file format is that it encodes the physical layout of the data within the
file&#39;s footer. This allows the file format to be effectively self-describing and to evolve without breaking changes to
the file format specification.</p>
<p dir="auto">In fact, the format is designed to support forward compatibility by optionally embedding WASM decoders directly into the files
themselves. This should help avoid the rapid calcification that has plagued other columnar file formats.</p>


<p dir="auto">The Vortex type-system is still in flux. The current set of logical types is:</p>
<ul dir="auto">
<li>Null</li>
<li>Bool</li>
<li>Integer(8, 16, 32, 64)</li>
<li>Float(16, b16, 32, 64)</li>
<li>Binary</li>
<li>UTF8</li>
<li>Struct</li>
<li>List (partially implemented)</li>
<li>Date/Time/DateTime/Duration (implemented as an extension type)</li>
<li>Decimal: TODO</li>
<li>FixedList: TODO</li>
<li>Tensor: TODO</li>
<li>Union: TODO</li>
</ul>

<p dir="auto">Vortex includes a base set of &#34;flat&#34; encodings that are designed to be zero-copy with Apache Arrow. These are the
canonical representations of each of the logical data types. The canonical encodings currently supported are:</p>
<ul dir="auto">
<li>Null</li>
<li>Bool</li>
<li>Primitive (Integer, Float)</li>
<li>Struct</li>
<li>VarBin (Binary, UTF8)</li>
<li>VarBinView (Binary, UTF8)</li>
<li>Extension</li>
<li>...with more to come</li>
</ul>

<p dir="auto">Vortex includes a set of highly data-parallel, vectorized encodings. These encodings each correspond to a compressed
in-memory array implementation, allowing us to defer decompression. Currently, these are:</p>
<ul dir="auto">
<li>Adaptive Lossless Floating Point (ALP)</li>
<li>BitPacked (FastLanes)</li>
<li>Constant</li>
<li>Chunked</li>
<li>Delta (FastLanes)</li>
<li>Dictionary</li>
<li>Fast Static Symbol Table (FSST)</li>
<li>Frame-of-Reference</li>
<li>Run-end Encoding</li>
<li>RoaringUInt</li>
<li>RoaringBool</li>
<li>Sparse</li>
<li>ZigZag</li>
<li>...with more to come</li>
</ul>

<p dir="auto">Vortex&#39;s default compression strategy is based on the
<a href="https://www.cs.cit.tum.de/fileadmin/w00cfj/dis/papers/btrblocks.pdf" rel="nofollow">BtrBlocks</a> paper.</p>
<p dir="auto">Roughly, for each chunk of data, a sample of at least ~1% of the data is taken. Compression is then attempted (
recursively) with a set of lightweight encodings. The best-performing combination of encodings is then chosen to encode
the entire chunk. This sounds like it would be very expensive, but given basic statistics about a chunk, it is
possible to cheaply prune many encodings and ensure the search space does not explode in size.</p>

<p dir="auto">Vortex provides the ability for each encoding to specialize the implementation of a compute function to avoid
decompressing where possible. For example, filtering a dictionary-encoded UTF8 array can be more cheaply performed by
filtering the dictionary first.</p>
<p dir="auto">Note--as mentioned above--that Vortex does not intend to become a full-fledged compute engine, but rather to implement
basic compute operations as may be required for efficient scanning &amp; pushdown.</p>

<p dir="auto">Vortex arrays carry lazily-computed summary statistics. Unlike other array libraries, these statistics can be populated
from disk formats such as Parquet and preserved all the way into a compute engine. Statistics are available to compute
kernels as well as to the compressor.</p>
<p dir="auto">The current statistics are:</p>
<ul dir="auto">
<li>BitWidthFreq</li>
<li>TrailingZeroFreq</li>
<li>IsConstant</li>
<li>IsSorted</li>
<li>IsStrictSorted</li>
<li>Max</li>
<li>Min</li>
<li>RunCount</li>
<li>TrueCount</li>
<li>NullCount</li>
</ul>
<div dir="auto"><h3 tabindex="-1" dir="auto">Serialization / Deserialization (Serde)</h3><a id="user-content-serialization--deserialization-serde" aria-label="Permalink: Serialization / Deserialization (Serde)" href="#serialization--deserialization-serde"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The goals of the <code>vortex-serde</code> implementation are:</p>
<ul dir="auto">
<li>Support scanning (column projection + row filter) with zero-copy and zero heap allocation.</li>
<li>Support random access in constant or near-constant time.</li>
<li>Forward statistical information (such as sortedness) to consumers.</li>
<li>Provide IPC format for sending arrays between processes.</li>
<li>Provide an extensible, best-in-class file format for storing columnar data on disk or in object storage.</li>
</ul>
<p dir="auto">TODO: insert diagram here</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Integration with Apache Arrow</h2><a id="user-content-integration-with-apache-arrow" aria-label="Permalink: Integration with Apache Arrow" href="#integration-with-apache-arrow"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Apache Arrow is the de facto standard for interoperating on columnar array data. Naturally, Vortex is designed to
be maximally compatible with Apache Arrow. All Arrow arrays can be converted into Vortex arrays with zero-copy,
and a Vortex array constructed from an Arrow array can be converted back to Arrow, again with zero-copy.</p>
<p dir="auto">It is important to note that Vortex and Arrow have different--albeit complementary--goals.</p>
<p dir="auto">Vortex explicitly separates logical types from physical encodings, distinguishing it from Arrow. This allows
Vortex to model more complex arrays while still exposing a logical interface. For example, Vortex can model a UTF8
<code>ChunkedArray</code> where the first chunk is run-length encoded and the second chunk is dictionary encoded.
In Arrow, <code>RunLengthArray</code> and <code>DictionaryArray</code> are separate incompatible types, and so cannot be combined in this way.</p>

<p dir="auto">For best performance we recommend using <a href="https://github.com/microsoft/mimalloc">MiMalloc</a> as the application&#39;s
allocator.</p>
<div dir="auto" data-snippet-clipboard-copy-content="#[global_allocator]
static GLOBAL_ALLOC: MiMalloc = MiMalloc;"><pre><span>#<span>[</span>global_allocator<span>]</span></span>
<span>static</span> <span>GLOBAL_ALLOC</span><span>:</span> <span>MiMalloc</span> = <span>MiMalloc</span><span>;</span></pre></div>

<p dir="auto">Please see <a href="https://mckzm.github.io/spiraldb/vortex/blob/develop/CONTRIBUTING.md">CONTRIBUTING.md</a>.</p>

<p dir="auto">In order to build vortex, you may also need to install the flatbuffer compiler (flatc):</p>


<p dir="auto">This repo uses rye to manage the combined Rust/Python monorepo build. First, make sure to run:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Install Rye from https://rye-up.com, and setup the virtualenv
rye sync"><pre><span><span>#</span> Install Rye from https://rye-up.com, and setup the virtualenv</span>
rye sync</pre></div>

<p dir="auto">Licensed under the Apache License, Version 2.0 (the &#34;License&#34;).</p>

<p dir="auto">Vortex is and will remain an open-source project. Our intent is to model its governance structure after the
<a href="https://substrait.io/governance/" rel="nofollow">Substrait project</a>, which in turn is based on the model of the Apache Software Foundation.
Expect more details on this in Q4 2024.</p>

<p dir="auto">This project is inspired by and--in some cases--directly based upon the existing, excellent work of many researchers
and OSS developers.</p>
<p dir="auto">In particular, the following academic papers greatly influenced the development:</p>
<ul dir="auto">
<li>Maximilian Kuschewski, David Sauerwein, Adnan Alhomssi, and Viktor Leis.
2023. <a href="https://www.cs.cit.tum.de/fileadmin/w00cfj/dis/papers/btrblocks.pdf" rel="nofollow">BtrBlocks: Efficient Columnar Compression
for Data Lakes</a>. Proc. ACM Manag. Data 1,
2,
Article 118 (June 2023), 14 pages. <a href="https://doi.org/10.1145/3589263" rel="nofollow">https://doi.org/10.1145/3589263</a></li>
<li>Azim Afroozeh and Peter
Boncz. <a href="https://www.vldb.org/pvldb/vol16/p2132-afroozeh.pdf" rel="nofollow">The FastLanes Compression Layout: Decoding &gt;100 Billion Integers per Second with Scalar
Code</a>. PVLDB, 16(9): 2132 - 2144, 2023.</li>
<li>Peter Boncz, Thomas Neumann, and Viktor Leis. <a href="https://www.vldb.org/pvldb/vol13/p2649-boncz.pdf" rel="nofollow">FSST: Fast Random Access String
Compression</a>.
PVLDB, 13(11): 2649-2661, 2020.</li>
<li>Azim Afroozeh, Leonardo X. Kuffo, and Peter Boncz. 2023. <a href="https://ir.cwi.nl/pub/33334/33334.pdf" rel="nofollow">ALP: Adaptive Lossless floating-Point
Compression</a>. Proc. ACM
Manag. Data 1, 4 (SIGMOD), Article 230 (December 2023), 26 pages. <a href="https://doi.org/10.1145/3626717" rel="nofollow">https://doi.org/10.1145/3626717</a></li>
</ul>
<p dir="auto">Additionally, we benefited greatly from:</p>
<ul dir="auto">
<li>the existence, ideas, &amp; implementation of <a href="https://arrow.apache.org" rel="nofollow">Apache Arrow</a>.</li>
<li>likewise for the excellent <a href="https://github.com/apache/datafusion">Apache DataFusion</a> project.</li>
<li>the <a href="https://github.com/jorgecarleitao/parquet2">parquet2</a> project by <a href="https://github.com/jorgecarleitao">Jorge Leitao</a>.</li>
<li>the public discussions around choices of compression codecs, as well as the C++ implementations thereof,
from <a href="https://github.com/duckdb/duckdb">duckdb</a>.</li>
<li>the <a href="https://github.com/facebookincubator/velox">Velox</a> and <a href="https://github.com/facebookincubator/nimble">Nimble</a> projects,
and discussions with their maintainers.</li>
</ul>
<p dir="auto">Thanks to all of the aforementioned for sharing their work and knowledge with the world! ðŸš€</p>
</article></div></div>
  </body>
</html>
