<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.adrianriv.com/blog/2024/02/19/minimum_volume_ellipsoid/">Original</a>
    <h1>How to optimally trap points in high-dimensional spaces inside ellipsoids</h1>
    
    <div id="readability-page-1" class="page"><div>
        <!--
In this post, I show how to describe ellipsoids and formulate an optimization problem to enclose sets of points inside an ellipsoid with minimal volume. This technique will be useful for building the uncertainty sets required to create Robust Markowitz Portfolios.
 -->
<p>In this post we study how to trap a set of points in high dimensions inside an ellipsoid with minimal volume <a href="#john2014extremum">(John, 1948)</a>. This problem has applications in statistics and outlier detection, but my motivation for studying this problem is to be able to represent “uncertainty sets” for doing Robust Optimization. Please see <a href="https://www.adrianriv.com/blog/2024/02/12/robust_markowitz/">this post</a> if the terms “uncertainty sets” and Robust Optimization are new to you, if all you care is about learning geometry and optimization just keep reading.</p>

<p>Pictorially, what I’m trying to do is, find a description of the ellipsoid shown in the picture below.</p>

<figure>
<img src="https://www.adrianriv.com/images/minimal_volume_ellipsoid/john_ellipsoid.png"/>
<figcaption>
Minimal volume ellipsoid enclosing a set of points. From <a href="https://en.wikipedia.org/wiki/File:Lowner_Ellipse.webm" target="_blank"> Wikipedia</a>.
</figcaption>
</figure>

<p>This post is organized as follows, first I will show how to concisely represent/describe ellipsoids using matrices, then I’ll present an alternative parametrization of ellipsoids that is useful for entering the problem into a solver. Finally I will pose the Minimal Volume Enclosing Ellipsoid (MVEE) problem as a convex optimization problem.</p>


<p>Before we discuss ellipsoids lets get comfortable describing their simplest form, unit balls. You probably remember from school that in two dimensions the ball of radius 1, can be represented as the set of all points $x_1, x_2$ such that</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>x</mi><mn>2</mn><mn>2</mn></msubsup><mo>≤</mo><mn>1.</mn></mrow><annotation encoding="application/x-tex">
x_1^2 + x_2^2 \leq 1.
</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>1</span><span>.</span></span></span></span></span></p>

<p>That is the two-dimensional unit ball is $\mathcal{B}_2 = \lbrace x_1, x_2 \in \mathbb{R}: x_1^2 + x_2^2 \leq 1 \rbrace$. In $n$ dimensions, we have</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>x</mi><mn>2</mn><mn>2</mn></msubsup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msubsup><mi>x</mi><mi>n</mi><mn>2</mn></msubsup><mo>≤</mo><mn>1.</mn></mrow><annotation encoding="application/x-tex">
x_1^2 + x_2^2+ ... + x_n^2 \leq 1.
</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>.</span><span>.</span><span>.</span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>1</span><span>.</span></span></span></span></span></p>

<p>It is annoying to work with these large equations so, if $x \in \mathbb{R}^n$ is is the column vector with entries $x_1, x_2, …, x_n$ we can simply write $\mathcal{B}_n = \lbrace x \in \mathbb{R}^n: x^\top x \leq 1 \rbrace$.</p>

<p>Great, now, to go from a unit ball to an ellipsoid (lets focus on ellipsoids centered around the origin) all we have to do is “squish it” and rotate it. A great way to represent, squishing and rotating a set of points is through applying linear functions of the form $f(x) = Ax$ where $A$ is an $n$ by $n$ matrix. For example, imagine applying pressure to the top of the unit ball so it no longer reaches 1 but instead it only reaches .5 (keeping its width constant), and then rotating counterclockwise 45 degrees. This transformation is equivalent to first sending the unit vector pointing upwards from $[0; 1]$ to $[0; .5]$, then the 45 degree rotation sends $[1; 0] \rightarrow [\frac{1}{\sqrt{2}}; \frac{1}{\sqrt{2}}]$ and $[0; .5] \rightarrow [-\frac{1}{2\sqrt{2}} ; \frac{1}{2\sqrt{2}}]$. The matrix that represents this transformation is</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mfrac><mn>1</mn><mrow><mn>2</mn><msqrt><mn>2</mn></msqrt></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><mrow><mn>2</mn><msqrt><mn>2</mn></msqrt></mrow></mfrac></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">
A = 
\begin{bmatrix}
   \frac{1}{\sqrt{2}} &amp; -\frac{1}{2\sqrt{2}} \\
   \frac{1}{\sqrt{2}} &amp; \frac{1}{2\sqrt{2}}
\end{bmatrix}.
</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>A</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span>[</span></span><span><span><span><span><span><span><span><span></span><span><span><span></span><span><span><span><span><span><span></span><span><span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><svg width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z"></path></svg></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span><span><span></span><span><span><span></span><span><span><span><span><span><span></span><span><span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><svg width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z"></path></svg></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span></span><span><span><span><span><span><span></span><span><span>−</span><span><span></span><span><span><span><span><span><span></span><span><span><span>2</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><svg width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z"></path></svg></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span><span><span></span><span><span><span></span><span><span><span><span><span><span></span><span><span><span>2</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><svg width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z"></path></svg></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span>]</span></span></span><span></span><span>.</span></span></span></span></span></p>

<p>That’s right, the first column of the matrix tells you where the unit vector $[1; 0]$ gets mapped to, and the second column tells you where the other unit vector $[0; 1]$ gets mapped to. The previous is not a coincidence, by the way, if you feel like digging deeper into why this is true I highly recommend <a href="https://gregorygundersen.com/blog/2018/10/24/matrices/">this post</a> from Gregory Gundersen’s blog, which I’ve obviously drawn inspiration (and template files (with his permission)) from.</p>

<p>So, our ellipse $\mathcal{E}$ is the set of all points $y$ such that $y = Ax$ where $x$ is in the unit ball. Since we are interested in “full dimensional” ellipsoids in $\mathbb{R}^n$, that is we are not interested in representing a 2-d circle in 3-d space, the matrix $A$ is assumed to be invertible. More formally our ellipsoid is</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">E</mi><mo>=</mo><mo stretchy="false">{</mo><mi>y</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mi>n</mi></msup><mo separator="true">,</mo><mi mathvariant="normal">∃</mi><mi>x</mi><msup><mi mathvariant="double-struck">R</mi><mi>n</mi></msup><mo>:</mo><mi>y</mi><mo>=</mo><mi>A</mi><mi>x</mi><mo separator="true">,</mo><msup><mi>x</mi><mi mathvariant="normal">⊤</mi></msup><mi>x</mi><mo>≤</mo><mn>1</mn><mo stretchy="false">}</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">
\mathcal{E} = \lbrace y \in \mathbb{R}^n, \exists x \mathbb{R}^n: y = Ax, x^\top x \leq 1 \rbrace.
</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>E</span></span><span></span><span>=</span><span></span></span><span><span></span><span>{</span><span>y</span><span></span><span>∈</span><span></span></span><span><span></span><span><span><span>R</span></span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span>,</span><span></span><span>∃</span><span>x</span><span><span><span>R</span></span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>:</span><span></span></span><span><span></span><span>y</span><span></span><span>=</span><span></span></span><span><span></span><span>A</span><span>x</span><span>,</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>⊤</span></span></span></span></span></span></span></span><span>x</span><span></span><span>≤</span><span></span></span><span><span></span><span>1</span><span>}</span><span>.</span></span></span></span></span></p>

<p>Since A is invertible we have</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>x</mi><mo>=</mo><msup><mi>A</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>y</mi></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(1)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">
x = A^{-1} y \tag{1}
</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>=</span><span></span></span><span><span></span><span><span>A</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span>y</span></span><span><span></span><span><span>(</span><span><span>1</span></span><span>)</span></span></span></span></span></span></p>

<p>so that</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">E</mi><mo>=</mo><mo stretchy="false">{</mo><mi>y</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mi>n</mi></msup><mo>:</mo><msup><mi>y</mi><mi mathvariant="normal">⊤</mi></msup><msup><mi>A</mi><mrow><mo>−</mo><mi mathvariant="normal">⊤</mi></mrow></msup><msup><mi>A</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>y</mi><mo>≤</mo><mn>1</mn><mo stretchy="false">}</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">
\mathcal{E} = \lbrace y \in \mathbb{R}^n: y^\top A^{-\top}A^{-1} y \leq 1 \rbrace.
</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>E</span></span><span></span><span>=</span><span></span></span><span><span></span><span>{</span><span>y</span><span></span><span>∈</span><span></span></span><span><span></span><span><span><span>R</span></span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>:</span><span></span></span><span><span></span><span><span>y</span><span><span><span><span><span><span></span><span><span>⊤</span></span></span></span></span></span></span></span><span><span>A</span><span><span><span><span><span><span></span><span><span><span>−</span><span>⊤</span></span></span></span></span></span></span></span></span><span><span>A</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span>y</span><span></span><span>≤</span><span></span></span><span><span></span><span>1</span><span>}</span><span>.</span></span></span></span></span></p>

<p>Back to our numerical example, computing $A^{-\top}A^{-1}$ we get $B = \frac{1}{2}[[5, -3];[-3, 5]]$, so that $x^\top A^{-\top}A^{-1} x = \frac{5}{2}(x^2+y^2) - 3xy$ and this is what the ellipsoid looks like:</p>

<figure>
<img src="https://www.adrianriv.com/images/minimal_volume_ellipsoid/rotated_squished.png"/>
<figcaption>
An ellipsoid formed by mapping the unit ball with a matrix that squishes the top of the ball to .5, and then rotates 45 degrees counter-clockwise.
</figcaption>
</figure>
<p>just like we designed it; squished at the top, then rotated 45 degrees counter-clockwise.</p>

<p>It is common in the literature to see $n$-dimensional ellipsoids parametrized with a symmetric positive-semidefinite (I’ll explain in a sec) matrix $B\in \mathbb{R}^{n\times n}$ via</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">E</mi><mo>=</mo><mo stretchy="false">{</mo><mi>x</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mi>n</mi></msup><mo>:</mo><msup><mi>x</mi><mi mathvariant="normal">⊤</mi></msup><mi>B</mi><mi>x</mi><mo>≤</mo><mn>1</mn><mo stretchy="false">}</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">
\mathcal{E} = \lbrace x \in \mathbb{R}^n: x^\top B x \leq 1 \rbrace.
</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>E</span></span><span></span><span>=</span><span></span></span><span><span></span><span>{</span><span>x</span><span></span><span>∈</span><span></span></span><span><span></span><span><span><span>R</span></span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>:</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>⊤</span></span></span></span></span></span></span></span><span>B</span><span>x</span><span></span><span>≤</span><span></span></span><span><span></span><span>1</span><span>}</span><span>.</span></span></span></span></span></p>

<p>So, if we ever encounter a parametrization of this kind we know that if we can factorize $B$ as</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>B</mi><mo>=</mo><msup><mi>A</mi><mrow><mo>−</mo><mi mathvariant="normal">⊤</mi></mrow></msup><msup><mi>A</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo separator="true">,</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">
B = A^{-\top} A^{-1}, \tag{2}
</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>B</span><span></span><span>=</span><span></span></span><span><span></span><span><span>A</span><span><span><span><span><span><span></span><span><span><span>−</span><span>⊤</span></span></span></span></span></span></span></span></span><span><span>A</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span>,</span></span><span><span></span><span><span>(</span><span><span>2</span></span><span>)</span></span></span></span></span></span></p>

<p>then $A$ tells us how a unit ball is being transformed to create the ellipsoid. Intuitively, a matrix $B$ is <a href="https://www.google.com/search?q=positive+semidefinite+matrix&amp;oq=positive+se&amp;aqs=chrome.2.69i59j69i57j35i39i512i650j0i433i512l2j0i131i433i512j0i512j69i60.3283j0j7&amp;sourceid=chrome&amp;ie=UTF-8">positive-semidefinite</a> (PSD) if there exists a decomposition of the form $B = A^{-\top} A^{-1}$ where A squishes and/or rotates but does not collapse dimensions. Now, what if we don’t want our ellipsoids to be centered at $0$, what if we want them centered at $b\in \mathbb{R}^n$? All we have to do is:</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi mathvariant="script">E</mi><mo>=</mo><mo stretchy="false">{</mo><mi>x</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mi>n</mi></msup><mo>:</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mi>b</mi><msup><mo stretchy="false">)</mo><mi mathvariant="normal">⊤</mi></msup><mi>B</mi><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mi>b</mi><mo stretchy="false">)</mo><mo>≤</mo><mn>1</mn><mo stretchy="false">}</mo><mi mathvariant="normal">.</mi></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(3)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">
\mathcal{E} = \lbrace x \in \mathbb{R}^n: (x-b)^\top B (x-b) \leq 1 \rbrace \tag{3}.
</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>E</span></span><span></span><span>=</span><span></span></span><span><span></span><span>{</span><span>x</span><span></span><span>∈</span><span></span></span><span><span></span><span><span><span>R</span></span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>:</span><span></span></span><span><span></span><span>(</span><span>x</span><span></span><span>−</span><span></span></span><span><span></span><span>b</span><span><span>)</span><span><span><span><span><span><span></span><span><span>⊤</span></span></span></span></span></span></span></span><span>B</span><span>(</span><span>x</span><span></span><span>−</span><span></span></span><span><span></span><span>b</span><span>)</span><span></span><span>≤</span><span></span></span><span><span></span><span>1</span><span>}</span><span>.</span></span><span><span></span><span><span>(</span><span><span>3</span></span><span>)</span></span></span></span></span></span></p>

<p>To see why this is true think that if before the translation of the ellipsoid you had a point inside it: $\bar{x}$ (and thus it satisfied $\bar{x}^\top B \bar{x} \leq 1$), after translation you have to plug in $\bar{x} + b$ to get $(\bar{x} + b - b)^\top B (\bar{x} + b - b) =  \bar{x}^\top B \bar{x} \leq 1$.</p>


<p>Another way to parametrize an ellipsoid is via a PSD matrix $C \in \mathbb{R}^{n\times n}$ and a vector $c \in \mathbb{R}^n$. The parametrization is all $x\in \mathbb{R}^n$ such that:</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∥</mi><mi>C</mi><mi>x</mi><mo>+</mo><mi>c</mi><msubsup><mi mathvariant="normal">∥</mi><mn>2</mn><mn>2</mn></msubsup><mo>≤</mo><mn>1.</mn></mrow><annotation encoding="application/x-tex">
\Vert C x + c\Vert_2^2 \leq 1.
</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>∥</span><span>C</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>∥</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>1</span><span>.</span></span></span></span></span></p>

<p>How does this parametrization relate to the one in (3)? Lets expand:</p>

<p>\begin{align}
\Vert C x + c\Vert_2^2 &amp; = (C x + c)^\top (C x + c) \cr
&amp; = x^\top C^\top C x + 2 x^\top C^\top c + c^\top c.
\end{align}</p>

<p>Expanding (3) we get</p>

<p>\begin{align}
(x-b)^\top B (x-b) = x^\top B x - 2x^\top B b + b^\top b,
\end{align}</p>

<p>it must follow that if we are referring to same elipsoid with two different representations the following must hold:
$B = C^\top C$, and $C c = b$. More importantly, because of (2) it must hold that</p>

<p>\begin{align}
C = A^{-1} \tag{4}.
\end{align}</p>

<p>Why equation (4) is important will be explained in a minute.</p>


<p>Recall the problem we are trying to solve. We have been given a set of $N$ points $x_1, x_2, …, x_N$ in $\mathbb{R}^n$ and we want to find the ellipsoid of smallest volume that contains it. Using our second parametrization of ellipsoids, we know that we are looking for $C$ in the set of all PSD matrices and $c \in \mathbb{R}^n$ such that:</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∥</mi><mi>C</mi><msub><mi>x</mi><mi>n</mi></msub><mo>+</mo><mi>c</mi><msubsup><mi mathvariant="normal">∥</mi><mn>2</mn><mn>2</mn></msubsup><mo>≤</mo><mn>1</mn><mspace width="2em"></mspace><mi mathvariant="normal">∀</mi><mi>n</mi><mo>∈</mo><mo stretchy="false">[</mo><mi>N</mi><mo stretchy="false">]</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">
\Vert C x_n + c\Vert_2^2 \leq 1 \qquad \forall n \in [N].
</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>∥</span><span>C</span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>∥</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>1</span><span></span><span>∀</span><span>n</span><span></span><span>∈</span><span></span></span><span><span></span><span>[</span><span>N</span><span>]</span><span>.</span></span></span></span></span></p>

<p>But how do express that we want the ellipsoid of smallest volume? The trick is to remember from linear algebra that the <a href="https://en.wikipedia.org/wiki/Determinant">determinant</a> of a matrix is proportional to how the linear transformation increases/decreases volume. Remember how two sections ago we were thinking about creating ellipsoids by squishing and rotating unit balls by applying the mapping $A$? We want to minimize $\det(A^{-1})$, but how are $C$ and $A$ related? Well, we established this relation in equation (4). So our problem formulation is:</p>

<p>\begin{align}
\min_{C, c} \quad &amp; \det(C^{-1}) \cr
&amp; \Vert C x_n + c\Vert_2^2 \leq 1 \qquad \forall n \in [N].
\end{align}</p>

<p>We have a formulation for the MVEE optimization problem, but is this problem convex? Do there exist algorithms to efficiently solve this problem? The answer to the first question is no, this is because $\det(\cdot)$ is neither convex nor concave over the set of PSD matrices <a href="https://math.stackexchange.com/questions/2112803/is-the-function-a-mapsto-deta-convex-over-the-set-of-positive-definite-mat">(see F_G’s answer)</a>. But we are in luck, because $\log(\det(\cdot))$ <a href="https://math.stackexchange.com/questions/1192329/log-determinant-concavity-proof?noredirect=1&amp;lq=1">is concave</a>. So. if we modify our objective function to be $\log(\det(C^{-1})) = \log(\frac{1}{\det(C)}) = - \log(\det(C))$, we are minimizing a convex function! To conclude that the whole optimization problem is a convex one we would have to show two more things, that the set of PSD matrices is convex, and that each of the sets $\lbrace C : \Vert C x_n + c\Vert_2^2 \leq 1  \rbrace$ is convex. Turns out both statements are true, unfortunately I won’t prove them right now because I want to focus on trying to build robust portfolios. But if you want to learn how to prove this I recommend these <a href="\https://inst.eecs.berkeley.edu/~ee127/sp21/livebook/l_sdp_main.html">lecture notes</a> on Semidefinite Programming or Ch. 8 from <a href="#boyd2004convex">(Boyd &amp; Vandenberghe, 2004)</a>.</p>


<p>To summarize, the MVEE can be formulated as the following (convex) Semidefinite Program</p>

<p>\begin{align}
\min_{C, c} \quad &amp; - \log(\det(C)) \cr
&amp; \Vert C x_n + c\Vert_2^2 \leq 1 \qquad \forall n \in [N].
\end{align}</p>

<p>This formulation is useful because there exist general purpose algorithms for solving these kinds of problems. In the next post I will show how given samples of asset returns (these will be the points $\lbrace x_n \rbrace$) we can use a MVEE to find uncertainty sets which we can then incorporate into our robust formulation of the mean-variance portfolio problem.</p>

    </div></div>
  </body>
</html>
