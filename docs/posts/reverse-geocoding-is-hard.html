<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://shkspr.mobi/blog/2025/04/reverse-geocoding-is-hard/">Original</a>
    <h1>Reverse Geocoding Is Hard</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="https://schema.org/articleBody">
					<p>My wife and I run <a href="https://openbenches.org/">OpenBenches</a> - a crowd-sourced database of nearly 40,000 memorial benches.  Every bench is geo-tagged with a latitude and longitude. But how do you go from a string of digits to something human readable?</p>
					<p>How do I turn <code>-33.755780,150.603769</code> into &#34;42 Wallaby Way, Sydney, Australia&#34;?</p>
					<p>Luckily, that&#39;s a (somewhat) solved problem. Services like <a href="https://opencagedata.com/">OpenCage</a>, <a href="https://stadiamaps.com/">StadiaMaps</a>, <a href="https://nominatim.openstreetmap.org">OpenStreetMap</a>, and <a href="https://geocode.earth/">Geocode.Earth</a> all provide APIs which transform co-ordinates into addresses.  Done! Let&#39;s go home.</p>
					<p>Except… Not everywhere <em>has</em> an address.  <a href="https://openbenches.org/bench/35905">Some benches are in parks</a>. They typically don&#39;t have a street number, but might have an interesting feature nearby to help with location. For example a statue or prominent landmark.</p>
					<p>And… Not every address is relevant. <a href="https://openbenches.org/bench/26061">Some benches are on streets</a>. But we probably don&#39;t want to imply that the bench is <em>inside</em> or belongs to a specific nearby house.</p>
					<p>Let&#39;s step back a bit. <em>Why</em> do we want to display a human-readable address?</p>
					<p>We have two use-cases.</p>
					<p>&#34;As a visitor to the site, I want to:&#34;</p>
					<ol>
						<li>Read a (rough) textual representation of where the bench is.</li>
						<li>Click on a component of the address to see all benches within that area.</li>
					</ol>
					<p>The first is easy to explain:</p>
					<p><img alt="Map. Under it is an address of &#34;Middlewich, Cheshire East, England, United Kingdom&#34;." decoding="async" fetchpriority="high" height="638" src="https://shkspr.mobi/blog/wp-content/uploads/2025/04/OB-Address.webp" width="1134"/></p><p>The second is harder.  Suppose a bench is in Wellington, New Zealand. We want to create a URl like <a href="https://openbenches.org/location/New%20Zealand/Wellington/">openbenches.org/location/New Zealand/Wellington/</a>. That way, users can click on the word &#34;Wellington&#34; and find all the benches nearby. A user can also manually edit that URl to increase or decrease precision.</p>
					<p>Both of these are problems of <em>precision</em>.</p>
					<p>Let&#39;s take a look at <a href="https://nominatim.openstreetmap.org/reverse?lat=51.476845&amp;lon=-0.295296&amp;format=jsonv2">how one of the reverse geocoding services</a> deals with transforming <code>51.476845,-0.295296</code> into an address:</p>
					<blockquote>
						<p>Royal Botanic Gardens, Kew, Sandycombe Road, Kew, London Borough of Richmond upon Thames, London, Greater London, England, TW9 2EN, United Kingdom</p>
					</blockquote>
					<p><strong>That is <em>too much</em> address!</strong></p>
					<p>Yes, it is technically accurate. But it contains far too much detail for humans, the postcode is irrelevant, and the weird-subdivisions are nothing that a local person would use.</p>
					<p>Looking at the full API response, we can see:</p>
					<pre itemscope="" itemtype="https://schema.org/SoftwareSourceCode"><span><img alt="" height="32" src="https://shkspr.mobi/blog/wp-content/plugins/tempest-highlight//svg/json.svg" width="32"/><span itemprop="programmingLanguage"> JSON</span></span><code itemprop="text"><span>{</span>
  <span>&#34;place_id&#34;</span>: 258770727,
  <span>&#34;licence&#34;</span>: <span>&#34;Data © OpenStreetMap contributors, ODbL 1.0. http://osm.org/copyright&#34;</span>,
  <span>&#34;name&#34;</span>: <span>&#34;Royal Botanic Gardens, Kew&#34;</span>,
  <span>&#34;display_name&#34;</span>: <span>&#34;Royal Botanic Gardens, Kew, Elizabeth Cottages, Kew, London Borough of Richmond upon Thames, London, Greater London, England, TW9 3NJ, United Kingdom&#34;</span>,
  <span>&#34;address&#34;</span>: <span>{</span>
    <span>&#34;leisure&#34;</span>: <span>&#34;Royal Botanic Gardens, Kew&#34;</span>,
    <span>&#34;road&#34;</span>: <span>&#34;Elizabeth Cottages&#34;</span>,
    <span>&#34;suburb&#34;</span>: <span>&#34;Kew&#34;</span>,
    <span>&#34;city_district&#34;</span>: <span>&#34;London Borough of Richmond upon Thames&#34;</span>,
    <span>&#34;ISO3166-2-lvl8&#34;</span>: <span>&#34;GB-RIC&#34;</span>,
    <span>&#34;city&#34;</span>: <span>&#34;London&#34;</span>,
    <span>&#34;state_district&#34;</span>: <span>&#34;Greater London&#34;</span>,
    <span>&#34;state&#34;</span>: <span>&#34;England&#34;</span>,
    <span>&#34;ISO3166-2-lvl4&#34;</span>: <span>&#34;GB-ENG&#34;</span>,
    <span>&#34;postcode&#34;</span>: <span>&#34;TW9 3NJ&#34;</span>,
    <span>&#34;country&#34;</span>: <span>&#34;United Kingdom&#34;</span>,
    <span>&#34;country_code&#34;</span>: <span>&#34;gb&#34;</span>
  <span>}</span>
<span>}</span>
</code></pre>
					<p>Aha! Perhaps I can build a better address using just those components!</p>
					<p>Except… Not every country has states. And not all states are used when giving addresses. Not every location is in a city. Some places have villages, prefectures, municipalities, and hamlets.</p>
					<p>New York, New York is a valid address, but <a href="https://blog.opencagedata.com/post/99059889253/good-looking-addresses-solving-the-berlin-berlin">Berlin, Berlin</a> is not!</p>
					<p>There&#39;s an <a href="https://github.com/OpenCageData/address-formatting">address formatter by OpenCage</a> which is pretty sensible about stripping off irrelevant details. But, to go back to my first point, not every map location on OpenBenches is a street address and - even if it is on a street - it probably shouldn&#39;t have a house number.</p>
					<p>Well, there&#39;s kind of a solution to that! Most mapping provider have a <abbr title="Point of Interest">POI</abbr> function - we can find nearby things of interest and use them as a location.</p>
					<p>Here&#39;s a <a href="https://openbenches.org/bench/36734">bench in Cook County, Illinois, USA</a>. The POI address is:</p>
					<pre itemscope="" itemtype="https://schema.org/SoftwareSourceCode"><span><img alt="" height="32" src="https://shkspr.mobi/blog/wp-content/plugins/tempest-highlight//svg/json.svg" width="32"/><span itemprop="programmingLanguage"> JSON</span></span><code itemprop="text"><span>{</span>
…
   <span>&#34;name&#34;</span>: <span>&#34;Central Park&#34;</span>,
   <span>&#34;coarse_location&#34;</span>: <span>&#34;Des Plaines, IL, USA&#34;</span>,
…
<span>}</span>
</code></pre>
					<p>I <em>assume</em> there&#39;s only one Central Park in Des Plaines. Do people know that &#34;Il&#34; is Illinois? Would &#34;Cook County&#34; be useful?</p>
					<p>On the subject of localisation, not everywhere speaks English. Do I want to display addresses like &#34;<span lang="ja">原爆の子の像, 広島, 日本</span>&#34;? How about &#34;原爆の子の像, Hiroshima, Japan&#34;?</p>
					<p>We&#39;re an international site, but most benches are in Anglophone countries.</p>
					<p>Of course, just because something is <em>physically</em> near a POI, that doesn&#39;t mean it is <em>logically</em> close to it.</p>
					<p>Consider a bench situated <a href="https://www.openstreetmap.org/query?lat=50.580682&amp;lon=-3.467831">at the edge of this park</a>
<img alt="A map, with a marker situated just across a river." decoding="async" height="1060" src="https://shkspr.mobi/blog/wp-content/uploads/2025/04/map.webp" width="1328"/></p>
					<p>The nearest POI is &#34;Gay&#39;s Creamery&#34; - across the river. Is that what you&#39;d expect?  Is there any way to easily say &#34;if a point is <em>inside</em> an amenity* then use that as the address?</p>
					<p>I don&#39;t want the users of our site to have to select from a list of POIs or addresses, this should be as automated as possible.</p>
					<h2 id="the-plan">
						<a href="#the-plan">The Plan</a>
					</h2>
					<p>For each bench:</p>
					<ol>
						<li>Use StadiaMaps to get the nearest POI.</li>
						<li>Get the data in English.</li>
						<li>Concatenate the name and coarse location.</li>
						<li>Save the &#34;address&#34;.</li>
						<li>Wait for complaints?</li>
					</ol>
					<p>Thoughts?</p>
				</div></div>
  </body>
</html>
