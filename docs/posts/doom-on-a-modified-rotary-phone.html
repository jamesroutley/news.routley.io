<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tamulaitis.lt/project/dialrhea/">Original</a>
    <h1>Doom on a modified rotary phone</h1>
    
    <div id="readability-page-1" class="page"><div> <div>  <article>  <div> 
    
  
<p>Dialrhea is a modified rotary phone that has been repurposed to control the classic first-person shooter game Doom via Bluetooth. We built it in two days during the “Internet Of Shit” hackathon organized by Technarium crew in Vilnius, Lithuania. The theme of this hackathon was to build devices that are completely useless, but fully functional. Here is Dialrhea in action:</p>

<div>
        <iframe src="https://www.youtube.com/embed/YNjw6ZKlyNM" title="Watch Dialrhea in action" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
        <p><span><strong>Watch Dialrhea in action</strong>: https://www.youtube.com/watch?v=YNjw6ZKlyNM</span>
      </p></div>
    
<p>During the same weekend we also made a “slick” promotional video demonstrating capabilities of this revolutionary shitty machine.</p>

<div>
        <iframe src="https://www.youtube.com/embed/RVSE1t3wHlI" title="Watch Dialrhea promotional video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
        <p><span><strong>Watch Dialrhea promotional video</strong>: https://www.youtube.com/watch?v=RVSE1t3wHlI</span>
      </p></div>
    
<h2 id="whats-next">What’s next?</h2>
<p>I would like to host a workshop where we would build at least three more devices, and then play a Doom death match using these devices. Ideal setting would be some hacker camp or similar event. If you have ideas how to make it happen, drop me a line.</p>
<h2 id="the-story">The Story</h2>
<p>The device was built during “Internet Of Shit” hackathon. It’s an amazing event that was hosted by Technarium crew in Vilnius, Lithuania in 2017 and 2018. Award categories included the likes of “Fire Means It’s Working”, “Least Private On-line Gadget”, “This is Likely Illegal”, and the teams were competing hard to turn these concepts into a working piece of technology.</p>
<p>Our device won the “Least Shitty project” award, and we were also awarded the “Public Prize” for the most popular project. It is worth mentioning that the prize was a rubber drainage cleaning pump sprayed with gold paint.</p>
<p>The ingenious idea was generated after a few beers with Donatas Valiulis and Džiugas Bartkus. The tree of us carried out the whole operation with me and Donatas taking care of technical aspects and Džiugas responsible for video production and promotional materials.</p>
<p>Džiugas also made a nice trippy video about the making of the device and the whole hackathon in general.</p>

<div>
        <iframe src="https://www.youtube.com/embed/nAaBJcYIFyU" title="Watch Dialrhea making of video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
        <p><span><strong>Watch Dialrhea making of video</strong>: https://www.youtube.com/watch?v=nAaBJcYIFyU</span>
      </p></div>
    
<p>There were lots of other absurd projects built during the event, if you are interested, 
    <a href="https://www.youtube.com/watch?v=fujuv8Wm4F8" target="_blank" rel="noopener">here is the full one hour long presentation</a>
   of all projects of “Internet of Shit 2017” including Dialrhea.</p>
<h2 id="appearances">Appearances</h2>
<p>In addition to the hackathon, the device was also a guest of honor in numerous events including Maker Faire 2017 at The Energy and Technology Museum, No Trolls Allowed hacker camp, Vilnius Tech Park birthday, Braille Satellite music festival and others.</p>
<h3 id="vilnius-tech-park-birthday-2018">Vilnius Tech Park birthday 2018</h3>
<p>I spent quite some time in a co-working space in a newly opened Sapiegos Tech Park, a start-up / scale-up infested complex of old hospital buildings in a middle of a beautiful park in the center of the city. An amazing place where I met a lot of interesting people, attended many events and heard a tons of interesting business ideas being pitched near the kitchen sink. When Sapiegos Tech Park celebrated their second birthday I offered to fire up Dialrhea as an interactive installation.</p>

    <div>
      
        <p><img src="https://tamulaitis.lt/images/dialrhea/dialrhea-at-sapiegos-tech-park-2019-1.webp" alt="Dialrhea at Sapiegos Tech Park 1"/>
        </p>
      
        <p><img src="https://tamulaitis.lt/images/dialrhea/dialrhea-at-sapiegos-tech-park-2019-2.webp" alt="Dialrhea at Sapiegos Tech Park 2"/>
        </p>
      
    </div>
  
<p>There were many interesting people from business and tech world there. In a picture above you can see well known Lithuanian entrepreneur Valdas Lašas testing out Dialrhea and enjoying it. Unfortunately, he didn’t end up investing in this revolutionary shitty machine, probably because being old-school he didn’t understand how to use this high tech gadget properly and instinctively tried putting the phone to his ear, which obviously gained no results.</p>
<h3 id="braille-satellite-music-festival-2018">Braille Satellite music festival 2018</h3>
<p>On the other side of the spectrum was Dialrhea’s appearance in the Braille Satellite music festival. Taking place in an amazing Mushroom Manor in a middle of Lithuanian countryside it’s a small and cozy festival for the weirder side of electronic music.</p>

    <div>
      
        <p><img src="https://tamulaitis.lt/images/dialrhea/dialrhea-at-braille-satellite-2019-1.webp" alt="Dialrhea at Braille Satellite 1"/>
        </p>
      
        <p><img src="https://tamulaitis.lt/images/dialrhea/dialrhea-at-braille-satellite-2019-2.webp" alt="Dialrhea at Braille Satellite 2"/>
        </p>
      
    </div>
  
<p>Instead of entrepreneurs this time Dialrhea was battle tested with a bunch of ravers, hipsters, musicians and people who haven’t slept for three days.</p>
<h2 id="technical-details">Technical details</h2>
<p>The device is built on Arduino, and uses Bluetooth LE to communicate to the computer wirelessly. It presents itself as bluetooth keyboard and can be paired with any device supporting Bluetooth LE. Below you can see the breakdown of components powering Dialrhea.</p>
<p>
      <img src="https://tamulaitis.lt/images/dialrhea/dialrhea-insides.webp" alt="Insides of Dialrhea"/>
    </p>
<p>Although the ultimate use case for the device ended up being playing Doom, device actually has full support for multiple modes of operation:</p>
<ul>
<li><strong>Doom</strong> - in this mode the device acts as a game controller, and is configured to control classic Doom game (using Doomsday Engine)</li>
<li><strong>Emoji</strong> - this mode is best used with mobile phones and allows you to type emoji’s and send them to your friends</li>
<li><strong>Boring</strong> - in this mode Dialrhea just outputs the dialed numbers (not recommended)</li>
</ul>
<h3 id="reading-data-from-rotary-dial">Reading data from rotary dial</h3>
<p>The most interesting learning during the process was how the rotary dial actually works from technical point of view. I am from the generation who still remember using rotary phones so it was really interesting to understand both how simple the mechanism actually is and why I was getting electric shock while touching phone wires and playing phone mechanic only sometimes and not all the time. If you are interested 
    <a href="https://www.youtube.com/watch?v=cLGd6OB8D5k" target="_blank" rel="noopener">here is the video explaining the mechanism</a>
  .</p>

    <div>
      
        <p><img src="https://tamulaitis.lt/images/dialrhea/dialrhea-rotary-dial.webp" alt="Working on rotary dial"/>
        </p>
      
        <p><img src="https://tamulaitis.lt/images/dialrhea/dialrhea-fighting-bluetooth.webp" alt="Fighting bluetooth"/>
        </p>
      
    </div>
  
<p>After understanding how the mechanism works implementing it with Arduino was pretty much straight forward and I don’t remember having any major troubles with it.</p>
<h3 id="fighting-bluetooth">Fighting bluetooth</h3>
<p>Probably the biggest challenge was to make bluetooth communication work properly. We chose to use 
    <a href="https://learn.adafruit.com/introducing-the-adafruit-bluefruit-le-uart-friend" target="_blank" rel="noopener">Adafruit Bluefruit LE UART Friend</a>
   module for the job just because I had it lying around and also I already tried to work with it while working on another project. It is a very capable module, but most problems we had were around stability and reliability. Sometimes things worked well, sometimes we were getting some errors running exactly the same code. We read lots of documentation about how to follow proper handshake protocols, do pairing correctly, etc., but then ended up just adding retry loops and timeouts everywhere so the chip has time to “come to it’s senses” after each risky operation. You can see full source code for Dialrhea below.</p>
<div>
            <div>
              <div id="codeblock-3623754">
                <p><span>Click to enable scrolling</span>
                  <span>Tap to enable scrolling</span>
                </p>
              </div>
              <pre><code>

<span>#<span>include</span> <span>&lt;Arduino.h&gt;</span></span>
<span>#<span>include</span> <span>&lt;SPI.h&gt;</span></span>
<span>#<span>if</span> not defined (_VARIANT_ARDUINO_DUE_X_) &amp;&amp; not defined(ARDUINO_ARCH_SAMD)</span>
  <span>#<span>include</span> <span>&lt;SoftwareSerial.h&gt;</span></span>
<span>#<span>endif</span></span>
<span>#<span>include</span> <span>&#34;Adafruit_BLE.h&#34;</span></span>
<span>#<span>include</span> <span>&#34;Adafruit_BluefruitLE_UART.h&#34;</span></span>
<span>#<span>include</span> <span>&#34;BluefruitConfig.h&#34;</span></span>

<span>#<span>define</span> DEVICE_NAME <span>&#34;Dialrhea&#34;</span></span>


<span>#<span>define</span> ROTARY_PIN 2</span>

<span>#<span>define</span> HANDSET_PIN 3</span>

<span>#<span>define</span> OPERATION_MODE_PIN A5</span>


<span>#<span>define</span> CONTROL_KEY_HOLD_DURATION 200</span>

<span>#<span>define</span> FIRE_KEY_HOLD_DURATION 200</span>


<span>#<span>define</span> INSTANT_KEY_HOLD_DURATION 10</span>


<span>#<span>define</span> STATUS_LED_RED_PIN 4</span>
<span>#<span>define</span> STATUS_LED_GREEN_PIN 6</span>
<span>#<span>define</span> STATUS_LED_BLUE_PIN 5</span>


<span>#<span>define</span> COLOR_OFF 0</span>
<span>#<span>define</span> COLOR_RED 1</span>
<span>#<span>define</span> COLOR_GREEN 2</span>
<span>#<span>define</span> COLOR_BLUE 3</span>


<span>#<span>define</span> KEY_COUNT 14</span>



<span>#<span>define</span> KEY_GAMING_MODE_HANDSET_1_INDEX 10</span>
<span>#<span>define</span> KEY_GAMING_MODE_HANDSET_2_INDEX 11</span>

<span>#<span>define</span> KEY_EMOJI_MODE_HANDSET_INDEX 12</span>

<span>#<span>define</span> KEY_BORING_MODE_HANDSET_INDEX 13</span>


<span>const</span> <span>int</span> keyValues[KEY_COUNT] = {
  <span>0x42</span>, 
  <span>0x52</span>, 
  <span>0x4F</span>, 
  <span>0x50</span>, 
  <span>0x51</span>, 
  <span>0x2A</span>, 
  <span>0x00</span>, 
  <span>0x00</span>, 
  <span>0x00</span>, 
  <span>0x00</span>, 
  <span>0x10</span>, 
  <span>0x2C</span>, 
  <span>0x28</span>, 
  <span>0x29</span>  
};


<span>const</span> <span>int</span> keyHoldDurations[KEY_COUNT] = {
  INSTANT_KEY_HOLD_DURATION, 
  CONTROL_KEY_HOLD_DURATION, 
  CONTROL_KEY_HOLD_DURATION,
  CONTROL_KEY_HOLD_DURATION,
  CONTROL_KEY_HOLD_DURATION,
  INSTANT_KEY_HOLD_DURATION,
  INSTANT_KEY_HOLD_DURATION,
  INSTANT_KEY_HOLD_DURATION,
  INSTANT_KEY_HOLD_DURATION,
  INSTANT_KEY_HOLD_DURATION,
  FIRE_KEY_HOLD_DURATION,
  FIRE_KEY_HOLD_DURATION,
  INSTANT_KEY_HOLD_DURATION,
  INSTANT_KEY_HOLD_DURATION
};


<span>unsigned</span> <span>long</span> keyPressTimes[KEY_COUNT];

<span>bool</span> keyPressStates[KEY_COUNT];


<span>int</span> rotaryHasFinishedRotatingTimeout = <span>100</span>;
<span>int</span> rotaryDebounceTimeout = <span>10</span>;
<span>int</span> rotaryLastValue = <span>LOW</span>;
<span>int</span> rotaryTrueValue = <span>LOW</span>;
<span>unsigned</span> <span>long</span> rotaryLastValueChangeTime = <span>0</span>;
<span>bool</span> rotaryNeedToEmitEvent = <span>0</span>;
<span>int</span> rotaryPulseCount;


<span>#<span>define</span> OPERATION_MODE_GAMING 0 </span>
<span>#<span>define</span> OPERATION_MODE_EMOJI 1 </span>
<span>#<span>define</span> OPERATION_MODE_BORING 2 </span>


<span>int</span> operationMode;


<span>const</span> <span>char</span>* emojis[] = {<span>&#34;:-O&#34;</span>, <span>&#34;:poop:&#34;</span>,  <span>&#34;:-)&#34;</span>, <span>&#34;:-(&#34;</span>, <span>&#34;:-D&#34;</span>, <span>&#34;:-\\&#34;</span>, <span>&#34;;-)&#34;</span>, <span>&#34;:-*&#34;</span>, <span>&#34;:-P&#34;</span>, <span>&#34;&gt;:-(&#34;</span>};


<span>bool</span> isHandsetPressed = <span>false</span>;
<span>unsigned</span> <span>long</span> handsetPressStartTime = <span>0</span>;
<span>unsigned</span> <span>long</span> handsetPressStartTimeout = <span>60</span>;



<span>bool</span> keyPressStateChanged;


<span>#<span>define</span> FACTORYRESET_ENABLE         0</span>
<span>#<span>define</span> VERBOSE_MODE                false  </span>
<span>#<span>define</span> MINIMUM_FIRMWARE_VERSION    <span>&#34;0.6.6&#34;</span></span>
<span>#<span>define</span> BLUEFRUIT_HWSERIAL_NAME      Serial1</span>


<span>Adafruit_BluefruitLE_UART <span>ble</span><span>(BLUEFRUIT_HWSERIAL_NAME, BLUEFRUIT_UART_MODE_PIN)</span></span>;

<span><span>void</span> <span>setup</span><span>(<span>void</span>)</span> </span>{
  <span>pinMode</span>(ROTARY_PIN, <span>INPUT</span>);
  <span>pinMode</span>(HANDSET_PIN, <span>INPUT_PULLUP</span>);
  <span>pinMode</span>(STATUS_LED_RED_PIN, <span>OUTPUT</span>);
  <span>pinMode</span>(STATUS_LED_GREEN_PIN, <span>OUTPUT</span>);
  <span>pinMode</span>(STATUS_LED_BLUE_PIN, <span>OUTPUT</span>);

  <span>setStatusLEDColor</span>(COLOR_GREEN);

  
  
  
  
  
  <span>delay</span>(<span>1000</span>);

  <span>initializeSerialConnection</span>();
  <span>initializeBLEModule</span>();

  
  <span>delay</span>(<span>100</span>);

  <span>setStatusLEDColor</span>(COLOR_BLUE);
}

<span><span>void</span> <span>loop</span><span>(<span>void</span>)</span> </span>{
  keyPressStateChanged = <span>false</span>;
  <span>refreshOperationMode</span>();
  <span>handleHandset</span>();
  <span>handleRotary</span>();
  <span>processKeyUps</span>();

  
  <span>if</span> (keyPressStateChanged)
    <span>sendCurrentlyPressedKeys</span>();
}


<span><span>void</span> <span>setStatusLEDColor</span><span>(<span>int</span> colorID)</span> </span>{
  <span>digitalWrite</span>(STATUS_LED_RED_PIN, colorID == COLOR_RED ? <span>HIGH</span> : <span>LOW</span>);
  <span>digitalWrite</span>(STATUS_LED_GREEN_PIN, colorID == COLOR_GREEN ? <span>HIGH</span> : <span>LOW</span>);
  <span>digitalWrite</span>(STATUS_LED_BLUE_PIN, colorID == COLOR_BLUE ? <span>HIGH</span> : <span>LOW</span>);
}


<span><span>void</span> <span>error</span><span>(<span>const</span> __FlashStringHelper*err)</span> </span>{

  <span>setStatusLEDColor</span>(COLOR_RED);
  
  <span>Serial</span>.<span>println</span>(err);
  <span>while</span> (<span>1</span>);
}


<span><span>void</span> <span>blink</span><span>()</span> </span>{
  <span>setStatusLEDColor</span>(COLOR_OFF);
  <span>delay</span>(<span>100</span>);
  <span>setStatusLEDColor</span>(COLOR_GREEN);
}


<span><span>void</span> <span>initializeSerialConnection</span><span>()</span> </span>{
  <span>Serial</span>.<span>begin</span>(<span>9600</span>);
  <span>Serial</span>.<span>println</span>(<span>F</span>(<span>&#34;Hello, I am the Dialrhea! Ready for some dialing action?&#34;</span>));
  <span>Serial</span>.<span>println</span>(<span>F</span>(<span>&#34;8-------------------------------------D&#34;</span>));
}


<span><span>void</span> <span>initializeBLEModule</span><span>()</span> </span>{
  
  <span>char</span> commandString[<span>64</span>];

  <span>setStatusLEDColor</span>(COLOR_GREEN);

  <span>Serial</span>.<span>print</span>(<span>F</span>(<span>&#34;Initialising the Bluefruit LE module: &#34;</span>));
  <span>if</span> (!ble.<span>begin</span>(VERBOSE_MODE)) <span>error</span>(<span>F</span>(<span>&#34;Couldn&#39;t find Bluefruit, make sure it&#39;s in CoMmanD mode &amp; check wiring?&#34;</span>));
  <span>Serial</span>.<span>println</span>( <span>F</span>(<span>&#34;Easy!&#34;</span>) );

  <span>blink</span>();

  <span>if</span> (FACTORYRESET_ENABLE)
  {
    <span>Serial</span>.<span>println</span>(<span>F</span>(<span>&#34;Performing a factory reset: &#34;</span>));
    <span>if</span> (!ble.<span>factoryReset</span>()) <span>error</span>(<span>F</span>(<span>&#34;Couldn&#39;t factory reset. Have no idea why...&#34;</span>));
    <span>Serial</span>.<span>println</span>(<span>F</span>(<span>&#34;Done, feeling like a virgin again!&#34;</span>));
  }

  <span>blink</span>();

  
  ble.<span>echo</span>(<span>false</span>);

  <span>blink</span>();

  <span>Serial</span>.<span>println</span>(<span>&#34;Requesting Bluefruit info:&#34;</span>);
  ble.<span>info</span>();

  <span>blink</span>();

  
  <span>Serial</span>.<span>print</span>(<span>F</span>(<span>&#34;Setting device name to &#39;&#34;</span>));
  <span>Serial</span>.<span>print</span>(DEVICE_NAME);
  <span>Serial</span>.<span>print</span>(<span>F</span>(<span>&#34;&#39;: &#34;</span>));
  <span>sprintf</span>(commandString, <span>&#34;AT+GAPDEVNAME=%s&#34;</span>, DEVICE_NAME);
  <span>if</span> (!ble.<span>sendCommandCheckOK</span>(commandString)) <span>error</span>(<span>F</span>(<span>&#34;Could not set device name for some reason. Sad.&#34;</span>));
  <span>Serial</span>.<span>println</span>(<span>F</span>(<span>&#34;It&#39;s beautiful!&#34;</span>));

  <span>blink</span>();

  <span>Serial</span>.<span>print</span>(<span>F</span>(<span>&#34;Enable HID Service (including Keyboard): &#34;</span>));
  <span>strcpy</span>(commandString, ble.<span>isVersionAtLeast</span>(MINIMUM_FIRMWARE_VERSION) ? <span>&#34;AT+BleHIDEn=On&#34;</span> : <span>&#34;AT+BleKeyboardEn=On&#34;</span>);
  <span>if</span> (!ble.<span>sendCommandCheckOK</span>(commandString)) <span>error</span>(<span>F</span>(<span>&#34;Could not enable Keyboard, we&#39;re in deep shit...&#34;</span>));
  <span>Serial</span>.<span>println</span>(<span>F</span>(<span>&#34;I&#39;m now officially a keyboard!&#34;</span>));

  <span>blink</span>();

  
  <span>Serial</span>.<span>print</span>(<span>F</span>(<span>&#34;Performing a SW reset (service changes require a reset): &#34;</span>));
  <span>if</span> (!ble.<span>reset</span>()) <span>error</span>(<span>F</span>(<span>&#34;Couldn&#39;t reset?? Lame.&#34;</span>));
  <span>Serial</span>.<span>println</span>(<span>F</span>(<span>&#34;Baby I&#39;m ready to go!&#34;</span>));
  <span>Serial</span>.<span>println</span>();
}


<span><span>void</span> <span>refreshOperationMode</span><span>()</span> </span>{
  operationMode = <span>floor</span>((<span>float</span>)<span>analogRead</span>(OPERATION_MODE_PIN) / <span>342.0</span>);
}


<span><span>void</span> <span>handleHandset</span><span>()</span> </span>{
  
  <span>if</span> (<span>millis</span>() - handsetPressStartTime &gt; handsetPressStartTimeout) {
    <span>int</span> ragelisCurrentValue = <span>digitalRead</span>(HANDSET_PIN);
    
    <span>if</span> (!isHandsetPressed &amp;&amp; ragelisCurrentValue == <span>HIGH</span>) {
      isHandsetPressed = <span>true</span>;
      handsetPressStartTime = <span>millis</span>();
      <span>onHandsetClicked</span>();
    }

    <span>else</span> <span>if</span> (isHandsetPressed &amp;&amp; ragelisCurrentValue == <span>LOW</span>) {
      isHandsetPressed = <span>false</span>;
      handsetPressStartTime = <span>millis</span>(); 
    }
  }
}


<span><span>void</span> <span>handleRotary</span><span>()</span> </span>{
  <span>int</span> rotaryCurrentValue = <span>digitalRead</span>(ROTARY_PIN);

  
  <span>if</span> ((<span>millis</span>() - rotaryLastValueChangeTime) &gt; rotaryHasFinishedRotatingTimeout) {
    
    <span>if</span> (rotaryNeedToEmitEvent) {
      
      <span>onRotaryNumberDialed</span>(rotaryPulseCount % <span>10</span>);
      rotaryNeedToEmitEvent = <span>false</span>;
      rotaryPulseCount = <span>0</span>;
    }
  }

  
  <span>if</span> (rotaryCurrentValue != rotaryLastValue) {
    rotaryLastValueChangeTime = <span>millis</span>();
  }

  
  <span>if</span> ((<span>millis</span>() - rotaryLastValueChangeTime) &gt; rotaryDebounceTimeout) {
    
    <span>if</span> (rotaryCurrentValue != rotaryTrueValue) {
      
      rotaryTrueValue = rotaryCurrentValue;

      
      <span>if</span> (rotaryTrueValue == <span>HIGH</span>) {
        rotaryPulseCount++; 
        rotaryNeedToEmitEvent = <span>true</span>;
      } 
    }
  }

  
  rotaryLastValue = rotaryCurrentValue;
}


<span><span>void</span> <span>onHandsetClicked</span><span>()</span> </span>{
  
  <span>if</span> (operationMode == OPERATION_MODE_GAMING) {
    <span>if</span> (keyPressStates[KEY_GAMING_MODE_HANDSET_1_INDEX] == <span>false</span> || keyPressStates[KEY_GAMING_MODE_HANDSET_2_INDEX] == <span>false</span>)
      keyPressStateChanged = <span>true</span>;
  
    keyPressStates[KEY_GAMING_MODE_HANDSET_1_INDEX] = <span>true</span>;
    keyPressTimes[KEY_GAMING_MODE_HANDSET_1_INDEX] = <span>millis</span>();
  
    keyPressStates[KEY_GAMING_MODE_HANDSET_2_INDEX] = <span>true</span>;
    keyPressTimes[KEY_GAMING_MODE_HANDSET_2_INDEX] = <span>millis</span>();
  } <span>else</span> <span>if</span> (operationMode == OPERATION_MODE_EMOJI) {
    <span>if</span> (keyPressStates[KEY_EMOJI_MODE_HANDSET_INDEX] == <span>false</span>)
      keyPressStateChanged = <span>true</span>;
  
    keyPressStates[KEY_EMOJI_MODE_HANDSET_INDEX] = <span>true</span>;
    keyPressTimes[KEY_EMOJI_MODE_HANDSET_INDEX] = <span>millis</span>();
  } <span>else</span> <span>if</span> (operationMode == OPERATION_MODE_BORING) {
    <span>if</span> (keyPressStates[KEY_BORING_MODE_HANDSET_INDEX] == <span>false</span>)
      keyPressStateChanged = <span>true</span>;
  
    keyPressStates[KEY_BORING_MODE_HANDSET_INDEX] = <span>true</span>;
    keyPressTimes[KEY_BORING_MODE_HANDSET_INDEX] = <span>millis</span>();
  }
}


<span><span>void</span> <span>onRotaryNumberDialed</span><span>(<span>int</span> number)</span> </span>{
  <span>if</span> (operationMode == OPERATION_MODE_GAMING) {
    
    <span>if</span> (keyPressStates[number] == <span>false</span>)
      keyPressStateChanged = <span>true</span>;
  
    keyPressStates[number] = <span>true</span>;
    keyPressTimes[number] = <span>millis</span>();
  } <span>else</span> <span>if</span> (operationMode == OPERATION_MODE_EMOJI) {
    
    <span>sendCharArray</span>(emojis[number]);
  } <span>else</span> <span>if</span> (operationMode == OPERATION_MODE_BORING) {
    
    <span>char</span> numberString[<span>1</span>];
    <span>sprintf</span>(numberString, <span>&#34;%d&#34;</span>, number);
    <span>sendCharArray</span>(numberString);
  }
}


<span><span>void</span> <span>sendBluetoothCommand</span><span>(<span>char</span> *commandString)</span> </span>{
  <span>setStatusLEDColor</span>(COLOR_OFF);

  <span>Serial</span>.<span>print</span>(commandString);

  ble.<span>println</span>(commandString);
  <span>if</span> (ble.<span>waitForOK</span>()) {
    <span>Serial</span>.<span>println</span>(<span>F</span>(<span>&#34; &lt;- OK!&#34;</span>)); 
    <span>setStatusLEDColor</span>(COLOR_BLUE);
  }
  <span>else</span> {
    <span>Serial</span>.<span>println</span>(<span>F</span>(<span>&#34; &lt;- FAILED!&#34;</span>));
    <span>setStatusLEDColor</span>(COLOR_RED);
  };
}


<span><span>void</span> <span>sendCharArray</span><span>(<span>char</span>* charArray)</span> </span>{
  <span>char</span> commandString[<span>64</span>];
  <span>sprintf</span>(commandString, <span>&#34;AT+BleKeyboard=%s&#34;</span>, charArray);
  <span>sendBluetoothCommand</span>(commandString);
}


<span><span>void</span> <span>sendCurrentlyPressedKeys</span><span>()</span> </span>{
  <span>char</span> commandString[<span>64</span>] = <span>&#34;AT+BleKeyboardCode=00-00&#34;</span>;

  <span>for</span> (<span>int</span> i=<span>0</span>; i&lt;KEY_COUNT; i++) {
    <span>if</span> (keyPressStates[i] == <span>true</span> &amp;&amp; keyValues[i] != <span>0x00</span>) {
      <span>sprintf</span> (commandString, <span>&#34;%s-%02X&#34;</span>, commandString, keyValues[i]);
    }
  }

  <span>sendBluetoothCommand</span>(commandString);
}


<span><span>void</span> <span>processKeyUps</span><span>()</span> </span>{
  <span>for</span> (<span>int</span> i=<span>0</span>; i&lt;KEY_COUNT; i++) {
    <span>if</span> (keyPressStates[i] == <span>true</span>) {
      <span>if</span> (<span>millis</span>() - keyPressTimes[i] &gt; keyHoldDurations[i]) {
        keyPressStates[i] = <span>false</span>;
        keyPressStateChanged = <span>true</span>;
      }
    }
  }
}
</code></pre>
              
            </div>
          </div>
          
        
<p>There is actually a very interesting bug in this device that allows player to “leap” forward very quickly. I have seen it happening several times, usually after somebody was frantically bashing the device for a while. I literally have no idea why it happens or how to reproduce it, but I actually find it really cool, so I decided to just leave it in and call it a feature.</p>
<h2 id="doom">Doom</h2>
<p>It is no coincidence that classic Doom was chosen as a subject to be controlled by Dialrhea. I absolutely love the game and was obsessed by it while growing up. My father brought it back from his work one day in like 10 floppy disks. I had to learn how to write custom <code>autoexec.bat</code> and <code>config.sys</code> files and boot the system up from special floppy disk containing minimal version of MS-DOS and highly optimized mouse driver so there is just enough memory to run Doom on my Intel 386 33Mhz machine that only had 4Mb of RAM if I remember correctly. <code>&#34;LH A:\MOUSE.COM&#34;</code> was the magic line that told DOS to load mouse driver into otherwise unreachable high memory therefore winning some additional kilobytes of RAM for Doom.</p>

    <div>
      
        <p><img src="https://tamulaitis.lt/images/dialrhea/doom-title-screen.webp" alt="Doom 1993 title screen"/>
        </p>
      
        <p><img src="https://tamulaitis.lt/images/dialrhea/doom-floppy-disks.webp" alt="Doom in floppy discs"/>
        </p>
      
    </div>
  
<p>Apparently I was not the only one obsessed by Doom, many years later that I found out that Doom and it’s creators “id Software” actually redefined the PC gaming market and were first to introduce shareware distribution model successfully. At one point more personal computers had Doom than Windows 95 operating system installed. There is a great book 
    <a href="https://www.amazon.com/Masters-Doom-Created-Transformed-Culture/dp/0812972155" target="_blank" rel="noopener">“Masters of Doom” by David Kushner</a>
   that tells the story of “id Software” with lots of incredible details, highly recommended read. 
    <a href="https://www.youtube.com/watch?v=iGdkm780730" target="_blank" rel="noopener">This YouTube video</a>
   also paints quite a nice picture about the innovation and drama inside “id Software”. I still think that Doom is the best game that was ever released.</p>
<h2 id="doom-running-on-everything">Doom running on everything</h2>
<p>One more reason to choose Doom to be controlled with rotary phone was that Doom is notorious for being able to run on pretty much any hardware. Well, actually crazy Doom fans are notorious for making Doom run on pretty much any hardware. Doom was made to run on calculators, microwaves, treadmills, traffic ticket validators, vapes and even pregnancy tests! If the device has a CPU and the screen, there will be some geek trying to run Doom on that machine. Subreddit 
    <a href="https://www.reddit.com/r/itrunsdoom/" target="_blank" rel="noopener">r/itrunsdoom</a>
   has the most impressive collection of devices running Doom that I’ve seen so far.</p>
<p>
      <img src="https://tamulaitis.lt/images/dialrhea/doom-running-on-everything.webp#full-width" alt="Doom running on everything"/>
    </p>
<p>One of the more interesting projects was one guy 
    <a href="https://www.youtube.com/watch?v=KFDlVgBMomQ" target="_blank" rel="noopener">running Doom on scientific calculator powered by ~800 potatoes</a>
  ! Yes, potatoes! Compared to this our Dialrhea project doesn’t seem so crazy.</p>
<h2 id="competition">Competition</h2>
<p>Apparently we were not the only ones willing to waste our time building ridiculous machine like this. Good five years after our attempt somewhere in Japan the guy named Yoshino built similar device. I have to admit his marketing campaign was way more successful than ours and the video went viral, being covered by major gaming outlets like PC Gamer, IGN and others and even provoking a tweet from John Romero (one of the people who created original Doom) himself.</p>
<p>
      <img src="https://tamulaitis.lt/images/dialrhea/john-romero-tweet.webp#padding-on-mobile" alt="John Romero&#39;s tween about rotary phone"/>
    </p>
<p>Compared to Dialrhea, Yoshino’s device doesn’t utilize handset at all forcing you to dial <code>1</code> to shoot (which is way less fun than frantically mashing the handset). Also you need to connect it to the computer via cable while Dialrhea is fully wireless and supports Bluetooth LE. Just another example how technologically superior solution doesn’t always win the market, marketing does.</p>
<!-- This is v1.3 of this article. --> </div>  </article> </div>  </div></div>
  </body>
</html>
