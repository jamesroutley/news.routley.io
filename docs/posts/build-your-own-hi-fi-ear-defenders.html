<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://spectrum.ieee.org/hi-fi-ear-defenders">Original</a>
    <h1>Build your own hi-fi ear defenders</h1>
    
    <div id="readability-page-1" class="page"><div data-headline="Build Your Own Hi-fi Ear Defenders" data-elid="2666324942" data-post-url="https://spectrum.ieee.org/hi-fi-ear-defenders" data-authors="Pete Lewis" data-page-title="Build Your Own Hi-fi Ear Defenders - IEEE Spectrum"><div><p>
	Many of us have gotten used to being able to dampen unwanted sound, thanks to the noise-cancellation technology found in, for example, Apple’s <a href="https://www.apple.com/airpods-pro/" rel="noopener noreferrer" target="_blank">AirPods Pro earbuds</a>. But this tech gets you only so far: Noise cancellation works just for relatively low frequencies, and the overall hearing protection that earbuds can offer is also relatively limited. Earplugs or over-the-ear defenders are an option, but they block wanted as well as unwanted sounds. There are industrial solutions that pass through sounds in specific frequency ranges, but these are targeted at speech. As a musician who plays loud music, I want a way to protect my hearing and to be able to hear myself, my bandmates, and the audience with high fidelity.
</p><p>
	For years, I have been trying to improve my personal audio-monitoring situation without going to the expense of the systems used by professional touring bands, which include custom-molded earpieces. Now, after countless versions of wiring things together, and even designing my own audio mixers, I finally have a <a href="https://spectrum.ieee.org/topic/diy/">DIY</a> solution that works within a reasonable budget. My approach was to adapt an idea used in some pass-through systems, placing ambient microphones on the outside of sound-isolating headphones. I would capture the signal from these external mics at high quality and feed it into the headphones at the desired volume.
</p><p>
	Of course, easier said than done. For my first prototype, I bought a set of US $40 <a href="https://www.amazon.com/Smoostart-Cancelling-Protection-Snowblowing-Construction/dp/B08M95FP4X" rel="noopener noreferrer" target="_blank">ear defenders that had a built-in AM/FM radio</a>, which fed into small speakers in the ear “cans” and extracted the radio electronics to make some space. I then hooked up a chain of breakout boards from my full-time employer, <a href="https://www.sparkfun.com/" rel="noopener noreferrer" target="_blank">SparkFun Electronics</a>: A $7 <a href="https://www.sparkfun.com/products/18011" rel="noopener noreferrer" target="_blank">ICS-40180 MEMS microphone</a>, a $6 <a href="https://www.sparkfun.com/products/14874" rel="noopener noreferrer" target="_blank">TSH82 op-amp</a>, and an $11 <a href="https://www.sparkfun.com/products/20690" rel="noopener noreferrer" target="_blank">TPA2016D2 class-D amplifier</a>. My initial testing went okay, in that I could hear the sound from the mics when I wore the defenders, but I quickly noticed a problem.
</p><p><img alt="An illustration of components." data-rm-shortcode-id="3bea1b30cf24ca02d9a6e0f11d6b86be" data-rm-shortcode-name="rebelmouse-image" data-runner-src="https://spectrum.ieee.org/media-library/an-illustration-of-components.jpg?id=50530145&amp;width=980" height="1155" id="e9447" lazy-loadable="true" src="data:image/svg+xml,%3Csvg%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20viewBox=&#39;0%200%201540%201155&#39;%3E%3C/svg%3E" width="1540"/><small placeholder="Add Photo Caption...">The author needed a properly shielded grounded cable (1) to bring in a signal from the left microphone (2) to the audio codec board (3), which is mounted on a custom circuit board (4) inside the right headphone. Also mounted on the board are the ESP32 microcontroller (5) and a volume control and audio jack (6). </small><small placeholder="Add Photo Credit...">James Provost</small></p><p>
	I’m a drummer. When I played very gently on my drum set, the audio was clear, but as soon as I hit a drum with even moderate force, the pass-through signal became rudely distorted, or clipped. Puzzled, I checked the specs of the microphone. The datasheet indicated it had an acoustic overload point (AOP) of 124 decibels. It seemed like the microphone should be more than capable of handling an acoustic drum set—which, according to my calibrated sound-level meter, was producing a peak of only 115 dB during my hardest-hitting playing.
</p><p>
	The microphone’s breakout board applies a gain of 64x, using two stages. My first thought was to reduce this gain. Maybe the clipping was happening at only the first gain stage. Unfortunately, even with this gain eliminated, the clipping remained. I then tested the raw MEMS microphone output by feeding it into some “pro grade” mic preamps. With this setup, I was able to see that the problem wasn’t the amplification stages but that the mics themselves were producing the clipping. Through this test, I learned a valuable lesson: A mic’s listed AOP is the point at which the microphone will produce a 10 percent<a href="https://en.wikipedia.org/wiki/Total_harmonic_distortion" rel="noopener noreferrer" target="_blank"> total harmonic distortion</a>, and so noticeable clipping can actually start to happen well below this level.
</p><p>
	I was on the hunt for another cheap small MEMS mic that could handle louder sound sources. I found the <a href="https://www.sparkfun.com/products/21537" rel="noopener noreferrer" target="_blank">Vesper VM2020</a>, with an impressive AOP of 149 dB! I spun up a new breakout board for the VM2020 and was testing it in no time. Initial results were good—the VM2020 did not clip the signal no matter how hard I played! However, due to the middling sensitivity of this microphone (–63 dB), it was necessary to add a lot of gain to the signal. Combined with the microphone’s equally middling signal-to-noise ratio of 50 dB, this resulted in too much hiss in the output for my musical needs. I went on the hunt for yet another microphone. I found the $5<a href="https://puiaudio.com/product/microphones/aom-5035l-hd3-r" rel="noopener noreferrer" target="_blank"> AOM-5035L by PUI Audio</a>, which is an <a href="https://en.wikipedia.org/wiki/Electret_microphone" rel="noopener noreferrer" target="_blank">electret condenser</a> type. This microphone had three important specs: high AOP (135 dB), good sensitivity (–35 dB), and a better signal-to-noise ratio of 75 dB.
</p><p><img alt="A set of system elements arranged around the audio codec board in a star arrangement" data-rm-shortcode-id="172c4587342462ce822ff67d682af9e7" data-rm-shortcode-name="rebelmouse-image" data-runner-src="https://spectrum.ieee.org/media-library/a-set-of-system-elements-arranged-around-the-audio-codec-board-in-a-star-arrangement.jpg?id=50530151&amp;width=980" height="748" id="fefd1" lazy-loadable="true" src="data:image/svg+xml,%3Csvg%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20viewBox=&#39;0%200%201240%20748&#39;%3E%3C/svg%3E" width="1240"/><small placeholder="Add Photo Caption...">The WM8960 audio codec translates incoming sound signals—whether they’re analog from the microphones, an audio cable, or digital signals received from the ESP32 microcontroller—into audible sounds that a wearer can hear. The ESP32 also configures the codec board on startup.</small><small placeholder="Add Photo Credit...">James Provost</small></p><p>
	Around the time of finding this microphone, I had just completed another breakout board for SparkFun. It was for the audio codec chip by Wolfson, the $18 <a href="https://www.sparkfun.com/products/21250" rel="noopener noreferrer" target="_blank">WM8960</a>. This board was more suited for this project than my previous choice, the TPA2016D2. The WM8960 has a quieter initial gain stage that’s designed for microphones. However, I now needed a microcontroller to initialize and control the WM8960. I chose the $10 <a href="https://www.sparkfun.com/products/17830" rel="noopener noreferrer" target="_blank">ESP32</a> because it would allow me to operate the WM8960 and also accept audio via a Bluetooth connection from, say, my phone, and stream it to the WM8960.
</p><p>I created a motherboard PCB to ensure everything fitted nicely into the right ear can of my hacked ear defenders. On the outside of each can I placed a microphone to provide stereo sound. (A detailed <a href="https://docs.sparkfun.com/SuperHeadphones/introduction/" rel="noopener noreferrer" target="_blank">step-by-step guide</a> is available on the SparkFun website.) Soon I was enjoying a clean audio signal with no clipping and no hiss during my drum rehearsals. But in a last wrinkle, I noticed that sometimes there was a small whining noise that would vary in pitch in the left audio channel. This became more pronounced when the batteries were getting low, and if I turned off the ESP32’s Bluetooth, some of the noise would go away. In an attempt to solve this, I first added a separate and dedicated ground connection from the left microphone back to the electronics in the right ear can. This reduced the whine but did not remove it entirely. I finally used a proper shielded microphone cable to connect the microphone to the WM8960. This eliminated the noise completely. Success! I’ve been playing away with protected hearing, and for less than $100 and some bench time, you too can have your very own custom set of Superheadphones!</p></div></div></div>
  </body>
</html>
