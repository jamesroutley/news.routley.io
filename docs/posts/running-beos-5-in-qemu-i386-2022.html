<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://john-millikin.com/running-beos-5-in-qemu-i386">Original</a>
    <h1>Running BeOS 5 in QEMU (i386) (2022)</h1>
    
    <div id="readability-page-1" class="page"><div posted="2022-07-09T06:51:22Z"><p><a href="https://en.wikipedia.org/wiki/BeOS">BeOS</a> is an operating system from the &#39;90s, notable for its prescient technical decisions and abject business failure<blog-footnote-ref>[<a href="#fn:1">1</a>]</blog-footnote-ref>. It embraced multi-threading at a time when 100mhz CPUs powered top-shelf workstations, and featured metadata-backed virtual folders ten years before their arrival in mainstream OSes.</p><blog-section><h2 slot="title">Installation media</h2><p>The installation CD-ROM for BeOS Pro Edition 5.0 is available on the Internet Archive. It&#39;s been uploaded there at least twice, but the content is identical, so either one works. You&#39;ll need both the <tt>.bin</tt> and <tt>.cue</tt> files.</p><ul><li><a href="https://archive.org/details/BeosVersion5.0.3IntelAndPpc">BeOS Version 5.0.3 Intel and PPC</a> (uploaded 2017-08-23)</li><li><a href="https://archive.org/details/beos-5.0.3-professional-gobe">BeOS Professional Edition 5.0.3</a> (uploaded 2021-08-18)</li></ul><blog-code syntax="commands"><pre>shasum -a 256 *
# 1889fd6cf5af4259b01c9d1925e62f664effdf9dd88f924dc9b4da41ce1f0106  BeOS_Tools.bin
# 6f4fd9fbf7dff01d27391bee3b8bb27def7ed2fcd978f4b698c220b69eb89af9  BeOS_Tools.cue
# 1889fd6cf5af4259b01c9d1925e62f664effdf9dd88f924dc9b4da41ce1f0106  beos-5.0.3-professional-gobe.bin
# a57d9552cdadbbdbe6f608e8dbe9ac2bec2a010da1ad801fc0176e4d66bb234c  beos-5.0.3-professional-gobe.cue</pre></blog-code><p>The BeOS installation media has an unusual layout with three separate filesystems, which must be split to be usable by QEMU<blog-footnote-ref>[<a href="#fn:4">4</a>]</blog-footnote-ref>. Use <a href="http://he.fi/bchunk/">bchunk</a> to extract the bootable ISO 9660 filesystem into a <tt>.iso</tt> file.</p><blog-code syntax="commands"><pre>curl -L -O https://raw.githubusercontent.com/hessu/bchunk/release/1.2.2/bchunk.c
shasum -a 256 bchunk.c
# 34ce2e8c23b41a9f14a7e4f50e14996f2754c27237ba431ede1caaee39e759a6  bchunk.c
gcc -o bchunk bchunk.c
./bchunk BeOS_Tools.bin BeOS_Tools.cue BeOS_Tools.iso
# binchunker for Unix, version 1.2.2 by Heikki Hannikainen &lt;hessu@hes.iki.fi&gt;
# 	Created with the kind help of Bob Marietta &lt;marietrg@SLU.EDU&gt;,
# 	partly based on his Pascal (Delphi) implementation.
# 	Support for MODE2/2352 ISO tracks thanks to input from
# 	Godmar Back &lt;gback@cs.utah.edu&gt;, Colas Nahaboo &lt;Colas@Nahaboo.com&gt;
# 	and Matthew Green &lt;mrg@eterna.com.au&gt;.
# 	Released under the GNU GPL, version 2 or later (at your option).
# 
# Reading the CUE file:
# 
# Track  1: MODE1/2352    01 00:00:00
# Track  2: MODE1/2352    01 10:48:58
# Track  3: MODE1/2352    01 46:07:03
# 
# Writing tracks:
# 
#  1: BeOS_Tools.iso01.iso   95/95   MB  [********************] 100 %
#  2: BeOS_Tools.iso02.iso  310/310  MB  [********************] 100 %
#  3: BeOS_Tools.iso03.iso  236/236  MB  [********************] 100 %
shasum -a 256 *.iso
# 5c193d1855ad542f9a40a092a32bf2c6072e273a51d781dbf925a9a02e66d759  BeOS_Tools.iso01.iso
# 0031b4eb35a8ebfcf578d197c2372dfda0f748ef260f44dba2dd93740da35626  BeOS_Tools.iso02.iso
# 26b771b4f22f01b3311b86c82d4a7c2f6d84973b2ed506cf8d65738732f21708  BeOS_Tools.iso03.iso</pre></blog-code><p>Of the split files, <tt>iso01</tt> is bootable. The other two are BeFS filesystems containing x86 and PowerPC installation data.</p><blog-code syntax="commands"><pre>ls -lh *.iso
# -rw-rw-r-- 1 john john  96M Oct  8 14:56 BeOS_Tools.iso01.iso
# -rw-rw-r-- 1 john john 311M Oct  8 14:56 BeOS_Tools.iso02.iso
# -rw-rw-r-- 1 john john 236M Oct  8 14:56 BeOS_Tools.iso03.iso
sudo mount -o loop BeOS_Tools.iso01.iso BeOS_Tools_01
sudo mount -o loop BeOS_Tools.iso02.iso BeOS_Tools_02
sudo mount -o loop BeOS_Tools.iso03.iso BeOS_Tools_03
ls BeOS_Tools_01
# AUTORUN.INF  boot.catalog  floppy.img  GNU  Gobe  Macintosh  Personal  PMAGIC
ls BeOS_Tools_02
# apps  beos  demos  home  _packages_  preferences  var
file BeOS_Tools_02/beos/apps/Terminal
# BeOS_Tools/beos/apps/Terminal: ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, not stripped
file BeOS_Tools_03/beos/apps/Terminal
# BeOS_Tools/beos/apps/Terminal: header for PowerPC PEF executable</pre></blog-code><p>Note how the x86 edition of BeOS uses a common executable format (<a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">ELF</a>), whereas the PowerPC edition uses <a href="https://en.wikipedia.org/wiki/Preferred_Executable_Format">PEF</a> from early Mac OS. It&#39;s an unusual decision.</p></blog-section><blog-section><h2 slot="title">Booting the installer</h2><p>We&#39;re now ready to start up QEMU and enter the BeOS graphical installer.</p><blog-code syntax="commands"><pre>qemu-system-i386 -version
# QEMU emulator version 7.0.0
# Copyright (c) 2003-2022 Fabrice Bellard and the QEMU Project developers
qemu-img create -f qcow2 beos-5.img 1G
# Formatting &#39;beos-5.img&#39;, fmt=qcow2 cluster_size=65536 extended_l2=off compression_type=zlib size=1073741824 lazy_refcounts=off refcount_bits=16
qemu-system-i386 -m 512M \
  -drive media=cdrom,file=BeOS_Tools.iso01.iso \
  -drive media=cdrom,file=BeOS_Tools.iso02.iso \
  -drive file=beos-5.img</pre></blog-code><p><img src="https://john-millikin.com/by-sha256/028754df4b20845987086c7d384b1097519b3f06b06a1e85ef1eca2e54f86553/Screen%20Shot%202022-07-08%20at%2013.12.07.png"/>
<img src="https://john-millikin.com/by-sha256/87c0825ef5524659b01a3e1e5f525306c27b456b80f6255e2dd29c2c88362954/Screen%20Shot%202022-07-08%20at%2013.12.13.png"/></p><p>At this point the screen will go blank and no further progress happens. To proceed, we must use the boot menu to disable BIOS calls.</p><p><img src="https://john-millikin.com/by-sha256/b74c5bb01a023d401997c92fb440a4b21433a2412ff37108c131ec20c712a978/Screen%20Shot%202022-07-08%20at%2013.16.56.png"/>
<img src="https://john-millikin.com/by-sha256/de8f94fc3d6582b7af2e1aab3ff1636af91b83d4511a5810eb27b17ad64cb0ad/Screen%20Shot%202022-07-08%20at%2013.17.02.png"/></p><p>The installer is now able to boot, and it would actually be able to fully install from here. However, BeOS doesn&#39;t recognize the QEMU graphics device and therefore defaults to low-resolution greyscale graphics.</p><p><img src="https://john-millikin.com/by-sha256/172ae576e3a6d0185c34249499fe15330a7b28f47251e5704afe7f97fc7a2a17/Screen%20Shot%202022-07-08%20at%2013.17.26.png"/></p><p>Going back to the boot screen, the default video mode can be manually configured to something more reasonable. I picked <tt>1024x768x16</tt> to get color and a bit more usable screen area.</p><p><img src="https://john-millikin.com/by-sha256/291d007b26248b01b23fee6dd19b1e5f5475bc058f504fb872efd441f9f49ef9/Screen%20Shot%202022-07-08%20at%2013.18.31.png"/>
<img src="https://john-millikin.com/by-sha256/11751b7ef439f46056d6421807190a510a92db95b30022726a88f9118b365032/Screen%20Shot%202022-07-08%20at%2013.19.21.png"/></p><p>BeOS is now ready to install.</p><p><img src="https://john-millikin.com/by-sha256/7aa28aaba778356c0e7b6e8c7a24972541d0fd25cff786e12d2d3273c7ea039a/Screen%20Shot%202022-07-08%20at%2013.20.56.png"/></p></blog-section><blog-section><h2 slot="title">Installing BeOS</h2><p>The installation process for BeOS 5 is mostly unremarkable to modern eyes, but remember this thing was a contemporary of Windows 98. The typical installer UI back then used text-mode VGA, and then here comes BeOS with full graphics (the windows repaint on drag!) straight from the installation media.</p><p>Also, I say <i>mostly</i> unremarkable, because there&#39;s no modern OS in the world that could install a complete desktop environment (including web browser and development tools) in 265 MB. Chrome is larger than that just by itself<blog-footnote-ref>[<a href="#fn:5">5</a>]</blog-footnote-ref></p><p><img src="https://john-millikin.com/by-sha256/4ad6168d5720361eaa75f135b299cd84a269e0d1e138dd39e7a121c2e7716f91/Screen%20Shot%202022-07-08%20at%2013.22.33.png"/></p><p><img src="https://john-millikin.com/by-sha256/4fe870f08e6b43690dde6a367b27e60184e66b5a57665ddcf9f54cfebd868d7f/Screen%20Shot%202022-07-08%20at%2013.23.59.png"/>
<img src="https://john-millikin.com/by-sha256/d94a0f5ebfa42616a0e4c2d3e3f802133459cf3028f755e5f32308c40768f816/Screen%20Shot%202022-07-08%20at%2013.25.36.png"/></p><p><img src="https://john-millikin.com/by-sha256/be7df93c3b118788dbf75ea15cbc2811d2a86962ec915e68c707585dd75eca1c/Screen%20Shot%202022-07-08%20at%2013.32.19.png"/></p></blog-section><blog-section><h2 slot="title">Post-install configuration</h2><p>At this point, BeOS has been installed but still has some emulation issues. It will kernel panic on startup unless BIOS calls are disabled in the boot menu, and the graphics will default to 640x480 greyscale. Also, it doesn&#39;t have any network connectivity.</p><p>For networking, the list of supported NICs is available at <a href="https://web.archive.org/web/20010331170926/http://www.be.com/support/guides/beosreadylist_intel.html#network">BeOS Ready List - Intel Â» BeOS Ready Network Cards and Connections</a>. QEMU&#39;s default NIC emulates an Intel e1000, but it can also emulate the NE2000 family supported by BeOS.</p><blog-code syntax="commands"><pre>$ qemu-system-i386 -m 512M -drive file=beos-5.img -nic user,model=ne2k_pci</pre></blog-code><p>Once booted, go into the BeOS network preferences and enable DHCP. Click &#34;restart networking&#34; to let the changes take effect. The QEMU user-mode networking stack has built-in DHCP and DNS servers, so it doesn&#39;t matter how the host system is configured.</p><p><img src="https://john-millikin.com/by-sha256/269351bf8a51a8610f097306298af25ae77a7cc5ce4d1167e944a200739df5e2/Screen%20Shot%202022-07-08%20at%2014.04.03.png"/></p><p>Next up is fixing the default graphics and disabling BIOS calls. Open a terminal into <tt>/boot/home/config/settings/kernel/drivers</tt>. This directory configures the BeOS boot loader; the <tt>sample/</tt> directory contains example config files.</p><p>Using <tt>sample/kernel</tt> and <tt>sample/vesa</tt> as a guide, create two files in <tt>[...]/kernel/drivers</tt>:</p><ul><li>File <tt>kernel</tt> should contain <tt>bios_calls disabled</tt></li><li>File <tt>vesa</tt> should contain <tt>mode 1024 768 16</tt> (or whatever resolution you want)</li></ul><p><img src="https://john-millikin.com/by-sha256/3cddf2bbc2bd64c581b1a49d37bae78f22cfb27d7b3411285301c54739101a93/Screen%20Shot%202022-07-08%20at%2013.59.14.png"/></p><p>BeOS 5.0.3 comes with VIM 4.5, so features like `:split` are available.</p><p><img src="https://john-millikin.com/by-sha256/87a38401ad6456140b65c67549f282e077c80d3c7068b3edf22e81aef9ba00a4/Screen%20Shot%202022-07-08%20at%2014.00.20.png"/></p><p>Booting now works without any special boot menu selection, and the built-in web browser can be used to view any page that allows plaintext<blog-footnote-ref>[<a href="#fn:6">6</a>]</blog-footnote-ref> HTTP clients.</p><p><img src="https://john-millikin.com/by-sha256/37d10e31a25ee7a2834cb03ee320977601cc2d0ce877e63a8c7ee1e8ea21fff4/Screen%20Shot%202022-07-08%20at%2014.14.08.png"/></p></blog-section><blog-footnotes><hr/><ol><li id="fn:1"><p>Unfortunately for BeOS, technical innovation alone was not enough to pay the bills. After rejecting a $200 million buyout offer from Apple<blog-footnote-ref>[<a href="#fn:2">2</a>]</blog-footnote-ref>, Be Inc struggled to compete with hyper-competitive mid-90s Microsoft. It was swept away in the <a href="https://en.wikipedia.org/wiki/Dot-com_bubble#Bursting_of_the_bubble">dot-com crash</a>, and in 2001 the remaining assets were sold to Palm for $11 million<blog-footnote-ref>[<a href="#fn:3">3</a>]</blog-footnote-ref>.</p></li><li id="fn:2"><p><a href="https://www.mercurynews.com/2014/08/29/1996-jobs-is-back-at-apple/">The Mercury News: Jobs is back at Apple</a></p></li><li id="fn:3"><p><a href="https://www.latimes.com/archives/la-xpm-2002-jan-01-fi-be1-story.html">Los Angeles Times: Be Inc. Founder Leaving as Firm Nears Closure</a></p></li><li id="fn:4"><p>Invoking QEMU with <tt>-drive media=cdrom,file=BeOS_Tools.bin</tt> will fail to locate a boot sector.</p><p><img src="https://john-millikin.com/by-sha256/ba9351ca9739e4978175641820506d9919c024fdb5c3a1dc4401aff4c40ec70a/Screen%20Shot%202022-07-08%20at%2013.01.11.png"/></p></li><li id="fn:5"><p>The Linux build of Chrome is slightly larger than BeOS 5, and it doesn&#39;t even include an OpenGL teapot demo.</p><blog-code syntax="commands"><pre>du -s --si /opt/google/chrome/
# 278M	/opt/google/chrome/</pre></blog-code></li><li id="fn:6"><p>Minimum requirements for HTTPS have evolved somewhat in the 20 years since the NetPositive browser last saw development, so the modern web can only be accessed via a MITM proxy.</p></li></ol></blog-footnotes></div></div>
  </body>
</html>
