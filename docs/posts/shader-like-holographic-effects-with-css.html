<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://robbowen.digital/wrote-about/css-blend-mode-shaders/">Original</a>
    <h1>Shader-like holographic effects with CSS</h1>
    
    <div id="readability-page-1" class="page"><div><p>I might be understating it a bit, but WebGL is a big deal. You only need to spend five minutes on one of the many design awards sites to see site-after-site fully leaning into the power of <code>canvas</code>. Tools like <a href="https://threejs.org/" target="_blank">threejs</a> bring the power of 3D and <abbr title="OpenGL Shading Language">GLSL</abbr> shaders to the browser and, with that, a whole new level of visual effects.</p><p>This got me thinking though; why let JS have all the fun? With <code>mix-blend-mode</code> finally gaining wide browser-support, we now have access to many of most common shading techniques in CSS. With some choice images and a bit of careful layering it&#39;s possible to build some surprisingly high-quality effects without the need for introducing any JS dependencies.</p><p>Let&#39;s take a look at an example. As you scroll past the image below, the sunlight blooms a warm orange, before fading to a cool blue. You&#39;ll also briefly see some lens bokeh.</p><div><div><p><img src="https://robbowen.digital/assets/img/articles/holo/tower.jpg" alt="Asakusa at dusk"/></p></div></div><p>Ooooh shiny. Let&#39;s break it down.</p><h2 id="what-is-a-css-shader">What is a CSS &#39;shader&#39;?<a href="#what-is-a-css-shader"> permalink</a></h2><p>Shaders in the WebGL world are complex GLSL scripts that determine how each individual pixel is rendered to the screen. We still don&#39;t have <em>that</em> level of control in our CSS so, at its most basic level, our CSS &#39;shader&#39; is just an image with additional background-image layers above it. Yes, I&#39;m taking a few liberties with the name but with careful use of gradients, masking, nesting and <code>mix-blend-mode</code> we can manage how these layers interact with both one-another and the image at the bottom of the stack.</p><p>For the sake of visualising this core structure, the &#39;shader&#39; example above is set up with a few nested divs:</p><pre><code><span><span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>shader<span>&#34;</span></span><span>&gt;</span></span></span></code></pre><p>To keep each layer aligned with the image at the base, we keep the nested content positioned with the following CSS:</p><pre><code><span>  <span>.shader</span> <span>{</span></span></code></pre><p>Ok, with the basic layout taken care of, lets take a look at the first layer of our effect - the lighting.</p><h2 id="simulating-specularity">Simulating specularity<span>.</span><a href="#simulating-specularity"> permalink</a></h2><p>First of all we need to think about how light travels from light to dark across the surface of our image. We&#39;ll need an area of brightness where the light is at its most intense, falling off gradually into darkness as the light dissipates. We&#39;ll do this with a gradient.</p><pre><code><span><span>.specular</span> <span>{</span></span></code></pre><p>If you imagine looking at a shiny surface, the light that reflects back is known as a specular reflection. How and where that highlight appears is dependant on the light source, but also your viewing angle - the highlight moves with you. Whilst our gradient is looking lovely, it&#39;s all a bit static. We&#39;ll need to introduce a bit of movement to really sell the effect.</p><p>Fortunately, there&#39;s a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/background-attachment" target="_blank">vintage CSS Level 1 property</a> that can help with that; setting <code>.specular</code> to <code>background-attachment: fixed</code> means that, as the page scrolls, the gradient remains locked to the browser&#39;s viewport. This not only brings some much needed motion to our shader, but also means that we can very roughly simulate the changing view-angle without reaching for JavaScript.</p><pre><code><span><span>.specular</span> <span>{</span></span></code></pre><p>Great! Now, let&#39;s get to applying this lighting to our base image.</p><h2 id="know-your-blend-modes">Know your blend modes<span>.</span><a href="#know-your-blend-modes"> permalink</a></h2><p>As the name implies, <code>mix-blend-mode</code> mixes the colours of each pixel in one element layer together with the layer directly below it. As with GLSL, CSS gives us a nice <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/blend-mode" target="_blank">long list of options to choose from</a>, and creating the right effect means knowing which blend is going to give the results we need. But what do these blend modes actually do? Before we get stuck in with our shader, let&#39;s take a quick look at the blend modes we&#39;ll be using.</p><p>Below you can see the images that we&#39;ll be using for these examples. On the left is the upper layer to be blended, and the right is the base image we&#39;ll be blending onto.</p><div><p><img src="https://robbowen.digital/assets/img/articles/holo/mask-layer.jpg" alt="Black and white concentric circles, with two grey semi-circles at the centre"/></p><p><img src="https://robbowen.digital/assets/img/about/lakebled.jpg" alt="Lake bled from above"/></p></div><p>First off, let&#39;s look at a <code>multiply</code> blend. <code>Multiply</code> takes the colour of each pixel in the current layer and multiplies it with the colour of the pixel directly beneath it. In practice this means that <em>darker colours in the current layer will obscure those in the layer below</em>:</p><div><div><p><img src="https://robbowen.digital/assets/img/about/lakebled.jpg" alt="Lake bled from above"/></p><p><img src="https://robbowen.digital/assets/img/articles/holo/mask-layer.jpg" alt="Black and white concentric circles, with two grey semi-circles at the centre"/></p></div></div><p>Setting the blend to <code>screen</code> takes the inverse of each pixel and multiplies them before inverting the result. This might sound complicated, but you can think of <code>screen</code> as the opposite of <code>multiply</code> - <em>Darker colours become transparent and only the lighter colours will show through to the layer below</em>:</p><div><div><p><img src="https://robbowen.digital/assets/img/about/lakebled.jpg" alt="Lake bled from above"/></p><p><img src="https://robbowen.digital/assets/img/articles/holo/mask-layer.jpg" alt="Black and white concentric circles, with two grey semi-circles at the centre"/></p></div></div><p>Lastly, <code>color-dodge</code> and <code>color-burn</code> are like taking <code>multiply</code> and <code>screen</code> into overdrive. Both modes divide the pixel colour on the base layer with the one in the current layer.</p><p><em>For <code>color-dodge</code> this means that highlights and midtones get blown out whilst dark tones have no affect at all. <code>color-burn</code> will boost shadows and darker midtones, whilst lighter tones have no affect at all</em>.</p><p>In the image below, the left example is <code>color-dodge</code> and the right is <code>color-burn</code>.</p><h2 id="compositing-layers">Compositing layers<span>.</span><a href="#compositing-layers"> permalink</a></h2><p><img src="https://robbowen.digital/assets/img/articles/holo/composite-diagram.jpg" alt="A diagram summarising how layers can be composited together to form a new image"/></p><p>Now we know what we&#39;re working with, it might seem like the next step would be to slap a blend mode onto our gradient, place it over our base image and call it a day. That will definitely work, but it won&#39;t reach the level of quality we&#39;re going for.</p><p>Blending the gradient directly to the base layer will mean that the lighting will be totally uniform across the image. Aside from chromed surfaces, that doesn&#39;t happen too often in nature. To really sell the effect we want to have control over the areas of the image where light can fall and where it can&#39;t. To simulate this, we can use a predominately dark image to mask out our gradient. This technique of using a dark image to mask off areas of a lighter one is often known as a <em>specular map</em>.</p><p>You might be wondering how it will be possible to do this with CSS if <code>mix-blend-mode</code> only affects the pixels in the layer directly below it, and we can only set one blend mode at a time. This is where our HTML structure starts to shine.</p><pre><code><span><span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>shader<span>&#34;</span></span><span>&gt;</span></span></span></code></pre><p>By nesting <code>div</code> layers inside of one another, we can work outwards applying additional <code>mix-blend-mode</code>s to each wrapping <code>div</code>. Essentially, this lets us add another <code>mix-blend-mode</code> to the output of the previous blend. This process of layering different blend modes to produce a final output is known as <code>compositing</code>.</p><p>Let&#39;s give it a try. Using a suitably dark <code>background-image</code> we&#39;ll set <code>mix-blend-mode: multiply</code> on our <code>.mask</code> layer and throw away the parts of our gradient where we don&#39;t want light to show through.</p><p><img src="https://robbowen.digital/assets/img/articles/holo/composite-diagram-multiply.jpg" alt="Two images are combined with a multiply blend to form a mask"/></p><pre><code><span><span>.mask</span> <span>{</span></span></code></pre><p>Now that we have our specular map, we can apply the final lighting to the base image. We need to use one of the blend modes that ignores black and dark tones. This means that we should set our <code>.specular</code> layer to use <code>mix-blend-mode: screen</code> or <code>mix-blend-mode: color-dodge</code>. Either would work in this case, but because we want the highlights to blow out into a nice sunlight-bloom effect, we&#39;ll go for <code>color-dodge</code>.</p><p>Let&#39;s take a look:</p><p><img src="https://robbowen.digital/assets/img/articles/holo/composite-diagram-dodge.jpg" alt="two images are combined with color-dodge blend to form a bloom effect"/></p><pre><code><span><span>.specular</span> <span>{</span></span></code></pre><h2 id="the-final-shader">The final shader<span>.</span><a href="#the-final-shader"> permalink</a></h2><p>And with that, the effect is complete! Here&#39;s the completed HTML and CSS:</p><pre><code><span><span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>shader<span>&#34;</span></span><span>&gt;</span></span></span></code></pre><p>Let&#39;s take another look at the completed effect, but this time with the added ability to isolate each layer of the shader. Change the view mode dropdown to step through the effect and get a better idea of how the layers work together to produce the final image:</p><div><p><label>View mode: <span></span></label></p><div><div><p><img src="https://robbowen.digital/assets/img/articles/holo/tower.jpg" alt="Asakusa at dusk"/></p></div></div></div><h2 id="taking-it-further">Taking it further<span>.</span><a href="#taking-it-further"> permalink</a></h2><p>In the example above, we used a greyscale version of the main image (with added scratches and bokeh) as a mask. That&#39;s a great way to add interest to an image, but shader layers can be whatever you want them to be. Let&#39;s look at a few more examples.</p><h3 id="aurora-borealis">Aurora Borealis<span>.</span><a href="#aurora-borealis"> permalink</a></h3><p>In this example, repeating the gradient background gradient and reducing <code>background-size-y</code> causes the light efffect to move more quickly across the screen. When masked out with a specular map, this creates the illusion of an aurora rippling over the main image. Blown-out highlights with <code>colour-dodge</code> creates the wrong effect here, so swapping our <code>.specular</code> layer to <code>mix-blend-mode: screen</code> maintains the sharp definition of the aurora.</p><div><p><label>View mode: <span></span></label></p><div><div><p><img src="https://robbowen.digital/assets/img/articles/holo/forest.jpg" alt="A pine forest at night"/></p></div></div></div><h3 id="light-leak">Light-leak<span>.</span><a href="#light-leak"> permalink</a></h3><p>Until now the examples have all used a greyscale specular map, but a full colour specular map can introduce new effects. In this example the mask image is created from an inverted and blurred version of the primary image, with a blue-red tone overlaid on top. When it&#39;s all layered together with a hot red-orange gradient, the resulting blend of colours results in something that looks a little like the light-leaks you get on vintage film cameras.</p><div><p><label>View mode: <span></span></label></p><div><div><p><img src="https://robbowen.digital/assets/img/articles/holo/pinelake.jpg" alt="A lake with pine trees"/></p></div></div></div><h3 id="hologram">Hologram<span>.</span><a href="#hologram"> permalink</a></h3><p>Layering within the mask opens up even more possiblilities. What would happen if we add another layer with <code>background-attachment: fixed</code>?</p><p>In this final example the mask layer has a background image SVG, and another black-white gradient running at the opposite angle to the specular gradient in the <code>.specular</code> layer. Setting the nested mask layer to <code>color-burn</code> causes it to blow out the definition of the SVG and you get this sweet two-way holographic look. CSS <em>is</em> awesome.</p><div><p><label>View mode: <span></span></label></p><div><div><p><img src="https://robbowen.digital/assets/img/articles/holo/dash.jpg" alt="The dashboard of a vintage car"/></p></div></div></div><h2 id="wrapping-up">Wrapping up<span>.</span><a href="#wrapping-up"> permalink</a></h2><p>I&#39;ve said it before, but it bears repeating: modern CSS is such an amazing tool to work with and I&#39;m consistently impressed with the level of fidelity you can achieve. That said, It&#39;s time to address the potential elephant in the room. Depending on the device or browser you&#39;ve used to read this article, your scroll performance might be on the floor and your fans may have kicked up a notch.</p><p>At the time of writing, blend modes in browsers are still pretty resource heavy. For more complex effects, with several layers of compositing, you will see a real performance hit. Add any CSS animations or transitions to the mix and it will really tank - particularly in Safari. After a bit of tweaking I eventually managed to claw back a bit of a performance boost by using <code>backface-visibility: hidden</code>, but my initial impulse was to force GPU rendering by using the trusty <code>transform: translateZ(0);</code> hack. Sadly, adding a transform revealed another quirk to be aware of.</p><p>Due to the reliance on <code>background-attachment: fixed</code>, applying CSS transforms to the shader can cause some strange side-effects. In Chrome it broadly works, but the gradients may appear offset depending on the transforms applied. Firefox on the other hand, will simply ignore the fixed positioning and your gradients will totally appear static. I&#39;m sure there are ways and means around that, but they&#39;d likely be testing the spirit of doing all of this without using JS.</p><p>All-in-all this was really fun to explore. Sure, we can&#39;t get quite the same level of fidelity as GLSL, but for simpler effects this technique is a great alternative to introducing extra libraries to your project. As great as these effects can look though, I think that for now this is very much a case of: just because you can, doesn&#39;t mean you should.</p><p>Until CSS filters and blend modes become more performant (or until browsers allow linking GLSL filters directly from CSS 🤞) restraint and subtlety might be the best way to go.</p><h2 id="image-credits">Image credits<span>.</span><a href="#image-credits"> permalink</a></h2><p>The demos in this article use a collection of images or composited textures made available by the Unsplash photographers below. Please go check out their beautiful work.</p><ul><li><a href="https://unsplash.com/photos/4ShXInrtdV4" target="_blank">Bokeh lights</a> by <a href="https://unsplash.com/@helloimnik" target="_blank">Hello I&#39;m Nik</a></li><li><a href="https://unsplash.com/photos/SkLSOR5r3nc" target="_blank">Silhouette of pine trees under stars</a> by <a href="https://unsplash.com/@joshua_j_woroniecki" target="_blank">Joshua Woroniecki</a></li><li><a href="https://unsplash.com/photos/upXoQv5GAr8" target="_blank">Aurora</a> by <a href="https://unsplash.com/@followhansi" target="_blank">Johannes Groll</a></li><li><a href="https://unsplash.com/photos/P8PlK2nGwqA" target="_blank">Lake under blue sky</a> by <a href="https://unsplash.com/@juanster" target="_blank">Juan Davila</a></li><li><a href="https://unsplash.com/photos/I1C6CrPNyo8" target="_blank">Vintage dashboard</a> by <a href="https://unsplash.com/@ynwasso" target="_blank">Wassim Chouak</a></li><li><a href="https://unsplash.com/photos/2jYK_Bloby4" target="_blank">Light leak</a> by <a href="https://unsplash.com/@seanwsinclair" target="_blank">Sean Sinclair</a></li><li><a href="https://unsplash.com/photos/1k7vrumRHow" target="_blank">Scratches</a> by <a href="https://unsplash.com/@dancristianpaduret" target="_blank">Dan Cristian Pădureț</a></li></ul></div></div>
  </body>
</html>
