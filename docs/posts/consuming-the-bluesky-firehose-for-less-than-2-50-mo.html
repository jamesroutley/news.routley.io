<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bsky.bad-example.com/consuming-the-firehose-cheaply/">Original</a>
    <h1>Consuming the Bluesky firehose for less than $2.50/mo</h1>
    
    <div id="readability-page-1" class="page"><div>
      <header>
        
      </header>
      
      <p>2024-11-13 by <a href="https://bsky.app/profile/bad-example.com" target="_blank" title="bluesky profile: bad-example.com">phil</a> <small>(they/them)</small></p>

      <p><em>work in progress</em></p>

      <p>It&#39;s fun to play with data<sup>[citation needed]</sup>. All data on Bluesky is extremely public, and with 15 million users (as of today and with mind-boggling growth), there&#39;s a lot of public data to play with.</p>

      <p>You can get the firehose as a websocket JSON feed with <a href="https://jazco.dev/2024/09/24/jetstream/">Jetstream</a>. This connects you to <em>everything</em> happening on the network in real time. It&#39;s extremely easy to get started and very fun.</p>

      <p>Here&#39;s a random word from every post being posted <em>right now</em>:</p>

      

      <p>There you go, you just consumed it for free from your browser.</p>

      <h2>little app</h2>

      <p>After noodling around a bit, i sketched out <a href="https://deletions.bsky.bad-example.com/" target="_blank">this questionable little app</a> which listens for all <code>delete</code> events from the firehose, and then shows the just-deleted text one last time in an anonymized disappearing feed. Kind of fascinating to see what people choose to delete. (also please note that I made this millions of users ago when the network was a fraction of the current chaotic speed). Maybe I&#39;ll write more about it later.</p>

      <p>Anyway it runs on fly:</p>

      <ul>
        <li>Fly machine, shared-cpu-1x with 256MB RAM: $1.94/mo</li>
        <li>2GB Persistent volume: $0.30/mo</li>
      </ul>

      <p><img src="https://bsky.bad-example.com/consuming-the-firehose-cheaply/fly-dash.png" alt="screenshot of fly.io dashboard showing app metrics over 7 days. network io has a daily cycle (growing since bsky is growing), cpu memory and load average are all flat, volume usage grows (backfill), then levels (steady state), then grows again (bsky growing)."/></p><p>Granted it&#39;s not doing <em>much</em>, but it&#39;s doing it happily on the smallest instance fly offers.</p>

      <p>What <em>is</em> it doing?</p>

      <ol>
        <li>Receive every new create-post event from the <code>app.bsky.feed.post</code> collection</li>
        <li>Filter out empty posts, apply redactions to mentions and links</li>
        <li>Cache the clean text content on the volume in pebbledb, keyed by <code>did+rkey</code></li>
        <li>Every few seconds, do a range-delete on saved texts older than 48hr</li>
        <li>For every delete-post event, try to fetch the text from the cache, and if found, broadcast it to all current observers</li>
      </ol>

      <p>More interesting apps might not scale down this far, but some will.</p>

    </div></div>
  </body>
</html>
