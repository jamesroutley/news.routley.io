<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://laplab.me/posts/whats-that-touchscreen-in-my-room/">Original</a>
    <h1>What&#39;s that touchscreen in my room?</h1>
    
    <div id="readability-page-1" class="page"><article>
      <blockquote>
<p>Discussion on <a href="https://news.ycombinator.com/item?id=39063242">HackerNews</a> and <a href="https://lobste.rs/s/ylejdi/what_s_touchscreen_my_room">Lobsters</a>.</p>
</blockquote>
<p>Roughly a year ago I moved into my new apartment. One of the reasons I picked this apartment was age of the building. The construction was finished in 2015, which ensured pretty good thermal isolation for winters as well as small nice things like Ethernet ports in each room. However, there was one part of my apartment that was too new and too smart for me. This thing:</p>
<p><img src="https://laplab.me/img/netthings/touchscreen.png" alt="Random touchscreen on the wall"/></p>
<p>It is obviously a touchscreen of some sort, but there was zero indication as to what it controls. The landlord had no idea what this is. There are no buttons or labels on the thing, just a tiny yellow light to let you know it has the power.</p>
<p>I had a million questions, but I was too busy with the move and kinda of forgot about it until about a week ago. I was looking through a huge binder of various appliance manuals for my apartment when this thing slided out:</p>
<p><img src="https://laplab.me/img/netthings/brochure-touchscreen.png" alt="Brouchure with a touchscreen turned on"/></p>
<p>Wait a second, that’s my touchscreen! Turns out it is a part of an energy monitoring system, which tells you current energy usage and has the ability to display historical data. That actually sounds pretty neat - I would be interested to see energy usage patterns of my house.</p>
<p>Brochure also mentioned a second part of the so-called “energy manager”, which was directly plugged into an electricity meter to get usage information. I went to inspect communal cupboard housing electricity meters - and sure enough, there it was, just standing in the corner. I never even noticed these boxes before, but they at least have the same branding as the brochure - some company creatively named “NETTHINGS”.</p>
<p><img src="https://laplab.me/img/netthings/energy-manager.png" alt="Energy Manager in the communal cupboard"/></p>
<p>Pretty straightforward so far. We have two devices, one “server” gathering the data and another one “client” reading the data. Now the distance between them is actually very short - just a few meters and maybe 2-3 walls, totally reasonable setup for a cable connection. It was at that moment when I noticed a weird sticker in the corner of the brochure. There were two strings printed with labels “SSID” and “Pwd”. I froze in horror. They wouldn’t dare. It is literally 3 meter distance. These are embedded devices, they do not need this complexity…</p>
<p>And of course the two devices communicate using WiFi. Now that was unusual for me, since I am not an embedded developer. But a friend of mine, who worked on smart home features for one voice assistant told me that this is actually a pretty common thing to do in IoT space. C in IoT stands for “cost-effective” I guess.</p>
<p>Moving on, I needed to somehow turn on the weird touchscreen. Upon closer inspection, I noticed a small hole on the side, which looked a lot like something you insert a pin into to reset the device:</p>
<p><img src="https://laplab.me/img/netthings/touchscreen-reset.png" alt="Touchscreen reset hole"/></p>
<p>I held a hidden button with a wire for a few seconds and was greeted by…an Android bootup logo! Yes, this turned out to be in fact an Android tablet, and a pretty old one at that. It has Google Talk, Flash and all kinds of other interesting stuff pre-installed:</p>
<p><img src="https://laplab.me/img/netthings/android.png" alt="Android menu"/></p>
<p>From what I can tell, this is an Android 5, but I am not exactly sure. One of the apps stands out with a familiar name: “NetThings”. Launching it leads us to the screen where we select a WiFi network. Unfortunately, the one that is mentioned on the brochure, was not on the list. I double-checked the list, tried to refresh it, looked for WiFi networks using my other devices, tried to directly connect to the WiFi using the credentials, but no luck.</p>
<p>When I came back to the meter room I noticed the obvious: boxes for all other apartments had the light on, but mine was off for some reason:</p>
<p><img src="https://laplab.me/img/netthings/energy-manager-off.png" alt="Energy manager for my apartment is off"/></p>
<p>I live in the UK and if anything, this is a country of electrical fuses. The more fuses the better, everything is fused, even some plugs. Fuses for certain appliances come in separate boxes with a small drawer that can slide out, allowing to replace the fuse. It looks like this:</p>
<p><img src="https://laplab.me/img/netthings/empty-fuse-box.png" alt="Empty fuse box"/></p>
<p>As you can see, my fuse box did not have a fuse inside for some reason. No fuse - no electrical connection, no power for the energy manager and no WiFi hotspot. Thanks to the fuse box design, it is easy to replace one, but I did not know what kind of amperage should be allowed in the circuit. Luckily, I had a few working energy managers in the same cupboard, so I opened their boxes (cutting the power to them for a few seconds) to see what kind of fuses they use. Turns out, I need a 3A fuse, so I ordered one from Amazon and installed it the next day.</p>
<p>To be honest, the whole thing was a bit scary, since I was very close to the mains. After installation, I checked the temperature of the fuse multiple times during the day to get at least some indication that things are not going to get worse. It worked fine for a more than a week now, but I still do not recommend experiments like this to anyone.</p>
<p>After installing the replacement fuse, energy manager started blinking with green LEDs and the promised WiFi network appeared on all devices. Once I selected the network on the Android tablet, it changed to the following screen:</p>
<p><img src="https://laplab.me/img/netthings/energy-monitor-main.png" alt="Energy monitor main screen"/></p>
<p>When tapped, it changes to this menu, inviting the user to select what kind of resource they want to monitor. Nothing here actually works except for “Mains Electricity” because that’s the only meter the energy manager is hooked up to.</p>
<p><img src="https://laplab.me/img/netthings/energy-monitor-menu.png" alt="Energy monitor menu"/></p>
<p>“Mains Electricity” leads us to the most dissapointing screen in the history of UX design:</p>
<p><img src="https://laplab.me/img/netthings/energy-monitor-electricity.png" alt="Energy monitor electricity"/></p>
<p>Ugh, where to start. What’s up with this color indicator on the right? What does the vertical position mean? If it is green, does it mean that I am using a small amount of electricity or just a normal one? What exactly is small? If it gets all the way to the top, is it compared to my historical maximum usage? Over what period of time?</p>
<p>Out of 5 numbers displayed to the left of the indicator, only one is actually true - number of kW consumed. All other numbers depend on the energy provider and definitely changed since the time this monitor was installed.</p>
<p>I saved best for last. The amount of money you pay as well as estimate of CO2 per kW <strong>is not configurable</strong>. According to the brochure, it was configurable during the initial installation, but it has no information on how to reset the system back into configurable state.</p>
<p>Finally, brochure says the following:</p>
<p><img src="https://laplab.me/img/netthings/brochure-time.png" alt="Brochure stating that clock is always accurate"/></p>
<p>I have no idea why they decided to include this. Of course the clock on Android tablet shifted by almost 15 minutes since 2015, when it was supposedly installed.</p>
<p>The whole thing was quite dissapointing. However, I do have a few Raspberry Pico microcontrollers lying around at home. If I could connect to the WiFi network of the energy manager directly and get the data from the server, I could just extract kW consumption from the API, multiply it by a correct rate and then display it on some Grafana instance.</p>
<p>The main problem was that I do not know the IP of the server. I was just about ready to launch a full IP scan from laptop when I noticed that one of the use cases brochure advertised is checking the energy usage from the PC. The IP and port were conveniently provided together with the instructions. Opening it in the browser displays a familiar screen:</p>
<p><img src="https://laplab.me/img/netthings/energy-monitor-browser.png" alt="Energy Monitor as seen from the browser"/></p>
<p>Turns out, interface on the Android tablet is just a webview. This makes our job that easier, since we can just go to the web inspector and see all the API calls. Looking at the URLs we see…</p>
<p><img src="https://laplab.me/img/netthings/energy-monitor-socketio.png" alt="Energy Monitor Network inspector"/></p>
<p>…Socket.IO! Wow, I honestly did not expect that. Client literally needs to receive 5 numbers from the server, Socket.IO seems to be a complete overkill for this usecase. The client code also looks very complicated for what it does. There are at least 6 RequireJS modules, all loading dynamically through different requests of course. There is Handlebars, Backbone.js, Underscore.js… I feel like I am in high school again. These are all technologies I was very interested when I just <a href="https://laplab.me/posts/how-did-i-become-database-engineer-at-23/">started web development</a>.</p>
<p>But wait a second, Socket.IO would mean that an embedded device in my meters cupboard is running JavaScript? This must be weirdest Edge Computing Platform I have seen in my life. I want to deploy <em>something</em> there!</p>
<p>Totally forgetting the idea with Raspberry Pico fetching the data from the server, I put on my hacker hat and started poking around. IoT devices have a terrible reputation from the security perspective, so I expected it to be an easy run for a couple of hours tops. Boy was I wrong.</p>
<p>Direct SSH using <code>ssh <a href="https://laplab.me/cdn-cgi/l/email-protection" data-cfemail="eb9984849fabdadcd9c5daddc5dbc5d9dedf">[email protected]</a></code> immediately fails with “Connection refused” error. That could mean a number of things, let’s see which ports are available:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>$ sudo nmap -p- -sV -O 172.16.0.254
</span></span><span><span>... truncated output ...
</span></span><span><span>Nmap scan report <span>for</span> 172.16.0.254
</span></span><span><span>Host is up (0.011s latency).
</span></span><span><span>Not shown: 65530 closed tcp ports (reset)
</span></span><span><span>PORT      STATE SERVICE       VERSION
</span></span><span><span>53/tcp    open  domain        dnsmasq 2.63rc6
</span></span><span><span>80/tcp    open  http          Node.js (Express middleware)
</span></span><span><span>1534/tcp  open  micromuse-lm?
</span></span><span><span>3000/tcp  open  http          Node.js (Express middleware)
</span></span><span><span>41142/tcp open  ssh           OpenSSH 6.2 (protocol 2.0)
</span></span></code></pre></div><p>Now this is interesting. As expected, we see a Node.js server running. We also have <code>dnsmasq</code>, which is a DHCP server (makes sense, since the device is a WiFi access point) and a hidden SSH server on port 41142.</p>
<p>SSH connection is no longer refused, but the root turned out to be password-protected. None of the simple username/password combinations like <code>admin/admin</code> or <code>root/root</code> worked, so we are essentially back to square one. However, <code>nmap</code> detected an unrecognized service on port 1534 called <code>micromuse-lm</code>. The first Google result is the following <a href="https://support.xilinx.com/s/question/0D52E00007IPix4SAD/broadcasts-to-port-1534?language=en_US">forum post</a>:</p>
<p><img src="https://laplab.me/img/netthings/xilinx-forum.png" alt="Xilinx forum post about micromuse-lm"/></p>
<p>I do not know who you are <code>@ljohnson</code>, but may your life be happy and prosperous. This post does not give a lot of information, but it provides one with the correct keywords to continue the search. The main phrase here is <code>tcf-agent</code>. The concrete description of what is going on here is spread atom-thin across several websites, all of which expect you to know the terminology. Each of these websites provides you with a tiny piece of the puzzle and you are expected to combine it together on your own. So after a few hours and lots of cursing, here is what I know about <code>tcf-agent</code>:</p>
<p>TCF <a href="https://elinux.org/TCF">stands for</a> “Target Communications Framework”. It is a text protocol, which allows to read the filesystem, start new processes, send signals to processes and a lot more with the target system. <code>tcf-agent</code> is the server implementing this protocol or, in another words, probably the second biggest security vulnerability after passwordless root SSH. I do not understand why they went into all this trouble with SSH passwords, but kept <code>tcf-agent</code> running.</p>
<p>TCF seems to be closedly tied to Eclipse ecosystem. The <a href="https://download.eclipse.org/tools/tcf/tcf-docs/TCF%20Getting%20Started.html">Getting Started</a> guide suggests several plugins for Eclipse as the main way to interact with <code>tcf-agent</code>. I tried installing these plugins on a new version of Eclipse and it is absolutely impossible. There are dependency issues everywhere and when you actually try to install the missing dependencies, Eclipse does not let you because they conflict with some other dependencies. It’s a mess, which is exactly how I imagined this interaction to go.</p>
<p>Conveniently, TCF project has a Python SDK. As with everything during this research, I needed to go through 3 links on different websites to actually find one. First, we are met with <a href="https://wiki.eclipse.org/TCF/Python_Scripting">this lovely page</a>:</p>
<p><img src="https://laplab.me/img/netthings/eclipse-wiki-python.png" alt="Eclipse Wiki for Python Scripting"/></p>
<p>Which has a link that leads to <a href="https://git.eclipse.org/c/tcf/org.eclipse.tcf.git/tree/python/src/tcf">here</a>, which has a very small text pointing out that the repo moved to <a href="https://gitlab.eclipse.org/eclipse/tcf/tcf">this Gitlab repository</a>. Phew. The repo even has a few fresh commits, which seems a bit suprprising to me, as TCF in general gives off vibes of an abandoned project.</p>
<p>Nevertheless, the repository contains a pretty modern Python 3 (!) SDK, even with some inline documentation. It is not perfect, some docs are outdated, some methods are very weird, but you can pretty easily figure out what’s going on from the code. Protocol specification <a href="https://download.eclipse.org/tools/tcf/tcf-docs/TCF%20Specification.html">here</a> and <a href="https://download.eclipse.org/tools/tcf/tcf-docs/TCF%20Services.html">here</a> are a huge help in this process.</p>
<p>In a nutshell, a <code>tcf-agent</code> provides a bunch of services that expose various parts of the system. For example, there is a <code>FileSystem</code> service for all interactions with the filesystem, <code>Processes</code> service for starting/stopping/debugging processes, etc. Here is an example of getting current user information:</p>
<div><pre tabindex="0"><code data-lang="python"><span><span><span>import</span> <span>tcf</span>
</span></span><span><span><span>from</span> <span>tcf.util.sync</span> <span>import</span> CommandControl
</span></span><span><span>
</span></span><span><span>tcf.protocol.startEventQueue()
</span></span><span><span>cmd = CommandControl(tcf.connect(<span>&#39;TCP:172.16.0.254:1534&#39;</span>))
</span></span><span><span>error, user = cmd.FileSystem.user()
</span></span><span><span><span>print</span>(user)
</span></span></code></pre></div><p>And that’s how we learned that <code>tcf-agent</code>, in fact, runs under the <code>root</code> user. Again, why bother with SSH passwords if you leave a debug server with root access - this I will never understand.</p>
<p><code>FileSystem</code> and <code>Processes</code> services have other functions, roughly corresponding to syscalls. You can pretty easily replicate alternatives to common commands like <code>ls</code>, <code>cat</code>, <code>ps</code> and the like using this API. Now I say “pretty easily”, but in reality that was 4 hours of guessing the protocol format, trying to the find the documentation, fixing bugs in the SDK, all on an extremely unstable WiFi connection from an embedded device. Fun times. You can find the results in <a href="https://github.com/laplab/tcf-tools">this Github repo</a>.</p>
<p>Now that we have basic instruments, let’s get to hacking! My first attempt was to crack the root password, as I still believed it was something trivial. I used <a href="https://github.com/openwall/john">John the Ripper</a> password cracker in the following way</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span><span># `cat.py` fetches file contents from the energy manager</span>
</span></span><span><span><span># using `FileSystem` TCF service.</span>
</span></span><span><span>$ ./cat.py /etc/passwd &gt; passwd.txt
</span></span><span><span>$ ./cat.py /etc/shadow &gt; shadow.txt
</span></span><span><span>$ unshadow passwd.txt shadow.txt &gt; passwords.txt
</span></span><span><span>$ john passwords.txt
</span></span></code></pre></div><p>I left it running for roughly 7 hours, but it did not find a match. John reported that it will finish its brute-force in the year 2035, so I decided to try out a different approach.</p>
<p>After a bit of Googling, I <a href="https://unix.stackexchange.com/a/533599">found out</a> that one can simply make root’s password empty by modifying <code>/etc/shadow</code>. Having done just that, I powercycled the device by removing the fuse I installed previously and putting it back after some time. Unfortunately, SSH still rejected my login attempts.</p>
<p>More out of desperation than anything else, I decided to look at sshd config of the host and finally found the offending line. <code>sshd_config</code> had <code>PermitRootLogin no</code> line included, which is a very sensible security measure as long as you are not providing a full disk access to anyone on the network.</p>
<p>I replaced the line with <code>PermitRootLogin yes</code> and finally, I saw the output I was struggling for:</p>
<p><img src="https://laplab.me/img/netthings/prompt.png" alt="SSH prompt for the server"/></p>
<p>We are in! God, that was quite a journey, wasn’t it? Let’s look around!</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>root@nt-core:~# uname -srm
</span></span><span><span>Linux 3.10.28 armv5tejl
</span></span></code></pre></div><p>We can see that we are running Linux 3.10, which is actually quite a recent release (middle of 2013), considering this device was developed and installed roughly in 2014-2015. Unsurprisingly for an embedded device, it is powered by an ARM chip:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>root@nt-core:~# cat /proc/cpuinfo
</span></span><span><span>processor	: 0
</span></span><span><span>model name	: ARM926EJ-S rev 5 (v5l)
</span></span><span><span>BogoMIPS	: 226.09
</span></span><span><span>Features	: swp half fastmult edsp java
</span></span><span><span>CPU implementer	: 0x41
</span></span><span><span>CPU architecture: 5TEJ
</span></span><span><span>CPU variant	: 0x0
</span></span><span><span>CPU part	: 0x926
</span></span><span><span>CPU revision	: 5
</span></span><span><span>
</span></span><span><span>Hardware	: Freescale MXS (Device Tree)
</span></span><span><span>Revision	: 0000
</span></span><span><span>Serial		: 0000000000000000
</span></span></code></pre></div><p>We have an <a href="https://en.wikipedia.org/wiki/ARM9">ARM9 family</a> CPU. Wikipedia says that it was released in 2001, with a list of notable mentions including being a <a href="https://en.wikipedia.org/wiki/Hollywood_(graphics_chip)#Starlet">coprocessor for Nintendo Wii</a>.</p>
<p>The fact I find even more surprising is that this processor supports executing Java bytecode directly. Yep, you read that right, the <code>java</code> in the list of CPU features actually means <strong>that</strong> Java. The ARM extension for this feature was called <a href="https://en.wikipedia.org/wiki/Jazelle">Jazelle</a>. This seemed to be some kind of a trend around 2000s, since this is <a href="https://mastodon.social/@laplab/109697958878708357">not the first time I encounter such feature</a>.</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>root@nt-core:~# cat /proc/meminfo
</span></span><span><span>MemTotal:         118172 kB
</span></span><span><span>...truncated...
</span></span></code></pre></div><p>Lastly, we have 118MB of RAM. I am not an embedded Linux expert, but this does seem like a lot after tinkering with Raspberry Pi Pico and such. At the same time, it makes sense, since we do have a Node.js app running on the host and JavaScript isn’t exactly a memory-efficient language.</p>
<p>The app itself is quite a sizeable codebase. Despite the fact that the company that made the device and software for it is <a href="https://find-and-update.company-information.service.gov.uk/company/SC313913">already dissolved</a>, I don’t want to risk being sued over releasing the source code. I am pretty sure nobody would actually care, but I still want nothing to do with it. So instead we will just look at some file lists.</p>
<p>Top-level directory structure looks like this:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>root@nt-core:/srv/server# ls -la
</span></span><span><span>drwxr-xr-x   13 nodejs   nogroup       4096 Oct 23 10:47 .
</span></span><span><span>drwxr-xr-x    3 root     root          4096 Oct 14 12:13 ..
</span></span><span><span>-rw-r--r--    1 nodejs   nogroup       8125 Oct 14 12:13 Gruntfile.js
</span></span><span><span>-rw-r--r--    1 nodejs   nogroup       1916 Oct 14 12:13 app.js
</span></span><span><span>drwxr-xr-x    2 nodejs   nogroup       4096 Oct 14 12:13 app_data
</span></span><span><span>drwxr-xr-x   10 nodejs   nogroup       4096 Oct 14 12:13 bin
</span></span><span><span>-rw-r--r--    1 nodejs   nogroup       1278 Oct 14 12:13 bower.json
</span></span><span><span>drwxr-xr-x    2 nodejs   nogroup       4096 Oct 23 10:40 info
</span></span><span><span>-rw-r--r--    1 nodejs   nogroup         16 Oct 14 12:13 jira_version
</span></span><span><span>-rw-r--r--    1 nodejs   nogroup       2673 Oct 14 12:13 karma.conf.js
</span></span><span><span>drwxr-xr-x    2 nodejs   dialout       4096 Oct 23 10:49 logs
</span></span><span><span>drwxr-xr-x    4 nodejs   nogroup       4096 Oct 14 12:13 modules
</span></span><span><span>drwxr-xr-x   17 nodejs   nogroup       4096 Oct 14 12:13 node_modules
</span></span><span><span>-rw-r--r--    1 root     root             0 Oct 23 10:40 nodejs.log
</span></span><span><span>-rw-r--r--    1 nodejs   nogroup      76023 Oct 14 12:13 npm-shrinkwrap.json
</span></span><span><span>-rw-r--r--    1 nodejs   nogroup       2216 Oct 14 12:13 package.json
</span></span><span><span>drwxr-xr-x    6 nodejs   nogroup       4096 Oct 14 12:13 production
</span></span><span><span>drwxr-xr-x    6 nodejs   nogroup       4096 Oct 14 12:13 public
</span></span><span><span>drwxr-xr-x    4 nodejs   nogroup       4096 Oct 14 12:13 routes
</span></span><span><span>drwxr-xr-x    3 nodejs   nogroup       4096 Oct 14 12:13 scripts
</span></span><span><span>drwxr-xr-x    4 nodejs   nogroup       4096 Oct 14 12:13 views
</span></span></code></pre></div><p>From what I could figure out, the app consists of two parts. The first part is responsible for actually reading usage data from the electricity meter connected to the device. This part is called a “Pulse app” and its binary is located in the <code>bin</code> folder:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>root@nt-core:/srv/server# ls -la bin
</span></span><span><span>drwxr-xr-x   10 nodejs   nogroup       4096 Oct 14 12:13 .
</span></span><span><span>drwxr-xr-x   13 nodejs   nogroup       4096 Oct 23 10:47 ..
</span></span><span><span>drwxrw----    2 nodejs   dialout       4096 Nov 16 00:12 aggregate
</span></span><span><span>drwxrw----    2 nodejs   dialout       4096 Oct 23 11:03 cfg
</span></span><span><span>-rwxr-xr-x    1 nodejs   dialout      52418 Oct 14 12:13 ct-read-daemon
</span></span><span><span>drwxrw----    2 nodejs   dialout       4096 Nov 16 01:00 daily
</span></span><span><span>-rwxr-xr-x    1 nodejs   nogroup       1155 Oct 14 12:13 get_sys_versions.sh
</span></span><span><span>drwxrw----    2 nodejs   dialout     118784 Nov 16 03:00 hourly
</span></span><span><span>drwxrw----    2 nodejs   dialout       4096 Nov  1 01:00 monthly
</span></span><span><span>drwxr-xr-x    2 nodejs   nogroup       4096 Oct 14 12:13 output
</span></span><span><span>-rwxr-xr-x    1 nodejs   dialout      34543 Oct 14 12:13 pulse-app
</span></span><span><span>-rwxr-xr-x    1 nodejs   dialout     117029 Oct 14 12:13 pulse.ko
</span></span><span><span>-rwxr-xr-x    1 nodejs   nogroup        758 Oct 14 12:13 reset_nrg_mgr.sh
</span></span><span><span>drwxrw----    2 nodejs   dialout       4096 Nov 16 01:00 weekly
</span></span><span><span>drwxrw----    2 nodejs   dialout       4096 Oct 23 11:00 yearly
</span></span></code></pre></div><p>Judging from the debug symbols, my initial guess was that this is a regular C appication, which seems appropriate for the task of interacting with low-level GPIO pins. However, <code>pulse.ko</code> file got me interested. <code>.ko</code> extension usually means “Kernel Object”, which would suggest that this is actually a kernel module. I do not know a first thing about kernel modules, so I might be wrong here.</p>
<p>Pulse app reads the data from the GPIO pins and stores the results in CSV files. These CSV files are split by month, day and hour in the directories with the respective names, still in the <code>bin</code> folder. Such separation is no coincedence. Historical data view in the web UI of the energy manager supports displaying the data only by month, by day and by hour.</p>
<p>Along with the Pulse app, there is the second part of the application. A Node.js app reads CSV files populated with energy usage data and displays them to the user in the web UI. It uses Node.js 0.10.26, Express.js 4.13.3 and Socket.io 1.3.6.</p>
<p>Scrolling through the dependencies, I noticed an <code>mqtt</code> package. This was intriguing, because I did not see any message broker interaction until now. After reading the sources for a little while, this seemed to be an unfinished cloud integration that Netthings promised in their brochure. There are even some hardcoded IPs mentioned in the source, which are used to connect to a message broker. Unsurprisingly, none of them are up any more. I am not even sure how that would work, since the device does not have an internet access.</p>
<p>All in all, this was a very fun investigation! I grew accustomed to calling it “my urban archeology project”. I now have access to one of the weirdest Edge Computing platforms imaginable. If you have any fun ideas on what to do with it, feel free to drop me a line at <a href="https://laplab.me/cdn-cgi/l/email-protection#fa9293ba969b8a969b98d4979f"><span data-cfemail="5f37361f333e2f333e3d71323a">[email protected]</span></a>!</p>
<p>P.S. As a final touch, I decided to leave a small note in the home directory. It’s kind of weird to realise that I am probably the only person who would actually read it. But maybe in some distant future another software engineer will live in this apartment and discover it. Time will tell :)</p>
<p><img src="https://laplab.me/img/netthings/letter-to-the-void.png" alt="Note to the next tinkerer"/></p>
<p>P.P.S. HackerNews user <a href="https://news.ycombinator.com/item?id=39065780">M6WIQ</a> pointed out <a href="https://strugglers.net/~andy/blog/2018/12/24/the-internet-of-unprofitable-things/">another article</a> about consequences of engineering decisions by NetThings. It’s a great read!</p>
<p>P.P.P.S. Author of the article above kindly responded to me on Mastodon, inquiring whether the device still uses their NTP server IP. The truth turned out to be <a href="https://mastodon.social/@laplab/111789584104871367">much worse</a>.</p>

    </article></div>
  </body>
</html>
