<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/maelstrom-software/maelstrom">Original</a>
    <h1>Show HN: Maelstrom – A Hermetic, Clustered Test Runner for Python and Rust</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/146376379/323394968-7b46a1c1-e67f-412a-b618-42f7e2c25139.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjA2MjExMzgsIm5iZiI6MTcyMDYyMDgzOCwicGF0aCI6Ii8xNDYzNzYzNzkvMzIzMzk0OTY4LTdiNDZhMWMxLWU2N2YtNDEyYS1iNjE4LTQyZjdlMmMyNTEzOS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNzEwJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDcxMFQxNDEzNThaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0wOWRhNDM5OTg3ZjY2N2JhMDA5MjI0MGM1MmY1NmQxZDk5MDQ1ZTQxZTE1MTM3MDk0MDlmNDI1NjAxOWRiOTFiJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.ARvrwXtKIUUx99uN-QMHINB2Bu3WYVBwRJ7bA5hr9e0"><img src="https://private-user-images.githubusercontent.com/146376379/323394968-7b46a1c1-e67f-412a-b618-42f7e2c25139.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjA2MjExMzgsIm5iZiI6MTcyMDYyMDgzOCwicGF0aCI6Ii8xNDYzNzYzNzkvMzIzMzk0OTY4LTdiNDZhMWMxLWU2N2YtNDEyYS1iNjE4LTQyZjdlMmMyNTEzOS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNzEwJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDcxMFQxNDEzNThaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0wOWRhNDM5OTg3ZjY2N2JhMDA5MjI0MGM1MmY1NmQxZDk5MDQ1ZTQxZTE1MTM3MDk0MDlmNDI1NjAxOWRiOTFiJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.ARvrwXtKIUUx99uN-QMHINB2Bu3WYVBwRJ7bA5hr9e0" alt="Maelstrom Logo (Dark Compatible)"/></a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/87b92a2017cc06d7b5b812e0709058107c9b1f2568833c95eede2436da056d14/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f636172676f2d6d61656c7374726f6d"><img src="https://camo.githubusercontent.com/87b92a2017cc06d7b5b812e0709058107c9b1f2568833c95eede2436da056d14/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f636172676f2d6d61656c7374726f6d" alt="Crates.io" data-canonical-src="https://img.shields.io/crates/v/cargo-maelstrom"/></a>
<a href="https://discord.gg/WGacKK5eZz" rel="nofollow"><img src="https://camo.githubusercontent.com/5eea3755a852730e6c36b5642bfb42cabf64e950162ad53c6772632175323155/68747470733a2f2f696d672e736869656c64732e696f2f646973636f72642f31313937363130323633313437343632373336" alt="Discord" data-canonical-src="https://img.shields.io/discord/1197610263147462736"/></a>
<a href="https://opensource.org/licenses/Apache-2.0" rel="nofollow"><img src="https://camo.githubusercontent.com/44bc63cdf9bc4b15dcf019006fc6e19bc712fc031f39fab78c0c4595b2967e93/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4170616368655f322e302d626c75652e737667" alt="License" data-canonical-src="https://img.shields.io/badge/License-Apache_2.0-blue.svg"/></a>
<a href="https://opensource.org/licenses/MIT" rel="nofollow"><img src="https://camo.githubusercontent.com/a4426cbe5c21edb002526331c7a8fbfa089e84a550567b02a0d829a98b136ad0/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d49542d79656c6c6f772e737667" alt="License" data-canonical-src="https://img.shields.io/badge/License-MIT-yellow.svg"/></a>
<a href="https://github.com/maelstrom-software/maelstrom/actions/workflows/ci.yml"><img src="https://github.com/maelstrom-software/maelstrom/actions/workflows/ci.yml/badge.svg" alt="CI"/></a></p>
<p dir="auto">Maelstrom is a suite of tools for running tests in hermetic micro-containers
locally on your machine or distributed across arbitrarily large clusters.
Maelstrom currently has test runners for Rust and Python, with more on the
way. You might use Maelstrom to run your tests because:</p>
<ul dir="auto">
<li><strong>It&#39;s easy.</strong> Maelstrom provides drop-in replacements for <code>cargo test</code> and
<code>pytest</code>. In most cases, it just works with your existing tests with minimal configuration.</li>
<li><strong>It&#39;s reliable.</strong> Maelstrom runs every test hermetically in its own lightweight
container, eliminating confusing errors caused by inter-test or implicit
test-environment dependencies.</li>
<li><strong>It&#39;s scalable.</strong> Maelstrom can be run as a cluster. You can add more worker machines to
linearly increase test throughput.</li>
<li><strong>It&#39;s clean.</strong> Maelstrom has built a rootless container implementation (not
relying on Docker or RunC) from scratch, in Rust, optimized to be
low-overhead and start quickly.</li>
<li><strong>It&#39;s fast.</strong> In most cases, Maelstrom is faster than <code>cargo test</code>, even
without using clustering. Maelstrom’s test-per-process model is inherently
slower than <code>pytest</code>’s shared-process model, but Maelstrom provides test
isolation at a low performance cost.</li>
</ul>
<p dir="auto">While our focus thus far has been on running tests, Maelstrom&#39;s underlying
job execution system is general-purpose. We provide a command
line utility to run arbitrary commands, as well a gRPC-based API and Rust
bindings for programmatic access and control.</p>
<p dir="auto">The project is currently Linux-only (x86 and ARM), as it relies on namespaces
to implement containers.</p>
<p dir="auto">See the <a href="https://maelstrom-software.com/book/" rel="nofollow">book</a> for more information.</p>

<div dir="auto"><h2 tabindex="-1" dir="auto">Installing Pre-Built Binaries</h2><a id="user-content-installing-pre-built-binaries" aria-label="Permalink: Installing Pre-Built Binaries" href="#installing-pre-built-binaries"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To run your tests using Maelstrom, you need a test runner binary.
The easiest way to get it is using
<a href="https://github.com/cargo-bins/cargo-binstall">cargo-binstall</a>:</p>
<p dir="auto">For Rust tests:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo binstall cargo-maelstrom"><pre>cargo binstall cargo-maelstrom</pre></div>
<p dir="auto">For Python tests:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo binstall maelstrom-pytest"><pre>cargo binstall maelstrom-pytest</pre></div>
<p dir="auto">This will install a pre-built binary from the <a href="https://github.com/maelstrom-software/maelstrom/releases">github releases page</a>.</p>
<p dir="auto">If you don&#39;t have <code>cargo-binstall</code>, you can download the binaries manually.</p>
<p dir="auto">Check out the <a href="https://maelstrom-software.com/book/installation.html" rel="nofollow">book</a> for more ways to get Maelstrom.</p>

<p dir="auto">To run your Rust tests, use <code>cargo-maelstrom</code>:</p>

<p dir="auto">This runs in &#34;standalone&#34; mode, meaning all tests are run locally. Each test is
run in its own container, configured with a few common dependencies. It may work for your project without any further configuration.</p>
<p dir="auto">If some tests fail, however, it likely means those tests have dependencies on
their execution environment that aren&#39;t packaged in their containers.
You can remedy this by adding directives to the <code>cargo-maelstrom.toml</code> file. To
do this, run:</p>

<p dir="auto">Then edit the created <code>cargo-maelstrom.toml</code> file as described in the <a href="https://maelstrom-software.com/book/cargo-maelstrom/spec.html" rel="nofollow">book</a>.</p>

<p dir="auto">Before running tests, we need to do a little setup.</p>

<p dir="auto">First generate a <code>maelstrom-pytest.toml</code> file</p>

<p dir="auto">Then update the file to include a python image</p>
<div dir="auto" data-snippet-clipboard-copy-content="[[directives]]
image.name = &#34;docker://python:3.11-slim&#34;
image.use = [&#34;layers&#34;, &#34;environment&#34;]"><pre>[[<span>directives</span>]]
<span>image.name</span> = <span><span>&#34;</span>docker://python:3.11-slim<span>&#34;</span></span>
<span>image.use</span> = [<span><span>&#34;</span>layers<span>&#34;</span></span>, <span><span>&#34;</span>environment<span>&#34;</span></span>]</pre></div>
<p dir="auto">This example installs an <a href="https://hub.docker.com/_/python" rel="nofollow">image from Docker</a></p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Including Your Project Python Files</h2><a id="user-content-including-your-project-python-files" aria-label="Permalink: Including Your Project Python Files" href="#including-your-project-python-files"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">So that your tests can be run from the container, your project&#39;s python must be included.</p>
<div dir="auto" data-snippet-clipboard-copy-content="added_layers = [ { glob = &#34;**.py&#34; } ]"><pre><span>added_layers</span> = [ { <span>glob</span> = <span><span>&#34;</span>**.py<span>&#34;</span></span> } ]</pre></div>
<p dir="auto">This example just adds all files with a <code>.py</code> extension. You may also need to include <code>.pyi</code> files
or other files.</p>

<p dir="auto">If you have an image named &#34;python&#34;, <code>maelstrom-pytest</code> will automatically include pip packages for
you as part of the container. It expects to read these packages from a <code>test-requirements.txt</code> file
in your project directory. This needs to at a minimum include the <code>pytest</code> package</p>
<p dir="auto"><code>test-requirements.txt</code></p>

<p dir="auto">Now we are ready to try to run tests. Just invoke <code>maelstrom-pytest</code>:</p>

<p dir="auto">This runs in &#34;standalone&#34; mode, meaning all tests are run locally. Each test is run in its own
container.</p>

<p dir="auto">To get even more out of Maelstrom, you can set up a cluster to run your tests on.
You will need to run one copy of the broker (<code>maelstrom-broker</code>) somewhere, and
one copy of the worker (<code>maelstrom-worker</code>) on each node of the cluster.</p>
<p dir="auto">You can install these using <a href="https://maelstrom-software.com/book/installation.html" rel="nofollow">multiple
methods</a>,
including <code>cargo-binstall</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo binstall maelstrom-worker maelstrom-broker"><pre>cargo binstall maelstrom-worker maelstrom-broker</pre></div>
<p dir="auto">Then you can start the broker:</p>
<div dir="auto" data-snippet-clipboard-copy-content="maelstrom-broker --port=1234"><pre>maelstrom-broker --port=1234</pre></div>
<p dir="auto">Then a few workers:</p>
<div dir="auto" data-snippet-clipboard-copy-content="maelstrom-worker --broker=broker-host:1234"><pre>maelstrom-worker --broker=broker-host:1234</pre></div>
<p dir="auto">And then run <code>cargo-maelstrom</code> or <code>maelstrom-pytest</code> against the cluster:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo maelstrom --broker=broker-host:1234
maelstrom-pytest --broker=broker-host:1234"><pre>cargo maelstrom --broker=broker-host:1234
maelstrom-pytest --broker=broker-host:1234</pre></div>

<p dir="auto">Find our complete documentation in the <a href="https://maelstrom-software.com/book/" rel="nofollow">book</a>.</p>

<p dir="auto">This project is available under the terms of either the Apache 2.0 license or the MIT license.</p>
</article></div></div>
  </body>
</html>
