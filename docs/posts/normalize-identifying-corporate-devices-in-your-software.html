<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lgug2z.com/articles/normalize-identifying-corporate-devices-in-your-software/">Original</a>
    <h1>Normalize Identifying Corporate Devices in Your Software</h1>
    
    <div id="readability-page-1" class="page"><div><div>
        <p>If you dual-license your software in such a way that it requires a paid license
for commercial use, here are two code blobs for you.</p>
<h2 id="macos">macOS<a href="#macos" arialabel="Anchor">⌗</a> </h2>
<div><pre tabindex="0"><code data-lang="rust"><span><span><span>pub</span> <span>fn</span> <span>mdm_enrollment</span>() -&gt; <span>eyre</span>::Result<span>&lt;</span>(<span>bool</span>, Option<span>&lt;</span>String<span>&gt;</span>)<span>&gt;</span> {
</span></span><span><span>    <span>let</span> <span>mut</span> command <span>=</span> Command::new(<span>&#34;/usr/bin/profiles&#34;</span>);
</span></span><span><span>    command.args([<span>&#34;status&#34;</span>, <span>&#34;-type&#34;</span>, <span>&#34;enrollment&#34;</span>]);
</span></span><span><span>    <span>let</span> stdout <span>=</span> command.output()<span>?</span>.stdout;
</span></span><span><span>    <span>let</span> output <span>=</span> std::<span>str</span>::from_utf8(<span>&amp;</span>stdout)<span>?</span>;
</span></span><span><span>    <span>if</span> output.contains(<span>&#34;MDM enrollment: No&#34;</span>) {
</span></span><span><span>        <span>return</span> Ok((<span>false</span>, None));
</span></span><span><span>    }
</span></span><span><span>
</span></span><span><span>    <span>let</span> <span>mut</span> server <span>=</span> None;
</span></span><span><span>
</span></span><span><span>    <span>for</span> line <span>in</span> output.lines() {
</span></span><span><span>        <span>if</span> line.starts_with(<span>&#34;MDM server&#34;</span>) {
</span></span><span><span>            server <span>=</span> Some(line.trim_start_matches(<span>&#34;MDM server: &#34;</span>).to_string())
</span></span><span><span>        }
</span></span><span><span>    }
</span></span><span><span>
</span></span><span><span>    Ok((<span>true</span>, server))
</span></span><span><span>}
</span></span></code></pre></div><h2 id="windows">Windows<a href="#windows" arialabel="Anchor">⌗</a> </h2>
<div><pre tabindex="0"><code data-lang="rust"><span><span><span>pub</span> <span>fn</span> <span>mdm_enrollment</span>() -&gt; <span>eyre</span>::Result<span>&lt;</span>(<span>bool</span>, Option<span>&lt;</span>String<span>&gt;</span>)<span>&gt;</span> {
</span></span><span><span>    <span>let</span> <span>mut</span> command <span>=</span> Command::new(<span>&#34;dsregcmd&#34;</span>);
</span></span><span><span>    command.args([<span>&#34;/status&#34;</span>]);
</span></span><span><span>    <span>let</span> stdout <span>=</span> command.output()<span>?</span>.stdout;
</span></span><span><span>    <span>let</span> output <span>=</span> std::<span>str</span>::from_utf8(<span>&amp;</span>stdout)<span>?</span>;
</span></span><span><span>    <span>if</span> <span>!</span>output.contains(<span>&#34;MdmUrl&#34;</span>) {
</span></span><span><span>        <span>return</span> Ok((<span>false</span>, None));
</span></span><span><span>    }
</span></span><span><span>
</span></span><span><span>    <span>let</span> <span>mut</span> server <span>=</span> None;
</span></span><span><span>
</span></span><span><span>    <span>for</span> line <span>in</span> output.lines() {
</span></span><span><span>        <span>if</span> line.contains(<span>&#34;MdmUrl&#34;</span>) {
</span></span><span><span>            <span>let</span> line <span>=</span> line.trim().to_string();
</span></span><span><span>            server <span>=</span> Some(line.trim_start_matches(<span>&#34;MdmUrl : &#34;</span>).to_string())
</span></span><span><span>        }
</span></span><span><span>    }
</span></span><span><span>
</span></span><span><span>    Ok((<span>true</span>, server))
</span></span><span><span>}
</span></span></code></pre></div><p>Looking at mobile device management (MDM) enrollment is not a silver bullet for
identifying corporate devices running your software, but it is a good start.</p>
<p>A productive next step would be to put together a list of known corporate MDM
server URLs in a public repository to allow for more granular identification.</p>
<p>This is something anyone with a corporate device enrolled in MDM can contribute
to by running <code>profiles status -type enrollment</code> on macOS or <code>dsregcmd /status</code>
on Windows.</p>
<hr/>
<p>If you have any questions or comments you can reach out to me on
<a href="https://bsky.app/profile/lgug2z.com">Bluesky</a> and
<a href="https://hachyderm.io/@LGUG2Z">Mastodon</a>.</p>
<p>If you’re interested in what I read to come up with software like komorebi, you
can subscribe to my <a href="https://notado.app/feeds/jado/software-development">Software Development RSS
feed</a>.</p>
<p>If you’d like to watch me writing code while explaining what I’m doing, you can
also <a href="https://www.youtube.com/channel/UCeai3-do-9O4MNy9_xjO6mg?sub_confirmation=1">subscribe to my YouTube
channel</a>.</p>
<p>If you would like early access to <a href="https://www.youtube.com/watch?v=u3eJcsa_MJk">komorebi for
Mac</a>, you can sponsor me on
<a href="https://github.com/sponsors/LGUG2Z">GitHub</a>.</p>

      </div></div></div>
  </body>
</html>
