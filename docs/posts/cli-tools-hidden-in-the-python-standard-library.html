<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://til.simonwillison.net/python/stdlib-cli-tools">Original</a>
    <h1>CLI tools hidden in the Python standard library</h1>
    
    <div id="readability-page-1" class="page"><section>



<p>Seth Michael Larson <a href="https://twitter.com/sethmlarson/status/1674141676325990400" rel="nofollow">pointed out</a> that the Python <code>gzip</code> module can be used as a CLI tool like this:</p>
<div><pre>python -m gzip --decompress pypi.db.gz</pre></div>
<p>This is a neat Python feature: modules with a <code>if __name__ == &#34;__main__&#34;:</code> block that are available on Python&#39;s standard import path can be executed from the terminal using <code>python -m name_of_module</code>.</p>
<p>Seth pointed out this is useful if you are on Windows and don&#39;t have the <code>gzip</code> utility installed.</p>
<p>This made me wonder: what other little tools are lurking in the Python standard library, available on any computer with a working Python installation?</p>
<h2><a id="user-content-finding-them-with-ripgrep" aria-hidden="true" href="#finding-them-with-ripgrep"><span aria-hidden="true"></span></a>Finding them with ripgrep</h2>
<p>I decided to take a sniff around the standard library and see what I can find.</p>
<p>Jim Crist-Harif <a href="https://twitter.com/jcristharif/status/1674146077757276162" rel="nofollow">pointed me</a> to <code>python -m site</code>, which outputs useful information about your installation:</p>

<pre><code>sys.path = [
    &#39;/opt/homebrew/Cellar/python@3.11/3.11.4_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11&#39;,
    &#39;/opt/homebrew/Cellar/python@3.11/3.11.4_1/Frameworks/Python.framework/Versions/3.11/lib/python311.zip&#39;,
    &#39;/opt/homebrew/Cellar/python@3.11/3.11.4_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/lib-dynload&#39;,
    &#39;/opt/homebrew/lib/python3.11/site-packages&#39;,
    &#39;/opt/homebrew/opt/python@3.11/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages&#39;,
]
USER_BASE: &#39;/Users/simon/Library/Python/3.11&#39; (doesn&#39;t exist)
USER_SITE: &#39;/Users/simon/Library/Python/3.11/lib/python/site-packages&#39; (doesn&#39;t exist)
ENABLE_USER_SITE: True
</code></pre>
<p>This showed me that the standard library itself for my Homebrew installation of Python 3.11 is in <code>/opt/homebrew/Cellar/python@3.11/3.11.4_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11</code>.</p>
<p>So I switched there and used <code>ripgrep</code> to find likely packages:</p>
<pre><code>cd /opt/homebrew/Cellar/python@3.11/3.11.4_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11
</code></pre>
<p>Then ran <code>rg</code>:</p>
<pre><code>rg &#39;if __name__ =&#39; -l | grep -v &#39;test/&#39; \
  | grep -v &#39;tests/&#39; | grep -v idlelib | grep -v turtledemo
</code></pre>
<p>The <code>-l</code> option causes <code>ripgrep</code> to list matching files without showing the context of the match.</p>
<p>I built up those <code>grep -v</code> exclusions over a few iterations - <code>idlelib/</code> and <code>turtledemo/</code> have a bunch of matches that I wasn&#39;t interested in.</p>
<p>Here&#39;s the result:</p>
<pre><code>tabnanny.py
pyclbr.py
netrc.py
heapq.py
fileinput.py
site.py
telnetlib.py
smtplib.py
timeit.py
__hello__.py
aifc.py
json/tool.py
asyncio/__main__.py
runpy.py
mailcap.py
tokenize.py
smtpd.py
sysconfig.py
tarfile.py
lib2to3/pgen2/tokenize.py
lib2to3/pgen2/driver.py
lib2to3/pgen2/literals.py
xmlrpc/server.py
xmlrpc/client.py
getopt.py
dbm/__init__.py
doctest.py
pickle.py
imaplib.py
compileall.py
shlex.py
ast.py
venv/__init__.py
py_compile.py
ensurepip/__main__.py
ensurepip/_uninstall.py
http/server.py
pickletools.py
poplib.py
quopri.py
calendar.py
pprint.py
symtable.py
pstats.py
inspect.py
pdb.py
platform.py
wsgiref/simple_server.py
random.py
ftplib.py
mimetypes.py
turtle.py
tkinter/dialog.py
xml/sax/expatreader.py
tkinter/colorchooser.py
tkinter/dnd.py
tkinter/filedialog.py
tkinter/messagebox.py
tkinter/simpledialog.py
tkinter/font.py
tkinter/scrolledtext.py
xml/sax/xmlreader.py
tkinter/__init__.py
code.py
difflib.py
pydoc.py
uu.py
imghdr.py
filecmp.py
profile.py
cgi.py
codecs.py
modulefinder.py
__phello__/__init__.py
__phello__/spam.py
multiprocessing/spawn.py
textwrap.py
base64.py
curses/textpad.py
curses/has_key.py
zipapp.py
cProfile.py
dis.py
webbrowser.py
nntplib.py
sndhdr.py
gzip.py
ctypes/util.py
zipfile.py
encodings/rot_13.py
distutils/fancy_getopt.py
</code></pre>
<p>That&#39;s a lot of neat little tools!</p>
<p>I haven&#39;t explored my way through all of them yet, but running <code>python -m module_name</code> usually outputs something useful, and adding <code>-h</code> frequently provides help.</p>
<h2><a id="user-content-a-few-highlights" aria-hidden="true" href="#a-few-highlights"><span aria-hidden="true"></span></a>A few highlights</h2>
<p>Here are a few of the commands I&#39;ve figured out so far.</p>
<h3><a id="user-content-httpserver" aria-hidden="true" href="#httpserver"><span aria-hidden="true"></span></a>http.server</h3>
<p>To run a localhost webserver on port 8000, serving the content of the current directory:</p>

<p>This takes an optional port. To change port, do this:</p>
<div><pre>python -m http.server 8001</pre></div>
<p>Pass <code>-h</code> for more options.</p>
<h3><a id="user-content-base64" aria-hidden="true" href="#base64"><span aria-hidden="true"></span></a>base64</h3>

<pre><code>usage: .../base64.py [-h|-d|-e|-u|-t] [file|-]
        -h: print this help message and exit
        -d, -u: decode
        -e: encode (default)
        -t: encode and decode string &#39;Aladdin:open sesame&#39;
</code></pre>
<h3><a id="user-content-asyncio" aria-hidden="true" href="#asyncio"><span aria-hidden="true"></span></a>asyncio</h3>
<p>This provides a Python console with top-level await:</p>

<div><pre>asyncio REPL 3.11.4 (main, Jun 20 2023, 17:23:00) [Clang 14.0.3 (clang-1403.0.22.14.1)] on darwin
Use &#34;await&#34; directly instead of &#34;asyncio.run()&#34;.
Type &#34;help&#34;, &#34;copyright&#34;, &#34;credits&#34; or &#34;license&#34; for more information.
&gt;&gt;&gt; <span>import</span> asyncio
&gt;&gt;&gt; <span>import</span> httpx
&gt;&gt;&gt; <span>async</span> <span>with</span> httpx.AsyncClient() <span>as</span> client:
...     r <span>=</span> <span>await</span> client.get(<span><span>&#39;</span>https://www.example.com/<span>&#39;</span></span>)
... 
&gt;&gt;&gt; r.text[:<span>50</span>]
&#39;&lt;!DOCTYPE html&gt;\n&lt;html lang=&#34;en&#34;&gt;\n&lt;head&gt;\n  &lt;meta ht&#39;</pre></div>
<h3><a id="user-content-tokenize" aria-hidden="true" href="#tokenize"><span aria-hidden="true"></span></a>tokenize</h3>
<p>This is fun - it&#39;s a debug mode for the Python tokenizer. You can run it directly against a file:</p>
<div><pre>python -m tokenize cgi.py <span>|</span> head -n 10</pre></div>
<pre><code>0,0-0,0:            ENCODING       &#39;utf-8&#39;        
1,0-1,24:           COMMENT        &#39;#! /usr/local/bin/python&#39;
1,24-1,25:          NL             &#39;\n&#39;           
2,0-2,1:            NL             &#39;\n&#39;           
3,0-3,66:           COMMENT        &#39;# NOTE: the above &#34;/usr/local/bin/python&#34; is NOT a mistake.  It is&#39;
3,66-3,67:          NL             &#39;\n&#39;           
4,0-4,59:           COMMENT        &#39;# intentionally NOT &#34;/usr/bin/env python&#34;.  On many systems&#39;
4,59-4,60:          NL             &#39;\n&#39;           
5,0-5,65:           COMMENT        &#39;# (e.g. Solaris), /usr/local/bin is not in $PATH as passed to CGI&#39;
5,65-5,66:          NL             &#39;\n&#39;           
</code></pre>
<h3><a id="user-content-ast" aria-hidden="true" href="#ast"><span aria-hidden="true"></span></a>ast</h3>
<p>Even more fun than <code>tokenize</code> - a debug mode for the Python AST module!</p>
<div><pre>python -m ast cgi.py <span>|</span> head -n 10</pre></div>
<pre><code>Module(
   body=[
      Expr(
         value=Constant(value=&#39;Support module for CGI (Common Gateway Interface) scripts.\n\nThis module defines a number of utilities for use by CGI scripts\nwritten in Python.\n\nThe global variable maxlen can be set to an integer indicating the maximum size\nof a POST request. POST requests larger than this size will result in a\nValueError being raised during parsing. The default value of this variable is 0,\nmeaning the request size is unlimited.\n&#39;)),
      Assign(
         targets=[
            Name(id=&#39;__version__&#39;, ctx=Store())],
         value=Constant(value=&#39;2.6&#39;)),
      ImportFrom(
         module=&#39;io&#39;,
</code></pre>
<p>I used this module to build my <a href="https://github.com/simonw/symbex">symbex</a> tool - this debug mode would have helped quite a bit if I&#39;d found out about it earlier.</p>
<h3><a id="user-content-jsontool" aria-hidden="true" href="#jsontool"><span aria-hidden="true"></span></a>json.tool</h3>
<p>Pretty-print JSON:</p>
<div><pre><span>echo</span> <span><span>&#39;</span>{&#34;foo&#34;: &#34;bar&#34;, &#34;baz&#34;: [1, 2, 3]}<span>&#39;</span></span> <span>|</span> python -m json.tool</pre></div>
<div><pre>{
    <span>&#34;foo&#34;</span>: <span><span>&#34;</span>bar<span>&#34;</span></span>,
    <span>&#34;baz&#34;</span>: [
        <span>1</span>,
        <span>2</span>,
        <span>3</span>
    ]
}</pre></div>
<h3><a id="user-content-random" aria-hidden="true" href="#random"><span aria-hidden="true"></span></a>random</h3>
<p>I thought this might provide a utility for generating random numbers, but sadly it&#39;s just a benchmarking suite with no additional command-line options:</p>

<pre><code>0.000 sec, 2000 times random
avg 0.49105, stddev 0.290864, min 0.00216092, max 0.999473

0.001 sec, 2000 times normalvariate
avg -0.00286956, stddev 0.996872, min -3.42333, max 4.2012

0.001 sec, 2000 times lognormvariate
avg 1.64228, stddev 2.13138, min 0.0386213, max 34.0379

0.001 sec, 2000 times vonmisesvariate
avg 3.18754, stddev 2.27556, min 0.00336177, max 6.28306
...
</code></pre>
<h3><a id="user-content-nntplib" aria-hidden="true" href="#nntplib"><span aria-hidden="true"></span></a>nntplib</h3>
<p>&#34;nntplib built-in demo - display the latest articles in a newsgroup&#34;</p>
<p>It defaults to <code>gmane.comp.python.general</code>:</p>

<pre><code>Group gmane.comp.python.general has 757237 articles, range 23546 to 848591
 848582 MRAB via Python-...  Re: Trouble with defaults and timeout ...  (40)
 848583 Dave Ohlsson via...  unable to run the basic Embedded Pytho...  (179)
 848584 Piergiorgio Sart...  Re: Trouble with defaults and timeout ...  (43)
 848585 Dan Kolis via Py...  TKinter in Python - advanced notions - ok  (52)
 848586 Fulian Wang via ...  Re: unable to run the basic Embedded P...  (190)
 848587 Fulian Wang via ...  Re: unable to run the basic Embedded P...  (220)
 848588 Christian Gollwi...  Re: unable to run the basic Embedded P...  (26)
 848589 small marcc via ...  my excel file is not updated to add ne...  (42)
 848590 Thomas Passin vi...  Re: my excel file is not updated to ad...  (47)
 848591 dn via Python-list   Re: my excel file is not updated to ad...  (207)
</code></pre>
<p>Those look like real, recent messages - I matched them with <a href="https://www.mail-archive.com/python-list@python.org/" rel="nofollow">this mirror</a>.</p>
<p>When I tried passing other newsgroup names with <code>python -m nntplib -g alt.humor.puns</code> I got an error though:</p>
<blockquote>
<p><code>NNTPTemporaryError: 411 No such group alt.humor.puns</code></p>
</blockquote>
<h3><a id="user-content-calendar" aria-hidden="true" href="#calendar"><span aria-hidden="true"></span></a>calendar</h3>
<p>Show a calendar for the current year:</p>

<pre><code>                                  2023

      January                   February                   March
Mo Tu We Th Fr Sa Su      Mo Tu We Th Fr Sa Su      Mo Tu We Th Fr Sa Su
                   1             1  2  3  4  5             1  2  3  4  5
 2  3  4  5  6  7  8       6  7  8  9 10 11 12       6  7  8  9 10 11 12
 9 10 11 12 13 14 15      13 14 15 16 17 18 19      13 14 15 16 17 18 19
16 17 18 19 20 21 22      20 21 22 23 24 25 26      20 21 22 23 24 25 26
23 24 25 26 27 28 29      27 28                     27 28 29 30 31
30 31

       April                      May                       June
Mo Tu We Th Fr Sa Su      Mo Tu We Th Fr Sa Su      Mo Tu We Th Fr Sa Su
                1  2       1  2  3  4  5  6  7                1  2  3  4
 3  4  5  6  7  8  9       8  9 10 11 12 13 14       5  6  7  8  9 10 11
10 11 12 13 14 15 16      15 16 17 18 19 20 21      12 13 14 15 16 17 18
17 18 19 20 21 22 23      22 23 24 25 26 27 28      19 20 21 22 23 24 25
24 25 26 27 28 29 30      29 30 31                  26 27 28 29 30

        July                     August                  September
Mo Tu We Th Fr Sa Su      Mo Tu We Th Fr Sa Su      Mo Tu We Th Fr Sa Su
                1  2          1  2  3  4  5  6                   1  2  3
 3  4  5  6  7  8  9       7  8  9 10 11 12 13       4  5  6  7  8  9 10
10 11 12 13 14 15 16      14 15 16 17 18 19 20      11 12 13 14 15 16 17
17 18 19 20 21 22 23      21 22 23 24 25 26 27      18 19 20 21 22 23 24
24 25 26 27 28 29 30      28 29 30 31               25 26 27 28 29 30
31

      October                   November                  December
Mo Tu We Th Fr Sa Su      Mo Tu We Th Fr Sa Su      Mo Tu We Th Fr Sa Su
                   1             1  2  3  4  5                   1  2  3
 2  3  4  5  6  7  8       6  7  8  9 10 11 12       4  5  6  7  8  9 10
 9 10 11 12 13 14 15      13 14 15 16 17 18 19      11 12 13 14 15 16 17
16 17 18 19 20 21 22      20 21 22 23 24 25 26      18 19 20 21 22 23 24
23 24 25 26 27 28 29      27 28 29 30               25 26 27 28 29 30 31
30 31
</code></pre>
<p>This one has a bunch more options (visible with <code>-h</code>). <code>python -m calendar -t html</code> produces the calendar in HTML, for example.</p>
<h3><a id="user-content-loads-more" aria-hidden="true" href="#loads-more"><span aria-hidden="true"></span></a>Loads more</h3>
<p>There are plenty more in there - these are just the ones I&#39;ve explored so far.</p>




  <h3>Related</h3>
  


<p>Created 2023-06-28T17:16:48-07:00, updated 2023-06-28T18:24:09-07:00 · <a href="https://github.com/simonw/til/commits/main/python/stdlib-cli-tools.md">History</a> · <a href="https://github.com/simonw/til/blob/main/python/stdlib-cli-tools.md">Edit</a></p>

</section></div>
  </body>
</html>
