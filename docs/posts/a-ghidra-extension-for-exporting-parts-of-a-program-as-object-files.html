<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/boricj/ghidra-delinker-extension">Original</a>
    <h1>Show HN: A Ghidra extension for exporting parts of a program as object files</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">This Ghidra extension enables exporting parts of a program as object files. These object files have valid metadata (symbols, relocation tables…) and as such can be reused directly by a toolchain for further processing.</p>
<p dir="auto">Use-cases include:</p>
<ul dir="auto">
<li><a href="https://boricj.net/tenchu1/2024/05/31/part-11.html" rel="nofollow">Advanced binary patching</a>, by leveraging the linker to mend both original and modified parts together instead of doing this work by hand ;</li>
<li><a href="https://boricj.net/atari-jaguar-sdk/2024/01/02/part-5.html" rel="nofollow">Software ports</a>, by isolating system-independent code from a program and replacing the rest ;</li>
<li>Converting <a href="https://boricj.net/atari-jaguar-sdk/2023/12/18/part-3.html" rel="nofollow">programs</a> or object files from one file format to another ;</li>
<li><a href="https://boricj.net/tenchu1/2024/03/11/part-5.html" rel="nofollow">Creating</a> <a href="https://boricj.net/tenchu1/2024/03/18/part-6.html" rel="nofollow">libraries</a>, by extracting parts of a program and reusing them in another context ;</li>
<li>Decompilation projects, by splitting a program into multiple object files and reimplementing these <em>Ship of Theseus</em>-style ;</li>
<li>…</li>
</ul>
<p dir="auto">Matrix of supported instruction set architectures and object files:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th></th>
<th>x86</th>
<th>MIPS</th>
</tr>
</thead>
<tbody>
<tr>
<td>COFF</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>ELF</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<ul dir="auto">
<li>Clone this repository ;</li>
<li>Define the <code>GHIDRA_INSTALL_DIR</code> environment variable to point to your Ghidra installation directory ;</li>
<li>Run <code>gradle buildExtension</code>.</li>
</ul>
<p dir="auto">The Ghidra extension archive will be created inside the <code>dist/</code> directory.</p>

<ul dir="auto">
<li>Download the extension from the <a href="https://github.com/boricj/ghidra-delinker-extension/releases">releases page</a> or build it locally ;</li>
<li>Install the extension in your Ghidra instance with <code>File &gt; Install Extensions…</code> ;</li>
<li>Enable the <code>RelocationTableSynthesizedPlugin</code> plugin with <code>File &gt; Configure</code> inside a CodeBrowser window.</li>
</ul>

<ol dir="auto">
<li>Select a set of addresses in the Listing view ;</li>
<li>Run the <code>Relocation table synthesizer</code> analyzer (available in one-shot mode) ;</li>
<li>Invoke a relocatable object file exporter with <code>File &gt; Export Program…</code></li>
</ol>
<p dir="auto">The reconstructed relocations can be viewed with <code>Window &gt; Relocation table (synthesized)</code>.</p>
<ul dir="auto">
<li><g-emoji alias="warning">⚠️</g-emoji> The <em>relocation table synthesizer</em> analyzer relies on a fully populated Ghidra database (with correctly declared symbols, data types and references) in order to work. <strong>Incorrect or missing information may lead to broken or undiscovered relocations</strong> during the analysis.</li>
<li><g-emoji alias="warning">⚠️</g-emoji> The object file exporters rely on the results of the <em>relocation table synthesizer</em> analyzer in order to work. When in doubt, <strong>run this analyzer right before exporting an object file</strong> to make sure the relocation table contents are up-to-date with the current state of the program.</li>
</ul>

<p dir="auto">Object files are made of three parts:</p>
<ul dir="auto">
<li>Relocatable section bytes ;</li>
<li>A symbol table ;</li>
<li>A relocation table.</li>
</ul>
<p dir="auto">When a linker is invoked to generate an executable from a bunch of object files, it will:</p>
<ul dir="auto">
<li>Lay out their sections in memory ;</li>
<li>Compute the addresses of the symbols in the virtual address space ;</li>
<li>Apply the relocations based on the final addresses of the symbols onto the section bytes.</li>
</ul>
<p dir="auto">Normally the relocation table is discarded after this process, as well as the symbol table if debugging symbols aren&#39;t kept, leaving only the un-relocatable section bytes.
However, through careful analysis this data can be recreated, which allows us to then effectively <em>delink</em> the program back into object files.</p>
</article></div></div>
  </body>
</html>
