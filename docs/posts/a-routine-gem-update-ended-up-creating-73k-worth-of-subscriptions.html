<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://serpapi.com/blog/how-a-routine-gem-update-ended-up-charging/">Original</a>
    <h1>A routine gem update ended up creating $73k worth of subscriptions</h1>
    
    <div id="readability-page-1" class="page"><article>

    <header>

        <section>
            <a href="https://serpapi.com/blog/tag/business/">Business</a>
        </section>

        


        <div>
            <section>
                <ul>
                    <li>
                        <a href="https://serpapi.com/blog/author/julien/">
                            <img src="https://serpapi.com/blog/content/images/size/w100/2021/07/IMG_4604.jpeg" alt="Julien Khaleghy"/>
                        </a>
                    </li>
                </ul>
                <div>
                    
                    <p><time datetime="2022-01-07">Jan 7, 2022</time>
                        <span><span>â€¢</span> 3 min read</span>
                    </p>
                </div>
            </section>
        </div>

    </header>

    <section>
        <p>On November 5, 2021 (a Friday of course), we&#39;ve deployed innocent-looking gem updates. Minor versions of Ruby on Rails, Ruby Sentry client, Ruby Slack client, http libraries, Puma, Devise, OmniAuth Ruby client, Mongoid, and a few test gems. </p><figure><img src="https://serpapi.com/blog/content/images/2021/11/image-1.png" alt="" loading="lazy" width="1252" height="426" srcset="https://serpapi.com/blog/content/images/size/w600/2021/11/image-1.png 600w, https://serpapi.com/blog/content/images/size/w1000/2021/11/image-1.png 1000w, https://serpapi.com/blog/content/images/2021/11/image-1.png 1252w" sizes="(min-width: 720px) 720px"/></figure><p>In less than 1h, we&#39;ve created 474 new subscriptions for a total of $73,271.36.</p><figure><img src="https://serpapi.com/blog/content/images/2021/11/image-2.png" alt="" loading="lazy" width="2000" height="1227" srcset="https://serpapi.com/blog/content/images/size/w600/2021/11/image-2.png 600w, https://serpapi.com/blog/content/images/size/w1000/2021/11/image-2.png 1000w, https://serpapi.com/blog/content/images/size/w1600/2021/11/image-2.png 1600w, https://serpapi.com/blog/content/images/size/w2400/2021/11/image-2.png 2400w" sizes="(min-width: 720px) 720px"/></figure><p>After refunding everyone, we manually double-checked the billing state of each account one by one and sent emails to apologize to each customer one by one; all 475 of them.</p><figure><img src="https://serpapi.com/blog/content/images/2021/12/image-18.png" alt="" loading="lazy" width="1596" height="502" srcset="https://serpapi.com/blog/content/images/size/w600/2021/12/image-18.png 600w, https://serpapi.com/blog/content/images/size/w1000/2021/12/image-18.png 1000w, https://serpapi.com/blog/content/images/2021/12/image-18.png 1596w" sizes="(min-width: 720px) 720px"/></figure><p>This is part of a feature that seems good on paper: We offer to automatically renew your plan if you run out of searches on our service. </p><pre><code>computed_selector_in_mongoid_7_0_8 = {
  &#34;_id&#34; =&gt; BSON::ObjectId(&#39;59af54094-----------64&#39;), &#34;$or&#34; =&gt; [{
    &#34;renewing_early_lock_at&#34; =&gt; {
      &#34;$lte&#34; =&gt; 2022-01-07 20:14:53.44744 UTC
    }
  }, {
    &#34;renewing_early_lock_at&#34; =&gt; nil
  }]
}</code></pre><p>In Mongoid <code>7.3.3</code> , <code>or()</code> now means filter documents that contain any of the argument conditions OR any of previous method conditions! In our case filter users that have either a specific id OR that have never had a <code>renewing_early_lock</code> OR their <code>renewing_early_lock</code> is less than 1 hour ago.</p><pre><code>computed_selector_in_mongoid_7_3_3 = {
  &#34;$or&#34; =&gt; [{
    &#34;_id&#34; =&gt; BSON::ObjectId(&#39;59af54094-----------64&#39;)
  }, {
    &#34;renewing_early_lock_at&#34; =&gt; {
      &#34;$lte&#34; =&gt; 2022-01-07 19:00:09.571034 UTC
    }
  }, {
    &#34;renewing_early_lock_at&#34; =&gt; nil
  }]
}</code></pre><p>Notice that the user ID selector got moved into an optional <code>or()</code>! </p><figure><img src="https://serpapi.com/blog/content/images/2022/01/image-3.png" alt="" loading="lazy" width="1398" height="1050" srcset="https://serpapi.com/blog/content/images/size/w600/2022/01/image-3.png 600w, https://serpapi.com/blog/content/images/size/w1000/2022/01/image-3.png 1000w, https://serpapi.com/blog/content/images/2022/01/image-3.png 1398w" sizes="(min-width: 720px) 720px"/></figure><p>Which is obviously awful.</p>
    </section>



</article></div>
  </body>
</html>
