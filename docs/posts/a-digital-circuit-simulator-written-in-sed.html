<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://fideo.info/wiki.lua/blog/sed-circuit-simulator">Original</a>
    <h1>A digital circuit simulator written in sed</h1>
    
    <div id="readability-page-1" class="page"><div id="content" ondblclick="showEditor(true)"><pre>                            sed-circuit-simulator

                 a digital circuit simulator written in sed.

<img alt="image" width="640" height="48" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUAAAAAYBAMAAAB5FDm3AAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAAfklEQVRIie2TQQrAIAwE/WTxJWG/X1Njtb30sIdY2NGARA/DBsuxOSVb4AsJskiQRYIsPxEEZsfPraq1BfSKc5qgC4xGtVhovb77/XySITjTGUJXYu4VieYKYk3wJeg36YLLCO8RG/YZ8SOh5ZPEiC1fcGMkyCJBFgmySJDlBNeAB2TdR3ceAAAAAElFTkSuQmCC"/>

As many of you might know, one of my hobbies is writing code on a programming
language called &#34;sed&#34;, commonly available on unix-like operating systems.
Most unix users developers only have a superficial knowledge of this programming
language, let alone developers in general, and with good reason: doing anything
other than a simple &#34;s/pattern/replacement/&#34; substitution is a recipe for an
unreadable mess.  In other words &#34;sed&#34; is a write-only or esoteric programming
language.

Sed only contains two places were we can store a string: the pattern space and
the hold space.  The program in its most basic form will be executed once per
each input line, and each execution will start with the pattern space containing
such line, the hold space however is kept in memory across the all the input,
and in this case we will certainly be using that space.

This means we have to:
  * Encode all the memory structures of our program into a single string using
    a format that simplifies the regexp replacements we will be using.
    - HINT: To do this, reserving a subset of the characters for usage of these
      structures is in general a good idea.
  * Validate all input so that we either:
    * Reject lines with reserved characters.
    * Remove reserved characters from the input.
    * Escape those characters: ie: html uses «&amp;quot;» for «&#34;», and then «&amp;amp;»
      for «&amp;».
  * Consider having a partial order for the parts of the string, as that can
    be useful for marking whether some processing has been done, for example
    a given delimiter could separate the processed parts from the rest.

<img alt="image" width="640" height="48" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUAAAAAYBAMAAAB5FDm3AAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA0UlEQVRIie2TCwrDMAiGe0nxJOL1l4evpmWjdbAO/ENCUCOfSdzg4dp+DfBJBZhVAWZVgFn9CSCSGZCpzba0iTK730KYQexzT+hx0d8yDB/N/JITxrnLgBwAicGA+tLnAFE/CrAPi9NaBxA6IGtOs1wEjDdoAA4Y0xqA2FZAg2HmNebLgExvAeVWD4Cg5+kc8NYT757In8MA559aC4CzJ3ZA/4P+j/u4AagJ5n7fJKHyGWBNgBQaxrsoNok2mhYhTXX9Bh+sAsyqALMqwKwKMKsX7KAdLvwoKVYAAAAASUVORK5CYII="/>

To reduce the scope of this simulator we will be considering circuits as just
a bunch of logic gates connected by cables:
 * a cable can be on or off (which we represent by 1 or 0 respectively),
 * logic gates are boxes with one or many inputs and one output whose value
   depends on whether the inputs are on or off.  Even though in real life
   there are many types of logic gates, here we will only be supporting the
   following: OR, AND and NOT.
   * an OR gate outputs 1 if any of its inputs are 1, otherwise it outputs 0.
   * an AND gate outputs 1 if all of its inputs are 1, otherwise it outputs 0.
   * a NOT gate has only one input and the output is the input negated,
     that is 1 if the input is 0; and 0 if the input is 1.
 * we don&#39;t allow outputs connected together, as in some contexts that could
   cause a short circuit on real life (it&#39;s quite more complex in reality, as
   there are ways to support multiple outputs on a single cable, like using
   three-state or open collectors).

So in order to model this our simulator model circuits as a bunch of nodes,
where a node has a definition and a state.
 * The state of all nodes is initially set to 0, and at each step we
   recalculate the state of each node based on the states of the nodes at
   the previous step.  This means that each node will represent an output with
   a propagation delay of one step.
 * Definitions are mathematical expressions which can contain:
   * Node names (all of them must be defined).
   * The binary «+» operator returning the OR of the expressions.
   * The binary «*» operator returning the AND of the expressions.
   * The unary «!» operator returning the NOT of the expression at its right.
   * Balanced parenthesis, to override the order for the expression evaluation
     as done traditionally in math.

<img alt="image" width="640" height="48" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUAAAAAYBAMAAAB5FDm3AAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAAwklEQVRIie2TDQrDIAyFe0nxJOFdf0bzhx0bNBvrIM+KbdLql2c92s11/BrgnQowqwLMqgCz+hNAwCOdxrUaxztAMzbG1anZN5znN/UekrRn8lgGcMKo5sS8qEByiheU207QOqwQb1qjNrQw83XAQWABcWR1AbRRHLNCNriOJ/Bxdy4DhjJfAlJ0O8ABkms23e5qDhAOucC0m3MBUB2J7qmbe+ZDW6wA+7L+7zno6ZCo0988JHdWAWZVgFkVYFYFmNUDBvUZwH5PuowAAAAASUVORK5CYII="/>

Feel free to add any &#39;p&#39; commands in the source code to show the
intermediate state at any place.

  1│ s/ //g; /^\(&lt;[^&gt;|:=+*()!]*:[^&gt;|:=]*&gt;\)*$/!{s/.*/syntax error/;n;}
  2│ 1s/^/|/; x; G; s/\n//; s/.*|\(.*\)/\1&amp;/
  3│ :d; s/\(&lt;[^&gt;]*\):[^&gt;]*\(&gt;.*|\)/\1=0\2/; td
  4│ :a; s/\(.*\)\(&lt;[^&gt;]*[=:]\)[^&gt;]*&gt;\([^|]*\)\2\([^&gt;]*&gt;\)/\1\2\4\3/; ta
  5│ s/|.*/&amp;&amp;/
  6│ :v; s/\(&lt;\([^=]*\)=\([01]\)&gt;.*|.*|.*[:+*!(]\)\2\([+*)&gt;]\)/\1\3\4/; tv
  7│ h; s/.*|//
  8│ :e
  9│   s/!0/1/g; s/!1/0/g; s/(\([01]\))/\1/g; te
 10│   s/1\*1/1/g; te; s/[01]\*[01]/0/g; te
 11│   s/0+0/0/g; te; s/[01]+[01]/1/g; te
 12│ /:[^01]\|:.[^&gt;]/{s/^/eval error: /;q;}
 13│ s/:/=/g; x; s/[^|]*$//; G; s/.*\(|.*\)|.\(.*\)/\2\1/; h; s/^/-- /

Decoding each line:

 1. Remove spaces from the input, each input line should have the following
    format: 0 or more assignments where each assignment is &#34;&lt;&#34; + the name of
    the variable being assigned + &#34;:&#34; + the definition for that variable + &#34;&gt;&#34;.
    Otherwise we show &#34;syntax error&#34; jumping to the beginning of the program
    to process the next line.  Among the names and definitions we reject any
    occurrences of the characters ­«|:=&lt;&gt;», these will be reserved characters.

 2. Let&#39;s try to make sense of this line by converting it to lua.  Note as
    well that in the line 8 we are overwriting the hold space, hold space we
    don&#39;t use until the very last line, so really we don&#39;t care about what&#39;s
    left in there after this line.  So:
      -- We add a pipe if we are reading the first line (that&#39;s the meaning
      -- of the 1 before the &#39;s&#39; command):
      if first_line then
        pattern = &#39;|&#39; .. pattern
      end
      -- With &#39;x&#39; we interchange the hold and pattern spaces:
      pattern, hold = hold, pattern
      -- and with the &#39;G&#39; command we append a new line plus the hold space to
      -- the pattern space.
      pattern = pattern .. &#39;\n&#39; .. hold
      -- We delete the newline character:
      pattern = pattern:gsub(&#39;\n&#39;, &#39;&#39;)
      -- And then add whatever is after the pipe, to the beginning of the line:
      pattern = pattern:match &#39;.*|(.*)&#39; .. pattern

    Note that what we really intended by doing «x;G;s/\n//» is to just have:
    pattern = hold .. pattern; but there&#39;s no command in sed for this.

    In other words, since we don&#39;t care about the hold space, this would be the
    equivalent to just the pattern space if we combine all these commands:
      if first_line then
        pattern = pattern .. &#39;|&#39; .. pattern
      else
        pattern = hold:match&#39;.*|(.*)&#39; .. pattern .. hold .. pattern
      end

    After this line we will have two sections separated by a pipe: on the left
    we will be ultimately storing the current state of the circuit, on the
    right all the definitions of each node.

 3. This line is in charge of initializing the states of newly added variables
    to 0.  We can identify the new variables because they have a colon in their
    definition.  Note that here we only do replacements on the left part of the
    pattern space, that&#39;s why we need to reach the pipe at each replacement.

 4. Here we add support for redefining nodes, if the same name is defined twice
    in the same section we will take the value of second definition and place
    it in the first one while deleting the second definition.  We do it this way
    to maintain the order of the definitions, since it&#39;s way easier to read the
    output if the order of the variables doesn&#39;t change.

    Exercise 1: look at the regexp and notice that it begins with \(.*\),
    obviously corresponding to \1, yet the only place where we use \1 is at
    the beginning of the replacement string.  Try to explain why we added
    this seemingly useless group.  The answer is at the end of the blog post.

 5. This short line requires a bit more explanation, here we are duplicating
    the second section into a new third section.  We will see why we do this
    in the next line once we start using it.

 6. Now we replace each and every one of the referenced variables in the
    third section by the values on the state&#39;s first section, after this is
    complete we expect to have the third section as just a bunch of formulas
    with zeros and ones like this:

      &lt;d:1&gt;&lt;e:0&gt;&lt;g1:!(1*1)&gt;&lt;g2:!(1*0)&gt;&lt;g3:!(0*!1)&gt;&lt;q:!(0*1*1)&gt;

 7. So, we save everything in the hold space and leave only this third section
    in the pattern space.

 8. Because from this point we will be evaluating these expressions ensuring
    the precedence order of the operators.  After each successful replacement
    we will go back to this label.

 9. With the highest priority we have the NOT operator !0 is 1 and !1 is 0,
    and the parenthesis that contain just a value (1) and (0)... pretty
    straightforward replacements.

10. Then it comes the ANDs: 1*1 first so that we can have a simple [01]\*[01]
    for the rest of the AND cases.

11. Similar for OR: 0+0 -&gt; 0 first, then [01]+[01] -&gt; 1.

12. Calculated expressions should end up being :0&gt; or :1&gt;, otherwise it&#39;s
    either a syntax error (or we forgot to define a variable).

13. Let&#39;s save the newly calculated state by changing colons to equal sign,
    swapping the spaces, removing the old third section, appending a newline
    and the new state.  Then it comes s/.*\(|.*\)|.\(.*\)/\2\1/ which results
    in the new state, a pipe and the definitions.  Note that the period after
    the second pipe is the one matching the newline.

    We save that line and prepend a few dashes to display the output and get
    ready to process the next line.

<img alt="image" width="640" height="48" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUAAAAAYBAMAAAB5FDm3AAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAAv0lEQVRIie2TbQ6DMAiGvSTpSQjXHyAfddPsB93mEl6b2AKVR1o2uLm2XwO8UwNW1YBVNWBV/wE4iNANMh/8wD6I1/LOGFlrDPv2SNBYsUmMxg98yVQB5KxhUBhNLyAjIDxlAqVPYm2j7hXPWsDpe1IxrwLPE5DsJwzm4LOKJ2CeyBrApwoGIGIeMU4ROvB7gJEA8ojznsEFIMzVPQLi6gr6HYJsEktODnDaJGaPpvpck9xXDVhVA1bVgFU1YFUPgIIWDvrQXuEAAAAASUVORK5CYII="/>

In this example we will be doing an Earle latch:

  <a href="https://en.wikipedia.org/wiki/Flip-flop_(electronics)#Earle_latch">https://en.wikipedia.org/wiki/Flip-flop_(electronics)#Earle_latch</a>

We then define the circuit as two inputs, d: data, e: write enable, and four
NAND gates: g1, g2, g3 and q:

  &lt;d:0&gt;&lt;e:0&gt; &lt;g1:!(d*e)&gt;&lt;g2:!(d*q)&gt;&lt;g3:!(q*!e)&gt;&lt;q:!(g1*g2*g3)&gt; 

This flip flop has the nice characteristic that the input to output propagation
is constant given that the clock &#34;e&#34; (write enable) and its opposite &#34;!e&#34; are
synchronized.  Since the &#34;e&#34; negation is done directly in the gate g3, we don&#39;t
have to worry about synchronization.

The multiple panels here, show the state of the circuit after each step of
propagation delay.  Even though the gates seems to be returning the incorrect
value we should remember that gates here take one step each to update their
value: they are computed based on the state of the circuit at the previous
step.

Note that with the inputs initialized at 0, this results in the final output
q oscillating between 0 and 1.

<img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA00lEQVQ4jYWUOxbEIAhFs3w627FyiymxYvyACqh5FTk3CHlCHrrpfYhy6jEUhTOuCB2O8YZzyik2BXnH4hrlTnT1ebhgANNa18jGHebaqLsbOGX6xhjOmE0buDyumCUYAwaTDe3wHlg8WuPAHG4xqWzxHEHMXzFNz6f5HstM1ABu2bhmo3gyA4Vd5x53z6f5Kx6eT/NXbDw3GJzu2eRqw3Ec8D5MX1guao/pMOcxKmy2hHcslavo2aRx2bG2oD8wH83ZHOIWc20iuSiDh/yvReGN3j9rhy85JF+NWgAAAABJRU5ErkJggg=="/> <img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA1ElEQVQ4jZ2UvRLEIAiE8/h0tmflK6bUivMHEBG9mdtqM18QXE0evOl9EEsaHqrCGTeUNxzjDZdUUuwK/I7FzZVB1u5zccYAZrQhqc4ept55nU5wKvgb53DGFJrgOrPGJMZtx6Ya+uLDWCyjkTGLW4xLNWeegcPXGGfm3fSod8x3oh/irbossXDm07iZK+NlroyXuTLoZK6NHm3TvRq33hDOeO7nD8wn5mMdtcZtAwqPR8H0jaV6DUY1rrheqR7CB9D9gMlmF6M0o4MyWLT/Whbs6P0CG+gykD7/KJEAAAAASUVORK5CYII="/> <img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA00lEQVQ4jYWUOxbEIAhFs3w627FyiymxYvyACqh5FTk3CHlCHrrpfYhy6jEUhTOuCB2O8YZzyik2BXnH4hrlTnT1ebhgANNa18jGHebaqLsbOGX6xhjOmE0buDyumCUYAwaTDe3wHlg8WuPAHG4xqWzxHEHMXzFNz6f5HstM1ABu2bhmo3gyA4Vd5x53z6f5Kx6eT/NXbDw3GJzu2eRqw3Ec8D5MX1guao/pMOcxKmy2hHcslavo2aRx2bG2oD8wH83ZHOIWc20iuSiDh/yvReGN3j9rhy85JF+NWgAAAABJRU5ErkJggg=="/> <img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA1ElEQVQ4jZ2UvRLEIAiE8/h0tmflK6bUivMHEBG9mdtqM18QXE0evOl9EEsaHqrCGTeUNxzjDZdUUuwK/I7FzZVB1u5zccYAZrQhqc4ept55nU5wKvgb53DGFJrgOrPGJMZtx6Ya+uLDWCyjkTGLW4xLNWeegcPXGGfm3fSod8x3oh/irbossXDm07iZK+NlroyXuTLoZK6NHm3TvRq33hDOeO7nD8wn5mMdtcZtAwqPR8H0jaV6DUY1rrheqR7CB9D9gMlmF6M0o4MyWLT/Whbs6P0CG+gykD7/KJEAAAAASUVORK5CYII="/>

We reset the latch by setting the write enable input to 1 for a couple of steps.

  &lt;e:1&gt;

<img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA1ElEQVQ4jYWUMRbEIAhEc3y2srbKFVNCxUYRRVAzFe/9DOLI7sUnPRcz3VLDq7THBWHAOZ8w3XTnqqTfeFwqEjKfPporBnCjibobV7hdCufpOk7E3xjTHo/+el6yuEkxJkzODbW5FB730VrhmnvMk1szR9DwLeaR+Qg/Yt2JUsDJjdaNPXMTvsFh8ogl8xG+xT3zEb7FLnOHIejs5nA2bNcBz8v0hfWh1pg3ey4/C/NiEy4rVTFlcfOM39vUEH7ZXbq5W0lLzP2w9lAOd8W/lgkv9PwBzyssnXvUuywAAAAASUVORK5CYII="/> <img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA1ElEQVQ4jaWUvRbDIAiF8/h0cmbKK2aUiaqABvzp0DtxzhcQLrQXn/RczHRLDEVpjyvKE0Y8YbrpxqZk30RcIxLiXx/FDQOE1kQ9O6+wDpV9dx0n4t84pz0e9UWl5zdWGa4Th2xoxSWIuLemQSgeMbts8zyDmf/GPDxvQbN6xnYTbYmnbHK2oLVm5tDG8y0WzzWgjecaBBw8DxgnnbN5ehsO5/DXrfWNLTFv7lx+Fq+NOZxTNbAwQslmj8s0dST4YBhaszWkJeb+mC4q4K75r8XhhZ4v7PMvY6cRBRgAAAAASUVORK5CYII="/>

  &lt;e:0&gt;

<img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA1ElEQVQ4jaWUuxYDIQhE9/PpbGPlL24pFVEEdsFHikw159xFcSC56KT7IsIyPDSlPe6oTjjnE8aCJbOSfhNxdziIv/05XDFAaG3IqusKy93Vd2e4IP3GNe2xhGa49fzGIsX9xaEa+PBhIrbWxITDIyZXrZlX0PDfmJ7M2XDUM9ad4CGeqtHFYplrOLjJfItH5mJwk7mYgEPmAedJ52qa7obDOvy1azaxJabNnvcHuIk5LL+x0kYxqsnjtlIcwgfCo6VabF1iuZub5kEFbJr/Whxe6P4CiU8x/5oH0rcAAAAASUVORK5CYII="/> <img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA1ElEQVQ4jaWUuxYDIQhE9/PpbGPlL24pFVEEdsFHikw159xFcSC56KT7IsIyPDSlPe6oTjjnE8aCJbOSfhNxdziIv/05XDFAaG3IqusKy93Vd2e4IP3GNe2xhGa49fzGIsX9xaEa+PBhIrbWxITDIyZXrZlX0PDfmJ7M2XDUM9ad4CGeqtHFYplrOLjJfItH5mJwk7mYgEPmAedJ52qa7obDOvy1azaxJabNnvcHuIk5LL+x0kYxqsnjtlIcwgfCo6VabF1iuZub5kEFbJr/Whxe6P4CiU8x/5oH0rcAAAAASUVORK5CYII="/> <img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA1ElEQVQ4jaWUuxYDIQhE9/PpbGPlL24pFVEEdsFHikw159xFcSC56KT7IsIyPDSlPe6oTjjnE8aCJbOSfhNxdziIv/05XDFAaG3IqusKy93Vd2e4IP3GNe2xhGa49fzGIsX9xaEa+PBhIrbWxITDIyZXrZlX0PDfmJ7M2XDUM9ad4CGeqtHFYplrOLjJfItH5mJwk7mYgEPmAedJ52qa7obDOvy1azaxJabNnvcHuIk5LL+x0kYxqsnjtlIcwgfCo6VabF1iuZub5kEFbJr/Whxe6P4CiU8x/5oH0rcAAAAASUVORK5CYII="/> <img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA1ElEQVQ4jaWUuxYDIQhE9/PpbGPlL24pFVEEdsFHikw159xFcSC56KT7IsIyPDSlPe6oTjjnE8aCJbOSfhNxdziIv/05XDFAaG3IqusKy93Vd2e4IP3GNe2xhGa49fzGIsX9xaEa+PBhIrbWxITDIyZXrZlX0PDfmJ7M2XDUM9ad4CGeqtHFYplrOLjJfItH5mJwk7mYgEPmAedJ52qa7obDOvy1azaxJabNnvcHuIk5LL+x0kYxqsnjtlIcwgfCo6VabF1iuZub5kEFbJr/Whxe6P4CiU8x/5oH0rcAAAAASUVORK5CYII="/>

Now we will change the latch value by setting d now to 1, together with the
write Enable input for a couple of steps.

  &lt;d:1&gt;&lt;e:1&gt;

<img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA2ElEQVQ4jYWUOxLFIAhFs3xfRU3lFlNixUsEUfATmjBz5sIVJRef4r6YCSRPT8Aevx+asEmWmIAgJSsMC8xVVz++ey/ecErBmoSpaYW1N3l3hoH4G78ud7jXl0DMIzaPEiWXHNSpFpckYrOmSSgeMTt1m7klDnOfeU0wu4OxzVzU+MZJXUZ1wWatDcfjyfmMZeaaBGwz1yTgMPOAcYqzmqfeafscyvkxfWFsN7bEvHnnshbDjTmsO/a8LRQ1e/ycpi7oD8OhVa1pWWK2ZtB/FJNzti3c4UXcf5WZLhfi7/lXAAAAAElFTkSuQmCC"/> <img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA20lEQVQ4jZ2UuxLEIAhF8/lsRU3lL6bUivUBBBWzM0sjmTMXyCXm4re4L+aMI4caeMbtyBs2SYgzZgSwwhhg7rp+UIqLKyZaRhth6hJh6V1HCzFm/o3blCcs9Q0TJY8lFJdU0qKGXnwkK7bRJFmKr5gntXpeSM33WLYBmnTzd6yroxZv6uLVo2WdKDvzHdaBvfkLbp578z22nT7meyzhzfejbfGu5q034Bnbi/2DdVExNs8XDDDh8WhY7lj7DIaaZ1zfpl/QD3F4gSUtIWZrhs+PYpuc7RaecBD3F7BOLqeLssQeAAAAAElFTkSuQmCC"/>

  &lt;e:0&gt;

<img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA1UlEQVQ4jZ2UuxLEIAhF8/l0tkvlL6bEio2KiIjZmaXxZk4u4THm4re4L2ZKXcMT6YzrQRtWS4gpUQLQxCnA3HztwBwnHxjRldZD3SXCj0tKC3Em/o1rlScsvSl+Hi2WGLh27NzQknfhsZYmwiX3mBf3mHnBMXyLZRv1JRW847G6tsQ3Ny1jAaloinDmRkQzNyKauREczNwKW9oW727evg3pjGc/f+CxsRjbUVvcr0WeG1twySU3TNDdvGLEjDU+4JoWt0gKMeuVTPNHsVXeq3J0wUHcXy7iLn0mXXuBAAAAAElFTkSuQmCC"/> <img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA2UlEQVQ4jZ2UuxLEIAhF8/l0tEvlL6aEivUF8YHZmaUR5wheL5Nc+hb3pcrYcsiBZ1wW3rCXhJiREcAbY4C11tVlvv1pbhhgkdbCqznCRNSlhTix/sZF5Qn3tznO2xG7xr7mFy/VUJu3ZMUurSdL8xXrVG2eezLhPg2ypB7acbev6oO3ap5sMU9kMD9QLnrExXMZzA88l8H8wHMZzB+lbfFerdvdgGfsD/sH26Bi7J4vmGjCbetYkqSKGVq1zpgolSHTBzT4gMWOc4jVL8PnR7EpV7VBnXAQ9xfyoi8EinA3QwAAAABJRU5ErkJggg=="/> <img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA2UlEQVQ4jZ2UuxLEIAhF8/l0tEvlL6aEivUF8YHZmaUR5wheL5Nc+hb3pcrYcsiBZ1wW3rCXhJiREcAbY4C11tVlvv1pbhhgkdbCqznCRNSlhTix/sZF5Qn3tznO2xG7xr7mFy/VUJu3ZMUurSdL8xXrVG2eezLhPg2ypB7acbev6oO3ap5sMU9kMD9QLnrExXMZzA88l8H8wHMZzB+lbfFerdvdgGfsD/sH26Bi7J4vmGjCbetYkqSKGVq1zpgolSHTBzT4gMWOc4jVL8PnR7EpV7VBnXAQ9xfyoi8EinA3QwAAAABJRU5ErkJggg=="/> <img alt="image" width="118" height="78" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAnBAMAAABDHy1gAAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAA2UlEQVQ4jZ2UuxLEIAhF8/l0tEvlL6aEivUF8YHZmaUR5wheL5Nc+hb3pcrYcsiBZ1wW3rCXhJiREcAbY4C11tVlvv1pbhhgkdbCqznCRNSlhTix/sZF5Qn3tznO2xG7xr7mFy/VUJu3ZMUurSdL8xXrVG2eezLhPg2ypB7acbev6oO3ap5sMU9kMD9QLnrExXMZzA88l8H8wHMZzB+lbfFerdvdgGfsD/sH26Bi7J4vmGjCbetYkqSKGVq1zpgolSHTBzT4gMWOc4jVL8PnR7EpV7VBnXAQ9xfyoi8EinA3QwAAAABJRU5ErkJggg=="/>

<img alt="image" width="640" height="48" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUAAAAAYBAMAAAB5FDm3AAAAMFBMVEX//////wD/ZgDdAAD/AJkiAJkxcIwsmOEAqgAAZgBmMwCZZjO7u7uIiIhEREQAAAC9QGvpAAAAbklEQVRIie3TQQrAIAxEUS8ZcpKQ67dpSUNXXczCKcwX0eUj4jLy1m7AVwKiCYgmINpPgB7mmb3Da2U89/3AgkWv05t15g1nAA6uJjdTLGDhOYD9xGGEwAtkNjsZn9he0+P6JMQJiCYgmoBoAqIdMm4HjumHIZoAAAAASUVORK5CYII="/>

Answer to exercise 1:

In language theory we usually define grammars as just the set of strings
matched by them without considering *how* or *what part* of the string is
matched, as that doesn&#39;t affect whether it matches or not.

When replacing this DOES matter, so this is how regexps are matched in sed:
 * The first lexical element of a regex tries to match the earliest possible
   occurrence.  IE: s/x/&lt;X&gt;/ changes axbxc to a&lt;x&gt;bxc
 * The first lexical element of a regex tries to find the longest possible
   match.  IE: s/foox*/!/ changes aafooxxxxaa to aa!aa
   Note that the first rule will have priority: this is why the replacement
   s/o*/!/ changes foo to !foo (/o*/ matches at the beginning with 0 o&#39;s)
 * In case of the alternative operator «\|» sed tries to match the earliest
   longest matching, no matter if it is the first or second operand matching.
   IE: s/f\|fo/!/ changes fox to !x
 * In case of multiple lexical elements the first will receive priority on
   these rules: s/\([ab]*\)\([bc]*\)/&lt;\1&gt;&lt;\2&gt;/ replaces abc with &lt;ab&gt;&lt;c&gt;

That&#39;s it.

Then why does the \(.*\) at the start matters? because by adding that, we place
a different first lexical element which tries to match as much text as
possible, making the rest of the replacement match the latest possible part
of the regex.

Take for instance the following replacement:
  s/\(&lt;[a-z]*&gt;\)\(.*\)\(&lt;[a-z]*&gt;\)/L:\1\2R:\3/

If the input is &lt;a&gt; &lt;b&gt; &lt;c&gt;, the resulting output would be L:&lt;a&gt; &lt;b&gt; R:&lt;c&gt;.

Doing something like this be ok in many cases but not in the line 4 of the
code, because what we wanted to do there was to retain the last definition.
&lt;a:d1&gt;...&lt;a:d2&gt;...&lt;a:d3&gt; would first change to &lt;a:d3&gt;...&lt;a:d2&gt;... and then to
&lt;a:d2&gt;......, leaving the middle one.  We can either match the first two or
the last two, it would be ok either way, and as we have just seen it&#39;s very
easy to match the last two by adding a \(.*\) group at the beginning.

As an extra exercise try to rewrite the regex in line 4 of the code to match
the *first* two definitions instead.  Good luck!.  If you manage to do it,
please write a comment with the response.  Hint: I&#39;m sorry to inform you that
GNU sed does not support non-greedy matches: «.*?»

</pre></div></div>
  </body>
</html>
