<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/mavdol/capsule">Original</a>
    <h1>Show HN: Sandboxing untrusted code using WebAssembly</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<hr/>

<p dir="auto"><code>Capsule</code> is a runtime for coordinating AI agent tasks in isolated environments. It is designed to handle, long-running workflows, large-scale processing, autonomous decision-making securely, or even multi-agent systems.</p>
<p dir="auto">Each task runs inside its own WebAssembly sandbox, providing:</p>
<ul dir="auto">
<li><strong>Isolated execution</strong>: Each task runs isolated from your host system</li>
<li><strong>Resource limits</strong>: Set CPU, memory, and timeout limits per task</li>
<li><strong>Automatic retries</strong>: Handle failures without manual intervention</li>
<li><strong>Lifecycle tracking</strong>: Monitor which tasks are running, completed, or failed</li>
</ul>
<p dir="auto">This enables safe task-level execution of untrusted code within AI agent systems.</p>


<p dir="auto">Simply annotate your Python functions with the <code>@task</code> decorator:</p>
<div dir="auto" data-snippet-clipboard-copy-content="from capsule import task

@task(name=&#34;analyze_data&#34;, compute=&#34;MEDIUM&#34;, ram=&#34;512MB&#34;, timeout=&#34;30s&#34;, max_retries=1)
def analyze_data(dataset: list) -&gt; dict:
    &#34;&#34;&#34;Process data in an isolated, resource-controlled environment.&#34;&#34;&#34;
    # Your code runs safely in a Wasm sandbox
    return {&#34;processed&#34;: len(dataset), &#34;status&#34;: &#34;complete&#34;}"><pre><span>from</span> <span>capsule</span> <span>import</span> <span>task</span>

<span>@<span>task</span>(<span>name</span><span>=</span><span>&#34;analyze_data&#34;</span>, <span>compute</span><span>=</span><span>&#34;MEDIUM&#34;</span>, <span>ram</span><span>=</span><span>&#34;512MB&#34;</span>, <span>timeout</span><span>=</span><span>&#34;30s&#34;</span>, <span>max_retries</span><span>=</span><span>1</span>)</span>
<span>def</span> <span>analyze_data</span>(<span>dataset</span>: <span>list</span>) <span>-&gt;</span> <span>dict</span>:
    <span>&#34;&#34;&#34;Process data in an isolated, resource-controlled environment.&#34;&#34;&#34;</span>
    <span># Your code runs safely in a Wasm sandbox</span>
    <span>return</span> {<span>&#34;processed&#34;</span>: <span>len</span>(<span>dataset</span>), <span>&#34;status&#34;</span>: <span>&#34;complete&#34;</span>}</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">With TypeScript / JavaScript</h3><a id="user-content-with-typescript--javascript" aria-label="Permalink: With TypeScript / JavaScript" href="#with-typescript--javascript"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For TypeScript and JavaScript, use the <code>task()</code> wrapper function with full access to the npm ecosystem:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { task } from &#34;@capsule-run/sdk&#34;;

export const analyzeData = task({
  name: &#34;analyze_data&#34;,
  compute: &#34;MEDIUM&#34;,
  ram: &#34;512MB&#34;,
  timeout: &#34;30s&#34;,
  maxRetries: 1
}, (dataset: number[]): object =&gt; {
  // Your code runs safely in a Wasm sandbox
  return { processed: dataset.length, status: &#34;complete&#34; };
});

// The &#34;main&#34; task is required as the entrypoint
export const main = task({
    name: &#34;main&#34;,
    compute: &#34;HIGH&#34;
}, () =&gt; {
  return analyzeData([1, 2, 3, 4, 5]);
});
"><pre><span>import</span> <span>{</span> <span>task</span> <span>}</span> <span>from</span> <span>&#34;@capsule-run/sdk&#34;</span><span>;</span>

<span>export</span> <span>const</span> <span>analyzeData</span> <span>=</span> <span>task</span><span>(</span><span>{</span>
  <span>name</span>: <span>&#34;analyze_data&#34;</span><span>,</span>
  <span>compute</span>: <span>&#34;MEDIUM&#34;</span><span>,</span>
  <span>ram</span>: <span>&#34;512MB&#34;</span><span>,</span>
  <span>timeout</span>: <span>&#34;30s&#34;</span><span>,</span>
  <span>maxRetries</span>: <span>1</span>
<span>}</span><span>,</span> <span>(</span><span>dataset</span>: <span>number</span><span>[</span><span>]</span><span>)</span>: <span>object</span> <span>=&gt;</span> <span>{</span>
  <span>// Your code runs safely in a Wasm sandbox</span>
  <span>return</span> <span>{</span> <span>processed</span>: <span>dataset</span><span>.</span><span>length</span><span>,</span> <span>status</span>: <span>&#34;complete&#34;</span> <span>}</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

<span>// The &#34;main&#34; task is required as the entrypoint</span>
<span>export</span> <span>const</span> <span>main</span> <span>=</span> <span>task</span><span>(</span><span>{</span>
    <span>name</span>: <span>&#34;main&#34;</span><span>,</span>
    <span>compute</span>: <span>&#34;HIGH&#34;</span>
<span>}</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span>analyzeData</span><span>(</span><span>[</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>]</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></pre></div>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p dir="auto">The runtime requires a task named <code>&#34;main&#34;</code> as the entry point. Python can define the main task itself, but it&#39;s recommended to set it manually.</p>
</div>
<p dir="auto">When you run <code>capsule run main.py</code> (or <code>main.ts</code>), your code is compiled into a WebAssembly module and executed in a dedicated sandbox to isolate tasks.</p>
<p dir="auto">Each task operates within its own sandbox with configurable resource limits, ensuring that failures are contained and don&#39;t cascade to other parts of your workflow. The host system controls every aspect of execution, from CPU allocation via Wasm fuel metering to memory constraints and timeout enforcement.</p>

<p dir="auto">Every task returns a structured JSON envelope containing both the result and execution metadata:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;success&#34;: true,
  &#34;result&#34;: &#34;Hello from Capsule!&#34;,
  &#34;error&#34;: null,
  &#34;execution&#34;: {
    &#34;task_name&#34;: &#34;data_processor&#34;,
    &#34;duration_ms&#34;: 1523,
    &#34;retries&#34;: 0,
    &#34;fuel_consumed&#34;: 45000
  }
}"><pre>{
  <span>&#34;success&#34;</span>: <span>true</span>,
  <span>&#34;result&#34;</span>: <span><span>&#34;</span>Hello from Capsule!<span>&#34;</span></span>,
  <span>&#34;error&#34;</span>: <span>null</span>,
  <span>&#34;execution&#34;</span>: {
    <span>&#34;task_name&#34;</span>: <span><span>&#34;</span>data_processor<span>&#34;</span></span>,
    <span>&#34;duration_ms&#34;</span>: <span>1523</span>,
    <span>&#34;retries&#34;</span>: <span>0</span>,
    <span>&#34;fuel_consumed&#34;</span>: <span>45000</span>
  }
}</pre></div>
<p dir="auto"><strong>Response fields:</strong></p>
<ul dir="auto">
<li><code>success</code> — Boolean indicating whether the task completed successfully</li>
<li><code>result</code> — The actual return value from your task (json, string, null on failure etc..)</li>
<li><code>error</code> — Error details if the task failed (<code>{ error_type: string, message: string }</code>)</li>
<li><code>execution</code> — Performance metrics:
<ul dir="auto">
<li><code>task_name</code> — Name of the executed task</li>
<li><code>duration_ms</code> — Execution time in milliseconds</li>
<li><code>retries</code> — Number of retry attempts that occurred</li>
<li><code>fuel_consumed</code> — CPU resources used (see <a href="#compute-levels">Compute Levels</a>)</li>
</ul>
</li>
</ul>



<p dir="auto">Create <code>hello.py</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="from capsule import task

@task(name=&#34;main&#34;, compute=&#34;LOW&#34;, ram=&#34;64MB&#34;)
def main() -&gt; str:
    return &#34;Hello from Capsule!&#34;"><pre><span>from</span> <span>capsule</span> <span>import</span> <span>task</span>

<span>@<span>task</span>(<span>name</span><span>=</span><span>&#34;main&#34;</span>, <span>compute</span><span>=</span><span>&#34;LOW&#34;</span>, <span>ram</span><span>=</span><span>&#34;64MB&#34;</span>)</span>
<span>def</span> <span>main</span>() <span>-&gt;</span> <span>str</span>:
    <span>return</span> <span>&#34;Hello from Capsule!&#34;</span></pre></div>
<p dir="auto">Run it:</p>


<div dir="auto" data-snippet-clipboard-copy-content="npm install -g @capsule-run/cli
npm install @capsule-run/sdk"><pre>npm install -g @capsule-run/cli
npm install @capsule-run/sdk</pre></div>
<p dir="auto">Create <code>hello.ts</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { task } from &#34;@capsule-run/sdk&#34;;

export const main = task({
  name: &#34;main&#34;,
  compute: &#34;LOW&#34;,
  ram: &#34;64MB&#34;
}, (): string =&gt; {
  return &#34;Hello from Capsule!&#34;;
});"><pre><span>import</span> <span>{</span> <span>task</span> <span>}</span> <span>from</span> <span>&#34;@capsule-run/sdk&#34;</span><span>;</span>

<span>export</span> <span>const</span> <span>main</span> <span>=</span> <span>task</span><span>(</span><span>{</span>
  <span>name</span>: <span>&#34;main&#34;</span><span>,</span>
  <span>compute</span>: <span>&#34;LOW&#34;</span><span>,</span>
  <span>ram</span>: <span>&#34;64MB&#34;</span>
<span>}</span><span>,</span> <span>(</span><span>)</span>: <span>string</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span>&#34;Hello from Capsule!&#34;</span><span>;</span>
<span>}</span><span>)</span><span>;</span></pre></div>
<p dir="auto">Run it:</p>

<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p><p dir="auto">Use <code>--verbose</code> to display real-time task execution details.</p>
</div>

<div dir="auto"><h3 tabindex="-1" dir="auto">Task Configuration Options</h3><a id="user-content-task-configuration-options" aria-label="Permalink: Task Configuration Options" href="#task-configuration-options"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Configure your tasks with these parameters:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
<th>Default</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>Task identifier</td>
<td><code>str</code></td>
<td>function name (Python) / <em>required</em> (TS)</td>
<td><code>&#34;process_data&#34;</code></td>
</tr>
<tr>
<td><code>compute</code></td>
<td>CPU allocation level: <code>&#34;LOW&#34;</code>, <code>&#34;MEDIUM&#34;</code>, or <code>&#34;HIGH&#34;</code></td>
<td><code>str</code></td>
<td><code>&#34;MEDIUM&#34;</code></td>
<td><code>&#34;HIGH&#34;</code></td>
</tr>
<tr>
<td><code>ram</code></td>
<td>Memory limit for the task</td>
<td><code>str</code></td>
<td>unlimited</td>
<td><code>&#34;512MB&#34;</code>, <code>&#34;2GB&#34;</code></td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>Maximum execution time</td>
<td><code>str</code></td>
<td>unlimited</td>
<td><code>&#34;30s&#34;</code>, <code>&#34;5m&#34;</code>, <code>&#34;1h&#34;</code></td>
</tr>
<tr>
<td><code>max_retries</code> / <code>maxRetries</code></td>
<td>Number of retry attempts on failure</td>
<td><code>int</code></td>
<td><code>0</code></td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>allowed_files</code> / <code>allowedFiles</code></td>
<td>Folders accessible in the sandbox</td>
<td><code>list</code></td>
<td><code>[]</code></td>
<td><code>[&#34;./data&#34;, &#34;./output&#34;]</code></td>
</tr>
<tr>
<td><code>env_variables</code> / <code>envVariables</code></td>
<td>Environment variables accessible in the sandbox</td>
<td><code>list</code></td>
<td><code>[]</code></td>
<td><code>[&#34;API_KEY&#34;]</code></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<p dir="auto">Capsule controls CPU usage through WebAssembly&#39;s <strong>fuel mechanism</strong>, which meters instruction execution. The compute level determines how much fuel your task receives.</p>
<ul dir="auto">
<li><strong>LOW</strong> provides minimal allocation for lightweight tasks</li>
<li><strong>MEDIUM</strong> offers balanced resources for typical workloads</li>
<li><strong>HIGH</strong> grants maximum fuel for compute-intensive operations</li>
<li><strong>CUSTOM</strong> to specify an exact fuel value (e.g., <code>compute=&#34;1000000&#34;</code>) for precise control over execution limits.</li>
</ul>
<div dir="auto"><h3 tabindex="-1" dir="auto">Project Configuration (Optional)</h3><a id="user-content-project-configuration-optional" aria-label="Permalink: Project Configuration (Optional)" href="#project-configuration-optional"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can create a <code>capsule.toml</code> file in your project root to set default options for all tasks and define workflow metadata:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# capsule.toml

[workflow]
name = &#34;My AI Workflow&#34;
version = &#34;1.0.0&#34;
entrypoint = &#34;src/main.py&#34;  # Default file when running `capsule run`

[tasks]
default_compute = &#34;MEDIUM&#34;
default_ram = &#34;256MB&#34;
default_timeout = &#34;30s&#34;
default_max_retries = 2"><pre><span><span>#</span> capsule.toml</span>

[<span>workflow</span>]
<span>name</span> = <span><span>&#34;</span>My AI Workflow<span>&#34;</span></span>
<span>version</span> = <span><span>&#34;</span>1.0.0<span>&#34;</span></span>
<span>entrypoint</span> = <span><span>&#34;</span>src/main.py<span>&#34;</span></span>  <span><span>#</span> Default file when running `capsule run`</span>

[<span>tasks</span>]
<span>default_compute</span> = <span><span>&#34;</span>MEDIUM<span>&#34;</span></span>
<span>default_ram</span> = <span><span>&#34;</span>256MB<span>&#34;</span></span>
<span>default_timeout</span> = <span><span>&#34;</span>30s<span>&#34;</span></span>
<span>default_max_retries</span> = <span>2</span></pre></div>
<p dir="auto">With an entrypoint defined, you can simply run:</p>

<p dir="auto">Task-level options always override these defaults when specified.</p>


<p dir="auto">The standard Python <code>requests</code> library and socket-based networking aren&#39;t natively compatible with WebAssembly&#39;s sandboxed I/O model. Capsule provides its own HTTP client that works within the Wasm environment:</p>
<div dir="auto" data-snippet-clipboard-copy-content="from capsule import task
from capsule.http import get, post, put, delete

@task(name=&#34;http_example&#34;, compute=&#34;MEDIUM&#34;, timeout=&#34;30s&#34;)
def main() -&gt; dict:
    &#34;&#34;&#34;Example demonstrating HTTP client usage within a task.&#34;&#34;&#34;

    # GET request
    response = get(&#34;https://api.example.com/data&#34;)

    # POST with JSON body
    response = post(&#34;https://api.example.com/submit&#34;, json={&#34;key&#34;: &#34;value&#34;})

    # Response methods
    is_ok = response.ok()           # Returns True if status code is 2xx
    status = response.status_code    # Get the HTTP status code
    data = response.json()           # Parse response as JSON
    text = response.text()           # Get response as text

    return {&#34;status&#34;: status, &#34;success&#34;: is_ok}"><pre><span>from</span> <span>capsule</span> <span>import</span> <span>task</span>
<span>from</span> <span>capsule</span>.<span>http</span> <span>import</span> <span>get</span>, <span>post</span>, <span>put</span>, <span>delete</span>

<span>@<span>task</span>(<span>name</span><span>=</span><span>&#34;http_example&#34;</span>, <span>compute</span><span>=</span><span>&#34;MEDIUM&#34;</span>, <span>timeout</span><span>=</span><span>&#34;30s&#34;</span>)</span>
<span>def</span> <span>main</span>() <span>-&gt;</span> <span>dict</span>:
    <span>&#34;&#34;&#34;Example demonstrating HTTP client usage within a task.&#34;&#34;&#34;</span>

    <span># GET request</span>
    <span>response</span> <span>=</span> <span>get</span>(<span>&#34;https://api.example.com/data&#34;</span>)

    <span># POST with JSON body</span>
    <span>response</span> <span>=</span> <span>post</span>(<span>&#34;https://api.example.com/submit&#34;</span>, <span>json</span><span>=</span>{<span>&#34;key&#34;</span>: <span>&#34;value&#34;</span>})

    <span># Response methods</span>
    <span>is_ok</span> <span>=</span> <span>response</span>.<span>ok</span>()           <span># Returns True if status code is 2xx</span>
    <span>status</span> <span>=</span> <span>response</span>.<span>status_code</span>    <span># Get the HTTP status code</span>
    <span>data</span> <span>=</span> <span>response</span>.<span>json</span>()           <span># Parse response as JSON</span>
    <span>text</span> <span>=</span> <span>response</span>.<span>text</span>()           <span># Get response as text</span>

    <span>return</span> {<span>&#34;status&#34;</span>: <span>status</span>, <span>&#34;success&#34;</span>: <span>is_ok</span>}</pre></div>

<p dir="auto">Standard libraries like <code>fetch</code> are already compatible, so no custom HTTP client is needed for TypeScript/JavaScript.</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { task } from &#34;@capsule-run/sdk&#34;;

export const main = task({
    name: &#34;main&#34;,
    compute: &#34;MEDIUM&#34;
}, async () =&gt; {
    const response = await fetch(&#34;https://api.example.com/data&#34;);
    return response.json();
});"><pre><span>import</span> <span>{</span> <span>task</span> <span>}</span> <span>from</span> <span>&#34;@capsule-run/sdk&#34;</span><span>;</span>

<span>export</span> <span>const</span> <span>main</span> <span>=</span> <span>task</span><span>(</span><span>{</span>
    <span>name</span>: <span>&#34;main&#34;</span><span>,</span>
    <span>compute</span>: <span>&#34;MEDIUM&#34;</span>
<span>}</span><span>,</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>response</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;https://api.example.com/data&#34;</span><span>)</span><span>;</span>
    <span>return</span> <span>response</span><span>.</span><span>json</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></pre></div>

<p dir="auto">Tasks can read and write files within directories specified in <code>allowed_files</code>. Any attempt to access files outside these directories is not possible.</p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p dir="auto">Currently, <code>allowed_files</code> supports directory paths, not individual files.</p>
</div>

<p dir="auto">Python&#39;s standard file operations work normally. Use <code>open()</code>, <code>os</code>, <code>pathlib</code>, or any file manipulation library.</p>
<div dir="auto" data-snippet-clipboard-copy-content="from capsule import task

@task(name=&#34;restricted_writer&#34;, allowed_files=[&#34;./output&#34;])
def restricted_writer() -&gt; None:
    with open(&#34;./output/result.txt&#34;, &#34;w&#34;) as f:
        f.write(&#34;result&#34;)

@task(name=&#34;main&#34;)
def main() -&gt; str:
    restricted_writer()"><pre><span>from</span> <span>capsule</span> <span>import</span> <span>task</span>

<span>@<span>task</span>(<span>name</span><span>=</span><span>&#34;restricted_writer&#34;</span>, <span>allowed_files</span><span>=</span>[<span>&#34;./output&#34;</span>])</span>
<span>def</span> <span>restricted_writer</span>() <span>-&gt;</span> <span>None</span>:
    <span>with</span> <span>open</span>(<span>&#34;./output/result.txt&#34;</span>, <span>&#34;w&#34;</span>) <span>as</span> <span>f</span>:
        <span>f</span>.<span>write</span>(<span>&#34;result&#34;</span>)

<span>@<span>task</span>(<span>name</span><span>=</span><span>&#34;main&#34;</span>)</span>
<span>def</span> <span>main</span>() <span>-&gt;</span> <span>str</span>:
    <span>restricted_writer</span>()</pre></div>

<p dir="auto">Common Node.js built-ins are available. Use the standard <code>fs</code> module:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { task } from &#34;@capsule-run/sdk&#34;;
import fs from &#34;fs/promises&#34;;

export const restrictedWriter = task({
    name: &#34;restricted_writer&#34;,
    allowedFiles: [&#34;./output&#34;]
}, async () =&gt; {
    await fs.writeFile(&#34;./output/result.txt&#34;, &#34;result&#34;);
});

export const main = task({ name: &#34;main&#34;, allowedFiles: [&#34;./data&#34;] }, async () =&gt; {
    await restrictedWriter();
    return await fs.readFile(&#34;./data/input.txt&#34;, &#34;utf8&#34;);
});"><pre><span>import</span> <span>{</span> <span>task</span> <span>}</span> <span>from</span> <span>&#34;@capsule-run/sdk&#34;</span><span>;</span>
<span>import</span> <span>fs</span> <span>from</span> <span>&#34;fs/promises&#34;</span><span>;</span>

<span>export</span> <span>const</span> <span>restrictedWriter</span> <span>=</span> <span>task</span><span>(</span><span>{</span>
    <span>name</span>: <span>&#34;restricted_writer&#34;</span><span>,</span>
    <span>allowedFiles</span>: <span>[</span><span>&#34;./output&#34;</span><span>]</span>
<span>}</span><span>,</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>await</span> <span>fs</span><span>.</span><span>writeFile</span><span>(</span><span>&#34;./output/result.txt&#34;</span><span>,</span> <span>&#34;result&#34;</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

<span>export</span> <span>const</span> <span>main</span> <span>=</span> <span>task</span><span>(</span><span>{</span> <span>name</span>: <span>&#34;main&#34;</span><span>,</span> <span>allowedFiles</span>: <span>[</span><span>&#34;./data&#34;</span><span>]</span> <span>}</span><span>,</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>await</span> <span>restrictedWriter</span><span>(</span><span>)</span><span>;</span>
    <span>return</span> <span>await</span> <span>fs</span><span>.</span><span>readFile</span><span>(</span><span>&#34;./data/input.txt&#34;</span><span>,</span> <span>&#34;utf8&#34;</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></pre></div>

<p dir="auto">Tasks can access environment variables to read configuration, API keys, or other runtime settings.</p>

<p dir="auto">Use Python&#39;s standard <code>os.environ</code> to access environment variables:</p>
<div dir="auto" data-snippet-clipboard-copy-content="from capsule import task
import os

@task(name=&#34;main&#34;, env_variables=[&#34;API_KEY&#34;])
def main() -&gt; dict:
    api_key = os.environ.get(&#34;API_KEY&#34;)
    return {&#34;api_key&#34;: api_key}"><pre><span>from</span> <span>capsule</span> <span>import</span> <span>task</span>
<span>import</span> <span>os</span>

<span>@<span>task</span>(<span>name</span><span>=</span><span>&#34;main&#34;</span>, <span>env_variables</span><span>=</span>[<span>&#34;API_KEY&#34;</span>])</span>
<span>def</span> <span>main</span>() <span>-&gt;</span> <span>dict</span>:
    <span>api_key</span> <span>=</span> <span>os</span>.<span>environ</span>.<span>get</span>(<span>&#34;API_KEY&#34;</span>)
    <span>return</span> {<span>&#34;api_key&#34;</span>: <span>api_key</span>}</pre></div>

<p dir="auto">Use the standard <code>process.env</code> to access environment variables:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { task } from &#34;@capsule-run/sdk&#34;;

export const main = task({
    name: &#34;main&#34;,
    envVariables: [&#34;API_KEY&#34;]
}, () =&gt; {
    const apiKey = process.env.API_KEY;
    return { apiKeySet: apiKey !== undefined };
});"><pre><span>import</span> <span>{</span> <span>task</span> <span>}</span> <span>from</span> <span>&#34;@capsule-run/sdk&#34;</span><span>;</span>

<span>export</span> <span>const</span> <span>main</span> <span>=</span> <span>task</span><span>(</span><span>{</span>
    <span>name</span>: <span>&#34;main&#34;</span><span>,</span>
    <span>envVariables</span>: <span>[</span><span>&#34;API_KEY&#34;</span><span>]</span>
<span>}</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>apiKey</span> <span>=</span> <span>process</span><span>.</span><span>env</span><span>.</span><span>API_KEY</span><span>;</span>
    <span>return</span> <span>{</span> <span>apiKeySet</span>: <span>apiKey</span> <span>!==</span> <span>undefined</span> <span>}</span><span>;</span>
<span>}</span><span>)</span><span>;</span></pre></div>

<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p dir="auto">TypeScript/JavaScript has broader compatibility than Python since it doesn&#39;t rely on native bindings.</p>
</div>
<p dir="auto"><strong>Python:</strong> Pure Python packages and standard library modules work. Packages with C extensions (<code>numpy</code>, <code>pandas</code>) are not yet supported.</p>
<p dir="auto"><strong>TypeScript/JavaScript:</strong> npm packages and ES modules work. Common Node.js built-ins are available. If you have any trouble with a built-in do not hesitate to open an issue.</p>

<p dir="auto">Contributions are welcome!</p>

<p dir="auto"><strong>Prerequisites:</strong> Rust (latest stable), Python 3.13+, Node.js 22+</p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/mavdol/capsule.git
cd capsule

# Build and install CLI
cargo install --path crates/capsule-cli

# Python SDK (editable install)
pip install -e crates/capsule-sdk/python

# TypeScript SDK (link for local dev)
cd crates/capsule-sdk/javascript
npm install &amp;&amp; npm run build &amp;&amp; npm link

# Then in your project: npm link @capsule-run/sdk"><pre>git clone https://github.com/mavdol/capsule.git
<span>cd</span> capsule

<span><span>#</span> Build and install CLI</span>
cargo install --path crates/capsule-cli

<span><span>#</span> Python SDK (editable install)</span>
pip install -e crates/capsule-sdk/python

<span><span>#</span> TypeScript SDK (link for local dev)</span>
<span>cd</span> crates/capsule-sdk/javascript
npm install <span>&amp;&amp;</span> npm run build <span>&amp;&amp;</span> npm link

<span><span>#</span> Then in your project: npm link @capsule-run/sdk</span></pre></div>

<ol dir="auto">
<li><strong>Fork</strong> the repository</li>
<li><strong>Create</strong> a feature branch: <code>git checkout -b feature/amazing-feature</code></li>
<li><strong>Run tests</strong>: <code>cargo test</code></li>
<li><strong>Open</strong> a Pull Request</li>
</ol>
<p dir="auto">Need help? <a href="https://github.com/mavdol/capsule/issues">Open an issue</a></p>

<p dir="auto">Capsule builds on these open source projects:</p>
<ul dir="auto">
<li><a href="https://github.com/bytecodealliance/componentize-py">componentize-py</a> – Python to WebAssembly Component compilation</li>
<li><a href="https://github.com/bytecodealliance/jco">jco</a> – JavaScript toolchain for WebAssembly Components</li>
<li><a href="https://github.com/bytecodealliance/wasmtime">wasmtime</a> – WebAssembly runtime</li>
<li><a href="https://github.com/WebAssembly/WASI">WASI</a> – WebAssembly System Interface</li>
</ul>

<p dir="auto">This project is licensed under the <strong>Apache License 2.0</strong> - see the <a href="https://github.com/mavdol/capsule/blob/main/LICENSE">LICENSE</a> file for details.</p>
</article></div></div>
  </body>
</html>
