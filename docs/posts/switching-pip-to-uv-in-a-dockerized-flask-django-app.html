<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nickjanetakis.com/blog/switching-pip-to-uv-in-a-dockerized-flask-or-django-app">Original</a>
    <h1>Switching Pip to Uv in a Dockerized Flask / Django App</h1>
    
    <div id="readability-page-1" class="page"><div><div class="page"><article><p>Updated on
June 17, 2025
in
<a href="https://nickjanetakis.com/blog/tag/docker-tips-tricks-and-tutorials">#docker</a>, <a href="https://nickjanetakis.com/blog/tag/flask-tips-tricks-and-tutorials">#flask</a></p><p><img src="https://nickjanetakis.com/assets/blog/cards/switching-pip-to-uv-in-a-dockerized-flask-or-django-app-364f0f76218db4be0e0b0daa935ad8e6e156b3320409b94f49a0b120dec45a77.jpg" height="422" width="750" alt="switching-pip-to-uv-in-a-dockerized-flask-or-django-app.jpg"/></p><h2>I noticed about a 10x speed up across a number of projects, we&#39;ll avoid using
a venv and run things as a non-root user too.</h2><p><strong>Prefer video? Here is it <a href="#demo-video">on YouTube</a>.</strong></p><p>I was surprised at how painless it was to switch things over. You can see the
git diffs to make the change for both of my example
<a href="https://github.com/nickjj/docker-flask-example/commit/8972f04c7724ad1ea5bfec6d18b2ca111575ab28" target="_blank">Flask</a>
and
<a href="https://github.com/nickjj/docker-django-example/commit/74520f64e52979d0d9abd67aa96f4d616097c110" target="_blank">Django</a>
projects. In this post we’ll go into more detail about these changes and how to
use a few <code>uv</code> commands.</p><h3 id="pyprojecttoml-vs-requirementstxt"><a href="#pyprojecttoml-vs-requirementstxt">#</a>
pyproject.toml vs requirements.txt</h3><p>Let’s start with defining our project’s dependencies.</p><p>You can create a <code>pyproject.toml</code> file and delete your <code>requirements.txt</code> after
you’ve entered your project’s dependencies and their versions into
<code>pyproject.toml</code>.</p><p>You only need to add your top level dependencies, uv will make a lock file for
you automatically which is somewhat comparable to what <code>pip freeze</code> would
produce except uv’s lock file has proper dependency trees and is way better.</p><p>Here’s a very small diff that shows an example of what to do, adjust it as
needed:</p><div><pre tabindex="0"><code data-lang="diff"><span><span># pyproject.toml
</span></span><span><span>
</span></span><span><span><span>+[project]
</span></span></span><span><span><span>+dependencies = [
</span></span></span><span><span><span>+  &#34;redis==5.2.1&#34;,
</span></span></span><span><span><span>+]
</span></span></span><span><span><span></span>
</span></span><span><span># requirements.txt
</span></span><span><span><span>-redis==5.2.1
</span></span></span></code></pre></div><h3 id="dockerfile"><a href="#dockerfile">#</a>
Dockerfile</h3><p>It’s important that these steps happen in order. For example you’ll want the
environment variables defined before you install your dependencies.</p><h4>Install uv</h4><div><pre tabindex="0"><code data-lang="diff"><span><span><span>+COPY --from=ghcr.io/astral-sh/uv:0.7.13 /uv /uvx /usr/local/bin/
</span></span></span></code></pre></div><ul><li>Ensure both <code>uv</code> and <code>uvx</code> binaries are installed on your system’s path<ul><li>Since uv is a compiled Rust tool we only need statically compiled binaries</li><li>You can find the latest release here: <a href="https://github.com/astral-sh/uv/releases" target="_blank">https://github.com/astral-sh/uv/releases</a></li></ul></li></ul><h4>Dependency Files</h4><div><pre tabindex="0"><code data-lang="diff"><span><span><span>-COPY --chown=python:python requirements*.txt ./
</span></span></span><span><span><span></span><span>+COPY --chown=python:python pyproject.toml uv.lock* ./
</span></span></span></code></pre></div><ul><li>Reference uv’s dependency related files instead<ul><li>That trailing <code>*</code> is important because it makes the lock file optional<ul><li>The first time you build your project the lock file might not exist</li></ul></li></ul></li></ul><h4>Environment Variables</h4><div><pre tabindex="0"><code data-lang="diff"><span><span><span>+ENV \
</span></span></span><span><span><span>+  UV_COMPILE_BYTECODE=1 \
</span></span></span><span><span><span>+  UV_PROJECT_ENVIRONMENT=&#34;/home/python/.local&#34; \
</span></span></span></code></pre></div><ul><li><code>UV_COMPILE_BYTECODE</code><ul><li>Python source files will be compiled to bytecode<ul><li>This is preferred since all bytecode gets compiled once at build time<ul><li>Your app doesn’t need to do this at run-time when the container starts</li></ul></li></ul></li></ul></li><li><code>UV_PROJECT_ENVIRONMENT</code> instructs uv to not make a virtual environment (venv)<ul><li>My example apps run things as a non-root <code>python</code> user</li><li>Ultimately all Python dependencies will be installed in this path</li></ul></li></ul><h4>Dependency Install Commands</h4><div><pre tabindex="0"><code data-lang="diff"><span><span><span>-RUN chmod 0755 bin/* &amp;&amp; bin/pip3-install
</span></span></span><span><span><span></span><span>+RUN chmod 0755 bin/* &amp;&amp; bin/uv-install
</span></span></span></code></pre></div><p>In both cases I extracted their install commands to a separate script so it’s
easy to either run at build time in the Dockerfile (as seen above), or by
running it as a command at run-time to make sure your lock file gets updated
on your host machine through a volume.</p><p>In any case, both solutions are just shell scripts. Here’s the one for uv with
comments:</p><div><pre tabindex="0"><code data-lang="sh"><span><span><span>#!/usr/bin/env bash
</span></span></span><span><span><span></span>
</span></span><span><span><span>set</span> -o errexit
</span></span><span><span><span>set</span> -o pipefail
</span></span><span><span>
</span></span><span><span><span># Ensure we always have an up to date lock file.</span>
</span></span><span><span><span>if</span> ! <span>test</span> -f uv.lock <span>||</span> ! uv lock --check 2&gt;/dev/null<span>;</span> <span>then</span>
</span></span><span><span>  uv lock
</span></span><span><span><span>fi</span>
</span></span><span><span>
</span></span><span><span><span># Use the existing lock file exactly how it is defined.</span>
</span></span><span><span>uv sync --frozen --no-install-project
</span></span></code></pre></div><p><em>There’s a few ways to use uv, such as using its pip sub-command but I like
using sync since it’s the “uv way” of doing things. The pip sub-command is
there to help create a mental model of how uv works, or continue using pip’s
commands through uv if you prefer.</em></p><p>The <code>--frozen</code> flag ensures the lock file doesn’t get updated. That’s exactly
what we want because we expect the lock file to have a complete list of exact
versions we want to use for all dependencies that get installed.</p><p>The <code>--no-install-project</code> flag skips installing your code as a Python package.
Since we have a <code>pyproject.toml</code> with a project defined the default behavior
is to install it as a package.</p><p>For a typical web app, you usually have your project’s dependencies and that’s
it. Your project isn’t an installable project in itself. However, if you do
have that use case feel free to remove this flag! You can think of this as
using <code>--editable .</code> with pip.</p><h3 id="add-update-or-delete-your-dependencies"><a href="#add-update-or-delete-your-dependencies">#</a>
Add, Update or Delete Your Dependencies</h3><p>If you’re using my example starter app, it comes with a few <a href="https://nickjanetakis.com/blog/replacing-make-with-a-shell-script-for-running-your-projects-tasks">run script</a> shortcuts. They’re shortcut shell scripts to run certain commands in a
container:</p><ul><li><code>./run deps:install</code><ul><li>Build a new image and volume mount out a new lock file</li><li>It’s mainly doing <code>docker compose build</code> and running <code>bin/uv-install</code> inside of a container which has a volume mount so your host’s lock file gets updated</li></ul></li><li><code>./run deps:install --no-build</code><ul><li>The same as above except it skips building but still mounts out a new lock file</li></ul></li><li><code>./run uv [...]</code><ul><li>It’s doing <code>docker compose exec web uv [...]</code></li><li>Execute any <a href="https://docs.astral.sh/uv/reference/cli/" target="_blank"><code>uv</code> commands</a> you want, for example:<ul><li><code>uv add mypackage --no-sync</code><ul><li>Updates your <code>pyproject.toml</code> file and lock file but doesn’t install it<ul><li>Then you can run <code>./run deps:install</code></li></ul></li><li>This will either add a new dependency OR update an existing one<ul><li>For adding, if you omit <code>==X.X.X</code> it will add the current latest version as <code>&gt;=X.X.X</code> in <code>pyproject.toml</code></li><li>For updating, include <code>==X.X.X</code> so <code>pyproject.toml</code> gets updated</li></ul></li></ul></li><li><code>uv remove mypackage --no-sync</code><ul><li>The same as above except it removes the package</li></ul></li></ul></li></ul></li><li><code>./run uv:outdated</code><ul><li>It’s doing <code>docker compose exec web uv tree --outdated --depth 1</code></li><li>Show a list of outdated dependencies so you know what to update</li></ul></li></ul><p>The video below goes over the diffs together and runs some of the above commands.</p><h3 id="demo-video"><a href="#demo-video">#</a>
Demo Video</h3><p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/pL-qft1ykek?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" title="YouTube video"></iframe></p><h4>Timestamps</h4><ul><li>0:17 – TL;DR on uv</li><li>1:36 – pyproject.toml to replace requirements.txt</li><li>3:05 – Dockerfile: install uv</li><li>3:56 – Dockerfile: dependency files</li><li>4:50 – Dockerfile: env vars</li><li>6:46 – Dockerfile: uv lock / sync</li><li>10:22 – Quick recap</li><li>10:44 – One way to update a package</li><li>11:41 – Checking for outdated packages</li><li>13:29 – Using uv add to add or update packages</li><li>15:27 – Adding a new package at its latest version</li><li>16:12 – Removing a package</li></ul><p><strong>Did you switch to uv, how did it go? Let me know below.</strong></p></article><p>Like you, I&#39;m super protective of my inbox,
so don&#39;t worry about getting spammed. You can expect a few emails per year (at most), and
you can 1-click unsubscribe at any time. <a href="https://nickjanetakis.com/newsletter">See what else you&#39;ll get</a> too.</p><hr/><hr/><h2>Comments</h2><hr/></div></div></div>
  </body>
</html>
