<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://alexplescan.com/posts/2023/07/08/easy-svg-sparklines/">Original</a>
    <h1>Easy SVG sparklines</h1>
    
    <div id="readability-page-1" class="page"><div role="main">
      <div>
        <article role="article">
  

  <div>
    <p><a href="https://en.wikipedia.org/wiki/Sparkline">Sparkline charts</a> are compact, simple charts showing a general trend without getting into the nitty-gritty of a more complete solution.</p>

<p>On <a href="https://mailgrip.io">Mailgrip</a>, I use them as a UI flourish to give a visual indication of how many emails an inbox has received over time:</p>

<picture><source srcset="/generated/assets/posts/easy-svg-sparklines/mailgrip-sparkline-500-965b47029.webp 1.0x, /generated/assets/posts/easy-svg-sparklines/mailgrip-sparkline-1000-965b47029.webp 2.0x, /generated/assets/posts/easy-svg-sparklines/mailgrip-sparkline-1116-965b47029.webp 2.23x" type="image/webp"/><source srcset="/generated/assets/posts/easy-svg-sparklines/mailgrip-sparkline-500-965b47029.jpg 1.0x, /generated/assets/posts/easy-svg-sparklines/mailgrip-sparkline-1000-965b47029.jpg 2.0x, /generated/assets/posts/easy-svg-sparklines/mailgrip-sparkline-1116-965b47029.jpg 2.23x" type="image/jpeg"/><img src="https://alexplescan.com/generated/assets/posts/easy-svg-sparklines/mailgrip-sparkline-800-6e055d663.png" alt="a screenshot showing an example of a sparkline"/></picture>

<p>This post will explain how to use SVG to create minimal sparklines in a really easy and fast way.</p>

<h2 id="hand-crafting-the-svg">Hand crafting the SVG</h2>

<p>Let’s start by writing the SVG by hand, and then I’ll show you an example of the Elixir code I use to generate sparklines in Mailgrip.</p>

<p>Say we’ve got this series of 10 data points to display:</p>

<div><div><pre><code>1, 0, 5, 4, 8, 10, 15, 10, 5, 4
</code></pre></div></div>

<h3 id="drawing-a-line">Drawing a line</h3>

<p>Everything has a starting point, including our sparkline. So let’s begin by drawing a line.</p>

<p>SVGs use a set of primitive commands (<a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#path_commands">docs</a>) to draw shapes. The ones we’re interested in are:</p>

<ul>
  <li>M (<code>moveto</code>): Sets a new starting point. It takes two parameters: X and Y.</li>
  <li>L (<code>lineto</code>): Draws a line from the current position to a new one, specified by X and Y parameters.</li>
  <li>Z (<code>closepath</code>): Draws a line from the current position back to the starting position.</li>
</ul>

<p>We’ll use these commands to draw our lines based on X and Y coordinates.</p>

<p>In SVG, the origin coordinates (0, 0) are at the top left. However we want our chart’s coordinates to start at the bottom left.</p>

<p>To adjust the Y position for a point, we’ll substract it from the largest (max) point in our data set. This flips our Y positions to:</p>

<div><div><pre><code>14, 15, 10, 11, 7, 5, 0, 5, 10, 11
</code></pre></div></div>

<p>Figuring out the X positions is straightforward; they’re just the index of the point we’re drawing:</p>

<div><div><pre><code>0, 1, 2, 3, 4, 5, 6, 7, 8, 9
</code></pre></div></div>

<p>Now, let’s put these coordinates to work and draw our sparkline:</p>

<div><div><pre><code><span>&lt;svg</span> <span>height=</span><span>&#34;180px&#34;</span> <span>width=</span><span>&#34;500px&#34;</span><span>&gt;</span>
  <span>&lt;path</span>
    <span>d=</span><span>&#34;M 0 14 L 1 15 L 2 10 L 3 11 L 4 7 L 5 5 L 6 0 L 7 5 L 8 10 L 9 11&#34;</span>
    <span>stroke-width=</span><span>&#34;2&#34;</span>
    <span>stroke=</span><span>&#34;red&#34;</span>
    <span>fill=</span><span>&#34;transparent&#34;</span>
  <span>/&gt;</span>
<span>&lt;/svg&gt;</span>
</code></pre></div></div>

<p>Behold our beautiful creation:</p>



<p>Okay that’s a bit sad, we’ve got a few more steps to go still…</p>

<h3 id="scaling">Scaling</h3>

<p>We’ve defined that our SVG should have a height of 180px and width of 500px, but the line we drew is rendering at one pixel per X/Y coordinate.</p>

<p>Here’s where SVG’s ability to <em>Scale</em> Vector Graphics really helps out. Instead of having to transpose our data to screen space coordinates, we can let SVG do it for us!</p>

<p>We use the <code>viewBox</code> attribute (<a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/viewBox">docs</a>) on the SVG element to set the coordinate space of the chart. <code>viewBox</code> values are zero-indexed, so our width will be <code>9</code> (because we have a total of 10 points) and our height will be <code>15</code> (because our max point value is 15).</p>

<div><div><pre><code><span>&lt;svg</span> <span>height=</span><span>&#34;180px&#34;</span> <span>width=</span><span>&#34;500px&#34;</span> <span>viewBox=</span><span>&#34;0 0 9 15&#34;</span><span>&gt;</span>
  <span>&lt;path</span>
    <span>d=</span><span>&#34;M 0 14 L 1 15 L 2 10 L 3 11 L 4 7 L 5 5 L 6 0 L 7 5 L 8 10 L 9 11&#34;</span>
    <span>stroke-width=</span><span>&#34;2&#34;</span>
    <span>stroke=</span><span>&#34;red&#34;</span>
    <span>fill=</span><span>&#34;transparent&#34;</span>
  <span>/&gt;</span>
<span>&lt;/svg&gt;</span>
</code></pre></div></div>



<p>Ah, but now a couple of other funky things have happened:</p>

<ul>
  <li>The <code>stroke-width</code> of 2px has scaled up with the image. We can tell SVG to keep the stroke consistent by setting the <code>vector-effect</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/vector-effect">docs</a>) property on our path.</li>
  <li>The image scaled up using the aspect ratio of the 9 x 15 <code>viewBox</code>, which is different to that of our image. We can tell SVG to maintain the aspect ratio of the <code>svg</code> element by setting <code>preserveAspectRatio</code> to <code>none</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/preserveAspectRatio">docs</a>).</li>
</ul>

<div><div><pre><code><span>&lt;svg</span> <span>height=</span><span>&#34;180px&#34;</span> <span>width=</span><span>&#34;500px&#34;</span> <span>viewBox=</span><span>&#34;0 0 9 15&#34;</span> <span>preserveAspectRatio=</span><span>&#34;none&#34;</span><span>&gt;</span>
  <span>&lt;path</span>
    <span>d=</span><span>&#34;M 0 14 L 1 15 L 2 10 L 3 11 L 4 7 L 5 5 L 6 0 L 7 5 L 8 10 L 9 11&#34;</span>
    <span>stroke-width=</span><span>&#34;2&#34;</span>
    <span>stroke=</span><span>&#34;red&#34;</span>
    <span>fill=</span><span>&#34;transparent&#34;</span>
    <span>vector-effect=</span><span>&#34;non-scaling-stroke&#34;</span>
  <span>/&gt;</span>
<span>&lt;/svg&gt;</span>
</code></pre></div></div>



<p>That’s better, now for some more… flare… let’s add a fill to the SVG as well:</p>

<h3 id="adding-a-fill">Adding a fill</h3>

<p>To do this, we copy our existing line but set a <code>fill</code> on it instead of a <code>stroke</code>:</p>

<div><div><pre><code><span>&lt;svg</span> <span>height=</span><span>&#34;180px&#34;</span> <span>width=</span><span>&#34;500px&#34;</span> <span>viewBox=</span><span>&#34;0 0 9 15&#34;</span> <span>preserveAspectRatio=</span><span>&#34;none&#34;</span><span>&gt;</span>
  <span>&lt;path</span>
    <span>d=</span><span>&#34;M 0 14 L 1 15 L 2 10 L 3 11 L 4 7 L 5 5 L 6 0 L 7 5 L 8 10 L 9 11&#34;</span>
    <span>stroke=</span><span>&#34;transparent&#34;</span>
    <span>fill=</span><span>&#34;pink&#34;</span>
  <span>/&gt;</span>
  <span>&lt;path</span>
    <span>d=</span><span>&#34;M 0 14 L 1 15 L 2 10 L 3 11 L 4 7 L 5 5 L 6 0 L 7 5 L 8 10 L 9 11&#34;</span>
    <span>stroke-width=</span><span>&#34;2&#34;</span>
    <span>stroke=</span><span>&#34;red&#34;</span>
    <span>fill=</span><span>&#34;transparent&#34;</span>
    <span>vector-effect=</span><span>&#34;non-scaling-stroke&#34;</span>
  <span>/&gt;</span>
<span>&lt;/svg&gt;</span>
</code></pre></div></div>



<p>Almost there! Let’s close that unsightly white gap. To do so, we need to extend our line to the bottom right of the graphic (<code>L 9 15</code>), then to the bottom left (<code>L 0 15</code>), then back up to the starting point (<code>Z</code>).</p>

<p>This creates a closed line that nicely encapsulates the area we want to fill in:</p>

<div><div><pre><code><span>&lt;svg</span> <span>height=</span><span>&#34;180px&#34;</span> <span>width=</span><span>&#34;500px&#34;</span> <span>viewBox=</span><span>&#34;0 0 9 15&#34;</span> <span>preserveAspectRatio=</span><span>&#34;none&#34;</span><span>&gt;</span>
  <span>&lt;path</span>
    <span>d=</span><span>&#34;M 0 14 L 1 15 L 2 10 L 3 11 L 4 7 L 5 5 L 6 0 L 7 5 L 8 10 L 9 11 L 9 15 L 0 15 Z&#34;</span>
    <span>stroke=</span><span>&#34;transparent&#34;</span>
    <span>fill=</span><span>&#34;pink&#34;</span>
  <span>/&gt;</span>
  <span>&lt;path</span>
    <span>d=</span><span>&#34;M 0 14 L 1 15 L 2 10 L 3 11 L 4 7 L 5 5 L 6 0 L 7 5 L 8 10 L 9 11&#34;</span>
    <span>stroke-width=</span><span>&#34;2&#34;</span>
    <span>stroke=</span><span>&#34;red&#34;</span>
    <span>fill=</span><span>&#34;transparent&#34;</span>
    <span>vector-effect=</span><span>&#34;non-scaling-stroke&#34;</span>
  <span>/&gt;</span>
<span>&lt;/svg&gt;</span>
</code></pre></div></div>



<p>That’s looking pretty good now - especially considering how simple it was to draw. Now let’s move on to rendering these on the server…</p>

<h2 id="rendering-sparklines-on-the-server">Rendering Sparklines on the server</h2>

<p>One of my favourite things about creating sparklines like this is that I can create the SVGs entirely on the backend. I don’t need to worry about using a JavaScript charting library, or sending the “points” data to the frontend. The browser requests an SVG. The server returns it. Simple!</p>

<p>Mailgrip is written in Elixir and uses the Phoenix framework, so the code I’m sharing is in Elixir too - but this approach could be adapted to any programming language.</p>

<p>The Phoenix controller defines a route that looks like:</p>

<div><div><pre><code><span>defmodule</span> <span>MailgripWeb</span><span>.</span><span>InboxController</span> <span>do</span>
  <span>def</span> <span>activity_svg</span><span>(</span><span>conn</span><span>,</span> <span>_params</span><span>)</span> <span>do</span>
    <span>points</span> <span>=</span>
      <span>Emails</span><span>.</span><span>message_stats</span><span>(</span><span>conn</span><span>.</span><span>assigns</span><span>.</span><span>inbox</span><span>,</span> <span>30</span><span>)</span>
      <span>|&gt;</span> <span>Enum</span><span>.</span><span>map</span><span>(</span><span>fn</span> <span>stat</span> <span>-&gt;</span> <span>Map</span><span>.</span><span>fetch!</span><span>(</span><span>stat</span><span>,</span> <span>:count</span><span>)</span> <span>end</span><span>)</span>

    <span>conn</span>
    <span>|&gt;</span> <span>put_resp_content_type</span><span>(</span><span>&#34;image/svg+xml&#34;</span><span>)</span>
    <span>|&gt;</span> <span>send_resp</span><span>(</span><span>200</span><span>,</span> <span>MailgripWeb</span><span>.</span><span>Sparkline</span><span>.</span><span>draw</span><span>(</span><span>100</span><span>,</span> <span>20</span><span>,</span> <span>points</span><span>))</span>
  <span>end</span>
<span>end</span>
</code></pre></div></div>

<p>Which in turn calls this module (heavily inspired by the <a href="https://github.com/mindok/contex">Contex</a> package):</p>

<div><div><pre><code><span>defmodule</span> <span>MailgripWeb</span><span>.</span><span>Sparkline</span> <span>do</span>
  <span>@fill</span> <span>&#34;#dcfce7&#34;</span>
  <span>@stroke</span> <span>&#34;#bbf7d0&#34;</span>
  <span>@stroke_width</span> <span>4</span>

  <span>def</span> <span>draw</span><span>(</span><span>width</span><span>,</span> <span>height</span><span>,</span> <span>points</span><span>)</span> <span>do</span>
    <span>vb_width</span> <span>=</span> <span>length</span><span>(</span><span>points</span><span>)</span> <span>-</span> <span>1</span>
    <span>vb_height</span> <span>=</span> <span>Enum</span><span>.</span><span>max</span><span>(</span><span>points</span><span>)</span>

    <span>&#34;&#34;&#34;
    &lt;svg height=&#34;#{height}&#34; width=&#34;#{width}&#34; viewBox=&#34;0 0 #{vb_width} #{vb_height}&#34; preserveAspectRatio=&#34;none&#34; role=&#34;img&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
      &lt;path d=&#34;#{closed_path(points, vb_width, vb_height)}&#34; stroke=&#34;transparent&#34; fill=&#34;#{@fill}&#34; /&gt;
      &lt;path d=&#34;#{path(points, vb_width, vb_height)}&#34; stroke-width=&#34;#{@stroke_width}&#34; vector-effect=&#34;non-scaling-stroke&#34; stroke=&#34;#{@stroke}&#34; fill=&#34;transparent&#34; /&gt;
    &lt;/svg&gt;
    &#34;&#34;&#34;</span>
  <span>end</span>

  <span>defp</span> <span>path</span><span>(</span><span>points</span><span>,</span> <span>vb_width</span><span>,</span> <span>vb_height</span><span>)</span> <span>do</span>
    <span>[</span>
      <span>&#34;M&#34;</span><span>,</span>
      <span>points</span>
      <span>|&gt;</span> <span>Enum</span><span>.</span><span>with_index</span><span>()</span>
      <span>|&gt;</span> <span>Enum</span><span>.</span><span>map</span><span>(</span><span>fn</span> <span>{</span><span>value</span><span>,</span> <span>i</span><span>}</span> <span>-&gt;</span>
        <span>x</span> <span>=</span> <span>i</span>
        <span>y</span> <span>=</span> <span>vb_height</span> <span>-</span> <span>value</span>
        <span>&#34;</span><span>#{</span><span>x</span><span>}</span><span> </span><span>#{</span><span>y</span><span>}#{</span><span>if</span> <span>i</span> <span>&lt;</span> <span>vb_width</span><span>,</span> <span>do</span><span>:</span> <span>&#34; L &#34;</span><span>}</span><span>&#34;</span>
      <span>end</span><span>)</span>
    <span>]</span>
  <span>end</span>

  <span>defp</span> <span>closed_path</span><span>(</span><span>points</span><span>,</span> <span>vb_width</span><span>,</span> <span>vb_height</span><span>)</span> <span>do</span>
    <span>[</span><span>path</span><span>(</span><span>points</span><span>,</span> <span>vb_width</span><span>,</span> <span>vb_height</span><span>),</span> <span>&#34; L </span><span>#{</span><span>vb_width</span><span>}</span><span> </span><span>#{</span><span>vb_height</span><span>}</span><span> L 0 </span><span>#{</span><span>vb_height</span><span>}</span><span> Z&#34;</span><span>]</span>
  <span>end</span>
<span>end</span>
</code></pre></div></div>

<p>That’s all it takes for minimal sparklines to add some flourish to your user interfaces!</p>

<p>My use of sparklines is gonna go:</p>



  </div>
</article>

      </div>
    </div></div>
  </body>
</html>
