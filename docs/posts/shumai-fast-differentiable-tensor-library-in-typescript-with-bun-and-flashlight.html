<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/facebookresearch/shumai">Original</a>
    <h1>Shumai: Fast Differentiable Tensor Library in TypeScript with Bun and Flashlight</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><p dir="auto">
<a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/4842908/187270063-250a42b0-475e-4eb2-bc1e-2b6a54182577.png#gh-light-mode-only"><img width="375" alt="shumai_logo_light" src="https://user-images.githubusercontent.com/4842908/187270063-250a42b0-475e-4eb2-bc1e-2b6a54182577.png#gh-light-mode-only"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/4842908/187270061-99666d73-047c-4076-906c-f181c940244c.png#gh-dark-mode-only"><img width="375" alt="shumai_logo_dark" src="https://user-images.githubusercontent.com/4842908/187270061-99666d73-047c-4076-906c-f181c940244c.png#gh-dark-mode-only"/></a>
</p>
<p dir="auto">A fast differentiable tensor library for research in TypeScript and JavaScript.  Built with <a href="https://bun.sh" rel="nofollow">bun</a> + <a href="https://github.com/flashlight/flashlight">flashlight</a>.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/4842908/190880994-6e59dd90-22ef-4a6a-9129-5be04086b59a.gif"><img src="https://user-images.githubusercontent.com/4842908/190880994-6e59dd90-22ef-4a6a-9129-5be04086b59a.gif" alt="shumai_big" data-animated-image=""/></a></p>
<p dir="auto"><g-emoji alias="warning" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png">⚠️</g-emoji> <em>This is experimental software!</em> <g-emoji alias="warning" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png">⚠️</g-emoji></p>
<p dir="auto"><a href="https://facebookresearch.github.io/shumai/" rel="nofollow"><img src="https://camo.githubusercontent.com/914fa2629dd4e8827c95d65def8011449248fac66a9fa1469d0f2cc5d9aeac22/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f63732d617661696c61626c652d626c7565" alt="docs" data-canonical-src="https://img.shields.io/badge/docs-available-blue"/></a>
<a href="https://github.com/facebookresearch/shumai/actions/workflows/build.yml"><img src="https://github.com/facebookresearch/shumai/actions/workflows/build.yml/badge.svg" alt="build"/></a>
<a href="https://app.circleci.com/pipelines/github/facebookresearch/shumai" rel="nofollow"><img src="https://camo.githubusercontent.com/c9fffb8e1f12fbd05d16519def2c7a7a9012128548b48e73a43dbedc8a7be369/68747470733a2f2f636972636c6563692e636f6d2f67682f66616365626f6f6b72657365617263682f7368756d61692e7376673f7374796c653d736869656c64" alt="tests" data-canonical-src="https://circleci.com/gh/facebookresearch/shumai.svg?style=shield"/></a>
<a href="https://www.npmjs.com/settings/shumai/packages" rel="nofollow"><img src="https://camo.githubusercontent.com/5c205b395092566a405570038c5cb7bb766117e32565da0501a7be3d24a26d78/68747470733a2f2f696d672e736869656c64732e696f2f6e706d2f762f407368756d61692f7368756d61692f6c6174657374" alt="npm" data-canonical-src="https://img.shields.io/npm/v/@shumai/shumai/latest"/></a>
<a href="https://discord.com/channels/1013580889940295730/" rel="nofollow"><img src="https://camo.githubusercontent.com/20198ede3c129ece05f4c99e574f21ee3693a0f4e459386a6b2fb5763abd6ae4/68747470733a2f2f696d672e736869656c64732e696f2f646973636f72642f31303133353830383839393430323935373330" alt="Discord" data-canonical-src="https://img.shields.io/discord/1013580889940295730"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/e48e7fa0418ef63c501eaacc35cc89be7b851fb3f970a4a698e8bf562511f180/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f636f6d6d69742d61637469766974792f772f66616365626f6f6b72657365617263682f7368756d6169"><img src="https://camo.githubusercontent.com/e48e7fa0418ef63c501eaacc35cc89be7b851fb3f970a4a698e8bf562511f180/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f636f6d6d69742d61637469766974792f772f66616365626f6f6b72657365617263682f7368756d6169" alt="GitHub commit activity" data-canonical-src="https://img.shields.io/github/commit-activity/w/facebookresearch/shumai"/></a>
<a href="https://github.com/facebookresearch/shumai/blob/main/LICENSE"><img src="https://camo.githubusercontent.com/c2005222150323ad1be086926a3532e8ce97c3417222ad587acbe0a6f96bdd70/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f66616365626f6f6b72657365617263682f7368756d6169" alt="GitHub" data-canonical-src="https://img.shields.io/github/license/facebookresearch/shumai"/></a></p>
<hr/>
<ul dir="auto">
<li><a href="#usage">Usage</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#installing-local-build-from-source">Build from source</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#supported-operations">Supported operations</a></li>
</ul>
<h2 dir="auto"><a id="user-content-quickstart" aria-hidden="true" href="#quickstart"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Quickstart</h2>
<p dir="auto">Install <a href="https://bun.sh/" rel="nofollow">Bun</a> and <a href="https://github.com/arrayfire/arrayfire/wiki/Getting-ArrayFire">ArrayFire</a></p>
<details><summary><strong>For MacOS users:</strong></summary>
<p dir="auto">You can use <a href="https://brew.sh" rel="nofollow">Homebrew</a> to install ArrayFire:</p>
<div dir="auto" data-snippet-clipboard-copy-content="curl https://bun.sh/install | bash
brew install arrayfire"><pre>curl https://bun.sh/install <span>|</span> bash
brew install arrayfire</pre></div>
</details>
<details><summary><strong>For Linux users:</strong></summary>
<p dir="auto">If you&#39;re running Ubuntu with <strong>x86-64</strong>, you can use the official distribution:</p>
<div dir="auto" data-snippet-clipboard-copy-content="curl https://bun.sh/install | bash
sudo apt install -y gnupg2 ca-certificates
sudo apt-key adv --fetch-key https://repo.arrayfire.com/GPG-PUB-KEY-ARRAYFIRE-2020.PUB
echo &#34;deb https://repo.arrayfire.com/debian all main&#34; | sudo tee /etc/apt/sources.list.d/arrayfire.list
sudo apt update
sudo apt install -y arrayfire-cpu3-dev arrayfire-cpu3-openblas"><pre>curl https://bun.sh/install <span>|</span> bash
sudo apt install -y gnupg2 ca-certificates
sudo apt-key adv --fetch-key https://repo.arrayfire.com/GPG-PUB-KEY-ARRAYFIRE-2020.PUB
<span>echo</span> <span><span>&#34;</span>deb https://repo.arrayfire.com/debian all main<span>&#34;</span></span> <span>|</span> sudo tee /etc/apt/sources.list.d/arrayfire.list
sudo apt update
sudo apt install -y arrayfire-cpu3-dev arrayfire-cpu3-openblas</pre></div>
<p dir="auto">If you&#39;re running Ubuntu with <strong>ARMv8</strong>, you&#39;ll need to build from source:</p>
<div dir="auto" data-snippet-clipboard-copy-content="curl https://bun.sh/install | bash
sudo apt remove libarrayfire-dev libarrayfire-cpu3 libarrayfire-cpu-dev
sudo apt install -y libblas-dev liblapack-dev liblapacke-dev libfftw3-dev libboost-all-dev cmake make g++
cd /tmp
sudo rm -rf arrayfire
git clone https://github.com/arrayfire/arrayfire.git
cd arrayfire
cmake -Bbuild -DAF_BUILD_EXAMPLES=OFF -DCMAKE_BUILD_TYPE=Release -DAF_BUILD_UNIFIED=OFF -DAF_TEST_WITH_MTX_FILES=OFF -DBUILD_TESTING=OFF
make -j4 -Cbuild
sudo make install -Cbuild"><pre>curl https://bun.sh/install <span>|</span> bash
sudo apt remove libarrayfire-dev libarrayfire-cpu3 libarrayfire-cpu-dev
sudo apt install -y libblas-dev liblapack-dev liblapacke-dev libfftw3-dev libboost-all-dev cmake make g++
<span>cd</span> /tmp
sudo rm -rf arrayfire
git clone https://github.com/arrayfire/arrayfire.git
<span>cd</span> arrayfire
cmake -Bbuild -DAF_BUILD_EXAMPLES=OFF -DCMAKE_BUILD_TYPE=Release -DAF_BUILD_UNIFIED=OFF -DAF_TEST_WITH_MTX_FILES=OFF -DBUILD_TESTING=OFF
make -j4 -Cbuild
sudo make install -Cbuild</pre></div>
<p dir="auto">Otherwise, see the official <a href="https://github.com/arrayfire/arrayfire/wiki/Getting-ArrayFire">ArrayFire installation guide.</a></p>
</details>
<p dir="auto">then run:</p>
<div data-snippet-clipboard-copy-content="bun install @shumai/shumai"><pre><code>bun install @shumai/shumai
</code></pre></div>
<p dir="auto">Only macOS and Linux are supported. Linux installs default to GPU computation with CUDA, and macOS to CPU. Detailed install instructions <a href="#install">below</a>.</p>
<p dir="auto"><em>Install is work in progress</em>: <a href="https://github.com/facebookresearch/shumai/issues"><strong>please file an issue</strong></a> if you run into problems.</p>
<h2 dir="auto"><a id="user-content-why-build-this" aria-hidden="true" href="#why-build-this"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Why build this?</h2>
<p dir="auto">With Shumai, we hope to make</p>
<ul dir="auto">
<li><strong>Creating datasets</strong>
<ul dir="auto">
<li>JavaScript, with native typed arrays and a JIT compiler, is perfect for twiddling with data before it can be made into big, flat GPU-compatible arrays.</li>
</ul>
</li>
<li><strong>Training small models</strong>
<ul dir="auto">
<li>FFI bindings in Bun are crazy fast (~3ns), so JS gets out of the way when training small models</li>
</ul>
</li>
<li><strong>Advanced/fine-grained training/inference logic</strong>
<ul dir="auto">
<li>Bun uses the JSC JIT compiler, meaning you can confidently write complex training logic without needing a native C++ implementation</li>
</ul>
</li>
<li><strong>Building applications</strong>
<ul dir="auto">
<li>JavaScript has a <del>large</del> <a href="https://survey.stackoverflow.co/2022/#section-most-popular-technologies-programming-scripting-and-markup-languages" rel="nofollow">HUGE</a> ecosystem, which facilitates better application development</li>
</ul>
</li>
</ul>
<h2 dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Usage</h2>
<p dir="auto">shumai will always attempt to use an attached GPU or accelerator; although CPU computation will use the ArrayFire CPU backend, which is not well-optimized.</p>
<p dir="auto">We hope to support the ArrayFire OpenCL backend and other non-ArrayFire tensor backends soon.</p>
<p dir="auto">If shumai seems unusually slow, please file an issue!</p>
<p dir="auto"><strong>Standard array utilities:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="import * as sm from &#34;@shumai/shumai&#34;

// create a 1024 by 1024 tensor, randomly filled with normal distribution
let X = sm.randn([1024, 1024])
let W = sm.identity(1024)
let Y = X.matmul(W)
console.log(Y.shape)"><pre><span>import</span> <span>*</span> <span>as</span> <span>sm</span> <span>from</span> <span>&#34;@shumai/shumai&#34;</span>

<span>// create a 1024 by 1024 tensor, randomly filled with normal distribution</span>
<span>let</span> <span>X</span> <span>=</span> <span>sm</span><span>.</span><span>randn</span><span>(</span><span>[</span><span>1024</span><span>,</span> <span>1024</span><span>]</span><span>)</span>
<span>let</span> <span>W</span> <span>=</span> <span>sm</span><span>.</span><span>identity</span><span>(</span><span>1024</span><span>)</span>
<span>let</span> <span>Y</span> <span>=</span> <span>X</span><span>.</span><span>matmul</span><span>(</span><span>W</span><span>)</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>Y</span><span>.</span><span>shape</span><span>)</span></pre></div>
<p dir="auto"><strong>Conversion to and from JavaScript native arrays:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="const data : Float32Array = new Float32Array(128)
for (let i = 0; i &lt; 128; ++i) {
  data[i] = Math.random()
}

const X : Tensor = sm.tensor(data)
const pi = sm.scalar(3.14)
const Y = X.mul(pi)

// tensors can be converted back to native JavaScript
const Y_data = Y.toFloat32Array()

// scalar tensors can be converted to JavaScript numbers
const total : number = X.sum().toFloat32()"><pre><span>const</span> <span>data</span> : <span>Float32Array</span> <span>=</span> <span>new</span> <span>Float32Array</span><span>(</span><span>128</span><span>)</span>
<span>for</span> <span>(</span><span>let</span> <span>i</span> <span>=</span> <span>0</span><span>;</span> <span>i</span> <span>&lt;</span> <span>128</span><span>;</span> <span>++</span><span>i</span><span>)</span> <span>{</span>
  <span>data</span><span>[</span><span>i</span><span>]</span> <span>=</span> <span>Math</span><span>.</span><span>random</span><span>(</span><span>)</span>
<span>}</span>

<span>const</span> <span>X</span> : <span>Tensor</span> <span>=</span> <span>sm</span><span>.</span><span>tensor</span><span>(</span><span>data</span><span>)</span>
<span>const</span> <span>pi</span> <span>=</span> <span>sm</span><span>.</span><span>scalar</span><span>(</span><span>3.14</span><span>)</span>
<span>const</span> <span>Y</span> <span>=</span> <span>X</span><span>.</span><span>mul</span><span>(</span><span>pi</span><span>)</span>

<span>// tensors can be converted back to native JavaScript</span>
<span>const</span> <span>Y_data</span> <span>=</span> <span>Y</span><span>.</span><span>toFloat32Array</span><span>(</span><span>)</span>

<span>// scalar tensors can be converted to JavaScript numbers</span>
<span>const</span> <span>total</span> : <span>number</span> <span>=</span> <span>X</span><span>.</span><span>sum</span><span>(</span><span>)</span><span>.</span><span>toFloat32</span><span>(</span><span>)</span></pre></div>
<p dir="auto"><strong>Gradients:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="const W = sm.randn([128, 128])
W.requires_grad = true

const X = sm.randn([128, 128])
const diff = X.sub(W)
const mse = diff.mul(diff).sum()
mse.backward()

W.grad // this gradient is now populated

// copy W without allowing gradient updates
const Y = W.detach()
Y.sum().backward() // nothing changes
"><pre><span>const</span> <span>W</span> <span>=</span> <span>sm</span><span>.</span><span>randn</span><span>(</span><span>[</span><span>128</span><span>,</span> <span>128</span><span>]</span><span>)</span>
<span>W</span><span>.</span><span>requires_grad</span> <span>=</span> <span>true</span>

<span>const</span> <span>X</span> <span>=</span> <span>sm</span><span>.</span><span>randn</span><span>(</span><span>[</span><span>128</span><span>,</span> <span>128</span><span>]</span><span>)</span>
<span>const</span> <span>diff</span> <span>=</span> <span>X</span><span>.</span><span>sub</span><span>(</span><span>W</span><span>)</span>
<span>const</span> <span>mse</span> <span>=</span> <span>diff</span><span>.</span><span>mul</span><span>(</span><span>diff</span><span>)</span><span>.</span><span>sum</span><span>(</span><span>)</span>
<span>mse</span><span>.</span><span>backward</span><span>(</span><span>)</span>

<span>W</span><span>.</span><span>grad</span> <span>// this gradient is now populated</span>

<span>// copy W without allowing gradient updates</span>
<span>const</span> <span>Y</span> <span>=</span> <span>W</span><span>.</span><span>detach</span><span>(</span><span>)</span>
<span>Y</span><span>.</span><span>sum</span><span>(</span><span>)</span><span>.</span><span>backward</span><span>(</span><span>)</span> <span>// nothing changes</span></pre></div>
<p dir="auto">Some more examples can be found <a href="https://github.com/facebookresearch/shumai/tree/main/examples">here</a>.</p>
<p dir="auto">Supported operators can be found <a href="#supported-operations">here</a>.</p>
<h2 dir="auto"><a id="user-content-install" aria-hidden="true" href="#install"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Install</h2>
<p dir="auto"><strong>The install procedure is a work in progress!</strong>
If you have any problems building or installing, we would
greatly appreciate filed issues. Please tell us about your platform/OS when you do.</p>
<p dir="auto"><strong>Prerequisites</strong>:</p>
<ul dir="auto">
<li>Ensure you have bun installed (<a href="https://bun.sh" rel="nofollow">https://bun.sh</a>).</li>
<li>Install <a href="https://github.com/arrayfire/arrayfire">ArrayFire</a>. <em>macOS users should install ArrayFire&#39;s CPU backend; Linux users should install the CUDA backend^.</em>
<ul dir="auto">
<li><strong>macOS</strong> --- ArrayFire can easily be installed with Homebrew:</li>
</ul>

</li>
<li><strong>Linux</strong> --- instructions <a href="https://github.com/arrayfire/arrayfire/wiki/Getting-ArrayFire">can be found here</a>. On Ubuntu, ArrayFire can be installed via <a href="https://github.com/arrayfire/arrayfire/wiki/Install-ArrayFire-From-Linux-Package-Managers">package managers (e.g. <code>apt</code>)</a>.</li>
</ul>
<p dir="auto">Once <code>bun</code> and <code>ArrayFire</code> are installed, install the package and backing libs with <code>bun</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="bun install @shumai/shumai"><pre>bun install @shumai/shumai</pre></div>
<p dir="auto">^<strong>Linux users can use the CPU backend</strong> by swapping the required <code>package.json</code> dependency from <code>@shumai/linux_x64_shumai_flashlight</code> to <code>@shumai/linux_x64_shumai_flashlight_cpu</code>, i.e. running:</p>
<div dir="auto" data-snippet-clipboard-copy-content="sed -i &#34;s/linux_x64_shumai_flashlight/linux_x64_shumai_flashlight_cpu/g&#34; package.json"><pre>sed -i <span><span>&#34;</span>s/linux_x64_shumai_flashlight/linux_x64_shumai_flashlight_cpu/g<span>&#34;</span></span> package.json</pre></div>
<h3 dir="auto"><a id="user-content-windows-support" aria-hidden="true" href="#windows-support"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Windows Support</h3>
<p dir="auto">While not officially supported, Windows users have been successful leveraging <a href="https://www.docker.com/" rel="nofollow">Docker</a> + <a href="https://learn.microsoft.com/en-us/windows/wsl/install" rel="nofollow">WSL2</a> + Linux. Including CUDA support.</p>
<h2 dir="auto"><a id="user-content-building-native-libraries-from-source" aria-hidden="true" href="#building-native-libraries-from-source"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building Native Libraries from Source</h2>
<p dir="auto"><strong>Note:</strong> <em>not required when developing TypeScript/Javascript library components locally.</em></p>
<p dir="auto">From source build instructions for:</p>
<ul dir="auto">
<li><a href="#building-on-macos-from-source">macOS</a></li>
<li><a href="#building-on-linux-from-source">Linux</a></li>
</ul>
<p dir="auto">This process will build the dependent ffi libraries (<code>libflashlight</code> and <code>libflashlight_binding</code>) and pack them using <code>npm pack</code> to generate a <code>@shumai/shumai_*.tgz</code>
package. You can then use <code>npm install $PATH_TO_SOURCE/@shumai/shumai-*.tgz</code> to install the package where you&#39;d like.</p>
<h3 dir="auto"><a id="user-content-building-on-macos-from-source" aria-hidden="true" href="#building-on-macos-from-source"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building on macOS from Source</h3>
<p dir="auto">First, install ArrayFire CPU with <code>brew install arrayfire</code>.</p>
<p dir="auto">Build and install <a href="https://github.com/flashlight/flashlight#building-and-installing">Flashlight</a>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="mkdir -p $HOME/usr/ # installing flashlight here
git clone --recursive --depth 1 https://github.com/flashlight/flashlight.git
cd flashlight
mkdir -p build
cd build
cmake .. \
  -DCMAKE_BUILD_TYPE=RelWithDebInfo \ # or as specified
  -DFL_ARRAYFIRE_USE_CPU=ON \
  -DFL_ARRAYFIRE_USE_CUDA=OFF \
  -DFL_BUILD_DISTRIBUTED=OFF \
  -DFL_USE_ONEDNN=OFF \
  -DFL_BUILD_TESTS=OFF \
  -DFL_BUILD_EXAMPLES=OFF \
  -DFL_BUILD_SCRIPTS=OFF \
  -DCMAKE_INSTALL_PREFIX=$HOME/usr/
make -j$(nproc)
make install"><pre>mkdir -p <span>$HOME</span>/usr/ <span><span>#</span> installing flashlight here</span>
git clone --recursive --depth 1 https://github.com/flashlight/flashlight.git
<span>cd</span> flashlight
mkdir -p build
<span>cd</span> build
cmake .. \
  -DCMAKE_BUILD_TYPE=RelWithDebInfo <span>\ </span><span><span>#</span> or as specified</span>
  -DFL_ARRAYFIRE_USE_CPU=ON \
  -DFL_ARRAYFIRE_USE_CUDA=OFF \
  -DFL_BUILD_DISTRIBUTED=OFF \
  -DFL_USE_ONEDNN=OFF \
  -DFL_BUILD_TESTS=OFF \
  -DFL_BUILD_EXAMPLES=OFF \
  -DFL_BUILD_SCRIPTS=OFF \
  -DCMAKE_INSTALL_PREFIX=<span>$HOME</span>/usr/
make -j<span><span>$(</span>nproc<span>)</span></span>
make install</pre></div>
<p dir="auto">Build Flashlight bindings for Shumai:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cd shumai
mkdir -p build
cd build
cmake .. -Dflashlight_DIR=$HOME/usr/share/flashlight/cmake/
make -j$(nproc)"><pre><span>cd</span> shumai
mkdir -p build
<span>cd</span> build
cmake .. -Dflashlight_DIR=<span>$HOME</span>/usr/share/flashlight/cmake/
make -j<span><span>$(</span>nproc<span>)</span></span></pre></div>
<h4 dir="auto"><a id="user-content-profiling" aria-hidden="true" href="#profiling"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Profiling</h4>
<p dir="auto">On macOS, you can record perf with <code>xcrun xctrace record --template &#34;Time Profiler&#34; --launch $(which bun) train.js</code>.</p>
<h3 dir="auto"><a id="user-content-building-on-linux-from-source" aria-hidden="true" href="#building-on-linux-from-source"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building on Linux from Source</h3>
<p dir="auto">First <a href="https://github.com/arrayfire/arrayfire/wiki/Getting-ArrayFire">install ArrayFire</a>. The Linux build for shumai uses the CUDA backend, but from source, you can build the CPU backend as well (OpenCL support coming soon).</p>
<p dir="auto">Build and install <a href="https://github.com/flashlight/flashlight#building-and-installing">Flashlight</a>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="mkdir -p $HOME/usr/ # installing flashlight here
git clone --recursive --depth 1 https://github.com/flashlight/flashlight.git
cd flashlight
mkdir -p build
cd build
cmake .. \
  -DCMAKE_BUILD_TYPE=RelWithDebInfo \ # or as specified
  -DFL_ARRAYFIRE_USE_CPU=OFF \
  \ # swap with the above to build for CPU
  -DFL_ARRAYFIRE_USE_CUDA=ON \ 
  -DFL_BUILD_DISTRIBUTED=OFF \
  -DFL_USE_ONEDNN=OFF \
  -DFL_BUILD_TESTS=OFF \
  -DFL_BUILD_EXAMPLES=OFF \
  -DFL_BUILD_SCRIPTS=OFF \
  -DCMAKE_INSTALL_PREFIX=$HOME/usr/
make -j$(nproc)
make install"><pre>mkdir -p <span>$HOME</span>/usr/ <span><span>#</span> installing flashlight here</span>
git clone --recursive --depth 1 https://github.com/flashlight/flashlight.git
<span>cd</span> flashlight
mkdir -p build
<span>cd</span> build
cmake .. \
  -DCMAKE_BUILD_TYPE=RelWithDebInfo <span>\ </span><span><span>#</span> or as specified</span>
  -DFL_ARRAYFIRE_USE_CPU=OFF \
  <span>\ </span><span><span>#</span> swap with the above to build for CPU</span>
  -DFL_ARRAYFIRE_USE_CUDA=ON <span>\ </span>
  -DFL_BUILD_DISTRIBUTED=OFF \
  -DFL_USE_ONEDNN=OFF \
  -DFL_BUILD_TESTS=OFF \
  -DFL_BUILD_EXAMPLES=OFF \
  -DFL_BUILD_SCRIPTS=OFF \
  -DCMAKE_INSTALL_PREFIX=<span>$HOME</span>/usr/
make -j<span><span>$(</span>nproc<span>)</span></span>
make install</pre></div>
<p dir="auto">Build bindings for shumai:</p>
<div dir="auto" data-snippet-clipboard-copy-content="mkdir -p build &amp;&amp; cd build
cmake .. \
    -DBUILD_SHARED_LIBS=ON \
    -DCMAKE_BUILD_TYPE=RelWithDebInfo \ # or as specified
    -Dflashlight_DIR=${FLASHLIGHT_INSTALL_PREFIX}/share/flashlight/cmake \
    -DArrayFire_DIR=${ARRAYFIRE_INSTALL_PREFIX}/share/ArrayFire/cmake # if built from source, else not needed
make -j$(nproc)"><pre>mkdir -p build <span>&amp;&amp;</span> <span>cd</span> build
cmake .. \
    -DBUILD_SHARED_LIBS=ON \
    -DCMAKE_BUILD_TYPE=RelWithDebInfo <span>\ </span><span><span>#</span> or as specified</span>
    -Dflashlight_DIR=<span>${FLASHLIGHT_INSTALL_PREFIX}</span>/share/flashlight/cmake \
    -DArrayFire_DIR=<span>${ARRAYFIRE_INSTALL_PREFIX}</span>/share/ArrayFire/cmake <span><span>#</span> if built from source, else not needed</span>
make -j<span><span>$(</span>nproc<span>)</span></span></pre></div>
<h2 dir="auto"><a id="user-content-contributing" aria-hidden="true" href="#contributing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Contributing</h2>
<p dir="auto">If you&#39;d like to make changes to the core bindings or ffi, first <a href="#installing-from-source">build from source</a>.</p>
<p dir="auto">All files ending in <code>*.inl</code> or <code>*_gen.ts</code> are generated.
These can be modified by editing <a href="https://github.com/facebookresearch/shumai/blob/main/scripts/gen_binding.py"><code>scripts/gen_binding.py</code></a>
and running <a href="https://github.com/facebookresearch/shumai/blob/main/scripts/gen_all_binding.sh"><code>./scripts/gen_all_binding.sh</code></a>.</p>
<p dir="auto">See the <a href="https://github.com/facebookresearch/shumai/blob/main/CONTRIBUTING.md">CONTRIBUTING</a> file for style guidance and more info on how to help out. <g-emoji alias="grin" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f601.png">😁</g-emoji></p>
<h3 dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>License</h3>
<p dir="auto">shumai is MIT licensed, as found in the LICENSE file.</p>
</article>
          </div></div>
  </body>
</html>
