<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://deno.com/blog/a-whole-website-in-a-single-js-file">Original</a>
    <h1>A whole website in a single JavaScript file</h1>
    
    <div id="readability-page-1" class="page"><div><p><a href="https://website-in-a-single-js.deno.dev/" rel="noopener noreferrer">This site</a> is a pretty standard demo
website; a site with links to different pages. Nothing to write home about
except that the whole website is contained within a single JavaScript file, and
is rendered dynamically, just in time, at the edge, close to the user.</p>
<p>The routing is fairly minimal: we use the
<a href="https://crux.land/router@0.0.11" rel="noopener noreferrer"><code>router</code></a> module which uses
<a href="https://developer.mozilla.org/en-US/docs/Web/API/URL_Pattern_API" rel="noopener noreferrer"><code>URLPattern</code></a>
under the hood for pattern matching.</p>
<div><pre>





<span>import</span> <span>{</span> serve <span>}</span> <span>from</span> <span>&#34;https://deno.land/std@0.133.0/http/server.ts&#34;</span><span>;</span>
<span>import</span> <span>{</span> router <span>}</span> <span>from</span> <span>&#34;https://crux.land/router@0.0.11&#34;</span><span>;</span>
<span>import</span> <span>{</span> h<span>,</span> ssr <span>}</span> <span>from</span> <span>&#34;https://crux.land/nanossr@0.0.4&#34;</span><span>;</span>

<span>const</span> <span>render</span> <span>=</span> <span>(</span>component<span>)</span> <span>=&gt;</span> <span>ssr</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span><span><span>&lt;</span><span>App</span></span><span>&gt;</span></span><span>{</span>component<span>}</span><span><span><span>&lt;/</span><span>App</span></span><span>&gt;</span></span><span>)</span><span>;</span>

<span>serve</span><span>(</span><span>router</span><span>(</span>
  <span>{</span>
    <span>&#34;/&#34;</span><span>:</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>render</span><span>(</span><span><span><span>&lt;</span><span>Landing</span></span> <span>/&gt;</span></span><span>)</span><span>,</span>
    <span>&#34;/stats&#34;</span><span>:</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>render</span><span>(</span><span><span><span>&lt;</span><span>Stats</span></span> <span>/&gt;</span></span><span>)</span><span>,</span>
    <span>&#34;/bagels&#34;</span><span>:</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>render</span><span>(</span><span><span><span>&lt;</span><span>Bagels</span></span> <span>/&gt;</span></span><span>)</span><span>,</span>
  <span>}</span><span>,</span>
  <span>(</span><span>)</span> <span>=&gt;</span> <span>render</span><span>(</span><span><span><span>&lt;</span><span>NotFound</span></span> <span>/&gt;</span></span><span>)</span><span>,</span>
<span>)</span><span>)</span><span>;</span></pre></div><p>We have 3 paths: <code>/</code> for the main page, and<code>/stats</code> for some statistics, and
<code>/bagels</code> to display various bagels that we sell. We also have a fallback
handler (the last argument in the snippet), which will be called when none of
the paths match, acting as a 404 page. These are served using the <code>serve</code>
function from the <a href="https://deno.land/x/std" rel="noopener noreferrer">standard library</a>.</p>
<p>For rendering of the JSX, we use <a href="https://crux.land/nanossr@0.0.4" rel="noopener noreferrer"><code>nanossr</code></a>,
which is a tiny server-side renderer that uses <code>twind</code> under the hood for
styling. This is invoked by using the <code>ssr</code> function, to which a callback is
passed which should return JSX. The <code>ssr</code> function returns a
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Response" rel="noopener noreferrer"><code>Response</code></a>. We
create a <code>render</code> function to remove the need for larger duplication of code,
just to tidy things up.</p>
<p>But before any of this, you probably noticed some funny looking comments. Let&#39;s
go through them:</p>
<ul>
<li><code>/** @jsx h */</code>: this pragma tells Deno which function we want to use for
transpiling the JSX.</li>
<li><code>/// &lt;reference no-default-lib=&#34;true&#34;/&gt;</code>: Deno comes with various TypeScript
libraries enabled by default; with this comment, we tell it to not use those,
but instead only the ones we specify manually.</li>
<li><code>/// &lt;reference lib=&#34;dom&#34; /&gt;</code>, <code>/// &lt;reference lib=&#34;dom.asynciterable&#34; /&gt;</code>,
and <code>/// &lt;reference lib=&#34;deno.ns&#34; /&gt;</code>: these libraries provide various
typings. The <code>dom</code> one gives us various typings related to the DOM, and
<code>dom.asynciterable</code> defines functions that need async iterators as these are
not included in the normal <code>dom</code> library as of writing. The <code>deno.ns</code> library
gives us typings for any of the functions and classes under the <code>Deno.*</code>
namespace, like <code>Deno.readFile</code>. You can read more about the various libraries
available in
<a href="https://deno.land/manual@main/typescript/configuration#using-the-lib-property" rel="noopener noreferrer">the manual</a>.</li>
</ul>
<p>Let&#39;s look at some actual code; in the code snippet earlier you might have
noticed that we wrap all route components in an <code>App</code> component. This is defined
as:</p>
<div><pre><span>function</span> <span>App</span><span>(</span><span>{</span> children <span>}</span><span>)</span> <span>{</span>
  <span>return</span> <span>(</span>
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>min-h-screen<span>&#34;</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;</span><span>NavBar</span></span> <span>/&gt;</span></span><span>
      </span><span>{</span>children<span>}</span><span>
    </span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  <span>)</span><span>;</span>
<span>}</span></pre></div><p>It&#39;s fairly compact: it returns a div and inside that we have our <code>NavBar</code> which
is our menu navigation at the top of the page. We&#39;re doing templating
server-side, sharing components between different pages using the same language
one would do this client-side.</p>
<p><img src="https://blog.plover.com/a-whole-website-in-a-single-js-file/pagespeed.png"/></p><p>Hosted on <a href="https://blog.plover.com/deploy" rel="noopener noreferrer">Deno Deploy</a>, this little website is able to acheive
<a href="https://pagespeed.web.dev/report?url=https%3A%2F%2Fwebsite-in-a-single-js.deno.dev%2F" rel="noopener noreferrer">a perfect pagespeed score</a>.
Serviced from an anycast IP address over encrypted HTTP from 29 data centers
around the world, the site is fully managed and will be available indefinitely
at zero cost.</p>
<p>Everything mentioned here can be viewed on a
<a href="https://dash.deno.com/playground/website-in-a-single-js" rel="noopener noreferrer">playground</a>.</p>
</div></div>
  </body>
</html>
