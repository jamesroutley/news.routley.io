<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://netrinos.com/blog/conflicting-subnets">Original</a>
    <h1>When Every Network is 192.168.1.x</h1>
    
    <div id="readability-page-1" class="page"><div>
        



<section>

    
    <img src="https://netrinos.com/cdn/images/page/cheap-isp-modem.jpg?260128.0810" alt="When Every Network is 192.168.1.x"/>
    

    <section>
    
    <p>Solving the conflicting subnet problem with WireGuard and NAT</p>
</section>

<article>

<h2>The Problem</h2>

<p>If you manage devices at multiple customer sites, you already know this problem. Every consumer router and ISP modem ships with the same default subnet. The specific range varies by manufacturer (192.168.1.0/24, 192.168.0.0/24, 10.0.0.0/24), but the result is the same: every site ends up on one of the same few subnets.</p>

<p>Security integrators, MSPs, AV installers, home automation companies. Anyone who deploys equipment at residential sites encounters this immediately. The NVR at one customer&#39;s home is 192.168.1.100. The NVR at the next customer&#39;s home is also on 192.168.1.x. And the one after that.</p>

<p>One remote site isn&#39;t a problem. Set up a VPN gateway, add a route for 192.168.1.0/24, and traffic flows to the right place. Two sites with different subnets, still fine. But the moment two sites share the same address range, you have an ambiguity that IP routing cannot resolve.</p>

<p>A packet destined for 192.168.1.100 has two valid destinations. The routing table accepts one entry per prefix. One site works. The other is unreachable.</p>

<p><img src="https://netrinos.com/cdn/images/diagrams/blog-nat-conflict.png" alt="Technician cannot route to two sites with the same IP address"/></p>

<p>At 50 or 300 sites, the problem is absurd. You can&#39;t maintain unique subnet assignments across networks you don&#39;t control. You didn&#39;t configure these routers. You don&#39;t have admin access to most of them. And re-addressing a customer&#39;s home network to avoid conflicts with your other customers isn&#39;t realistic.</p>

<p>There&#39;s a second problem. The devices you need to reach, cameras, NVRs, NAS units, etc., are embedded systems with fixed firmware. There&#39;s no SSH, no package manager, no way to install a WireGuard client. You need to reach them, but they can&#39;t participate in any overlay network directly.</p>

<h2>Why Traditional Approaches Fail</h2>

<h3>Port forwarding</h3>

<p>The most common workaround. Open ports on the customer&#39;s ISP modem and map external ports to internal devices. This works until the ISP replaces or resets the modem. When that happens, the port forwarding configuration is gone. You&#39;re dispatching a technician.</p>

<p>Port forwarding also breaks multi-port protocols. RTSP, the protocol used by most IP cameras for video streaming, uses TCP (typically port 554) as a control channel, but delivers the actual video over RTP on separate UDP ports. These ports are dynamically negotiated during session setup, and they span a wide range. Port-forward TCP 554 and the RTSP handshake succeeds, but the RTP media arrives on UDP ports that aren&#39;t forwarded. The control session connects. The video never arrives.</p>

<p>And that assumes a single NAT. Many sites have a security firewall behind the ISP modem, or a cellular modem in front of it. Double or triple NAT means configuring port forwarding on two or three devices in series, any of which can be reset or replaced independently. If the ISP uses CGNAT, the outermost NAT is on the ISP&#39;s infrastructure and you have no options.</p>

<h3>Subnet routing</h3>

<p>Route all of 192.168.1.0/24 through a VPN node at the remote site. This works for exactly one site. The routing table accepts one next-hop per destination prefix. When two sites share the same range, you can route to one or the other, not both.</p>

<h3>Re-addressing</h3>

<p>Assign each customer a unique subnet so addresses don&#39;t overlap. This is the theoretically correct answer. It&#39;s also operationally impossible at scale. You don&#39;t own these networks. The customer&#39;s ISP modem manages DHCP. Their phones, laptops, and smart speakers expect the existing configuration. Re-addressing 300 customer networks and maintaining a master subnet allocation is not a real solution.</p>

<h2>Overlay Addressing with 1:1 NAT</h2>

<p>The approach that works is to stop trying to route to local addresses entirely. Instead, assign each remote device a globally unique IP in a separate address space (an overlay network) and translate between the overlay address and the local address at each site.</p>

<p>You place a device on the customer&#39;s LAN: a Raspberry Pi, a spare PC, any Linux box. This device connects to your mesh network via WireGuard. It also has a connection to the local network where the target devices sit.</p>

<p>For each device you want to reach, you assign an address from the overlay range. RFC 6598 reserves 100.64.0.0/10 for Carrier-Grade NAT, providing roughly 4 million addresses. This range is almost never used on customer LANs, so it won&#39;t collide with existing devices. And because the overlay addresses only exist inside WireGuard tunnels, they never appear as raw IP on the internet, so there&#39;s no conflict with ISPs that use CGNAT on the WAN side. Each camera, NVR, or NAS gets a unique address in this space, regardless of its local IP.</p>

<p>The gateway device performs 1:1 NAT. Traffic arriving for 100.97.14.3 is destination-translated to 192.168.1.100, and the source is masqueraded to the gateway&#39;s own LAN address. The local device sees a packet from a neighbor on its own subnet and responds normally. Connection tracking reverses both translations on the return path. A single gateway holds multiple overlay addresses, one per device behind it, so each camera, NVR, or panel gets its own IP and DNS name on the mesh.</p>

<p><img src="https://netrinos.com/cdn/images/diagrams/blog-nat-conflict-resolved.png" alt="Overlay addressing gives each device a unique IP, resolving the routing ambiguity"/></p>

<p>The local device has no awareness of this. It receives packets from a local IP (the gateway&#39;s LAN interface) and responds normally. No software, no configuration changes, nothing installed on the endpoint.</p>

<p>The local IP address becomes an implementation detail. Only the NAT rule on the gateway cares that the NVR is at 192.168.1.100. Everything else on the overlay network knows it by its unique address. Site A&#39;s NVR is 100.97.14.3. Site B&#39;s NVR is 100.82.44.9. Even the monitoring station itself can be on 192.168.1.x. It doesn&#39;t matter. The conflict is gone.</p>

<p>The NAT itself is trivial. Anyone can write an nftables rule. The hard part is automating it across hundreds of sites: key generation, peer distribution, NAT rule management, DNS assignment, health monitoring, roaming technicians who need access from the field, all without manual intervention. Each device requires a WireGuard peer, a DNAT rule, and a DNS record. At 10 devices per site across 300 sites, that&#39;s 3,000 sets of configuration to generate, deploy, and keep in sync.</p>

<h2>In Production</h2>

<p>A security integrator managing residential camera systems operates approximately 300 customer sites with over 3,000 cameras, NVRs, etc. Every site has a standard ISP modem handing out addresses in 192.168.1.0/24.</p>

<p>Before: open ports on every ISP modem. Cameras, many running firmware with known vulnerabilities, exposing port 80 directly to the internet. When the ISP replaced or reset a modem, all port forwarding configuration was lost. A technician was dispatched to reconfigure it.</p>

<p>After: a gateway device at each site connects to the monitoring station through an encrypted WireGuard mesh. Each camera has a unique overlay address. The monitoring station accesses any camera by its overlay IP or DNS name.</p>

<p>The security posture changed. Cameras that were previously exposed to the internet, reachable by anyone with a port scanner, are now invisible. No open ports on customer equipment. All traffic encrypted end-to-end inside WireGuard tunnels. The attack surface went from 3,000 devices on the public internet to zero.</p>

<p>Operationally, truck rolls for connectivity issues stopped. The ISP can swap the modem, change the customer&#39;s public IP, or reset the device to factory defaults. The gateway reconnects automatically, and the overlay addresses don&#39;t change. Sites with dual-WAN failover just work: the gateway uses whichever uplink is available. A technician in the field connects to the mesh and accesses any camera by its DNS name, from any location, without VPN credentials per site or firewall rules to maintain.</p>

<p>Adding a new site means dropping a gateway on the customer&#39;s LAN. It picks up a DHCP address and calls home. Register the devices from your dashboard, and they&#39;re immediately reachable. This deployment has been running in production for over two years.</p>

<h2>Clarifications</h2>

<p><strong>Not a full mesh.</strong> Customer gateways don&#39;t know about each other. A gateway at Site A has no awareness of Site B. Only the monitoring station and technicians assigned to the sites can reach its devices. Access control enforces this: each participant on the mesh sees only what they should. This is the correct topology for managing customer equipment, not a limitation.</p>

<p><strong>NAT is still NAT.</strong> DNAT with masquerade passes all ports and protocols, so multi-port protocols like RTSP should work: the dynamically negotiated RTP ports pass through without explicit forwarding rules. Protocols that embed IP addresses in their payload (RTSP includes the device&#39;s local IP in SDP) or use IP-based authentication may need testing.</p>

<p><strong>Requires a foothold device.</strong> You need a device on the remote LAN to run the VPN and NAT. At scale, a dedicated Linux device makes sense: a Raspberry Pi, a small appliance, a spare PC. But the same virtual device capability works from any Netrinos client on Windows, macOS, or Linux. Either way, if there&#39;s nothing you can control at the target site, this approach doesn&#39;t help.</p>

<p><strong>Address space.</strong> The overlay uses the 100.64.0.0/10 CGNAT range (RFC 6598). This range is not for use on customer LANs, so collisions with local devices are unlikely. Overlay addresses are encapsulated inside WireGuard tunnels and never appear on the public internet, so ISP-level CGNAT will not conflict.</p>

<h2>Under the Hood</h2>

<p>Netrinos is a configuration manager built on industry-standard tools: WireGuard for tunnels, nftables on Linux, PF on macOS, WFP on Windows. These are popular, trusted, proven components. None of them can solve the conflicting subnet problem on their own. The orchestration is what makes it work, generating the right configuration across hundreds of devices and keeping it in sync.</p>

<p>The implementation uses three components, all generated from a single device registration.</p>

<p>A WireGuard peer, auto-generated for each virtual device:</p>

<pre><code>[Peer]
PublicKey = &lt;generated-per-device&gt;
AllowedIPs = 100.97.14.3/32</code></pre>

<p>A DNAT rule and masquerade (nftables on Linux):</p>

<pre><code># Translate destination to local device
ip daddr 100.97.14.3 dnat to 192.168.1.100

# Masquerade tunnel traffic going to LAN
iifname &#34;wg0&#34; oifname != &#34;wg0&#34; masquerade</code></pre>

<p>A DNS record mapping a human-readable name to the overlay address:</p>

<pre><code>lobby-cam.downtown.myco.2ho.ca  â†’  100.97.14.3</code></pre>

<p>Register a device (&#34;192.168.1.100 on this site&#39;s LAN, call it lobby-cam&#34;), and all three are generated and deployed. No manual WireGuard configuration, no hand-written firewall rules, no DNS zone editing.</p>

<h2>Closing</h2>

<p>Every service company managing devices at customer sites runs into this: the networks they need to reach all look identical. Overlay addressing with 1:1 NAT solves it. The local IP becomes an implementation detail, and the devices you need to reach get unique addresses that the rest of the network can route to without ambiguity.</p>

<p>The components are standard: WireGuard, nftables, DNS. The hard part is orchestrating them across hundreds of sites, keeping keys rotated, NAT rules consistent, and DNS records in sync, without manual intervention. That&#39;s the problem worth solving.</p>

<p>This is how <a href="https://netrinos.com">Netrinos</a> Virtual Devices work. The software runs on Windows, macOS, and Linux, with a <a href="https://app.netrinos.com/signup?plan=pro">14-day free trial</a>.</p>

</article>

    

</section>


    </div></div>
  </body>
</html>
