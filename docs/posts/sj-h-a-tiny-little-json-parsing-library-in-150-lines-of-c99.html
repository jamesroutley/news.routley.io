<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/rxi/sj.h">Original</a>
    <h1>Sj.h: A tiny little JSON parsing library in ~150 lines of C99</h1>
    
    <div id="readability-page-1" class="page"><div dir="auto" data-snippet-clipboard-copy-content="char *json_text = &#34;{ \&#34;x\&#34;: 10, \&#34;y\&#34;: 20, \&#34;w\&#34;: 30, \&#34;h\&#34;: 40 }&#34;;

typedef struct { int x, y, w, h; } Rect;

bool eq(sj_Value val, char *s) {
    size_t len = val.end - val.start;
    return strlen(s) == len &amp;&amp; !memcmp(s, val.start, len);
}

int main(void) {
    Rect rect = {0};

    sj_Reader r = sj_reader(json_text, strlen(json_text));
    sj_Value obj = sj_read(&amp;r);

    sj_Value key, val;
    while (sj_iter_object(&amp;r, obj, &amp;key, &amp;val)) {
        if (eq(key, &#34;x&#34;)) { rect.x = atoi(val.start); }
        if (eq(key, &#34;y&#34;)) { rect.y = atoi(val.start); }
        if (eq(key, &#34;w&#34;)) { rect.w = atoi(val.start); }
        if (eq(key, &#34;h&#34;)) { rect.h = atoi(val.start); }
    }

    printf(&#34;rect: { %d, %d, %d, %d }\n&#34;, rect.x, rect.y, rect.w, rect.h);
    return 0;
}"><pre><span>char</span> <span>*</span><span>json_text</span> <span>=</span> <span>&#34;{ \&#34;x\&#34;: 10, \&#34;y\&#34;: 20, \&#34;w\&#34;: 30, \&#34;h\&#34;: 40 }&#34;</span>;

<span>typedef</span> <span>struct</span> { <span>int</span> <span>x</span>, <span>y</span>, <span>w</span>, <span>h</span>; } <span>Rect</span>;

<span>bool</span> <span>eq</span>(<span>sj_Value</span> <span>val</span>, <span>char</span> <span>*</span><span>s</span>) {
    <span>size_t</span> <span>len</span> <span>=</span> <span>val</span>.<span>end</span> <span>-</span> <span>val</span>.<span>start</span>;
    <span>return</span> <span>strlen</span>(<span>s</span>) <span>==</span> <span>len</span> <span>&amp;&amp;</span> !<span>memcmp</span>(<span>s</span>, <span>val</span>.<span>start</span>, <span>len</span>);
}

<span>int</span> <span>main</span>(<span>void</span>) {
    <span>Rect</span> <span>rect</span> <span>=</span> {<span>0</span>};

    <span>sj_Reader</span> <span>r</span> <span>=</span> <span>sj_reader</span>(<span>json_text</span>, <span>strlen</span>(<span>json_text</span>));
    <span>sj_Value</span> <span>obj</span> <span>=</span> <span>sj_read</span>(<span>&amp;</span><span>r</span>);

    <span>sj_Value</span> <span>key</span>, <span>val</span>;
    <span>while</span> (<span>sj_iter_object</span>(<span>&amp;</span><span>r</span>, <span>obj</span>, <span>&amp;</span><span>key</span>, <span>&amp;</span><span>val</span>)) {
        <span>if</span> (<span>eq</span>(<span>key</span>, <span>&#34;x&#34;</span>)) { <span>rect</span>.<span>x</span> <span>=</span> <span>atoi</span>(<span>val</span>.<span>start</span>); }
        <span>if</span> (<span>eq</span>(<span>key</span>, <span>&#34;y&#34;</span>)) { <span>rect</span>.<span>y</span> <span>=</span> <span>atoi</span>(<span>val</span>.<span>start</span>); }
        <span>if</span> (<span>eq</span>(<span>key</span>, <span>&#34;w&#34;</span>)) { <span>rect</span>.<span>w</span> <span>=</span> <span>atoi</span>(<span>val</span>.<span>start</span>); }
        <span>if</span> (<span>eq</span>(<span>key</span>, <span>&#34;h&#34;</span>)) { <span>rect</span>.<span>h</span> <span>=</span> <span>atoi</span>(<span>val</span>.<span>start</span>); }
    }

    <span>printf</span>(<span>&#34;rect: { %d, %d, %d, %d }\n&#34;</span>, <span>rect</span>.<span>x</span>, <span>rect</span>.<span>y</span>, <span>rect</span>.<span>w</span>, <span>rect</span>.<span>h</span>);
    <span>return</span> <span>0</span>;
}</pre></div><p dir="auto">This is free and unencumbered software released into the public domain. See
<a href="https://blog.plover.com/rxi/sj.h/blob/master/LICENSE">LICENSE</a> for details.</p></div>
  </body>
</html>
