<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/shriram/anonymous-recursive-function">Original</a>
    <h1>Anonymous recursive functions in Racket</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">

<p dir="auto">Some languages, like PowerShell, have “anonymous recursive
functions”. That is, normally, a function needs to use a name to refer
to itself to recur. But “anonymous recursion” means the language has
some special mechanism by which the function can refer to itself
without having to explicitly introduce a name. In some contexts, this
is called an <em>anaphoric</em> reference.</p>

<p dir="auto">Here we show how we can easily implement this feature in Racket. The
file <a href="https://github.com/shriram/anonymous-recursive-function/blob/main/anon-rec.rkt"><code>anon-rec.rkt</code></a> implements a macro called
<code>lam/anon♻️</code>, short for &#34;lambda with anonymous recursion&#34;.
This specifically binds the name <code>$MyInvocation</code>, to mimic the syntax
of PowerShell, though the <code>$</code> here does not mean anything special.</p>

<p dir="auto">The file <a href="https://github.com/shriram/anonymous-recursive-function/blob/main/client.rkt"><code>client.rkt</code></a> shows several uses of increasing
and varying complexity:</p>
<ul dir="auto">
<li>
<p dir="auto"><code>fact</code> shows a standard factorial definition.</p>
</li>
<li>
<p dir="auto">How can we confirm that <code>$MyInvocation</code> is really bound to the right
invocation? So <code>lucas-or-fib</code> is essentially a glorified version of
the Fibonacci function, but the same body (which recurs using
<code>$MyInvocation</code>) can also be used for the Lucas sequence given
different initial values. This shows that the recursive function is
bound correctly.</p>
</li>
<li>
<p dir="auto"><code>grid</code> shows that the correct binding occurs even in nested
settings.</p>
</li>
<li>
<p dir="auto"><code>range</code> is a peculiar way to write a standard range-generating
function. It exists only to check that “varargs” works properly with
<code>lam/anon♻️</code>.</p>
</li>
</ul>
<p dir="auto">(In case you&#39;re wondering, I added <code>lam/anon♻️</code> to the <code>lambda</code>-like keywords
list of DrRacket&#39;s Indenting configuration. That&#39;s why the layout is so nice.)</p>

<p dir="auto">Jokes aside, why is this useful?</p>
<p dir="auto">I&#39;ve often had the experience that I&#39;m writing
some helper function as a <code>lambda</code>, then half-way through realize it would be
nice if the function could recur. But on its own a <code>lambda</code> can&#39;t recur, because
it&#39;s <em>anonymous</em>, and recursion requires a name. So the traditional solution is
to rewrite the program: e.g., introduce a <code>letrec</code>, give a name, make this <code>lambda</code>
its right-hand side expression, then use tha name in the <code>lambda</code>s body.</p>
<p dir="auto">All this
requires a fair bit of boring editing. It significantly increases the indentation
of the <code>lambda</code> body (which sometimes makes you want to add newlines). In addition,
the body of that <code>letrec</code> then usually just returns the name, which is a confusing
pattern the first few times you see it. And all this might be happening inside
the argument to a function. That&#39;s a lot of effort.</p>
<p dir="auto">This avoids that problem. When you hit that point half-way through, you can leave
everything intact and just…recur. Of course, it would be nicer if you could give a
<em>meaningful</em> name to the recursive function. That way, also, you can choose which
function you want to recur on, not only the nearest enclosing named one.</p>

<p dir="auto">If you&#39;re a Racket programmer, be aware there&#39;s already a good solution for this!
The
<a href="https://docs.racket-lang.org/mzlib/mzlib_etc.html#%28form._%28%28lib._mzlib%2Fetc..rkt%29._rec%29%29" rel="nofollow"><code>rec</code> form</a>
already does something very much like this. For instance, say you were half-way into
writing</p>
<div data-snippet-clipboard-copy-content="(λ (n)
    (if (zero? n)
        1
        (* n •"><pre><code>(λ (n)
    (if (zero? n)
        1
        (* n •
</code></pre></div>
<p dir="auto">whoops! Well, you can now <em>wrap</em> it in <code>rec</code>, choosing the name you&#39;d like:</p>
<div data-snippet-clipboard-copy-content="(rec fact
  (λ (n)
    (if (zero? n)
        1
        (* n (fact (sub1 n))))))"><pre><code>(rec fact
  (λ (n)
    (if (zero? n)
        1
        (* n (fact (sub1 n))))))
</code></pre></div>
<p dir="auto">The virtues of this solution are:</p>
<ul dir="auto">
<li>This still evaluates to a function, as the <code>lambda</code> itself would have—indeed, critically, the same function.</li>
<li>You can leave the body of the <code>lambda</code> unchanged (as with <code>letrec</code>), making changes on the outside.
(This is in contrast to turning the <code>lambda</code> into a <code>define</code>.)</li>
<li>Your indentation increases only slightly.</li>
<li>You get to pick a meaningful name.</li>
<li>You get to retain all the <a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" rel="nofollow">bells-and-whistles</a> of <code>lambda</code>; <code>rec</code> is orthogonal to that.</li>
</ul>

<ul dir="auto">
<li>
<p dir="auto">James Brundage, “MrPowerShell”,
<a href="https://bsky.app/profile/mrpowershell.com/post/3lxx3yk4l5k2t" rel="nofollow">showed me</a>
the PowerShell
<a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_automatic_variables?view=powershell-7.5#myinvocation" rel="nofollow"><code>$MyInvocation</code></a>
on Bluesky.</p>
</li>
<li>
<p dir="auto">Ali M, <code>@deadmarshal</code> on <code>mastodon.social</code>,
<a href="https://mastodon.social/@deadmarshal/115144121899754304" rel="nofollow">pointed out</a>
that Forth has a keyword named
<a href="https://forth-standard.org/standard/core/RECURSE" rel="nofollow"><code>RECURSE</code></a>
that does this.</p>
</li>
</ul>
</article></div></div>
  </body>
</html>
