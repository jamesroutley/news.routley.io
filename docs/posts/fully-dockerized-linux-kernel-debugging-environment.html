<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/0xricksanchez/like-dbg">Original</a>
    <h1>Fully Dockerized Linux kernel debugging environment</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><strong>VERY MUCH IN POC/WIP STATE</strong></p>
<p dir="auto">This repository aims at automating the boring steps when trying to set up a Linux kernel debugging environment.
All steps from building the kernel to running the kernel and attaching the debugger are transparently done inside docker containers to keep system requirements minimal.
Currently there&#39;s a dedicated docker container for every step:</p>
<ul dir="auto">
<li>Building the kernel</li>
<li>Creating a root file system to use with the earlier build kernel</li>
<li>A debuggee container that launches QEMU with our custom kernel + rootfs</li>
<li>A debug container that houses the debugging logic</li>
</ul>
<h2 dir="auto"><a id="user-content-caveats" aria-hidden="true" href="#caveats"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Caveats</h2>
<ul>
<li> Currently only <em>x86_64</em> and <em>arm64</em> Linux kernel builds are supported</li>
<li> Only recent kernel builds will likely succeed building due to how the requirements for the toolchain differs between versions</li>
<li> No android kernel support right now</li>
<li> Fine-tuning of GDB environment (e.g. custom breakpoints) missing</li>
</ul>
<h2 dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h2>
<ul>
<li> Automated kernel/root file system builds based on <code>config.ini</code>
<ul>
<li> Multi-arch: <code>x86_64</code> and <code>arm64</code></li>
<li> Kernel compilation modes (generic, syzkaller) + custom flag support</li>
<li> Building of kernel from
<ul>
<li> Commit id</li>
<li> Release tag, or</li>
<li> <em>&lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;</em>-version</li>
</ul>
</li>
<li> Applying patch files</li>
</ul>
</li>
<li> Debugger powered by: GDB + <a href="https://github.com/hugsy/gef">gef</a></li>
<li> QEMU runtime options for the kernel like <code>kaslr</code>, <code>smep</code>, <code>smap</code>, <code>kpti</code>, and others</li>
<li> Re-use builds
<ul>
<li> Images</li>
<li> root file systems</li>
<li> kernels</li>
</ul>
</li>
<li> Minimal host system requirements</li>
</ul>
<h2 dir="auto"><a id="user-content-requirements" aria-hidden="true" href="#requirements"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Requirements</h2>
<ul dir="auto">
<li><code>docker</code> (may work with <code>podman</code> as well)</li>
<li><code>tmux</code></li>
<li><code>python&gt;=3.7</code>
<ul dir="auto">
<li><code>venv</code></li>
</ul>
</li>
</ul>
<h2 dir="auto"><a id="user-content-configuration" aria-hidden="true" href="#configuration"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Configuration</h2>
<p dir="auto">Everything is configured in the <code>config.ini</code>
Some fields should not be altered but in general the fields that are of interest to create a custom-tailored kernel debugging environment should be self explanatory.</p>
<p dir="auto">Once you&#39;re set, executing the commands below should drop you into a 3-tile tmux configuration with a booted kernel in QEMU, an attached
GDB debugger, and one terminal for free allocation</p>
<div data-snippet-clipboard-copy-content="$ tmux
$ python3 -m venv .like-dbg
$ source .like-dbg/bin/activate
$ python3 -m pip install --upgrade pip
$ python3 -m pip install -r requirements.txt
$ python3 start_kgdb.py"><pre>$ tmux
$ python3 -m venv .like-dbg
$ <span>source</span> .like-dbg/bin/activate
$ python3 -m pip install --upgrade pip
$ python3 -m pip install -r requirements.txt
$ python3 start_kgdb.py</pre></div>
<h2 dir="auto"><a id="user-content-showcase" aria-hidden="true" href="#showcase"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Showcase</h2>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/0xricksanchez/like-dbg/blob/main/img/example.png"><img src="https://github.com/0xricksanchez/like-dbg/raw/main/img/example.png" alt="img/example.png"/></a></p>
</article>
          </div></div>
  </body>
</html>
