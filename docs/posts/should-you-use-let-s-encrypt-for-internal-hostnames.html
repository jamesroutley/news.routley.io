<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://shkspr.mobi/blog/2022/01/should-you-use-lets-encrypt-for-internal-hostnames/">Original</a>
    <h1>Should you use Let&#39;s Encrypt for internal hostnames?</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="https://schema.org/articleBody">
<p>Julien Savoie has written a brilliant post explaining <a href="https://jsavoie.github.io/2021/06/01/letsencrypt.html">how you can enable https on your <em>intra</em>net</a>.</p><p>This is useful for several reasons. It means your employees aren&#39;t constantly fighting browser warnings when trying to submit stuff internally. All your http traffic is encrypted. You don&#39;t need to install a self-generated root certificate on devices. Lovely!</p><p>But there&#39;s a downside. Every TLS certificate created by Let&#39;s Encrypt is recorded in a <a href="https://letsencrypt.org/docs/ct-logs/">Certificate Transparency log</a>.  These CT logs are primarily to detect <a href="https://certificate.transparency.dev/">maliciously or mistakenly issued certificates</a>. For example, you can look through them and see that someone unauthorised has created a cert for your domain - or its sub-domains.</p><p>But there is a downside. The CT logs are <em>public</em> and can be searched. Here&#39;s <a href="https://crt.sh/?q=twitter.com">all the certificates issued for Twitter&#39;s sub-domains</a>.</p><p>There are a few ways that this can be dangerous for use with <em>internal</em> services.</p><p>Firstly, it aides reconnaissance for attackers. Having a &#34;map&#34; of your internal infrastructure is useful. Especially if you have &#34;obviously&#34; named servers like <code>exchange.example.com</code> or <code>customerdata.example.com</code>.  Also handy for social engineering - who else but someone internal would know that <code>gandalf.example.com</code> was a valid server?</p><p>Secondly, it might expose some vulnerabilities - depending on how you name things. Let&#39;s hope you don&#39;t have <code>log4j.example.com</code>!</p><p>Thirdly, there&#39;s the potential for espionage. Do you want your competitors knowing that you&#39;ve got <code>olympics-campaign.staging.example.com</code>?</p><p>I&#39;m sure you can think of a few other ways this could be used for mischief and mayhem.</p><p>As I wrote a few years ago, &#34;<a href="https://shkspr.mobi/blog/2017/11/theres-no-https-for-the-internet-of-things/">There&#39;s no HTTPS for the Internet of Things</a>&#34;. Internal networks which only have IP addresses cannot use TLS certificates. OK, so you decide to have an internal DNS - now the whole world knows you have <code>doorbell-model-xyz.myhome.example.com</code>!</p><p>The only real answer to this is to use <a href="https://community.letsencrypt.org/t/acme-v2-production-environment-wildcards/55578">Wildcard Certificates</a>.  You can get a TLS certificate for <code>*.internal.example.com</code></p><p>This requires setting up a <a href="https://letsencrypt.org/docs/challenge-types/#dns-01-challenge">DNS-01 Challenge</a> - which can be more difficult to configure and has some non-obvious risks. And, sadly, <a href="https://blog.sean-wright.com/wildcard-certs-not-quite-the-star/">Wildcard certificates come with their own difficulties</a>.</p><h2 id="recap"><a href="#recap">Recap</a></h2><p>I don&#39;t think there&#39;s a good solution to this.</p><ul><li>Self-signed certificates require something to be installed on all clients. Not always possible with BYOD.</li><li>Named LE certificates expose details of your infrastructure which you may wish to keep private.</li><li>Wildcard certificates require a heightened level of co-ordination and management.</li></ul><p>These problems <a href="https://news.ycombinator.com/item?id=19353294">have all been discussed before</a>. But I can&#39;t help but wishing that there was something obvious I&#39;m missing.</p><p>How would you solve this knotty problem?</p></div></div>
  </body>
</html>
