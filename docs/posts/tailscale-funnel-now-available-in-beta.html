<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tailscale.com/blog/tailscale-funnel-beta/">Original</a>
    <h1>Tailscale Funnel now available in beta</h1>
    
    <div id="readability-page-1" class="page"><div>
      <p>Tailscale Funnel, a tool that lets you share a web server on your private tailnet with the public internet, is now available as a beta feature for all users. With Funnel enabled, you can share access to a local development server, test a webhook, or even host a blog.</p>
<figure>
		<video playsinline="" muted="" loop="" autoplay="">
		<source type="video/mp4" src="https://stream.mux.com/6NNY6AjFiUUBlJM2QddHGZk65ITYGL7Z/high.mp4"/>
		</video>
		</figure>
<p>Funnel provides a DNS name tied to your node that becomes publicly accessible once enabled. When a user on the public internet requests your service, we use a secure Tailscale tunnel to forward those requests along.</p>
<p>Given our commitment to user privacy, we’ve set up Funnel so we never see decrypted packets going to and from your service. All connections require TLS encryption, and Tailscale will automatically provision valid certificates with which your node does the TLS termination. Because Funnel addresses are subdomains of ts.net, we could technically acquire valid certificates and do that termination server-side, but we believe that preserving user privacy is more important. You can always confirm we haven’t obtained certificates for Funnel services by reviewing the public <a href="https://en.wikipedia.org/wiki/Certificate_Transparency">Certificate Transparency</a> logs.</p>
<p>To get started, point Tailscale to your local development server and turn on Funnel. For example:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>$ tailscale serve https / http://localhost:3000
</span></span><span><span>$ tailscale funnel <span>443</span> on
</span></span></code></pre></div><p>Your local server is now reachable at its DNS name over the internet. You can turn Funnel on and off using the <code>tailscale funnel</code> command. To view the status of your Funnel, run:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>$ tailscale funnel status
</span></span><span><span>https://example.pango-lin.ts.net <span>(</span>Funnel on<span>)</span>
</span></span><span><span><span>|</span>-- / proxy http://127.0.0.1:3000
</span></span></code></pre></div><p>It’s a simple syntax, but a powerful tool that we’re hoping opens up a lot of possibilities for Tailscale users. We’ve got some examples of usage ideas for Funnel and <code>tailscale serve</code> in our docs; for programmatic uses beyond that, our experimental <code>tsnet</code> library can <a href="https://tailscale.dev/blog/embedded-funnel">embed Funnel</a> in your Go app.</p>
<p>To learn more about how to set up Funnel on your own tailnet, <a href="https://tailscale.com/kb/1223/tailscale-funnel/">check out our documentation</a>, or get your hands dirty with a <a href="https://tailscale.dev/blog/funnel-101">detailed 101-style walk-through</a> on our Tailscale community site about configuring Funnel to receive GitHub webhooks.</p>
<h2 id="funnel-for-the-whole-family">Funnel for the whole family</h2>
<p>That covers most of the mechanics of setting up and using Funnel on your device, but we know developers will be curious about how it works and what happens on Tailscale’s end. The tl;dr: When you turn on Funnel, we create public DNS records for your <code>node.tailnet.ts.net</code> name that points to a set of ingress servers we operate around the world, and then we give those servers very limited access to your tailnet — just enough to offer a TCP connection, which your nodes can accept or reject. We go into a lot more detail in <a href="https://tailscale.com/blog/introducing-tailscale-funnel/#how-it-works">our Funnel announcement post</a>, and you can always find more information in the  <a href="https://tailscale.com/kb/1223/tailscale-funnel/">Funnel section of our knowledge base</a>.</p>
<h2 id="whats-new-since-alpha">What’s new since alpha</h2>
<p>We’ve learned a lot since <a href="https://tailscale.com/blog/introducing-tailscale-funnel/">launching Funnel as an invite-only alpha feature last November</a>, and thanks to great feedback from alpha testers, we’ve been able to make a few key improvements. </p>
<h3 id="dns">DNS</h3>
<blockquote>
<p>It’s not DNS</p>
</blockquote>
<p>Throughout the alpha period, we’ve been improving the way we handle DNS requests and how we configure public records.</p>
<p>Tailscale offers MagicDNS to resolve DNS requests for the names of nodes on your tailnet. This is a handy feature since remembering names (<code>amelie.pango-lin.ts.net</code>) is easier than remembering CGNAT IP addresses (<code>100.x.y.z</code>). Since launching Funnel alpha, we now need to forward <code>*.ts.net</code> DNS requests to a public resolver. (Before Funnel, we wouldn’t resolve DNS queries from outside your current tailnet for <code>ts.net</code> names.)</p>
<p>In addition to splitting DNS, we need a system to track active Funnel nodes and create or update their DNS records to point at the nearest geo-local ingress server. We have a number of ingress servers across the globe that handle inbound connections from the internet and forward them over a secure tunnel to your node. We pick the closest (by latency) ingress server to your Funnel-enabled node. We also keep it up to date in case you’re on the go!</p>
<p>The whole process from enabling Funnel to assigning the right public DNS record revealed a number of opportunities for improving the way we send updates across tailnets. We need to coordinate with the control plane to inform the ingress servers which in turn kick off a DNS process and send an update to your node. We sometimes call this “waking up nodes,” and since the alpha launch, we’ve fixed a few bugs and optimized the number of updates.</p>
<h3 id="cli">CLI</h3>
<p>One of the best ways to test a user interface is to use it! For our alpha release we released the initial set of CLI commands, and we’ve received feedback from the community (and employees!) on how we could improve the ergonomics and better separate Funnel from the equally useful <code>tailscale serve</code> command.</p>
<p>In Tailscale v1.38.1, we released the overhauled set of commands. We’ve updated how you start local servers via <code>tailscale serve</code>, and we’ve separated Funnel into its own command, <code>tailscale funnel</code>.</p>
<p>In updating the CLI commands we tried to find the right balance between clarity and brevity. Some commands ended up being shorter than their equivalent with the old interface — and we hope you agree that the new syntax is just as clearly understood.</p>
<p>Here are a few examples of before and after:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span><span># Start an HTTPS server on port 443, forwarding to a local server running at http://localhost:3000</span>
</span></span><span><span>
</span></span><span><span><span># both: default to port 443 for HTTPS</span>
</span></span><span><span><span>(</span>OLD<span>)</span> $ tailscale serve / proxy http://localhost:3000
</span></span><span><span><span>(</span>NEW<span>)</span> $ tailscale serve https / http://localhost:3000
</span></span><span><span>
</span></span><span><span><span># The same, but using an alternate port 8443</span>
</span></span><span><span><span>(</span>OLD<span>)</span> $ tailscale serve --serve-port<span>=</span><span>8443</span> / proxy http://localhost:3000
</span></span><span><span><span>(</span>NEW<span>)</span> $ tailscale serve https:8443 / http://localhost:3000
</span></span><span><span>
</span></span><span><span><span># Start an HTTPS server on port 443, serving files from /home/amelie/docs</span>
</span></span><span><span><span>(</span>OLD<span>)</span> $ tailscale serve / path /home/amelie/docs
</span></span><span><span><span>(</span>NEW<span>)</span> $ tailscale serve https / /home/amelie/docs
</span></span><span><span>
</span></span><span><span><span># Forward incoming TCP connections on port 10000 to a local TCP server on port 22 </span>
</span></span><span><span><span># (e.g. to run OpenSSH in parallel with Tailscale SSH):</span>
</span></span><span><span><span>(</span>OLD<span>)</span> $ tailscale serve --serve-port<span>=</span><span>10000</span> tcp <span>22</span>
</span></span><span><span><span>(</span>NEW<span>)</span> $ tailscale serve tcp:10000 tcp://localhost:22
</span></span><span><span>
</span></span><span><span><span># You can now use any valid port for a `tailscale serve` command.</span>
</span></span><span><span><span># With the old CLI it was restricted to valid Funnel ports (443, 8443, 10000)</span>
</span></span><span><span>
</span></span><span><span><span>(</span>OLD<span>)</span> $ tailscale serve --serve-port<span>=</span><span>222</span> tcp <span>22</span> <span># ERROR!</span>
</span></span><span><span><span>(</span>NEW<span>)</span> $ tailscale serve tcp:2222 tcp://localhost:22
</span></span></code></pre></div><h2 id="now-in-beta">Now in beta</h2>
<p>Tailscale Funnel is available in beta, which means you no longer need an invite to use it, but you will need to enable it in <a href="https://login.tailscale.com/admin/settings/general">your tailnet’s settings</a>, and you’ll need to be running Tailscale 1.38.3 or later.  If you want to share how you’re using Funnel or other Tailscale features, we’d love to hear from you at <a href="mailto:devrel@tailscale.com">devrel@tailscale.com</a>!</p>
    </div></div>
  </body>
</html>
