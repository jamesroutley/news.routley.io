<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.theregister.com/2024/02/13/dnssec_vulnerability_internet/">Original</a>
    <h1>Just one bad packet can bring down a vulnerable DNS server thanks to DNSSEC</h1>
    
    <div id="readability-page-1" class="page"><div id="body">
<p>A single packet can exhaust the processing capacity of a vulnerable DNS server, effectively disabling the machine, by exploiting a 20-plus-year-old design flaw in the DNSSEC specification.</p>
<p>That would make it trivial to take down a DNSSEC-validating DNS resolver that has yet to be patched, upsetting all the clients relying on that service and make it seem as though websites and apps were offline.</p>
<p>The academics who found this flaw – associated with the German National Research Center for Applied Cybersecurity (ATHENE) in Darmstadt – claimed DNS server software makers briefed about the vulnerability described it as &#34;the worst attack on DNS ever discovered.&#34;</p>

<p>Identified by Professor Haya Schulmann and Niklas Vogel of the Goethe University Frankfurt; Elias Heftrig of Fraunhofer SIT; and Professor Michael Waidner at the Technical University of Darmstadt and Fraunhofer SIT, the security hole has been named <a target="_blank" rel="nofollow" href="https://www.presseportal.de/pm/173495/5713546">KeyTrap</a>, designated <a target="_blank" rel="nofollow" href="https://kb.isc.org/docs/cve-2023-50387">CVE-2023-50387</a>, and assigned a CVSS severity rating of 7.5 out of 10.</p>
<p>As of December 2023, approximately 31 percent of web clients worldwide used DNSSEC-validating DNS resolvers and, like other applications relying on those systems, would feel the effects of a KeyTrap attack: With those DNS servers taken out by the flaw, clients relying on them would be unable to resolve domain and host names to IP addresses to use, resulting in a loss of connectivity.</p>

    

<p>The researchers said lone DNS packets exploiting KeyTrap could stall public DNSSEC-validated DNS services, such as those provided by Google and Cloudflare, by making them do calculations that overtax server CPU cores.</p>

        


        

<p>This disruption of DNS could not only deny people&#39;s access to content but could also interfere with other systems, including spam defenses, cryptographic defenses (PKI), and inter-domain routing security (RPKI), the researchers assert.</p>
<p>&#34;Exploitation of this attack would have severe consequences for any application using the Internet including unavailability of technologies such as web-browsing, e-mail, and instant messaging,&#34; they claimed. &#34;With KeyTrap, an attacker could completely disable large parts of the worldwide internet.&#34;</p>

        

<p>A non-public technical paper on the vulnerability provided to <em>The Register</em>, titled, &#34;The KeyTrap Denial-of-Service Algorithmic Complexity Attacks on DNS,&#34; describes how an assault would be carried out. It basically involves asking a vulnerable DNSSEC-validating DNS resolver to look up an address that causes the server to contact a malicious nameserver that sends a reply that causes the resolver to consume most or all of its own CPU resources.</p>
<blockquote>

<p>With KeyTrap, an attacker could completely disable large parts of the worldwide Internet</p>
</blockquote>
<p>&#34;To initiate the attacks our adversary causes the victim resolver to look up a record in its malicious domain,&#34; the due-to-be-published paper states. &#34;The attacker’s nameserver responds to the DNS queries with a malicious record set (RRset), according to the specific attack vector and zone configuration.&#34;</p>
<p>The attack works, the paper explains, because <a target="_blank" rel="nofollow" href="https://datatracker.ietf.org/doc/rfc2535/">the DNSSEC spec</a> follows <a target="_blank" rel="nofollow" href="https://www.cs.tufts.edu/comp/117/assts/postel">Postel’s Law</a>: &#34;The nameservers should send all the available cryptographic material, and the resolvers should use any of the cryptographic material they receive until the validation is successful.&#34;</p>
<p>This requirement, to ensure availability, means DNSSEC-validating DNS resolvers can be forced to do a lot of work if presented with colliding key-tags and colliding keys that must be validated.</p>
<p>&#34;Our complexity attacks are triggered by feeding the DNS resolvers with specially crafted DNSSEC records, which are constructed in a way that exploits validation vulnerabilities in cryptographic validation logic,&#34; the paper explains.</p>

        

<p>&#34;When the DNS resolvers attempt to validate the DNSSEC records they receive from our nameserver, they get stalled. Our attacks are extremely stealthy, being able to stall resolvers between 170 seconds and 16 hours (depending on the resolver software) with a single DNS response packet.&#34;</p>
<ul>

<li><a href="https://www.theregister.com/2023/01/19/google_dns_queries/">If your DNS queries LoOk liKE tHIs, it&#39;s not a ransom note, it&#39;s a security improvement</a></li>

<li><a href="https://www.theregister.com/2020/02/13/iana_dnssec_ksk_delay/">Internet&#39;s safe-keepers forced to postpone crucial DNSSEC root key signing ceremony – no, not a hacker attack, but because they can&#39;t open a safe</a></li>

<li><a href="https://www.theregister.com/2016/02/23/dnssec_more_problem_than_solution/">Is DNSSEC causing more problems than it solves?</a></li>

<li><a href="https://www.theregister.com/2024/01/29/icann_internal_tld/">ICANN proposes creating .INTERNAL domain to do the same job as 192.168.x.x</a></li>
</ul>
<p>The ATHENE boffins said they worked with all relevant vendors and major public DNS providers to privately disclose the vulnerability so a coordinated patch release would be possible. The last patch was finished today.</p>
<p>&#34;We are aware of this vulnerability and rolled out a fix in coordination with the reporting researchers,&#34; a Google spokesperson told <em>The Register</em>. &#34;There is no evidence of exploitation and no action required by users at this time.&#34;</p>
<p>Network research lab NLnet Labs published <a target="_blank" rel="nofollow" href="https://nlnetlabs.nl/downloads/unbound/patch_CVE-2023-50387_CVE-2023-50868.diff">a patch</a> for its Unbound DNS software, addressing two vulnerabilities, one of which is KeyTrap. The other bug fixed, <a target="_blank" rel="nofollow" href="https://nlnetlabs.nl/downloads/unbound/CVE-2023-50387_CVE-2023-50868.txt">CVE-2023-50868</a>, referred to as the NSEC3 vulnerability, also allows denial of service through CPU exhaustion.</p>
<p>&#34;The KeyTrap vulnerability works by using a combination of keys (also colliding keys), signatures and number of RRSETs on a malicious zone,&#34; NLnet Labs <a target="_blank" rel="nofollow" href="https://nlnetlabs.nl/news/2024/Feb/13/unbound-1.19.1-released/">wrote</a>. &#34;Answers from that zone can force a DNSSEC validator down a very CPU intensive and time costly validation path.&#34;</p>
<p>PowerDNS, meanwhile, has an update <a target="_blank" rel="nofollow" href="https://doc.powerdns.com/recursor/security-advisories/powerdns-advisory-2024-01.html">here</a> to thwart KeyTrap exploitation.</p>
<p>&#34;An attacker can publish a zone that contains crafted DNSSEC related records. While validating results from queries to that zone using the RFC mandated algorithms, the Recursor’s resource usage can become so high that processing of other queries is impacted, resulting in a denial of service,&#34; the team wrote. &#34;Note that any resolver following the RFCs can be impacted, this is not a problem of this particular implementation.&#34;</p>
<p>The fix for CVE-2023-50387 is just <a target="_blank" rel="nofollow" href="https://seclists.org/oss-sec/2024/q1/125">one of six</a> vulnerabilities addressed in Internet Systems Consortium&#39;s BIND 9 DNS software. The others include:</p>
<ul>
<li><a target="_blank" rel="nofollow" href="https://kb.isc.org/docs/cve-2023-4408">CVE-2023-4408</a>: Parsing large DNS messages may cause excessive CPU load;</li>

<li><a target="_blank" rel="nofollow" href="https://kb.isc.org/docs/cve-2023-5517">CVE-2023-5517</a>: Querying RFC 1918 reverse zones may cause an assertion failure when &#34;nxdomain-redirect&#34; is enabled;</li>

<li><a target="_blank" rel="nofollow" href="https://kb.isc.org/docs/cve-2023-5679">CVE-2023-5679</a>: Enabling both DNS64 and serve-stale may cause an assertion failure during recursive resolution;</li>

<li><a target="_blank" rel="nofollow" href="https://kb.isc.org/docs/cve-2023-6516">CVE-2023-6516</a>: Specific recursive query patterns may lead to an out-of-memory condition;</li>

<li><a target="_blank" rel="nofollow" href="https://kb.isc.org/docs/cve-2023-50868">CVE-2023-50868</a>: Preparing an NSEC3 closest encloser proof can exhaust CPU resources.</li>
</ul>
<p>The requirements for the KeyTrap vulnerability date all the way back to 1999 from the now obsolete RFC 2535, according to the research team that identified it. And by 2012, these elements appeared in <a target="_blank" rel="nofollow" href="https://datatracker.ietf.org/doc/rfc6781/">RFC 6781</a> and <a target="_blank" rel="nofollow" href="https://datatracker.ietf.org/doc/rfc6840/">RFC 6840</a>, the implementation requirements for DNSSEC validation.</p>
<blockquote>

<p>One packet suffices. You don&#39;t have to do more than that to disconnect an entire network</p>
</blockquote>
<p>Since at least August 2000 – more than 23 years ago – KeyTrap has been present in the BIND 9 DNS resolver, and it surfaced seven years later in the Unbound DNS resolver.</p>
<p>Dr Haya Shulman, a professor of computer science and one of the academics behind the KeyTrap research, told <em>The Register</em> in a phone interview the attack is simple and can be carried out by encoding it in a <a href="https://dnsinstitute.com/documentation/dnssec-guide/ch04s02.html#signing-verify-zone-file">zone file</a>.</p>
<p>&#34;The vulnerability is actually something that&#39;s recommended in the DNSSEC standard,&#34; Prof Shulman explained. &#34;One packet suffices. You don&#39;t have to do more than that to disconnect an entire network.&#34;</p>
<p>Prof Shulman said the patches that have been issued by various vendors break the standard. &#34;The problem is this attack is not easy to solve,&#34; she said. &#34;If we launch it against a patched resolver, we still get 100 percent CPU usage but it can still respond.&#34;</p>
<p>The ATHENE team observed that while the flaw remained undetected for decades, its obscurity isn&#39;t surprising because DNSSEC validation requirements are so complicated. So too is mitigating the vulnerability and completely eliminating it will require a revision of the DNSSEC standard. ®</p>                                


                    </div></div>
  </body>
</html>
