<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://abenezer.org/blog/hyrum-law-in-golang">Original</a>
    <h1>Hyrum‚Äôs Law in Golang</h1>
    
    <div id="readability-page-1" class="page"><div><p>I recently stumbled upon an <a target="_blank" rel="noopener noreferrer" href="https://github.com/golang/go/blob/5123f38e050c5ee7130d459ea247d998a838b5a1/src/net/http/request.go#L1199">intriguing comment</a>
while exploring the Go codebase.</p>
<blockquote><p>&#34;Due to Hyrum&#39;s law, this text cannot be changed.&#34;</p></blockquote>
<pre><code><span><span>func</span> <span>(</span>e <span>*</span>MaxBytesError<span>)</span> <span>Error</span><span>(</span><span>)</span> <span>string</span> <span>{</span>
</span><span>	
</span><span>	<span>return</span> <span>&#34;http: request body too large&#34;</span>
</span><span><span>}</span>
</span></code></pre>
<ul>
<li>Prior to this, I had never heard of Hyrum&#39;s law.</li>
<li>A quick search revealed that it is a principle
named after <a target="_blank" rel="noopener noreferrer" href="https://www.hyrumwright.org/">Hyrum Wright</a>, a software engineer at Google.</li>
</ul>
<p>The <a target="_blank" rel="noopener noreferrer" href="https://www.hyrumslaw.com/">&#34;law&#34;</a> is simple:</p>
<blockquote><p>With a sufficient number of users of an API, it does not matter what you promise in the contract: all
observable behaviors of your system will be depended on by somebody.</p></blockquote>
<p>In other words, any behavior that can be observed in code ‚Äî whether intentional or accidental ‚Äî
will eventually become something that someone, somewhere, relies on.</p>
<p>So in the code above, the author is acknowledging that the error message cannot be changed because
it is likely being relied upon by someone, somewhere. Even though it might seem trivial to tweak the
error message, doing so could cause unintended issues for anyone relying on this specific message.
In this case, a seemingly small change could break existing code where someone depends on the exact
phrasing of &#34;http: request body too large&#34;.</p>
<p>For example, here are some open source codebases that will be affected if the error message is changed:</p>
<ul>
<li><a target="_blank" rel="noopener noreferrer" href="https://grep.app/search?q=http%3A%20request%20body%20too%20large&amp;filter%5Blang%5D%5B0%5D=Go">http: request body too large</a></li>
</ul>
<p>This wasn&#39;t the only instance. I found similar comments referencing Hyrum&#39;s Law in Go&#39;s
<a target="_blank" rel="noopener noreferrer" href="https://github.com/golang/go/tree/5123f38e050c5ee7130d459ea247d998a838b5a1/src/crypto/rsa"><code>crypto/rsa</code></a>
and <a target="_blank" rel="noopener noreferrer" href="https://github.com/golang/go/tree/5123f38e050c5ee7130d459ea247d998a838b5a1/src/internal/weak"><code>internal/weak</code></a>
packages as well.</p>
<h3 id="here-they-are"><a href="#here-they-are"><span></span></a>Here they are:</h3>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/golang/go/blob/5123f38e050c5ee7130d459ea247d998a838b5a1/src/crypto/rsa/rsa.go#L517"><code>crypto/rsa/rsa.go</code></a></p>
<pre><code><span><span>func</span> <span>EncryptOAEP</span><span>(</span>hash hash<span>.</span>Hash<span>,</span> random io<span>.</span>Reader<span>,</span> pub <span>*</span>PublicKey<span>,</span> msg <span>[</span><span>]</span><span>byte</span><span>,</span> label <span>[</span><span>]</span><span>byte</span><span>)</span> <span>(</span><span>[</span><span>]</span><span>byte</span><span>,</span> <span>error</span><span>)</span> <span>{</span>
</span><span>	
</span><span>	
</span><span>	
</span><span>	
</span><span>	
</span></code></pre>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/golang/go/blob/5123f38e050c5ee7130d459ea247d998a838b5a1/src/crypto/rsa/pss.go#L294"><code>crypto/rsa/pss.go</code></a></p>
<pre><code><span><span>func</span> <span>SignPSS</span><span>(</span>rand io<span>.</span>Reader<span>,</span> priv <span>*</span>PrivateKey<span>,</span> hash crypto<span>.</span>Hash<span>,</span> digest <span>[</span><span>]</span><span>byte</span><span>,</span> opts <span>*</span>PSSOptions<span>)</span> <span>(</span><span>[</span><span>]</span><span>byte</span><span>,</span> <span>error</span><span>)</span> <span>{</span>
</span><span>	
</span><span>	
</span><span>	
</span><span>	
</span><span>	
</span><span>
</span><span>	<span>if</span> opts <span>!=</span> <span>nil</span> <span>&amp;&amp;</span> opts<span>.</span>Hash <span>!=</span> <span>0</span> <span>{</span>
</span><span>		hash <span>=</span> opts<span>.</span>Hash
</span><span>	<span>}</span>
</span></code></pre>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/golang/go/blob/5123f38e050c5ee7130d459ea247d998a838b5a1/src/internal/weak/pointer.go#L24"><code>internal/weak</code></a></p>
<pre><code><span>Using <span>go</span><span>:</span>linkname to access this <span>package</span> and the functions it references
</span><span>is explicitly forbidden by the toolchain because the semantics of this
</span><span><span>package</span> have not gone through the proposal process<span>.</span> By exposing this
</span><span>functionality<span>,</span> we risk locking in the existing semantics due to Hyrum&#39;s Law<span>.</span>
</span></code></pre>
<h3 id="observation"><a href="#observation"><span></span></a>Observation</h3>
<p>This is obviously <a target="_blank" rel="noopener noreferrer" href="https://grep.app/search?q=hyrum%27s%20law&amp;filter%5Blang%5D%5B0%5D=Markdown&amp;filter%5Blang%5D%5B1%5D=C%2B%2B&amp;filter%5Blang%5D%5B2%5D=Python&amp;filter%5Blang%5D%5B3%5D=reStructuredText&amp;filter%5Blang%5D%5B4%5D=Rust&amp;filter%5Blang%5D%5B5%5D=Swift&amp;filter%5Blang%5D%5B6%5D=YAML">not specific to Golang</a>
and is mentioned in <a target="_blank" rel="noopener noreferrer" href="https://github.com/python/cpython/blob/450db61a78989c5a1f1106be01e071798c783cf9/Lib/urllib/parse.py#L30">other</a>
<a target="_blank" rel="noopener noreferrer" href="https://github.com/PixarAnimationStudios/OpenUSD/blob/9b0c13b2efa6233c8a4a4af411833628c5435bde/pxr/base/vt/array.h#L959">codebases</a> as well.</p>
<p>TBH, this whole thing reminds me of how JavaScript&#39;s evolution over the years has been heavily shaped by
widespread reliance on all sorts of quirky, unintended behaviors, which became de facto standards. Now, I finally
know what to refer to this phenomenon as ‚Äî <strong>Hyrum&#39;s Law.</strong></p>
<h3 id="final-thoughts"><a href="#final-thoughts"><span></span></a>Final thoughts</h3>
<ul>
<li>A good reminder to be careful when changing code others might depend on‚Äîand to try designing things in a way that doesn&#39;t accidentally
lock in weird quirks.</li>
<li>And even better, to design systems in a way that minimizes the chances of unintended behaviors being relied upon in the first place.</li>
<li>After all, you know the saying: &#34;All it takes is one small change to... something something...&#34; I don&#39;t remember the whole quote.</li>
</ul>
<p>üò∂‚Äçüå´Ô∏èÔ∏è</p></div></div>
  </body>
</html>
