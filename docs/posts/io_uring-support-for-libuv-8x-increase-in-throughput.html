<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/libuv/libuv/pull/3952">Original</a>
    <h1>io_uring support for libuv – 8x increase in throughput</h1>
    
    <div id="readability-page-1" class="page"><div>

      <div data-gid="PR_kwDOAOIGQ85OLHLM" data-url="/libuv/libuv/pull/3952/partials/body" data-channel="eyJjIjoicHVsbF9yZXF1ZXN0OjEzMTE1MzU4MjAiLCJ0IjoxNjg1MzE1NTc2fQ==--cf7b34dc087f4f6406f28d9067f1b569df606f78c315f4755073db00b2d4a222">

<p><a href="https://www.datadoodad.com/bnoordhuis" data-view-component="true"><img data-hovercard-type="user" data-hovercard-url="/users/bnoordhuis/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" src="https://avatars.githubusercontent.com/u/275871?s=60&amp;v=4" alt="bnoordhuis" size="40" height="40" width="40" data-view-component="true"/></a>
  
  
</p>
</div>

       
            


      

      <div data-gid="PRR_kwDOAOIGQ85SZHjh">
  
        <div>
  <div id="pullrequestreview-1382316257" data-gid="PRR_kwDOAOIGQ85SZHjh" data-channel="eyJjIjoicHVsbF9yZXF1ZXN0X3JldmlldzoxMzgyMzE2MjU3IiwidCI6MTY4NTMxNTU3N30=--6633d892139ec1961bb3246f5b6b5fde632b44e3149e71ef609be12e8c9657a3" data-url="/libuv/libuv/pull/3952/partials/reviews/1382316257">
      <div data-view-component="true">
  <p><a href="https://www.datadoodad.com/trevnorris" data-view-component="true"><img data-hovercard-type="user" data-hovercard-url="/users/trevnorris/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" src="https://avatars.githubusercontent.com/u/289174?s=60&amp;v=4" alt="trevnorris" size="40" height="40" width="40" data-view-component="true"/></a></p>
  
</div>

        </div>
</div>


</div>

      

      


      


      

      


      <div data-gid="PRR_kwDOAOIGQ85Sn8kN">
  
        <div>
  <div id="pullrequestreview-1386203405" data-gid="PRR_kwDOAOIGQ85Sn8kN" data-channel="eyJjIjoicHVsbF9yZXF1ZXN0X3JldmlldzoxMzg2MjAzNDA1IiwidCI6MTY4NTMxNTU3N30=--658b31bcc6c4c071700b9e104d52aaa5bf745363f8641d529ec68891fed9df97" data-url="/libuv/libuv/pull/3952/partials/reviews/1386203405">
      <div data-view-component="true">
  <p><a href="https://www.datadoodad.com/santigimeno" data-view-component="true"><img data-hovercard-type="user" data-hovercard-url="/users/santigimeno/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" src="https://avatars.githubusercontent.com/u/1084056?s=60&amp;v=4" alt="santigimeno" size="40" height="40" width="40" data-view-component="true"/></a></p>
  
</div>

        </div>
</div>


</div>

      

      


      <div data-gid="PRR_kwDOAOIGQ85Spf2f">
  
        <div>
  <div id="pullrequestreview-1386610079" data-gid="PRR_kwDOAOIGQ85Spf2f" data-channel="eyJjIjoicHVsbF9yZXF1ZXN0X3JldmlldzoxMzg2NjEwMDc5IiwidCI6MTY4NTMxNTU3N30=--0304752d4f4d936f69803826acd3c1bda4ae2630ab81235724c8a9b475ab73e9" data-url="/libuv/libuv/pull/3952/partials/reviews/1386610079">
      <div data-view-component="true">
  <p><a href="https://www.datadoodad.com/santigimeno" data-view-component="true"><img data-hovercard-type="user" data-hovercard-url="/users/santigimeno/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" src="https://avatars.githubusercontent.com/u/1084056?s=60&amp;v=4" alt="santigimeno" size="40" height="40" width="40" data-view-component="true"/></a></p>
  
</div>
        
        </div>
</div>


</div>

      


      <div data-gid="PRR_kwDOAOIGQ85Sp-K0">
  
        <div>
  <div id="pullrequestreview-1386734260" data-gid="PRR_kwDOAOIGQ85Sp-K0" data-channel="eyJjIjoicHVsbF9yZXF1ZXN0X3JldmlldzoxMzg2NzM0MjYwIiwidCI6MTY4NTMxNTU3OH0=--391acb536964c85ed446dd77b38c1773599c849cc0b58293a13725a5659397ba" data-url="/libuv/libuv/pull/3952/partials/reviews/1386734260">
      <div data-view-component="true">
  <p><a href="https://www.datadoodad.com/santigimeno" data-view-component="true"><img data-hovercard-type="user" data-hovercard-url="/users/santigimeno/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" src="https://avatars.githubusercontent.com/u/1084056?s=60&amp;v=4" alt="santigimeno" size="40" height="40" width="40" data-view-component="true"/></a></p>
  
</div>
        
        </div>
</div>


</div>

      


      <div data-gid="PRR_kwDOAOIGQ85Sx_sy">
  
        <div>
  <div id="pullrequestreview-1388837682" data-gid="PRR_kwDOAOIGQ85Sx_sy" data-channel="eyJjIjoicHVsbF9yZXF1ZXN0X3JldmlldzoxMzg4ODM3NjgyIiwidCI6MTY4NTMxNTU3OH0=--8baeb12d0a1a8d80cb2b3bf0888b70d1e7dd4ae615747184a1624b5d21baaa36" data-url="/libuv/libuv/pull/3952/partials/reviews/1388837682">
      <div data-view-component="true">
  <p><a href="https://www.datadoodad.com/trevnorris" data-view-component="true"><img data-hovercard-type="user" data-hovercard-url="/users/trevnorris/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" src="https://avatars.githubusercontent.com/u/289174?s=60&amp;v=4" alt="trevnorris" size="40" height="40" width="40" data-view-component="true"/></a></p>
  
</div>
        
        </div>
</div>


</div>

      <div data-gid="PRR_kwDOAOIGQ85SyVOj">
  
        <div>
  <div id="pullrequestreview-1388925859" data-gid="PRR_kwDOAOIGQ85SyVOj" data-channel="eyJjIjoicHVsbF9yZXF1ZXN0X3JldmlldzoxMzg4OTI1ODU5IiwidCI6MTY4NTMxNTU3OH0=--37ac2fe1c9b8443be6987615c14367c040d295bb5b450bd46a1f967dcf9ae639" data-url="/libuv/libuv/pull/3952/partials/reviews/1388925859">
      <div data-view-component="true">
  <p><a href="https://www.datadoodad.com/trevnorris" data-view-component="true"><img data-hovercard-type="user" data-hovercard-url="/users/trevnorris/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" src="https://avatars.githubusercontent.com/u/289174?s=60&amp;v=4" alt="trevnorris" size="40" height="40" width="40" data-view-component="true"/></a></p>
  
</div>

        </div>
</div>


</div>

      


      

      <div data-gid="C_kwDOAcYN9doAKDI2Yzc5YTk0MmI5MjU3M2ExMzg4YzBlZThhNmFkNDM5N2YwMDkzMTg">
  
        <div>
  <div>
      <div data-view-component="true">
  
  
  <div data-view-component="true">          <div>
  <div>
    <div>
      
<div>
  <p><a data-test-selector="commits-avatar-stack-avatar-link" data-hovercard-type="user" data-hovercard-url="/users/bnoordhuis/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://www.datadoodad.com/bnoordhuis">
        <img data-test-selector="commits-avatar-stack-avatar-image" src="https://avatars.githubusercontent.com/u/275871?s=40&amp;v=4" width="20" height="20" alt="@bnoordhuis"/>
</a>  </p>
</div>

      

      

      

      
    </div>
  </div>
    <div>
      <pre>Add io_uring support for several asynchronous file operations:

- read, write
- fsync, fdatasync
- stat, fstat, lstat

io_uring is used when the kernel is new enough, otherwise libuv simply
falls back to the thread pool.

Performance looks great; an 8x increase in throughput has been observed.

This work was sponsored by ISC, the Internet Systems Consortium.</pre>
    </div>
</div>

</div>
</div>  </div>
</div>


</div>

      

      


      


      <div data-gid="CRE_kwDOAhgJ0c5MSt-u">
  
          

  
<div>
  <div id="ref-commit-571c551">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/bnoordhuis/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://www.datadoodad.com/bnoordhuis">bnoordhuis</a> 

      added a commit
        to bnoordhuis/libuv
      that referenced
      this pull request

    </p><a href="#ref-commit-571c551">
      <relative-time datetime="2023-04-19T05:00:29Z">Apr 19, 2023</relative-time>
    </a>
    <div>
      
<div data-channel="eyJjIjoicmVwbzoyOTc1NjkxNzpjb21taXQ6NTcxYzU1MTFjOGJlZDQ0ZmVjZjg3MDQ2Y2YxZmE4YjMwM2UwMjFkZSIsInQiOjE2ODUzMTU1Nzh9--12b65b564dc7d1ae8771b5e7d66cb30eb9e65fb01ffc91a2bf3bf79301a58e89" data-url="/bnoordhuis/libuv/commit/571c5511c8bed44fecf87046cf1fa8b303e021de/show_partial?partial=commit%2Fcondensed_details">
  <div>
    <div>
      
<div>
  <p><a data-test-selector="commits-avatar-stack-avatar-link" data-hovercard-type="user" data-hovercard-url="/users/bnoordhuis/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://www.datadoodad.com/bnoordhuis">
        <img data-test-selector="commits-avatar-stack-avatar-image" src="https://avatars.githubusercontent.com/u/275871?s=40&amp;v=4" width="20" height="20" alt="@bnoordhuis"/>
</a>  </p>
</div>


      

      

      

      <!-- ml-1 is added to accommodate "clock" icon -->
      
    </div>
  </div>
    <div>
      <pre>Fix a valgrind warning that only manifested with clang (not gcc!) by
explicitly passing 0L instead of plain 0 as the |sigsz| argument to
io_uring_enter(). That is, pass a long instead of an int.

On x86_64, |sigsz| is passed on the stack (the other arguments are
passed in registers) but where gcc emits a `push $0` that zeroes the
entire stack slot, clang emits a `movl $0,(%rsp)` that leaves the upper
32 bits untouched.

It&#39;s academic though since we don&#39;t pass IORING_ENTER_EXT_ARG and the
kernel therefore completely ignores the argument.

Refs: <a data-error-text="Failed to load title" data-id="1665308925" data-permission-text="Title is private" data-url="https://github.com/libuv/libuv/issues/3952" data-hovercard-type="pull_request" data-hovercard-url="/libuv/libuv/pull/3952/hovercard" href="https://github.com/libuv/libuv/pull/3952">libuv#3952</a></pre>
    </div>
</div>

    </div>
  </div>
</div>

  



</div>



        


        <div data-gid="REFE_lADOAOIGQ85jQpj9zwAAAAIa-EcC">
  
          
<div>
  <div id="ref-commit-a7ff759">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/bnoordhuis/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://www.datadoodad.com/bnoordhuis">bnoordhuis</a> 

      added a commit
      that referenced
      this pull request

    </p><a href="#ref-commit-a7ff759">
      <relative-time datetime="2023-04-19T05:39:12Z">Apr 19, 2023</relative-time>
    </a>
    <div>
      
<div data-channel="eyJjIjoicmVwbzoxNDgxMjczOTpjb21taXQ6YTdmZjc1OWNhMWRlYWNiMmUwZTZhZTNjMmQzZGNlOTFjYzYzN2RmZSIsInQiOjE2ODUzMTU1Nzh9--b653164c633dd5817a8e30442b5ad1003a67f697e90e3b7243c188edc737e5a6" data-url="/libuv/libuv/commit/a7ff759ca1deacb2e0e6ae3c2d3dce91cc637dfe/show_partial?partial=commit%2Fcondensed_details">
  <div>
    <div>
      
<div>
  <p><a data-test-selector="commits-avatar-stack-avatar-link" data-hovercard-type="user" data-hovercard-url="/users/bnoordhuis/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://www.datadoodad.com/bnoordhuis">
        <img data-test-selector="commits-avatar-stack-avatar-image" src="https://avatars.githubusercontent.com/u/275871?s=40&amp;v=4" width="20" height="20" alt="@bnoordhuis"/>
</a>  </p>
</div>


      

      

      

      <!-- ml-1 is added to accommodate "clock" icon -->
      
    </div>
  </div>
    <div>
      <pre>Fix a valgrind warning that only manifested with clang (not gcc!) by
explicitly passing 0L instead of plain 0 as the |sigsz| argument to
io_uring_enter(). That is, pass a long instead of an int.

On x86_64, |sigsz| is passed on the stack (the other arguments are
passed in registers) but where gcc emits a `push $0` that zeroes the
entire stack slot, clang emits a `movl $0,(%rsp)` that leaves the upper
32 bits untouched.

It&#39;s academic though since we don&#39;t pass IORING_ENTER_EXT_ARG and the
kernel therefore completely ignores the argument.

Refs: <a data-error-text="Failed to load title" data-id="1665308925" data-permission-text="Title is private" data-url="https://github.com/libuv/libuv/issues/3952" data-hovercard-type="pull_request" data-hovercard-url="/libuv/libuv/pull/3952/hovercard" href="https://github.com/libuv/libuv/pull/3952">#3952</a></pre>
    </div>
</div>

    </div>
  </div>
</div>

  



</div>

        


        

        

        


        


        <div data-gid="CRE_kwDOAOIGQ85MtnU8">
  
          

  

  

  


  

  

  


  
<div>
  <div id="ref-commit-9e68f94">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/nodejs-github-bot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://www.datadoodad.com/nodejs-github-bot">nodejs-github-bot</a> 

      pushed a commit
        to nodejs/node
      that referenced
      this pull request

    </p><a href="#ref-commit-9e68f94">
      <relative-time datetime="2023-05-24T11:07:13Z">May 24, 2023</relative-time>
    </a>
    <div>
      
<div data-channel="eyJjIjoicmVwbzoyNzE5Mzc3OTpjb21taXQ6OWU2OGY5NDEzZTA1ZTZlY2IzYTFjMTViYzdjNzY2YTA5ZTg2NmNjMCIsInQiOjE2ODUzMTU1Nzh9--9df58ea08a31b7b606c4582840db351428803890228ffc3738d1bc563249ef76" data-url="/nodejs/node/commit/9e68f9413e05e6ecb3a1c15bc7c766a09e866cc0/show_partial?partial=commit%2Fcondensed_details">
  <div>
    <div>
      
<div>
  <p><a data-test-selector="commits-avatar-stack-avatar-link" data-hovercard-type="user" data-hovercard-url="/users/santigimeno/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://www.datadoodad.com/santigimeno">
        <img data-test-selector="commits-avatar-stack-avatar-image" src="https://avatars.githubusercontent.com/u/1084056?s=40&amp;u=67d7d93b07701371573e69af932ddc1f5c17fce8&amp;v=4" width="20" height="20" alt="@santigimeno"/>
</a>      <a data-test-selector="commits-avatar-stack-avatar-link" data-hovercard-type="user" data-hovercard-url="/users/nodejs-github-bot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://www.datadoodad.com/nodejs-github-bot">
        <img data-test-selector="commits-avatar-stack-avatar-image" src="https://avatars.githubusercontent.com/u/18269663?s=40&amp;v=4" width="20" height="20" alt="@nodejs-github-bot"/>
</a>  </p>
</div>


      

      

      

      <!-- ml-1 is added to accommodate "clock" icon -->
      
    </div>
  </div>
    <div>
      <pre>- linux: introduce io_uring support <a data-error-text="Failed to load title" data-id="1665308925" data-permission-text="Title is private" data-url="https://github.com/libuv/libuv/issues/3952" data-hovercard-type="pull_request" data-hovercard-url="/libuv/libuv/pull/3952/hovercard" href="https://github.com/libuv/libuv/pull/3952">libuv/libuv#3952</a>
- src: add new metrics APIs <a data-error-text="Failed to load title" data-id="1373706051" data-permission-text="Title is private" data-url="https://github.com/libuv/libuv/issues/3749" data-hovercard-type="pull_request" data-hovercard-url="/libuv/libuv/pull/3749/hovercard" href="https://github.com/libuv/libuv/pull/3749">libuv/libuv#3749</a>
- unix,win: give thread pool threads an 8 MB stack <a data-error-text="Failed to load title" data-id="1407340585" data-permission-text="Title is private" data-url="https://github.com/libuv/libuv/issues/3787" data-hovercard-type="pull_request" data-hovercard-url="/libuv/libuv/pull/3787/hovercard" href="https://github.com/libuv/libuv/pull/3787">libuv/libuv#3787</a>
- win,unix: change execution order of timers <a data-error-text="Failed to load title" data-id="1628086284" data-permission-text="Title is private" data-url="https://github.com/libuv/libuv/issues/3927" data-hovercard-type="pull_request" data-hovercard-url="/libuv/libuv/pull/3927/hovercard" href="https://github.com/libuv/libuv/pull/3927">libuv/libuv#3927</a>

<span aria-label="This commit closes issue #43931.">Fixes</span>: <a data-error-text="Failed to load title" data-id="1313260849" data-permission-text="Title is private" data-url="https://github.com/nodejs/node/issues/43931" data-hovercard-type="issue" data-hovercard-url="/nodejs/node/issues/43931/hovercard" href="https://github.com/nodejs/node/issues/43931">#43931</a>
<span aria-label="This commit closes issue #42496.">Fixes</span>: <a data-error-text="Failed to load title" data-id="1182585807" data-permission-text="Title is private" data-url="https://github.com/nodejs/node/issues/42496" data-hovercard-type="issue" data-hovercard-url="/nodejs/node/issues/42496/hovercard" href="https://github.com/nodejs/node/issues/42496">#42496</a>
<span aria-label="This commit closes issue #47715.">Fixes</span>: <a data-error-text="Failed to load title" data-id="1683451725" data-permission-text="Title is private" data-url="https://github.com/nodejs/node/issues/47715" data-hovercard-type="issue" data-hovercard-url="/nodejs/node/issues/47715/hovercard" href="https://github.com/nodejs/node/issues/47715">#47715</a>
<span aria-label="This commit closes issue #47259.">Fixes</span>: <a data-error-text="Failed to load title" data-id="1640865919" data-permission-text="Title is private" data-url="https://github.com/nodejs/node/issues/47259" data-hovercard-type="issue" data-hovercard-url="/nodejs/node/issues/47259/hovercard" href="https://github.com/nodejs/node/issues/47259">#47259</a>
<span aria-label="This commit closes issue #47241.">Fixes</span>: <a data-error-text="Failed to load title" data-id="1638491428" data-permission-text="Title is private" data-url="https://github.com/nodejs/node/issues/47241" data-hovercard-type="issue" data-hovercard-url="/nodejs/node/issues/47241/hovercard" href="https://github.com/nodejs/node/issues/47241">#47241</a>
PR-URL: <a data-error-text="Failed to load title" data-id="1717130716" data-permission-text="Title is private" data-url="https://github.com/nodejs/node/issues/48078" data-hovercard-type="pull_request" data-hovercard-url="/nodejs/node/pull/48078/hovercard" href="https://github.com/nodejs/node/pull/48078">#48078</a>
Reviewed-By: Ben Noordhuis &lt;info@bnoordhuis.nl&gt;
Reviewed-By: Mohammed Keyvanzadeh &lt;mohammadkeyvanzade94@gmail.com&gt;
Reviewed-By: Debadree Chatterjee &lt;debadree333@gmail.com&gt;
Reviewed-By: Luigi Pinca &lt;luigipinca@gmail.com&gt;
Reviewed-By: Colin Ihrig &lt;cjihrig@gmail.com&gt;
Reviewed-By: Yagiz Nizipli &lt;yagiz@nizipli.com&gt;
Reviewed-By: Michaël Zasso &lt;targos@protonmail.com&gt;
Reviewed-By: Rafael Gonzaga &lt;rafael.nunu@hotmail.com&gt;
Reviewed-By: Richard Lau &lt;rlau@redhat.com&gt;
Reviewed-By: Tobias Nießen &lt;tniessen@tnie.de&gt;
Reviewed-By: Jiawen Geng &lt;technicalcute@gmail.com&gt;</pre>
    </div>
</div>

    </div>
  </div>
</div>

  



</div>



  <!-- Rendered timeline since 2023-05-28 14:27:57 -->
  



    </div></div>
  </body>
</html>
