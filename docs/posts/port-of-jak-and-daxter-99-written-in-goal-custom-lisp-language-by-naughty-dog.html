<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/water111/jak-project">Original</a>
    <h1>Port of Jak and Daxter. 99% written in GOAL, custom Lisp language by Naughty Dog</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text"><p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://github.com/water111/jak-project/blob/master/docs/markdown/imgs/logo-text-colored-new.png"><img width="500" height="100%" src="https://github.com/water111/jak-project/raw/master/docs/markdown/imgs/logo-text-colored-new.png"/></a>
</p>
<p dir="auto">
  <a href="https://water111.github.io/jak-project/" rel="nofollow"><img src="https://camo.githubusercontent.com/8f00a3ce3dab0184984b3bbb3290ff31123ce821c0e6c429569e9ab8a4db5da5/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f446f63756d656e746174696f6e2d486572652d696e666f726d6174696f6e616c" alt="Documentation Badge" data-canonical-src="https://img.shields.io/badge/Documentation-Here-informational"/></a>
  <a href="https://github.com/water111/jak-project/workflows/Linux/badge.svg"><img src="https://github.com/water111/jak-project/workflows/Linux/badge.svg" alt="Linux"/></a>
  <a href="https://github.com/water111/jak-project/workflows/Windows/badge.svg"><img src="https://github.com/water111/jak-project/workflows/Windows/badge.svg" alt="Windows"/></a>
  <a href="https://coveralls.io/github/water111/jak-project?branch=master" rel="nofollow"><img src="https://camo.githubusercontent.com/7b81b644f34ea3c3fb43b659eafd9ef90f850a2ef7053e280ea4c1f9f396f9ec/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f6769746875622f77617465723131312f6a616b2d70726f6a6563742f62616467652e7376673f6272616e63683d6d6173746572" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/github/water111/jak-project/badge.svg?branch=master"/></a>
  <a href="https://www.codacy.com/gh/water111/jak-project/dashboard?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=xTVaser/jak-project&amp;utm_campaign=Badge_Grade" rel="nofollow"><img src="https://camo.githubusercontent.com/91ef0a40ce45a7d7c30fbd0170a813d4fc1f62d0790e27c029b52ef470eda644/68747470733a2f2f6170702e636f646163792e636f6d2f70726f6a6563742f62616467652f47726164652f3763336364633037353233663433616361333433333438346562633632666639" alt="Codacy Badge" data-canonical-src="https://app.codacy.com/project/badge/Grade/7c3cdc07523f43aca3433484ebc62ff9"/></a>
  <a href="https://discord.gg/E7yFpd6w9G" rel="nofollow"><img src="https://camo.githubusercontent.com/7927e45fffe0c890fdc2124b28838e8269e33e4999eee95a94c5ffdd27131e22/68747470733a2f2f696d672e736869656c64732e696f2f646973636f72642f373536323837343631333737373033393837" alt="Discord" data-canonical-src="https://img.shields.io/discord/756287461377703987"/></a>
</p>
<h2 dir="auto"><a id="user-content-table-of-contents" aria-hidden="true" href="#table-of-contents"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Table of Contents</h2>

<ul dir="auto">
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#project-description">Project Description</a></li>
<li><a href="#getting-started---linux-ubuntu">Getting Started - Linux (Ubuntu)</a></li>
<li><a href="#getting-started---linux-arch">Getting Started - Linux (Arch)</a></li>
<li><a href="#getting-started---nixpkgs">Getting Started - Nixpkgs</a></li>
<li><a href="#getting-started---windows">Getting Started - Windows</a></li>
<li><a href="#project-layout">Project Layout</a></li>
<li><a href="#directory-layout">Directory Layout</a></li>
<li><a href="#more-documentation">More Documentation</a></li>
<li><a href="#asan-build">ASan Build</a>
<ul dir="auto">
<li><a href="#on-windows--visual-studio">On Windows / Visual Studio</a></li>
</ul>
</li>
</ul>

<h2 dir="auto"><a id="user-content-project-description" aria-hidden="true" href="#project-description"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Project Description</h2>
<p dir="auto">This project is to port Jak 1 (NTSC, &#34;black label&#34; version) to PC. Over 99% of this game is written in GOAL, a custom Lisp language developed by Naughty Dog. Our strategy is:</p>
<ul dir="auto">
<li>decompile the original game code into human-readable GOAL code</li>
<li>develop our own compiler for GOAL and recompile game code for x86-64</li>
<li>create a tool to extract game assets into formats that can be easily viewed or modified</li>
<li>create tools to repack game assets into a format that our port uses.</li>
</ul>
<p dir="auto">Our objectives are:</p>
<ul dir="auto">
<li>make the port a &#34;native application&#34; on x86-64, with high performance. It shouldn&#39;t emulated, interpreted, or transpiled.</li>
<li>Our GOAL compiler&#39;s performance should be around the same as unoptimized C.</li>
<li>try to match things from the original game and development as possible. For example, the original GOAL compiler supported live modification of code while the game is running, so we do the same, even though it&#39;s not required for just porting the game.</li>
<li>support modifications. It should be possible to make edits to the code without everything else breaking.</li>
</ul>
<p dir="auto">We support both Linux and Windows on x86-64.</p>
<h2 dir="auto"><a id="user-content-current-status" aria-hidden="true" href="#current-status"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Current Status</h2>
<p dir="auto">So far, we&#39;ve decompiled around 341,233 lines of GOAL code, out of an estimated 500,000 total lines and we&#39;ve started work on an OpenGL renderer. Currently, the main display process (<code>*dproc*</code>) runs and sends data to our renderer. We can load textures, text files, and level files. Using keyboard controls, we can open the debug menu and turn on some simple debug visualizations.</p>
<p dir="auto">Here are some screenshots of the renderer:
<a target="_blank" rel="noopener noreferrer" href="https://github.com/water111/jak-project/blob/master/docs/markdown/imgs/screenshot_hut.png"><img src="https://github.com/water111/jak-project/raw/master/docs/markdown/imgs/screenshot_hut.png" alt=""/></a>
<a target="_blank" rel="noopener noreferrer" href="https://github.com/water111/jak-project/blob/master/docs/markdown/imgs/screenshot_vi1.png"><img src="https://github.com/water111/jak-project/raw/master/docs/markdown/imgs/screenshot_vi1.png" alt=""/></a></p>
<p dir="auto">YouTube playlist:
<a href="https://www.youtube.com/playlist?list=PLWx9T30aAT50cLnCTY1SAbt2TtWQzKfXX" rel="nofollow">https://www.youtube.com/playlist?list=PLWx9T30aAT50cLnCTY1SAbt2TtWQzKfXX</a></p>
<p dir="auto">To help with decompiling, we&#39;ve built a decompiler that can process GOAL code and unpack game assets. We manually specify function types and locations where the original code had type casts until the decompiler succeeds, then we clean up the output of the decompiled code by adding comments and adjusting formatting, then save it in <code>goal_src</code>. Our decompiler is designed specifically for processing the output of the original GOAL compiler. As a result, when given correct casts, it often produces code that can be directly fed into a compiler and works perfectly. This is tested as part of our unit tests, and so far we have around 300,000 lines (380 files) that pass.</p>
<p dir="auto">We don&#39;t save any assets from the game - you must bring your own copy of the game and use the decompiler to extract assets.</p>
<h2 dir="auto"><a id="user-content-whats-next" aria-hidden="true" href="#whats-next"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>What&#39;s Next</h2>
<ul dir="auto">
<li>Continue decompilation of GOAL code. We&#39;ve made huge progress recently in decompiling gameplay code. We&#39;re finishing that up and also working on the some of the rendering and collision code. Here&#39;s our decompilation progress over the past year: <a target="_blank" rel="noopener noreferrer" href="https://github.com/water111/jak-project/blob/master/docs/markdown/imgs/code_progress.png"><img src="https://github.com/water111/jak-project/raw/master/docs/markdown/imgs/code_progress.png" alt=""/></a></li>
<li>Start running gameplay code! We can now spawn simple actors like particle effects and collectables.</li>
<li>Improve the decompiler. We are always finding new features and macros in the GOAL language.</li>
<li>Investigate more complicated renderers. We have an in-progress port of the &#34;tfrag&#34; background renderer, shown in the screenshots above.</li>
</ul>
<h2 dir="auto"><a id="user-content-getting-started---linux-ubuntu" aria-hidden="true" href="#getting-started---linux-ubuntu"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Getting Started - Linux (Ubuntu)</h2>
<p dir="auto">Install packages and init repository:</p>
<div data-snippet-clipboard-copy-content="sudo apt install gcc make cmake build-essential g++ nasm clang-format
git submodule update --init --recursive"><pre>sudo apt install gcc make cmake build-essential g++ nasm clang-format
git submodule update --init --recursive</pre></div>
<p dir="auto">Compile:</p>
<div data-snippet-clipboard-copy-content="cmake -B build &amp;&amp; cmake --build build -j 8"><pre>cmake -B build <span>&amp;&amp;</span> cmake --build build -j 8</pre></div>
<p dir="auto">Run tests:</p>

<p dir="auto">Note: we have found that <code>clang</code> and <code>lld</code> are significantly faster to compile and link than <code>gcc</code>, generate faster code, and have better warning messages. To install these:</p>
<div data-snippet-clipboard-copy-content="sudo apt install lld clang"><pre>sudo apt install lld clang</pre></div>
<p dir="auto">and run <code>cmake</code> (in a fresh build directory) with:</p>
<div data-snippet-clipboard-copy-content="cmake -DCMAKE_SHARED_LINKER_FLAGS=&#34;-fuse-ld=lld&#34; -DCMAKE_EXE_LINKER_FLAGS=&#34;-fuse-ld=lld&#34; -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ .."><pre>cmake -DCMAKE_SHARED_LINKER_FLAGS=<span><span>&#34;</span>-fuse-ld=lld<span>&#34;</span></span> -DCMAKE_EXE_LINKER_FLAGS=<span><span>&#34;</span>-fuse-ld=lld<span>&#34;</span></span> -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ ..</pre></div>
<h2 dir="auto"><a id="user-content-getting-started---linux-arch" aria-hidden="true" href="#getting-started---linux-arch"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Getting Started - Linux (Arch)</h2>
<p dir="auto">Install packages and init repository:</p>
<div data-snippet-clipboard-copy-content="sudo pacman -S gcc make cmake base-devel g++ nasm
git submodule update --init --recursive"><pre>sudo pacman -S gcc make cmake base-devel g++ nasm
git submodule update --init --recursive</pre></div>
<p dir="auto">Compile:</p>
<div data-snippet-clipboard-copy-content="cmake -B build &amp;&amp; cmake --build build -j 8"><pre>cmake -B build <span>&amp;&amp;</span> cmake --build build -j 8</pre></div>
<p dir="auto">Run tests:</p>

<h2 dir="auto"><a id="user-content-getting-started---nixpkgs" aria-hidden="true" href="#getting-started---nixpkgs"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Getting Started - Nixpkgs</h2>
<p dir="auto">If your Nix supports flakes:</p>
<div data-snippet-clipboard-copy-content="nix develop # development environment
nix build # package
nix develop &#39;.#jak-asan-dev&#39; # development environment with Clang
nix build &#39;.#jak-asan&#39; # package with Clang ASan build"><pre>nix develop <span><span>#</span> development environment</span>
nix build <span><span>#</span> package</span>
nix develop <span><span>&#39;</span>.#jak-asan-dev<span>&#39;</span></span> <span><span>#</span> development environment with Clang</span>
nix build <span><span>&#39;</span>.#jak-asan<span>&#39;</span></span> <span><span>#</span> package with Clang ASan build</span></pre></div>
<p dir="auto">Otherwise, with traditional Nix:</p>
<div data-snippet-clipboard-copy-content="nix-shell # development environment
nix-build # package
nix-shell -A packages.x86_64-linux.jak-asan-dev # development environment with Clang
nix-build -A packages.x86_64-linux.jak-asan # package with Clang ASan build"><pre>nix-shell <span><span>#</span> development environment</span>
nix-build <span><span>#</span> package</span>
nix-shell -A packages.x86_64-linux.jak-asan-dev <span><span>#</span> development environment with Clang</span>
nix-build -A packages.x86_64-linux.jak-asan <span><span>#</span> package with Clang ASan build</span></pre></div>
<h2 dir="auto"><a id="user-content-getting-started---windows" aria-hidden="true" href="#getting-started---windows"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Getting Started - Windows</h2>
<p dir="auto">Install Visual Studio 2019 and get the C++ and CMake tools via the Visual Studio Installer</p>
<p dir="auto">On Windows, it&#39;s recommended to get Scoop to use as a package manager, making the follow steps <em>much</em> easier. Follow the steps on the bottom of the homepage here <a href="https://scoop.sh/" rel="nofollow">https://scoop.sh/</a></p>
<p dir="auto">Once Scoop is installed, run the following command:</p>

<p dir="auto">Initialize the repository&#39;s third-party dependencies:</p>
<div data-snippet-clipboard-copy-content="git submodule update --init --recursive"><pre>git submodule update --init --recursive</pre></div>
<p dir="auto">Open the project as a CMake project, browse for the root level <code>CMakeLists.txt</code>:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/water111/jak-project/blob/master/docs/markdown/imgs/open-cmake-vs.png"><img src="https://github.com/water111/jak-project/raw/master/docs/markdown/imgs/open-cmake-vs.png" alt=""/></a></p>
<p dir="auto">In the toolbar, you should be able to select an individual component to compile, or combine within the root CMakeLists.txt. In the future we will pre-define configurations to make this easier.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/water111/jak-project/blob/master/docs/markdown/imgs/cmake-build-vs.png"><img src="https://github.com/water111/jak-project/raw/master/docs/markdown/imgs/cmake-build-vs.png" alt=""/></a></p>
<p dir="auto">You may also wish to view the files that pertain to each CMake target, rather than the project as it is normally:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/water111/jak-project/blob/master/docs/markdown/imgs/cmake-target-view.png"><img src="https://github.com/water111/jak-project/raw/master/docs/markdown/imgs/cmake-target-view.png" alt=""/></a></p>
<h2 dir="auto"><a id="user-content-building-and-running-the-game" aria-hidden="true" href="#building-and-running-the-game"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building and Running the Game</h2>
<p dir="auto">Getting a running game involves 4 steps:</p>
<ol dir="auto">
<li>Build C++ tools (follow steps above)</li>
<li>Extract assets from game</li>
<li>Build game</li>
<li>Run game</li>
</ol>
<h3 dir="auto"><a id="user-content-extract-assets" aria-hidden="true" href="#extract-assets"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Extract Assets</h3>
<p dir="auto">Running the decompiler on the entire game is slow and not needed, so it is recommended to just run it on data. Edit <code>decompiler/config/jak1-ntsc_black_label.jsonc</code> and disable <code>decompile_code</code>.</p>
<div data-snippet-clipboard-copy-content="  &#34;decompile_code&#34;: false, // change this to false, don&#39;t decompile code"><pre>  <span>&#34;decompile_code&#34;</span>: <span>false</span>, <span>// change this to false, don&#39;t decompile code</span></pre></div>
<p dir="auto">Place a copy of the game&#39;s files in <code>iso_data</code> (on Windows, make a <code>jak1</code> subfolder and place the files there), then run the decompiler with the <code>scripts/shell/decomp.sh</code> (Linux) or <code>scripts/batch/decomp-jak1.bat</code> (Windows) script.</p>
<h3 dir="auto"><a id="user-content-build-game" aria-hidden="true" href="#build-game"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Build Game</h3>
<p dir="auto">Run the OpenGOAL compiler <code>build/goalc/goalc</code>, or use one of the <code>gc</code> scripts. Enter <code>(mi)</code> to build the <code>&#34;iso&#34;</code> target, which contains everything we have placed in the build system so far.</p>
<h3 dir="auto"><a id="user-content-run-game" aria-hidden="true" href="#run-game"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Run Game</h3>
<p dir="auto">In a separate terminal, start the runtime with <code>build/game/gk -fakeiso -debug</code>. Then, in the OpenGOAL window, run <code>(mi)</code> to create the data for the game and give the REPL information for running code, <code>(lt)</code> to connect, <code>(lg)</code> to load the game engine and <code>(test-play)</code> to start the game engine. If it all works right, it will look something like this:</p>
<div data-snippet-clipboard-copy-content="g &gt; (lt)
[Listener] Socket connected established! (took 0 tries). Waiting for version...
Got version 0.8 OK!
[Debugger] Context: valid = true, s7 = 0x147d24, base = 0x2123000000, tid = 2438049

gc&gt; (lg)
10836466        #xa559f2              0.0000        (&#34;game&#34; &#34;kernel&#34;)

gc&gt; (test-play)
(play :use-vis #t :init-game #f) has been called!
0        #x0              0.0000        0

gc&gt; "><pre><code>g &gt; (lt)
[Listener] Socket connected established! (took 0 tries). Waiting for version...
Got version 0.8 OK!
[Debugger] Context: valid = true, s7 = 0x147d24, base = 0x2123000000, tid = 2438049

gc&gt; (lg)
10836466        #xa559f2              0.0000        (&#34;game&#34; &#34;kernel&#34;)

gc&gt; (test-play)
(play :use-vis #t :init-game #f) has been called!
0        #x0              0.0000        0

gc&gt; 
</code></pre></div>
<p dir="auto">Then, in the graphics window, you can use the period key to bring up the debug menu. Controllers also work, using the same mapping as the original game.</p>
<p dir="auto">Check out the <code>pc_debug</code> and <code>examples</code> folder under <code>goal_src</code> for some examples of GOAL code we wrote. They have instructions for how to run them.</p>
<h2 dir="auto"><a id="user-content-project-layout" aria-hidden="true" href="#project-layout"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Project Layout</h2>
<p dir="auto">There are four main components to the project.</p>
<p dir="auto">The first is <code>goalc</code>, which is a GOAL compiler for x86-64. Our implementation of GOAL is called OpenGOAL. All of the compiler source code is in <code>goalc</code>. To run the compiler on Linux, there is a script <code>gc.sh</code>. On Windows, there is a <code>gc.bat</code> scripts and a <code>gc-no-lt.bat</code> script, the latter of which will not attempt to automatically attach to a running target. The compiler is controlled through a prompt which can be used to enter commands to compile, connect to a running GOAL program for interaction, run the OpenGOAL debugger, or, if you are connected to a running GOAL program, can be used as a REPL to run code interactively. In addition to compiling code files, the compiler has features to pack and build data files.</p>
<p dir="auto">The second component to the project is the decompiler. You must have a copy of the PS2 game and place all files from the DVD into the <code>iso_data</code> folder. Then run <code>decomp.sh</code> (Linux) to run the decompiler. For Windows, it is the <code>decomp-jak1.bat</code> file, and it wants your game&#39;s DVD files in a <code>jak1</code> folder inside <code>iso_data</code>. The decompile will extract assets to the <code>assets</code> folder. These assets will be used by the compiler when building the port, and you may want to turn asset extraction off after running it once. The decompiler will output code and other data intended to be inspected by humans in the <code>decompiler_out</code> folder. Stuff in this folder will not be used by the compiler.</p>
<p dir="auto">The third is the game source code, written in OpenGOAL. This is located in <code>goal_src</code>. All GOAL and GOOS code should be in this folder. Right now most of this is placeholders or incomplete, but you can take a look at <code>kernel/gcommon.gc</code> or <code>goal-lib.gc</code> to see some in-progress source code.</p>
<p dir="auto">The final component is the &#34;runtime&#34;, located in <code>game</code>. This is the part of the game that&#39;s written in C++. In the port, that includes:</p>
<ul dir="auto">
<li>The &#34;C Kernel&#34;, which contains the GOAL linker and some low-level GOAL language features. GOAL has a completely custom dynamically linked object file format so in order to load the first GOAL code, you need a linker written in C++. Some low-level functions for memory allocation, communicating with the I/O Processor, symbol table, strings, and the type system are also implemented in C, as these are required for the linker. It also listens for incoming messages from the compiler and passes them to the running game. This also initializes the game, by initializing the PS2 hardware, allocating the GOAL heaps, loading the GOAL kernel off of the DVD, and executing the kernel dispatcher function. This is in the <code>game/kernel</code> folder. This should be as close as possible to the game, and all differences should be noted with a comment.</li>
<li>Implementation of Sony&#39;s standard library. GOAL code can call C library functions, and Naughty Dog used some Sony library functions to access files, memory cards, controllers, and communicate with the separate I/O Processor. The library functions are in <code>game/sce</code>. Implementations of library features specific to the PC port are located in <code>game/system</code>.</li>
<li>The I/O Processor driver, Overlord. The PS2 had a separate CPU called the I/O Processor (IOP) that was directly connected to the DVD drive hardware and the sound hardware. Naughty Dog created a custom driver for the IOP that handled streaming data off of the DVD. It is much more complicated than I first expected. It&#39;s located in <code>game/overlord</code>. Like the C kernel, we try to keep this as close as possible to the actual game.</li>
<li>Sound Code. Naughty Dog used a third party library for sound. We have not started on this yet.</li>
<li>PC specific graphics stuff. We have a functional OpenGL renderer and context that can create a game window and display graphics on it. The specific renderers used by the game however are mostly unimplemented. We have a debug, sprite and tfrag renderers, which is enough to render most of the game world, on-screen text and sprites like the progress menu. This is located in <code>game/graphics</code>. Many liberties will be taken to make this work, but the end result should closely match the actual game.</li>
</ul>
<h2 dir="auto"><a id="user-content-directory-layout" aria-hidden="true" href="#directory-layout"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Directory Layout</h2>
<ul dir="auto">
<li><code>assets</code>: extracted assets (textures, translated game text, audio) generated by the decompiler. Not included in the repository. This data is used when building the PC port.</li>
<li><code>build</code>: C++ CMake build folder.</li>
<li><code>common</code>: common C++ code shared between the compiler, decompiler, and game.
<ul dir="auto">
<li><code>audio</code>: tools for decoding the audio files.</li>
<li><code>cross_os_debug</code>: platform-independent library for implementing the OpenGOAL debugger. Linux and Windows.</li>
<li><code>cross_sockets</code>: platform-independent library for sockets. Used to connect the compiler to a running game. Linux and Windows.</li>
<li><code>goos</code>: the compiler-time macro language and parser for OpenGOAL.</li>
<li><code>type_system</code>: the OpenGOAL type system.</li>
<li><code>texture</code>: texture unpacking and format conversion.</li>
<li><code>dma</code>: utilities for handling the transfer of PS2 DMA packets.</li>
<li><code>util</code>, <code>math</code>, <code>log</code>: Random utility functions for accessing files, timers, etc.</li>
</ul>
</li>
<li><code>decompiler</code>: Source code for the decompiler.
<ul dir="auto">
<li><code>analysis</code>: analysis algorithms.</li>
<li><code>config</code>: JSON config files for the decompiler and type definition file.</li>
<li><code>data</code>: utilities to extract assets from the game.</li>
<li><code>Disasm</code>: MIPS disassembler.</li>
<li><code>Function</code>: Tools for analyzing GOAL functions.</li>
<li><code>gui</code>: an early prototype of a Python GUI for reading the output of the decompiler.</li>
<li><code>IR2</code>: the &#34;Intermediate Representation&#34; for GOAL functions and expressions.</li>
<li><code>ObjectFile</code>: Utilities for processing the GOAL object file format.</li>
<li><code>scripts</code>: Useful scripts for setting up the decompilation.</li>
<li><code>util</code>: random utilities.</li>
<li><code>VuDisasm</code>: disassembler for VU code.</li>
</ul>
</li>
<li><code>decompiler_out</code>: output of the decompiler that&#39;s not automatically used by the compiler. This is for humans to read and use. Not included in the repository.</li>
<li><code>docs</code>: more documentation!</li>
<li><code>game</code>: the source code for the game executable.
<ul dir="auto">
<li><code>common</code>: shared stuff between the <code>kernel</code> (EE) and <code>overlord</code> (IOP).</li>
<li><code>graphics</code>: PC Port graphics.</li>
<li><code>kernel</code>: the part of the GOAL kernel written in C. The entry point for the game is in <code>kboot.cpp</code>.</li>
<li><code>overlord</code>: the I/O processor driver used to get data off of the DVD.</li>
<li><code>sce</code>: the Sony library implementation.</li>
<li><code>system</code>: PC-port specific OS-level stuff, like file I/O, threads, controllers, debug network connection.</li>
</ul>
</li>
<li><code>goal_src</code>: The GOAL code for the game.
<ul dir="auto">
<li><code>build</code>: info related to the GOAL build system.</li>
<li><code>engine</code>: the game engine.</li>
<li><code>kernel</code>: The GOAL kernel.</li>
<li><code>levels</code>: Level specific code.</li>
<li><code>old</code>: Unused or deleted files from the original game.</li>
<li><code>dgos</code>: File lists for DGOs in the build system.</li>
<li><code>examples</code>: Example GOAL code we have written.</li>
<li><code>test</code>: Test code we have written.</li>
<li><code>pc_debug</code>: GOAL code for PC-specific debugging. Also written by us.</li>
<li><code>user</code>: User sandboxes. Written by you! And anyone else that wishes to share their user code.</li>
</ul>
</li>
<li><code>goalc</code>: The OpenGOAL compiler.
<ul dir="auto">
<li><code>compiler</code>: The implementation of the OpenGOAL language.</li>
<li><code>data_compiler</code>: Tools for packing data.</li>
<li><code>debugger</code>: The OpenGOAL debugger (part of the compiler).</li>
<li><code>emitter</code>: x86-64 emitter and object file generator.</li>
<li><code>listener</code>: The OpenGOAL listener, which connects the compiler to a running GOAL program for the interactive REPL.</li>
<li><code>make</code>: The OpenGOAL build system, builds both code and data files.</li>
<li><code>regalloc</code>: Register allocator.</li>
</ul>
</li>
<li><code>iso_data</code>:</li>
<li><code>out</code>: Outputs from the build process. Only the <code>iso</code> subfolder should contain assets used by the game.
<ul dir="auto">
<li><code>iso</code>: Final outputs that are used by the game.</li>
<li><code>obj</code>: Object files generated by the compiler.</li>
</ul>
</li>
<li><code>resources</code>: To be removed. Contains fake versions of some files required to get things booting.</li>
<li><code>scripts</code>: Utility scripts. Windows-specific batch files are in a <code>batch</code> folder while Unix shell scripts are in a <code>shell</code> folder.</li>
<li><code>test</code>: Unit tests (run on GitHub Actions).</li>
<li><code>third-party</code>: Third party libraries.
<ul dir="auto">
<li>CMake Code Coverage. For code coverage statistics on GitHub builds.</li>
<li><code>fmt</code>. String formatting library.</li>
<li><code>googletest</code>: Test framework.</li>
<li><code>inja</code>: templating library used for generating test code for compiler tests.</li>
<li><code>lzokay</code>: decompression code for Jak 2 and later DGOs.</li>
<li><code>mman</code>: Windows library used to emulate <code>mmap</code> on Linux.</li>
<li><code>run-clang-format</code>: Utility to check and enforce code formatting.</li>
<li><code>run-clang-tidy</code></li>
<li><code>zydis</code>: x86-64 disassembler used in the OpenGOAL debugger.</li>
<li><code>json</code>: A JSON library.</li>
<li><code>replxx</code>: Used for the REPL input. Supports history and useful editing shortcuts.</li>
<li><code>svpng</code>: Save a PNG file.</li>
</ul>
</li>
</ul>
<h3 dir="auto"><a id="user-content-on-windows--visual-studio" aria-hidden="true" href="#on-windows--visual-studio"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>On Windows / Visual Studio</h3>
<p dir="auto">Until 16.9 Preview 4, when attaching a debugger to the ASan build, you must disable breaking on Win32 Access Violation exceptions. See the relevant section <code>Debugging - Exceptions</code> here <a href="https://devblogs.microsoft.com/cppblog/asan-for-windows-x64-and-debug-build-support/#known-issues" rel="nofollow">https://devblogs.microsoft.com/cppblog/asan-for-windows-x64-and-debug-build-support/#known-issues</a></p>
</article>
        </div></div>
  </body>
</html>
