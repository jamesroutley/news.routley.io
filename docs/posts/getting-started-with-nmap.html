<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ittavern.com/getting-started-with-nmap/">Original</a>
    <h1>Getting started with nmap</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody text">
    <p><strong>Disclaimer</strong>: Only scan networks you have permission for. Many VPS provider do not allow the scanning of other networks and can cause you trouble. Please be aware of it.</p>
<h3>Installation</h3>
<p>I won&#39;t cover the installation of nmap in this blog post. It is available for many OSs, and a simple look up with your favorite search engine will give you enough results to get it done.</p>
<h3>What is nmap?</h3>
<p>Nmap (Network mapper) is an open-source tool for network and security auditing. It is used for host and service discovery on networks and has a wide range of use cases. It can scan ports, discover live hosts, detect service and OS versions, runs vulnerability scans, and can be used with many scripts.</p>
<p>I&#39;ll show you the basics of nmap in this post. This is more than enough to get started.</p>
<p><strong>Important</strong>: I recommand to use nmap as <strong>root</strong> since not all scans are available for non-root users. The kernel constrains standard users from using all functions of the NIC.</p>
<h3>Specifiy the hosts or networks to scan</h3>
<p>You&#39;ll start by defining the range of the scan. This is mandatory and there are multiple ways to do it.</p>
<dl>
<dt>Single address / host name:</dt>
<dd><code>nmap 10.10.20.1</code></dd>
<dd>
<code>nmap scanme.nmap.org</code> <em># You have permission to scan this domain / host. Visit <a href="http://scanme.nmap.org/">this page</a> for more information. As mentioned before, be aware that many server providers prohibit the scan of other networks.</em>
</dd>
<dt>There are several ways to define a range of targets:</dt>
<dd><code>nmap 10.10.10.1 10.10.10.2 10.10.10.3</code></dd>
<dd><code>nmap 10.10.10.1,2,3</code></dd>
<dd><code>nmap 10.10.10.1-50</code></dd>
<dd><code>nmap 10.10.10.0/24</code></dd>
<dt>Use a file with a list of targets (hosts/network):</dt>
<dd><code>nmap -iL /path/to/file.txt</code></dd>
</dl>
<p><strong>Side note</strong>: The list can have various formats. All hosts in one single line, seperated by spaces, or you can put every host in separate line, or even combine it like this:</p>
<div><pre>10.10.10.1 10.10.20.2
10.10.30.3
</pre></div>

<p>Nmap would scan 3 hosts.</p>
<dl>
<dt>Choose random number of hosts within a chosen range:</dt>
<dd><code>nmap 10.10.10.0/24 -iR 5</code></dd>
</dl>
<h5>Exclude hosts and networks from scans</h5>
<dl>
<dt>Choose hosts or network that should be excluded:</dt>
<dd><code>nmap 192.168.0.0/24 --exclude 192.168.0.2</code></dd>
<dt>Use a file with a list of exclusions:</dt>
<dd><code>nmap 10.10.10.0/24 --excludefile /path/to/file.txt</code></dd>
</dl>
<h3>SPECIFIC PORT RANGES</h3>
<p><strong>Side note</strong>: Without a flag, it runs the 1000 common TCP ports by default. <a href="https://nmap.org/book/port-scanning.html">Source</a> </p>
<dl>
<dt>*For a quick scan, that only scans the first 100 ports, use the <code>-F</code> flag:</dt>
<dd><code>nmap 10.10.10.1 -F</code></dd>
<dt>Scan of a single port:</dt>
<dd><code>nmap 10.10.10.0/24 -p 22</code></dd>
<dt>Scan of several ports:</dt>
<dd><code>nmap 10.10.10.0/24 -p 22,80</code></dd>
<dd><code>nmap 10.10.10.0/24 -p 1-100</code></dd>
<dd><code>nmap 10.10.10.0/24 -p 80</code></dd>
<dt>
<code>-p-</code> would scan ALL ports (0 to 65535):</dt>
<dd><code>nmap 10.10.10.0/24 -p-</code></dd>
</dl>
<p>TCP is the default protocol. You can specificly choose TCP or UDP like this:</p>
<dl>
<dt>TCP <em>(default)</em>:</dt>
<dd><code>nmap 10.10.10.0/24 -p T:53</code></dd>
<dt>UDP:</dt>
<dd><code>nmap 10.10.10.0/24 -p U:53</code></dd>
<dt>Combine both:</dt>
<dd><code>nmap 10.10.10.0/24 -p T:53,U:53</code></dd>
</dl>
<p><strong>Important</strong>: the <code>T:</code> and <code>U:</code> must be capitalized since it is case-sensitive.</p>
<p>If you only want to scan UDP ports, use the <code>-sU</code> flag to do so.</p>
<dl>
<dt>I am not familiar with it, but you can work with protocol names like this:</dt>
<dd>
<code>nmap 10.10.10.0/24 -p SMTP</code> <em># never worked for me tho</em>
</dd>
</dl>
<h5>Exlude ports from scan</h5>
<dl>
<dt>Simply us the <code>--exlude-ports</code> option and the ports / port range:</dt>
<dd><code>nmap 10.10.10.1 -p 1-100 --exlude-ports 22,53</code></dd>
</dl>
<h5>Set the source port</h5>
<dl>
<dt>Use the <code>-g</code>flag to specify the source port of the scan:</dt>
<dd><code>nmap 10.10.10.1 -g 12345</code></dd>
</dl>
<h3>Save output to file</h3>
<p>There are 3 formats you can pick between:</p>
<dl>
<dt>Console output:</dt>
<dd><code>-oN results.txt</code></dd>
<dt>&#39;Grepable&#39; console output:</dt>
<dd><code>-oG results.txt</code></dd>
<dt>XML format:</dt>
<dd><code>-oX results.txt</code></dd>
<dt>Saves output of ALL 3 formats:</dt>
<dd><code>-oA results.txt</code></dd>
</dl>
<p>If you want to append the results to a file, simply add the <code>--append-output</code> option to the command.</p>
<h3>Port states</h3>
<p>Nmap distinguishes the state of the port in six categories. This section is copied from the <a href="https://nmap.org/book/man-port-scanning-basics.html">official documentation</a> since it is explained really well.</p>
<p><strong>open</strong></p>
<blockquote>
<p>An application is actively accepting TCP connections, UDP datagrams or SCTP associations on this port. Finding these is often the primary goal of port scanning. Security-minded people know that each open port is an avenue for attack. Attackers and pen-testers want to exploit the open ports, while administrators try to close or protect them with firewalls without thwarting legitimate users. Open ports are also interesting for non-security scans because they show services available for use on the network. </p>
</blockquote>
<p><strong>closed</strong></p>
<blockquote>
<p>A closed port is accessible (it receives and responds to Nmap probe packets), but there is no application listening on it. They can be helpful in showing that a host is up on an IP address (host discovery, or ping scanning), and as part of OS detection. Because closed ports are reachable, it may be worth scanning later in case some open up. Administrators may want to consider blocking such ports with a firewall. Then they would appear in the filtered state, discussed next. </p>
</blockquote>
<p><strong>filtered</strong></p>
<blockquote>
<p>Nmap cannot determine whether the port is open because packet filtering prevents its probes from reaching the port. The filtering could be from a dedicated firewall device, router rules, or host-based firewall software. These ports frustrate attackers because they provide so little information. Sometimes they respond with ICMP error messages such as type 3 code 13 (destination unreachable: communication administratively prohibited), but filters that simply drop probes without responding are far more common. This forces Nmap to retry several times just in case the probe was dropped due to network congestion rather than filtering. This slows down the scan dramatically.</p>
</blockquote>
<p><strong>unfiltered</strong></p>
<blockquote>
<p>The unfiltered state means that a port is accessible, but Nmap is unable to determine whether it is open or closed. Only the ACK scan, which is used to map firewall rulesets, classifies ports into this state. Scanning unfiltered ports with other scan types such as Window scan, SYN scan, or FIN scan, may help resolve whether the port is open. </p>
</blockquote>
<p><strong>open|filtered</strong></p>
<blockquote>
<p>map places ports in this state when it is unable to determine whether a port is open or filtered. This occurs for scan types in which open ports give no response. The lack of response could also mean that a packet filter dropped the probe or any response it elicited. So Nmap does not know for sure whether the port is open or being filtered. The UDP, IP protocol, FIN, NULL, and Xmas scans classify ports this way.</p>
</blockquote>
<p><strong>closed|filtered</strong></p>
<blockquote>
<p>This state is used when Nmap is unable to determine whether a port is closed or filtered. It is only used for the IP ID idle scan.</p>
</blockquote>
<h3>Scan timing / timing templates</h3>
<dl>
<dt>With these timing templates, you can decide how aggressive and fast you want to scan your targets. The lower the number, the slower scan and vice versa. You can choose them with the <code>-T</code> flag like this:</dt>
<dd>
<code>-T0</code> paranoid</dd>
<dd>
<code>-T1</code> sneaky</dd>
<dd>
<code>-T2</code> polite</dd>
<dd>
<code>-T3</code> normal (default)</dd>
<dd>
<code>-T4</code> aggressive</dd>
<dd>
<code>-T5</code> insane</dd>
</dl>
<p><code>-T0</code> and <code>-T1</code> for example are used for IDS evasion. The scans are less aggressive, have more delay, look more random, and so on. <code>-T5</code> is really aggressive, fast and rather unreliable due loss of packets. </p>
<p>A detailed table of differences can be found in the <a href="https://nmap.org/book/performance-timing-templates.html">official documentation</a></p>
<h3>Scripts</h3>
<p><strong>Disclaimer + Important:</strong>  Scripts are not run in a sandbox and thus could accidentally or maliciously damage your system or invade your privacy. Never run scripts from third parties unless you trust the authors or have carefully audited the scripts yourself. </p>
<p>The Nmap Scripting Engine (NSE) allows you to use, and share various scripts. The scripts are written in Lua.</p>
<p>There are different categories of scripts. The current categories are: auth, broadcast, default, discovery, dos, exploit, external, fuzzer, intrusive, malware, safe, version, and vuln.</p>
<dl>
<dt>Run a script:</dt>
<dd><code>--script filename / category / directory</code></dd>
<dd><em>all scripts in the category or directory would be loaded</em></dd>
</dl>
<p>Nmap scripting is way beyond the scope of this post, and since I am not too familiar, I rather keep it short. I mostly use scripts for finding SMBv1 servers (<code>smb-os-discovery</code>), display of SSH authentication information (<code>ssh-auth-methods</code>) or all available DHCP server (<code>broadcast-dhcp-discover</code>). The last one is great for debug DHCP problems or find rogue DHCP servers. </p>
<p>Often enough scripts are used to find vulnerabilities. One example can be found <a href="https://github.com/Diverto/nse-log4shell">on Github</a>. A helpful script to check against <strong>log4shell or LogJam vulnerabilities</strong> (CVE-2021-44228).</p>
<h3>Helpful additional scan options</h3>
<dl>
<dt>Verbosity of the scan:</dt>
<dd>
<code>-v</code> / <code>-vv</code> / <code>-vvv</code>
</dd>
<dt>Choose the interface for the scan:</dt>
<dd><code>-e interfacename</code></dd>
<dt>skip reverse DNS look-up:</dt>
<dd><code>-n</code></dd>
<dt>force reverse DNS, even when host is offine:</dt>
<dd><code>-R</code></dd>
<dt>Scan IPv6 addresses:</dt>
<dd><code>-6 ::ffff:1234:abcd</code></dd>
</dl>
<h3>List of various options</h3>
<dl>
<dt>detecting the version of services running on the target:</dt>
<dd><code>-sV</code></dd>
<dt>detecting operating system of the target by fingerprinting:</dt>
<dd><code>-O</code></dd>
<dt>TCP Syn scan - Stealth mode:</dt>
<dd><code>-sS</code></dd>
<dd>sending TCP/SYN packet, waits for TCP/ACK. Slower, but less aggressive</dd>
<dt>TCP full connect - 3-way-handshake:</dt>
<dd><code>-sT</code></dd>
<dd>it is more acurate, but slower and noisier:</dd>
<dt>ICMP echo request / ping for a quick scan:</dt>
<dd><code>-sP</code></dd>
<dt>No ICMP echo request / ping, nmap assumes the host is up:</dt>
<dd><code>-Pn</code></dd>
<dt>ICMP echo request:</dt>
<dd><code>-PE</code></dd>
<dt>ICMP Timestamp request:</dt>
<dd>
<code>-PP</code> </dd>
<dt>ICMP netmask request:</dt>
<dd><code>-PM</code></dd>
<dt>TCP SYN ping:</dt>
<dd><code>-PS PORTNUMBER</code></dd>
<dd><em>Port 40125 is the default, if no port entered</em></dd>
<dt>TCP ACK Ping use</dt>
<dd><code>-PA  PORTNUMBER</code></dd>
<dd><em>Port 40125 is the default, if no port entered</em></dd>
</dl>
<h5>IDS/ FW Evasion</h5>
<p>This is a topic for another time and unnecessary for beginners, but just some methods of IDS/FW evasion.</p>
<dl>
<dt>Decoy mode - tries to hide your IP in a pool of other IPs</dt>
<dd><code>nmap -D 10.10.10.22,10.10.10.44,10.10.10.66 10.10.10.1</code></dd>
<dd>
<code>10.10.10.22</code> <em># your own IP</em>
</dd>
<dd>
<code>10.10.10.44</code> <em># decoy IP</em>
</dd>
<dd>
<code>10.10.10.66</code> <em># decoy IP</em>
</dd>
<dd>
<code>10.10.10.1</code> <em># IP of target</em>
</dd>
<dt>Change the source IP:</dt>
<dd><code>-S</code></dd>
<dt>Spoof another MAC address:</dt>
<dd><code>--spoof-mac MAC-ADDRESS / prefix / vendor name</code></dd>
<dt>Using a HTTP/SOCKS4 proxy:</dt>
<dd><code>--proxies URL,[url2],...</code></dd>
</dl>
<h2>Conclusion</h2>
<p>Nmap is unbelievably powerful and invaluable for my day-to-day work. I hope I gave you a insight into the possibilities of nmap. If you think I forgot something, feel free to reach out.</p>

<hr/>
<p><b>E-Mail</b> 
hello@ittavern.com
</p><!-- End post-list post_list_b7315e37e55f42968fe9004650e27856 -->



<!-- End post-list post_list_f71460d415664dd99ab453fbb3ffe847 -->
    </div></div>
  </body>
</html>
