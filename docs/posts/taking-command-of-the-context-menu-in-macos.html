<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.gingerbeardman.com/2024/07/30/taking-command-of-the-context-menu-in-macos/">Original</a>
    <h1>Taking command of the Context Menu in macOS</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
          

          

          

          <p>Yesterday on Twitter the inimitable Morten Just posted a preview of a tool he’s created that wrap ffmpeg to allow movies, such screen recordings but pretty much anything, to be re-encoded to a smaller filesize.</p>

<p>I responded with a trick I use to do the same on right-click using a macOS app called <em>ContextMenu</em>, and others said it was possible to do it using <em>Automator</em> (with some caveats). In this blog post I’ll compare the two.</p>

<p>But first… let’s talk about how we will make this work.</p>

<hr/>



<p>We’ll be making use of command line tools to do the heavy lifting, but don’t worry I’ll show that this can be as simple as a single-line command to process a single file, or a shell scripts of a few lines to process multiple files.</p>

<h3 id="single-files">Single files</h3>

<p>The one-line command to convert a video or audio file can be as simple as the following:</p>

<div><div><pre><code>/opt/homebrew/bin/ffmpeg <span>-i</span> <span>&#34;</span><span>$@</span><span>&#34;</span> <span>&#34;</span><span>${</span><span>@%.*</span><span>}</span><span>.mp4&#34;</span>
</code></pre></div></div>

<p>There are some assumptions here:</p>
<ul>
  <li>
<code>ffmpeg</code> has been installed using <code>brew</code>
</li>
  <li>my Mac is Apple silicon, so <code>brew</code> installs commands to <code>/opt/homebrew/bin/</code>
</li>
  <li>(older Intel Macs will have them installed to <code>/usr/local/bin/</code>)</li>
  <li>the script is called with parameters passed by <code>argv</code> so the file is <code>$@</code>
</li>
  <li>the new file will have the same name as the original, but with a new .mp4 file extension</li>
  <li>it only works on single files (read on)</li>
</ul>

<p>You can take the exact same approach with any destination format as it is decided by the file extension. Cool. You could convert any of ffmpeg’s supported file types to any other, such as WAV, OGG, MKV, etc.</p>

<p>And as we’ll see later we can take this simple command and change it to use other command line tools to compress GIFs, with or without upscaling, and many other timesaving tasks. Powerful stuff!</p>

<h3 id="multiple-files">Multiple files</h3>

<p>To extend this approach for multiple files you can use the following for loop:</p>

<div><div><pre><code><span>for </span>f <span>in</span> <span>&#34;</span><span>$@</span><span>&#34;</span>
<span>do</span>
    /opt/homebrew/bin/ffmpeg <span>-i</span> <span>&#34;</span><span>$f</span><span>&#34;</span> <span>&#34;</span><span>${</span><span>f</span><span>%.*</span><span>}</span><span>.mp4&#34;</span>
<span>done</span>
</code></pre></div></div>

<h3 id="multiple-files-in-parallel">Multiple files in parallel</h3>

<p>And to process those multiple files in parallel (be careful not to overwhelm your computer!) we can background each execution using the <code>&amp;</code> symbol.</p>

<div><div><pre><code><span>for </span>f <span>in</span> <span>&#34;</span><span>$@</span><span>&#34;</span>
<span>do</span>
    /opt/homebrew/bin/ffmpeg <span>-i</span> <span>&#34;</span><span>$f</span><span>&#34;</span> <span>&#34;</span><span>${</span><span>f</span><span>%.*</span><span>}</span><span>.mp4&#34;</span> &amp;
<span>done</span>
</code></pre></div></div>

<hr/>

<h2 id="automator">Automator</h2>

<p>Setup is relatively straightforward:</p>

<ol>
  <li>Create a new <em>Quick Action</em> workflow</li>
  <li>Workflow receives current: <em>movie files</em>
</li>
  <li>in: <em>Finder</em>
</li>
  <li>Add a new action of type action <em>Run Shell Script</em> (search for it in the sidebar)</li>
  <li>Pass input: <em>as arguments</em> (this will give us a template command)</li>
  <li><em>Replace the echo line with your command</em></li>
  <li>
<em>Save</em>, name it “Duplicate as MP4”</li>
</ol>

<p><img src="https://cdn.gingerbeardman.com/images/posts/take-command-automator-setup.png" alt="PNG" loading="lazy"/></p>

<p>The menu item is now available on the right click menu, inside the <em>Quick <em>Actions</em></em> submenu. After repeated use I find this submenu too annoying, but you may fare better.</p>

<p><img src="https://cdn.gingerbeardman.com/images/posts/take-command-automator-finder.png#half" alt="PNG" title="Automator Quick Action in Finder Context Menu" loading="lazy"/></p>

<p>So, pretty easy! But, there are some caveats or limitations that may, or may not, annoy you. Perhaps we don’t want the menu item to appear for such a broad range of files (all “movie files”), or maybe we want it to appear for multiple types of files (both “audio files” and “movie files”). Sadly this is not so easy with <em>Automator</em>.</p>

<p>Automator stores these files at <code>~/Library/Services/</code> and they will migrate to a new Mac.</p>

<hr/>



<p>Many years ago I found <a href="https://apps.apple.com/us/app/context-menu/id1236813619?mt=12">ContextMenu</a> ($4.99) which solves all of the issues I have with the <em>Automator</em> approach. There’s also a free version, <a href="https://apps.apple.com/gb/app/context-menu-lite/id1261373706?mt=12">ContextMenu Lite</a>, that supports up to 3 actions to give you a taste of the good stuff.</p>

<ul>
  <li>Submenu is optional</li>
  <li>Apply to multiple types (files or directories; can be as granular as file extension)</li>
  <li>Show output (sometimes you want to see the results of the command)</li>
  <li>Confirmation before running (if it’s a potentially dangerous operation)</li>
</ul>

<p><img src="https://cdn.gingerbeardman.com/images/posts/take-command-context-menu-setup.png#half" alt="PNG" loading="lazy"/></p>

<p>The menu item displays in Finder as follows:</p>

<p><img src="https://cdn.gingerbeardman.com/images/posts/take-command-context-menu-finder.png#half" alt="PNG" title="ContextMenu Action in Finder Context Menu" loading="lazy"/></p>

<p>ContextMenu stores these files in its own group folder, right click an action and choose <em>Show in Finder</em>, but you can specify your own folder in a location of uyour choice. The later is probably the best way to migrate them to a new Mac.</p>

<hr/>

<h2 id="compressing-a-gif">Compressing a GIF</h2>

<p>We can use the <a href="https://www.lcdf.org/gifsicle/">gifsicle</a> command line tool to optimise (compress) an Animated GIF. The a parameters I use here are explained in the <a href="https://www.lcdf.org/gifsicle/man.html">gifsicle man page</a>, and I arrived at them with <a href="https://blog.gingerbeardman.com/2016/06/16/post-processing-animated-gifs/">years of experimentation</a>.</p>

<div><div><pre><code>/opt/homebrew/bin/gifsicle <span>-O1</span> <span>-Okeep-empty</span> <span>--careful</span> <span>&#34;</span><span>$@</span><span>&#34;</span> <span>&gt;</span> <span>&#34;</span><span>${</span><span>@%.gif</span><span>}</span><span>.o.gif&#34;</span>
</code></pre></div></div>

<p>We can also do the same thing whilst scaling it up by a factor of 2:</p>

<div><div><pre><code>/opt/homebrew/bin/gifsicle <span>-O1</span> <span>-Okeep-empty</span> <span>--careful</span> <span>--scale</span> 2 <span>&#34;</span><span>$@</span><span>&#34;</span> <span>&gt;</span> <span>&#34;</span><span>${</span><span>@%.gif</span><span>}</span><span>.o.gif&#34;</span>
</code></pre></div></div>

<hr/>



<p>Here’s my repo of shared actions. Inside each <code>.cmaction</code> file is a <code>main.sh</code> file which contains the command that you can use in <em>Automator</em> if you’d like.</p>

<ul>
  <li><a href="https://github.com/gingerbeardman/contextmenu-actions">https://github.com/gingerbeardman/contextmenu-actions</a></li>
</ul>

<p>These include many useful commands such as:</p>

<ul>
  <li>Convert BIN+CUE to ISO</li>
  <li>Change sample rate of audio</li>
  <li>Convert image to 1-bit</li>
  <li>Convert image format</li>
  <li>Create Clean ZIP</li>
  <li>Duplicate audio as alternative format</li>
  <li>Duplicate image as alternative format</li>
  <li>Duplicate movie as alternative format</li>
  <li>File information</li>
  <li>Generate images for web</li>
  <li>Make script executable</li>
  <li>Move file (includes helper app)</li>
  <li>New file with clipboard</li>
  <li>Open file with specific apps</li>
  <li>Optimize GIF</li>
  <li>Set GIF to loop infinitely</li>
  <li>Show GIF info</li>
  <li>Playdate Colorize IMG</li>
  <li>Replace Existing App (warning)</li>
  <li>Scale image to certain percentage</li>
  <li>Set as MacJapanese encoding</li>
  <li>Show hashes (includes helper app)</li>
  <li>Stub out file (warning)</li>
  <li>Touch file</li>
</ul>

        </div></div>
  </body>
</html>
