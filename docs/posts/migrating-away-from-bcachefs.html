<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.sesse.net/blog/tech/2025-01-20-21-45_migrating_away_from_bcachefs.html">Original</a>
    <h1>Migrating Away from Bcachefs</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>Pretty much exactly a year ago, I posted about how I was trying out this
bcachefs thing, being cautiously optimistic (but reminding you to keep
backups). Now I&#39;m going the other way; I&#39;ve converted my last bcachefs
filesystem to XFS, and I don&#39;t intend to look at it again in the near
future.</p>

<p>What changed in the meantime? Well, the short version is: I no longer
trust bcachefs&#39; future. Going into a new filesystem is invariably
filled with rough edges, and I totally accepted that (thus the backups).
But you do get a hope that things will get better, and for a filesystem
developed by a single person (Kent Overstreet), that means you&#39;ll need
to trust that person to a fairly large degree. Having both hung out in
#bcache and seen how this plays out
<a href="https://lore.kernel.org/lkml/172816780614.3194359.10913571563159868953.pr-tracker-bot@kernel.org/T/">on LKML</a> and <a href="https://jonathancarter.org/2024/08/29/orphaning-bcachefs-tools-in-debian/">against Debian</a>, I don&#39;t
really have that trust anymore.</p>

<p>To be clear: I&#39;ve seen my share of bugs. Whenever you see Kent defending
his filesystem, he usually emphasizes how he has a lot of happy users
and very few bugs left and things are going to be great after Just The
Next Refactor. (Having to call out this explicitly all the time is usually
a bad sign in itself.) But, well, I&#39;ve had catastrophic data loss bugs that went unfixed
for weeks despite multiple people reporting them. I&#39;ve seen strange read
performance issues. I&#39;ve had oopses. And when you go and ask about why you get e.g. hang
messages in the kernel log, you get “oh, yeah, that&#39;s a known issue with
compression, we&#39;re not entirely sure what to do about it”.</p>

<p>There are more things: SSD promotion/demotion doesn&#39;t always work.
Erasure coding is known-experimental. Userspace fsck frequently hangs my
system during boot (I need to go into a debug console and kill mount,
and <em>then</em> the kernel mounts the filesystem). umount can take minutes sometimes.
The filesystem claims to support quotas, but there&#39;s no way to actually
make the Linux standard quota tools enable quotas on a multi-device
filesystem. And you&#39;ll generally need to spent 8% on spare space for
copygc, even if your filesystem consists of entirely static files.</p>

<p>You could argue that since I didn&#39;t report all of these bugs, I cannot
expect them to be fixed either. But here&#39;s the main issue for me: Reporting bugs to bcachefs
is not a pleasant experience. You hang around in #bcache on IRC, and perhaps
Kent is awake, perhaps he&#39;s not, perhaps things get fixed or perhaps other
things take priority. But you <em>can</em> expect to get flamed about running Debian,
or perhaps more accurately, not being willing to spearhead Kent&#39;s crusade
against Debian&#39;s Rust packaging policies. (No, you cannot stay neutral.
No, you cannot just want to get your filesystem fixed. You are expected
to actively go and fight the Rust team on Kent&#39;s behalf.) Kent has made
it clear that for distributions to carry bcachefs-tools (which you need
to, among others, mount filesystems), it&#39;s his way
or the highway; ship exactly what he wants in the way that he wants it,
or just go away. (Similarly, it&#39;s the “kernel&#39;s culture” and “an mm
maintainer” that are the problems; it&#39;s not like Kent ought to change
the way he wants to develop or anything.)</p>

<p>So I simply reverted back to something tried and trusted. It&#39;s a bit sad
to lose the compression benefits, but I can afford those 100 extra gigabytes
of disk space. And it was nice to have partial-SSD-partial-HDD filesystems
(it worked better than dm-cache for me), but it turns out 1TB SSDs are cheap
now and I could have my key filesystems (/home and /var/lib/postgres)
entirely on SSD instead.</p>

<p>Look, I&#39;m not saying bcachefs sucks. Nor that it is doomed; perhaps Kent
will accept that he needs to work differently for it to thrive in the kernel
(and the Linux ecosystem as a whole), no matter how right he feels he is.
But with a filesystem this young, you inevitably have to accept some rough
edges in return for some fun. And at some point, the fun just stopped for me.</p>

<p>Perhaps in a couple of years?</p>

</div></div>
  </body>
</html>
