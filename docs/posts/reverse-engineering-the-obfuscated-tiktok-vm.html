<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering">Original</a>
    <h1>Reverse engineering the obfuscated TikTok VM</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">This project is for reverse engineering the TikTok Virtual Machine (VM).</p>

<p dir="auto">TikTok uses a custom virtual machine (VM) as part of its obfuscation and security layers. This project includes tools to:</p>
<ul dir="auto">
<li><strong>Deobfuscate</strong> <code>webmssdk.js</code> that has the virtual machine.</li>
<li><strong>Decompile</strong> TikTokâ€™s virtual machine instructions into readable form.</li>
<li><strong>Script Inject</strong> Replace webmssdk.js with the deobfuscated VM <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/injector.js">injector</a>.</li>
<li><strong>Sign URLs</strong> Generate signed URLs which can be used to perform auth-based requests eg. Post comments.</li>
</ul>
<hr/>

<p dir="auto">When looking at <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/deobfVersions/raw.js">webmssdk.js</a> you&#39;re met with a
heavily obfuscated file. The main method of obfuscating Javascript
is to take advantage of bracket notation which let&#39;s you index a variable
using another variable.</p>
<p dir="auto">So when you see something like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// Line 3391 of ./deobfVersions/raw.js
r[Gb[301]](Gb[57], e))"><pre><span>// Line 3391 of ./deobfVersions/raw.js</span>
<span>r</span><span>[</span><span>Gb</span><span>[</span><span>301</span><span>]</span><span>]</span><span>(</span><span>Gb</span><span>[</span><span>57</span><span>]</span><span>,</span> <span>e</span><span>)</span><span>)</span></pre></div>
<p dir="auto">You have absolutely no idea what it&#39;s indexing.</p>
<p dir="auto">Each use of this method is using an array <code>Gb</code> defined as</p>
<div dir="auto" data-snippet-clipboard-copy-content="    var Gb = [&#34;ydTGHdFNV&#34;, &#34;sNxpGNHMrpLV&#34;, &#34;xyrNMLEN Fpp rpMu&#34;, &#34;ydWyNe&#34;, ...].map(function(a) {
        return a.split(&#34;&#34;).map(function(c) {
            return &#34;LsfVNxutyOcrEMpYAGdFHneaUKRXSgoJDbhqICzPZklivTmWBwQj&#34;.indexOf(c) == -1 ? c : &#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;[&#34;LsfVNxutyOcrEMpYAGdFHneaUKRXSgoJDbhqICzPZklivTmWBwQj&#34;.indexOf(c)]
        }).join(&#34;&#34;)
    });"><pre>    <span>var</span> <span>Gb</span> <span>=</span> <span>[</span><span>&#34;ydTGHdFNV&#34;</span><span>,</span> <span>&#34;sNxpGNHMrpLV&#34;</span><span>,</span> <span>&#34;xyrNMLEN Fpp rpMu&#34;</span><span>,</span> <span>&#34;ydWyNe&#34;</span><span>,</span> ...<span>]</span><span>.</span><span>map</span><span>(</span><span>function</span><span>(</span><span>a</span><span>)</span> <span>{</span>
        <span>return</span> <span>a</span><span>.</span><span>split</span><span>(</span><span>&#34;&#34;</span><span>)</span><span>.</span><span>map</span><span>(</span><span>function</span><span>(</span><span>c</span><span>)</span> <span>{</span>
            <span>return</span> <span>&#34;LsfVNxutyOcrEMpYAGdFHneaUKRXSgoJDbhqICzPZklivTmWBwQj&#34;</span><span>.</span><span>indexOf</span><span>(</span><span>c</span><span>)</span> <span>==</span> <span>-</span><span>1</span> ? <span>c</span> : <span>&#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><span>[</span><span>&#34;LsfVNxutyOcrEMpYAGdFHneaUKRXSgoJDbhqICzPZklivTmWBwQj&#34;</span><span>.</span><span>indexOf</span><span>(</span><span>c</span><span>)</span><span>]</span>
        <span>}</span><span>)</span><span>.</span><span>join</span><span>(</span><span>&#34;&#34;</span><span>)</span>
    <span>}</span><span>)</span><span>;</span></pre></div>
<p dir="auto">As you can see we can&#39;t even read this either as it&#39;s all encoded
using this string <code>&#34;LsfVNxutyOcrEMpYAGdFHneaUKRXSgoJDbhqICzPZklivTmWBwQj&#34;</code>.</p>
<p dir="auto">Because this code get&#39;s executed immediately we can simply take this snippet
and run it in any console and retrieve:</p>
<div dir="auto" data-snippet-clipboard-copy-content="[
    &#34;isTrusted&#34;,
    &#34;beforeunload&#34;,
    &#34;filename too long&#34;,
    &#34;isView&#34;,
    ...
]"><pre><span>[</span>
    <span>&#34;isTrusted&#34;</span><span>,</span>
    <span>&#34;beforeunload&#34;</span><span>,</span>
    <span>&#34;filename too long&#34;</span><span>,</span>
    <span>&#34;isView&#34;</span><span>,</span>
    ...
<span>]</span></pre></div>
<p dir="auto">We can now see each of these strings, therefore we can use RegEx to go through
the script and replace all uses of the array as seen <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/deobfuscation/changeNotation.js#L322">here</a>
It will also convert the bracket notation back to readable dot notation.</p>
<p dir="auto">After that we&#39;ve left with <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/deobfVersions/ems1.js">webmssdk1</a>.</p>
<p dir="auto">The example from above now looks like this</p>
<div dir="auto" data-snippet-clipboard-copy-content="r.addEventListener(&#34;abort&#34;, e),"><pre><span>r</span><span>.</span><span>addEventListener</span><span>(</span><span>&#34;abort&#34;</span><span>,</span> <span>e</span><span>)</span><span>,</span></pre></div>
<p dir="auto">Much better.</p>
<p dir="auto">Another significant obfuscation method used is for disguising function calls.</p>
<p dir="auto">Each function is defined in an array <code>Ab</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="  var Ab = [function(e) {
      return &#34;[object Array]&#34; === Object.prototype.toString.call(e)
  }
  , function(e) {
      return e &amp;&amp; e.__esModule &amp;&amp; Object.prototype.hasOwnProperty.call(e, &#34;default&#34;) ? e.default : e
  }
  , function() {
      var Ga;
      Ga = [0, 1],
      (je = !Ga[0],
      le &amp;&amp; (setTimeout(function() {
          document.dispatchEvent(new Event(pe))
      }, Ga[1]),
      document.removeEventListener(&#34;DOMContentLoaded&#34;, Ab[40]),
      document.removeEventListener(&#34;readystatechange&#34;, Ab[75])))
  }
  ...]"><pre>  <span>var</span> <span>Ab</span> <span>=</span> <span>[</span><span>function</span><span>(</span><span>e</span><span>)</span> <span>{</span>
      <span>return</span> <span>&#34;[object Array]&#34;</span> <span>===</span> <span>Object</span><span>.</span><span>prototype</span><span>.</span><span>toString</span><span>.</span><span>call</span><span>(</span><span>e</span><span>)</span>
  <span>}</span>
  <span>,</span> <span>function</span><span>(</span><span>e</span><span>)</span> <span>{</span>
      <span>return</span> <span>e</span> <span>&amp;&amp;</span> <span>e</span><span>.</span><span>__esModule</span> <span>&amp;&amp;</span> <span>Object</span><span>.</span><span>prototype</span><span>.</span><span>hasOwnProperty</span><span>.</span><span>call</span><span>(</span><span>e</span><span>,</span> <span>&#34;default&#34;</span><span>)</span> ? <span>e</span><span>.</span><span>default</span> : <span>e</span>
  <span>}</span>
  <span>,</span> <span>function</span><span>(</span><span>)</span> <span>{</span>
      <span>var</span> <span>Ga</span><span>;</span>
      <span>Ga</span> <span>=</span> <span>[</span><span>0</span><span>,</span> <span>1</span><span>]</span><span>,</span>
      <span>(</span><span>je</span> <span>=</span> <span>!</span><span>Ga</span><span>[</span><span>0</span><span>]</span><span>,</span>
      <span>le</span> <span>&amp;&amp;</span> <span>(</span><span>setTimeout</span><span>(</span><span>function</span><span>(</span><span>)</span> <span>{</span>
          <span>document</span><span>.</span><span>dispatchEvent</span><span>(</span><span>new</span> <span>Event</span><span>(</span><span>pe</span><span>)</span><span>)</span>
      <span>}</span><span>,</span> <span>Ga</span><span>[</span><span>1</span><span>]</span><span>)</span><span>,</span>
      <span>document</span><span>.</span><span>removeEventListener</span><span>(</span><span>&#34;DOMContentLoaded&#34;</span><span>,</span> <span>Ab</span><span>[</span><span>40</span><span>]</span><span>)</span><span>,</span>
      <span>document</span><span>.</span><span>removeEventListener</span><span>(</span><span>&#34;readystatechange&#34;</span><span>,</span> <span>Ab</span><span>[</span><span>75</span><span>]</span><span>)</span><span>)</span><span>)</span>
  <span>}</span>
  <span>.</span><span>.</span><span>.</span><span>]</span></pre></div>
<p dir="auto">And it used by calling <code>Ab[index](args)</code> like:</p>

<p dir="auto">When using common IDE&#39;s if we click on this function it will just bring us to
the start of the array making it difficult to keep track of what function call
is calling what function.</p>
<p dir="auto">We can make this readable by:</p>
<ul dir="auto">
<li>Taking the array</li>
<li>Replace each of the function element with it&#39;s own standard function calling it <code>function Abindex(args)</code></li>
<li>Replace each call to <code>Ab[index](args)</code> with <code>Abindex(args)</code></li>
</ul>
<p dir="auto">We can do this by using the AST form of the script via bapel as seen <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/deobfuscation/bapel.js#L55">here</a></p>
<p dir="auto">Which gives us <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/deobfVersions/ems2.js#L1798">this</a></p>
<p dir="auto">The Virtual Machine part of the script, specifically when executing the bytecode
is a nested if else statement as seen <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/deobfVersions/ems2.js#L2235">here</a></p>
<p dir="auto">It is actually just a normal switch case but has been disguised pretty well. After manually
doing some of the cases, AI was able to help me out and do the rest. Which gave me <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/handleBytecode.js">this</a>,
which looks pretty standard for a bytecode VM.</p>
<p dir="auto">When debugging the Virtual Machine later and seeing which functions it uses
I was able to tell what it&#39;s doing and changed some of var names.</p>
<p dir="auto">After all of this and a few more small obfuscation techniques
<a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/latestDeobf.js">here</a> is the latest version of the file.</p>
<hr/>

<p dir="auto">With the file fully deobfuscated, figuring out the functionality was much easier,
I easily found how the VM was being initiated <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/latestDeobf.js#L3041">here</a>.</p>
<p dir="auto">The bytecode is stored as a long string that&#39;s all been XOR&#39;ed with a key that
lies within the string.</p>
<div dir="auto" data-snippet-clipboard-copy-content="// Line 3046 of latestDeobf.js
// Getting XOR key
for (var t = atob(payload), r = 0, n = 4; n &lt; 8; ++n) r += t.charCodeAt(n);

// Decryping bytecode
unZip(Uint8Array.from(t.slice(8), XOR, r % 256), {  i: 2 }, t &amp;&amp; t.out, t &amp;&amp; t.dictionary),

// Extracting strings, functions and metadata for each function
for (var n = leb128(t), o = 0; o &lt; n; ++o) strings.push(Ab27(t)); 
i = leb128(t);
for (o = 0; o &lt; i; ++o) {
  for (var argsLength = leb128(t), isStrictMode = Boolean(leb128(t)), exceptionHandlers = new Array(), p = leb128(t), m = 0; m &lt; p; ++m)    exceptionHandlers.push([leb128(t), leb128(t), leb128(t), leb128(t)]);
  for (var instructions = new Array(), h = leb128(t), v = 0; v &lt; h; ++v) instructions.push(leb128(t));
  instructionSets.push([instructions, argsLength, isStrictMode, exceptionHandlers]);
}"><pre><span>// Line 3046 of latestDeobf.js</span>
<span>// Getting XOR key</span>
<span>for</span> <span>(</span><span>var</span> <span>t</span> <span>=</span> <span>atob</span><span>(</span><span>payload</span><span>)</span><span>,</span> <span>r</span> <span>=</span> <span>0</span><span>,</span> <span>n</span> <span>=</span> <span>4</span><span>;</span> <span>n</span> <span>&lt;</span> <span>8</span><span>;</span> <span>++</span><span>n</span><span>)</span> <span>r</span> <span>+=</span> <span>t</span><span>.</span><span>charCodeAt</span><span>(</span><span>n</span><span>)</span><span>;</span>

<span>// Decryping bytecode</span>
<span>unZip</span><span>(</span><span>Uint8Array</span><span>.</span><span>from</span><span>(</span><span>t</span><span>.</span><span>slice</span><span>(</span><span>8</span><span>)</span><span>,</span> <span>XOR</span><span>,</span> <span>r</span> <span>%</span> <span>256</span><span>)</span><span>,</span> <span>{</span>  <span>i</span>: <span>2</span> <span>}</span><span>,</span> <span>t</span> <span>&amp;&amp;</span> <span>t</span><span>.</span><span>out</span><span>,</span> <span>t</span> <span>&amp;&amp;</span> <span>t</span><span>.</span><span>dictionary</span><span>)</span><span>,</span>

<span>// Extracting strings, functions and metadata for each function</span>
<span>for</span> <span>(</span><span>var</span> <span>n</span> <span>=</span> <span>leb128</span><span>(</span><span>t</span><span>)</span><span>,</span> <span>o</span> <span>=</span> <span>0</span><span></span><span>;</span> <span>o</span> <span>&lt;</span> <span>n</span><span>;</span> <span>++</span><span>o</span><span>)</span> <span>strings</span><span>.</span><span>push</span><span>(</span><span>Ab27</span><span>(</span><span>t</span><span>)</span><span>)</span><span>;</span> 
<span>i</span> <span>=</span> <span>leb128</span><span>(</span><span>t</span><span>)</span><span>;</span>
<span>for</span> <span>(</span><span>o</span> <span>=</span> <span>0</span><span>;</span> <span>o</span> <span>&lt;</span> <span>i</span><span>;</span> <span>++</span><span>o</span><span>)</span> <span>{</span>
  <span>for</span> <span>(</span><span>var</span> <span>argsLength</span> <span>=</span> <span>leb128</span><span>(</span><span>t</span><span>)</span><span>,</span> <span>isStrictMode</span> <span>=</span> <span>Boolean</span><span>(</span><span>leb128</span><span>(</span><span>t</span><span>)</span><span>)</span><span>,</span> <span>exceptionHandlers</span> <span>=</span> <span>new</span> <span>Array</span><span>(</span><span>)</span><span>,</span> <span>p</span> <span>=</span> <span>leb128</span><span>(</span><span>t</span><span>)</span><span>,</span> <span>m</span> <span>=</span> <span>0</span><span>;</span> <span>m</span> <span>&lt;</span> <span>p</span><span>;</span> <span>++</span><span>m</span><span>)</span>    <span>exceptionHandlers</span><span>.</span><span>push</span><span>(</span><span>[</span><span>leb128</span><span>(</span><span>t</span><span>)</span><span>,</span> <span>leb128</span><span>(</span><span>t</span><span>)</span><span>,</span> <span>leb128</span><span>(</span><span>t</span><span>)</span><span>,</span> <span>leb128</span><span>(</span><span>t</span><span>)</span><span>]</span><span>)</span><span>;</span>
  <span>for</span> <span>(</span><span>var</span> <span>instructions</span> <span>=</span> <span>new</span> <span>Array</span><span>(</span><span>)</span><span>,</span> <span>h</span> <span>=</span> <span>leb128</span><span>(</span><span>t</span><span>)</span><span>,</span> <span>v</span> <span>=</span> <span>0</span><span>;</span> <span>v</span> <span>&lt;</span> <span>h</span><span>;</span> <span>++</span><span>v</span><span>)</span> <span>instructions</span><span>.</span><span>push</span><span>(</span><span>leb128</span><span>(</span><span>t</span><span>)</span><span>)</span><span>;</span>
  <span>instructionSets</span><span>.</span><span>push</span><span>(</span><span>[</span><span>instructions</span><span>,</span> <span>argsLength</span><span>,</span> <span>isStrictMode</span><span>,</span> <span>exceptionHandlers</span><span>]</span><span>)</span><span>;</span>
<span>}</span></pre></div>
<p dir="auto">NOTE: The string was gZip-ed and each value was leb128 encoded both for compression</p>
<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">Virtual Machine decompiling</h2><a id="user-content-virtual-machine-decompiling" aria-label="Permalink: Virtual Machine decompiling" href="#virtual-machine-decompiling"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">TikTok is using a full-fledged bytecode VM, if you browse through <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/vm.js">it</a>, it supports
scopes, nested functions and exception handling. This isn&#39;t a typical VM and shows that
it is definitely sophiscated.</p>
<p dir="auto">To be able to write a form of decompilation I simply went through each of the cases
and wrote appropriate code for each one, and any case that jumps to another position
for loops like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="case 2:
    var a = instructions[index++];
    stack[pointer] ? --pointer : index += a;
    break;"><pre>case <span>2</span>:
    <span>var</span> <span>a</span> <span>=</span> <span>instructions</span><span>[</span><span>index</span><span>++</span><span>]</span><span>;</span>
    <span>stack</span><span>[</span><span>pointer</span><span>]</span> ? <span>--</span><span>pointer</span> : <span>index</span> <span>+=</span> <span>a</span><span>;</span>
    <span>break</span><span>;</span></pre></div>
<p dir="auto">I would simply stop it from doing so:</p>
<div dir="auto" data-snippet-clipboard-copy-content="case 2:
    var a = instructions[index++];
    //stack[pointer] ? --pointer : index += a;

    addCode(`// if (!v${pointer}) skip ${a} to ${index + a}`, byteCodePos)
    break;"><pre>case <span>2</span>:
    <span>var</span> <span>a</span> <span>=</span> <span>instructions</span><span>[</span><span>index</span><span>++</span><span>]</span><span>;</span>
    <span>//stack[pointer] ? --pointer : index += a;</span>

    <span>addCode</span><span>(</span><span>`// if (!v<span><span>${</span><span>pointer</span><span>}</span></span>) skip <span><span>${</span><span>a</span><span>}</span></span> to <span><span>${</span><span>index</span> <span>+</span> <span>a</span><span>}</span></span>`</span><span>,</span> <span>byteCodePos</span><span>)</span>
    <span>break</span><span>;</span></pre></div>
<p dir="auto">After doing this for all the cases I dumped each file <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/decompiler/functions">here</a>.
It&#39;s not completely readable but you should be able to make out a general idea
of what each function is doing, for example <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/decompiler/functions/VM223.js">VM223</a> which is
generating random characters.</p>
<hr/>

<p dir="auto">As this is a Javascript file executed on the web, it is actually possible to replace
the normal <code>webmssdk.js</code> with the deobfuscated file and use TikTok normally.</p>
<p dir="auto">This can be achieved by using two browser extensions known as <a href="https://chromewebstore.google.com/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?hl=en-GB" rel="nofollow">Tampermonkey</a> for executing
custom code and <a href="https://chromewebstore.google.com/detail/disable-content-security/ieelmcmcagommplceebfedjlakkhpden?hl=en-GB&amp;pli=1" rel="nofollow">CSP</a> to disable CSP so I can fetch files from blocked origins. This is so I
can put <code>latestDeobf.js</code> in my own file server and have it be fetched each time, this is so I can easily
edit the file and let the changes take effect each time I refresh. This makes it much easier to bebug
when reversing functions.</p>
<p dir="auto">The script can be found <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/injector.js">here</a></p>
<hr/>

<p dir="auto">Now that we have deobfuscated the file and decompiled the VM we can
start to reverse any function we want and figure out what it&#39;s doing.</p>
<p dir="auto">When you make a request to the server it usually consists of 3 additional headers.</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Header</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>msToken</code></td>
<td>Sent by the server and reissued on each request.</td>
</tr>
<tr>
<td><code>X-Bogus</code></td>
<td>Generated by webmssdk.js based on request.</td>
</tr>
<tr>
<td><code>_signature</code></td>
<td>Generated by webmssdk.js based on request.</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">When making a request that doesn&#39;t require authentication like querying a user. Only <code>X-Bogus</code> is
needed to be generated which can be done using <code>window.frontierSign</code>. <code>_signature</code> isn&#39;t needed
and any <code>msToken</code> can be used.</p>
<p dir="auto">This popular <a href="https://github.com/davidteather/TikTok-Api">API</a> let&#39;s you make those requests.
It uses a webdriver library called <a href="https://playwright.dev/python/docs/api/class-playwright" rel="nofollow">playwright</a>, that simply sets up a browser instance, so it can easily call <code>window.frontierSign</code>.</p>
<p dir="auto">When it comes to making authentication-based requests like posting a comment, <code>_signature</code> is needed
and isn&#39;t exposed to <code>window</code>.</p>
<hr/>

<p dir="auto">The inital function call for each request is <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/decompiler/functions/VM86.js">VM86</a> which then calls</p>
<p dir="auto"><a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/decompiler/functions/VM113.js">VM113</a> for <code>X-bogus</code></p>
<p dir="auto"><a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/decompiler/functions/VM189.js">VM189</a> for <code>_signature</code></p>
<p dir="auto">I was able to write <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/decompiler/signer.js">signer</a> which
succesfully signs URL&#39;s.</p>
<p dir="auto">Here&#39;s a demo of posting a comment and checking it using a
private browser to ensure it&#39;s successful.</p>
<details open="">
  <summary>
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M16 3.75v8.5a.75.75 0 0 1-1.136.643L11 10.575v.675A1.75 1.75 0 0 1 9.25 13h-7.5A1.75 1.75 0 0 1 0 11.25v-6.5C0 3.784.784 3 1.75 3h7.5c.966 0 1.75.784 1.75 1.75v.675l3.864-2.318A.75.75 0 0 1 16 3.75Zm-6.5 1a.25.25 0 0 0-.25-.25h-7.5a.25.25 0 0 0-.25.25v6.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-6.5ZM11 8.825l3.5 2.1v-5.85l-3.5 2.1Z"></path>
</svg>
    <span aria-label="Video description PostCommentTest1.mp4">PostCommentTest1.mp4</span>
    <span></span>
  </summary>

  <video src="https://private-user-images.githubusercontent.com/50531317/435448001-746aa1a1-d171-487a-819b-5b0ca1894c47.mp4?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NDUyMjc0OTcsIm5iZiI6MTc0NTIyNzE5NywicGF0aCI6Ii81MDUzMTMxNy80MzU0NDgwMDEtNzQ2YWExYTEtZDE3MS00ODdhLTgxOWItNWIwY2ExODk0YzQ3Lm1wND9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA0MjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNDIxVDA5MTk1N1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWQwNTY2NTIzZWM3ZTA4ZTI4YjU3YWQ2MDg2ZTk4MzY3MGJiMGNhMDY3ZmYzZGE3MzMxZDQxYWYyMDYxZGEyM2EmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.hUh_Ykz_2osGpbzU5-0ffGh73BCAAS9S4mBCguPmNWM" data-canonical-src="https://private-user-images.githubusercontent.com/50531317/435448001-746aa1a1-d171-487a-819b-5b0ca1894c47.mp4?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NDUyMjc0OTcsIm5iZiI6MTc0NTIyNzE5NywicGF0aCI6Ii81MDUzMTMxNy80MzU0NDgwMDEtNzQ2YWExYTEtZDE3MS00ODdhLTgxOWItNWIwY2ExODk0YzQ3Lm1wND9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA0MjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNDIxVDA5MTk1N1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWQwNTY2NTIzZWM3ZTA4ZTI4YjU3YWQ2MDg2ZTk4MzY3MGJiMGNhMDY3ZmYzZGE3MzMxZDQxYWYyMDYxZGEyM2EmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.hUh_Ykz_2osGpbzU5-0ffGh73BCAAS9S4mBCguPmNWM" controls="controls" muted="muted">

  </video>
</details>

<p dir="auto">NOTE: There are also some bot protection methods such as mouse tracking (<a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/decompiler/functions/VM120.js">VM120</a>)
and environment checking (<a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/decompiler/functions/VM265.js">VM265</a>) within <a href="https://github.com/LukasOgunfeitimi/TikTok-ReverseEngineering/blob/main/decompiler/functions/VM86.js">VM86</a>, but it is a completely client-sided check and doesn&#39;t communicate
with the server about, so it can be ignored when generating the signatures.</p>
<hr/>

<ul dir="auto">
<li><strong>Note:</strong> The TikTok VM is constantly changing with new releases. There&#39;s a high chance the main algorithms will change and decompilation of the new VM is needed.</li>
</ul>
</article></div></div>
  </body>
</html>
