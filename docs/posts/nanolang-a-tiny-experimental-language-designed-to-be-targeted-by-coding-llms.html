<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/jordanhubbard/nanolang">Original</a>
    <h1>Nanolang: A tiny experimental language designed to be targeted by coding LLMs</h1>
    
    <div id="readability-page-1" class="page"><div>
  <section>
    <p>Safari and invalid HTTP/2 headers</p>
    <p>
      <time>16 Jan 2026</time> 
      
       | 
      
      
      <span> <a href="https://punchagan.muse-amuse.in/tags/blag">blag</a> <a href="https://punchagan.muse-amuse.in/tags/emacs">emacs</a> <a href="https://punchagan.muse-amuse.in/tags/ocaml">ocaml</a> <a href="https://punchagan.muse-amuse.in/tags/web">web</a>  </span>
      
    </p>
    <div><p><a href="https://github.com/punchagan/elfeed-offline/">Elfeed-offline</a> currently has a <a href="https://camlworks.github.io/dream/">Dream web server</a> which acts as a proxy server in
front of Elfeed’s Emacs <a href="https://github.com/skeeto/emacs-web-server/tree/master">simple-httpd</a> server.</p>
<p>simple-httpd supports HTTP/1.1 protocol, while Dream provides transparent
upgrading of connections to HTTP/2 — if the client can handle HTTP/2 and the
connection is using HTTPS, it is transparently upgraded to HTTP/2.</p>
<p>My proxying code was too simplistic in forwarding the headers too along with
the content received from the simple-httpd server. Some of the HTTP/1 headers
are no longer valid in HTTP/2. And, Safari (and curl) strictly adhere to the
protocol and fail if there are invalid headers. Curl, for instance, fails with
the following error:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>&lt; HTTP/2 200
</span></span><span><span>&lt; server: simple-httpd (Emacs 30.1)
</span></span><span><span>&lt; date: Fri, 16 Jan 2026 10:57:25 GMT
</span></span><span><span>* Invalid HTTP header field was received: frame type: 1, stream: 1, name: [connection], value: [keep-alive]
</span></span><span><span>* [HTTP2] [1] received invalid frame: FRAME[HEADERS, len=77, hend=1, eos=0], error -531: Invalid HTTP header field was received
</span></span><span><span>* HTTP/2 stream 1 was not closed cleanly: unknown (err 4294966765)
</span></span><span><span>* Connection #0 to host 192.168.1.5 left intact
</span></span><span><span>curl: (92) Invalid HTTP header field was received: frame type: 1, stream: 1, name: [connection], value: [keep-alive]
</span></span></code></pre></div><p>This was causing issues for <a href="https://github.com/Feyorsh">@Feyorsh</a> who was trying out elfeed-offline with
Safari. Thanks for taking the time to debug the problem and for suggesting a
fix!</p>
</div>
  </section>

  <section>
    <p>
  Feel free to send me an <a href="mailto:punchagan+blog@muse-amuse.in">email</a> with your
  comments.
</p>

    




  </section>
</div></div>
  </body>
</html>
