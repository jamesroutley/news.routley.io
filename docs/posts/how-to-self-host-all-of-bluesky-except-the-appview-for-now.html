<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://alice.bsky.sh/post/3laega7icmi2q">Original</a>
    <h1>How to self-host all of Bluesky except the AppView (for now)</h1>
    
    <div id="readability-page-1" class="page"><div><p node="[object Object]">Did you know? You can self-host and/or mirror almost all of Bluesky&#39;s infrastructure today!</p>
<blockquote node="[object Object]">
<p node="[object Object]">This article assumes familiarity with the architecture of Bluesky, general *nix knowledge and basic knowledge of TypeScript, Go and Rust toolchains</p>
</blockquote>
<h2 node="[object Object]">PDS</h2>
<p node="[object Object]">The most obvious one: having your own <a href="https://docs.bsky.app/docs/advanced-guides/federation-architecture#personal-data-server-pds" node="[object Object]">PDS</a> and owning your data. You can find the GitHub repository with instructions <a href="https://github.com/bluesky-social/pds?tab=readme-ov-file#self-hosting-pds" node="[object Object]">here</a>; you can migrate your existing account with the <a href="https://github.com/bluesky-social/indigo/tree/main/cmd/goat" node="[object Object]">GOAT tool</a>, for which <a href="https://bsky.app/profile/bnewbold.net" node="[object Object]">Bryan Newbold</a> has written an <a href="https://whtwnd.com/bnewbold.net/entries/Migrating%20PDS%20Account%20with%20%60goat%60" node="[object Object]">excellent howto post</a>.</p>
<h2 node="[object Object]">Relay</h2>
<p node="[object Object]">Bryan has a great blog post on how to set up your own <a href="https://docs.bsky.app/docs/advanced-guides/federation-architecture#relay" node="[object Object]">Relay</a> <a href="https://whtwnd.com/bnewbold.net/entries/Notes%20on%20Running%20a%20Full-Network%20atproto%20Relay%20(July%202024)" node="[object Object]">right here</a>. Things have grown since, so make sure you have at least ~4.5 TB of disk space (maybe more). Two important comments, not in the post: make sure to use the <code node="[object Object]">--disk-persister-dir=/data/events</code> flag as well as <a href="https://github.com/bluesky-social/indigo/blob/d1686e9b80835948407fd7ad2428e92379298dac/cmd/bigsky/main.go#L136-L141" node="[object Object]">enable compaction</a>.</p>
<h2 node="[object Object]">Jetstream</h2>
<p node="[object Object]"><a href="https://github.com/bluesky-social/jetstream" node="[object Object]">Jetstream</a> is like having your own Relay firehose, but uses a fraction of the bandwidth, storage, and gives you friendly JSON instead of <a href="https://en.wikipedia.org/wiki/CBOR" node="[object Object]">CBOR</a>-encoded <a href="https://en.wikipedia.org/wiki/Merkle_tree" node="[object Object]">MST</a> blocks. After cloning the GitHub repository, you can either use the included <code node="[object Object]">docker-compose.yaml</code> with <code node="[object Object]">make up</code> or build it directly with <code node="[object Object]">make build</code> and use your favorite keep-this-process-running-pretty-please tool (systemd, pm2 etc.) Don&#39;t forget to take a look at the <a href="https://github.com/bluesky-social/jetstream/blob/0ab10bd041fe1fdf682d3964b20d944905c4862d/cmd/jetstream/main.go#L36-L103" node="[object Object]">available CLI arguments/env variables</a>, which let you do things like change the default retention (24 hours) or override the Firehose cursor and backfill it with 3 days of dataâ€”which is what&#39;s available from the official relays.</p>
<h2 node="[object Object]">plc.directory mirror</h2>
<p node="[object Object]">To get a mirror of <a href="https://plc.directory" node="[object Object]">plc.directory</a>, with almost all users on Bluesky (they <a href="https://atproto.com/specs/did#blessed-did-methods" node="[object Object]">do support did:web</a>, but they are few and far between), clone <a href="https://bsky.app/profile/str4d.xyz" node="[object Object]">str4d</a>&#39;s <a href="https://github.com/str4d/plc" node="[object Object]"><code node="[object Object]">plc</code> repo</a>, switch to the <code node="[object Object]">mirror</code> branch, run <code node="[object Object]">cargo run --features mirror -- mirror run mirror.db</code>, then sit back and wait 5-10 hours. Once it&#39;s done and up-to-date, you have a full replica in a neat sqlite3 DB. You can monitor its status with something like <code node="[object Object]">watch -n60 &#39;sqlite3 mirror.db &#34;select count(*) from identity;&#34;&#39;</code> in a <a href="https://github.com/tmux/tmux/wiki" node="[object Object]">tmux</a> pane.</p>
<h2 node="[object Object]">The official web/mobile app, also known as <code node="[object Object]">social-app</code></h2>
<p node="[object Object]">Clone the <a href="https://github.com/bluesky-social/social-app" node="[object Object]">repo</a>, run <code node="[object Object]">yarn &amp;&amp; yarn web</code>, and you have a fully-functional copy of it in mere minutes that you can modify to your heart&#39;s desire. Doing this on mobile is a lot more involved and <a href="https://github.com/bluesky-social/social-app/blob/main/docs/build.md#iosandroid-build" node="[object Object]">documented here</a>.</p>
<h2 node="[object Object]">AppView</h2>
<p node="[object Object]">The elephant in the room is, of course, running your own Bluesky <a href="https://atproto.com/guides/glossary#app-view" node="[object Object]">AppView</a>. If you&#39;re interested, DM me on Bluesky to join my working group to make it happen!</p></div></div>
  </body>
</html>
