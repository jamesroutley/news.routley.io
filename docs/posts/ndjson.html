<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://kracekumar.com/post/ndjson/">Original</a>
    <h1>ndjson</h1>
    
    <div id="readability-page-1" class="page"><div>
    <div>
  
  <p><time datetime="2025-01-14T23:16:25+0530">Tue, Jan 14, 2025</time></p><p><img src="https://raw.githubusercontent.com/ndjson/ndjson-spec/refs/heads/master/ndjson.png" alt="ndjson"/></p>
<div><pre tabindex="0"><code data-lang="python"><span><span><span>curl</span> <span>http</span><span>:</span><span>//</span><span>localhost</span><span>:</span><span>11434</span><span>/</span><span>api</span><span>/</span><span>generate</span> <span>-</span><span>d</span> <span>&#39;{</span>
</span></span><span><span>                                                                                                                            <span>&#34;model&#34;</span><span>:</span> <span>&#34;llama3.2&#34;</span><span>,</span>
</span></span><span><span>                                                                                                                            <span>&#34;prompt&#34;</span><span>:</span> <span>&#34;Where is Dublin? Answer in a six words&#34;</span>
</span></span><span><span>                                                                                                                          <span>}</span><span>&#39;</span>
</span></span><span><span><span>{</span><span>&#34;model&#34;</span><span>:</span><span>&#34;llama3.2&#34;</span><span>,</span><span>&#34;created_at&#34;</span><span>:</span><span>&#34;2025-01-14T17:48:33.15898Z&#34;</span><span>,</span><span>&#34;response&#34;</span><span>:</span><span>&#34;Located&#34;</span><span>,</span><span>&#34;done&#34;</span><span>:</span><span>false</span><span>}</span>
</span></span><span><span><span>{</span><span>&#34;model&#34;</span><span>:</span><span>&#34;llama3.2&#34;</span><span>,</span><span>&#34;created_at&#34;</span><span>:</span><span>&#34;2025-01-14T17:48:33.183229Z&#34;</span><span>,</span><span>&#34;response&#34;</span><span>:</span><span>&#34; on&#34;</span><span>,</span><span>&#34;done&#34;</span><span>:</span><span>false</span><span>}</span>
</span></span><span><span><span>{</span><span>&#34;model&#34;</span><span>:</span><span>&#34;llama3.2&#34;</span><span>,</span><span>&#34;created_at&#34;</span><span>:</span><span>&#34;2025-01-14T17:48:33.206942Z&#34;</span><span>,</span><span>&#34;response&#34;</span><span>:</span><span>&#34; the&#34;</span><span>,</span><span>&#34;done&#34;</span><span>:</span><span>false</span><span>}</span>
</span></span><span><span><span>{</span><span>&#34;model&#34;</span><span>:</span><span>&#34;llama3.2&#34;</span><span>,</span><span>&#34;created_at&#34;</span><span>:</span><span>&#34;2025-01-14T17:48:33.230918Z&#34;</span><span>,</span><span>&#34;response&#34;</span><span>:</span><span>&#34; east&#34;</span><span>,</span><span>&#34;done&#34;</span><span>:</span><span>false</span><span>}</span>
</span></span><span><span><span>{</span><span>&#34;model&#34;</span><span>:</span><span>&#34;llama3.2&#34;</span><span>,</span><span>&#34;created_at&#34;</span><span>:</span><span>&#34;2025-01-14T17:48:33.254533Z&#34;</span><span>,</span><span>&#34;response&#34;</span><span>:</span><span>&#34; coast&#34;</span><span>,</span><span>&#34;done&#34;</span><span>:</span><span>false</span><span>}</span>
</span></span><span><span><span>{</span><span>&#34;model&#34;</span><span>:</span><span>&#34;llama3.2&#34;</span><span>,</span><span>&#34;created_at&#34;</span><span>:</span><span>&#34;2025-01-14T17:48:33.278113Z&#34;</span><span>,</span><span>&#34;response&#34;</span><span>:</span><span>&#34; Ireland&#34;</span><span>,</span><span>&#34;done&#34;</span><span>:</span><span>false</span><span>}</span>
</span></span><span><span><span>{</span><span>&#34;model&#34;</span><span>:</span><span>&#34;llama3.2&#34;</span><span>,</span><span>&#34;created_at&#34;</span><span>:</span><span>&#34;2025-01-14T17:48:33.301689Z&#34;</span><span>,</span><span>&#34;response&#34;</span><span>:</span><span>&#34;.&#34;</span><span>,</span><span>&#34;done&#34;</span><span>:</span><span>false</span><span>}</span>
</span></span><span><span><span>{</span><span>&#34;model&#34;</span><span>:</span><span>&#34;llama3.2&#34;</span><span>,</span><span>&#34;created_at&#34;</span><span>:</span><span>&#34;2025-01-14T17:48:33.3255Z&#34;</span><span>,</span><span>&#34;response&#34;</span><span>:</span><span>&#34;&#34;</span><span>,</span><span>&#34;done&#34;</span><span>:</span><span>true</span><span>,</span><span>&#34;done_reason&#34;</span><span>:</span><span>&#34;stop&#34;</span><span>,</span><span>&#34;context&#34;</span><span>:[</span><span>128006</span><span>,</span><span>9125</span><span>,</span><span>128007</span><span>,</span><span>271</span><span>,</span><span>38766</span><span>,</span><span>1303</span><span>,</span><span>33025</span><span>,</span><span>2696</span><span>,</span><span>25</span><span>,</span><span>6790</span><span>,</span><span>220</span><span>,</span><span>2366</span><span>,</span><span>18</span><span>,</span><span>271</span><span>,</span><span>128009</span><span>,</span><span>128006</span><span>,</span><span>882</span><span>,</span><span>128007</span><span>,</span><span>271</span><span>,</span><span>9241</span><span>,</span><span>374</span><span>,</span><span>33977</span><span>,</span><span>30</span><span>,</span><span>22559</span><span>,</span><span>304</span><span>,</span><span>264</span><span>,</span><span>4848</span><span>,</span><span>4339</span><span>,</span><span>128009</span><span>,</span><span>128006</span><span>,</span><span>78191</span><span>,</span><span>128007</span><span>,</span><span>271</span><span>,</span><span>48852</span><span>,</span><span>389</span><span>,</span><span>279</span><span>,</span><span>11226</span><span>,</span><span>13962</span><span>,</span><span>14990</span><span>,</span><span>13</span><span>],</span><span>&#34;total_duration&#34;</span><span>:</span><span>2392671125</span><span>,</span><span>&#34;load_duration&#34;</span><span>:</span><span>575523041</span><span>,</span><span>&#34;prompt_eval_count&#34;</span><span>:</span><span>34</span><span>,</span><span>&#34;prompt_eval_duration&#34;</span><span>:</span><span>1649000000</span><span>,</span><span>&#34;eval_count&#34;</span><span>:</span><span>8</span><span>,</span><span>&#34;eval_duration&#34;</span><span>:</span><span>167000000</span><span>}</span>
</span></span></code></pre></div><p>I was playing around with ollama API to explore the API capabilities and noticed the HTTP response was streaming JSON that prompted me to look into the response headers.</p>
<div><pre tabindex="0"><code data-lang="python"><span><span><span>curl</span> <span>-</span><span>v</span> <span>http</span><span>:</span><span>//</span><span>localhost</span><span>:</span><span>11434</span><span>/</span><span>api</span><span>/</span><span>generate</span> <span>-</span><span>d</span> <span>&#39;{</span>
</span></span><span><span>                                                                                                                            <span>&#34;model&#34;</span><span>:</span> <span>&#34;llama3.2&#34;</span><span>,</span>
</span></span><span><span>                                                                                                                            <span>&#34;prompt&#34;</span><span>:</span> <span>&#34;Where is Dublin? Answer in a six words&#34;</span>
</span></span><span><span>                                                                                                                          <span>}</span><span>&#39;</span>
</span></span><span><span><span>*</span> <span>Host</span> <span>localhost</span><span>:</span><span>11434</span> <span>was</span> <span>resolved</span><span>.</span>
</span></span><span><span><span>*</span> <span>IPv6</span><span>:</span> <span>::</span><span>1</span>
</span></span><span><span><span>*</span> <span>IPv4</span><span>:</span> <span>127.0.0.1</span>
</span></span><span><span><span>*</span>   <span>Trying</span> <span>[::</span><span>1</span><span>]:</span><span>11434.</span><span>..</span>
</span></span><span><span><span>*</span> <span>connect</span> <span>to</span> <span>::</span><span>1</span> <span>port</span> <span>11434</span> <span>from</span> <span>::</span><span>1</span> <span>port</span> <span>49217</span> <span>failed</span><span>:</span> <span>Connection</span> <span>refused</span>
</span></span><span><span><span>*</span>   <span>Trying</span> <span>127.0.0.1</span><span>:</span><span>11434.</span><span>..</span>
</span></span><span><span><span>*</span> <span>Connected</span> <span>to</span> <span>localhost</span> <span>(</span><span>127.0.0.1</span><span>)</span> <span>port</span> <span>11434</span>
</span></span><span><span><span>&gt;</span> <span>POST</span> <span>/</span><span>api</span><span>/</span><span>generate</span> <span>HTTP</span><span>/</span><span>1.1</span>
</span></span><span><span><span>&gt;</span> <span>Host</span><span>:</span> <span>localhost</span><span>:</span><span>11434</span>
</span></span><span><span><span>&gt;</span> <span>User</span><span>-</span><span>Agent</span><span>:</span> <span>curl</span><span>/</span><span>8.7.1</span>
</span></span><span><span><span>&gt;</span> <span>Accept</span><span>:</span> <span>*/*</span>
</span></span><span><span><span>&gt;</span> <span>Content</span><span>-</span><span>Length</span><span>:</span> <span>250</span>
</span></span><span><span><span>&gt;</span> <span>Content</span><span>-</span><span>Type</span><span>:</span> <span>application</span><span>/</span><span>x</span><span>-</span><span>www</span><span>-</span><span>form</span><span>-</span><span>urlencoded</span>
</span></span><span><span><span>&gt;</span>
</span></span><span><span><span>*</span> <span>upload</span> <span>completely</span> <span>sent</span> <span>off</span><span>:</span> <span>250</span> <span>bytes</span>
</span></span><span><span><span>&lt;</span> <span>HTTP</span><span>/</span><span>1.1</span> <span>200</span> <span>OK</span>
</span></span><span><span><span>&lt;</span> <span>Content</span><span>-</span><span>Type</span><span>:</span> <span>application</span><span>/</span><span>x</span><span>-</span><span>ndjson</span>
</span></span><span><span><span>&lt;</span> <span>Date</span><span>:</span> <span>Tue</span><span>,</span> <span>14</span> <span>Jan</span> <span>2025</span> <span>17</span><span>:</span><span>49</span><span>:</span><span>29</span> <span>GMT</span>
</span></span><span><span><span>&lt;</span> <span>Transfer</span><span>-</span><span>Encoding</span><span>:</span> <span>chunked</span>
</span></span><span><span><span>&lt;</span>
</span></span><span><span><span>...</span>
</span></span></code></pre></div><p>The content type is <code>application/x-ndjson</code> and quick search hinted it’s a new line separated JSON that can be used in streaming protocols. Also the  <code>Transfer-Encoding</code>is chunked and fits well with for LLM responses over the wire.</p>
<div><pre tabindex="0"><code data-lang="python"><span><span><span>curl</span> <span>http</span><span>:</span><span>//</span><span>localhost</span><span>:</span><span>11434</span><span>/</span><span>api</span><span>/</span><span>generate</span> <span>-</span><span>d</span> <span>&#39;{</span>
</span></span><span><span>                                                                                                                                   <span>&#34;model&#34;</span><span>:</span> <span>&#34;llama3.2&#34;</span><span>,</span>
</span></span><span><span>                                                                                                                                   <span>&#34;prompt&#34;</span><span>:</span> <span>&#34;Where is Dublin? Answer in a six words&#34;</span>
</span></span><span><span>                                                                                                                                 <span>}</span><span>&#39; | jq .response</span>
</span></span><span><span>  <span>%</span> <span>Total</span>    <span>%</span> <span>Received</span> <span>%</span> <span>Xferd</span>  <span>Average</span> <span>Speed</span>   <span>Time</span>    <span>Time</span>     <span>Time</span>  <span>Current</span>
</span></span><span><span>                                 <span>Dload</span>  <span>Upload</span>   <span>Total</span>   <span>Spent</span>    <span>Left</span>  <span>Speed</span>
</span></span><span><span><span>100</span>  <span>1399</span>    <span>0</span>  <span>1149</span>  <span>100</span>   <span>250</span>   <span>3291</span>    <span>716</span> <span>--</span><span>:</span><span>--</span><span>:</span><span>--</span> <span>--</span><span>:</span><span>--</span><span>:</span><span>--</span> <span>--</span><span>:</span><span>--</span><span>:</span><span>--</span>  <span>3997</span>
</span></span><span><span><span>&#34;Located&#34;</span>
</span></span><span><span><span>&#34; on&#34;</span>
</span></span><span><span><span>&#34; the&#34;</span>
</span></span><span><span><span>&#34; east&#34;</span>
</span></span><span><span><span>&#34; coast&#34;</span>
</span></span><span><span><span>&#34; Ireland&#34;</span>
</span></span><span><span><span>&#34;.&#34;</span>
</span></span><span><span><span>&#34;&#34;</span>
</span></span></code></pre></div><p>Also <code>jq</code>could handle new line delimited json.</p>
<h3 id="json-streaming-formats">JSON Streaming formats</h3>
<p>While researching further on <a href="https://en.wikipedia.org/wiki/JSON_streaming">JSON streaming</a> there are several other approaches to stream JSON objects. Notable ones are <code>ndjson, jsonl, json-seq</code>.  All these formats are useful for processing and parallelising large JSON objects without loading entire dataset into the memory.</p>
<p><strong>Syntax</strong></p>
<ul>
<li>
<p><code>ndjson</code>: Uses a newline character (<code>\n</code>) to separate each JSON object, and no whitespace is allowed between objects or values. Example: <code>{&#34;some&#34;:&#34;thing\n&#34;}</code>. Only single <code>\n</code></p>
</li>
<li>
<p><code>jsonl</code> (<a href="https://jsonlines.org/on_the_web/">JSON Lines</a>): Similar to <code>ndjson</code>, but allows for optional whitespace around the <code>\n</code> separator and <code>\r\n</code> in windows. Example: <code>{&#34;name&#34;: &#34;John&#34;, &#34;age&#34;: 30}\r\n</code></p>
</li>
<li>
<p><code>json-seq</code> (JSON Sequence): Each JSON object prefixed by an ASCII Record Separator (0x1E), and each ending with an ASCII Line Feed character (0x0A). Example: <code>␞{&#34;d&#34;:&#34;2014-09-22T21:58:35.270Z&#34;,&#34;value&#34;:6}␤</code></p>
</li>
</ul>
<p>It’s quite interesting to see the different use cases of different variations of JSON formats.</p>

</div>


    </div></div>
  </body>
</html>
