<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/elodin-sys/elodin">Original</a>
    <h1>Show HN: Elodin â€“ A better framework for physics simulation</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Elodin is a platform for rapid design, testing, and simulation of
drones, satellites, and aerospace control systems.</p>
<p dir="auto">Quick Demo: <a href="https://app.elodin.systems/sandbox/hn/cube-sat" rel="nofollow">https://app.elodin.systems/sandbox/hn/cube-sat</a></p>
<p dir="auto">Sandbox Alpha: <a href="https://app.elodin.systems" rel="nofollow">https://app.elodin.systems</a></p>
<p dir="auto">This repository is a collection of core libraries:</p>
<ul dir="auto">
<li><code>libs/nox</code>: Tensor library that compiles to XLA (like
JAX, but for Rust).</li>
<li><code>libs/nox-ecs</code>: Rust ECS framework built to work with JAX and Nox,
that allows you to build your own physics engine.</li>
<li><code>libs/nox-py</code>: Python version of <code>nox-ecs</code>, that works with JAX</li>
<li><code>libs/nox-ecs-macros</code>: Derive macros to generate implementations of
ECS and Nox traits.</li>
<li><code>libs/conduit</code>: Column-based protocol for transferring ECS data
between different systems.</li>
<li><code>libs/xla-rs</code>: Rust bindings to XLA&#39;s C++ API (originally based on
<a href="https://github.com/LaurentMazare/xla-rs">https://github.com/LaurentMazare/xla-rs</a>).</li>
</ul>
<p dir="auto">Join us on Discord: <a href="https://discord.gg/agvGJaZXy5" rel="nofollow">https://discord.gg/agvGJaZXy5</a>!</p>

<ol dir="auto">
<li>Install Rust using <a href="https://rustup.rs" rel="nofollow">https://rustup.rs</a></li>
<li>Setup a new venv with:</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="python3 -m venv .venv
 . .venv/bin/activate.fish # or activate.sh if you do not use fish"><pre>python3 <span>-m</span> venv .venv
 . .venv/bin/activate.fish <span><span>#</span> or activate.sh if you do not use fish</span></pre></div>
<ol start="3" dir="auto">
<li>Install <code>elodin</code>, and <code>matplotlib</code> with</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="pip install libs/nox-py
pip install matplotlib"><pre>pip install libs/nox-py
pip install matplotlib</pre></div>
<ol start="4" dir="auto">
<li>Try running the following code</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="import matplotlib.pyplot as plt
import jax.numpy as np
from elodin import *

@system
def gravity(q: Query[WorldPos]) -&gt; Query[Force]:
  return q.map(Force, lambda _p: Force.from_linear(np.array([0.0, -9.81, 0.0])))

@system
def bounce(q: Query[WorldPos, WorldVel]) -&gt; Query[WorldVel]:
  return q.map(WorldVel, lambda p, v: jax.lax.cond(
    jax.lax.max(p.linear()[1], v.linear()[1]) &lt; 0.0,
    lambda _: WorldVel.from_linear(v.linear() * np.array([1.,-1.,1.]) * 0.85),
    lambda _: v,
    operand=None
  ))

w = WorldBuilder()
w.spawn(
    Body(
        world_pos=WorldPos.from_linear(np.array([0.0, 10.0, 0.0])),
        world_vel=WorldVel.from_linear(np.array([0.0, 0.0, 0.0])),
        inertia=Inertia.from_mass(1.0),
    )
)
client = Client.cpu()
exec = w.build(bounce.pipe(six_dof(1.0 / 60.0, gravity)))
t = range(500)
pos = []
for _ in t:
    exec.run(client)
    y = exec.column_array(ComponentId(&#34;world_pos&#34;))[0, 5]
    pos.append(y)
fig, ax = plt.subplots()
ax.plot(t, pos)
plt.show()"><pre><span>import</span> <span>matplotlib</span>.<span>pyplot</span> <span>as</span> <span>plt</span>
<span>import</span> <span>jax</span>.<span>numpy</span> <span>as</span> <span>np</span>
<span>from</span> <span>elodin</span> <span>import</span> <span>*</span>

<span>@<span>system</span></span>
<span>def</span> <span>gravity</span>(<span>q</span>: <span>Query</span>[<span>WorldPos</span>]) <span>-&gt;</span> <span>Query</span>[<span>Force</span>]:
  <span>return</span> <span>q</span>.<span>map</span>(<span>Force</span>, <span>lambda</span> <span>_p</span>: <span>Force</span>.<span>from_linear</span>(<span>np</span>.<span>array</span>([<span>0.0</span>, <span>-</span><span>9.81</span>, <span>0.0</span>])))

<span>@<span>system</span></span>
<span>def</span> <span>bounce</span>(<span>q</span>: <span>Query</span>[<span>WorldPos</span>, <span>WorldVel</span>]) <span>-&gt;</span> <span>Query</span>[<span>WorldVel</span>]:
  <span>return</span> <span>q</span>.<span>map</span>(<span>WorldVel</span>, <span>lambda</span> <span>p</span>, <span>v</span>: <span>jax</span>.<span>lax</span>.<span>cond</span>(
    <span>jax</span>.<span>lax</span>.<span>max</span>(<span>p</span>.<span>linear</span>()[<span>1</span>], <span>v</span>.<span>linear</span>()[<span>1</span>]) <span>&lt;</span> <span>0.0</span>,
    <span>lambda</span> <span>_</span>: <span>WorldVel</span>.<span>from_linear</span>(<span>v</span>.<span>linear</span>() <span>*</span> <span>np</span>.<span>array</span>([<span>1.</span>,<span>-</span><span>1.</span>,<span>1.</span>]) <span>*</span> <span>0.85</span>),
    <span>lambda</span> <span>_</span>: <span>v</span>,
    <span>operand</span><span>=</span><span>None</span>
  ))

<span>w</span> <span>=</span> <span>WorldBuilder</span>()
<span>w</span>.<span>spawn</span>(
    <span>Body</span>(
        <span>world_pos</span><span>=</span><span>WorldPos</span>.<span>from_linear</span>(<span>np</span>.<span>array</span>([<span>0.0</span>, <span>10.0</span>, <span>0.0</span>])),
        <span>world_vel</span><span>=</span><span>WorldVel</span>.<span>from_linear</span>(<span>np</span>.<span>array</span>([<span>0.0</span>, <span>0.0</span>, <span>0.0</span>])),
        <span>inertia</span><span>=</span><span>Inertia</span>.<span>from_mass</span>(<span>1.0</span>),
    )
)
<span>client</span> <span>=</span> <span>Client</span>.<span>cpu</span>()
<span>exec</span> <span>=</span> <span>w</span>.<span>build</span>(<span>bounce</span>.<span>pipe</span>(<span>six_dof</span>(<span>1.0</span> <span>/</span> <span>60.0</span>, <span>gravity</span>)))
<span>t</span> <span>=</span> <span>range</span>(<span>500</span>)
<span>pos</span> <span>=</span> []
<span>for</span> <span>_</span> <span>in</span> <span>t</span>:
    <span>exec</span>.<span>run</span>(<span>client</span>)
    <span>y</span> <span>=</span> <span>exec</span>.<span>column_array</span>(<span>ComponentId</span>(<span>&#34;world_pos&#34;</span>))[<span>0</span>, <span>5</span>]
    <span>pos</span>.<span>append</span>(<span>y</span>)
<span>fig</span>, <span>ax</span> <span>=</span> <span>plt</span>.<span>subplots</span>()
<span>ax</span>.<span>plot</span>(<span>t</span>, <span>pos</span>)
<span>plt</span>.<span>show</span>()</pre></div>

<p dir="auto">Licensed under either of</p>
<ul dir="auto">
<li><a href="https://github.com/elodin-sys/elodin/blob/main/LICENSES/Apache-2.0.txt">Apache License, Version 2.0</a></li>
<li><a href="https://github.com/elodin-sys/elodin/blob/main/LICENSES/MIT.txt">MIT License</a></li>
</ul>
<p dir="auto">at your option.</p>

<p dir="auto">Unless you explicitly state otherwise, any contribution intentionally
submitted for inclusion in the work by you, as defined in the
Apache-2.0 license, shall be dual licensed as above, without any
additional terms or conditions.</p>
</article></div></div>
  </body>
</html>
