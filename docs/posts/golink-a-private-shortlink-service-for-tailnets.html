<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/tailscale/golink">Original</a>
    <h1>Golink: A private shortlink service for tailnets</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><a href="https://tailscale.com/kb/1167/release-stages/#experimental" rel="nofollow"><img src="https://camo.githubusercontent.com/c24bc49f9a25e4b30f998749a5bf4603c132f0763d6055903cd9b620282e38c6/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7374617475732d6578706572696d656e74616c2d626c7565" alt="status: experimental" data-canonical-src="https://img.shields.io/badge/status-experimental-blue"/></a></p>
<p dir="auto">golink is a private shortlink service for your <a href="https://tailscale.com/kb/1136/tailnet/" rel="nofollow">tailnet</a>.
It lets you create short, memorable links for the websites you and your team use most.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tailscale/golink/blob/main/screenshot.png"><img src="https://github.com/tailscale/golink/raw/main/screenshot.png" alt="Screenshot of golink home screen"/></a></p>
<h2 dir="auto"><a id="user-content-building-and-running" aria-hidden="true" href="#building-and-running"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building and running</h2>
<p dir="auto">To build from source and run in dev mode:</p>
<div data-snippet-clipboard-copy-content="go run ./cmd/golink -dev-listen :8080"><pre><code>go run ./cmd/golink -dev-listen :8080
</code></pre></div>
<p dir="auto">golink will be available at <a href="http://localhost:8080/" rel="nofollow">http://localhost:8080/</a>,
storing links in a temporary database, and will not attempt to join a tailnet.</p>
<p dir="auto">The equivalent using the pre-built docker image:</p>
<div data-snippet-clipboard-copy-content="docker run -it --rm -p 8080:8080 ghcr.io/tailscale/golink:main -dev-listen :8080"><pre><code>docker run -it --rm -p 8080:8080 ghcr.io/tailscale/golink:main -dev-listen :8080
</code></pre></div>
<p dir="auto">If you receive the docker error <code>unable to open database file: out of memory (14)</code>,
use a persistent volume as documented in <a href="#running-in-production">Running in production</a>.</p>
<h2 dir="auto"><a id="user-content-joining-a-tailnet" aria-hidden="true" href="#joining-a-tailnet"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Joining a tailnet</h2>
<p dir="auto">Create an [auth key] for your tailnet at <a href="https://login.tailscale.com/admin/settings/keys" rel="nofollow">https://login.tailscale.com/admin/settings/keys</a>.
Configure the auth key to your preferences, but at a minimum we generally recommend:</p>
<ul dir="auto">
<li>add a <a href="https://tailscale.com/kb/1068/acl-tags/" rel="nofollow">tag</a> (maybe something like <code>tag:golink</code>) to make it easier to set ACLs for controlling access and to ensure the node doesn&#39;t expires.</li>
<li>don&#39;t set &#34;ephemeral&#34; so the node isn&#39;t removed if it goes offline</li>
</ul>
<p dir="auto">Once you have a key, set it as the <code>TS_AUTHKEY</code> environment variable when starting golink.
You will also need to specify your sqlite database file:</p>
<div data-snippet-clipboard-copy-content="TS_AUTHKEY=&#34;tskey-auth-&lt;key&gt;&#34; go run ./cmd/golink -sqlitedb golink.db"><pre><code>TS_AUTHKEY=&#34;tskey-auth-&lt;key&gt;&#34; go run ./cmd/golink -sqlitedb golink.db
</code></pre></div>
<p dir="auto">golink stores its tailscale data files in a <code>tsnet-golink</code> directory inside <a href="https://pkg.go.dev/os#UserConfigDir" rel="nofollow">os.UserConfigDir</a>.
As long as this is on a persistent volume, the auth key only needs to be provided on first run.</p>
<h2 dir="auto"><a id="user-content-magicdns" aria-hidden="true" href="#magicdns"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MagicDNS</h2>
<p dir="auto">When golink joins your tailnet, it will attempt to use &#34;go&#34; as its node name,
and will be available at <a href="http://go.tailnet0000.ts.net/" rel="nofollow">http://go.tailnet0000.ts.net/</a> (or whatever your tailnet name is).
To make it accessible simply as <a href="http://go/" rel="nofollow">http://go/</a>, enable <a href="https://tailscale.com/kb/1081/magicdns/" rel="nofollow">MagicDNS</a> for your tailnet.
With MagicDNS enabled, no special configuration or browser extensions are needed on client devices.
Users just need to have Tailscale installed and connected to the tailnet.</p>
<h2 dir="auto"><a id="user-content-running-in-production" aria-hidden="true" href="#running-in-production"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Running in production</h2>
<p dir="auto">golink compiles as a single static binary (including the frontend) and can be deployed and run like any other binary.
Two pieces of data should be on persistent volumes:</p>
<ul dir="auto">
<li>tailscale data files in the <code>tsnet-golink</code> directory inside <a href="https://pkg.go.dev/os#UserConfigDir" rel="nofollow">os.UserConfigDir</a></li>
<li>the sqlite database file where links are stored</li>
</ul>
<p dir="auto">In the docker image, both are stored in <code>/home/nonroot</code>, so you can mount a persistent volume:</p>
<div data-snippet-clipboard-copy-content="docker run -v /persistant/data:/home/nonroot ghcr.io/tailscale/golink:main"><pre><code>docker run -v /persistant/data:/home/nonroot ghcr.io/tailscale/golink:main
</code></pre></div>
<p dir="auto">The mounted directory will need to be writable by the nonroot user (uid: 65532, gid: 65532),
for example by calling <code>sudo chown 65532 /persistent/data</code>.
Alternatively, you can run golink as root using <code>docker run -u root</code>.</p>
<p dir="auto">No ports need to be exposed, whether running as a binary or in docker.
golink will listen on port 80 on the tailscale interface, so can be accessed at <a href="http://go/" rel="nofollow">http://go/</a>.</p>
<details>
  <summary>Deploy on Fly</summary>
<p dir="auto">See <a href="https://fly.io/docs/" rel="nofollow">https://fly.io/docs/</a> for full instructions for deploying apps on Fly, but this should give you a good start.
Replace <code>FLY_APP_NAME</code> and <code>FLY_VOLUME_NAME</code> with your app and volume names.</p>
<p dir="auto">Create a <a href="https://fly.io/docs/reference/configuration/" rel="nofollow">fly.toml</a> file:</p>
<div dir="auto" data-snippet-clipboard-copy-content="app = &#34;FLY_APP_NAME&#34;

[build]
image = &#34;ghcr.io/tailscale/golink:main&#34;

[deploy]
strategy = &#34;immediate&#34;

[mounts]
source=&#34;FLY_VOLUME_NAME&#34;
destination=&#34;/root&#34;"><pre><span>app</span> = <span><span>&#34;</span>FLY_APP_NAME<span>&#34;</span></span>

[<span>build</span>]
<span>image</span> = <span><span>&#34;</span>ghcr.io/tailscale/golink:main<span>&#34;</span></span>

[<span>deploy</span>]
<span>strategy</span> = <span><span>&#34;</span>immediate<span>&#34;</span></span>

[<span>mounts</span>]
<span>source</span>=<span><span>&#34;</span>FLY_VOLUME_NAME<span>&#34;</span></span>
<span>destination</span>=<span><span>&#34;</span>/root<span>&#34;</span></span></pre></div>
<p dir="auto">Then run the commands with the <a href="https://fly.io/docs/hands-on/install-flyctl/" rel="nofollow">flyctl CLI</a>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ flyctl apps create FLY_APP_NAME
$ flyctl volumes create FLY_VOLUME_NAME
$ flyctl secrets set TS_AUTHKEY=tskey-auth-&lt;key&gt;
$ flyctl deploy"><pre>$ flyctl apps create FLY_APP_NAME
$ flyctl volumes create FLY_VOLUME_NAME
$ flyctl secrets <span>set</span> TS_AUTHKEY=tskey-auth-<span>&lt;</span>key<span>&gt;</span>
$ flyctl deploy</pre></div>
</details>
<h2 dir="auto"><a id="user-content-backups" aria-hidden="true" href="#backups"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Backups</h2>
<p dir="auto">Once you have golink running, you can backup all of your links in <a href="https://jsonlines.org/" rel="nofollow">JSON lines</a> format from <a href="http://go/.export" rel="nofollow">http://go/.export</a>.
At Tailscale, we snapshot our links weekly and store them in git.</p>
<p dir="auto">To restore links, specify the snapshot file on startup.
Only links that don&#39;t already exist in the database will be added.</p>
<div data-snippet-clipboard-copy-content="golink -snapshot links.json"><pre><code>golink -snapshot links.json
</code></pre></div>
<p dir="auto">You can also resolve links locally using a snapshot file:</p>
<div data-snippet-clipboard-copy-content="golink -resolve-from-backup links.json go/link"><pre><code>golink -resolve-from-backup links.json go/link
</code></pre></div>
</article>
          </div></div>
  </body>
</html>
