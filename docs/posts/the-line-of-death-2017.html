<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://textslashplain.com/2017/01/14/the-line-of-death/">Original</a>
    <h1>The Line of Death (2017)</h1>
    
    <div id="readability-page-1" class="page"><div id="content">

	<section id="primary">
		<main id="main">

			
<article id="post-1256">

	

	
	<div>
		<p>When building applications that display untrusted content, security designers have a major problem— if an attacker has full control of a block of pixels, he can make those pixels look like anything he wants, including the UI of the application itself. He can then induce the user to undertake an unsafe action, and a user will be none the wiser.</p>
<p>In web browsers, the browser itself usually controls the top of the window, while pixels under the top are under control of the site. I’ve recently heard this called <strong>the line of death:</strong></p>
<p><img title="Line of death below omnibox" src="https://textplain.files.wordpress.com/2017/01/image36.png?w=720&amp;h=292" alt="Line of death below omnibox" width="720" height="292"/></p>
<p>If a user trusts pixels above the line of death, the thinking goes, they’ll be safe, but if they can be convinced to trust the pixels below the line, <em>they’re gonna die</em>.</p>
<p>Unfortunately, this crucial demarcation isn’t explicitly pointed out to the user, and even more unfortunately, it’s not an absolute.</p>
<p>For instance, because the area above the LoD is so small, sometimes more space is needed to display trusted UI. Chrome attempts to resolve this by showing a little <strong>chevron</strong> that crosses the LoD:</p>
<p><img title="Chrome chevrons" src="https://textplain.files.wordpress.com/2017/01/image37.png?w=678&amp;h=152" alt="Chrome chevrons" width="678" height="152"/></p>
<p>…because untrusted markup cannot cross the LoD. Unfortunately, as you can see in the screenshot, the treatment is inconsistent; in the PageInfo flyout, the chevron points to the bottom of the lock and the PageInfo box overlaps the LoD, while in the Permission flyout the chevron points to the bottom of the omnibox and the Permission box only abuts the LoD. Sometimes, the chevron is omitted, as in the case of Authentication dialogs, and as of <strong>Chrome 70</strong>, the chevron appears to have been <em>removed entirely </em>for all UI.</p>
<p>Alas, even when it was in Chrome, the chevron is subtle, and I expect most users will fall for a faked chevron, like some sites have started to use<sup>1</sup>:</p>
<p><img title="Fake chevron in HTML" src="https://textplain.files.wordpress.com/2017/01/image38.png?w=287&amp;h=164" alt="Fake chevron in HTML" width="287" height="164"/></p>
<p>The bigger problem is that some attacker data is allowed above the LoD; while trusting the content below the LoD will kill your security, there are also areas of death <em>above </em>the line. A more accurate <strong>Zones of Death </strong>map might look like this:</p>
<p><img title="Zones of Death" src="https://textplain.files.wordpress.com/2017/01/image39.png?w=720&amp;h=293" alt="Zones of Death" width="720" height="293"/></p>
<p>In Zone 1, the attacker’s chosen icon and page title are shown. This information is controlled fully by the attacker and thus may consist entirely of deceptive content and lies.</p>
<p>In Zone 2, the attacker’s domain name is shown. Some information security pros will argue that this is the only “trustworthy” component of the URL, insofar as if the URL is HTTPS then the domain correctly identifies the site to which you’re connected. Unfortunately, your idea of <em>trustworthy</em> might be different than the experts’; <code>https://paypal-account.com/</code> may really be the domain you loaded, but it has no relationship with the legitimate payment service found at <a href="https://paypal.com" rel="nofollow">https://paypal.com</a>.</p>
<p>The path component of the URL in Zone 3 is fully untrustworthy; the URL <code>http://account-update.com/<strong>paypal.com/</strong></code> has nothing to do with Paypal either, and while spoofing here is less convincing, it also may be harder for the good guys to block because the spoofing content is not found in DNS nor does it create any records in <a href="https://www.certificate-transparency.org/">Certificate Transparency</a> logs.</p>
<p>Zone 4 is the web content area. Nothing in this area is to be believed. Unfortunately, on windowed operating systems, this is worse than it sounds, because it creates the possibility of <strong>picture-in-picture attacks</strong>, where an entire browser window, <em>including its trusted pixels</em>, can be faked:</p>
<p><img title="Paypal window is fake content from evil.example.com" src="https://textplain.files.wordpress.com/2017/01/image40.png?w=758&amp;h=491" alt="Paypal window is fake content from evil.example.com" width="758" height="491"/></p>
<p>When hearing of picture-in-picture attacks, many people immediately brainstorm defenses; many related to personalization. For instance, if you run your OS or browser with a custom theme, the thinking goes, you won’t be fooled. Unfortunately, there’s evidence that that just isn’t the case.</p>
<h3><span><em>Story time</em></span></h3>
<p><span>Back in 2007 as the IE team was launching Extended Validation (EV) certificates, Microsoft Research was <a href="https://www.adambarth.com/papers/2007/jackson-simon-tan-barth.pdf">publishing a paper</a> calling into question their effectiveness. A Fortune 500 financial company came to visit the IE team as they evaluated whether they wanted to go into the EV Certificate Authority business. They were excited about the prospect (as were we, since they were a well-known-name with natural synergies) but they noted that they thought the picture-in-picture problem was a fatal flaw. </span></p>
<p><span>I was defensive– “It’s interesting,” I conceded, “but I don’t think it’s a very plausible attack.”</span></p>
<p><span>They retorted “Well, we passed this screenshot around our entire information security department, and nobody could tell it’s a picture-in-picture attack. Can you?” they slid an 8.5×11 color print across the table.</span></p>
<p><span>“Of course!” I said, immediately relieved. I quickly grew gravely depressed as I realized the <em>implications</em> of the fact that <em>they</em> couldn’t tell the difference.</span></p>
<p><span>“How?” they demanded.</span></p>
<p><span>“It’s a picture of an IE7 browser running on Windows Vista in the transparent Aero Glass theme with a page containing a JPEG of an IE7 browser running on Windows XP in the Luna aka Fisher Price theme?” I pointed out.</span></p>
<p><span>“Oh. Huh.” they noted.</span></p>
<p><span>My thoughts of using browser personalization as an effective mitigation died that day.</span></p>
<p>Other mitigations were proposed; one CA built an extension where hovering over the EV Lock Icon (“Trust Badge”) would dim the entire screen except for the badge. One team proposed using image analysis to scan the current webpage for anything that looked like a fake EV badge.</p>
<p>Personally, my favorite approach was Tyler Close’s idea that the browser should use <a href="https://www.w3.org/2005/Security/usability-ws/papers/02-hp-petname/">PetNames</a> for site identity– think of them as a Gravatar icon for salted certificate hashes– not only would they make every HTTPS site’s identity look unique to each user, but this could also be used as a means of detecting fraudulent or misissued certificates (in a world before we had certificate transparency).</p>
<h2>The Future is Here … and It’s Worse</h2>
<p>HTML5 adds a Fullscreen API, which means the Zone of Death looks like this:<img data-attachment-id="1263" data-permalink="https://textslashplain.com/2017/01/14/the-line-of-death/zodfullscreen/" data-orig-file="https://textplain.files.wordpress.com/2017/01/zodfullscreen.png" data-orig-size="620,252" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="zodfullscreen" data-image-description="" data-image-caption="" data-medium-file="https://textplain.files.wordpress.com/2017/01/zodfullscreen.png?w=300" data-large-file="https://textplain.files.wordpress.com/2017/01/zodfullscreen.png?w=620" src="https://textplain.files.wordpress.com/2017/01/zodfullscreen.png?w=750" alt="zodfullscreen" srcset="https://textplain.files.wordpress.com/2017/01/zodfullscreen.png 620w, https://textplain.files.wordpress.com/2017/01/zodfullscreen.png?w=150 150w, https://textplain.files.wordpress.com/2017/01/zodfullscreen.png?w=300 300w" sizes="(max-width: 620px) 100vw, 620px"/></p>
<p>The Metro/Immersive/Modern mode of Internet Explorer in Windows 8 suffered from the same problem; because it was designed with a philosophy of “content over chrome”, there were <em>no </em>reliable trustworthy pixels. I begged for a persistent <strong>trustbadge </strong>to adorn the bottom-right of the screen (showing a security origin and a lock) but was overruled. One enterprising security tester in Windows made a visually-perfect spoofing site of Paypal, where even the user gestures that displayed the ephemeral browser UI were intercepted and fake indicators were shown. It was terrifying stuff, mitigated only by the hope that no one would use the new mode.</p>
<p>Virtually all mobile operating systems suffer from the same issue– due to UI space constraints, there are no trustworthy pixels, allowing any application to spoof another application or the operating system itself. Historically, some operating systems have attempted to mitigate the problem by introducing a <strong>secure user gesture </strong>(on Windows, it’s Ctrl+Alt+Delete) that always shows trusted UI, but such measures tend to confuse users (limiting their effectiveness) and often get “optimized away” when the UX team’s designers get ahold of the product.</p>
<p>It will be interesting to see how WebVR tries to address this problem on an even grander scale.</p>
<h2>Beyond Browsers</h2>
<p>Of course, other applications have the concept of a LoD as well, including web applications. Unfortunately, they often get this wrong. Consider Outlook.com’s rendering of an email:</p>
<p><img title="image" src="https://textplain.files.wordpress.com/2017/01/image41.png?w=526&amp;h=334" alt="image" width="526" height="334"/></p>
<p>When Outlook has received an email from a trusted sender, they notify the user via a “This message is from a trusted sender.” notice. Which appears directly inside a Zone of Death:</p>
<p><img title="image" src="https://textplain.files.wordpress.com/2017/01/image42.png?w=536&amp;h=345" alt="image" width="536" height="345"/></p>
<p>Enterprising phishers have taken advantage of this and generate their own fake “trusted sender” notifications atop their phishing content. Similar attacks exist against <a href="https://int21.de/slides/sec-t-lightning-pgp/#/">email-signing mechanisms</a>.</p>
<p>Security UI is hard.</p>
<p>-Eric</p>
<p><sup>1</sup> “<em>Why would they fake a permission prompt? What would they gain?</em>” you ask? Because for a real permission prompt, if you click <strong>Block</strong>,they can never ask you again, while with a fake prompt, they can spam you as much as they like. On the other hand, if you click <strong>Allow</strong>, they immediately present the <em>real </em>prompt.</p>
	</div><!-- .entry-content -->

	<!-- .entry-footer -->

			<div>
	
	<p>
		Impatient optimist. Dad. Author/speaker. Created Fiddler &amp; SlickRun. PM @ MSFT &#39;01-&#39;12, and &#39;18-, presently working on Microsoft Edge. My words are my own.		<a href="https://textslashplain.com/author/ericlaw1979/" rel="author">
			View more posts		</a>
	</p><!-- .author-description -->
</div><!-- .author-bio -->
	
</article><!-- #post-${ID} -->

	<nav aria-label="Posts">
		<h2>Post navigation</h2>
		
	</nav>
<!-- #comments -->

		</main><!-- #main -->
	</section><!-- #primary -->


	</div></div>
  </body>
</html>
