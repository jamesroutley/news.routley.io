<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ian.sh/tsa">Original</a>
    <h1>Bypassing airport security via SQL injection</h1>
    
    <div id="readability-page-1" class="page"><div class="page"><p><img alt="Bypassing airport security via SQL injection" fetchpriority="high" decoding="async" data-nimg="fill" sizes="100vw" srcset="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/d62a8e83-afad-45b3-8c9c-7c6044ad9797/lucia-serone--0DVsjv1AHc-unsplash/w=640,quality=90,fit=scale-down 640w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/d62a8e83-afad-45b3-8c9c-7c6044ad9797/lucia-serone--0DVsjv1AHc-unsplash/w=750,quality=90,fit=scale-down 750w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/d62a8e83-afad-45b3-8c9c-7c6044ad9797/lucia-serone--0DVsjv1AHc-unsplash/w=828,quality=90,fit=scale-down 828w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/d62a8e83-afad-45b3-8c9c-7c6044ad9797/lucia-serone--0DVsjv1AHc-unsplash/w=1080,quality=90,fit=scale-down 1080w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/d62a8e83-afad-45b3-8c9c-7c6044ad9797/lucia-serone--0DVsjv1AHc-unsplash/w=1200,quality=90,fit=scale-down 1200w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/d62a8e83-afad-45b3-8c9c-7c6044ad9797/lucia-serone--0DVsjv1AHc-unsplash/w=1920,quality=90,fit=scale-down 1920w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/d62a8e83-afad-45b3-8c9c-7c6044ad9797/lucia-serone--0DVsjv1AHc-unsplash/w=2048,quality=90,fit=scale-down 2048w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/d62a8e83-afad-45b3-8c9c-7c6044ad9797/lucia-serone--0DVsjv1AHc-unsplash/w=3840,quality=90,fit=scale-down 3840w" src="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/d62a8e83-afad-45b3-8c9c-7c6044ad9797/lucia-serone--0DVsjv1AHc-unsplash/w=3840,quality=90,fit=scale-down"/></p></div><article id="block-tsa"><p id="block-5f9453d75cba484eb1a381348b2a2108">08/29/2024</p><span id="cb2544b620ab4adb82692781483173f2"></span><p id="block-5110571d9c504c6c81cc9b24098d2f01">Like many, <a href="https://twitter.com/samwcyo" target="_blank" rel="noopener noreferrer">Sam Curry</a> and I spend a lot of time waiting in airport security lines. If you do this enough, you might sometimes see a special lane at airport security called <strong>Known Crewmember</strong> (KCM). KCM is a TSA program that allows pilots and flight attendants to bypass security screening, even when flying on domestic personal trips.</p><p id="block-15290d09e5c14891aa7e5a90578f1e42">The KCM process is fairly simple: the employee uses the dedicated lane and presents their KCM barcode or provides the TSA agent their employee number and airline. <a href="https://www.apfa.org/wp-content/uploads/2019/10/KCM-Program-Changes_OCT19.pdf" target="_blank" rel="noopener noreferrer">Various forms of ID</a> need to be presented while the TSA agent’s laptop verifies the employment status with the airline. If successful, the employee can access the sterile area without any screening at all. </p><p id="block-5fb348f7f51f4b228e79509e86ed0bcd">A similar system also exists for cockpit access, called the <strong>Cockpit Access Security System</strong> (CASS). Most aircraft have at least one jumpseat inside the cockpit sitting behind the flying pilots. When pilots need to commute or travel, it is not always possible for them to occupy a revenue seat, so a jumpseat can be used instead. CASS allows the gate agent of a flight to verify that the jumpseater is an authorized pilot. The gate agent can then inform the crew of the flight that the jumpseater was authenticated by CASS.</p><p id="block-b09c8233b01f4d6992aa6c223c6c4126">The employment status check is the most critical component of these processes. If the individual doesn’t currently work for an airline, they have not had a background check and should not be permitted to bypass security screening or access the cockpit. This process is also responsible for returning the photo of the crewmember to ensure the right person is being authorized for access. So how does this work, when every airline presumably uses a different system to store their employee information? That is what we were wondering, and where it gets interesting…</p><span id="0f91f0757e014a77ba9b3e3fde656baf"></span><h2 id="block-0f91f0757e014a77ba9b3e3fde656baf">ARINC </h2><p id="block-5c8319d635fd442da648f5e6ad7d14e7"><a href="https://en.wikipedia.org/wiki/ARINC" target="_blank" rel="noopener noreferrer">ARINC</a> (a subsidiary of Collins Aerospace) appears to be contracted by the TSA to operate the Known Crewmember system. ARINC operates a few central components, including an online website for pilots and flight attendants to check their KCM status, and an API to route authorization requests between different airlines. Each airline appears to operate their own authorization system to participate in KCM and CASS, and it interacts with the “hub” of ARINC.</p><p id="block-aad1266bbba04920bafe0731766f8582">The TSA and airlines can send requests such as <code>CockpitAccessRequest</code> and <code>CrewVerificationRequest</code> to ARINC, which then routes it to the appropriate airline’s system and receives the response. There are <a href="https://www.knowncrewmember.org/airlines/" target="_blank" rel="noopener noreferrer">77 airlines</a> currently participating in KCM. While larger airlines have likely built their own system, how do smaller airlines respond to these requests to participate in KCM or CASS?</p><span id="99a6c236791b49c1b92441fbfa50ffcb"></span><h2 id="block-99a6c236791b49c1b92441fbfa50ffcb">FlyCASS.com</h2><p id="block-6a2f9ee861344bb8837f1d231dba24c6">In our search for vendors that actually run the authorization systems, we found a site called <a href="https://www.flycass.com/" target="_blank" rel="noopener noreferrer">FlyCASS</a> which pitches small airlines a web-based interface to CASS. Intrigued, we noticed every airline had its own login page, such as Air Transport International (8C) being available at <code>/ati</code>. With only a login page exposed, we thought we had hit a dead end.</p><p id="block-d01c0c07f9524aedbe9e0ef68994c32d">Just to be sure though, we tried a single quote in the username as a SQL injection test, and immediately received a MySQL error:</p><div id="block-fd86e37760634f738707b576d7576670"><p><img alt="Uh oh." loading="lazy" width="3373" height="466.00000000000006" decoding="async" data-nimg="1" sizes="(max-width: 546px) 100vw, 100vw" srcset="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/68274892-b9e5-485b-a7d5-b05ddfb57518/Untitled/w=640,quality=90,fit=scale-down 640w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/68274892-b9e5-485b-a7d5-b05ddfb57518/Untitled/w=750,quality=90,fit=scale-down 750w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/68274892-b9e5-485b-a7d5-b05ddfb57518/Untitled/w=828,quality=90,fit=scale-down 828w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/68274892-b9e5-485b-a7d5-b05ddfb57518/Untitled/w=1080,quality=90,fit=scale-down 1080w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/68274892-b9e5-485b-a7d5-b05ddfb57518/Untitled/w=1200,quality=90,fit=scale-down 1200w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/68274892-b9e5-485b-a7d5-b05ddfb57518/Untitled/w=1920,quality=90,fit=scale-down 1920w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/68274892-b9e5-485b-a7d5-b05ddfb57518/Untitled/w=2048,quality=90,fit=scale-down 2048w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/68274892-b9e5-485b-a7d5-b05ddfb57518/Untitled/w=3840,quality=90,fit=scale-down 3840w" src="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/68274892-b9e5-485b-a7d5-b05ddfb57518/Untitled/w=3840,quality=90,fit=scale-down"/></p><figcaption>Uh oh.</figcaption></div><p id="block-b0f0b0ec3a614dd8a3bbd441f8d5decd">This was a very bad sign, as it seemed the username was directly interpolated into the login SQL query. Sure enough, we had discovered SQL injection and were able to use sqlmap to confirm the issue. Using the username of <code>&#39; or &#39;1&#39;=&#39;1</code> and password of <code>&#39;) OR MD5(&#39;1&#39;)=MD5(&#39;1</code>, we were able to login to FlyCASS as an administrator of Air Transport International!</p><span id="8b86c8aaab6f4f868314459db97a6cec"></span><h2 id="block-8b86c8aaab6f4f868314459db97a6cec">KCM and CASS Admin</h2><p id="block-e00dfaf85c19481cbadc0a9c5a907f01">It turns out that FlyCASS also operates both KCM and CASS for its participating airlines. Now that we are an administrator of Air Transport International, we are able to manage the list of pilots and flight attendants associated with them. Surprisingly, there is <strong>no further check or authentication</strong> to add a new employee to the airline. As the administrator of the airline, we were able to add anyone as an authorized user for KCM and CASS.</p><div id="block-d600d9cf5df1433498ff796d27907a00"><p><img alt="image" loading="lazy" width="3620" height="1329" decoding="async" data-nimg="1" sizes="(max-width: 546px) 100vw, 100vw" srcset="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/365eaded-0e61-4b63-ae2b-e6fbe38e6844/Untitled/w=640,quality=90,fit=scale-down 640w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/365eaded-0e61-4b63-ae2b-e6fbe38e6844/Untitled/w=750,quality=90,fit=scale-down 750w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/365eaded-0e61-4b63-ae2b-e6fbe38e6844/Untitled/w=828,quality=90,fit=scale-down 828w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/365eaded-0e61-4b63-ae2b-e6fbe38e6844/Untitled/w=1080,quality=90,fit=scale-down 1080w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/365eaded-0e61-4b63-ae2b-e6fbe38e6844/Untitled/w=1200,quality=90,fit=scale-down 1200w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/365eaded-0e61-4b63-ae2b-e6fbe38e6844/Untitled/w=1920,quality=90,fit=scale-down 1920w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/365eaded-0e61-4b63-ae2b-e6fbe38e6844/Untitled/w=2048,quality=90,fit=scale-down 2048w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/365eaded-0e61-4b63-ae2b-e6fbe38e6844/Untitled/w=3840,quality=90,fit=scale-down 3840w" src="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/365eaded-0e61-4b63-ae2b-e6fbe38e6844/Untitled/w=3840,quality=90,fit=scale-down"/></p><figcaption></figcaption></div><p id="block-942390e7aeb34afdb0601499a03dfb75">To test that it was possible to add new employees, we created an employee named <code>Test TestOnly</code> with a test photo of our choice and authorized it for KCM and CASS access. We then used the Query features to check if our new employee was authorized. Unfortunately, <strong>our test user was now approved to use both KCM and CASS</strong>:</p><div id="block-8ec8b06f285f48d696a14154d4aa6b27"><p><img alt="image" loading="lazy" width="708" height="463.8236220472441" decoding="async" data-nimg="1" sizes="(max-width: 546px) 100vw, 100vw" srcset="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/1becd167-a35e-4816-9fda-3defebefee14/Untitled/w=640,quality=90,fit=scale-down 640w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/1becd167-a35e-4816-9fda-3defebefee14/Untitled/w=750,quality=90,fit=scale-down 750w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/1becd167-a35e-4816-9fda-3defebefee14/Untitled/w=828,quality=90,fit=scale-down 828w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/1becd167-a35e-4816-9fda-3defebefee14/Untitled/w=1080,quality=90,fit=scale-down 1080w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/1becd167-a35e-4816-9fda-3defebefee14/Untitled/w=1200,quality=90,fit=scale-down 1200w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/1becd167-a35e-4816-9fda-3defebefee14/Untitled/w=1920,quality=90,fit=scale-down 1920w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/1becd167-a35e-4816-9fda-3defebefee14/Untitled/w=2048,quality=90,fit=scale-down 2048w, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/1becd167-a35e-4816-9fda-3defebefee14/Untitled/w=3840,quality=90,fit=scale-down 3840w" src="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/1becd167-a35e-4816-9fda-3defebefee14/Untitled/w=3840,quality=90,fit=scale-down"/></p><figcaption></figcaption></div><p id="block-aab9f586b06847d185fda501a3699e97">At this point, we realized we had discovered a very serious problem. Anyone with basic knowledge of SQL injection could login to this site and add anyone they wanted to KCM and CASS, allowing themselves to both skip security screening and then access the cockpits of commercial airliners.</p><p id="block-48684ad8ac6a411b93aa891e2c36a03b">We ended up finding several more serious issues but began the disclosure process immediately after finding the first issue.</p><span id="cf74fb9feff54a94834c69ce7fb59f57"></span><h2 id="block-cf74fb9feff54a94834c69ce7fb59f57">Disclosure</h2><p id="block-22d867c129804deaa67fe6e71f770148">We had difficulty identifying the right disclosure contact for this issue. We did not want to contact FlyCASS first as it appeared to be operated only by one person and we did not want to alarm them. On April 23rd, we were able to disclose the issue to the Department of Homeland Security, who acknowledged the issue and confirmed that they “are taking this very seriously”. FlyCASS was subsequently disabled in KCM/CASS and later appears to have remediated the issues.</p><p id="block-0c868581924b4680964d6534e7dc6628">After the issue was fixed, we attempted to coordinate the safe disclosure of this issue. Unfortunately, instead of working with us, the Department of Homeland Security stopped responding to us, and the TSA press office issued dangerously incorrect statements about the vulnerability, denying what we had discovered.</p><p id="block-affbd9beb9084b6f83220bb36f611c61">The TSA press office said in a statement that this vulnerability could not be used to access a KCM checkpoint because the TSA initiates a vetting process before issuing a KCM barcode to a new member. However, a KCM barcode is not required to use KCM checkpoints, as the TSO can enter an airline employee ID manually. After we informed the TSA of this, <a href="https://web.archive.org/web/20221001213220/https://mykcmsupport.com/faq/" target="_blank" rel="noopener noreferrer">they deleted the section of their website that mentions manually entering an employee ID</a>, and did not respond to our correction. We have confirmed that the interface used by TSOs still allows manual input of employee IDs.</p><p id="block-83fbfcaff7214b93b11e6ba4d8378fc8">Several other attacks were also likely possible. Since our vulnerability allowed us to edit an existing KCM member, we could have changed the photo and name of an existing enrolled user, which would likely bypass any vetting process that may exist for new members. If you are able to obtain an unenrolled KCM barcode, you can also enroll it to an employee ID yourself on the KCM website.</p><span id="ca072cb33f5c45a98f2ad3e874cb6ac0"></span><h2 id="block-ca072cb33f5c45a98f2ad3e874cb6ac0">Timeline</h2><ul><li id="block-a8cef222f5014cbe9bbbbb2d4d3b8538">04/23/2024: Initial disclosure to ARINC and FAA</li><li id="block-051304e2f4264d1b97dc755c1709153f">04/24/2024: Subsequent disclosure to DHS via CISA</li><li id="block-9c58a3b8c02a45a78b42da239c8639da">04/25/2024: DHS CISO confirms they are working on a resolution</li><li id="block-fd638dcbe6004c56be550f61d7eb86b4">05/07/2024: DHS CISO confirms FlyCASS was disconnected from KCM/CASS</li><li id="block-e68dff0aa21e4ef89a0e7d901ae978b3">05/17/2024: Follow-up to DHS CISO about TSA statements (no reply)</li><li id="block-2a2ab638ed704d2faab8a4917535a984">06/04/2024: Follow-up to DHS CISO about TSA statements (no reply)</li></ul><span id="2b40219408b04b0297eb78cd9e3d13e0"></span><h2 id="block-2b40219408b04b0297eb78cd9e3d13e0">Collaborators</h2><ul><li id="block-81b57a91ad9e4d70ae3426c4ac84ad89">Ian Carroll (<a href="https://twitter.com/iangcarroll" target="_blank" rel="noopener noreferrer">https://twitter.com/iangcarroll</a>)</li><li id="block-d12eca81b7d0493ebdcbeade4bb3fde8">Sam Curry (<a href="https://twitter.com/samwcyo" target="_blank" rel="noopener noreferrer">https://twitter.com/samwcyo</a>) </li></ul></article></div>
  </body>
</html>
