<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://research.google/blog/transformers-in-music-recommendation/">Original</a>
    <h1>Music recommendation system using transformer models</h1>
    
    <div id="readability-page-1" class="page"><section data-gt-id="blog_summary" data-gt-component-name="Blog Summary">
                        
                        



<p>We present a music recommendation ranking system that uses Transformer models to better understand the sequential nature of user actions based on the current user context.</p>
                        
                    </section><div data-gt-publish-date="20240816">
                    
                    
    <div data-gt-id="rich_text" data-gt-component-name="">
    <p data-block-key="08t19">Users have more choices for listening to music than ever before. Popular services boast of massive and varied catalogs. The YouTube Music catalog, for example, has over 100M songs globally. It follows that item recommendations are a core part of these products. Recommender systems make sense of the item catalog and are critical for tuning the catalog for the user’s tastes and needs. In products that provide recommendations, user actions on the recommended items — such as <i>skip</i>, <i>like</i>, or <i>dislike —</i> provide an important signal about user preferences. Observing and learning from these actions can lead to better recommendation systems. In <a href="https://music.youtube.com/explore" target="_blank" rel="noopener noreferrer">YouTube Music</a>, leveraging this signal is critical to understanding a user&#39;s musical taste.</p><p data-block-key="6rpn9">Consider a scenario where a user typically likes slow-tempo songs. When presented with an uptempo song, the user would typically skip it. However, at the gym, when they’re in a workout session, they like more uptempo music. In such a situation, we want to continue learning from their prior history to understand their musical preferences. At the same time, we want to discount prior skips of uptempo songs when recommending workout music.</p><p data-block-key="fj00u">Below we illustrate the users’ music listening experience, with music songs shown as items and with the user’s actions as text beneath. In current recommendation systems that don’t consider the broader context, we would predict that the user will skip an uptempo song, resulting in demoting a potentially relevant and valuable song.</p>
</div>

                    
                    
    

  







                    
                    
    <div data-gt-id="rich_text" data-gt-component-name="">
    <p data-block-key="buklh">The below figure shows the same user journey as before, but in a different situation, where upbeat music may be more relevant. We still utilize their previous music listening, while recommending upbeat music that is close to their usual music listening. In effect, we are learning which previous actions are relevant in the current task of ranking music, and which actions are irrelevant.</p>
</div>

                    
                    
    

  







                    
                    
    <div data-gt-id="rich_text" data-gt-component-name="">
    <p data-block-key="6gnmm">A typical user will perform hundreds of <i>like</i>, <i>dislike</i>, and <i>skip</i> actions, and this sequence of input data, though information-rich, quickly becomes unwieldy. To add to this complexity, users perform different numbers of actions. While a typical user might have hundreds of actions, user behavior can vary between a small number of actions to a very large number of actions, and a good ranking system must be flexible in handling different input sizes.</p><p data-block-key="18rv9">In this post we discuss how we’ve applied <a href="https://research.google/pubs/pub46201/">transformers</a>, which are well-suited to processing sequences of input data, to improve the recommendation system in YouTube Music. This recommendation system consists of three key stages: item retrieval, item ranking, and filtering. Prior user actions are usually added to the ranking models as an input feature. Our approach adapts the Transformer architecture from generative models for the task of understanding the sequential nature of user actions, and blends that with ranking models personalized for that user. Using transformers to incorporate different user actions based on the current user context helps steer music recommendations directly towards the user’s current need. For signed-in users, this approach allows us to incorporate a user’s history without having to explicitly identify what in a user’s history is valuable to the ranking task.</p>
</div>

                    
                    
    <div data-gt-id="rich_text" data-gt-component-name="">
    <h2 data-block-key="d4ewl">Retrieval, ranking, and filtering</h2><p data-block-key="cdcfp">In existing models, it was difficult to identify which user actions were relevant to the user’s current needs. To understand such models, we need to look at typical recommendation systems. These systems are usually set up as three distinct stages. First, <i>retrieval</i> systems retrieve thousands of relevant items (documents, songs, etc.) from a large corpus. Second, <i>ranking</i> systems evaluate the retrieved results, so that the items that are more relevant and important to the user’s needs are assigned a higher score. The key complexity of ranking comes from the value judgment between concepts such as relevance, importance, novelty, and assigning a numerical value to these fuzzy concepts. Finally, a <i>filtering</i> stage sorts the ranked list by scores, and reduces the sorted list to a short list that is shown to the user. When designing and deploying a ranking model, it is hard to manually select and apply relative weights to specific user actions out of the many hundreds or thousands that they may commonly take.</p>
</div>

                    
                    
    <div data-gt-id="rich_text" data-gt-component-name="">
    <h2 data-block-key="d4ewl">Transformers make sense of sequences</h2><p data-block-key="tbr8"><a href="https://research.google/blog/transformer-a-novel-neural-network-architecture-for-language-understanding/">Transformers</a> are well-suited to a class of problems where we need to make sense of a sequence of input data. While transformers have been used to improve ranking functions, previous approaches have not focused on user actions: Transformer models like <a href="https://www.amazon.science/publications/rankformer-listwise-learning-to-rank-using-listwide-labels" target="_blank" rel="noopener noreferrer">RankFormer</a> have used item candidates (as opposed to user-actions) as input, classical language <a href="https://arxiv.org/abs/1810.04805" target="_blank" rel="noopener noreferrer">transformers like BERT</a> are used to <a href="https://parl.ai/docs/agent_refs/bert_ranker.html" target="_blank" rel="noopener noreferrer">rank language</a> output, or BERT-like models are used in recommendations, as <a href="https://arxiv.org/pdf/1904.06690" target="_blank" rel="noopener noreferrer">in Bert4Rec</a>.</p><p data-block-key="1cc9b">The Transformer architecture consists of self-attention layers to make sense of sequential input. Transformer models have shown incredible performance on translation or classification tasks, even with ambiguous input text. The self-attention layers capture the relationship between words of text in a sentence, which suggests that they might be able to resolve the relationship between user actions as well. The attention layers in transformers learn attention weights between the pieces of input (tokens), which are akin to word relationships in the input sentence.</p>
</div>

                    
                    
    

  







                    
                    
    <div data-gt-id="rich_text" data-gt-component-name="">
    <p data-block-key="76aop">This is how we utilize the Transformer architecture to encode user actions on <a href="https://music.youtube.com/" target="_blank" rel="noopener noreferrer">YouTube Music</a>. In the user journey involving uptempo music above, we saw how some actions were less important than others. For example, when the user is listening to music at the gym, the user may prefer high-energy upbeat music that they would normally skip, hence related actions (e.g., the skip action in this example) should get a lower attention weight. However, when a user is listening to music in other settings, user actions should get more attention. There should be a difference in attention weight applied to music context versus a user’s music history based upon the activity the user is performing. For example, when a user is at the gym they might listen to music that is more upbeat, but not too far from what they usually listen to. Or when they are driving, they might prefer to explore more new music.</p>
</div>

                    
                    
    <div data-gt-id="rich_text" data-gt-component-name="">
    <h2 data-block-key="d4ewl">Transformers for ranking in YouTube Music</h2><p data-block-key="2k8jl">Our architecture combines a Transformer with an existing ranking model to learn the combined ranking that best blends user actions with listening history (see diagram below). In this diagram, information flows from the bottom to the top: the inputs to the Transformer are shown at the bottom, and the produced ranking score is shown at the top. “Items” here are music tracks that we want to rank, with the goal to produce a ranking score for each music “item” given to it, with other signals (also called features) provided as input.</p>
</div>

                    
                    
    

  







                    
                    
    <div data-gt-id="rich_text" data-gt-component-name="">
    <p data-block-key="bmna1">Here are the signals describing the user action at each time step:</p><ul><li data-block-key="750ce">Intention of the action: interrupt a music track, select a music track to listen to, autoplay.</li><li data-block-key="chbpd">Salience of the action: percentage of the music track that was played, time since prior user-action.</li><li data-block-key="c0bee">Other metadata: artist, language of the music.</li><li data-block-key="98lkt">Music track: music track identifier corresponding to the user-action.</li></ul><p data-block-key="9k56l">Music tracks corresponding to user actions are represented by a vector of numbers called the track embedding. This music-track embedding is used as an input in both the Transformer and the existing ranking model. User-action signals, like intention and metadata, are turned into vectors with the same length as the length of the track embedding. This operation, called a projection, allows us to combine the signals simply by adding the two vectors: user-action signals and the track embedding, producing input vectors (called tokens) for the Transformer. The tokens provided as inputs to the Transformer are used <a href="https://developers.google.com/machine-learning/recommendation/dnn/scoring" target="_blank" rel="noopener noreferrer">to score</a> the retrieved music items. When considering the user’s history, we include the previous user actions and the music the user is currently listening to, as both capture valuable user context. The output vector from the Transformer is combined with the existing ranking model inputs, using a multi-layer neural network. The Transformer is co-trained with the ranking model, for multiple ranking objectives.</p><p data-block-key="b0hrb">Offline analysis and live experiments demonstrate that using this Transformer significantly improves the performance of the ranking model, leading to a reduction in skip-rate and an increase in time users spend listening to music. Skipping less frequently indicates that on average, users like the recommendations more. Increased session length indicates that users are happier with the overall experience. These two metrics demonstrate the improvement in user satisfaction for YouTube Music.</p>
</div>

                    
                    
    <div data-gt-id="rich_text" data-gt-component-name="">
    <h2 data-block-key="d4ewl">Future work</h2><p data-block-key="5b34">We see two main opportunities to build on this work. The first would be to adapt the technique to other parts of the recommendation system such as retrieval models. There are also a variety of nonsequential features, which are used as inputs to the prior ranking model, that we are also exploring for incorporation. Currently, these are combined after the Transformer stage, and we predict that incorporating them within the Transformer would allow for improved self-attention between the sequential features, like user-actions, and non-sequential features such as artist popularity, user language, music popularity and more.</p>
</div>

                    
                    
    <div data-gt-id="rich_text" data-gt-component-name="">
    <h2 data-block-key="d4ewl">Acknowledgements</h2><p data-block-key="2koet"><i>Thanks to colleagues Reza Mirghaderi, Li Yang, Chieh Lo, Jungkhun Byun, Gergo Varady, and Sally Goldman, for their collaboration on this effort.</i></p>
</div>

                    
                </div></div>
  </body>
</html>
