<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rachelbythebay.com/w/2023/12/25/feedback/">Original</a>
    <h1>A year-end wrapup of responses to reader feedback</h1>
    
    
<p>
It&#39;s time for some end of the year feedback.  I get a bunch of comments 
and questions from people through my contact page, and sometimes this is 
the only way to reply.  Other times, a response is also suitable for a 
wider audience.
</p>
<p>
...
</p>
<p>
Igor asks:
</p>
<blockquote>
<p>
Have you played around with cling? Seems you may have the knowledge 
to break it or request the developers to enhance it with some useful 
feature(s). Like suppose doing scripting in it?
</p>
</blockquote>
<p>
I didn&#39;t even know what cling was until I read this and went looking. 
It seems to be a clang/LLVM-based C++ interpreter that&#39;s interactive.  I 
guess I don&#39;t have a need for something like that.  As far as 
deliberately breaking things, I have no doubt that my luck would lead to 
any number of bad outcomes.  However, I have enough of that in my life 
already without seeking out new stuff just for the sake of having 
something to break.
</p>
<p>
Now, if there was a good reason for me to do it, that would be another 
story.  (I am available for mercenary purposes, put it that way.)
</p>
<p>
...
</p>
<p>
An anonymous reader asks:
</p>
<blockquote>
<p>
What&#39;s the specs of this new web server?
</p>
</blockquote>
<p>
It&#39;s only new to me.  It&#39;s actually fairly old.  I think it&#39;s roughly 
2014 vintage.  I bought it from one of those vendors who resell old 
servers.  I figured &#34;it&#39;s a server, not a toothbrush&#34; and so the notion 
of using some random old box was not a problem for me.  It runs Linux 
and is plenty quick, so I&#39;m happy enough.
</p>
<p>
I guess this is a good point to tell the story of actually installing 
this thing.  Despite working at places with millions of Linux boxes over 
the years, I&#39;d never hung a server.  I&#39;d done routers and dialup boxes, 
but those were all relatively short.  They&#39;d hang from the front posts 
and were plenty happy with life that way.
</p>
<p>
flicker, on the other hand, is a monster.  It&#39;s so long the cabinet 
doors almost didn&#39;t close.  I had no idea that length was a dimension 
that might be a problem.  I clearly didn&#39;t realize just what I was 
getting when that order was placed, and when it showed up in a giant 
box, I started thinking &#34;what have I done?&#34;...
</p>
<p>
Initially, the machine barely fit into the cabinet with the power cord 
being squished on one end and the network cables being squished on the 
other.  I came back about a month later and swapped it to a new power 
cord that has a 90 degree bend built into the server-side plug.  This 
clawed back about an inch on that side and let the whole thing slide 
back a little bit which took the pressure off the Ethernet cables.
</p>
<p>
I took the now-permanently-crimped (and damaged) power cable, cut it in 
half so nobody would find it and try to use it, and tossed it.
</p>
<p>
It was the sort of thing that anyone with experience would point at and 
go &#34;ha, you screwed up&#34;, and indeed, I did.  It turned out to not be 
fatal to the project of moving to colocation, but it was mighty close.
</p>
<p>
Next time, I&#39;ll pay attention to this sort of thing.
</p>
<p>
Lesson learned: go see the cabinet and measure it before ordering 
something that&#39;s almost three feet long!
</p>
<p>
(It&#39;s an Ivy Bridge flavored dual-socket hex core Xeon with 128 GB of 
memory and a couple of SSDs.  It also has a far faster pipe than the 
previous box.  It&#39;s a complete monster for how I use it.  Oh, and it&#39;s 
not in Texas, which has turned out to be very important.)
</p>
<p>
...
</p>
<p>
Regarding my &#34;char buf[1048576]&#34; thing from the other day where I blew 
the stack, a reader says:
</p>
<blockquote>
<p>
You can use boost::thread instead. It lets you specify the stack size.
</p>
</blockquote>
<p>
Honestly though, I don&#39;t *want* to specify the stack size.  I&#39;m fine 
with defaults.  Also, any answer which involves &#34;boost&#34; means I&#39;m asking 
the wrong question.  I don&#39;t ever want to get stuck with something like 
that.  There&#39;s been too much drama in my life from boost dependencies in 
years gone by.
</p>
<p>
The obvious way around the &#34;problem&#34; for me is to do something like a 
vector&lt;char&gt;, push it out to whatever size, and then let read() use it 
as a buffer.  This is pretty much what I end up doing any time I have to 
deal with old-school C library functions from my C++ code.
</p>
<p>
Like, okay, mkdtemp().  It wants a char* template, like 
&#34;/tmp/test_thingy.XXXXXXXX&#34;.  It *reaches into* that space and alters 
it, changing the Xs to some random gunk that turned out to be unique - 
this is how you avoid /tmp race attacks.  This is more annoying than it 
sounds.
</p>
<p>
You might think &#34;oh I know, I&#39;ll use a string, then hand the .c_str() 
pointer from it to mkdtemp&#34;.  But, no, c_str() gives you a *const* 
pointer, and mkdtemp is going to violate that const-ness.  Your compiler 
will stop you from doing this.  You then must either lie to it and do 
some nasty casting, or you decide that&#39;s not going to work and find 
another way.
</p>
<p>
This is why I have a bunch of stupid shims to deal with these scenarios.  
It&#39;s just that I never really shimmed read() before - the old hacky way 
of having a buffer on the stack was never a problem.
</p>
<p>
As for &#34;why is that buffer so big&#34;, well, I like to cut down on the 
number of syscalls required to inhale a file: a bigger buffer eats the 
whole thing in a single go.  A tiny buffer would need to keep coming 
back until it finished.  This sort of thing used to matter more when 
machines were much slower.
</p>
<p>
Besides, I
<a href="https://rachelbythebay.com/w/2023/01/05/syscall/">hate spammy syscall</a>
situations.  read() or write() with a single byte?  Argh!
</p>
<p>
...
</p>
<p>
From another reader:
</p>
<blockquote>
<p>
hey are you still running wg barebones on your mac? I just made the 
mistake of installing and got the &#39;cant uninstall&#39; behavior with 
additional &#39;nothing happens when you dbl click on app icon&#39; . just 
wanted to compare notes
</p>
</blockquote>
<p>
Yep, I still am doing this on my personal machine and also those of 
family members (in my duties as &#34;holiday sysadmin&#34;), having removed the 
&#34;app store&#34; version a while back.  I get feedback from random people 
who find that
<a href="https://rachelbythebay.com/w/2020/12/24/wg/">three year old post</a>
about once a quarter, and they all seem to have the same problems.
I take that as a pretty strong signal to not try it again just yet.
</p>
<p>
I should note that if you&#39;re using Macports, upgrade to Sonoma, and then 
try to build wireguard-tools or several other packages, it&#39;ll fail due 
to various Apple-related stupidity.  I&#39;ll do another post about that 
eventually.
</p>
<p>
...
</p>
<p>
Finally, a bunch of people wrote in about the &#34;clang + C++ + original 
armv6 Raspberry Pi = unusable binaries&#34; to say that it explained some 
oddities they had been seeing on their own stuff, so I think that turned 
out okay.  That&#39;s really what I aim for in writing these posts:  
visibility into problems, and confirmation that you aren&#39;t alone in 
experiencing something.  Sometimes it&#39;s technical, but other times it&#39;s 
about squishy meatspace stuff.  Both are valid.
</p>

  </body>
</html>
