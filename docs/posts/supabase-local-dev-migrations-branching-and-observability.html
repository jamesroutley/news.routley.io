<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://supabase.com/blog/supabase-local-dev">Original</a>
    <h1>Supabase Local Dev: migrations, branching, and observability</h1>
    
    <div id="readability-page-1" class="page"><article><div><p><span><img alt="Supabase Local Dev: migrations, branching, and observability" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></p><p>One of our goals at Supabase is to make Postgres development delightful. To do this, we need to simplify the experience between our CLI, your code editor, and the remote Postgres database powering your applications.</p>
<p>We received feedback recently about our local development experience, encouraging us to improve. This iteration introduces many new features to address that feedback. Let’s jump into a few of the features we’re launching today.</p>
<p><iframe src="https://www.youtube-nocookie.com/embed/N0Wb85m3YMI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"></iframe></p>
<h2 id="postgres-language-server">Postgres Language Server</h2>
<p><span><span><img alt="Postgres Language Server" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></span></p>
<p>One of the unique features of Supabase is the ability to access your Postgres database directly from a browser or mobile app through our <a href="https://supabase.com/docs/guides/api">Serverless APIs</a>. This means that developers are writing more <a href="https://www.postgresql.org/docs/current/plpgsql.html">PL/pgSQL</a>.</p>
<p>While code editors have great support for most programming languages, SQL support is underwhelming. We want to make Postgres as simple as Python. Our recently announced <a href="https://github.com/supabase/postgres_lsp">Postgres Language Server</a> takes us a step in that direction - eventually it will provide first-class support for Postgres in your favorite code editor including Linting, Syntax Highlighting, Migrations Parsing, SQL Auto-complete, and Intellisense.</p>
<p>The Postgres Language Server is not ready for Production just yet. The majority of work is still ahead, but we&#39;ve verified that the technical approach works and we&#39;re making it public now so that we can develop it in the open with input from the community. We’re already receiving amazing <a href="https://github.com/supabase/postgres_lsp/discussions">feedback</a> and <a href="https://news.ycombinator.com/item?id=37020610">support</a>.</p>
<p>Follow the progress of the <a href="https://github.com/supabase/postgres_lsp">Postgres Language Server on GitHub</a>.</p>
<h2 id="observability-tools-for-postgres">Observability tools for Postgres</h2>
<p><span><span><img alt="Inspect your database" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></span></p>
<p>We’ve added <a href="https://supabase.com/docs/guides/database/inspect">debugging utilities</a> to our CLI to identify production issues via the <code>supabase inspect db</code> command. This interface includes 19 different commands to help you solve everything from slow queries to redundant indexes.</p>
<p>A lot of the credit for this belongs to <a href="https://github.com/heroku/heroku-pg-extras">Heroku’s pg-extras</a> feature, an amazingly useful set of functionality. We’ve adapted the work they started, added a few additional commands, and made it available for any Postgres database. Simply append the <code>--db-url</code> param to use these commands with your own Postgres database.</p>
<p>This is just a starting point for the Supabase inspector. We’ll grow this feature to become an essential part of your Postgres toolkit.</p>


<h2 id="easier-backups">Easier backups</h2>
<p><span><span><img alt="How to back up your database with Supabase CLI" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></span></p>
<p>We’ve made it even easier to backup and migrate your database, using <code>supabase db dump</code>. Under the hood, this simply uses <a href="https://www.postgresql.org/docs/current/app-pgdump.html">pg_dump</a> (it&#39;s just Postgres, after all). However we also handle a few of the hairy issues that you might need to navigate on your own, like object permissions.</p>

<h2 id="improved-database-migrations">Improved Database Migrations</h2>
<p><span><span><img alt="modify your database" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></span></p>
<p>We’ve extended the CLI migration feature and added Dashboard support. Database migrations give you a way to update your database using version-controlled SQL files. We’ve built a lot of tooling around our migrations, including <a href="https://supabase.com/docs/reference/cli/supabase-migration-repair">reparation</a>, migration cleanup using the <a href="https://supabase.com/docs/reference/cli/supabase-migration-squash">squash</a> command, and <a href="https://supabase.com/docs/reference/cli/supabase-db-diff">diffing</a> (using <a href="https://github.com/djrobstep/migra">migra</a>) to generate a new migration or to detect schema drift.</p>
<p>With the new Postgres Language Server, we hope to make it as easy to write Postgres migrations as it is to develop applications in TypeScript, Go, Python, or Rust.</p>
<p>Finally, we’ve added a Migrations view <a href="https://app.supabase.com/project/_/database/migrations">in the dashboard</a> to track your migration history to improve the discoverability of migrations.</p>

<h2 id="test-and-lint-your-database">Test and lint your database</h2>
<p><span><span><img alt="Test your database" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></span></p>
<p>We’ve simplified the database testing experience, with <code>supabase test</code>. Running <code>supabase test new</code> stubs out a <a href="https://pgtap.org/">pgTAP test</a> for you to fill with testing logic. The CLI includes <a href="https://pgtap.org/pg_prove">pg_prove and the TAP harness</a>, so all you need to do is run <code>supabase test db</code>.</p>
<p>To make life even easier, our friends at <a href="https://usebasejump.com/">Basejump</a> have created an entire suite of <a href="https://github.com/usebasejump/supabase-test-helpers">Supabase Test Helpers</a> which make it simple to create users, run tests as an <a href="https://usebasejump.com/blog/testing-on-supabase-with-pgtap#testing-authenticated">authenticated user</a>, and test your <a href="https://usebasejump.com/blog/testing-on-supabase-with-pgtap#rls-testing">RLS policies</a>.</p>
<p>Finally, while you wait for us to make progress on the Language Server, we’ve added <a href="https://supabase.com/docs/guides/cli/testing-and-linting#linting-your-database">support for linting</a> through the excellent <a href="https://github.com/okbob/plpgsql_check">plpgsql_check</a> extension.</p>

<h2 id="database-seeding">Database seeding</h2>
<p><span><span><img alt="Support for seeding" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></span></p>
<p>Seeding is the process of populating a database with initial data, typically used to provide sample or default records for testing and development purposes. This gives you a reproducible development environment across your entire team.</p>
<p>We’ve added <a href="https://supabase.com/docs/guides/cli/seeding-your-database">support for seeding</a> to populate your local databases with data whenever you run <code>supabase start</code> or <code>supabase db reset</code>.</p>
<p>We’ve also worked with our friends at Snaplet to <a href="https://supabase.com/docs/guides/cli/seeding-your-database#generating-seed-data">generate seed data</a> directly from your database:</p>

<h2 id="type-generators">Type generators</h2>
<p><span><span><img alt="End to end Type Safety" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></span></p>
<p>Type generators introspect a PostgreSQL schema and automatically generate TypeScript definitions. This gives you <a href="https://www.youtube.com/watch?v=VSNgAIObBdw">end-to-end type safety</a> from the database to the browser.</p>
<p>In the past month, we&#39;ve added relationship detection in supabase-js. Foreign keys are now included in the generated types so that supabase-js can detect whether a foreign table should be an array (one-to-many) or an object (many-to-one). We&#39;ve also added Helper Types to improve the developer experience for common scenarios, like short-hand accessors:</p>


<h2 id="official-github-action">Official GitHub Action</h2>
<p><span><span><img alt="Support for GitHub Actions" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></span></p>
<p>We’ve developed an official <a href="https://github.com/marketplace/actions/supabase-cli-action">GitHub Action</a> which leverages the CLI. You can <a href="https://supabase.com/docs/guides/cli/github-action/generating-types">generate types on every PR</a>, or run <a href="https://supabase.com/docs/guides/cli/github-action/testing">your tests on every commit</a>.</p>
<h2 id="local-logging-and-debugging">Local Logging and Debugging</h2>
<p>Logs are now accessible locally in the Dashboard. Last launch week we released an open source logging server, with support for BigQuery. In the past few months we’ve added Postgres support to this server. This means that all of your local logs are accessible with no additional config - simply run supabase start and then visit the local dashboard to start debugging.</p>
<p><span><span><img alt="Logs are now accessible locally in the dashboard" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></span></p>
<h2 id="stable-releases">Stable releases</h2>
<p>We’ve moved the Supabase CLI to a fortnightly stable-release cycle. Every 2 weeks, we will update the <a href="https://www.npmjs.com/package/supabase?activeTab=versions"><code>latest</code></a> tag on npm, the <a href="https://github.com/supabase/homebrew-tap/blob/main/supabase.rb"><code>supabase/tap</code></a> for homebrew, and the <a href="https://github.com/supabase/homebrew-tap/blob/main/supabase.rb"><code>supabase</code></a> scoop bucket. You can find the binary downloads in our GitHub <a href="https://github.com/supabase/cli/releases/latest">latest release</a>.</p>
<p>For the adventurous feature hunters, we’ve added a <code>beta</code> release channel for the CLI, with new releases on every PR merged. You can follow <a href="https://github.com/supabase/cli#install-the-cli">this guide</a> to install Supabase CLI (beta).</p>
<h2 id="branching-and-preview-environments">Branching and Preview Environments</h2>
<p>And finally, probably our most anticipated feature - branching:</p>
<p><span><span><img alt="Searching branches with Supabase" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></span></p>
<p>We’ve made major improvements to our local development with the features above - but we have bigger ambitions. For several months we’ve been developing Supabase branching and today we&#39;re opening it up for alpha testers.</p>
<p>Supabase isn’t simply a database, it’s an entire backend - everything from your Postgres database to your <a href="https://supabase.com/blog/storage-v3-resumable-uploads">50GB videos</a>. Branching improves the experience of managing environments so that developers and teams spend less time on DevOps and more time building.</p>
<h3 id="supabase-branching-is-hard">Supabase branching is hard</h3>
<p>Every project is a Postgres database, wrapped in a suite of tools like <a href="https://supabase.com/auth">Auth</a>, <a href="https://supabase.com/storage">Storage</a>, <a href="https://supabase.com/edge-functions">Edge Functions</a>, <a href="https://supabase.com/realtime">Realtime</a> and <a href="https://supabase.com/vector">Vectors</a>, and encompassed by <a href="https://supabase.com/docs/guides/api">API middleware</a> and <a href="https://supabase.com/blog/supabase-logs-self-hosted">logs</a>.</p>
<p>A good branching solution requires each tool to provide multi-tenancy support so that:</p>
<ol>
<li>Data can be isolated from production for security.</li>
<li>Compute can be isolated from each other to avoid noisy-neighbors.</li>
</ol>
<h3 id="how-does-branching-work">How does branching work?</h3>
<p>We use Git to bridge the gap between your local development environment and your hosted database. For now, we’ve focused on GitHub.</p>
<p>Every time you open a new Pull Request on GitHub, a corresponding “Preview Environment” is created. Each preview branch is an isolated Firecracker instance that pauses automatically after a period of inactivity. Every time a change is pushed to GitHub, the migrations within the <code>./supabase/migrations</code> folder are run against the Preview Branch so that your entire team is working from the same source of truth.</p>
<p>When you hit merge on your Pull Request we run the migrations on your Production database.</p>
<h3 id="what-about-data">What about data?</h3>
<p>We’re starting with seed data. Any SQL with <code>./supabase/seed.sql</code> will populate your Preview Branch. This provides your entire team with an isolated and reproducible environment, safe from any data privacy concerns.</p>
<p>Importantly, we <em>aren’t</em> cloning production data until we find something appropriate for data security. We know that copy-on-write is an available option, and with the appropriate anonymization techniques it seems like a promising way to provide a “production-like” test environment.</p>
<p>We’ll also need to figure out what this means for large files in Supabase Storage. Do you need to anonymize your photos and videos? This is a work in progress and we’re open to feedback.</p>
<p>Either way, we want to support <em>both</em> seed data and anonymized production data, so that teams can choose their preference based on their risk profile. It makes sense to start with a seed.</p>
<h3 id="is-it-available-yet">Is it available yet?</h3>
<p>For the next few months branching is in closed alpha. We’re looking for development partners for Supabase Branching. If you’re interested in testing the new features, <a href="https://forms.supabase.com/branching-request">sign up for early access</a>.</p>
<h2 id="get-started">Get started</h2>
<p>Jump into our updated <a href="https://supabase.com/docs/guides/cli">Local Development documentation</a> to get started with the CLI.</p>
<p>If you’re an existing user simply <a href="https://supabase.com/docs/guides/cli/getting-started#updating-the-supabase-cli">update your CLI</a> and check out the <a href="https://supabase.com/docs/reference/cli/introduction">full command reference</a> for all the latest commands.</p>
<h2 id="more-launch-week-8">More Launch Week 8</h2>
<ul>
<li><a href="https://supabase.com/blog/hugging-face-supabase">Hugging Face is now supported in Supabase</a></li>
<li><a href="https://supabase.com/launch-week">Launch Week 8</a></li>
<li><a href="https://supabase.com/blog/interactive-constellation-threejs-react-three-fiber">Coding the stars - an interactive constellation with Three.js and React Three Fiber</a></li>
<li><a href="https://supabase.com/blog/why-supabase-remote">Why we&#39;ll stay remote</a></li>
<li><a href="https://github.com/supabase/postgres_lsp">Postgres Language Server</a></li>
</ul></div></article></div>
  </body>
</html>
