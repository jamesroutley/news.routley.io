<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.complete.org/usenet-over-nncp/">Original</a>
    <h1>Usenet over NNCP</h1>
    
    <div id="readability-page-1" class="page"><article>
        <p><a href="https://www.complete.org/usenet/">Usenet</a>, of course, originally ran over <a href="https://www.complete.org/uucp/">UUCP</a> in quite a few cases.  Since <a href="https://www.complete.org/nncp/">NNCP</a> is quite similar to UUCP – in fact, you can <a href="https://nncp.mirrors.quux.org/Comparison.html">map UUCP commands to NNCP ones</a> – it is quite possible, and not all that hard, to run Usenet over NNCP.  In fact, in a number of ways, it works better than Usenet over UUCP!</p>
<h2 id="introduction-to-nncp--20220128150835-nncp-dot-md">Introduction to <a href="https://www.complete.org/nncp/">NNCP</a></h2>
<p>According to the <a href="https://nncp.mirrors.quux.org/">NNCP documentation</a>, NNCP is intended to help build up small size ad-hoc friend-to-friend (F2F) statically routed darknet delay-tolerant networks for fire-and-forget secure reliable files, file requests, Internet mail and commands transmission. All packets are integrity checked, end-to-end encrypted, explicitly authenticated by known participants public keys. Onion encryption is applied to relayed packets. Each node acts both as a client and server, can use push and poll behaviour model. Also there is multicasting area support.  NNCP can operate over a lot of transports: Internet, USB sticks, tapes, CD-ROMs, and <a href="https://www.complete.org/tunneling-nncp-over-other-transports/">some more</a> such as ssh, socat, Dropbox, and so forth.</p>
<p>The NNCP homepage is <a href="http://www.nncpgo.org">http://www.nncpgo.org</a>.  A mirror using TLS and Let’s Encrypt is at <a href="https://nncp.mirrors.quux.org">https://nncp.mirrors.quux.org</a>.  See <a href="https://www.complete.org/nncp-concepts/">NNCP Concepts</a> for an introduction to NNCP if you aren’t already familiar with it.</p>
<h2 id="introduction-to-usenet--20220128150908-usenet-dot-md">Introduction to <a href="https://www.complete.org/usenet/">Usenet</a></h2>
<p><a href="https://www.complete.org/usenet/">Usenet</a> is sometimes said to be the world’s oldest social network.  Since 1980, Usenet has been a massive, global discussion system.  Participants can read and post messages (called articles) in discussion forums (called newsgroups).  Unlike web forums, Usenet newsgroups are available from thousands of independently-operated servers worldwide (instead of just one particular site).  You can also use the client of your choice to access them.</p>
<p><strong>Please see <a href="https://www.complete.org/usenet/">my Usenet page</a> for more details, including how Usenet can be suitable for both very large and very small (eg, Raspberry Pi) sites.</strong></p>
<p>An NNCP feed is ideal for people that wish to run a smaller server; since the tools that operate Usenet come from an era in which even a Raspberry Pi would have been an unimaginably high level of computing power, the resource requirements for a small site are quite minimal</p>
<h2 id="intent-of-this-document">Intent of this document</h2>
<p>This document is primarily intended to let you operate as a leaf node for news.quux.org, the Usenet transit server operated principally by <a href="https://www.complete.org/john-goerzen/">John Goerzen</a>.  The <a href="https://www.complete.org/quux-org-usenet-nntp-and-nncp-peer/">quux.org Usenet NNTP and NNCP peer</a> (news.quux.org) has numerous peers with which it exchanges Usenet articles, and is able to offer you a full (basically every non-binary newsgroup) or partial (the newsgroups you select) feed.</p>
<p>Secondary intents are to:</p>
<ul>
<li>
<p>Demonstrate how to integrate INN with NNCP</p>
</li>
<li>
<p>Explain how you might operate a standalone (not connected with the global Usenet) INN network using NNCP.  This scenario is actually simpler than participating in the public Usenet, so much of what is said here may not apply to you.</p>
</li>
</ul>
<h2 id="what-can-you-do-with-a-nncp-usenet-feed-from-quux">What can you do with a NNCP Usenet feed from quux?</h2>
<p>Here are some examples:</p>
<ul>
<li>Set up a personal news server for your own use, which you can use to read and post articles, search through, etc.</li>
<li>Set up a news server for yourself, friends, and family</li>
<li>Receive content from quux and further redistribute it to your friends (establishing your own peers is up to you, and doesn’t require any involvement from quux)
<ul>
<li>You can also do the reverse; feed posts your friends send you via NNCP to quux and thus to the global Usenet.</li>
</ul>
</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before continuing, you must already:</p>
<ul>
<li>Be familiar with and operating <a href="https://www.complete.org/nncp/">NNCP</a></li>
<li>Have a working understanding of Usenet.</li>
<li>Be comfortable with the Linux/BSD/Unix command line.</li>
</ul>
<p>If you are not already familiar with Usenet, it would probably be a good idea to dive in!</p>
<p>Start with a newsreader program.  <a href="https://www.thunderbird.net/en-US/">Mozilla Thunderbird</a> or <a href="http://pan.rebelbase.com/">PAN</a> may be good places to start.  (For Thunderbird, add a new “other” account, for Usenet/newsgroup access).  You can get a free Usenet account from <a href="http://news.aioe.org/">AIOE</a> or <a href="https://www.eternal-september.org/">Eternal September</a> to use with it.  Don’t skip this step!</p>
<h3 id="requirements-for-an-nncp-feed-from-news-dot-quux-dot-org">Requirements for an NNCP feed from news.quux.org</h3>
<p>Because news.quux.org is capable of feeding your Usenet posts to thousands of Usenet servers across the globe, some additional requirements apply:</p>
<ul>
<li>
<p>Your NNCP data will be exchanged using the <a href="https://www.complete.org/quux-org-nncp-public-relay/">quux.org NNCP public relay</a>.  So, you will need to establish yourself as an NNCP peer with it according to its <a href="https://www.complete.org/quux-org-nncp-public-relay/">documentation</a>.  (This is a quick and simple process.)</p>
</li>
<li>
<p>NNCP already set up to call quux, and to run the tosser in some way.</p>
</li>
<li>
<p>If you discontinue using the quux NNCP gateway – and that’s fine – you need to let me know, so we don’t build up an endless set of articles for a system that will never talk to us again.</p>
</li>
<li>
<p>You must not operate an open or public relay.  Generally, that means “don’t expose any ports on your Usenet server to the Internet.”</p>
<ul>
<li>If you must expose the NNTP port to the Internet - which is discouraged in this situation - it must require authentication and you must not hand out accounts to the public.  As with an email service, operating a Usenet service that is open to the world would be ripe for abuse.  Those at AIOE and Eternal September have years of experience preventing that, and running a public relay from quux over NNCP is just going to be more pain than any of us have time to deal with.</li>
</ul>
</li>
<li>
<p>news.quux.org is a well-connected transit system, and as such will send you articles from the public Internet.  While measures are taken to filter at quux, you must understand and agree that, like much of the public Internet, Usenet has no central authority and you may encounter content you find objectionable.  Content policing is up to each individual server operator in Usenet, which will now include YOU.  Be familiar with what’s out there before, for instance, you offer it to children.</p>
</li>
<li>
<p>Similarly, it is your duty to not spread objectionable content to the Internet via quux.  Examples of objectionable content include that which is illegal, spam, abusive or exploitative, “doxxing”, harassing, impersonating others with fake headers or the like, threatening or causing harm (including by spreading health misinformation), and so forth.  While there are corners of the global Usenet that have ugly behavior, and news.quux.org being fundamentally a dumb machine that just copies data from point A to B means that you may encounter this, there is a also an effort to make more parts of the Internet a positive environment, and quux.org is part of that effort.  <a href="https://floss.social/terms">https://floss.social/terms</a> is an example of the kind of conduct we would like to see from articles you feed to us.  <strong>We want to be part of the solution, not part of the problem.</strong></p>
<ul>
<li>If you provide access to others in any way, whether by letting them access your server or by becoming NNCP peers with them, you need to make sure they understand their responsibilities on what gets injected to the globe via you, and be prepared to enforce standards of behavior.  You may, for instance, need to cut them off if they engage in objectionable behavior via your system.  Keep this in mind.</li>
<li>If persistent abuse occurs from your site which you are unable or unwilling to correct, or particularly egregious abuse occurs, your feed may be canceled.</li>
<li>You must have up-to-date contact information on file with me at quux, so that you can be reached in the event complaints are received about your site at quux.  The idea is to resolve things collaboratively so that feed interruption need not occur – but moreover, to prevent issues from occurring in the first place.</li>
<li>Also this service is all-volunteer without guarantee of correct operation or the continuing operation of any feed.</li>
</ul>
</li>
</ul>
<p>You should also be aware, in case you are planning to take your solar-powered Raspberry Pi with INN and NNCP with you on a 3-week hike across the remotest parts of Canada, writing articles to pass the time and posting them when you reach civilization, that most Usenet sites reject articles that reach them if they are older than a certain number of days.  For most, that number is 10, but it may be as little as 1 or 2 on some.  So if you are feeding data TO the Internet via quux, keep that in mind.  For data coming to YOU from quux, you can set the limit whatever you like (but the quux public relay may also auto-reap packets of advanced age that are bound to you).  So basically if you want to use this, checking in daily will probably work; weekly will probably usually work, and monthly will not.</p>
<h2 id="the-big-picture-how-it-works">The Big Picture: How it Works</h2>
<p>There are various Usenet servers; for this, we will use INN 2.6 (if you’re using Debian, the package name is inn2).</p>
<p>INN still has UUCP support.  NNCP presents an interface that is almost identical to UUCP, so we will be generally configuring INN as if it’s exchanging articles by UUCP.</p>
<p>Here’s how INN generally works in a UUCP/NNCP scenario:</p>
<ul>
<li>Incoming articles from news.quux.org are fed from the tosser (nncp-toss, which replaces  uuxqt from UUCP) to a program called rnews, which is part of the INN distribution and injects them into the local server.</li>
<li>For articles you feed to quux, INN maintains a small file with information about them – basically a “storage token” to find them on disk and a size.  From cron, send-uucp (also part of INN) goes through those INN files and generates batches of articles to be sent to quux’s rnews via NNCP, using nncp-exec (NNCP’s version of UUCP’s uux).</li>
</ul>
<p>This is basically using a tried-and-true method that has worked with INN’s UUCP support for decades.  All we are doing is substituting NNCP for the UUCP layer.  We are not using NNCP’s multicast areas for this; see the conversation below about this.</p>
<h2 id="planning">Planning</h2>
<p>Before getting started, you need to think about a few things.</p>
<h3 id="your-usenet-hostname">Your Usenet hostname</h3>
<p>The Usenet hostname you set is a vital part of preventing routing loops and duplicate messages on Usenet.  It does not have to be a valid Internet hostname (though it often is).  It does have to be globally unique, and it also ought to serve to identify your system.</p>
<p>If you already own a DNS domain, you could use something under that.  For instance, if you have registered example.com, you might consider news.nncp.example.com.  It is fine if <code>news.nncp.example.com</code> doesn’t resolve in DNS; it just needs to not be used for something else.</p>
<p>If you don’t own a DNS domain, then you may have to make something up, perhaps ending in <code>.nncp</code>.  For instance, <code>news.smith.newark.nj.us.nncp</code> or something.  Visit with me about this if you like.  The key is that there must be no chance of an accidental use of the same name by some other system anywhere on the planet.</p>
<p>You will add this to the “pathhost” line in inn.conf, and also to the “ME” line in newsfeeds.</p>
<h3 id="what-newsgroups">What newsgroups?</h3>
<p>You can opt to carry a “full feed” from quux - that is, basically everything that transits quux will be sent to you.  The concept of “everything” is a little different at each site due to things like spam filters.</p>
<p>Or, you can opt to carry a handful of specific newsgroups – say, <code>comp.mail.uucp</code>.  Or an entire hierarchy; say, <code>comp.*</code> or <code>comp.mail.*</code>.  These can be changed later, but do require manual config file editing on my part, so be aware that a change doesn’t happen instantly.</p>
<p>New newsgroups are often created (or added to quux because a new feed is added which carries them).</p>
<p>You can get a sense of what newsgroups are out there by looking at the ISC’s files at <a href="ftp://ftp.isc.org/pub/usenet/CONFIG">ftp://ftp.isc.org/pub/usenet/CONFIG</a> .  The file <code>active</code> in that directory contains a list of every newsgroup believed to be active at ISC.  The file <code>newsgroups</code> contains descriptions for many, but not all, newsgroups.  Be aware that the actual set of carried newsgroups varies from site to site, particularly for <code>alt.*</code> which lacks a formal process for authorizing new groups.</p>
<p>Some newsgroups are <em>moderated</em>; that is, you can’t post directly to them.  When you attempt to post to a moderated group, INN will actually submit your post via email to the moderator, rather than post it to Usenet.  Therefore, if you intend to post to a moderated group, you will require working email service on your Usenet server.  Moderated newsgroups today are often quite low-traffic and rarely posted to by the public.  You can identify a moderated group because, in the active file from ISC, the line ends with <code>m</code> instead of <code>y</code>.</p>
<h3 id="send-your-request">Send your request</h3>
<p>Send your peering request to me, <a href="mailto:jgoerzen@complete.org">jgoerzen@complete.org</a>.  If you haven’t already, make sure you include your information for the public relay nodelist.  Also include your selected hostname and the names of the newsgroups you want to use.</p>
<h2 id="setting-up-nncp">Setting up NNCP</h2>
<p>OK, let’s begin!  This is the easy part.  First, you need to have done the setup for the <a href="https://www.complete.org/quux-org-nncp-public-relay/">quux.org NNCP public relay</a>, which will have included adding the quux definition to your nncp.hjson.</p>
<p>Then, you need to note the quux news server in your nncp.hjson’s neigh section:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>    news.quux.org: {
</span></span><span><span>      id: 6QVFU7QIHQNI6TWNRK7OAJUUBDZT262XX3I5YHGZOGLTVYOQM47Q
</span></span><span><span>      exchpub: DBHZYJFEXNGJ5UFC6TZVYRAAAKKKVLT3DAAXCQXZZYERXPLLEQIQ
</span></span><span><span>      signpub: OKFURSS5YFXUEEPYCAEGPBIPZDHDBISNJA47LHGMVECH6KC5PEWA
</span></span><span><span>      noisepub: ZXEYBPZN5WAI4674NBF5ZRX6ZG7YEILVMRDGQT3NWHA7Q5ZMXQXQ
</span></span><span><span>      via: [&#34;quux&#34;]
</span></span><span><span>      incoming: &#34;/tmp&#34;  # or more appropriate path; only if you intend to freq active from news.quux.org
</span></span><span><span>      exec: {
</span></span><span><span>        rnews: [&#34;/usr/bin/rnews&#34;, &#34;-h&#34;, &#34;news.quux.org&#34;]
</span></span><span><span>      }
</span></span><span><span>    }
</span></span></code></pre></div><p>Here you have set up NNCP so that rnews can be executed to process incoming packets from quux.  As a further exercise for added security, you should wrap it with a script that prevents any further arguments to rnews (since NNCP otherwise permits that), but this simple example gets you started.</p>
<p>Now, we need a script to act as a plug-in replacement for <code>uux</code>.  This is what INN will call to submit the articles you write back to quux.  Put this in <code>/usr/local/bin/nncp-uux</code>:</p>
<div><pre tabindex="0"><code data-lang="sh"><span><span><span>#!/usr/bin/env bash
</span></span></span><span><span><span></span>
</span></span><span><span><span>set</span> -eo pipefail
</span></span><span><span>
</span></span><span><span><span>while</span> <span>[</span> -n <span>&#34;</span><span>$1</span><span>&#34;</span> <span>]</span><span>;</span> <span>do</span>
</span></span><span><span>    <span>if</span> <span>echo</span> <span>&#34;</span><span>$1</span><span>&#34;</span> <span>|</span> grep -q <span>&#34;!rnews&#34;</span><span>;</span> <span>then</span>
</span></span><span><span>        <span>HOST</span><span>=</span><span>&#34;</span><span>$(</span><span>echo</span> <span>&#34;</span><span>$1</span><span>&#34;</span> <span>|</span> sed <span>&#39;s/!rnews//&#39;</span><span>)</span><span>&#34;</span>
</span></span><span><span>        <span># This exec will terminate the script here</span>
</span></span><span><span>        <span>exec</span> /usr/local/bin/nncp-exec -quiet <span>&#34;</span><span>$HOST</span><span>&#34;</span> rnews
</span></span><span><span>    <span>fi</span>
</span></span><span><span>    <span>shift</span>
</span></span><span><span><span>done</span>
</span></span><span><span>
</span></span><span><span><span>echo</span> <span>&#34;Couldn&#39;t find valid host&#34;</span>
</span></span><span><span><span>exit</span> <span>5</span>
</span></span></code></pre></div><p>And, of course, <code>chmod a+x /usr/local/bin/nncp-uux</code> and, if your nncp-exec isn’t in <code>/usr/local/bin</code>, fix that path.  INN’s <code>send-uucp</code> process will cause this thing to be invoked with a bunch of parameters, but most particularly one that’s <code>HOSTNAME!rnews</code>.  We extract that HOSTNAME as our nncp node name, and form the nncp-exec command from there.</p>
<p>The last remaining part is to allow the <code>news</code> user to queue up packets using <code>nncp-exec</code>.  There are three ways you can do that:</p>
<ul>
<li><a href="https://nncp.mirrors.quux.org/Administration.html#Shared-spool">NNCP’s shared spool</a> configuration.  You would need to add the <code>news</code> user to the <code>nncp</code> group for this one.  On Debian, <code>adduser news nncp</code> can do this.</li>
<li>Or, you can <a href="https://www.complete.org/using-nncp-with-sudo/">configure NNCP with sudo</a> to allow the <code>news</code> user to effectively run <code>sudo -u nncp nncp-exec</code>.</li>
<li>Simply run NNCP as the news user instead of a different user such as nncp.</li>
</ul>
<p>There is a similar part to allow NNCP to run rnews; you need to add nncp to the uucp group; <code>adduser nncp uucp</code> will do the trick on Debian.</p>
<p>What you do is up to you.  Allowing the news user permissions to NNCP does mean that it could access the NNCP private keys if there was a security breach in the INN process or something, but whether you care about that possibility is up to you.</p>
<p>It is not necessary to run <code>rnews</code> as the news user, since it feeds to INN by connecting to localhost:119.  But, by default it is only executable by the news user or uucp group, which is why we need NNCP to be running as either that user or that group.</p>
<p>That’s it.  You’re done configuring NNCP!</p>
<h2 id="getting-started-with-inn">Getting started with INN</h2>
<p>For the purposes of easy conversation, this document will cover INN 2.6.4 as distributed in Debian 11 (bullseye).  Path names will differ on other systems, but the concepts should be the same.</p>
<p>This document is not a substitute for the <a href="https://www.eyrie.org/~eagle/software/inn/">proper INN documentation</a>.  In particular, consult the <a href="https://www.eyrie.org/~eagle/software/inn/docs-2.6/install.html">INSTALL</a> file, the <a href="https://www.eyrie.org/~eagle/software/inn/docs-2.6/checklist.html">checklist</a>, and the <a href="https://www.eyrie.org/~eagle/software/inn/docs-2.6/">documentation for each config file and program</a>.  I am going to highlight some steps, but this is <em>not</em> a comprehensive INN installation document!</p>
<p>First, install INN: <code>apt-get install inn2 inn2-inews</code>.  (the inn2-inews package includes rnews)</p>
<p>The INN configuration files live in <code>/etc/news</code>.  You’ll usually edit them as root, but all other actions should be run as the <code>news</code> user, which you can enter with <code>su -s /bin/bash - news</code>.</p>
<p>Although you can reload certain INN config files via <code>ctlinnd</code>, the easiest way to make changes take effect is with <code>systemctl restart inn2</code>.</p>
<h3 id="inn-dot-conf">inn.conf</h3>
<p><a href="https://www.eyrie.org/~eagle/software/inn/docs-2.6/inn.conf.html">inn.conf</a> has some critical settings.  You’ll want to set something sensible for organization.  The hostname you’ve chosen goes in pathhost.</p>
<p>You will probably want to set <code>innflags: &#34;-C&#34;</code> to disable processing of cancel messages unless you obtain more advanced processing (which is outside the scope of this document).</p>
<p>Depending on your circumstances, you may wish to set <code>addinjectionpostinghost</code> to false for privacy reasons.</p>
<p>You should put your valid e-mail address for <code>complaints</code>, which is part of the <code>Injection-Info</code> header.</p>
<p>Many sites will also need to set <code>domain:</code> to be the domain part of your pathhost.  That is, if your pathhost is “foo.bar.baz.example.com”, then domain is “bar.baz.example.com”.</p>
<h3 id="expire-dot-ctl">expire.ctl</h3>
<p><a href="https://www.eyrie.org/~eagle/software/inn/docs-2.6/expire.ctl.html">expire.ctl</a> defines how long old articles are kept around.  By default, they’re generally kept for 15 days.  See the comments in this file if you want to keep them for a longer or shorter time.  It is not necessary to modify this file.</p>
<h3 id="newsfeeds">newsfeeds</h3>
<p>In <a href="https://www.eyrie.org/~eagle/software/inn/docs-2.6/newsfeeds.html">newsfeeds</a>, you need to edit the “ME” line to exclude your own hostname (pathhost).  Add <code>/PATHHOST</code> after “ME”, so it reads like this:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>ME/my.pathhost.value.goes.here:!*/!local,!collabra-internal::
</span></span></code></pre></div><p>We will do some more work in this file later.</p>
<h2 id="creating-newsgroups">Creating newsgroups</h2>
<p>Now that you have done the basics, it’s time to create some newsgroups.  How you will do that will depend on whether you are grabbing a few newsgroups or thousands.</p>
<h3 id="a-small-feed-with-a-few-newsgroups">A small feed with a few newsgroups</h3>
<p>In this scenario, you can manually create each relevant newsgroup.  Say you wanted to add <code>comp.misc.fakegroup</code>, as unmoderated.  You would run:</p>
<p><code>/usr/lib/news/bin/ctlinnd newgroup comp.misc.fakegroup y</code></p>
<p>If it was moderated, you’d use <code>m</code> instead of <code>y</code>.  That’s it.  You’re done.</p>
<h3 id="a-large-feed-with-tons-of-newsgroups">A large feed with tons of newsgroups</h3>
<p>In this case, you will need to use some automated mechanism to create your local newsgroups.  First, request <code>active</code> from news.quux.org:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>nncp-freq news.quux.org:active
</span></span></code></pre></div><p>Once that file is delivered, you can use actsync to process it.</p>
<h4 id="setting-up-actsync-dot-ign">Setting up actsync.ign</h4>
<p>Edit actsync.ign.  By default, it’s set up to just bring in the 8 “major” news hierarchies.  That’s probably reasonable to start.  If you want to just take everything quux has, add <code>c *</code> after the example lines.  Then run:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>/usr/lib/news/bin/actsync -p 0 -v 2 -i /etc/news/actsync.ign localhost \
</span></span><span><span>  /var/local/nncp-incoming/news.quux.org/active &gt; /tmp/foo
</span></span></code></pre></div><p>This <code>nncp-incoming</code> path is the location where the active file you freq’d appears (don’t forget to chown it to news before you run this command, if needed).  Now, inspect /tmp/foo.  You might make sure there are no unexpected <code>rmgroup</code> commands (which would remove groups).  If you’re satisfied, then run:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>/usr/lib/news/bin/mod-active /tmp/foo
</span></span></code></pre></div><h2 id="configuring-inn-for-nncp">Configuring INN for NNCP</h2>
<p>Remember, the INN configuration is in <code>/etc/news</code>.</p>
<h3 id="send-uucp-dot-cf">send-uucp.cf</h3>
<p>We’re going to set up INN’s <a href="https://www.eyrie.org/~eagle/software/inn/docs-2.6/send-uucp.html">send-uucp</a> for our purposes.  This is what configures INN for sending outbound articles you write to quux.  Add a line for quux like this:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>news.quux.org          none      52428800
</span></span></code></pre></div><p>This defines that you will send to quux, without compression, with a maximum size of 50MB per batch.  We turn off compression here because NNCP has built-in compression that is better anyway, and running through two compressors just wastes CPU power.  send-uucp will start a new batch if any one batch exceeds 50MB in size.  A batch is one or more articles that are combined into a single nncp-exec invocation.</p>
<h3 id="newsfeeds-for-quux">newsfeeds for quux</h3>
<p>Now, in <code>newsfeeds</code>, you need to add an entry for quux like so:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>news.quux.org\
</span></span><span><span>   :*,\
</span></span><span><span>   !*.bina*,!*.bain*,!*.dateien*,!*.pictures*,!junk/!local\
</span></span><span><span>   :Tf,Wnb,B4096/1024:
</span></span></code></pre></div><p>Here’s a <strong>very important note</strong>: make sure there isn’t a space at the end of that line.  If there is, it will take the space to be the name of the file it should create in <code>/var/spool/news/outgoing</code> and that will mess everything up.</p>
<p>If you are taking only a subset of newsgroups, you will want to modify this accordingly to send only the desired messages to quux.</p>
<p>Also, remember to modify the “ME” line as described above.</p>
<h3 id="innshellvars-dot-pl-dot-local">innshellvars.pl.local</h3>
<p>Next, we’re going to tell INN to use our fake uux instead of UUCP’s.  Add this to innshellvars.pl.local:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>$uux = &#39;/usr/local/bin/nncp-uux&#39;;
</span></span></code></pre></div><p>Now, INN’s Perl config system in <code>/usr/share/perl5/INN/Config.pm</code> won’t actually use this file unless it’s marked executable.  So:</p>
<p><code>chmod a+x innshellvars.pl.local</code></p>
<h3 id="testing-it-out">Testing it out</h3>
<p>Now, make a test post somewhere.  Then let’s see if we can generate outbound packets.</p>
<p>First, become the news user: <code>su -s /bin/bash - news</code>.</p>
<p>Then run <code>/usr/lib/news/bin/send-uucp</code>.  With any luck, <code>nncp-stat</code> should show an outbound packet generated!</p>
<h3 id="adding-cron">Adding cron</h3>
<p>Now you can set up cron for send-uucp.  Something like this in /etc/cron.d/local-send-uucp will do the trick:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>PATH=/usr/lib/news/bin:/sbin:/bin:/usr/sbin:/usr/bin
</span></span><span><span>20,50 * * * *   news    /usr/lib/news/bin/send-uucp
</span></span></code></pre></div><h3 id="submitting-to-the-usenet-top-1000-project--optional">Submitting to the Usenet Top 1000 project (optional)</h3>
<p>The <a href="http://top1000.anthologeek.net/">Usenet Top 1000</a> project tracks the top 1000 Usenet servers on the Internet.  It does this by receiving automated reports from participating administrators of the articles that pass through their site - and, critically, information about the Path header in each article that indicates where in the globe it traversed.</p>
<p>Your participation helps in several ways:</p>
<ul>
<li>Helps me understand how important, or not, this service is – and, by extension, the other peers of news.quux.org.</li>
<li>Helps the Usenet community understand traffic flow patterns.</li>
<li>Is a way of sort of “casting a vote” for certain helpful peers.</li>
</ul>
<p>Once INN is set up and working, the only requirement for participation is a working email system.  Reports are (these days) sent out daily.</p>
<p>To enable, first edit <code>newsfeeds</code> and add this line:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>inpaths!:*:Tc,WP:/usr/lib/news/bin/ginpaths2
</span></span></code></pre></div><p>Don’t forget to restart INN or issue <code>ctlinnd reload newsfeeds reason</code>.</p>
<p>Now, edit <code>/etc/cron.d/inn2</code> and find the “NINPATHS” section at the bottom.  Uncomment the two lines, and in the second line, change <code>1 * *</code> to <code>* * *</code> (that line dates from a time when people made monthly instead of daily reports).  The lines should now read:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>6 6	* * *	news	ctlinnd -s -t 60 flush inpaths!
</span></span><span><span>8 6	* * *	news	sendinpaths
</span></span></code></pre></div><p>That’s it.  Done!</p>
<h2 id="supporting-newsreaders--client-applications">Supporting newsreaders (client applications)</h2>
<p>By now, you should have your system fully armed and operational!  It should be able to send and receive news.  Except… you have no way to read it.  So let’s do that.</p>
<p>The file you will be interested in is <a href="https://www.eyrie.org/~eagle/software/inn/docs-2.6/readers.conf.html">readers.conf</a>.  By default, it will let you connect from localhost.  So, that may be enough for you!  You could install a reader like slrn over there and just ssh into your newsbox and read news there.</p>
<p>But let’s say you want to permit access from your LAN.  Then you need to support passwords.  Add this after the <code>auth &#34;localhost&#34;</code> block:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>auth &#34;authenticated&#34; {
</span></span><span><span>    hosts: &#34;192.168.0.0/16&#34;
</span></span><span><span>    auth: &#34;/usr/lib/news/bin/auth/passwd/ckpasswd -f /var/lib/news/newsusers&#34;
</span></span><span><span>}
</span></span><span><span>
</span></span><span><span>access &#34;authenticated&#34; {
</span></span><span><span>    newsgroups: &#34;*&#34;
</span></span><span><span>}
</span></span></code></pre></div><p>Of course, use the relevant netmask there.</p>
<p>Now you need to create the <code>/var/lib/news/newsusers</code> file.  On Debian, you will need to <code>apt-get install apache2-utils</code> to do this.</p>
<p>Now, <code>su -s /bin/bash - news</code> and run <code>htpasswd -c -d /var/lib/news/newsusers username</code>.  You can add more users also; just leave off the <code>-c</code> (since it means “create”).</p>
<p>If you’re going to use this on the public Internet – and I recommend you do <strong>NOT</strong> - but if you must, then you will certainly want to arrange to run a nnrpd with SSL and add <code>require_ssl: true</code> to the auth group.</p>
<h2 id="advanced-topics">Advanced topics</h2>
<h3 id="locking-down-rnews-invocation">Locking down rnews invocation</h3>
<p>NNCP permits the caller to specify parameters to the command lines of executed programs in nncp-exec.  To prevent callers from adding additional parameters to rnews - perhaps maliciously targeting other NNTP servers for instance - you could lock things down.  First, create this at <code>/usr/local/bin/restricted-rnews</code>:</p>
<div><pre tabindex="0"><code data-lang="sh"><span><span><span>set</span> -euo pipefail
</span></span><span><span><span>exec</span> /usr/bin/rnews -h <span>&#34;</span><span>$1</span><span>&#34;</span>
</span></span></code></pre></div><p>Now, your exec clause in nncp.hjson changes to:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>      exec: {
</span></span><span><span>        rnews: [&#34;/usr/local/bin/restricted-rnews&#34;, &#34;news.quux.org&#34;]
</span></span><span><span>      }
</span></span></code></pre></div><p>Since any other parameters would be added after the first one – the hostname you’ve given – they will be ignored here.</p>
<h2 id="anticipated-faqs">Anticipated FAQs</h2>
<h3 id="what-about-the-nncp-multicast-areas-feature">What about the NNCP multicast areas feature?</h3>
<p>Indeed, NNCP’s <a href="https://nncp.mirrors.quux.org/Multicast.html">multicast areas</a> feature is quite appealing.  You might rightly conclude that its algorithm for asynchronous distribution is quite similar to Usenet’s, but made more general so it can be used with anything.</p>
<p>It would, in fact, be quite possible to handle distribution via either a multicast area or direct feeds from INN like this document discusses.  I opted for direct feeds for two reasons:</p>
<ul>
<li>At the moment, when dealing with NNCP multicast areas, the rnews wrapper has no way to know which particular member node transmitted an exec request, reducing the usefulness of our security and logging practices.</li>
<li>While both approaches have ways to prevent duplicate re-injection and routing loops, it is best in this case to use INN’s, so that a situation in which an article may post to Usenet via NNCP, traverse Usenet using NNTP, then return back to NNCP could be detected in this way.</li>
</ul>
<h3 id="i-already-have-a-full-usenet-feed-dot-can-i-still-peer-with-you-using-nncp">I already have a full Usenet feed.  Can I still peer with you using NNCP?</h3>
<p>This is unlikely to be a great idea, because it would mostly be two systems sending each other articles that the other has already seen.  I’m willing to explore, but would probably prefer to peer with you over NNTP.</p>
<h3 id="how-often-does-quux-process-nncp-packets">How often does quux process NNCP packets?</h3>
<p>This information is subject to change.</p>
<p>At the moment, I am trying to strike a balance between quick turnaround, and not giving those that process news daily thousands of tiny packets to process.  Right now:</p>
<ul>
<li>news.quux.org calls quux public relay to exchange packets every 5 minutes.</li>
<li>NNCP outgoing batches are generated at :30 and :00.</li>
</ul>
<p>For most, calling the quux public relay at :20 and :50 would be the most expeditious way to get your local posts out.</p>
<h3 id="does-news-dot-quux-dot-org-directly-relay-traffic-between-different-nncp-peers">Does news.quux.org directly relay traffic between different NNCP peers?</h3>
<p>If two NNCP peers of news.quux.org carry a newsgroup, and one has a new post, it will be processed like this:</p>
<ol>
<li>The post flows to news.quux.org via NNCP.</li>
<li>When it is ingested into quux, it will be queued for transmission to all of quux’s peers, Internet and NNCP.</li>
<li>When the next set of outbound NNCP batches is run – generally 5 minutes after the incoming post is processed – the post will be included, along with a Path: entry reflecting that it passed through news.quux.org.  It is not necessary for the post to traverse the Internet to be included in packets for other quux NNCP peers.</li>
</ol>
<h3 id="where-can-i-get-a-newsgroups-file-for-my-server">Where can I get a newsgroups file for my server?</h3>
<p>From ftp.isc.org in /pub/usenet/CONFIG.</p>
<h3 id="how-long-has-quux-dot-org-been-around">How long has quux.org been around?</h3>
<p><a href="https://www.complete.org/quux-org/">quux.org</a> is one of two domains used for services I have long provided; the other, primary one, is complete.org.  They both run on the same hardware.  complete.org has had an Internet presence since 1995, but existed as a BBS before then.  The quux.org domain was registered in 2000.</p>
<h3 id="why-are-you-doing-this">Why are you doing this?</h3>
<p>Because:</p>
<ul>
<li>It’s fun.</li>
<li>It’s useful.</li>
<li>I see a lot of overlooked value in the technologies that were widely used at the beginning of the Internet. See <a href="https://www.complete.org/old-and-small-technology/">Old and Small Technology</a>.</li>
</ul>
<p>A few more words on that last one.  Today we see a lot of trouble with the giants that control the Internet: the Facebooks and the Youtubes of our time.  We see them promoting anything that drives people to spend time on their site – even if it is false and harmful – because spending time on their site is how they make money.  This has had real-world consequences, including deaths.</p>
<p>It’s not that Usenet was or is perfect.  After all, spam sort of started on Usenet.  Usenet has no central authority and is therefore anarchic in some ways.  This carries its own set of problems, but those problems are <em>different</em> than the ones at Facebook and Twitter.  At Facebook and Twitter, you get a highly curated experience – curated in a way that benefits the social media companies, not you.  With Usenet, you get an uncurated experience.  It may be better, it may be worse, but it is most definitely not <a href="https://www.complete.org/attention-economy/">exploiting your attention</a> for somebody else’s profit.</p>
<h3 id="are-there-any-guarantees-about-this-service">Are there any guarantees about this service?</h3>
<p>I hope to operate a useful service for a long time, but no, there are no guarantees.  This service is powered by goodwill and volunteer effort.  Part of the reason for the careful ToS for posts is because large corporations have the staff to deal with numerous complaints, but volunteers don’t.</p>
<p>But let’s have fun with this and do our part to make a better Internet and community!</p>
<hr/>
<h2 id="links-to-this-note">Links to this note</h2>
<ul>
<li><a href="https://www.complete.org/john-goerzen-s-software/">John Goerzen’s Software</a></li>
</ul>
<blockquote>
<p>This page gives you references to software by <a href="https://www.complete.org/john-goerzen/">John Goerzen</a>.</p>
</blockquote>
<ul>
<li><a href="https://www.complete.org/sites-and-services-hosted-at-complete-org/">Sites and Services Hosted at Complete.Org</a></li>
</ul>
<blockquote>
<p>These sites are hosted on the complete.org server.  Some are hosted with resources donated to non-profit organizations.</p>
</blockquote>
<ul>
<li><a href="https://www.complete.org/quux-org-usenet-nntp-and-nncp-peer/">Quux.Org Usenet NNTP and NNCP Peer</a></li>
</ul>
<blockquote>
<p>At <a href="https://www.complete.org/quux-org/">quux.org</a>, <a href="https://www.complete.org/john-goerzen/">I</a> operate a heavily-peered <a href="https://www.complete.org/usenet/">Usenet</a> server.  It peers with others on the Internet using conventional NNTP.  Moreover, I also offer partial and full <a href="https://www.complete.org/usenet-over-nncp/">Usenet over NNCP</a> feeds.  quux.org carries a full set of text newsgroups, and no binaries.</p>
</blockquote>
<ul>
<li><a href="https://www.complete.org/the-pc-internet-revolution-in-rural-america/">The PC &amp; Internet Revolution in Rural America</a></li>
</ul>
<blockquote>
<p>Inspired by several others (such as <a href="https://alexschroeder.ch/wiki/2021-11-14%5FThe%5Fearly%5Fyears%5Fon%5Fthe%5Fnet">Alex Schroeder’s post</a> and <a href="https://mastodon.online/@szczezuja/108902027541781265">Szczeżuja’s prompt</a>), as well as a desire to get this down for my kids, I figure it’s time to write a bit about living through the PC and Internet revolution where I did: outside a tiny town in rural Kansas.  And, as I’ve been back in that same area for the past 15 years, I reflect some on the challenges that continue to play out.</p>
</blockquote>
<ul>
<li><a href="https://www.complete.org/nncp/">NNCP</a></li>
</ul>
<blockquote>
<p>NNCP lets you securely send files, or request remote execution, between systems.  It uses <a href="https://www.complete.org/asynchronous-communication/">asynchronous communication</a>, so the source and destination need never be online simultaneously.  NNCP can route requests via intermediate devices – other NNCP nodes, USB sticks, tapes, radios, phones, cloud services, whatever – leading to a network that is highly resilient and flexible.  NNCP makes it much easier to communicate with devices that lack Internet connectivity, or have poor Internet.</p>
</blockquote>
<ul>
<li><a href="https://www.complete.org/ideas-for-nncp-projects/">Ideas for NNCP Projects</a></li>
</ul>
<blockquote>
<p>I sometimes see people read about <a href="https://www.complete.org/nncp/">NNCP</a> and wonder “This sounds great!  But… what can I do with it?”  This page aims to answer those questions.</p>
</blockquote>

      </article></div>
  </body>
</html>
