<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://2ality.com/2022/03/type-annotations-first-look.html">Original</a>
    <h1>First look: adding type annotations to JavaScript</h1>
    
    <div id="readability-page-1" class="page"><div><ul>
<li><strong>Update 2022-03-10:</strong> I’m quoting a few insightful tweets at the end of this blog post.</li>
</ul>
<hr/>
<p><a href="https://github.com/giltayar/proposal-types-as-comments/">The ECMAScript proposal “Types as comments”</a> (by Gil Tayar, Daniel Rosenwasser, Romulo Cintra, Rob Palmer, and others) is about adding type annotations to JavaScript (there is also <a href="https://devblogs.microsoft.com/typescript/a-proposal-for-type-syntax-in-javascript/">an accompanying blog post</a>).</p>
<p>Such type annotations would look similar to TypeScript’s and Flow’s annotations and are completely ignored at runtime.</p>
<p>In this blog post, I briefly explain how the proposed type annotations would work and then describe what I think about them.</p>
<!--more-->
<hr/>
<p><strong>Table of contents:</strong></p>
<nav><ul><li><a href="#how-do-the-proposed-type-annotations-work%3F">How do the proposed type annotations work?  </a></li><li><a href="#thoughts-on-adding-type-annotations-to-javascript">Thoughts on adding type annotations to JavaScript  </a><ul><li><a href="#my-thoughts">My thoughts  </a></li><li><a href="#thoughts-by-typescript-team-member-%40searyanc">Thoughts by TypeScript team member @SeaRyanC  </a></li><li><a href="#thoughts-by-former-typescript-team-member-%40orta">Thoughts by former TypeScript team member @orta  </a></li><li><a href="#tweets-by-various-people">Tweets by various people  </a></li></ul></li><li><a href="#further-reading">Further reading  </a></li></ul></nav><hr/>
<h2 id="how-do-the-proposed-type-annotations-work%3F">How do the proposed type annotations work?  <a href="#how-do-the-proposed-type-annotations-work%3F" aria-hidden="true">#</a></h2>
<p>This is an example:</p>
<pre><code><span><span>function</span> <span>add</span>(<span>x: number, y: number</span>) </span>{
  <span>return</span> x + y;
}
</code></pre>
<p>The parameters <code>x</code> and <code>y</code> have type annotations: The type <code>number</code>, separated by a colon.</p>
<p>This is how these annotations are handled:</p>
<ul>
<li>
<p>At runtime, JavaScript engines completely ignore them – as if they were comments.</p>
</li>
<li>
<p>At development time, type checkers can statically analyze the annotations and warn developers about potential issues.</p>
</li>
</ul>
<p>So far, we have only seen relatively simple type annotations. More complicated ones are also proposed – e.g.:</p>
<ul>
<li>Interfaces (<code>interface</code>)</li>
<li>Type aliases (<code>type</code>)</li>
<li>Type assertions (<code>as</code>)</li>
<li>Generic invocations (e.g. <code>add&lt;number&gt;(4, 5)</code>)</li>
<li>And more (<a href="https://github.com/giltayar/proposal-types-as-comments">see proposal</a>)</li>
</ul>
<h2 id="thoughts-on-adding-type-annotations-to-javascript">Thoughts on adding type annotations to JavaScript  <a href="#thoughts-on-adding-type-annotations-to-javascript" aria-hidden="true">#</a></h2>
<h3 id="my-thoughts">My thoughts  <a href="#my-thoughts" aria-hidden="true">#</a></h3>
<p>Upsides:</p>
<ul>
<li>
<p>Having a standard for type notations would be good and would make it easier for tooling and experiments in this field.</p>
</li>
<li>
<p>It would become possible to program (e.g.) TypeScript without compiling the source code. There would only be type checking at development time. This would considerably improve the development experience for statically typed JavaScript:</p>
<ul>
<li>No intermediate files would be needed for execution.
<ul>
<li>This would be especially useful on Node.js where you could run TypeScript files directly.</li>
</ul>
</li>
<li>No source maps would be needed to see the original source code while debugging.</li>
<li><code>.d.ts</code> files often won‘t be needed either.</li>
</ul>
<p>This development experience is similar to <a href="https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html">providing type information via JSDoc comments</a> – which is already a popular way of using TypeScript.</p>
</li>
</ul>
<p>Downsides:</p>
<ul>
<li>I like that right now, static typing systems such as TypeScript are completely optional layers on top of JavaScript and don’t add any complexity to JavaScript.</li>
<li>The proposal adds much new syntax to the language. Even if engines ignore it, they must still be able to parse it. Upgrading JavaScript tools will take time and effort.</li>
<li>If TypeScript (etc.) aren’t compiled to JavaScript before deploying libraries to npm, browsing source code written by TypeScript developers will become less pleasant for people who don’t like TypeScript.
<ul>
<li>To help with this, removing all type annotations from a file might become an operation supported by text editors.</li>
</ul>
</li>
</ul>
<p>Various thoughts:</p>
<ul>
<li>Python’s <a href="https://docs.python.org/3/library/typing.html"><em>type hints</em></a> are similar to the proposal.</li>
<li>How would the proposal affect Deno? Does it provide any benefits for its TypeScript-centric approach?</li>
<li>The value of minification would grow for type-annotated code: more saved storage space and a bigger increase in parsing speed.</li>
<li>Using TypeScript as a strict superset of JavaScript would probably become even more popular than it already is. That means: no enums, no TypeScript-style decorators (but there is <a href="https://github.com/tc39/proposal-decorators">a proposal to add slightly different ones to JavaScript</a>), etc.</li>
</ul>
<p>I can understand if JavaScript developers are afraid of TypeScript taking over their language. However, this proposal will be as far as things will go w.r.t. adding TypeScript features to JavaScript. From the viewpoint of JavaScript engines, type annotations will be more like comments.</p>
<p>What are your thoughts? Let us know in the comments!</p>
<h3 id="thoughts-by-typescript-team-member-%40searyanc">Thoughts by TypeScript team member <code>@SeaRyanC</code>  <a href="#thoughts-by-typescript-team-member-%40searyanc" aria-hidden="true">#</a></h3>
<p>[Source: <a href="https://twitter.com/SeaRyanC/status/1501645753730560000">tweet thread</a>]</p>
<p>Here’s one way to think about this.</p>
<p>Would you ever intentionally <em>ship</em> unminified JS to your production website? Probably not</p>
<p>Do you <em>write</em> minified code today? Definitely not.</p>
<p>But is it useful to be able to <em>run</em> unminified code? Extremely!</p>
<p>Removing type annotations is the same thing. And just like your lint rules might enforce a style guide, your choice of type checker can validate type annotations you write.</p>
<p>Runtimes ignore both style and type “errors”, both of which vanish completely in minfication.</p>
<p>You could imagine a world where JS didn’t allow indentation. We’d probably write a compile-to-JS language (or many) that allowed indentation, maybe with style rules.</p>
<p>“Indentation in the browser” would be the idea of just allowing indentation, not re-implementing those style rules.</p>
<h3 id="thoughts-by-former-typescript-team-member-%40orta">Thoughts by former TypeScript team member <code>@orta</code>  <a href="#thoughts-by-former-typescript-team-member-%40orta" aria-hidden="true">#</a></h3>
<p>[Source: <a href="https://twitter.com/orta/status/1501855600346640384">tweet thread</a>]</p>
<p>One angle I don’t think people have explored when thinking about ‘Types As Comments’ is how much modern JS development has moved to a ‘soft fork’ of the JS language for types/tools.</p>
<p>‘Types as Comments’ would allow a lot of TS codebases to move back towards alignment with JS.</p>
<p>The TS design goals are set up to ensure that TypeScript stays as an non-hostile ‘soft fork’ of the language, thus ‘JS + types’ as the one-liner. Now with ‘Types as Comments’ allowing for ‘types in JS’ to not be a fork but a legit subset instead of superset.</p>
<h3 id="tweets-by-various-people">Tweets by various people  <a href="#tweets-by-various-people" aria-hidden="true">#</a></h3>
<ul>
<li>
<p><a href="https://twitter.com/_nicojs/status/1501863594614480900"><code>@_nicojs</code></a>: “Reading through [the proposal], it is clear that this is not going to be easy. It’s mainly hard to decide <em>where type comments start and where they stop</em>.</p>
<p>For example: <code>function foo(bar: baz) {}</code> seems simple, but what about <code>function foo&lt;bar&gt;(baz: { qux: corge }) {}</code>?</p>
<p>[...]</p>
<p>Did you know that  <a href="https://astexplorer.net/#/gist/26322f5cc19f444a015a3966a1710f70/68c4d48f7da111dd13a7438bfa66667b7fcfca33"><code>add&lt;number&gt;(4, 5)</code></a> is <em>valid JS</em>? It makes sense when you think about it, just never did.”</p>
</li>
<li>
<p><a href="https://twitter.com/alexandereardon/status/1501768797501341699"><code>@alexandereardon</code></a>: “If I worked on a compiler and I was tasked with making things faster, I would be reaching for those annotations to help pre-optimise code as much as I could!”</p>
<ul>
<li>Given that <a href="https://2ality.com/2013/02/asm-js.html">asm.js</a> and AssemblyScript use type declarations to produce faster code, this idea seems plausible.</li>
</ul>
</li>
<li>
<p><a href="https://twitter.com/AndaristRake/status/1501679269554139137"><code>@AndaristRake</code></a>: “The only benefit from my PoV is that I would be able to copy my TS code and evaluate it quickly in a console etc, without stripping the types first.”</p>
</li>
</ul>
<h2 id="further-reading">Further reading  <a href="#further-reading" aria-hidden="true">#</a></h2>
<ul>
<li>
<p>A quick introduction to TypeScript’s type notation: <a href="https://exploringjs.com/tackling-ts/ch_typescript-essentials.html">chapter “The essentials of TypeScript”</a> in “Tackling TypeScript”</p>
</li>
<li>
<p>Using TypeScript via JSDoc comments and pure JavaScript: <a href="https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html">“JSDoc reference”</a> in the TypeScript handbook</p>
</li>
<li>
<p>Blog post: <a href="https://devblogs.microsoft.com/typescript/a-proposal-for-type-syntax-in-javascript/">“A proposal for type syntax in JavaScript”</a> by Daniel Rosenwasser</p>
</li>
<li>
<p>ECMAScript poposal: <a href="https://github.com/giltayar/proposal-types-as-comments">“Types as comments”</a> by Gil Tayar, Daniel Rosenwasser, Romulo Cintra, Rob Palmer, and others</p>
</li>
</ul>
</div></div>
  </body>
</html>
