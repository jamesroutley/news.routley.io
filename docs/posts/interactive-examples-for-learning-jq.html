<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ishan.page/blog/2023-11-06-jq-by-example/">Original</a>
    <h1>Interactive examples for learning jq</h1>
    
    <div id="readability-page-1" class="page"><section>
    
    
    <blockquote>
<p>Cover Photo by <a href="https://www.pexels.com/photo/airport-bank-board-business-534216/" target="_blank" rel="noopener">Pixabay</a></p>
</blockquote>

<p>Has this ever happened to you?</p>
<p>Youâ€™ve just received a massive JSON file that looks like it was designed to confuse you. Or maybe you entered a command, and you got so much JSON that it looks incomprehensible.</p>
<p>The data you need is buried inside, and youâ€™re dreading the hours itâ€™ll take to extract and clean it up.</p>
<p>Iâ€™ve been there. Iâ€™ve <code>grep</code>ped my way through JSON and written ad-hoc Python scripts to process it for me.</p>
<p>But things donâ€™t have to be like this.</p>
<h2 id="introduction">Introduction</h2>
<p><code>jq</code> is one of the best-kept secrets in the data processing world.</p>
<p>Here are some scenarios where <code>jq</code> could swoop in to save your day (and saves mine regularly):</p>
<ol>
<li>
<p>Integrating with APIs in shell scripts often means handling JSON responses, requiring data extraction and manipulation.</p>
</li>
<li>
<p>Data from different sources may need to be converted to or from JSON format for compatibility.</p>
</li>
<li>
<p>Managing software configuration files in JSON format can be a regular task.</p>
</li>
<li>
<p>Extracting data from websites often results in dealing with JSON data that requires parsing and filtering.</p>
</li>
<li>
<p>Server logs and monitoring data often use JSON, necessitating parsing and analysis.</p>
</li>
<li>
<p>Infra as Code tools like Ansible and Terraform use JSON-like configurations, requiring management. JSON is a subset of YAML, so every valid JSON file is also a valid YAML file.</p>
</li>
</ol>
<p>All examples are <em>âœ¨fully interactiveâœ¨</em>, so I encourage you to play around!</p>
<p>Letâ€™s dive in! Weâ€™ll start off easy, and get slowly deeper into the weeds.</p>
<h2 id="basic-operations">Basic Operations</h2>
<h3 id="selecting-values">Selecting values</h3>
<p>Everything in <code>jq</code> is a filter. The dot <code>.</code> is used to select the current object or element, and we can put the property name after it to access a key from an object:</p>


<h3 id="filtering-arrays">Filtering Arrays</h3>
<p>The <code>.[]</code> notation is used to iterate over the elements of an array in a JSON document. It allows you to access each element of an array and perform operations on them.</p>
<p>The <code>select()</code> function is used to filter JSON data based on a specified condition or criteria. It is a powerful tool for extracting specific elements from a JSON document that meet certain conditions.</p>
<p>Similiar to shell scripting, <code>jq</code> works on a pipes-and-filters manner. We use the <code>|</code> to send the data from one filter to the next.
<jq-view name="example2"></jq-view></p>

<h3 id="mapping-arrays">Mapping Arrays</h3>
<p>We can use the <code>map</code> function to run any operation on every element of the array and return a new array containing the outputs of that operation:
<jq-view name="example3"></jq-view></p>

<h3 id="combining-filters">Combining Filters</h3>
<p>The pipe operator <code>|</code> can be used to chain as many filters or functions as we want:
<jq-view name="example4"></jq-view></p>

<h3 id="splitting-strings">Splitting Strings</h3>
<p>We can use the <code>split()</code> function to a split a string on a particular separator character. </p>


<h3 id="conditional-logic">Conditional Logic</h3>
<p>We can use <code>if</code> to create expressions
<jq-view name="example6"></jq-view></p>

<h3 id="handling-null-values">Handling Null Values</h3>
<p>Null values can often mess up logic in our scripts, so we can filter them all out using <code>map</code> and <code>select</code>
<jq-view name="example17"></jq-view></p>

<h3 id="formatting-output">Formatting Output</h3>
<p>Sometimes we donâ€™t want JSON output. We want it in a particular string format.</p>

<h3 id="multiple-outputs">Multiple Outputs</h3>
<p>Curly braces create a new object, which we can use for multiple outputs:
<jq-view name="example5"></jq-view></p>

<h2 id="dealing-with-nested-items">Dealing with Nested Items</h2>
<p><img src="https://ishan.page/blog/2023-11-06-jq-by-example/russian_dolls.jpg" width="3500" height="2333" srcset="/blog/2023-11-06-jq-by-example/russian_dolls_hu3d03a01dcc18bc5be0e67db3d8d209a6_252781_480x0_resize_q75_box.jpg 480w, /blog/2023-11-06-jq-by-example/russian_dolls_hu3d03a01dcc18bc5be0e67db3d8d209a6_252781_1024x0_resize_q75_box.jpg 1024w" loading="lazy" data-flex-grow="150" data-flex-basis="360px"/></p>
<blockquote>
<p><a href="https://www.pexels.com/photo/two-yellow-and-red-ceramic-owl-figurines-4966180/" target="_blank" rel="noopener">Photo by cottonbro studio</a></p>
</blockquote>
<p>JSON is very commonly used to store nested objects, and we often need to traverse or manipulate such structures. <code>jq</code> gives us all the tools we need to make it easy:</p>
<h3 id="recursive-descent">Recursive Descent</h3>
<p>We can use <code>..</code> to recursively descend through a tree of an object.</p>


<h3 id="filtering-nested-arrays">Filtering Nested Arrays</h3>


<h3 id="flattening-nested-json-objects">Flattening Nested JSON Objects</h3>
<p>Often, we just want all the key-values, and flattening the object may be the most convenient way to go:</p>


<h3 id="recursive-object-manipulation">Recursive Object Manipulation</h3>
<p>We can use the <code>recurse</code> as well, to traverse a tree.
<jq-view name="example18"></jq-view></p>

<h3 id="complex-object-transformation">Complex Object Transformation</h3>


<h3 id="walk-through-object-and-apply-a-transformation-conditionally">Walk through object and apply a transformation conditionally</h3>
<p>The <code>walk()</code> function provides a convenient way to traverse a nested object and apply some transformation to it.
<jq-view name="example24"></jq-view></p>

<h2 id="statistical-operations">Statistical Operations</h2>
<p><img src="https://ishan.page/blog/2023-11-06-jq-by-example/stats.jpg" width="6016" height="4016" srcset="/blog/2023-11-06-jq-by-example/stats_hu3d03a01dcc18bc5be0e67db3d8d209a6_2144012_480x0_resize_q75_box.jpg 480w, /blog/2023-11-06-jq-by-example/stats_hu3d03a01dcc18bc5be0e67db3d8d209a6_2144012_1024x0_resize_q75_box.jpg 1024w" loading="lazy" data-flex-grow="149" data-flex-basis="359px"/></p>
<blockquote>
<p>Photo by <a href="https://www.pexels.com/photo/magnifying-glass-on-white-paper-with-statistical-data-5561913/" target="_blank" rel="noopener">Leeloo Thefirst</a></p>
</blockquote>
<p><code>jq</code> is incredibly handy for doing quick and dirty statistical analysis in the field. Hereâ€™s most of the common operations related to that</p>
<h3 id="sorting-arrays">Sorting Arrays</h3>
<p>Sorting an array is a basic operation that is useful for many things in statistics.
<jq-view name="example7"></jq-view></p>


<p>Extracting unique values from an array is another fairly basic operation that we need for many things.
<jq-view name="example12"></jq-view></p>

<h3 id="calculating-averages">Calculating Averages</h3>
<p>Calculating the mean or average of a dataset is a common statistical operation we may often need to do
<jq-view name="example20"></jq-view></p>

<h3 id="grouping-and-aggregating">Grouping and Aggregating</h3>
<p>We can group an array of objects by a particular key and get an aggregated value of the other keys fairly easily:
<jq-view name="example11"></jq-view></p>

<h3 id="filtering-after-aggregation">Filtering after Aggregation</h3>


<h3 id="custom-aggregation-with-reduce">Custom Aggregation with reduce</h3>
<p>We can also use <code>reduce</code> to perform a single-output aggregation from an array
<jq-view name="example23"></jq-view></p>

<h3 id="calculating-histogram-bins">Calculating Histogram Bins</h3>
<p>We may want to calculate a histogram from an array of data.
<jq-view name="example22"></jq-view></p>

<h2 id="other-common-operations">Other Common Operations</h2>
<p>These are some other common operations I frequently find myself doing every day, but I couldnâ€™t think of a better way to categorize them.</p>

<p>We can combine multiple conditions in a <code>select</code> call. The <code>test()</code> function is used to check if the passed string contains one of the substrings or not.
<jq-view name="example15"></jq-view></p>

<h3 id="formatting-unix-timestamps">Formatting Unix Timestamps</h3>
<p>Various tools emit Unix Timestamps, and we can use the handy <code>strftime</code> function to format it so itâ€™s easier to understand at a glace.
<jq-view name="example16"></jq-view></p>

<h3 id="enumerating-by-top-level-key-and-value">Enumerating by Top Level Key and Value</h3>


<h2 id="closing-thoughts">Closing Thoughts</h2>
<p>Whew! Thatâ€™s been a long article ðŸ˜… If youâ€™re still here, then I appreciate you staying till the very end.</p>
<p>I hope youâ€™ve learned something new, and that youâ€™ll be able to quickly identify use cases for <code>jq</code> in your current workflow and apply your learnings there.</p>
<h3 id="how-does-this-article-work">How Does This Article Work?</h3>
<ul>
<li>I have used web components to create a custom component <code>&lt;jq-view&gt;</code>.</li>
<li>There is some Javascript in this page which renders all the <code>&lt;jq-view&gt;</code>s when the page is loaded.</li>
<li>The WebAssembly build of <code>jq</code>, as well as all the code for calling out to it is provided by BioWasm.</li>
<li>I have used AlpineJs to make the examples interactive. When the button is clicked, it sends an event to a listener, which makes it run <code>jq</code> and then update the output.</li>
<li>Since I am not good at front-end, this was a substantial learning experience for me.</li>
</ul>
<h3 id="get-in-touch">Get In Touch</h3>
<p>If you have any suggestions on how this may be improved, errors that I might have made, or you just want to discuss any other topic, please feel free to <a href="mailto:ishan.dassharma1@gmail.com">email me</a>. I always love to hear from you.</p>

<p><a href="https://jqlang.github.io/jq/manual/" target="_blank" rel="noopener">JQ Manual</a></p>

</section></div>
  </body>
</html>
