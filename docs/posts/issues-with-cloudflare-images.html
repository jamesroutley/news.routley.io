<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.klungo.no/2021/12/07/cloudflare-images-has-a-lot-of-issues/">Original</a>
    <h1>Issues with Cloudflare Images</h1>
    
    <div id="readability-page-1" class="page"><div><p>I’m a huge fan of the various Cloudflare offerings, and have been impressed time after time with the innovations and solutions offered by CF. This writeup therefore pains me, as I usually don’t have anything negative to say about CF, but after some months in <em>production</em>, and a severe lack of any meaningful reply from the CF Images team addressing any of these concerns (you won’t find a single official response in any of the linked community posts), I find it necessary to inform about some aspects of CF Images that I frankly find both surprising, concerning and disappointing. I will update this list when issues have been addressed.</p>
<h2 id="Issues"><a href="#Issues"></a>Issues</h2>
<h3 id="1-Incredibly-confusing-and-nonsensical-pricing-in-a-CF-context"><a href="#1-Incredibly-confusing-and-nonsensical-pricing-in-a-CF-context"></a>1. Incredibly confusing and nonsensical pricing in a CF context</h3>
<p>Links: <a href="https://blog.cloudflare.com/announcing-cloudflare-images/#eliminate-egress-costs">“Cloudflare Images Now Available to Everyone”</a>, <a href="https://blog.cloudflare.com/aws-egregious-egress/">“AWS’s Egregious Egress”</a>, <a href="https://www.cloudflare.com/bandwidth-alliance/">“Bandwidth Alliance”</a>, <a href="https://community.cloudflare.com/t/am-i-charged-for-cloudflare-images-if-the-image-would-otherwise-be-cached-by-cf-caching-rules/305727">Community post 1</a>, <a href="https://community.cloudflare.com/t/billing-how-is-images-served-calculated/317899">Community post 2</a>, <a href="https://community.cloudflare.com/t/cloudflare-images-delivery-pricing-is-based-on-no-of-time-requested/319015">Community post 3</a>, <a href="https://community.cloudflare.com/t/image-resizing-cached-requests-counted-as-well/327571">Community post 4</a></p>
<p>CF has a track record of creating services that both work incredibly well, in addition to being supremely cost-effective. Furthermore, they seem to be on a mission to eliminate egress fees with the “Bandwidth Alliance”, while also making direct statements towards AWS for their “Egregious Egress”, and in the product announcement for CF Images they write this (emphasis mine):</p>
<blockquote>
<p>Egress cost is the cost of getting your data out of a storage provider. The most common case being when you serve an image from storage you pay for the bits transmitted. <strong>And you end up paying every, single time that same image is displayed.</strong></p>
</blockquote>
<p>The thing is, with CF Images you <strong><em>do</em> end up paying every, single time that same image is displayed</strong>, as the pricing clearly states literally 2 paragraphs later (emphasis mine):</p>
<blockquote>
<p>You pay $5/month for every 100,000 stored images and <strong>$1 per 100,000 delivered images</strong></p>
</blockquote>
<p>To add insult to injury, one can only assume that requests hitting the CDN also counts, as it’s still a “delivered image”, and they nowhere mention that this isn’t the case. Not only this, but since you pay <em>per image</em> instead of for bandwidth, you will end up paying <em>more</em> for small images (eg. 50kB = $0.20 per GB) than you would using AWS.</p>
<h3 id="2-No-way-to-track-how-many-images-has-been-served"><a href="#2-No-way-to-track-how-many-images-has-been-served"></a>2. No way to track how many images has been served</h3>
<p>Links: <a href="https://community.cloudflare.com/t/seeing-how-many-images-has-been-served-so-far/322725">Community post 1 (by me)</a>, <a href="https://community.cloudflare.com/t/where-can-we-follow-the-consumption-of-image-requests/326868">Community post 2</a>, <a href="https://community.cloudflare.com/t/how-to-view-cloudflare-images-delivered-usage/328994">Community post 3</a></p>
<p>You’re given a clear overview of how many images you have uploaded, but unlike with eg. CF Workers, there is no way to tell how many requests have been made, other than the line item when the invoice arrives. The one tool you have to get <em>some</em> information about this, is setting up usage notifications/alerts at certain thresholds, but this quickly becomes spammy if you want fine-grained information.</p>
<h3 id="3-No-way-to-retrieve-original-image"><a href="#3-No-way-to-retrieve-original-image"></a>3. No way to retrieve original image</h3>
<p>Links: <a href="https://community.cloudflare.com/t/cloudflare-images-retrieve-the-original-file-upload/317897">Community Post</a>, <a href="https://blog.cloudflare.com/aws-egregious-egress/">“AWS’s Egregious Egress”</a></p>
<p>The heading says it all. There is currently no way at all to retrieve the original and unmodified file, meaning you also have <strong>no way</strong> to migrate to another platform if you want. In the CF post “AWS’s Egregious Egress” linked above, they write this:</p>
<blockquote>
<p>The only rationale we can reasonably come up with for AWS’s egress pricing: locking customers into their cloud, and making it prohibitively expensive to get customer data back out. So much for being customer-first.</p>
</blockquote>
<p>Since there is no way to retrieve the original image from CF Images, customers are completely locked into their cloud. Even worse than AWS, where it’s “prohibitively expensive” to get your data, it’s actually impossible to get data back out from CF Images.</p>

<p>Links: <a href="https://community.cloudflare.com/t/how-can-i-configure-cors-policies-on-cloudflare-images/314481">Community post 1</a>, <a href="https://community.cloudflare.com/t/downloading-image-on-client-side-is-giving-cors-error/313317">Community post 2</a>, <a href="https://community.cloudflare.com/t/cloudflare-images-cors-error-when-loading-via-javascript/312609">Community Post 3</a></p>
<p>All images served through CF Images for some reason lack a CORS header, meaning that you cannot do things like using them on a canvas, in a WebGL context, or an anchor tag with the <code>download</code> attribute. This seems like a strange oversight.</p>
<p>In cases where you are serving images to only your own domain, Images can now be served directly from your custom domain. <a href="https://my.domain/cdn-cgi/imagedelivery/">https://my.domain/cdn-cgi/imagedelivery/</a><path> where PATH is the path you usually use on <a href="http://imagedelivery.net">imagedelivery.net</a>.</path></p>
<p><a href="https://developers.cloudflare.com/images/cloudflare-images/serve-images#serving-images-from-custom-domains">https://developers.cloudflare.com/images/cloudflare-images/serve-images#serving-images-from-custom-domains</a></p>
<p>If you need to serve images to other or unknown domains, you will need to bypass this yourself with something like a CF Worker.</p>
<h3 id="5-Lack-of-dynamic-resizing-only-20-“variants”-allowed"><a href="#5-Lack-of-dynamic-resizing-only-20-“variants”-allowed"></a>5. Lack of dynamic resizing, only 20 “variants” allowed</h3>
<p>Links: <a href="https://community.cloudflare.com/t/i-need-more-variants-in-image-service/324776">Community post</a></p>
<p>For whatever reason, CF Images is limited to 20 “variants”, ie. size + mode of resizing, and there is no option to have more, nor is there an option to enable query-based resizing parameters. This might make sense for applications where you know all sizes in advance, but CF Images also supports what they call “Direct creator uploads”, which are one-time URL’s you can create, that allows your user to directly upload to CF Images without needing to pipe it through your server. This is all well and good, but requires you to do any custom or user-defined cropping on the client side, and you’ll lose image information permanently when uploading the already cropped image to CF Images. This means that the user can’t decide to later change the crop without re-uploading the image, which is both impractical and a waste of space and bandwidth.</p>
<h3 id="6-“Direct-Creator-Upload”-is-essentially-useless"><a href="#6-“Direct-Creator-Upload”-is-essentially-useless"></a>6. “Direct Creator Upload” is essentially useless</h3>
<p>Links: <a href="https://developers.cloudflare.com/images/cloudflare-images/upload-images/direct-creator-upload">Direct Creator Upload in the docs</a>, <a href="https://community.cloudflare.com/t/id-from-direct-upload-differs-from-final-image-id-rendering-direct-upload-practically-useless/318722">Community post (by me)</a>, <a href="https://community.cloudflare.com/t/webhook-for-tracking-direct-creator-upload/315099">Community post 2 (by me)</a></p>
<p>To expand on the “Direct creator upload” mentioned above, I haven’t actually found out how to use it in a single meaningful way, while I’d really like to. The flow goes like this:</p>
<ol>
<li>Request a one-time upload URL from the CF API and return it to the user
<ul>
<li>This contains an <code>id</code> and an <code>uploadURL</code></li>
</ul>
</li>
<li>The user uploads an image with the given <code>uploadURL</code></li>
</ol>
<p>This works great, but while this <em>technically</em> does the job of allowing a user to make an upload directly to CF Images, there is no way to know whether or not the upload succeeded, nor what the final <code>id</code> and the resulting image URL is, without being told by and blindly trusting the client.</p>
<p>There are no webhooks for CF Images (like for <a href="https://developers.cloudflare.com/stream/uploading-videos/using-webhooks">CF Stream</a>), so my first instinct to work around this was to store the <code>id</code> received from the CF API in the server-side request, and have the user ping the server when their upload was complete. I could then use the CF API once again to fetch the image using the original <code>id</code> and verify that the image was indeed uploaded successfully. This, unfortunately, does not work, as the <code>id</code> from the CF API differs from the final <code>id</code> of the uploaded image.</p>
<p>I’m sure I’ve severely misunderstood something, but I’d very much like to know how somebody would use this is a production setting, where you cannot trust the client, and need to be able to track usage, as well as have the possibility to delete user data.</p>
<h3 id="7-Size-limit-of-10MB-with-no-option-to-increase-it"><a href="#7-Size-limit-of-10MB-with-no-option-to-increase-it"></a>7. Size limit of 10MB, with no option to increase it</h3>
<p>This one seems arbitrarily low, as you’d want the highest quality you could get when resizing images. In the <a href="https://news.ycombinator.com/item?id=28565993">HN thread</a> for the product launch, it’s mentioned that this is a starting default, and that they can support larger sizes. Hopefully this will be changed to something like 25MB at some point.</p>
<h3 id="8-No-way-to-perform-batch-deletions-of-images"><a href="#8-No-way-to-perform-batch-deletions-of-images"></a>8. No way to perform batch deletions of images</h3>
<p>Links: <a href="https://community.cloudflare.com/t/batch-deletion-of-images-and-streams/315691">Community post (by me)</a></p>
<p>There is currently no way to delete more than 1 image at a time using the CF API, requiring you to build your own solution for this, making sure that you stay under the CF API rate limit of 1,200 requests per 5 minutes - which goes for your entire applications usage of the CF API.</p>
<h3 id="9-You’re-left-to-patch-some-of-these-things-yourself"><a href="#9-You’re-left-to-patch-some-of-these-things-yourself"></a>9. You’re left to patch some of these things yourself</h3>
<p>By using a simple CF Worker you can get proper CORS-headers, and actual caching of images. Doing this, you will both get expected functionality (CORS-headers), as well as reduced cost by the images being properly cached.</p>
<p>Thing is, you’re using a CF service to do this, doing something that by itself shouldn’t be necessary, but more importantly - if the cost can be reduced by doing this yourself, one would assume that the cost could be even further reduced if this was implemented by CF.</p>
<h2 id="Conclusion"><a href="#Conclusion"></a>Conclusion</h2>
<p>So, is CF Images a bad product? No, by no means, but given all of the above issues, it seems both incomplete and rushed. I have not even the slightest ounce of insight into what kind of administrative and architectural processes goes into making a product of this complexity and scale, so I’m in no position to say if these are things that can or even should be fixed. Also, given that the product is at an early stage, it’s subject to a lot of change and improvements.</p>
<p>I do wish they called it a beta, though, and I do wish that CF really put their money where their mouth is, and actually made CF Images more affordable than AWS, and provided a way to retrieve the original images to prevent vendor lock-in - especially with their very public criticism of their competitor for these very same reasons.</p>
<p>Lastly, I hope that this list very quickly becomes outdated, and that I soon can edit all of them with descriptions of how they’ve been solved or addressed by the CF team.</p>
<h2 id="Thanks-and-further-discussion"><a href="#Thanks-and-further-discussion"></a>Thanks and further discussion</h2>
<p>Thank you for reading this! I would love to hear your thoughts and ideas too. Join the discussion on <a href="https://news.ycombinator.com/item?id=29474743">Hacker News</a>, or feel free to email me at <code>daniel</code> at the domain this blog is on, or DM me on <a href="https://twitter.com/poacher2k">Twitter</a></p>
</div></div>
  </body>
</html>
