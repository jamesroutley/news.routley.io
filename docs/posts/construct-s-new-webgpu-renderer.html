<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.construct.net/en/blogs/construct-official-blog-1/introducing-constructs-new-1768">Original</a>
    <h1>Construct&#39;s New WebGPU Renderer</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>
<p>After years of work, we&#39;re proud to finally start wider testing for <strong>Construct&#39;s all-new WebGPU renderer!</strong> This is a major technology upgrade for Construct, with lots of under-the-hood improvements and some big performance results compared to the existing WebGL renderer. In this blog we&#39;ll cover what&#39;s new, some of the technical differences, and look at performance.
</p>
<h2>Background</h2>
<p>WebGPU is a brand-new web technology for computer graphics that supersedes WebGL. It&#39;s based on the modern graphics APIs Vulkan, Metal and DirectX 12 that aim to replace the legacy decades-old APIs like OpenGL that preceded them. After years in development WebGPU has just begun to roll out in browsers, starting with Chrome and Edge on desktop.
</p>
<p>For more background see the blog posts <a href="https://www.construct.net/en/blogs/ashleys-blog-2/brief-history-graphics-web-1517" target="_blank" rel="noopener" title="Make your own games">A brief history of graphics on the web and WebGPU</a>, and <a href="https://www.construct.net/en/blogs/ashleys-blog-2/webgl-webgpu-construct-1519" target="_blank" rel="noopener" title="Make your own games">From WebGL to WebGPU in Construct</a>, both written back in 2020 when we started work on WebGPU.
</p>
<h2>Technical improvements</h2>
<p>WebGPU is more powerful than WebGL 2, being more like WebGL 3 in terms of capabilities. We were able to take advantage of these new capabilities to make some big internal improvements to how the WebGPU renderer works. Better still, we were able to do this upgrade in a backwards compatible way, avoiding the need for us (and third-party developers) to rewrite large amounts of code interacting with the renderer. Here&#39;s a run-down of some of the more significant improvements we made with a ground-up rewrite of Construct&#39;s renderer using WebGPU&#39;s capabilities.
</p>
<h3>No more batch queue</h3>
<p>Due to the way Construct dynamically renders content, the WebGL renderer has to build a queue of commands while rendering. Then at the end of the frame it submits buffer data and then runs through all the queued commands. However WebGPU can reorder commands, meaning there is no need to build a queue of commands in the WebGPU renderer: instead it can issue commands directly while rendering, at the end of the frame it can insert a command to submit buffer data at the start. This is a <strong>major architectural simplifaction</strong> to the renderer and improves overall general performance too. There&#39;s a bit more detail on this improvement in the blog post <a href="https://www.construct.net/en/blogs/ashleys-blog-2/webgl-webgpu-construct-1519" target="_blank" rel="noopener" title="Make your own games">From WebGL to WebGPU in Construct</a>.
</p>
<h3>14x multitexturing</h3>
<p>The WebGL renderer can only render from a single texture at a time. Changing texture interrupts the flow of rendering with an instruction to change the current texture, also known as a &#34;texture swap&#34;.
</p>
<p>Spritesheeting (also known as texture atlases) is a common technique which amongst other benefits, helps mitigate texture swaps: if lots of images are on the same texture, then any of them can be drawn without changing texture. A texture swap is then only needed to switch to an entirely different spritesheet. However other considerations like memory use, the maximum texture size, and other technical restrictions, often mean games have to render from several different textures anyway.
</p>
<p>To mitigate this even further, Construct&#39;s WebGPU renderer takes advantage of multitexturing. This means instead of only being able to render one texture at a time, it can <strong>set a group of 14 textures to render from at once</strong> - with no need for texture swaps between those 14 textures! This is done by moving the texture selection to the GPU. Now texture swaps are only needed to switch to another group of 14 textures, far reducing the need for switches. In fact if the game renders from 14 or fewer textures - which is reasonable given most content is likely to be on spritesheets - then <strong>no texture swaps are needed at all</strong> during rendering!
</p>
<p>To demonstrate the potential performance benefit, we built a benchmark that thrashes texture swaps: it renders as many sprites as possible, with every sprite alternating between different spritesheets. In the WebGL renderer this forces a texture swap per sprite. However WebGPU&#39;s multitexturing allows it to render from both without any texture swaps. Here are the results for number of sprites at 60 FPS in each renderer.
</p>
<div><p><a href="https://construct-static.com/images/v1127/uploads/articleuploadobject/0/images/100720/texturethrash-perf.png" itemprop="image" target="_blank" rel="nofollow" title="Open original 856x686px in new window (34.21 KB)"><span><img no-referrer="none" loading="lazy" src="https://construct-static.com/images/v1127/r/uploads/articleuploadobject/0/images/100720/texturethrash-perf_v430.png" width="428" height="343" srcset="https://construct-static.com/images/v1127/r/uploads/articleuploadobject/0/images/100720/texturethrash-perf_v430.png 1x, https://construct-static.com/images/v1127/r/uploads/articleuploadobject/0/images/100720/texturethrash-perf_v650.png 1.5x, https://construct-static.com/images/v1127/uploads/articleuploadobject/0/images/100720/texturethrash-perf.png 2x"/></span></a></p></div>
<p>WebGPU achieves <strong>over 17x as many sprites</strong> on this test! This is an artificial benchmark and real-world projects will see smaller benefits, but it demonstrates the efficiency improvement of multitexturing. You can run the <a href="https://downloads.scirra.com/labs/perf/texturethrash-webgl/" target="_blank" rel="noopener" title="Make your own games">WebGL</a> and <a href="https://downloads.scirra.com/labs/perf/texturethrash-webgpu/" target="_blank" rel="noopener" title="Make your own games">WebGPU</a> benchmarks to see for yourself.
</p>
<p>Why 14? WebGPU guarantees the ability to use 16 textures, but Construct reserves two slots for internal purposes.
</p>
<h3>Batched opacity and colors</h3>
<p>In the WebGL renderer, drawing a sprite with a different opacity or color filter to the previous one also interrupted the flow of rendering with an instruction to change the opacity or color, much like a texture swap. (This did not affect particles though, as they use a special rendering mode.)
</p>
<p>The WebGPU renderer is now able to efficiently send the current opacity or color with every sprite (or &#34;quad&#34;, internally) entirely avoiding the need for opacity or color swaps. Similar to multitexturing, this entirely removes the overhead of such swaps from rendering. We built another benchmark that renders as many sprites as possible all with different opacity, and another one rendering all with different colors, to stress-test this case too, and here are the results.
</p>
<div><p><a href="https://construct-static.com/images/v1127/uploads/articleuploadobject/0/images/100722/opacitycolorthrash-perf.png" itemprop="image" target="_blank" rel="nofollow" title="Open original 1074x746px in new window (48.16 KB)"><span><img no-referrer="none" loading="lazy" src="https://construct-static.com/images/v1127/r/uploads/articleuploadobject/0/images/100722/opacitycolorthrash-perf_v550.png" width="537" height="373" srcset="https://construct-static.com/images/v1127/r/uploads/articleuploadobject/0/images/100722/opacitycolorthrash-perf_v550.png 1x, https://construct-static.com/images/v1127/r/uploads/articleuploadobject/0/images/100722/opacitycolorthrash-perf_v850.png 1.5x, https://construct-static.com/images/v1127/uploads/articleuploadobject/0/images/100722/opacitycolorthrash-perf.png 2x"/></span></a></p></div>
<p>In both cases WebGPU achieves <strong>about 10x as many sprites!</strong> As before this is an artificial benchmark and real-world projects will see smaller benefits, but it demonstrates the efficiency improvement in the new WebGPU renderer. You can run the <a href="https://downloads.scirra.com/labs/perf/opacitythrash-webgl/" target="_blank" rel="noopener" title="Make your own games">WebGL opacity</a>, <a href="https://downloads.scirra.com/labs/perf/opacitythrash-webgpu/" target="_blank" rel="noopener" title="Make your own games">WebGPU opacity</a>, <a href="https://downloads.scirra.com/labs/perf/colorthrash-webgl/" target="_blank" rel="noopener" title="Make your own games">WebGL color</a> and <a href="https://downloads.scirra.com/labs/perf/colorthrash-webgpu/" target="_blank" rel="noopener" title="Make your own games">WebGPU color</a> benchmarks to see for yourself.
</p>
<h3>Improved fullscreen copies</h3>
<p>Sometimes the renderer needs to copy a texture the size of the screen, such as to process layer effects. These are improved in the WebGPU renderer with the aim of improving GPU performance:
</p>
<ul>
<li><strong>More efficient fullscreen copies</strong> with optimized rasterization and working in the same render pass with no buffer updates</li>
<li><strong>Fewer fullscreen copies</strong> using WebGPU&#39;s ability to do things like sample the display texture directly (whereas WebGL needs a separate framebuffer)</li>
</ul>
<h3>Effect compositor improvements</h3>
<p>The WebGPU renderer uses a new and improved effect compositor, essentially a third-generation compositor that goes beyond the rewritten WebGL compositor. This features:
</p>
<ul>
<li>Background blending effects can now sample directly from the backbuffer, avoiding the need for an extra copy</li>
<li>Background blending effects can in some cases now render directly to the display on a new fast path</li>
<li>Rotation, mirror, flip, and spritesheet rotation, are now all more efficiently handled with background blending effects, no longer needing the &#34;pre-draw&#34; step</li>
<li>The whole effect chain runs in a special co-ordinates mode that avoids the need for changing transforms and updating buffers throughout</li>
<li>Effect parameters are stored in their own per-instance buffers, allowing switching between different object&#39;s effects parameters without uploading any buffer data</li>
</ul>
<h3>Better API</h3>
<p>OpenGL&#39;s API design was never exactly popular, and WebGL inherited the same design that dates all the way back to the 90s. WebGPU has taken the much-needed opportunity to break from the old and completely redesign the API with modern principles. It&#39;s much nicer to work with and less error prone! </p>
<h3>Modern technology</h3>
<p>WebGPU is based on the latest graphics technologies, essentially forming a cross-platform version of Vulkan, Metal and DirectX 12, and is designed for modern graphics hardware. This allows us to take advantage of more extensive minimum capabilities, such as for multitexturing, shader features, texture size limits, and more. It also allows for much simpler graphics drivers, which hopefully also means they are more reliable. Finally it puts us in a good place to benefit from future improvements as WebGPU continues to advance further ahead of WebGL.
</p>
<h2>Editor support</h2>
<p>One of the great things about Construct being fully browser-based is we can share all our code between both the editor and the runtime. We&#39;ve also been working on WebGPU support for Construct&#39;s Layout View, so all these benefits improve the editing experience within Construct as well! This will help ensure smooth performance while editing even the most ambitious projects.
</p>
<h2>Construct Animate support</h2>
<p>Full support for WebGPU is also in <a href="https://www.construct.net/en/animation-software" target="_blank" rel="noopener" title="Make your own games">Construct Animate</a>, helping ensure your animations are flawlessly smooth even under demanding circumstances - especially since WebGPU is also fully supported in worker mode, running all Construct&#39;s logic off the main thread, protecting it from any jank caused by the browser or other web content. Support for WebGPU is the same in both Construct 3 and Construct Animate, so everything noted here and in any documentation applies to both.
</p>
<h2>Try WebGPU today</h2>
<p>We&#39;re already trialling WebGPU support in our latest beta releases of Construct, so you can give it a spin today! While in future we expect WebGPU to be enabled by default and supported in all major browsers and platforms, for the time being we are being appropriately cautious with the roll-out of such a big technology upgrade. The status of WebGPU in Construct will change over time, so keep an eye on the <a href="https://www.construct.net/en/forum/construct-3/general-discussion-7/construct-webgpu-status-thread-177456" target="_blank" rel="noopener" title="Make your own games">Construct WebGPU status forum thread</a> for the latest details. However at time of writing you can use WebGPU in Chrome or Edge on Windows, macOS or ChromeOS, in the <a href="https://editor.construct.net/beta" target="_blank" rel="noopener" title="Make games in the browser">latest Construct beta release</a>, with preview and web and desktop exports, and opt-in your project by changing the <em>Use WebGPU</em> project setting to <em>Yes</em>.
</p>
<h2>Work in progress</h2>
<p>We&#39;re expecting a fair bit more work to fix any bugs or compatibility issues, as well as gradually rolling out support for other platforms as support widens, and making sure third-party developers have caught up with porting their effects to WGSL. However as mentioned, we&#39;re expecting WebGPU to be widely supported and enabled by default in future. We&#39;re even working with Google to try to further optimize WebGPU in cases where we think it could be doing even better!
</p>
<h2>Conclusion</h2>
<p>Construct already had <a href="https://www.construct.net/en/blogs/construct-official-blog-1/outstanding-game-performance-1584" target="_blank" rel="noopener" title="Make your own games">outstanding performance</a>, but that&#39;s not enough for us! Construct&#39;s new WebGPU support pushes its performance and capabilities further still. We&#39;ve always believed that the web platform is the future, and we&#39;ve always been right at the leading edge of web technology, being an early adopter of WebGL itself way back in 2011, and taking advantage of the latest improvements from <a href="https://www.construct.net/en/blogs/construct-official-blog-1/export-smaller-projects-webp-1594" target="_blank" rel="noopener" title="Make your own games">optimizing exports with WebP images</a> to the latest WebGPU support, all working robustly and predictably cross-platform. Combined with <a href="https://www.construct.net/en/blogs/construct-official-blog-1/feature-focus-javascript-1595" target="_blank" rel="noopener" title="Make your own games">powerful JavaScript coding</a> that <a href="https://www.construct.net/en/blogs/construct-official-blog-1/javascript-beats-gamemaker-1570" target="_blank" rel="noopener" title="Make your own games">far outclasses competitors</a>, integrated <a href="https://www.construct.net/en/blogs/construct-official-blog-1/design-uis-html-css-construct-1585" target="_blank" rel="noopener" title="Make your own games">HTML and CSS capabilities</a>, advanced features like <a href="https://www.construct.net/en/blogs/construct-official-blog-1/efficient-advanced-effects-1579" target="_blank" rel="noopener" title="Make your own games">sub-layers</a>, <a href="https://www.construct.net/en/blogs/construct-official-blog-1/heard-meshes-1567" target="_blank" rel="noopener" title="Make your own games">meshes</a>, <a href="https://www.construct.net/en/blogs/construct-official-blog-1/lets-talk-scene-graph-1569" target="_blank" rel="noopener" title="Make your own games">scene graph</a>, <a href="https://www.construct.net/en/blogs/construct-official-blog-1/explore-new-3d-features-1578" target="_blank" rel="noopener" title="Make your own games">3D</a> and much much more, Construct is the most advanced game development tool that is still easy to use - so <a href="https://editor.construct.net/?startTour" target="_blank" rel="noopener" title="Make games in the browser">get started with Construct today</a>!</p>
</div>
</div></div>
  </body>
</html>
