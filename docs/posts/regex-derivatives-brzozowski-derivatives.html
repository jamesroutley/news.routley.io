<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/c0stya/brzozowski">Original</a>
    <h1>Show HN: Regex Derivatives (Brzozowski Derivatives)</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><em>This code is provided for educational purposes. It is not efficient. But it illustrates the idea.</em></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/c0stya/brzozowski/blob/main/formula.png"><img src="https://github.com/c0stya/brzozowski/raw/main/formula.png" alt="sample derivative expression"/></a></p>
<p dir="auto"><a href="https://en.wikipedia.org/wiki/Brzozowski_derivative" rel="nofollow">Brzozowski derivative</a> is a less known technique to work with regular expressions. Normally, to match a string using regex we have to construct an <a href="https://en.wikipedia.org/wiki/Nondeterministic_finite_automaton" rel="nofollow">automaton</a> and simulate it. With the regex derivative technique we can use a regular expression &#39;directly&#39; without the automaton construction and simulation.</p>
<p dir="auto">It has nothing to do with classical derivative in analysis. But the symbolic nature and chain rule application make it feel similar. For more details there is a paper <a href="https://www.ccs.neu.edu/home/turon/re-deriv.pdf" rel="nofollow">&#34;Regular-expression derivative re-examined&#34;</a> by Scott Owens, John Reppy and Aaron Turon.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Usage</h2>
<p dir="auto">This code implements only three operators. There are concatenation (<math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$\cdot$</math-renderer>), alteration (<math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$\mid$</math-renderer>), and Kleene star(<math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$*$</math-renderer>).</p>
<p dir="auto">The usage is straightforward:</p>
<div data-snippet-clipboard-copy-content="&gt; python match.py &lt;regex&gt; &lt;string&gt;"><pre><code>&gt; python match.py &lt;regex&gt; &lt;string&gt;
</code></pre></div>
<p dir="auto">E.g.</p>
<div dir="auto" data-snippet-clipboard-copy-content="&gt; python match.py &#39;(c|b)at&#39; &#39;cat&#39;
(((c|b)·a)·t)
(((ϵ|∅)·a)·t)
((((∅|∅)·a)|ϵ)·t)
(((((∅|∅)·a)|∅)·t)|ϵ)
True"><pre><span>&gt;</span> python match.py <span><span>&#39;</span>(c|b)at<span>&#39;</span></span> <span><span>&#39;</span>cat<span>&#39;</span></span>
<span><span>((</span>(c<span>|</span>b)·a)·t)</span>
<span>(((ϵ|∅)·a)·t)</span>
<span>((((∅|∅)·a)|ϵ)·t)</span>
<span>(((((∅|∅)·a)|∅)·t)|ϵ)</span>
<span>True</span></pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="&gt; python match.py &#39;(c|b)at&#39; &#39;sat&#39;
(((c|b)·a)·t)
(((∅|∅)·a)·t)
(((∅|∅)·a)·t)
(((∅|∅)·a)·t)
False"><pre><span>&gt;</span> python match.py <span><span>&#39;</span>(c|b)at<span>&#39;</span></span> <span><span>&#39;</span>sat<span>&#39;</span></span>
<span><span>((</span>(c<span>|</span>b)·a)·t)</span>
<span>(((∅|∅)·a)·t)</span>
<span>(((∅|∅)·a)·t)</span>
<span>(((∅|∅)·a)·t)</span>
<span>False</span></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-definition-and-rules" aria-hidden="true" href="#definition-and-rules"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Definition and rules</h2>
<p dir="auto">The derivative of a language <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$L \subset \Sigma*$</math-renderer> with respect to a string <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$u \in \Sigma*$</math-renderer> is a language <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$\partial_u L = \lbrace v \mid u \cdot v \in L \rbrace$</math-renderer>.</p>
<p dir="auto">For any characters <em>a</em> and <em>b</em> and for any regular expressions <em>r</em> and <em>s</em> we have following rules:</p>
<p dir="auto"><math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$$
\begin{align}
\partial_a \varepsilon &amp;= \emptyset &amp; \\
\partial_a a &amp;= \epsilon &amp; \\
\partial_a b &amp;= \emptyset &amp; \text{ for }(a \neq b) \\
\partial_a (r \cdot s) &amp;= \partial_a r \mid \nu(r) \cdot \partial_a s &amp; \\
\partial_a (r \mid s) &amp;= \partial_a r \mid \partial_a s &amp; \\
\partial_a (r*) &amp;= \partial_a r \cdot r* &amp;
\end{align}
$$</math-renderer></p>
<p dir="auto">where the function <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$\nu(r)$</math-renderer> checks if the language defined by regular expression contains an empty string (<math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$\epsilon$</math-renderer>). We call such regular expression <em>nullable</em>. The recursive definition of <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$\nu$</math-renderer> is:</p>
<p dir="auto"><math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$$
\begin{align}
\nu(\varepsilon) &amp;= \varepsilon \\
\nu(\emptyset) &amp;= \emptyset \\
\nu(a) &amp;= \emptyset \\
\nu(r \cdot s) &amp;= \nu(r) \cdot \nu(s) \\
\nu(r \mid s) &amp;= \nu(r) \mid \nu(s) \\
\nu(r*) &amp;= \varepsilon
\end{align}
$$</math-renderer></p>
<p dir="auto">We need two rules with respect to strings to complete the rule set:</p>
<p dir="auto"><math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$$
\begin{align}
\partial_\varepsilon r &amp;= r \\
\partial_{ua} &amp;= \partial_{a} \partial_{u} r
\end{align}
$$</math-renderer></p>
<p dir="auto">To find a match we have to check if the derivative of the regex <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$r$</math-renderer> with respect to string <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$u$</math-renderer> is <em>nullable</em>:</p>
<p dir="auto"><math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$$
\nu(\partial_{u} r) = \epsilon
$$</math-renderer></p>
<h2 tabindex="-1" dir="auto"><a id="user-content-example" aria-hidden="true" href="#example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Example</h2>
<p dir="auto">Let&#39;s check if word <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$cat$</math-renderer> matches the regexp <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$(c|b)at$</math-renderer>. Obviously it is because the regex defines a language of just two strings <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$cat$</math-renderer> and <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$bat$</math-renderer>. Anyway, let&#39;s do it formally.</p>
<p dir="auto"><math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$$
\partial_{cat}\left[(c \mid b)\cdot a \cdot t\right] = \partial_t\partial_a\partial_c\left[(c \mid b)\cdot a \cdot t\right]
$$</math-renderer></p>
<p dir="auto">Let&#39;s take a derivative with respect of each character separately:</p>
<p dir="auto"><math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$$
\begin{align*}
\partial_c\left[(c \mid b)\cdot a \cdot t\right] &amp;= \partial_c \left[c \mid b\right]\cdot a \cdot t \mid \nu(c \mid b) \cdot \partial_c [a \cdot t] &amp; \text{ by } \cdot \text{-rule} \\
&amp;= \partial_c \left[c \mid b\right]\cdot a \cdot t \mid \emptyset \cdot \partial_c [\cdot a \cdot t] &amp;  \nu(c \mid b) = \nu(c) \mid \nu(b) = \emptyset \mid \emptyset = \emptyset \\
&amp;= \partial_c \left[c \mid b\right]\cdot a \cdot t \mid \emptyset &amp; r \cdot \emptyset = \emptyset \cdot r = \emptyset \text{ for any }r \\
&amp;= \partial_c \left[c \mid b\right]\cdot a \cdot t &amp; r \mid \emptyset = \emptyset \mid r = r \text{ for any }r \\
&amp;= (\partial_c c \mid \partial_c b) \cdot a \cdot t &amp; \text{ by } \mid \text{-rule} \\
&amp;= (\epsilon \mid \emptyset) \cdot a \cdot t &amp;  \\
&amp;= \epsilon \cdot a \cdot t &amp;  \\
&amp;= a \cdot t &amp;  \\
\partial_a[a \cdot t] &amp;= \partial_a a \cdot t \mid \nu(a) \cdot \partial_a b   &amp; \text{ by } \cdot \text{-rule} \\
&amp;= \epsilon \cdot t \mid \emptyset &amp; \\
&amp;= t &amp; \\
\partial_t[t] &amp;= \epsilon \\
\end{align*}
$$</math-renderer></p>
<p dir="auto">So <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$\partial_{cat}\left[(c \mid b)\cdot a \cdot t\right] = \epsilon$</math-renderer> is <em>nullable</em> and the word <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$cat$</math-renderer> matches the regexp <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="e763c95f2e00d2dd78afe88ac963ccb2">$(c \mid b)\cdot a \cdot t$</math-renderer>.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-why-do-we-need-it" aria-hidden="true" href="#why-do-we-need-it"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Why do we need it</h2>
<ol dir="auto">
<li>It is fun</li>
<li>Using this technique we can construct a very efficient automaton called <a href="https://en.wikipedia.org/wiki/DFA_minimization" rel="nofollow">minimal DFA</a>. There are some considerations though but in some cases such construction can be very handy.</li>
</ol>
<h2 tabindex="-1" dir="auto"><a id="user-content-todo" aria-hidden="true" href="#todo"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>TODO</h2>
<ol dir="auto">
<li>Extend the derivative theory section</li>
<li>Add the <a href="https://en.wikipedia.org/wiki/Deterministic_finite_automaton" rel="nofollow">DFA</a> construction code</li>
</ol>
</article>
          </div></div>
  </body>
</html>
