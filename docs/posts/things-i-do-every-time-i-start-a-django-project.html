<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://brntn.me/blog/six-things-i-do-every-time-i-start-a-django-project/">Original</a>
    <h1>Things I do every time I start a Django project</h1>
    
    <div id="readability-page-1" class="page"><div>
    <p>I start a lot of projects. A lot!
Django is my go-to framework for spinning up a quick personal project, and while it&#39;s a fantastic framework, a big part of the reason I love Django is that it feels familiar.</p>
<p>I have a lot of muscle memory for starting a new project.
Here are six things that I do after I run <code>django-admin startproject</code>.</p>
<h2>Move the SECRET_KEY into an environment variable</h2>
<p>While it&#39;s one that you can get away with if you&#39;re keeping your source private, I reconfigure the <code>SECRET_KEY</code> as an environment variable on every new project.
This helps you get started along the path of building a <a href="https://12factor.net/">Twelve Factor App</a> and means that making the repository public won&#39;t expose you to problems down the line.</p>
<p>Having the <code>SECRET_KEY</code> in a <code>.gitignore</code>&#39;d <code>.env</code> file means that you can change it in each environment and specify your server&#39;s secret during your deployment.
We&#39;re not going to talk about deploying applications today (I use <a href="https://github.com/sesh/django-up">django-up</a>) but this strategy will allow you to specify the <code>SECRET_KEY</code> as an environment variable both locally and on your server.</p>
<p>If you&#39;re using <a href="https://github.com/pypa/pipenv"><code>pipenv</code></a> the <code>.env</code> file will be automatically loaded when you run commands in your terminal.
You can also use tools like <a href="https://direnv.net/"><code>direnv</code></a> to load the <code>.env</code> file when you move into the directory.</p>
<p>Update your <code>settings.py</code> to use the secret key:</p>
<div><pre><span></span><span>import</span> <span>os</span>

<span># ...</span>

<span>SECRET_KEY</span> <span>=</span> <span>os</span><span>.</span><span>environ</span><span>.</span><span>get</span><span>(</span><span>&#34;DJANGO_SECRET_KEY&#34;</span><span>)</span>
</pre></div>
<p>Update the <code>.env</code> file to load the secret locally:</p>
<div><pre><span></span><span>DJANGO_SECRET_KEY</span><span>=&lt;</span><span>generated</span><span>-</span><span>secret</span><span>&gt;</span>
</pre></div>
<p>(Speaking of projects, you can use <a href="https://utils.brntn.me/django-secret/">my utilities project</a> to generate a secret key the same way Django does)</p>
<h2>Change the database configuration to DATABASE_URL</h2>
<p>Django uses SQLite out of the box for new projects.
Since most of the personal projects I work on are database-agnostic, I&#39;m happy to keep running SQLite locally and switch to Postgres on the server.
To achieve this, and continue down the Twelve Factor App path, I use <a href="https://github.com/jazzband/dj-database-url"><code>dj-database-url</code></a> to specify the database with an environment variable.</p>
<p>If you&#39;re deploying to Heroku, Fly.io or most other PaaS providers, they will handle specifying the <code>DATABASE_URL</code> in your hosted environment.
If you&#39;re managing the deployment yourself you will need to make sure the variable is properly configured in each of your environments.</p>
<p>Using an environment variable like this helps avoid having environment specific configuration files for your database.</p>
<p>First, install the package:</p>
<div><pre><span></span>pipenv install dj_database_url
</pre></div>
<p>Then, update your <code>settings.py</code> to use <code>dj-database-url</code> with SQLite as the default if <code>DATABASE_URL</code> isn&#39;t specified.</p>
<div><pre><span></span><span>import</span> <span>dj_database_url</span>
<span>DATABASES</span> <span>=</span> <span>{</span>
    <span>&#39;default&#39;</span><span>:</span> <span>dj_database_url</span><span>.</span><span>config</span><span>(</span><span>default</span><span>=</span><span>f</span><span>&#39;sqlite:///</span><span>{</span><span>BASE_DIR</span> <span>/</span> <span>&#34;db.sqlite3&#34;</span><span>}</span><span>&#39;</span><span>)</span>
<span>}</span>
</pre></div>
<p>Unless you add something to your <code>.env</code> file this will continue to use SQLite locally.
Check out the <a href="https://github.com/jazzband/dj-database-url">documentation</a> for how to specify Postgres or another database server for local use.</p>
<h2>Set up a custom user model</h2>
<p>Over the years, there&#39;s been a lot of discussion about changing Django&#39;s default user model.
The current incarnation (that&#39;s been effectively the same since the pre-1.0 days) uses [username, password, email, first_name, last_name].
A lot of developers have started following the more modern practise of replacing the first and last name fields with a single name field.</p>
<p>In addition to fixing up the name, it&#39;s not unusual to replace the username with an email address.
While a username has some privacy advantages (I don&#39;t want your email address!), there are problems with users forgetting usernames, and using usernames without an email address makes account recovery difficult.</p>
<p>If you&#39;re supporting a forgotten password flow via email or making email required for any other reason, then you might as well switch to the much simpler [email, password, name].</p>
<p>This is such a common requirement that the Django documentation actually has a <a href="https://docs.djangoproject.com/en/4.0/topics/auth/customizing/#specifying-a-custom-user-model">whole section for replacing the default user model</a>.
You should do it.
Even if you want to stick to the default setup, it will make any changes you want to make in the future much simpler.</p>
<p>The model that I use is shared in the <a href="https://github.com/sesh/django-authuser">django-authuser</a> project. That project includes some extras like a sign up view and customised admin configuration. To implement only the custom user model and model manager you can:</p>
<div><pre>&gt; python manage.py startapp authuser
</pre></div><p>Then add the following model to <code>authuser/models.py</code>:</p>
<div><pre><span></span><span>from</span> <span>django.db</span> <span>import</span> <span>models</span>
<span>from</span> <span>django.contrib.auth.models</span> <span>import</span> <span>AbstractBaseUser</span><span>,</span> <span>PermissionsMixin</span><span>,</span> <span>UserManager</span>
<span>from</span> <span>django.utils</span> <span>import</span> <span>timezone</span>


<span>class</span> <span>CustomUserManager</span><span>(</span><span>UserManager</span><span>):</span>
    <span>def</span> <span>_create_user</span><span>(</span><span>self</span><span>,</span> <span>email</span><span>,</span> <span>password</span><span>,</span> <span>**</span><span>extra_fields</span><span>):</span>
        <span>&#34;&#34;&#34;</span>
<span>        Create and save a User with the provided email and password.</span>
<span>        &#34;&#34;&#34;</span>
        <span>if</span> <span>not</span> <span>email</span><span>:</span>
            <span>raise</span> <span>ValueError</span><span>(</span><span>&#34;The given email address must be set&#34;</span><span>)</span>

        <span>email</span> <span>=</span> <span>self</span><span>.</span><span>normalize_email</span><span>(</span><span>email</span><span>)</span>
        <span>user</span> <span>=</span> <span>self</span><span>.</span><span>model</span><span>(</span><span>email</span><span>=</span><span>email</span><span>,</span> <span>**</span><span>extra_fields</span><span>)</span>
        <span>user</span><span>.</span><span>set_password</span><span>(</span><span>password</span><span>)</span>
        <span>user</span><span>.</span><span>save</span><span>(</span><span>using</span><span>=</span><span>self</span><span>.</span><span>_db</span><span>)</span>
        <span>return</span> <span>user</span>

    <span>def</span> <span>create_user</span><span>(</span><span>self</span><span>,</span> <span>email</span><span>=</span><span>None</span><span>,</span> <span>password</span><span>=</span><span>None</span><span>,</span> <span>**</span><span>extra_fields</span><span>):</span>
        <span>extra_fields</span><span>.</span><span>setdefault</span><span>(</span><span>&#34;is_staff&#34;</span><span>,</span> <span>False</span><span>)</span>
        <span>extra_fields</span><span>.</span><span>setdefault</span><span>(</span><span>&#34;is_superuser&#34;</span><span>,</span> <span>False</span><span>)</span>
        <span>return</span> <span>self</span><span>.</span><span>_create_user</span><span>(</span><span>email</span><span>,</span> <span>password</span><span>,</span> <span>**</span><span>extra_fields</span><span>)</span>

    <span>def</span> <span>create_superuser</span><span>(</span><span>self</span><span>,</span> <span>email</span><span>,</span> <span>password</span><span>,</span> <span>**</span><span>extra_fields</span><span>):</span>
        <span>extra_fields</span><span>.</span><span>setdefault</span><span>(</span><span>&#34;is_staff&#34;</span><span>,</span> <span>True</span><span>)</span>
        <span>extra_fields</span><span>.</span><span>setdefault</span><span>(</span><span>&#34;is_superuser&#34;</span><span>,</span> <span>True</span><span>)</span>

        <span>if</span> <span>extra_fields</span><span>.</span><span>get</span><span>(</span><span>&#34;is_staff&#34;</span><span>)</span> <span>is</span> <span>not</span> <span>True</span><span>:</span>
            <span>raise</span> <span>ValueError</span><span>(</span><span>&#34;Superuser must have is_staff=True.&#34;</span><span>)</span>
        <span>if</span> <span>extra_fields</span><span>.</span><span>get</span><span>(</span><span>&#34;is_superuser&#34;</span><span>)</span> <span>is</span> <span>not</span> <span>True</span><span>:</span>
            <span>raise</span> <span>ValueError</span><span>(</span><span>&#34;Superuser must have is_superuser=True.&#34;</span><span>)</span>

        <span>return</span> <span>self</span><span>.</span><span>_create_user</span><span>(</span><span>email</span><span>,</span> <span>password</span><span>,</span> <span>**</span><span>extra_fields</span><span>)</span>


<span>class</span> <span>User</span><span>(</span><span>AbstractBaseUser</span><span>,</span> <span>PermissionsMixin</span><span>):</span>
    <span>&#34;&#34;&#34;</span>
<span>    User model that uses email addresses instead of usernames, and</span>
<span>    name instead of first / last name fields.</span>

<span>    All other fields from the Django auth.User model are kept to</span>
<span>    ensure compatibility with the built in management commands.</span>
<span>    &#34;&#34;&#34;</span>

    <span>email</span> <span>=</span> <span>models</span><span>.</span><span>EmailField</span><span>(</span><span>blank</span><span>=</span><span>True</span><span>,</span> <span>default</span><span>=</span><span>&#34;&#34;</span><span>,</span> <span>unique</span><span>=</span><span>True</span><span>)</span>
    <span>name</span> <span>=</span> <span>models</span><span>.</span><span>CharField</span><span>(</span><span>max_length</span><span>=</span><span>200</span><span>,</span> <span>blank</span><span>=</span><span>True</span><span>,</span> <span>default</span><span>=</span><span>&#34;&#34;</span><span>)</span>

    <span>is_active</span> <span>=</span> <span>models</span><span>.</span><span>BooleanField</span><span>(</span><span>default</span><span>=</span><span>True</span><span>)</span>
    <span>is_staff</span> <span>=</span> <span>models</span><span>.</span><span>BooleanField</span><span>(</span><span>default</span><span>=</span><span>False</span><span>)</span>
    <span>is_superuser</span> <span>=</span> <span>models</span><span>.</span><span>BooleanField</span><span>(</span><span>default</span><span>=</span><span>False</span><span>)</span>

    <span>last_login</span> <span>=</span> <span>models</span><span>.</span><span>DateTimeField</span><span>(</span><span>blank</span><span>=</span><span>True</span><span>,</span> <span>null</span><span>=</span><span>True</span><span>)</span>
    <span>date_joined</span> <span>=</span> <span>models</span><span>.</span><span>DateTimeField</span><span>(</span><span>default</span><span>=</span><span>timezone</span><span>.</span><span>now</span><span>)</span>

    <span>objects</span> <span>=</span> <span>CustomUserManager</span><span>()</span>

    <span>USERNAME_FIELD</span> <span>=</span> <span>&#34;email&#34;</span>
    <span>EMAIL_FIELD</span> <span>=</span> <span>&#34;email&#34;</span>
    <span>REQUIRED_FIELDS</span> <span>=</span> <span>[]</span>

    <span>class</span> <span>Meta</span><span>:</span>
        <span>verbose_name</span> <span>=</span> <span>&#34;User&#34;</span>
        <span>verbose_name_plural</span> <span>=</span> <span>&#34;Users&#34;</span>

    <span>def</span> <span>get_full_name</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>self</span><span>.</span><span>name</span>

    <span>def</span> <span>get_short_name</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>self</span><span>.</span><span>name</span> <span>or</span> <span>self</span><span>.</span><span>email</span><span>.</span><span>split</span><span>(</span><span>&#34;@&#34;</span><span>)[</span><span>0</span><span>]</span>
</pre></div>
<p>Once that&#39;s added, add our new app to our <code>INSTALLED_APPS</code> in <code>settings.py</code> and configure the <code>AUTH_USER_MODEL</code> setting:</p>
<div><pre><span></span><span>INSTALLED_APPS</span> <span>=</span> <span>[</span>
    <span>...</span>
    <span>&#34;authuser&#34;</span><span>,</span>
<span>]</span>

<span>AUTH_USER_MODEL</span> <span>=</span> <span>&#34;authuser.User&#34;</span>
</pre></div>
<p>Then make / run your migrations to set up the new user model:</p>
<div><pre>&gt; python manage.py makemigrations
&gt; python manage.py migrate
</pre></div><p>This model overwrites some of the fields from the <code>AbstractBaseUser</code> and <code>PermissionsMixin</code> classes.
I prefer being explicit with my setup of those fields rather than relying on the base class.
That said, it&#39;s unlikely that Django will change the base class, so if you want an even simpler version you can remove the <code>is_active</code>, <code>is_staff</code>, <code>is_superuser</code> and <code>last_login</code> fields from the model.
If you do that, make sure you keep a close eye on the major version release notes for any changes.</p>
<h2>Create your Django app</h2>
<p>We&#39;ve already made a bunch of changes to our application&#39;s structure and we&#39;re only just creating our Django app!</p>
<p>I always try to name my first app after the primary model that the project is about.
If it&#39;s a blog, then it would be <code>posts</code>.
If it&#39;s a bookmark site, then it might be <code>links</code>.
If it&#39;s a CRM, then it might be <code>clients</code> or <code>leads</code>.</p>
<p>Some folks advocate a <code>core</code> Django app to house your initial models.
I&#39;m not against this idea, but I do tend to prefer a more <a href="https://martinfowler.com/bliki/DomainDrivenDesign.html">Domain Driven Design</a> approach to naming that promotes naming each app after its primary model.
I find that it&#39;s easy to follow this pattern early in a project, so you might as well.
After all, you&#39;re starting a project with an idea, and if you&#39;re using Django that idea probably revolves around a particular model.</p>
<p>Getting this name right is actually one of the trickiest parts of starting a new project.
But don&#39;t worry – you&#39;ll find it easy to change with modern refactoring tools (though, best to get the name correct before you have live data).</p>
<p>Use the <code>startapp</code> management command to create your app:</p>
<div><pre><span></span>pipenv run python manage.py startapp links
</pre></div>
<p>This creates the directory structure for the application. Next, update <code>settings.py</code> to include your app in the <code>INSTALLED_APPS</code>:</p>
<div><pre><span></span><span>INSTALLED_APPS</span> <span>=</span> <span>[</span>
    <span>...</span>
    <span>&#34;links&#34;</span><span>,</span>
<span>]</span>
</pre></div>
<p>You don&#39;t have any models or views yet, so there&#39;s no need to do anything else at this point.
Once you add models you&#39;ll run <code>makemigrations</code> and once you start adding views you might create an app-specific <code>urls.py</code> to house those routes.</p>
<h2>Make a <code>base.html</code></h2>
<p>Once we have our first application it&#39;s time to get our base template sorted.
I create a <code>base.html</code> file with a simple structure, then use <code>{% extends &#39;base.html&#39; %}</code> in each of my templates.</p>
<p>Start by creating a templates directory in the app you just created.
By default, Django will look for templates inside each of your <code>INSTALLED_APPS</code>.
As the project grows you <em>might</em> move this into a more central location.</p>

<p>The content of the template can be fairly straight forward.
You&#39;ll likely have your own preferences that you can start to include here around Javascript / CSS frameworks.
I like to leave it as much of a blank canvas as possible.</p>
<p>Add the following to <code>links/templates/base.html</code>:</p>
<div><pre>{% load static %}&lt;!doctype html&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;meta charset=&#34;utf-8&#34;&gt;
    &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt;
    &lt;title&gt;{% block title %}Page Title{% endblock %}&lt;/title&gt;
    &lt;link rel=&#34;stylesheet&#34; href=&#34;{% static &#39;css/style.css&#39; %}&#34; /&gt;
&lt;/head&gt;
&lt;body&gt;
    {% block content %}{% endblock %}
&lt;/body&gt;
&lt;/html&gt;
</pre></div><p>You&#39;ll note that I have a stylesheet linked here.
Create the directory and an empty file so that our page loads properly.
Use this file to add your styles as the project grows.</p>
<div><pre><span></span>&gt; mkdir -p links/static/css
&gt; touch links/static/css/style.css
</pre></div>
<p>I&#39;ll add a <code>&lt;header&gt;</code> and <code>&lt;footer&gt;</code> to this <code>base.html</code> file as they are needed.
If I need to include Javascript for specific templates I&#39;ll sometimes add a <code>{% block extra_js %}{% endblock %}</code> at the bottom so that I can include those from my sub templates.
Until you outgrow the single content block there&#39;s no need to add that though.</p>
<h2>Gibo and Git Init</h2>
<p>We have everything set up and it&#39;s time to initialise the Git repository so that we can track our work.
You could use <a href="https://github.com/simonwhitaker/gibo"><code>gibo</code></a> to load up the latest version of the Github <code>.gitignore</code> file but I tend to just use this <code>curl</code> snippet to grab it:</p>
<div><pre><span></span>&gt; curl https://raw.githubusercontent.com/github/gitignore/main/Python.gitignore &gt; .gitignore
</pre></div>
<p>That Python gitignore file includes excludes for the SQLite database and our <code>.env</code> file.
There&#39;s a bunch of editor specific excludes that you might want to remove.
I tend to keep them though, as they don&#39;t cause any harm.</p>
<p>Run <code>git init</code> in our main directory, with the <code>main</code> branch as our default.
Then add our files and create an initial commit.</p>
<div><pre>&gt; git init -b main
&gt; git add .
&gt; git commit -m &#34;init: Initial commit for our new project&#34;
</pre></div><p>You can now push this project to a public repository without leaking your SECRET_KEY or database credentials.
How great is that?!</p>

    </div></div>
  </body>
</html>
