<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://twitter.com/sjmurdoch/status/1638623990817103888">Original</a>
    <h1>Acropalypse: Windows Save File API is defective by design</h1>
    
    <div id="readability-page-1" class="page"><div role="main"><div><div><div><div data-testid="primaryColumn"><div aria-label="Home timeline" tabindex="0"><div itemscope="" itemtype="https://schema.org/Collection"><meta content="Tweet with replies" itemprop="name"/><section aria-labelledby="accessible-list-143729" role="region"><div aria-label="Timeline: Conversation"><div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638623990817103888" itemprop="identifier"/><meta content="1" itemprop="position"/><meta content="3" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T19:29:38.000Z" itemprop="dateCreated"/><meta content="2023-03-22T19:29:38.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638623990817103888" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638623990817103888" itemprop="mainEntityOfPage"/><article aria-labelledby="id__kp0u711mag id__1p8a41a5e4b id__iohfhnuosb8 id__fkpva9vezk id__bua1vb98s8f id__rgmmjk7khwq id__7lanaw33dur id__rfn2po9zqo id__k9cgnkwr3q id__qnor89t0y0e id__xfbrjhrdyqo id__kl7cfubr6wm id__iy2eu8fff8k id__anmm6125lcs id__aqfjrebqa9q id__p36u704dt3h id__rvzrmu1n4yn id__vew2tpai6zj id__blww8bmmm5" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div></div><div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>I did a little digging to see why Windows Snip and Sketch leaves part of the old image in a file when you crop a screenshot, potentially disclosing sensitive information (Acropalypse). It looks like the new Windows Save File API is defective by design. Why do I say this?</span><span>üßµ</span><span> 1/9</span></p></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638623993220440074" itemprop="identifier"/><meta content="2" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T19:29:38.000Z" itemprop="dateCreated"/><meta content="2023-03-22T19:29:38.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638623993220440074" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638623990817103888" itemprop="isPartOf"/><article aria-labelledby="id__ozmvvt8y8ed id__mxld0usrfci id__bc1fv8fmeyv id__zxk8l2k36zl id__f7e0mjv7p8 id__iwj8ggumkk id__8ud0zdcdpgg id__1wzklmntk4a id__0zrk4bmwiks id__v3bep6nirb9 id__820vniyrcds id__7jiazrrn4f id__zruz7ajfw0f id__bdtvezi0btf id__di31ecq9h4 id__5j1660vzb57 id__s67teic3gcd id__sc434gev0xm id__81c10doxbco" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>The old Win32 API for saving a file was (roughly) to show a file picker, get the filename the user selected, and then open the file. To open a file, the programmer must specify whether to overwrite the file or not, and example code usually does overwrite the file. 2/9</span></p></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638623995330174981" itemprop="identifier"/><meta content="3" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T19:29:39.000Z" itemprop="dateCreated"/><meta content="2023-03-22T19:29:39.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638623995330174981" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638623993220440074" itemprop="isPartOf"/><article aria-labelledby="id__rl8zdaznhpf id__v7cd2myzc2m id__xebclkkgps id__n2uah4euyci id__nnb9k5s0mc7 id__l0iytxgdp3i id__rl0ftz3ysw id__scp8boh1qcf id__w3rym9fnmnp id__dcypal1wvfi id__reeu6jvb33h id__cm4i707njue id__yi5ueb5y4u id__1r08c0iegrv id__mq6974ydl1i id__pu8n2twz8i id__sqc65khyeb id__3ay6tg0l48d id__g8yq4v70zn" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>However, the new ‚Äúmore secure‚Äù Universal Windows Platform (UWP) sandboxes the file picker in a separate process, allowing neat features like capability-based access control. It returns a file handle which, if the selected file exists, will not overwrite the existing content! 3/9</span></p></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638623998224244761" itemprop="identifier"/><meta content="4" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T19:29:39.000Z" itemprop="dateCreated"/><meta content="2023-03-22T19:29:39.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638623998224244761" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638623995330174981" itemprop="isPartOf"/><article aria-labelledby="id__5ctgxoie5kj id__0710qii7cp17 id__nmtqjiekvzb id__71kwy2gk5r7 id__hzftkdelx id__i0plnyc6smo id__7z9ji8pmgiy id__wg0wc0x11n id__l7ixjdpfwkm id__khydmrns1i id__60v869mxlxx id__gv40z21kioi id__ruc17gg6tlg id__r12jzb4orrn id__zm1epjhdbpn id__ny3tqhebzre id__hdb2nev9fn id__8sdj9ay0ikq id__vq7prp4frj" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div aria-labelledby="id__01epaf7j9ksq id__chpj6dx1oek" id="id__ruc17gg6tlg"><div><div><div><div><div><div role="button" tabindex="0"><div><div><div aria-label="Screenshot of linked StackOverflow post." data-testid="tweetPhoto"><p><img alt="Screenshot of linked StackOverflow post." draggable="true" src="https://pbs.twimg.com/media/Fr2KdDEWICglhc7?format=png&amp;name=medium"/></p></div></div></div></div></div></div></div></div></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638624001147961344" itemprop="identifier"/><meta content="5" itemprop="position"/><meta content="3" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T19:29:40.000Z" itemprop="dateCreated"/><meta content="2023-03-22T19:29:40.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638624001147961344" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638623998224244761" itemprop="isPartOf"/><article aria-labelledby="id__de5kqj42y3 id__y9djto47g3s id__1fv8mpc81i3 id__41juimienst id__t9i3gf6r8y id__kdmydqt8dxd id__l5hj4itgp8g id__0mc9ko63yiyb id__h6r38j5uyuw id__awdjiu5kim id__k728kvjwu5c id__hkfw769pryn id__m13vc1u6bwr id__pkdtmryu1yf id__509rstjaxv3 id__v39qzws80a id__j8qxwigivx id__wxy3893un9c id__fm3fyu88run" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>The documentation for FileSavePicker doesn‚Äôt mention the problem or truncate files in the example code. It is no surprise that the default behaviour of not truncating existing files is, therefore commonplace, despite being not what most people want. 5/9</span></p></div></div><div aria-labelledby="id__xo1kejwsjn9 id__maejgr42qjr" id="id__m13vc1u6bwr"><div aria-labelledby="id__ayn522flyyl id__ckju4z81zpi" id="id__maejgr42qjr" data-testid="card.wrapper"><div aria-hidden="true" id="id__ayn522flyyl" data-testid="card.layoutSmall.media"><a href="https://t.co/vrKASBQjzh" rel="noopener noreferrer nofollow" target="_blank" role="link" tabindex="-1"><div><div><div aria-label="Microsoft Logo"><p><img alt="Microsoft Logo" draggable="true" src="https://pbs.twimg.com/card_img/1638347109517647872/c7EY7kyI?format=png&amp;name=small"/></p></div></div></div></a></div></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638624003592953856" itemprop="identifier"/><meta content="6" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T19:29:41.000Z" itemprop="dateCreated"/><meta content="2023-03-22T19:29:41.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638624003592953856" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638624001147961344" itemprop="isPartOf"/><article aria-labelledby="id__v1a5s0ultji id__6hp639kdyug id__g6fsqxcg92l id__0mdkw8o6hurf id__8o872jxhvjn id__51dmkpzfjg6 id__ok1jneyfw2 id__oq7vscolk6 id__90e3qy4a06 id__boj2fcizcbi id__23434w1fw0e id__m1fshopfews id__q1odzdtpsx id__btc38l7phvs id__ot6tbgoifaf id__yvcw7m98nka id__puc4rdhxr9 id__bqr9wf3976o id__ukb12ji4u0g" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>For some formats, the resulting file will be detected as corrupt, and the bug will be recognised. However, software often follows Postel‚Äôs Law ‚Äì ‚Äúbe conservative in what you send, be liberal in what you accept‚Äù and so quietly ignores the old data after the expected content. 6/9</span></p></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638624005673328641" itemprop="identifier"/><meta content="7" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T19:29:41.000Z" itemprop="dateCreated"/><meta content="2023-03-22T19:29:41.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638624005673328641" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638624003592953856" itemprop="isPartOf"/><article aria-labelledby="id__1h78yecn1zh id__n5ch7b9165 id__4rc31ya1zmw id__jt1q11idy5l id__2jggf4a27of id__rf11jehdgu id__cxyioaw7jy id__58xib6khppa id__eji22xbqdqo id__f56q2hzpzei id__2a3hycbo5t4 id__splw43tewqq id__d20zrnoqo9s id__3wq0nvlly16 id__pd1dq3yx3u8 id__vt3rygrj6g id__ws11kau54p id__7bawsrovem8 id__9emtmgwlpc" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>The general lessons for this are not new, but bears repeating: secure defaults matter, including for APIs, and example code should be secure. Microsoft normally tries to do this, but something has obviously slipped through here. 7/9</span></p></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638624007724343296" itemprop="identifier"/><meta content="8" itemprop="position"/><meta content="6" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T19:29:42.000Z" itemprop="dateCreated"/><meta content="2023-03-22T19:29:42.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638624007724343296" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638624005673328641" itemprop="isPartOf"/><article aria-labelledby="id__n3ve36thwob id__6o6warppp1c id__njw4lb1ghhi id__l2nhyejmxi id__d8g2hzdwupm id__5rhcwcuqka id__pf326fg116 id__0h02uqmdkth id__tgkvc04n6fe id__krcwnk0q2gd id__l93n6erzugi id__k0p0rxlkqwj id__18xrtt98k3e id__2sywu8hkpgr id__mnvm0brulq id__py423oq1xc8 id__jo0xt1qus8 id__qj3iayg53g id__xt2vbeub8f" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>Perhaps it is also time to move on from Postel‚Äôs Law. It was important for the growth of the Internet but is now becoming a liability. Rejecting invalid input can help identify problems earlier when they have had less opportunity to cause harm. 8/9</span></p></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638624009775357952" itemprop="identifier"/><meta content="9" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T19:29:42.000Z" itemprop="dateCreated"/><meta content="2023-03-22T19:29:42.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638624009775357952" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638624007724343296" itemprop="isPartOf"/><meta content="https://twitter.com/David3141593/status/1638222624084951040" itemprop="isBasedOn"/><article aria-labelledby="id__4mv8p44id9s id__ufld31ze8pa id__0r33guj98ijb id__4idgcw0q12j id__x78ddyq0kuj id__x69weuxgvoe id__co1jwb5x4ci id__hws9d007py id__x5lz1eotbpg id__0pz05uxl74z id__2n367nc7e2i id__wj4ks586ydo id__5xt64j52xyu id__j2rz3addqz id__9xhw47lrcr id__vgb7l99vs4 id__k16d8ougjy id__6judiyo7a38 id__12yw25ekv72" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div aria-labelledby="id__5n1d1mezb4b id__k5v528tvhds" id="id__5xt64j52xyu"><div id="id__5n1d1mezb4b"><p><span>Quote Tweet</span></p><div tabindex="0"><div><div><p><span>holy FUCK.

Windows Snipping Tool is vulnerable to Acropalypse too.

An entirely unrelated codebase.

The same exploit script works with minor changes (the pixel format is RGBA not RGB)

Tested myself on Windows 11 </span><span> twitter.com/ProgramMax/sta‚Ä¶</span></p><p><span>Show this thread</span></p></div><div><div><div><div><div><div><div><div><div aria-label="Image" data-testid="tweetPhoto"><p><img alt="Image" draggable="true" src="https://pbs.twimg.com/media/Frwit_wWIAIJqm8?format=jpg&amp;name=large"/></p></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638671894940467201" itemprop="identifier"/><meta content="10" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T22:39:59.000Z" itemprop="dateCreated"/><meta content="2023-03-22T22:39:59.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638671894940467201" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638624009775357952" itemprop="isPartOf"/><article aria-labelledby="id__hsud2zf0oic id__pyv3okci31 id__1gu2xofrjb id__cgi1m0agoaj id__8gjomdkbmoy id__0csf2smv0w69 id__oltmkvuklp id__vm1573z53s id__s5bm2j3c1u id__fnf8axutz4j id__8l94i6mf1lh id__2zy9is98t49 id__5rfqez155pu id__131kkkn88loc id__eenwtw40ah5 id__unq8fo1cxsa id__jwcsm33txb id__tspgcfsyelf id__ydr9fno7did" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>I installed Visual Studio and kept on digging. It looks like if you only use FileIO to manipulate the opened file, it is OK, but if want to do anything more interesting you have to open the file as a stream and then the vulnerable default behaviour is a problem. 10/n</span></p></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638671898472255488" itemprop="identifier"/><meta content="11" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T22:40:00.000Z" itemprop="dateCreated"/><meta content="2023-03-22T22:40:00.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638671898472255488" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638671894940467201" itemprop="isPartOf"/><article aria-labelledby="id__xx92ca6lm9 id__hum9jccalsp id__10gg9mwns64g id__twcnh3mv519 id__7g5bbreb5ow id__yr9x5i0rlmh id__ecq8p1qg76q id__kbf6ghz45bo id__0vg2f49whak id__h0ut0ru7ald id__tptaeg9ian id__jlzpy2ska4 id__3gptxe5ndrd id__p0sng59wzh id__2i24deeuezt id__ill6dbv5qin id__2pd8h79pv1e id__h4lz34zoqv id__5khxp35073" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>For example, FileIO.WriteBytesAsync() truncates the stream before writing. This example is closely based on the Windows UWP demonstration code. 11/n</span></p></div></div><div aria-labelledby="id__59kz1o4ck8y id__p3jt4c7ic6" id="id__3gptxe5ndrd"><div><div><div><div><div><div><div><div><div role="button" tabindex="0"><div><div aria-label="Example code using FileIO.WriteBytesAsync()
" data-testid="tweetPhoto"><p><img alt="Example code using FileIO.WriteBytesAsync()
" draggable="true" src="https://pbs.twimg.com/media/Fr2z_XRWIAEa5DJ?format=jpg&amp;name=large"/></p></div></div></div></div></div><div><div><div role="button" tabindex="0"><div><div aria-label="Output file showing only 0x0A values." data-testid="tweetPhoto"><p><img alt="Output file showing only 0x0A values." draggable="true" src="https://pbs.twimg.com/media/Fr20XvIWcAEhDMx?format=png&amp;name=small"/></p></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638671902393741312" itemprop="identifier"/><meta content="12" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T22:40:01.000Z" itemprop="dateCreated"/><meta content="2023-03-22T22:40:01.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638671902393741312" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638671898472255488" itemprop="isPartOf"/><article aria-labelledby="id__iljlcxg27je id__43on1vou623 id__aaqz3rmd4ef id__inri2pj54s8 id__itdssqkrhsd id__rpbp07o7azc id__8w8qqqzyu4d id__1afp6g7smm6 id__ku98l33y7s id__wubc40ghfkj id__25eq0ovrgnc id__h5s58sj822w id__v0h9f5tt3gd id__2tsjstbe28j id__r6rd04lzhd id__j312ve80blt id__c000no4y9uj id__noj42e373ia id__dx6ulylxnls" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>But if we change the code to open the stream and write to it through a DataWriter, it does not truncate the file before writing. 12/n</span></p></div></div><div aria-labelledby="id__rhzgqajexrg id__g256n9o45d" id="id__v0h9f5tt3gd"><div><div><div><div><div><div><div><div><div role="button" tabindex="0"><div><div aria-label="Example code using WriteBytes()" data-testid="tweetPhoto"><p><img alt="Example code using WriteBytes()" draggable="true" src="https://pbs.twimg.com/media/Fr202-6WwAAyKhW?format=jpg&amp;name=large"/></p></div></div></div></div></div><div><div><div role="button" tabindex="0"><div><div aria-label="Output file showing the beginning overwritten but text present in the rest of the file." data-testid="tweetPhoto"><p><img alt="Output file showing the beginning overwritten but text present in the rest of the file." draggable="true" src="https://pbs.twimg.com/media/Fr21MD8XsAAYq8q?format=png&amp;name=small"/></p></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638671905627467776" itemprop="identifier"/><meta content="13" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T22:40:02.000Z" itemprop="dateCreated"/><meta content="2023-03-22T22:40:02.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638671905627467776" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638671902393741312" itemprop="isPartOf"/><article aria-labelledby="id__logtsotwb id__lokk31j4tt id__j9tcikkuzvd id__5ztn7amaztu id__qkxyvxmdttr id__18lhu8htbsi id__ols25cmyseb id__qqtzfy85yun id__4ny04xyd5nm id__yem1pf4jcia id__mue940khser id__iaqli799pvq id__hl3ku1pkaau id__ag4pe9is9gg id__9ggbclqxwj4 id__evrpjj7as id__89czu6zjbkb id__sobtjajyzb id__teccg9l0r5" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div aria-labelledby="id__ydwtld9ykk id__sfg163fif89" id="id__hl3ku1pkaau"><div><div><div><div><div><div role="button" tabindex="0"><div><div><div aria-label="Uno source code showing fileStream.SetLength(0)" data-testid="tweetPhoto"><p><img alt="Uno source code showing fileStream.SetLength(0)" draggable="true" src="https://pbs.twimg.com/media/Fr21pHJXgAMoSYv?format=png&amp;name=900x900"/></p></div></div></div></div></div></div></div></div></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638671909142544384" itemprop="identifier"/><meta content="14" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T22:40:02.000Z" itemprop="dateCreated"/><meta content="2023-03-22T22:40:02.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638671909142544384" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638671905627467776" itemprop="isPartOf"/><article aria-labelledby="id__5owirqbogjp id__y65dnr0j2de id__h1k8hkwji66 id__oz0l8w17q1e id__0x5rezd04znl id__15p04ez9w4yh id__6w6rzistvov id__on3wpn8ekf id__qk70phqtn6 id__5foo8hmzbyr id__489gour6tyx id__aanopqj9a8b id__73lq03akxfc id__nanje9bqcrj id__xsaxjgo3q7l id__k0h124fsr6s id__bsm2aofn29e id__5mquuvyb35a id__gxd8tghg5k7" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>Overall I think my conclusions still hold. The example code works, but if modified in a way that should be expected, it is insecure. The API for opening a file selected by a picker will, by default, not overwrite an existing file, which is almost always not what is intended. 14/n</span></p></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638671911210164224" itemprop="identifier"/><meta content="15" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T22:40:03.000Z" itemprop="dateCreated"/><meta content="2023-03-22T22:40:03.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638671911210164224" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638671909142544384" itemprop="isPartOf"/><article aria-labelledby="id__1dlrnjtifs2 id__k337dgm85fk id__9k5x46loo6r id__gzo59yuh2l id__00fn1aux0w675 id__nrmthidqpam id__4l4upjshc0q id__b9hcr26axr8 id__mtu95w8nbt id__gw9qxc7516b id__q7gx05jowdg id__kzi1mslrlkb id__wcyi9kzwpy id__t5r3x23nmzg id__se2g8n441fm id__4rko5ro6y8b id__v8q3ewrz9j id__5fciyy6h8tm id__o2h1edlt9ef" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>A safer API would be for the FileSavePicker to truncate existing files by default. Alternatively, OpenAsync() could have the option to open the stream for writing. Currently, it is only Read and ReadWrite, unlike the far richer Win32 CreateFile API. 15/n</span></p></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638675586221760513" itemprop="identifier"/><meta content="16" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T22:54:39.000Z" itemprop="dateCreated"/><meta content="2023-03-22T22:54:39.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638675586221760513" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638671911210164224" itemprop="isPartOf"/><article aria-labelledby="id__cx4obxxmuje id__vqua4pqa0od id__0t062en865fg id__i6ak1rrxuck id__kyu5l9cib9 id__v8tkirwc3i id__n5zd5qm35l id__c9o1vegg68m id__1tikj599wky id__wni3qaidadg id__j4k4iep4i49 id__papbkd93efe id__5sk4okg3ovf id__ou2bitqhcr id__q4ko9velb9e id__6bj73245fzv id__iek4n1dslmi id__uhtvoy4rxnk id__l3ytighx8cc" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>As an aside, OpenAsync has a very anaemic API. Win32 CreateFile allows checking for an existing file before opening and setting security parameters. These steps are atomic with opening the file, but if UWP doesn‚Äôt support atomic operations could it cause race conditions? 16/n</span></p></div></div></div></div></div></div></article></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1638681234648834049" itemprop="identifier"/><meta content="17" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2023-03-22T23:17:06.000Z" itemprop="dateCreated"/><meta content="2023-03-22T23:17:06.000Z" itemprop="datePublished"/><meta content="https://twitter.com/sjmurdoch/status/1638681234648834049" itemprop="url"/><meta content="https://twitter.com/sjmurdoch/status/1638675586221760513" itemprop="isPartOf"/><article aria-labelledby="id__m6vdh2cav58 id__a32d68mp07 id__cas87q75wnw id__h0mbr5rx23p id__mirrvgx7t2l id__b65q67e10ho id__19amveffi6g id__2wf2lkl2xec id__alnnuvhdr98 id__oy4kau689w id__qfp16o3f57p id__ifkrg2ri9q id__kha56psde5i id__5mcc2nirtpc id__aiyj6innk3t id__2rv91fj791l id__yc8g0n7v62i id__nzjcm2uebc id__dfl4pd7b1p9" role="article" tabindex="-1" data-testid="tweet"><div><div><div><div><div data-testid="Tweet-User-Avatar"><div><div><div data-testid="UserAvatar-Container-sjmurdoch"><div><div><div><div><a href="https://twitter.com/sjmurdoch" aria-hidden="true" role="link" tabindex="-1"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/641996073112735744/IzfDDqlw_400x400.jpg"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div itemprop="articleBody" data-testid="tweetTextAnnotations"><div><p><span>I can see why programmers could be easily confused, even if they work for Microsoft. Here‚Äôs some documentation that presents the FileIO and OpenAsync as interchangeable approaches when only the former will safely truncate a file that already exists. 17/n</span></p></div></div><div aria-labelledby="id__6vmr654h3uy id__fo8kioaonfi" id="id__kha56psde5i"><div aria-labelledby="id__3pp1gb562c id__1ldvjqgiz6i" id="id__fo8kioaonfi" data-testid="card.wrapper"><div aria-hidden="true" id="id__3pp1gb562c" data-testid="card.layoutSmall.media"><a href="https://t.co/5kq20I0WrK" rel="noopener noreferrer nofollow" target="_blank" role="link" tabindex="-1"><div><div><div aria-label="Microsoft Logo"><p><img alt="Microsoft Logo" draggable="true" src="https://pbs.twimg.com/card_img/1638347109517647872/c7EY7kyI?format=png&amp;name=small"/></p></div></div></div></a></div></div></div></div></div></div></div></article></div></div></div></div></section></div></div></div></div></div></div></div></div>
  </body>
</html>
