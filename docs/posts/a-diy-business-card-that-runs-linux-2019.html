<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/">Original</a>
    <h1>A DIY business card that runs Linux (2019)</h1>
    
    <div id="readability-page-1" class="page"><div id="main" tabindex="-1">
<article>

<div>

<p>I’m an embedded systems engineer.
I spend a lot of my free time looking for things I could use in future designs, or things that tickle one of my fancies.</p>
<p>One of those things is cheap Linux-capable computers, the cheaper the better.
So I started diving into the very deep rabbit hole of obscure processors.</p>
<p>I thought to myself, “These processors are nearly cheap enough to give away.”
After a while I hit upon the idea of making a barebones Linux board in a business card form factor.</p>
<p>As soon as I had the idea I thought it would be pretty cool to do.
I have <a href="https://hackaday.com/2017/10/04/literally-flashy-business-cards/">seen</a> electronic <a href="https://hackaday.com/2014/06/17/designing-the-second-version-of-my-business-card/">business</a> cards <a href="https://hackaday.com/2018/05/11/stylish-business-card-with-a-stylophone-built-in/">before</a>, with various fun features including emulating USB flash drives, blinkenlights, or even wireless transceivers.
I have never seen one running Linux, however.</p>
<p>So I built one.</p>
<figure><a href="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/businesscard-top.jpg">
<img src="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/businesscard-top_huad90566bef925e8b01048d4355f78bd6_6751801_1024x1024_fit_q80_box.jpg" title="(click for large version)"/> </a>
</figure>
<p>This is the finished product.
It is a complete, minimal ARM computer running my customized Linux firmware built with Buildroot.</p>
<figure><a href="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/businesscard-bottom.jpg">
<img src="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/businesscard-bottom_hu0304cb7e538da5a35ca6f72df4bbc0a9_7893599_1024x1024_fit_q80_box.jpg" title="(click for large version)"/> </a>
</figure>
<p>It has a USB port in the corner.
If you plug it into a computer, it boots in about 6 seconds and shows up over USB as a flash drive and a virtual serial port that you can use to log into the card’s shell.
The flash drive has a README file, a copy of my résumé, and some of my photography.
The shell has several games and Unix classics such as fortune and rogue, a small 2048, and a small MicroPython interpreter.</p>
<p>All this is accomplished on a very small 8MB flash chip.
The bootloader fits in 256KB, the kernel is 1.6MB, and the whole root filesystem is 2.4MB.
So, there’s plenty of space for the virtual flash drive.
It also includes a writable home directory, on the off chance that anyone creates something they want to keep.
This is also saved on the flash chip, which is properly wear leveled with UBI.</p>
<p>The whole thing costs under $3.
It’s cheap enough to give away.
If you get one from me, I’m probably trying to impress you.</p>
<h2 id="design-and-assembly">Design and assembly</h2>
<p>I designed and built everything myself.
This is literally my job, and I enjoy it, so much of the challenge was finding parts that were cheap enough for a hobbyist.</p>
<p>The choice of processor was the most critical decision to keep the cost low and make the project feasible.
After much research, I selected the F1C100s, a fairly obscure cost-optimized (read: <em>damn cheap</em>) part made by Allwinner; it includes both RAM and CPU in a single package.
I bought these on Taobao.
All the other miscellaneous components were sourced from LCSC.</p>
<p>I fabricated the PCBs with <a href="https://jlcpcb.com/">JLC</a>.
For $8 I got 10 copies.
I have been very impressed with boards I’ve gotten from JLC; they’re not quite as nice as the ones from OSHPark, but they look great, especially for the price.</p>
<p>The first spin of the boards were matte black, which looked fine but were quite the fingerprint magnets.</p>
<figure><a href="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/businesscard-v1-top.jpg">
<img src="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/businesscard-v1-top_hufbc4863b7048e03811fce4d4bb545c2d_2395351_1024x1024_fit_q80_box.jpg" title="(click for large version)"/> </a>
</figure>
<p>There were a couple problems with the first spin: first, the USB port wasn’t long enough to reliably make contact in many USB ports.
Less critically, the flash footprint was wrong, which I worked around by bending the leads under the part by hand.
(My wife said I was “dead-spidering” the part!)</p>
<figure><a href="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/dead-spider.jpg">
<img src="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/dead-spider_hub9f0c46128e70c3e8e3772be08b379bb_215180_1024x1024_fit_q80_box.jpg" title="(click for large version)"/> </a>
</figure>
<p>Once I had validated everything else, I re-spun the boards to get the version you see at the top of this article.</p>
<p>Due to the size of all these small parts, right away I decided to reflow solder everything using a <a href="https://www.thirtythreeforty.net/posts/2019/08/t962-reflow-profile-calculator/">cheap reflow oven</a>.
I have access to a laser cutter, so I laser-cut my own solder paste stencil using laminator pages.
The stencil turned out reasonably well.
The 0.2mm apertures for the processor pins needed special attention to get them to come out clean: laser power and focus were critical.</p>
<figure><a href="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/stencil.jpg">
<img src="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/stencil_hu1570a4fa6440b9ea23bc1041972caaf0_1201295_1024x1024_fit_q80_box.jpg" alt="Other blank PCBs make a good jig for holding your board to apply paste." title="(click for large version)"/> </a><figcaption>
<p>Other blank PCBs make a good jig for holding your board to apply paste.</p>
</figcaption>
</figure>
<p>I applied solder paste and placed components by hand.
I made sure to have a lead-free process—the boards, parts, and solder paste are all RoHS—so that I wouldn’t feel bad about giving them to people.</p>
<figure><a href="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/paste.jpg">
<img src="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/paste_hu025309d0408002528ae9eb49aeb44512_1961770_1024x1024_fit_q80_box.jpg" alt="I was a little off-target on this particular print, but solder paste is pretty forgiving and these assembled fine." title="(click for large version)"/> </a><figcaption>
<p>I was a little off-target on this particular print, but solder paste is pretty forgiving and these assembled fine.</p>
</figcaption>
</figure>
<p>Each component takes around 10 seconds to hand-place, so I tried to keep component count as low as possible.</p>
<p>For more discussion about the design and software, you might be interested in reading my <a href="https://www.thirtythreeforty.net/posts/2019/12/designing-my-linux-business-card/">detailed write-up</a>.</p>
<h3 id="bill-of-materials--cost">Bill of Materials &amp; Cost</h3>
<p>I kept costs low.
It’s cheap enough that I don’t feel bad giving it away, as designed!
I’m not going to give one to absolutely everyone because it does take time to assemble each card, and assembly cost is not factored in here (my time is “free”).</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>F1C100s</td>
<td>$1.42</td>
</tr>
<tr>
<td>PCB</td>
<td>$0.80</td>
</tr>
<tr>
<td>8MB flash</td>
<td>$0.17</td>
</tr>
<tr>
<td>All other components</td>
<td>$0.49</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>$2.88</strong></td>
</tr>
</tbody>
</table>
<p>Of course, there are other costs that are difficult to quantify like shipping (since it’s spread across multiple projects).
But this is definitely pretty cheap for a Linux board.
It also gives a pretty decent starting point for quantifying how much it costs companies to manufacture bottom-end devices: you bet they’re getting everything even cheaper than I am!</p>
<h2 id="capabilities">Capabilities</h2>
<p>What can I say?
It boots a super stripped-down Linux in about 6 seconds.
Due to form factor and cost, the card lacks I/O, networking, and any amount of storage to run heavyweight programs.
Nonetheless, I managed to cram a bunch of interesting stuff into the firmware image.</p>
<h3 id="usb">USB</h3>
<p>I could do any number of things with the USB, but I chose to keep it fairly simple so that people could have a decent chance of getting everything working on their computer when they tried it out.
Linux lets you behave as a “device” with the <a href="https://linux-sunxi.org/USB_Gadget">Gadget Framework</a>.
Since I forward-ported some drivers from others&#39; previous work on this processor, I have all the functionality of the entire USB gadget framework at my disposal.
I decided to emulate a pre-generated flash drive and supply a shell over a virtual serial port.</p>
<h3 id="shell">Shell</h3>
<p>You can run all these from the emulated serial console after you log in (as <code>root</code>, the only user):</p>
<ul>
<li><strong><code>rogue</code></strong>: the classic Unix dungeon crawler.</li>
<li><strong><code>2048</code></strong>: a simple console mode 2048 game.</li>
<li><strong><code>fortune</code></strong>: various pithy sayings. I decided not to include the entire database of quotes here to save space for other functionality.</li>
<li><strong><a href="https://micropython.org/"><code>micropython</code></a></strong>: a very small Python interpreter.</li>
</ul>
<h3 id="emulated-flash-drive">Emulated Flash Drive</h3>
<p>During the compilation process, the build tools generate a small FAT32 image and add it as one of the UBI partitions.
As I described above, the Linux gadget subsystem presents this as a mass storage device to the PC.</p>
<p>If you’d like to see what appears on the flash drive, the easiest thing to do would be to go <a href="https://github.com/thirtythreeforty/businesscard-linux/tree/master/package/businesscard-flashdrive/files">look at the source code</a>.
There’s some of my photography and my resume.</p>
<h2 id="resources">Resources</h2>
<h3 id="source-code">Source Code</h3>
<ul>
<li>
<p>If you’d like to see my Buildroot tree, it’s open-sourced on GitHub at <a href="https://github.com/thirtythreeforty/businesscard-linux"><strong><code>thirtythreeforty/businesscard-linux</code></strong></a>.
It contains the code to generate the NOR flash image, which is then installed via the processor’s USB download mode.
It also has package definitions for the games and other goodies like fortune that I packaged for Buildroot once I got everything working.
If you’re wanting to use the F1C100s in a project, it’s a great starting point (and feel free to get in touch if you have questions).</p>
</li>
<li>
<p>I rebased <a href="https://github.com/Icenowy/linux/tree/f1c100s">Icenowy’s excellent F1C100s work</a> on Linux v4.9.
My business card runs near-mainline v5.2 with this handful of patches rebased and debugged.
It’s hosted on GitHub at <a href="https://github.com/thirtythreeforty/linux/tree/f1c100s-v5.2.4"><strong><code>thirtythreeforty/linux</code></strong></a>.</p>
</li>
<li>
<p>I believe I currently have the world’s best port of U-Boot to the F1C100s, based again in part on some work by Icenowy.
(Surprisingly, getting U-Boot fully working was quite annoying.)
I am working on upstreaming this.
In the meantime, it is also on GitHub at <a href="https://github.com/thirtythreeforty/u-boot/tree/f1c100s-v2019.04"><strong><code>thirtythreeforty/u-boot</code></strong></a>.</p>
</li>
</ul>
<h3 id="f1c100s-documentation">F1C100s Documentation</h3>
<p>I found some (sparse) documentation for the F1C100s, which I’m mirroring here:</p>
<ul>
<li><a href="https://www.thirtythreeforty.net/media/F1C100s_Datasheet_V1.0.pdf"><strong>Allwinner F1C100s Datasheet</strong></a>
gives pinouts and general info</li>
<li><a href="https://www.thirtythreeforty.net/media/Allwinner_F1C600_User_Manual_V1.0.pdf"><strong>Allwinner F1C600 Reference Manual</strong></a>
gives register definitions for the F1C600, which is an F1C100s rebadged as Linux-capable (ha!)</li>
<li>I heavily drew from the <a href="http://dl.sipeed.com/LICHEE/Nano/">schematic</a> for <a href="https://www.seeedstudio.com/LicheePi-Nano-ARM926EJS-SoC-Development-Board-16M-Flash-p-2892.html?utm_source=referral&amp;utm_medium=thirtythreeforty">Sipeed’s Lichee Nano</a>, which was the dev board I used to get my software working.</li>
<li>You can get a KiCAD symbol and footprint for the F1C100s in my <a href="https://github.com/thirtythreeforty/3340_kicad">KiCAD parts library</a>.</li>
</ul>
<p>And finally, I’ve uploaded my schematic for the curious.
You can download it by clicking on it below.</p>
<figure><a href="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/businesscard.pdf"><img src="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/schematic-preview.svg"/></a>
</figure>
<p>The F1C100s is somewhat scarce here in the US, so here’s an open offer for people who want to design with this part: if you design a board with this chip on it, get in touch and I’ll get you some samples to build your board.</p>
<h2 id="conclusion">Conclusion</h2>
<p>I taught myself a lot on this project: it’s my first project using a reflow oven to solder the parts.
I also had to learn how to find resources for poorly-documented parts.
There was a lot more to it than what I touched on in this quick presentation; again, if you want to see how the sausage gets made, see also my <a href="https://www.thirtythreeforty.net/posts/2019/12/designing-my-linux-business-card/">companion detailed write-up</a>.</p>
<p>I drew from my existing experience with embedded Linux and designing PCBs.
It isn’t flawless, but it’s a pretty good representation of my abilities.</p>
<p>If you’d like to learn how to do this kind of thing, you might also be interested in my ongoing <a href="https://www.thirtythreeforty.net/posts/2019/08/mastering-embedded-linux-part-1-concepts/">Mastering Embedded Linux</a> series!
I’m walking through how to build hardware and software from scratch for tiny, cheap Linux systems much like my business card.
You can also subscribe to all future updates from the fancy new <a href="https://www.thirtythreeforty.net/subscribe/">Subscribe page</a>.</p>
</div>





</article>
</div></div>
  </body>
</html>
