<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.haproxy.com/blog/state-of-ssl-stacks">Original</a>
    <h1>The State of SSL Stacks</h1>
    
    <div id="readability-page-1" class="page"><div>
                        
                        
        
            <p><em>A paper on this topic was prepared for internal use within HAProxy last year, and this version is now being shared publicly. Given the critical role of SSL in securing internet communication and the challenges presented by evolving SSL technologies, reverse proxies like HAProxy must continuously adapt their SSL strategies to maintain performance and compatibility, ensuring a secure and efficient experience for users. We are committed to providing ongoing updates on these developments.</em></p><p>The SSL landscape has shifted dramatically in the past few years, introducing performance bottlenecks and compatibility challenges for developers. Once a reliable foundation, OpenSSL&#39;s evolution has prompted a critical reassessment of SSL strategies across the industry. </p><p>For years, OpenSSL maintained its position as the de facto standard SSL library, offering long-term stability and consistent performance. The arrival of version 3.0 in September 2021 changed everything. While designed to enhance security and modularity, the new architecture introduced significant performance regressions in multi-threaded environments, and deprecated essential APIs that many external projects relied upon. The absence of the anticipated QUIC API further complicated matters for developers who had invested in its implementation.</p><p>This transition posed a challenge for the entire ecosystem. OpenSSL 3.0 was designated as the Long-Term Support (LTS) version, while maintenance for the widely used 1.1.1 branch was discontinued. As a result, many Linux distributions had no practical choice but to adopt the new version despite its limitations. Users with performance-critical applications found themselves at a crossroads: continue with increasingly unsupported earlier versions or accept substantial penalties in performance and functionality.</p><p>Performance testing reveals the stark reality: in some multi-threaded configurations, OpenSSL 3.0 performs significantly worse than alternative SSL libraries, forcing organizations to provision more hardware just to maintain existing throughput. This raises important questions about performance, energy efficiency, and operational costs.</p><p>Examining alternatives—BoringSSL, LibreSSL, WolfSSL, and AWS-LC—reveals a landscape of trade-offs. Each offers different approaches to API compatibility, performance optimization, and QUIC support. For developers navigating the modern SSL ecosystem, understanding these trade-offs is crucial for optimizing performance, maintaining compatibility, and future-proofing their infrastructure.</p><h2 id="functional-requirements">Functional requirements</h2><p>The functional aspects of SSL libraries determine their versatility and applicability across different software products. HAProxy’s SSL feature set was designed around the OpenSSL API, so compatibility or functionality parity is a key requirement. </p><ul><li><p>Modern implementations must support a range of TLS protocol versions (from legacy TLS 1.0 to current TLS 1.3) to accommodate diverse client requirements while encouraging migration to more secure protocols. </p></li><li><p>Support for innovative, emerging protocols like QUIC plays a vital role in driving widespread adoption and technological breakthroughs. </p></li><li><p>Certificate management functionality, including chain validation, revocation checking via OCSP and CRLs, and SNI (Server Name Indication) support, is essential for proper deployment. </p></li><li><p>SSL libraries must offer comprehensive cipher suite options to meet varying security policies and compliance requirements such as PCI-DSS, HIPAA, and FIPS. </p></li><li><p>Standard features like ALPN (Application-Layer Protocol Negotiation) for HTTP/2 support, certificate transparency validation, and stapling capabilities further expand functional requirements. </p></li></ul><p>Software products relying on these libraries must carefully evaluate which functional components are critical for their specific use cases while considering the overhead these features may introduce.</p><h2 id="performance-considerations">Performance considerations</h2><p>SSL/TLS operations are computationally intensive, creating significant performance challenges for software products that rely on these libraries. Handshake operations, which establish secure connections, require asymmetric cryptography that can consume substantial CPU resources, especially in high-volume environments. They also present environmental and logistical challenges alongside their computational demands. </p><p>The energy consumption of cryptographic operations directly impacts the carbon footprint of digital infrastructure relying on these security protocols. High-volume SSL handshakes and encryption workloads increase power requirements in data centers, contributing to greater electricity consumption and associated carbon emissions. </p><p>Performance of SSL libraries has become increasingly important as organizations pursue sustainability goals and green computing initiatives. Modern software products implement sophisticated core-awareness strategies that maximize single-node efficiency by distributing cryptographic workloads across all available CPU cores. This approach to processor saturation enables organizations to fully utilize existing hardware before scaling horizontally, significantly reducing both capital expenditure and energy consumption that would otherwise be required for additional servers. </p><p>By efficiently leveraging all available cores for SSL/TLS operations, a single properly configured node can often handle the same encrypted traffic volume as multiple poorly optimized servers, dramatically reducing datacenter footprint, cooling requirements, and power consumption. </p><p>These architectural improvements, when properly leveraged by SSL libraries, can deliver substantial performance improvements with minimal environmental impact—a critical consideration as encrypted traffic continues to grow exponentially across global networks.</p><h2 id="maintenance-requirements">Maintenance requirements</h2><p>The maintenance burden of SSL implementations presents significant challenges for software products. Security vulnerabilities in SSL libraries require immediate attention, forcing development teams to establish robust patching processes. </p><p>Software products must balance the stability of established SSL libraries against the security improvements of newer versions; this process becomes more manageable when operating system vendors provide consistent and timely updates. Documentation and expertise requirements add further complexity, as configuring SSL properly demands specialized knowledge that may be scarce within development teams. Backward compatibility concerns often complicate maintenance, as updates must protect existing functionality while implementing necessary security improvements or fixes. </p><p>The complexity and risks associated with migrating to a new SSL library version often encourage product vendors to try to stick as long as possible to the same maintenance branch, preferably an LTS version provided by the operating system’s vendor. </p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-8.png/e48ae0541d139e9a7dac953cb09edd51/state-of-ssl-stacks-8.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-8.png/8d7b34ed1b1747c2d71755ef1f7f89b4/state-of-ssl-stacks-8.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-8.png/bb612fa46bedd4ce45440aaa8c260302/state-of-ssl-stacks-8.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-8.png/8d7b34ed1b1747c2d71755ef1f7f89b4/state-of-ssl-stacks-8.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-8.png/bb612fa46bedd4ce45440aaa8c260302/state-of-ssl-stacks-8.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-8.png/8d7b34ed1b1747c2d71755ef1f7f89b4/state-of-ssl-stacks-8.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-8.png/c613b8fe8873adba925228e9a05b96d2/state-of-ssl-stacks-8.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-8.png/9e5ccb70238a1a1d291c725ce0140a56/state-of-ssl-stacks-8.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-8.png/c613b8fe8873adba925228e9a05b96d2/state-of-ssl-stacks-8.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-8.png/c613b8fe8873adba925228e9a05b96d2/state-of-ssl-stacks-8.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-8.png/9e5ccb70238a1a1d291c725ce0140a56/state-of-ssl-stacks-8.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <h2 id="current-ssl-library-ecosystem">Current SSL library ecosystem</h2><h3 id="openssl">OpenSSL</h3><p>OpenSSL has served as the industry-standard SSL library included in most operating systems for many years. A key benefit has been its simultaneous support for multiple versions over extended periods, enabling users to carefully schedule upgrades, adapt their code to accommodate new versions, and thoroughly test them before implementation.</p><p>The introduction of OpenSSL 3.0 in September 2021 posed significant challenges to the stability of the SSL ecosystem, threatening its continued reliability and sustainability.</p><ol><li><p>This version was released nearly a <a target="_blank" href="https://www.mail-archive.com/openssl-project@openssl.org/msg02559.html">year</a> behind <a target="_blank" href="https://openssl-corporation.org/post/2019-11-07-3.0-update/">schedule</a>, thus shortening the available timeframe for migrating applications to the new version. </p></li><li><p>The migration process was challenging due to OpenSSL&#39;s API changes, such as the deprecation of many commonly used functions and the ENGINE API that external projects relied on. This affected solutions like the <a target="_blank" href="https://github.com/OpenSC/libp11">pkcs11 engine</a> used for Hardware Security Modules (HSM) and <a target="_blank" href="https://github.com/intel/QAT_Engine">Intel’s QAT engine</a> for hardware crypto acceleration, forcing engines to be rewritten with the new providers API. </p></li><li><p>Performance was also measurably lower in multi-threaded environments, making OpenSSL 3.0 unusable in many performance-dependent use cases. </p></li><li><p>OpenSSL also decided that the long-awaited QUIC API would finally <a target="_blank" href="https://www.mail-archive.com/openssl-project@openssl.org/msg02585.html">not be merged</a>, dealing a significant blow to innovators and early adopters of this technology. Developers and organizations were left without the key QUIC capabilities they had been counting on for their projects.</p></li><li><p>OpenSSL labeled version 3.0 as an LTS branch and shortly thereafter discontinued maintenance of the previous 1.1.1 LTS branch. This decision left many Linux distributions with no viable alternatives, compelling them to adopt the new version.</p></li></ol><p>Users with performance-critical requirements faced limited options: either remain on older distributions that still maintained their own version 1.1.1 implementations, deploy more servers to compensate for the performance loss, or purchase expensive extended premium support contracts and maintain their own packages.</p><h3 id="boringssl">BoringSSL</h3><p>BoringSSL is a fork of OpenSSL that was announced in 2014, after the <a target="_blank" href="https://heartbleed.com/">heartbleed</a> CVE. This library was initially meant for Google; projects that use it must follow the &#34;live at HEAD&#34; model. This can lead to maintenance challenges, since the API breaks frequently and no maintenance branches are provided.</p><p>However, it stands out in the SSL ecosystem for its willingness to implement bleeding-edge features. For example, it was the first OpenSSL-based library to implement the QUIC API, which other such libraries later adopted.</p><p>This library has been supported in the HAProxy community for some time now and has provided the opportunity to progress on the QUIC subject. While it was later abandoned because of its incompatibility with the HAProxy LTS model, we continue to keep an eye on it because it often produces valuable innovations.</p><h3 id="libressl">LibreSSL</h3><p>LibreSSL is a fork of OpenSSL 1.0.1 that also emerged after the heartbleed vulnerability, with the aim to be a more secure alternative to OpenSSL. It started with a massive cleanup of the OpenSSL code, removing a lot of legacy and infrequently used code in the OpenSSL API.</p><p>LibreSSL later provided the libtls API, a completely new API designed as a simpler and more secure alternative to the libssl API. However, since it&#39;s an entirely different API, applications require significant modifications to adopt it.</p><p>LibreSSL aims for a more secure SSL and tends to be less performant than other libraries. As such, features considered potentially insecure are not implemented, for example, 0-RTT. Nowadays, the project focuses on evolving its libssl API with some inspiration from BoringSSL; for example, the EVP_AEAD and QUIC APIs.</p><p>LibreSSL was ported to other operating systems in the form of the libressl-portable project. Unfortunately, it is rarely packaged in Linux distributions, and is typically used in BSD environments.</p><p>HAProxy does support LibreSSL—it is currently built and tested by our continuous integration (CI) pipeline—however, not all features are supported. LibreSSL implemented the BoringSSL QUIC API in 2022, and the HAProxy team successfully ported HAProxy to it with libressl 3.6.0. Unfortunately, LibreSSL does not implement all the API features needed to use HAProxy to its full potential. </p><h3 id="wolfssl">WolfSSL</h3><p>WolfSSL is a TLS library which initially targeted the embedded world. This stack is not a fork of OpenSSL but offers a compatibility layer, making it simpler to port applications.</p><p>Back in 2012, we tested its predecessor, cyaSSL. It had relatively good performance but lacked too many features to be considered for use. Since that time, the library has evolved with the addition of many consequential features (TLS 1.3, QUIC, etc.) while still keeping its lightweight approach and even providing a FIPS-certified cryptographic module. </p><p>In 2022, we started a port of HAProxy to WolfSSL with the help of the WolfSSL team. There were bugs and missing features in the OpenSSL compatibility layer, but as of WolfSSL 5.6.6, it became a viable option for simple setups or embedded systems. It was successfully ported to the HAProxy CI and, as such, is regularly built and tested with up-to-date WolfSSL versions.</p><p>Since WolfSSL is not OpenSSL-based at all, some behavior could change, and not all features are supported. HAProxy SSL features were designed around the OpenSSL API; this was the first port of HAProxy to an SSL library not based on the OpenSSL API, which makes it difficult to perfectly map existing features. As a result, some features occasionally require minor configuration adaptations.</p><p>We&#39;ve been working with the WolfSSL team to ensure their library can be seamlessly integrated with HAProxy in mainstream Linux distributions, though this integration is still under development (<a target="_blank" href="https://github.com/wolfSSL/wolfssl/issues/6834">https://github.com/wolfSSL/wolfssl/issues/6834</a>).</p><p>WolfSSL is available in Ubuntu and Debian, but unfortunately, specific build options that are needed for HAProxy and CPU optimization are not activated by default. As a result, it needs to be installed and maintained manually, which can be bothersome.</p><h3 id="aws-lc">AWS-LC</h3><p>AWS-LC is a BoringSSL (and by extension OpenSSL) fork that started in 2019. It is intended for AWS and its customers. AWS-LC targets security and performance (particularly on AWS hardware). Unlike BoringSSL, it aims for a backward-compatible API, making it easy to maintain.</p><p>We were recently approached by the AWS team, who provided us with patches to make HAProxy compatible with AWS-LC, enabling us to test them together regularly via CI. Since HAProxy was ported to BoringSSL in the past, we inherited a lot of features that were already working with it.</p><p>AWS-LC supports modern TLS features and QUIC. In HAProxy, it supports the same features as OpenSSL 1.1.1, but it lacks some older ciphers which are not used anymore (CCM, DHE). It also lacks the engine support that was already removed in BoringSSL.</p><p>It does provide a FIPS-certified cryptographic module, which is periodically submitted for FIPS validation.</p><h3 id="other-libraries">Other libraries</h3><p>Mbedtls, GnuTLS, and other libraries have also been considered; however, they would require extensive rewriting of the HAProxy SSL code. We didn&#39;t port HAProxy to these libraries because the available feature sets did not justify the amount of up-front work and maintenance effort required.</p><p>We also tested Rustls and its rustls-openssl-compat layer. Rustls could be an interesting library in the future, but the OpenSSL compatibility application binary interface (ABI) was not complete enough to make it work correctly with HAProxy in its current state. Using the native Rustls API would again require extensive rewriting of HAProxy code.</p><p>We also routinely used QuicTLS (openssl+quic) during our QUIC development. However, it does not diverge enough from OpenSSL to be considered a different library, as it is really distributed as a patchset applied on top of OpenSSL.</p><h2 id="an-introduction-to-quic-and-how-it-relates-to-ssl-libraries">An introduction to QUIC and how it relates to SSL libraries</h2><p>QUIC is an encrypted, multiplexed transport protocol that is mainly used to transport HTTP/3. It combines some of the benefits of TCP, TLS, and HTTP/2, without many of their drawbacks. It started as research work at Google in 2012 and was deployed at scale in combination with the Chrome browser in 2014. In 2015, the IETF QUIC working group was created to standardize the protocol, and published the first draft (draft-ietf-quic-transport-00) on Nov 28th, 2016. In 2020, the new IETF QUIC protocol differed quite a bit from the original one and started to be widely adopted by browsers and some large hosting providers. Finally, the protocol was published as RFC9000 in 2021.</p><p>One of the key goals of the protocol is to move the congestion control to userland so that application developers can experiment with new algorithms, without having to wait for operating systems to implement and deploy them. It integrates cryptography at its heart, contrary to classical TLS, which is only an additional layer on top of TCP.</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/userland-applicationand-operating-system-kernel-diagram.png/f82413a2644e85e61ca72fa66e00f1b3/userland-applicationand-operating-system-kernel-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/userland-applicationand-operating-system-kernel-diagram.png/899a1d5fbe6f242e589d8411e8c5e960/userland-applicationand-operating-system-kernel-diagram.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/userland-applicationand-operating-system-kernel-diagram.png/5737ddbebeafd91cb98815429cb1a2ed/userland-applicationand-operating-system-kernel-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/userland-applicationand-operating-system-kernel-diagram.png/899a1d5fbe6f242e589d8411e8c5e960/userland-applicationand-operating-system-kernel-diagram.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/userland-applicationand-operating-system-kernel-diagram.png/5737ddbebeafd91cb98815429cb1a2ed/userland-applicationand-operating-system-kernel-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/userland-applicationand-operating-system-kernel-diagram.png/899a1d5fbe6f242e589d8411e8c5e960/userland-applicationand-operating-system-kernel-diagram.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/userland-applicationand-operating-system-kernel-diagram.png/304a0664efc1af8051a0f6bb93bf3683/userland-applicationand-operating-system-kernel-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/userland-applicationand-operating-system-kernel-diagram.png/007d76e462cd51b7f55bac63eb90a199/userland-applicationand-operating-system-kernel-diagram.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/userland-applicationand-operating-system-kernel-diagram.png/304a0664efc1af8051a0f6bb93bf3683/userland-applicationand-operating-system-kernel-diagram.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/userland-applicationand-operating-system-kernel-diagram.png/304a0664efc1af8051a0f6bb93bf3683/userland-applicationand-operating-system-kernel-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/userland-applicationand-operating-system-kernel-diagram.png/007d76e462cd51b7f55bac63eb90a199/userland-applicationand-operating-system-kernel-diagram.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>A full-stack web application relies on these key components:</p><ul><li><p>HTTP/1, HTTP/2, HTTP/3 implementations (in-house or libraries)</p></li><li><p>A QUIC implementation (in-house or library)</p></li><li><p>A TLS library shared between these 3 protocol implementations</p></li><li><p>The rest (below) is the regular UDP/TCP kernel sockets</p></li></ul>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/web-application-diagram.png/04066468204e6870afe50df819088174/web-application-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/web-application-diagram.png/3d60f9ef3e2f69947ee7ed1269fab0fc/web-application-diagram.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/web-application-diagram.png/10f1b060635b5707a498385f8a9019ae/web-application-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/web-application-diagram.png/3d60f9ef3e2f69947ee7ed1269fab0fc/web-application-diagram.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/web-application-diagram.png/10f1b060635b5707a498385f8a9019ae/web-application-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/web-application-diagram.png/3d60f9ef3e2f69947ee7ed1269fab0fc/web-application-diagram.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/web-application-diagram.png/385c8d7b3f8861f7274a801c999182e7/web-application-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/web-application-diagram.png/01dce8f21a34e21da9a821df0f103d9c/web-application-diagram.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/web-application-diagram.png/385c8d7b3f8861f7274a801c999182e7/web-application-diagram.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/web-application-diagram.png/385c8d7b3f8861f7274a801c999182e7/web-application-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/web-application-diagram.png/01dce8f21a34e21da9a821df0f103d9c/web-application-diagram.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>Overall, this integrates pretty well, and various QUIC implementations started very early, in order to validate some of the new protocol’s concepts and provide feedback to help them evolve. Some implementations are specific to a single project, such as HAProxy’s QUIC implementation, while others, such as <a target="_blank" href="https://github.com/ngtcp2/ngtcp2">ngtcp2</a>, are made to be portable and easy to adopt by common applications.</p><p>During all this work, the need for new TLS APIs was identified in order to permit a QUIC implementation to access some essential elements conveyed in TLS records, and the required changes were introduced in BoringSSL (Google’s fork of OpenSSL). This has been the only TLS library usable by QUIC implementations for both clients and servers for a long time. One of the difficulties with working with BoringSSL is that it evolves quickly and is not necessarily suitable for products maintained for a long period of time, because new versions regularly break the build, due to changes in BoringSSL&#39;s public API.</p><p>In February 2020, <a target="_blank" href="https://github.com/openssl/openssl/pull/8797">Todd Short opened a pull request</a> (PR) on OpenSSL’s GitHub repository to propose a BoringSSL-compatible implementation of the QUIC API in OpenSSL. The additional code adds a few callbacks at some key points, allowing existing QUIC implementations such as <a target="_blank" href="https://github.com/microsoft/msquic/">MsQuic</a>, <a target="_blank" href="https://github.com/ngtcp2/ngtcp2">ngtcp2</a>, <a target="_blank" href="https://github.com/haproxy/haproxy">HAProxy</a>, and others to support OpenSSL in addition to BoringSSL. It was extremely well-received by the community. However, the OpenSSL team <a target="_blank" href="https://github.com/openssl/openssl/pull/8797#issuecomment-517750097">preferred</a> <a target="_blank" href="https://openssl-library.org/post/2020-02-13-quic-and-openssl/">to keep</a> <a target="_blank" href="https://github.com/openssl/openssl/pull/8797#issuecomment-582970318">that work on hold</a> until OpenSSL 3.0 was released; they did not reconsider this choice later, even though the schedule was drifting. During this time, developers from Akamai and Microsoft created QuicTLS. This new project essentially took the latest stable versions of OpenSSL and applied the patchset on top of it. QuicTLS soon became the de facto standard TLS library for QUIC implementations that were patiently waiting for OpenSSL 3.0 to be released and for this PR to get merged.</p><p>Finally, three years later, the OpenSSL team <a target="_blank" href="https://www.mail-archive.com/openssl-project@openssl.org/msg02585.html">announced</a> that they were not going to integrate that work and instead would create a whole new QUIC implementation from scratch. This was <a target="_blank" href="https://github.com/openssl/openssl/pull/8797#issuecomment-942735379">not what users needed or asked for</a> and threw away years of proven work from the QUIC community. This shocking move provoked a strong reaction from the community, who had invested a lot of effort in OpenSSL via QuicTLS, but were left to find another solution: either the fast-moving BoringSSL or a more officially maintained variant of QuicTLS. </p><p>In parallel, other libs including WolfSSL, LibreSSL, and AWS-LC adopted the de facto standard BoringSSL QUIC API. </p><p>Finally, OpenSSL continues to mention QUIC in their projects, though their current focus seems to be to <a target="_blank" href="https://www.mail-archive.com/openssl-project@openssl.org/msg02585.html">deliver a single-stream-capable minimum viable product (MVP</a>) that should be sufficient for the command-line &#34;s_client&#34; tool. However, this approach still doesn’t offer the API that QUIC implementations <a target="_blank" href="https://daniel.haxx.se/blog/2019/01/21/quic-and-missing-apis/">have been waiting for</a> over the last four years, forcing them to turn to QuicTLS. </p><p>The development of a transport layer like QUIC requires a totally different skillset than cryptographic library development. Such development work must be done with full transparency. The development team has degraded their project’s quality, failed to address ongoing issues, and consistently dismissed widespread community requests for even minor improvements. Validating these concerns, Curl contributor Stefan Eissing <a target="_blank" href="https://github.com/openssl/openssl/discussions/23339#discussioncomment-9627091">recently tried to make use of OpenSSL’s QUIC implementation</a> with Curl and <a target="_blank" href="https://github.com/icing/blog/blob/main/curl-h3-performance.md">published his findings</a>.They’re clearly not appealing, as most developers concerned about this topic would have expected.</p><p>In despair at this situation, we at HAProxy tried to figure out from the QUIC patch set if there could be a way to hack around OpenSSL without patching it, and we were clearly not alone. Roman Arutyunyan from NGINX core team were the first to <a target="_blank" href="https://mailman.nginx.org/pipermail/nginx-devel/2023-February/C75K3FSDCMMP7WUTRBPEE7IGDTU766DP.html">propose a solution</a> with a clever method that abuses the <em>keylog</em> callback to make it possible to extract or inject the required elements, and finally make it possible to have a minimal server-mode QUIC support. We adopted it as well, so users could start to familiarize themselves with QUIC and its impacts on their infrastructure, even though it does have some technical limitations (e.g., 0-RTT is not supported). This solution is only for servers, however; this hack may not work for clients (though this works for HAProxy, since QUIC is only implemented at the frontend at the moment).</p><p>With all that in mind, the possible choices of TLS libraries for QUIC implementations in projects designed around OpenSSL are currently quite limited:</p><ul><li><p>QuicTLS: closest to OpenSSL, the most likely to work well as a replacement for OpenSSL, but now suffers from OpenSSL 3+ unsolved technical problems (more on that below), since QuicTLS is rebased on top of OpenSSL</p></li><li><p>AWS-LC: fairly complete, maintained, frequent releases, pretty fast, but no dedicated LTS branch for now</p></li><li><p>WolfSSL: less complete, more adaptable, very fast, also offers support contracts, so LTS is probably negotiable</p></li><li><p>LibreSSL: comes with OpenBSD by default, lacks some features and optimisations compared to OpenSSL, but works out of the box for small sites</p></li><li><p>NGINX’s hack: servers only, works out of the box with OpenSSL (no TLS rebuild needed), but has a few limitations, and will also suffer from OpenSSL 3+ unsolved technical problems</p></li><li><p>BoringSSL: where it all comes from, but moves too fast for many projects</p></li></ul><p>This unfortunate situation considerably <a target="_blank" href="https://github.com/openssl/openssl/pull/8797#issuecomment-943368428">hurts</a> <a target="_blank" href="https://daniel.haxx.se/blog/2024/06/10/http-3-in-curl-mid-2024/">QUIC</a> <a target="_blank" href="https://daniel.haxx.se/blog/2021/10/25/the-quic-api-openssl-will-not-provide/">protocol</a> <a target="_blank" href="https://github.com/openssl/openssl/pull/8797#issuecomment-883901176">adoption</a>. It even makes it difficult to develop or build test tools to monitor a QUIC server. From an industry perspective, it looks like either WolfSSL or AWS-LC needs to offer LTS versions of their products to potentially move into a market-leading position. This would potentially obsolete OpenSSL and eliminate the need for the QuicTLS effort.</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-5.png/ab82ca2b6cff5774051b2148737cc1fa/state-of-ssl-stacks-5.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-5.png/f11f407a849eeb9a1c00ccd5c861a43b/state-of-ssl-stacks-5.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-5.png/fa48c2c8d9fad0213cf952e6230f641e/state-of-ssl-stacks-5.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-5.png/f11f407a849eeb9a1c00ccd5c861a43b/state-of-ssl-stacks-5.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-5.png/fa48c2c8d9fad0213cf952e6230f641e/state-of-ssl-stacks-5.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-5.png/f11f407a849eeb9a1c00ccd5c861a43b/state-of-ssl-stacks-5.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-5.png/fe78b65723e2e19ebd360115a8504731/state-of-ssl-stacks-5.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-5.png/5972164566da247e5f130b4cd1ea43ba/state-of-ssl-stacks-5.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-5.png/fe78b65723e2e19ebd360115a8504731/state-of-ssl-stacks-5.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-5.png/fe78b65723e2e19ebd360115a8504731/state-of-ssl-stacks-5.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-5.png/5972164566da247e5f130b4cd1ea43ba/state-of-ssl-stacks-5.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <h2 id="performance-issues">Performance issues</h2><p>In SSL, performance is the most critical aspect. There are indeed very expensive operations performed at the beginning of a connection before the communication can happen. If connections are closed fast (service reloads, scale up/down, switch-over, peak connection hours, attacks, etc.), it is very easy for a server to be overwhelmed and stop responding, which in turn can make visitors try again and add even more traffic. This explains why SSL frontend gateways tend to be very powerful systems with lots of CPU cores that are able to handle traffic surges without degrading service quality.</p><p>During performance testing performed in collaboration with Intel, which led to optimizations reflected in <a target="_blank" href="https://networkbuilders.intel.com/docs/networkbuilders/intel-quickassist-technology-intel-qat-accelerating-haproxy-performance-on-4th-gen-intel-xeon-scalable-processors-technology-guide-1686048444.pdf">this document</a>, we encountered an unexpected bottleneck. We found ourselves stuck with the “<a href="https://github.com/wtarreau/h1load">h1load</a>” generator unable to produce more than 400 connections per second on a 48-core machine. After extensive troubleshooting, traces showed that threads were waiting for each other inside the <em>libcrypto</em> component (part of the OpenSSL library). The load generators were set up on Ubuntu 22.04, which comes with OpenSSL 3.0.2. Rebuilding OpenSSL 1.1.1 and linking against it instantly solved the problem, unlocking 140,000 connections per second. Several team members involved in the tests got trapped linking tools against OpenSSL 3.0, eventually realizing that this version was fundamentally unsuitable for client-based performance testing purposes.</p><p>The performance problems we encountered were part of a much broader pattern. Numerous users reported performance degradation with OpenSSL 3; there is even a meta-issue created to try to centralize information about this massive performance regression that affects many areas of the library (<a target="_blank" href="https://github.com/OpenSSL/OpenSSL/issues/17627">https://github.com/OpenSSL/OpenSSL/issues/17627</a>). Among them, there were reports about <a target="_blank" href="https://github.com/nodejs/node/issues/43128">nodejs’ performance being divided by seven</a> when used as a client, other tools showing a <a target="_blank" href="https://github.com/openssl/openssl/issues/20286">20x processing time increase</a>, a <a target="_blank" href="https://github.com/openssl/openssl/issues/17064">30x CPU increase on threaded applications</a> that was similar to the load generator problem, and numerous others.</p><p>Despite the huge frustration caused by the QUIC API rejection, we were still eager to try to help OpenSSL spot and address the massive performance regression. We’ve participated with others to try to explain to the OpenSSL team the root cause of the problem, providing detailed measurements, graphs, and lock counts, such as <a target="_blank" href="https://github.com/openssl/openssl/issues/20286#issuecomment-1527869072">here</a>. OpenSSL responded by saying <a target="_blank" href="https://github.com/openssl/openssl/issues/20286#issuecomment-1533263544">“we’re not going to reimplement locking callbacks because embedded systems are no longer the target”</a> (when speaking about an Intel Xeon with 32GB RAM), and even suggested that <a target="_blank" href="https://github.com/openssl/openssl/issues/20286#issuecomment-1535924755">pull requests fixing the problems are welcome</a>, as if it was trivial for a third party to fix the issues that had caused the performance degradation.</p><p>The disconnect between user experience and developer perspective was highlighted in recent discussions, further exemplified by the complete absence of a culture of performance testing. This lack of performance testing was glaringly evident when a developer, after asking users to test their patches, admitted to <a target="_blank" href="https://github.com/openssl/openssl/issues/20286#issuecomment-1547053752">not conducting testing themselves due to a lack of hardware</a>. It was then suggested that the project should just publicly call for hardware access (and this was apparently resolved within a week or two), and by this time, the performance testing of proposed patches was finally conducted by participants outside of the project, namely from Akamai, HAProxy, and Microsoft.</p><p>When some of the project members considered a <a target="_blank" href="https://github.com/openssl/openssl/issues/20286#issuecomment-1941125159">32% performance regression “pretty near” the original performance</a>, it signaled to our development team that any meaningful improvement was unlikely. The lack of hardware for testing indicates that the project is unwilling or unable to direct sufficient resources to address the problems, and the only meaningful metric probably is the number of open issues. Nowadays, projects using OpenSSL are starting to lose faith and are <a target="_blank" href="https://github.com/DataDog/integrations-core/pull/17669">adding options to link against alternative libraries</a>, since the situation has stagnated over the last three years – a trend that aligns with our own experience and observations.</p><h3 id="deep-dive-into-the-exact-problem">Deep dive into the exact problem</h3><p>Prior to OpenSSL 1.1.0, OpenSSL relied on a simple and efficient locking API. Applications using threads would simply initialize the OpenSSL API and pass a few pointers to the functions to be used for locking and unlocking. This had the merit of being compatible with whatever threading model an application uses. With OpenSSL 1.1.0, this function is ignored, and OpenSSL exclusively relies on the locks offered by the standard Pthread library, which can already be significantly heavier than what an application used to rely on.</p><p>At that time, while locks were implemented in many places, they were rarely used in exclusive mode, and not on the most common code paths. For example, we noticed heavy usage when using crypto engines, to the point of being the main bottleneck; quite a bit on session resume and cache access, but less on the rest of the code paths.</p><p>During our tests of the Intel QAT engine two years ago, we already noticed that OpenSSL 1.1.1 could make an immoderate use of locking in the engine API, causing extreme contention past 16 threads. This was tolerable, considering that engines were an edge case that was probably harder to test and optimize than the rest of the code. By seeing that these were just pthread_rwlocks and that we already had a lighter implementation of read-write locks, we had the idea to provide our own pthread_rwlock functions relying on our low-overhead locks (“lorw”), so that the OpenSSL library would use those instead of the legacy pthread_rwlocks. This proved extremely effective at pushing the contention point much higher. Thanks to this improvement, the code was eventually merged, and a build-time option was added to enable this alternate locking mechanism: USE_PTHREAD_EMULATION. We’ll see further that this option will be exploited again in order to measure what can be attributed to locking only.</p><p>With OpenSSL 3.0, an <a target="_blank" href="https://www.mail-archive.com/openssl-project@openssl.org/msg02585.html">important goal</a> was apparently to make the library much more dynamic, with a lot of previously constant elements (e.g., algorithm identifiers, etc.) becoming dynamic and having to be looked up in a list instead of being fixed at compile-time. Since the new design allows anyone to update that list at runtime, <a target="_blank" href="https://github.com/openssl/openssl/discussions/22900">locks were placed</a> everywhere when accessing the list to ensure consistency. These lists are apparently scanned to find very basic configuration elements, so this operation is performed a lot. In one of the measurements provided to the team and linked to above, it was shown that the number of read locks (non-exclusive) jumped 5x compared with OpenSSL 1.1.1 just for the server mode, which is the least affected one. The measurement couldn’t be done in client mode since it just didn’t work at all; timeouts and watchdog were hitting every few seconds.</p><p>As you’ll see below, just changing the locking mechanism reveals pretty visible performance gains, proving that locking abuse is the main cause of the performance degradation that affects OpenSSL 3.0.</p><p>OpenSSL 3.1 tried to partially address the problem by placing a few atomic operations instead of locks where it appeared possible. The problem remains that the architecture was probably designed to be way more dynamic than necessary, making it unfit for performance-critical workloads, and this was clearly visible in the performance reports of the issues above.</p><p>There are two remaining issues at the moment:</p><ul><li><p>After everything imaginable was done, the performance of OpenSSL 3.x remains highly inferior to that of OpenSSL 1.1.1. The ratio is hard to predict, as it depends heavily on the workload, but losses from 10% to 99% were reported.</p></li><li><p>In a rush to get rid of OpenSSL 1.1.1, the OpenSSL team declared its end of life before 3.0 was released, then postponed the release of 3.0 by more than a year without adjusting 1.1.1’s end of life date. When 3.0 was finally emitted, 1.1.1 had little remaining time to live, so they had to declare 3.0 “long term supported”. This means that this shiny new version, with a completely new architecture that had not been sufficiently tested yet, would become the one provided by various operating systems for several years, since they all need multiple years of support. It turns out that this version proved to be dramatically worse in terms of performance and reliability than any other version ever released.</p></li></ul><p>End users are facing a dead end:</p><ul><li><p>Operating systems now ship with 3.0, which is literally unusable for certain users.</p></li><li><p>Distributions that were shipping 1.1.1 are progressively reaching end of support (except those providing extended support, but few people use these distributions, and they’re often paid).</p></li><li><p>OpenSSL 1.1.1 is no longer supported for free by the OpenSSL team, so many users cannot safely use it.</p></li></ul><p>These issues <a target="_blank" href="https://github.com/haproxy/haproxy/issues/2169">sparked</a> <a target="_blank" href="https://github.com/haproxy/haproxy/issues/2645">significant</a> <a target="_blank" href="https://github.com/haproxy/haproxy/issues/2454">concern</a> within the HAProxy community, fundamentally shifting their priorities. While they had initially been focused on forward-looking questions such as, &#34;which library should we use to implement QUIC?&#34;, they were now forced to grapple with a more basic survival concern: &#34;which SSL library will allow our websites to simply stay operational?&#34; The performance problems were so severe that basic functionality, rather than new feature support, had become the primary consideration. </p><h3 id="performance-testing-results">Performance testing results</h3><p>HAProxy already supported alternative libraries, but the support was mostly incomplete due to API differences. The new performance problem described above forced us to speed up the full adoption of alternatives. At the moment, HAProxy <a target="_blank" href="https://github.com/haproxy/wiki/wiki/SSL-Libraries-Support-Status">supports</a> multiple SSL libraries in addition to OpenSSL: QuicTLS, LibreSSL, WolfSSL, and AWS-LC. QuicTLS is not included in the testing since it is simply OpenSSL plus the QUIC patches, which do not impact performance. LibreSSL is not included in the tests because its focus is primarily on code correctness and auditability, and we already noticed some significant performance losses there - probably related to the removal of certain assembler implementations of algorithms and simplifications of certain features.</p><p>We included various versions of OpenSSL from 1.1.1 to the latest 3.4-dev (at the time), in order to measure the performance loss of 3.x compared with 1.1.1 and identify any progress made by the OpenSSL team to fix the regression. OpenSSL version 3.0.2 was specifically mentioned because it is shipped in Ubuntu 22.04, where most users face the problem after upgrading from Ubuntu 20.04, which ships the venerable OpenSSL 1.1.1. The HAProxy version used for testing was: HAProxy version 3.1-dev1-ad946a-33 2024/06/26</p><p>Testing scenarios:</p><ul><li><p><strong>Server-only mode with full TLS handshake</strong>: This is the most critical and common use for internet-facing web equipment (servers and load balancers), because it requires extremely expensive asymmetric cryptographic operations. The performance impact is especially concerning because it is the absolute worst case, and a new handshake can be imposed by the client at any time. For this reason, it is also often an easy target for denial of service attacks.</p></li><li><p><strong>End-to-end encryption with TLS resumption</strong>: The resumption approach is the most common on the backend to reach the origin servers. Security is especially important in today’s virtualized environments, where network paths are unclear. Since we don’t want to inflict a high load on the server, TLS sessions are resumed on new TCP connections. We’re just doing the same on the frontend to match the common case for most sites.</p></li></ul><p>Testing variants:</p><ul><li><p>Two locking options (standard Pthread locking and HAProxy’s low-overhead locks)</p></li><li><p>Multiple SSL libraries and versions</p></li></ul><p>Testing environment:</p><ul><li><p>All tests will be running on AWS r8g.16xlarge instance, running 64 Graviton4 cores (ARM Neoverse V2)</p></li></ul><h4 id="server-only-mode-with-full-tls-handshake">Server only mode with Full TLS Handshake</h4>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/initial-full-handshake.png/1ec5d166e2791acaec796435aff9cabf/initial-full-handshake.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/initial-full-handshake.png/482f3d2a27c0d1d8d10d42b1a3688987/initial-full-handshake.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/initial-full-handshake.png/1ee544cde41cf568478d3cde0acc77bb/initial-full-handshake.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/initial-full-handshake.png/482f3d2a27c0d1d8d10d42b1a3688987/initial-full-handshake.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/initial-full-handshake.png/1ee544cde41cf568478d3cde0acc77bb/initial-full-handshake.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/initial-full-handshake.png/482f3d2a27c0d1d8d10d42b1a3688987/initial-full-handshake.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/initial-full-handshake.png/176192ca5bd92e58634e6ca6ef487371/initial-full-handshake.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/initial-full-handshake.png/53d6adfd095b1790ea86076b3c85f032/initial-full-handshake.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/initial-full-handshake.png/176192ca5bd92e58634e6ca6ef487371/initial-full-handshake.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/initial-full-handshake.png/176192ca5bd92e58634e6ca6ef487371/initial-full-handshake.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/initial-full-handshake.png/53d6adfd095b1790ea86076b3c85f032/initial-full-handshake.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>In this test, clients will:</p><ol><li><p>Connect to the server (HAProxy in this case)</p></li><li><p>Perform a single HTTP request</p></li><li><p>Close the connection</p></li></ol><p>In this simplified scenario, to simulate the most ideal conditions, backend servers are not involved because they have a negligible impact, and HAProxy can directly respond to client requests. When they reconnect, they never try to resume an existing session, and instead always perform a new connection. Using RSA, this use case is very inexpensive for the clients and very expensive for the server. This use case represents a surge of new visitors (which causes a key exchange); for example, a site that suddenly becomes popular after an event (e.g., news sites). In such tests, a ratio of 1:10 to 1:15 in terms of performance between the client and the server is usually sufficient to saturate the server. Here, the server has 64 cores, but we’ll keep a 32-core client, which will be largely enough.</p><p>The performance of the machine running the different libraries is measured in number of new connections per second. It was always verified that the machine saturates its CPU. The first test is with the regular build of HAProxy against the libraries (i.e., HAProxy doesn’t emulate the pthread locks, but lets the libraries use them):</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png/a8be2120757794e0ae964a8822beaa5c/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png/9141d90d83415f01eab810616de51df2/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png/e58d8149a02790bd6feb95928dc72f0b/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png/9141d90d83415f01eab810616de51df2/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png/e58d8149a02790bd6feb95928dc72f0b/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png/9141d90d83415f01eab810616de51df2/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png/c0ae70a88e1429f34cb76ef2249652f1/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png/859039028792215fb05f494dc4c5decc/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png/c0ae70a88e1429f34cb76ef2249652f1/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png/c0ae70a88e1429f34cb76ef2249652f1/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png/859039028792215fb05f494dc4c5decc/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-4.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>Two libraries stand out at the top and the bottom. At the top, above 63000 connections per second, in light blue, we’re seeing the latest version of AWS-LC (30 commits after v1.32.0), which includes important CPU-level optimizations for RSA calculations. Previous versions did not yield such results due to <a target="_blank" href="https://github.com/aws/aws-lc/commit/d3fa1f237b">a mistake in the code</a> that failed to properly detect the processor and enable the appropriate optimizations. The second fastest library, in orange, was WolfSSL 5.7.0. For a long time, we’ve known this library for being heavily optimized to run fast on modest hardware, so we’re not surprised and even pleased to see it in the top on such a powerful machine.</p><p>In the middle, around 48000 connections per second, or 25% lower, are OpenSSL 1.1.1 and the previous version of AWS-LC (~45k), version 1.29.0. Below those two, around 42500 connections per second, are the latest versions of OpenSSL (3.1, 3.2, 3.3 and 3.4-dev). At the bottom, around 21000 connections per second, are both OpenSSL 3.0.2 and 3.0.14, the latest 3.0 version at the time of testing.</p><p>What is particularly visible on this graph is that aside from the two versions that specifically optimize for this processor, all other libraries remained grouped until around 12-16 threads. After that point, the libraries start to diverge, with the two flavors of OpenSSL 3.0 staying at the bottom and reaching their maximum performance and plateau around 32 threads. Thus, this is not a cryptography optimization issue; it&#39;s a scalability issue.</p><p>When comparing the profiling output of OpenSSL 1.1.1 and 3.0.14 for this test, the difference is obvious.</p><p>OpenSSL 1.1.1w:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            
            
            
            
            



<div>

    
        
    

    <div>
        <div translate="no" data-color-mode="light" data-light-theme="light">
      <div>
        <div>
  <div id="file-blog20250429-01-sh">
    
    <div itemprop="text" tabindex="0" role="region" aria-label="blog20250429-01.sh content, created by haproxytechblog on 05:49PM on April 29.">

        
<div>

  <template>
  <div data-view-component="true">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <p><span>
      This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span></p>
</div></template>
<template>
  <span aria-label="This line has hidden Unicode characters" data-view-component="true">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
</span></template>

  <table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="blog20250429-01.sh">
        <tbody><tr>
          <td id="file-blog20250429-01-sh-L1" data-line-number="1"></td>
          <td id="file-blog20250429-01-sh-LC1"> 46.29%  libcrypto.so.1.1   	[.] __bn_sqr8x_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L2" data-line-number="2"></td>
          <td id="file-blog20250429-01-sh-LC2">  14.73%  libcrypto.so.1.1   	[.] __bn_mul4x_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L3" data-line-number="3"></td>
          <td id="file-blog20250429-01-sh-LC3">  13.01%  libcrypto.so.1.1   	[.] MOD_EXP_CTIME_COPY_FROM_PREBUF</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L4" data-line-number="4"></td>
          <td id="file-blog20250429-01-sh-LC4">   2.05%  libcrypto.so.1.1   	[.] __ecp_nistz256_mul_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L5" data-line-number="5"></td>
          <td id="file-blog20250429-01-sh-LC5">   1.06%  libcrypto.so.1.1   	[.] sha512_block_armv8</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L6" data-line-number="6"></td>
          <td id="file-blog20250429-01-sh-LC6">   0.95%  libcrypto.so.1.1   	[.] __ecp_nistz256_sqr_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L7" data-line-number="7"></td>
          <td id="file-blog20250429-01-sh-LC7">   0.61%  libcrypto.so.1.1   	[.] ecp_nistz256_point_double</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L8" data-line-number="8"></td>
          <td id="file-blog20250429-01-sh-LC8">   0.54%  libcrypto.so.1.1   	[.] bn_mul_mont_fixed_top</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L9" data-line-number="9"></td>
          <td id="file-blog20250429-01-sh-LC9">   0.52%  [kernel]           	[k] default_idle_call</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L10" data-line-number="10"></td>
          <td id="file-blog20250429-01-sh-LC10">   0.51%  libc.so.6          	[.] malloc</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L11" data-line-number="11"></td>
          <td id="file-blog20250429-01-sh-LC11">   0.51%  libc.so.6          	[.] _int_free</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L12" data-line-number="12"></td>
          <td id="file-blog20250429-01-sh-LC12">   0.50%  libcrypto.so.1.1   	[.] BN_mod_exp_mont_consttime</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L13" data-line-number="13"></td>
          <td id="file-blog20250429-01-sh-LC13">   0.49%  libcrypto.so.1.1   	[.] ecp_nistz256_sqr_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L14" data-line-number="14"></td>
          <td id="file-blog20250429-01-sh-LC14">   0.46%  libc.so.6          	[.] _int_malloc</td>
        </tr>
        <tr>
          <td id="file-blog20250429-01-sh-L15" data-line-number="15"></td>
          <td id="file-blog20250429-01-sh-LC15">   0.43%  libcrypto.so.1.1   	[.] OPENSSL_cleanse</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      
    </div>
    </div>

    
</div>
            
            
            
            
        
            <p>OpenSSL 3.0.14:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            
            
            
            
            



<div>

    

    <div>
        <div translate="no" data-color-mode="light" data-light-theme="light">
      <div>
        <div>
  <div id="file-blog20250429-02-sh">
    
    <div itemprop="text" tabindex="0" role="region" aria-label="blog20250429-02.sh content, created by haproxytechblog on 05:49PM on April 29.">

        
<div>

  <template>
  <div data-view-component="true">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <p><span>
      This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span></p>
</div></template>
<template>
  <span aria-label="This line has hidden Unicode characters" data-view-component="true">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
</span></template>

  <table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="blog20250429-02.sh">
        <tbody><tr>
          <td id="file-blog20250429-02-sh-L1" data-line-number="1"></td>
          <td id="file-blog20250429-02-sh-LC1">  19.12%  libcrypto.so.3          	[.] __bn_sqr8x_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L2" data-line-number="2"></td>
          <td id="file-blog20250429-02-sh-LC2">  17.33%  libc.so.6               	[.] __aarch64_ldadd4_acq</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L3" data-line-number="3"></td>
          <td id="file-blog20250429-02-sh-LC3">  15.14%  libc.so.6               	[.] pthread_rwlock_unlock@@GLIBC_2.34</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L4" data-line-number="4"></td>
          <td id="file-blog20250429-02-sh-LC4">  12.48%  libc.so.6               	[.] pthread_rwlock_rdlock@@GLIBC_2.34</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L5" data-line-number="5"></td>
          <td id="file-blog20250429-02-sh-LC5">   8.55%  libc.so.6               	[.] __aarch64_cas4_rel</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L6" data-line-number="6"></td>
          <td id="file-blog20250429-02-sh-LC6">   6.04%  libcrypto.so.3          	[.] __bn_mul4x_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L7" data-line-number="7"></td>
          <td id="file-blog20250429-02-sh-LC7">   5.39%  libcrypto.so.3          	[.] MOD_EXP_CTIME_COPY_FROM_PREBUF</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L8" data-line-number="8"></td>
          <td id="file-blog20250429-02-sh-LC8">   1.59%  libcrypto.so.3          	[.] __ecp_nistz256_mul_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L9" data-line-number="9"></td>
          <td id="file-blog20250429-02-sh-LC9">   0.80%  libcrypto.so.3          	[.] __aarch64_ldadd4_relax</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L10" data-line-number="10"></td>
          <td id="file-blog20250429-02-sh-LC10">   0.74%  libcrypto.so.3          	[.] __ecp_nistz256_sqr_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L11" data-line-number="11"></td>
          <td id="file-blog20250429-02-sh-LC11">   0.53%  libcrypto.so.3          	[.] __aarch64_ldadd8_relax</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L12" data-line-number="12"></td>
          <td id="file-blog20250429-02-sh-LC12">   0.50%  libcrypto.so.3          	[.] ecp_nistz256_point_double</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L13" data-line-number="13"></td>
          <td id="file-blog20250429-02-sh-LC13">   0.43%  libcrypto.so.3          	[.] sha512_block_armv8</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L14" data-line-number="14"></td>
          <td id="file-blog20250429-02-sh-LC14">   0.30%  libcrypto.so.3          	[.] ecp_nistz256_sqr_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L15" data-line-number="15"></td>
          <td id="file-blog20250429-02-sh-LC15">   0.24%  libc.so.6               	[.] malloc</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L16" data-line-number="16"></td>
          <td id="file-blog20250429-02-sh-LC16">   0.23%  libcrypto.so.3          	[.] bn_mul_mont_fixed_top</td>
        </tr>
        <tr>
          <td id="file-blog20250429-02-sh-L17" data-line-number="17"></td>
          <td id="file-blog20250429-02-sh-LC17">   0.23%  libc.so.6               	[.] _int_free</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      
    </div>
    </div>

    
</div>
            
            
            
            
        
            <p>OpenSSL 3.0.14 spends 27% of the time acquiring and releasing <strong>read locks</strong>, something that should definitely not be needed during key exchange operations, to which we can add 26% in atomic operations, which is precisely 53% of the CPU spent doing non-useful things.</p><p>Let’s examine how much performance can be recovered by building with USE_PTHREAD_EMULATION=1. (The libraries will use HAProxy’s low-overhead locks instead of Pthread locks.)</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-10.png/86922e4a4d3dc2468d99cc8405c256bb/state-of-ssl-stacks-10.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-10.png/7de5646d61af4db2d7ffce38959111c2/state-of-ssl-stacks-10.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-10.png/2018461d4a61b62a6e7ffcd2e538abc8/state-of-ssl-stacks-10.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-10.png/7de5646d61af4db2d7ffce38959111c2/state-of-ssl-stacks-10.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-10.png/2018461d4a61b62a6e7ffcd2e538abc8/state-of-ssl-stacks-10.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-10.png/7de5646d61af4db2d7ffce38959111c2/state-of-ssl-stacks-10.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-10.png/4585d7d08aa3774ffc4d3398cffe4849/state-of-ssl-stacks-10.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-10.png/cf860310a52d92bfa2480b7f299c99b8/state-of-ssl-stacks-10.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-10.png/4585d7d08aa3774ffc4d3398cffe4849/state-of-ssl-stacks-10.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-10.png/4585d7d08aa3774ffc4d3398cffe4849/state-of-ssl-stacks-10.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-10.png/cf860310a52d92bfa2480b7f299c99b8/state-of-ssl-stacks-10.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>The results show that the performance remains exactly the same for all libraries, except OpenSSL 3.0, which significantly increased to reach around 36000 connections per second. The profile now looks like this:</p><p>OpenSSL 3.0.14:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            
            
            
            
            



<div>

    

    <div>
        <div translate="no" data-color-mode="light" data-light-theme="light">
      <div>
        <div>
  <div id="file-blog20250429-03-sh">
    
    <div itemprop="text" tabindex="0" role="region" aria-label="blog20250429-03.sh content, created by haproxytechblog on 05:49PM on April 29.">

        
<div>

  <template>
  <div data-view-component="true">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <p><span>
      This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span></p>
</div></template>
<template>
  <span aria-label="This line has hidden Unicode characters" data-view-component="true">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
</span></template>

  <table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="blog20250429-03.sh">
        <tbody><tr>
          <td id="file-blog20250429-03-sh-L1" data-line-number="1"></td>
          <td id="file-blog20250429-03-sh-LC1">  33.03%  libcrypto.so.3          	[.] __bn_sqr8x_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L2" data-line-number="2"></td>
          <td id="file-blog20250429-03-sh-LC2">  10.63%  haproxy-openssl-3.0.14-emu  [.] pthread_rwlock_wrlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L3" data-line-number="3"></td>
          <td id="file-blog20250429-03-sh-LC3">  10.34%  libcrypto.so.3          	[.] __bn_mul4x_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L4" data-line-number="4"></td>
          <td id="file-blog20250429-03-sh-LC4">   9.27%  libcrypto.so.3          	[.] MOD_EXP_CTIME_COPY_FROM_PREBUF</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L5" data-line-number="5"></td>
          <td id="file-blog20250429-03-sh-LC5">   5.63%  haproxy-openssl-3.0.14-emu  [.] pthread_rwlock_rdlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L6" data-line-number="6"></td>
          <td id="file-blog20250429-03-sh-LC6">   3.15%  haproxy-openssl-3.0.14-emu  [.] pthread_rwlock_unlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L7" data-line-number="7"></td>
          <td id="file-blog20250429-03-sh-LC7">   2.75%  libcrypto.so.3          	[.] __ecp_nistz256_mul_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L8" data-line-number="8"></td>
          <td id="file-blog20250429-03-sh-LC8">   2.19%  libcrypto.so.3          	[.] __aarch64_ldadd4_relax</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L9" data-line-number="9"></td>
          <td id="file-blog20250429-03-sh-LC9">   1.26%  libcrypto.so.3          	[.] __ecp_nistz256_sqr_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L10" data-line-number="10"></td>
          <td id="file-blog20250429-03-sh-LC10">   1.10%  libcrypto.so.3          	[.] __aarch64_ldadd8_relax</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L11" data-line-number="11"></td>
          <td id="file-blog20250429-03-sh-LC11">   0.87%  libcrypto.so.3          	[.] ecp_nistz256_point_double</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L12" data-line-number="12"></td>
          <td id="file-blog20250429-03-sh-LC12">   0.72%  libcrypto.so.3          	[.] sha512_block_armv8</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L13" data-line-number="13"></td>
          <td id="file-blog20250429-03-sh-LC13">   0.50%  libcrypto.so.3          	[.] ecp_nistz256_sqr_mont</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L14" data-line-number="14"></td>
          <td id="file-blog20250429-03-sh-LC14">   0.42%  libc.so.6               	[.] malloc</td>
        </tr>
        <tr>
          <td id="file-blog20250429-03-sh-L15" data-line-number="15"></td>
          <td id="file-blog20250429-03-sh-LC15">   0.41%  libc.so.6               	[.] _int_free</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      
    </div>
    </div>

    
</div>
            
            
            
            
        
            <p>The locks used were the only difference between the two tests. The amount of time spent in locks noticeably diminished, but not enough to explain that big a difference. However, it’s worth noting that pthread_rwlock_wrlock made its appearance, as it wasn’t visible in the previous profile. It’s likely that, upon contention, the original function immediately went to sleep in the kernel, explaining why its waiting time was not accounted for (perf top measures CPU time).</p><h4 id="end-to-end-encryption-with-tls-resumption">End-to-end encryption with TLS resumption</h4>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/resumed-handshake.png/85b809724487faaf4d08ff27c39fcd77/resumed-handshake.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/resumed-handshake.png/3e7476ed8ac45bbf0d579cf01712f3ea/resumed-handshake.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/resumed-handshake.png/af1c2f4e883b40c0b64f737ab3ac389c/resumed-handshake.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/resumed-handshake.png/3e7476ed8ac45bbf0d579cf01712f3ea/resumed-handshake.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/resumed-handshake.png/af1c2f4e883b40c0b64f737ab3ac389c/resumed-handshake.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/resumed-handshake.png/3e7476ed8ac45bbf0d579cf01712f3ea/resumed-handshake.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/resumed-handshake.png/d2206735f2894567b39c27efc909f633/resumed-handshake.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/resumed-handshake.png/ad902aa8a310925fa088dc221dc0827e/resumed-handshake.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/resumed-handshake.png/d2206735f2894567b39c27efc909f633/resumed-handshake.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/resumed-handshake.png/d2206735f2894567b39c27efc909f633/resumed-handshake.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/resumed-handshake.png/ad902aa8a310925fa088dc221dc0827e/resumed-handshake.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>The next test concerns the most optimal case, that is, when the proxy has the ability to resume a TLS session from the client’s ticket, and then uses session resumption as well to connect to the backend server. In this mode, asymmetric cryptography is used only once per client and once per server for the time it takes to get a session ticket, and everything else happens using lighter cryptography.</p><p>This scenario represents the most common use case for applications hosted on public cloud infrastructures: clients connected all day to an application don&#39;t do it over the same TCP connection; connections are transparently closed when not used for a while, and reopened on activity, with the TLS session resumed. As a result, the cost of the initial asymmetric cryptography becomes negligible when amortized over numerous requests and connections. In addition, since this is a public cloud, encryption between the proxy and the backend servers is mandatory, so there’s really SSL on both sides.</p><p>Given that performance is going to be much higher, a single client and a single server are no longer sufficient for the benchmark. Thus, we’ll need 10 clients and 10 servers per proxy, each taking 10% of the total load, which gives the following theoretical setup:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-server-diagram.png/5bb1ca0b2a18fef5c5114ce8058fa9e7/client-proxy-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-server-diagram.png/2d76b1ea26271c33e00db091b172d2df/client-proxy-server-diagram.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-server-diagram.png/fa86804d86d4f6202aa23546d468177d/client-proxy-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-server-diagram.png/2d76b1ea26271c33e00db091b172d2df/client-proxy-server-diagram.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-server-diagram.png/fa86804d86d4f6202aa23546d468177d/client-proxy-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-server-diagram.png/2d76b1ea26271c33e00db091b172d2df/client-proxy-server-diagram.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-server-diagram.png/f1d2d460bd59d919980a363e53a87e19/client-proxy-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-server-diagram.png/680d33088f8f4827b54ea63972d06cd8/client-proxy-server-diagram.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-server-diagram.png/f1d2d460bd59d919980a363e53a87e19/client-proxy-server-diagram.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-server-diagram.png/f1d2d460bd59d919980a363e53a87e19/client-proxy-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-server-diagram.png/680d33088f8f4827b54ea63972d06cd8/client-proxy-server-diagram.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>We can simplify the configuration by having 10 distinct instances of the proxy within the same process (i.e., 10 ports, one per client -&gt; server association):</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-instance-server-diagram.png/47b4ace3905f24a080eb782849516113/client-proxy-instance-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-instance-server-diagram.png/d51c0e169729396296159f2dfe0029b9/client-proxy-instance-server-diagram.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-instance-server-diagram.png/7f330eea4bd27d9c85ba71d828a7a44a/client-proxy-instance-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-instance-server-diagram.png/d51c0e169729396296159f2dfe0029b9/client-proxy-instance-server-diagram.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-instance-server-diagram.png/7f330eea4bd27d9c85ba71d828a7a44a/client-proxy-instance-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-instance-server-diagram.png/d51c0e169729396296159f2dfe0029b9/client-proxy-instance-server-diagram.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-instance-server-diagram.png/4e26e1136b7a4c62229d0b2cdc20ac0e/client-proxy-instance-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-instance-server-diagram.png/fcc1059e722246c72db28f4f40a42d2a/client-proxy-instance-server-diagram.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-instance-server-diagram.png/4e26e1136b7a4c62229d0b2cdc20ac0e/client-proxy-instance-server-diagram.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-instance-server-diagram.png/4e26e1136b7a4c62229d0b2cdc20ac0e/client-proxy-instance-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-proxy-instance-server-diagram.png/fcc1059e722246c72db28f4f40a42d2a/client-proxy-instance-server-diagram.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>Since the connections with the client and server are using the exact same protocols and behavior (http/1.1, close, resume), we can daisy-chain each instance to the next one and keep only client 1 and server 10:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-path-server-diagram.png/87da6d06b1061f93c5578ba2c3bcdacf/client-path-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-path-server-diagram.png/bfe7acde87736bfd0473f4eb9b53f3cc/client-path-server-diagram.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-path-server-diagram.png/c71ebcc3074a64b6367273cd0c4a143b/client-path-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-path-server-diagram.png/bfe7acde87736bfd0473f4eb9b53f3cc/client-path-server-diagram.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-path-server-diagram.png/c71ebcc3074a64b6367273cd0c4a143b/client-path-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-path-server-diagram.png/bfe7acde87736bfd0473f4eb9b53f3cc/client-path-server-diagram.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-path-server-diagram.png/4e071905754e88d91d071b887c392191/client-path-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-path-server-diagram.png/183d128d6d8290b83d732e7f7de2cbdf/client-path-server-diagram.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-path-server-diagram.png/4e071905754e88d91d071b887c392191/client-path-server-diagram.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-path-server-diagram.png/4e071905754e88d91d071b887c392191/client-path-server-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/client-path-server-diagram.png/183d128d6d8290b83d732e7f7de2cbdf/client-path-server-diagram.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>With this setup, only a single client and a single server are needed, each seeing 10% of the load, with the proxy having to deal 10 times with these 10%, hence seeing 100% of the load.</p><p>The first test was run against the regular HAProxy version, keeping the default locks. The performance is measured in end-to-end connections per second; that is, one connection accepted from the client and one connection emitted to the server count together as one end-to-end connection.</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png/7ccab461f353cd61e42dc2a7cb336048/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png/6bf1c15b9a9adf27eb27ac586175baa8/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png/a1001fb5f9d3882f7d99386a0018fe7d/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png/6bf1c15b9a9adf27eb27ac586175baa8/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png/a1001fb5f9d3882f7d99386a0018fe7d/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png/6bf1c15b9a9adf27eb27ac586175baa8/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png/919d53c35a7bbda5c243024aaaef373e/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png/2d66a8e6636c56845f277068257f7b78/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png/919d53c35a7bbda5c243024aaaef373e/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png/919d53c35a7bbda5c243024aaaef373e/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png/2d66a8e6636c56845f277068257f7b78/ssl-library-performance-comparison-on-r8g-16xlarge-diagram-2.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>Let’s ignore the highest two curves for now. The orange curve is again WolfSSL, showing an excellent linear scalability until 64 cores, where it reaches 150000 end-to-end connections per second, where the performance was only limited by the number of available CPU cores. This also demonstrates HAProxy’s modern scalability, showcasing that it can deliver linear performance scaling within a single process as the number of cores increases.</p><p>The brown curve below it is OpenSSL 1.1.1w; this used to scale quite well with rekeying, but when resuming and connecting to a server, the scalability disappears and performance degrades at 40 threads. Performance then collapses to the equivalent of 8 threads when reaching 64 threads, at 17800 connections per second. The performance profiling clearly reveals the cause: locking and atomics alone are wasting around 80% of the CPU cycles.</p><p>OpenSSL 1.1.1w:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            
            
            
            
            



<div>

    

    <div>
        <div translate="no" data-color-mode="light" data-light-theme="light">
      <div>
        <div>
  <div id="file-blog20250429-04-sh">
    
    <div itemprop="text" tabindex="0" role="region" aria-label="blog20250429-04.sh content, created by haproxytechblog on 05:49PM on April 29.">

        
<div>

  <template>
  <div data-view-component="true">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <p><span>
      This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span></p>
</div></template>
<template>
  <span aria-label="This line has hidden Unicode characters" data-view-component="true">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
</span></template>

  <table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="blog20250429-04.sh">
        <tbody><tr>
          <td id="file-blog20250429-04-sh-L1" data-line-number="1"></td>
          <td id="file-blog20250429-04-sh-LC1">  72.83%  libc.so.6          	[.] pthread_rwlock_wrlock@@GLIBC_2.34</td>
        </tr>
        <tr>
          <td id="file-blog20250429-04-sh-L2" data-line-number="2"></td>
          <td id="file-blog20250429-04-sh-LC2">   1.99%  libc.so.6          	[.] __aarch64_cas4_acq</td>
        </tr>
        <tr>
          <td id="file-blog20250429-04-sh-L3" data-line-number="3"></td>
          <td id="file-blog20250429-04-sh-LC3">   1.47%  libcrypto.so.1.1   	[.] fe51_mul</td>
        </tr>
        <tr>
          <td id="file-blog20250429-04-sh-L4" data-line-number="4"></td>
          <td id="file-blog20250429-04-sh-LC4">   1.30%  libc.so.6          	[.] __aarch64_cas4_relax</td>
        </tr>
        <tr>
          <td id="file-blog20250429-04-sh-L5" data-line-number="5"></td>
          <td id="file-blog20250429-04-sh-LC5">   1.24%  libcrypto.so.1.1   	[.] fe_mul</td>
        </tr>
        <tr>
          <td id="file-blog20250429-04-sh-L6" data-line-number="6"></td>
          <td id="file-blog20250429-04-sh-LC6">   1.00%  libc.so.6          	[.] __aarch64_ldset4_acq</td>
        </tr>
        <tr>
          <td id="file-blog20250429-04-sh-L7" data-line-number="7"></td>
          <td id="file-blog20250429-04-sh-LC7">   0.86%  libcrypto.so.1.1   	[.] sha512_block_armv8</td>
        </tr>
        <tr>
          <td id="file-blog20250429-04-sh-L8" data-line-number="8"></td>
          <td id="file-blog20250429-04-sh-LC8">   0.77%  [kernel]           	[k] futex_q_lock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-04-sh-L9" data-line-number="9"></td>
          <td id="file-blog20250429-04-sh-LC9">   0.70%  [kernel]           	[k] queued_spin_lock_slowpath</td>
        </tr>
        <tr>
          <td id="file-blog20250429-04-sh-L10" data-line-number="10"></td>
          <td id="file-blog20250429-04-sh-LC10">   0.70%  libcrypto.so.1.1   	[.] fe51_sq</td>
        </tr>
        <tr>
          <td id="file-blog20250429-04-sh-L11" data-line-number="11"></td>
          <td id="file-blog20250429-04-sh-LC11">   0.68%  libcrypto.so.1.1   	[.] x25519_scalar_mult</td>
        </tr>
        <tr>
          <td id="file-blog20250429-04-sh-L12" data-line-number="12"></td>
          <td id="file-blog20250429-04-sh-LC12">   0.56%  libc.so.6          	[.] pthread_rwlock_unlock@@GLIBC_2.34</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      
    </div>
    </div>

    
</div>
            
            
            
            
        
            <p>The worst-performing libraries, the flat curves at the bottom, are once again OpenSSL 3.0.2 and 3.0.14, respectively. They both fail to scale past 2 threads; 3.0.2 even collapses at 16 threads, reaching performance levels that are indistinguishable from the X axis, and showing 1500-1600 connections per second at 16 threads and beyond, equivalent to just 1% of WolfSSL! OpenSSL 3.0.14 is marginally better, culminating at 3700 connections per second, or 2.5% of WolfSSL. <strong>In blunt terms: running OpenSSL 3.0.2 as shipped with Ubuntu 22.04 results in 1/100 of WolfSSL’s performance on identical hardware!</strong> To put this into perspective, you would have to deploy 100 times the number of machines to handle the same traffic, solely because of the underlying SSL library.</p><p>It’s also visible that a 32-core system running optimally at 63000 connections per second on OpenSSL 1.1.1 would collapse to only 1500 connections per second on OpenSSL 3.0.2, or <strong>1/42 of its performance</strong>, for example, <strong>after upgrading from Ubuntu 20.04 to 22.04</strong>. This is exactly what many of our users are experiencing at the moment. It is also understandable that upgrading to the more recent Ubuntu 24.04 only addresses a tiny part of the problem, by only roughly doubling the performance with OpenSSL 3.0.14.</p><p>Here is a performance profile of the process running on OpenSSL 3.0.2:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            
            
            
            
            



<div>

    

    <div>
        <div translate="no" data-color-mode="light" data-light-theme="light">
      <div>
        <div>
  <div id="file-blog20250429-05-sh">
    
    <div itemprop="text" tabindex="0" role="region" aria-label="blog20250429-05.sh content, created by haproxytechblog on 05:49PM on April 29.">

        
<div>

  <template>
  <div data-view-component="true">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <p><span>
      This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span></p>
</div></template>
<template>
  <span aria-label="This line has hidden Unicode characters" data-view-component="true">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
</span></template>

  <table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="blog20250429-05.sh">
        <tbody><tr>
          <td id="file-blog20250429-05-sh-L1" data-line-number="1"></td>
          <td id="file-blog20250429-05-sh-LC1">  14.52%  [kernel]               	[k] default_idle_call</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L2" data-line-number="2"></td>
          <td id="file-blog20250429-05-sh-LC2">  14.15%  libc.so.6              	[.] __aarch64_ldadd4_acq</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L3" data-line-number="3"></td>
          <td id="file-blog20250429-05-sh-LC3">   9.87%  libc.so.6              	[.] pthread_rwlock_unlock@@GLIBC_2.34</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L4" data-line-number="4"></td>
          <td id="file-blog20250429-05-sh-LC4">   7.32%  libcrypto.so.3         	[.] ossl_sa_doall_arg</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L5" data-line-number="5"></td>
          <td id="file-blog20250429-05-sh-LC5">   7.28%  libc.so.6              	[.] pthread_rwlock_rdlock@@GLIBC_2.34</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L6" data-line-number="6"></td>
          <td id="file-blog20250429-05-sh-LC6">   6.23%  [kernel]               	[k] arch_local_irq_enable</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L7" data-line-number="7"></td>
          <td id="file-blog20250429-05-sh-LC7">   3.35%  libcrypto.so.3         	[.] __aarch64_ldadd8_relax</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L8" data-line-number="8"></td>
          <td id="file-blog20250429-05-sh-LC8">   2.80%  libc.so.6              	[.] __aarch64_cas4_rel</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L9" data-line-number="9"></td>
          <td id="file-blog20250429-05-sh-LC9">   2.04%  [kernel]               	[k] arch_local_irq_restore</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L10" data-line-number="10"></td>
          <td id="file-blog20250429-05-sh-LC10">   1.32%  libcrypto.so.3         	[.] OPENSSL_LH_doall_arg</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L11" data-line-number="11"></td>
          <td id="file-blog20250429-05-sh-LC11">   1.11%  libcrypto.so.3         	[.] __aarch64_ldadd4_relax</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L12" data-line-number="12"></td>
          <td id="file-blog20250429-05-sh-LC12">   0.87%  [kernel]               	[k] futex_q_lock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L13" data-line-number="13"></td>
          <td id="file-blog20250429-05-sh-LC13">   0.84%  libcrypto.so.3         	[.] fe51_mul</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L14" data-line-number="14"></td>
          <td id="file-blog20250429-05-sh-LC14">   0.82%  [kernel]               	[k] el0_svc_common.constprop.0</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L15" data-line-number="15"></td>
          <td id="file-blog20250429-05-sh-LC15">   0.74%  libcrypto.so.3         	[.] fe_mul</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L16" data-line-number="16"></td>
          <td id="file-blog20250429-05-sh-LC16">   0.65%  libcrypto.so.3         	[.] OPENSSL_LH_flush</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L17" data-line-number="17"></td>
          <td id="file-blog20250429-05-sh-LC17">   0.64%  libcrypto.so.3         	[.] OPENSSL_LH_doall</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L18" data-line-number="18"></td>
          <td id="file-blog20250429-05-sh-LC18">   0.62%  [kernel]               	[k] futex_wake</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L19" data-line-number="19"></td>
          <td id="file-blog20250429-05-sh-LC19">   0.58%  libc.so.6              	[.] _int_malloc</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L20" data-line-number="20"></td>
          <td id="file-blog20250429-05-sh-LC20">   0.57%  [kernel]               	[k] wake_q_add_safe</td>
        </tr>
        <tr>
          <td id="file-blog20250429-05-sh-L21" data-line-number="21"></td>
          <td id="file-blog20250429-05-sh-LC21">   0.53%  libcrypto.so.3         	[.] sha512_block_armv8</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      
    </div>
    </div>

    
</div>
            
            
            
            
        
            <p>What is visible here is that all the CPU is wasted in locks and atomic operations and wake-up/sleep cycles, explaining why the CPU cannot go higher than 350-400%. The machine seems to be waiting for something while the locks are sleeping, causing all the work to be extremely serialized.</p><p>Another concerning curve is AWS-LC, the blue one near the bottom. It shows significantly higher performance than other libraries for a few threads, and then suddenly collapses when the number of cores increases. The profile reveals that this is definitely a locking issue, and it is confirmed by perf top:</p><p>AWS-LC 1.29.0:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            
            
            
            
            



<div>

    

    <div>
        <div translate="no" data-color-mode="light" data-light-theme="light">
      <div>
        <div>
  <div id="file-blog20250429-06-sh">
    
    <div itemprop="text" tabindex="0" role="region" aria-label="blog20250429-06.sh content, created by haproxytechblog on 05:49PM on April 29.">

        
<div>

  <template>
  <div data-view-component="true">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <p><span>
      This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span></p>
</div></template>
<template>
  <span aria-label="This line has hidden Unicode characters" data-view-component="true">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
</span></template>

  <table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="blog20250429-06.sh">
        <tbody><tr>
          <td id="file-blog20250429-06-sh-L1" data-line-number="1"></td>
          <td id="file-blog20250429-06-sh-LC1">  86.01%  libc.so.6               	[.] pthread_rwlock_wrlock@@GLIBC_2.34</td>
        </tr>
        <tr>
          <td id="file-blog20250429-06-sh-L2" data-line-number="2"></td>
          <td id="file-blog20250429-06-sh-LC2">   2.43%  libc.so.6               	[.] __aarch64_cas4_relax</td>
        </tr>
        <tr>
          <td id="file-blog20250429-06-sh-L3" data-line-number="3"></td>
          <td id="file-blog20250429-06-sh-LC3">   1.78%  libc.so.6               	[.] __aarch64_cas4_acq</td>
        </tr>
        <tr>
          <td id="file-blog20250429-06-sh-L4" data-line-number="4"></td>
          <td id="file-blog20250429-06-sh-LC4">   1.13%  [kernel]                	[k] futex_q_lock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-06-sh-L5" data-line-number="5"></td>
          <td id="file-blog20250429-06-sh-LC5">   1.09%  libc.so.6               	[.] __aarch64_ldset4_acq</td>
        </tr>
        <tr>
          <td id="file-blog20250429-06-sh-L6" data-line-number="6"></td>
          <td id="file-blog20250429-06-sh-LC6">   0.82%  libc.so.6               	[.] __aarch64_swp4_relax</td>
        </tr>
        <tr>
          <td id="file-blog20250429-06-sh-L7" data-line-number="7"></td>
          <td id="file-blog20250429-06-sh-LC7">   0.76%  [kernel]                	[k] queued_spin_lock_slowpath</td>
        </tr>
        <tr>
          <td id="file-blog20250429-06-sh-L8" data-line-number="8"></td>
          <td id="file-blog20250429-06-sh-LC8">   0.65%  haproxy-aws-lc-v1.29.0-std  [.] curve25519_x25519_byte_scalarloop</td>
        </tr>
        <tr>
          <td id="file-blog20250429-06-sh-L9" data-line-number="9"></td>
          <td id="file-blog20250429-06-sh-LC9">   0.25%  [kernel]                	[k] futex_get_value_locked</td>
        </tr>
        <tr>
          <td id="file-blog20250429-06-sh-L10" data-line-number="10"></td>
          <td id="file-blog20250429-06-sh-LC10">   0.23%  haproxy-aws-lc-v1.29.0-std  [.] curve25519_x25519base_byte_scalarloop</td>
        </tr>
        <tr>
          <td id="file-blog20250429-06-sh-L11" data-line-number="11"></td>
          <td id="file-blog20250429-06-sh-LC11">   0.15%  libc.so.6               	[.] __aarch64_cas4_rel</td>
        </tr>
        <tr>
          <td id="file-blog20250429-06-sh-L12" data-line-number="12"></td>
          <td id="file-blog20250429-06-sh-LC12">   0.13%  libc.so.6               	[.] _int_malloc</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      
    </div>
    </div>

    
</div>
            
            
            
            
        
            <p>The locks take most of the CPU, atomic ops quite a bit (particularly a CAS – compare-and-swap – operation that resists contention poorly, since the operation might have to be attempted many times before succeeding), and even some in-kernel locks (futex, etc.). Approximately a year ago, during our initial x86 testing with library version 1.19, we observed this behavior, but did not conduct a thorough investigation at the time.</p><p>Digging into the flame graph reveals that it’s essentially the reference counting operations that cost a lot of locking:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-7.png/43fb391b7075da44cd451acd01975c9c/state-of-ssl-stacks-7.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-7.png/559a54ea8015c6f7145d4b892238f17c/state-of-ssl-stacks-7.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-7.png/3fa383a08eb950251bc5c4e083db44dc/state-of-ssl-stacks-7.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-7.png/559a54ea8015c6f7145d4b892238f17c/state-of-ssl-stacks-7.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-7.png/3fa383a08eb950251bc5c4e083db44dc/state-of-ssl-stacks-7.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-7.png/559a54ea8015c6f7145d4b892238f17c/state-of-ssl-stacks-7.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-7.png/b4f96f5369f4d983a1b8ec63c2a35454/state-of-ssl-stacks-7.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-7.png/e660b15f1f5a4dbf225165102dd62cfa/state-of-ssl-stacks-7.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-7.png/b4f96f5369f4d983a1b8ec63c2a35454/state-of-ssl-stacks-7.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-7.png/b4f96f5369f4d983a1b8ec63c2a35454/state-of-ssl-stacks-7.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-7.png/e660b15f1f5a4dbf225165102dd62cfa/state-of-ssl-stacks-7.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>With two libraries significantly affected by the cost of locking, we ran a new series of tests using HAProxy’s locks. (HAProxy was then rebuilt with USE_PTHREAD_EMULATION=1.)</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png/f3c536ee6308f083b23a4f41a676d51e/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png/ee5db236ca3d9a5402f7dec853a7f9d1/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png/f8f00e48ab6734a2020f39067098291c/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png/ee5db236ca3d9a5402f7dec853a7f9d1/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png/f8f00e48ab6734a2020f39067098291c/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png/ee5db236ca3d9a5402f7dec853a7f9d1/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png/f1b2cab3da2f14074f131559ec52abc9/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png/5b37d3bb24dcce23329c02bab60764f8/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png/f1b2cab3da2f14074f131559ec52abc9/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png/f1b2cab3da2f14074f131559ec52abc9/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png/5b37d3bb24dcce23329c02bab60764f8/ssl-library-performance-comparison-on-r8g-16xlarge-diagram.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>The results were much better. OpenSSL 1.1.1 is now pretty much linear, reaching 124000 end-to-end connections per second, with a much cleaner performance profile, and less than 3% of CPU cycles spent in locks.</p><p>OpenSSL 1.1.1w:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            
            
            
            
            



<div>

    

    <div>
        <div translate="no" data-color-mode="light" data-light-theme="light">
      <div>
        <div>
  <div id="file-blog20250429-07-sh">
    
    <div itemprop="text" tabindex="0" role="region" aria-label="blog20250429-07.sh content, created by haproxytechblog on 05:49PM on April 29.">

        
<div>

  <template>
  <div data-view-component="true">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <p><span>
      This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span></p>
</div></template>
<template>
  <span aria-label="This line has hidden Unicode characters" data-view-component="true">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
</span></template>

  <table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="blog20250429-07.sh">
        <tbody><tr>
          <td id="file-blog20250429-07-sh-L1" data-line-number="1"></td>
          <td id="file-blog20250429-07-sh-LC1">   7.52%  libcrypto.so.1.1        	[.] fe51_mul</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L2" data-line-number="2"></td>
          <td id="file-blog20250429-07-sh-LC2">   6.47%  libcrypto.so.1.1        	[.] fe_mul</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L3" data-line-number="3"></td>
          <td id="file-blog20250429-07-sh-LC3">   4.68%  libcrypto.so.1.1        	[.] sha512_block_armv8</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L4" data-line-number="4"></td>
          <td id="file-blog20250429-07-sh-LC4">   3.64%  libcrypto.so.1.1        	[.] fe51_sq</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L5" data-line-number="5"></td>
          <td id="file-blog20250429-07-sh-LC5">   3.42%  libcrypto.so.1.1        	[.] x25519_scalar_mult</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L6" data-line-number="6"></td>
          <td id="file-blog20250429-07-sh-LC6">   2.67%  haproxy-openssl-1.1.1w-emu  [.] pthread_rwlock_wrlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L7" data-line-number="7"></td>
          <td id="file-blog20250429-07-sh-LC7">   2.48%  libcrypto.so.1.1        	[.] fe_sq</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L8" data-line-number="8"></td>
          <td id="file-blog20250429-07-sh-LC8">   2.33%  libc.so.6               	[.] _int_malloc</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L9" data-line-number="9"></td>
          <td id="file-blog20250429-07-sh-LC9">   2.04%  libc.so.6               	[.] _int_free</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L10" data-line-number="10"></td>
          <td id="file-blog20250429-07-sh-LC10">   1.84%  [kernel]                	[k] __wake_up_common_lock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L11" data-line-number="11"></td>
          <td id="file-blog20250429-07-sh-LC11">   1.83%  libc.so.6               	[.] cfree@GLIBC_2.17</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L12" data-line-number="12"></td>
          <td id="file-blog20250429-07-sh-LC12">   1.80%  libc.so.6               	[.] malloc</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L13" data-line-number="13"></td>
          <td id="file-blog20250429-07-sh-LC13">   1.59%  libcrypto.so.1.1        	[.] OPENSSL_cleanse</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L14" data-line-number="14"></td>
          <td id="file-blog20250429-07-sh-LC14">   1.10%  [kernel]                	[k] el0_svc_common.constprop.0</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L15" data-line-number="15"></td>
          <td id="file-blog20250429-07-sh-LC15">   0.95%  libcrypto.so.1.1        	[.] cmov</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L16" data-line-number="16"></td>
          <td id="file-blog20250429-07-sh-LC16">   0.91%  libcrypto.so.1.1        	[.] SHA512_Final</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L17" data-line-number="17"></td>
          <td id="file-blog20250429-07-sh-LC17">   0.77%  libc.so.6               	[.] __memcpy_generic</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L18" data-line-number="18"></td>
          <td id="file-blog20250429-07-sh-LC18">   0.77%  libc.so.6               	[.] __aarch64_swp4_rel</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L19" data-line-number="19"></td>
          <td id="file-blog20250429-07-sh-LC19">   0.73%  libc.so.6               	[.] malloc_consolidate</td>
        </tr>
        <tr>
          <td id="file-blog20250429-07-sh-L20" data-line-number="20"></td>
          <td id="file-blog20250429-07-sh-LC20">   0.71%  [kernel]                	[k] kmem_cache_free</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      
    </div>
    </div>

    
</div>
            
            
            
            
        
            <p>OpenSSL 3.0.2 keeps the same structural defects but doesn’t collapse until 32 threads (compared to 12 previously), revealing more clearly how it uses its locks and atomic ops (96% locks).</p><p>OpenSSL 3.0.2:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            
            
            
            
            



<div>

    

    <div>
        <div translate="no" data-color-mode="light" data-light-theme="light">
      <div>
        <div>
  <div id="file-blog20250429-08-sh">
    
    <div itemprop="text" tabindex="0" role="region" aria-label="blog20250429-08.sh content, created by haproxytechblog on 05:49PM on April 29.">

        
<div>

  <template>
  <div data-view-component="true">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <p><span>
      This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span></p>
</div></template>
<template>
  <span aria-label="This line has hidden Unicode characters" data-view-component="true">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
</span></template>

  <table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="blog20250429-08.sh">
        <tbody><tr>
          <td id="file-blog20250429-08-sh-L1" data-line-number="1"></td>
          <td id="file-blog20250429-08-sh-LC1">  77.58%  haproxy-openssl-3.0.2-emu  [.] pthread_rwlock_rdlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-08-sh-L2" data-line-number="2"></td>
          <td id="file-blog20250429-08-sh-LC2">  18.02%  haproxy-openssl-3.0.2-emu  [.] pthread_rwlock_wrlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-08-sh-L3" data-line-number="3"></td>
          <td id="file-blog20250429-08-sh-LC3">   0.51%  libcrypto.so.3         	[.] ossl_sa_doall_arg</td>
        </tr>
        <tr>
          <td id="file-blog20250429-08-sh-L4" data-line-number="4"></td>
          <td id="file-blog20250429-08-sh-LC4">   0.39%  haproxy-openssl-3.0.2-emu  [.] pthread_rwlock_unlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-08-sh-L5" data-line-number="5"></td>
          <td id="file-blog20250429-08-sh-LC5">   0.34%  libcrypto.so.3         	[.] OPENSSL_LH_doall_arg</td>
        </tr>
        <tr>
          <td id="file-blog20250429-08-sh-L6" data-line-number="6"></td>
          <td id="file-blog20250429-08-sh-LC6">   0.27%  libcrypto.so.3         	[.] OPENSSL_LH_flush</td>
        </tr>
        <tr>
          <td id="file-blog20250429-08-sh-L7" data-line-number="7"></td>
          <td id="file-blog20250429-08-sh-LC7">   0.26%  libcrypto.so.3         	[.] OPENSSL_LH_doall</td>
        </tr>
        <tr>
          <td id="file-blog20250429-08-sh-L8" data-line-number="8"></td>
          <td id="file-blog20250429-08-sh-LC8">   0.23%  libcrypto.so.3         	[.] __aarch64_ldadd8_relax</td>
        </tr>
        <tr>
          <td id="file-blog20250429-08-sh-L9" data-line-number="9"></td>
          <td id="file-blog20250429-08-sh-LC9">   0.13%  libcrypto.so.3         	[.] __aarch64_ldadd4_relax</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      
    </div>
    </div>

    
</div>
            
            
            
            
        
            <p>OpenSSL 3.0.14 maintains its (admittedly low) level until 64 threads, but this time with a performance of around 8000 connections per second, or slightly more than twice the performance with Pthread locks, also exhibiting an excessive use of locks (89% CPU usage).</p><p>OpenSSL 3.0.14:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            
            
            
            
            



<div>

    

    <div>
        <div translate="no" data-color-mode="light" data-light-theme="light">
      <div>
        <div>
  <div id="file-blog20250429-09-sh">
    
    <div itemprop="text" tabindex="0" role="region" aria-label="blog20250429-09.sh content, created by haproxytechblog on 05:49PM on April 29.">

        
<div>

  <template>
  <div data-view-component="true">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <p><span>
      This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span></p>
</div></template>
<template>
  <span aria-label="This line has hidden Unicode characters" data-view-component="true">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
</span></template>

  <table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="blog20250429-09.sh">
        <tbody><tr>
          <td id="file-blog20250429-09-sh-L1" data-line-number="1"></td>
          <td id="file-blog20250429-09-sh-LC1">  60.18%  haproxy-openssl-3.0.14-emu  [.] pthread_rwlock_rdlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-09-sh-L2" data-line-number="2"></td>
          <td id="file-blog20250429-09-sh-LC2">  28.69%  haproxy-openssl-3.0.14-emu  [.] pthread_rwlock_unlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-09-sh-L3" data-line-number="3"></td>
          <td id="file-blog20250429-09-sh-LC3">   0.55%  libcrypto.so.3          	[.] fe51_mul</td>
        </tr>
        <tr>
          <td id="file-blog20250429-09-sh-L4" data-line-number="4"></td>
          <td id="file-blog20250429-09-sh-LC4">   0.49%  libcrypto.so.3          	[.] fe_mul</td>
        </tr>
        <tr>
          <td id="file-blog20250429-09-sh-L5" data-line-number="5"></td>
          <td id="file-blog20250429-09-sh-LC5">   0.46%  libcrypto.so.3          	[.] __aarch64_ldadd4_relax</td>
        </tr>
        <tr>
          <td id="file-blog20250429-09-sh-L6" data-line-number="6"></td>
          <td id="file-blog20250429-09-sh-LC6">   0.33%  libcrypto.so.3          	[.] sha512_block_armv8</td>
        </tr>
        <tr>
          <td id="file-blog20250429-09-sh-L7" data-line-number="7"></td>
          <td id="file-blog20250429-09-sh-LC7">   0.27%  libcrypto.so.3          	[.] fe51_sq</td>
        </tr>
        <tr>
          <td id="file-blog20250429-09-sh-L8" data-line-number="8"></td>
          <td id="file-blog20250429-09-sh-LC8">   0.26%  libcrypto.so.3          	[.] x25519_scalar_mult</td>
        </tr>
        <tr>
          <td id="file-blog20250429-09-sh-L9" data-line-number="9"></td>
          <td id="file-blog20250429-09-sh-LC9">   0.26%  libc.so.6               	[.] _int_malloc</td>
        </tr>
        <tr>
          <td id="file-blog20250429-09-sh-L10" data-line-number="10"></td>
          <td id="file-blog20250429-09-sh-LC10">   0.22%  libc.so.6               	[.] _int_free</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      
    </div>
    </div>

    
</div>
            
            
            
            
        
            <p>The latest OpenSSL versions replaced many locks with atomics, but these have become excessive, as can be seen below with __aarch64_ldadd4_relax() – which is an instruction typically used with reference counting and manual locking, and that still keeps using a lot of CPU.</p><p>OpenSSL 3.4.0-dev:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            
            
            
            
            



<div>

    

    <div>
        <div translate="no" data-color-mode="light" data-light-theme="light">
      <div>
        <div>
  <div id="file-blog20250429-10-sh">
    
    <div itemprop="text" tabindex="0" role="region" aria-label="blog20250429-10.sh content, created by haproxytechblog on 05:49PM on April 29.">

        
<div>

  <template>
  <div data-view-component="true">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <p><span>
      This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span></p>
</div></template>
<template>
  <span aria-label="This line has hidden Unicode characters" data-view-component="true">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
</span></template>

  <table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="blog20250429-10.sh">
        <tbody><tr>
          <td id="file-blog20250429-10-sh-L1" data-line-number="1"></td>
          <td id="file-blog20250429-10-sh-LC1">  37.24%  libcrypto.so.3             	[.] __aarch64_ldadd4_relax</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L2" data-line-number="2"></td>
          <td id="file-blog20250429-10-sh-LC2">   8.91%  libcrypto.so.3             	[.] evp_md_init_internal</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L3" data-line-number="3"></td>
          <td id="file-blog20250429-10-sh-LC3">   8.68%  libcrypto.so.3             	[.] EVP_MD_CTX_copy_ex</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L4" data-line-number="4"></td>
          <td id="file-blog20250429-10-sh-LC4">   7.18%  libcrypto.so.3             	[.] EVP_DigestUpdate</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L5" data-line-number="5"></td>
          <td id="file-blog20250429-10-sh-LC5">   2.03%  libcrypto.so.3             	[.] fe51_mul</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L6" data-line-number="6"></td>
          <td id="file-blog20250429-10-sh-LC6">   1.92%  libcrypto.so.3             	[.] EVP_DigestFinal_ex</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L7" data-line-number="7"></td>
          <td id="file-blog20250429-10-sh-LC7">   1.78%  libcrypto.so.3             	[.] fe_mul</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L8" data-line-number="8"></td>
          <td id="file-blog20250429-10-sh-LC8">   1.45%  haproxy-openssl-3.4.0-dev-emu  [.] pthread_rwlock_rdlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L9" data-line-number="9"></td>
          <td id="file-blog20250429-10-sh-LC9">   1.43%  haproxy-openssl-3.4.0-dev-emu  [.] pthread_rwlock_unlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L10" data-line-number="10"></td>
          <td id="file-blog20250429-10-sh-LC10">   1.22%  libcrypto.so.3             	[.] sha512_block_armv8</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L11" data-line-number="11"></td>
          <td id="file-blog20250429-10-sh-LC11">   1.09%  libcrypto.so.3             	[.] fe51_sq</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L12" data-line-number="12"></td>
          <td id="file-blog20250429-10-sh-LC12">   0.86%  libc.so.6                  	[.] _int_malloc</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L13" data-line-number="13"></td>
          <td id="file-blog20250429-10-sh-LC13">   0.85%  libcrypto.so.3             	[.] x25519_scalar_mult</td>
        </tr>
        <tr>
          <td id="file-blog20250429-10-sh-L14" data-line-number="14"></td>
          <td id="file-blog20250429-10-sh-LC14">   0.77%  libc.so.6                  	[.] _int_free</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      
    </div>
    </div>

    
</div>
            
            
            
            
        
            <p>The WolfSSL curve doesn’t change at all; it clearly doesn’t need locks.</p><p>The AWS-LC curve goes much higher before collapsing (32 threads – 81000 connections per second), but still under heavy locking.</p><p>AWS-LC 1.29.0:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            
            
            
            
            



<div>

    

    <div>
        <div translate="no" data-color-mode="light" data-light-theme="light">
      <div>
        <div>
  <div id="file-blog20250429-11-sh">
    
    <div itemprop="text" tabindex="0" role="region" aria-label="blog20250429-11.sh content, created by haproxytechblog on 05:49PM on April 29.">

        
<div>

  <template>
  <div data-view-component="true">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <p><span>
      This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span></p>
</div></template>
<template>
  <span aria-label="This line has hidden Unicode characters" data-view-component="true">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
</span></template>

  <table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="blog20250429-11.sh">
        <tbody><tr>
          <td id="file-blog20250429-11-sh-L1" data-line-number="1"></td>
          <td id="file-blog20250429-11-sh-LC1">  69.57%  haproxy-aws-lc-v1.29.0-emu  [.] pthread_rwlock_wrlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-11-sh-L2" data-line-number="2"></td>
          <td id="file-blog20250429-11-sh-LC2">   4.80%  haproxy-aws-lc-v1.29.0-emu  [.] curve25519_x25519_byte_scalarloop</td>
        </tr>
        <tr>
          <td id="file-blog20250429-11-sh-L3" data-line-number="3"></td>
          <td id="file-blog20250429-11-sh-LC3">   1.65%  haproxy-aws-lc-v1.29.0-emu  [.] curve25519_x25519base_byte_scalarloop</td>
        </tr>
        <tr>
          <td id="file-blog20250429-11-sh-L4" data-line-number="4"></td>
          <td id="file-blog20250429-11-sh-LC4">   0.93%  haproxy-aws-lc-v1.29.0-emu  [.] pthread_rwlock_unlock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-11-sh-L5" data-line-number="5"></td>
          <td id="file-blog20250429-11-sh-LC5">   0.73%  [kernel]                	[k] __wake_up_common_lock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-11-sh-L6" data-line-number="6"></td>
          <td id="file-blog20250429-11-sh-LC6">   0.52%  libc.so.6               	[.] _int_malloc</td>
        </tr>
        <tr>
          <td id="file-blog20250429-11-sh-L7" data-line-number="7"></td>
          <td id="file-blog20250429-11-sh-LC7">   0.47%  libc.so.6               	[.] _int_free</td>
        </tr>
        <tr>
          <td id="file-blog20250429-11-sh-L8" data-line-number="8"></td>
          <td id="file-blog20250429-11-sh-LC8">   0.45%  haproxy-aws-lc-v1.29.0-emu  [.] sha256_block_armv8</td>
        </tr>
        <tr>
          <td id="file-blog20250429-11-sh-L9" data-line-number="9"></td>
          <td id="file-blog20250429-11-sh-LC9">   0.41%  haproxy-aws-lc-v1.29.0-emu  [.] SHA256_Final</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      
    </div>
    </div>

    
</div>
            
            
            
            
        
            <p>A new flamegraph of AWS-LC was produced, showing much narrower spikes (which is unsurprising since the performance was roughly doubled).</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/image19.png/463d00e383b08e8596bf0f337b24cfcd/image19.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/image19.png/063cfaa90576c10a27f507ae9a5df3eb/image19.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/image19.png/3efccf0822d9f2680a65ad0653e3f90d/image19.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/image19.png/063cfaa90576c10a27f507ae9a5df3eb/image19.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/image19.png/3efccf0822d9f2680a65ad0653e3f90d/image19.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/image19.png/063cfaa90576c10a27f507ae9a5df3eb/image19.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/image19.png/f7c6bd6f40fe946e0967dec475a02b6a/image19.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/image19.png/49538ebde3fb60fea11d8a43b0252a87/image19.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/image19.png/f7c6bd6f40fe946e0967dec475a02b6a/image19.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/image19.png/f7c6bd6f40fe946e0967dec475a02b6a/image19.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/image19.png/49538ebde3fb60fea11d8a43b0252a87/image19.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>Reference counting should normally not employ locks, so we reviewed the AWS-LC code to see if something could be improved. We discovered that there are, in fact, two implementations of the reference counting functions: a generic one relying on Pthread rwlocks, and a more modern one involving atomic operations supported since gcc-4.7, that’s only selected for compilers configured to adopt the C11 standard. This has been the default since gcc-5. Given that our tests were made with gcc-11.4, we should be covered. A deeper analysis revealed that the CMakeFile used to configure the project forces the standard to the older C99 unless a variable, CMAKE_C_STANDARD, is set.</p><p>Rebuilding the library with CMAKE_C_STANDARD=11 radically changed the performance and resulted in the topmost curves attributed to the -c11 variants of the library. This time, there is no difference between the regular build and the emulated locks, since the library no longer uses locks on the fast path. Now, just as with WolfSSL, performance scales linearly with the number of cores and threads. Now it is pretty visible that the library is more performant, reaching 183000 end-to-end connections per second at 64 threads – or about 20% higher than WolfSSL and 50% higher than OpenSSL 1.1.1w. The profile shows no more locks.</p><p>AWS-LC 1.29.0:</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            
            
            
            
            



<div>

    

    <div>
        <div translate="no" data-color-mode="light" data-light-theme="light">
      <div>
        <div>
  <div id="file-blog20250429-12-sh">
    
    <div itemprop="text" tabindex="0" role="region" aria-label="blog20250429-12.sh content, created by haproxytechblog on 05:49PM on April 29.">

        
<div>

  <template>
  <div data-view-component="true">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
    <p><span>
      This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span></p>
</div></template>
<template>
  <span aria-label="This line has hidden Unicode characters" data-view-component="true">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
</svg>
</span></template>

  <table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="blog20250429-12.sh">
        <tbody><tr>
          <td id="file-blog20250429-12-sh-L1" data-line-number="1"></td>
          <td id="file-blog20250429-12-sh-LC1">  16.61%  haproxy-aws-lc-v1.29.0-c11-emu  [.] curve25519_x25519_byte_scalarloop</td>
        </tr>
        <tr>
          <td id="file-blog20250429-12-sh-L2" data-line-number="2"></td>
          <td id="file-blog20250429-12-sh-LC2">   5.69%  haproxy-aws-lc-v1.29.0-c11-emu  [.] curve25519_x25519base_byte_scalarl</td>
        </tr>
        <tr>
          <td id="file-blog20250429-12-sh-L3" data-line-number="3"></td>
          <td id="file-blog20250429-12-sh-LC3">   2.65%  [kernel]                    	[k] __wake_up_common_lock</td>
        </tr>
        <tr>
          <td id="file-blog20250429-12-sh-L4" data-line-number="4"></td>
          <td id="file-blog20250429-12-sh-LC4">   1.60%  libc.so.6                   	[.] _int_malloc</td>
        </tr>
        <tr>
          <td id="file-blog20250429-12-sh-L5" data-line-number="5"></td>
          <td id="file-blog20250429-12-sh-LC5">   1.55%  haproxy-aws-lc-v1.29.0-c11-emu  [.] sha256_block_armv8</td>
        </tr>
        <tr>
          <td id="file-blog20250429-12-sh-L6" data-line-number="6"></td>
          <td id="file-blog20250429-12-sh-LC6">   1.53%  [kernel]                    	[k] el0_svc_common.constprop.0</td>
        </tr>
        <tr>
          <td id="file-blog20250429-12-sh-L7" data-line-number="7"></td>
          <td id="file-blog20250429-12-sh-LC7">   1.52%  libc.so.6                   	[.] _int_free</td>
        </tr>
        <tr>
          <td id="file-blog20250429-12-sh-L8" data-line-number="8"></td>
          <td id="file-blog20250429-12-sh-LC8">   1.36%  haproxy-aws-lc-v1.29.0-c11-emu  [.] SHA256_Final</td>
        </tr>
        <tr>
          <td id="file-blog20250429-12-sh-L9" data-line-number="9"></td>
          <td id="file-blog20250429-12-sh-LC9">   1.27%  libc.so.6                   	[.] malloc</td>
        </tr>
        <tr>
          <td id="file-blog20250429-12-sh-L10" data-line-number="10"></td>
          <td id="file-blog20250429-12-sh-LC10">   1.22%  haproxy-aws-lc-v1.29.0-c11-emu  [.] OPENSSL_free</td>
        </tr>
        <tr>
          <td id="file-blog20250429-12-sh-L11" data-line-number="11"></td>
          <td id="file-blog20250429-12-sh-LC11">   0.93%  [kernel]                    	[k] __fget_light</td>
        </tr>
        <tr>
          <td id="file-blog20250429-12-sh-L12" data-line-number="12"></td>
          <td id="file-blog20250429-12-sh-LC12">   0.90%  libc.so.6                   	[.] __memcpy_generic</td>
        </tr>
        <tr>
          <td id="file-blog20250429-12-sh-L13" data-line-number="13"></td>
          <td id="file-blog20250429-12-sh-LC13">   0.89%  haproxy-aws-lc-v1.29.0-c11-emu  [.] CBB_flush</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      
    </div>
    </div>

    
</div>
            
            
            
            
        
            <p>This issue was <a target="_blank" href="https://github.com/aws/aws-lc/issues/1723">reported to the AWS-LC project</a>, which welcomed the report and fixed this oversight (mostly a problem of cat-and-mouse in the cmake-based build system).</p><p>Finally, modern versions of OpenSSL (3.1, 3.2, 3.3 and 3.4-dev) do not benefit much from the lighter locks. Their performance remains identical across all four versions, increasing from 25000 to 28000 connections per second with the lighter locks, reaching a plateau between 24 and 32 threads. That’s equivalent to 22.5% of OpenSSL 1.1.1, and 15.3% of AWS-LC’s performance. This definitely indicates that the contention is no longer concentrated to locks only and is now spread all over the code due to abuse of atomic operations. <strong>The problem stems from a fundamental software architecture issue rather than simple optimization concerns. </strong>A permanent solution will require rolling back to a lighter architecture that prioritizes efficient resource utilization and aligns with real-world application requirements.</p><h3 id="performance-summary-per-locking-mechanism">Performance summary per locking mechanism</h3><p>The graph below shows how each library performs, in number of server handshakes per second (the numbers are expressed in thousands of connections per second).</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png/5ca664b77e52754293689594a6480f47/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png/b2386549d409c6eec368a529d4024fd9/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png/ad787626de0f87c0ecc75b9b9b55ce58/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png/b2386549d409c6eec368a529d4024fd9/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png/ad787626de0f87c0ecc75b9b9b55ce58/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png/b2386549d409c6eec368a529d4024fd9/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png/8346c55ea8798921612db768ba1356c9/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png/2252b963b0b9fd18e67657f373020ca3/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png/8346c55ea8798921612db768ba1356c9/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png/8346c55ea8798921612db768ba1356c9/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png/2252b963b0b9fd18e67657f373020ca3/ssl-library-performance-depending-on-locking-model-graviton-4_64-threads-diagram-1.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>With the exception of OpenSSL 3.0.x, the libraries are not affected by the locks during this phase, indicating that they are not making heavy use of them. The performance is roughly the same across all libraries, with the CPU-aware ones (AWS-LC and WolfSSL) at the top, followed by OpenSSL 1.1.1, then all versions of OpenSSL 3.x.</p><p>The following graph shows how the libraries perform for TLS resumption (the numbers are expressed in thousands of forwarded connections per second).</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-13.png/1a4667e57181485d7e49894e7b13649e/state-of-ssl-stacks-13.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-13.png/4c287ffb2cc06941969784ab3a30e760/state-of-ssl-stacks-13.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-13.png/7755516e49a592158a0e3a795339cbec/state-of-ssl-stacks-13.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-13.png/4c287ffb2cc06941969784ab3a30e760/state-of-ssl-stacks-13.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-13.png/7755516e49a592158a0e3a795339cbec/state-of-ssl-stacks-13.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-13.png/4c287ffb2cc06941969784ab3a30e760/state-of-ssl-stacks-13.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-13.png/2ae82917ae3f6509111020405fa8678e/state-of-ssl-stacks-13.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-13.png/f0f8c07c267abb3ce59919e19fe74730/state-of-ssl-stacks-13.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-13.png/2ae82917ae3f6509111020405fa8678e/state-of-ssl-stacks-13.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-13.png/2ae82917ae3f6509111020405fa8678e/state-of-ssl-stacks-13.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/state-of-ssl-stacks-13.png/f0f8c07c267abb3ce59919e19fe74730/state-of-ssl-stacks-13.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <p>This test involves end-to-end connections, where the client establishes a connection to HAProxy, which then establishes a connection to the server. Preliminary handshakes had already been performed, and connections were resumed from a ticket, which explains why the numbers are much higher than in the previous test. OpenSSL 1.1.1w shows bad performance by default, due to a moderate use of locking; however, it became one of the best performers when lighter locks were used. OpenSSL 3.0.x versions exhibit extremely poor performance that can be improved only slightly by replacing the locks; at best,  performance is doubled. </p><p>All OpenSSL 3.x versions remain poor performers, with locking being a small part of their problem. However, those who are stuck with this version can still benefit from our lighter locks by setting an HAProxy build option. The performance of the default build of aws-lc1.32 is also very low because it incorrectly detects the compiler and uses locks instead of atomic operations for reference counting. However, once properly configured, it becomes the best performer. WolfSSL is very good out of the box. Note that despite the wrong compilation option, AWS-LC is still significantly better than any OpenSSL 3.x version, even with OpenSSL 3.x using our lighter locks.</p><h2 id="future-of-ssl-libraries">Future of SSL libraries</h2><p>Unfortunately the future is not bright for OpenSSL users. After one of the most massive performance regressions in history, measurements show absolutely no more progress to overcome this issue over the last two years, suggesting that the ability for the team to fix this important problem has reached a plateau. </p><p>It is often said that fixing a problem requires smarter minds than those who created that problem. When the problem was architected by a team with strong convictions about the solution‘s correctness, it seems extremely unlikely that the resolution will come from the team that created that problem in the first place. The lack of progress in the latest releases tends to confirm these unfortunate hypotheses. The only path forward seems to be for the team to revert some of the major changes that plague the 3.x versions, but discussions suggest that this is out of the equation for them.</p><p>It is hard to guess what good or bad can emerge from a project in which technical matters are still decided by <a target="_blank" href="https://openssl-library.org/about/bylaws/index.html#OTC">committees</a> and <a target="_blank" href="https://github.com/openssl/technical-policies/tree/master/votes">votes</a>, despite this anti-pattern <a target="_blank" href="https://en.wikipedia.org/wiki/Design_by_committee">being well known</a> for causing more bad than good; bureaucracy and managers deciding against common sense usually doesn’t result in trustable solutions, since the majority is not necessarily right in technical matters. It also doesn’t appear that further changes are expected soon, as the project <a target="_blank" href="https://openssl-library.org/post/2024-07-24-openssl-new-governance-structure/">just reorganized</a>, but kept its committees and vote-based decision process.</p><p>In early 2023 Rich Salz, one of the project’s leaders, <a target="_blank" href="https://github.com/haproxy/haproxy/issues/680#issuecomment-1434699667">indicated that the QuicTLS project was considering moving to the Apache Foundation</a> via the <a target="_blank" href="https://incubator.apache.org/">Apache Incubator</a> and potentially becoming <em>Apache TLS</em>. This has not happened. One possible explanation might be related to the difficulty in finding sufficient maintainers willing to engage long-term in such an arduous task. There’s probably also the realization that OpenSSL completely ruined their performance with versions 3 and above; that doesn’t make it very appealing for developers to engage with a new project that starts out crippled by a major performance flaw, and with the demonstrated inability of the team to improve or resolve the problems after two years. At IETF 120, the <a target="_blank" href="https://datatracker.ietf.org/meeting/120/materials/slides-120-hotrfc-sessa-06-the-quictls-project">QuicTLS project leaders indicated</a> that their goal is to diverge from OpenSSL, work in a similar fashion to BoringSSL, and collaborate with others. </p><p>AWS-LC looks like a very active project with a strong community. During our first encounter, there were a few rough edges that were quickly addressed. Even the recently reported performance issue was quickly fixed and released with the next version. Several versions were issued during the write-up of this article. This is definitely a library that anyone interested in the topic should monitor.</p>
            
            
            
            
            
            
            
            
            
            
            
        
            
            
            
            <div>
                <figure>
            
                    
                        
                        



















    
        
        
        
        

         

        

        
        
            <picture>
                <source media="(min-width: 1024px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-12.png/1d31866344793eccee18ef55b9749a31/state-of-ssl-stacks-12.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-12.png/c4c9c27d2657877a3c12844132e87db8/state-of-ssl-stacks-12.png 2x"/>
                <source media="(min-width: 768px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-12.png/46c3b0cf37ea064fe281493dc6edad6b/state-of-ssl-stacks-12.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-12.png/c4c9c27d2657877a3c12844132e87db8/state-of-ssl-stacks-12.png 2x"/>
                <source media="(min-width: 480px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-12.png/46c3b0cf37ea064fe281493dc6edad6b/state-of-ssl-stacks-12.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-12.png/c4c9c27d2657877a3c12844132e87db8/state-of-ssl-stacks-12.png 2x"/>
                <source media="(max-width: 479px)" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-12.png/9823b864d68cdd9a419386793c45dc2b/state-of-ssl-stacks-12.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-12.png/a988f07bb2844361a9d6befcc3511ed7/state-of-ssl-stacks-12.png 2x"/>
                <img src="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-12.png/9823b864d68cdd9a419386793c45dc2b/state-of-ssl-stacks-12.png" srcset="https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-12.png/9823b864d68cdd9a419386793c45dc2b/state-of-ssl-stacks-12.png 1x, https://cdn.haproxy.com/img/containers/partner_integrations/2025/state-of-ssl/new/highres/state-of-ssl-stacks-12.png/a988f07bb2844361a9d6befcc3511ed7/state-of-ssl-stacks-12.png 2x" loading="lazy" alt="" width="900"/>
            </picture>
            
        

        



                        
            
                    
            
                    
                </figure>
            </div>
            
            
            
            
            
            
            
            
            
            
        
            <h2 id="recommendations-for-haproxy-users">Recommendations for HAProxy users</h2><p>What are the solutions for end users?</p><ul><li><p>Regardless of the performance impact, if operating system vendors would ship the QuicTLS patch set applied on top of OpenSSL releases, that would help a lot with the adoption of QUIC in environments that are not sensitive to performance.</p></li><li><p>For users who want to test or use QUIC and don’t care about performance (i.e. the majority), HAProxy offers the limited-quic option that supports QUIC without 0-RTT on top of OpenSSL. For other users, including users of other products, building QuicTLS is easy and will provide a 100% OpenSSL compatible library that integrates seamlessly with any code.</p></li><li><p>Regarding the performance impact, those able to upgrade their versions regularly should adopt AWS-LC. The library integrates well with existing code, since it shares ancestry with BoringSSL, which itself is a fork of OpenSSL The team is helpful, responsive, and we have not yet found a meaningful feature of HAProxy’s SSL stack that is not compatible. While there is no official LTS branch, FIPS branches are maintained for 5 years, which can be a suitable alternative. For users on the cutting edge, it is recommended to periodically upgrade and rebuild their AWS-LC library. </p></li><li><p>Those who want to fine-tune the library for their systems should probably turn to WolfSSL. Its support is pretty good; however, given that it doesn’t have common ancestry with OpenSSL and only emulates its API, from time to time we discover minor differences. As a result, deploying it in a product requires a lot of testing and feature validation. There is a company behind the project, so it should be possible to negotiate a support period that suits both parties.</p></li><li><p>In the meantime, since we have not decided on a durable solution for our customers, we’re offering packages built against OpenSSL 1.1.1 with extended support and the QuicTLS patchset. This solution offers the best combination of support, features, and performance while we continue evaluating the SSL landscape.</p></li></ul><p>The current state of OpenSSL 3.0 in Linux distributions forces users to seek alternative solutions that are usually not packaged. This means users no longer receive automatic security updates from their OS vendors, leaving them solely responsible for addressing any security vulnerabilities that emerge. As such, the situation has significantly undermined the overall security posture of TLS implementations in real-world environments. That’s not counting the challenges with 3.0 itself, which constitutes an easy DoS target, as seen above. We continue to watch news on this topic and to publish our updated findings and suggestions in the <a target="_blank" href="https://github.com/haproxy/wiki/wiki/SSL-Libraries-Support-Status">HAProxy wiki</a>, which everyone is obviously encouraged to periodically check.</p><h3 id="hopes">Hopes</h3><p>We can only hope that the situation will clarify itself over time.</p><p>First, OpenSSL ought not to have tagged 3.0 as LTS, since it simply does not work for anything beyond command-line tools such as “openssl s_client” and Curl. We urge them to tag a newer release as LTS because, while the performance starting with 3.1 is still very far away from what users were having before the upgrade, we’re back into an area where it is usable for small sites. On top of this, the QuicTLS fork would then benefit from a usable LTS version with QUIC support, again for sites without high performance requirements. </p><p>OpenSSL has finally implemented its own QUIC API in 3.5-beta, ending a long-standing issue. However, this new API is not compatible with the standard one that other libraries and QUIC implementations have been using for years. It will require significant work to integrate existing implementations with this new QUIC API, and it is unlikely that many new implementations using the new QUIC API will emerge in the near future; as such, the relevance of this API is currently uncertain. Curl author Daniel Stenberg has a <a target="_blank" href="https://daniel.haxx.se/blog/2025/02/16/openssl-does-a-quic-api/">review of the announcement</a> on his blog. </p><p>Second, in a world where everyone is striving to reduce their energy footprint, sticking to a library that operates at only a quarter of its predecessor&#39;s efficiency, and six to nine times slower than the competition, contradicts global sustainability efforts. This is not acceptable, and requires that the community unite in an effort to address the problem. </p><p>Both AWS-LC and QuicTLS seem to pursue comparable goals of providing QUIC, high performance, and good forward compatibility to their users. Maybe it would make sense for such projects to join efforts to try to provide users with a few LTS versions of AWS-LC that deliver excellent performance. It is clear that operating system vendors are currently lacking a long enough support commitment to start shipping such a library and that, once accepted, most SSL-enabled software would quickly adopt this, given the huge benefits that can be expected from these.</p><p>We hope that an acceptable solution will be found before OpenSSL 1.1.1 reaches the end of paid extended support. A similar situation happened around 22 years ago on Linux distros. There was a divergence between threading mechanisms and libraries; after a few distros started to ship the new NPTL kernel and library patches, it was progressively adopted by all distros, and eventually became the standard threading library. The industry likely needs a few distributions to lead the way and embrace an updated TLS library; this will encourage others to follow suit.</p><p>We consistently monitor announcements and engage in discussions with implementers to enhance the experience for our users and customers. The hope is that within a reasonable time frame, an efficient and well-maintained library, provided by default with operating systems and supporting all features including QUIC, will be available. Work continues in this direction with increased confidence that such a situation will eventually emerge, and steps toward improvement are noticeable across the board, such as OpenSSL&#39;s recent announcement of a maintenance cycle for a new LTS version every two years, with five years of support.</p><p>We invite you to stay tuned for the next update at our very own <a target="_blank" href="https://www.haproxyconf.com">HAProxyConf</a> in June, 2025, where we will usher in HAProxy’s next generation of TLS performance and compatibility.</p>
            
            
            
            
            
            
            
            
            
            
            
        



                        <p><a href="#" @click.prevent="blogNewsletter = true">
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
                                <path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"></path>
                                </svg>
                            </span>
                            <span>
                                Subscribe to our blog.
                                <span>Get the latest release updates, tutorials, and deep-dives from HAProxy experts.</span>
                            </span>
                        </a>
                    </p></div></div>
  </body>
</html>
