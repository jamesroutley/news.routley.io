<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet">Original</a>
    <h1>Uncovering a 0-Click RCE in the SuperNote Nomad E-Ink Tablet</h1>
    
    <div id="readability-page-1" class="page"><div data-hook="post-description"><div><div><div data-rce-version="10.123.1"><div dir="ltr" data-id="content-viewer"><div><div><p data-breakout="normal"><h2 dir="auto" id="viewer-foo"><span><span>Overview:</span></span></h2></p><p dir="auto" id="viewer-7avk356"><span><span>Last year, popular E-Ink tablet vendor </span><a target="_blank" href="https://supernote.com/?srsltid=AfmBOorepWN3BO2e0u-Dt06zM5pFb1_2q-cAltdVxHU2wKIon0WtcJ0C" rel="noopener noreferrer" data-hook="web-link"><u><span>Ratta Software</span></u></a><span> released the </span><a target="_blank" href="https://supernote.com/products/supernote-nomad?srsltid=AfmBOop-tkBYaFOtxlwRqT74E3lyC5aV5tvKEzPdwuGEqww6UhyOrBk-" rel="noopener noreferrer" data-hook="web-link"><u><span>SuperNote A6 X2 Nomad </span></u></a><span>- a 7.8 inch tablet running Android 11 under the hood. </span></span></p><p dir="auto" id="viewer-g4he291192"><span><span>As productivity nerds, we picked one up in July of 2024 with the goal of using it for its intended purpose: note taking and academic paper reading. However, as hackers at heart, it took all of 24-hours before we abandoned that idea entirely and decided to poke at it. </span></span></p><p dir="auto" id="viewer-0b7bg91871"><span><span>What follows is a blog post detailing how we were able to chain a vulnerability and a handful of misconfigurations into a remotely installable, 0-click rootkit. A malicious attacker on the same network as the victim could fully compromise the target device without any user-interaction.</span><span>
</span><span>
</span><span>EDIT: This issue was assigned to </span><a target="_blank" href="https://nvd.nist.gov/vuln/detail/CVE-2025-32409" rel="noopener noreferrer" data-hook="web-link"><u><span>CVE-2025-32409</span></u></a><span> after publication.</span></span></p><div data-breakout="normal"><div id="viewer-ipmo2436"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="ipmo2436"><wow-image id="82b748_97196ebf509f4c55b79dc58becb3cb8a~mv2.jpg" data-image-info="{&#34;containerId&#34;:&#34;ipmo2436&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:980,&#34;height&#34;:483,&#34;uri&#34;:&#34;82b748_97196ebf509f4c55b79dc58becb3cb8a~mv2.jpg&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_97196ebf509f4c55b79dc58becb3cb8a~mv2.jpg/v1/fill/w_980,h_483,al_c,q_85,enc_avif,quality_auto/82b748_97196ebf509f4c55b79dc58becb3cb8a~mv2.jpg" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_97196ebf509f4c55b79dc58becb3cb8a~mv2.jpg/v1/fill/w_980,h_483,al_c,q_85/82b748_97196ebf509f4c55b79dc58becb3cb8a~mv2.jpg" draggable="false"/></wow-image></div></div></figure></div></div></div><p data-breakout="normal"><h2 dir="auto" id="viewer-sylil468"><span><span>Recon:</span></span></h2></p><p dir="auto" id="viewer-nc834624"><span><span>This research kicked off with an innocent </span><u><span>Nmap</span></u><span> scan, just to see if anything interesting was listening on the device while in its default configuration. Lo and behold, there was one result which stood out:</span></span></p><div data-breakout="normal"><div id="viewer-cy1qy1621854"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="cy1qy1621854"><wow-image id="82b748_dad176ba78834c66a13db5c0bd162004~mv2.png" data-image-info="{&#34;containerId&#34;:&#34;cy1qy1621854&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:712,&#34;height&#34;:110,&#34;uri&#34;:&#34;82b748_dad176ba78834c66a13db5c0bd162004~mv2.png&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_dad176ba78834c66a13db5c0bd162004~mv2.png/v1/fill/w_712,h_110,al_c,q_85,enc_avif,quality_auto/82b748_dad176ba78834c66a13db5c0bd162004~mv2.png" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_dad176ba78834c66a13db5c0bd162004~mv2.png/v1/fill/w_997,h_154,al_c,lg_1,q_85/82b748_dad176ba78834c66a13db5c0bd162004~mv2.png" draggable="false"/></wow-image></div></div></figure></div></div></div><p dir="auto" id="viewer-8et8h1619850"><span><span>
</span><span>As shown above, we found port 60002 open and listening. Nmap was unable to identify the service directly, so we decided to investigate this mysterious port a bit further by grabbing a firmware image for the device from Ratta Software&#39;s </span><a target="_blank" href="https://support.supernote.com/en_US/change-log/how-to-update-your-supernote" rel="noopener noreferrer" data-hook="web-link"><u><span>&#34;Updates&#34; page</span></u></a><span>.</span></span></p><p dir="auto" id="viewer-k9pmi837"><span><span>The firmware was unencrypted, and we were able to mount the various filesystem images and grep through them for anything related to that port number. </span></span></p><p dir="auto" id="viewer-2govq166936"><span><span>
</span><span>This led us to the </span><em><span>SuperNoteLauncher.apk</span></em><span>, which we threw into </span><a target="_blank" href="https://github.com/skylot/jadx" rel="noopener noreferrer" data-hook="web-link"><u><span>jadx</span></u></a><span> and started reversing.</span></span></p><p data-breakout="normal"><h3 dir="auto" id="viewer-zprdh1977"><span><span>Reversing The SuperNoteLauncher</span><span>
</span></span><br role="presentation"/></h3></p><p data-breakout="normal"><h4 dir="auto" id="viewer-jk9oj2074"><span><span>Locating The Port:</span></span></h4></p><p dir="auto" id="viewer-svl872217"><span><span>After opening the apk in jadx, we first searched for where that port number was specifically being referenced. As shown below, this led us to a </span><em><span>static final int</span></em><span> named </span><em><span>COMMAND_RECEIVE_FILE_PORT</span></em><span>.</span></span></p><div data-breakout="normal"><div id="viewer-sa7uk2415"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="sa7uk2415"><wow-image id="82b748_deaef05a4efa48bfbb82745ae6f2df98~mv2.png" data-image-info="{&#34;containerId&#34;:&#34;sa7uk2415&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:1138,&#34;height&#34;:506,&#34;uri&#34;:&#34;82b748_deaef05a4efa48bfbb82745ae6f2df98~mv2.png&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_deaef05a4efa48bfbb82745ae6f2df98~mv2.png/v1/fill/w_980,h_436,al_c,q_90,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_deaef05a4efa48bfbb82745ae6f2df98~mv2.png" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_deaef05a4efa48bfbb82745ae6f2df98~mv2.png/v1/fill/w_1138,h_506,al_c,q_90/82b748_deaef05a4efa48bfbb82745ae6f2df98~mv2.png" draggable="false"/></wow-image></div></div></figure></div></div></div><p dir="auto" id="viewer-q5ul32035"><span><span>Looking for cross-references, we eventually tracked down where it was being used: </span><em><span>com.ratta.supernote.wifip2p.receive</span></em><span>.</span></span></p><div data-breakout="normal"><div id="viewer-rynpl2777"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="rynpl2777"><wow-image id="82b748_6d7076b80bce459f8f521d9bdb05b8f4~mv2.jpg" data-image-info="{&#34;containerId&#34;:&#34;rynpl2777&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:1520,&#34;height&#34;:728,&#34;uri&#34;:&#34;82b748_6d7076b80bce459f8f521d9bdb05b8f4~mv2.jpg&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_6d7076b80bce459f8f521d9bdb05b8f4~mv2.jpg/v1/fill/w_980,h_469,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_6d7076b80bce459f8f521d9bdb05b8f4~mv2.jpg" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_6d7076b80bce459f8f521d9bdb05b8f4~mv2.jpg/v1/fill/w_1520,h_728,al_c,q_85/82b748_6d7076b80bce459f8f521d9bdb05b8f4~mv2.jpg" draggable="false"/></wow-image></div></div></figure></div></div></div><p data-breakout="normal"><h4 dir="auto" id="viewer-81u8g2893"><span><span>
</span><span>Identifying The Service:</span></span></h4></p><p dir="auto" id="viewer-m5inw3273"><span><span>At this point, our goal was to better understand the service running on 60002. </span><span>
</span><span>
</span><span>We can see in the below screenshot that when the port is open, a handful of functions are triggered after something is received over the </span><em><span>ServerSocket</span></em><span>. Specifically, the code of interest resides in the </span><em><span>DeviceThread</span></em><span> class. </span></span></p><div data-breakout="normal"><div id="viewer-f9xcu190444"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="f9xcu190444"><wow-image id="82b748_ff6953aac3e54d6c9f3e02c17b97f28d~mv2.jpg" data-image-info="{&#34;containerId&#34;:&#34;f9xcu190444&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:1520,&#34;height&#34;:240,&#34;uri&#34;:&#34;82b748_ff6953aac3e54d6c9f3e02c17b97f28d~mv2.jpg&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_ff6953aac3e54d6c9f3e02c17b97f28d~mv2.jpg/v1/fill/w_980,h_155,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_ff6953aac3e54d6c9f3e02c17b97f28d~mv2.jpg" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_ff6953aac3e54d6c9f3e02c17b97f28d~mv2.jpg/v1/fill/w_1520,h_240,al_c,q_85/82b748_ff6953aac3e54d6c9f3e02c17b97f28d~mv2.jpg" draggable="false"/></wow-image></div></div></figure></div></div></div><p dir="auto" id="viewer-fpc303306"><span><em><span>DeviceThread</span></em><span> implements </span><em><span>Runnable</span></em><span> and its r</span><em><span>un()</span></em><span> function is a behemoth. That said, a quick glance at it indicates that we are likely dealing with a custom HTTP server based on the way error messages are communicated back to the client.</span></span></p><div data-breakout="normal"><div id="viewer-ek0bm3809"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="ek0bm3809"><wow-image id="82b748_a3884e1f5c384c49aae32ce809b22da7~mv2.jpg" data-image-info="{&#34;containerId&#34;:&#34;ek0bm3809&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:1820,&#34;height&#34;:632,&#34;uri&#34;:&#34;82b748_a3884e1f5c384c49aae32ce809b22da7~mv2.jpg&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_a3884e1f5c384c49aae32ce809b22da7~mv2.jpg/v1/fill/w_980,h_340,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_a3884e1f5c384c49aae32ce809b22da7~mv2.jpg" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_a3884e1f5c384c49aae32ce809b22da7~mv2.jpg/v1/fill/w_1820,h_632,al_c,q_85/82b748_a3884e1f5c384c49aae32ce809b22da7~mv2.jpg" draggable="false"/></wow-image></div></div></figure></div></div></div><p dir="auto" id="viewer-6r8gq3812"><span><span>
</span><span>The first line of </span><em><span>run()</span></em><span> passes the socket over to </span><em><span>getDeviceName()</span></em><span>. </span></span></p><div data-breakout="normal"><div id="viewer-s6py26354"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="s6py26354"><wow-image id="82b748_bc4db5d9fa99471d909a0dc3e5bf29e4~mv2.png" data-image-info="{&#34;containerId&#34;:&#34;s6py26354&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:1130,&#34;height&#34;:182,&#34;uri&#34;:&#34;82b748_bc4db5d9fa99471d909a0dc3e5bf29e4~mv2.png&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_bc4db5d9fa99471d909a0dc3e5bf29e4~mv2.png/v1/fill/w_980,h_158,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_bc4db5d9fa99471d909a0dc3e5bf29e4~mv2.png" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_bc4db5d9fa99471d909a0dc3e5bf29e4~mv2.png/v1/fill/w_1356,h_218,al_c,lg_1,q_85/82b748_bc4db5d9fa99471d909a0dc3e5bf29e4~mv2.png" draggable="false"/></wow-image></div></div></figure></div></div></div><div data-breakout="normal"><div id="viewer-iadwb5052"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="iadwb5052"><wow-image id="82b748_a3fd6042d0db4b498f707a502678a967~mv2.png" data-image-info="{&#34;containerId&#34;:&#34;iadwb5052&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:1708,&#34;height&#34;:1132,&#34;uri&#34;:&#34;82b748_a3fd6042d0db4b498f707a502678a967~mv2.png&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_a3fd6042d0db4b498f707a502678a967~mv2.png/v1/fill/w_980,h_650,al_c,q_90,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_a3fd6042d0db4b498f707a502678a967~mv2.png" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_a3fd6042d0db4b498f707a502678a967~mv2.png/v1/fill/w_1708,h_1132,al_c,q_90/82b748_a3fd6042d0db4b498f707a502678a967~mv2.png" draggable="false"/></wow-image></div></div></figure></div></div></div><p dir="auto" id="viewer-dgazg6445"><span><span>Those of you with a keen eye can probably tell what this is code is doing: parsing out custom headers that our HTTP server expects. This puts into context quite a bit of the strange behavior observed inside </span><em><span>run()</span></em><span> - different operations are being triggered based on what custom headers are passed from the client. </span></span></p><p dir="auto" id="viewer-3zo2y6491"><span><span>For example, we can trigger a 501 error code by providing a </span><em><span>version</span></em><span> header greater than 1</span></span></p><div data-breakout="normal"><div id="viewer-yitpw7073"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="yitpw7073"><wow-image id="82b748_f1c608431cc141f29e6c473cd4bb326f~mv2.png" data-image-info="{&#34;containerId&#34;:&#34;yitpw7073&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:1820,&#34;height&#34;:632,&#34;uri&#34;:&#34;82b748_f1c608431cc141f29e6c473cd4bb326f~mv2.png&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_f1c608431cc141f29e6c473cd4bb326f~mv2.png/v1/fill/w_980,h_340,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_f1c608431cc141f29e6c473cd4bb326f~mv2.png" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_f1c608431cc141f29e6c473cd4bb326f~mv2.png/v1/fill/w_1820,h_632,al_c,q_90/82b748_f1c608431cc141f29e6c473cd4bb326f~mv2.png" draggable="false"/></wow-image></div></div></figure></div></div></div><div data-breakout="normal"><div id="viewer-znxkt1619330"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="znxkt1619330"><wow-image id="82b748_b86a2d869c0649348639bbb4fd11bfce~mv2.png" data-image-info="{&#34;containerId&#34;:&#34;znxkt1619330&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:1132,&#34;height&#34;:230,&#34;uri&#34;:&#34;82b748_b86a2d869c0649348639bbb4fd11bfce~mv2.png&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_b86a2d869c0649348639bbb4fd11bfce~mv2.png/v1/fill/w_980,h_199,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_b86a2d869c0649348639bbb4fd11bfce~mv2.png" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_b86a2d869c0649348639bbb4fd11bfce~mv2.png/v1/fill/w_1358,h_276,al_c,lg_1,q_90/82b748_b86a2d869c0649348639bbb4fd11bfce~mv2.png" draggable="false"/></wow-image></div></div></figure></div></div></div><p dir="auto" id="viewer-c7yk87076"><span><span>
</span><span>And, when we send the request, we actually get a pop-up error saying that the SuperNote device is not on the latest version</span></span></p><div data-breakout="normal"><div id="viewer-enjxy7898"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="enjxy7898"><wow-image id="82b748_2a0a89b77b4241ed92905a46aabeec5b~mv2.jpg" data-image-info="{&#34;containerId&#34;:&#34;enjxy7898&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:3072,&#34;height&#34;:4080,&#34;uri&#34;:&#34;82b748_2a0a89b77b4241ed92905a46aabeec5b~mv2.jpg&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_2a0a89b77b4241ed92905a46aabeec5b~mv2.jpg/v1/fill/w_980,h_1302,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_2a0a89b77b4241ed92905a46aabeec5b~mv2.jpg" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_2a0a89b77b4241ed92905a46aabeec5b~mv2.jpg/v1/fill/w_3072,h_4080,al_c,q_90/82b748_2a0a89b77b4241ed92905a46aabeec5b~mv2.jpg" draggable="false"/></wow-image></div></div></figure></div></div></div><p data-breakout="normal"><h3 dir="auto" id="viewer-zkl428214"><span><span>File Uploading</span></span></h3></p><p dir="auto" id="viewer-sxbk58683"><span><span>All of this is interesting, but what piqued our interest most was the class names: </span><em><span>RecieverManager</span></em><span> and </span><em><span>WiFiP2PService</span></em><span>. Unauthenticated device-to-device file sharing sounds like a potentially great attack surface.</span></span></p><p dir="auto" id="viewer-c70ut8738"><span><span>Given that we at-least know how to interact with the server, at this point we went ahead and mocked up a python client that just sends a POST request with an attached file and all the necessary headers...andddd the file showed up on the device in the INBOX directory!</span></span></p><div data-breakout="normal"><div id="viewer-eb7cz82428"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="eb7cz82428"><wow-image id="82b748_04d4622d0d594985b6a1653c54feb1a4~mv2.png" data-image-info="{&#34;containerId&#34;:&#34;eb7cz82428&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:1645,&#34;height&#34;:930,&#34;uri&#34;:&#34;82b748_04d4622d0d594985b6a1653c54feb1a4~mv2.png&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_04d4622d0d594985b6a1653c54feb1a4~mv2.png/v1/fill/w_980,h_554,al_c,q_90,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_04d4622d0d594985b6a1653c54feb1a4~mv2.png" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_04d4622d0d594985b6a1653c54feb1a4~mv2.png/v1/fill/w_1645,h_930,al_c,q_90/82b748_04d4622d0d594985b6a1653c54feb1a4~mv2.png" draggable="false"/></wow-image></div></div></figure></div></div></div><div data-breakout="normal"><div id="viewer-sijl884273"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="sijl884273"><wow-image id="82b748_7bc40303171c4df2acfaeafa61cc6664~mv2.jpg" data-image-info="{&#34;containerId&#34;:&#34;sijl884273&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:2259,&#34;height&#34;:2144,&#34;uri&#34;:&#34;82b748_7bc40303171c4df2acfaeafa61cc6664~mv2.jpg&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_7bc40303171c4df2acfaeafa61cc6664~mv2.jpg/v1/fill/w_980,h_930,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_7bc40303171c4df2acfaeafa61cc6664~mv2.jpg" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_7bc40303171c4df2acfaeafa61cc6664~mv2.jpg/v1/fill/w_2259,h_2144,al_c,q_90/82b748_7bc40303171c4df2acfaeafa61cc6664~mv2.jpg" draggable="false"/></wow-image></div></div></figure></div></div></div><div data-breakout="normal"><div id="viewer-65m2b87787"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="65m2b87787"><wow-image id="82b748_f8bbae3bde50411299f6479d791c2266~mv2.jpg" data-image-info="{&#34;containerId&#34;:&#34;65m2b87787&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:4080,&#34;height&#34;:3072,&#34;uri&#34;:&#34;82b748_f8bbae3bde50411299f6479d791c2266~mv2.jpg&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_f8bbae3bde50411299f6479d791c2266~mv2.jpg/v1/fill/w_980,h_738,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_f8bbae3bde50411299f6479d791c2266~mv2.jpg" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_f8bbae3bde50411299f6479d791c2266~mv2.jpg/v1/fill/w_4080,h_3072,al_c,q_90/82b748_f8bbae3bde50411299f6479d791c2266~mv2.jpg" draggable="false"/></wow-image></div></div></figure></div></div></div><p data-breakout="normal"><h2 dir="auto" id="viewer-cmavp9601"><span><span>Investigating A Path Traversal:</span></span></h2></p><p dir="auto" id="viewer-3uma010015"><span><span>After figuring out how to get files into the INBOX directory, we did what all good security researchers would do: added some &#34;dot-dot-slashes&#34; to our payload to see what would happen. Specifically, the Nomad has a directory named EXPORT at the same level as INBOX. This EXPORT directory is accessible in the UI, allowing us to quickly verify if the payload worked.</span><span>
</span><span>
</span><span>Our new headers dict includes the path traversal payload, like so:</span></span></p><p dir="auto" id="viewer-nbbb7273647"><span><span>headers = {&#34;version&#34;: &#34;1&#34;, &#34;content-length&#34;: &#34;1234&#34;, &#34;name&#34;: &#34;../../../../../../../../sdcard/EXPORT/testfile.txt&#34;, &#34;devicename&#34;: &#34;testdevice&#34;}</span><span>
</span><span>
</span><span>
</span><span>And what do you know? It worked! </span></span></p><div data-breakout="normal"><div id="viewer-ntr0e89970"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="ntr0e89970"><wow-image id="82b748_b1aab90cb7b14c48872987d985234a37~mv2.jpg" data-image-info="{&#34;containerId&#34;:&#34;ntr0e89970&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:2259,&#34;height&#34;:2003,&#34;uri&#34;:&#34;82b748_b1aab90cb7b14c48872987d985234a37~mv2.jpg&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_b1aab90cb7b14c48872987d985234a37~mv2.jpg/v1/fill/w_980,h_869,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_b1aab90cb7b14c48872987d985234a37~mv2.jpg" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_b1aab90cb7b14c48872987d985234a37~mv2.jpg/v1/fill/w_2259,h_2003,al_c,q_90/82b748_b1aab90cb7b14c48872987d985234a37~mv2.jpg" draggable="false"/></wow-image></div></div></figure></div></div></div><p dir="auto" id="viewer-arzdf9191"><span><span>
</span><span>However, see that pesky &#34;</span><em><span>(1)&#34;</span></em><span> appended to the end of our filename? Yeah, that is going to prove to be quite the problem during exploitation here in a second.</span></span></p><p data-breakout="normal"><h3 dir="auto" id="viewer-1lltc12232"><span><span>
</span><span>Exploit Plan:</span></span></h3></p><p dir="auto" id="viewer-ypx4412829"><span><span>Up until now, we haven&#39;t been entirely honest. </span><span>
</span><span>
</span><span>Going into this, we had a little bit of an idea as to what an exploit </span><em><span>might</span></em><span> look like if we were able to find an arbitrary file write. This idea stemmed from 3 critical pieces of information we came across during our recon.</span></span></p><div data-breakout="normal"><ol><li dir="auto" aria-level="1"><p dir="" id="viewer-7h1o213028"><span><span>SuperNote&#39;s instruction on the Firmware Update page specifically ask you to put the downloaded zip file into the EXPORT directory</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-bjyzx13030"><span><span>A manual firmware update will automatically start after a hotplug event or reboot if a valid update image is found in the EXPORT directory</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-enfgi13032"><span><span>A researcher </span><a target="_blank" href="https://github.com/TA1312/supernote-a5x" rel="noopener noreferrer" data-hook="web-link"><u><span>poked at the previous generation of SuperNote devices</span></u></a><span> and found that firmware images were signed with publicly available debug keys and the bootloader was unlocked by default...nice. We confirmed that while the keys had been renamed on the newer devices, they were still the same.</span></span></p></li></ol></div><p dir="auto" id="viewer-kzbub13036"><span><span>Therefore, we figured we could do the following:</span><span>
</span></span><br role="presentation"/></p><div data-breakout="normal"><ol><li dir="auto" aria-level="1"><p dir="" id="viewer-jtv4s13038"><span><span>Create a backdoored firmware image and sign it with the publicly available debug keys</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-exfcp13040"><span><span>Use the arbitrary write to get the download directly into the &#34;EXPORT&#34; directory</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-lagwr13042"><span><span>An update would automatically be initiated during normal device usage, installing our malicious rootkit. </span></span></p></li></ol></div><p dir="auto" id="viewer-ty4qh13045"><span><span>This was all good in theory, only there was one major problem</span></span></p><p data-breakout="normal"><h3 dir="auto" id="viewer-9p22u10324"><span><span>The Problem</span></span></h3></p><p dir="auto" id="viewer-kmw4c19461"><span><span>Remember that &#34;</span><em><span>(1)</span></em><span>&#34; appended to our filename? Yeah, here is where it comes back to bite us. You see, the service that scans for the update in the EXPORT directory has the following code:</span></span></p><div data-breakout="normal"><div id="viewer-2jexz21864"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="2jexz21864"><wow-image id="82b748_61fcdb7519074a7d87bb0e9652edf8c8~mv2.jpg" data-image-info="{&#34;containerId&#34;:&#34;2jexz21864&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:981,&#34;height&#34;:155,&#34;uri&#34;:&#34;82b748_61fcdb7519074a7d87bb0e9652edf8c8~mv2.jpg&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_61fcdb7519074a7d87bb0e9652edf8c8~mv2.jpg/v1/fill/w_980,h_155,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_61fcdb7519074a7d87bb0e9652edf8c8~mv2.jpg" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_61fcdb7519074a7d87bb0e9652edf8c8~mv2.jpg/v1/fill/w_1373,h_217,al_c,lg_1,q_80/82b748_61fcdb7519074a7d87bb0e9652edf8c8~mv2.jpg" draggable="false"/></wow-image></div></div></figure></div></div></div><p dir="auto" id="viewer-iwfn422201"><span><span>The filename has to be exactly </span><em><span>update.zip</span></em><span>...not </span><em><span>update(1).zip</span></em><span>. </span><span>
</span><span>
</span><span>So we need to figure out </span><em><span>why</span></em><span> the extra number gets appended to our path traversal payload and how we can get rid of it.</span></span></p><p data-breakout="normal"><h4 dir="auto" id="viewer-ijdmu23938"><span><span>Why Does The Filename Change?</span></span></h4></p><p dir="auto" id="viewer-gypml30582"><span><span>After a bit more reverse engineering of the launcher apk, we finally determined the root cause of the issue. While it would be too much code to include via screenshots here, the high-level file reception logic is as follows:</span></span></p><div data-breakout="normal"><ol><li dir="auto" aria-level="1"><p dir="" id="viewer-cjam630676"><span><span>The server first creates a file in its application directory under the  </span><span>
</span><span>&#34;</span><em><span>/</span></em><span>receiver</span><em><span>_file_cache/file_name</span></em><span>&#34; path</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-bnpah30678"><span><span>It then copies the incoming stream of data into that newly created file in &#34;receiver</span><em><span>_file_cache/file_name</span></em><span>&#34; path</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-mv28230680"><span><span>When it has reached the end of the incoming stream of data, it then creates a new file, named `INBOX/file_name`</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-v51c930682"><span><span>It copies the contents from &#34;receiver</span><em><span>_file_cache/file_name&#34;</span></em><span> over to &#34;</span><em><span>INBOX/file_name&#34;</span></em></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-sjw8w30684"><span><span>Finally, it deletes the cached file.</span></span></p></li></ol></div><p dir="auto" id="viewer-clei930687"><span><span>The problem arises due to the continued use of the attacker supplied filename for </span><em><span>all</span></em><span> operations. So for our original attack plan, what ACTUALLY ends up happening on the device is:</span></span></p><div data-breakout="normal"><ol><li dir="auto" aria-level="1"><p dir="" id="viewer-5jw8230689"><span><span>The server receives and creates the &#34;</span><em><span>/</span></em><span>receiver</span><em><span>_file_cache/../../../../sdcard/EXPORT/update.zip</span></em><span>&#34; file, thinking this should be the cache file</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-jrru230691"><span><span>Then after it has finished receiving the data, it goes to create the INBOX file, but actually attempts to create &#34;</span><em><span>/INBOX/../../../../sdcard/EXPORT/update.zip</span></em><span>&#34; again</span></span></p></li></ol></div><p dir="auto" id="viewer-x602o30694"><span><span>Before each file creation event, the following code is run:</span></span></p><div data-breakout="normal"><div id="viewer-90obc41608"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="90obc41608"><wow-image id="82b748_030c9ba864324cf38bb456dd16f18c2d~mv2.png" data-image-info="{&#34;containerId&#34;:&#34;90obc41608&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:763,&#34;height&#34;:365,&#34;uri&#34;:&#34;82b748_030c9ba864324cf38bb456dd16f18c2d~mv2.png&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_030c9ba864324cf38bb456dd16f18c2d~mv2.png/v1/fill/w_763,h_365,al_c,q_85,enc_avif,quality_auto/82b748_030c9ba864324cf38bb456dd16f18c2d~mv2.png" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_030c9ba864324cf38bb456dd16f18c2d~mv2.png/v1/fill/w_916,h_438,al_c,lg_1,q_90/82b748_030c9ba864324cf38bb456dd16f18c2d~mv2.png" draggable="false"/></wow-image></div></div></figure></div></div></div><p dir="auto" id="viewer-gzlga41611"><span><span>
</span><span>As shown, if the name already exists where a new file is to be written, then a &#34;1&#34; (or the next subsequent number) is added to the file name. </span><span>
</span><span>
</span><span>So instead of creating &#34;</span><em><span>/EXPORT/update.zip</span></em><span>&#34;, the 2nd file creation event creates &#34;</span><em><span>EXPORT/update(1).zip</span></em><span>&#34;. </span><span>
</span><span>
</span><span>Then the remaining steps of the process take place: the file contents are copied over, and the the original file (&#34;</span><em><span>/EXPORT/update.zip</span></em><span>&#34;) is deleted, leaving us only with the renamed one.</span><span>
</span></span><br role="presentation"/></p><p data-breakout="normal"><h2 dir="auto" id="viewer-tmmxv45108"><span><span>Finding A Naming Issue Bypass Via A &#34;Race Condition&#34;</span></span></h2></p><p dir="auto" id="viewer-9fmea46376"><span><span>So given our current strategy, we are stuck. We need to figure out how to get our actual update file into EXPORT with the right name. At this point, we spent a lot of time trying to find an actual naming bypass, which naturally didn&#39;t work. </span></span></p><p dir="auto" id="viewer-8qyjp1705807"><span><span>What </span><em><span>did</span></em><span> end up working was taking advantage of a logical &#34;race condition&#34;...technically it&#39;s not </span><em><span>actually</span></em><span> a vulnerability or a traditional race condition, but we can leverage it to our advantage.</span></span></p><p dir="auto" id="viewer-5b2dx46506"><span><span>You see, a legitimate update file is 1.1GB large. That means, it takes quite a bit of time to transfer. Three other factors also play to our advantage: </span></span></p><div data-breakout="normal"><ol><li dir="auto" aria-level="1"><p dir="" id="viewer-uivo446508"><span><span>The file is first created, and then the stream is written byte-by-byte into it.</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-9bk2646510"><span><span>Once the transfer completes, the second file is created, and then the copy starts.</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-yo4tm46512"><span><span>The server is multi-threaded, meaning it can receive multiple files at the same time</span></span></p></li></ol></div><p dir="auto" id="viewer-wl8ax46515"><span><span>We can use these three facts to modify our exploit a bit.</span></span></p><p data-breakout="normal"><h3 dir="auto" id="viewer-m0lft54911"><span><span>Revised Exploit Strategy:</span></span></h3></p><p dir="auto" id="viewer-9gx7s55316"><span><span>Using our understanding of the server logic under the hood, we can use the following trick to satisfy our naming requirements. </span></span></p><div data-breakout="normal"><ol><li dir="auto" aria-level="1"><p dir="" id="viewer-0ds5y55452"><span><span>Create a very small, dummy file named `update.zip`</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-j7jow55454"><span><span>Create a legitimate `update.zip` file that contains our malicious backdoor, signed with the publicly available development keys</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-r3o0e55456"><span><span>Send the the very small, dummy file first</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-0872555458"><span><span>Send the legitimate `update.zip` file immediately after.</span></span></p></li></ol></div><p dir="auto" id="viewer-arfq155461"><span><span>Anddd if we do that, the following happens on device (Note - thread one is </span><em><span>italicized</span></em><span> and thread two is </span><strong><span>bold</span></strong><span>):</span><span>
</span></span><br role="presentation"/></p><div data-breakout="normal"><ol><li dir="auto" aria-level="1"><p dir="" id="viewer-7l3v755463"><span><em><span>`EXPORT/update.zip` is created by the dummy file during the caching / initial reception step</span></em></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-9g64m55465"><span><strong><span>`EXPORT/update(1).zip` is created by the real update during the caching / initial reception step</span></strong></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-vhnvq55467"><span><em><span>`EXPORT/update(2).zip` is created by the dummy file during the copy step</span></em></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-iu45f55469"><span><em><span>`EXPORT/update.zip` is deleted by the dummy file after completion of the copy step</span></em></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-nmn2m55471"><span><strong><span>`EXPORT/update.zip` is created by the real update during copy step</span></strong></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-1pobo55473"><span><strong><span>`EXPORT/update(1).zip` is deleted by the real update after completion of copy step</span></strong></span></p></li></ol></div><p dir="auto" id="viewer-fje7g55475"><span><span>
</span><span>Because our dummy file is so much smaller than the real update file, it completes the caching, copy, and delete steps before the valid update is done being recieved. This leaves the </span><em><span>EXPORT/update.zip </span></em><span>name available when the copy step begins for the valid update.</span><span>
</span></span><br role="presentation"/></p><p dir="auto" id="viewer-okmor55476"><span><span>So, after our exploit runs, we are left with a properly named malicious update image. We also have the &#34;</span><em><span>EXPORT/update(2).zip&#34;</span></em><span> artifact left over from our dummy file&#39;s copy operation, but we don&#39;t care about it. If we want to do clean-up, that could be performed after the rootkit is installed.</span></span></p><p data-breakout="normal"><h2 dir="auto" id="viewer-2hna475547"><span><span>Backdooring The Firmware Image</span></span></h2></p><p dir="auto" id="viewer-i73hl76011"><span><span>We won&#39;t go too in-depth on this step, but we found the development keys needed after a bit of Googling around. From there, we created a backdoor using </span><a target="_blank" href="https://github.com/ng-dst/flashable-android-rootkit" rel="noopener noreferrer" data-hook="web-link"><u><span>flashable-android-rootkit</span></u></a><span> and writing simple C reverse shell payload. </span><span>
</span><span>
</span><span>To re-package the firmware, we followed the recommended method from the </span><a target="_blank" href="https://github.com/TA1312/supernote-a5x?tab=readme-ov-file#build-and-sign-your-own-updatezip" rel="noopener noreferrer" data-hook="web-link"><u><span>previous research</span></u></a><span> and used </span><a target="_blank" href="https://forum.xda-developers.com/t/kitchen-windows-multi-image-kitchen-repack-android-partitions.4326387/" rel="noopener noreferrer" data-hook="web-link"><u><span>Multi Image Kitchen</span></u></a><span> (Note: Finding the right JDK version to get Multi Image Kitchen working was one of the harder parts of this exploit).</span></span></p><p data-breakout="normal"><h2 dir="auto" id="viewer-i12x780254"><span><span>Putting It All Together</span></span></h2></p><p dir="auto" id="viewer-0ceio1728289"><span><span>Once the payload is in position, it will be auto-installed during normal operations of the device. The installer checks the EXPORT directory during hotplug events (usb-c in or out of the device) or during a reboot. Therefore, all you have to do is sit back, wait, and hope the user doesn&#39;t find the potentially suspicious update.zip file in EXPORT.</span><span>
</span><span>
</span><span>Note that after a hotplug event, the user DOES get a prompt about an update. However, it is an opt-OUT prompt, meaning the update will install in 30 seconds unless &#34;abort&#34; is clicked. </span><span>
</span><span>
</span><span>If all goes according to plan, you get the following:</span></span></p><div data-breakout="normal"><div id="viewer-zfduv736756"><div><figure data-hook="figure-IMAGE"><div role="button" data-hook="image-viewer" tabindex="0" aria-haspopup="true"><div id="zfduv736756"><wow-image id="82b748_0b427783183149029b4d36bbf134e381~mv2.jpeg" data-image-info="{&#34;containerId&#34;:&#34;zfduv736756&#34;,&#34;displayMode&#34;:&#34;fill&#34;,&#34;isLQIP&#34;:false,&#34;isSEOBot&#34;:true,&#34;encoding&#34;:&#34;AVIF&#34;,&#34;imageData&#34;:{&#34;width&#34;:1266,&#34;height&#34;:592,&#34;uri&#34;:&#34;82b748_0b427783183149029b4d36bbf134e381~mv2.jpeg&#34;,&#34;name&#34;:&#34;&#34;,&#34;displayMode&#34;:&#34;fill&#34;}}" data-motion-part="BG_IMG" data-bg-effect-name="" data-has-ssr-src=""><img src="https://static.wixstatic.com/media/82b748_0b427783183149029b4d36bbf134e381~mv2.jpeg/v1/fill/w_980,h_458,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/82b748_0b427783183149029b4d36bbf134e381~mv2.jpeg" alt="" data-pin-url="https://www.prizmlabs.io/post/remote-rootkits-uncovering-a-0-click-rce-in-the-supernote-nomad-e-ink-tablet" data-pin-media="https://static.wixstatic.com/media/82b748_0b427783183149029b4d36bbf134e381~mv2.jpeg/v1/fill/w_1266,h_592,al_c,q_85/82b748_0b427783183149029b4d36bbf134e381~mv2.jpeg" draggable="false"/></wow-image></div></div></figure></div></div></div><p data-breakout="normal"><h2 dir="auto" id="viewer-zvge1801209"><span><span>Disclosure Timeline:</span></span></h2></p><div data-breakout="normal"><ul><li dir="auto" aria-level="1"><p dir="" id="viewer-rofgx806585"><span><strong><span>July 26, 2024</span></strong><span> - PRIZM reaches out to Ratta Software&#39;s service team</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-vj2v7821437"><span><strong><span>August 15th, 2024</span></strong><span> - PRIZM follows up with Ratta Software</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-e0d7n838842"><span><strong><span>September 23rd, 2024</span></strong><span> - PRIZM follows up with Ratta Software again, notifying them of plans to publicly disclose the vulnerability at the 90 day disclosure deadline (Oct 23rd)</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-50wc5886742"><span><strong><span>September 30th, 2024</span></strong><span> - PRIZM loops in Ratta software&#39;s &#34;feedback&#34; team in an effort to get a response.</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-9ywvl956740"><span><strong><span>October 2nd, 2024</span></strong><span> - Ratta Software responds, mentioning staff changes had caused the disclosure to slip through the cracks. Team asks for additional information to pass to their head of engineering.</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-8l8s71003229"><span><strong><span>October 3rd, 2024</span></strong><span> - PRIZM provides a 7 page technical report, including full exploit code for local reproduction</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-spcdy1062298"><span><strong><span>October 15th, 2024 </span></strong><span>- PRIZM follows up to ensure the technical details have been recieved and remind of the upcoming 90 day deadline the following week.</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-8zo8s1103678"><span><strong><span>October 16th, 2024</span></strong><span> - SuperNote responds and mentions they plan to address the issues in the December update.</span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-52ucb1143673"><span><strong><span>October 16th, 2024</span></strong><span> - PRIZM replies and agrees to hold off on any disclosure until December 2024. </span></span></p></li><li dir="auto" aria-level="1"><p dir="" id="viewer-lycur627"><span><strong><span>EDIT: April 8th, 2025 - </span></strong><a target="_blank" href="https://nvd.nist.gov/vuln/detail/CVE-2023-30257" rel="noopener noreferrer" data-hook="web-link"><u><span>CVE-2025-32409</span></u></a><span> was assigned.</span></span></p></li></ul></div><p data-breakout="normal"><h2 dir="auto" id="viewer-i5nlv1207837"><span><span>About PRIZM Labs:</span></span></h2></p><p dir="auto" id="viewer-k49wt1213207"><span><span>PRIZM Labs is a security firm primarily focused on the defense and aerospace sectors. The team is currently partnered with </span><a target="_blank" href="https://catalystcampus.org/" rel="noopener noreferrer" data-hook="web-link"><u><span>Catalyst Campus</span></u></a><span> in a Space Force sponsored accelerator to develop binary analysis tooling for mission-critical software.</span><span>
</span><span>
</span><span>PRIZM has a suite of service offerings ranging from product security reviews to custom tool development. Whether you are building a satellite or an e-ink tablet, we&#39;ve got you covered.</span><span>
</span><span>
</span><span>Interested in a free discovery call? </span><a target="_blank" href="https://www.prizmlabs.io/contact-us" rel="noopener noreferrer" data-hook="web-link"><u><span>Contact Us</span></u></a><span> </span></span></p></div></div></div></div></div></div></div></div>
  </body>
</html>
