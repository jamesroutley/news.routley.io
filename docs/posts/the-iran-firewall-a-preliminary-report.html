<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.thc.org/the-iran-firewall-a-preliminary-report">Original</a>
    <h1>The Iran Firewall: A preliminary report</h1>
    
    <div id="readability-page-1" class="page"><div><section><div><div id="post-content-wrapper"><p>I got side tracked for the last 3 days to assess the Great Firewall of Iran (GFI).</p>
<blockquote>
<p>TL;DR</p>
</blockquote>
<p>The GFI uses Deep Packet Inspection (DPI) on all international peering points. In addition the local operators (telco &amp; DSL) use their own Firewall but most of them are static and badly configured. Some use DPI.</p>
<p>The GFI is port number agnostic and changing the port number of a service will not yield success.</p>
<p>The GFI consists of three parts:</p>
<ol>
<li>All blacklisted domains resolve to 10.0.34.35</li>
<li>An active component constantly scans Iran&#39;s internal network for &#39;hostile&#39; services (like open Socks5 proxies).</li>
<li>IP addresses are rarely fully blocked. Instead, the TCP 3-way handshake won&#39;t complete (the syn-ack is dropped).</li>
</ol>
<p>The GFI seems to operate differently almost every day - from severe disruption to barely any disruption.</p>
<p>The most severe disruption is when the regime turns off all cell towers and all local Internet. They just pull the plug and it&#39;s game over for any neo-liberal smart-arse that thinks V2ray/Tor/Shadowsocks is the solution.</p>
<p>All Free Internet is blocked from all Mobile Phones and DSL connections between 4pm and 12pm (it&#39;s OFF). During these hours only VPSs inside of Iran can (sometimes) access the Free Internet. There are V2Ray/Shadowsocks/etc relays on VPSs inside of Iran. They last hours or a few days before getting blocked by the GFI (and then taken down by the local VPS provider).</p>
<p>At the moment the Free Internet is mostly only accessible to geeks and those who can tunnel out using various protocols and tricks. Those geeks are the least concerned (but a bravado for their enthusiasm).</p>
<p>The worst affected are the ordinary citizens. The GFI blocks them effectively. Many people (and mostly women) depend on the Free Internet for work. The illegal regime of Iran uses the GFI as a form of blackmail - to run them out of money (and by that out of their independency).</p>
<p>On bad days:</p>
<ul>
<li>Tor is blocked (since day 1).</li>
<li>Wireguard/OpenVpn is blocked (since day 1)</li>
<li>V2ray/Vmess/Shadowsocks/... are either permanently blocked or blocked as soon as the IP Address of the EXIT node becomes known. </li>
<li>The DPI blocks on TLS&#39;s cleartext SNI.</li>
<li>Any outbound traffic is blocked after 1k-4k is transferred upstream.</li>
<li>Any website that offers VPN solutions is blocked (ProtonVPN, Mullvad, NordVPN, ..). Those who already had the software before the GFI can not use the software (most apps require to register an account or make an API call to a WebRTC - which is blocked).</li>
<li>Cloudflare is blocked (including DoH/DoT).</li>
<li>Docker is sometimes blocked.</li>
<li>Google Play and App Store are blocked.</li>
<li>Some operators use a whitelist and block all other websites.</li>
</ul>
<p>The most blocking local operator is IR-MCI (aka HamrahAvval). They seem to be regime lovers.</p>
<p>The users of Iran can not get to the software that would help them to circumvent the GFI. This is mostly a failing of Google/Apple and the big players: It is no longer (easily) possible to copy software from one device to another (or when the network is down).</p>
<p>China is involved. Connecting to any random port number from the outside world on any server inside of Iran (passing the GFI) is almost always followed by a port probe on <em>that specific port</em> from an IP address belonging to China.</p>
<p>The filtering on TLS by SNI is embarrassing. TLS is not secure until the SNI is encrypted. I was there at the IETF-88 (9 years ago) and part of the TLS-Working group when Eric Rescorla famously said that encrypted SNI is no priority and that the big players like Google/Apple/Facebook/AWS all want speed (lower RTT) over security. We <a target="_blank" href="https://mailarchive.ietf.org/arch/msg/tls/fkIt8X2XZB7RAauV3ujChoWlJWQ/">tried hard to convince the players</a> but got shut down.</p>
<p>Recommendation:</p>
<ol>
<li>The big players (Google/Apple) to implement a feature that allows users to share apps with friends (via Bluetooth) when the network is down.</li>
<li>VPN Providers to make their apps work when above mentioned restrictions are in place.</li>
<li>A mesh-like networking method is needed (using local wifi or Bluetooth) when the main network goes down.</li>
<li>Encrypted SNI needs to happen without fallback to non-encrypted SNI. </li>
<li>Exemption from sanctions to get Starlink and other equipment into the country.</li>
<li>&#34;How to stage a rebellion effectively&#34; should be part of the school&#39;s syllabus. In the years to come the knowledge to rebel against oppression and tyranny will be more useful to our children than knowing about Nietzsche or why Bonobo Apes are always happy. </li>
<li>Does China breach sanctions by providing the GFI as a service?</li>
<li>Iran signed the <a target="_blank" href="https://www.un.org/en/about-us/universal-declaration-of-human-rights">Universal Declaration of Human Rights</a>. May the UN comment on why Iran is allowed to disregard it and what that means for the integrity of the UN if members can pick and choose at will.</li>
</ol>
<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1666960222617/LGiX1EeUo.png?auto=compress,format&amp;format=webp" alt="Screenshot 2022-10-28 at 13.29.35.png"/></p>
<blockquote>
<p>Thank you to all the courageous people of Iran who provided me with access to various servers and DSL systems. You are the true heroes.</p>
</blockquote>
<p>Stay safe and read our <a target="_blank" href="https://hackerschoice.medium.com/it-security-and-privacy-for-the-rebellions-of-the-world-db4023cadcca">IT Security and Privacy for the rebellions around the world</a></p>
<p>THC operates a variety of EXIT nodes and Proxy Services in Iran. We need help. Join us on <a target="_blank" href="https://t.me/+tIblf9hhvBAwOGNk">Telegram</a>.</p>
</div></div></section></div></div>
  </body>
</html>
