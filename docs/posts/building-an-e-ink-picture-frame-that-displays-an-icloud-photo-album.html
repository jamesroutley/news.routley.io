<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ben.page/eink">Original</a>
    <h1>Building an e-ink picture frame that displays an iCloud photo album</h1>
    
    <div id="readability-page-1" class="page"><div>  <p>For Christmas, I gave my parents this e-ink picture frame (built from an old e-reader) that cycles through photos from a shared iCloud photo album:</p><div><div><div><article><p><span>Wrote a blog post about reverse-engineering iCloud photo albums and rooting the Nook! </span><a href="https://ben.page/eink" target="_blank" rel="noopener noreferrer">ben.page/eink</a></p><div><article><p><span>Made an e-ink picture frame for my parents using an old e-reader! It auto-updates with pictures from a shared iCloud photo album:</span></p></article></div></article></div></div></div><p>It&#39;s a re-worked version of a gift that I gave to my girlfriend in October, except that one was in a smaller frame that fell apart pretty quickly:</p><p><img src="https://payments.posthaven.com/posts/eink/IMG_9398%20Large.jpeg" alt="" title=""/></p><p>I rebuilt hers to be more solid, and built one for my parents at the same time. Here&#39;s how I did it:</p><h2>The e-reader</h2><p>For this project I went with a Nook Simple Touch Reader. You can find them on eBay or Facebook Marketplace for $10-$30 used.</p><p><img src="https://payments.posthaven.com/posts/eink/image.png" alt="" title=""/></p><p>The reason to go with a Nook instead of a Kindle or another e-reader is that Nooks run Android under the hood. That means they&#39;re far easier to root and to run Android apps on.</p><p>For that part, I followed <a href="https://shkspr.mobi/blog/2020/02/turn-an-old-ereader-into-an-information-screen-nook-str/">this wonderful post by Terence Eden</a>. The process was quite straightforward; the only thing to note is that you&#39;ll need a microSD card.</p><p>After you get it running Android, as the post describes, you can run an ancient Android app called Electric Sign. This app allows you to put any website on the Nook&#39;s screen and have it refresh at a given interval, with a catch: the Nook doesn&#39;t support SSL. Therefore I had to set up a website that uses <code>http://</code> instead of <code>https://</code>, which is remarkably difficult in this day and age. (I had to set up a custom Nginx server, because you can&#39;t use something like Vercel.)</p><p>But once that part was done, I just had to put the website URL into the Electric Sign app on the Nook and I was all set!</p><h2>The frame</h2><p>I bought <a href="https://www.amazon.com/dp/B09ZQ9GQ95">this pack of 8x10 frames off Amazon</a>, but in general what I was looking for was a frame that was large but could hold a 5x7 picture with a matte. That&#39;s because the Nook&#39;s display was more or less 5x7, but I needed a big frame (8x10) to hold the sides and charging cable coming out the bottom.</p><p>I simply jammed the Nook into the frame and forced the latches on the back shut, with the cable sticking out the bottom. It surprisingly fits the Nook, albeit with some bulging in the back.</p><p>If you look closely, the black bezels at the top and bottom of the Nook would show through the 5x7 hole, so I added some white card stock to have them blend in a bit better.</p><h2>iCloud photo album</h2><p>I wanted to source the images from a shared iCloud photo album. That way, I could share the album with my parents, and they could add new photos that would show up on the frame right from their Photos app.</p><p>iCloud photo albums have no API. However, if you share an iCloud photo album to a public link, you can use the Developer Tools to inspect the API requests Apple is making to get the photos. If you replicate those requests, you too can load the photos from the shared iCloud album (as long as the album stays publicly shared).</p><p>Here&#39;s my <a href="https://laravel.com">Laravel</a> code that I used, for reference:</p><div><pre tabindex="0"><code><span><span>$webstream </span><span>=</span><span> </span><span>Http</span><span>::</span><span>post</span><span>(</span><span>&#39;</span><span>https://p01-sharedstreams.icloud.com/12345678/sharedstreams/webstream</span><span>&#39;</span><span>, [</span></span>
<span><span>    </span><span>&#39;</span><span>streamCtag</span><span>&#39;</span><span> </span><span>=&gt;</span><span> </span><span>null</span></span>
<span><span>]);</span></span>
<span></span>
<span><span>$photoGuids </span><span>=</span><span> </span><span>collect</span><span>($webstream</span><span>-&gt;</span><span>json</span><span>()[</span><span>&#39;</span><span>photos</span><span>&#39;</span><span>])</span><span>-&gt;</span><span>pluck</span><span>(</span><span>&#39;</span><span>photoGuid</span><span>&#39;</span><span>);</span></span>
<span></span>
<span><span>// I wanted the highest quality versions, so those are the checksums I collected for later. </span></span>
<span><span>$checksums </span><span>=</span><span> </span><span>collect</span><span>($webstream</span><span>-&gt;</span><span>json</span><span>()[</span><span>&#39;</span><span>photos</span><span>&#39;</span><span>])</span><span>-&gt;</span><span>map</span><span>(</span><span>function</span><span> ($photo) {</span></span>
<span><span>    $maxFileSize </span><span>=</span><span> </span><span>0</span><span>;</span></span>
<span><span>    $maxFileSizeChecksum </span><span>=</span><span> </span><span>null</span><span>;</span></span>
<span></span>
<span><span>    </span><span>foreach</span><span> ($photo[</span><span>&#39;</span><span>derivatives</span><span>&#39;</span><span>] </span><span>as</span><span> $derivative) {</span></span>
<span><span>        </span><span>if</span><span> ($derivative[</span><span>&#39;</span><span>fileSize</span><span>&#39;</span><span>] </span><span>&gt;</span><span> $maxFileSize) {</span></span>
<span><span>            $maxFileSize </span><span>=</span><span> $derivative[</span><span>&#39;</span><span>fileSize</span><span>&#39;</span><span>];</span></span>
<span><span>            $maxFileSizeChecksum </span><span>=</span><span> $derivative[</span><span>&#39;</span><span>checksum</span><span>&#39;</span><span>];</span></span>
<span><span>        }</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>return</span><span> $maxFileSizeChecksum;</span></span>
<span><span>});</span></span>
<span></span>
<span><span>$assets </span><span>=</span><span> </span><span>Http</span><span>::</span><span>post</span><span>(</span><span>&#39;</span><span>https://p01-sharedstreams.icloud.com/12345678/sharedstreams/webasseturls</span><span>&#39;</span><span>, [</span></span>
<span><span>    </span><span>&#39;</span><span>photoGuids</span><span>&#39;</span><span> </span><span>=&gt;</span><span> $photoGuids,</span></span>
<span><span>]);</span></span>
<span></span>
<span><span>$urls </span><span>=</span><span> </span><span>collect</span><span>($assets</span><span>-&gt;</span><span>json</span><span>()[</span><span>&#39;</span><span>items</span><span>&#39;</span><span>])</span></span>
<span><span>    </span><span>-&gt;</span><span>filter</span><span>(</span><span>function</span><span> ($item, $key) </span><span>use</span><span> ($checksums) {</span></span>
<span><span>        </span><span>return</span><span> $checksums</span><span>-&gt;</span><span>contains</span><span>($key);</span></span>
<span><span>    })</span></span>
<span><span>    </span><span>-&gt;</span><span>map</span><span>(</span><span>function</span><span> ($item) {</span></span>
<span><span>        </span><span>return</span><span> </span><span>&#39;</span><span>https://</span><span>&#39;</span><span> </span><span>.</span><span> $item[</span><span>&#39;</span><span>url_location</span><span>&#39;</span><span>] </span><span>.</span><span> $item[</span><span>&#39;</span><span>url_path</span><span>&#39;</span><span>];</span></span>
<span><span>    })</span></span>
<span><span>    </span><span>-&gt;</span><span>values</span><span>();</span></span>
<span></span>
<span><span>$url </span><span>=</span><span> $urls</span><span>-&gt;</span><span>random</span><span>(); </span><span>// Pick a random photo from the album. </span></span></code></pre></div><p>From this, I just inserted the image into a very simple HTML page, using the <a href="https://wsrv.nl">wsrv.nl</a> API to crop the photo to the exact dimensions of the Nook (600x800 pixels):</p><div><pre tabindex="0"><code><span><span>&lt;</span><span>img</span><span> </span><span>src</span><span>=</span><span>&#34;</span><span>{{</span><span> </span><span>route</span><span>(</span><span>&#39;</span><span>image</span><span>&#39;</span><span>,</span><span> </span><span>[</span><span>&#39;</span><span>url</span><span>&#39;</span><span> </span><span>=&gt;</span><span> </span><span>&#34;</span><span>https://wsrv.nl/?url=</span><span>{$encodedUrl}</span><span>&amp;w=600&amp;h=800&amp;fit=cover&amp;mod=1.2</span><span>&#34;</span><span>],</span><span> </span><span>false</span><span>)</span><span> </span><span>}}</span><span>&#34;</span><span> /&gt;</span></span></code></pre></div><p>I did brighten the images a little (using <code>mod=1.2</code>) so they&#39;d look better on the e-ink screen, and also you&#39;ll notice that I&#39;m going through an <code>image</code> route â€” that&#39;s a route that proxies Apple&#39;s images because those images would normally use <code>https</code> and I need them going through my <code>http</code>-only server so the Nook can load the image.</p><h2>Putting it all together</h2><p>I mounted the Nook in the frame, set the website with the photo from the shared album, and closed it all up with a charging cable so it can stay plugged in all the time. It&#39;s been working beautifully so far!</p>  </div></div>
  </body>
</html>
