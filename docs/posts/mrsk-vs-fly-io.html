<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://fly.io/ruby-dispatch/mrsk-vs-flyio/">Original</a>
    <h1>MRSK vs. Fly.io</h1>
    
    <div id="readability-page-1" class="page"><article> <dl> <dt>Author</dt> <dd> <img src="https://fly.io/static/images/sam.jpg" alt="Sam Ruby" srcset=""/> <dl> <dt>Name</dt> <dd> Sam Ruby </dd> <dt>Social Media</dt> <dd> <a href="https://ruby.social/@samruby" target="_blank" rel="noopener noreferrer"> <span aria-hidden="true">@samruby</span> <span>View Fediverse Profile</span> </a> </dd> </dl> </dd> </dl> <section> <figure> <img src="https://fly.io/ruby-dispatch/2023-03-16/mrsk-vs-flyio-cover.webp" alt="MSRK logo vs Fly&#39;s balloon with boxing gloves"/> <figcaption> <span>Image by</span> <svg role="img" style="pointer-events: none; width: 17px; height: 17px;" viewBox="0 0 20 20" fill="currentColor" fill-rule="evenodd"> <g buffered-rendering="static"> <path fill-rule="evenodd" d="M1 8a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 018.07 3h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0016.07 6H17a2 2 0 012 2v7a2 2 0 01-2 2H3a2 2 0 01-2-2V8zm13.5 3a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM10 14a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path> </g> </svg> <a href="https://annieruygtillustration.com/" target="_blank"> Annie Ruygt </a> </figcaption> </figure> <p><a href="https://world.hey.com/dhh/introducing-mrsk-9330a267">MRSK</a> was introduced last month and it truly is a game changer. From the announcement:</p> <blockquote> <p>It sits on top of basic Docker, and harvests all the benefits you get from isolated containers with a sliver of the complexity associated with most other solutions. Instead of sending the deployment pipeline off to servers in the cloud, it runs entirely on your own machine. Just like Capistrano did.</p> </blockquote> <p>And it appears that the admiration is mutual:</p> <p><a href="https://twitter.com/dhh/status/1632044101418745864"><img src="https://fly.io/ruby-dispatch/2023-03-16/dhh-praise-tweet.webp" alt="DHH Praise Tweet"/></a></p> <p>Aw, shucks. Makes me want to blush. I suspect that much of the admiration is due to the fact that <a href="https://fly.io/">fly.io</a> shares more in common with your local data-center than with most cloud providers. <a href="https://fly.io/blog/the-serverless-server/">We transmogrify Docker containers into lightweight micro-VMs and run them on our own hardware in racks around the world, so your apps can run close to your users</a>. It is also worth noting that the back-end for our GraphQL API is a <a href="https://fly.io/docs/hiring/stack/">Rails app</a>.</p> <hr/> <p>While there are plenty of differences between MRSK and fly.io, the starting and end points are pretty much the same.</p> <p>You start with an application and a Dockerfile. Rails 7.1 will <a href="https://fly.io/ruby-dispatch/rails-on-docker/">provide a starter Dockerfile</a>. <code>fly launch</code> will use this Dockerfile if it exists, otherwise it will provide Dockerfiles for all current versions of Rails as well as a number of other frameworks including Elixir, Laravel, Django, a number of Node frameworks, and even Rack apps. We even make <a href="https://github.com/rubys/dockerfile-rails">dockerfile-rails</a> available to all - you are welcome to use it to build Dockerfiles for your existing Rails applications and deploy to any datacenter or cloud using MRSK.</p> <p>The desired result is to have multiple instances of your application deployed, each connected to a common database, load balanced, protected by a firewall, with a SSL certificate, and monitored with <a href="https://fly.io/ruby-dispatch/health-checks/">health checks</a>.</p> <hr/> <p>DHH followed up with a video demonstrating the workflow using MRSK:</p> <p><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I"> <img src="https://img.youtube.com/vi/LL1cV2FXZ5I/0.jpg"/> </a></p><p>Following are key points in the video:</p> <div><table><thead><tr> <th>Time</th> <th>Description</th> </tr> </thead><tbody><tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=134">2:15</a></td> <td>MRSK requires a bit of knowledge of Linux and Docker</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=174">2:55</a></td> <td><code>rails new ship --main --css tailwind</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=181">3:02</a></td> <td><code>cd ship</code></td> </tr> <tr> <td></td> <td><code>rails g scaffold post title:string body:text</code></td> </tr> <tr> <td></td> <td><code>rails db:migrate</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=218">3:39</a></td> <td>Hetzner - select region</td> </tr> <tr> <td></td> <td>Create server</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=251">4:12</a></td> <td>create <code>config/deploy.yml</code></td> </tr> <tr> <td></td> <td>specify the service name, image name</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=259">4:20</a></td> <td>grab the ip address, paste into deploy.yml</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=267">4:28</a></td> <td>set up an environment template: mrsk envify</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=283">4:44</a></td> <td><code>mrsk deploy</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=390">6:31</a></td> <td>note that docker may need to be restarted;</td> </tr> <tr> <td></td> <td>recommend remote docker buildx setup</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=434">7:15</a></td> <td>create another vm for db and app servers</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=451">7:32</a></td> <td>add two firewalls - ports 80 and 22 for the app servers, 3306 for db</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=507">8:28</a></td> <td>add load balancer</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=534">8:55</a></td> <td>change rails db config, install gem, change <code>config/deploy.yml</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=579">9:40</a></td> <td>create database</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=608">10:09</a></td> <td>update <code>config/database.yml</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=622">10:23</a></td> <td>update env template with mysql root password</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=643">10:44</a></td> <td><code>mrsk setup</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=679">11:20</a></td> <td><code>mrsk redploy</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=697">11:38</a></td> <td><code>mrsk details</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=758">12:39</a></td> <td><code>mrsk rollback</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=790">13:11</a></td> <td>setup domain name using Cloudflare</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=827">13:48</a></td> <td>http3 and compression</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=861">14:22</a></td> <td>failure - look at logs with nice grep feature!</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=883">14:44</a></td> <td>origin mismatch</td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=905">15:06</a></td> <td>uncomment two lines in <code>config/environments/production.rb</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=LL1cV2FXZ5I&amp;t=927">15:28</a></td> <td><code>mrsk redeploy</code></td> </tr> </tbody></table></div><p>Inspired by DHH&#39;s video, I made one of my own, developing and deploying the same application. I substituted fly.io for Hetzner. Rails 7.0.4.3 for Rails 7.1.0.alpha. And Postgresql for MySQL.</p> <p><a href="https://www.youtube.com/watch?v=eHWPx04J1OY"> <img src="https://img.youtube.com/vi/eHWPx04J1OY/0.jpg"/> </a></p><p>Here are the key points in the video:</p> <div><table><thead><tr> <th>Time</th> <th>Description</th> </tr> </thead><tbody><tr> <td><a href="https://www.youtube.com/watch?v=eHWPx04J1OY&amp;t=80">1:21</a></td> <td><code>rails new ship --css tailwind</code></td> </tr> <tr> <td></td> <td><code>cd ship</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=eHWPx04J1OY&amp;t=109">1:50</a></td> <td><code>rails g scaffold post title:string body:text</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=eHWPx04J1OY&amp;t=113">1:54</a></td> <td><code>flyctl launch --force-machines --region ord</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=eHWPx04J1OY&amp;t=187">3:08</a></td> <td><code>fly deploy</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=eHWPx04J1OY&amp;t=269">4:30</a></td> <td><code>fly open</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=eHWPx04J1OY&amp;t=301">5:02</a></td> <td><code>fly machine clone --region cdg</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=eHWPx04J1OY&amp;t=347">5:48</a></td> <td><code>fly dashboard</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=eHWPx04J1OY&amp;t=444">7:25</a></td> <td><code>vi app/views/posts/index.html.erb</code></td> </tr> <tr> <td><a href="https://www.youtube.com/watch?v=eHWPx04J1OY&amp;t=461">7:42</a></td> <td><code>fly deploy</code></td> </tr> </tbody></table></div><figure> <figcaption> <p> I used the <a href="https://fly.io/terminal">Fly.io terminal</a> for this demo - try it yourself if you have a GitHub account or an email address. You can also run this on your own machine, we have a <a href="https://fly.io/docs/hands-on/">Hands-on</a> guide that will walk you through the steps.</p><p><a href="https://fly.io/docs/rails/"> Try Fly for free  <span>→</span> </a></p> </figcaption><p><img src="https://fly.io/static/images/cta-kitty.jpg" srcset="/static/images/cta-kitty@2x.jpg 2x" alt=""/></p></figure><p>Like DHH, I started with a cold cache - in particular with no Docker layers already having previously been built. Unlike DHH, I chose <strong>NOT</strong> to fast forward over the boring parts, as I want to realistically depict how long it takes to deploy an application.</p> <hr/> <p>Both Fly.io and MRSK are young, and undoubtedly will learn much from each other. I am particularly envious of rollback, love the log grep feature, and while Cloudflare has moved on to HTTP/3, Fly.io is currently only at HTTP/2.</p> <p>As both MRSK and fly.io share the goal of providing to the developer only a <em>sliver of the complexity associated with most other solutions</em>, the true winners of these types of competition are developers everywhere.</p> <p>By standardizing on a common piece of infrastructure, in this case Dockerfiles, people are free to pick the solution that best suits their needs, confident in the fact that they can switch back and forth or even use both simultaneously as there is no lock in here.</p> <p>We welcome you to compare our <a href="https://fly.io/docs/about/pricing/">prices</a> against your favorite data center or cloud, and to draw your own conclusions as to matters like developer ergonomics and ease of use.</p>  </section> <dl> <dt> Previous post  ↓ </dt> <dd> <a href="https://fly.io/ruby-dispatch/little-gestures-of-confidence/"> Little Gestures of Confidence Make Our Tools &amp; Community Better </a> </dd> </dl> </article></div>
  </body>
</html>
