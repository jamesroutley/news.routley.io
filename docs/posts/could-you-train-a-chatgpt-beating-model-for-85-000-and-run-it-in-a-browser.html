<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://simonwillison.net/2023/Mar/17/beat-chatgpt-in-a-browser/">Original</a>
    <h1>Could you train a ChatGPT-beating model for $85,000 and run it in a browser?</h1>
    
    <div id="readability-page-1" class="page"><div>




<p>I think it’s now possible to train a large language model with similar functionality to GPT-3 for $85,000. And I think we might soon be able to run the resulting model entirely in the browser, and give it capabilities that leapfrog it ahead of ChatGPT.</p>
<p>This is currently wild speculation on my part, but bear with me because I think this is worth exploring further.</p>
<p>Large language models with GPT-3-like capabilities cost millions of dollars to build, thanks to the cost of running the expensive GPU servers needed to train them. Whether you are renting or buying those machines, there are still enormous energy costs to cover.</p>
<p>Just one example of this: the <a href="https://huggingface.co/bigscience/bloom-7b1">BLOOM large language model</a> was trained in France with the support of the French government. The cost was estimated as $2-5M, it took almost four months to train and boasts about its low carbon footprint because most of the power came from a nuclear reactor!</p>
<p>[ Fun fact: as of a few days ago you can now <a href="https://github.com/NouamaneTazi/bloomz.cpp">run the openly licensed BLOOM on your own laptop</a>, using Nouamane Tazi’s adaptive copy of the <code>llama.cpp</code> code that made that possible for LLaMA ]</p>
<p>Recent developments have made me suspect that these costs could be made dramatically lower. I think a capable language model can now be trained from scratch for around $85,000.</p>
<h4>It’s all about that LLaMA</h4>
<p>The LLaMA plus Alpaca combination is the key here.</p>
<p>I wrote about these two projects previously:</p>
<ul>
<li>
<a href="https://simonwillison.net/2023/Mar/11/llama/">Large language models are having their Stable Diffusion moment</a> discusses the significance of LLaMA</li>
<li>
<a href="https://simonwillison.net/2023/Mar/13/alpaca/">Stanford Alpaca, and the acceleration of on-device large language model development</a> describes Alpaca</li>
</ul>
<p>To recap: <a href="https://research.facebook.com/publications/llama-open-and-efficient-foundation-language-models/">LLaMA</a> by Meta research provided a GPT-3 class model trained entirely on documented, available public training information, as opposed to OpenAI’s continuing practice of not revealing the sources of their training data.</p>
<p>This makes the model training a whole lot more likely to be replicable by other teams.</p>
<p>The paper also describes some enormous efficiency improvements they made to the training process.</p>
<p>The LLaMA research was still extremely expensive though. From the paper:</p>
<blockquote>
<p>... we estimate that we used 2048 A100-80GB for a period of approximately 5 months to develop our models</p>
</blockquote>
<p>My friends at <a href="https://replicate.com/">Replicate</a> told me that a simple rule of thumb for A100 cloud costs is $1/hour.</p>
<p>2048 * 5 * 30 * 24 = $7,372,800</p>
<p>But... that $7M was the cost to both iterate on the model and to train all four sizes of LLaMA that they tried: 7B, 13B, 33B, and 65B.</p>
<p>Here’s Table 15 from the paper, showing the cost of training each model.</p>
<p><img src="https://static.simonwillison.net/static/2023/llama-table-15.jpg" alt="Table 15: Carbon footprint of training different models in the same data center. We follow Wu et al. (2022) to compute carbon emission of training OPT, BLOOM and our models in the same data center. For the power consumption of a A100-80GB, we take the thermal design power for NVLink systems, that is 400W. We take a PUE of 1.1 and a carbon intensity factor set at the national US average of 0.385 kg COze per KWh. Lists 6 models. OPT-175B: 809,472 GPU hours, 356 MWh, 137 tons CO2. BLOOM-175B: 1,082,880 GPU hours, 475 MWh, 183 tons. LLaMA-7B: 82,432 GPU hours, 36 MWh, 14 tons. LLaMA-13B: 135,168 GPU hours, 59 MWh, 23 tons. LLaMA-33B: 530,432 GPU hours, 233 MWh, 90 tons. LLaMA-65B: 1,022,362 GPU hours, 449 MWh, 173 tons."/></p>
<p>This shows that the smallest model, LLaMA-7B, was trained on 82,432 hours of A100-80GB GPUs, costing 36MWh and generating 14 tons of CO2.</p>
<p>(That’s about 28 people flying from London to New York.)</p>
<p>Going by the $1/hour rule of thumb, this means that provided you get everything right on your first run you can train a LLaMA-7B scale model for around $82,432.</p>
<h4>Upgrading to Alpaca</h4>
<p>You can run LLaMA 7B <a href="https://til.simonwillison.net/llms/llama-7b-m2">on your own laptop</a> (or even <a href="https://twitter.com/ggerganov/status/1635605532726681600">on a phone</a>), but you may find it hard to get good results out of. That’s because it hasn’t been instruction tuned, so it’s not great at answering the kind of prompts that you might send to ChatGPT or GPT-3 or 4.</p>
<p><a href="https://crfm.stanford.edu/2023/03/13/alpaca.html">Alpaca</a> is the project from Stanford that fixes that. They fine-tuned LLaMA on 52,000 instructions (of <a href="https://simonwillison.net/2023/Mar/13/alpaca/#bonus-training-data">somewhat dubious origin</a>) and claim to have gotten ChatGPT-like performance as a result... from that smallest 7B LLaMA model!</p>
<p>You can <a href="https://crfm.stanford.edu/alpaca/">try out their demo</a> (<strong>update:</strong> no you can’t, “Our live demo is suspended until further notice”) and see for yourself that it really does capture at least some of that ChatGPT magic.</p>
<p>The best bit? The Alpaca fine-tuning can be done for less than $100. The Replicate team have repeated the training process and <a href="https://replicate.com/blog/replicate-alpaca">published a tutorial</a> about how they did it.</p>
<p>Other teams have also been able to replicate the Alpaca fine-tuning process, for example <a href="https://github.com/antimatter15/alpaca.cpp">antimatter15/alpaca.cpp</a> on GitHub.</p>
<p>We are still within our $85,000 budget! And Alpaca—or an Alpaca-like model using different fine tuning data—is the ChatGPT on your own device model that we’ve all been hoping for.</p>
<h4>Could we run it in a browser?</h4>
<p>Alpaca is effectively the same size as LLaMA 7B—around 3.9GB (after 4-bit quantization ala <a href="https://simonwillison.net/2023/Mar/17/beat-chatgpt-in-a-browser/github.com/ggerganov/llama.cpp">llama.cpp</a>). And LLaMA 7B has already been shown running on a whole bunch of different personal devices: laptops, Raspberry Pis (very slowly) and even a Pixel 5 phone at a decent speed!</p>
<p>The next frontier: running it in the browser.</p>
<p>I saw two tech demos yesterday that made me think this may be possible in the near future.</p>
<p>The first is <a href="https://github.com/xenova/transformers.js">Transformers.js</a>. This is a WebAssembly port of the Hugging Face <a href="https://huggingface.co/docs/transformers/index">Transformers</a> library of models—previously only available for server-side Python.</p>
<p>It’s worth spending some time with <a href="https://xenova.github.io/transformers.js/">their demos</a>, which include some smaller language models and some very impressive image analysis languages too.</p>
<p>The second is <a href="https://github.com/mlc-ai/web-stable-diffusion">Web Stable Diffusion</a>. This team managed to get the Stable Diffusion generative image model running entirely in the browser as well!</p>
<p>Web Stable Diffusion uses WebGPU, a still emerging standard that’s currently only working in Chrome Canary. But it does work! It rendered me this image of two raccoons eating a pie in the forest in 38 seconds.</p>
<p><img src="https://static.simonwillison.net/static/2023/web-stable-diffusion-raccoons.jpg" alt="mig.ai/web-stable-diffusion/ in a browser. The input prompt is two racoons eating a pie in the woods, with the default 20 step scheduler. After 38 seconds elapsed on the prograss bar a realistic photograph of two raccoons eating a fruit pie appears - although on closer inspection the raccoon holding the pie has three paws!"/></p>
<p>The Stable Diffusion model this loads into the browser is around 1.9GB.</p>
<p>LLaMA/Alpaca at 4bit quantization is 3.9GB.</p>
<p>The sizes of these two models are similar enough that I would not be at all surprised to see an Alpaca-like model running in the browser in the not-too-distant future. I wouldn’t be surprised if someone is working on that right now.</p>
<h4 id="react-pattern">Now give it extra abilities with ReAct</h4>
<p>A model running in your browser that behaved like a less capable version of ChatGPT would be pretty impressive. But what if it could be MORE capable than ChatGPT?</p>
<p>The <a href="https://react-lm.github.io/">ReAct prompt pattern</a> is a simple, proven way of expanding a language model’s abilities by giving it access to extra tools.</p>
<p>Matt Webb explains the significance of the pattern in <a href="https://interconnected.org/home/2023/03/16/singularity">The surprising ease and effectiveness of AI in a loop</a>.</p>
<p>I got it working with a few dozen lines of Python myself, which I described in <a href="https://til.simonwillison.net/llms/python-react-pattern">A simple Python implementation of the ReAct pattern for LLMs</a>.</p>
<p>Here’s the short version: you tell the model that it must think out loud and now has access to tools. It can then work through a question like this:</p>
<blockquote>
<p><strong>Question:</strong> Population of Paris, squared?</p>
<p><strong>Thought:</strong> I should look up the population of paris and then multiply it</p>
<p><strong>Action:</strong> search_wikipedia: Paris</p>
</blockquote>
<p>Then it stops. Your code harness for the model reads that last line, sees the action and goes and executes an API call against Wikipedia. It continues the dialog with the model like this:</p>
<blockquote>
<p><strong>Observation:</strong> &lt;truncated content from the Wikipedia page, including the 2,248,780 population figure&gt;</p>
</blockquote>
<p>The model continues:</p>
<blockquote>
<p><strong>Thought:</strong> Paris population is 2,248,780 I should square that</p>
<p><strong>Action:</strong> calculator: 2248780 ** 2</p>
</blockquote>
<p>Control is handed back to the harness, which passes that to a calculator and returns:</p>
<blockquote>
<p><strong>Observation:</strong> 5057011488400</p>
</blockquote>
<p>The model then provides the answer:</p>
<blockquote>
<p><strong>Answer:</strong> The population of Paris squared is 5,057,011,488,400</p>
</blockquote>
<p>Adding new actions to this system is trivial: each one can be a few lines of code.</p>
<p>But as <a href="https://react-lm.github.io/">the ReAct paper</a> demonstrates, adding these capabilities to even an under-powered model (such as LLaMA 7B) can dramatically improve its abilities, at least according to several common language model benchmarks.</p>
<p>This is essentially what Bing is! It’s GPT-4 with the added ability to run searches against the Bing search index.</p>
<p>Obviously if you’re going to give a language model the ability to execute API calls and evaluate code you need to do it in a safe environment! Like for example... a web browser, which runs code from untrusted sources as a matter of habit and has the most thoroughly tested sandbox mechanism of any piece of software we’ve ever created.</p>
<h4 id="llm-conclusion">Adding it all together</h4>
<p>There are a lot more groups out there that can afford to spend $85,000 training a model than there are that can spend $2M or more.</p>
<p>I think LLaMA and Alpaca are going to have a lot of competition soon, from an increasing pool of openly licensed models.</p>
<p>A fine-tuned LLaMA scale model is leaning in the direction of a ChatGPT competitor already. But... if you hook in some extra capabilities as seen in ReAct and Bing even that little model should be able to way outperform ChatGPT in terms of actual ability to solve problems and do interesting things.</p>
<p>And we might be able to run such a thing on our phones... or even in our web browsers... sooner than you think.</p>
<h4 id="llm-cheaper">And it’s only going to get cheaper</h4>

<p><a href="https://twitter.com/tobi/status/1636810016140271616">Tobias Lütke on Twitter:</a></p>

<blockquote data-conversation="none"><p lang="en" dir="ltr">H100s are shipping and you can half this again. Twice (or more) if fp8 works.</p>- tobi lutke (@tobi) <a href="https://twitter.com/tobi/status/1636810016140271616?ref_src=twsrc%5Etfw">March 17, 2023</a></blockquote>

<p>The <a href="https://www.nvidia.com/en-us/data-center/h100/">H100</a> is the new Tensor Core GPU from NVIDIA, which they claim can offer up to a 30x performance improvement over their current A100s.</p>




</div></div>
  </body>
</html>
