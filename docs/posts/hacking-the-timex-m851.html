<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lock.cmpxchg8b.com/timex.html">Original</a>
    <h1>Hacking the Timex m851</h1>
    
    <div id="readability-page-1" class="page">

<nav id="TOC">
<ul>
<li><a href="#intro">Intro</a></li>
<li><a href="#watchapps">WatchApps</a></li>
<li><a href="#conclusion">Conclusion</a><ul>
<li><a href="#availabliity">Availabliity</a></li>
</ul></li>
</ul>
</nav>
<p><small> <em>This post is part of a series on my quest to find the perfect watch.</em> </small></p>
<section id="intro">

<p><a href="https://lock.cmpxchg8b.com/img/datalink.jpg" title="Timex m851"><img src="https://lock.cmpxchg8b.com/img/datalink.jpg" alt="Timex m851"/></a></p>
<p>Take a look at this watch, itâ€™s just some boring watch for runners, right?</p>
<p>Nope, I think this might be the best ultra-low power consumer digital watch ever produced!</p>
<p>Let me explainâ€¦</p>
<section id="specifications">
<h4>Specifications</h4>
<p>This is the Timex m851. It uses an 8-bit Seiko SC188 CPU, has 48KB of ROM, 2KB of RAM and a 42x11 dot matrix main display.</p>
<p>The cpu is designed for ultra-low power operation - a single battery can last 3 <em>years</em>!</p>
<p>This is a big selling point for me, I donâ€™t think theyâ€™re making consumer watches like this any more.</p>
<p><img src="https://lock.cmpxchg8b.com/img/datalink-usb.jpg" alt="Timex USB"/> <img src="https://lock.cmpxchg8b.com/img/datalink-pins.jpg" alt="Timex USB"/></p>
<p>Those pins on the side? Thatâ€™s USB. Naturally, you can synchronize things like appointments, and so on (thereâ€™s a neat <a href="https://github.com/HuidaeCho/libdlusb">linux library</a> for that).</p>
<p>Hereâ€™s where it getâ€™s interestingâ€¦ this thing has an SDK, and it is <em>surprisingly</em> good!</p>
<p>You can just <code>$ cc helloworld.c</code>, and upload it to your watch.</p>
<p>I didnâ€™t really think I would be enamored with this watch at first â€“ the Windows XP-era wizard Timex provided for development wasâ€¦ <strong><em>painful</em></strong>. However, it turned out it was just driving a UNIX-like toolchain behind the scenes.</p>
<p>After pulling that out, hacking this started to become pretty fun!</p>
<blockquote>
<p><img src="https://lock.cmpxchg8b.com/img/datalink-make.gif" alt="Makefile"/> <img src="https://lock.cmpxchg8b.com/img/watch.gif" alt="Hello World"/></p>
</blockquote>
</section>
</section>
<section id="watchapps">

<p>Just want to see some code? No problem, Iâ€™ve uploaded a <em>hello world</em> and a <code>Makefile</code> to build it to github:</p>
<p><a href="https://github.com/taviso/timex/">https://github.com/taviso/timex/</a></p>
<p>If you want to browse the full manual, there are some links below.</p>
<p>You can do some fun things with this, people wrote all kinds of <a href="https://www.youtube.com/watch?v=mitJafrsimw">games</a> and productivity <a href="https://rayslogic.com/Software/TimexUSB/TimexUSB.htm">tools</a>.</p>
<p>If you want a TL;DR of development, Iâ€™ll try!</p>
<section id="design">
<h4>Design</h4>
<section id="states-and-modes">
<h5>States and Modes</h5>
<p>You need to split your application into <em>states</em>.</p>
<p>A <em>state</em> is just a way to swap code in and out as needed. When you switch states, the active code is discarded and the new code is swapped in.</p>
<blockquote>
<p>You <em>could</em> write an app that uses up to ~30kb of code and/or data, <em>but</em> there is only ~2kb of RAM. This is why you need to use states, there is no paging and you couldnâ€™t fit that in!</p>
</blockquote>
<p>There is room for some <em>common</em> code that all your states share, and of course there is space for variables, and a database API for persistent data.</p>
<p>The first few states are reserved for handling common events. The rest you can use for anything you want - you just ask the kernel to switch you whenever you need it!</p>

<p>A <em>mode</em> is just a foreground application.</p>
<p>Your app is (probably) providing a mode, but you can also add background tasks, periodic tasks, and so on.</p>
<p>Requesting a mode change is sort of like <code>exit()</code>, the next app will gain control.</p>

</section>
<section id="events">
<h5>Events</h5>
<p>Each state needs an event handler. A super simple one would be like this:</p>

<p>In general, you can ignore any event you donâ€™t care about.</p>
</section>
<section id="services">
<h5>Services</h5>
<p>The kernel takes care of handling the hardware, dispatching events to you and provides various services.</p>
<p>Things like timers, generating tones (beeps), scrolling the display, access to database records, etc.</p>

<p>The watch has a crown - and you can ask the kernel to configure it in a few different ways. For example, you might want pulse mode so you can monitor how quickly the user is turning it.</p>
<blockquote>
<figure>
<img src="https://lock.cmpxchg8b.com/img/crown.gif" alt="Crown Demo"/><figcaption>Crown Demo</figcaption>
</figure>
</blockquote>
<p>It has a backlight, you can control that from software too.</p>
</section>
</section>
<section id="debugging">
<h4>Debugging</h4>
<p>Thereâ€™s no memory protection or anything, you can just clobber the kernel if you wantâ€¦ so what happens if you crash?</p>
<p>Well, one thing the kernel does is notify a watchdog every 2 seconds that itâ€™s still alive. If the watchdog doesnâ€™t see that notification, it will just reset the watchâ€¦ so try not to do that! ðŸ˜€</p>
<p>If youâ€™re doing some heavy computation you could accidentally trigger the watchdog. Just remember to let the watchdog know youâ€™re still alive:</p>
<pre><code> // Let the watchdog know we&#39;re not dead.
 hwResetWatchdog();</code></pre>
<section id="simulator">
<h5>Simulator</h5>
<p>Luckily thereâ€™s a really good simulator available, so you donâ€™t have to sit through tedious resets everytime you make a typo. Itâ€™s actually an open source 3rd party tool, <a href="https://sourceforge.net/projects/virtualdatalink/">Virtual Datalink</a>.</p>
<blockquote>
<p>Sadly itâ€™s for Windows only. I would port it to Linux, but itâ€™s written in Delphiâ€¦ is it feasible to port it to free pascal? Let me know!</p>
</blockquote>
<p>It has conditional breakpoints, a dissasembler, save states, resource and power analysis. Iâ€™ve found it pretty capable.</p>
<blockquote>
<figure>
<img src="https://lock.cmpxchg8b.com/img/vdatalink.gif" alt="Virtual Datalink"/><figcaption>Virtual Datalink</figcaption>
</figure>
</blockquote>
</section>
</section>
</section>
<section id="conclusion">

<p>The main app Iâ€™m working on right now is integrating my watch with <a href="https://dianne.skoll.ca/projects/remind/">remind</a>.</p>
<p>Hacking this little watch has been a super fun project!</p>
<section id="availabliity">
<h2>Availabliity</h2>
<p>Now that Iâ€™ve told you how much I love this thing - the bad news.</p>
<p>Theyâ€™re long out of production, and getting hard to come by.</p>
<p>I bought a set of two on eBay, they just needed new batteries and were as good as new.</p>
<p>If this is the sort of thing that appeals to you, setup an alert and then help me hack on it ðŸ˜€</p>
<section id="references">
<h4>References</h4>
<ul>
<li>The most important doc is the <a href="https://assets.timex.com/developer/developer_downloads/WA_Design_Guide.pdf">Design Guide</a>, itâ€™s very well written.</li>
<li>Then of course, you need the <a href="https://www.rayslogic.com/Software/TimexUSB/Docs/s1c88%20core%20cpu%20manual.pdf">CPU manual</a>. Itâ€™s also excellent!</li>
<li>The toolchain also has a thorough manual.</li>
<li>Finally, the complete <a href="https://assets.timex.com/developer/developer_downloads/WA_API_Reference.pdf">API reference</a> lists the services provided by the Kernel.</li>
</ul>
</section>
</section>
</section>



</div>
  </body>
</html>
