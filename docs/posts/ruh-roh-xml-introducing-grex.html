<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.jakelow.com/blog/introducing-grex">Original</a>
    <h1>Ruh-roh, XML! Introducing grex</h1>
    
    <div id="readability-page-1" class="page"><div><article><header><span> <time datetime="2025-10-31">October 31, 2025 </time> </span></header><p>I’m being haunted by XML. Or I must be, because this is the second Halloween that I’ve spent writing a little CLI tool to wrangle it. Last year it was <a href="https://github.com/jake-low/xpath-cli" rel="external">xpath-cli</a>, which evaluates <a href="https://en.wikipedia.org/wiki/XPath" rel="external">XPath</a> expressions on XML or HTML documents. It’s simple (just a tiny wrapper around <a href="https://gitlab.gnome.org/GNOME/libxml2/-/wikis/home" rel="external">libxml2</a>), but it has seen me through many perils.</p><p>This year, the apparitions are back, and to fend them off I wrote <a href="https://github.com/jake-low/grex" rel="external">grex</a>. <code>grex</code> flattens an XML document into a line-oriented format that’s easy to work on with UNIX tools like <code>grep</code>, <code>sed</code>, <code>awk</code>, <code>diff</code>, <code>cat</code>, and so on. Afterwards you can use the <code>--ungrex</code> mode to convert back to XML (<em>if you dare!</em>). It’s directly inspired by <a href="https://github.com/tomnomnom/gron" rel="external">gron</a> which does the same thing for JSON data.</p><p>Here’s an example. Given this XML document:</p><pre aria-label="xml code" data-lang="xml" data-label="xml"><code><span><span><span>&lt;</span>mystery</span> <span>id</span><span><span>=</span><span>&#34;</span>014<span>&#34;</span></span> <span>episode</span><span><span>=</span><span>&#34;</span>Go Away Ghost Ship<span>&#34;</span></span> <span>location</span><span><span>=</span><span>&#34;</span>Harbor<span>&#34;</span></span><span>&gt;</span></span>
  <span><span><span>&lt;</span>suspect</span><span>&gt;</span></span>Ghost of Redbeard<span><span><span>&lt;/</span>suspect</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>clues</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>clue</span> <span>location</span><span><span>=</span><span>&#34;</span>Ghost Ship<span>&#34;</span></span><span>&gt;</span></span>Dry ice in storeroom<span><span><span>&lt;/</span>clue</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>clue</span> <span>location</span><span><span>=</span><span>&#34;</span>Ghost Ship<span>&#34;</span></span><span>&gt;</span></span>Wire-operated sword<span><span><span>&lt;/</span>clue</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>clue</span> <span>location</span><span><span>=</span><span>&#34;</span>Hidden Cave<span>&#34;</span></span><span>&gt;</span></span>Paper pirate hat<span><span><span>&lt;/</span>clue</span><span>&gt;</span></span>
  <span><span><span>&lt;/</span>clues</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>culprit</span><span>&gt;</span></span>C.L. Magnus<span><span><span>&lt;/</span>culprit</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>motive</span><span>&gt;</span></span>Insurance fraud on own ships<span><span><span>&lt;/</span>motive</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>mystery</span><span>&gt;</span></span>
</code></pre><p><code>grex</code> produces:</p><pre aria-label="code"><code>/mystery/@episode = Go Away Ghost Ship
/mystery/@id = 014
/mystery/@location = Harbor
/mystery/suspect/text() = Ghost of Redbeard
/mystery/clues/clue[1]/@location = Ghost Ship
/mystery/clues/clue[1]/text() = Dry ice in storeroom
/mystery/clues/clue[2]/@location = Ghost Ship
/mystery/clues/clue[2]/text() = Wire-operated sword
/mystery/clues/clue[3]/@location = Hidden Cave
/mystery/clues/clue[3]/text() = Paper pirate hat
/mystery/culprit/text() = C.L. Magnus
/mystery/motive/text() = Insurance fraud on own ships
</code></pre><p>Each line starts with an XPath expression that describes a location in the XML tree, followed by an <code>=</code> sign and the value at that location. This format is easy to search and manipulate. Want to list all locations? Use <code>grep &#39;@location&#39; | sed &#39;s/.* = //&#39; | sort -u</code>. Want to see what changed between two files? Use <code>diff &lt;(grex before.xml) &lt;(grex after.xml)</code>.</p><p>The transformation is reversible.<sup id="fnref-1"><a href="#fn-1">1</a></sup> You can flatten XML with <code>grex</code>, modify it with standard UNIX tools, then use <code>grex --ungrex</code> to convert back to XML. For example, say you want to rearrange the <code>culprit</code> and <code>motive</code> elements into a new container element:</p><pre aria-label="code"><code>$ grex mystery.xml \
  | sed &#39;s:/culprit/:/culprit/name/:&#39; \
  | sed &#39;s:/motive/:/culprit/motive/:&#39; \
  | grex --ungrex
</code></pre><p>…and you’ll get out something that looks like this:</p><pre aria-label="xml code" data-lang="xml" data-label="xml"><code><span><span><span>&lt;</span>mystery</span> <span>episode</span><span><span>=</span><span>&#34;</span>Go Away Ghost Ship<span>&#34;</span></span> <span>id</span><span><span>=</span><span>&#34;</span>014<span>&#34;</span></span> <span>location</span><span><span>=</span><span>&#34;</span>Harbor<span>&#34;</span></span><span>&gt;</span></span>
  <span><span><span>&lt;</span>suspect</span><span>&gt;</span></span>Ghost of Redbeard<span><span><span>&lt;/</span>suspect</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>clues</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>clue</span> <span>location</span><span><span>=</span><span>&#34;</span>Ghost Ship<span>&#34;</span></span><span>&gt;</span></span>Dry ice in storeroom<span><span><span>&lt;/</span>clue</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>clue</span> <span>location</span><span><span>=</span><span>&#34;</span>Ghost Ship<span>&#34;</span></span><span>&gt;</span></span>Wire-operated sword<span><span><span>&lt;/</span>clue</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>clue</span> <span>location</span><span><span>=</span><span>&#34;</span>Hidden Cave<span>&#34;</span></span><span>&gt;</span></span>Paper pirate hat<span><span><span>&lt;/</span>clue</span><span>&gt;</span></span>
  <span><span><span>&lt;/</span>clues</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>culprit</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>name</span><span>&gt;</span></span>C.L. Magnus<span><span><span>&lt;/</span>name</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>motive</span><span>&gt;</span></span>Insurance fraud on own ships<span><span><span>&lt;/</span>motive</span><span>&gt;</span></span>
  <span><span><span>&lt;/</span>culprit</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>mystery</span><span>&gt;</span></span>
</code></pre><p>The grex format also lets you merge documents by concatenating them. To add a new clue to the case file, just append some lines and ungrex:</p><pre aria-label="code"><code>$ cat &lt;&lt;EOF &gt; new_clue.grex
/mystery/clues/clue[4]/@location = Magnus Apartment
/mystery/clues/clue[4]/text() = Bear-skin rug
EOF

$ grex mystery.xml | cat - new_clue.grex | grex --ungrex
</code></pre><p>I wrote grex for the same reason I wrote xpath-cli: I work with XML files a lot and wanted simpler ways to inspect and modify them from the comfort of my shell. I’ve used tools like <code>jq</code> and <code>gron</code> for a long time when working with JSON, and now with <code>xpath</code> and <code>grex</code> I can do a lot of the same workflows with XML.</p><p>The code is <a href="https://github.com/jake-low/grex" rel="external">available on GitHub</a>. If you want to try <code>grex</code>, you can build it from source:</p><pre aria-label="code"><code>git clone https://github.com/jake-low/grex
cd grex
cargo install --path .
</code></pre><p>If you encounter any <del>ghosts</del> bugs, please open an issue.</p></article> </div></div>
  </body>
</html>
