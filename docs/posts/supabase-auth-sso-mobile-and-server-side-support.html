<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://supabase.com/blog/supabase-auth-sso-pkce">Original</a>
    <h1>Supabase Auth: SSO, Mobile, and Server-Side Support</h1>
    
    <div id="readability-page-1" class="page"><article><div><p><span><img alt="Supabase Auth: SSO,  Mobile, and Server-side support" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></p><p>Today we&#39;re excited to announce a few new features for Supabase Auth:</p>
<ol>
<li><a href="https://supabase.com/blog/supabase-auth-sso-pkce#single-sign-on-support-using-saml-20">Easily add Single Sign-On support to your projects using SAML 2.0</a></li>
<li><a href="https://supabase.com/blog/supabase-auth-sso-pkce#server-side-and-mobile-auth">Better support for server-side rendering and mobile apps using PKCE</a></li>
<li><a href="https://supabase.com/blog/supabase-auth-sso-pkce#native-apple-login-on-ios">Native Apple login on iOS</a></li>
</ol>
<h2 id="single-sign-on-support-using-saml-20">Single Sign-On Support using SAML 2.0</h2>
<p>With Single Sign-On (SSO), your users can login with their company&#39;s identity provider (IDP), a critical feature when you&#39;re building applications for Enterprises.</p>
<p>Every developer building a B2B application eventually needs the SSO authentication flow to onboard enterprise customers. SSO is a requirement for larger Enterprise customers because it&#39;s a standard request in Enterprise Security Policies. Over the past few months, we&#39;ve been <a href="https://supabase.com/docs/guides/platform/sso">dogfooding SSO for our own Enterprise customers</a>, and today we&#39;re releasing it for you to do the same.</p>
<p>Building SSO into your application isn&#39;t necessarily hard, but does come with some complexity. A lot of time can be spent understanding the nuances and details of the protocol - from dissecting the jargon to testing the implementation heavily. It took us months to build it for ourselves. With this release, you will have SSO set up and running in less than an hour so that you can focus on shipping the core features of your product. This feature is available for the <a href="https://supabase.com/pricing">Pro-tier and above</a>, starting today.</p>
<p><iframe src="https://www.youtube-nocookie.com/embed/hAwJeR6mhB0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"></iframe></p>
<h3 id="getting-started-with-saml-20">Getting Started with SAML 2.0</h3>
<p>To get started, enable the <a href="https://app.supabase.com/project/phcnitosaawbzytgyznx/auth/providers">“SAML 2.0“</a> <a href="https://app.supabase.com/project/_/auth/providers">authentication method in the dashboard</a>. We&#39;ve added new commands to the <a href="https://supabase.com/docs/guides/cli">Supabase CLI</a> to help with the configuration process:</p>

<p>Once you&#39;ve added a new SSO identity provider to your project, it&#39;s as simple as calling the <code>signInWithSSO()</code> from the <code>supabase-js</code> library:</p>

<h3 id="sso-with-row-level-security-and-multi-tenancy">SSO with Row Level Security and multi-tenancy</h3>
<p>As usual, we&#39;ve engineered this feature around the excellent capabilities of PostgreSQL.</p>
<p>For example, you can use Row Level Security (RLS) to build multi-tenant applications, simply by using the provider&#39;s unique identifier in the user&#39;s JWT:</p>

<p>The journey to enterprise readiness isn&#39;t an end goal, it is a continuous process that demands constant attention and maintenance. With Supabase Auth, your team can offload this engineering burden to us and prioritize the features that matter.</p>
<h2 id="server-side-and-mobile-auth">Server-Side and Mobile Auth</h2>
<p>Many developers today are using Supabase to build mobile apps, and server-side rendering is becoming popular (again!). This release will add support for these use cases by introducing the <em>Proof Key for Code Exchange flow (PKCE)</em> authentication flow. This improves security for mobile apps and makes building server-first apps simple. Since this is a major update that touches many of the authentication routes, we will be rolling it out gradually over the next few weeks.</p>
<h3 id="a-brief-history-of-supabase-auth">A brief history of Supabase Auth</h3>
<p>When we <a href="https://news.ycombinator.com/item?id=24072051">launched</a> Supabase Auth, our target was JAMstack developers. In these cases, the protocol used between the user&#39;s application and Supabase Auth is known as the <a href="https://www.rfc-editor.org/rfc/rfc6749#section-4.2">Implicit Grant Flow</a>:</p>
<p><img alt="diagram reference" src="https://supabase.com/images/blog/launch-week-7/day-4-supabase-auth-sso-pkce/supabase-auth-implicit-grant-flow--light.svg"/>
<img alt="diagram reference" src="https://supabase.com/images/blog/launch-week-7/day-4-supabase-auth-sso-pkce/supabase-auth-implicit-grant-flow--dark.svg"/></p><p>As developers built more complex apps, they encountered two problems with this authentication flow:</p>
<ul>
<li><strong>Server-Side Email Verification Links</strong>
Data provided in a URL fragment is only accessible in a browser environment, not on the server. This is problematic for email verification links that redirect users to a server-side route.</li>
<li><strong>Challenges with Mobile App Authentication</strong>
The implicit grant flow raised security concerns for mobile use cases since <a href="https://www.rfc-editor.org/rfc/rfc7636#section-1">malicious apps could potentially obtain the user session</a>.</li>
</ul>
<p>Server-side auth unlocks a number of benefits. Developers can:</p>
<ul>
<li>Set cookies on the same domain as the application.</li>
<li>Enable server-side rendering for protected pages.</li>
<li>Perform downstream actions after user authentication, such as adding the user to a CRM or sending analytics.</li>
</ul>
<h3 id="introducing-pkce">Introducing PKCE</h3>
<p>To solve these problems, we&#39;re introducing support for the <em>Proof Key for Code Exchange</em> flow (PKCE, pronounced “pixy”).</p>
<p>The PKCE flow introduces a <em>code verifier</em> (a randomly generated secret) and a <em>code challenge</em> (the hash of the <em>code verifier</em>). The authorization code is returned as a query parameter so it&#39;s accessible on the server. During the PKCE flow:</p>
<ol>
<li>The <em>code challenge</em> is sent to Supabase Auth, which returns an <em>authorization code.</em></li>
<li>The client sends the <em>authorization code</em> together with the <em>code verifier</em> to obtain the user&#39;s session.</li>
<li>Supabase Auth checks if the <em>code verifier</em> matches the <em>code challenge</em> sent earlier by computing the hash. This renders a malicious attacker&#39;s attempt to intercept the authorization code useless, since they need to know the value of the <em>code verifier</em> as well.</li>
</ol>
<p><img alt="diagram reference" src="https://supabase.com/images/blog/launch-week-7/day-4-supabase-auth-sso-pkce/supabase-auth-pkce-flow--light.svg"/>
<img alt="diagram reference" src="https://supabase.com/images/blog/launch-week-7/day-4-supabase-auth-sso-pkce/supabase-auth-pkce-flow--dark.svg"/></p><h3 id="migrating-to-pkce-on-the-client">Migrating to PKCE on the client</h3>
<p>Over the next few weeks, you&#39;ll be able to use it with the Supabase libraries. We&#39;ve already added PKCE to the <a href="https://supabase.com/docs/reference/javascript/installing">JavaScript</a> client library and our <a href="https://supabase.com/docs/guides/auth/auth-helpers">auth-helpers</a> library. If you&#39;re using <code>supabase-js</code> , you can switch to PKCE by initializing your client with the following option:</p>

<p>For client-side auth, that&#39;s all you need to do to switch over. <code>supabase-js</code> will handle the generation and storage for the code verifier, as well as exchanging the authorization code for the user&#39;s session.</p>
<h3 id="migrating-to-pkce-on-the-server">Migrating to PKCE on the server</h3>
<p>Server-side authentication is now a lot easier. Let&#39;s look at an example using NextJS.</p>
<p>Install the <code>next</code> version of auth-helpers (lets use the <code>nextjs</code> version for this example)</p>

<p>Then prepare an endpoint for the sign in process. The redirect URL is set to <code>/api/auth/callback</code>, which will be implemented next.</p>

<p>Now we can set up the callback API endpoint:</p>

<h3 id="roll-out">Roll out</h3>
<p>Since this is a major update that touches many of the authentication routes, we will roll it out gradually over the next few weeks. You will receive a notification in your dashboard when the feature is available for your project. Reach out to us if you want early access to this feature.</p>
<h2 id="native-apple-login-on-ios">Native Apple login on iOS</h2>
<p>While PKCE support is great, that is not the only news for you mobile app developers out there.</p>
<p>Building apps for iOS requires support for native <em>Sign in with Apple</em>. We heard the community&#39;s requests for native sign-in. We hope you join our excitement to officially announce support for native <em>Sign in with Apple</em>.</p>
<p>Your app&#39;s iOS Bundle ID can now be configured in the Apple provider section of your project&#39;s dashboard.</p>
<p><span><span><img alt="native-apple-login-on-iOS.png" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></span></p>
<p>This is the only prerequisite for triggering a native <em>Sign in with Apple.</em> With <a href="https://pub.dev/packages/supabase_flutter#native-sign-in-with-apple-example">supabase-flutter</a>, this is as easy as:</p>

<p>It&#39;s that easy! No need to set up deep links, no need to pass any parameters.</p>
<p>We&#39;re just starting with Apple login, and soon add support for Google login.</p>
<h2 id="wrapping-up">Wrapping Up</h2>
<p>Supabase Auth aims to continue developing auth features that are secure by default yet simple to implement. We use Supabase Auth for our hosted platform and continuously dogfood the latest version on it. If you are interested to migrate to Supabase Auth, you can check out this blog post on how <a href="https://kevcodez.medium.com/migrating-125-000-users-from-auth0-to-supabase-81c0568de307">Parqet migrated 125,000 users from Auth0 to Supabase Auth</a>.</p></div></article></div>
  </body>
</html>
