<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://aimilios.bearblog.dev/reverse-engineering-sleep-mask/">Original</a>
    <h1>My smart sleep mask broadcasts users&#39; brainwaves to an open MQTT broker</h1>
    
    <div id="readability-page-1" class="page"><div>
    

    

    
        

        <p>
            <i>
                <time datetime="2026-02-12T14:34Z">
    12 Feb, 2026
</time>
            </i>
        </p>
    

    <p>I recently got a smart sleep mask from Kickstarter. I was not expecting to end up with the ability to read strangers&#39; brainwaves and send them electric impulses in their sleep. But here we are.</p>
<p>The mask was from a small Chinese research company, very cool hardware -- EEG brain monitoring, electrical muscle stimulation around the eyes, vibration, heating, audio. The app was still rough around the edges though and the mask kept disconnecting, so I asked Claude to try reverse-engineer the Bluetooth protocol and build me a simple web control panel instead.</p>
<h3 id="bluetooth">Bluetooth</h3><p>The first thing Claude did was scan for BLE (Bluetooth Low Energy) devices nearby. It found mine among 35 devices in range, connected, and mapped the interface -- two data channels. One for sending commands, one for streaming data.</p>
<p>Then it tried talking to it. Sent maybe a hundred different command patterns. Modbus frames, JSON, raw bytes, common headers. Unfortunately, the device said nothing back, the protocol was not a standard one.</p>
<h3 id="the-app">The app</h3><p>So Claude went after the app instead. Grabbed the Android APK, decompiled it with jadx. Turns out the app is built with Flutter, which is a bit of a problem for reverse engineering. Flutter compiles Dart source code into native ARM64 machine code -- you can&#39;t just read it back like normal Java Android apps. The actual business logic lives in a 9MB binary blob.</p>
<p>But even compiled binaries have strings in them. Error messages, URLs, debug logs. Claude ran <code>strings</code> on the binary and this was the most productive step of the whole session. Among the thousands of lines of Flutter framework noise, it found:</p>
<ul>
<li>Hardcoded credentials for the company&#39;s message broker (shared by every copy of the app)</li>
<li>Cloud API endpoints</li>
<li>All fifteen command builder function names (e.g. to set vibration, heating, electric stimulation, etc.)</li>
<li>Protocol debug messages that revealed the packet structure -- header, direction byte, command type, payload, footer</li>
</ul>
<p>We had the shape of the protocol. Still didn&#39;t have the actual byte values though.</p>
<p>Claude then used <a href="https://github.com/worawit/blutter">blutter</a>, a tool specifically for decompiling Flutter&#39;s compiled Dart snapshots. It reconstructs the functions with readable annotations. Claude figured out the encoding, and just read off every command byte from every function. Fifteen commands, fully mapped.</p>
<h3 id="it-works">It works</h3><p>Claude sent a six-byte query packet. The device came back with 153 bytes -- model number, firmware version, serial number, all eight sensor channel configurations (EEG at 250Hz, respiration, 3-axis accelerometer, 3-axis gyroscope). Battery at 83%.</p>
<p>Vibration control worked. Heating worked. EMS worked. Music worked. Claude built me a little web dashboard with sliders for everything. I was pretty happy with it.</p>
<p>That could have been the end of the story.</p>
<h3 id="the-server">The server</h3><p>Remember the hardcoded credentials from earlier? While poking around, Claude tried using them to connect to the company&#39;s MQTT broker -- MQTT is a pub/sub messaging system standard in IoT, where devices publish sensor readings and subscribe to commands. It connected fine. Then it started receiving data. Not just from my device -- from <em>all of them</em>. About 25 were active:</p>
<ul>
<li>Sleep masks publishing live EEG brainwave data</li>
<li>Air quality monitors reporting temperature, humidity, CO2</li>
<li>Presence sensors detecting room occupancy</li>
</ul>
<p>Claude captured a couple minutes of EEG from two active sleep masks. One user seemed to be in REM sleep (mixed-frequency activity). The other was in deep slow-wave sleep (strong delta power below 4Hz). Real brainwaves from real people, somewhere in the world.</p>
<p><img src="https://hatzistamou.com/img_assets/eeg_live.png" alt="Live EEG"/></p>
<h3 id="ems">EMS</h3><p>The mask also does EMS -- electrical muscle stimulation around the eyes. Controlling it is just another command: mode, frequency, intensity, duration.</p>
<p>Since every device shares the same credentials and the same broker, if you can read someone&#39;s brainwaves you can also send them electric impulses.</p>
<h3 id="disclosure">Disclosure</h3><p>For obvious reasons, I am not naming the product/company here, but have reached out to inform them about the issue.</p>
<p>This whole thing made  me revisit Karpathy&#39;s <a href="https://karpathy.bearblog.dev/digital-hygiene/">Digital Hygiene</a> post, and you probably should too.</p>
<hr/>
<p><em>The reverse engineering -- Bluetooth, APK decompilation, Dart binary analysis, MQTT discovery -- was more or less one-shotted by Claude (Opus 4.6) over a 30&#39; autonomous session.</em></p>


    

    
        

        
            


        

        
            
        
    


  </div></div>
  </body>
</html>
