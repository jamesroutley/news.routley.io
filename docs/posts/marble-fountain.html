<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://willmorrison.net/posts/marble-fountain/">Original</a>
    <h1>Marble Fountain</h1>
    
    <div id="readability-page-1" class="page"><div><p>I really enjoy procedural generation, especially systems designed to work with hardware outputs. After starting work at Formlabs in September of 2023 and gaining access to much nicer printers than I was used to, I started wanting to tackle some large algorithmic structure projects. Complexity is free in 3d printing, the limit of design geometry is mostly how much time you’re willing to spend in CAD. I wanted to print the most complicated art piece I could think of. Marble Fountain is what I came up with.</p><p><iframe src="https://www.youtube.com/embed/ULpNiZU2tpg" allowfullscreen="" title="YouTube Video"></iframe></p><h2 id="tracks">Tracks</h2><p>My initial system came together quickly. Randomly placing spaced out points, drawing a spline through them, and setting a constant slope just works. My first draft was just subtracting a tube from the solid support structure which worked but was super limited. I wanted to add more parts and so I started working on a path solver. I wanted to fit as much motion into the volume of the printer as possible. This turned out to be extremely challenging.</p><p>The solver starts by making a random series of line segments connecting the top and bottom of the lift. There are several different algorithms to generate this guess, as the initial conditional has a noticeable impact on the shape of the structure for lower path counts. It’s interesting to play with different variants of the starting conditions and see how they change during generation.</p><p>A series of functions update the positions over time to “pull” the points into a followable path.
The points making up each path:</p><ul><li>Stay in the bounding box</li><li>Evenly space themselves out</li><li>Pull towards a fixed height to enforce a constant slope</li><li>Enforce min and max turning radius of the path</li><li>Repel away from other tracks</li><li>Repel away from distant sections of our own track</li><li>Smooth out changes in slope to prevent jumps</li><li>Prevent slope from ever increasing</li></ul><p>Velocity is a much harder problem than I anticipated. The tracks break a lot of the obvious assumptions if you act like the marble is a point mass, as changing the bank of the track moves the axis of rotation and can burn off rotational inertia to friction. Long straight sections would build up too much speed and bearings fly off on the turns, but balls taking sharp turns at slow speed will lose too much momentum and stop. I settled on setting a minimum turn radius for the track and banking much more aggressively than is technically necessary for any given speed, so it constantly snakes back and forth to burn off speed.</p><p>One of the most elegant designs of the whole structure is how the lift acts like a ball screw. The the screw is constrained by the balls on all sides which allows it to run with no bearing at the top. This also leads to a failure mode where if the screw ever only has balls on one side it will immediately start wobbling badly enough that all the balls currently rolling will fall off the tracks.</p><h2 id="supports">Supports</h2><p>The support generation was surprisingly simple. Iterating from the top down and treating the support pillars as a particle system is quite robust. I spent more time tweaking the geometry for aesthetics than I did for actual structure and collision issues, although I did heavily lean on the overhang tolerance of the printer.</p><p>Each support:</p><ul><li>Pulls towards other supports, weighted by distance and similarity in size</li><li>Repels away from other supports</li><li>Pulls to stay in the bounding box</li><li>Pulls towards a fixed radius from the center of the structure</li></ul><p>Supports also have inertia, which is where the arcs in the structure of the support columns come from.</p><h2 id="looking-forward">Looking forward</h2><p>The final models take around 5-20 minutes to export. There’s a ton I could do to optimize the models, but at this point the geometry is simply beyond the scope of OpenSCAD. If I was rewriting this I would probably use a different tool more optimized for this type of organic geometry, likely an SDF library. I have vague ambitions to do a big rewrite eventually but figured sharing <a href="https://github.com/Will-Morr/MarbleFountain" target="_blank">janky code</a>
is better than none. I started this just planning for the janky splines as a weekend project but it has gotten thoroughly out of hand.</p><p>I have a ton of other ideas to play with if I do that big rewrite. There is no realistic velocity estimation at any point in the whole system right now, just a pile of heuristics. I was originally trying to not overcomplicate but building a proper acceleration model by measuring velocity with a camera would have almost definitely saved time overall. Trying to maintain a fixed slope makes collision prevention much harder but is required to keep speed within bounds. At this point I’m also just curious about the response curve, there’s a knee somewhere where the surfaces start to slip that I want to track down.</p><h2 id="looking-back">Looking back</h2><p>This was the most work I have ever put into a hobby project. I started in February 2024 and worked on it on and off until September. I applied to show it in a gallery (shoutout to <a href="https://www.newalliancegallery.com/" target="_blank">New Alliance Gallery</a>
in Somerville) with two months of warning, which wound up leading to a large crunch trying to make the system reliable enough to show in person in the weeks before the show. I was able to get it working consistently, although it did lose 2-3 balls an hour and could only run for a few hours without the motor overheating. I got pretty burned out and dropped the project, which is why I shelved it for a full year before sharing anything.</p><p>Finally, a huge thanks to my friend Alex who listened to me ramble about marbles for several months every day while walking home from work, gave a ton of helpful input, and lived with the dozens of ball bearings scattered across our apartment.</p><figure><img src="https://thornberry.io/img/MarbleFountain/gallery.jpg" alt="Marble Fountain installed in New Alliance Gallery"/></figure><p><a href="https://github.com/Will-Morr/MarbleFountain" target="_blank">GitHub Repo</a></p></div></div>
  </body>
</html>
