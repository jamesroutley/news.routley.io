<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/">Original</a>
    <h1>Formalizing the proof of PFR in Lean4 using Blueprint: a short tour</h1>
    
    <div id="readability-page-1" class="page"><div>
		
<p>Since the release of <a href="https://terrytao.wordpress.com/2023/11/13/on-a-conjecture-of-marton/">my preprint with Tim, Ben, and Freddie</a> proving the Polynomial Freiman-Ruzsa  (PFR) conjecture over <img src="https://s0.wp.com/latex.php?latex=%7B%5Cmathbb+F%7D_2&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%7B%5Cmathbb+F%7D_2&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%7B%5Cmathbb+F%7D_2&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="{\mathbb F}_2"/>, I (together with <a href="https://github.com/YaelDillies">Yael Dillies</a> and <a href="https://github.com/b-mehta">Bhavik Mehta</a>) have started a <a href="https://teorth.github.io/pfr/">collaborative project</a> to formalize this argument in the proof assistant language <a href="https://en.wikipedia.org/wiki/Lean_(proof_assistant)">Lean4</a>.   It has been less than a week since the project was launched, but it is proceeding quite well, with a significant fraction of the paper already either fully or partially formalized.  The project has been greatly assisted by the <a href="https://github.com/PatrickMassot/leanblueprint">Blueprint tool</a> of <a href="https://www.imo.universite-paris-saclay.fr/~patrick.massot/en/">Patrick Massot</a>, which allows one to write a human-readable “blueprint” of the proof that is linked to the Lean formalization; similar blueprints have been <a href="https://leanprover-community.github.io/liquid/">used for other projects</a>, such as Scholze’s <a href="https://github.com/leanprover-community/lean-liquid">liquid tensor experiment</a>.  For the PFR project, the blueprint can be found <a href="https://teorth.github.io/pfr/blueprint/">here</a>.  One feature of the blueprint that I find particularly appealing is the dependency graph that is automatically generated from the blueprint, and can provide a rough snapshot of how far along the formalization has advanced.  For PFR, the latest state of the dependency graph can be found <a href="https://teorth.github.io/pfr/blueprint/dep_graph_document.html">here</a>.  At the current time of writing, the graph looks like this:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image.png"><img data-attachment-id="14060" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image.png" data-orig-size="2692,965" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image.png?w=490" width="1024" height="367" src="https://terrytao.files.wordpress.com/2023/11/image.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/11/image.png?w=2048 2048w, https://terrytao.files.wordpress.com/2023/11/image.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image.png?w=768 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>The color coding of the various bubbles (for lemmas) and rectangles (for definitions) is explained in the legend to <a href="https://teorth.github.io/pfr/blueprint/dep_graph_document.html">the dependency graph</a>, but roughly speaking the green bubbles/rectangles represent lemmas or definitions that have been fully formalized, and the blue ones represent lemmas or definitions which are ready to be formalized (their statements, but not proofs, have already been formalized, as well as those of all prerequisite lemmas and proofs).  The goal is to get all the bubbles leading up to the “<a href="https://teorth.github.io/pfr/blueprint/sect0007.html#pfr">pfr</a>” bubble at the bottom colored in green.</p>



<p>In this post I would like to give a quick “tour” of the project, to give a sense of how it operates.  If one clicks on the “<a href="https://teorth.github.io/pfr/blueprint/sect0007.html#pfr">pfr</a>” bubble at the bottom of the dependency graph, we get the following:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-1.png"><img data-attachment-id="14064" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-1/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-1.png" data-orig-size="2390,620" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-1" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-1.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-1.png?w=490" width="1024" height="265" src="https://terrytao.files.wordpress.com/2023/11/image-1.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-1.png?w=1022 1022w, https://terrytao.files.wordpress.com/2023/11/image-1.png?w=2043 2043w, https://terrytao.files.wordpress.com/2023/11/image-1.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-1.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-1.png?w=768 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>Here, Blueprint is displaying a human-readable form of the PFR statement.  This is coming from the <a href="https://teorth.github.io/pfr/blueprint/sect0007.html#pfr">corresponding portion of the blueprint</a>, which also comes with a human-readable proof of this statement that relies on other statements in the project:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-2.png"><img data-attachment-id="14066" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-2.png" data-orig-size="1744,765" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-2" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-2.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-2.png?w=490" width="1024" height="449" src="https://terrytao.files.wordpress.com/2023/11/image-2.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-2.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/11/image-2.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-2.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-2.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-2.png 1744w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>(I have cropped out the second half of the proof here, as it is not relevant to the discussion.)</p>



<p>Observe that the “<a href="https://teorth.github.io/pfr/blueprint/sect0007.html#pfr">pfr</a>” bubble is white, but has a green border.  This means that the statement of PFR has been formalized in Lean, but not the proof; and the proof itself is not ready to be formalized, because some of the prerequisites (in particular, “<a href="https://teorth.github.io/pfr/blueprint/sect0006.html#entropy-pfr">entropy-pfr</a>” (Theorem 6.16)) do not even have their statements formalized yet.  If we click on the “Lean” link below the description of PFR in the dependency graph, we are lead to the (auto-generated) <a href="https://teorth.github.io/pfr/docs/PFR/main.html#PFR_conjecture">Lean documentation for this assertion</a>:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-3.png"><img data-attachment-id="14068" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-3/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-3.png" data-orig-size="1533,421" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-3" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-3.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-3.png?w=490" loading="lazy" width="1024" height="281" src="https://terrytao.files.wordpress.com/2023/11/image-3.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-3.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/11/image-3.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-3.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-3.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-3.png 1533w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>This is what a typical theorem in Lean looks like (after a procedure known as “pretty printing”).  There are a number of hypotheses stated before the colon, for instance that <img src="https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="G"/> is a finite elementary abelian group of order <img src="https://s0.wp.com/latex.php?latex=2&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=2&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=2&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="2"/> (this is how we have chosen to formalize the finite field vector spaces <img src="https://s0.wp.com/latex.php?latex=%7B%5Cbf+F%7D_2%5En&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%7B%5Cbf+F%7D_2%5En&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%7B%5Cbf+F%7D_2%5En&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="{\bf F}_2^n"/>), that <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="A"/> is a non-empty subset of <img src="https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="G"/> (the hypothesis that <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="A"/> is non-empty was not stated in the LaTeX version of the conjecture, but we realized it was necessary in the formalization, and will update the LaTeX blueprint shortly to reflect this) with the cardinality of <img src="https://s0.wp.com/latex.php?latex=A%2BA&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=A%2BA&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=A%2BA&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="A+A"/> less than <img src="https://s0.wp.com/latex.php?latex=K&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=K&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=K&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="K"/> times the cardinality of <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="A"/>, and the statement after the colon is the conclusion: that <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="A"/> can be contained in the sum <img src="https://s0.wp.com/latex.php?latex=c%2BH&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=c%2BH&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=c%2BH&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="c+H"/> of a subgroup <img src="https://s0.wp.com/latex.php?latex=H&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=H&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=H&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="H"/> of <img src="https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="G"/> and a set <img src="https://s0.wp.com/latex.php?latex=c&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=c&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=c&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="c"/> of cardinality at most <img src="https://s0.wp.com/latex.php?latex=2K%5E%7B12%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=2K%5E%7B12%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=2K%5E%7B12%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="2K^{12}"/>.  </p>



<p>The astute reader may notice that the above theorem seems to be missing one or two details, for instance it does not explicitly assert that <img src="https://s0.wp.com/latex.php?latex=H&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=H&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=H&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="H"/> is a subgroup.  This is because the “pretty printing” suppresses some of the information in the actual statement of the theorem, which can be seen by clicking on the “<a href="https://github.com/teorth/pfr/blob/6b2c357dc922ff00dec5dd6873b841925b0e22ef//PFR/main.lean#L17-L21">Source</a>” link:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-4.png"><img data-attachment-id="14072" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-4/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-4.png" data-orig-size="1737,296" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-4" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-4.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-4.png?w=490" loading="lazy" width="1024" height="174" src="https://terrytao.files.wordpress.com/2023/11/image-4.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-4.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/11/image-4.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-4.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-4.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-4.png 1737w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>Here we see that <img src="https://s0.wp.com/latex.php?latex=H&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=H&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=H&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="H"/> is required to have the “type” of an additive subgroup of <img src="https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="G"/>.  (Lean’s language revolves very strongly around <a href="https://en.wikipedia.org/wiki/Type_theory">types</a>, but for this tour we will not go into detail into what a type is exactly.)  The prominent “sorry” at the bottom of this theorem asserts that a proof is not yet provided for this theorem, but the intention of course is to replace this “sorry” with an actual proof eventually.</p>



<p>Filling in this “sorry” is too hard to do right now, so let’s look for a simpler task to accomplish instead.  Here is a simple intermediate lemma “<a href="https://teorth.github.io/pfr/blueprint/sect0003.html#ruzsa-nonneg">ruzsa-nonneg</a>” that shows up in the proof:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-5.png"><img data-attachment-id="14075" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-5/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-5.png" data-orig-size="1647,597" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-5" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-5.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-5.png?w=490" loading="lazy" width="1024" height="371" src="https://terrytao.files.wordpress.com/2023/11/image-5.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-5.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/11/image-5.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-5.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-5.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-5.png 1647w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>The expression <img src="https://s0.wp.com/latex.php?latex=d%5BX%3B+Y%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=d%5BX%3B+Y%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=d%5BX%3B+Y%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="d[X; Y]"/> refers to something called the entropic Ruzsa distance between <img src="https://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="X"/> and <img src="https://s0.wp.com/latex.php?latex=Y&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=Y&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=Y&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="Y"/>, which is something that is defined <a href="https://teorth.github.io/pfr/blueprint/sect0003.html#ruz-dist-def">elsewhere in the project</a>, but for the current discussion it is not important to know its precise definition, other than that it is a real number.  The bubble is blue with a green border, which means that the statement has been formalized, and the proof is ready to be formalized also.  The blueprint dependency graph indicates that this lemma can be deduced from just one preceding lemma, called “<a href="https://teorth.github.io/pfr/blueprint/sect0003.html#ruzsa-diff">ruzsa-diff</a>“:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-6.png"><img data-attachment-id="14078" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-6/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-6.png" data-orig-size="1716,559" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-6" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-6.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-6.png?w=490" loading="lazy" width="1024" height="333" src="https://terrytao.files.wordpress.com/2023/11/image-6.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-6.png?w=1022 1022w, https://terrytao.files.wordpress.com/2023/11/image-6.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-6.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-6.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-6.png 1716w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>“<a href="https://teorth.github.io/pfr/blueprint/sect0003.html#ruzsa-diff">ruzsa-diff</a>” is also blue and bordered in green, so it has the same current status as “<a href="https://teorth.github.io/pfr/blueprint/sect0003.html#ruzsa-nonneg">ruzsa-nonneg</a>“: the statement is formalized, and the proof is ready to be formalized also, but the proof has not been written in Lean yet.  The quantity <img src="https://s0.wp.com/latex.php?latex=H%5BX%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=H%5BX%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=H%5BX%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="H[X]"/>, by the way, refers to the <a href="https://en.wikipedia.org/wiki/Entropy_(information_theory)">Shannon entropy</a> of <img src="https://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="X"/>, defined <a href="https://teorth.github.io/pfr/blueprint/sect0002.html#entropy-def">elsewhere in the project</a>, but for this discussion we do not need to know its definition, other than to know that it is a real number.</p>



<p>Looking at Lemma 3.11 and Lemma 3.13 it is clear how the former will imply the latter: the quantity <img src="https://s0.wp.com/latex.php?latex=%7CH%5BX%5D+-+H%5BY%5D%7C&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%7CH%5BX%5D+-+H%5BY%5D%7C&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%7CH%5BX%5D+-+H%5BY%5D%7C&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="|H[X] - H[Y]|"/> is clearly non-negative!  (There is a factor of <img src="https://s0.wp.com/latex.php?latex=2&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=2&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=2&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="2"/> present in Lemma 3.11, but it can be easily canceled out.) So it should be an easy task to fill in the proof of Lemma 3.13 assuming Lemma 3.11, even if we still don’t know how to prove Lemma 3.11 yet.  Let’s first look at the Lean code for each lemma.  Lemma 3.11 is formalized <a href="https://github.com/teorth/pfr/blob/6b2c357dc922ff00dec5dd6873b841925b0e22ef//PFR/ruzsa_distance.lean#L118-L118">as follows</a>:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-7.png"><img data-attachment-id="14082" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-7/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-7.png" data-orig-size="1185,93" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-7" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-7.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-7.png?w=490" loading="lazy" width="1024" height="80" src="https://terrytao.files.wordpress.com/2023/11/image-7.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-7.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/11/image-7.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-7.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-7.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-7.png 1185w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>Again we have a “sorry” to indicate that this lemma does not currently have a proof.  The Lean notation (as well as the name of the lemma) differs a little from the LaTeX version for technical reasons that we will not go into here.  (Also, the variables <img src="https://s0.wp.com/latex.php?latex=X%2C+%5Cmu%2C+Y%2C+%5Cmu%27&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=X%2C+%5Cmu%2C+Y%2C+%5Cmu%27&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=X%2C+%5Cmu%2C+Y%2C+%5Cmu%27&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="X, \mu, Y, \mu&#39;"/> are introduced at an earlier stage in the Lean file; again, we will ignore this point for the ensuing discussion.)  Meanwhile, Lemma 3.13 is <a href="https://github.com/teorth/pfr/blob/6b2c357dc922ff00dec5dd6873b841925b0e22ef//PFR/ruzsa_distance.lean#L127-L128">currently formalized as</a></p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-8.png"><img data-attachment-id="14085" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-8/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-8.png" data-orig-size="822,108" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-8" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-8.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-8.png?w=490" loading="lazy" width="822" height="108" src="https://terrytao.files.wordpress.com/2023/11/image-8.png?w=822" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-8.png 822w, https://terrytao.files.wordpress.com/2023/11/image-8.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-8.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-8.png?w=768 768w" sizes="(max-width: 822px) 100vw, 822px"/></a></figure>



<p>OK, I’m now going to try to fill in the latter “sorry”.  In my local copy of the <a href="https://github.com/teorth/pfr">PFR github repository</a>, I open up the <a href="https://github.com/teorth/pfr/blob/master/PFR/ruzsa_distance.lean">relevant Lean file</a> in my editor (<a href="https://code.visualstudio.com/">Visual Studio Code</a>, with the <a href="https://github.com/leanprover/vscode-lean4">lean4 extension</a>) and navigate to the “sorry” of “rdist_nonneg”.  The accompanying “Lean infoview” then shows the current state of the Lean proof:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-9.png"><img data-attachment-id="14087" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-9/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-9.png" data-orig-size="614,1040" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-9" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-9.png?w=177" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-9.png?w=490" loading="lazy" width="605" height="1024" src="https://terrytao.files.wordpress.com/2023/11/image-9.png?w=605" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-9.png?w=605 605w, https://terrytao.files.wordpress.com/2023/11/image-9.png?w=89 89w, https://terrytao.files.wordpress.com/2023/11/image-9.png?w=177 177w, https://terrytao.files.wordpress.com/2023/11/image-9.png 614w" sizes="(max-width: 605px) 100vw, 605px"/></a></figure>



<p>Here we see a number of ambient hypotheses (e.g., that <img src="https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="G"/> is an additive commutative group, that <img src="https://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="X"/> is a map from <img src="https://s0.wp.com/latex.php?latex=%5COmega&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5COmega&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5COmega&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\Omega"/> to <img src="https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=G&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="G"/>, and so forth; many of these hypotheses are not actually relevant for this particular lemma), and at the bottom we see the goal we wish to prove.</p>



<p>OK, so now I’ll try to prove the claim.  This is accomplished by applying a series of “tactics” to transform the goal and/or hypotheses.  The first step I’ll do is to put in the factor of <img src="https://s0.wp.com/latex.php?latex=2&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=2&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=2&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="2"/> that is needed to apply Lemma 3.11.  This I will do with the “suffices” tactic, writing in the proof</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-10.png"><img data-attachment-id="14090" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-10/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-10.png" data-orig-size="812,204" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-10" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-10.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-10.png?w=490" loading="lazy" width="812" height="204" src="https://terrytao.files.wordpress.com/2023/11/image-10.png?w=812" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-10.png 812w, https://terrytao.files.wordpress.com/2023/11/image-10.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-10.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-10.png?w=768 768w" sizes="(max-width: 812px) 100vw, 812px"/></a></figure>



<p> I now have two goals (and two “sorries”): one to show that <img src="https://s0.wp.com/latex.php?latex=0+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=0+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=0+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="0 \leq 2 d[X;Y]"/> implies <img src="https://s0.wp.com/latex.php?latex=0+%5Cleq+d%5BX%2CY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=0+%5Cleq+d%5BX%2CY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=0+%5Cleq+d%5BX%2CY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="0 \leq d[X,Y]"/>, and the other to show that <img src="https://s0.wp.com/latex.php?latex=0+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=0+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=0+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="0 \leq 2 d[X;Y]"/>.    (The yellow squiggly underline indicates that this lemma has not been fully proven yet due to the presence of “sorry”s. The dot “.” is a syntactic marker that is useful to separate the two goals from each other, but you can ignore it for this tour.)  The Lean tactic “suffices” corresponds, roughly speaking, to the phrase “It suffices to show that …” (or more precisely,  “It suffices to show that … .  To see this, … .  It remains to verify the claim …”) in Mathematical English.  For my own education, I wrote a “Lean phrasebook” of further correspondences between lines of Lean code and sentences or phrases in Mathematical English, which can be found <a href="https://docs.google.com/spreadsheets/d/1Gsn5al4hlpNc_xKoXdU6XGmMyLiX4q-LFesFVsMlANo/edit#gid=0">here</a>. </p>



<p>Let’s fill in the first “sorry”.  The tactic state now looks like this (cropping out some irrelevant hypotheses):</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-11.png"><img data-attachment-id="14093" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-11/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-11.png" data-orig-size="532,206" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-11" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-11.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-11.png?w=490" loading="lazy" width="532" height="206" src="https://terrytao.files.wordpress.com/2023/11/image-11.png?w=532" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-11.png 532w, https://terrytao.files.wordpress.com/2023/11/image-11.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-11.png?w=300 300w" sizes="(max-width: 532px) 100vw, 532px"/></a></figure>



<p>Here I can use a handy tactic “<a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#linarith">linarith</a>“, which solves any goal that can be derived by linear arithmetic from existing hypotheses:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-12.png"><img data-attachment-id="14095" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-12/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-12.png" data-orig-size="829,218" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-12" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-12.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-12.png?w=490" loading="lazy" width="829" height="218" src="https://terrytao.files.wordpress.com/2023/11/image-12.png?w=829" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-12.png 829w, https://terrytao.files.wordpress.com/2023/11/image-12.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-12.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-12.png?w=768 768w" sizes="(max-width: 829px) 100vw, 829px"/></a></figure>



<p> This works, and now the tactic state reports no goals left to prove on this branch, so we move on to the remaining sorry, in which the goal is now to prove <img src="https://s0.wp.com/latex.php?latex=0+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=0+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=0+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="0 \leq 2 d[X;Y]"/>:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-13.png"><img data-attachment-id="14097" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-13/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-13.png" data-orig-size="507,177" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-13" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-13.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-13.png?w=490" loading="lazy" width="507" height="177" src="https://terrytao.files.wordpress.com/2023/11/image-13.png?w=507" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-13.png 507w, https://terrytao.files.wordpress.com/2023/11/image-13.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-13.png?w=300 300w" sizes="(max-width: 507px) 100vw, 507px"/></a></figure>



<p>Here we will try to invoke Lemma 3.11.  I add the following lines of code:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-14.png"><img data-attachment-id="14099" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-14/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-14.png" data-orig-size="1042,307" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-14" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-14.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-14.png?w=490" loading="lazy" width="1024" height="301" src="https://terrytao.files.wordpress.com/2023/11/image-14.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-14.png?w=1022 1022w, https://terrytao.files.wordpress.com/2023/11/image-14.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-14.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-14.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-14.png 1042w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>The Lean tactic “<a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#have">have</a>” roughly corresponds to the Mathematical English phrase “We have the statement…” or “We claim the statement…”; like “suffices”, it splits a goal into two subgoals, though in the reversed order to “suffices”.</p>



<p>I again have two subgoals, one to prove the bound <img src="https://s0.wp.com/latex.php?latex=%7CH%5BX%5D-H%5BY%5D%7C+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%7CH%5BX%5D-H%5BY%5D%7C+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%7CH%5BX%5D-H%5BY%5D%7C+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="|H[X]-H[Y]| \leq 2 d[X;Y]"/> (which I will call “h”), and then to deduce the previous goal <img src="https://s0.wp.com/latex.php?latex=0+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=0+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=0+%5Cleq+2+d%5BX%3BY%5D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="0 \leq 2 d[X;Y]"/> from <img src="https://s0.wp.com/latex.php?latex=h&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=h&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=h&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="h"/>.  For the first, I know I should invoke the lemma “diff_ent_le_rdist” that is encoding Lemma 3.11.  One way to do this is to try the tactic “exact?”, which will automatically search to see if the goal can already be deduced immediately from an existing lemma.  It reports:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-15.png"><img data-attachment-id="14101" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-15/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-15.png" data-orig-size="553,127" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-15" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-15.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-15.png?w=490" loading="lazy" width="553" height="127" src="https://terrytao.files.wordpress.com/2023/11/image-15.png?w=553" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-15.png 553w, https://terrytao.files.wordpress.com/2023/11/image-15.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-15.png?w=300 300w" sizes="(max-width: 553px) 100vw, 553px"/></a></figure>



<p>So I try this (by clicking on the suggested code, which automatically pastes it into the right location), and it works, leaving me with the final “sorry”:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-16.png"><img data-attachment-id="14103" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-16/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-16.png" data-orig-size="1020,279" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-16" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-16.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-16.png?w=490" loading="lazy" width="1020" height="279" src="https://terrytao.files.wordpress.com/2023/11/image-16.png?w=1020" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-16.png 1020w, https://terrytao.files.wordpress.com/2023/11/image-16.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-16.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-16.png?w=768 768w" sizes="(max-width: 1020px) 100vw, 1020px"/></a></figure>



<p>The lean tactic “<a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#exact">exact</a>” corresponds, roughly speaking, to the Mathematical English phrase “But this is exactly …”.</p>



<p>At this point I should mention that I also have the <a href="https://github.com/features/copilot">Github Copilot</a> extension to Visual Studio Code installed.  This is an AI which acts as an advanced autocomplete that can suggest possible lines of code as one types.  In this case, it offered a suggestion which was almost correct (the second line is what we need, whereas the first is not necessary, and in fact does not even compile in Lean):</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-25.png"><img data-attachment-id="14135" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-25/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-25.png" data-orig-size="1193,322" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-25" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-25.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-25.png?w=490" loading="lazy" width="1024" height="276" src="https://terrytao.files.wordpress.com/2023/11/image-25.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-25.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/11/image-25.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-25.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-25.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-25.png 1193w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>In any event, “exact?” worked in this case, so I can ignore the suggestion of Copilot this time (it has been very useful in other cases though).  I apply the “exact?” tactic a second time and follow its suggestion to establish the matching bound <img src="https://s0.wp.com/latex.php?latex=0+%5Cleq+%7CH%5BX%5D+-+H%5BY%5D%7C&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=0+%5Cleq+%7CH%5BX%5D+-+H%5BY%5D%7C&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=0+%5Cleq+%7CH%5BX%5D+-+H%5BY%5D%7C&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="0 \leq |H[X] - H[Y]|"/>:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-17.png"><img data-attachment-id="14105" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-17/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-17.png" data-orig-size="1013,354" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-17" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-17.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-17.png?w=490" loading="lazy" width="1013" height="354" src="https://terrytao.files.wordpress.com/2023/11/image-17.png?w=1013" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-17.png 1013w, https://terrytao.files.wordpress.com/2023/11/image-17.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-17.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-17.png?w=768 768w" sizes="(max-width: 1013px) 100vw, 1013px"/></a></figure>



<p>(One can find documention for the “abs_nonneg” method <a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Order/Group/Abs.html#abs_nonneg">here</a>.  Copilot, by the way, was also able to resolve this step, albeit with a slightly different syntax; there are also several other search engines available to locate this method as well, such as <a href="https://moogle-morphlabs.vercel.app/search/raw?q=absolute%20value%20is%20nonnegative">Moogle</a>.  One of the main purposes of the <a href="https://leanprover-community.github.io/contribute/naming.html">Lean naming conventions for lemmas</a>, by the way, is to facilitate the location of methods such as “abs_nonneg”, which is easier figure out how to search for than a method named (say) “Lemma 1.2.1”.) To fill in the final “sorry”, I try “exact?” one last time, to figure out how to combine <img src="https://s0.wp.com/latex.php?latex=h&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=h&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=h&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="h"/> and <img src="https://s0.wp.com/latex.php?latex=h%27&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=h%27&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=h%27&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="h&#39;"/> to give the desired goal, and it works!</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-18.png"><img data-attachment-id="14107" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-18/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-18.png" data-orig-size="1027,364" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-18" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-18.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-18.png?w=490" loading="lazy" width="1024" height="362" src="https://terrytao.files.wordpress.com/2023/11/image-18.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-18.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/11/image-18.png?w=1021 1021w, https://terrytao.files.wordpress.com/2023/11/image-18.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-18.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-18.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-18.png 1027w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>Note that all the squiggly underlines have disappeared, indicating that Lean has accepted this as a valid proof. The documentation for “ge_trans” may be found <a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Init/Order/Defs.html#ge_trans">here</a>.  The reader may observe that this method uses the <img src="https://s0.wp.com/latex.php?latex=%5Cgeq&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cgeq&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cgeq&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\geq"/> relation rather than the <img src="https://s0.wp.com/latex.php?latex=%5Cleq&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cleq&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cleq&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\leq"/> relation, but in Lean the assertions <img src="https://s0.wp.com/latex.php?latex=X+%5Cgeq+Y&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=X+%5Cgeq+Y&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=X+%5Cgeq+Y&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="X \geq Y"/> and <img src="https://s0.wp.com/latex.php?latex=Y+%5Cleq+X&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=Y+%5Cleq+X&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=Y+%5Cleq+X&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="Y \leq X"/> are “<a href="https://www.ma.imperial.ac.uk/~buzzard/xena/formalising-mathematics-2022/Part_B/equality.html#:~:text=Definitional%20equality,-Definitional%20equality%20is&amp;text=In%20Lean%2C%20%C2%ACP%20is,equal%2C%20they%20are%20definitionally%20equal.">definitionally equal</a>“, allowing tactics such as “exact” to use them interchangeably. “exact <a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Init/Order/Defs.html#le_trans">le_trans</a> h’ h” would also have worked in this instance. </p>



<p>It is possible to compactify this proof quite a bit by cutting out several intermediate steps (a procedure sometimes known as “<a href="https://en.wikipedia.org/wiki/Code_golf">code golf</a>“):</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-19.png"><img data-attachment-id="14109" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-19/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-19.png" data-orig-size="1190,152" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-19" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-19.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-19.png?w=490" loading="lazy" width="1024" height="130" src="https://terrytao.files.wordpress.com/2023/11/image-19.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-19.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/11/image-19.png?w=1018 1018w, https://terrytao.files.wordpress.com/2023/11/image-19.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-19.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-19.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-19.png 1190w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>And now the proof is done!  In the end, it was literally a “one-line proof”, which makes sense given how close Lemma 3.11 and Lemma 3.13 were to each other.</p>



<p>The current version of Blueprint does not automatically verify the proof (even though it does compile in Lean), so we have to manually update the blueprint as well.  The LaTeX for Lemma 3.13 <a href="https://github.com/teorth/pfr/blob/master/blueprint/src/chapter/distance.tex">currently looks like this:</a></p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-20.png"><img data-attachment-id="14111" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-20/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-20.png" data-orig-size="1130,341" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-20" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-20.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-20.png?w=490" loading="lazy" width="1024" height="309" src="https://terrytao.files.wordpress.com/2023/11/image-20.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-20.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/11/image-20.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-20.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-20.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-20.png 1130w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>I add the “\leanok” macro to the proof, to flag that the proof has now been formalized:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-22.png"><img data-attachment-id="14114" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-22/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-22.png" data-orig-size="1217,338" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-22" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-22.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-22.png?w=490" loading="lazy" width="1024" height="284" src="https://terrytao.files.wordpress.com/2023/11/image-22.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-22.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/11/image-22.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-22.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-22.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-22.png 1217w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>I then push everything back up to the master Github repository.  The blueprint will take quite some time (about half an hour) to rebuild, but eventually it does, and the dependency graph (which Blueprint has for some reason decided to rearrange a bit) now shows “<a href="https://teorth.github.io/pfr/blueprint/sect0003.html#ruzsa-nonneg">ruzsa-nonneg</a>” in green:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/11/image-23.png"><img data-attachment-id="14121" data-permalink="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/image-23/" data-orig-file="https://terrytao.files.wordpress.com/2023/11/image-23.png" data-orig-size="1643,711" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-23" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/11/image-23.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/11/image-23.png?w=490" loading="lazy" width="1024" height="443" src="https://terrytao.files.wordpress.com/2023/11/image-23.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/11/image-23.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/11/image-23.png?w=150 150w, https://terrytao.files.wordpress.com/2023/11/image-23.png?w=300 300w, https://terrytao.files.wordpress.com/2023/11/image-23.png?w=768 768w, https://terrytao.files.wordpress.com/2023/11/image-23.png 1643w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>And so the formalization of PFR moves a little bit closer to completion.  (Of course, this was a particularly easy lemma to formalize, that I chose to illustrate the process; one can imagine that most other lemmas will take a bit more work.)  Note that while “<a href="https://teorth.github.io/pfr/blueprint/sect0003.html#ruzsa-nonneg">ruzsa-nonneg</a>” is now colored in green, we don’t yet have a full proof of this result, because the lemma “<a href="https://teorth.github.io/pfr/blueprint/sect0003.html#ruzsa-diff">ruzsa-diff</a>” that it relies on is not green.  Nevertheless, the proof is <em>locally</em> complete at this point; hopefully at some point in the future, the predecessor results will also be locally proven, at which point this result will be completely proven.  Note how this blueprint structure allows one to work on different parts of the proof asynchronously; it is not necessary to wait for earlier stages of the argument to be fully formalized to start working on later stages, although I anticipate a small amount of interaction between different components as we iron out any bugs or slight inaccuracies in the blueprint.  (For instance, I am suspecting that we may need to add some measurability hypotheses on the random variables <img src="https://s0.wp.com/latex.php?latex=X%2C+Y&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=X%2C+Y&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=X%2C+Y&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="X, Y"/> in the above two lemmas to make them completely true, but this is something that should emerge organically as the formalization process continues.)</p>



<p>That concludes the brief tour!  If you are interested in learning more about the project, you can follow the <a href="https://leanprover.zulipchat.com/#narrow/stream/412902-Polynomial-Freiman-Ruzsa-conjecture">Zulip chat stream</a>; you can also <a href="https://leanprover-community.github.io/get_started.html">download Lean</a> and <a href="https://leanprover-community.github.io/install/project.html">work on the PFR project yourself</a>, using a local copy of the Github repository and sending pull requests to the master copy if you have managed to fill in one or more of the “sorry”s in the current version (but if you plan to work on anything more large scale than filling in a small lemma, it is good to announce your intention on the Zulip chat to avoid duplication of effort) .  (One key advantage of working with a project based around a proof assistant language such as Lean is that it makes large-scale mathematical collaboration possible without necessarily having a pre-established level of trust amongst the collaborators;  my fellow repository maintainers and I have already approved several pull requests from contributors that had not previously met, as the code was verified to be correct and we could see that it advanced the project.  Conversely, as the above example should hopefully demonstrate, it is possible for a contributor to work on one small corner of the project without necessarily needing to understand all the mathematics that goes into the project as a whole.)</p>



<p>If one just wants to experiment with Lean without going to the effort of downloading it, you can playing try the “<a href="https://adam.math.hhu.de/">Natural Number Game</a>” for a gentle introduction to the language, or the <a href="https://live.lean-lang.org/">Lean4 playground</a> for an online Lean server.  Further resources to learn Lean4 may be found <a href="https://leanprover-community.github.io/learn.html">here</a>.</p>
	</div></div>
  </body>
</html>
