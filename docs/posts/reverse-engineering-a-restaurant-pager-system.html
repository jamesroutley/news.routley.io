<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://k3xec.com/td158/">Original</a>
    <h1>Reverse Engineering a Restaurant Pager System</h1>
    
    <div id="readability-page-1" class="page"><div><a href="https://soylent.green/@paul">Paul Tagliamonte</a>
2024-06-14<p>Itâ€™s been a while since I played with something new â€“ been stuck in a bit of a
rut with radios recently - working on refining and debugging stuff I mostly
understand for the time being. The other day, I was out getting some food and I
idly wondered how the restaurant pager system worked. Idle curiosity gave way
to the realization that I, in fact, likely had the means and ability to answer
this question, so I bought the first set of the most popular looking restaurant
pagers I could find on eBay, figuring itâ€™d be a fun multi-week adventure.</p><p>I wound up buying a Retekess brand TD-158 Restaurant Pager System (they looked
like ones Iâ€™d seen before and seemed to be low-cost and popular), and quickly
after, had a pack of 10 pagers and a base station in-hand. The manual stated
that the radios operated at 433 MHz` (cool! can do! Love a good ISM band
device), and after taking an inital read through the manual for tips on the
PHY, I picked out a few interesting things. First is that the base station ID
was limited to 0-999, which is weird because it means the limiting factor is
likely the base-10 display on the base station, not the protocol â€“ we need
enough bits to store 999 â€“ at least 10 bits. Nothing else seemed to catch my
eye, so I figured may as well jump right to it.</p><p>Not being the type to mess with success, I did exactly the same thing as I did
in my <a href="https://k3xec.com/christmas">christmas tree post</a>, and took a capture at <code>433.92MHz</code>
since it was in the middle of the band, and immediately got deja-vu. Not only
was the signal at <code>433.92MHz</code>, but throwing the packet into <code>inspectrum</code> gave
me the <em>identical</em> plot of the OOK encoding scheme.</p><p><img src="https://k3xec.com/imgs/td158/td158-packet.png" alt=""/></p><p>Not just similar â€“ identical. The only major difference was the baud rate and
bit structure of the packets, and the only minor difference was the existence
of what I think is a wakeup preamble packet (of all zeros), rather than a
preamble symbol that lasted longer than usual PHY symbol (which makes this
pager system a bit easier to work with than my tree, IMHO).</p><p>Getting down to work, I took some measurements to determine what the symbol
duration was over the course of a few packets, I was able to determine the
symbol rate was somewhere around <code>858</code> microseconds (<code>0.000858</code> seconds per
symbol), which is a weird number, but maybe Iâ€™m slightly off or thereâ€™s some
larger math Iâ€™m missing that makes this number satisfyingly round (internal
low cost crystal clock or something? I assume this is some hardware constrait
with the pager?)</p><p>Anyway, good enough. Moving along, letâ€™s try our hand at a demod â€“ letâ€™s just
assume itâ€™s all the same as the chrismas tree post and demod ones and zeros
the same way here. That gives us 26 bits:</p><pre><code>00001101110000001010001000
</code></pre><p>Now, I know we need at least 10 bits for the base station ID, some number
of bits for the pager ID, and some bits for the command. This was a capture
of me hitting â€œcallâ€ from a base station ID of 55 to a pager with the ID of
10, so letâ€™s blindly look for 10 bit chunks with the numbers weâ€™re looking for:</p><pre><code>0000110111 0000001010 001000
</code></pre><p>Jeez. First try. 10 bits for the base station ID (55 in binary is
<code>0000110111</code>), 10 bits for the pager ID (10 in binary is <code>0000001010</code>), which
leaves us with 6 bits for a command (and maybe something else too?) â€“ which is
<code>8</code> here. Great, cool, letâ€™s work off that being the case and revisit it if
we hit bugs.</p><p>Besides our data packet, thereâ€™s also a â€œpreambleâ€ packet that Iâ€™ll add in,
in case itâ€™s used for signal detection or wakeup or something â€“ which is
fairly easy to do since itâ€™s the same packet structure as the above, just
all zeros. Very kind of them to leave it with the same number of bits and
encoding scheme â€“ itâ€™s nice that it can live outside the PHY.</p><p><img src="https://k3xec.com/imgs/td158/td158-preamble.png" alt=""/></p><p>Once I got here, I wrote a quick and dirty modulator, and was able to ring up
pagers! Unmitigated success and good news â€“ only downside was that it took me
a single night, and not the multi-week adventure I was looking for. Well, letâ€™s
finish the job and document what weâ€™ve found for the sake of completeness.</p><p>My best guess on the packet structure is as follows:</p><p>For a <code>call</code> or <code>F2</code> operation, the <code>argument</code> is the Pagerâ€™s ID code,
but for other commands itâ€™s a value or an enum, depending. Hereâ€™s a table
of my by-hand demodulation of all the packet types the base station
produces:</p><table><thead><tr><td>Type</td><td>Cmd Id</td><td>Description</td></tr></thead><tbody><tr><td>Call</td><td>8</td><td>Call the pager identified by the id in <code>argument</code></td></tr><tr><td>Off</td><td>60</td><td>Request any pagers on the charger power off when power is removed, <code>argument</code> is all zero</td></tr><tr><td>F2</td><td>40</td><td>Program a pager to the specified Pager ID (in <code>argument</code>) and base station</td></tr><tr><td>F3</td><td>44</td><td>Set the reminder duration in seconds specified in <code>argument</code></td></tr><tr><td>F4</td><td>48</td><td>Set the pager&#39;s beep mode to the one in <code>argument</code> (<code>0</code> is disabled, <code>1</code> is slow, <code>2</code> is medium, <code>3</code> is fast)</td></tr><tr><td>F5</td><td>52</td><td>Set the pager&#39;s vibration mode to the one in <code>argument</code> (<code>0</code> is disabled, <code>1</code> is enabled)</td></tr></tbody></table><p>Iâ€™m not going to be publishing this code since I canâ€™t think of a good use
anyone would have for this besides folks using a low cost SDR and annoying
local resturants; but thereâ€™s enough here for folks who find this interesting
to try modulating this protocol on their own hardware if they want to buy their
own pack of pagers and give it a shot, which I do encourage! Itâ€™s fun! Radios
are great, and this is a good protocol to hack with â€“ itâ€™s really nice.</p><p>All in all, this wasnâ€™t the multi-week adventure I was looking for, this was
still a great exercise and a fun reminder that Iâ€™ve come a far way from when
Iâ€™ve started. It felt a lot like cheating since I was able to infer a lot about
the PHY because Iâ€™d seen it before, but it was still a great time. I may grab a
few more restaurant pagers and see if I can find one with a more exotic PHY to
emulate next. I mean why not, Iâ€™ve already got the
<a href="https://github.com/paultag/go-epson">thermal</a>
<a href="https://crates.io/crates/epson">printer</a>
libraries
<a href="https://soylent.green/@paul/111805908699444082">working</a>
ğŸ–¨ï¸</p></div></div>
  </body>
</html>
