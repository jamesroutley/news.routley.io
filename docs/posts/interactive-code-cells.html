<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://antonz.org/code-cells/">Original</a>
    <h1>Interactive Code Cells</h1>
    
    <div id="readability-page-1" class="page"><div><div><article><div><div><header></header><p>What would you say if Jupyter Notebooks could ➀ support any programming language, ➁ have no hidden state, and ➂ have a native look and feel for any article or blog post?</p><p>Well, I&#39;ve just shipped something like that! With the latest <a href="https://github.com/nalgeon/codapi-js">codapi-js</a> feature called <em>code cells</em>, you can create a series of interactive code snippets that depend on each other and execute them without leaving your browser.</p><p>Let&#39;s look at an example.</p><h2 id="code-cells">Code cells</h2><p>Suppose we are writing an SQL tutorial using PostgreSQL. First, let&#39;s create an <code>employees</code> table:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>create</span> <span>table</span> <span>employees</span> (
</span></span><span><span>  <span>id</span> <span>integer</span> <span>primary</span> <span>key</span>,
</span></span><span><span>  <span>name</span> <span>varchar</span>(<span>50</span>),
</span></span><span><span>  <span>department</span> <span>varchar</span>(<span>10</span>),
</span></span><span><span>  <span>salary</span> <span>integer</span>
</span></span><span><span>);
</span></span></code></pre></div><codapi-snippet id="create.sql" sandbox="postgres" editor="basic" template="#status.tpl"></codapi-snippet><p>Then insert some employee data:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>insert</span> <span>into</span> <span>employees</span>
</span></span><span><span>(<span>id</span>, <span>name</span>, <span>department</span>, <span>salary</span>)
</span></span><span><span><span>values</span>
</span></span><span><span>(<span>11</span>, <span>&#39;Diane&#39;</span>, <span>&#39;hr&#39;</span>, <span>70</span>),
</span></span><span><span>(<span>12</span>, <span>&#39;Bob&#39;</span>, <span>&#39;hr&#39;</span>, <span>78</span>),
</span></span><span><span>(<span>21</span>, <span>&#39;Emma&#39;</span>, <span>&#39;it&#39;</span>, <span>84</span>),
</span></span><span><span>(<span>22</span>, <span>&#39;Grace&#39;</span>, <span>&#39;it&#39;</span>, <span>90</span>),
</span></span><span><span>(<span>23</span>, <span>&#39;Henry&#39;</span>, <span>&#39;it&#39;</span>, <span>104</span>),
</span></span><span><span>(<span>31</span>, <span>&#39;Cindy&#39;</span>, <span>&#39;sales&#39;</span>, <span>96</span>),
</span></span><span><span>(<span>32</span>, <span>&#39;Dave&#39;</span>, <span>&#39;sales&#39;</span>, <span>96</span>),
</span></span><span><span>(<span>33</span>, <span>&#39;Alice&#39;</span>, <span>&#39;sales&#39;</span>, <span>100</span>);
</span></span></code></pre></div><codapi-snippet id="insert.sql" sandbox="postgres" editor="basic" template="#status.tpl" depends-on="create.sql"></codapi-snippet><p>Finally, rank the employees according to their salaries in each department:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span>
</span></span><span><span>  <span>department</span> <span>as</span> <span>dep</span>,
</span></span><span><span>  <span>dense_rank</span>() <span>over</span> <span>w</span> <span>as</span> <span>rank</span>,
</span></span><span><span>  <span>name</span>, <span>salary</span>
</span></span><span><span><span>from</span> <span>employees</span>
</span></span><span><span><span>window</span> <span>w</span> <span>as</span> (
</span></span><span><span>  <span>partition</span> <span>by</span> <span>department</span>
</span></span><span><span>  <span>order</span> <span>by</span> <span>salary</span> <span>desc</span>
</span></span><span><span>)
</span></span><span><span><span>order</span> <span>by</span> <span>department</span>, <span>rank</span>;
</span></span></code></pre></div><codapi-snippet sandbox="postgres" editor="basic" template="#select.tpl" depends-on="insert.sql"></codapi-snippet><p>As you can probably see, the <code>insert</code> snippet depends on the <code>create</code> snippet, while the <code>select</code> snippet depends on both <code>create</code> and <code>insert</code>, forming a dependency chain:</p><pre tabindex="0"><code>create ← insert ← select
</code></pre><p>This is how the snippets work:</p><ul><li>When you run the <code>insert</code> snippet, it automatically creates the table before inserting the data.</li><li>When you run the <code>select</code> snippet, it automatically creates the table and inserts the records before selecting the data.</li></ul><p>The dependencies do not have to be linear, they can form an (acyclic) graph. Suppose we want to <code>describe</code> the table schema:</p><pre tabindex="0"><code>\d employees;
</code></pre><codapi-snippet sandbox="postgres" editor="basic" template="#select.tpl" depends-on="create.sql"></codapi-snippet><p>The <code>describe</code> snippet does not need table data, so it can depend directly on the <code>create</code> snippet:</p><pre tabindex="0"><code>create ← insert ← select
   ↖
  describe
</code></pre><p>More complex dependency graphs are also possible, as long as there are no cycles:</p><pre tabindex="0"><code>create ← insert-1 ← select
       ↖ insert-2 ↙
</code></pre><p>You probably get the idea.</p><h2 id="implementation">Implementation</h2><p>Back to our example. Suppose we started with two static code examples — <code>create</code> and <code>insert</code>:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>create</span> <span>table</span> <span>employees</span> (
</span></span><span><span>  <span>id</span> <span>integer</span> <span>primary</span> <span>key</span>,
</span></span><span><span>  <span>name</span> <span>varchar</span>(<span>50</span>),
</span></span><span><span>  <span>department</span> <span>varchar</span>(<span>10</span>),
</span></span><span><span>  <span>salary</span> <span>integer</span>
</span></span><span><span>);
</span></span></code></pre></div><div><pre tabindex="0"><code data-lang="sql"><span><span><span>insert</span> <span>into</span> <span>employees</span>
</span></span><span><span>(<span>id</span>, <span>name</span>, <span>department</span>, <span>salary</span>)
</span></span><span><span><span>values</span>
</span></span><span><span>(<span>11</span>, <span>&#39;Diane&#39;</span>, <span>&#39;hr&#39;</span>, <span>70</span>),
</span></span><span><span>(<span>12</span>, <span>&#39;Bob&#39;</span>, <span>&#39;hr&#39;</span>, <span>78</span>),
</span></span><span><span>(<span>21</span>, <span>&#39;Emma&#39;</span>, <span>&#39;it&#39;</span>, <span>84</span>);
</span></span></code></pre></div><p>First, we make them interactive by adding <code>codapi-snippet</code>s.</p><p>➀ Create:</p><pre><code>```sql
create table employees (
  id integer primary key,
  name varchar(50),
  department varchar(10),
  salary integer
);
```

&lt;codapi-snippet id=&#34;create.sql&#34; sandbox=&#34;postgres&#34; editor=&#34;basic&#34;&gt;
&lt;/codapi-snippet&gt;
</code></pre><p>➁ Insert:</p><pre><code>```sql
insert into employees
(id, name, department, salary)
values
(11, &#39;Diane&#39;, &#39;hr&#39;, 70),
(12, &#39;Bob&#39;, &#39;hr&#39;, 78),
(21, &#39;Emma&#39;, &#39;it&#39;, 84);
```

&lt;codapi-snippet id=&#34;insert.sql&#34; sandbox=&#34;postgres&#34; editor=&#34;basic&#34;&gt;
&lt;/codapi-snippet&gt;
</code></pre><p>Then we make <code>insert</code> dependent on <code>create</code> by adding a <code>depends-on</code> attribute:</p><div><pre tabindex="0"><code data-lang="html"><span><span>&lt;<span>codapi-snippet</span> <span>id</span><span>=</span><span>&#34;insert.sql&#34;</span> <span>sandbox</span><span>=</span><span>&#34;postgres&#34;</span> <span>editor</span><span>=</span><span>&#34;basic&#34;</span>
</span></span><span><span>    <span>depends-on</span><span>=</span><span>&#34;create.sql&#34;</span>&gt;
</span></span><span><span>&lt;/<span>codapi-snippet</span>&gt;
</span></span></code></pre></div><p>The rest is automatic!</p><p>Behind the scenes, <code>codapi-snippet</code> calls a <a href="https://github.com/nalgeon/codapi">codapi</a> server (either a cloud or self-hosted instance) so it can run any programming language, database or software you&#39;ve configured.</p><p>As you know, Jupyter notebooks are stateful — that is, they store the state of variables between cell invocations. This can be a good thing for prototyping, but not for documentation or explanation.</p><p>The last thing I want as a reader is code examples that fail or behave oddly because they were run out of order. Or because I didn&#39;t run some cells. Or because I changed a cell and didn&#39;t re-run it.</p><p>Codapi code cells, unlike Jupyter&#39;s, have no hidden state. Instead, they execute the whole chain of dependencies as needed to ensure that the reader gets a consistent result.</p><h2 id="summary">Summary</h2><p>Codapi provides an easy way to create interactive examples in technical documentation. It gets even easier with code cells, which allow declarative dependencies between snippets of code.</p><p>Give it a try!</p><p><a href="https://codapi.org/">About Codapi</a> •
<a href="https://github.com/nalgeon/codapi">Codapi server</a> •
<a href="https://github.com/nalgeon/codapi-js">Snippet widget</a></p><p><em><a href="https://antonz.org/subscribe/"><i></i> <strong>Subscribe</strong></a>
to keep up with new posts.</em></p></div></div></article></div></div></div>
  </body>
</html>
