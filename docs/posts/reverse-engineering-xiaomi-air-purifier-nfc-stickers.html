<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.flamingo-tech.nl/2022/05/27/this-is-how-they-do-it/">Original</a>
    <h1>Reverse engineering Xiaomi air purifier NFC stickers</h1>
    
    <div id="readability-page-1" class="page"><article id="post-577">

	<!-- .entry-header -->

	<div>
		
<p>Well itâ€™s been a long time since Iâ€™ve posted something newâ€¦ But today Iâ€™ve got something big:</p>



<figure><img loading="lazy" width="365" height="274" src="https://www.flamingo-tech.nl/wp-content/uploads/2022/05/ezgif-2-a4c55b6128.gif" alt=""/><figcaption>NFC Stickers act like new filters!!</figcaption></figure>



<p>Sometime last year I received an email from Doegox. A Belgium Hacker (I know him for his work on the ICE-man repo of the proxmark readers/writers).</p>



<p>We exchanged some information and this is what I received from him:</p>



<pre><code>import sys
import hashlib

# Usage: pwd.py 04A03CAA1E7080
def getpwd(uid):
    uid = bytearray.fromhex(uid)
    h = bytearray.fromhex(hashlib.sha1(uid).hexdigest())
    pwd = &#34;&#34;
    pwd += &#34;%02X&#34; % h[h[0] % 20]
    pwd += &#34;%02X&#34; % h[(h[0]+5) % 20]
    pwd += &#34;%02X&#34; % h[(h[0]+13) % 20]
    pwd += &#34;%02X&#34; % h[(h[0]+17) % 20]
    return pwd

assert getpwd(&#34;04A03CAA1E7080&#34;) == &#34;CD91AFCC&#34;
assert getpwd(&#34;04112233445566&#34;) == &#34;EC9805C8&#34;
print(&#34;PWD:&#34;, getpwd(sys.argv[1]))

</code></pre>



<p>To most of you this might look like some random code.. But this is actually very specialâ€¦ Xiaomi relies on a password for communication between filter and air purifier. More information can be found on the reverse engineering Github: <a href="https://github.com/Flamingo-tech/xiaomi-air-purifier-reverse-engineering/tree/main/Filter%20information" target="_blank" rel="noreferrer noopener">Click</a></p>



<p>The type of NFC tags that are used are the NTAG213 tags (by NXP) How they created the password was a secret until now!</p>



<p>They use the UUID (duhh its, unique for each filter) If we use the above code and and insert a filter with UUID : 04A03CAA1E7080 we get the password CD91AFCC.</p>



<p>As seen as in my Github filter snoop: <a href="https://github.com/Flamingo-tech/xiaomi-air-purifier-reverse-engineering/blob/main/Filter%20information/Filter%203/100%25/Snoop.txt" target="_blank" rel="noreferrer noopener">Click</a></p>



<p>That means we can make our own filters now!</p>



<figure><img loading="lazy" width="410" height="230" src="https://www.flamingo-tech.nl/wp-content/uploads/2022/05/giphy.gif" alt=""/><figcaption>Party hard.</figcaption></figure>



<p>This will significantly decrease the waste footprint from a whole filter.. to just a sticker ðŸ˜€</p>



<p>if you want to support me, buy a NFC sticker pack (yes they act as an new filter in a Xiaomi Air Purifier)</p>



<p><a href="https://www.tindie.com/stores/theflamingo/?ref=offsite_badges&amp;utm_source=sellers_TheFlamingo&amp;utm_medium=badges&amp;utm_campaign=badge_large"><img loading="lazy" src="https://d2ss6ovg47m0r5.cloudfront.net/badges/tindie-larges.png" alt="I sell on Tindie" width="200" height="104"/></a>
</p>



<p>Special thanks to Doegox and an incredible programmer friend. </p>



<figure><img loading="lazy" width="480" height="270" src="https://www.flamingo-tech.nl/wp-content/uploads/2022/05/giphy2.gif" alt=""/><figcaption>Programmingâ€¦..</figcaption></figure>








	</div><!-- .entry-content -->

	<!-- .entry-footer -->

				
</article></div>
  </body>
</html>
