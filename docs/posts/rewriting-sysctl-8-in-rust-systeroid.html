<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.orhun.dev/rewriting-sysctl-in-rust/">Original</a>
    <h1>Rewriting Sysctl(8) in Rust: Systeroid</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
      <p><a href="https://en.wikipedia.org/wiki/Sysctl">sysctl</a> is a simple and great tool for modifying the kernel parameters. It does its job very well by providing an easy-to-use interface for <code>/proc/sys</code>. It is maintained as a part of <a href="https://gitlab.com/procps-ng/procps">procps</a> toolkit for years and it can easily be considered a legacy tool today. So why not push it to its limits and turn it into a more user-friendly and even more useful tool with the power of Rust?</p>
<h3 id="sysctl">sysctl</h3>
<p>sysctl depends on <a href="https://en.wikipedia.org/wiki/Procfs">procfs</a> and works by accessing/modifying the kernel parameters that reside in <code>/proc/sys</code> directory. The basic functionalities of sysctl are the following:</p>
<ul>
<li>List parameter values: <code>sysctl -A</code></li>
<li>Set a parameter value: <code>sysctl -w parameter=1</code></li>
</ul>
<p>A more concrete example would be:</p>
<pre data-lang="sh"><code data-lang="sh"><span>sysctl</span><span> -w</span><span> vm.swappiness=60
</span></code></pre>
<p>Considering this simple example, how different use cases could you have, and what role does <strong>systeroid</strong> play?</p>
<h3 id="systeroid">systeroid</h3>
<p><a href="https://github.com/orhun/systeroid"><strong>https://github.com/orhun/systeroid</strong></a></p>
<p><strong>systeroid</strong> is &#34;sysctl on steroids&#34;. Similar to sysctl, it is implemented using procfs and the primary goal is to manage the kernel parameters. It has a bunch of features to ease the process of reading and modifying the values and even retrieving information about them from the official Linux kernel documentation. It also has a text-based user interface to visualize the state of the kernel parameters and interactively perform these management operations.</p>
<p><img src="https://github.com/orhun/systeroid/raw/main/assets/systeroid-demo.gif" alt="demo"/></p>
<h4 id="comparison">Comparison</h4>
<p>If you compare the <code>--help</code> output of systeroid with sysctl, you will see that they are compatible with each other, also meaning that systeroid encapsulates the functionality. There are some additional arguments/flags which is the actual thing that gives systeroid its power:</p>
<ul>
<li><code>-T, --tree</code>: display the variables in a tree-like format</li>
<li><code>-J, --json</code>: display the variables in JSON format</li>
<li><code>-E, --explain</code>: provide a detailed explanation for variable</li>
<li><code>-D, --docs &lt;path&gt;</code>: set the path of the kernel documentation</li>
<li><code>-P, --no-pager</code>: do not pipe output into a pager</li>
<li><code>-v, --verbose</code>: enable verbose logging</li>
<li><code>--tui</code>: show terminal user interface</li>
</ul>
<p>systeroid can also be used as a drop-in replacement for sysctl.</p>
<h4 id="output-formats">Output formats</h4>
<p><code>systeroid -A</code> is the simplest way of listing the kernel parameters. In addition, there is also <code>-T, --tree</code> flag which will output a tree:</p>
<pre data-lang="sh"><code data-lang="sh"><span>$ systeroid</span><span> --names --pattern </span><span>&#39;kernel.*_max$&#39;</span><span> --tree
</span><span>
</span><span>kernel
</span><span>‚îú‚îÄ‚îÄ ngroups_max
</span><span>‚îú‚îÄ‚îÄ pid_max
</span><span>‚îî‚îÄ‚îÄ sched_util_clamp_max
</span></code></pre>
<p>You can also <code>-J, --json</code> to get the output as JSON:</p>
<pre data-lang="sh"><code data-lang="sh"><span>$ systeroid</span><span> --pattern </span><span>&#39;^net.*&#39;</span><span> --json
</span><span>
</span><span>[
</span><span>  {
</span><span>    </span><span>&#34;name&#34;</span><span>: </span><span>&#34;net.unix.max_dgram_qlen&#34;</span><span>,
</span><span>    </span><span>&#34;section&#34;</span><span>: </span><span>&#34;net&#34;</span><span>,
</span><span>    </span><span>&#34;value&#34;</span><span>: </span><span>&#34;512&#34;
</span><span>  }
</span><span>]
</span></code></pre>
<h4 id="explain">Explain</h4>
<p>Let&#39;s assume that you have faced a particular problem and someone on Stack Overflow recommended using the following command:</p>
<pre data-lang="sh"><code data-lang="sh"><span>sysctl</span><span> -w</span><span> kernel.oops_all_cpu_backtrace=0
</span></code></pre>
<p>In this case, you might ask what is &#34;kernel.oops_all_cpu_backtrace&#34; and what does setting it to 0 do?</p>
<p>This is where systeroid comes in to help:</p>
<pre data-lang="sh"><code data-lang="sh"><span>systeroid</span><span> --explain</span><span> kernel.oops_all_cpu_backtrace
</span></code></pre>
<p>The command above will fetch the corresponding information from the Linux kernel documentation and yield the results to stdout via <code>less</code>. Similarly, you can run systeroid with <code>-E, --explain</code> argument to retrieve information about any other parameter (as long as they are present in the kernel documentation).</p>
<p>So how does this work?</p>
<p>As you might have guessed, you need to have the kernel documentation &#34;installed&#34; or cloned somewhere. Distro packages solve this by having the kernel documentation as a separate package and in that case, all you have to do is install that package. (e.g. <a href="https://archlinux.org/packages/core/x86_64/linux-docs/">linux-docs</a> in Arch Linux) In case this is not applicable, you need to clone the kernel repository and specify a path via <code>-D, --docs</code> argument. There is a <a href="https://github.com/orhun/systeroid/blob/main/scripts/clone-linux-docs.sh">convenience script</a> in the repository.</p>
<pre data-lang="sh"><code data-lang="sh"><span># specify the kernel documentation path explicitly
</span><span># (not needed if you have the kernel documentation installed as a package)
</span><span>systeroid</span><span> -E</span><span> user.max_user_namespaces</span><span> -D</span><span> /usr/share/doc/linux
</span></code></pre>
<p>After the kernel documentation is supplied to systeroid, it parses the corresponding sysctl files (using <a href="https://github.com/orhun/parseit">parseit</a> crate) and caches them for the next run. This way, documentation about each parameter can be shown to the user.</p>
<p>For more information, see the <a href="https://github.com/orhun/systeroid#showing-information-about-parameters">README.md#showing-information-about-parameters</a>.</p>
<h4 id="tui">TUI</h4>
<p>systeroid has a terminal interface that can be launched via <code>systeroid-tui</code> (binary) or <code>systeroid --tui</code> (alias).</p>
<p><img src="https://raw.githubusercontent.com/orhun/systeroid/main/assets/systeroid-tui-set-value.gif" alt="systeroid-tui"/></p>
<p>Currently, the following actions are supported:</p>
<ul>
<li><a href="https://github.com/orhun/systeroid#scrolling">Browse the available parameters</a></li>
<li><a href="https://github.com/orhun/systeroid#viewing-the-parameter-documentation">View the documentation</a></li>
<li><a href="https://github.com/orhun/systeroid#searching">Search for parameters</a></li>
<li><a href="https://github.com/orhun/systeroid#setting-values-1">Update the value of a parameter</a></li>
<li><a href="https://github.com/orhun/systeroid#copying-to-clipboard">Copy to clipboard</a></li>
<li><a href="https://github.com/orhun/systeroid#running-commands">And more!</a></li>
</ul>
<p>The colors are also <a href="https://github.com/orhun/systeroid#changing-the-colors">customizable</a> and I&#39;m thinking of adding a <a href="https://github.com/orhun/systeroid/issues/12">configuration file</a> to customize the TUI in the future.</p>
<h3 id="endnote">Endnote</h3>
<p>My primary goal for the future of the project is simply adding more ways to conveniently manage the kernel parameters. I also plan to work on the <a href="https://github.com/orhun/systeroid/issues">existing issues</a>. I hope systeroid will help you out in ways that will improve your workflow and the security of your kernel :)</p>
<p>If you liked <strong>systeroid</strong> and/or my other projects on my GitHub, please consider <a href="https://www.patreon.com/join/orhunp">becoming a patron</a> to support me! üêª</p>
<p><em>G√∂r√º≈ümek √ºzere!</em></p>

    </div></div>
  </body>
</html>
