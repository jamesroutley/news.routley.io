<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://thevaluable.dev/fzf-vim-integration/">Original</a>
    <h1>A Practical Guide to fzf: Vim Integration</h1>
    
    <div id="readability-page-1" class="page"><div role="main"><article><section><picture><source srcset="https://thevaluable.dev/images/2023/fzf-vim/tmnt_fzf.webp" type="image/webp"/><img width="780" height="520" src="https://thevaluable.dev/images/2023/fzf-vim/tmnt_fzf.jpg" alt="Raphael using fzf to search his friends"/></picture><p>This article is the third part of a series about fzf:</p><div><div><ol><li><a href="https://thevaluable.dev/practical-guide-fzf-example/">A Practical Guide to fzf: Building a File Explorer</a></li><li><a href="https://thevaluable.dev/fzf-shell-integration/">A Practical Guide to fzf: Shell Integration</a></li><li><a href="https://thevaluable.dev/fzf-vim-integration/">A Practical Guide to fzf: Vim Integration</a></li></ol></div></div><p>Davina, your colleague developer, explained in the two previous articles of the series how to use and configure fzf for the shell. This time, she’s back to explain how to use fzf directly in the Best Editor in the Known Universe™, <del>Emacs</del> Vim (or Neovim).</p><p>Vim vanilla functionalities are often enough to do what we want to do, but not this time. To use fzf in Vim, we’ll have to use two plugins:</p><ol><li><a href="https://github.com/junegunn/fzf/blob/master/README-VIM.md" target="_blank" rel="noopener">A first plugin</a>, coming directly with fzf. I’ll call it the “native fzf plugin” in this article.</li><li>Another plugin, <a href="https://github.com/junegunn/fzf.vim" target="_blank" rel="noopener">fzf.vim</a>, adding new <a href="https://thevaluable.dev/vim-expert/#user-commands" target="_blank" rel="noopener">user commands</a> and global options.</li></ol><p>The plugin fzf.vim is built on top of the native fzf plugin, that’s why we’ll need to use both. They are great plugins for two reasons:</p><ol><li>They are not bloated. It’s not too hard to dig in the code and understand how they work.</li><li>They are both written by the author of fzf itself, and he’s far from being an amateur.</li></ol><p>I’ll try to clearly specify what plugin bring what functionality in this article. In fact, if you’re ready to spend more time to configure fzf in Vim, you can skip fzf.vim entirely, and only rely on the native fzf plugin.</p><p>We’ll see, in this article:</p><ul><li>How to install these two plugins to harness fzf power in Vim.</li><li>The default user commands offered by the plugin fzf.vim.</li><li>The global variables we can use to configure further the fzf integration.</li><li>The basic functions allowing us to build our own user commands.</li></ul><p>Are you ready to fuzzy find everything and anything? Me neither, but let’s dive anyway.</p><h2 id="installing-the-fzf-plugins-for-vim">Installing the fzf Plugins for Vim</h2><p>Let’s first install the two plugins we were speaking about in the introduction.</p><p>They can be installed like any other plugin; for example, if you use a plugin manager like <a href="https://github.com/junegunn/vim-plug" target="_blank" rel="noopener">vim-plug</a>, you can simply add the following to your Vim config:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>&#34; fzf native plugin</span><span>
</span></span></span><span><span><span></span><span>Plug</span> <span>&#39;junegunn/fzf&#39;</span><span>
</span></span></span><span><span><span></span><span>&#34; fzf.vim</span><span>
</span></span></span><span><span><span></span><span>Plug</span> <span>&#39;junegunn/fzf.vim&#39;</span><span>
</span></span></span></code></pre></div><p>Nothing earth-shattering here. That said, the native fzf plugin is automatically installed when you install fzf itself. As a result, you can directly include fzf’s directory in your <a href="https://thevaluable.dev/vim-runtime-guide-example/">runtime path</a>. For example, if you installed fzf with homebrew, you can add the following to your Vim config to get the native fzf plugin:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>set</span> <span>rtp</span><span>+=</span><span>/usr/</span><span>local</span><span>/opt/</span><span>fzf</span><span>
</span></span></span></code></pre></div><p>If you’re using Arch Linux: you don’t need to do anything to use the native fzf plugin, it’s directly included in your Vim’s global plugin directory when you install fzf with pacman. It means that it will always be sourced when Vim starts.</p><p>It’s also interesting to note that the native fzf plugin is quite small (it’s <a href="https://github.com/junegunn/fzf/blob/master/plugin/fzf.vim" target="_blank" rel="noopener">only one file</a>). If you decide to only use this one, your integration’s footprint will be minimal.</p><p>That’s it! Next!</p><h2 id="the-default-user-commands">The Default User Commands</h2><p>The plugin <a href="https://github.com/junegunn/fzf.vim" target="_blank" rel="noopener">fzf.vim</a> comes with many different user commands you can use from the get-go. They allow you to search through your files to find and edit what you want.</p><p>I describe, in this section, some of the user commands I find the most useful. There are many others you can find in the <a href="https://github.com/junegunn/fzf.vim" target="_blank" rel="noopener">plugin’s README file</a>.</p><h3 id="searching-through-files">Searching Through Files</h3><picture><source srcset="https://thevaluable.dev/images/2023/fzf-vim/fzf-vim-file.webp" type="image/webp"/><img width="780" height="520" src="https://thevaluable.dev/images/2023/fzf-vim/fzf-vim-file.jpg" alt="Using fzf in vim with the :File Ex command"/></picture><p>To search any file in your project by its filename, you can always use the Ex command <code>:find</code> in vanilla Vim. But you need to already know where the file is located in your filesystem (more or less), and it can be cumbersome to always have to type a pattern to narrow down the search.</p><p>In my opinion, it’s where fuzzy finding becomes handy. The plugin fzf.vim offers you a couple of Ex commands which can help you search the filenames you want to edit:</p><table><tbody><tr><th>Ex command</th><th>Description</th></tr><tr><td><code>:Files {directory}</code></td><td>Populate fzf with all the filenames from the <code>{directory}</code>, recursively. The working directory is used if no <code>{directory}</code> is specified.</td></tr><tr><td><code>:GFiles</code></td><td>Populate fzf with the filenames of all the files added to Git (using the shell command <code>git ls-files</code> under the hood).</td></tr><tr><td><code>:History</code></td><td>Populate fzf with the history of open filenames.</td></tr></tbody></table><p>How these Ex commands work, you might rightfully ask?</p><p>Under the hood, the commands above run a shell command defined by the environment variable <code>FZF_DEFAULT_COMMAND</code>, to populate fzf with a list of filenames. It also uses the environment variable <code>FZF_DEFAULT_OPTS</code> to give to fzf some default options.</p><p>If these environment variables are not defined, fzf uses the <a href="https://thevaluable.dev/find-cli-guide-examples/">CLI find</a> to get the list of filenames it needs. If you want to know more about these two environment variables, I’ve written about them in <a href="https://thevaluable.dev/practical-guide-fzf-example/#the-default-command">the first article of this series</a>.</p><p>You can also use a couple of keystrokes directly in fzf after running one of the command above. They allow you to edit the files you want to edit in new split windows or tabs:</p><table><tbody><tr><th>Keystroke</th><th>Description</th></tr><tr><td><code>ENTER</code></td><td>Open the file in the current window.</td></tr><tr><td><code>CTRL-x</code></td><td>Open the file in a new horizontal split.</td></tr><tr><td><code>CTRL-v</code></td><td>Open the file in a new vertical split.</td></tr><tr><td><code>CTRL-t</code></td><td>Open the file in a new tab.</td></tr></tbody></table><p>When you hit any keystroke described above, Vim will run an Ex command with the entry selected as argument. For example, when you hit <code>ENTER</code> after selecting the file <code>a</code>, Vim will run the Ex commands <code>:edit a</code>. If you hit <code>CTRL-v</code>, <code>:vsplit</code> will be used instead of <code>:edit</code>.</p><p>Since fzf runs with <a href="https://thevaluable.dev/practical-guide-fzf-example/#selecting-more-entries-with-multi-selection">multi-selection on</a>, you can hit the <code>TAB</code> key to select more than one file to edit them all! In that case, Vim will run the different Ex commands (<code>:edit</code> for example) multiple times.</p><h3 id="using-the-fzf-ex-command">Using the Fzf Ex Command</h3><p>There is another, more flexible command you can use to search through your files using their filenames. This one is implemented in the native fzf plugin; as a result, you won’t need <code>fzf.vim</code> to use it. Here it is:</p><table><tbody><tr><th>Ex command</th><th>Description</th></tr><tr><td><code>:FZF {options} {path}</code></td><td>Populate fzf with all the filenames from the <code>{directory}</code>, recursively. It also gives fzf some <code>{options}</code>. The working directory is used if no <code>{directory}</code> is specified.</td></tr></tbody></table><p>Again, both environment variables <code>FZF_DEFAULT_COMMAND</code> and <code>FZF_DEFAULT_OPTS</code> are used if they are defined.</p><p>Here’s an example:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>:</span><span>FZF</span> <span>--</span><span>multi</span> <span>--</span><span>layout</span><span>=</span><span>reverse</span><span>-</span><span>list</span> <span>--</span><span>info</span><span>=</span><span>inline</span> <span>--</span><span>pointer</span><span>=</span>→  <span>--</span><span>marker</span><span>=</span>♡<span>
</span></span></span></code></pre></div><p>If you know how to use fzf in your shell, it’s then easy to use <code>:FZF</code> in Vim to search any file you want. If you want more options to feed the gluttony fzf, you can look at the <a href="https://thevaluable.dev/practical-guide-fzf-example/">first article of this series</a>.</p><p>It’s not easy to craft more complex commands, however. For example, you’ll have a hard time to display a preview of the files, configuring the layout, or even change the syntax highlighting.</p><h3 id="searching-through-the-content-of-files">Searching Through the Content of Files</h3><picture><source srcset="https://thevaluable.dev/images/2023/fzf-vim/fzf-vim-ripgrep.webp" type="image/webp"/><img width="780" height="520" src="https://thevaluable.dev/images/2023/fzf-vim/fzf-vim-ripgrep.jpg" alt="Using fzf with ripgrep"/></picture><p>The above user commands are great, but you need to have an idea of the filename you want to edit to use them effectively. What if you want to search into your files’ content directly? Vanilla Vim already offers <a href="https://thevaluable.dev/vim-search-find-replace/#vim-search-in-multiple-files">many functionalities to do so</a> natively, but being able to fuzzy search through all this content is even more effective.</p><p>The plugin fzf.vim offers a couple of user commands directly using two external CLIs:</p><ul><li><a href="https://github.com/ggreer/the_silver_searcher" target="_blank" rel="noopener">ag - The Silver Searcher</a></li><li><a href="https://github.com/BurntSushi/ripgrep" target="_blank" rel="noopener">rg - ripgrep</a></li></ul><p>Here they are:</p><table><tbody><tr><th>Ex command</th><th>Description</th></tr><tr><td><code>:Ag [pattern]</code></td><td>Use The Silver Searcher to search the <code>[pattern]</code> through your files’ content.</td></tr><tr><td><code>:Rg [pattern]</code></td><td>Use ripgrep to search the <code>[pattern]</code> through your files’ content.</td></tr></tbody></table><p>You can also use two handy keystrokes when fzf pops up:</p><table><tbody><tr><th>Keystroke</th><th>Description</th></tr><tr><td><code>ALT-a</code></td><td>Select all files.</td></tr><tr><td><code>ALT-d</code></td><td>De-select all files.</td></tr></tbody></table><p>Again, you can select multiple entries to edit all the files selected. It’s interesting to note that, in that case, <a href="https://thevaluable.dev/vim-advanced/#quickfix-lists">a quickfix list</a> will also be created and filled with these files. Handy if you need to do some <a href="https://thevaluable.dev/vim-advanced/#vims-quickfix-and-location-list">operations across all the selected files</a>, for example.</p><h3 id="searching-through-open-buffers">Searching Through Open Buffers</h3><picture><source srcset="https://thevaluable.dev/images/2023/fzf-vim/fzf-vim-buffer-list.webp" type="image/webp"/><img width="780" height="520" src="https://thevaluable.dev/images/2023/fzf-vim/fzf-vim-buffer-list.jpg" alt="Using fzf in Vim to search a buffer"/></picture><p>What about searching directly through your open buffers using fzf? It can be a good alternative to the <code>:buffer</code> Ex command, especially if you have an unfathomable amount of buffers open.</p><p>Here are the magical commands you always wanted:</p><table><tbody><tr><th>Ex command</th><th>Description</th></tr><tr><td><code>:Buffers</code></td><td>Search through all open buffers.</td></tr><tr><td><code>:Lines</code></td><td>Search through the content of all open buffers.</td></tr><tr><td><code>:BLines</code></td><td>Search through the content of the current buffer.</td></tr></tbody></table><p>Again, it’s interesting to note that both <code>:Lines</code> and <code>:BLines</code> will fill a quickfix list if multiple entries are selected.</p><h3 id="searching-through-command-and-search-histories">Searching Through Command and Search Histories</h3><picture><source srcset="https://thevaluable.dev/images/2023/fzf-vim/fzf-vim-history.webp" type="image/webp"/><img width="780" height="520" src="https://thevaluable.dev/images/2023/fzf-vim/fzf-vim-history.jpg" alt="Using fzf in Vim to search through your histories"/></picture><p>It’s also possible to fuzzy-find your way through different histories, like your Ex command history or even your search history:</p><table><tbody><tr><th>Ex command</th><th>Description</th></tr><tr><td><code>:History:</code></td><td>Search through your Ex command history.</td></tr><tr><td><code>:History/</code></td><td>Search through your search history.</td></tr></tbody></table><p>As a reminder, the <a href="https://thevaluable.dev/vim-intermediate/#command-line-window" target="_blank" rel="noopener">Ex command history</a> gives all the executed Ex command you’ve run.</p><h3 id="searching-through-your-mapping">Searching Through your Mapping</h3><picture><source srcset="https://thevaluable.dev/images/2023/fzf-vim/fzf-vim-mapping.webp" type="image/webp"/><img width="780" height="520" src="https://thevaluable.dev/images/2023/fzf-vim/fzf-vim-mapping.jpg" alt="Using fzf in Vim to search through your mapping"/></picture><p>Have you ever wonder how to go through your mapping? By default in Vim, you can use the <a href="https://thevaluable.dev/vim-expert/#verbose-commands">verbose Ex command</a> <code>:verbose</code> to do so. You can also use fzf:</p><table><tbody><tr><th>Ex command</th><th>Description</th></tr><tr><td><code>:Maps</code></td><td>Search through all NORMAL mode mapping.</td></tr></tbody></table><h3 id="adding-a-prefix-to-the-default-fzf-ex-commands">Adding a Prefix to the Default Fzf Ex-Commands</h3><p>If you don’t like the names of the Ex commands provided by fzf.vim, or if they conflict with your own user commands, you can add a prefix to their names using the global variable <code>g:fzf_vim.command_prefix</code>. For example:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>let</span> <span>g</span>:<span>fzf_vim</span> <span>=</span> {}<span>
</span></span></span><span><span><span></span><span>let</span> <span>g</span>:<span>fzf_vim</span>.<span>command_prefix</span> <span>=</span> <span>&#39;Fzf&#39;</span><span>
</span></span></span></code></pre></div><p>Then, instead of running <code>:Files</code> to search for a filename for example, you can run <code>:FzfFiles</code>.</p><p>You can also directly overwrite these commands with more customized one; we’ll see that in another section below.</p><h3 id="opening-fzf-fullscreen">Opening fzf Fullscreen</h3><picture><source srcset="https://thevaluable.dev/images/2023/fzf-vim/fzf-fullscreen.webp" type="image/webp"/><img width="780" height="520" src="https://thevaluable.dev/images/2023/fzf-vim/fzf-fullscreen.jpg" alt="Using fzf in Vim to search through your mapping"/></picture><p>A last detail which can be quite handy: if you want to open fzf fullscreen, you just need to add a bang <code>!</code> to any Ex command described above. For example:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>:</span><span>Files</span><span>!</span><span>
</span></span></span></code></pre></div><p>Now, fzf is taking the space it deserves.</p><h2 id="global-variables-to-configure-fzf">Global Variables to Configure Fzf</h2><p>Now that we saw the most useful user commands to use fzf in Vim, let’s see how you can customize the integration to suit your needs. The easiest way to do so is to use a couple of global variables, directly available in the native fzf plugin.</p><p>The plugin fzf.vim add more global variables on top of the ones described below, but in general I find them less useful. As a result, I won’t describe them in this article. If you’re curious, you can grab them in <a href="https://github.com/junegunn/fzf.vim#customization" target="_blank" rel="noopener">fzf.vim’s README file</a>.</p><p>These variables will add different options to the fzf shell command running in the background. To see what this fzf shell command looks like, you can run <code>:echo fzf#wrap()</code>. It’s very handy if you need to debug any unexpected behavior.</p><h3 id="history-of-fzf-queries">History of Fzf Queries</h3><p>You can keep a history of all the queries you write when fuzzy-finding using fzf, thanks to the global variable <code>g:fzf_history_dir</code>. For example:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>let</span> <span>g</span>:<span>fzf_history_dir</span> <span>=</span> <span>&#39;~/.config/local/share/fzf-vim-history&#39;</span><span>
</span></span></span></code></pre></div><p>Each time you hit <code>ENTER</code> after typing a fzf query (to fuzzy search and select what you want), the query itself will be added to the history file, located in the filepath defined by <code>g:fzf_history_dir</code>. To go through the history, you can use the two following keystrokes directly in fzf:</p><table><tbody><tr><th>Keystroke</th><th>Description</th></tr><tr><td><code>CTRL-p</code></td><td>Display the previous entry from the history.</td></tr><tr><td><code>CTRL-n</code></td><td>Display the next entry from the history.</td></tr></tbody></table><h3 id="keystrokes-for-fzf-the-actions">Keystrokes for fzf: the Actions</h3><p>We saw that some Ex commands provided by fzf allow us to use some handy keystrokes to do all sorts of things. We can actually overwrite these keystrokes and add new ones if we want to, using the handy global variable <code>g:fzf_action</code>. Its value is a dictionary with the keystrokes as keys and any Ex command they should run as values.</p><p>For example, after running the Ex command <code>:Files</code> (available in fzf.vim), you can open your selected file in a new horizontal split thanks to the keystroke <code>CTRL-x</code>. But what if you want to use <code>CTRL-h</code> instead?</p><p>Here’s what you can add to your Vim’s config to do so. Note that <code>g:fzf_action</code> overwrite all the default keystrokes, so you’ll need to define them again (like <code>ctrl-t</code> or <code>ctrl-v</code> for example):</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>let</span> <span>g</span>:<span>fzf_action</span> <span>=</span> {<span>
</span></span></span><span><span><span></span>  \ <span>&#39;ctrl-t&#39;</span>: <span>&#39;tab split&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;ctrl-h&#39;</span>: <span>&#39;split&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;ctrl-v&#39;</span>: <span>&#39;vsplit&#39;</span> }<span>
</span></span></span></code></pre></div><p>Here’s another example I personally use. It shows that you can also use custom functions, not only Ex commands, to create your actions. Here, the function allow me to select multiple files (after running <code>:Files</code> for example) and then open them in a <a href="https://thevaluable.dev/vim-advanced/#quickfix-lists">quickfix list</a> with <code>CTRL-x</code>:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>&#34; Build a quickfix list when multiple files are selected</span><span>
</span></span></span><span><span><span></span><span>function</span><span>!</span> <span>s</span>:<span>build_quickfix_list</span><span>(</span><span>lines</span><span>)</span><span>
</span></span></span><span><span><span></span>  <span>call</span> <span>setqflist</span><span>(</span><span>map</span><span>(</span><span>copy</span><span>(</span><span>a</span>:<span>lines</span><span>),</span> <span>&#39;{ &#34;filename&#34;: v:val }&#39;</span><span>))</span><span>
</span></span></span><span><span><span></span>  <span>copen</span><span>
</span></span></span><span><span><span></span>  <span>cc</span><span>
</span></span></span><span><span><span></span><span>endfunction</span><span>
</span></span></span><span><span><span>
</span></span></span><span><span><span></span><span>let</span> <span>g</span>:<span>fzf_action</span> <span>=</span> {<span>
</span></span></span><span><span><span></span>  \ <span>&#39;ctrl-x&#39;</span>: <span>function</span><span>(</span><span>&#39;s:build_quickfix_list&#39;</span><span>),</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;ctrl-t&#39;</span>: <span>&#39;tab split&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;ctrl-h&#39;</span>: <span>&#39;split&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;ctrl-v&#39;</span>: <span>&#39;vsplit&#39;</span> }<span>
</span></span></span></code></pre></div><h3 id="customizing-fzf-layout">Customizing fzf Layout</h3><p>What if we want to customize the layout of fzf? We can use the global variable <code>g:fzf_layout</code> to do so. For example:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>let</span> <span>g</span>:<span>fzf_layout</span> <span>=</span> { <span>&#39;window&#39;</span>: { <span>&#39;width&#39;</span>: <span>0</span>.<span>7</span><span>,</span> <span>&#39;height&#39;</span>: <span>0</span>.<span>6</span> } }<span>
</span></span></span></code></pre></div><p>Here, fzf’s window will take 70% of the width of the screen, and 60% of its height. If you want fzf’s window to be relative to the current window, you can set “relative” to true; for example:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>let</span> <span>g</span>:<span>fzf_layout</span> <span>=</span> { <span>&#39;window&#39;</span>: { <span>&#39;width&#39;</span>: <span>0</span>.<span>7</span><span>,</span> <span>&#39;height&#39;</span>: <span>0</span>.<span>6</span><span>,</span> <span>&#39;relative&#39;</span>: <span>v</span>:<span>true</span> } }<span>
</span></span></span></code></pre></div><p>We also saw, <a href="https://thevaluable.dev/fzf-shell-integration/#fzf-and-tmux">in another article</a>, that fzf can use tmux to open a floating window. You can also use it in Vim; for example:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>let</span> <span>g</span>:<span>fzf_layout</span> <span>=</span> { <span>&#39;tmux&#39;</span>: <span>&#39;-p70%,60%&#39;</span> }<span>
</span></span></span></code></pre></div><h3 id="configuring-fzf-highlighting">Configuring fzf Highlighting</h3><p>Configuring the layout is not enough? You want to change the highlighting in fzf to match your wonderful Vim color theme? You can use yet another global variable, <code>g:fzf_colors</code>, to do so:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>let</span> <span>g</span>:<span>fzf_colors</span> <span>=</span><span>
</span></span></span><span><span><span></span>\ { <span>&#39;fg&#39;</span>:      [<span>&#39;fg&#39;</span><span>,</span> <span>&#39;Normal&#39;</span>]<span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;bg&#39;</span>:      [<span>&#39;bg&#39;</span><span>,</span> <span>&#39;Normal&#39;</span>]<span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;hl&#39;</span>:      [<span>&#39;fg&#39;</span><span>,</span> <span>&#39;Search&#39;</span>]<span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;fg+&#39;</span>:     [<span>&#39;fg&#39;</span><span>,</span> <span>&#39;CursorLine&#39;</span><span>,</span> <span>&#39;CursorColumn&#39;</span><span>,</span> <span>&#39;Normal&#39;</span>]<span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;bg+&#39;</span>:     [<span>&#39;bg&#39;</span><span>,</span> <span>&#39;CursorLine&#39;</span><span>,</span> <span>&#39;CursorColumn&#39;</span>]<span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;hl+&#39;</span>:     [<span>&#39;fg&#39;</span><span>,</span> <span>&#39;Visual&#39;</span>]<span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;info&#39;</span>:    [<span>&#39;fg&#39;</span><span>,</span> <span>&#39;PreProc&#39;</span>]<span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;border&#39;</span>:  [<span>&#39;fg&#39;</span><span>,</span> <span>&#39;StatusLineNC&#39;</span>]<span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;prompt&#39;</span>:  [<span>&#39;fg&#39;</span><span>,</span> <span>&#39;Conditional&#39;</span>]<span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;pointer&#39;</span>: [<span>&#39;fg&#39;</span><span>,</span> <span>&#39;Exception&#39;</span>]<span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;marker&#39;</span>:  [<span>&#39;fg&#39;</span><span>,</span> <span>&#39;Keyword&#39;</span>]<span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;spinner&#39;</span>: [<span>&#39;fg&#39;</span><span>,</span> <span>&#39;Label&#39;</span>]<span>,</span><span>
</span></span></span><span><span><span></span>  \ <span>&#39;header&#39;</span>:  [<span>&#39;fg&#39;</span><span>,</span> <span>&#39;Comment&#39;</span>] }<span>
</span></span></span></code></pre></div><p>As you can see, this variable takes a dictionary as value:</p><ul><li>The keys are the elements you want to highlight; they are the same elements you can give to the <code>--color</code> option using fzf in the shell. <a href="https://thevaluable.dev/practical-guide-fzf-example/#colors-but-for-what">Here’s a handy list</a> of these elements.</li><li>The values are Vim highlight groups.</li></ul><p>Let’s take an example from above to understand how it works:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>&#39;fg+&#39;</span>:     [<span>&#39;fg&#39;</span><span>,</span> <span>&#39;CursorLine&#39;</span><span>,</span> <span>&#39;CursorColumn&#39;</span><span>,</span> <span>&#39;Normal&#39;</span>]<span>,</span><span>
</span></span></span></code></pre></div><p>Vim will highlight the text of the current line (<code>fg+</code>) with the given highlight group (<code>CursorLine</code>). If this highlight group doesn’t exist, it will try to reach the second one (<code>CursorColumn</code>) and so on, until there are no highlight groups left; in that case, it will use a default color.</p><h2 id="the-basic-functions-for-fzf-integration">The Basic Functions for fzf Integration</h2><p>We saw, at the beginning of this article, that fzf.vim defines some user commands you can directly use (like <code>:Files</code> or <code>:Rg</code>) to search and edit the files we want. We can also create new user commands, or even overwrite the existing ones.</p><h3 id="using-the-run-and-wrap-functions">Using the Run and Wrap Functions</h3><p>There are two low level functions you can use to define your own user commands: <code>fzf#run</code> and <code>fzf#wrap</code>. Actually, <code>fzf#wrap</code> is not mandatory, but recommended. They are both defined in the native fzf plugin for Vim, so you don’t need fzf.vim to use them.</p><p>Both <code>fzf#run</code> and <code>fzf#wrap</code> accept a dictionary as argument. Here are the most useful keys you can use:</p><table><tbody><tr><th>Key</th><th>Description</th><th>Default</th></tr><tr><td><code>sink</code></td><td>The Ex command executed after selecting some entries.</td><td><code>:edit</code></td></tr><tr><td><code>source</code></td><td>The shell command piped to fzf.</td><td><code>FZF_DEFAULT_COMMAND</code> (or fzf’s defaults if not initialized).</td></tr><tr><td><code>options</code></td><td>The different options given to fzf.</td><td><code>FZF_DEFAULT_OPTS</code> (or fzf’s defaults if not initialized).</td></tr></tbody></table><p>Here’s one of the simplest example we can run:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>:</span><span>call</span> <span>fzf</span>#<span>run</span><span>(</span><span>fzf</span>#<span>wrap</span><span>())</span><span>
</span></span></span></code></pre></div><p>If you run the Ex command above, all the default values will be used:</p><ol><li>The value of the environment variable <code>FZF_DEFAULT_COMMAND</code> will be piped to fzf under the hood, to create the list of files given to fzf.</li><li>The options defined in the environment variable <code>FZF_DEFAULT_OPTS</code> will be given to fzf.</li><li>Every entry you’ve selected in fzf will be added as argument to the Ex command <code>:edit</code>.</li></ol><p>If you don’t want to use <code>FZF_DEFAULT_COMMAND</code> (or fzf’s defaults) to create your entries, you can add a source as follows:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>:</span><span>call</span> <span>fzf</span>#<span>run</span><span>(</span><span>fzf</span>#<span>wrap</span><span>(</span>{<span>&#39;source&#39;</span>: <span>&#39;fd --hidden .&#39;</span>}<span>))</span><span>
</span></span></span></code></pre></div><p>You need the CLI <a href="https://github.com/sharkdp/fd" target="_blank" rel="noopener">fd</a> installed on your system for the above command to work properly.</p><p>You can also add some options to fzf:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>call</span> <span>fzf</span>#<span>run</span><span>(</span><span>fzf</span>#<span>wrap</span><span>(</span>{<span>
</span></span></span><span><span><span></span>    \ <span>&#39;source&#39;</span>: <span>&#39;fd --hidden .&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>    \ <span>&#39;sink&#39;</span>: <span>&#39;edit&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>    \ <span>&#39;options&#39;</span>: [<span>&#39;--multi&#39;</span><span>,</span> <span>&#39;--pointer&#39;</span><span>,</span> <span>&#39;→&#39;</span><span>,</span> <span>&#39;--marker&#39;</span><span>,</span> <span>&#39;♡&#39;</span><span>,</span> <span>&#39;--preview&#39;</span><span>,</span> <span>&#39;cat {}&#39;</span>]<span>
</span></span></span><span><span><span></span>    \ }<span>))</span><span>
</span></span></span></code></pre></div><p>This is more or less equivalent to the following shell command:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>fd</span> <span>--</span><span>hidden</span> <span>|</span> <span>fzf</span> <span>--</span><span>multi</span> <span>--</span><span>pointer</span><span>=</span><span>&#39;→&#39;</span> <span>--</span><span>marker</span><span>=</span><span>&#39;♡&#39;</span> <span>--</span><span>preview</span><span>=</span><span>&#39;cat {}&#39;</span><span>
</span></span></span></code></pre></div><p>From there, it’s not difficult to create your own <a href="https://thevaluable.dev/vim-expert/#user-commands" target="_blank" rel="noopener">user command</a> using these functions, and then create a keystroke you could use in NORMAL mode. For example:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>command</span><span>!</span> <span>MyFiles</span> <span>call</span> <span>fzf</span>#<span>run</span><span>(</span><span>fzf</span>#<span>wrap</span><span>(</span>{<span>
</span></span></span><span><span><span></span>    \ <span>&#39;source&#39;</span>: <span>&#39;fd --hidden .&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>    \ <span>&#39;sink&#39;</span>: <span>&#39;edit&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>    \ <span>&#39;options&#39;</span>: [<span>&#39;--multi&#39;</span><span>,</span> <span>&#39;--pointer&#39;</span><span>,</span> <span>&#39;→&#39;</span><span>,</span> <span>&#39;--marker&#39;</span><span>,</span> <span>&#39;♡&#39;</span><span>,</span> <span>&#39;--preview&#39;</span><span>,</span> <span>&#39;cat {}&#39;</span>]<span>
</span></span></span><span><span><span></span>    \ }<span>))</span><span>
</span></span></span><span><span><span>
</span></span></span><span><span><span></span><span>nnoremap</span> <span>&lt;</span><span>leader</span><span>&gt;</span><span>a</span> :<span>MyFiles</span><span>&lt;</span><span>cr</span><span>&gt;</span><span>
</span></span></span></code></pre></div><p>You can also add two more arguments to the <code>fzf#wrap</code> function: a first one to specify the filename to use if you want to keep a history of your queries (it won’t have any effect if you don’t define <code>g:fzf_history_dir</code> beforehand), and a last one to specify if the fzf’s window should be fullscreen. For example:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>let</span> <span>g</span>:<span>fzf_history_dir</span> <span>=</span> <span>&#39;~/.config/local/share/fzf-vim-history&#39;</span><span>
</span></span></span><span><span><span></span><span>command</span><span>!</span> <span>MyFiles</span> <span>call</span> <span>fzf</span>#<span>run</span><span>(</span><span>fzf</span>#<span>wrap</span><span>(</span><span>&#39;my_files_history&#39;</span><span>,</span> {<span>
</span></span></span><span><span><span></span>    \ <span>&#39;source&#39;</span>: <span>&#39;fd --hidden .&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>    \ <span>&#39;sink&#39;</span>: <span>&#39;edit&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>    \ <span>&#39;options&#39;</span>: [<span>&#39;--multi&#39;</span><span>,</span> <span>&#39;--pointer&#39;</span><span>,</span> <span>&#39;→&#39;</span><span>,</span> <span>&#39;--marker&#39;</span><span>,</span> <span>&#39;♡&#39;</span><span>,</span> <span>&#39;--preview&#39;</span><span>,</span> <span>&#39;cat {}&#39;</span>]<span>
</span></span></span><span><span><span></span>    \ }<span>,</span> <span>1</span><span>))</span><span>
</span></span></span></code></pre></div><p>In that case, your history file for your fzf queries will be <code>~/.config/local/share/fzf-vim-history/my_files_history</code>, and fzf’s window will always be fullscreen.</p><p>What if we want to copy the behavior of the default Ex commands defined in fzf.vim, and only display fzf’s window fullscreen if there is a bang added to the command? We can add the <code>-bang</code> option to the Ex command <code>:command</code> to do so:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>command</span><span>!</span> <span>-</span><span>bang</span> <span>MyFiles</span> <span>call</span> <span>fzf</span>#<span>run</span><span>(</span><span>fzf</span>#<span>wrap</span><span>(</span>{<span>
</span></span></span><span><span><span></span>    \ <span>&#39;source&#39;</span>: <span>&#39;fd --hidden .&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>    \ <span>&#39;sink&#39;</span>: <span>&#39;edit&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>    \ <span>&#39;options&#39;</span>: [<span>&#39;--multi&#39;</span><span>,</span> <span>&#39;--pointer&#39;</span><span>,</span> <span>&#39;→&#39;</span><span>,</span> <span>&#39;--marker&#39;</span><span>,</span> <span>&#39;♡&#39;</span><span>,</span> <span>&#39;--preview&#39;</span><span>,</span> <span>&#39;cat {}&#39;</span>]<span>
</span></span></span><span><span><span></span>    \ }<span>,</span> <span>&lt;</span><span>bang</span><span>&gt;</span><span>0</span><span>))</span><span>
</span></span></span></code></pre></div><p>Now, the Ex command <code>:MyFile!</code> will display fzf’s window fullscreen.</p><p>As we already saw, these two functions <code>fzf#run</code> and <code>fzf#wrap</code> are defined in <a href="https://github.com/junegunn/fzf/blob/master/plugin/fzf.vim" target="_blank" rel="noopener">in the native fzf plugin</a>. You could only source this file, create the user commands which are most useful for you, and skip entirely the plugin fzf.vim.</p><p>But it’s the theory. In practice, it can be quite challenging to implement <code>:Rg</code> for example. We could think of something like that:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>command</span><span>!</span> <span>-</span><span>bang</span> <span>-</span><span>nargs</span><span>=</span>* <span>Rg</span> <span>call</span> <span>fzf</span>#<span>run</span><span>(</span><span>fzf</span>#<span>wrap</span><span>(</span>{<span>
</span></span></span><span><span><span></span>    \ <span>&#39;source&#39;</span>: <span>&#39;rg --column --line-number --no-heading --glob=&#34;!.git/*&#34; &#39;</span>.<span>shellescape</span><span>(&lt;</span><span>q</span><span>-</span><span>args</span><span>&gt;),</span><span>
</span></span></span><span><span><span></span>    \ <span>&#39;sink&#39;</span>: <span>&#39;edit&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>    \ <span>&#39;options&#39;</span>: [<span>
</span></span></span><span><span><span></span>                \ <span>&#39;--multi&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>                \ <span>&#39;--pointer&#39;</span><span>,</span> <span>&#39;→&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>                \ <span>&#39;--marker&#39;</span><span>,</span> <span>&#39;♡&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>                \ <span>&#39;--preview&#39;</span><span>,</span> <span>&#39;cat {}&#39;</span><span>,</span><span>
</span></span></span><span><span><span></span>                \ <span>&#39;--preview-window&#39;</span><span>,</span> <span>&#39;50%,border-double,right&#39;</span>]<span>
</span></span></span><span><span><span></span>    \ }<span>,</span><span>
</span></span></span><span><span><span></span>    \ <span>&lt;</span><span>bang</span><span>&gt;</span><span>0</span><span>))</span><span>
</span></span></span></code></pre></div><p>Here’s the result:</p><picture><source srcset="https://thevaluable.dev/images/2023/fzf-vim/fzf-vim-run-wrap.webp" type="image/webp"/><img width="780" height="520" src="https://thevaluable.dev/images/2023/fzf-vim/fzf-vim-run-wrap.jpg" alt="Using fzf in vim with the run and wrap functions"/></picture><p>As you can see, it doesn’t really work as expected. Here, fzf tries to add the current entry to the command <code>cat</code> to display the preview, including the filename <em>and</em> the pattern matched by ripgrep. This glob of information doesn’t match any filepath on my filesystem, that’s why the <code>cat</code> command fails, and the preview breaks.</p><p>Even worse: if I try to edit a file, this glob of information would be given to <code>:edit</code>, and, as a result, it wouldn’t work either.</p><p>It’s better to use the higher level functions offered by fzf.vim to define more complex user commands. These functions use <code>fzf#run</code> and <code>fzf#wrap</code> under the hood.</p><h3 id="using-the-functions-from-fzfvim">Using the Functions from fzf.vim</h3><p>If you look in the GitHub repository of fzf.vim, you’ll find <a href="https://github.com/junegunn/fzf.vim/blob/master/plugin/fzf.vim" target="_blank" rel="noopener">a file defining higher level functions</a> we can use as examples to define our own.</p><p>For example, you can see that the command <code>:Rg</code> call the function <code>fzf#vim#grep</code> as follows:</p><div><pre tabindex="0"><code data-lang="vim"><span><span><span>command</span><span>!</span> <span>-</span><span>bang</span> <span>-</span><span>nargs</span><span>=</span>* <span>Rg</span> <span>call</span> <span>fzf</span>#<span>vim</span>#<span>grep</span><span>(</span><span>&#34;rg --column --line-number --no-heading --color=always --smart-case -- &#34;</span>.<span>fzf</span>#<span>shellescape</span><span>(&lt;</span><span>q</span><span>-</span><span>args</span><span>&gt;),</span> <span>fzf</span>#<span>vim</span>#<span>with_preview</span><span>(),</span> <span>&lt;</span><span>bang</span><span>&gt;</span><span>0</span><span>)</span><span>
</span></span></span></code></pre></div><p>This looks a lot like the user command we tried to create in the previous section. But here you don’t have to parse the different entries to isolate the filenames from the pattern matched. The function <code>fzf#vim#grep</code> does that for you.</p><p>For example, here’s a user command I use every day, directly overwriting the <code>:Rg</code> Ex command from fzf.vim:</p><div><pre tabindex="0"><code data-lang="vim"><span><span># <span>Overwrite</span> :<span>Rg</span> <span>from</span> <span>fzf</span>.<span>vim</span><span>
</span></span></span><span><span><span></span># <span>Hit</span> <span>&#39;?&#39;</span> <span>to</span> <span>toggle</span> <span>the</span> <span>preview</span><span>
</span></span></span><span><span><span></span><span>command</span><span>!</span> <span>-</span><span>bang</span> <span>-</span><span>nargs</span><span>=</span>* <span>Rg</span> <span>call</span> <span>fzf</span>#<span>vim</span>#<span>grep</span><span>(</span><span>
</span></span></span><span><span><span></span>  \   &#39;<span>rg</span><span>
</span></span></span><span><span><span></span>        \ <span>--</span><span>column</span><span>
</span></span></span><span><span><span></span>        \ <span>--</span><span>line</span><span>-</span><span>number</span><span>
</span></span></span><span><span><span></span>        \ <span>--</span><span>no</span><span>-</span><span>heading</span><span>
</span></span></span><span><span><span></span>        \ <span>--</span><span>fixed</span><span>-</span><span>strings</span><span>
</span></span></span><span><span><span></span>        \ <span>--</span><span>ignore</span><span>-</span><span>case</span><span>
</span></span></span><span><span><span></span>        \ <span>--</span><span>hidden</span><span>
</span></span></span><span><span><span></span>        \ <span>--</span><span>follow</span><span>
</span></span></span><span><span><span></span>        \ <span>--</span><span>glob</span> <span>&#34;!.git/*&#34;</span><span>
</span></span></span><span><span><span></span>        \ <span>--</span><span>color</span> <span>&#34;always&#34;</span> &#39;.<span>shellescape</span><span>(&lt;</span><span>q</span><span>-</span><span>args</span><span>&gt;),</span><span>
</span></span></span><span><span><span></span>  \   <span>fzf</span>#<span>vim</span>#<span>with_preview</span><span>(</span><span>&#39;right:50%:hidden&#39;</span><span>,</span> <span>&#39;?&#39;</span><span>),</span><span>
</span></span></span><span><span><span></span>  \   <span>&lt;</span><span>bang</span><span>&gt;</span><span>0</span><span>)</span><span>
</span></span></span></code></pre></div><p>If your curious about the implementation of all these higher level functions, you can look at the file <a href="https://github.com/junegunn/fzf.vim/blob/master/autoload/fzf/vim.vim" target="_blank" rel="noopener">vim.vim</a> from the plugin itself.</p><h2 id="alternative-plugins">Alternative plugins</h2><p>Finally, let’s finish this article with two more plugins specifically targeting Neovim users. I know that many people only want Lua in their config; these plugins, in that case, will be of interest for you:</p><ul><li><a href="https://github.com/vijaymarupudi/nvim-fzf" target="_blank" rel="noopener">nvim-fzf</a></li><li><a href="https://github.com/ibhagwan/fzf-lua" target="_blank" rel="noopener">fzf-lua</a></li></ul><p>The second plugin is built on top of the first one, a bit like fzf.vim is built on top of the native fzf plugin.</p><h2 id="the-fusion-between-vim-and-fzf">The Fusion Between Vim and fzf</h2><p>Vim is a really powerful tool by itself, offering many functionalities without the need of any plugin. But it’s also true that a tool like fzf can improve Vim significantly, offering a more comfortable way to go through your files and lists.</p><p>Here’s a summary of the main ideas of this article:</p><ul><li>There are two plugins allowing us to use fzf in Vim: the <a href="https://github.com/junegunn/fzf/blob/master/plugin/fzf.vim" target="_blank" rel="noopener">native fzf plugin</a> directly installed with fzf, and <a href="https://github.com/junegunn/fzf.vim" target="_blank" rel="noopener">fzf.vim</a>. The second plugin is built on the first one.</li><li>The plugin fzf.vim offers many user commands to search through your filenames, or directly parsing the content of your files.</li><li>You can also search through other lists using fzf: your search or Ex command history, or even your mapping for example.</li><li>Many global variables can be used to easily configure fzf. The most interesting ones are defined in the native fzf plugin.</li><li>You can write your own user functions only using the native fzf plugin for Vim, or, to make the implementation easier, by using higher level functions offered by fzf.vim.</li><li>There are a couple of alternative plugins if you use Neovim, allowing you to configure them in Lua.</li></ul><p>If you know any more way to use fzf in Vim, don’t hesitate to let a comment! It could help more people than you think.</p><div><p>Related Sources</p><ul><li><a href="https://github.com/junegunn/fzf/blob/master/README-VIM.md" target="_blank" rel="noopener">Documentation for the native fzf plugin</a></li><li><a href="https://github.com/junegunn/fzf.vim" target="_blank" rel="noopener">Documentation for fzf.vim</a></li></ul></div></section></article></div></div>
  </body>
</html>
