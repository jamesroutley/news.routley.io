<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mitchellh.com/writing/zig-builds-getting-faster">Original</a>
    <h1>Zig builds are getting faster</h1>
    
    <div id="readability-page-1" class="page"><div><p>Andrew Kelley famously (or infamously, depending on your views) said
&#34;the compiler is too damn slow, that&#39;s why we have bugs.&#34;<sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
<p>As a result, one of the primary stated goals of <a target="_blank" rel="noopener noreferrer" href="https://ziglang.org">Zig</a> for
years has been faster compile times. The Zig team has been working on
extremely hard problems to make this a reality
(such as <a target="_blank" rel="noopener noreferrer" href="https://github.com/ziglang/zig/issues/16270">yeeting LLVM</a>,
writing their own <a target="_blank" rel="noopener noreferrer" href="https://ziglang.org/download/0.15.1/release-notes.html#Compiler">code generation backends</a>,
building their own <a target="_blank" rel="noopener noreferrer" href="https://github.com/ziglang/zig/pull/25299">linkers</a>,
and marching towards <a target="_blank" rel="noopener noreferrer" href="https://ziglang.org/download/0.15.1/release-notes.html#Incremental-Compilation">incremental compilation</a> in general).<sup><a href="#user-content-fn-2" id="user-content-fnref-2" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup></p>
<p>The fruits of this multi-year labor are finally starting to show
with Zig 0.15.1. The <a target="_blank" rel="noopener noreferrer" href="https://ghostty.org">Ghostty</a> project just completed upgrading to
Zig 0.15.1, and I&#39;d like to share some real-world build times.<sup><a href="#user-content-fn-3" id="user-content-fnref-3" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup></p>
<hr/>
<h2 id="build-script-compilation"><a href="#build-script-compilation" aria-hidden="true" tabindex="-1"><span></span></a>Build Script Compilation</h2>
<ul>
<li>Zig 0.14: 7sec 167ms</li>
<li>Zig 0.15: 1sec 702ms</li>
</ul>
<p>This is the time it takes to build the <code>build.zig</code> script itself. The
times above were measured by running <code>zig build --help</code>.</p>
<p>A well-written build script should only rebuild itself rarely. However,
this is a cost every new uncached source build will pay (e.g. a user
downloading the project to build from source one time). As such, it directly
impacts the time to build a usable binary.</p>
<hr/>
<h2 id="full-uncached-ghostty-binary"><a href="#full-uncached-ghostty-binary" aria-hidden="true" tabindex="-1"><span></span></a>Full Uncached Ghostty Binary</h2>
<ul>
<li>Zig 0.14: 41sec</li>
<li>Zig 0.15: 32sec</li>
</ul>
<p>This includes the time to build the build script itself. Given the prior
results, Zig 0.15 is building everything else ~2 seconds faster. But, you
can still see in wall time the change in this initial build time.</p>
<div><p><strong>Important: most of this is still using LLVM.</strong> Ghostty still can&#39;t fully build and link using
the self-hosted x86_64 backend, since the backend still has bugs. So, this just shows the general
improvements in the Zig compiler itself, even with LLVM in the picture.</p></div>
<p>Once Ghostty can use the self-hosted x86_64 backend completely, I expect
this time to plummet to around 25 seconds or less, fully half the time it
would take with Zig 0.14.</p>
<hr/>
<h2 id="incremental-build-ghostty-executable"><a href="#incremental-build-ghostty-executable" aria-hidden="true" tabindex="-1"><span></span></a>Incremental Build (Ghostty Executable)</h2>
<ul>
<li>Zig 0.14: 19sec</li>
<li>Zig 0.15: 16sec</li>
</ul>
<p>This is the time it takes to rebuild Ghostty after a one-line change to
the most core terminal emulation code (adding a log function call to the
escape sequence parser).</p>
<p>This build has a fully cached build script and dependency graph, so it
is only rebuilding what it needs to. Incremental compilation in Zig isn&#39;t
functional yet, so this still recompiles a considerable amount of code.
Additionally, as with the prior section, <strong>this is still using LLVM</strong>.
By simply dropping LLVM out of the picture, I expect this time to drop to
around 12 seconds or so (less the time LLVM is emitting).</p>
<p>Going further, once Zig supports incremental compilation, I expect
we&#39;ll be able to measure incremental builds like this within milliseconds
at worst. But, let&#39;s wait and see when that is reality.</p>
<hr/>
<h2 id="incremental-build-libghostty-vt"><a href="#incremental-build-libghostty-vt" aria-hidden="true" tabindex="-1"><span></span></a>Incremental Build (libghostty-vt)</h2>
<ul>
<li>Zig 0.14: 2sec 884ms</li>
<li>Zig 0.15: 975ms</li>
</ul>
<p>This is the time it takes to rebuild only <a href="https://mitchellh.com/writing/libghostty-is-coming">libghostty-vt</a>
after a one-line change. Unlike the Ghostty executable, <code>libghostty-vt</code>
is fully functional with the self-hosted x86_64 backend, so this
shows the differences in build times without LLVM in the picture.</p>
<p>Similar to the Ghostty executable, this is still rebuilding the full
Zig module for <code>libghostty-vt</code>, since incremental compilation isn&#39;t
fully functional yet. I expect this to also drop to single-digit milliseconds
at worst once incremental compilation is a reality.</p>
<p>But still, a sub-second build time for a non-trivial library is <em>amazing</em>.
This is the library I&#39;m spending most of my time working on right now,
and even in a few short days since upgrading to Zig 0.15.1, I&#39;ve felt
a huge difference in my workflow. Previously, I might tab out to read an
email between builds or tests, but now its so fast I can stay in flow
in my terminal.</p>
<p><strong>This improvement is most indicative of what&#39;s to come in the short term.</strong>
The self-hosted x86_64 backend is already stable enough to build all debug
builds by default and the aarch64 backend is getting there, too. We aren&#39;t
able to build the full Ghostty executable yet, but I bet this will get
ironed out within months.</p>
<hr/>
<h2 id="faster-builds-are-here"><a href="#faster-builds-are-here" aria-hidden="true" tabindex="-1"><span></span></a>Faster Builds Are Here</h2>
<p>As you can see, building Ghostty with Zig 0.15.1 is faster in every single
scenario, despite the fact that a lot of Ghostty still can&#39;t even take
advantage of the self-hosted backend! And despite the fact that incremental
compilation isn&#39;t functional yet!</p>
<p>I&#39;ve loved betting on Zig for Ghostty, and I love that they&#39;re focusing
on compile times. These improvements are real, and they&#39;re here now. And
I suspect in the next couple years, the results posted today will look
downright slow. ðŸ˜œ</p>
</div></div>
  </body>
</html>
