<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://baak6.com/baikal-openbsd-fossdroid/">Original</a>
    <h1>Own Your Calendar and Contacts with OpenBSD, Baïkal, and FOSS Android</h1>
    
    <div id="readability-page-1" class="page"><div>


<p>In this tutorial I explain how I use Baïkal running on OpenBSD to host my own
calendar and address book, and how to consume them with FOSS apps on Android.</p>

<p>Feel free to skip the introduction if you just want to dive straight into the
tutorial, it&#39;s just there to provide context for those who are new to these
topics.</p>

<h2 id="Introduction">Introduction</h2>

<p>Before I got back into self hosting, I was using Hey as an email provider. They
do not provide a calendar, so I was still using Google calendar. To get away
from Google, I just wanted a service that would just host my calendar for me,
nothing else.</p>

<p>Now this was a while ago, but at least back then there were just no sane
options. There was a plethora of bloated calendar products and startups,
but none of them just offered a simple hosted calendar, incredible. Maybe I was
looking for the wrong things?</p>

<p>The only other thing I found were email services that also provide a calendar,
but I only wanted a calendar.</p>

<p>Now that I&#39;m self hosting again, I thought surely this is a solved problem
without having to run NextCloud or get a calendar as a module of some big and
complex software. Enter <a href="https://sabre.io/baikal/">Baïkal</a>.</p>

<h3 id="What%20is%20Ba%C3%AFkal?">What is Baïkal?</h3>

<p>Baïkal is a lightweight CalDAV+CardDAV server. It&#39;s written in PHP and uses
MySQL or SQLite as a database.</p>

<p>Baïkal is a great example of a small and simple piece of software which does
one thing and does it well. Well, it does two things, but it does them both
really well.</p>

<p>What it boils down to is that we can self host a Baïkal server that allows you
to manage calendars and address books using CalDAV and CardDAV via HTTP.</p>

<h4 id="What%20are%20CalDAV%20and%20CardDAV?">What are CalDAV and CardDAV?</h4>

<p><a href="https://en.wikipedia.org/wiki/CalDAV">CalDAV</a> is an internet standard used to
represent and communicate calendar data. <a href="https://en.wikipedia.org/wiki/CardDAV">CardDAV</a>
is the same thing but for contacts.</p>

<p>CalDAV and CardDAV are both implemented on top of WebDAV (Web Distributed
Authoring and Versioning) which itself is an extension of HTTP. I&#39;m not going
to get into more details about this in this post as it&#39;s not really relevant.</p>

<h3 id="Why%20OpenBSD?">Why OpenBSD?</h3>

<p>In case you&#39;ve not been exposed to <a href="https://www.openbsd.org/index.html">OpenBSD</a>
before, it&#39;s an operating system focused on security and correctness, amongst
other things.</p>

<p>It provides a really simple, batteries included way to host something like
Baïkal. I run my OpenBSD machines on Vultr (<a href="https://www.vultr.com/?ref=9119489">affiliate link</a>,
<a href="https://www.vultr.com">non-affiliate link</a>). They make it super easy to spin
up a VPS with OpenBSD and the prices are great.</p>

<h3 id="FOSS%20Android?">FOSS Android?</h3>

<p>By FOSS Android I just mean a free (as in freedom (and beer in this case)) and
open source software calendar and contacts applications for Android. I use the
ones from <a href="https://simplemobiletools.com/">Simple Mobile Tools</a>, they are
really good, but more on this later.</p>

<p>If you&#39;re on iOS, you can still follow this tutorial and skip the Android
specific steps. As for iOS calendar applications, I guess you can use the built
in one, I&#39;m not sure what FOSS calendar applications are available for iOS.</p>

<h2 id="Tutorial">Tutorial</h2>

<p>We&#39;ll start by getting an OpenBSD VPS up and running, then we&#39;ll install and
configure Baïkal on it. Once everything is up and running we&#39;ll install and
configure Android applications to talk to our server.</p>

<h3 id="Setting%20up%20OpenBSD">Setting up OpenBSD</h3>

<p>I&#39;ll be starting from a clean install of OpenBSD. I get there by deploying a
new VPS on Vultr, but it should be the same as installing one yourself.</p>

<p>OpenBSD has pretty sane defaults, so I&#39;m not going to be making any
configuration changes. Create a user for yourself and setup credentials to SSH
to the server, then things are good to go to install Baïkal.</p>

<h3 id="Setting%20up%20Ba%C3%AFkal">Setting up Baïkal</h3>

<p>Start by install Baïkal:</p>

<pre><code>pkg_add baikal
</code></pre>

<p>Before configuring Baïkal, you probably want to sort out an SSL certificate for
your web server. It&#39;s very quick and painless to do, the <a href="https://www.openbsdhandbook.com/services/webserver/ssl/">OpenBSD Handbook</a>
has great documentation for this.</p>

<p>Next, let&#39;s setup httpd to point to Baïkal. Thankfully the OpenBSD README for
Baïkal has all the steps needed for setup. Here&#39;s what my <code>httpd.conf</code> looks
like:</p>

<pre><code>server &#34;calendar.baak6.com&#34; {
        listen on * tls port 443

        tls {
                certificate &#34;/etc/ssl/calendar.baak6.com.fullchain.pem&#34;
                key &#34;/etc/ssl/private/calendar.baak6.com.key&#34;
        }

        location &#34;/.well-known/ca*dav&#34; {
                block return 301 &#34;http://calendar.baak6.com/baikal/dav.php&#34;
        }

        location &#34;/baikal/*.php*&#34; {
                root &#34;/baikal/html&#34;
                request strip 1
                fastcgi socket &#34;/run/php-fpm.sock&#34;
                directory index index.php
        }

        location &#34;/baikal/*&#34; {
                root &#34;/baikal/html&#34;
                request strip 1
                directory index index.php
        }
}

server &#34;calendar.baak6.com&#34; {
        listen on * port 80
        location &#34;/.well-known/acme-challenge/*&#34; {
                root &#34;/acme&#34;
                request strip 2
        }
}

</code></pre>

<p>The first server block makes Baïkal available at
<code>https://calendar.baak6.com/baikal/</code> (made up URL for this tutorial) via HTTPS
and the second server block just redirects any non-HTTPS traffic to HTTPS.</p>

<p>Next up you have the choice between MySQL and SQLite. I use SQLite since it is
a lot simpler and suitable for my needs. Install the PHP module for SQLite,
when it asks for a version, pick the one that matches your PHP version.</p>

<pre><code>pkg_add php-pdo_sqlite
</code></pre>

<p>Next up we need to enable SQLite in PHP. Open up <code>/etc/php-8.0.ini</code> and
uncomment (remove the <code>;</code>) the following line:</p>

<pre><code>;extension=pdo_sqlite
</code></pre>

<p>Now enable and start PHP and httpd:</p>

<pre><code>rcctl enable php80_fpm
rcctl start php80_fpm
rcctl enable httpd
rcctl start httpd
</code></pre>

<p>Now you should be able to navigate to
<code>https://calendar.baak6.com/baikal/admin/</code> (replace with your server&#39;s hostname
of course) and complete the setup, create an account, etc.</p>

<p>I have an admin account for managing the server and a separate user account for
myself. Once you&#39;ve created a user account for yourself in Baïkal you can start
using managing your calendar and contacts with a client. I&#39;ll demonstrate how
to do this with FOSS Android applications.</p>

<h3 id="Setting%20up%20Android">Setting up Android</h3>

<p>In this section we&#39;ll go through installing and setting up Simple Calendar and
Simple Contacts, and having them use your Baïkal server using <a href="https://www.davx5.com/">DAVx⁵</a>.</p>

<p>I use <a href="https://f-droid.org/">F-Droid</a> to install these applications, but you
might be able to find them on other platforms.</p>

<h4 id="Setting%20up%20DAVx%E2%81%B5">Setting up DAVx⁵</h4>

<p>On Android the OS normally takes care of abstracting things like calendar and
contacts from your applications. This is done under <code>Passwords &amp; Accounts</code> in
settings and depending on your device and what applications you have, certain
platforms will be available, like Google, Facebook, etc.</p>

<p>To make our Baïkal server available, we need to install DAVx⁵ and point it to
our server. It will make the calendars and contacts on whatever you point it to
available on your phone, that&#39;s all it does.</p>

<p>So head to F-Droid and find <a href="https://f-droid.org/en/packages/at.bitfire.davdroid/">DAVx⁵</a>,
then install it.</p>

<p>Once it&#39;s installed, open it up and add an account. Select <code>Login with URL and
user name</code>, then put in your username and password.</p>

<p>For the base URL, put in <code>https://calendar.baak6.com/baikal/dav.php/</code>,
replacing the hostname with your server of course.</p>

<p>Once you authenticate, you should see your calendars under the <code>CALDAV</code> tab and
your address books under <code>CARDDAV</code>. There you can choose which ones to enable,
if you created multiple, and you can also create, delete, and update them.</p>

<p>In case you run into trouble with URLs in this step (I recall that happening to
me), here are example URLs for a calendar and address book on my setup. My
calendar is just called <code>calendar</code> and my address book is called <code>contacts</code>.</p>

<pre><code>https://calendar.baak6.com/baikal/dav.php/calendars/baak6/calendar
https://calendar.baak6.com/baikal/dav.php/addressbooks/baak6/contacts
</code></pre>

<p>Now calendars and contacts from your Baïkal server should be available on your
Android device.</p>

<h4 id="Using%20Simple%20Calendar%20&amp;#38;%20Simple%20contacts">Using Simple Calendar &amp; Simple contacts</h4>

<p>Go back to F-Droid and install <a href="https://f-droid.org/en/packages/com.simplemobiletools.contacts.pro/">Simple Contacts</a> and <a href="https://f-droid.org/en/packages/com.simplemobiletools.calendar.pro/">Simple Calendar</a>.</p>

<p>Then open them up and your calendar events and address book contacts should be
visible to you.</p>

<p>Now your setup is complete, start using your new calendar and address book. I
manually migrated my data over, I&#39;ll leave it up to you to figure that part
out.</p>

<p>But, before you leave, setup a backup process for your server. At least back up
the SQLite database regularly if nothing else.</p>

<h2 id="Conclusion">Conclusion</h2>

<p>In this tutorial we went through setting up Baïkal on OpenBSD, configuring
DAVx⁵ to connect to Baïkal and using Simple Contacts and Simple Calendar to
view your address books and calendars.</p>

<p>Now you have full control over your calendar and address book data and a fully
end to end open source experience (assuming you run a FOSS Android based OS).</p>
</div></div>
  </body>
</html>
