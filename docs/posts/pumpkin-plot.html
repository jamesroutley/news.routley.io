<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://alex-hhh.github.io/2022/10/pumpkin-plot.html">Original</a>
    <h1>Pumpkin Plot</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div>

        <!-- Main column -->
        <!-- NOTE: there is a bug in the web server template renderer which
             indents all items inside if blocks.  This means that we cannot
             put the contents inside an if block, as all the <pre> tags will
             be indented.
          -->
        <div id="content">





          <article>
  <header>
    
    <p>
<time datetime="2022-10-16" pubdate="true">2022-10-16</time> :: <span><a href="https://alex-hhh.github.io/tags/racket.html">racket</a>, <a href="https://alex-hhh.github.io/tags/data-visualization.html">data visualization</a></span></p>
  </header>

<p>Inspired by the <a href="https://github.com/zappo2/digital-art-with-matlab">Digital Arts with MATLAB</a> project, I wanted to check out if the <a href="https://docs.racket-lang.org/plot/index.html">Racket 3D Plot</a> package could be used for a similar purpose, so I decided to plot a pumpkin…</p>
<!-- more-->

<p>… and here is the result:</p>

<div><p><img src="https://alex-hhh.github.io/img/a057/screenshot.png" alt=""/></p></div>

<p>This blog post will show a step-by-step guide on how this plot was build, but, before we begin, let’s load the required libraries: we’ll use the <a href="https://docs.racket-lang.org/plot/index.html">plot</a> library for plotting and the <a href="https://docs.racket-lang.org/pict/index.html">pict</a> library for adding some nice labels to the plots:</p>



<p>There are also a few plot parameters that are useful for this project, these parameters control how the plot looks: how many samples to use for 3D rendering, the width and height of the plot, as well as clearing the labels on the X, Y and Z axes:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      <div>
       <pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span></pre></div></td>
     <td>
      <div>
       <pre><span></span><span>;; open plots in a separate window instead of the REPL</span><span></span>
<span>(</span><span>plot-new-window?</span><span> </span><span>#f</span><span>)</span><span></span>
<span>;; Number of samples for 3D plots </span><span></span>
<span>;; higher values look better, but slower rendering</span><span></span>
<span>(</span><span>plot3d-samples</span><span> </span><span>50</span><span>)</span><span></span>
<span>;; The width and height (in pixels) of the plot</span><span></span>
<span>(</span><span>plot-width</span><span> </span><span>300</span><span>)</span><span></span>
<span>(</span><span>plot-height</span><span> </span><span>300</span><span>)</span><span></span>
<span>;; Clear the labels of the X, Y and Z axes</span><span></span>
<span>;; since they are not meaningfull for a pumpkin</span><span></span>
<span>(</span><span>plot-x-label</span><span> </span><span>#f</span><span>)</span><span></span>
<span>(</span><span>plot-y-label</span><span> </span><span>#f</span><span>)</span><span></span>
<span>(</span><span>plot-z-label</span><span> </span><span>#f</span><span>)</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<h2 id="a-sphere">A Sphere</h2>

<p>We begin by plotting a sphere, and the simplest way to do that in the racket plot package is to use the <a href="https://docs.racket-lang.org/plot/renderer3d.html#%28def._%28%28lib._plot%2Fmain..rkt%29._polar3d%29%29">polar3d</a> renderer, which plots a function that maps from a Latitude/Longitude pair to a a radius value. Given that we are plotting a sphere, the radius will be a constant:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      </td>
     <td>
      <div>
       <pre><span></span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>pumpkin-size</span><span> </span><span>1</span><span>)</span><span> </span><span>; the radius of the sphere</span><span></span>
<span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>sphere</span><span></span>
<span>  </span><span>(</span><span>polar3d</span><span></span>
<span>   </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))">lambda</a></span><span> </span><span>(</span><span>longitude</span><span> </span><span>latitude</span><span>)</span><span> </span><span>pumpkin-size</span><span>)</span><span></span>
<span>   </span><span>#:color</span><span> </span><span>&#34;darkorange&#34;</span><span></span>
<span>   </span><span>#:line-color</span><span> </span><span>&#34;brown&#34;</span><span></span>
<span>   </span><span>#:line-width</span><span> </span><span>0.2</span><span></span>
<span>   </span><span>#:line-style</span><span> </span><span>&#39;</span><span>solid</span><span>))</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>If you try to display the sphere in the DrRacket REPL, you’ll notice that it does not display anything useful, this is because <code>sphere</code> is just a “renderer”, an object that needs to be passed to one of the plot functions for rendering.</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      </td>
     <td>
      <div>
       <pre><span></span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))">&gt;</a></span><span> </span><span>sphere</span><span></span>
<span>(</span><span>renderer3d</span><span></span>
<span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/vectors.html#(def._((quote._~23~25kernel)._vector))">vector</a></span><span> </span><span>(</span><span>ivl</span><span> </span><span>-0.9997495328765437</span><span> </span><span>0.9998741276738751</span><span>)</span><span> </span><span>(</span><span>ivl</span><span> </span><span>-0.9998429784893453</span><span> </span><span>0.9998429784893453</span><span>)</span><span> </span><span>(</span><span>ivl</span><span> </span><span>-1.0</span><span> </span><span>1.0</span><span>))</span><span></span>
<span> </span><span>#f</span><span></span>
<span> </span><span>#&lt;procedure:default-ticks-fun&gt;</span><span></span>
<span> </span><span>#f</span><span></span>
<span> </span><span>#&lt;procedure:...ot3d/isosurface.rkt:216:0&gt;</span><span>)</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>To plot the sphere, we simply pass the sphere to the <a href="https://docs.racket-lang.org/plot/plotting.html#%28def._%28%28lib._plot%2Fmain..rkt%29._plot3d%29%29">plot3d</a> function, using <code>(plot3d sphere)</code>, and if you run the code in the DrRacket REPL, you can rotate the plot interactively with the mouse:</p>

<div><p><img src="https://alex-hhh.github.io/img/a057/sphere-plot.png" alt=""/></p></div>

<h2 id="squashing-it">Squashing It</h2>

<p>The next step is to “squash” this sphere into a more “pumpkin-like shape” and we’ll use the function sin⁴(x) to reduce the radius of the sphere depending on the “latitude”. Before we build the 3D plot, it might be useful to plot the squashing function separately:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      </td>
     <td>
      <div>
       <pre><span></span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>squash-depth</span><span> </span><span>0.4</span><span>)</span><span></span>
<span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>(</span><span>squash</span><span> </span><span>latitude</span><span> </span><span>[</span><span>depth</span><span> </span><span>squash-depth</span><span>])</span><span></span>
<span>  </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._expt))">expt</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._sin))">sin</a></span><span> </span><span>latitude</span><span>)</span><span> </span><span>4</span><span>)</span><span> </span><span>depth</span><span>))</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>We can plot this function on a 2D plane using the <a href="https://docs.racket-lang.org/plot/renderer2d.html#%28def._%28%28lib._plot%2Fmain..rkt%29._polar%29%29">polar</a> renderer, this time we’ll construct and pass the renderer directly to the <a href="https://docs.racket-lang.org/plot/index.html">plot</a> function.</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      <div>
       <pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span></pre></div></td>
     <td>
      <div>
       <pre><span></span><span>(</span><span>plot</span><span></span>
<span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span><span></span>
<span>  </span><span>(</span><span>polar</span><span></span>
<span>   </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))">lambda</a></span><span> </span><span>(</span><span>latitude</span><span>)</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span><span> </span><span>pumpkin-size</span><span> </span><span>(</span><span>squash</span><span> </span><span>latitude</span><span>)))</span><span></span>
<span>   </span><span>#:width</span><span> </span><span>3</span><span></span>
<span>   </span><span>#:color</span><span> </span><span>&#34;darkorange&#34;</span><span>)</span><span></span>
<span>  </span><span>(</span><span>point-pict</span><span></span>
<span>   </span><span>#</span><span>(</span><span>0</span><span> </span><span>0</span><span>)</span><span></span>
<span>   </span><span>(</span><span>vc-append</span><span></span>
<span>    </span><span>2</span><span></span>
<span>    </span><span>(</span><span>text</span><span> </span><span>&#34;Squash&#34;</span><span> </span><span>&#39;</span><span>default</span><span> </span><span>18</span><span> </span><span>0</span><span>)</span><span></span>
<span>    </span><span>(</span><span>text</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._format))">format</a></span><span> </span><span>&#34;depth <a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3d))">=</a> ~a&#34;</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/format..rkt)._~7er))">~r</a></span><span> </span><span>squash-depth</span><span> </span><span>#:precision</span><span> </span><span>2</span><span>))</span><span> </span><span>&#39;</span><span>default</span><span> </span><span>16</span><span> </span><span>0</span><span>))</span><span></span>
<span>   </span><span>#:anchor</span><span> </span><span>&#39;</span><span>center</span><span></span>
<span>   </span><span>#:point-sym</span><span> </span><span>&#39;</span><span>none</span><span>))</span><span></span>
<span> </span><span>#:x-min</span><span> </span><span>-1</span><span> </span><span>#:x-max</span><span> </span><span>1</span><span> </span><span>#:y-min</span><span> </span><span>-1</span><span> </span><span>#:y-max</span><span> </span><span>1</span><span>)</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div><p><img src="https://alex-hhh.github.io/img/a057/squash-outline.png" alt=""/></p></div>

<p>We can define the “squashed sphere” renderer by simply subtracting the value of the <code>squash</code> function from the radius:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      </td>
     <td>
      <div>
       <pre><span></span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>squashed-sphere</span><span></span>
<span>  </span><span>(</span><span>polar3d</span><span></span>
<span>   </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))">lambda</a></span><span> </span><span>(</span><span>longitude</span><span> </span><span>latitude</span><span>)</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span><span> </span><span>pumpkin-size</span><span> </span><span>(</span><span>squash</span><span> </span><span>latitude</span><span>)))</span><span></span>
<span>   </span><span>#:color</span><span> </span><span>&#34;darkorange&#34;</span><span></span>
<span>   </span><span>#:line-color</span><span> </span><span>&#34;brown&#34;</span><span></span>
<span>   </span><span>#:line-width</span><span> </span><span>0.2</span><span></span>
<span>   </span><span>#:line-style</span><span> </span><span>&#39;</span><span>solid</span><span>))</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>… and we can inspect the result using <code>(plot3d squashed-sphere)</code>, and rotate the plot in the DrRacket REPL:</p>

<div><p><img src="https://alex-hhh.github.io/img/a057/squashed-sphere.png" alt=""/></p></div>

<h2 id="adding-bumps">Adding Bumps</h2>

<p>A pumpkin should have bumps, and these will be done using a function that modifies the sphere radius along the longitudinal axis. As with the squash function, it is simpler to first visualize the bumps as a 2D plot. We’ll interleave two bumps around the sphere, a “deeper” and a “shallower” one:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      <div>
       <pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span></pre></div></td>
     <td>
      </td></tr></tbody></table></div>

</div>

<p>And we can plot the bumps outline to adjust the parameters:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      <div>
       <pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span>
<span>19</span>
<span>20</span>
<span>21</span></pre></div></td>
     <td>
      <div>
       <pre><span></span><span>(</span><span>plot</span><span></span>
<span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span><span></span>
<span>  </span><span>(</span><span>polar</span><span></span>
<span>   </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))">lambda</a></span><span> </span><span>(</span><span>longitude</span><span>)</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span><span> </span><span>pumpkin-size</span><span></span>
<span>        </span><span>(</span><span>bump</span><span> </span><span>longitude</span><span> </span><span>primary-bump-angle</span><span> </span><span>primary-bump-depth</span><span>)</span><span></span>
<span>        </span><span>(</span><span>bump</span><span> </span><span>longitude</span><span> </span><span>secondary-bump-angle</span><span> </span><span>secondary-bump-depth</span><span>)</span><span></span>
<span>        </span><span>))</span><span></span>
<span>   </span><span>#:width</span><span> </span><span>3</span><span></span>
<span>   </span><span>#:color</span><span> </span><span>&#34;darkorange&#34;</span><span>)</span><span></span>
<span>  </span><span>(</span><span>point-pict</span><span></span>
<span>   </span><span>#</span><span>(</span><span>0</span><span> </span><span>0</span><span>)</span><span></span>
<span>   </span><span>(</span><span>vc-append</span><span></span>
<span>    </span><span>2</span><span></span>
<span>    </span><span>(</span><span>text</span><span> </span><span>&#34;Bumps&#34;</span><span> </span><span>&#39;</span><span>default</span><span> </span><span>18</span><span> </span><span>0</span><span>)</span><span></span>
<span>    </span><span>(</span><span>text</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._format))">format</a></span><span> </span><span>&#34;count <a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3d))">=</a> ~a&#34;</span><span> </span><span>num-bumps</span><span>)</span><span> </span><span>&#39;</span><span>default</span><span> </span><span>16</span><span> </span><span>0</span><span>)</span><span></span>
<span>    </span><span>(</span><span>text</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._format))">format</a></span><span> </span><span>&#34;primary depth <a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3d))">=</a> ~a&#34;</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/format..rkt)._~7er))">~r</a></span><span> </span><span>primary-bump-depth</span><span> </span><span>#:precision</span><span> </span><span>2</span><span>))</span><span> </span><span>&#39;</span><span>default</span><span> </span><span>16</span><span> </span><span>0</span><span>)</span><span></span>
<span>    </span><span>(</span><span>text</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._format))">format</a></span><span> </span><span>&#34;secondary depth <a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3d))">=</a> ~a&#34;</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/format..rkt)._~7er))">~r</a></span><span> </span><span>secondary-bump-depth</span><span> </span><span>#:precision</span><span> </span><span>2</span><span>))</span><span> </span><span>&#39;</span><span>default</span><span> </span><span>16</span><span> </span><span>0</span><span>))</span><span></span>
<span>   </span><span>#:anchor</span><span> </span><span>&#39;</span><span>center</span><span></span>
<span>   </span><span>#:point-sym</span><span> </span><span>&#39;</span><span>none</span><span>))</span><span></span>
<span> </span><span>#:x-min</span><span> </span><span>-1</span><span> </span><span>#:x-max</span><span> </span><span>1</span><span> </span><span>#:y-min</span><span> </span><span>-1</span><span> </span><span>#:y-max</span><span> </span><span>1</span><span>)</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div><p><img src="https://alex-hhh.github.io/img/a057/bumps-outline.png" alt=""/></p></div>

<p>As with squashing, we can define a “sphere with bumps” by subtracting the value of the <code>bump</code> function (one for the primary and one for the secondary bump) from the sphere radius, and plotting it using <code>(plot3d
sphere-with-bumps)</code>:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      </td>
     <td>
      <div>
       <pre><span></span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>sphere-with-bumps</span><span></span>
<span>  </span><span>(</span><span>polar3d</span><span></span>
<span>   </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))">lambda</a></span><span> </span><span>(</span><span>longitude</span><span> </span><span>latitude</span><span>)</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span><span> </span><span>pumpkin-size</span><span></span>
<span>        </span><span>(</span><span>bump</span><span> </span><span>longitude</span><span> </span><span>primary-bump-angle</span><span> </span><span>primary-bump-depth</span><span>)</span><span></span>
<span>        </span><span>(</span><span>bump</span><span> </span><span>longitude</span><span> </span><span>secondary-bump-angle</span><span> </span><span>secondary-bump-depth</span><span>)))</span><span></span>
<span>   </span><span>#:color</span><span> </span><span>&#34;darkorange&#34;</span><span></span>
<span>   </span><span>#:line-color</span><span> </span><span>&#34;brown&#34;</span><span></span>
<span>   </span><span>#:line-width</span><span> </span><span>0.2</span><span></span>
<span>   </span><span>#:line-style</span><span> </span><span>&#39;</span><span>solid</span><span>))</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div><p><img src="https://alex-hhh.github.io/img/a057/sphere-with-bumps.png" alt=""/></p></div>

<h2 id="the-pumpkin">The Pumpkin</h2>

<p>The <code>squash</code> and <code>bump</code> functions can be combined together, both squasing the sphere and applying bumps to it, making it look like a pumpkin, and plot it using <code>(plot3d the-pumpkin)</code>:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      </td>
     <td>
      <div>
       <pre><span></span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>the-pumpkin</span><span></span>
<span>  </span><span>(</span><span>polar3d</span><span></span>
<span>   </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))">lambda</a></span><span> </span><span>(</span><span>longitude</span><span> </span><span>latitude</span><span>)</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span><span> </span><span>pumpkin-size</span><span></span>
<span>        </span><span>(</span><span>squash</span><span> </span><span>latitude</span><span>)</span><span></span>
<span>        </span><span>(</span><span>bump</span><span> </span><span>longitude</span><span> </span><span>primary-bump-angle</span><span> </span><span>primary-bump-depth</span><span>)</span><span></span>
<span>        </span><span>(</span><span>bump</span><span> </span><span>longitude</span><span> </span><span>secondary-bump-angle</span><span> </span><span>secondary-bump-depth</span><span>)))</span><span></span>
<span>   </span><span>#:color</span><span> </span><span>&#34;darkorange&#34;</span><span></span>
<span>   </span><span>#:line-style</span><span> </span><span>&#39;</span><span>transparent</span><span>))</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div><p><img src="https://alex-hhh.github.io/img/a057/pumpkin-no-stem.png" alt=""/></p></div>

<h2 id="a-cylinder">A Cylinder</h2>

<p>To make a credible pumpkin, we’ll need a stem, and to plot that, we’ll start with a cylinder. To render a cylinder, we can use the <a href="https://docs.racket-lang.org/plot/renderer3d.html#%28def._%28%28lib._plot%2Fmain..rkt%29._parametric-surface3d%29%29">parametric-surface3d</a> renderer — this is a generalization of the <code>polar3d</code> renderer: it still takes a function of two arguments, but allows specifying the range for each of the arguments. In our case, we’ll use the first parameter to specify the “longitude” with a range of 0..2π and another parameter to specify the height of the cylinder, ranging from 0 to 1, this will actually be a percentage of the actual cylinder height, which is defined as <code>stem-length</code> below.</p>

<p>The parametric surface function accepts the two parameters and returns a 3D position, as a list X, Y and Z values. Finally, all the Z values are offset by <code>stem-z</code>, so the cylinder is not drawn at the origin, but at the top of our pumpkin.</p>

<p>The cylinder plotted below is already scaled to match the pumpkin size, but if you find this confusing, it might be worth setting the <code>stem-length</code> to 1, <code>stem-radius</code> to 0.5 and <code>stem-z</code> to 0, so see that this really is a cylinder:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      <div>
       <pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span></pre></div></td>
     <td>
      <div>
       <pre><span></span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>stem-length</span><span> </span><span>0.35</span><span>)</span><span></span>
<span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>stem-radius</span><span> </span><span>0.1</span><span>)</span><span></span>
<span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>stem-z</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span><span> </span><span>1.0</span><span> </span><span>squash-depth</span><span>))</span><span></span>

<span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>cylinder</span><span></span>
<span>  </span><span>(</span><span>parametric-surface3d</span><span></span>
<span>   </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))">lambda</a></span><span> </span><span>(</span><span>longitude</span><span> </span><span>t</span><span>)</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>radius</span><span> </span><span>stem-radius</span><span>)</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._sin))">sin</a></span><span> </span><span>longitude</span><span>)</span><span> </span><span>radius</span><span>)</span><span>     </span><span>; X</span><span></span>
<span>           </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._cos))">cos</a></span><span> </span><span>longitude</span><span>)</span><span> </span><span>radius</span><span>)</span><span>     </span><span>; Y</span><span></span>
<span>           </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span><span> </span><span>stem-z</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>t</span><span> </span><span>stem-length</span><span>))))</span><span> </span><span>; Z</span><span></span>
<span>   </span><span>0</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>2</span><span> </span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/math..rkt)._pi))">pi</a></span><span>)</span><span>                           </span><span>; longitude range</span><span></span>
<span>   </span><span>0</span><span> </span><span>1</span><span>                                  </span><span>; t range</span><span></span>
<span>   </span><span>#:color</span><span> </span><span>&#34;forestgreen&#34;</span><span></span>
<span>   </span><span>#:line-style</span><span> </span><span>&#39;</span><span>transparent</span><span>))</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Here is what it looks like when plotted using <code>(plot3d cylinder)</code>, this looks better in the DrRacket REPL, where the plot can be rotated:</p>

<div><p><img src="https://alex-hhh.github.io/img/a057/cylinder-plot.png" alt=""/></p></div>

<h2 id="narrowing">Narrowing</h2>

<p>The pumpkin stem needs to narrow as it approaches the top, and we can do that by reducing the cylinder radius based on its height. There are several ways to do that, but I found the function below to work nicely, although it took a few tries to tune the parameters:</p>



<p>Here is the parametric plot which narrows the cylinder, making it resemble a stem, it can be plotted using <code>(plot3d cylinder-with-narrow-top)</code>:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      <div>
       <pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span></pre></div></td>
     <td>
      <div>
       <pre><span></span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>cylinder-with-narrow-top</span><span></span>
<span>  </span><span>(</span><span>parametric-surface3d</span><span></span>
<span>   </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))">lambda</a></span><span> </span><span>(</span><span>longitude</span><span> </span><span>t</span><span>)</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>radius</span><span></span>
<span>       </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>stem-radius</span><span> </span><span>(</span><span>narrow-stem</span><span> </span><span>t</span><span>)))</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._sin))">sin</a></span><span> </span><span>longitude</span><span>)</span><span> </span><span>radius</span><span>)</span><span>     </span><span>; X</span><span></span>
<span>           </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._cos))">cos</a></span><span> </span><span>longitude</span><span>)</span><span> </span><span>radius</span><span>)</span><span>     </span><span>; Y</span><span></span>
<span>           </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span><span> </span><span>stem-z</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>t</span><span> </span><span>stem-length</span><span>))))</span><span> </span><span>; Z</span><span></span>
<span>   </span><span>0</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>2</span><span> </span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/math..rkt)._pi))">pi</a></span><span>)</span><span>                           </span><span>; longitude range</span><span></span>
<span>   </span><span>0</span><span> </span><span>1</span><span>                                  </span><span>; t range</span><span></span>
<span>   </span><span>#:color</span><span> </span><span>&#34;forestgreen&#34;</span><span></span>
<span>   </span><span>#:line-style</span><span> </span><span>&#39;</span><span>transparent</span><span>))</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div><p><img src="https://alex-hhh.github.io/img/a057/cylinder-with-narrow-top.png" alt=""/></p></div>

<h2 id="bending">Bending</h2>

<p>The stem on a pumpkin is also bent to one side, so we’ll need to bend the cylinder by adjusting the X, Y coordinates of the parametric function. As with narrowing, there are several functions that can be used, but I found the one below, based on logarithms to produce nice results:</p>



<p>We can apply only the bending to the cylinder, to see how it looks, note that we adjust both the X, and Y arguments by the same value, but this is not necessary:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      <div>
       <pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span></pre></div></td>
     <td>
      <div>
       <pre><span></span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>cylinder-with-bending</span><span></span>
<span>  </span><span>(</span><span>parametric-surface3d</span><span></span>
<span>   </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))">lambda</a></span><span> </span><span>(</span><span>longitude</span><span> </span><span>t</span><span>)</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>radius</span><span> </span><span>stem-radius</span><span>)</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>bending</span><span> </span><span>(</span><span>bend</span><span> </span><span>t</span><span>))</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._sin))">sin</a></span><span> </span><span>longitude</span><span>)</span><span> </span><span>radius</span><span>)</span><span> </span><span>bending</span><span>)</span><span> </span><span>; X</span><span></span>
<span>           </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._cos))">cos</a></span><span> </span><span>longitude</span><span>)</span><span> </span><span>radius</span><span>)</span><span> </span><span>bending</span><span>)</span><span> </span><span>; Y</span><span></span>
<span>           </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span><span> </span><span>stem-z</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>t</span><span> </span><span>stem-length</span><span>))))</span><span>         </span><span>; Z</span><span></span>
<span>   </span><span>0</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>2</span><span> </span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/math..rkt)._pi))">pi</a></span><span>)</span><span>                                     </span><span>; longitude range</span><span></span>
<span>   </span><span>0</span><span> </span><span>1</span><span>                                            </span><span>; t range</span><span></span>
<span>   </span><span>#:color</span><span> </span><span>&#34;forestgreen&#34;</span><span></span>
<span>   </span><span>#:line-style</span><span> </span><span>&#39;</span><span>transparent</span><span>))</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Here is the output from <code>(plot3d cylinder-with-bending)</code>:</p>

<div><p><img src="https://alex-hhh.github.io/img/a057/cylinder-with-bending.png" alt=""/></p></div>

<h2 id="the-stem">The Stem</h2>

<p>To build the actual stem, we’ll start with the cylinder, then we’ll apply the narrowing and bending to it. To make it more realistic, we can also add bumps to it, using the same <code>bump</code> function we used for the pumpkin, the bump value is applied to the stem radius after narrowing it:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      <div>
       <pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span></pre></div></td>
     <td>
      <div>
       <pre><span></span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>stem-bump-depth</span><span> </span><span>0.01</span><span>)</span><span></span>

<span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>the-stem</span><span></span>
<span>  </span><span>(</span><span>parametric-surface3d</span><span></span>
<span>   </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))">lambda</a></span><span> </span><span>(</span><span>longitude</span><span> </span><span>t</span><span>)</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>radius</span><span></span>
<span>       </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>stem-radius</span><span> </span><span>(</span><span>narrow-stem</span><span> </span><span>t</span><span>))</span><span></span>
<span>          </span><span>(</span><span>bump</span><span> </span><span>longitude</span><span> </span><span>primary-bump-angle</span><span> </span><span>stem-bump-depth</span><span>)))</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span><span> </span><span>bending</span><span> </span><span>(</span><span>bend</span><span> </span><span>t</span><span>))</span><span></span>
<span>     </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._sin))">sin</a></span><span> </span><span>longitude</span><span>)</span><span> </span><span>radius</span><span>)</span><span> </span><span>bending</span><span>)</span><span> </span><span>; X</span><span></span>
<span>           </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._cos))">cos</a></span><span> </span><span>longitude</span><span>)</span><span> </span><span>radius</span><span>)</span><span> </span><span>bending</span><span>)</span><span> </span><span>; Y</span><span></span>
<span>           </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span><span> </span><span>stem-z</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>t</span><span> </span><span>stem-length</span><span>))))</span><span>         </span><span>; Z</span><span></span>
<span>   </span><span>0</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span><span> </span><span>2</span><span> </span><span><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/math..rkt)._pi))">pi</a></span><span>)</span><span>                                     </span><span>; longitude range</span><span></span>
<span>   </span><span>0</span><span> </span><span>1</span><span>                                            </span><span>; t range</span><span></span>
<span>   </span><span>#:color</span><span> </span><span>&#34;forestgreen&#34;</span><span></span>
<span>   </span><span>#:line-style</span><span> </span><span>&#39;</span><span>transparent</span><span>))</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Here is the output from <code>(plot3d cylinder-with-bending)</code>:</p>

<div><p><img src="https://alex-hhh.github.io/img/a057/only-the-stem.png" alt=""/></p></div>

<h2 id="everything-together">Everything Together</h2>

<p>To produce the final pumpkin, we can plot the pumpkin and stem renderers on a single canvas by passing both of them to the <code>plot3d</code> command. The <code>plot3d</code> accepts not only a single renderer but also a list (and a list of lists) of renders, making it easy to combine different elements to be plotted:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      </td>
     <td>
      <div>
       <pre><span></span><span>(</span><span>plot3d</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span><span> </span><span>the-pumpkin</span><span> </span><span>the-stem</span><span>))</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div><p><img src="https://alex-hhh.github.io/img/a057/the-pumpkin.png" alt=""/></p></div>

<p>In an interactive DrRacket REPL window, the plot can be rotated using the mouse. Also, the <code>plot3d-samples</code> controls the number of samples used to construct the plot and a low value of 50 will produce a plot where individual faces are noticeable, a higher value (the plot above is rendered using 200 samples) will produce nicer results, but rendering will be slower. Higher sampling values can be used for plots that are saved to image files, for example:</p>

<div>
 <div>
  <table>
   <tbody>
    <tr>
     <td>
      </td>
     <td>
      <div>
       <pre><span></span><span>(</span><span><a href="http://docs.racket-lang.org/reference/parameters.html#(form._((lib._racket/private/more-scheme..rkt)._parameterize))">parameterize</a></span><span> </span><span>([</span><span>plot3d-samples</span><span> </span><span>200</span><span>])</span><span></span>
<span>  </span><span>(</span><span>plot3d-file</span><span> </span><span>(</span><span><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span><span> </span><span>the-pumpkin</span><span> </span><span>the-stem</span><span>)</span><span> </span><span>&#34;the-pumpkin.png&#34;</span><span>))</span><span></span>
</pre></div></td></tr></tbody></table></div>

</div>
  
</article>
        </div>
        

      </div>

    </div></div>
  </body>
</html>
