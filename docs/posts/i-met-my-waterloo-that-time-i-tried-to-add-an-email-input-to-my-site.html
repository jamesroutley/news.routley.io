<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.greg.technology/2023/12/02/that-time-i-tried-to-add-an-email-input-to-my-site.html">Original</a>
    <h1>i met my waterloo - that time i tried to add an email input to my site</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>here’s how I got here:</p>

<blockquote>
  <p>it is the year 2023 AD and I would like, on my tiny tiny web pages hosted on github pages, to have an  for my visitors’ email addresses, and for those email addresses to be submitted and then stored somewhere. they could be emailed to me. they could be appended to a google sheets. that’s all ok. I just want those email addresses.</p>
</blockquote>

<p><small>(ok, it’s very funny that the &lt;input&gt; above is an actual input…)</small></p>

<hr/>
<hr/>
<hr/>

<p>news flash:</p>

<h3 id="i-dont-know-how-to-add-a-little-email-input-form-to-my-little-sites">I don’t know how to add a little email input form to my little sites</h3>



<h2 id="which-is-very-frustrating-to-me">which is very frustrating to me.</h2>

<hr/>
<hr/>
<hr/>

<p>ok but I did find a way and I’m just going to dump it on you. and I’m sure it won’t work? in a month? something subtle and hard to debug will silently start failing? with no warning? for sure. FOR SURE.</p>

<p>but as of today - and today is all we have - it works. here goes:</p>

<ol>
  <li>sign up for mailchimp (this is a required step - I wish it wasn’t?)</li>
  <li>create an embedded signup form on mailchimp. it will be a bunch of html. we will modify it and extract stuff from it.</li>
  <li>add this, roughly, to your html:</li>
</ol>

<div><div><pre><code><span>&lt;form</span> <span>action=</span><span>&#34;&#34;</span> <span>style=</span><span>&#39;text-align: center;&#39;</span><span>&gt;</span>
    <span>&lt;input</span> <span>type=</span><span>&#34;hidden&#34;</span> <span>name=</span><span>&#34;c&#34;</span> <span>value=</span><span>&#34;?&#34;</span><span>/&gt;</span>
    <span>&lt;input</span> <span>type=</span><span>&#34;hidden&#34;</span> <span>name=</span><span>&#34;subscribe&#34;</span> <span>value=</span><span>&#34;Subscribe&#34;</span><span>&gt;</span>
    <span>&lt;input</span> <span>type=</span><span>&#34;email&#34;</span> <span>name=</span><span>&#34;EMAIL&#34;</span> <span>placeholder=</span><span>&#34;you@awesome.com&#34;</span> <span>autofocus</span><span>&gt;</span>
    <span>&lt;div</span> <span>aria-hidden=</span><span>&#34;true&#34;</span> <span>style=</span><span>&#34;position: absolute; left: -5000px;&#34;</span><span>&gt;</span>
        <span>&lt;!-- YOU NEED TO CHANGE THE BELOW --&gt;</span>
        <span>&lt;input</span> <span>type=</span><span>&#34;text&#34;</span> <span>name=</span><span>&#34;.........&#34;</span> <span>tabindex=</span><span>&#34;-1&#34;</span> <span>value=</span><span>&#34;&#34;</span><span>&gt;</span>
    <span>&lt;/div&gt;</span>
<span>&lt;/form&gt;</span>
</code></pre></div></div>

<ul>
  <li>yes, leave the action empty. YES, have the <code>&#34;c&#34;</code> hidden input with the <code>&#34;?&#34;</code> value, otherwise NOTHING will work. (because of <a href="https://stackoverflow.com/a/70997063">cors</a>).</li>
  <li>in the embedded code you were given, there will be a hidden input with a bizarre <code>name</code> (<code>b_...</code> in my case). it’s for spam protection. just copy the field you have into the form above. don’t use a <code>&#34;.......&#34;</code> name, I’m sure that would make it all not work / get you in major trouble.</li>
</ul>

<p>4. almost there?</p>

<p>5. here’s some typescript-ish for you:</p>

<div><div><pre><code><span>// THIS IS VERY IMPORTANT</span>
<span>// 5.1 take the &lt;form action=&#34;...&#34; value from your original mailchimp embedded form</span>
<span>// 5.2 AND REPLACE /subscribe/post with /subscribe/post-json </span>
<span>// 5.3 so that it looks kinda like below.</span>
<span>// 5.4 there will be GET arguments after /subscribe/post like ?u=... KEEP THEM.</span>
<span>const</span> <span>FORM_URL</span> <span>=</span>
  <span>&#34;</span><span>https://......list-manage.com/subscribe/post-json?u=.....</span><span>&#34;</span><span>;</span>

<span>function</span> <span>validateEmail</span><span>(</span><span>value</span><span>:</span> <span>string</span><span>)</span> <span>{</span>
  <span>const</span> <span>input</span> <span>=</span> <span>document</span><span>.</span><span>createElement</span><span>(</span><span>&#34;</span><span>input</span><span>&#34;</span><span>);</span>

  <span>input</span><span>.</span><span>type</span> <span>=</span> <span>&#34;</span><span>email</span><span>&#34;</span><span>;</span>
  <span>input</span><span>.</span><span>required</span> <span>=</span> <span>true</span><span>;</span>
  <span>input</span><span>.</span><span>value</span> <span>=</span> <span>value</span><span>;</span>

  <span>return</span> <span>typeof</span> <span>input</span><span>.</span><span>checkValidity</span> <span>===</span> <span>&#34;</span><span>function</span><span>&#34;</span>
    <span>?</span> <span>input</span><span>.</span><span>checkValidity</span><span>()</span>
    <span>:</span> <span>/</span><span>\S</span><span>+@</span><span>\S</span><span>+</span><span>\.\S</span><span>+/</span><span>.</span><span>test</span><span>(</span><span>value</span><span>);</span>
<span>}</span>

<span>export</span> <span>function</span> <span>maybeEmailSignup</span><span>({</span> <span>form</span> <span>}:</span> <span>{</span> <span>form</span><span>:</span> <span>HTMLFormElement</span> <span>})</span> <span>{</span>
  <span>const</span> <span>emailValue</span> <span>=</span> <span>form</span><span>.</span><span>querySelector</span><span>(</span><span>&#34;</span><span>input[type=email]</span><span>&#34;</span><span>)?.</span><span>value</span><span>;</span>

  <span>// double check that email input is not empty and semi legit looking</span>
  <span>if</span> <span>(</span><span>!</span><span>emailValue</span> <span>||</span> <span>!</span><span>emailValue</span><span>.</span><span>includes</span><span>(</span><span>&#34;</span><span>@</span><span>&#34;</span><span>)</span> <span>||</span> <span>!</span><span>validateEmail</span><span>(</span><span>emailValue</span><span>))</span> <span>{</span>
    <span>return</span><span>;</span>
  <span>}</span>

  <span>fetch</span><span>(</span><span>FORM_URL</span><span>,</span> <span>{</span>
    <span>method</span><span>:</span> <span>&#34;</span><span>POST</span><span>&#34;</span><span>,</span>
    <span>mode</span><span>:</span> <span>&#34;</span><span>no-cors</span><span>&#34;</span><span>,</span>
    <span>body</span><span>:</span> <span>new</span> <span>FormData</span><span>(</span><span>form</span><span>),</span>
  <span>});</span>
<span>}</span>
</code></pre></div></div>

<p>6. you’re so good! you’re so done! you’re done! go. go have a life.</p>

<p>7. test your form once a month cause this is all so extremely fragile and untrustworthy.</p>

<p>8. we used to have <code>&lt;?php mail(...)</code> back in the day. we used to run code on servers. we were <a href="https://www.youtube.com/watch?v=lr_vl62JblQ">normal and innocent</a>. we didn’t know how good we had it.</p>

  </div>
</article>
      </div>
    </div></div>
  </body>
</html>
