<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jvns.ca/blog/2022/01/11/how-to-find-a-domain-s-authoritative-nameserver/">Original</a>
    <h1>How to find a domain&#39;s authoritative nameservers</h1>
    
    

<p>Here&rsquo;s a very quick &ldquo;how to&rdquo; post on how to find your domain&rsquo;s authoritative
nameserver.</p>

<p>I&rsquo;m writing this because if you made a DNS update and it didn&rsquo;t work, there are 2 options:</p>

<ol>
<li>Your authoritative nameserver doesn&rsquo;t have the correct record</li>
<li>Your authoritative nameserver <strong>does</strong> have the correct record, but an old record is cached and you need to wait for the cache to expire</li>
</ol>

<p>To be able to tell which one is happening (do you need to make a change, or do
you just need to wait?), you need to be able to find your domain&rsquo;s
authoritative nameserver and query it to see what records it has.</p>

<p>But when I looked up how to find a domain&rsquo;s authoritative nameserver online to
see what advice was out there, I found a lot of conflicting answers. So here&rsquo;s
how I look up a domain&rsquo;s authoritative nameserver when I want to be 100% sure
I&rsquo;m getting the right answer.</p>

<p>In this example, we&rsquo;re going to look up the authoritative nameserver for
<code>jvns.ca</code>. There are 2 steps, and the hardest part is just knowing what line of
<code>dig</code>&rsquo;s output to use.</p>

<h3 id="first-the-easy-way">first, the easy way</h3>

<p>If you definitely haven&rsquo;t updated your authoritative DNS
server in the last week or so, a very easy way to find it is to run <code>dig +short ns DOMAIN</code></p>

<pre><code>$ dig +short ns jvns.ca
art.ns.cloudflare.com.
roxy.ns.cloudflare.com.
</code></pre>

<p>But if you <em>have</em> updated your authoritative DNS server in the last few days, that can give
you an inaccurate answer, so here&rsquo;s a more complicated way that will always
work.</p>

<h3 id="step-1-query-a-root-nameserver">step 1: query a root nameserver</h3>

<p>No matter what domain we&rsquo;re looking up, we need to start with the root
nameservers. <code>h.root-servers.net</code> is one of the <a href="https://www.iana.org/domains/root/servers">13 DNS root nameservers</a>, and <code>dig @h.root-servers.net</code> means &ldquo;send the query to <code>h.root-servers.net</code>&rdquo;.</p>

<pre><code>$ dig @h.root-servers.net jvns.ca
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 42165
;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 4, ADDITIONAL: 9
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
;; QUESTION SECTION:
;jvns.ca.			IN	A

;; AUTHORITY SECTION: &lt;------------ this is the section we're interested in
ca.			172800	IN	NS	c.ca-servers.ca. &lt;------- we'll use this record
ca.			172800	IN	NS	j.ca-servers.ca.
ca.			172800	IN	NS	x.ca-servers.ca.
ca.			172800	IN	NS	any.ca-servers.ca.

;; ADDITIONAL SECTION:
c.ca-servers.ca.	172800	IN	A	185.159.196.2
j.ca-servers.ca.	172800	IN	A	198.182.167.1
x.ca-servers.ca.	172800	IN	A	199.253.250.68
any.ca-servers.ca.	172800	IN	A	199.4.144.2
c.ca-servers.ca.	172800	IN	AAAA	2620:10a:8053::2
j.ca-servers.ca.	172800	IN	AAAA	2001:500:83::1
x.ca-servers.ca.	172800	IN	AAAA	2620:10a:80ba::68
any.ca-servers.ca.	172800	IN	AAAA	2001:500:a7::2

;; Query time: 96 msec
;; SERVER: 198.97.190.53#53(198.97.190.53)
;; WHEN: Tue Jan 11 08:30:57 EST 2022
;; MSG SIZE  rcvd: 289
</code></pre>

<p>The answer we&rsquo;re looking for is this line in the &ldquo;AUTHORITY SECTION&rdquo;:</p>

<pre><code>ca.			172800	IN	NS	c.ca-servers.ca.
</code></pre>

<p>It doesn&rsquo;t matter which line in this section you pick, you can use any of them. I just picked the first one.</p>

<p>This tells us the server we need to talk to in step 2: <code>c.ca-servers.ca.</code></p>

<h3 id="step-2-query-the-ca-nameservers">step 2: query the .ca nameservers</h3>

<p>Now we run <code>dig @c.ca-servers.ca jvns.ca</code></p>

<pre><code>$ dig @c.ca-servers.ca jvns.ca
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 24920
;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 2, ADDITIONAL: 1
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
;; QUESTION SECTION:
;jvns.ca.			IN	A

;; AUTHORITY SECTION: &lt;------------ this is the section we're interested in
jvns.ca.		86400	IN	NS	art.ns.cloudflare.com. &lt;---- we'll use this record
jvns.ca.		86400	IN	NS	roxy.ns.cloudflare.com.

;; Query time: 26 msec
;; SERVER: 185.159.196.2#53(185.159.196.2)
;; WHEN: Tue Jan 11 08:32:44 EST 2022
;; MSG SIZE  rcvd: 90
</code></pre>

<p>Same as last time: the answer we&rsquo;re looking for is this line in the &ldquo;AUTHORITY
SECTION&rdquo;:</p>

<pre><code>jvns.ca.		86400	IN	NS	art.ns.cloudflare.com.
</code></pre>

<p>Again, it doesn&rsquo;t matter which line in this section you pick, you can use any
of them. I just picked the first one.</p>

<h3 id="success-we-know-the-authoritative-nameserver">success! we know the authoritative nameserver!</h3>

<p>The authoritative nameserver for <code>jvns.ca</code> is <code>art.ns.cloudflare.com.</code>. Now you
can now query <code>art.ns.cloudflare.com.</code> directly to see what DNS records it has
for <code>jvns.ca</code>.</p>

<pre><code>$ dig @art.ns.cloudflare.com. jvns.ca
jvns.ca.		292	IN	A	172.64.80.1
</code></pre>

<p>Nice, it worked.</p>

<h3 id="this-is-exactly-what-s-happening-behind-the-scenes-when-you-make-a-dns-query">this is exactly what&rsquo;s happening behind the scenes when you make a DNS query</h3>

<p>The reason I like this method is that it mimics what&rsquo;s happening behind the
scenes when you make a DNS query. When Google&rsquo;s DNS resolver <code>8.8.8.8.</code> looks
up <code>jvns.ca</code>, the server it queries to to get <code>jvns.ca</code>&rsquo;s authoritative nameserver is
<code>c.ca-servers.net</code> (or one of the other options, like <code>j.ca-servers.ca.</code> or <code>x.ca-servers.ca.</code>)</p>

<p>Because this method uses the exact same information source as a real DNS query,
you&rsquo;re guaranteed to get a correct answer every time.</p>

<p>Often in practice I skip step 1 because I remember that the answer for <code>.ca</code>
domains is <code>c.ca-servers.net</code>, so I can skip straight to step 2.</p>

<h3 id="this-is-useful-to-do-when-you-re-updating-your-nameservers">this is useful to do when you&rsquo;re updating your nameservers</h3>

<p>When I update my nameservers with my domain registrar, they don&rsquo;t actually update the
authoritative nameserver right away. It takes a while, maybe an hour. So I like
to go through these steps to check if my registrar has actually updated my
authoritative nameserver yet.</p>

<h3 id="other-ways-to-get-a-domain-s-authoritative-nameserver">other ways to get a domain&rsquo;s authoritative nameserver</h3>

<p>Here are a few other ways you can get the authoritative nameserver for a domain
and why I didn&rsquo;t recommend them as the main method.</p>

<p><strong>dig +trace jvns.ca</strong></p>

<p>This will always give you the right answer, but the output is a bit confusing
to read so I&rsquo;m a bit more hesitant to recommend it.</p>

<p><strong>dig ns jvns.ca</strong></p>

<p>This will usually give you the right answer, but there are 2 reasons it might
be wrong:</p>

<ol>
<li>You might get an old cached record</li>
<li>The NS record you get doesn&rsquo;t come from the same place as it does when we do
the method described in this post. In this example, instead of getting a NS
record from <code>c.ca-servers.net</code>, <code>dig ns jvns.ca</code> will give you an NS record
from <code>art.ns.cloudflare.com</code>.  In practice usually these are the exact same
thing, but in some weird edge cases they might not be.</li>
</ol>

<p><strong>dig soa jvns.ca</strong></p>

<p>You can also find nameservers in the SOA record!</p>

<pre><code>$ dig SOA jvns.ca
jvns.ca.   3600    IN    SOA    art.ns.cloudflare.com. dns.cloudflare.com. 2267173366 10000 2400 604800 3600
                                ^^^^^^^^^^^^^^^^^^^^^
                                    here it is
</code></pre>

<p>This will usually give the right answer, but similarly to the NS record, the
response comes from your authoritative nameserver. So if you&rsquo;re in the middle
of updating your nameserver, you might get the wrong answer because your DNS
resolver sent the request to the old nameserver.</p>

<p><strong>whois jvns.ca</strong></p>

<p>This will usually give you the right answer, but it might be an old cached version.</p>

<p>Here&rsquo;s what this looks like on my machine for this example: (it gives us the right answer)</p>

<pre><code>$ whois jvns.ca | grep 'Name Server'
Name Server: art.ns.cloudflare.com
Name Server: roxy.ns.cloudflare.com
</code></pre>

<h3 id="that-s-all">that&rsquo;s all!</h3>

<p>I hope this helps some of you debug your DNS issues!</p>

  </body>
</html>
