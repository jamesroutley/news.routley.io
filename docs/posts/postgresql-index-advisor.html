<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/supabase/index_advisor">Original</a>
    <h1>Show HN: PostgreSQL index advisor</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><div dir="auto"><a id="user-content-postgresql-index-advisor" aria-label="Permalink: PostgreSQL Index Advisor" href="#postgresql-index-advisor"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">
<a href="https://github.com/supabase/index_advisor/blob/main"><img src="https://camo.githubusercontent.com/fcbb85cdafab586a5805e2d34c6bb52a01c0c07858f4ae92d570b60d4ca010e7/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f706f737467726573716c2d31332b2d626c75652e737667" alt="PostgreSQL version" height="18" data-canonical-src="https://img.shields.io/badge/postgresql-13+-blue.svg"/></a>
<a href="https://github.com/supabase/index_advisor/blob/master/LICENSE"><img src="https://camo.githubusercontent.com/d9cf21745199186ea8db42f6c4220b8ca3bef5a5cb7b96b95c108456afea6100/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f73757061626173652f696e6465785f61647669736f72" alt="License" height="18" data-canonical-src="https://img.shields.io/github/license/supabase/index_advisor"/></a>
<a href="https://github.com/supabase/index_advisor/actions"><img src="https://github.com/supabase/index_advisor/actions/workflows/test.yml/badge.svg" alt="tests" height="18"/></a>
</p>
<p dir="auto">A PostgreSQL extension for recommending indexes to improve query performance.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/supabase/index_advisor/blob/main/docs/img/dashboard.png"><img src="https://github.com/supabase/index_advisor/raw/main/docs/img/dashboard.png" alt="Dashboard"/></a></p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Features</h2><a id="user-content-features" aria-label="Permalink: Features" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Supports generic parameters e.g. <code>$1</code>, <code>$2</code></li>
<li>Supports materialized views</li>
<li>Identifies tables/columns obfuscaed by views</li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">API</h2><a id="user-content-api" aria-label="Permalink: API" href="#api"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto"><h4 tabindex="-1" dir="auto">Description</h4><a id="user-content-description" aria-label="Permalink: Description" href="#description"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For a given <em>query</em>, searches for a set of SQL DDL <code>create index</code> statements that improve the query&#39;s execution time;</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">Signature</h4><a id="user-content-signature" aria-label="Permalink: Signature" href="#signature"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="index_advisor(query text)
returns
    table  (
        startup_cost_before jsonb,
        startup_cost_after jsonb,
        total_cost_before jsonb,
        total_cost_after jsonb,
        index_statements text[],
        errors text[]
    )"><pre>index_advisor(query <span>text</span>)
returns
    table  (
        startup_cost_before jsonb,
        startup_cost_after jsonb,
        total_cost_before jsonb,
        total_cost_after jsonb,
        index_statements <span>text</span>[],
        errors <span>text</span>[]
    )</pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">Usage</h2><a id="user-content-usage" aria-label="Permalink: Usage" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For a minimal example, the <code>index_advisor</code> function can be given a single table query with a filter on an unindexed column.</p>
<div dir="auto" data-snippet-clipboard-copy-content="create extension if not exists index_advisor cascade;

create table book(
  id int primary key,
  title text not null
);

select
    *
from
  index_advisor(&#39;select book.id from book where title = $1&#39;);
"><pre>create extension if not exists index_advisor cascade;

<span>create</span> <span>table</span> <span>book</span>(
  id <span>int</span> <span>primary key</span>,
  title <span>text</span> <span>not null</span>
);

<span>select</span>
    <span>*</span>
<span>from</span>
  index_advisor(<span><span>&#39;</span>select book.id from book where title = $1<span>&#39;</span></span>);
</pre></div>
<div dir="auto" data-snippet-clipboard-copy-content=" startup_cost_before | startup_cost_after | total_cost_before | total_cost_after |                  index_statements                   | errors
---------------------+--------------------+-------------------+------------------+-----------------------------------------------------+--------
 0.00                | 1.17               | 25.88             | 6.40             | {&#34;CREATE INDEX ON public.book USING btree (title)&#34;},| {}

(1 row)"><pre> startup_cost_before | startup_cost_after | total_cost_before | total_cost_after |                  index_statements                   | errors
---------------------+--------------------+-------------------+------------------+-----------------------------------------------------+--------
 0.00                | 1.17               | 25.88             | 6.40             | {&#34;CREATE INDEX ON public.book USING btree (title)&#34;},| {}

(1 row)</pre></div>
<p dir="auto">More complex queries may generate additional suggested indexes</p>
<div dir="auto" data-snippet-clipboard-copy-content="create extension if not exists index_advisor cascade;

create table author(
    id serial primary key,
    name text not null
);

create table publisher(
    id serial primary key,
    name text not null,
    corporate_address text
);

create table book(
    id serial primary key,
    author_id int not null references author(id),
    publisher_id int not null references publisher(id),
    title text
);

create table review(
    id serial primary key,
    book_id int references book(id),
    body text not null
);

select
    *
from
    index_advisor(&#39;
        select
            book.id,
            book.title,
            publisher.name as publisher_name,
            author.name as author_name,
            review.body review_body
        from
            book
            join publisher
                on book.publisher_id = publisher.id
            join author
                on book.author_id = author.id
            join review
                on book.id = review.book_id
        where
            author.id = $1
            and publisher.id = $2
    &#39;);
"><pre>create extension if not exists index_advisor cascade;

<span>create</span> <span>table</span> <span>author</span>(
    id <span>serial</span> <span>primary key</span>,
    name <span>text</span> <span>not null</span>
);

<span>create</span> <span>table</span> <span>publisher</span>(
    id <span>serial</span> <span>primary key</span>,
    name <span>text</span> <span>not null</span>,
    corporate_address <span>text</span>
);

<span>create</span> <span>table</span> <span>book</span>(
    id <span>serial</span> <span>primary key</span>,
    author_id <span>int</span> <span>not null</span> <span>references</span> author(id),
    publisher_id <span>int</span> <span>not null</span> <span>references</span> publisher(id),
    title <span>text</span>
);

<span>create</span> <span>table</span> <span>review</span>(
    id <span>serial</span> <span>primary key</span>,
    book_id <span>int</span> <span>references</span> book(id),
    body <span>text</span> <span>not null</span>
);

<span>select</span>
    <span>*</span>
<span>from</span>
    index_advisor(<span><span>&#39;</span></span>
<span>        select</span>
<span>            book.id,</span>
<span>            book.title,</span>
<span>            publisher.name as publisher_name,</span>
<span>            author.name as author_name,</span>
<span>            review.body review_body</span>
<span>        from</span>
<span>            book</span>
<span>            join publisher</span>
<span>                on book.publisher_id = publisher.id</span>
<span>            join author</span>
<span>                on book.author_id = author.id</span>
<span>            join review</span>
<span>                on book.id = review.book_id</span>
<span>        where</span>
<span>            author.id = $1</span>
<span>            and publisher.id = $2</span>
<span>    <span>&#39;</span></span>);
</pre></div>
<div dir="auto" data-snippet-clipboard-copy-content=" startup_cost_before | startup_cost_after | total_cost_before | total_cost_after |                  index_statements                         | errors
---------------------+--------------------+-------------------+------------------+-----------------------------------------------------------+--------
 27.26               | 12.77              | 68.48             | 42.37            | {&#34;CREATE INDEX ON public.book USING btree (author_id)&#34;,   | {}
                                                                                    &#34;CREATE INDEX ON public.book USING btree (publisher_id)&#34;,
                                                                                    &#34;CREATE INDEX ON public.review USING btree (book_id)&#34;}
(3 rows)"><pre> startup_cost_before | startup_cost_after | total_cost_before | total_cost_after |                  index_statements                         | errors
---------------------+--------------------+-------------------+------------------+-----------------------------------------------------------+--------
 27.26               | 12.77              | 68.48             | 42.37            | {&#34;CREATE INDEX ON public.book USING btree (author_id)&#34;,   | {}
                                                                                    &#34;CREATE INDEX ON public.book USING btree (publisher_id)&#34;,
                                                                                    &#34;CREATE INDEX ON public.review USING btree (book_id)&#34;}
(3 rows)</pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">Install</h2><a id="user-content-install" aria-label="Permalink: Install" href="#install"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Requires Postgres with <a href="https://github.com/HypoPG/hypopg">hypopg</a> installed.</p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/supabase/index_advisor.git
cd index_advisor
sudo make install"><pre>git clone https://github.com/supabase/index_advisor.git
<span>cd</span> index_advisor
sudo make install</pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">Run Tests</h2><a id="user-content-run-tests" aria-label="Permalink: Run Tests" href="#run-tests"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="make install; make installcheck"><pre>make install<span>;</span> make installcheck</pre></div>
</article></div></div>
  </body>
</html>
