<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://geohot.github.io//blog/jekyll/update/2023/06/07/a-dive-into-amds-drivers.html">Original</a>
    <h1>A dive into the AMD driver workflow</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>I ended up getting a response from high level people at AMD. It was still very light on any real technical information, but it did include some great phrases like “I am able to replicate the issues you are facing” and some mockable phrases like “We are hoping that this will improve your perception of AMD products and this will be reflected in your public messaging.”</p>

<p>Though they did end up sending me a ROCm 5.6 driver tarball that seems to be able to run <a href="https://github.com/RadeonOpenCompute/rocm_bandwidth_test">rocm_bandwidth_test</a> and <a href="https://github.com/ROCm-Developer-Tools/HIP-Examples/tree/master/gpu-burn">gpu-burn</a> in loops on 2x 7900XTX. So it fixed the main reported issue! Sadly, they asked me not to distribute it, and gave no more details on what the issue is.</p>

<p>A note culturally, I do sadly feel like what they responded to was <i>george is upset and saying bad things about us which is bad for our brand</i> and not <i>holy shit we have a broken driver released panicing thousands of people’s kernels and crashing their GPUs</i>. But it’s a start.</p>

<p>Let’s say, tentatively, that the AMD on MLPerf plan is back on, as I trust they will release this fixed driver.</p>

<hr/>


<p>AMD has two drivers, “amdgpu” and “AMDGPU-Pro”, henceforth “Pro”</p>

<p>Oddly, they appear to both be open source, at least in kernel land, but only amdgpu is in the Linux kernel in <code>drivers/gpu/drm/amd</code>. Pro is packaged as part of ROCm in <a href="https://repo.radeon.com/amdgpu/5.5.1/ubuntu/pool/main/a/amdgpu-dkms/">dkms debs</a>. These are the subfolders</p>

<ul>
  <li>acp</li>
  <li>amdgpu</li>
  <li>amdkcl (Pro only)</li>
  <li>amdkfd</li>
  <li>backport (Pro only)</li>
  <li>display</li>
  <li>dkms (Pro only)</li>
  <li>include</li>
  <li>pm</li>
</ul>

<p>So amdgpu appears to be a subset of Pro.</p>

<p>They also release a git repo for the Pro driver, called <a href="https://github.com/RadeonOpenCompute/ROCK-Kernel-Driver">ROCK-Kernel-Driver</a>.</p>

<ul>
  <li><a href="https://github.com/RadeonOpenCompute/ROCK-Kernel-Driver/tree/rocm-5.5.0/drivers/gpu/drm/amd">6.0.5.50500-1581431</a></li>
  <li><a href="https://github.com/RadeonOpenCompute/ROCK-Kernel-Driver/tree/rocm-5.5.1/drivers/gpu/drm/amd">6.0.5.50501-1593694</a></li>
  <li>6.1.5.50600-1602498 (the beta version they gave me)</li>
</ul>

<p>Sadly, the public repo is not kept up to date, the last commit was on Apr 19.</p>

<hr/>


<p>I also know there’s more after Apr 19, because there’s an <a href="https://lists.freedesktop.org/mailman/listinfo/amd-gfx">amd-gfx</a> mailing list! These amdgpu commits are merged into amd-staging-drm-next. Arch even has an <a href="https://aur.archlinux.org/packages/linux-amd-staging-drm-next-git">AUR</a> for it.</p>

<ul>
  <li><a href="https://github.com/torvalds/linux/tree/master/drivers/gpu/drm/amd">amdgpu in trunk</a></li>
  <li><a href="https://gitlab.freedesktop.org/agd5f/linux/-/tree/amd-staging-drm-next/drivers/gpu/drm/amd">amdgpu in amd-staging-drm-next</a></li>
</ul>

<p>I got the amd-staging-drm-next kernel built on Ubuntu, but example ROCm apps refused to run at all. It’s worth investigating exactly what the differences between the ROCK-Kernel-Driver (Pro) and mainline linux trees (amdgpu) are. I’ll add links if anyone has them.</p>

<hr/>


<p>My ask to AMD, why keep the real driver development workflow closed source?</p>

<p>Before my <a href="https://www.youtube.com/watch?v=Mr0rWJhv9jU">big AMD driver rant</a>, I built master from <a href="https://github.com/RadeonOpenCompute/ROCK-Kernel-Driver">ROCK-Kernel-Driver</a> (because it’s rude to complain before you try master). I didn’t understand it was actually just the same as amdgpu-dkms from 5.5. Had the 5.6 stuff from the private tarball been pushed, the building of master would have fixed my issues.</p>

<p>Let’s make the driver developed in the open! Cathedral style is no better than <a href="https://github.com/NVIDIA/open-gpu-kernel-modules">NVIDIA</a>. And in order to beat them, you must be playing to win, not just playing not to lose. Combine the driver openness with public <a href="https://www.intel.com/content/www/us/en/docs/graphics-for-linux/developer-reference/1-0/alchemist-arctic-sound-m.html">hardware docs</a> and you have a competitive advantage.</p>


  </div>
</article>

      </div>
    </div></div>
  </body>
</html>
