<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.maximeheckel.com/posts/the-art-of-dithering-and-retro-shading-web/">Original</a>
    <h1>The Art of Dithering and Retro Shading for the Web</h1>
    
    <div id="readability-page-1" class="page"><div><div><p>I spent the past few months building my <a href="https://maximeheckel.com">personal website</a> from the ground up, finally taking the time to incorporate some 3D work to showcase my shader and WebGL skills.
Throughout this work, I got to truly understand the crucial role that <strong>post-processing</strong> plays in making a scene actually <em>look good</em>, which brought some resolutions to long-term frustrations I had with my past React Three Fiber and shader projects where my vision wouldn&#39;t materialize regardless of the amount of work and care I was putting into them.</p>
<p>Taking the time to build, combine, and experiment with custom post-processing effects gave me an additional creative outlet, and among the many types I got to iterate on, I always had a particular affection for the several &#34;retro&#34; effects I came up with. With subtle details such as <strong>dithering</strong>, <strong>color quantization</strong>, or <strong>pixelization/CRT RGB cells</strong>, they bring a pleasant contrast between the modern web landscape and a long-gone era of technology we 90s/early 2000s kids are sometime longing for.</p>
<figure></figure>
<p>Given the time I invested dissecting every aspect of these effects, I wanted to dive deep with you into the concepts powering them and the shader techniques I learned along the way. In this article, I hope to convince you of the power of post-processing effects and that nothing beats an elegant retro vibe applied to a website 👌✨. We&#39;ll also look into examples of dithering and pixel art from very talented folks who use the same processes that I&#39;ll be introducing later on, as well as some of my own creations that I built while learning about all this.</p>


<section id="dithering-techniques-section"><h2 id="dithering-techniques"><a href="#dithering-techniques" aria-hidden="true" tabindex="-1"><span></span></a>Dithering techniques</h2>
<p>Dithering originated as an early graphics technique to <em>trick</em> the viewer&#39;s brain into seeing more color or smoothness in gradients/shadows that the machines back in the day could output by intentionally introducing noise on top of an image or a render.
Color palettes were very limited back then, thus relying on techniques like these was vital for game designers to realize their vision. This gave, as a result, a unique look and feel to games and media from that specific moment in time where computers became ubiquitous, but advanced graphic capabilities were not yet there.</p>
<p>Today, dithering is more an artistic choice than a workaround. Many artists or game designers use this technique as a creative outlet to give their work a unique <em>retro vibe</em>, calling out to that early gaming era, or work within the realms of self-imposed limits in colors. Some great examples of such use of dithering include:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Basement Studio&#39;s <a href="https://chronicles.basement.studio/">Basement Chronicle</a> game: a well-executed <em>point-and-click</em> game that reminds me a lot of my own early gaming experience.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p><a href="https://twitter.com/loackme_">@loackme</a>&#39;s art, which I&#39;m an absolute fan of.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p><a href="https://twitter.com/aweusmeuh">@aweusmeuh</a>&#39;s use of the original Game Boy camera for experimental photography which features
a sublime dithering effect.</p></li>
</ul>
<figure><p><img alt="Examples of beautifully executed dithering art from left to right by Basement Studio, @aweusmeuh, and @loackme_" loading="lazy" width="700" height="405" decoding="async" data-nimg="1" sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/dithering-examples 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/dithering-examples 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/dithering-examples 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/dithering-examples 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/dithering-examples 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/dithering-examples 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/dithering-examples 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/dithering-examples 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/dithering-examples"/></p><figcaption>Examples of beautifully executed dithering art from left to right by Basement Studio, @aweusmeuh, and @loackme_</figcaption></figure>
<p>The latter is how we will approach dithering in this blog post: to give our React Three Fiber/Three.js projects a unique style! In this first part, we&#39;ll explore how the dithering technique works, implement it as a shader, and build a first iteration of a custom dithering post-processing effect that we can apply on top of any 3D scene.</p>
<h3 id="a-first-pass-at-dithering-in-react-three-fiber"><a href="#a-first-pass-at-dithering-in-react-three-fiber" aria-hidden="true" tabindex="-1"><span></span></a>A first pass at dithering in React Three Fiber</h3>
<p>For this project, we&#39;ll create a <strong>custom post-processing effect</strong>. As we did for the <a href="https://blog.maximeheckel.com/posts/moebius-style-post-processing/">Moebius stylized shader</a>, relying on post-processing will allow us to apply a shader to an already rendered scene and alter its style like adding an &#34;image filter&#34; to a photo.</p>

<p>To create a custom effect, we will:</p>
<ol>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Declare a class that extends from <code>Effect</code></p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Define our fragment shader and call it from the parent constructor using the <code>super</code> keyword.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Define the set of uniforms we will need for our effect.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Call the <code>wrapEffect</code> function from <code>@react-three/post-processing</code> with our effect class as an argument. This will allow us to use our effect as a JSX component within <code>EffectComposer</code>.</p></li>
</ol>
<div><div><p data-testid="codesnippet-title">Sample custom shader post-processing effect used in an R3F scene</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">import</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"> </span><span data-testid="content-line">OrbitControls</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">OrthographicCamera</span><span data-testid="content-line">,</span><span data-testid="content-line"> useFBO </span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">from</span><span data-testid="content-line"> </span><span data-testid="content-line">&#39;@react-three/drei&#39;</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">import</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"> </span><span data-testid="content-line">Canvas</span><span data-testid="content-line"> </span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">from</span><span data-testid="content-line"> </span><span data-testid="content-line">&#39;@react-three/fiber&#39;</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">import</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"> wrapEffect</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">EffectComposer</span><span data-testid="content-line"> </span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">from</span><span data-testid="content-line"> </span><span data-testid="content-line">&#39;@react-three/postprocessing&#39;</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">import</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"> </span><span data-testid="content-line">Effect</span><span data-testid="content-line"> </span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">from</span><span data-testid="content-line"> </span><span data-testid="content-line">&#39;postprocessing&#39;</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>5</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">import</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"> </span><span data-testid="content-line">Suspense</span><span data-testid="content-line">,</span><span data-testid="content-line"> useRef</span><span data-testid="content-line">,</span><span data-testid="content-line"> useState </span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">from</span><span data-testid="content-line"> </span><span data-testid="content-line">&#39;react&#39;</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">import</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"> v4 </span><span data-testid="content-line">as</span><span data-testid="content-line"> uuidv4 </span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">from</span><span data-testid="content-line"> </span><span data-testid="content-line">&#39;uuid&#39;</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">import</span><span data-testid="content-line"> </span><span data-testid="content-line">fragmentShader</span><span data-testid="content-line"> </span><span data-testid="content-line">from</span><span data-testid="content-line"> </span><span data-testid="content-line">&#39;./fragmentShader.glsl&#39;</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>9</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">class</span><span data-testid="content-line"> </span><span data-testid="content-line">RetroEffectImpl</span><span data-testid="content-line"> </span><span data-testid="content-line">extends</span><span data-testid="content-line"> </span><span data-testid="content-line">Effect</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>11</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">super</span><span data-testid="content-line">(</span><span data-testid="content-line">&#39;RetroEffect&#39;</span><span data-testid="content-line">,</span><span data-testid="content-line"> fragmentShader</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>12</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">uniforms</span><span data-testid="content-line">:</span><span data-testid="content-line"> </span><span data-testid="content-line">new</span><span data-testid="content-line"> </span><span data-testid="content-line">Map</span><span data-testid="content-line">(</span><span data-testid="content-line">[</span><span data-testid="content-line">]</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>17</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">RetroEffect</span><span data-testid="content-line"> </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">wrapEffect</span><span data-testid="content-line">(</span><span data-testid="content-line">RetroEffectImpl</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>20</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">const</span><span data-testid="content-line"> mesh </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">useRef</span><span data-testid="content-line">(</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>24</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">&lt;</span><span data-testid="content-line">mesh</span><span data-testid="content-line"> </span><span data-testid="content-line">receiveShadow</span><span data-testid="content-line"> </span><span data-testid="content-line">castShadow</span><span data-testid="content-line">&gt;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>25</p><p><span><span data-testid="content-line">        </span><span data-testid="content-line">&lt;</span><span data-testid="content-line">torusKnotGeometry</span><span data-testid="content-line"> </span><span data-testid="content-line">args</span><span data-testid="content-line">=</span><span data-testid="content-line">{</span><span data-testid="content-line">[</span><span data-testid="content-line">1</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.25</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">128</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">100</span><span data-testid="content-line">]</span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">/&gt;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>26</p><p><span><span data-testid="content-line">        </span><span data-testid="content-line">&lt;</span><span data-testid="content-line">meshStandardMaterial</span><span data-testid="content-line"> </span><span data-testid="content-line">color</span><span data-testid="content-line">=</span><span data-testid="content-line">&#34;</span><span data-testid="content-line">cyan</span><span data-testid="content-line">&#34;</span><span data-testid="content-line"> </span><span data-testid="content-line">/&gt;</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>As a first step to building our effect, we&#39;ll start with a simple <strong>luminance-based white noise dithering</strong>. The idea behind this is to:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Look at the <em>luminance</em> of each pixel.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Compare it to a random number (hence the &#34;white noise&#34; in the name).</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Output a white or black pixel based on whether the luminance falls above or below said random number.</p></li>
</ul>
<div><div><p data-testid="codesnippet-title">White noise dithering implemented in a fragment shader of a custom effect</p></div><pre><div data-testid="line"><p>2</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">return</span><span data-testid="content-line"> </span><span data-testid="content-line">fract</span><span data-testid="content-line">(</span><span data-testid="content-line">sin</span><span data-testid="content-line">(</span><span data-testid="content-line">dot</span><span data-testid="content-line">(</span><span data-testid="content-line">c</span><span data-testid="content-line">.</span><span data-testid="content-line">xy</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">12.9898</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">78.233</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">43758.5453</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>5</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec3</span><span data-testid="content-line"> </span><span data-testid="content-line">whiteNoiseDither</span><span data-testid="content-line">(</span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> lum</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>8</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">if</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">lum </span><span data-testid="content-line">&lt;</span><span data-testid="content-line"> </span><span data-testid="content-line">random</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>17</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">void</span><span data-testid="content-line"> </span><span data-testid="content-line">mainImage</span><span data-testid="content-line">(</span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> inputColor</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">out</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> outputColor</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>18</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">inputBuffer</span><span data-testid="content-line">,</span><span data-testid="content-line"> uv</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>20</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> lum </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">dot</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">0.2126</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.7152</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0722</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>21</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">whiteNoiseDither</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> lum</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>You can observe the effect that this code would yield on the widget below which re-implements a similar process:</p>


<p>Doing this will result in a grayscale version of our scene where any pixel not purely black or white will be <em>dithered</em> tricking our brains into seeing more shades of gray. The demo below shows the effect applied on top of a simple React Three Fiber scene:</p>

<h3 id="ordered-dithering-and-bayer-matrix"><a href="#ordered-dithering-and-bayer-matrix" aria-hidden="true" tabindex="-1"><span></span></a>Ordered Dithering and Bayer Matrix</h3>
<p>The effect we just built works, but it relies on white noise for its dithering threshold, leading to a messy result. We can bring order to all this (🥁) using a technique commonly known as <strong>ordered dithering</strong> due to the <em>ordered</em> pattern it yields when applied.</p>
<p>This technique relies on a threshold map defined via a <strong>Bayer Matrix</strong> that contains values used to determine whether we should adjust the color of a given pixel to black or white.</p>

<div data-fullbleed="true"><div><figure><p><img alt="Diagram showcasing the process of applying the 4x4 Bayer Matrix on the input buffer of a scene and obtaining the dithering pattern based on the threshold value matching each pixel" loading="lazy" width="700" height="298" decoding="async" data-nimg="1" sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/bayermatrix 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/bayermatrix 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/bayermatrix 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/bayermatrix 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/bayermatrix 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/bayermatrix 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/bayermatrix 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/bayermatrix 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/bayermatrix"/></p><figcaption>Diagram showcasing the process of applying the 4x4 Bayer Matrix on the input buffer of a scene and obtaining the dithering pattern based on the threshold value matching each pixel</figcaption></figure></div></div>
<p>To demonstrate how this dithering type works, I built the widget below where you can see how this matrix changes the output of a grid of pixels once applied on top of it:</p>

<p>As you can see through the examples I showcased above, we get some pretty distinct dithering patterns based on</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>the shades of gray used in the underlying pixel grid</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>the size of the Bayer Matrix used to get the threshold value</p></li>
</ul>
<figure><div tabindex="0" role="slider" aria-label="Ordered dithering applied on a simple grayscale gradient" aria-valuemin="0" aria-valuemax="100" aria-valuenow="50"><p><img alt="Before" loading="eager" width="700" height="364" decoding="async" data-nimg="1" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/grayscale 1x, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/grayscale 2x" src="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/grayscale"/></p><p><img alt="After" loading="eager" width="700" height="364" decoding="async" data-nimg="1" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/2-color 1x, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/2-color 2x" src="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/2-color"/></p><div id="slider-line"><p><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" style="transform:rotate(180deg)"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></p></div></div><figcaption>Ordered dithering applied on a simple grayscale gradient</figcaption></figure>
<p>To implement this in GLSL, we need to get the luminance of each pixel and compare its value with the corresponding threshold value for that same pixel obtained from the Bayer Matrix:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>if the difference between those values is positive, the pixel is white</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>otherwise, it is black</p></li>
</ul>
<div><div><p data-testid="codesnippet-title">Ordered dithering using a 4x4 Bayer Matrix</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">mat4x4</span><span data-testid="content-line"> bayerMatrix4x4 </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mat4x4</span><span data-testid="content-line">(</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec3</span><span data-testid="content-line"> </span><span data-testid="content-line">orderedDither</span><span data-testid="content-line">(</span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> lum</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>9</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>11</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> threshold </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>13</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">int</span><span data-testid="content-line"> x </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">int</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">%</span><span data-testid="content-line"> </span><span data-testid="content-line">4</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>14</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">int</span><span data-testid="content-line"> y </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">int</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">%</span><span data-testid="content-line"> </span><span data-testid="content-line">4</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>15</p><p><span><span data-testid="content-line">  threshold </span><span data-testid="content-line">=</span><span data-testid="content-line"> bayerMatrix4x4</span><span data-testid="content-line">[</span><span data-testid="content-line">y</span><span data-testid="content-line">]</span><span data-testid="content-line">[</span><span data-testid="content-line">x</span><span data-testid="content-line">]</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>17</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">if</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">lum </span><span data-testid="content-line">&lt;</span><span data-testid="content-line"> threshold </span><span data-testid="content-line">+</span><span data-testid="content-line"> bias</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>Modifying the effect code we implemented in the previous part with the code we just introduced will give us an ordered dithering effect for our underlying scene:</p>


<h3 id="blue-noise-dithering"><a href="#blue-noise-dithering" aria-hidden="true" tabindex="-1"><span></span></a>Blue noise dithering</h3>
<p>We got ourselves a satisfying ordered dithering effect! While this is the most popular dithering technique, as well as the main one we&#39;ll leverage in this article, I still wanted to touch upon an additonal way to dither that you perhaps remember seeing in my article on <a href="https://blog.maximeheckel.com/posts/real-time-cloudscapes-with-volumetric-raymarching/">Volumetric Raymarching</a>: <strong>blue noise dithering</strong>.</p>
<p>I used this technique in my raymarched cloud scenes to <em>&#34;erase the banding or layering effect due to a less granular [raymarching] loop&#34;</em> which funny enough is the same use case we need dithering for in our Retro post-processing effect. Unlike the previous techniques, this one relies on a texture that we&#39;ll pass to the shader of our custom post-processing effect via a uniform and then sample it as follows:</p>
<div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec4</span><span data-testid="content-line"> noise </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">uNoise</span><span data-testid="content-line">,</span><span data-testid="content-line"> gl_FragCoord</span><span data-testid="content-line">.</span><span data-testid="content-line">xy </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">128.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> threshold </span><span data-testid="content-line">=</span><span data-testid="content-line"> noise</span><span data-testid="content-line">.</span><span data-testid="content-line">r</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<p>where <code>128.0</code> is the width/height of said texture. We also define the threshold as the red color channel of the resulting noise color we obtain from the sampling, given that we&#39;re using a grayscale texture, it doesn&#39;t matter much which value you pick.</p>

<p>Below is the resulting output when we use a blue noise texture to obtain our dithering threshold value:</p>

<p>As you can see, it feels less repetitive and structured than ordered dithering while also not being as <em>random</em> as white noise dithering; a nice middle ground.</p>

</section><section id="color-quantization-section"><h2 id="color-quantization"><a href="#color-quantization" aria-hidden="true" tabindex="-1"><span></span></a>Color Quantization</h2>
<p>So far, all our dithering examples also converted the underlying scene to black and white, thus making us lose a lot of information and color. That is because:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We calculated our dithering threshold based on the pixel luminance, thus relying on a grayscale version of our scene.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We manually returned a black or white pixel based on the threshold value relative to the luminance.</p></li>
</ul>
<p>That technique is commonly referred to as <strong>luminance-based dithering</strong> and the color conversion used here compresses the color palette to 2-bit: each pixel of the resulting scene with our post-processing effect applied is either black or white, and any shade in-between appears to us through dithering.</p>
<p>This <em>color compression</em> is known as <strong>color quantization</strong>, and it supports more than just black and white pixels as we&#39;ll see in this section.</p>
<h3 id="shades-of-gray-and-colors"><a href="#shades-of-gray-and-colors" aria-hidden="true" tabindex="-1"><span></span></a>Shades of gray and colors</h3>
<p>Manually setting the colors of our dithering pattern can quickly get out of hand, especially with large color palettes. Instead, to get more than just a black or white pixel and leverage shades of gray, we&#39;ll use a formula to find the nearest neighboring color of a given pixel color based on the total number of colors we want to output in our effect:</p>
<p><code>floor(color * (n - 1) + 0.5)/n - 1</code> where <code>n</code> is the total number of color.</p>
<p>For example, if we wanted only two colors in our final color palette we would get a value of:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p><code>vec3(0.0)</code> for the color <code>vec3(0.3)</code> i.e. black</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p><code>vec3(1.0)</code> for the color <code>vec3(0.6)</code> i.e. white</p></li>
</ul>
<p>If we were to increase the number of colors we would get more shades of gray in the case of our grayscale scene.</p>
<div><div><p data-testid="codesnippet-title">Grayscale color quantization implemented in our custom effect</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec3</span><span data-testid="content-line"> </span><span data-testid="content-line">dither</span><span data-testid="content-line">(</span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> lum</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">lum</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">int</span><span data-testid="content-line"> x </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">int</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">%</span><span data-testid="content-line"> </span><span data-testid="content-line">8</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>5</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">int</span><span data-testid="content-line"> y </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">int</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">%</span><span data-testid="content-line"> </span><span data-testid="content-line">8</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> threshold </span><span data-testid="content-line">=</span><span data-testid="content-line"> bayerMatrix8x8</span><span data-testid="content-line">[</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">8</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> x</span><span data-testid="content-line">]</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb </span><span data-testid="content-line">+=</span><span data-testid="content-line"> threshold</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>9</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">r </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">r </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">colorNum </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">colorNum </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>10</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">g </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">g </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">colorNum </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">colorNum </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>11</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">b </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">b </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">colorNum </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">colorNum </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div>


<figure><div tabindex="0" role="slider" aria-label="Ordered dithering with 2 VS 4 color quantization. Notice how the 4-color variant yields a better looking gradient." aria-valuemin="0" aria-valuemax="100" aria-valuenow="50"><p><img alt="Before" loading="eager" width="700" height="364" decoding="async" data-nimg="1" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/2-color 1x, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/2-color 2x" src="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/2-color"/></p><p><img alt="After" loading="eager" width="700" height="364" decoding="async" data-nimg="1" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/4-color 1x, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/4-color 2x" src="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/4-color"/></p><div id="slider-line"><p><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" style="transform:rotate(180deg)"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></p></div></div><figcaption>Ordered dithering with 2 VS 4 color quantization. Notice how the 4-color variant yields a better looking gradient.</figcaption></figure>
<p>This formula doesn&#39;t just work for shades of gray, we can use it directly on the original pixel color to compute its nearest neighbor:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>for a two-color palette, we&#39;ll get the 2 possible values for each color channel thus 2^3 = 8 colors</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>for a four-color palette, it would be 4^3 = 64 colors</p></li>
</ul>
<div><div><p data-testid="codesnippet-title">Color quantization implemented in our custom effect</p></div><pre><div data-testid="highlight-line"><p>1</p><p><span><span data-testid="content-line">vec3</span><span data-testid="content-line"> </span><span data-testid="content-line">dither</span><span data-testid="content-line">(</span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> color</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">int</span><span data-testid="content-line"> x </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">int</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">%</span><span data-testid="content-line"> </span><span data-testid="content-line">8</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">int</span><span data-testid="content-line"> y </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">int</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">%</span><span data-testid="content-line"> </span><span data-testid="content-line">8</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> threshold </span><span data-testid="content-line">=</span><span data-testid="content-line"> bayerMatrix8x8</span><span data-testid="content-line">[</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">8</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> x</span><span data-testid="content-line">]</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb </span><span data-testid="content-line">+=</span><span data-testid="content-line"> threshold</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">r </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">r </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">colorNum </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">colorNum </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">g </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">g </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">colorNum </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">colorNum </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>9</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">b </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">b </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">colorNum </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">colorNum </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div>

<p>This quantization technique lets us approximate the look and feel of older graphics. We can obtain color palettes that are more in line with what computers and consoles could output back in the day.</p>

<h3 id="custom-color-palettes"><a href="#custom-color-palettes" aria-hidden="true" tabindex="-1"><span></span></a>Custom color palettes</h3>
<p>We now know a technique to reduce the number of colors in our final render to an arbitrary number, but what about reducing it to an arbitrary set of colors?</p>
<p>In his <a href="https://www.youtube.com/watch?v=8wOUe32Pt-E&amp;ab_channel=Acerola">video on quantization and dithering</a>, <a href="https://twitter.com/Acerola_t">@Acerola_t</a> introduces a technique to do just that by using the value of a grayscale color palette to sample a texture defining a custom color palette.</p>
<p>For example, if our last grayscale example scene from earlier sets the color number to four, we will get the following grayscale values:</p>
<figure><p><img alt="Diagram showcasing how to use the grayscale values to sample a texture containing the same amount of colors" loading="lazy" width="700" height="362" decoding="async" data-nimg="1" sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/grayscaletexture 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/grayscaletexture 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/grayscaletexture 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/grayscaletexture 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/grayscaletexture 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/grayscaletexture 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/grayscaletexture 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/grayscaletexture 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/grayscaletexture"/></p><figcaption>Diagram showcasing how to use the grayscale values to sample a texture containing the same amount of colors</figcaption></figure>
<p>These values correspond to the horizontal values of the UV coordinates of our color palette texture, thus letting us use those values to sample the texture and get the custom colors from it:</p>
<div><div><p data-testid="codesnippet-title">Using quantization grayscale value to sample custom color palette texture&#34;</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec3</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line">13</span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">dither</span><span data-testid="content-line">(</span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> lum</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">lum</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">int</span><span data-testid="content-line"> x </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">int</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">%</span><span data-testid="content-line"> </span><span data-testid="content-line">8</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>5</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">int</span><span data-testid="content-line"> y </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">int</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">%</span><span data-testid="content-line"> </span><span data-testid="content-line">8</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> threshold </span><span data-testid="content-line">=</span><span data-testid="content-line"> bayerMatrix8x8</span><span data-testid="content-line">[</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">8</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> x</span><span data-testid="content-line">]</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb </span><span data-testid="content-line">+=</span><span data-testid="content-line"> threshold </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.2</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>9</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">r </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">r </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">4.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">4.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>10</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">g </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">g </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">4.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">4.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>11</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">b </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">b </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">4.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">4.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>13</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> paletteColor </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">palette</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">r</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>If we were to apply that technique to the previous scene, this is what the final output would look like:</p>

<p>I&#39;d encourage you to fork this demo and try with:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>different textures</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>different number of colors</p></li>
</ul>
<p>The only thing to pay attention to is to keep the number of color blocks in your palette texture the same as the number of color you set in your custom effect.</p>
<h3 id="hue-lightness-based-color-quantization"><a href="#hue-lightness-based-color-quantization" aria-hidden="true" tabindex="-1"><span></span></a>Hue-lightness-based color quantization</h3>
<p>In his article <a href="http://alex-charlton.com/posts/Dithering_on_the_GPU/">Dithering on the GPU</a> Alex Charlton introduces an alternative color quantization technique. Instead of using the quantization formula we introduced at the beginning of this section, he relies on the hue of a color to find its closest neighboring colors from an arbitrary palette and the lightness of those colors to obtain the ordered dithering pattern.</p>
<p>To do so, he proceeds as follows:</p>
<ol>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>For each pixel, convert the color to HSL (Hue Saturation Lightness).</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Find its two closest neighbors in &#34;hue&#34; from the arbitrary color palette defined statically or provided via a uniform.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Get the distance between the pixel and its closest color over the distance between the previously obtained colors.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Compare this distance with the threshold value from the Bayer Matrix and, based on the result pick the first or second closest color.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Get the distance between the two closest lightness that match the original pixel&#39;s color.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Compare this distance with the threshold value from the Bayer Matrix and, based on the result pick the first or second lightness to set in the final color.</p></li>
</ol>
<p>I vividly recommend taking the time to read the full article as it goes in-depth into an original and more artistic dithering process. Below you&#39;ll find the demo I re-implemented from the process showcased in the article. It also features some of the missing functions the author did not include in their post.</p>

</section><section id="pixelization-section"><h2 id="pixelization"><a href="#pixelization" aria-hidden="true" tabindex="-1"><span></span></a>Pixelization</h2>
<p>We now know how to:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Reduce the number of colors of a given scene to a specific number or an arbitrary color palette.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Use dithering to <em>get back</em> some of the details of the scene in the form of a dithering pattern like shadows or color gradients.</p></li>
</ul>
<p>In this section, we will look at some techniques to <em>downsample</em> the final output of our scene to get a more <strong>pixelated</strong> look and see our dithering and quantization process shine at lower resolutions.</p>
<p>The key to getting a pixelated version of our original scene is to remap the UV coordinate system used in our effect shader and snap it to a grid so, once sampled, the texture from our input buffer appears as if it were at a lower resolution.</p>
<div><div><p data-testid="codesnippet-title">Pixelating a texture in GLSL</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">void</span><span data-testid="content-line"> </span><span data-testid="content-line">mainImage</span><span data-testid="content-line">(</span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> inputColor</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">out</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> outputColor</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>2</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">=</span><span data-testid="content-line"> pixelSize </span><span data-testid="content-line">/</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>3</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uvPixel </span><span data-testid="content-line">=</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">uv </span><span data-testid="content-line">/</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>5</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">inputBuffer</span><span data-testid="content-line">,</span><span data-testid="content-line"> uvPixel</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">dither</span><span data-testid="content-line">(</span><span data-testid="content-line">uvPixel</span><span data-testid="content-line">,</span><span data-testid="content-line"> color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>In the code snippet above:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We define the size of our pixel via the <code>pixelSize</code> uniform.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We divide this value by the resolution of our scene to convert it to a normalized texture coordinate ranging from 0 to 1.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We snap the UV coordinate to the grid defined by <code>uv/normalizedPixelSize</code> using the <code>floor</code> function.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We rescale the snapped UV coordinates to the original UV space by multiplying the result by <code>normalizedPixelSize</code>.</p></li>
</ul>
<p>The demo below adds this process along with an additional uniform for you to tweak the pixel size used in our scene:</p>

<p>Notice how the higher the value of <code>pixelSize</code> is, the more pixelated our scene becomes.</p>
<p>On top of that, we can see that our dithering pattern becomes less and less visible as the pixel size increases: there are not enough pixels in the final output to get any pattern at all.
We&#39;ll have to strike the right balance between dithering pattern and pixel size to get the most compelling effect.</p>
<p>With this added to our effect, we have all the ingredients to produce gorgeous pixel art pieces or pixelated 3D scenes! One thing I immediately tried upon wrapping up this post-processing effect was to try it on top of some of my earlier shader work, like in <a href="https://r3f.maximeheckel.com/dithered-waves">my scene titled Dithering Waves</a> where I applied a grayscale version of it on top of a simple scene rendering a domain wrapping texture using Fractal Brownian Motion, inspired by <a href="https://iquilezles.org/articles/warp/">Inigo Quilez&#39; article</a> on the matter.</p>


<p>To experiment with <a href="https://rauno.me/craft/contrasting-aesthetics">contrasting aesthetics</a>, I also wanted to try out ordered dithering and color quantization on some of my Raymarching work from last year. The ordered pattern contrasts nicely with the more organic nature of some of those scenes, especially at lower resolutions. Below are two examples that I particularily enjoyed:</p>
<figure></figure>
<figure></figure>
</section><section id="cathode-ray-tube-effect-section"><h2 id="cathode-ray-tube-effect"><a href="#cathode-ray-tube-effect" aria-hidden="true" tabindex="-1"><span></span></a>Cathode-Ray Tube effect</h2>
<p>While pixelization brings us one step closer to an accurate retro post-processing effect, there is one essential aspect of this effect that&#39;s missing: emulating the look of a good ol&#39; CRT monitor.</p>
<p>CRTs work differently than our current displays. Thus, the best we can do here is to approach the look and feel of those old monitors by stacking a series of effects in our custom shader effect. The first and most fundamental effect that we&#39;ll work on, that also highlights the inner workings of CRTs, is the RGB cell pattern from the display.</p>

<h3 id="rgb-cells"><a href="#rgb-cells" aria-hidden="true" tabindex="-1"><span></span></a>RGB Cells</h3>
<p>First and foremost, let&#39;s look at how CRT displays work so we can reproduce the effect as accurately as possible. Those monitors have 3 electron guns for each of the color channels (red, green, and blue) that run across the screen and excite their corresponding phosphors, which in return emit light to form an image. To prevent those beams from hitting the wrong phosphor dots and causing color issues on the final image, CRTs use a <strong>shadow mask</strong> with a metal plate made of tiny holes. They can have many different configurations which yield different <em>mask types</em>.</p>
<p>In this section, we&#39;ll attempt to emulate the Schiltzmaske: an aperture grill where each column is staggered by half a cell height.</p>
<figure><p><img alt="Diagram showcasing the staggered RGB cells shadow mask effect on a sample scene" loading="lazy" width="700" height="362" decoding="async" data-nimg="1" sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/rgbcells 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/rgbcells 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/rgbcells 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/rgbcells 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/rgbcells 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/rgbcells 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/rgbcells 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/rgbcells 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/rgbcells"/></p><figcaption>Diagram showcasing the staggered RGB cells shadow mask effect on a sample scene</figcaption></figure>
<p>This implementation could also allow us to try to get another mask type called Streifermaske, which is similar except that it does not feature the staggered cells and only features a mask on its column.</p>
<p>The implementation of such a &#34;pixel pattern&#34; in GLSL goes as follows:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We first need to define our RGB cells and their subcells: a slot for each red, green, and blue channel.</p></li>
</ul>
<div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec2</span><span data-testid="content-line"> pixel </span><span data-testid="content-line">=</span><span data-testid="content-line"> uv </span><span data-testid="content-line">*</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> coord </span><span data-testid="content-line">=</span><span data-testid="content-line"> pixel </span><span data-testid="content-line">/</span><span data-testid="content-line"> pixelSize</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> subcoord </span><span data-testid="content-line">=</span><span data-testid="content-line"> coord </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">3</span><span data-testid="content-line">,</span><span data-testid="content-line">1</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> cellOffset </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">mod</span><span data-testid="content-line">(</span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">coord</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">3.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We create a cell &#34;offset&#34; for every two cells: some will have an offset of <code>vec2(0.0)</code> and some of <code>vec2(0.0, 0.5)</code>, thus creating the vertical <em>staggered effect</em> of our shadow mask.</p></li>
</ul>
<div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec2</span><span data-testid="content-line"> cellOffset </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">mod</span><span data-testid="content-line">(</span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">coord</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">3.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We pick which subcell the current pixel belongs to and output the corresponding subcell color based on the subcell index.</p></li>
</ul>
<div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> ind </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mod</span><span data-testid="content-line">(</span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">subcoord</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">3.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec3</span><span data-testid="content-line"> maskColor </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">ind </span><span data-testid="content-line">==</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> ind </span><span data-testid="content-line">==</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> ind </span><span data-testid="content-line">==</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We now need to draw the borders of our masks. The first step is to create a set of UV coordinates for each subcell, then make a border vector that gets higher values in the edges of each subcell and lower towards the center. Finally, we blend the result with the current mask color, thus creating a colored subcell with a border.</p></li>
</ul>
<div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec2</span><span data-testid="content-line"> cellUv </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">fract</span><span data-testid="content-line">(</span><span data-testid="content-line">subcoord </span><span data-testid="content-line">+</span><span data-testid="content-line"> cellOffset</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> border </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> cellUv </span><span data-testid="content-line">*</span><span data-testid="content-line"> cellUv </span><span data-testid="content-line">*</span><span data-testid="content-line"> MASK_BORDER</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line">maskColor</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb </span><span data-testid="content-line">*=</span><span data-testid="content-line"> border</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> border</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>The last step is to create a <code>rgbCellUV</code> vector that we can use to sample the input buffer of our underlying scene and map it in this new CRT RGB Cell coordinate system.</p></li>
</ul>
<div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec2</span><span data-testid="content-line"> rgbCellUV </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">coord</span><span data-testid="content-line">+</span><span data-testid="content-line">cellOffset</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> pixelSize </span><span data-testid="content-line">/</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<p>This results in a more accurate look and feel for a retro post-processing effect. Those are the types of details that can make the whole difference when making a 3D scene for the web.</p>
<figure><div tabindex="0" role="slider" aria-label="Pixelization VS RGB Cell shadow mask effect. Notice how the output appears slightly sharper in the RGB Cell variant." aria-valuemin="0" aria-valuemax="100" aria-valuenow="50"><p><img alt="Before" loading="eager" width="700" height="370" decoding="async" data-nimg="1" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/pixeleffect2 1x, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/pixeleffect2 2x" src="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/pixeleffect2"/></p><p><img alt="After" loading="eager" width="700" height="370" decoding="async" data-nimg="1" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/rgbeffect2 1x, https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/rgbeffect2 2x" src="https://res.cloudinary.com/dg5nsedzw/image/upload/fl_lossy,f_auto,q_auto/blog/rgbeffect2"/></p><div id="slider-line"><p><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" style="transform:rotate(180deg)"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></p></div></div><figcaption>Pixelization VS RGB Cell shadow mask effect. Notice how the output appears slightly sharper in the RGB Cell variant.</figcaption></figure>
<p>The demo below fully implements the process highlighted above, which yields a beautiful and soft CRT effect. Setting a high pixel size will also allow you to admire our subcells at work, lighting up individually based on the color of the underlying scene.</p>


<h3 id="curving-the-display"><a href="#curving-the-display" aria-hidden="true" tabindex="-1"><span></span></a>Curving the display</h3>
<p>CRTs were not flat like their LCD counterparts. Instead, they featured some slight curvature which we can emulate with a few lines of GLSL. To do so, much like we just did for our RGB cells shadow mask, we can remap our UV coordinates to introduce some curvature:</p>
<div><div><p data-testid="codesnippet-title">Modifying our UVs to introduce curvature to our effect</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">void</span><span data-testid="content-line"> </span><span data-testid="content-line">mainImage</span><span data-testid="content-line">(</span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> inputColor</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">out</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> outputColor</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> curveUV </span><span data-testid="content-line">=</span><span data-testid="content-line"> uv </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> offset </span><span data-testid="content-line">=</span><span data-testid="content-line"> curveUV</span><span data-testid="content-line">.</span><span data-testid="content-line">yx </span><span data-testid="content-line">*</span><span data-testid="content-line"> curve</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">  curveUV </span><span data-testid="content-line">+=</span><span data-testid="content-line"> curveUV </span><span data-testid="content-line">*</span><span data-testid="content-line"> offset </span><span data-testid="content-line">*</span><span data-testid="content-line"> offset</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>5</p><p><span><span data-testid="content-line">  curveUV </span><span data-testid="content-line">=</span><span data-testid="content-line"> curveUV </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>In the code snippet above:</p>
<ol>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We convert our UV coordinates range to a new range of <code>[-1, 1]</code> as we want the curvature to be <em>centered</em> relative to the screen.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Swapping the x and y components of our UV coordinates and multiplying by a <code>CURVE_INTENSITY</code> variable lets us define the strength/offset of our curvature. In this case, the offset will be stronger at the corners and not as strong as we reach the center of both the x and y-axis.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Finally, we want our curvature to be quadratic, i.e. stronger the closer we get to the fringes of the screen. We then convert the resulting UV coordinates back to a range of <code>[0, 1]</code> allowing us to use it in our shader as the <em>base</em> UVs.</p></li>
</ol>
<p>Using those new UV coordinates, we can draw the <em>edges</em> of our CRT using <code>smoothstep</code>:</p>
<div><div><p data-testid="codesnippet-title">Drawing edges of our curved CRT using curveUV</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec2</span><span data-testid="content-line"> edge </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">smoothstep</span><span data-testid="content-line">(</span><span data-testid="content-line">0.</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.02</span><span data-testid="content-line">,</span><span data-testid="content-line"> curveUV</span><span data-testid="content-line">)</span><span data-testid="content-line">*</span><span data-testid="content-line">(</span><span data-testid="content-line">1.</span><span data-testid="content-line">-</span><span data-testid="content-line">smoothstep</span><span data-testid="content-line">(</span><span data-testid="content-line">1.</span><span data-testid="content-line">-</span><span data-testid="content-line">0.02</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.</span><span data-testid="content-line">,</span><span data-testid="content-line"> curveUV</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb </span><span data-testid="content-line">*=</span><span data-testid="content-line"> edge</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> edge</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<p>This gives us black curved edges on the top, bottom, left, and right sides of the display. The demo below implements this curvature element to the effect we&#39;ve been iterating on since the beginning of this blog post and also lets you tweak the curvature intensity from 0 (flat) to 0.5 (realistically curved, anything higher than that is &#34;too much&#34;).</p>


<h3 id="scanlines-distortion-and-final-touches"><a href="#scanlines-distortion-and-final-touches" aria-hidden="true" tabindex="-1"><span></span></a>Scanlines, distortion, and final touches</h3>
<p>In this last part, I wanted to walk you through some of the final touches I added to my own retro post-processing effect to make it as accurate as possible.</p>
<p>One of the first tweaks I felt was necessary was to add some slight chromatic aberration when sampling the input buffer of our effect, which we can find the code of in <a href="https://blog.maximeheckel.com/posts/refraction-dispersion-and-other-shader-light-effects/">Refraction, dispersion, and other shader light effects</a>. Due to the screen curvature and some imperfect alignments of the electron beams of the CRT, it was frequent that color channels would appear slightly offset, yielding a slightly blurred image.</p>
<div><div><p data-testid="codesnippet-title">Arbitrary chromatic aberration applied to our effect</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">void</span><span data-testid="content-line"> </span><span data-testid="content-line">mainImage</span><span data-testid="content-line">(</span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> inputColor</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">out</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> outputColor</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>5</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">r </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">inputBuffer</span><span data-testid="content-line">,</span><span data-testid="content-line"> rgbCellUV </span><span data-testid="content-line">+</span><span data-testid="content-line"> SPREAD</span><span data-testid="content-line">)</span><span data-testid="content-line">.</span><span data-testid="content-line">r</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>6</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">g </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">inputBuffer</span><span data-testid="content-line">,</span><span data-testid="content-line"> rgbCellUV</span><span data-testid="content-line">)</span><span data-testid="content-line">.</span><span data-testid="content-line">g</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>7</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">b </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">inputBuffer</span><span data-testid="content-line">,</span><span data-testid="content-line"> rgbCellUV </span><span data-testid="content-line">-</span><span data-testid="content-line"> SPREAD</span><span data-testid="content-line">)</span><span data-testid="content-line">.</span><span data-testid="content-line">b</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>9</p><p><span><span data-testid="content-line">  color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">dither</span><span data-testid="content-line">(</span><span data-testid="content-line">rgbCellUV</span><span data-testid="content-line">,</span><span data-testid="content-line"> color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>Moreover, due to the inner workings of CRTs we highlighted earlier, some <strong>Bloom</strong> may also occur. We can consider this using the <code>Bloom</code> component from <code>@react-three/postprocessing</code>.</p>
<div><div><p data-testid="codesnippet-title">Adding Bloom within our EffectComposer</p></div><pre><div data-testid="line"><p>2</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">const</span><span data-testid="content-line"> spaceship </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">useRef</span><span data-testid="content-line">(</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">const</span><span data-testid="content-line"> effect </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">useRef</span><span data-testid="content-line">(</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">&lt;</span><span data-testid="content-line">group</span><span data-testid="content-line"> </span><span data-testid="content-line">rotation</span><span data-testid="content-line">=</span><span data-testid="content-line">{</span><span data-testid="content-line">[</span><span data-testid="content-line">0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">Math</span><span data-testid="content-line">.</span><span data-testid="content-line">PI</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">2</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0</span><span data-testid="content-line">]</span><span data-testid="content-line">}</span><span data-testid="content-line">&gt;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line">        </span><span data-testid="content-line">&lt;</span><span data-testid="content-line">Spaceship</span><span data-testid="content-line"> </span><span data-testid="content-line">ref</span><span data-testid="content-line">=</span><span data-testid="content-line">{</span><span data-testid="content-line">spaceship</span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">/&gt;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>11</p><p><span><span data-testid="content-line">        </span><span data-testid="content-line">&lt;</span><span data-testid="content-line">RetroEffect</span><span data-testid="content-line"> </span><span data-testid="content-line">ref</span><span data-testid="content-line">=</span><span data-testid="content-line">{</span><span data-testid="content-line">effect</span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">/&gt;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>14</p><p><span><span data-testid="content-line">          </span><span data-testid="content-line">luminanceThreshold</span><span data-testid="content-line">=</span><span data-testid="content-line">{</span><span data-testid="content-line">0.05</span><span data-testid="content-line">}</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>15</p><p><span><span data-testid="content-line">          </span><span data-testid="content-line">luminanceSmoothing</span><span data-testid="content-line">=</span><span data-testid="content-line">{</span><span data-testid="content-line">0.9</span><span data-testid="content-line">}</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>Finally, we can overlay the final output of our custom shader effect with horizontal scanlines running through the screen vertically:</p>
<div><div><p data-testid="codesnippet-title">Simple scanlines added on top of our effect output</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> lines </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">sin</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">2000.0</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> time </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">100.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>We can also include some additional distortion to the UV coordinates of our effect by adding code to the <code>mainUv</code> function of our shader. Adding some slight imperfections like these can make our CRT look even more accurate. Below is a simple example, but feel free to further experiment with more complex distortion patterns:</p>
<div><div><p data-testid="codesnippet-title">Adding distortion in mainUv</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> </span><span data-testid="content-line">noise</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> st</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> b </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">random</span><span data-testid="content-line">(</span><span data-testid="content-line">i </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> c </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">random</span><span data-testid="content-line">(</span><span data-testid="content-line">i </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> d </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">random</span><span data-testid="content-line">(</span><span data-testid="content-line">i </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>10</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> u </span><span data-testid="content-line">=</span><span data-testid="content-line"> f</span><span data-testid="content-line">*</span><span data-testid="content-line">f</span><span data-testid="content-line">*</span><span data-testid="content-line">(</span><span data-testid="content-line">3.0</span><span data-testid="content-line">-</span><span data-testid="content-line">2.0</span><span data-testid="content-line">*</span><span data-testid="content-line">f</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>12</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">return</span><span data-testid="content-line"> </span><span data-testid="content-line">mix</span><span data-testid="content-line">(</span><span data-testid="content-line">a</span><span data-testid="content-line">,</span><span data-testid="content-line"> b</span><span data-testid="content-line">,</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>13</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">(</span><span data-testid="content-line">cfloat </span><span data-testid="content-line">noise</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> st</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>18</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> b </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">random</span><span data-testid="content-line">(</span><span data-testid="content-line">i </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>19</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> c </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">random</span><span data-testid="content-line">(</span><span data-testid="content-line">i </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>20</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> d </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">random</span><span data-testid="content-line">(</span><span data-testid="content-line">i </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>22</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> u </span><span data-testid="content-line">=</span><span data-testid="content-line"> f</span><span data-testid="content-line">*</span><span data-testid="content-line">f</span><span data-testid="content-line">*</span><span data-testid="content-line">(</span><span data-testid="content-line">3.0</span><span data-testid="content-line">-</span><span data-testid="content-line">2.0</span><span data-testid="content-line">*</span><span data-testid="content-line">f</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>24</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">return</span><span data-testid="content-line"> </span><span data-testid="content-line">mix</span><span data-testid="content-line">(</span><span data-testid="content-line">a</span><span data-testid="content-line">,</span><span data-testid="content-line"> b</span><span data-testid="content-line">,</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>25</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">(</span><span data-testid="content-line">c </span><span data-testid="content-line">-</span><span data-testid="content-line"> a</span><span data-testid="content-line">)</span><span data-testid="content-line">*</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>29</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">void</span><span data-testid="content-line"> </span><span data-testid="content-line">mainUv</span><span data-testid="content-line">(</span><span data-testid="content-line">inout</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>30</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> shake </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">noise</span><span data-testid="content-line">(</span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">sin</span><span data-testid="content-line">(</span><span data-testid="content-line">time </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">400.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">100.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0025</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>32</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> a</span><span data-testid="content-line">)</span><span data-testid="content-line">*</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>36</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">void</span><span data-testid="content-line"> </span><span data-testid="content-line">mainUv</span><span data-testid="content-line">(</span><span data-testid="content-line">inout</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>37</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> shake </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">noise</span><span data-testid="content-line">(</span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">sin</span><span data-testid="content-line">(</span><span data-testid="content-line">time </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">400.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">100.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0025</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div>

<p>We&#39;re finally done! Or at least I was satisfied enough to make this the stopping point of this article, you can still experiment and continue to tweak this shader at your heart&#39;s content! You can admire the final version of our retro post-processing effect below, which includes:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Color quantization to reduce the number of colors in our final output.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Pixelization and RGB Cell shadow mask effect to create realistic downsampling typically visible in old CRT displays.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Ordered Dithering which alleviates the low pixel and color count in the output image and gives us back some details of the underlying scene in the form of pixel patterns.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Screen Curvature, scanlines with distortions, bloom, and chromatic aberration as final touches to make our effect <em>pop</em>.</p></li>
</ul>

</section><section id="conclusion-section"><h2 id="conclusion"><a href="#conclusion" aria-hidden="true" tabindex="-1"><span></span></a>Conclusion</h2>
<p>Through the many examples and techniques we covered, I hope this article demonstrated how powerful custom shader effects are and how transformative they can be when applied on top of your own WebGL/3D work. This particular &#34;Retro&#34; effect is, of course, just a particular case of a beautiful effect you can build, a drop in the ocean of what&#39;s possible. The underlying <strong>dithering</strong>, <strong>quantization</strong>, and <strong>pixelization/RGB Cells</strong> that we learned about are applicable on their own as well as infinitely tweakable to make your work stand out in the ever-growing scene of 3D websites and digital art.</p>
<p>I&#39;m looking forward to seeing what you will come up with now that you know pretty much everything I do on the matter (there are no excuses not to build!), there&#39;s a lot you can create by combining the effect and building blocks we&#39;ve just seen. Meanwhile, I&#39;ll keep working through my endless list of shader techniques to study, and the many other post-processing effects and styles I&#39;m trying to mimic. As always, I&#39;ll report back on my findings 😊.</p></section></div></div></div>
  </body>
</html>
