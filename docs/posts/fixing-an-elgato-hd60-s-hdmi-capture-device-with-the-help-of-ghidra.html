<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.downtowndougbrown.com/2024/09/fixing-an-elgato-hd60-s-hdmi-capture-device-with-the-help-of-ghidra/">Original</a>
    <h1>Fixing an Elgato HD60 S HDMI capture device with the help of Ghidra</h1>
    
    <div id="readability-page-1" class="page"><div>
				
<p>This post has a little bit of everything. Hardware diagnostics, some suspiciously similar datasheets from two separate Taiwan chip manufacturers, and firmware reverse engineering. Read on if that sounds like fun!</p>



<p>Lately, I’ve been enjoying watching random electronics repair channels on YouTube. There’s something oddly satisfying about watching someone take a broken device from totally nonfunctional to perfectly working, all by replacing a $0.05 capacitor that has failed shorted or maybe a blown $0.75 IC. Two of my favorite channels about this topic are <a href="https://www.youtube.com/@BuyitFixit" data-type="link" data-id="https://www.youtube.com/@BuyitFixit" target="_blank" rel="noreferrer noopener">Buy it Fix it</a> and <a href="https://www.youtube.com/@StezStixFix" data-type="link" data-id="https://www.youtube.com/@StezStixFix" target="_blank" rel="noreferrer noopener">StezStix Fix?</a>.</p>



<p>The videos inspired me. I thought, “I should totally try this!” So I went on eBay and looked for broken devices. I have a pretty decent understanding of how video encoders and decoders work, so I thought it would be a fun project to try to fix an HDMI capture card. I found a broken Elgato Game Capture HD60 S USB 3.0 device. The listing said that nothing happened when you plugged it in.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hd60s.jpg" target="_blank" rel="noreferrer noopener"><img fetchpriority="high" decoding="async" width="1024" height="680" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hd60s.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hd60s.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hd60s-300x199.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hd60s-768x510.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>When it arrived, I was able to verify exactly what the listing said. Nothing showed up on my computer when I plugged it in. I cracked it open and had a look at what was happening internally when it powered up. I started by poking around at voltages on the board with it plugged in, and it was pretty obvious that something was dragging the power rails down. Little did I know at that point what I was getting myself into.</p>



<p>Honestly I could tell what was getting hot just by feeling around with my finger, but this was a good excuse to use my thermal camera to take some fun pictures.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hot1.jpg" target="_blank" rel="noreferrer noopener"><img decoding="async" width="240" height="320" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hot1.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hot1.jpg 240w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hot1-225x300.jpg 225w" sizes="(max-width: 240px) 100vw, 240px"/></a></figure>



<p>In this one, the red cursor indicating the hottest point in the image is pointing to a small chip in the upper-left corner of the board marked “fiVJVE”.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/fiVJVE.jpg" target="_blank" rel="noreferrer noopener"><img decoding="async" width="300" height="243" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/fiVJVE-300x243.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/fiVJVE-300x243.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/fiVJVE-1024x830.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/fiVJVE-768x623.jpg 768w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/fiVJVE.jpg 1332w" sizes="(max-width: 300px) 100vw, 300px"/></a></figure>



<p>This was pretty clearly some kind of a switching regulator, which I concluded due to its proximity to the “2R2” inductor (meaning 2.2 uH). Measuring the pins, I could see 5V going in, but obviously something was wrong because the voltage at the inductor (the output) was far too low.</p>



<p>There was also another fiVJVE chip on the board, with a pretty much identical circuit next to another 2.2 uH inductor. The circuit was missing a component, but I was pretty sure it was normal because the solder blobs looked like they came that way from the factory. It wasn’t getting hot, but it was also putting out a low voltage so I suspected something was wrong with it too:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/fiVJVE2.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="300" height="219" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/fiVJVE2-300x219.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/fiVJVE2-300x219.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/fiVJVE2-1024x747.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/fiVJVE2-768x560.jpg 768w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/fiVJVE2.jpg 1238w" sizes="(max-width: 300px) 100vw, 300px"/></a></figure>



<p>In the heat image above you can see another area on the board (near the bottom) that was also getting hot. It turns out it was actually originating from the other side:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hot2.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="240" height="320" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hot2.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hot2.jpg 240w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hot2-225x300.jpg 225w" sizes="(max-width: 240px) 100vw, 240px"/></a></figure>



<p>Yeah, that’s my finger in the picture. It helped adjust the levels in the image so the chip that’s getting hot is easier to pinpoint. This chip was labeled PFNI:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/PFNI.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="300" height="216" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/PFNI-300x216.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/PFNI-300x216.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/PFNI-768x554.jpg 768w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/PFNI.jpg 975w" sizes="(max-width: 300px) 100vw, 300px"/></a></figure>



<p>OK, so what could I do with this information? I found two chips that were getting hot, and another chip that likely wasn’t putting out its correct voltage. I started out by trying to identify what they were. Small chips with markings like this can be quite difficult to figure out. Luckily, there are a few SMD marking code search engines out there. Searching <a href="https://smd.yooneed.one/" target="_blank" rel="noreferrer noopener">smd.yooneed.one</a> for fiVJ didn’t result in any exact matches, but it did point out that the code “fi” went with the Fitipower FP6121-IS9P. This led me to <a href="https://www.fitipower.com/en" target="_blank" rel="noreferrer noopener">Fitipower’s website</a>, where I saw they had a bunch of different chips. Using Google’s help I was eventually able to narrow it down to being the FP6373A.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="725" height="315" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image.png 725w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-300x130.png 300w" sizes="(max-width: 725px) 100vw, 725px"/></a></figure>



<p>The pinout made sense on the board, and the fiV marking also matched. Yay! Now I had an idea what I was looking for. The PFNI chip ended up being even easier to identify. Google led me straight to the <a href="https://www.ti.com/product/TPS60403" target="_blank" rel="noreferrer noopener">TI TPS60403DBV voltage inverter</a>:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-1.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="678" height="331" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-1.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-1.png 678w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-1-300x146.png 300w" sizes="(max-width: 678px) 100vw, 678px"/></a></figure>



<p>One thing in common with all of these chips is they were all taking in 5V for their input and I was measuring that their outputs all had a pretty low resistance to ground. I started wondering if maybe someone fried this device by somehow putting more than 5V into it. How they did that, I have no idea.</p>



<p>I wasn’t sure why the other FP6373A regulator wasn’t getting hot. It wasn’t putting out much voltage and nothing else was getting hot on the board, so I decided to try injecting voltage on its output power rail instead to see where the low resistance was coming from. I could deduce its correct output voltage because it was going to a Winbond W25Q32JVSSIQ SPI flash chip rated for 2.7 to 3.6V. I was pretty sure it was on a 3.3V rail. I soldered wires to the regulator’s output and ground and used my bench power supply to inject 2.7V into the circuit with a small controlled current that I could slowly turn up. The idea was that I could find what was getting hot on the board and determine what to blame for this power rail being bad.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/powerinjection.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="549" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/powerinjection.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/powerinjection.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/powerinjection-300x161.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/powerinjection-768x412.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>This process pretty quickly revealed the FP6373A itself as the root problem.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hot3.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="240" height="320" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hot3.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hot3.jpg 240w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/hot3-225x300.jpg 225w" sizes="(max-width: 240px) 100vw, 240px"/></a></figure>



<p>I think maybe during normal operation when it was being supplied with 5V, it was putting itself into some kind of safety shutdown mode and killing its output power rail. The datasheet does mention overcurrent and overtemperature shutdown capability. When I injected voltage directly, the regulator couldn’t shut off the power rail so it had no choice but to get hot and announce “hey, I’m the problem!” through my thermal camera.</p>



<p>This was actually great. I wasn’t totally confident about whether the TI chip was to blame rather than something downstream of it, but since two other chips on the 5V rail were also fried, I thought a good first step would be to replace all three of them and see what would happen. Unfortunately the FP6373A isn’t available at the usual US distributors, but I was able to find it for sale on <a href="https://www.lcsc.com/" target="_blank" rel="noreferrer noopener">LCSC</a> at $0.17 a pop, and the TI chip was conveniently also available there for $0.58. Would it really be this easy? Just replace three chips totaling less than a dollar in value, even in quantities of 1? The shipping and handling was orders of magnitude more expensive than just the parts themselves!</p>



<p>After the parts arrived from China, I was able to successfully replace them. I’m always paranoid about upsetting nearby resistors and capacitors when I’m using hot air, so I like to use Kapton tape to shield everything else.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/removal.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="619" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/removal-1024x619.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/removal-1024x619.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/removal-300x181.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/removal-768x465.jpg 768w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/removal.jpg 1339w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>The process of soldering in the new chips was mostly easy, but the ground pins did soak up quite a bit of heat. I think this PCB design doesn’t have great thermal relief on the grounds. I did accidentally lift a pad for one of the regulators, but it wasn’t connected to anything (the “PG” signal) so there was no harm done. The fact that it wasn’t connected to anything was exactly why it was so easy to lift it. Also, the heat that the ground pin was eating up misled me into thinking I could use the same heat on the other pins.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/soldered.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="643" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/soldered.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/soldered.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/soldered-300x188.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/soldered-768x482.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>In addition to my lifted pad (middle pin on the right), you can see here how much trouble I had soldering the ground pin (middle pin on the left). It really didn’t want to heat up. I probably could have heated the whole board to help my soldering iron out, but hey, it’s connected.</p>



<p>Anyway, after replacing all three chips, it worked! None of the new chips were getting hot, the HD60 S showed up as a USB device when plugged in, and it worked perfectly for capturing and passing through an HDMI signal. I was pretty excited to successfully fix it, but there was still a problem: none of the indicator lights worked. There are seven white LEDs and seven red LEDs, and they are supposed to <a href="https://help.elgato.com/hc/en-us/articles/360058716852-Elgato-Game-Capture-HD60-S-Status-Lights-LEDs" target="_blank" rel="noreferrer noopener">do various things to tell you what’s going on</a>. The white lights are supposed to blink twice when you first plug it in, for example.</p>



<p>This was a little deflating. I had kind of fixed it, but not really. Now what?</p>



<p>Back to the drawing board. I looked closer at the PCB to understand how the LEDs work. The relevant chip is the IT1504, made by <a href="https://www.innochip.com.tw/" target="_blank" rel="noreferrer noopener">Innochip</a>. Looking further at <a href="http://www.innochip.com.tw/datasheet/IT1504.pdf" target="_blank" rel="noreferrer noopener">its datasheet</a>, it is a 16-channel LED driver chip. You talk to it with a serial data interface that appears to be very similar to SPI. It turns out a lot of LED driver chips from many manufacturers such as Toshiba and ST also use this same communication scheme. At first I though it was odd, but it seems pretty standard. It’s a variant of SPI where you send a particular number of clock pulses to choose which command you want to perform.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504probe.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="556" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504probe.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504probe.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504probe-300x163.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504probe-768x417.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>I monitored the relevant data input pins on the IT1504 using my oscilloscope, and I could definitely see some traffic being sent to it. By the way, I followed the traces and discovered that the IT1504 is being controlled by a Nuvoton M031LD2AE microcontroller, which is an ARM Cortex-M0.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/nuvoton.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="300" height="300" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/nuvoton-300x300.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/nuvoton-300x300.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/nuvoton-150x150.jpg 150w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/nuvoton.jpg 512w" sizes="(max-width: 300px) 100vw, 300px"/></a></figure>



<p>The presence of SPI traffic here proved it was at least trying to do <em>something</em>, so I assumed that the LED driver chip was probably fried. That presented a pretty big problem though: how could I find a replacement for the IT1504? It wasn’t stocked anywhere. LCSC didn’t have it, and of course none of the US distributors had it either. I couldn’t even find any sellers on AliExpress or utsource.</p>



<p>I reached out to Innotech, who surprisingly wrote back the next day and kindly offered to send me a few free samples for the price of shipping, but then realized they only have full reels in stock so they couldn’t send me any samples. That was nice of them to check, but I definitely wasn’t going to buy a full reel of IT1504 chips just to fix this one problem.</p>



<p>This pushed me toward a huge search all over the internet for LED drivers to try to find a suitable equivalent replacement. The IT1504 datasheet I had access to didn’t include the full command info, so I wasn’t sure exactly what I was looking for. There were several discontinued parts from other well-known manufacturers that looked similar, but I wasn’t finding any exact matches. That’s when I discovered something really strange.</p>



<p>I somehow stumbled upon <a href="https://www.mblock.com.tw/en" data-type="link" data-id="https://www.mblock.com.tw/en" target="_blank" rel="noreferrer noopener">Macroblock</a>‘s product offerings. Specifically, the MBI5040. The datasheet seemed to match up pretty well with the IT1504. In fact, a little too well. Here is an example of what I mean (click if you want it larger so you can read it):</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-2.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="357" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-2-1024x357.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-2-1024x357.png 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-2-300x105.png 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-2-768x268.png 768w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-2.png 1278w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>Here are a few more side-by-side comparisons to really hit the point home:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-3.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="992" height="1024" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-3-992x1024.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-3-992x1024.png 992w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-3-291x300.png 291w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-3-768x793.png 768w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-3.png 1302w" sizes="(max-width: 992px) 100vw, 992px"/></a></figure>



<p>They’re almost exactly the same! Everything is laid out in precisely the same order. The current output specs differ slightly, but aside from that, they’re the exact same product, right down to having identical block diagrams. The wording has been tweaked here and there, but both of these datasheets are clearly from the same source. These companies are both based in Taiwan. Maybe one of them licensed the design from the other? Or perhaps there is some industrial espionage going on? There is definitely some funky stuff going on with the fonts on the Innochip datasheet’s general description page. It randomly switches around between serif and sans-serif. It’s the kind of thing you notice when you’re reading an email that somebody sent and you can tell they’ve obviously been copying and pasting while writing it. That doesn’t necessarily mean anything, but I thought it was weird.</p>



<p>Heck, even the part numbers are pretty much the same. If you pretend that the capital letter “I” in MBI5040 is really the number 1, you have MB<strong>1504</strong>0 and IT<strong>1504</strong>.</p>



<p>I have no idea which product is the original here, but either way, this was really good news for me. I had successfully discovered another chip that would likely be suitable as a replacement for my assumed-to-be-fried IT1504. Additionally, the MBI5040 datasheet actually had command info, so if it came down to it, I could dive deeper and really try to understand what the SPI traffic was doing. I was able to find the MBI5040GF available for purchase on both AliExpress and utsource, so I bought a few.</p>



<p>Replacing the LED driver chip was a pretty simple job. Once again I used Kapton tape to protect me from myself.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504removed.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="576" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504removed.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504removed.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504removed-300x169.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504removed-768x432.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/solderingreplacement.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1004" height="417" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/solderingreplacement.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/solderingreplacement.jpg 1004w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/solderingreplacement-300x125.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/solderingreplacement-768x319.jpg 768w" sizes="(max-width: 1004px) 100vw, 1004px"/></a></figure>



<p>I was feeling pretty good about my situation at this point. I cleaned up all the flux residue and anxiously plugged in the HD60 S to my computer.</p>



<p>Video capture worked fine, so I didn’t make it any worse, but the lights were still not working! What in the world? Next I started wondering if perhaps the LEDs themselves were broken. I rigged up my bench power supply and a resistor so that I could pass current through them (without the whole device powered on, of course), and the LEDs all tested out fine physically. I was able to light each one up.</p>



<p>I was totally out of ideas at this point. A brand new chip didn’t fix it, and the LEDs were known good. That’s when I started searching on Google and found something shocking: apparently the LEDs going out on these Elgato HD60 S capture cards is a known problem that multiple people have experienced. In particular I found two different Reddit posts with four unique users complaining about running into this same problem:</p>



<ul>
<li><a href="https://www.reddit.com/r/elgato/comments/pcvtqj/why_doesnt_my_elgato_hd60s_light_up/" target="_blank" rel="noreferrer noopener">https://www.reddit.com/r/elgato/comments/pcvtqj/why_doesnt_my_elgato_hd60s_light_up/</a></li>



<li><a href="https://www.reddit.com/r/Twitch/comments/qfdxuu/elgato_hd60_s_can_anyone_help_me_with_this_issue/hhzsvez/" target="_blank" rel="noreferrer noopener">https://www.reddit.com/r/Twitch/comments/qfdxuu/elgato_hd60_s_can_anyone_help_me_with_this_issue/hhzsvez/</a></li>
</ul>



<p>Not only that, but sometime during this whole saga I also bought another “dead” HD60 S on eBay that turned out to work fine but had the exact same LED fault. It was starting to look like this indicator light failure was actually quite common!</p>



<p>So yeah. It’s very likely that the LEDs on this one weren’t working even before the voltage regulators originally got fried. This led me to a new bonus challenge: Could I figure out why the LEDs didn’t work and fix them? After all, I now had two different units both experiencing this failure and I knew of at least four other people with the same problem. If you go to the parent post at the second link above, there’s a video that shows how the white LEDs are expected to flash white twice when you first plug it in.</p>



<p>My first idea was to verify that the actual LED circuitry on the board was functional. To perform this test, I lifted the relevant SPI input pins on my replacement MBI5040 LED driver and soldered wires to them, as well as ground:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/solderedwires1.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1021" height="779" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/solderedwires1.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/solderedwires1.jpg 1021w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/solderedwires1-300x229.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/solderedwires1-768x586.jpg 768w" sizes="(max-width: 1021px) 100vw, 1021px"/></a></figure>



<p>This allowed me to rig something up with a Raspberry Pi Pico to manually control the LEDs by sending the appropriate commands as documented in the MBI5040 datasheet. I’ll let this picture speak for itself:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/litup.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="617" height="1024" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/litup.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/litup.jpg 617w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/litup-181x300.jpg 181w" sizes="(max-width: 617px) 100vw, 617px"/></a></figure>



<p>It was at this point that I became very confident there was nothing physically wrong with my repaired HD60 S at all. I could perfectly control the lights with my Pi Pico, so the circuit was fine. The Nuvoton Cortex-M0 microcontroller was simply never deciding to turn them on.</p>



<p>This whole MBI5040 replacement story was all for nothing! I was so proud of myself for finding a suitable substitute IC, but it was all mostly just a big waste of time. The original chip was probably fine all along. I decided to confirm that theory just to be sure. I put the original IT1504 chip back onto the board. In order to avoid having to bend pins, I covered the 3 pads that I wanted to avoid soldering to the chip with Kapton tape. This kept them insulated, and then I just soldered all of the other pins normally.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504resoldered.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="576" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504resoldered.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504resoldered.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504resoldered-300x169.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504resoldered-768x432.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>Then I resoldered the wires and repeated the experiment with the Pi Pico. No surprises here — the original chip was totally fine too. After I was done tinkering, I simply pulled the Kapton tape out and then was able to solder the remaining 3 pins normally. I thought this solution was pretty clever and saved me some time! Here’s a view after I pulled out the tape, but before I soldered them down.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504resoldered2.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="276" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504resoldered2.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504resoldered2.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504resoldered2-300x81.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/it1504resoldered2-768x207.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>And yes, I know pin 1 looks messy. Once again, it’s a ground pin and I guess they didn’t add thermals on the ground pins on this board. It was a pain to solder. I fixed it up afterward though.</p>



<p>So yeah. The original IT1504 chip worked fine. I was a little annoyed, but this side quest wasn’t entirely a waste of time. Getting ahold of the MBI5040 datasheet importantly gave me a perfect reference for how the LEDs are controlled by software. It was looking more and more like this was a software problem as opposed to a hardware problem. I was invested in this problem at this point. I couldn’t give up now!</p>



<p>I began the next phase of this project with a simple idea: ask Elgato if there is some kind of known issue with the status lights. Maybe there was a setting I was missing that allowed you to disable them. Essentially, they politely told me to take a hike:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-9.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="668" height="180" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-9.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-9.png 668w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-9-300x81.png 300w" sizes="(max-width: 668px) 100vw, 668px"/></a></figure>



<p>That’s okay. I felt like solving it on my own anyway. I decided to focus on understanding what was going on in the firmware running in the Nuvoton M031LD2AE microcontroller. By a stroke of pure luck, I had <a href="https://www.downtowndougbrown.com/2023/09/porting-my-mac-rom-simm-programmer-from-avr-to-arm/" data-type="post" data-id="3566" target="_blank" rel="noreferrer noopener">gained some experience last year with Nuvoton MCUs when working on my Mac ROM SIMM programmer</a>. I already had a <a href="https://www.nuvoton.com/tool-and-software/debugger-and-programmer/1-to-1-debugger-and-programmer/nu-link2-me/" target="_blank" rel="noreferrer noopener">Nu-Link2-Me</a> that was bundled with the dev board I bought for that project. The next step was to figure out how to access the programming pins on the microcontroller. It turns out that there are a couple of small JST connectors on the board: a 4-pin one and a 6-pin one. Tracing out the pins one by one, it quickly became apparent that the 4-pin JST connector was for programming the MCU! I hooked it up using the only 4-pin JST cable I had on hand, which had grabbers on the other end.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/nulink.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="643" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/nulink.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/nulink.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/nulink-300x188.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/nulink-768x482.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>I didn’t check, but I think it’s a pretty good educated guess that the 6-pin JST connector next to it is for programming the Altera MAX II CPLD that is also on this board. It just makes sense.</p>



<p>I didn’t care about the CPLD though. I tried to read the firmware out of the Nuvoton chip using NuMicro ICP Programming Tool, but of course Elgato protected the contents:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-4.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="304" height="180" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-4.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-4.png 304w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-4-300x178.png 300w" sizes="(max-width: 304px) 100vw, 304px"/></a></figure>



<p>Never fear, though. It turns out that Elgato includes the latest firmware with their 4K Capture Utility:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-5.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="878" height="651" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-5.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-5.png 878w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-5-300x222.png 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-5-768x569.png 768w" sizes="(max-width: 878px) 100vw, 878px"/></a></figure>



<p>Reading the included ElgatoDeviceCapabilities.json file in the same folder also provided some insight. This firmware is specifically for the version of the device with USB product ID 118 (0x0076), which definitely matches mine. Elgato refers to this device as the “Game Capture HD60 S Rev.4”:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-6.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="355" height="464" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-6.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-6.png 355w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-6-230x300.png 230w" sizes="(max-width: 355px) 100vw, 355px"/></a></figure>



<p>The firmware was already up to date when I checked in the 4K Capture Utility. You can also control-click the settings icon to enable an Update Firmware button, but it did nothing because the newest firmware was already installed on it:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-7.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="748" height="530" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-7.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-7.png 748w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-7-300x213.png 300w" sizes="(max-width: 748px) 100vw, 748px"/></a></figure>



<p>This was great though! The FW_HD60_S_MCU.bin file looked very much like a normal Cortex-M0 firmware binary. You can tell by looking at the start of it in a hex editor. The very first 4-byte word should be the initial stack pointer, so something in RAM. Then following that is a bunch of interrupt vectors including the reset vector.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-8.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="622" height="262" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-8.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-8.png 622w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-8-300x126.png 300w" sizes="(max-width: 622px) 100vw, 622px"/></a></figure>



<p>This all checked out. 0x20000E70 looks like a valid stack pointer, and each 4-byte word following that looks like a valid flash address. It looks exactly like a Cortex-M0 vector table. I loaded it into <a href="https://ghidra-sre.org/" data-type="link" data-id="https://ghidra-sre.org/" target="_blank" rel="noreferrer noopener">Ghidra</a> and also used <a href="https://github.com/leveldown-security/SVD-Loader-Ghidra" target="_blank" rel="noreferrer noopener">SVD-Loader</a> to try to map out some of the registers. I had to modify the SVD file (M031AE_v1.svd), which I got from the <a href="https://www.keil.arm.com/packs/numicro_dfp-nuvoton/devices/" target="_blank" rel="noreferrer noopener">NuMicro_DFP pack on keil.arm.com</a>, to get it to load with the plugin. Apparently it doesn’t like if you have multiple addressBlocks per peripheral, so I modified the first one in each peripheral to contain the full range of addresses.</p>



<p>And thus began the humongous effort of trying to figure out what this little MCU was actually doing.</p>



<p>The SVD file helped me identify the various peripherals being used: mostly GPIO, a timer, and I<sup>2</sup>C. <a href="https://github.com/OpenNuvoton/M031BSP/" target="_blank" rel="noreferrer noopener">Nuvoton’s M031BSP project</a> was very valuable for identifying a ton of functions. I did it by hand, which was probably slightly insane, but I wasn’t sure what compiler had been used. Since I knew which pins were hooked up to the LED controller chip, I was fairly quickly able to identify functions that control the LEDs. It was hard to understand their purpose in the grand scheme of things though. Sometimes they were buried deep inside multiple layers of function calls.</p>



<p>Knowing that I<sup>2</sup>C was being used was very helpful, because I saw there were other chips onboard that would communicate through it: the ITE IT6802E and IT66121FN. The IT6802E is an HDMI receiver. I don’t have any detailed documentation for it, but I’m pretty sure it converts an incoming HDMI signal into a parallel data stream suitable for the capture portion of the device to read in. The IT66121FN is the opposite. It takes a parallel data stream and sends it out as HDMI. This would be necessary for the passthrough functionality, providing an HDMI output signal to go through to your TV or monitor.</p>



<p>Anyway, I found some ITE driver code in some random GitHub projects <a href="https://github.com/densengithub/DB_C10" target="_blank" rel="noreferrer noopener">such as this one</a>, which quickly helped me identify a bunch of functions and variables as belonging to ITE’s drivers. This helped me gain a better understanding of what was happening in the firmware. I actually spent way too much time on this, but I think it was useful in the long run. Plus, it was good practice with Ghidra.</p>



<p>Once I had a good idea of the overall structure of the firmware, I decided to try figuring out how I could debug the code. The chip was protected, but I figured that I should be able to erase it and reflash the firmware. To be safe, I desoldered the original M031LD2AE chip and put a new empty one onto my board instead. They only cost $1.14 on Digi-Key in quantities of 1. Why not?</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/soldernuvoton.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="576" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/soldernuvoton.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/soldernuvoton.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/soldernuvoton-300x169.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/soldernuvoton-768x432.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>When I flashed FW_HD60_S_MCU.bin onto my brand-new blank chip, it definitely worked fine, but it re-protected itself so I couldn’t do any debugging! The offending code was pretty easy to find in Ghidra. There’s a function that is called to update the config registers with the proper locked state as well as the number of 512-byte data flash pages to reserve from the application ROM.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-10.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="669" height="835" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-10.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-10.png 669w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-10-240x300.png 240w" sizes="(max-width: 669px) 100vw, 669px"/></a></figure>



<p>I simply had to hack this function to always leave the chip unlocked. Then I reflashed the chip and I was finally able to debug the code! I inserted some breakpoints and stepped through the initialization code with OpenOCD and GDB to figure out why the LEDs weren’t being controlled. I found some places in the code where LED control would happen, but they were being skipped. I decided to force the code to run by filling in register values and RAM in GDB, and sure enough, I was able to at least force the lights to turn on. So clearly the code was there to control the lights, but it wasn’t running for whatever reason.</p>



<p>This chip unlocking mess led me down another rabbit hole. I assumed that the original Nuvoton MCU I removed had some other protected contents like a bootloader, so I decided to see if I could extract it by installing my new unlocked firmware file as an update through Elgato’s software. The idea was that after my new unlocked firmware was installed, the protection would be disabled and then I could read out the entire contents with my Nu-Link2-Me. Why would I want to do this? Well, it would just be nice to have as a backup in case I screwed up one of the chips, plus the bootloader might contain other clues.</p>



<p>I tried it out on my <em>other</em> HD60 S with broken LEDs which still had its stock Nuvoton MCU fitted. This required modifying ElgatoDeviceCapabilities.json to point to my unlocked firmware. I also had to change the version listed in this same file so that it would think it was out of date. After making these changes, the 4K Capture Utility allowed to install my new firmware through the normal firmware update mechanism. The utility did tell me the firmware update failed after it finished (more on that later).</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/update3.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="552" height="190" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/update3.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/update3.png 552w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/update3-300x103.png 300w" sizes="(max-width: 552px) 100vw, 552px"/></a></figure>



<p>This totally freaked me out because it appeared to brick the device. It didn’t work as a capture card anymore. But luckily, but I was left with an unlocked chip, just as I had hoped! This allowed me to read out the rest of the content of the flash that had previously been protected, including the LDROM (containing Elgato’s first-stage bootloader), data flash contents, and the correct original config register contents. This was <strong>really</strong> exciting because it meant I now had everything I would need in order to completely program a brand new Nuvoton MCU to contain Elgato’s stock firmware, including their bootloader. I rewrote the original Elgato firmware back to this second HD60 S’s APROM (application ROM) using Nuvoton’s tools, and re-locked the chip. Thankfully, this fully restored it to working order — except for the LEDs of course.</p>



<p>I also disassembled their small LDROM bootloader that I was able to read out of the chip, but it wasn’t really anything exciting. It receives commands and data over I<sup>2</sup>C and is capable of reflashing the APROM. Interestingly I discovered that if the chip is set for unprotected mode, the bootloader actually waits around for update commands instead of booting the application firmware. So Elgato is using the locked/unlocked bit as a way of signifying whether it should stay in the bootloader or not, which I find to be a little bit weird. That completely explained why my second HD60 S stopped working after I installed my unlocked firmware — it was stuck in the bootloader waiting forever because the chip was unprotected.</p>



<p>Anyway, I’ve really started to ramble on about things unrelated to the LED problem. Let’s get back on track. The point I’m trying to make here is that I was able to read out all of the stock microcontroller contents, which gave me the confidence I desperately needed in order to start tinkering even further to figure out the LED problem. I was kind of stuck at this point though. Why was the Nuvoton chip not controlling the LEDs? Some of the LED control happened over I<sup>2</sup>C from something else, so I was beginning to worry that the actual problem was once again at a different level.</p>



<p>Fortunately though, I was gaining a better understanding of the architecture of the entire product at this point. Here’s a broad overview of how it works:</p>



<ul>
<li>The main Cypress/Infineon CYUSB3014 USB 3.0 peripheral chip, which I haven’t mentioned until now, is an ARM926EJ-S. It sends commands to the Nuvoton MCU over I<sup>2</sup>C. This is the chip that actually communicates with the host PC through the USB 3.0 port.</li>



<li>The Nuvoton ARM Cortex-M0 microcontroller sets up and monitors the ITE video receiver and transmitter chips through a separate I<sup>2</sup>C bus.</li>



<li>The Nuvoton MCU also controls the LEDs.</li>



<li>The Nuvoton MCU communicates status information back to the CYUSB3014 through I<sup>2</sup>C.</li>



<li>The CYUSB3014 receives the video data stream from the IT6802E (likely through the MAX II CPLD, putting it in a format suitable for the CYUSB3014 to grab) and sends it to the computer over USB.</li>
</ul>



<p>I thought I would take a break from the Nuvoton chip for a while and start trying to understand the main Cypress processor instead. Yes, as I just mentioned above, there are two different ARM processors working together to implement the video capture functionality. Fortunately, Cypress/Infineon also provides a free SDK for these USB chips. The firmware is stored unprotected in the Winbond W25Q32JVSSIQ flash chip that I talked about very early on when I thought this was purely going to be a hardware repair project.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/spiflash.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="576" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/spiflash.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/spiflash.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/spiflash-300x169.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/spiflash-768x432.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>I desoldered the SPI flash chip and read it back using a programmer. It’s a 4 MB (32-megabit) chip. I also tried to do it in-circuit without removing the chip first, but I didn’t have any luck. I even accidentally knocked a small 0402 0.1 uF decoupling capacitor (seen above on the right) off the PCB while I was trying to clip onto it. Luckily the capacitor wasn’t damaged and I was able to put it right back on.</p>



<p>After dumping the chip contents, I used it to start trying to work my way through understanding what the CYUSB3014 was doing. I was able to use Cypress’s existing SDK binaries to help identify a lot of the functions in the dump. It turns out that the Cypress SDK uses the ThreadX RTOS under the hood.</p>



<p>I really didn’t want to dive deep into this firmware to the same level that I did for the Nuvoton chip though. I was already worn out from that disassembly. At the very least, I was able to see that the Cypress chip sends commands over I<sup>2</sup>C to the Nuvoton chip.</p>



<p>Looking through the rest of the SPI flash dump, I could see that starting at offset 0x300000, there were a bunch of small data chunks that looked like little pictures. Here’s an example:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-11.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="620" height="478" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-11.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-11.png 620w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-11-300x231.png 300w" sizes="(max-width: 620px) 100vw, 620px"/></a></figure>



<p>I couldn’t figure out why there would be little pictures in the flash chip here. What would the purpose be? It made me wonder if maybe it was some kind of small icon, since I’ve seen similar data for icons while analyzing old Mac ROM dumps. Given the context of this blog post, you might be screaming at me right now telling me what this data obviously is, but at the time I was totally oblivious.</p>



<p>I ended up solving this mystery as soon as I started looking into what was going on with five unknown GPIO pins in the firmware on the Nuvoton chip. There were a bunch of functions that controlled these pins, but I wasn’t sure what they did. I traced them out on the PCB and discovered they were going to a <a href="https://www.diodes.com/assets/Datasheets/PI5C3257.pdf">Diodes Incorporated PI5C3257 quad 2:1 mux/demux bus switch</a>.</p>



<p>This was the magic discovery that finally unblocked me. This bus switch is being used to decide whether the CYUSB3014 chip or the Nuvoton microcontroller should be wired up to the SPI flash chip. Prior to this moment, I thought that the SPI flash was entirely dedicated to the CYUSB3014. In reality, the Nuvoton microcontroller takes over control of the SPI flash after the CYUSB3014 has finished booting. This enabled me to disassemble a bunch of new functions which were all related to bit-banging SPI transactions, as well as higher-level functions for SPI flash chip erasing/reading/writing.</p>



<p>A light bulb went off in my head. Yes, these chunks of data in the flash chip <strong>were</strong> pictures! But not in the conventional sense. They were describing the various LED animations. Each set of 16 bytes is an animation frame written to the 14 LEDs. In the example above, a single red LED turns on and six of the seven white LEDs do stuff. The last two bytes in each row are a delay time before moving onto the next frame. The first 16 bytes looked kind of weird though. They looked like they possibly contained some header data for the animation or something.</p>



<p>I also found some code that was reading data from the start of the 0x300000 section, but in my SPI flash dump that section was pretty much completely empty:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-12.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="622" height="285" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-12.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-12.png 622w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-12-300x137.png 300w" sizes="(max-width: 622px) 100vw, 622px"/></a></figure>



<p>Everything was starting to make sense. There was a check in the Nuvoton MCU firmware to see if the first two bytes contained the 16-bit word value 0xAA55:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-17.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="636" height="287" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-17.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-17.png 636w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-17-300x135.png 300w" sizes="(max-width: 636px) 100vw, 636px"/></a></figure>



<p>In my dumps of the SPI flash chip contents from my units with nonfunctional LEDs, that section of the chip was empty. It was programmed as all 0x00. The firmware was bypassing all of the LED control code because expected data wasn’t stored starting at 0x300000 in the flash chip! I confirmed this data was missing on both of the HD60 S devices I was testing with.</p>



<p>Unless I wanted to go overboard trying to figure out how to artificially populate all this data from scratch, I had no choice but to buy a third HD60 S that was confirmed to be fully functional. That’s what I ended up doing. Unfortunately it was an older revision and had a completely different PCB, but it was still based on the CYUSB3014. It also used a Nuvoton microcontroller, but it was a different model. It still had an IT1504 for LED control though, as well as a Winbond SPI flash chip, so that was promising.</p>



<p>I confirmed that its LEDs worked fine, and then I dumped the SPI flash. By this point, I had figured out how to dump the flash contents without any soldering by forcing the CYUSB3014 to boot over USB (removing a jumper on the board) and then uploading a Cypress-provided RAM bootloader capable of dumping the SPI flash (cyfxflashprog.img), but I don’t want to stray too far from the LED issue at this point. Here’s the start of the good data at 0x300000:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-13.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="621" height="463" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-13.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-13.png 621w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-13-300x224.png 300w" sizes="(max-width: 621px) 100vw, 621px"/></a></figure>



<p>Okay, that data makes way more sense. The first 16-bit word (little-endian) is 0xAA55 just like the firmware was looking for. It also has a bunch of other header data, indicating there are 26 different LED animations, and including info about whether they are even animations at all. To be honest, I haven’t figured out what every piece of this data actually means, but each animation has a 16-byte summary. They start at 0x300008. I think the last 4 bytes for each animation are probably a CRC-32 of something.</p>



<p>Also, if you noticed in the original chip dump, there was a section starting at 0x3000B8 with a bunch of 0xE5 bytes. This is the dot correction data that gets loaded into the IT1504. Based on the decompilation above, it’s actually supposed to be at 0x3007F8, which is exactly where it is in the good dump:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-14.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="624" height="62" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-14.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-14.png 624w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-14-300x30.png 300w" sizes="(max-width: 624px) 100vw, 624px"/></a></figure>



<p>The 0x521114A7 that follows is a CRC-32 of the preceding 16 bytes of data.</p>



<p>Further inspection revealed that the data in the SPI flash of the broken devices differed quite a bit. In fact, they were different from each other as well. This led me to believe that the animation data was probably corrupted in them. For example, here’s what the animation at 0x31E000 looks like in the good HD60 S’s dump:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-15.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="621" height="541" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-15.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-15.png 621w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-15-300x261.png 300w" sizes="(max-width: 621px) 100vw, 621px"/></a></figure>



<p>Notice how there is no weird header at the top like the original “picture” I was inspecting from one of the other dumps? It just immediately starts with animation data that is consistent with the rest of the nearby data. It’s also longer. This data makes a lot more sense. On the other hand, it was corrupted in two completely different ways in my two HD60 S devices with nonfunctional LEDs.</p>



<p>Several (but not all) of the animations in my nonworking devices started with a weird “AB 03 12 39” header. I don’t think the header is supposed to be there. Maybe there was a bug in an update procedure or something? The Nuvoton firmware indeed has functions capable of erasing and rewriting data to the SPI flash chip. I’m wondering if that code ended up running and somehow destroying the original contents.</p>



<p>You may be able to guess what I did with this new knowledge. I took the original SPI flash contents from the two devices with nonfunctional status lights, and simply replaced all the LED data starting at 0x300000 with the data from the working one. Then I flashed this new “hybrid” image to the non-working devices. Oh, I should point out that each device has its own unique flash dump. The USB serial number is embedded in there somewhere. So I preferred to preserve the data from 0 to 0x2FFFFF for each individual device.</p>



<p>I wasn’t entirely sure what to expect by trying this. The good SPI flash data came from an older revision of the product with a different Nuvoton microcontroller, but it sure looked like it matched what the newer firmware was looking for.</p>



<p>Here’s a picture of what I saw as soon as I powered one of the problematic devices after I reflashed its SPI flash chip:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/success1.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="768" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/success1.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/success1.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/success1-300x225.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/success1-768x576.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>It freaking worked. The white lights flashed twice, and then the red lights briefly flashed once.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/success2.jpg" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="1024" height="768" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/success2.jpg" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/success2.jpg 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/success2-300x225.jpg 300w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/success2-768x576.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>I think the red flash just means the signal was lost, because it also does it every single time I unplug an HDMI source from it. The older model doesn’t do this red flash on every powerup, but maybe it’s just a firmware difference about whether it should say “signal lost” immediately at startup with nothing plugged in. I’ve seen some mention online of red lights meaning that the signal is HDCP-protected, but I think that’s a different longer red blink which I’ve also seen when I first plug in my iPhone as an HDMI source.</p>



<p>I’ve also noticed that some of the animations that Elgato says it should do, like when I start or stop recording, don’t play on this newer model, even though they work fine with the older model. I haven’t been able to figure out if this is just a known difference with how the newer model works. I may try to get a good SPI flash dump of the correct LED animations from a newer matching model to confirm it for sure, but I have a feeling the animation data will be identical.</p>



<p>I also recently realized that the raw data for each animation is sitting around in C:\Program Files\Elgato\GameCapture\Animations if you have the older Game Capture utility installed, or /Applications/Game Capture HD.app/Contents/Resources/Animations on Mac.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-16.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" decoding="async" width="655" height="786" src="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-16.png" alt="" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-16.png 655w, https://www.downtowndougbrown.com/wp-content/uploads/2024/09/image-16-250x300.png 250w" sizes="(max-width: 655px) 100vw, 655px"/></a></figure>



<p>Looking through each file (01.ani, 02.ani, etc.), it looks like the animation data perfectly matches my dump of the older working device. The bytes for each LED are out of order, but if I reorder them correctly, I can create an identical copy of all of the animation data that I extracted from the good flash chip.</p>



<p>Since those animations live inside the Game Capture app (or next to it), it seems as though the software has the capability to load them into the flash chip. I wonder if that explains how the stored animation data ended up corrupted in the first place. A botched update perhaps? That would make sense to me. Maybe they disabled the ability for their software to upload them after they discovered it was screwing up people’s devices? It might be interesting to disassemble the Windows and/or Mac software and try to figure out how to convince it to directly upload the animations, but I’m honestly out of motivation to do that at this point. It looks like LedCtrlDll.dll might be an interesting file to look at if anyone else is hooked enough to continue diving deeper. It contains classes with interesting names like Ub530LedSpiRom and I2cIO_Ub530. Some quick disassembly in Ghidra indeed shows it creating a 0x80C-byte array for the header data that would go into the flash chip at 0x300000, and populating the contents with the dot correction data.</p>



<p>One last thing I noticed is if I do a firmware update of the HD60 S inside of Elgato’s 4K Capture Utility in Windows, it doesn’t wait long enough. It seems to work fine on Mac, but Windows has some issues. The firmware update is still in progress when it tells me that it failed. If I sit there and wait, eventually the lights flash on the unit and it successfully reboots into the new firmware. If instead I unplug it quickly after Elgato’s software tells me the update failed, I end up with an incomplete flash. I wonder if this has fooled people into bricking their devices? Especially if the status LEDs don’t work at all. I was able to successfully fix this problem by increasing the updateDurationSec in ElgatoDeviceCapabilities.json from 40 to 80. I get the feeling Elgato’s firmware update functionality is a little flaky, at least on Windows. In Elgato’s defense, <a href="https://help.elgato.com/hc/en-us/articles/360027955132-Firmware-updates-and-Elgato-hardware" target="_blank" rel="noreferrer noopener">they specifically recommend <em>not</em> to update firmware on the HD60 S unless their tech support tells you to</a>. And they hide the functionality behind a special key combination when entering the settings screen.</p>



<p>I would like to figure out a way to share how to easily fix the LEDs for anyone else who runs into this problem, but the process is admittedly quite convoluted. It requires you to begin a firmware update (modifying ElgatoDeviceCapabilities.json to even allow you to install an update in the first place) and immediately unplug the device — otherwise the Nuvoton MCU takes control of the SPI flash, and you really need the Cypress chip to be in control in order to reflash its contents. Then, you remove the jumper on the PCB (instructing the Cypress chip to boot from USB), upload cyfxflashprog.img to RAM using download_fx3, and use a modified version of fx3_spitest to download the entire SPI flash contents and replace it with your patched LED section. Those are tools from the CYUSB3014 SDK. Finally, you unplug it, put the jumper back in, plug it back in, and perform a normal firmware update in 4K Capture Utility to restore the firmware back to the Nuvoton chip. You ignore the update failure message and wait another minute or so, and eventually it boots back up with working LEDs. If there ends up being enough interest in recovering these things, it might be possible for me to throw something together to automate the process, or at least provide binaries for everything. It would also be nice to figure out how to use Elgato’s software to directly reprogram the LED animations. For now though, I’m just going to sit back, relax, and celebrate my victory on this!</p>



<p>So in conclusion, yes, it really was that simple. All I needed to do was replace three chips for a total of less than $1 to bring this thing back to life. Every bit of extra time and money I spent on this project after that was all about figuring out a well-known indicator LED problem that really had nothing to do with my actual repair. I put way more effort into this than I should have, and yes I am probably a tiny bit crazy for actually doing this, but at least I now have an answer and fix for why the LEDs don’t work on some of these capture cards. It’s some sort of software/programming/update bug. I’m not sure which. Way to go Elgato!</p>
			  
			</div></div>
  </body>
</html>
