<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://news.ycombinator.com/item?id=41236745">Original</a>
    <h1>Tell HN: Google OAuth consent screen issue could be costing you signups</h1>
    
    <div id="readability-page-1" class="page"><div><td colspan="2"></td><td><div><p>TL;DR: The &#34;Sign in with Google&#34; form doesn&#39;t debounce clicks on the &#34;Continue&#34; button, so it can trigger multiple redirect callbacks, in our case causing 15% of signups to fail. We&#39;ve since reproduced the issue with several other companies&#39; signup flows.</p><p>What&#39;s the issue?</p><p>A few months ago we (Flat.app) noticed that a meaningful fraction of signups-via-Google to our SaaS product were failing. I recently found out why, so I&#39;m sharing this PSA for anyone facing a similar problem.</p><p>If your app supports &#34;Sign in with Google&#34;, it&#39;s likely that new signups will fail if, on Google&#39;s OAuth consent screen, a user clicks &#34;Continue&#34; more than once. The error will probably be inscrutable to the user, depending on your setup, so they may just give up instead of trying again. In our case, we were losing around 15% of signups!</p><p>I encountered this issue while investigating failed signups for our product, but I&#39;ve also reproduced it with other popular products including ChatGPT, Doordash, Expedia, and Snyk, so I assume it&#39;s widespread.</p><p>Some of these products use Auth0, as do we, but others don&#39;t, and they still generate an error of one kind or another.</p><p>For Auth0 specifically, the error is &#34;You may have pressed the back button, refreshed during login, opened too many login dialogs, or there is some issue with cookies, since we couldn&#39;t find your session. Try logging in again from the application and if the problem persists please contact the administrator.&#34; The error tries to be helpful by listing potential causes, but it fails to mention the actual cause. That&#39;s because Auth0 wasn&#39;t aware of this failure mode, based on my correspondence with them.</p><p>Why does this happen?</p><p>After a user clicks &#34;Continue&#34; the first time, Google will respond with a 302 to the callback URL, passing along the authorization code and replaying the OAuth 2.0 state param. If the user clicks &#34;Continue&#34; again, Google will respond again with a 302 to the callback URL. The browser will abort the first pending request and issue a new request to the callback URL. Importantly, the state param is, as it should be, the same in both requests, and it typically incorporates a nonce (see https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics#name-protecting-redirect-based-f). Since the nonce will already have been consumed by the first request, the second request will be rejected.</p><p>Why would a user click &#34;Continue&#34; twice?</p><p>Simple: poor UX in Google&#39;s consent screen. The &#34;Continue&#34; button provides almost no feedback that the click was registered, and the screen provides no feedback that any requests are pending. So, some users will naturally try again, especially if they&#39;re on a slow connection.</p><p>What can Google do?</p><p>Google could disable the &#34;Continue&#34; button with a loading indicator after the first click. That would ensure it&#39;s not possible to click it twice, and it would provide an improved UX by showing the user that something is happening.</p><p>Google&#39;s OAuth consent screen was redesigned at some point in the past few years. Allowing &#34;Continue&#34; to be clicked twice, with no visible feedback, may be an unintended regression.</p><p>What can I do?</p><p>Test this in your own application. Be sure to deauthorize your app before each test run so that you get the OAuth consent screen. You can do that in your Google account&#39;s Data &amp; privacy section.</p><p>Also, check your logs for errors to see if you&#39;re losing signups. See if you can detect this scenario and, if so, provide a better experience to users, e.g., by acknowledging what caused the error and giving them a clearer path to continue.</p></div></td></div></div>
  </body>
</html>
