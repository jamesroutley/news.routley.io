<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://labs.quansight.org/blog/free-threaded-one-year-recap">Original</a>
    <h1>The first year of free-threaded Python</h1>
    
    <div id="readability-page-1" class="page"><div><p>Last week, the CPython developers rolled out CPython 3.14.0b1. This week, PyCon
2025 kicks off in Pittsburgh, PA. Both events mark a significant milestone for
the effort to ship and stabilize free-threaded Python.</p>
<p>This is the story of the first year of that effort and how our team at
Quansight played a key role in enabling experimental use of the free-threaded
build with real production workflows that depend on a complex set of
dependencies.</p>

<p>Support for free-threaded Python unlocks the full compute power of modern
hardware with multicore CPUs and GPUs now commonplace. In the GIL-enabled
build, making full use of parallel algorithms that exploit all available
compute resources in Python requires workarounds and careful tuning. The Python
<code>threading</code> module is often not used because the GIL prevents useful parallel
scaling. Instead, many reach for <code>multiprocessing</code>, but spawning processes is
expensive and communicating across processes often requires making expensive
copies of data that would not be necessary in a multithreaded program where
data is implicitly shared between threads.</p>
<p>Having said that, it is not possible for packages that ship compiled code in
their release distributions to support the free-threaded build out of the box.
Any package shipping native code (many Python packages do that) need to be
audited to ensure the package builds and does not suffer thread-safety issues
that are impossible on the GIL-enabled build.</p>
<p>Disabling the GIL required deep structural changes to the CPython
interpreter. Fully supporting the free-threaded build in existing packages
similarly requires fixing structural issues that until now were not big
problems. Things like use of global state in the implementation of a C extension
for convenience or for performance are no longer safe, since the GIL does not
protect simultaneous access from Python to the global state, allowing undefined
behavior via data races. While it is possible to trigger thread safety issues
like this using the <code>threading</code> module even with the GIL, most of the time the
GIL prevented these issues from surfacing. The free-threaded build makes fixing
these issues much more pressing.</p>
<h2 id="major-accomplishments">Major accomplishments</h2>
<p>Alongside the Python runtime team at Meta, we made significant contributions to
enable support for free-threaded Python in a long list of packages and
projects, including:</p>
<ul>
<li>Packaging and project workflow tools like meson, meson-python, the
setup-python GitHub Actions workflow, packaging, pip, and setuptools.</li>
<li>Bindings generators like Cython, pybind11, f2py, and PyO3.</li>
<li>Foundational packages in the PyData ecosystem like NumPy, SciPy, PyArrow,
Matplotlib, pandas, scikit-learn, and scikit-image.</li>
<li>Top dependencies by PyPI downloads like Pillow, PyYAML, yarl, multidict,
and frozenlist.</li>
</ul>
<p>We are also currently looking at popular packages that don&#39;t yet ship support,
including CFFI, cryptography, PyNaCl, aiohttp, SQLAlchemy, and grpcio as well
as popular libraries for machine learning workflows like safetensors and
tokenizers.</p>
<p>CPython core developers on our team also contributed several major improvements
that will ship in CPython 3.14:</p>
<ul>
<li>The Python <code>warnings</code> module is now thread-safe by default on the
free-threaded build. It can be made thread-safe on the GIL-enabled build
with a configuration option or runtime command-line flag.</li>
<li>Significant thread safety issues in <code>asyncio</code> have been fixed. Our
benchmarks indicate substantially improved parallel scaling of code using
asyncio with a thread pool runner.</li>
<li>Thread safety overhaul in the <code>ctypes</code> module.</li>
<li>Substantial performance improvements for the free-threaded garbage collector.</li>
<li>Helped implement the deferred reference counting scheme used by the
free-threaded interpreter in 3.14.</li>
<li>Implemented several specializations for the adaptive specializing
interpreter and supported shipping optimizations that bring the
single-threaded performance of free-threaded CPython 3.14 within spitting
distance of the GIL-enabled build.</li>
<li>A huge number of smaller bugfixes and thread safety improvements.</li>
</ul>
<p>We&#39;ve also written a <a href="https://py-free-threading.github.io">comprehensive guide</a>
for supporting free-threaded Python in existing apps and packages gleaned from
our experiences. Our hope is that the documentation we&#39;ve written can be a
valuable resource for the &#34;long tail&#34; of packages that people will want to
update to support free-threaded Python in the coming years.</p>
<p>You can also read more about this effort from the team at Meta on the
<a href="https://engineering.fb.com/2025/05/05/developer-tools/enhancing-the-python-ecosystem-with-type-checking-and-free-threading/">Meta engineering blog</a>.</p>
<h2 id="what-is-the-state-of-the-free-threaded-python-ecosystem">What is the state of the free-threaded Python ecosystem?</h2>
<p>At this time last year, when Python 3.13.0b1 shipped, the wider ecosystem of
Python packages was more or less completely broken on the free-threaded build.
Trying to <code>pip install</code> anything but the simplest package with no dependencies
or only pure-Python dependencies would likely lead to build errors. Most of
these issues were not due to fundamental problems but because of unsupported
default options or minor assumptions broken on the free-threaded build.</p>
<p>Together with package maintainers and other contributors in the community,
we have fixed many of these issues and today things are much better. With the
release of Cython 3.1.0, which ships official support for the free-threaded
build, we also helped fix one of the most significant sources of build issues.</p>
<p>We are currently working on packages that ship compiled code but still do not
yet ship free-threaded wheels. You can track our progress using our manually
updated <a href="https://py-free-threading.github.io/tracking/">status tracking table</a>
or using Hugo van Kemenade&#39;s <a href="https://hugovk.github.io/free-threaded-wheels/">automatically updated
tracker</a>.</p>
<h3 id="challenges">Challenges</h3>
<p>As of today, the free-threaded Python build is ready to experiment with. We
need more reports of bad performance and bugs from people with real-world
workflows. Significant performance improvements are possible, particularly in
workflows that make use of multiprocessing and are paying the costs inherent to
that approach. However, many packages still need detailed auditing to discover
thread safety issues. Many Python libraries ship mutable data structures that
will not behave correctly under shared mutating and with no or minimal
documentation on thread safety or multithreaded performance.</p>
<p>As in any change of this magnitude that affects an entire programming language
package ecosystem, we are hitting cases where popular packages do not have the
resources needed to deal with changes needed to support free-threading. This is
particularly true of large legacy packages where few people or even no one
fully understands the code. As a community, we need to understand these issues
in our dependency trees and work towards sustainable maintenance for critical
packages.</p>
<h3 id="how-can-you-help">How can you help?</h3>
<p>Take a look at the <a href="https://py-free-threading.github.io/contributing/">contribution guide</a>
we&#39;ve added to the main free-threading guide. We&#39;re tracking ecosystem-wide
issues and writing the content of the free-threaded guide in the
<a href="https://github.com/Quansight-Labs/free-threaded-compatibility">free-threaded-compatibility</a>
repository hosted on the Quansight-Labs GitHub org.</p>
<p>We also helped launch a <a href="https://discord.gg/rqgHCDqdRr">community Discord</a> to host
discussions about supporting the free-threaded build. Come join us if you&#39;re
interested in helping out!</p>
<h2 id="come-to-our-talk-at-pycon">Come to our talk at PyCon!</h2>
<p>I will be giving <a href="https://us.pycon.org/2025/schedule/presentation/42/">a talk at
PyCon</a> with my teammate
<a href="https://github.com/lysnikolaou">Lysandros Nikolaou</a>. If you&#39;ll be attending
the conference, please come and watch. We&#39;ll be sharing details from our
experiences porting packages to support the free-threaded build. We&#39;re hopeful
that the recording on YouTube will be a lasting valuable resource for the
visual learners of the world.</p>
<p>Personally, I believe the free-threaded build is the future of the language,
and am excited that I get to work full-time on enabling that. I&#39;m also hopeful
that the work we&#39;re doing now will enable future work in the long tail of
packages used every day by millions of developers and dramatically improve the
performance of the language.</p></div></div>
  </body>
</html>
