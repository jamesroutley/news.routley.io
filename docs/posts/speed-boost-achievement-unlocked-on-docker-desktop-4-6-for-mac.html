<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.docker.com/blog/speed-boost-achievement-unlocked-on-docker-desktop-4-6-for-mac/">Original</a>
    <h1>Speed boost achievement unlocked on Docker Desktop 4.6 for Mac</h1>
    
    <div id="readability-page-1" class="page"><div>
	          <article role="article" id="post_29427">
          <header>
            
            
          </header>
          <main>
			  
<h3 id="introducing-virtiofs"><strong>Introducing virtiofs</strong></h3>



<p>The 4.6 release of Docker Desktop for Mac contains a number of changes that drastically improve file sharing performance for macOS users. Firstly, developers now have the option of using a new experimental file sharing implementation called<a href="https://virtio-fs.gitlab.io/"> virtiofs</a> (the current default is gRPC-FUSE). Secondly, improvements have been made to the way that files are synced between the macOS host and Docker VM. During testing with our amazing macOS community of users, we have observed that these changes have reduced the time taken to complete filesystem operations<a href="https://github.com/docker/roadmap/issues/7#issuecomment-1044452206"> by up to 98%</a>.</p>



<p>For developers, these incredible gains in speed mean less time waiting for filesystem operations to complete (or building project-specific workarounds to improve performance) and more time focusing on innovation!</p>



<h3 id="understanding-common-developer-workflows"><strong>Understanding common developer workflows</strong></h3>



<p>A common developer workflow when using technologies like Symfony or React is to edit source code located on the macOS host while running the app itself in a Docker container. The source code is shared between the host and the container by using Docker volumes, with a command like the following:</p>



<p>docker run -v /Users/me:/code -p 8080:8080 my-symfony-app</p>



<p>This allows the developer to edit their source code, save the changes and immediately see the results in their browser. Changes made to files located on the host system must propagate quickly and reliably to the container file system for the developer to optimize productivity and have a good user experience. This is where file sharing performance is absolutely critical.</p>



<h3 id="big-performance-improvements"><strong>Big performance improvements</strong></h3>



<p>Performance is vital when application source code is shared between the host and container. For example when a developer uses the <a href="https://symfony.com/">Symfony PHP framework</a>, edits the source code and then reloads the page in the browser, the web-server in the container must re-read many PHP files stored on the host. When considering that modern dependency management can easily bring 10k ‚Äì 100k files into a project (which linearly increases the performance penalty), this can result in poor performance as the host and container keep in sync via the volume.</p>



<p>The recent changes to Docker Desktop for Mac, including the usage of virtiofs, alleviate this problem and bring drastic improvements to file system performance. Specifically, developers working with an early preview of Docker Desktop 4.6 with virtiofs enabled and changes to file syncing included have observed:</p>



<ul><li>A 90% improvement in the time taken to <a href="https://github.com/docker/roadmap/issues/7#issuecomment-1045986171">complete a 284MB MySQL import</a> (3m 16s to 18s)</li><li>An 87% improvement in the time taken to <a href="https://github.com/docker/roadmap/issues/7#issuecomment-1067941403">run ‚Äòcomposer install‚Äô in a large codebase</a> (1m 27s to 11s)</li><li>An 80% improvement in the time taken to <a href="https://github.com/docker/roadmap/issues/7#issuecomment-1063124441">boot a monolithic Typescript app</a> (1m 30s to 18s)</li></ul>



<p>And here are some of the comments we‚Äôve heard from users:¬†</p>



<ul><li><strong>‚Äú</strong>This works great on my mac mini M1!, running migrations on my laravel instance is now instant‚Ä¶instead of running for minutes.<strong>‚Äù </strong>(Source: <a href="https://github.com/docker/roadmap/issues/7#issuecomment-1048690695">Github user feedback</a>)</li><li><strong>‚Äú</strong>My development setup is ridiculously fast now. Thanks everyone!<strong>‚Äù </strong>(Source: <a href="https://github.com/docker/roadmap/issues/7#issuecomment-1050902469">Github user feedback</a>)</li><li><strong>‚Äú</strong>Looking forward to seeing this enhancement land in a released build. It was like night and day! üôå.‚Äù (Source: <a href="https://github.com/docker/roadmap/issues/7#issuecomment-1051390372">Github user feedback</a>)</li></ul>



<h3 id="how-to-enable-virtiofs"><strong>How to enable virtiofs</strong></h3>



<p>Virtiofs is only available to users of the following macOS versions:</p>



<ul><li>macOS 12.2 and above (for Apple Silicon)</li><li>macOS 12.3 and above (for Intel)</li></ul>



<p>To <a href="https://docs.docker.com/desktop/mac/#experimental-features">enable virtiofs</a> in Docker Desktop:</p>



<ul><li>Ensure that you are using Docker Desktop version 4.6, available <a href="https://docs.docker.com/desktop/mac/release-notes/">here</a></li><li>Navigate to ‚ÄòPreferences‚Äô (the gear icon) &gt; ‚ÄòExperimental Features‚Äô</li><li>Select the ‚ÄòUse the new Virtualization framework‚Äô and ‚ÄòEnable VirtioFS accelerated directory sharing‚Äô toggles</li><li>Click ‚ÄòApply &amp; Restart‚Äô</li></ul>



<figure><img data-attachment-id="29428" data-permalink="https://www.docker.com/blog/speed-boost-achievement-unlocked-on-docker-desktop-4-6-for-mac/screenshot-2022-03-09-at-10-39-21/" data-orig-file="https://www.docker.com/blog/wp-content/uploads/2022/03/Screenshot-2022-03-09-at-10.39.21.png" data-orig-size="1014,661" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="Screenshot-2022-03-09-at-10.39.21" data-image-description="" data-image-caption="" data-medium-file="https://www.docker.com/blog/wp-content/uploads/2022/03/Screenshot-2022-03-09-at-10.39.21-460x300.png" data-large-file="https://www.docker.com/blog/wp-content/uploads/2022/03/Screenshot-2022-03-09-at-10.39.21.png" width="1014" height="661" src="https://www.docker.com/blog/wp-content/uploads/2022/03/Screenshot-2022-03-09-at-10.39.21.png" alt="" srcset="https://www.docker.com/blog/wp-content/uploads/2022/03/Screenshot-2022-03-09-at-10.39.21.png 1014w, https://www.docker.com/blog/wp-content/uploads/2022/03/Screenshot-2022-03-09-at-10.39.21-460x300.png 460w" sizes="(max-width: 1014px) 100vw, 1014px"/></figure>



<h3 id="your-feedback-is-needed"><strong>Your feedback is needed!</strong></h3>



<p>Virtiofs is accessible today within Docker Desktop for Mac (version 4.6) and available to all users including Docker Personal free users as well as <a href="https://www.docker.com/pricing">Docker Pro, Team and Business paid </a>subscription users.¬†</p>



<p>Please download it, give it a try and let us know how it goes. If you discover any problems, please report them on the<a href="https://github.com/docker/roadmap/issues/7"> Mac filesystem performance thread</a> on our public roadmap. For the moment, we are aware of an outstanding issue where containers running with virtiofs can fail due to permission errors. We have released a fix for this in an experimental Desktop build to the <a href="https://github.com/docker/roadmap/issues/7#issuecomment-1068876301">Mac filesystem performance thread</a> and will confirm its stability in the coming days.</p>



<p>Likewise, we‚Äôre always interested to hear of any performance benchmarks that you may use to test out virtiofs !</p>



<p><a href="https://www.docker.com/products/docker-desktop">Download button for Desktop 4.6 </a></p>







<p>We‚Äôd like to say a massive thank you to our macOS community of users for providing brilliant feedback and testing out the feature so rigorously. In particular, the excellent analysis of file system performance conducted by <a href="https://github.com/KJTsanaktsidis">Konstantinos Tsanaktsidis</a> led to valuable insights around file syncing.</p>
          </main>
          
        </article>
		    </div></div>
  </body>
</html>
