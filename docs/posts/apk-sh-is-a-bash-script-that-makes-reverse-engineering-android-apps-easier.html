<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ax/apk.sh">Original</a>
    <h1>Apk.sh is a Bash script that makes reverse engineering Android apps easier</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">apk.sh is a Bash script that makes reverse engineering Android apps easier, automating some repetitive tasks like pulling, decoding, rebuilding and patching an APK.</p>
<h2 dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h2>
<p dir="auto">apk.sh basically uses <a href="https://ibotpeaches.github.io/Apktool/" rel="nofollow">apktool</a> to disassemble, decode and rebuild resources and some bash to automate the <a href="https://https://frida.re/" rel="nofollow">frida</a> gadget injection process.
It also supports app bundles/split APKs.</p>
<ul dir="auto">
<li><g-emoji alias="mushroom" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f344.png">🍄</g-emoji> Patching APKs to load frida-gadget.so on start.</li>
<li><g-emoji alias="new" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f195.png">🆕</g-emoji> Support for app bundles/split APKs.</li>
<li><g-emoji alias="wrench" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f527.png">🔧</g-emoji> Disassembling resources to nearly original form with apktool.</li>
<li><g-emoji alias="nut_and_bolt" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f529.png">🔩</g-emoji> Rebuilding decoded resources back to binary APK/JAR with apktool.</li>
<li><g-emoji alias="old_key" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f5dd.png">🗝️</g-emoji> Code signing the apk with apksigner.</li>
<li><g-emoji alias="desktop_computer" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f5a5.png">🖥️</g-emoji> Multiple arch support (arm, arm64, x86, x86_64).</li>
<li><g-emoji alias="no_mobile_phones" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4f5.png">📵</g-emoji> No rooted Android device needed.</li>
</ul>
<h2 dir="auto"><a id="user-content-getting-started" aria-hidden="true" href="#getting-started"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Getting started</h2>
<p dir="auto"><g-emoji alias="arrow_left" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b05.png">⬅️</g-emoji> Pulling an APK from a device is simple as running <code>./apk.sh pull &lt;package_name&gt;</code></p>
<p dir="auto"><g-emoji alias="wrench" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f527.png">🔧</g-emoji> Decoding an APK is simple as running <code>./apk.sh decode &lt;apk_name&gt;</code></p>
<p dir="auto"><g-emoji alias="nut_and_bolt" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f529.png">🔩</g-emoji> Rebuilding an APK is simple as running  <code>./apk.sh build &lt;apk_dir&gt;</code></p>
<h2 dir="auto"><a id="user-content-apksh-pull" aria-hidden="true" href="#apksh-pull"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>apk.sh pull</h2>
<p dir="auto"><code>apk.sh pull</code> pull an APK from a device.
It supports app bundles/split APKs, which means that split APKs will be joined in a single APK (this is useful for patching).
If the package is an app bundle/split APK, apk.sh will combine the APKs into a single APK, fixing all public resource identifiers.</p>
<h2 dir="auto"><a id="user-content-apksh-patch" aria-hidden="true" href="#apksh-patch"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>apk.sh patch</h2>
<p dir="auto"><code>apk.sh patch</code> patch an APK to load <a href="https://frida.re/docs/gadget/" rel="nofollow">frida-gadget.so</a> on start.</p>
<p dir="auto">frida-gadget.so is a Frida&#39;s shared library meant to be loaded by programs to be instrumented (when the Injected mode of operation isn’t suitable). By simply loading the library it will allow you to interact with it using existing Frida-based tools like frida-trace. It also supports a fully autonomous approach where it can run scripts off the filesystem without any outside communication.</p>
<p dir="auto">Patching an APK is simple as running  <code>./apk.sh patch &lt;apk_name&gt; --arch arm</code>.</p>
<p dir="auto">You can calso specify a Frida gadget configuration in a json <code>./apk.sh patch &lt;apk_name&gt; --arch arm --gadget-conf &lt;config.json&gt;</code></p>
<h2 dir="auto"><a id="user-content-mushroom-fridas-gadget-configurations" aria-hidden="true" href="#mushroom-fridas-gadget-configurations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><g-emoji alias="mushroom" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f344.png">🍄</g-emoji> Frida&#39;s Gadget configurations</h2>
<p dir="auto">In the default interaction, Frida Gadget exposes a frida-server compatible interface, listening on localhost:27042 by default. In order to achieve early instrumentation Frida let Gadget’s constructor function block until you either <code>attach()</code> to the process, or call <code>resume()</code> after going through the usual <code>spawn()</code> -&gt; <code>attach()</code> -&gt; <code>...apply instrumentation...</code> steps.</p>
<p dir="auto">If you don’t want this blocking behavior and want to let the program boot right up, or you’d prefer it listening on a different interface or port, you can customize this through a json configuration file.</p>
<p dir="auto">The default configuration is:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;interaction&#34;: {
    &#34;type&#34;: &#34;listen&#34;,
    &#34;address&#34;: &#34;127.0.0.1&#34;,
    &#34;port&#34;: 27042,
    &#34;on_port_conflict&#34;: &#34;fail&#34;,
    &#34;on_load&#34;: &#34;wait&#34;
  }
}"><pre>{
  <span>&#34;interaction&#34;</span>: {
    <span>&#34;type&#34;</span>: <span><span>&#34;</span>listen<span>&#34;</span></span>,
    <span>&#34;address&#34;</span>: <span><span>&#34;</span>127.0.0.1<span>&#34;</span></span>,
    <span>&#34;port&#34;</span>: <span>27042</span>,
    <span>&#34;on_port_conflict&#34;</span>: <span><span>&#34;</span>fail<span>&#34;</span></span>,
    <span>&#34;on_load&#34;</span>: <span><span>&#34;</span>wait<span>&#34;</span></span>
  }
}</pre></div>
<p dir="auto">You can pass the gadget configuration file to <code>apk.sh</code> with the <code>--gadget-conf</code> option.</p>
<p dir="auto">A typically suggested configuration might be:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;interaction&#34;: {
    &#34;type&#34;: &#34;script&#34;,
    &#34;path&#34;: &#34;/data/local/tmp/script.js&#34;,
    &#34;on_change&#34;:&#34;reload&#34;
  }
}"><pre>{
  <span>&#34;interaction&#34;</span>: {
    <span>&#34;type&#34;</span>: <span><span>&#34;</span>script<span>&#34;</span></span>,
    <span>&#34;path&#34;</span>: <span><span>&#34;</span>/data/local/tmp/script.js<span>&#34;</span></span>,
    <span>&#34;on_change&#34;</span>:<span><span>&#34;</span>reload<span>&#34;</span></span>
  }
}</pre></div>
<p dir="auto">script.js could be something like:</p>
<div dir="auto" data-snippet-clipboard-copy-content="var android_log_write = new NativeFunction(
    Module.getExportByName(null, &#39;__android_log_write&#39;),
    &#39;int&#39;,
    [&#39;int&#39;, &#39;pointer&#39;, &#39;pointer&#39;]
);

var tag = Memory.allocUtf8String(&#34;[frida-sript][ax]&#34;);



var work = function() {
    setTimeout(function() {
        android_log_write(3, tag, Memory.allocUtf8String(&#34;ping @ &#34; + Date.now()));
        work();
    }, 1000);
}
work();

// console.log does not seems to work. see: https://github.com/frida/frida/issues/382
console.log(&#34;console.log&#34;);
console.error(&#34;console.error&#34;);
console.warn(&#34;WARN&#34;);
android_log_write(3, tag, Memory.allocUtf8String(&#34;&gt;--(O.o)-&lt;)&#34;);"><pre><span>var</span> <span>android_log_write</span> <span>=</span> <span>new</span> <span>NativeFunction</span><span>(</span>
    <span>Module</span><span>.</span><span>getExportByName</span><span>(</span><span>null</span><span>,</span> <span>&#39;__android_log_write&#39;</span><span>)</span><span>,</span>
    <span>&#39;int&#39;</span><span>,</span>
    <span>[</span><span>&#39;int&#39;</span><span>,</span> <span>&#39;pointer&#39;</span><span>,</span> <span>&#39;pointer&#39;</span><span>]</span>
<span>)</span><span>;</span>

<span>var</span> <span>tag</span> <span>=</span> <span>Memory</span><span>.</span><span>allocUtf8String</span><span>(</span><span>&#34;[frida-sript][ax]&#34;</span><span>)</span><span>;</span>



<span>var</span> <span>work</span> <span>=</span> <span>function</span><span>(</span><span>)</span> <span>{</span>
    <span>setTimeout</span><span>(</span><span>function</span><span>(</span><span>)</span> <span>{</span>
        <span>android_log_write</span><span>(</span><span>3</span><span>,</span> <span>tag</span><span>,</span> <span>Memory</span><span>.</span><span>allocUtf8String</span><span>(</span><span>&#34;ping @ &#34;</span> <span>+</span> <span>Date</span><span>.</span><span>now</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span>
        <span>work</span><span>(</span><span>)</span><span>;</span>
    <span>}</span><span>,</span> <span>1000</span><span>)</span><span>;</span>
<span>}</span>
<span>work</span><span>(</span><span>)</span><span>;</span>

<span>// console.log does not seems to work. see: https://github.com/frida/frida/issues/382</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;console.log&#34;</span><span>)</span><span>;</span>
<span>console</span><span>.</span><span>error</span><span>(</span><span>&#34;console.error&#34;</span><span>)</span><span>;</span>
<span>console</span><span>.</span><span>warn</span><span>(</span><span>&#34;WARN&#34;</span><span>)</span><span>;</span>
<span>android_log_write</span><span>(</span><span>3</span><span>,</span> <span>tag</span><span>,</span> <span>Memory</span><span>.</span><span>allocUtf8String</span><span>(</span><span>&#34;&gt;--(O.o)-&lt;)&#34;</span><span>)</span><span></span><span>;</span></pre></div>
<p dir="auto"><code>adb push script.js /data/local/tmp</code></p>
<p dir="auto"><code>./apk.sh patch &lt;apk_name&gt; --arch arm --gadget-conf &lt;config.json&gt;</code></p>
<p dir="auto"><code>adb install file.gadget.apk</code></p>
<h2 dir="auto"><a id="user-content-requirements" aria-hidden="true" href="#requirements"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Requirements</h2>
<ul dir="auto">
<li>apktool</li>
<li>apksigner</li>
<li>unxz</li>
<li>zipalign</li>
<li>aapt</li>
<li>adb</li>
</ul>
<h2 dir="auto"><a id="user-content-page_with_curl-links-of-interest" aria-hidden="true" href="#page_with_curl-links-of-interest"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><g-emoji alias="page_with_curl" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4c3.png">📃</g-emoji> Links of Interest</h2>
<p dir="auto"><a href="https://frida.re/docs/gadget/" rel="nofollow">https://frida.re/docs/gadget/</a></p>
<p dir="auto"><a href="https://lief-project.github.io/doc/latest/tutorials/09_frida_lief.html" rel="nofollow">https://lief-project.github.io/doc/latest/tutorials/09_frida_lief.html</a></p>
<p dir="auto"><a href="https://koz.io/using-frida-on-android-without-root/" rel="nofollow">https://koz.io/using-frida-on-android-without-root/</a></p>
<p dir="auto"><a href="https://github.com/sensepost/objection/">https://github.com/sensepost/objection/</a></p>
<p dir="auto"><a href="https://github.com/NickstaDB/patch-apk/">https://github.com/NickstaDB/patch-apk/</a></p>
<p dir="auto"><a href="https://neo-geo2.gitbook.io/adventures-on-security/frida-scripting-guide/frida-scripting-guide" rel="nofollow">https://neo-geo2.gitbook.io/adventures-on-security/frida-scripting-guide/frida-scripting-guide</a></p>
</article>
          </div></div>
  </body>
</html>
