<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nickdrozd.github.io/2023/07/11/python-interface-refactor-challenge.html">Original</a>
    <h1>Python Interface / Refactor Challenge</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    

<p>I have a smallish Python codebase. There is a type that is used ubiquitously throughout: <code>Count</code>. The current definition of the <code>Count</code> type is quite simple:</p>

<figure><pre><code data-lang="python"><span>Count</span> <span>=</span> <span>int</span></code></pre></figure>

<p>That is to say, <code>Count</code> is just a <strong>type alias</strong>.</p>

<p>Right now, a <code>Count</code> is nothing other than a number. However, I would like to start using <strong>algebraic expressions</strong> alongside actual numbers. For instance, instead of the actual number <code>9</code>, there might be an expression like <code>(4 + 5)</code>. Note that <strong>these expressions will be used alongside numbers, and not instead of them</strong>. Numbers and expressions will need to interact with each other, and the exact nature of a particular variable might not be known until runtime. Possibly other kinds of objects might be used later on as well.</p>

<p>Callsites for <code>Count</code> are mostly type-annotated with <code>Count</code>, but occasionally with <code>int</code>. This is because <strong>Mypy</strong> can’t (or won’t) distinguish between a type alias and its defintion. At the same time, there are functions annotated with <code>int</code> that really do require an actual number. So for example, there might be annotations like this:</p>

<figure><pre><code data-lang="python"><span>Count</span> <span>=</span> <span>int</span>

<span>def</span> <span>one_plus_square</span><span>(</span><span>x</span><span>:</span> <span>Count</span><span>)</span> <span>-&gt;</span> <span>Count</span><span>:</span>
    <span>return</span> <span>1</span> <span>+</span> <span>square</span><span>(</span><span>x</span><span>)</span>

<span>def</span> <span>square</span><span>(</span><span>x</span><span>:</span> <span>int</span><span>)</span> <span>-&gt;</span> <span>Count</span><span>:</span>  <span># int should be Count
</span>    <span>return</span> <span>x</span> <span>**</span> <span>2</span>

<span>def</span> <span>print_times</span><span>(</span><span>x</span><span>:</span> <span>Count</span><span>,</span> <span>n</span><span>:</span> <span>int</span><span>)</span> <span>-&gt;</span> <span>None</span><span>:</span>  <span># true int
</span>    <span>for</span> <span>_</span> <span>in</span> <span>range</span><span>(</span><span>n</span><span>):</span>
        <span>print</span><span>(</span><span>x</span><span>)</span></code></pre></figure>



<p><strong>Come up with an outline for a class or interface or whatever that extends the <code>Count</code> type to include <code>int</code>-like objects.</strong> Ideally this should not require extensive changes to existing use-sites. Additionally, <strong>come up with a strategy for actually implementing the changes</strong> (tools to use, etc). Obviously the details of the scenario are rather vague, so the solution can be similarly vague.</p>

<p><strong>Solutions to the challenge will be judged by me according to the following criteria:</strong></p>

<ol>
  <li>Can I, with a reasonable amount of effort, understand and implement the approach?</li>
  <li>Can it be implemented without requiring too many changes to the rest of the code?</li>
</ol>

<p><strong>Winning entries will be posted to this blog at a later date, where they will be read by perhaps a few dozen people. Fame and glory await.</strong></p>

<p>I am primarily interested in <strong>concrete Python-specific</strong> solutions. However, entries of the form <em>“Python sucks, here’s how I would do it in langauge X”</em> will be considered if they are interesting enough.</p>

  </div>
</article>

      </div>
    </div></div>
  </body>
</html>
