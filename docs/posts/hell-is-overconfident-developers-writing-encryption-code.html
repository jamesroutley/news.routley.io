<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://soatok.blog/2025/01/31/hell-is-overconfident-developers-writing-encryption-code/">Original</a>
    <h1>Hell Is Overconfident Developers Writing Encryption Code</h1>
    
    <div id="readability-page-1" class="page"><div>

		<div>

			
<p>Overconfident developers that choose to write their own cryptography code have plagued the information security industry since before it was <em>even an industry</em>.</p>



<p>This in and of itself isn’t inherently a bad thing, despite the infosec truisms about <em>never doing exactly that</em>. Writing crypto code (but not deploying or publishing it!) is <a href="https://www.cryptofails.com/post/75204435608/write-crypto-code-dont-publish-it" target="_blank" rel="noreferrer noopener">an important first step to understanding the algorithms</a>.</p>



<blockquote>
<p><strong>EDIT:</strong> If you haven’t already read the article I linked just now, please stop and do so before continuing.</p>



<p>Quite a few people have posted angry responses to a different argument I’m <em>not even making here</em> because they seem to have missed this prominently placed hyperlink, and consequently assumed a different stance than the one I’m actually taking.</p>
</blockquote>



<p>One trend I’ve noticed (as I <a href="https://soatok.blog/2025/01/20/session-round-2/#:~:text=On%20their%20FAQs%20page%2C%20Session%E2%80%99s%20response%20to%20%E2%80%9Care%20you%20rolling%20your%20own%20cryptography%3F%E2%80%9D%20can%20be%20abbreviated%20to%2C%20%E2%80%9CNo%2C%20we%20use%20libsodium!%E2%80%9D" target="_blank" rel="noreferrer noopener">recently noted about Session</a>) is developers incorrectly insisting that they aren’t rolling their own crypto because they use a lower-level cryptography library.</p>



<blockquote>
<p>“If you want a picture of the future, imagine developers rolling their own crypto–forever.”</p>
<cite>–if George Orwell was an applied cryptography expert</cite></blockquote>



<p>This misdeed isn’t limited to dubious apps that fork end-to-end encrypted messengers to strip off forward secrecy.</p>



<h2 id="startup-grade-crypto">Startup-Grade Cryptography</h2>



<p>Feast your eyes on, <em><a href="https://ghostarchive.org/archive/taW5z" target="_blank" rel="noreferrer noopener">How we share secrets at a fully-remote startup</a></em>–a January 2025 reprint of <a href="https://web.archive.org/web/20240716164008/https://www.getgrist.com/blog/how-we-share-secrets-at-a-fully-remote-startup/" target="_blank" rel="noreferrer noopener">an earlier 2024 blog post</a> about the same cryptography code that originally <a href="https://ghostarchive.org/archive/h8Ylr" target="_blank" rel="noreferrer noopener">fell victim to Bleichenbacher’s 1998 Padding Oracle Attack</a> (which is possibly the oldest pitfall in real-world cryptography).</p>



<p>And, <strong>let me be very clear on this</strong>, the reason I want you to feast your eyes on this is <strong><em>NOT</em></strong> put this person on blast. They are by far not the first person to roll their own cryptography. They aren’t even the first one I’ve seen <em>this week</em>.</p>



<p>But they <em>were</em> kind enough to walk through their code and share their thoughts about what they wrote, and I think that sheds a lot of insight into how people think about cryptographic code.</p>



<p>The blog post in question starts off with a bit humility and the common refrain from security experts:</p>



<blockquote>
<p><strong>Don’t roll your own security</strong></p>



<p>Like many hard areas of human knowledge, security/cryptography is one where the more you know, the more you realize you don’t know.</p>
<cite><a href="https://ghostarchive.org/archive/taW5z">How we share secrets at a fully-remote startup</a></cite></blockquote>



<p>But if you scroll down a bit further, past the code and explanation, you’ll see this too:</p>



<blockquote>
<p><strong>Did we roll our own security?</strong></p>



<p>No, not really. Our solution uses and trusts a lot of cryptography code from good sources: Node.js, its crypto module, and the <a href="https://www.openssl.org/">OpenSSL</a> library it’s based on. These are respected, well-maintained, commonly-used open-source tools, which get plenty of attention from security researchers.</p>
<cite><a href="https://ghostarchive.org/archive/taW5z">How we share secrets at a fully-remote startup</a></cite></blockquote>



<p>Hey, this argument has <a href="https://web.archive.org/web/20250102225433/https://getsession.org/faq#libsodium" target="_blank" rel="noreferrer noopener">a very familiar structure</a>, doesn’t it?</p>



<p>The code in question is <a href="https://github.com/gristlabs/secrets.js/issues/2" target="_blank" rel="noreferrer noopener">just about what you’d expect</a> from a blog post with this sort of cognitive dissonance:</p>



<ul>
<li>It first tries to <a href="https://soatok.blog/2021/01/20/please-stop-encrypting-with-rsa-directly/" target="_blank" rel="noreferrer noopener">encrypt keys directly with RSA</a>.</li>



<li>If it fails, it falls back to encrypting a <em>random symmetric key</em> with RSA, and then using that key to encrypt the message… with <a href="https://www.nccgroup.com/us/research-blog/cryptopals-exploiting-cbc-padding-oracles/" target="_blank" rel="noreferrer noopener">unauthenticated AES-CBC</a>.</li>
</ul>



<p>Oh, and did I mention that other folks tried to talk the author down from rolling their own implementation <a href="https://lobste.rs/s/1nj3wf/how_we_share_secrets_at_fully_remote" target="_blank" rel="noreferrer noopener">the first time around</a> (i.e., six months ago)?</p>



<h2 id="stories-untold">Countless Stories Untold</h2>



<p>As tempting as it may be to dunk on this code or the accompanying blog post, at least they’re being open and transparent.</p>



<blockquote>
<p>Care to wager how many people make similar design mistakes and ship them to production every week, without <em>any</em> oversight from the security community? </p>
</blockquote>



<p>This is the part of the blog post where I could tell any of a dozen stories that would fit very elegantly as a complementary example to that blog post from a startup co-CEO.</p>



<p>Unfortunately, all of my best work is done under NDA.</p>





<p>So, I can’t actually give you any specifics, even if I wanted to. The conversations I’ve experienced over the years would give most infosec neophytes <em>chills</em>. The only silver lining is that I, and my peers, were successful in convincing the developers in question to correct their course.</p>



<p>Here are a few highlights to chew on:</p>



<ul>
<li>I’ve seen people use <code>md5($password)</code> as their key derivation function for libsodium.</li>



<li>I’ve seen people encrypt fields in a database, and then store the decryption key right next to the ciphertext. And then, in a stunning display of brilliance, they wrote decryption logic in SQL so they could query their database over encrypted fields.</li>



<li>At least once, when reviewing an end-to-end encryption project that implemented cryptography in JavaScript intended to run in the web browser, my question of “how do you know which public key to trust?” was answered with something shaped like, “Oh, we just store those in MySQL and fetch them from the server.”</li>
</ul>



<p>When it comes to artisanal cryptography, even large tech companies aren’t impervious to the trappings of ego.</p>





<h2 id="pride-before-yolo">Pride Goeth Before YOLO</h2>



<p>My theory for why this phenomenon keeps happening is simple:</p>



<p><strong>Most people do not fundamentally understand what <em>rolling your own</em> crypto actually means.</strong></p>



<p>Their disagreement comes in layers.</p>



<h3>Misunderstood Scope</h3>



<p>Most critically, “rolling your own crypto” means spending <strong>any</strong> innovation tokens at any level of abstraction on cryptography <em>without</em> adequate assurance of correctness and/or peer review from cryptography experts (preferably ones with at least some experience breaking other implementations).</p>



<p>The admonishment isn’t limited to <a href="https://soatok.blog/2021/02/09/crackpot-cryptography-and-security-theater/" target="_blank" rel="noreferrer noopener">the Crystalline guy</a>!</p>



<p>Just because you outsource your block cipher implementations to your programming language’s <code>crypto</code> module doesn’t mean you’re not rolling your own crypto.</p>



<p>Cryptography doesn’t just exist at the primitive layer. Any protocols that use cryptography are, in fact, crypto! This is both radioactive and hazmat.</p>



<h3>What Even Is “Your Own” Crypto?</h3>



<p>The other big miss from this oft-repeated phrase is: what exactly <em>your own</em> crypto?</p>



<p>Does working with a team obviate the “ownness” of this act?</p>



<p>Is the problem as simple as novelty? Surely not.</p>



<p>If it were as simple as that, adhering to standards would be safe. So why do so many JSON Web Tokens implementations make terrible mistakes?</p>



<h3>There Will Be Tiers</h3>



<p>In my humble opinion, there are multiple layers of this onion: The deeper you slice, the more you will cry.</p>



<ul>
<li><strong>Writing UI code that wraps libsignal to ship E2EE isn’t novel</strong>, but you still want to get your code reviewed by someone with experience with attacking cryptography before you deploy it anywhere.</li>



<li>Writing your own <strong>implementation of standard cryptography protocols?</strong> That’s a little novel. Proceed with caution.</li>



<li><strong>Designing your own cryptography protocol</strong> on top of standard cryptography libraries? This is <em>way</em> more novel than you think it is.</li>



<li><strong>Developing your own cryptography library</strong> out of standard constructions of cryptographic algorithms? Unless you’re already an expert, this is dangerous territory.</li>



<li><strong>Novel constructions</strong> of cryptographic algorithms (like I did informally <a href="https://soatok.blog/2022/12/21/extending-the-aes-gcm-nonce-without-nightmare-fuel/" target="_blank" rel="noreferrer noopener">in this blog post</a>)? You’re already in too deep.</li>



<li><strong>Alternatives to cryptographic algorithms</strong>? Whoa, slow down.</li>



<li><strong>Competing ideas to the foundational mathematics used by modern cryptography?</strong> Unless you have already pierced all the preceding layers successfully, and demonstrated attacks against standards that exist at every corresponding layer, you are probably being a crackpot.</li>
</ul>



<p>When you hear an infosec person say, “Don’t roll your own crypto,” it isn’t immediately clear where they draw the line.</p>







<p>Fundamentally, I believe the core problem here is a lack of available and trustworthy cryptography tools for developers to use.</p>



<p>Whatever opinion you have about OpenSSL, you have to acknowledge it’s a “everything but the kitchen sink”, low-level cryptography library. </p>



<p>“I use OpenSSL” is not sufficient to implement, say, <a href="https://www.rfc-editor.org/rfc/rfc9420.html" target="_blank" rel="noreferrer noopener">Messaging Layer Security (RFC 9420)</a> and also declare you didn’t roll your own crypto.</p>



<p>Tink and libsodium are closer to the ideal, but fall short of being complete, off-the-shelf implementations of high-level protocols for developers to plug into their applications.</p>



<p>Even when cryptography nerds take action, historically, they’ve focused on the easy problems (wrapping standard AEADs with asymmetric cryptography), rather than addressing the harder problems. </p>



<p>Namely: Key management.</p>



<p><strong>This is why I focused on key management first</strong> for <a href="https://soatok.blog/category/technology/open-source/fediverse-e2ee-project/" target="_blank" rel="noreferrer noopener">my Fediverse E2EE project</a>. I’m not even thinking about the actual end-to-end encryption logic again until the key management story is sorted. </p>



<p>Looking at the available tooling to developers offered by their programming languages and package manager ecosystems of open source software, everyone else seems to kick that fucking can down the road–hoping it will be someone else’s problem.</p>



<h3 id="my-hell">Welcome To My Hell</h3>



<p>While I work to deliver a solid, reliable solution to the key management problem for my own end-to-end encryption design, overconfident developers the world over are rolling their own encryption–often while insisting they aren’t doing that.</p>





<p>To err is to be human, but to routinely make preventable mistakes because people with my exact skillset haven’t yet delivered easy-to-use, hard-to-misuse tooling in the programming languages actual developers use–meeting them where they are, as it were?</p>



<p><strong>That’s frustration on a level that would make</strong></p>



<p>And that’s not to say I’m anything special. <a href="https://soatok.blog/2024/09/09/doesnt-matter/">I’m definitely not.</a> But there are many, many people who can do everything I can (except they can do more), and yet this problem persists, as if to spite me.</p>



<p>I can’t help but feel responsible every time someone screws up, despite knowing that my betters (for which there are assuredly many) haven’t succeeded either. I’m not going to give up, but it is very disheartening.</p>



<p>If those who study history are doomed to stand by helplessly while everyone else repeats it, then watching developers reinvent the same vulnerabilities is my curse as a cryptography nerd.</p>





<h2 id="addendum-2025-02-01">Addendum (2025-02-01)</h2>



<p>This post unexpectedly blew up on Reddit / Hacker News / etc. and a few people posted a comment that can be summed up as “What tools should I use?” or “How should I learn this stuff?”</p>



<p>The good news is, I already wrote both of those blog posts before. To wit:</p>



<ul>
<li><a href="https://soatok.blog/2024/11/15/what-to-use-instead-of-pgp/" target="_blank" rel="noreferrer noopener"><em>What To Use Instead of PGP</em></a> details specific cryptographic software to use in order to solve specific use cases.</li>



<li><em><a href="https://soatok.blog/2020/06/10/how-to-learn-cryptography-as-a-programmer/" target="_blank" rel="noreferrer noopener">How to Learn Cryptography As A Programmer</a></em> is an introduction to many of the resources you need to level up on understanding cryptography if you already have a background in software development.</li>
</ul>



<p>In fact, I’ve written a lot of <a href="https://soatok.blog/tag/security-guidance/">security guidance</a> on this very blog. A lot of the questions raised in the comments section of news aggregators about this blog post are already well-answered by my previous blog posts, but I will eventually get rate-limited for spamming replies with links to my past writing. (So, please, take some time and peruse the topics I’ve already covered before asking in a public forum.)</p>



<hr/>



<p>Header art: <a href="https://cmykat.carrd.co/">CMYKat</a> and <a href="https://harubaki.carrd.co/">Harubaki</a>, plus my poor Photoshop skills.</p>

		</div><!-- .entry-content -->

	</div></div>
  </body>
</html>
