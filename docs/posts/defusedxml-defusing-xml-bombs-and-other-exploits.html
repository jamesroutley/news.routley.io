<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/tiran/defusedxml">Original</a>
    <h1>Defusedxml â€“ defusing XML bombs and other exploits</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://pypi.org/project/defusedxml/" rel="nofollow"><img src="https://camo.githubusercontent.com/0416204ca54807547e9104286e7f6a89385e41b02aadc5dea4767dd7803984a9/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f64656675736564786d6c2e737667" alt="Latest Version" data-canonical-src="https://img.shields.io/pypi/v/defusedxml.svg"/></a>
<a href="https://pypi.org/project/defusedxml/" rel="nofollow"><img src="https://camo.githubusercontent.com/f282fe0f40d7bb8444c0628826a276db181400998bb509f7e8e9546cb3d73813/68747470733a2f2f696d672e736869656c64732e696f2f707970692f707976657273696f6e732f64656675736564786d6c2e737667" alt="Supported Python versions" data-canonical-src="https://img.shields.io/pypi/pyversions/defusedxml.svg"/></a>
<a href="https://travis-ci.org/tiran/defusedxml" rel="nofollow"><img src="https://camo.githubusercontent.com/556ee1b674b79ff373cb9d846dc38c330e694ccaab25c6142c26b46d1b35fd2c/68747470733a2f2f7472617669732d63692e6f72672f746972616e2f64656675736564786d6c2e7376673f6272616e63683d6d6173746572" alt="Travis CI" data-canonical-src="https://travis-ci.org/tiran/defusedxml.svg?branch=master"/></a>
<a href="https://codecov.io/github/tiran/defusedxml?branch=master" rel="nofollow"><img src="https://camo.githubusercontent.com/f68bc3c37531977b28096360fb52a19e48eec9f91cf694845f93b481016c8b05/68747470733a2f2f636f6465636f762e696f2f6769746875622f746972616e2f64656675736564786d6c2f636f7665726167652e7376673f6272616e63683d6d6173746572" alt="codecov" data-canonical-src="https://codecov.io/github/tiran/defusedxml/coverage.svg?branch=master"/></a>
<a href="https://pypistats.org/packages/defusedxml" rel="nofollow"><img src="https://camo.githubusercontent.com/f259081381e230924822eeb7d25d5abf58a4b54264ab96254fd1bbaa509b2dc7/68747470733a2f2f696d672e736869656c64732e696f2f707970692f646d2f64656675736564786d6c2e737667" alt="PyPI downloads" data-canonical-src="https://img.shields.io/pypi/dm/defusedxml.svg"/></a>
<a href="https://github.com/psf/black"><img src="https://camo.githubusercontent.com/5bf9e9fa18966df7cb5fac7715bef6b72df15e01a6efa9d616c83f9fcb527fe2/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f636f64652532307374796c652d626c61636b2d3030303030302e737667" alt="Code style: black" data-canonical-src="https://img.shields.io/badge/code%20style-black-000000.svg"/></a></p>
<blockquote>
<p dir="auto">&#34;It&#39;s just XML, what could probably go wrong?&#34;</p>
</blockquote>
<p dir="auto">Christian Heimes &lt;<a href="mailto:christian@python.org">christian@python.org</a>&gt;</p>

<p dir="auto">The results of an attack on a vulnerable XML library can be fairly
dramatic. With just a few hundred <strong>Bytes</strong> of XML data an attacker can
occupy several <strong>Gigabytes</strong> of memory within <strong>seconds</strong>. An attacker
can also keep CPUs busy for a long time with a small to medium size
request. Under some circumstances it is even possible to access local
files on your server, to circumvent a firewall, or to abuse services to
rebound attacks to third parties.</p>
<p dir="auto">The attacks use and abuse less common features of XML and its parsers.
The majority of developers are unacquainted with features such as
processing instructions and entity expansions that XML inherited from
SGML. At best they know about <code>&lt;!DOCTYPE&gt;</code> from experience with HTML but
they are not aware that a document type definition (DTD) can generate an
HTTP request or load a file from the file system.</p>
<p dir="auto">None of the issues is new. They have been known for a long time. Billion
laughs was first reported in 2003. Nevertheless some XML libraries and
applications are still vulnerable and even heavy users of XML are
surprised by these features. It&#39;s hard to say whom to blame for the
situation. It&#39;s too short sighted to shift all blame on XML parsers and
XML libraries for using insecure default settings. After all they
properly implement XML specifications. Application developers must not
rely that a library is always configured for security and potential
harmful data by default.</p>
<p dir="auto">Table of Contents</p>

<div dir="auto"><h3 tabindex="-1" dir="auto">billion laughs / exponential entity expansion</h3><a id="user-content-billion-laughs--exponential-entity-expansion" aria-label="Permalink: billion laughs / exponential entity expansion" href="#billion-laughs--exponential-entity-expansion"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <a href="https://en.wikipedia.org/wiki/Billion_laughs" rel="nofollow">Billion Laughs</a>
attack -- also known as exponential entity expansion --uses multiple
levels of nested entities. The original example uses 9 levels of 10
expansions in each level to expand the string <code>lol</code> to a string of 3 *
10 <sup>9</sup> bytes, hence the name &#34;billion laughs&#34;. The resulting
string occupies 3 GB (2.79 GiB) of memory; intermediate strings require
additional memory. Because most parsers don&#39;t cache the intermediate
step for every expansion it is repeated over and over again. It
increases the CPU load even more.</p>
<p dir="auto">An XML document of just a few hundred bytes can disrupt all services on
a machine within seconds.</p>
<p dir="auto">Example XML:</p>
<div data-snippet-clipboard-copy-content="&lt;!DOCTYPE xmlbomb [
&lt;!ENTITY a &#34;1234567890&#34; &gt;
&lt;!ENTITY b &#34;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&#34;&gt;
&lt;!ENTITY c &#34;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&#34;&gt;
&lt;!ENTITY d &#34;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&#34;&gt;
]&gt;
&lt;bomb&gt;&amp;d;&lt;/bomb&gt;"><pre><code>&lt;!DOCTYPE xmlbomb [
&lt;!ENTITY a &#34;1234567890&#34; &gt;
&lt;!ENTITY b &#34;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&#34;&gt;
&lt;!ENTITY c &#34;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&#34;&gt;
&lt;!ENTITY d &#34;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&#34;&gt;
]&gt;
&lt;bomb&gt;&amp;d;&lt;/bomb&gt;
</code></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">quadratic blowup entity expansion</h3><a id="user-content-quadratic-blowup-entity-expansion" aria-label="Permalink: quadratic blowup entity expansion" href="#quadratic-blowup-entity-expansion"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">A quadratic blowup attack is similar to a <a href="https://en.wikipedia.org/wiki/Billion_laughs" rel="nofollow">Billion
Laughs</a> attack; it abuses
entity expansion, too. Instead of nested entities it repeats one large
entity with a couple of thousand chars over and over again. The attack
isn&#39;t as efficient as the exponential case but it avoids triggering
countermeasures of parsers against heavily nested entities. Some parsers
limit the depth and breadth of a single entity but not the total amount
of expanded text throughout an entire XML document.</p>
<p dir="auto">A medium-sized XML document with a couple of hundred kilobytes can
require a couple of hundred MB to several GB of memory. When the attack
is combined with some level of nested expansion an attacker is able to
achieve a higher ratio of success.</p>
<div data-snippet-clipboard-copy-content="&lt;!DOCTYPE bomb [
&lt;!ENTITY a &#34;xxxxxxx... a couple of ten thousand chars&#34;&gt;
]&gt;
&lt;bomb&gt;&amp;a;&amp;a;&amp;a;... repeat&lt;/bomb&gt;"><pre><code>&lt;!DOCTYPE bomb [
&lt;!ENTITY a &#34;xxxxxxx... a couple of ten thousand chars&#34;&gt;
]&gt;
&lt;bomb&gt;&amp;a;&amp;a;&amp;a;... repeat&lt;/bomb&gt;
</code></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">external entity expansion (remote)</h3><a id="user-content-external-entity-expansion-remote" aria-label="Permalink: external entity expansion (remote)" href="#external-entity-expansion-remote"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Entity declarations can contain more than just text for replacement.
They can also point to external resources by public identifiers or
system identifiers. System identifiers are standard URIs. When the URI
is a URL (e.g. a <code>http://</code> locator) some parsers download the resource
from the remote location and embed them into the XML document verbatim.</p>
<p dir="auto">Simple example of a parsed external entity:</p>
<div data-snippet-clipboard-copy-content="&lt;!DOCTYPE external [
&lt;!ENTITY ee SYSTEM &#34;http://www.python.org/some.xml&#34;&gt;
]&gt;
&lt;root&gt;&amp;ee;&lt;/root&gt;"><pre><code>&lt;!DOCTYPE external [
&lt;!ENTITY ee SYSTEM &#34;http://www.python.org/some.xml&#34;&gt;
]&gt;
&lt;root&gt;&amp;ee;&lt;/root&gt;
</code></pre></div>
<p dir="auto">The case of parsed external entities works only for valid XML content.
The XML standard also supports unparsed external entities with a
<code>NData declaration</code>.</p>
<p dir="auto">External entity expansion opens the door to plenty of exploits. An
attacker can abuse a vulnerable XML library and application to rebound
and forward network requests with the IP address of the server. It
highly depends on the parser and the application what kind of exploit is
possible. For example:</p>
<ul dir="auto">
<li>An attacker can circumvent firewalls and gain access to restricted
resources as all the requests are made from an internal and
trustworthy IP address, not from the outside.</li>
<li>An attacker can abuse a service to attack, spy on or DoS your
servers but also third party services. The attack is disguised with
the IP address of the server and the attacker is able to utilize the
high bandwidth of a big machine.</li>
<li>An attacker can exhaust additional resources on the machine, e.g.
with requests to a service that doesn&#39;t respond or responds with
very large files.</li>
<li>An attacker may gain knowledge, when, how often and from which IP
address an XML document is accessed.</li>
<li>An attacker could send mail from inside your network if the URL
handler supports <code>smtp://</code> URIs.</li>
</ul>
<div dir="auto"><h3 tabindex="-1" dir="auto">external entity expansion (local file)</h3><a id="user-content-external-entity-expansion-local-file" aria-label="Permalink: external entity expansion (local file)" href="#external-entity-expansion-local-file"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">External entities with references to local files are a sub-case of
external entity expansion. It&#39;s listed as an extra attack because it
deserves extra attention. Some XML libraries such as lxml disable
network access by default but still allow entity expansion with local
file access by default. Local files are either referenced with a
<code>file://</code> URL or by a file path (either relative or absolute).
Additionally, lxml&#39;s <code>libxml2</code> has catalog support. XML catalogs like
<code>/etc/xml/catalog</code> are XML files, which map schema URIs to local files.</p>
<p dir="auto">An attacker may be able to access and download all files that can be
read by the application process. This may include critical configuration
files, too.</p>
<div data-snippet-clipboard-copy-content="&lt;!DOCTYPE external [
&lt;!ENTITY ee SYSTEM &#34;file:///PATH/TO/simple.xml&#34;&gt;
]&gt;
&lt;root&gt;&amp;ee;&lt;/root&gt;"><pre><code>&lt;!DOCTYPE external [
&lt;!ENTITY ee SYSTEM &#34;file:///PATH/TO/simple.xml&#34;&gt;
]&gt;
&lt;root&gt;&amp;ee;&lt;/root&gt;
</code></pre></div>

<p dir="auto">This case is similar to external entity expansion, too. Some XML
libraries like Python&#39;s xml.dom.pulldom retrieve document type
definitions from remote or local locations. Several attack scenarios
from the external entity case apply to this issue as well.</p>
<div data-snippet-clipboard-copy-content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;!DOCTYPE html PUBLIC &#34;-//W3C//DTD XHTML 1.0 Transitional//EN&#34;
  &#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&#34;&gt;
&lt;html&gt;
    &lt;head/&gt;
    &lt;body&gt;text&lt;/body&gt;
&lt;/html&gt;"><pre><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;!DOCTYPE html PUBLIC &#34;-//W3C//DTD XHTML 1.0 Transitional//EN&#34;
  &#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&#34;&gt;
&lt;html&gt;
    &lt;head/&gt;
    &lt;body&gt;text&lt;/body&gt;
&lt;/html&gt;
</code></pre></div>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>kind</th>
<th>sax</th>
<th>etree</th>
<th>minidom</th>
<th>pulldom</th>
<th>xmlrpc</th>
</tr>
</thead>
<tbody>
<tr>
<td>billion laughs</td>
<td><strong>Maybe</strong> (1)</td>
<td><strong>Maybe</strong> (1)</td>
<td><strong>Maybe</strong> (1)</td>
<td><strong>Maybe</strong> (1)</td>
<td><strong>Maybe</strong> (1)</td>
</tr>
<tr>
<td>quadratic blowup</td>
<td><strong>Maybe</strong> (1)</td>
<td><strong>Maybe</strong> (1)</td>
<td><strong>Maybe</strong> (1)</td>
<td><strong>Maybe</strong> (1)</td>
<td><strong>Maybe</strong> (1)</td>
</tr>
<tr>
<td>external entity expansion (remote)</td>
<td>False (2)</td>
<td>False (3)</td>
<td>False (4)</td>
<td>False (2)</td>
<td>false</td>
</tr>
<tr>
<td>external entity expansion (local file)</td>
<td>False (2)</td>
<td>False (3)</td>
<td>False (4)</td>
<td>False (2)</td>
<td>false</td>
</tr>
<tr>
<td>DTD retrieval</td>
<td>False (2)</td>
<td>False</td>
<td>False</td>
<td>False (2)</td>
<td>false</td>
</tr>
<tr>
<td>gzip bomb</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td><strong>True</strong></td>
</tr>
<tr>
<td>xpath support (6)</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr>
<td>xsl(t) support (6)</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr>
<td>xinclude support (6)</td>
<td>False</td>
<td><strong>True</strong> (5)</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr>
<td>C library</td>
<td>expat</td>
<td>expat</td>
<td>expat</td>
<td>expat</td>
<td>expat</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">vulnerabilities and features</p>
<ol dir="auto">
<li><a href="https://libexpat.github.io/" rel="nofollow">expat parser</a> &gt;= 2.4.0 has <a href="https://libexpat.github.io/doc/api/latest/#billion-laughs" rel="nofollow">billion
laughs
protection</a>
against XML bombs (CVE-2013-0340). The parser has sensible defaults
for <code>XML_SetBillionLaughsAttackProtectionMaximumAmplification</code> and
<code>XML_SetBillionLaughsAttackProtectionActivationThreshold</code>.</li>
<li>Python &gt;= 3.6.8, &gt;= 3.7.1, and &gt;= 3.8 no longer retrieve local and
remote resources with urllib, see
<a href="https://github.com/python/cpython/issues/61441" data-hovercard-type="issue" data-hovercard-url="/python/cpython/issues/61441/hovercard">bpo-17239</a>.</li>
<li>xml.etree doesn&#39;t expand entities and raises a ParserError when an
entity occurs.</li>
<li>minidom doesn&#39;t expand entities and simply returns the unexpanded
entity verbatim.</li>
<li>Library has (limited) XInclude support but requires an additional
step to process inclusion.</li>
<li>These are features but they may introduce exploitable holes, see
<a href="#other-things-to-consider">Other things to consider</a></li>
</ol>
<div dir="auto"><h3 tabindex="-1" dir="auto">Settings in standard library</h3><a id="user-content-settings-in-standard-library" aria-label="Permalink: Settings in standard library" href="#settings-in-standard-library"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>

<p dir="auto">feature_external_ges (<a href="http://xml.org/sax/features/external-general-entities" rel="nofollow">http://xml.org/sax/features/external-general-entities</a>)</p>
<p dir="auto">feature_external_pes (<a href="http://xml.org/sax/features/external-parameter-entities" rel="nofollow">http://xml.org/sax/features/external-parameter-entities</a>)</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">DOM xml.dom.xmlbuilder.Options</h4><a id="user-content-dom-xmldomxmlbuilderoptions" aria-label="Permalink: DOM xml.dom.xmlbuilder.Options" href="#dom-xmldomxmlbuilderoptions"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">external_parameter_entities</p>
<p dir="auto">external_general_entities</p>
<p dir="auto">external_dtd_subset</p>
<p dir="auto">entities</p>

<p dir="auto">The <a href="https://github.com/tiran/defusedxml">defusedxml package</a>
(<a href="https://pypi.python.org/pypi/defusedxml" rel="nofollow">defusedxml on PyPI</a>) contains
several Python-only workarounds and fixes for denial of service and
other vulnerabilities in Python&#39;s XML libraries. In order to benefit
from the protection you just have to import and use the listed functions
/ classes from the right defusedxml module instead of the original
module. Merely <a href="#defusedxml.xmlrpc">defusedxml.xmlrpc</a> is implemented as
monkey patch.</p>
<p dir="auto">Instead of:</p>
<div data-snippet-clipboard-copy-content="&gt;&gt;&gt; from xml.etree.ElementTree import parse
&gt;&gt;&gt; et = parse(xmlfile)"><pre><code>&gt;&gt;&gt; from xml.etree.ElementTree import parse
&gt;&gt;&gt; et = parse(xmlfile)
</code></pre></div>
<p dir="auto">alter code to:</p>
<div data-snippet-clipboard-copy-content="&gt;&gt;&gt; from defusedxml.ElementTree import parse
&gt;&gt;&gt; et = parse(xmlfile)"><pre><code>&gt;&gt;&gt; from defusedxml.ElementTree import parse
&gt;&gt;&gt; et = parse(xmlfile)
</code></pre></div>
<div dir="auto">
<p dir="auto">Note</p>
<p dir="auto">The defusedxml modules are not drop-in replacements of their stdlib
counterparts. The modules only provide functions and classes related to
parsing and loading of XML. For all other features, use the classes,
functions, and constants from the stdlib modules. For example:</p>
<div data-snippet-clipboard-copy-content="&gt;&gt;&gt; from defusedxml import ElementTree as DET
&gt;&gt;&gt; from xml.etree.ElementTree as ET

&gt;&gt;&gt; root = DET.fromstring(&#34;&lt;root/&gt;&#34;)
&gt;&gt;&gt; root.append(ET.Element(&#34;item&#34;))
&gt;&gt;&gt; ET.tostring(root)
b&#39;&lt;root&gt;&lt;item /&gt;&lt;/root&gt;&#39;"><pre><code>&gt;&gt;&gt; from defusedxml import ElementTree as DET
&gt;&gt;&gt; from xml.etree.ElementTree as ET

&gt;&gt;&gt; root = DET.fromstring(&#34;&lt;root/&gt;&#34;)
&gt;&gt;&gt; root.append(ET.Element(&#34;item&#34;))
&gt;&gt;&gt; ET.tostring(root)
b&#39;&lt;root&gt;&lt;item /&gt;&lt;/root&gt;&#39;
</code></pre></div>
</div>
<p dir="auto">Additionally the package has an <strong>untested</strong> function to monkey patch
all stdlib modules with <code>defusedxml.defuse_stdlib()</code>.</p>
<div dir="auto">
<p dir="auto">Warning</p>
<p dir="auto"><code>defuse_stdlib()</code> should be avoided. It can break third party package or
cause surprising side effects. Instead you should use the parsing
features of defusedxml explicitly.</p>
</div>
<p dir="auto">All functions and parser classes accept three additional keyword
arguments. They return either the same objects as the original functions
or compatible subclasses.</p>
<p dir="auto">forbid_dtd (default: False)</p>
<p dir="auto">forbid_entities (default: True)</p>
<p dir="auto">forbid_external (default: True)</p>

<p dir="auto">DefusedXmlException, DTDForbidden, EntitiesForbidden,
ExternalReferenceForbidden, NotSupportedError</p>
<p dir="auto">defuse_stdlib() (<em>experimental</em>)</p>

<p dir="auto"><strong>NOTE</strong> <code>defusedxml.cElementTree</code> is deprecated and will be removed in
a future release. Import from <code>defusedxml.ElementTree</code> instead.</p>
<p dir="auto">parse(), iterparse(), fromstring(), XMLParser</p>

<p dir="auto">parse(), iterparse(), fromstring(), XMLParser</p>

<p dir="auto">create_parser(), DefusedExpatParser</p>

<p dir="auto">parse(), parseString(), make_parser()</p>

<p dir="auto">parse(), parseString(), DefusedExpatBuilder, DefusedExpatBuilderNS</p>

<p dir="auto">parse(), parseString()</p>

<p dir="auto">parse(), parseString()</p>

<p dir="auto">The fix is implemented as monkey patch for the stdlib&#39;s xmlrpc package
(3.x) or xmlrpclib module (2.x). The function <span>monkey_patch()</span> enables the fixes, <span>unmonkey_patch()</span> removes the patch and puts the
code in its former state.</p>
<p dir="auto">The monkey patch protects against XML related attacks as well as
decompression bombs and excessively large requests or responses. The
default setting is 30 MB for requests, responses and gzip decompression.
You can modify the default by changing the module variable <span>MAX_DATA</span>. A value of <span>-1</span> disables the limit.</p>

<p dir="auto"><strong>DEPRECATED</strong> The module is deprecated and will be removed in a future
release.</p>
<p dir="auto">lxml is safe against most attack scenarios. lxml uses <code>libxml2</code> for
parsing XML. The library has builtin mitigations against billion laughs
and quadratic blowup attacks. The parser allows a limit amount of entity
expansions, then fails. lxml also disables network access by default.
libxml2 <a href="https://lxml.de/FAQ.html#how-do-i-use-lxml-safely-as-a-web-service-endpoint" rel="nofollow">lxml
FAQ</a>
lists additional recommendations for safe parsing, for example counter
measures against compression bombs.</p>
<p dir="auto">The default parser resolves entities and protects against huge trees and
deeply nested entities. To disable entities expansion, use a custom
parser object:</p>
<div data-snippet-clipboard-copy-content="from lxml import etree

parser = etree.XMLParser(resolve_entities=False)
root = etree.fromstring(&#34;&lt;example/&gt;&#34;, parser=parser)"><pre><code>from lxml import etree

parser = etree.XMLParser(resolve_entities=False)
root = etree.fromstring(&#34;&lt;example/&gt;&#34;, parser=parser)
</code></pre></div>
<p dir="auto">The module acts as an <em>example</em> how you could protect code that uses
lxml.etree. It implements a custom Element class that filters out Entity
instances, a custom parser factory and a thread local storage for parser
instances. It also has a check_docinfo() function which inspects a tree
for internal or external DTDs and entity declarations. In order to check
for entities lxml &gt; 3.0 is required.</p>
<p dir="auto">parse(), fromstring() RestrictedElement, GlobalParserTLS,
getDefaultParser(), check_docinfo()</p>

<p dir="auto">The <a href="https://github.com/tiran/defusedexpat">defusedexpat package</a>
(<a href="https://pypi.python.org/pypi/defusedexpat" rel="nofollow">defusedexpat on PyPI</a>) is
no longer supported. <a href="https://libexpat.github.io/" rel="nofollow">expat parser</a> 2.4.0
and newer come with <a href="https://libexpat.github.io/doc/api/latest/#billion-laughs" rel="nofollow">billion laughs
protection</a>
against XML bombs.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">How to avoid XML vulnerabilities</h2><a id="user-content-how-to-avoid-xml-vulnerabilities" aria-label="Permalink: How to avoid XML vulnerabilities" href="#how-to-avoid-xml-vulnerabilities"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Update to Python 3.6.8, 3.7.1, or newer. The SAX and DOM parser do not
load external entities from files or network resources.</p>
<p dir="auto">Update to expat to 2.4.0 or newer. It has <a href="https://libexpat.github.io/doc/api/latest/#billion-laughs" rel="nofollow">billion laughs
protection</a>
with sensible default limits to mitigate billion laughs and quadratic
blowup.</p>
<p dir="auto">Official binaries from python.org use libexpat 2.4.0 since 3.7.12,
3.8.12, 3.9.7, and 3.10.0 (August 2021). Third party vendors may use
older or newer versions of expat. <code>pyexpat.version_info</code> contains the
current runtime version of libexpat. Vendors may have backported fixes
to older versions without bumping the version number.</p>
<p dir="auto">Example:</p>
<div data-snippet-clipboard-copy-content="import sys
import pyexpat

has_mitigations = (
    sys.version_info &gt;= (3, 7, 1) and
    pyexpat.version_info &gt;= (2, 4, 0)
)"><pre><code>import sys
import pyexpat

has_mitigations = (
    sys.version_info &gt;= (3, 7, 1) and
    pyexpat.version_info &gt;= (2, 4, 0)
)
</code></pre></div>

<ul dir="auto">
<li>Don&#39;t allow DTDs</li>
<li>Don&#39;t expand entities</li>
<li>Don&#39;t resolve externals</li>
<li>Limit parse depth</li>
<li>Limit total input size</li>
<li>Limit parse time</li>
<li>Favor a SAX or iterparse-like parser for potential large data</li>
<li>Validate and properly quote arguments to XSL transformations and
XPath queries</li>
<li>Don&#39;t use XPath expression from untrusted sources</li>
<li>Don&#39;t apply XSL transformations that come untrusted sources</li>
</ul>
<p dir="auto">(based on Brad Hill&#39;s <a href="https://www.isecpartners.com/media/12976/iSEC-HILL-Attacking-XML-Security-bh07.pdf" rel="nofollow">Attacking XML
Security</a>)</p>

<p dir="auto">XML, XML parsers and processing libraries have more features and
possible issue that could lead to DoS vulnerabilities or security
exploits in applications. I have compiled an incomplete list of
theoretical issues that need further research and more attention. The
list is deliberately pessimistic and a bit paranoid, too. It contains
things that might go wrong under daffy circumstances.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">attribute blowup / hash collision attack</h3><a id="user-content-attribute-blowup--hash-collision-attack" aria-label="Permalink: attribute blowup / hash collision attack" href="#attribute-blowup--hash-collision-attack"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">XML parsers may use an algorithm with quadratic runtime O(n
<sup>2</sup>) to handle attributes and namespaces. If it uses hash
tables (dictionaries) to store attributes and namespaces the
implementation may be vulnerable to hash collision attacks, thus
reducing the performance to O(n <sup>2</sup>) again. In either case an
attacker is able to forge a denial of service attack with an XML
document that contains thousands upon thousands of attributes in a
single node.</p>
<p dir="auto">I haven&#39;t researched yet if expat, pyexpat or libxml2 are vulnerable.</p>

<p dir="auto">The issue of decompression bombs (aka <a href="https://en.wikipedia.org/wiki/Zip_bomb" rel="nofollow">ZIP
bomb</a>) apply to all XML
libraries that can parse compressed XML stream like gzipped HTTP streams
or LZMA-ed files. For an attacker it can reduce the amount of
transmitted data by three magnitudes or more. Gzip is able to compress 1
GiB zeros to roughly 1 MB, lzma is even better:</p>
<div data-snippet-clipboard-copy-content="$ dd if=/dev/zero bs=1M count=1024 | gzip &gt; zeros.gz
$ dd if=/dev/zero bs=1M count=1024 | lzma -z &gt; zeros.xy
$ ls -sh zeros.*
1020K zeros.gz
 148K zeros.xy"><pre><code>$ dd if=/dev/zero bs=1M count=1024 | gzip &gt; zeros.gz
$ dd if=/dev/zero bs=1M count=1024 | lzma -z &gt; zeros.xy
$ ls -sh zeros.*
1020K zeros.gz
 148K zeros.xy
</code></pre></div>
<p dir="auto">None of Python&#39;s standard XML libraries decompress streams except for
<code>xmlrpclib</code>. The module is vulnerable
&lt;<a href="https://bugs.python.org/issue16043" rel="nofollow">https://bugs.python.org/issue16043</a>&gt; to decompression bombs.</p>
<p dir="auto">lxml can load and process compressed data through libxml2 transparently.
libxml2 can handle even very large blobs of compressed data efficiently
without using too much memory. But it doesn&#39;t protect applications from
decompression bombs. A carefully written SAX or iterparse-like approach
can be safe.</p>

<p dir="auto"><a href="https://en.wikipedia.org/wiki/Processing_Instruction" rel="nofollow">PI</a>&#39;s like:</p>
<div data-snippet-clipboard-copy-content="&lt;?xml-stylesheet type=&#34;text/xsl&#34; href=&#34;style.xsl&#34;?&gt;"><pre><code>&lt;?xml-stylesheet type=&#34;text/xsl&#34; href=&#34;style.xsl&#34;?&gt;
</code></pre></div>
<p dir="auto">may impose more threats for XML processing. It depends if and how a
processor handles processing instructions. The issue of URL retrieval
with network or local file access apply to processing instructions, too.</p>

<p dir="auto"><a href="https://en.wikipedia.org/wiki/Document_Type_Definition" rel="nofollow">DTD</a> has more
features like <code>&lt;!NOTATION&gt;</code>. I haven&#39;t researched how these features may
be a security threat.</p>

<p dir="auto">XPath statements may introduce DoS vulnerabilities. Code should never
execute queries from untrusted sources. An attacker may also be able to
create an XML document that makes certain XPath queries costly or
resource hungry.</p>

<p dir="auto">XPath injeciton attacks pretty much work like SQL injection attacks.
Arguments to XPath queries must be quoted and validated properly,
especially when they are taken from the user. The page <a href="http://www.ibm.com/developerworks/xml/library/x-xpathinjection/index.html" rel="nofollow">Avoid the
dangers of XPath
injection</a>
list some ramifications of XPath injections.</p>
<p dir="auto">Python&#39;s standard library doesn&#39;t have XPath support. Lxml supports
parameterized XPath queries which does proper quoting. You just have to
use its xpath() method correctly:</p>
<div data-snippet-clipboard-copy-content="# DON&#39;T
&gt;&gt;&gt; tree.xpath(&#34;/tag[@id=&#39;%s&#39;]&#34; % value)

# instead do
&gt;&gt;&gt; tree.xpath(&#34;/tag[@id=$tagid]&#34;, tagid=name)"><pre><code># DON&#39;T
&gt;&gt;&gt; tree.xpath(&#34;/tag[@id=&#39;%s&#39;]&#34; % value)

# instead do
&gt;&gt;&gt; tree.xpath(&#34;/tag[@id=$tagid]&#34;, tagid=name)
</code></pre></div>

<p dir="auto"><a href="https://www.w3.org/TR/xinclude/#include_element" rel="nofollow">XML Inclusion</a> is
another way to load and include external files:</p>
<div data-snippet-clipboard-copy-content="&lt;root xmlns:xi=&#34;http://www.w3.org/2001/XInclude&#34;&gt;
  &lt;xi:include href=&#34;filename.txt&#34; parse=&#34;text&#34; /&gt;
&lt;/root&gt;"><pre><code>&lt;root xmlns:xi=&#34;http://www.w3.org/2001/XInclude&#34;&gt;
  &lt;xi:include href=&#34;filename.txt&#34; parse=&#34;text&#34; /&gt;
&lt;/root&gt;
</code></pre></div>
<p dir="auto">This feature should be disabled when XML files from an untrusted source
are processed. Some Python XML libraries and libxml2 support XInclude
but don&#39;t have an option to sandbox inclusion and limit it to allowed
directories.</p>

<p dir="auto">A validating XML parser may download schema files from the information
in a <code>xsi:schemaLocation</code> attribute.</p>
<div data-snippet-clipboard-copy-content="&lt;ead xmlns=&#34;urn:isbn:1-931666-22-9&#34;
     xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;
     xsi:schemaLocation=&#34;urn:isbn:1-931666-22-9 http://www.loc.gov/ead/ead.xsd&#34;&gt;
&lt;/ead&gt;"><pre><code>&lt;ead xmlns=&#34;urn:isbn:1-931666-22-9&#34;
     xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;
     xsi:schemaLocation=&#34;urn:isbn:1-931666-22-9 http://www.loc.gov/ead/ead.xsd&#34;&gt;
&lt;/ead&gt;
</code></pre></div>

<p dir="auto">You should keep in mind that XSLT is a Turing complete language. Never
process XSLT code from unknown or untrusted source! XSLT processors may
allow you to interact with external resources in ways you can&#39;t even
imagine. Some processors even support extensions that allow read/write
access to file system, access to JRE objects or scripting with Jython.</p>
<p dir="auto">Example from <a href="https://www.isecpartners.com/media/12976/iSEC-HILL-Attacking-XML-Security-bh07.pdf" rel="nofollow">Attacking XML
Security</a>
for Xalan-J:</p>
<div data-snippet-clipboard-copy-content="&lt;xsl:stylesheet version=&#34;1.0&#34;
 xmlns:xsl=&#34;http://www.w3.org/1999/XSL/Transform&#34;
 xmlns:rt=&#34;http://xml.apache.org/xalan/java/java.lang.Runtime&#34;
 xmlns:ob=&#34;http://xml.apache.org/xalan/java/java.lang.Object&#34;
 exclude-result-prefixes= &#34;rt ob&#34;&gt;
 &lt;xsl:template match=&#34;/&#34;&gt;
   &lt;xsl:variable name=&#34;runtimeObject&#34; select=&#34;rt:getRuntime()&#34;/&gt;
   &lt;xsl:variable name=&#34;command&#34;
     select=&#34;rt:exec($runtimeObject, &amp;apos;c:\Windows\system32\cmd.exe&amp;apos;)&#34;/&gt;
   &lt;xsl:variable name=&#34;commandAsString&#34; select=&#34;ob:toString($command)&#34;/&gt;
   &lt;xsl:value-of select=&#34;$commandAsString&#34;/&gt;
 &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;"><pre><code>&lt;xsl:stylesheet version=&#34;1.0&#34;
 xmlns:xsl=&#34;http://www.w3.org/1999/XSL/Transform&#34;
 xmlns:rt=&#34;http://xml.apache.org/xalan/java/java.lang.Runtime&#34;
 xmlns:ob=&#34;http://xml.apache.org/xalan/java/java.lang.Object&#34;
 exclude-result-prefixes= &#34;rt ob&#34;&gt;
 &lt;xsl:template match=&#34;/&#34;&gt;
   &lt;xsl:variable name=&#34;runtimeObject&#34; select=&#34;rt:getRuntime()&#34;/&gt;
   &lt;xsl:variable name=&#34;command&#34;
     select=&#34;rt:exec($runtimeObject, &amp;apos;c:\Windows\system32\cmd.exe&amp;apos;)&#34;/&gt;
   &lt;xsl:variable name=&#34;commandAsString&#34; select=&#34;ob:toString($command)&#34;/&gt;
   &lt;xsl:value-of select=&#34;$commandAsString&#34;/&gt;
 &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</code></pre></div>

<p dir="auto">CVE-2013-1664</p>
<p dir="auto">CVE-2013-1665</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Other languages / frameworks</h2><a id="user-content-other-languages--frameworks" aria-label="Permalink: Other languages / frameworks" href="#other-languages--frameworks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Several other programming languages and frameworks are vulnerable as
well. A couple of them are affected by the fact that libxml2 up to 2.9.0
has no protection against quadratic blowup attacks. Most of them have
potential dangerous default settings for entity expansion and external
entities, too.</p>

<p dir="auto">Perl&#39;s XML::Simple is vulnerable to quadratic entity expansion and
external entity expansion (both local and remote).</p>

<p dir="auto">Ruby&#39;s REXML document parser is vulnerable to entity expansion attacks
(both quadratic and exponential) but it doesn&#39;t do external entity
expansion by default. In order to counteract entity expansion you have
to disable the feature:</p>
<div data-snippet-clipboard-copy-content="REXML::Document.entity_expansion_limit = 0"><pre><code>REXML::Document.entity_expansion_limit = 0
</code></pre></div>
<p dir="auto">libxml-ruby and hpricot don&#39;t expand entities in their default
configuration.</p>

<p dir="auto">PHP&#39;s SimpleXML API is vulnerable to quadratic entity expansion and
loads entities from local and remote resources. The option
<code>LIBXML_NONET</code> disables network access but still allows local file
access. <code>LIBXML_NOENT</code> seems to have no effect on entity expansion in
PHP 5.4.6.</p>

<p dir="auto">Information in <a href="https://msdn.microsoft.com/en-us/magazine/ee335713.aspx" rel="nofollow">XML DoS and Defenses
(MSDN)</a> suggest
that .NET is vulnerable with its default settings. The article contains
code snippets how to create a secure XML reader:</p>
<div data-snippet-clipboard-copy-content="XmlReaderSettings settings = new XmlReaderSettings();
settings.ProhibitDtd = false;
settings.MaxCharactersFromEntities = 1024;
settings.XmlResolver = null;
XmlReader reader = XmlReader.Create(stream, settings);"><pre><code>XmlReaderSettings settings = new XmlReaderSettings();
settings.ProhibitDtd = false;
settings.MaxCharactersFromEntities = 1024;
settings.XmlResolver = null;
XmlReader reader = XmlReader.Create(stream, settings);
</code></pre></div>

<p dir="auto">Untested. The documentation of Xerces and its <a href="https://xerces.apache.org/xerces2-j/javadocs/xerces2/org/apache/xerces/util/SecurityManager.html" rel="nofollow">Xerces
SecurityMananger</a>
sounds like Xerces is also vulnerable to billion laugh attacks with its
default settings. It also does entity resolving when an
<code>org.xml.sax.EntityResolver</code> is configured. I&#39;m not yet sure about the
default setting here.</p>
<p dir="auto">Java specialists suggest to have a custom builder factory:</p>
<div data-snippet-clipboard-copy-content="DocumentBuilderFactory builderFactory = DocumentBuilderFactory.newInstance();
builderFactory.setXIncludeAware(False);
builderFactory.setExpandEntityReferences(False);
builderFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, True);
# either
builderFactory.setFeature(&#34;http://apache.org/xml/features/disallow-doctype-decl&#34;, True);
# or if you need DTDs
builderFactory.setFeature(&#34;http://xml.org/sax/features/external-general-entities&#34;, False);
builderFactory.setFeature(&#34;http://xml.org/sax/features/external-parameter-entities&#34;, False);
builderFactory.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, False);
builderFactory.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-dtd-grammar&#34;, False);"><pre><code>DocumentBuilderFactory builderFactory = DocumentBuilderFactory.newInstance();
builderFactory.setXIncludeAware(False);
builderFactory.setExpandEntityReferences(False);
builderFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, True);
# either
builderFactory.setFeature(&#34;http://apache.org/xml/features/disallow-doctype-decl&#34;, True);
# or if you need DTDs
builderFactory.setFeature(&#34;http://xml.org/sax/features/external-general-entities&#34;, False);
builderFactory.setFeature(&#34;http://xml.org/sax/features/external-parameter-entities&#34;, False);
builderFactory.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, False);
builderFactory.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-dtd-grammar&#34;, False);
</code></pre></div>

<ul dir="auto">
<li>DOM: Use xml.dom.xmlbuilder options for entity handling</li>
<li>SAX: take feature_external_ges and feature_external_pes (?) into
account</li>
<li>test experimental monkey patching of stdlib modules</li>
<li>improve documentation</li>
</ul>

<p dir="auto">Copyright (c) 2013-2023 by Christian Heimes &lt;<a href="mailto:christian@python.org">christian@python.org</a>&gt;</p>
<p dir="auto">Licensed to PSF under a Contributor Agreement.</p>
<p dir="auto">See <a href="https://www.python.org/psf/license" rel="nofollow">https://www.python.org/psf/license</a> for licensing details.</p>

<p dir="auto">Brett Cannon (Python Core developer)</p>
<p dir="auto">Antoine Pitrou (Python Core developer)</p>
<p dir="auto">Aaron Patterson, Ben Murphy and Michael Koziarski (Ruby community)</p>
<p dir="auto">Thierry Carrez (OpenStack)</p>
<p dir="auto">Carl Meyer (Django)</p>
<p dir="auto">Daniel Veillard (libxml2)</p>
<p dir="auto">semantics GmbH (<a href="https://www.semantics.de/" rel="nofollow">https://www.semantics.de/</a>)</p>

<ul dir="auto">
<li><a href="https://msdn.microsoft.com/en-us/magazine/ee335713.aspx" rel="nofollow">XML DoS and Defenses
(MSDN)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Billion_laughs" rel="nofollow">Billion Laughs</a> on
Wikipedia</li>
<li><a href="https://en.wikipedia.org/wiki/Zip_bomb" rel="nofollow">ZIP bomb</a> on Wikipedia</li>
<li><a href="http://www.ibm.com/developerworks/xml/library/x-tipcfsx/index.html" rel="nofollow">Configure SAX parsers for secure
processing</a></li>
<li><a href="https://www.owasp.org/index.php/Testing_for_XML_Injection_(OWASP-DV-008)" rel="nofollow">Testing for XML
Injection</a></li>
</ul>


<p dir="auto"><em>Release date: 2023</em></p>
<ul dir="auto">
<li>Fix testing without lxml</li>
<li>Test on 3.13-dev and PyPy 3.9</li>
</ul>

<p dir="auto"><em>Release date: 29-Sep-2023</em></p>
<ul dir="auto">
<li>Silence deprecation warning in <span>defuse_stdlib</span>.</li>
<li>Update lxml safety information</li>
</ul>

<p dir="auto"><em>Release date: 26-Sep-2023</em></p>
<ul dir="auto">
<li>Drop support for Python 2.7, 3.4, and 3.5.</li>
<li>Test on 3.10, 3.11, and 3.12.</li>
<li>Add <code>defusedxml.ElementTree.fromstringlist()</code></li>
<li>Update <em>vulnerabilities and features</em> table in README.</li>
<li><strong>Pending removal</strong> The <code>defusedxml.lxml</code> module has been
unmaintained and deprecated since 2019. The module will be removed
in the next version.</li>
<li><strong>Pending removal</strong> The <code>defusedxml.cElementTree</code> will be removed in
the next version. Please use <code>defusedxml.ElementTree</code> instead.</li>
</ul>

<p dir="auto"><em>Release date: 08-Mar-2021</em></p>
<ul dir="auto">
<li>Fix regression <code>defusedxml.ElementTree.ParseError</code> (#63) The
<code>ParseError</code> exception is now the same class object as
<code>xml.etree.ElementTree.ParseError</code> again.</li>
</ul>

<p dir="auto"><em>Release date: 4-Mar-2021</em></p>
<ul dir="auto">
<li>No changes</li>
</ul>

<p dir="auto"><em>Release date: 12-Jan-2021</em></p>
<ul dir="auto">
<li>Re-add and deprecate <code>defusedxml.cElementTree</code></li>
<li>Use GitHub Actions instead of TravisCI</li>
<li>Restore <code>ElementTree</code> attribute of <code>xml.etree</code> module after patching</li>
</ul>

<p dir="auto"><em>Release date: 04-May-2020</em></p>
<ul dir="auto">
<li>Add support for Python 3.9</li>
<li><code>defusedxml.cElementTree</code> is not available with Python 3.9.</li>
<li>Python 2 is deprecate. Support for Python 2 will be removed in
0.8.0.</li>
</ul>

<p dir="auto"><em>Release date: 17-Apr-2019</em></p>
<ul dir="auto">
<li>Increase test coverage.</li>
<li>Add badges to README.</li>
</ul>

<p dir="auto"><em>Release date: 14-Apr-2019</em></p>
<ul dir="auto">
<li>Test on Python 3.7 stable and 3.8-dev</li>
<li>Drop support for Python 3.4</li>
<li>No longer pass <em>html</em> argument to XMLParse. It has been deprecated
and ignored for a long time. The DefusedXMLParser still takes a html
argument. A deprecation warning is issued when the argument is False
and a TypeError when it&#39;s True.</li>
<li>defusedxml now fails early when pyexpat stdlib module is not
available or broken.</li>
<li>defusedxml.ElementTree.__all__ now lists ParseError as public
attribute.</li>
<li>The defusedxml.ElementTree and defusedxml.cElementTree modules had a
typo and used XMLParse instead of XMLParser as an alias for
DefusedXMLParser. Both the old and fixed name are now available.</li>
</ul>

<p dir="auto"><em>Release date: 07-Feb-2017</em></p>
<ul dir="auto">
<li>No changes</li>
</ul>

<p dir="auto"><em>Release date: 28-Jan-2017</em></p>
<ul dir="auto">
<li>Add compatibility with Python 3.6</li>
<li>Drop support for Python 2.6, 3.1, 3.2, 3.3</li>
<li>Fix lxml tests (XMLSyntaxError: Detected an entity reference loop)</li>
</ul>

<p dir="auto"><em>Release date: 28-Mar-2013</em></p>
<ul dir="auto">
<li>Add more demo exploits, e.g. python_external.py and Xalan XSLT
demos.</li>
<li>Improved documentation.</li>
</ul>

<p dir="auto"><em>Release date: 25-Feb-2013</em></p>
<ul dir="auto">
<li>As per <a href="http://seclists.org/oss-sec/2013/q1/340" rel="nofollow">http://seclists.org/oss-sec/2013/q1/340</a> please REJECT
CVE-2013-0278, CVE-2013-0279 and CVE-2013-0280 and use
CVE-2013-1664, CVE-2013-1665 for OpenStack/etc.</li>
<li>Add missing parser_list argument to sax.make_parser(). The argument
is ignored, though. (thanks to Florian Apolloner)</li>
<li>Add demo exploit for external entity attack on Python&#39;s SAX parser,
XML-RPC and WebDAV.</li>
</ul>

<p dir="auto"><em>Release date: 19-Feb-2013</em></p>
<ul dir="auto">
<li>Improve documentation</li>
</ul>

<p dir="auto"><em>Release date: 15-Feb-2013</em></p>
<ul dir="auto">
<li>Rename ExternalEntitiesForbidden to ExternalReferenceForbidden</li>
<li>Rename defusedxml.lxml.check_dtd() to check_docinfo()</li>
<li>Unify argument names in callbacks</li>
<li>Add arguments and formatted representation to exceptions</li>
<li>Add forbid_external argument to all functions and classes</li>
<li>More tests</li>
<li>LOTS of documentation</li>
<li>Add example code for other languages (Ruby, Perl, PHP) and parsers
(Genshi)</li>
<li>Add protection against XML and gzip attacks to xmlrpclib</li>
</ul>

<p dir="auto"><em>Release date: 08-Feb-2013</em></p>
<ul dir="auto">
<li>Initial and internal release for PSRT review</li>
</ul>
</article></div></div>
  </body>
</html>
