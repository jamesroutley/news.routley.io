<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/google-deepmind/searchless_chess">Original</a>
    <h1>Grandmaster-Level Chess Without Search</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/google-deepmind/searchless_chess/master/overview.svg"><img src="https://raw.githubusercontent.com/google-deepmind/searchless_chess/master/overview.svg" alt="Overview figure"/></a>
</p>
<p dir="auto">This repository provides an implementation of our paper <a href="https://arxiv.org/abs/2402.04494" rel="nofollow">Grandmaster-Level Chess Without Search</a>.</p>
<blockquote>
<p dir="auto">The recent breakthrough successes in machine learning are mainly attributed to scale: namely large-scale attention-based architectures and datasets of unprecedented scale.
This paper investigates the impact of training at scale for chess.
Unlike traditional chess engines that rely on complex heuristics, explicit search, or a combination of both, we train a 270M parameter transformer model with supervised learning on a dataset of 10 million chess games.
We annotate each board in the dataset with action-values provided by the powerful Stockfish 16 engine, leading to roughly 15 billion data points.
Our largest model reaches a Lichess blitz Elo of 2895 against humans, and successfully solves a series of challenging chess puzzles, without any domain-specific tweaks or explicit search algorithms.
We also show that our model outperforms AlphaZero&#39;s policy and value networks (without MCTS) and GPT-3.5-turbo-instruct.
A systematic investigation of model and dataset size shows that strong chess performance only arises at sufficient scale.
To validate our results, we perform an extensive series of ablations of design choices and hyperparameters.</p>
</blockquote>

<div data-snippet-clipboard-copy-content=".
|
├── BayesElo                        - Elo computation (need to be installed)
|
├── checkpoints                     - Model checkpoints (need to be downloaded)
|   ├── 136M
|   ├── 270M
|   └── 9M
|
├── data                            - Datasets (need to be downloaded)
|   ├── eco_openings.csv
|   ├── test
|   ├── train
|   └── puzzles.csv
|
├── lc0                             - Leela Chess Zero (needs to be installed)
|
├── src
|   ├── engines
|   |   ├── engine.py               - Engine interface
|   |   ├── lc0_engine.py           - Leela Chess Zero engine
|   |   ├── neural_engines.py       - Neural engines
|   |   └── stockfish_engine.py     - Stockfish engine
|   |
|   ├── bagz.py                     - Readers for our .bag data files
|   ├── config.py                   - Experiment configurations
|   ├── constants.py                - Constants, interfaces, and types
|   ├── data_loader.py              - Data loader
|   ├── metrics_evaluator.py        - Metrics (e.g., Kendall&#39;s tau) evaluator
|   ├── puzzles.py                  - Puzzle evaluation script
|   ├── searchless_chess.ipynb      - Model analysis notebook
|   ├── tokenizer.py                - Chess board tokenization
|   ├── tournament.py               - Elo tournament script
|   ├── train.py                    - Example training + evaluation script
|   ├── training.py                 - Training loop
|   ├── training_utils.py           - Training utility functions
|   ├── transformer.py              - Decoder-only Transformer
|   └── utils.py                    - Utility functions
|
├── Stockfish                       - Stockfish (needs to be installed)
|
├── README.md
└── requirements.txt                - Dependencies"><pre><code>.
|
├── BayesElo                        - Elo computation (need to be installed)
|
├── checkpoints                     - Model checkpoints (need to be downloaded)
|   ├── 136M
|   ├── 270M
|   └── 9M
|
├── data                            - Datasets (need to be downloaded)
|   ├── eco_openings.csv
|   ├── test
|   ├── train
|   └── puzzles.csv
|
├── lc0                             - Leela Chess Zero (needs to be installed)
|
├── src
|   ├── engines
|   |   ├── engine.py               - Engine interface
|   |   ├── lc0_engine.py           - Leela Chess Zero engine
|   |   ├── neural_engines.py       - Neural engines
|   |   └── stockfish_engine.py     - Stockfish engine
|   |
|   ├── bagz.py                     - Readers for our .bag data files
|   ├── config.py                   - Experiment configurations
|   ├── constants.py                - Constants, interfaces, and types
|   ├── data_loader.py              - Data loader
|   ├── metrics_evaluator.py        - Metrics (e.g., Kendall&#39;s tau) evaluator
|   ├── puzzles.py                  - Puzzle evaluation script
|   ├── searchless_chess.ipynb      - Model analysis notebook
|   ├── tokenizer.py                - Chess board tokenization
|   ├── tournament.py               - Elo tournament script
|   ├── train.py                    - Example training + evaluation script
|   ├── training.py                 - Training loop
|   ├── training_utils.py           - Training utility functions
|   ├── transformer.py              - Decoder-only Transformer
|   └── utils.py                    - Utility functions
|
├── Stockfish                       - Stockfish (needs to be installed)
|
├── README.md
└── requirements.txt                - Dependencies
</code></pre></div>

<p dir="auto">Clone the source code into a local directory:</p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/google-deepmind/searchless_chess.git
cd searchless_chess"><pre>git clone https://github.com/google-deepmind/searchless_chess.git
<span>cd</span> searchless_chess</pre></div>
<p dir="auto">This repository requires Python 3.10.
<code>pip install -r requirements.txt</code> will install all required dependencies.
This is best done inside a <a href="https://www.anaconda.com/" rel="nofollow">conda environment</a>.
To that end, install <a href="https://www.anaconda.com/download#downloads" rel="nofollow">Anaconda</a>.
Then, create and activate the conda environment:</p>
<div dir="auto" data-snippet-clipboard-copy-content="conda create --name searchless_chess python=3.10
conda activate searchless_chess"><pre>conda create --name searchless_chess python=3.10
conda activate searchless_chess</pre></div>
<p dir="auto">Install <code>pip</code> and use it to install all the dependencies:</p>
<div dir="auto" data-snippet-clipboard-copy-content="conda install pip
pip install -r requirements.txt"><pre>conda install pip
pip install -r requirements.txt</pre></div>
<p dir="auto">If you have a GPU available (highly recommended for fast training), then you can install JAX with CUDA support.</p>
<div dir="auto" data-snippet-clipboard-copy-content="pip install --upgrade &#34;jax[cuda12_pip]&#34; -f https://storage.googleapis.com/jax-releases/jax_cuda_releases.html"><pre>pip install --upgrade <span><span>&#34;</span>jax[cuda12_pip]<span>&#34;</span></span> -f https://storage.googleapis.com/jax-releases/jax_cuda_releases.html</pre></div>
<p dir="auto">Note that the jax version must correspond to the existing CUDA installation you wish to use (CUDA 12 in the example above).
Please see the <a href="https://github.com/google/jax#installation">JAX documentation</a> for more details.</p>

<p dir="auto">Download and compile the latest version of Stockfish (for Unix-like systems):</p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/official-stockfish/Stockfish.git
cd Stockfish/src
make -j profile-build ARCH=x86-64-avx2
cd ../.."><pre>git clone https://github.com/official-stockfish/Stockfish.git
<span>cd</span> Stockfish/src
make -j profile-build ARCH=x86-64-avx2
<span>cd</span> ../..</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Installing Leela Chess Zero</h3><a id="user-content-installing-leela-chess-zero" aria-label="Permalink: Installing Leela Chess Zero" href="#installing-leela-chess-zero"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Follow the <a href="https://github.com/LeelaChessZero/lc0?tab=readme-ov-file#downloading-source">Lc0 download instructions</a>, i.e.,</p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone -b release/0.30 --recurse-submodules https://github.com/LeelaChessZero/lc0.git"><pre>git clone -b release/0.30 --recurse-submodules https://github.com/LeelaChessZero/lc0.git</pre></div>
<p dir="auto">Then build the engine as described in the <a href="https://github.com/LeelaChessZero/lc0?tab=readme-ov-file#building-and-running-lc0">Lc0 build instructions</a>.</p>
<p dir="auto">We evaluate Lc0 with the largest-possible network from <a href="https://lczero.org/play/networks/bestnets/" rel="nofollow">Lc0&#39;s model catalogue</a>, i.e., the <code>Large</code> network.
To download that network, run the following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cd lc0/build/release
wget https://storage.lczero.org/files/768x15x24h-t82-swa-7464000.pb.gz
gzip -d 768x15x24h-t82-swa-7464000.pb.gz
cd ../../.."><pre><span>cd</span> lc0/build/release
wget https://storage.lczero.org/files/768x15x24h-t82-swa-7464000.pb.gz
gzip -d 768x15x24h-t82-swa-7464000.pb.gz
<span>cd</span> ../../..</pre></div>

<p dir="auto">To compute the Elos for the different agents, we require <a href="https://www.remi-coulom.fr/Bayesian-Elo/" rel="nofollow">BayesElo</a>, which can be installed as follows:</p>
<div dir="auto" data-snippet-clipboard-copy-content="wget https://www.remi-coulom.fr/Bayesian-Elo/bayeselo.tar.bz2
tar -xvjf bayeselo.tar.bz2
cd BayesElo
make bayeselo
cd .."><pre>wget https://www.remi-coulom.fr/Bayesian-Elo/bayeselo.tar.bz2
tar -xvjf bayeselo.tar.bz2
<span>cd</span> BayesElo
make bayeselo
<span>cd</span> ..</pre></div>

<p dir="auto">To download our datasets to the correct locations, run the following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cd data
./download.sh
cd .."><pre><span>cd</span> data
./download.sh
<span>cd</span> ..</pre></div>
<p dir="auto">We also provide the individual dataset download links in the following table
(the action-value dataset is sharded into 2148 files due to its size and only
the link to the first shard is listed below):</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Split</th>
<th>Action-Value</th>
<th>Behavioral Cloning</th>
<th>State-Value</th>
<th>Puzzles</th>
</tr>
</thead>
<tbody>
<tr>
<td>Train</td>
<td><a href="https://storage.googleapis.com/searchless_chess/data/train/action_value-00000-of-02148_data.bag" rel="nofollow">1.2 GB</a> (of 1.1 TB)</td>
<td><a href="https://storage.googleapis.com/searchless_chess/data/train/behavioral_cloning_data.bag" rel="nofollow">34 GB</a></td>
<td><a href="https://storage.googleapis.com/searchless_chess/data/train/state_value_data.bag" rel="nofollow">36 GB</a></td>
<td>-</td>
</tr>
<tr>
<td>Test</td>
<td><a href="https://storage.googleapis.com/searchless_chess/data/test/action_value_data.bag" rel="nofollow">141 MB</a></td>
<td><a href="https://storage.googleapis.com/searchless_chess/data/test/behavioral_cloning_data.bag" rel="nofollow">4.1 MB</a></td>
<td><a href="https://storage.googleapis.com/searchless_chess/data/test/state_value_data.bag" rel="nofollow">4.4 MB</a></td>
<td><a href="https://storage.googleapis.com/searchless_chess/data/puzzles.csv" rel="nofollow">4.5 MB</a></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div dir="auto"><h3 tabindex="-1" dir="auto">Downloading the Model Checkpoints</h3><a id="user-content-downloading-the-model-checkpoints" aria-label="Permalink: Downloading the Model Checkpoints" href="#downloading-the-model-checkpoints"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To download the pretrained models to the correct locations, run the following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cd checkpoints
./download.sh
cd .."><pre><span>cd</span> checkpoints
./download.sh
<span>cd</span> ..</pre></div>

<p dir="auto">Before running any code, make sure to activate the conda environment and set the <code>PYTHONPATH</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="conda activate searchless_chess
export PYTHONPATH=$(pwd)/.."><pre>conda activate searchless_chess
<span>export</span> PYTHONPATH=<span><span>$(</span>pwd<span>)</span></span>/..</pre></div>

<p dir="auto">To train a model locally, run the following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cd src
python train.py
cd .."><pre><span>cd</span> src
python train.py
<span>cd</span> ..</pre></div>
<p dir="auto">The model checkpoints will be saved to <code>/checkpoints/local</code>.</p>

<p dir="auto">To evaluate a model&#39;s puzzle accuracy, run the following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cd src
python puzzles.py --num_puzzles 10 --agent=local
cd .."><pre><span>cd</span> src
python puzzles.py --num_puzzles 10 --agent=local
<span>cd</span> ..</pre></div>
<p dir="auto"><code>puzzles.py</code> supports the following agents:</p>
<ul dir="auto">
<li>the locally trained model: <code>local</code></li>
<li>the pretrained models: <code>9M</code>, <code>136M</code>, and <code>270M</code></li>
<li>the Stockfish engines: <code>stockfish</code> and <code>stockfish_all_moves</code></li>
<li>the Lc0 engines: <code>leela_chess_zero_depth_1</code>, <code>leela_chess_zero_policy_net</code>, and <code>leela_chess_zero_400_sims</code></li>
</ul>

<p dir="auto">To compute the Elo for the different agents, run the tournament to play games between them and then compute the Elo for the PGN file generated by the tournament (more information on BayesElo can be found <a href="https://www.remi-coulom.fr/Bayesian-Elo/" rel="nofollow">here</a>):</p>
<div dir="auto" data-snippet-clipboard-copy-content="cd src
python tournament.py --num_games=200

cd ../BayesElo

./bayeselo
&gt; ...
ResultSet&gt;readpgn ../data/tournament.pgn
&gt; N game(s) loaded, 0 game(s) with unknown result ignored.
ResultSet&gt;elo
ResultSet-EloRating&gt;mm
&gt; 00:00:00,00
ResultSet-EloRating&gt;exactdist
&gt; 00:00:00,00
ResultSet-EloRating&gt;ratings
&gt; ...

cd .."><pre><span>cd</span> src
python tournament.py --num_games=200

<span>cd</span> ../BayesElo

./bayeselo
<span>&gt;</span> ...
ResultSet<span>&gt;</span>readpgn ../data/tournament.pgn
<span>&gt;</span> N game(s) loaded, 0 game(s) with unknown result ignored.
ResultSet<span>&gt;</span>elo
ResultSet-EloRating<span>&gt;</span>mm
<span>&gt;</span> 00:00:00,00
ResultSet-EloRating<span>&gt;</span>exactdist
<span>&gt;</span> 00:00:00,00
ResultSet-EloRating<span>&gt;</span>ratings
<span>&gt;</span> ...

<span>cd</span> ..</pre></div>

<p dir="auto">To investigate the model&#39;s behavior (e.g., to compute the win percentage for all legal moves), start a notebook server and then open <code>src/searchless_chess.ipynb</code> in your browser:</p>


<div dir="auto" data-snippet-clipboard-copy-content="@article{ruoss2024grandmaster,
  author       = {Anian Ruoss and
                  Gr{\&#39;{e}}goire Del{\&#39;{e}}tang and
                  Sourabh Medapati and
                  Jordi Grau{-}Moya and
                  Li Kevin Wenliang and
                  Elliot Catt and
                  John Reid and
                  Tim Genewein},
  title        = {Grandmaster-Level Chess Without Search},
  journal      = {arXiv:2402.04494},
  year         = {2024}
}"><pre>@article{ruoss2024grandmaster,
  author       = {Anian Ruoss and
                  Gr{<span>\&#39;</span>{e}}goire Del{<span>\&#39;</span>{e}}tang and
                  Sourabh Medapati and
                  Jordi Grau{-}Moya and
                  Li Kevin Wenliang and
                  Elliot Catt and
                  John Reid and
                  Tim Genewein},
  title        = {Grandmaster-Level Chess Without Search},
  journal      = {arXiv:2402.04494},
  year         = {2024}
}</pre></div>

<p dir="auto">Copyright 2024 DeepMind Technologies Limited</p>
<p dir="auto">All software is licensed under the Apache License, Version 2.0 (Apache 2.0);
you may not use this file except in compliance with the Apache 2.0 license.
You may obtain a copy of the Apache 2.0 license at:
<a href="https://www.apache.org/licenses/LICENSE-2.0" rel="nofollow">https://www.apache.org/licenses/LICENSE-2.0</a></p>
<p dir="auto">The model weights are licensed under Creative Commons Attribution 4.0 (CC-BY).
You may obtain a copy of the CC-BY license at:
<a href="https://creativecommons.org/licenses/by/4.0/legalcode" rel="nofollow">https://creativecommons.org/licenses/by/4.0/legalcode</a></p>
<p dir="auto">Some portions of the dataset are in the public domain by a
Creative Commons CC0 license from lichess.org.
The remainder of the dataset is licensed under
Creative Commons Attribution 4.0 (CC-BY).
You may obtain a copy of the CC-BY license at:
<a href="https://creativecommons.org/licenses/by/4.0/legalcode" rel="nofollow">https://creativecommons.org/licenses/by/4.0/legalcode</a>.</p>
<p dir="auto">Unless required by applicable law or agreed to in writing, software and
materials distributed under the Apache 2.0 or CC-BY licenses are
distributed on an &#34;AS IS&#34; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
either express or implied. See the licenses for the specific language governing
permissions and limitations under those licenses.</p>
<p dir="auto">This is not an official Google product.</p>
</article></div></div>
  </body>
</html>
