<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.patrickcelentano.com/blog/planet-sim-part-1">Original</a>
    <h1>Simulating a Planet on the GPU: Part 1 (2022)</h1>
    
    <div id="readability-page-1" class="page"><div>
          

          <main>
            
              <section data-content-field="main-content">
                <article id="post-62976752045e881878b99413" data-item-id="62976752045e881878b99413">

    
      
    

    <div data-layout-label="Post Body" data-type="item" data-updated-on="1654090590716" id="item-62976752045e881878b99413"><div><div><div><div><div data-block-json="{&#34;blockAnimation&#34;:&#34;none&#34;,&#34;layout&#34;:&#34;caption-below&#34;,&#34;overlay&#34;:false,&#34;description&#34;:{&#34;html&#34;:&#34;&lt;p class=\&#34;\&#34; style=\&#34;white-space:pre-wrap;\&#34;&gt;&lt;em&gt;An epic tale from one of the Internet\u2019s finest, LGR&lt;/em&gt;&lt;/p&gt;&#34;},&#34;hSize&#34;:null,&#34;floatDir&#34;:null,&#34;isOldBlock&#34;:false,&#34;html&#34;:&#34;&lt;iframe class=\&#34;embedly-embed\&#34; src=\&#34;//cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2F3O_yXk8A98U%3Ffeature%3Doembed&amp;display_name=YouTube&amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D3O_yXk8A98U&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2F3O_yXk8A98U%2Fhqdefault.jpg&amp;key=c6502efcb3c84824bc6c1f27d683be13&amp;type=text%2Fhtml&amp;schema=youtube\&#34; width=\&#34;854\&#34; height=\&#34;480\&#34; scrolling=\&#34;no\&#34; title=\&#34;YouTube embed\&#34; frameborder=\&#34;0\&#34; allow=\&#34;autoplay; fullscreen\&#34; allowfullscreen=\&#34;true\&#34;&gt;&lt;/iframe&gt;&#34;,&#34;url&#34;:&#34;https://www.youtube.com/watch?v=3O_yXk8A98U&#34;,&#34;width&#34;:854,&#34;height&#34;:480,&#34;providerName&#34;:&#34;YouTube&#34;,&#34;thumbnailUrl&#34;:&#34;https://i.ytimg.com/vi/3O_yXk8A98U/hqdefault.jpg&#34;,&#34;resolvedBy&#34;:&#34;youtube&#34;}" data-block-type="32" id="block-yui_3_17_2_1_1654090592564_49617"><div><div><div><p><em>An epic tale from one of the Internet’s finest, LGR</em></p></div></div></div></div></div></div><div data-block-type="2" data-border-radii="{&#34;topLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;topRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0}}" data-sqsp-block="text" id="block-yui_3_17_2_1_1654111209144_96125"><div>

<div data-sqsp-text-block-content="">
  <p>To be fair, it didn’t <em>go </em>anywhere. You can still boot up a copy, mess around with evolution, atmospheric conditions, and continental drift like it’s 1990… but it’s not 1990. We have 32 years of <a href="https://www.youtube.com/watch?v=Q6ctb-Pb3lc">computing advances</a> at our backs and yet no SimEarth 2. Sure there’s <a href="https://www.superworldbox.com">WorldBox</a> and <a href="https://drtardigrade.itch.io/worldhistorysim">Worlds</a> and a bunch of awesome planet generation projects, (<a href="https://experilous.com/1/blog/post/procedural-planet-generation,">1</a>, <a href="https://drtardigrade.itch.io/worldhistorysim">2</a>, <a href="https://demiansky.itch.io/songs-of-the-eons">3</a>) but none allow me to play with plate tectonics, currents, or any of the “deep” factors underlying how the Earth really works.</p><p>Sometime last year, I decided against writing Will Wright a letter, begging him to spend hundreds of hours making a SimEarth 2. Instead, I did <a href="https://xkcd.com/1319/">what any good programmer would do</a> and decided to devote thousands of <em>my own</em> hours into the same thing. This blog describes my first step toward such a goal: describing well over a year’s worth of work and the many detours taken along the way. While there’s a long way to go from here, I’m very happy to share my progress to this point, and promise to follow up with a “part 2” at some future date.</p>
</div>




















  
  



</div></div><div data-block-type="2" data-border-radii="{&#34;topLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;topRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0}}" data-sqsp-block="text" id="block-yui_3_17_2_1_1654090592564_53276"><div>

<div data-sqsp-text-block-content="">
  <h2>Polygon-Based Approaches</h2><p>My first dozen or so approaches at realistic world generation involved generating polygons on a sphere, using <a href="https://en.wikipedia.org/wiki/Delaunay_triangulation">Delaunay Triangulation </a>and <a href="https://en.wikipedia.org/wiki/Voronoi_diagram">Voronoi Tessellation</a>. These fancy-sounding processes allow us to cheaply turn a 2D surface (or indeed, spheres, thanks to<a href="https://www.redblobgames.com/x/1843-planet-generation/"> this amazing blog</a>) into a number of polygons for representing geographic features. Once I wrapped my head around wrapping Voronoi polygons around the North and South Poles, I managed to get something vaguely passing as a planet generated, and applied a nice water shader.</p>
</div>




















  
  



</div></div><div data-block-type="2" data-border-radii="{&#34;topLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;topRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0}}" data-sqsp-block="text" id="block-yui_3_17_2_1_1654092533451_7778"><div>

<p>The fundamental issue with a polygon-centric approach is one of tectonic plate realism: plate collisions require an incredible number of polygons to model correctly. Increasing the number of polygons in a <a href="https://unity.com">Unity</a> &amp; <a href="https://docs.microsoft.com/en-us/dotnet/csharp/">C#</a> environment proved prohibitively expensive, so I turned to an old favorite: <a href="https://www.youtube.com/watch?ab_channel=Programmersarealsohuman&amp;v=s7wLYzRJt3s">C++</a>. After finding <a href="https://www.youtube.com/c/BrendanGalea">Brendan Galea’s excellent YouTube channel</a> and building the first of the three demos above in <a href="https://www.libsdl.org">SDL2 </a>&amp; <a href="https://www.vulkan.org">Vulkan</a> I realized what a titanic task writing a custom engine for this project would be, and went back to the (Unity) drawing board.</p>




















  
  



</div></div><div data-block-type="2" data-border-radii="{&#34;topLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;topRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0}}" data-sqsp-block="text" id="block-yui_3_17_2_1_1654111209144_184246"><div>

<div data-sqsp-text-block-content="">
  <h2>Cubemap-Overlap-Based Approaches</h2><p>Frustrated with the poor performance of my polygonal approach, I began to research Unity’s performance optimization tools. I chunked up and parallelized the Voronoi tessellation to no avail. I tried rearranging memory to no avail. Clearly, something about doing this amount of math on the CPU was beyond current processing capabilities… but what about the GPU?</p><p>Like most programmers, I’d heard of the legendary power of <a href="https://en.wikipedia.org/wiki/Graphics_processing_unit">GPUs</a>, but had only really harnessed it via graphics programming or <a href="https://en.wikipedia.org/wiki/CUDA">CUDA </a>(for my <a href="https://www.patrickcelentano.com/music-ex-machina">Music ex Machina</a> project). While I had some experience writing <a href="https://en.wikipedia.org/wiki/Shader">conventional shaders</a>, learning how to write <a href="https://en.wikipedia.org/wiki/Compute_kernel">compute shaders</a> seemed like a massive undertaking… but what option did I have? I had no room left on the CPU.</p><p>Put simply, compute shaders are capable of applying a GPU’s heavily-parallelized workflow to arbitrary data, meaning I could simulate a world full of tectonic plates one “pixel” at a time. Once I figured out how to represent potentially world-spanning plates as <a href="https://en.wikipedia.org/wiki/Cube_mapping">cubemaps</a>, I managed to create a neat compute shader-based simulation with plates colliding, subducting, and emerging from <a href="https://en.wikipedia.org/wiki/Seafloor_spreading">seafloor spreading</a>… but never deforming.</p><p>While I liked the direction this adventure in compute shaders had taken me, I needed some new technique which could realistically deform crust at <a href="https://en.wikipedia.org/wiki/Convergent_boundary">convergent plate boundaries</a>.</p>
</div>




















  
  



</div></div><div data-block-type="5" id="block-yui_3_17_2_1_1654111209144_313943"><div>










































  

    
  
    <div data-test="image-block-inline-outer-wrapper">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/694e538d-787a-46c5-b72e-030c88434b2c/ezgif-3-88bf663195.gif" data-image="https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/694e538d-787a-46c5-b72e-030c88434b2c/ezgif-3-88bf663195.gif" data-image-dimensions="600x400" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/694e538d-787a-46c5-b72e-030c88434b2c/ezgif-3-88bf663195.gif" width="600" height="400" alt="" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&#34;loaded&#34;)" srcset="https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/694e538d-787a-46c5-b72e-030c88434b2c/ezgif-3-88bf663195.gif?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/694e538d-787a-46c5-b72e-030c88434b2c/ezgif-3-88bf663195.gif?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/694e538d-787a-46c5-b72e-030c88434b2c/ezgif-3-88bf663195.gif?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/694e538d-787a-46c5-b72e-030c88434b2c/ezgif-3-88bf663195.gif?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/694e538d-787a-46c5-b72e-030c88434b2c/ezgif-3-88bf663195.gif?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/694e538d-787a-46c5-b72e-030c88434b2c/ezgif-3-88bf663195.gif?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/694e538d-787a-46c5-b72e-030c88434b2c/ezgif-3-88bf663195.gif?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs"/>

            </p>
          </div>
        
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div data-block-type="2" data-border-radii="{&#34;topLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;topRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0}}" data-sqsp-block="text" id="block-yui_3_17_2_1_1654111209144_273589"><div>

<div data-sqsp-text-block-content="">
  <h2>Smoothed-Particle Hydrodynamics</h2><p>Inspiration can come from anywhere, and as luck would have it, the inspiration for my next step forward came from watching <a href="https://www.youtube.com/watch?v=d9bKXY0OMxc">this physical simulation</a> of a plate boundary. The use of sand for crust material makes realistic deformation possible… and reminded me of the <a href="https://en.wikipedia.org/wiki/Falling-sand_game ">falling sand games</a> which were so popular when I was a kid. Could I simulate little bits of “crust” which could bump into one another, forming mountains and valleys? Could I use the same system for air and water?</p><p>After a little digging, I discovered <a href="https://en.wikipedia.org/wiki/Smoothed-particle_hydrodynamics">Smoothed-Particle Hydrodynamics</a>, a technique commonly used in place of cellular fluid simulations. If I could just implement SPH on a sphere using my newfound knowledge of compute shaders, I’d have the fundamentals of a truly-unique planet sim. With a clear implementation strategy in mind, how long could implementing it possibly take?</p><p>As it turns out, <a href="https://www.youtube.com/watch?v=kSMS5INYs-c">quite a while</a>.</p><p>Writing compute shaders is difficult, as is debugging and profiling them. I found myself performing true computer “science” on multiple occasions: forming a hypothesis about the performance impact of some new algorithm on the GPU and verifying it through good, old-fashioned experimentation. I learned a great deal in the process, most notably that <em>computation is cheap and memory is expensive! </em>More in depth, I’d highly recommend <a href="https://www.youtube.com/watch?v=0DLOJPSxJEg">this incredible talk on compute shader performance optimization</a>. I owe much of this project’s success to that talk.</p>
</div>




















  
  



</div></div><div data-block-type="5" id="block-yui_3_17_2_1_1654111209144_230432"><div>










































  

    
  
    <div data-test="image-block-inline-outer-wrapper">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/32cfbb10-a608-4ae5-9d30-6bce068fb1ea/ezgif-2-1da29a84d2.gif" data-image="https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/32cfbb10-a608-4ae5-9d30-6bce068fb1ea/ezgif-2-1da29a84d2.gif" data-image-dimensions="600x400" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/32cfbb10-a608-4ae5-9d30-6bce068fb1ea/ezgif-2-1da29a84d2.gif" width="600" height="400" alt="" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&#34;loaded&#34;)" srcset="https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/32cfbb10-a608-4ae5-9d30-6bce068fb1ea/ezgif-2-1da29a84d2.gif?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/32cfbb10-a608-4ae5-9d30-6bce068fb1ea/ezgif-2-1da29a84d2.gif?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/32cfbb10-a608-4ae5-9d30-6bce068fb1ea/ezgif-2-1da29a84d2.gif?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/32cfbb10-a608-4ae5-9d30-6bce068fb1ea/ezgif-2-1da29a84d2.gif?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/32cfbb10-a608-4ae5-9d30-6bce068fb1ea/ezgif-2-1da29a84d2.gif?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/32cfbb10-a608-4ae5-9d30-6bce068fb1ea/ezgif-2-1da29a84d2.gif?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5946cffe6a49635915a25577/32cfbb10-a608-4ae5-9d30-6bce068fb1ea/ezgif-2-1da29a84d2.gif?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs"/>

            </p>
          </div>
        
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div data-block-type="2" data-border-radii="{&#34;topLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;topRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0}}" data-sqsp-block="text" id="block-yui_3_17_2_1_1654088644669_47599"><div>

<div data-sqsp-text-block-content="">
  <h2>What’s Next?</h2><p>This project has proved one of the most difficult I’ve ever worked on, and yet, one of the most satisfying. I hope to build a great deal on this foundation, slowly approaching a fully-featured planetary simulation. Here are a few thoughts as to what might be next:</p><ul data-rte-list="default"><li><p>Create map modes to display the direction of the currents (at present you can only see the waves moving in the right direction)</p></li><li><p>Show the air currents in some clever way, perhaps with a moving cloud layer on top of the planet</p></li><li><p>Allow the wind to pick up moisture from warm bodies of water and precipitate it back on land… including <a href="https://en.wikipedia.org/wiki/Rain_shadow">rain shadows</a> caused by mountain ranges</p></li><li><p>Allow currents to warm up the surrounding air, causing phenomenon like the <a href="https://en.wikipedia.org/wiki/North_Atlantic_Current">North Atlantic Current&#39;s</a> miraculous warming of Europe.</p></li><li><p>Add hotspots, volcanoes, and a variety of rock types</p></li><li><p>Optimize it to run on hardware beyond my Surface Book 2</p></li></ul><p>Here’s to blog #2, with whatever new features that brings! Oh, and looking for a download link? Follow through to <a href="https://www.patrickcelentano.com/planet-simulator">this </a>page. Happy simulating : )</p>
</div>




















  
  



</div></div></div></div></div>

    

    

    <section id="comments-62976752045e881878b99413">
      
  

    </section>

  </article>





  <nav>

    
      <a href="https://www.patrickcelentano.com/blog/joining-rpis-hass-leadership-council">
        <svg viewBox="0 0 23 48">
          <g>
            <polyline fill="none" stroke-miterlimit="10" points="21.5,1.3 2.6,23.4 21.5,45.7 "></polyline>
          </g>
        </svg><!--
        --><div>
          <p>Previous</p>
          <h4>Joining the RPI HASS Leadership Council</h4>
          <div>
            <!--

            Author

            --><p><span>Patrick Celentano</span></p><!--

            Date

            --><p><time datetime="2023-01-07">January 7, 2023</time>
          </p></div>
        </div>
      </a>
    

    
      <a href="https://tech-blog.sonos.com/posts/renovating-setup-with-flutter/">
        <div>
          <p>Next</p>
          <h4>Sonos Tech Blog #2</h4>
          <div>
            <!--

            Categories

            --><p><span>Work</span></p><!--

            Author

            --><p><span>Patrick Celentano</span></p><!--

            Date

            --><p><time datetime="2022-05-13">May 13, 2022</time>
          </p></div>
        </div><!--
        --><svg viewBox="0 0 23 48">
          <g>
            <polyline fill="none" stroke-miterlimit="10" points="1.5,45.7 20.4,23.5 1.5,1.3 "></polyline>
          </g>
        </svg>
      </a>
    

  </nav>
              </section>
            
          </main>

        </div></div>
  </body>
</html>
