<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.ryujinx.org/the-impossible-port-macos/">Original</a>
    <h1>The Impossible Port: MacOS</h1>
    
    <div id="readability-page-1" class="page"><div id="site-main">
<article>

    <header>

        

        


        

            <figure>
                <img srcset="/content/images/size/w300/2022/11/titlecard2-2.png 300w,
                            /content/images/size/w600/2022/11/titlecard2-2.png 600w,
                            /content/images/size/w1000/2022/11/titlecard2-2.png 1000w,
                            /content/images/size/w2000/2022/11/titlecard2-2.png 2000w" sizes="(min-width: 1400px) 1400px, 92vw" src="https://blog.ryujinx.org/content/images/size/w2000/2022/11/titlecard2-2.png" alt="The Impossible Port: MacOS"/>
                    <figcaption><em>&#34;We&#39;re really, really excited about games, and again our goal, is to have the best gaming machine in the world.&#34;</em></figcaption>
            </figure>

    </header>

    <section>
        <p>Let&#39;s cut to the chase: <u>macOS and Apple Silicon support</u> (including older Intel Macs, although your mileage may vary)!  Even with all the hurdles, roadblocks and brick walls put in our way, we&#39;re finally back on Mac! And back in style!</p><figure><iframe width="200" height="113" src="https://www.youtube.com/embed/kgCpgXoKh00?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" title="[Ryujinx Blog] MacOS Showcase 1"></iframe></figure><p>With the launch of a new entry in the vast Pokémon library and an already brimming catalog of nearly 4000 incredible Switch titles, we hope you&#39;re as excited for this release as we are. Today, Ryujinx claims ANOTHER groundbreaking advancement to Switch emulation, tapping the unique potential of Apple Silicon to deliver the first &amp; only macOS-compatible Switch emulator. The potential for Apple Silicon Macs is unparalleled in the current market. These devices could enable emulation that is closer to a native port than most gaming PCs, thanks to the powerful ARM synergy they share with the Switch. </p><p>We&#39;re committed to writing an <u>accurate</u>, <u>stable</u> and <u>performant</u> Nintendo Switch emulator with no hacks or shortcuts. If you wish to support us in delivering our goals across Windows, Linux and now macOS too, then consider backing us on <a href="https://www.patreon.com/ryujinx/posts">Patreon</a> and letting us know how everything is going over on <a href="https://discord.gg/ryujinx">Discord</a>. </p><p>This release also <strong>includes LDN functionality </strong>- the ability to play with other Ryujinx, and CFW Switch users, via our hosted servers, LAN or ldn_mitm. You can read more about the features of LDN3 in this <u><a href="https://blog.ryujinx.org/introducing-ldn3/">separate post!</a></u></p><p>Just want the download? Head over to our <a href="https://ryujinx.org/">website</a>. </p><!--kg-card-begin: html--><h2>Install Guide</h2><!--kg-card-end: html--><p>This will be split into two sections: macOS 12 &#39;Monterey&#39;, macOS 13 &#39; Ventura&#39; and above (if you&#39;re reading this in the future). </p><!--kg-card-begin: html--><h3>macOS 13 &#39;Ventura&#39;</h3><!--kg-card-end: html--><ul><li>Extract the downloaded zip package from the <a href="https://ryujinx.org/download">download page</a> somewhere safe. We recommend against any folders that may be protected or otherwise cause permission issues, such as directly on the desktop or at the root of any drive.</li><li>When you try to run the &#39;Ryujinx&#39; executable you will be met with this pop-up, as the build is not officially signed.</li></ul><figure><img src="https://i.postimg.cc/DzNMw82d/02.png" alt="" loading="lazy"/><figcaption>We promise we aren&#39;t malicious software.</figcaption></figure><ul><li>At this point you&#39;ll need to go to <strong>Settings </strong>and then navigate to <strong>Privacy &amp; Security</strong>. </li></ul><figure><img src="https://i.postimg.cc/zvZ2T6Hy/04.png" alt="" loading="lazy"/></figure><ul><li>Scroll down to the <strong>Allow applications downloaded from</strong> options and you will find a box informing you that Ryujinx was blocked; select <strong>Open Anyway</strong>. A pop-up will ask you to confirm this choice.</li></ul><p>This is a one-time process. Subsequent boots will not need to authorise Ryujinx. We are looking into official signing of macOS releases in the future!</p><!--kg-card-begin: html--><h3>macOS 12 &#39;Monterey&#39;</h3><!--kg-card-end: html--><ul><li>Exactly the same process as above but your settings window will look a bit different!</li><li>Attempt to boot Ryujinx, then navigate to <strong>Security &amp; Privacy.</strong></li></ul><figure><img src="https://i.postimg.cc/ZRyDB4nk/03.png" alt="" loading="lazy"/></figure><ul><li>Select the <strong>Open Anyway</strong> option near the bottom of the page, a pop-up will ask you to confirm this choice.</li></ul><p>Alright, if any of you are interested in the nerd stuff, how we got it to work and what challenges still remain then the bulk of this post remains. Even if you&#39;re the kind of person to never read the manual, we&#39;d suggest reading this anyway. Having a base understanding of what&#39;s happening, the current strengths and limitations, and future work will help enormously if and when you have questions.</p><!--kg-card-begin: html--><h2>New SoC, who dis?</h2><!--kg-card-end: html--><figure><img src="https://i.postimg.cc/kgfHLTzH/20.webp" alt="" loading="lazy"/><figcaption>Credit: TechRadar</figcaption></figure><p>When we last supported macOS, Apple was <em>booorriinnggg</em>. They used the same architectures and hardware as regular desktops and laptops, but with worse software support. However, since the shift to their own &#39;Apple Silicon&#39; SoCs (System on a Chip), many consumers, and more importantly, developers have been foaming at the mouth to see what they&#39;re capable of. For Switch Emulation it&#39;s a bit of a double kill with the increased performance of Apple Silicon combined with the 1:1 ARMv8 CPU architecture of the Switch&#39;s Tegra X1. </p><p>Implementing ARM compatibility is a big-deal for normal software, and emulators are far from normal. But, as we alluded to earlier, one of the niceties for Switch Emulation in particular is that the host and guest system both execute the same code. Dedicated optimizations for Apple Silicon have thus been made:</p><ul><li>ARM Hypervisor - Allows native ARMv8 code execution with <strong>no translation.</strong> The overhead cost of emulating the game code is almost entirely removed, accessing the full potential of the chip. </li><li>ARM64 JIT - ARM support has been added to our CPU JIT recompiler &#39;<em>ARMeilleure&#39; </em>for cases where the above hypervisor won&#39;t work, such as 32-bit titles like Mario Kart 8 Deluxe. This has been optimised to allow a much more direct mapping for floating point instructions and behaviours compared to x86. Because of this, there is a lot more potential for JIT performance than regular x86 CPUs.</li><li>For the rare titles that don&#39;t work using the Hypervisor, a manual option to use the JIT has been made available. Beware, while this may increase compatibility, performance and stability will be severely impacted.</li></ul><p>While the ARM CPU cores on Apple Silicon are mighty impressive, not everything is as rosy on the GPU side...</p><!--kg-card-begin: html--><h2>A trip down memory lane...</h2><!--kg-card-end: html--><p>For those unaware, Ryujinx did initially support macOS all those years ago, before our OpenGL version-needs exceeded what Apple was prepared to provide. Apple have since fully deprecated OpenGL on macOS and support only very old versions for legacy purposes, thus forcing our exodus. While Apple do develop and maintain their own <a href="https://developer.apple.com/metal/">proprietary graphics API <em>&#39;Metal&#39;</em></a>, many had hoped that the new kid on the block, <a href="https://www.vulkan.org/">Vulkan</a>, would eventually be on the agenda for Apple going forward. Unfortunately, here we are in 2022 with no sign that anything other than Metal is a priority or even a goal on Apple&#39;s roadmap. </p><p>Many other emulators such as <a href="https://rpcs3.net/">RPCS3</a>, <a href="https://pcsx2.net/">PCSX2</a>, and most notably <a href="https://dolphin-emu.org/">Dolphin</a> have all, over time, been able to implement graphical support for macOS via one of two routes: a Metal backend or <a href="https://github.com/KhronosGroup/MoltenVK">MoltenVK</a>. Some used both at one point or another.</p><figure><img src="https://i.postimg.cc/j2HgccyZ/05.png" alt="" loading="lazy"/><figcaption>Vulkan... Volcano... Molten. I see what you did there!</figcaption></figure><p>MoltenVK is a library that translates between Vulkan and Metal, effectively meaning if you have a Vulkan backend you can make use of MoltenVK to translate those calls to Metal; thus acting as a pseudo-Metal backend. The issue is that those aforementioned emulators all mimic consoles with relatively old GPU architectures which, while complex in their own ways, do not particularly stress the limits of Metal, Vulkan, and by extension MoltenVK. By contrast, the Switch uses a relatively modern (architecturally-speaking) Nvidia GPU, with all the bells and whistles that follow along. To say that this <em>stretches </em>Metal would be an understatement. Fundamentally it&#39;s a brick wall. </p><p>Or at least that&#39;s what we thought... </p><!--kg-card-begin: html--><h2>Fetching our Sledgehammers</h2><!--kg-card-end: html--><p>This was not easy. Metal being feature-barren, and the new Mac GPUs being closer to mobile hardware than desktop has caused a whole world of hurt. Core extensions and features simply don&#39;t exist and paths that a desktop GPU would consider &#34;free&#34; are suddenly huge rendering costs, if they even have the ability to render at all. It&#39;s hard enough to make a Mac port of a video game that you yourself develop; it&#39;s even harder when you have no power over what the emulated game requests from your system. </p><p>Luckily our GPU developers are experienced in the dark arts of getting stuff working on APIs and hardware which hate cooperating. Let&#39;s run through some of the core issues faced and how they&#39;re being overcome. This may be for the tech-wizards; but we&#39;ll try to make it digestible!</p><ul><li><strong>4-byte Vertex Buffer Alignment Requirement: </strong>A very large number of games bind vertex buffers that just contain one attribute. When they do this, they tend to pack them tightly, which is allowed on normal graphics APIs. However, Metal demands that the stride aligns to 4 bytes, no matter what the size of the attribute is. To do this, we have a compute shader converting incompatible vertex buffers functioning alongside a cache, so the cost is only paid once. Most games would not work without this.</li><li><strong>Transform Feedback:</strong> Transform Feedback is another feature that doesn&#39;t exist on Mac, but is used by a few choice games like Xenoblade and Legends Arceus. We have a rather ingenious (but complicated) solution to this - just write the transform feedback outputs to storage buffers at the end of the vertex stage. The result is just as fast and works properly across affected titles.</li></ul><figure><iframe width="200" height="150" src="https://www.youtube.com/embed/quv9CLjtfS8?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" title="[Ryujinx Blog] MacOS Showcase 7"></iframe><figcaption>Transform Feedback: Pokémon Legends Arceus</figcaption></figure><ul><li><strong>16 Samplers:</strong> This issue is a bit of a killer, since more complicated Switch games bind a lot more textures and samplers than this. Thankfully, this limitation can be avoided through Metal Argument Buffers, which MoltenVK has an option to use. This has proven to be a bit buggy and slower in general, but significantly more games work thanks to it.</li><li><strong>Triangle Fan:</strong> A rather niche topology that draws triangles around a starting point, occasionally used to draw quads and circles in user interfaces. We support this by using the same compute shader conversion path as we do with vertex buffers, but converting an index buffer to the target topology instead. This has actually already been added to mainline, in the form of <a href="https://github.com/Ryujinx/Ryujinx/pull/3715">quads to tris</a> conversion, which ended up faster there too.</li><li><strong>No Sampler Bias:</strong> We just pretend this doesn&#39;t exist for now. A rather ingenious solution, if you ask us.</li><li><strong>Geometry Shaders:</strong> Geometry shaders do not exist in Metal or MoltenVK. Used for writing 3D textures in UE4 games, and a number of complex graphical effects in others, missing this would definitely hurt compatibility. However, gdkchan has come up with a clever method to emulate these stages using additional draws to vertex shader only. The result is incredibly impressive - <u>hardware-accelerated geometry shaders on a GPU that doesn&#39;t support them.</u> Coup de grâce!</li></ul><figure><iframe width="200" height="150" src="https://www.youtube.com/embed/BuASwjd9xFw?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" title="[Ryujinx Blog] MacOS Showcase 6"></iframe><figcaption>Geometry Shaders: Yoshis Crafted World</figcaption></figure><p>Alas, we&#39;re not all-powerful deities nor wizards with magic wands. There are some things that we simply can&#39;t work around, most of them being architectural. As we mentioned before, the GPUs in Apple Silicon Macs are fundamentally different to typical desktop/laptop GPUs. These GPUs are more similar to mobile hardware where rendering is done in tile memory, which is copied to/from the unified memory when a render pass happens. This means that updates to buffers in the middle of a render pass are more costly than usual, as it can result in render targets being copied in and out of memory all the time. However, the macOS build includes many strategies that attempt to mitigate this almost entirely, and some of these changes have already started being upstreamed (with positive performance impacts on Windows/Linux!).</p><p>And now, after we&#39;ve spoken so much about the GPU, let&#39;s see it all come together and render something!</p><!--kg-card-begin: html--><h2>Media Gallery</h2><!--kg-card-end: html--><figure><iframe width="200" height="113" src="https://www.youtube.com/embed/VgxRYvsyBSs?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" title="[Ryujinx Blog] MacOS Showcase 2"></iframe><figcaption>Animal Crossing: New Horizons</figcaption></figure><figure><iframe width="200" height="113" src="https://www.youtube.com/embed/EyKF6N7ttp4?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" title="[Ryujinx Blog] MacOS Showcase 3"></iframe><figcaption>Mario Kart 8 Deluxe</figcaption></figure><figure><iframe width="200" height="113" src="https://www.youtube.com/embed/inZFrOE-PHQ?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" title="[Ryujinx Blog] MacOS Showcase 4"></iframe><figcaption>Super Mario Odyssey</figcaption></figure><figure><iframe width="200" height="150" src="https://www.youtube.com/embed/ahzO0U68jqw?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" title="[Ryujinx Blog] MacOS Showcase 5"></iframe><figcaption>Finally... a Nintendo 64 emulator on MacOS :D</figcaption></figure><!--kg-card-begin: html--><h2>Known issues</h2><!--kg-card-end: html--><p>Ryujinx is an experimental emulator, and this is our first release on a completely different platform and architecture. Experimental-squared! As such, there will be issues.</p><ul><li>ARM64 Hypervisor does not function in all titles, most notably The Legend of Zelda: Breath of the Wild. Manually forcing the ARM64 JIT <em>may </em>allow these games to boot. Forcing Ryujinx to run via Rosetta could also be a potential option although this is relatively uncharted territory as far as stability goes.</li><li>Shader stutter is amplified due to the translation required between Vulkan&#39;s SPIR-V and Metal&#39;s MSL shaders. While not as significant as OpenGL, it is noticeable. </li><li>General performance, stability and graphical issues <em>will </em>occur. We haven&#39;t tested every game under the sun but we&#39;re sure you guys will!</li></ul><!--kg-card-begin: html--><h2>Closing words</h2><!--kg-card-end: html--><p>All in all, we&#39;re pleased with what we&#39;ve managed to accomplish. A barrier that many, including ourselves, originally thought unbreakable has been cracked wide open, and the best part is: this is just the beginning. With not only our own efforts to improve the core emulation, but upcoming updates to Metal 3 and the constantly improving MoltenVK, the experience is only going to get better.</p><p>To wrap up, the download is <a href="https://ryujinx.org/download">here</a>, our Discord is <a href="https://discord.gg/ryujinx">here</a>, and if you wish to support us on Patreon you can find us <a href="https://www.patreon.com/ryujinx/posts">here</a>.</p>
    </section>


</article>
</div></div>
  </body>
</html>
