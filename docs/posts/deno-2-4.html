<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://deno.com/blog/v2.4">Original</a>
    <h1>Deno 2.4</h1>
    
    <div id="readability-page-1" class="page"><div><p>To upgrade to Deno 2.4, run the following in your terminal:</p>
<p>If Deno is not yet installed, run one of the following commands to install or
<a href="https://docs.deno.com/runtime/manual/getting_started/installation" rel="noopener noreferrer">learn how to install it here</a>.</p>
<div><pre>

<span>curl</span> <span>-fsSL</span> https://deno.land/install.sh <span>|</span> <span>sh</span>


iwr https://deno.land/install.ps1 <span>-useb</span> <span>|</span> iex</pre></div><h2 id="whats-new-in-deno-24"><a aria-hidden="true" tabindex="-1" href="#whats-new-in-deno-24"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>What‚Äôs new in Deno 2.4</h2>
<ul>
<li><a href="#deno-bundle"><code>deno bundle</code></a></li>
<li><a href="#importing-text-and-bytes">Importing text and bytes</a></li>
<li><a href="#built-in-opentelemetry-is-now-stable">Built-in OpenTelemetry is now stable</a></li>
<li><a href="#modify-the-deno-environment-with-the-new---preload-flag">Modify the Deno environment with the new <code>--preload</code> flag</a></li>
<li><a href="#easier-dependency-management-with-deno-update">Easier dependency management with <code>deno update</code></a></li>
<li><a href="#collect-script-coverage-with-deno-run---coverage">Collect script coverage with <code>deno run --coverage</code></a></li>
<li><a href="#deno_compat1"><code>DENO_COMPAT=1</code></a></li>
<li><a href="#permission-changes">Permission changes</a></li>
<li><a href="#conditional-packagejson-exports">Conditional <code>package.json</code> exports</a></li>
<li><a href="#deno-run-bare-specifiers"><code>deno run</code> bare specifiers</a></li>
<li><a href="#deno-fmt-xml-and-svg-files"><code>deno fmt</code> XML and SVG files</a></li>
<li><a href="#better-tsconfigjson-support">Better <code>tsconfig.json</code> support</a></li>
<li><a href="#simpler-node-globals">Simpler Node globals</a></li>
<li><a href="#local-npm-packages">Local npm packages</a></li>
<li><a href="#nodejs-api-support">Node.js API support</a></li>
<li><a href="#lsp-improvements">LSP improvements</a></li>
<li><a href="#other-fun-things">Other fun things</a></li>
<li><a href="#acknowledgments">Acknowledgements</a></li>
</ul>
<h2 id="deno-bundle"><a aria-hidden="true" tabindex="-1" href="#deno-bundle"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>deno bundle</code></h2>
<p>Deno 2.4 restores the
<a href="https://docs.deno.com/runtime/reference/bundling" rel="noopener noreferrer"><code>deno bundle</code></a> subcommand for
creating single-file JavaScript bundles from JavaScript or TypeScript. It
supports both server-side and browser platforms, works with npm and JSR
dependencies, and includes automatic tree shaking and minification via esbuild.</p>
<div><pre>

$ deno bundle <span>--minify</span> main.ts


$ deno bundle <span>--platform</span> browser <span>--output</span> bundle.js app.jsx 


$ deno bundle <span>--platform</span> browser <span>--output</span> bundle.js <span>--sourcemap</span><span>=</span>external app.jsx</pre></div><figure>


<figcaption>
Bundling JavaScript with React for the client.
</figcaption>
</figure>

<p>For long time Deno users, you may remember we used to have <code>deno bundle</code>, which
was <a href="https://github.com/denoland/deno/issues/11073" rel="noopener noreferrer">subsequently deprecated</a>.
JavaScript bundling is an incredibly complex problem, and we did not believe we
could build <code>deno bundle</code> properly. Now that <code>deno bundle</code> uses
<a href="https://esbuild.github.io/" rel="noopener noreferrer"><code>esbuild</code></a> under the hood, it is here to stay.</p>
<p>We‚Äôre working on a runtime API to make bundling available programmatically in
the future. On top of that, we plan to add plugins, allowing you to customize
how the bundler processes modules during the build process.</p>
<p>For more information visit
<a href="https://docs.deno.com/runtime/reference/cli/bundle/" rel="noopener noreferrer"><code>deno bundle</code> reference</a>
and the <a href="https://docs.deno.com/runtime/reference/bundling" rel="noopener noreferrer">bundling docs page</a></p>
<h2 id="importing-text-and-bytes"><a aria-hidden="true" tabindex="-1" href="#importing-text-and-bytes"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Importing text and bytes</h2>
<p>Have you ever wanted to include a data-file of some sort in your JavaScript
module graph? Maybe a markdown file, icons, or a binary blob? Until now you
would have had to load these files at runtime, carefully ensuring the assets
were shipped alongside your code:</p>
<div><pre><span>const</span> image <span>=</span> <span>Deno</span><span>.</span><span>readFileSync</span><span>(</span><span>import</span><span>.</span><span>meta</span><span>.</span><span>resolve</span><span>(</span><span>&#34;./image.png&#34;</span><span>)</span><span>)</span><span>;</span>
<span>const</span> text <span>=</span> <span>await</span> <span>Deno</span><span>.</span><span>readTextFile</span><span>(</span><span>import</span><span>.</span><span>meta</span><span>.</span><span>resolve</span><span>(</span><span>&#34;./log.txt&#34;</span><span>)</span><span>)</span><span>;</span></pre></div><p>In Deno 2.4, you can link these files into the JavaScript graph with the flag
<a href="https://docs.deno.com/runtime/fundamentals/modules/#import-attributes" rel="noopener noreferrer"><code>--unstable-raw-imports</code></a>:</p>
<div><pre><span>import</span> <span>message</span> <span>from</span> <span>&#34;./hello.txt&#34;</span> <span>with</span> <span>{</span> type<span>:</span> <span>&#34;text&#34;</span> <span>}</span><span>;</span>
<span>import</span> <span>bytes</span> <span>from</span> <span>&#34;./hello.txt&#34;</span> <span>with</span> <span>{</span> type<span>:</span> <span>&#34;bytes&#34;</span> <span>}</span><span>;</span>
<span>import</span> <span>imageBytes</span> <span>from</span> <span>&#34;./image.png&#34;</span> <span>with</span> <span>{</span> type<span>:</span> <span>&#34;bytes&#34;</span> <span>}</span><span>;</span>

<span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Message:&#34;</span><span>,</span> message<span>)</span><span>;</span>


<span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Bytes:&#34;</span><span>,</span> bytes<span>)</span><span>;</span>






<span>Deno</span><span>.</span><span>serve</span><span>(</span><span>(</span>_req<span>)</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span>new</span> <span><span>Response</span></span><span>(</span>imageBytes<span>,</span> <span>{</span>
    status<span>:</span> <span>200</span><span>,</span>
    headers<span>:</span> <span>{</span>
      <span>&#34;Content-Type&#34;</span><span>:</span> <span>&#34;image/png&#34;</span><span>,</span>
      <span>&#34;Content-Length&#34;</span><span>:</span> imageBytes<span>.</span><span>byteLength</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>,</span>
    <span>}</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>
</pre></div><p>You can use this with <code>deno bundle</code>, simplifying the process of importing
non-JavaScript files in your application and avoiding manual file I/O or
middleware.</p>
<div><p>main.ts</p><pre><span>import</span> <span>icon</span> <span>from</span> <span>&#34;./icon.png&#34;</span> <span>with</span> <span>{</span> <span>type</span><span>:</span> <span>&#34;bytes&#34;</span> <span>}</span><span>;</span>

<span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Icon&#34;</span><span>,</span> icon<span>)</span><span>;</span></pre></div><div><pre>$ deno bundle --unstable-raw-imports <span>-o</span> app.js main.ts
‚ö†Ô∏è deno bundle is experimental and subject to changes
Bundled <span>2</span> modules <span>in</span> 7ms
  app.js 268B

$ deno app.js
Icon Uint8Array<span>(</span><span>69</span><span>)</span> <span>[</span>
  <span>137</span>, <span>80</span>, <span>78</span>, <span>71</span>, <span>13</span>,  <span>10</span>,  <span>26</span>,  <span>10</span>,   <span>0</span>,  <span>0</span>,  <span>0</span>, <span>13</span>,
   <span>73</span>, <span>72</span>, <span>68</span>, <span>82</span>,  <span>0</span>,   <span>0</span>,   <span>0</span>,   <span>1</span>,   <span>0</span>,  <span>0</span>,  <span>0</span>,  <span>1</span>,
    <span>8</span>,  <span>2</span>,  <span>0</span>,  <span>0</span>,  <span>0</span>, <span>144</span>, <span>119</span>,  <span>83</span>, <span>222</span>,  <span>0</span>,  <span>0</span>,  <span>0</span>,
   <span>12</span>, <span>73</span>, <span>68</span>, <span>65</span>, <span>84</span>, <span>120</span>, <span>218</span>,  <span>99</span>,  <span>96</span>, <span>96</span>, <span>96</span>,  <span>0</span>,
    <span>0</span>,  <span>0</span>,  <span>4</span>,  <span>0</span>,  <span>1</span>, <span>200</span>, <span>234</span>, <span>235</span>, <span>249</span>,  <span>0</span>,  <span>0</span>,  <span>0</span>,
    <span>0</span>, <span>73</span>, <span>69</span>, <span>78</span>, <span>68</span>, <span>174</span>,  <span>66</span>,  <span>96</span>, <span>130</span>
<span>]</span></pre></div><p>Additionally, this feature works with <code>deno compile</code>, so that you can embed
assets into your final compiled binary.</p>
<div><p>spellcheck.js</p><pre><span>import</span> <span>dictData</span> <span>from</span> <span>&#34;./dictionary.txt&#34;</span> <span>with</span> <span>{</span> <span>type</span><span>:</span> <span>&#34;text&#34;</span> <span>}</span><span>;</span>

<span>const</span> <span>DICT</span> <span>=</span> dictData<span>.</span><span>split</span><span>(</span><span>&#34; &#34;</span><span>)</span><span>;</span>

<span>while</span> <span>(</span><span>true</span><span>)</span> <span>{</span>
  <span>let</span> input <span>=</span> <span>prompt</span><span>(</span><span>&#34;&gt; Enter the word to check: &#34;</span><span>)</span><span>;</span>
  input <span>=</span> input<span>.</span><span>trim</span><span>(</span><span>)</span><span>;</span>
  <span>if</span> <span>(</span><span>!</span>input<span>)</span> <span>{</span>
    <span>continue</span><span>;</span>
  <span>}</span>

  <span>if</span> <span>(</span><span>!</span><span>DICT</span><span>.</span><span>includes</span><span>(</span>input<span>)</span><span>)</span> <span>{</span>
    <span>console</span><span>.</span><span>error</span><span>(</span><span><span>`</span><span><span>${</span>input<span>}</span></span><span> is not a known word</span><span>`</span></span><span>)</span><span>;</span>
  <span>}</span> <span>else</span> <span>{</span>
    <span>console</span><span>.</span><span>log</span><span>(</span><span><span>`</span><span><span>${</span>input<span>}</span></span><span> is a known word</span><span>`</span></span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></pre></div><div><pre>$ deno compile --unstable-raw-imports spellcheck.js
Compile file:///dev/spellcheck.js to spellcheck

$ ./spellcheck
<span>&gt;</span> Enter the word to check:  deno
deno is a known word
<span>&gt;</span> Enter the word to check:  asdf
asdf is not a known word</pre></div><p>Bytes and text imports add to Deno‚Äôs existing ability to
<a href="https://docs.deno.com/examples/importing_json/" rel="noopener noreferrer">import JSON</a> and
<a href="https://docs.deno.com/runtime/reference/wasm/" rel="noopener noreferrer">Wasm files</a> natively:</p>
<div><pre><span>import</span> <span>file</span> <span>from</span> <span>&#34;./version.json&#34;</span> <span>with</span> <span>{</span> type<span>:</span> <span>&#34;json&#34;</span> <span>}</span><span>;</span>
<span>console</span><span>.</span><span>log</span><span>(</span>file<span>.</span><span>version</span><span>)</span><span>;</span>


<span>import</span> <span><span>{</span> add <span>}</span></span> <span>from</span> <span>&#34;./add.wasm&#34;</span><span>;</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>add</span><span>(</span><span>1</span><span>,</span> <span>2</span><span>)</span><span>)</span><span>;</span>
</pre></div><p>While the ability to import various file types have been around (such as in
Next.js and other frameworks), these approaches are not spec-friendly and
introduce unnecessary complexity via domain-specific languages and ahead-of-time
compilers that modify the language.</p>
<p>We‚Äôve wanted to add importing other file types earlier, but also want to be
aligned with the spec and avoid introducing breaking changes. Astute observers
might note that this feature actually goes <em>ahead</em> of current spec
(<a href="https://github.com/tc39/proposal-import-attributes" rel="noopener noreferrer">here‚Äôs the proposal for import attributes</a>).
However, due to
<a href="https://github.com/whatwg/html/issues/9444" rel="noopener noreferrer">ongoing discussions</a> and
<a href="https://2ality.com/2025/01/import-attributes.html#upcoming-features-based-on-import-attributes" rel="noopener noreferrer">proposed upcoming features</a>
about this feature, we are confident this implementation is in the right
direction.</p>
<h2 id="built-in-opentelemetry-is-now-stable"><a aria-hidden="true" tabindex="-1" href="#built-in-opentelemetry-is-now-stable"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Built-in OpenTelemetry is now stable</h2>
<p>In <a href="https://deno.com/blog/v2.2" rel="noopener noreferrer">2.2</a>, we introduced
<a href="https://docs.deno.com/runtime/fundamentals/open_telemetry/" rel="noopener noreferrer">built-in OpenTelemetry support</a>,
which auto-instruments the collection of logs, metrics, and traces for your
project. We‚Äôre excited to announce that it is now stable in 2.4, which means you
no longer need <code>--unstable-otel</code> flag:</p>
<div><pre>$ <span>OTEL_DENO</span><span>=</span><span>1</span> deno --allow-net server.ts
Listening on http://localhost:8000/</pre></div><p>Deno‚Äôs OpenTelemetry support simplifies observability in your JavaScript
projects, as it
<a href="https://deno.com/blog/zero-config-debugging-deno-opentelemetry#the-issue-with-logs" rel="noopener noreferrer">automatically associates logs with HTTP requests</a>,
<a href="https://deno.com/blog/otel-tracing-in-node-and-deno" rel="noopener noreferrer">works in Node with no additional config</a>,
and is available to all your projects in our <a href="https://deno.com/deploy" rel="noopener noreferrer">new Deno Deploy</a>:</p>
<figure>


<figcaption>
Deno‚Äôs built-in OTel auto-instruments <code>console.log</code>s and associates them with HTTP requests. Here we click view a trace from a log, then view all logs within that HTTP request.
</figcaption>
</figure>

<p>Note that you will still need to set the environment variable <code>OTEL_DENO=1</code> to
enable instrumentation, since it uses additional resources and don‚Äôt want it on
all the time.</p>
<p>For more information about Deno‚Äôs OpenTelemetry support, check out the following
resources:</p>
<ul>
<li><a href="https://deno.com/blog/zero-config-debugging-deno-opentelemetry" rel="noopener noreferrer">Zero-config Debugging with Deno and OpenTelemetry</a></li>
<li><a href="https://deno.com/blog/otel-tracing-in-node-and-deno" rel="noopener noreferrer">How to get deep traces in your Node.js backend with OTel and Deno</a></li>
<li><a href="https://www.youtube.com/watch?v=PwDU8yTZmUM" rel="noopener noreferrer">Easier debugging with auto-instrumented OTel in Deno Deploy</a></li>
<li><a href="https://docs.deno.com/runtime/fundamentals/open_telemetry/" rel="noopener noreferrer">Deno OpenTelemetry reference documentation</a></li>
</ul>
<h2 id="modify-the-deno-environment-with-the-new---preload-flag"><a aria-hidden="true" tabindex="-1" href="#modify-the-deno-environment-with-the-new---preload-flag"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Modify the Deno environment with the new <code>--preload</code> flag</h2>
<p>We‚Äôve landed a new <a href="" rel="noopener noreferrer"><code>--preload</code> flag</a> that will execute code before your main
script. This is useful if you are building your own platform and need to modify
globals, load data, connect to databases, install dependencies, or provide other
APIs:</p>
<div><p>setup.ts</p><pre><span>delete</span> <span>Deno</span><span>;</span>
globalThis<span>.</span><span>window</span> <span>=</span> globalThis<span>;</span></pre></div><div><p>main.ts</p><pre><span>console</span><span>.</span><span>log</span><span>(</span><span>Deno</span><span>)</span><span>;</span></pre></div><div><pre>$ deno <span>--preload</span> setup.ts main.ts

error: Uncaught <span>(</span>in promise<span>)</span> ReferenceError: Deno is not defined
console.log<span>(</span>Deno<span>)</span><span>;</span>
            ^
    at file:///main.ts:1:13</pre></div><p>While we‚Äôve traditionally been cautious about allowing user code to modify the
runtime, it‚Äôs become clear that there are enough circumstances in which this is
needed. This flag is available to use in
<a href="https://docs.deno.com/runtime/reference/cli/run/" rel="noopener noreferrer"><code>deno run</code></a>,
<a href="https://docs.deno.com/runtime/reference/cli/test/" rel="noopener noreferrer"><code>deno test</code></a> and
<a href="https://docs.deno.com/runtime/reference/cli/bench/" rel="noopener noreferrer"><code>deno bench</code></a> subcommands.</p>
<h2 id="easier-dependency-management-with-deno-update"><a aria-hidden="true" tabindex="-1" href="#easier-dependency-management-with-deno-update"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Easier dependency management with <code>deno update</code></h2>
<p>We‚Äôve added a new subcommand,
<a href="https://docs.deno.com/runtime/reference/cli/update/" rel="noopener noreferrer"><code>deno update</code></a>, which
allows you to update your dependencies to the latest versions:</p>
<figure>


<figcaption>
Updating dependencies to their latest versions with <code>deno update --latest</code>.
</figcaption>
</figure>

<p>This command will update npm and JSR dependencies listed in <code>deno.json</code> or
<code>package.json</code> files to latest semver compatible versions.</p>
<div><pre>

deno update <span>--latest</span>


deno update <span>&#34;@std/*&#34;</span>


deno update <span>--recursive</span></pre></div><p><em><code>deno outdated --update</code> did the same thing, but to save you the headache of
typing additional characters, we added the alias <code>deno update</code>.</em></p>
<p>For more information about <code>deno update</code>, check out
<a href="https://docs.deno.com/runtime/reference/cli/update" rel="noopener noreferrer">the Deno docs</a>.</p>
<h2 id="collect-script-coverage-with-deno-run---coverage"><a aria-hidden="true" tabindex="-1" href="#collect-script-coverage-with-deno-run---coverage"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Collect script coverage with <code>deno run --coverage</code></h2>
<p><a href="https://docs.deno.com/runtime/reference/cli/coverage/" rel="noopener noreferrer"><code>deno test --coverage</code></a>
will execute your test suite while collecting coverage information, which is a
breeze to use. However, in some situations like if you need to spawn a
subprocess as part of the test suite,
<a href="https://docs.deno.com/runtime/reference/cli/test/" rel="noopener noreferrer"><code>deno test</code></a> would not
collect the coverage of the subprocess, making the report spotty.</p>
<p>Deno 2.4 alleviates this problem by introducing the <code>--coverage</code> flag that you
can pass to <a href="https://docs.deno.com/runtime/reference/cli/run/" rel="noopener noreferrer"><code>deno run</code></a>.</p>
<p><em>You can also use <code>DENO_COVERAGE_DIR</code> environment variable instead.</em></p>
<div><p>main.ts</p><pre><span>function</span> <span>foo</span><span>(</span>a<span>:</span> <span>number</span><span>,</span> b<span>:</span> <span>number</span><span>)</span> <span>{</span>
  <span>if</span> <span>(</span>a <span>&gt;</span> <span>0</span><span>)</span> <span>{</span>
    <span>console</span><span>.</span><span>log</span><span>(</span>a<span>)</span><span>;</span>
  <span>}</span> <span>else</span> <span>{</span>
    <span>console</span><span>.</span><span>log</span><span>(</span>a<span>)</span><span>;</span>
  <span>}</span>

  <span>if</span> <span>(</span>b <span>&gt;</span> <span>0</span><span>)</span> <span>{</span>
    <span>console</span><span>.</span><span>log</span><span>(</span>b<span>)</span><span>;</span>
  <span>}</span> <span>else</span> <span>{</span>
    <span>console</span><span>.</span><span>log</span><span>(</span>b<span>)</span><span>;</span>
  <span>}</span>
<span>}</span>

<span>const</span> <span>[</span>a <span>=</span> <span>0</span><span>,</span> b <span>=</span> <span>0</span><span>]</span> <span>=</span> <span>Deno</span><span>.</span><span>args</span><span>;</span>

<span>foo</span><span>(</span><span>+</span>a<span>,</span> <span>+</span>b<span>)</span><span>;</span></pre></div><pre><code>$ deno run --coverage main.ts
0
0

$ deno coverage
| File      | Branch % | Line % |
| --------- | -------- | ------ |
| main.ts   |      0.0 |   57.1 |
| All files |      0.0 |   57.1 |</code></pre><p>To learn more about coverage collection and presentation visit
<a href="https://docs.deno.com/runtime/reference/cli/coverage/" rel="noopener noreferrer">Deno docs</a>.</p>
<p><em>Oh by the way, HTML coverage report now supports dark mode</em> ü§´.</p>
<h2 id="deno_compat1"><a aria-hidden="true" tabindex="-1" href="#deno_compat1"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>DENO_COMPAT=1</code></h2>
<p>We‚Äôve introduced a new environment variable, <code>DENO_COMPAT=1</code> , that will tell
Deno to enable the below flags to improve ergonomics when using Deno in
<code>package.json</code>-first projects:</p>
<ul>
<li><a href="https://docs.deno.com/runtime/reference/cli/unstable_flags/#--unstable-detect-cjs" rel="noopener noreferrer"><code>--unstable-detect-cjs</code></a></li>
<li><a href="https://docs.deno.com/runtime/reference/cli/unstable_flags/#--unstable-node-globals" rel="noopener noreferrer"><code>--unstable-node-globals</code></a></li>
<li><a href="https://docs.deno.com/runtime/reference/cli/unstable_flags/#--unstable-bare-node-builtins" rel="noopener noreferrer"><code>--unstable-bare-node-builtins</code></a></li>
<li><a href="https://docs.deno.com/runtime/reference/cli/unstable_flags/#--unstable-sloppy-imports" rel="noopener noreferrer"><code>--unstable-sloppy-imports</code></a></li>
</ul>
<p>For instance:</p>
<div><pre>

deno --unstable-detect-cjs --unstable-node-globals --unstable-bare-node-builtins --unstable-sloppy-imports app.js


<span>DENO_COMPAT</span><span>=</span><span>1</span> deno app.js</pre></div><p>In the future, the scope of this environmental variable might be expanded
further ‚Äî eg. to not require <code>npm:</code> prefixes when
<a href="https://docs.deno.com/runtime/reference/cli/install/" rel="noopener noreferrer"><code>deno install</code></a>ing
packages.</p>
<p>We are also stabilizing the <code>--unstable-sloppy-imports</code> flag to become
<code>--sloppy-imports</code>, which tells Deno to infer file extensions from imports that
do not include them. While Deno generally encourages requiring file extensions
to avoid inefficiencies such
<a href="https://deno.com/blog/how-we-built-jsr#say-no-to-probing" rel="noopener noreferrer">as probing the filesystem</a>, the
<code>--sloppy-imports</code> flag is a way to run code that uses extensionless imports.</p>
<h2 id="permission-changes"><a aria-hidden="true" tabindex="-1" href="#permission-changes"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Permission changes</h2>
<p>The
<a href="https://docs.deno.com/runtime/fundamentals/security/#network-access" rel="noopener noreferrer"><code>--allow-net</code> flag</a>
now supports subdomain wildcards and CIDR ranges:</p>
<div><p>subdomain_wildcards.ts</p><pre><span>const</span> res1 <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;http://test.foo.localhost&#34;</span><span>)</span><span>;</span>
<span>const</span> res2 <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;http://test.bar.localhost&#34;</span><span>)</span><span>;</span></pre></div><pre><code>$ deno --allow-net=*.foo.localhost subdomain_wildcards.ts
Response {
  url: &#34;http://test.localhost&#34;,
  ...
}
‚îè ‚ö†Ô∏è  Deno requests net access to &#34;test.bar.localhost:80&#34;.
‚î†‚îÄ Requested by `fetch()` API.
‚î†‚îÄ To see a stack trace for this prompt, set the DENO_TRACE_PERMISSIONS environmental variable.
‚î†‚îÄ Learn more at: https://docs.deno.com/go/--allow-net
‚î†‚îÄ Run again with --allow-net to bypass this prompt.
‚îó Allow? [y/n/A] (y = yes, allow; n = no, deny; A = allow all net permissions) &gt;</code></pre><div><p>cidr_ranges.ts</p><pre><span>const</span> res1 <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;http://192.168.0.128:8080&#34;</span><span>)</span><span>;</span>
<span>const</span> res2 <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;http://192.168.0.1:8080&#34;</span><span>)</span><span>;</span></pre></div><pre><code>$ deno --allow-net=192.168.0.128/25 main.ts
Response {
  url: &#34;&#34;http://192.168.0.128:8080&#34;&#34;,
  ...
}
‚îè ‚ö†Ô∏è  Deno requests net access to &#34;192.168.0.1:8080&#34;.
‚î†‚îÄ Requested by `fetch()` API.
‚î†‚îÄ To see a stack trace for this prompt, set the DENO_TRACE_PERMISSIONS environmental variable.
‚î†‚îÄ Learn more at: https://docs.deno.com/go/--allow-net
‚î†‚îÄ Run again with --allow-net to bypass this prompt.
‚îó Allow? [y/n/A] (y = yes, allow; n = no, deny; A = allow all net permissions) &gt;</code></pre><p>Deno 2 added
<a href="https://docs.deno.com/runtime/fundamentals/security/#importing-from-the-web" rel="noopener noreferrer"><code>--allow-import</code> flag</a>
that allows you to specify which remote hosts Deno can download and execute code
from.</p>
<p>This release adds a complimentary <code>--deny-import</code> flag that allows to explicitly
block certain hosts.</p>
<p>By default Deno allows to import code from several hosts:</p>
<ul>
<li><code>deno.land:443</code></li>
<li><code>jsr.io:443</code></li>
<li><code>esm.sh:443</code></li>
<li><code>cdn.jsdelivr.net:443</code></li>
<li><code>raw.githubusercontent.com:443</code></li>
<li><code>user.githubusercontent.com:443</code></li>
</ul>
<figure>

<div><p>main.ts</p><pre><span>import</span> <span><span>*</span> <span>as</span> cowsay</span> <span>from</span> <span>&#34;https://cdn.jsdelivr.net/npm/cowsay&#34;</span><span>;</span></pre></div><div><pre>$ deno main.ts</pre></div><p>Now, you can disallow importing code from one of the default hosts:</p>
<div><pre>$ deno --deny-import<span>=</span>cdn.jsdelivr.net main.ts
error: Requires <span>import</span> access to <span>&#34;cdn.jsdelivr.net:443&#34;</span>, run again with the --allow-import flag
    at file:///main.ts:1:25</pre></div></figure>

<p>To further supplement <code>--allow-import</code> usages, the
<a href="https://docs.deno.com/api/deno/~/Deno.Permissions" rel="noopener noreferrer"><code>Deno.permissions</code></a> runtime
API has been fixed to support <code>&#34;import&#34;</code> type:</p>
<div><pre><span>console</span><span>.</span><span>log</span><span>(</span><span>Deno</span><span>.</span><span>permissions</span><span>.</span><span>query</span><span>(</span><span>{</span> name<span>:</span> <span>&#34;import&#34;</span> <span>}</span><span>)</span><span>)</span><span>;</span>
</pre></div><p>Finally, the <a href="https://docs.deno.com/api/deno/~/Deno.execPath" rel="noopener noreferrer"><code>Deno.execPath()</code></a>
API doesn‚Äôt require read permissions anymore:</p>
<div><p>main.ts</p><pre><span>console</span><span>.</span><span>log</span><span>(</span><span>Deno</span><span>.</span><span>execPath</span><span>(</span><span>)</span><span>)</span><span>;</span></pre></div><div><pre>

$ deno main.ts
‚îè ‚ö†Ô∏è  Deno requests <span>read</span> access to <span>&lt;</span>exec_path<span>&gt;</span>.
‚î†‚îÄ Requested by <span><span>`</span>Deno.execPath<span>(</span><span>)</span><span>`</span></span> API.
‚î†‚îÄ To see a stack trace <span>for</span> this prompt, <span>set</span> the DENO_TRACE_PERMISSIONS environmental variable.
‚î†‚îÄ Learn <span>more</span> at: https://docs.deno.com/go/--allow-read
‚î†‚îÄ Run again with --allow-read to bypass this prompt.
‚îó Allow? <span>[</span>y/n/A<span>]</span> <span>(</span>y <span>=</span> yes, allow<span>;</span> n <span>=</span> no, deny<span>;</span> A <span>=</span> allow all <span>read</span> permissions<span>)</span> <span>&gt;</span>


$ deno main.ts
/dev/.deno/bin/deno</pre></div><p>We made this update because in common scenarios, requiring read permission ends
up less secure than <em>not</em> requiring permissions. For example, if a user wants to
spawn a Deno subprocess using the current executable, they would do something
like:</p>
<div><p>spawn.ts</p><pre><span>new</span> <span><span>Deno</span></span><span>.</span><span><span>Command</span></span><span>(</span><span>Deno</span><span>.</span><span>execPath</span><span>(</span><span>)</span><span>,</span> <span>{</span> args<span>:</span> <span>[</span><span>&#34;eval&#34;</span><span>,</span> <span>&#34;1+1&#34;</span><span>]</span> <span>}</span><span>)</span><span>.</span><span>outputSync</span><span>(</span><span>)</span><span>;</span></pre></div><p>And to run it:</p>
<div><pre>

$ deno --allow-read --allow-run<span>=</span>deno spawn.ts


$ deno --allow-run<span>=</span>deno</pre></div><p>Before Deno 2.4, it was possible to limit the scope of <code>--allow-read</code> flag, but
it required upfront knowledge of where the Deno executable was or a bit of shell
expansion trickery. Most users understandably opted to give a blanket
<code>--allow-read</code> flag instead.</p>
<p>Not requiring read permissions allows the above program to be run with just
<code>--allow-run=deno</code> flag.</p>
<h2 id="conditional-packagejson-exports"><a aria-hidden="true" tabindex="-1" href="#conditional-packagejson-exports"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Conditional <code>package.json</code> exports</h2>
<p>This version ships with support for
<a href="https://docs.deno.com/go/conditional-exports" rel="noopener noreferrer">conditional exports in npm packages</a>.</p>
<p>Conditional exports is a mechanism that allows npm packages to use different
exports depending on the user provided conditions.</p>
<p>The stark example here is
<a href="https://github.com/reactjs/rfcs/blob/c15bc9df5afa8fd1dca6e5fd1c2ed073f7a9bd79/text/0227-server-module-conventions.md?plain=1#L54" rel="noopener noreferrer">the <code>react-server</code> condition</a>
that libraries from the React ecosystem can use to swap out exports for use with
Server Components.</p>
<div><p>app.jsx</p><pre><span>import</span> <span>react</span> <span>from</span> <span>&#34;npm:react@19.1.0&#34;</span><span>;</span>

<span>console</span><span>.</span><span>log</span><span>(</span>react<span>.</span><span><span>Component</span></span><span>)</span><span>;</span></pre></div><div><pre>$ deno app.jsx
Component: <span>[</span>Function: Component<span>]</span>

$ deno <span>--conditions</span><span>=</span>react-server app.jsx
undefined</pre></div><p>You can specify arbitrary conditions and as many of them as you want. If the
flag is not used Deno uses following conditions by default: <code>deno</code>, <code>node</code>,
<code>import</code>, <code>default</code>.</p>
<p>We expect most users to not have to use this flag directly, but is a crucial
option for the tooling you might depend on.</p>
<h2 id="deno-run-bare-specifiers"><a aria-hidden="true" tabindex="-1" href="#deno-run-bare-specifiers"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>deno run</code> bare specifiers</h2>
<p>Deno v2.4 now supports using bare specifiers as entry points in
<a href="https://docs.deno.com/runtime/reference/cli/run/" rel="noopener noreferrer"><code>deno run</code></a>.</p>
<p>Imagine you had a <code>deno.json</code> like this:</p>
<div><p>deno.json</p><pre><span>{</span>
  <span>&#34;imports&#34;</span><span>:</span> <span>{</span>
    <span>&#34;lume/&#34;</span><span>:</span> <span>&#34;https://deno.land/x/lume@v3.0.4/&#34;</span><span>,</span>
    <span>&#34;file-server&#34;</span><span>:</span> <span>&#34;jsr:@std/http/file-server&#34;</span><span>,</span>
    <span>&#34;cowsay&#34;</span><span>:</span> <span>&#34;npm:cowsay&#34;</span>
  <span>}</span>
<span>}</span></pre></div><p>You might have expected to be able to <code>deno run file-server</code> and be done with
it. Unfortunately, before Deno 2.4, this didn‚Äôt work:</p>
<div><pre>

$ deno run <span>-ERW</span> lume/cli.ts
error: Module not found <span>&#34;file:///dev/lume/cli.ts&#34;</span><span>.</span>

$ deno run file-server
error: Module not found <span>&#34;file:///dev/file-server&#34;</span><span>.</span>

$ deno run <span>-ER</span> cowsay <span>&#34;Hello there!&#34;</span>
error: Module not found <span>&#34;file:///dev/cowsay&#34;</span><span>.</span></pre></div><p>However, in 2.4:</p>
<div><pre>

$ deno run <span>-ERW</span> lume/cli.ts
üçæ Site built into ./_site

$ deno run file-server
Listening on <span>..</span>.

$ deno run <span>-ER</span> cowsay <span>&#34;Hello there!&#34;</span>
 ______________
<span>&lt;</span> Hello there<span>!</span> <span>&gt;</span>
 --------------
        <span>\</span>   ^__^
         <span>\</span>  <span>(</span>oo<span>)</span><span>\</span>_______
            <span>(</span>__<span>)</span><span>\</span>       <span>)</span><span>\</span>/<span>\</span>
                <span>||</span>----w <span>|</span>
                <span>||</span>     <span>||</span></pre></div><p><em>In most cases you can also omit <code>run</code> subcommand, like so
<code>deno -ER cowsay &#34;Hello there!&#34;</code></em></p>
<h2 id="deno-fmt-xml-and-svg-files"><a aria-hidden="true" tabindex="-1" href="#deno-fmt-xml-and-svg-files"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>deno fmt</code> XML and SVG files</h2>
<p><a href="https://docs.deno.com/runtime/reference/cli/fmt/" rel="noopener noreferrer"><code>deno fmt</code></a> will know
automatically format <code>.xml</code> and <code>.svg</code> files for you:</p>
<div><p>circle.svg</p><pre><span><span><span>&lt;</span>svg</span>    <span>width</span><span><span>=</span><span>&#34;</span>100<span>&#34;</span></span>    <span>height</span><span><span>=</span><span>&#34;</span>100<span>&#34;</span></span><span>&gt;</span></span>
  <span><span><span>&lt;</span>circle</span> <span>cx</span><span><span>=</span><span>&#34;</span>50<span>&#34;</span></span> <span>cy</span><span><span>=</span><span>&#34;</span>50<span>&#34;</span></span> 
    <span>r</span><span><span>=</span><span>&#34;</span>40<span>&#34;</span></span> <span>stroke</span><span><span>=</span><span>&#34;</span>green<span>&#34;</span></span> <span>stroke-width</span><span><span>=</span><span>&#34;</span>4<span>&#34;</span></span> 
  <span>fill</span><span><span>=</span><span>&#34;</span>yellow<span>&#34;</span></span> <span>/&gt;</span></span>
<span><span><span>&lt;/</span>svg</span><span>&gt;</span></span></pre></div><div><pre>$ deno <span>fmt</span>
/dev/circle.svg
Formatted <span>1</span> <span>file</span>

$ <span>cat</span> circle.svg
<span>&lt;</span>svg <span>width</span><span>=</span><span>&#34;100&#34;</span> <span>height</span><span>=</span><span>&#34;100&#34;</span><span>&gt;</span>
  <span>&lt;</span>circle
    <span>cx</span><span>=</span><span>&#34;50&#34;</span>
    <span>cy</span><span>=</span><span>&#34;50&#34;</span>
    <span>r</span><span>=</span><span>&#34;40&#34;</span>
    <span>stroke</span><span>=</span><span>&#34;green&#34;</span>
    stroke-width<span>=</span><span>&#34;4&#34;</span>
    <span>fill</span><span>=</span><span>&#34;yellow&#34;</span>
  /<span>&gt;</span>
<span>&lt;</span>/svg<span>&gt;</span></pre></div><p>Additionally, formatting <code>.mustache</code> templates is now supported, but requires
<code>--unstable-component</code> flag or <code>unstable.fmt-component</code> option in <code>deno.json</code>.</p>
<h2 id="better-tsconfigjson-support"><a aria-hidden="true" tabindex="-1" href="#better-tsconfigjson-support"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Better <code>tsconfig.json</code> support</h2>
<p>Deno automatically discovers <code>tsconfig.json</code> files next to <code>deno.json</code> and/or
<code>package.json</code> files.</p>
<p>This release also brings better handling for <code>tsconfig.json</code> files, with added
support for <code>&#34;references&#34;</code>, <code>&#34;extends&#34;</code>, <code>&#34;files&#34;</code>, <code>&#34;include&#34;</code> and <code>&#34;exclude&#34;</code>
options. That means you can expect a much better experience when working with
popular frontend frameworks like
<a href="https://docs.deno.com/examples/vue_tutorial/" rel="noopener noreferrer">Vue</a>, Svelte,
<a href="https://docs.deno.com/examples/solidjs_tutorial/" rel="noopener noreferrer">Solid</a>,
<a href="https://docs.deno.com/examples/qwik_tutorial/" rel="noopener noreferrer">Qwik</a> and more.</p>
<h2 id="simpler-node-globals"><a aria-hidden="true" tabindex="-1" href="#simpler-node-globals"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Simpler Node globals</h2>
<p><a href="https://deno.com/blog/v2.0-release-candidate#changes-to-global-variables" rel="noopener noreferrer">Deno v2.0 added the <code>process</code> global</a>
for improved compatibility with existing npm ecosystem. But there are more
global variables that were not available in Deno for user code, but were
available for npm packages:</p>
<ul>
<li><code>Buffer</code></li>
<li><code>global</code></li>
<li><code>setImmediate</code></li>
<li><code>clearImmediate</code></li>
</ul>
<p>Additionally, globals like <code>setTimeout</code> and <code>setInterval</code> (as well as their
<code>clear*</code> counterparts) are different globals depending if the context was user
code or in an npm dependency.</p>
<p>To achieve this bifurcation, we used a fairly complex setup hooking into V8
internal APIs to decide if a global is available at a particular call site or
not. While the solution was clever, it comes with a high performance cost ‚Äî on
each access of one of these globals, we were walking the stack and checking if
the call site is coming from an npm package. Finally, the mental overhead of
understanding which globals are available where is non-trivial.</p>
<p>In this release, we‚Äôve made <code>Buffer</code>, <code>global</code>, <code>setImmediate</code> and
<code>clearImmediate</code> available to user code as well. This helps if you are running
an existing Node.js project that relies on these globals, as you no longer need
to use the <code>--unstable-node-globals</code> flag to expose them, since they are now
available everywhere all the time.</p>
<h2 id="local-npm-packages"><a aria-hidden="true" tabindex="-1" href="#local-npm-packages"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Local npm packages</h2>
<p>In
<a href="https://deno.com/blog/v2.3#local-npm-packages" rel="noopener noreferrer">Deno v2.3, we introduced a way to use local npm packages</a>.
We received a lot of positive feedback about this issue, but some of you raised
concerns that the <code>patch</code> option can be easily confused with <code>npm patch</code>.</p>
<p>The option has been renamed to <code>links</code> (to better reflect <code>npm link</code> equivalent
functionality). You will receive a deprecation warning when using <code>patch</code> option
instead of <code>links</code>.</p>
<div><p>deno.json</p><pre>{
<span><span>+</span><span> &#34;links&#34;: [
</span></span><span><span>-</span><span> &#34;patch&#34;: [
</span></span><span><span> </span><span>   &#34;../cowsay&#34;
</span><span> </span><span> ]
</span></span>}</pre></div><p><em>In the future we might support <code>npm patch</code> equivalent functionlity out of the
box. If you depend on this tool,
<a href="https://github.com/denoland/deno/issues/new" rel="noopener noreferrer">let us know</a>.</em></p>
<h2 id="nodejs-api-support"><a aria-hidden="true" tabindex="-1" href="#nodejs-api-support"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Node.js API support</h2>
<p>We‚Äôve improved support for Node.js APIs again. Aside from the numerous additions
and fixes that you can dive into in the list below, the highlight is support for
the <a href="https://github.com/denoland/deno/pull/28972" rel="noopener noreferrer"><code>glob</code> API</a>, as well as
achieving over 95% compatibility for modules such as <code>node:buffer</code>,
<code>node:events</code>, <code>node:querystring</code>, <code>node:quic</code> and <code>node:wasm</code>.</p>
<p>We plan to keep increasing these compatibility numbers in the next release with
focus on modules such as <code>node:crypto</code>, <code>node:http</code>, <code>node:tls</code>, <code>node:worker</code>
and <code>node:zlib</code>.</p>
<p>Additionally, Deno 2.4 will use <code>@types/node</code> version 22.15.14 by default when
type checking.</p>
<p>Finally, here‚Äôs the full list of Node.js API fixes:</p>
<ul>
<li><a href="https://github.com/denoland/deno/pull/28972" rel="noopener noreferrer">Add <code>fs.glob</code>, <code>fs.globSync</code>, <code>fs.promises.glob</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29717" rel="noopener noreferrer"><code>process.loadEnvFile</code> correctly returns <code>undefined</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29474" rel="noopener noreferrer">Add <code>internal/http2/util</code> module</a></li>
<li><a href="https://github.com/denoland/deno/pull/29791" rel="noopener noreferrer">Add <code>fs.fchmod</code> and <code>fs.fchmodSync</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29408" rel="noopener noreferrer">Add <code>fs.fchown</code> and <code>fs.fchownSync</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29833" rel="noopener noreferrer">Add <code>fs.lchmod</code>, <code>fs.promises.lchmod</code> and <code>fs.lchmodSync</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29273" rel="noopener noreferrer">Add AES CTR to supported ciphers list</a></li>
<li><a href="https://github.com/denoland/deno/pull/29226" rel="noopener noreferrer">Add assert.CallTracker</a></li>
<li><a href="https://github.com/denoland/deno/pull/29636" rel="noopener noreferrer">Add <code>events.getMaxListeners</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29757" rel="noopener noreferrer">Add key length validation in <code>DiffieHellman.prototype.computeSecret</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29879" rel="noopener noreferrer">Type check <code>LibuvStreamWrap.writeBuffer</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29800" rel="noopener noreferrer">Add validation to <code>Cipheriv</code> methods</a></li>
<li><a href="https://github.com/denoland/deno/pull/29275" rel="noopener noreferrer">Align input validation of <code>Buffer.compare</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29245" rel="noopener noreferrer"><code>node:tls</code> allows <code>rejectUnauthorized: false</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29524" rel="noopener noreferrer">Check OOB when writing to <code>Buffer</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29525" rel="noopener noreferrer">Make <code>Buffer.fill</code> correct</a></li>
<li><a href="https://github.com/denoland/deno/pull/29504" rel="noopener noreferrer">Correct <code>kMaxLength</code> value of <code>node:buffer</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29472" rel="noopener noreferrer"><code>net.createInterface</code> doesn‚Äôt require env permission</a></li>
<li><a href="https://github.com/denoland/deno/pull/29758" rel="noopener noreferrer">Add <code>crypto.timingSafeEqual</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29774" rel="noopener noreferrer">Deprecate <code>Hash</code> and <code>Hmac</code> constructors</a></li>
<li><a href="https://github.com/denoland/deno/pull/29207" rel="noopener noreferrer"><code>dgram</code> multicast group membership</a></li>
<li><a href="https://github.com/denoland/deno/pull/29718" rel="noopener noreferrer"><code>crypto.DiffieHellman</code> constructor behaviors</a></li>
<li><a href="https://github.com/denoland/deno/pull/29105" rel="noopener noreferrer">Don‚Äôt use user manipulated Response objects, use correct <code>rawHeaders</code> structure</a></li>
<li><a href="https://github.com/denoland/deno/pull/29345" rel="noopener noreferrer">Emit <code>worker</code> event when a new worker thread is created</a></li>
<li><a href="https://github.com/denoland/deno/pull/29592" rel="noopener noreferrer">Enable <code>Buffer</code> pool for strings</a></li>
<li><a href="https://github.com/denoland/deno/pull/29271" rel="noopener noreferrer">Export <code>assert.CallTracker</code> as named export</a></li>
<li><a href="https://github.com/denoland/deno/pull/29870" rel="noopener noreferrer">Add <code>fs.promises.lchown</code> and <code>fs.promises.lutimes</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29563" rel="noopener noreferrer">Export <code>StatementSync</code> from <code>node:sqlite</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29617" rel="noopener noreferrer">Fix <code>Buffer.inspect</code> compatiblity</a></li>
<li><a href="https://github.com/denoland/deno/pull/29738" rel="noopener noreferrer">Fix <code>crypto.pbkdf2</code> compat</a></li>
<li><a href="https://github.com/denoland/deno/pull/29368" rel="noopener noreferrer">Fix <code>Database#exec</code> should return undefined</a></li>
<li><a href="https://github.com/denoland/deno/pull/29682" rel="noopener noreferrer">Fix <code>EventEmitter.on</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29480" rel="noopener noreferrer">Fix <code>getEventListeners</code> in <code>node:events</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29634" rel="noopener noreferrer">Fix <code>addAbortListener</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29803" rel="noopener noreferrer">Fix assertion error message of assert.ok</a></li>
<li><a href="https://github.com/denoland/deno/pull/29591" rel="noopener noreferrer">Fix buffer.includes edge cases</a></li>
<li><a href="https://github.com/denoland/deno/pull/29593" rel="noopener noreferrer">Fix buffer.indexOf for ucs2 encoding</a></li>
<li><a href="https://github.com/denoland/deno/pull/29167" rel="noopener noreferrer">Fix dns.lookup when promisified with <code>options.all</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29721" rel="noopener noreferrer">Fix error type in <code>crypto.DiffieHellman</code> constructor</a></li>
<li><a href="https://github.com/denoland/deno/pull/29685" rel="noopener noreferrer">Fix <code>events.getEventListeners</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29716" rel="noopener noreferrer">Fix <code>events.once</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29237" rel="noopener noreferrer">Correctly export <code>loadEnvFile</code> from <code>node:process</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29659" rel="noopener noreferrer">Fix <code>fs.watchFile</code> trigger</a></li>
<li><a href="https://github.com/denoland/deno/pull/29526" rel="noopener noreferrer">Fix function error message in <code>invalidArgTypeHelper</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29775" rel="noopener noreferrer">Fix input validation of <code>crypto.hkdf</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29668" rel="noopener noreferrer">Fix inspect of <code>CustomEvent</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29661" rel="noopener noreferrer">Fix oneshot hash validation</a></li>
<li><a href="https://github.com/denoland/deno/pull/29576" rel="noopener noreferrer">Fix prototype of <code>asymmetricKeyDetails</code> of <code>AsymmetricKeyObject</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29894" rel="noopener noreferrer">Fix <code>ReferenceError</code> in <code>node:stream</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29630" rel="noopener noreferrer">Fix validation of input in <code>events.setMaxListeners</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29611" rel="noopener noreferrer">Handle <code>-p</code> flag in <code>spawn</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29365" rel="noopener noreferrer">Handle <code>null</code> ssl options in <code>node:https</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29210" rel="noopener noreferrer">Hold weak reference to SQLite database in instances</a></li>
<li><a href="https://github.com/denoland/deno/pull/29367" rel="noopener noreferrer">Implement <code>before</code> and <code>after</code> hooks in <code>node:test</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29828" rel="noopener noreferrer">Implement <code>crypto.Certificate</code> API</a></li>
<li><a href="https://github.com/denoland/deno/pull/29195" rel="noopener noreferrer">Implement <code>dgram.setBroadcast</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29241" rel="noopener noreferrer">Implement <code>dgram.setMulticastLoopback</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29232" rel="noopener noreferrer">Implement <code>dgram.setMulticastTTL</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29850" rel="noopener noreferrer">Improve <code>assert.fail</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29846" rel="noopener noreferrer">Improve <code>assert.ifError</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29819" rel="noopener noreferrer">Improve comparison of faked objects in <code>assert.deepStrictEqual</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29501" rel="noopener noreferrer">Improve <code>getaddrinfo</code> compatibility</a></li>
<li><a href="https://github.com/denoland/deno/pull/29880" rel="noopener noreferrer">Improve input validations of <code>stream/consumers</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29773" rel="noopener noreferrer">Improve <code>crypto.scrypt</code> support</a></li>
<li><a href="https://github.com/denoland/deno/pull/29383" rel="noopener noreferrer">Include <code>assert.ok</code> in <code>node:test</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29896" rel="noopener noreferrer">Keep BOM in <code>Buffer.toString(&#39;utf8&#39;)</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29578" rel="noopener noreferrer">Make <code>Buffer</code> work with resizable ABs</a></li>
<li><a href="https://github.com/denoland/deno/pull/29640" rel="noopener noreferrer">Make conditional exports work in <code>require()</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29564" rel="noopener noreferrer">Make <code>DatabaseSync.readOnly</code> optional</a></li>
<li><a href="https://github.com/denoland/deno/pull/29612" rel="noopener noreferrer">Mark pool <code>ArrayBuffer</code> as untransferable</a></li>
<li><a href="https://github.com/denoland/deno/pull/29654" rel="noopener noreferrer">Match WebCrypto tag too small error msg with Node</a></li>
<li><a href="https://github.com/denoland/deno/pull/29725" rel="noopener noreferrer"><code>Module.wrap</code> cleanup for <code>npm:v8-code-cache</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29469" rel="noopener noreferrer"><code>node:buffer</code> validates <code>INSPECT_MAX_BYTES</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29600" rel="noopener noreferrer">Pass Node.js specific flags via <code>NODE_OPTIONS</code> env var in <code>spawn</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29353" rel="noopener noreferrer">Prevent stdin double read</a></li>
<li><a href="https://github.com/denoland/deno/pull/29860" rel="noopener noreferrer">Remove duplicated stream classes</a></li>
<li><a href="https://github.com/denoland/deno/pull/29567" rel="noopener noreferrer">Return <code>undefined</code> instead of <code>null</code> in <code>node:sqlite</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29440" rel="noopener noreferrer">Return values in <code>node:domain</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29485" rel="noopener noreferrer">Stub <code>crypto.getFipsCrypto</code> to <code>false</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29664" rel="noopener noreferrer">Support 2nd arg of <code>EventEmitter.prototype.listenerCount</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29530" rel="noopener noreferrer">Support <code>DEP0005</code> deprecation warning</a></li>
<li><a href="https://github.com/denoland/deno/pull/29182" rel="noopener noreferrer">Support HTTP over unix sockets</a></li>
<li><a href="https://github.com/denoland/deno/pull/29798" rel="noopener noreferrer">Support <code>KeyObject</code> in <code>crypto.publicEncrypt</code>/<code>crypto.privateDecrypt</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/28937" rel="noopener noreferrer">Support mTLS connections</a></li>
<li><a href="https://github.com/denoland/deno/pull/29752" rel="noopener noreferrer">Throw invalid state from <code>crypto.getAuthTag</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29279" rel="noopener noreferrer">Support TLS server unref</a></li>
<li><a href="https://github.com/denoland/deno/pull/29652" rel="noopener noreferrer">Update <code>crypto.decipherIv</code> error properties</a></li>
<li><a href="https://github.com/denoland/deno/pull/29632" rel="noopener noreferrer">Update interaction between event emitters and domains</a></li>
<li><a href="https://github.com/denoland/deno/pull/29613" rel="noopener noreferrer">Update message for <code>MaxListenersExceededWarning</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29231" rel="noopener noreferrer">Use ‚Äúlocalhost‚Äù as default tls hostname</a></li>
<li><a href="https://github.com/denoland/deno/pull/29739" rel="noopener noreferrer">Validate auth tag for GCM mode cipher</a></li>
<li><a href="https://github.com/denoland/deno/pull/29653" rel="noopener noreferrer">Validate prime bigint candidate</a></li>
<li><a href="https://github.com/denoland/deno/pull/29656" rel="noopener noreferrer">Validate <code>randomUUID()</code> options</a></li>
<li><a href="https://github.com/denoland/deno/pull/29211" rel="noopener noreferrer">Fix <code>ServerResponse.req</code> not being set</a></li>
<li><a href="https://github.com/denoland/deno/pull/29428" rel="noopener noreferrer">Throw on <code>assert.deepStrictEqual({}, Object.create(null))</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29222" rel="noopener noreferrer">Support for <code>t.skip</code> and <code>t.todo</code> in <code>node:test</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29546" rel="noopener noreferrer">Don‚Äôt return a smi from <code>zlib.crc32</code></a></li>
</ul>
<h2 id="lsp-improvements"><a aria-hidden="true" tabindex="-1" href="#lsp-improvements"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>LSP improvements</h2>
<p>The Deno LSP received numerous improvements including:</p>
<ul>
<li><a href="https://github.com/denoland/deno/pull/29420" rel="noopener noreferrer"><code>deno.config</code> option in now correctly handled outside of workspace</a></li>
<li>Jupyter cells correctly handle
<a href="https://github.com/denoland/deno/pull/29114" rel="noopener noreferrer"><code>for await</code></a> and
<a href="https://github.com/denoland/deno/pull/29712" rel="noopener noreferrer">respect media type for <code>tsx</code></a></li>
<li><a href="https://github.com/denoland/deno/pull/29180" rel="noopener noreferrer">Use correct resolution kind when checking for no-export-npm</a></li>
<li><a href="https://github.com/denoland/deno/pull/29304" rel="noopener noreferrer">Lookup bare workspace specifiers for auto-import</a></li>
<li><a href="https://github.com/denoland/deno/pull/29388" rel="noopener noreferrer">Lookup mapped npm specifier resolutions for auto-import</a></li>
<li><a href="https://github.com/denoland/deno/pull/29437" rel="noopener noreferrer">Lookup patched jsr packages for auto-import</a></li>
<li><a href="https://github.com/denoland/deno/pull/29566" rel="noopener noreferrer">Use canonicalized fallback filesystem root</a></li>
<li><a href="https://github.com/denoland/deno/pull/29192" rel="noopener noreferrer">Truncate JSON files larger than 10Mb</a></li>
<li><a href="https://github.com/denoland/deno/pull/29162" rel="noopener noreferrer">Don‚Äôt diff 10,000+ line files for formatting</a></li>
<li><a href="https://github.com/denoland/deno/pull/29194" rel="noopener noreferrer">Discard quick fixes importing /node_modules/ paths</a></li>
<li><a href="https://github.com/denoland/deno/pull/29463" rel="noopener noreferrer">Do not warn about unscoped package name</a></li>
<li><a href="https://github.com/denoland/deno/pull/29415" rel="noopener noreferrer">Don‚Äôt cache jsxImportSource on lockfile-only changes</a></li>
<li><a href="https://github.com/denoland/deno/pull/29888" rel="noopener noreferrer">Don‚Äôt show no-export diagnostics for type-only npm imports</a></li>
</ul>
<h2 id="other-fun-things"><a aria-hidden="true" tabindex="-1" href="#other-fun-things"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Other fun things</h2>
<ul>
<li><code>fetch</code> now works over Unix and Vsock sockets - create an instance of
<code>Deno.HttpClient</code> with a proper <code>proxy</code> option:</li>
</ul>
<div><p>fetch.ts</p><pre><span>const</span> client <span>=</span> <span>Deno</span><span>.</span><span>createHttpClient</span><span>(</span><span>{</span>
  proxy<span>:</span> <span>{</span>
    transport<span>:</span> <span>&#34;unix&#34;</span><span>,</span>
    path<span>:</span> <span>&#34;/path/to/unix.sock&#34;</span><span>,</span>
  <span>}</span><span>,</span>
  
  proxy<span>:</span> <span>{</span>
    transport<span>:</span> <span>&#34;vsock&#34;</span><span>,</span>
    cid<span>:</span> <span>2</span><span>,</span>
    port<span>:</span> <span>80</span><span>,</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span><span>;</span>

<span>await</span> <span>fetch</span><span>(</span><span>&#34;http://localhost/ping&#34;</span><span>,</span> <span>{</span> client <span>}</span><span>)</span><span>;</span></pre></div><ul>
<li><code>deno serve</code> now supports <code>onListen()</code> callbacks:</li>
</ul>
<div><p>server.ts</p><pre><span>export</span> <span>default</span> <span>{</span>
  <span>fetch</span><span>(</span>req<span>)</span> <span>{</span>
    <span>return</span> <span>new</span> <span><span>Response</span></span><span>(</span><span>&#34;Hello world!&#34;</span><span>)</span><span>;</span>
  <span>}</span><span>,</span>
  <span>onListen</span><span>(</span>addr<span>)</span> <span>{</span>
    <span>console</span><span>.</span><span>log</span><span>(</span>
      <span><span>`</span><span>üòé Hello world server started on </span><span><span>${</span>addr<span>.</span><span>hostname</span><span>}</span></span><span>:</span><span><span>${</span>addr<span>.</span><span>port</span><span>}</span></span><span>`</span></span><span>,</span>
    <span>)</span><span>;</span>
  <span>}</span><span>,</span>
<span>}</span> satisfies <span>Deno</span><span>.</span><span><span>ServeDefaultExport</span></span><span>;</span></pre></div><pre><code>$ deno serve server.ts
üòé Hello world server started on 0.0.0.0:8000</code></pre><ul>
<li>Better management of Jupyter kernels with <code>deno jupyter</code>:</li>
</ul>
<pre><code># Give kernel an explicit name
$ deno jupyter --install --name=&#34;deno_kernel&#34;
‚úÖ Deno kernelspec installed successfully at /Jupyter/kernels/deno_kernel.

# Don&#39;t overwrite existing kernel by mistake
$ deno jupyter --install --name=&#34;deno_kernel&#34;
error: Deno kernel already exists at /Jupyter/kernels/deno_kernel, run again with `--force` to overwrite it

# Give a display name to the kernel
deno jupyter --install --display=&#34;Deno 2.4 kernel&#34;
# Now you will see &#34;Deno 2.4 kernel&#34; in the kernel selector UI</code></pre><ul>
<li>Lint plugins can now access comments</li>
</ul>
<div><p>my-plugin.ts</p><pre><span>export</span> <span>default</span> <span>{</span>
  name<span>:</span> <span>&#34;my-lint-plugin&#34;</span><span>,</span>
  rules<span>:</span> <span>{</span>
    <span>&#34;my-lint-rule&#34;</span><span>:</span> <span>{</span>
      <span>create</span><span>(</span>context<span>)</span> <span>{</span>
        <span>return</span> <span>{</span>
          <span><span>Program</span></span><span>(</span>node<span>)</span> <span>{</span>
            <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Top level comments&#34;</span><span>,</span> node<span>.</span><span>comments</span><span>)</span><span>;</span>
          <span>}</span><span>,</span>
          <span><span>FunctionDeclaration</span></span><span>(</span>node<span>)</span> <span>{</span>
            <span>const</span> all <span>=</span> ctx<span>.</span><span>sourceCode</span><span>.</span><span>getAllComments</span><span>(</span><span>)</span><span>;</span>
            <span>const</span> before <span>=</span> ctx<span>.</span><span>sourceCode</span><span>.</span><span>getCommentsBefore</span><span>(</span>node<span>)</span><span>;</span>
            <span>const</span> after <span>=</span> ctx<span>.</span><span>sourceCode</span><span>.</span><span>getCommentsAfter</span><span>(</span>node<span>)</span><span>;</span>
            <span>const</span> inside <span>=</span> ctx<span>.</span><span>sourceCode</span><span>.</span><span>getCommentsInside</span><span>(</span>node<span>)</span><span>;</span>

            <span>console</span><span>.</span><span>log</span><span>(</span><span>{</span> program<span>,</span> all<span>,</span> before<span>,</span> after<span>,</span> inside <span>}</span><span>)</span><span>;</span>
          <span>}</span><span>,</span>
        <span>}</span><span>;</span>
      <span>}</span><span>,</span>
    <span>}</span><span>,</span>
  <span>}</span><span>,</span>
<span>}</span> satisfies <span>Deno</span><span>.</span><span>lint</span><span>.</span><span><span>Plugin</span></span><span>;</span></pre></div><ul>
<li><code>deno bench</code> and <code>deno coverage</code> tables are now Markdown compatible</li>
</ul>
<p>You can now directly copy-paste them into Markdown documents with proper
rendering</p>
<pre><code># Before
-----------------------------------
File          | Branch % | Line % |
-----------------------------------
 parser.ts    |     87.1 |   86.4 |
 tokenizer.ts |     80.0 |   92.3 |
-----------------------------------
 All files    |     86.1 |   87.4 |
-----------------------------------

# After
| File         | Branch % | Line % |
| ------------ | -------- | ------ |
| parser.ts    |     87.1 |   86.4 |
| tokenizer.ts |     80.0 |   92.3 |
| All files    |     86.1 |   87.4 |</code></pre><ul>
<li>Listening for Ctrl+Close (<code>SIGHUP</code>) now works correctly on Windows</li>
</ul>
<div><p>signal.ts</p><pre>

<span>Deno</span><span>.</span><span>addSignalListener</span><span>(</span><span>&#34;SIGHUP&#34;</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Got SIGHUP&#34;</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></pre></div><h2 id="acknowledgments"><a aria-hidden="true" tabindex="-1" href="#acknowledgments"><svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Acknowledgments</h2>
<p>We couldn‚Äôt build Deno without the help of our community! Whether by answering
questions in our
community¬†<a href="https://discord.gg/deno" rel="noopener noreferrer">Discord server</a>¬†or¬†<a href="https://github.com/denoland/deno/issues" rel="noopener noreferrer">reporting bugs</a>,
we are incredibly grateful for your support. In particular, we‚Äôd like to thank
the following people for their contributions to Deno 2.4: ÊûóÁÇ≥ÊùÉ, Andr√© Lima,
Andy Vu, Asher Gomez, Boye Lillejord-Nyg√•rd, chirsz, Christian Svensson,
Clarence Delmacio Manuel, ctrl+d, Cyan, Daniel Osvaldo R, David Emanuel
Buchmann, Edilson Pateguana, Efe, Elias Rhouzlane, familyboat, Hajime-san, ikkz,
James Bronder, Janosh Riebesell, JasperVanEsveld, Jeff Hykin, Jonh Alexis, Kenta
Moriuchi, Kingsword, Laurence Rowe, Lino Le Van, LongYinan, Marshall Walker,
MikaelUrankar, nana4gonta, narumincho, Nicholas Berlette, scarf, Scott Kyle,
sgasho, Simon Lecoq, stefnotch, Timothy J. Aveni, ud2, Volker Schlecht, and
zino.</p>
<p>Would you like to join the ranks of Deno
contributors?¬†<a href="https://docs.deno.com/runtime/manual/references/contributing" rel="noopener noreferrer">Check out our contribution docs here</a>,
and we‚Äôll see you on the list next time.</p>
<p>Believe it or not, the changes listed above still don‚Äôt tell you everything that
got better in 2.4. You can view
the¬†<a href="https://github.com/denoland/deno/releases/tag/v2.4.0" rel="noopener noreferrer">full list of pull requests merged in Deno 2.4 on GitHub</a>.</p>
<p>Thank you for catching up with our 2.4 release, and we hope you love building
with Deno!</p>
<blockquote>
<p><strong>üö®Ô∏è¬†<a href="https://deno.com/deploy" rel="noopener noreferrer">There have been major updates to Deno Deploy!</a>¬†üö®Ô∏è</strong></p>
<ul>
<li><a href="https://www.youtube.com/watch?v=fRFqZsBivCo" rel="noopener noreferrer">Improved Playgrounds with livestreaming logs, traces, and templates like Next.js</a></li>
<li><a href="https://www.youtube.com/watch?v=PwDU8yTZmUM" rel="noopener noreferrer">Automatic and immediate observability and telemetry</a></li>
<li><a href="https://x.com/deno_land/status/1935625197295739103" rel="noopener noreferrer">Simpler management for environment variables</a></li>
</ul>
<p>and¬†<a href="https://docs.deno.com/deploy/early-access/changelog/" rel="noopener noreferrer">much more!</a></p>
<p><a href="https://deno.com/deploy" rel="noopener noreferrer">Get early access today.</a></p>
</blockquote>
</div></div>
  </body>
</html>
