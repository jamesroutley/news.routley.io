<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://macwright.com/2023/09/17/bikeshare-1.html">Original</a>
    <h1>Playing with bikeshare data, part one</h1>
    
    <div id="readability-page-1" class="page"><div><p><picture><source srcset="/images/2023-10-17-bikeshare-1-docked-citi-bikes.webp" type="image/webp"/><img alt="Docked Citi Bikes" src="https://www.wildlondon.org.uk/images/2023-10-17-bikeshare-1-docked-citi-bikes.jpg"/></picture></p><p>Since July, I’ve been archiving data from the Citi Bike GBFS feed. Every five minutes, I have a datapoint for each of the roughly 2,090 stations with numbers for how many bikes are available or broken, and how many bikes are electric. It’s a long-term project that combines my interests in bikes, large datasets, and visualiation. It’s far from finished, though: these are just casual, early “lab notes”.</p><h3 id="citi-bike">Citi Bike</h3><p>For those unfamiliar, <a href="https://citibikenyc.com/homepage">Citi Bike</a> is New York City’s bikeshare program. I ride it to work and back every day.</p><p>Citi Bike gives me hope for humanity. Yesterday I was reading a book out on Pier 6 in Brooklyn Bridge Park, and I saw a lot of people riding those bikeshare bikes - young couples on dates, a mother following her daughter’s little bike, every age and demographic. The bikes make people happy, give them a sense of freedom and ease that’s hard to find in the rest of city life.</p><p>They’re accessible, too: there are stations in most neighborhoods, the only exceptions being outer Brooklyn, where they’re slowing expanding the network, and South Williamsburg, where <a href="https://macwright.com/2023/08/25/fortress-in-brooklyn">local opposition</a> has blocked them. You can buy a membership which is $205/year, or $5 a month if you use SNAP or live in public housing. The program is accessible, the bikes are stable and easy to ride.</p><p>It’s a good thing.</p><p>But it’s embattled. By the anti-bike activists, whose arguments don’t bear repeating. But it’s also facing a crunch from the city and the bikeshare operators. Despite the program <a href="https://nyc.streetsblog.org/2023/05/26/citibank-renews-nyc-bike-share-sponsorship-is-it-time-for-public-funding">growing in popularity</a> every single year including this one, Lyft has been hinting that it might <a href="https://www.curbed.com/2023/04/lyft-bike-share-citi-bike.html">sell the business unit</a>. Uber benefited from the pandemic and has diversified into freight and food delivery, but Lyft notably hasn’t.</p><p><img alt="Uber versus Lyft stock" src="https://www.wildlondon.org.uk/images/2023-10-17-bikeshare-1-uber-versus-lyft-stock.png"/></p><p>They’re not doing very well as a business. So, Lyft wants to reduce their lines of business and focus on getting people into cars. So much for <a href="https://macwright.com/2019/07/27/beware-the-ethical-car">combating climate change.</a>. Lyft already pulled out of their contract with <a href="https://www.mprnews.org/story/2023/03/02/nice-ride-shuts-down-pioneering-minneapolis-bike-share-program">Minneapolis</a>, so the worst could happen for New York.</p><h3 id="my-project">My project</h3><p>Let’s get one thing out of the way first, this is the millionth project relating to this data and that’s a good thing! Here’s a cool <a href="https://github.com/maronem/CitiBike_Data">analysis of bikeshare data and gender</a>, and <a href="https://toddwschneider.com/posts/a-tale-of-twenty-two-million-citi-bikes-analyzing-the-nyc-bike-share-system/">another one with cool graphics</a>, and <a href="https://github.com/rolyatmax/citibike-trips">another one with WebGL</a>.</p><p>Bikeshare makes for a <em>really cool dataset</em>, because it’s geographic, free &amp; easy to obtain, and also because we <em>systematically undervalue the privacy of people using public transit and microtransit while giving drivers expansive <a href="https://macwright.com/2021/12/24/policing-the-open-road">privacy rights</a> which aren’t enough because they <a href="https://www.newyorker.com/magazine/2023/01/23/at-large-with-new-yorks-one-man-crime-spree">bend their license plates so that they don’t get speeding tickets in school zones</a> and tint their windows <a href="https://www.nydailynews.com/2023/06/06/suspect-in-double-fatal-dwi-wreck-admits-running-stop-sign-in-queens-nypd-says/">so much that they don’t even realize they’ve killed people in crashes</a>.</em></p><p>Bikeshare is a good dataset, though.</p><h3 id="gbfs">GBFS</h3><svg fill="none" viewBox="0 0 1779 166" width="100%" xmlns="http://www.w3.org/2000/svg"><rect fill="#224678" height="115" width="1184" x="298" y="25"></rect><path d="M368.273 96.643C368.541 81.1812 353.836 67.5258 338.609 68.7133C323.984 68.8935 310.517 82.2128 311.003 97.1317C311.224 111.806 324.509 124.95 339.13 124.588C352.896 125.074 366.556 114.202 368.103 100.182C368.227 99.007 368.308 97.8255 368.273 96.643Z" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="3.77953"></path><path d="M385.167 66.6785C385.435 51.2167 370.73 37.5613 355.502 38.7488C340.877 38.929 327.41 52.2483 327.896 67.1672C328.117 81.8417 341.403 94.9859 356.024 94.6239C369.79 95.1093 383.45 84.2377 384.996 70.2178C385.12 69.0425 385.202 67.861 385.167 66.6785Z" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="3.77953"></path><path d="M401.682 96.2927C401.951 80.8309 387.246 67.1755 372.018 68.3631C357.393 68.5433 343.926 81.8625 344.412 96.7814C344.633 111.456 357.919 124.6 372.539 124.238C386.305 124.724 399.965 113.852 401.512 99.8321C401.636 98.6568 401.718 97.4753 401.682 96.2927Z" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="3.77953"></path><path d="M463.834 74C463.381 72.6132 462.784 71.3705 462.042 70.272C461.315 69.1598 460.443 68.2124 459.427 67.4297C458.424 66.647 457.285 66.0497 456.008 65.6378C454.731 65.2259 453.33 65.0199 451.806 65.0199C449.307 65.0199 447.034 65.6652 444.988 66.956C442.943 68.2467 441.315 70.1484 440.107 72.6612C438.899 75.174 438.295 78.2566 438.295 81.9091C438.295 85.5616 438.906 88.6442 440.128 91.157C441.35 93.6697 443.004 95.5715 445.091 96.8622C447.179 98.1529 449.527 98.7983 452.135 98.7983C454.552 98.7983 456.68 98.2834 458.52 97.2536C460.374 96.21 461.816 94.7408 462.846 92.8459C463.889 90.9373 464.411 88.6922 464.411 86.1108L465.976 86.4403H453.289V81.9091H469.354V86.4403C469.354 89.9143 468.613 92.9351 467.13 95.5028C465.661 98.0705 463.628 100.062 461.033 101.476C458.452 102.876 455.486 103.577 452.135 103.577C448.401 103.577 445.119 102.698 442.29 100.94C439.475 99.1828 437.278 96.6837 435.699 93.4432C434.134 90.2027 433.351 86.358 433.351 81.9091C433.351 78.5724 433.798 75.5722 434.69 72.9084C435.596 70.2308 436.873 67.9515 438.521 66.0703C440.169 64.1892 442.119 62.7474 444.371 61.745C446.622 60.7427 449.101 60.2415 451.806 60.2415C454.03 60.2415 456.104 60.5779 458.026 61.2507C459.962 61.9098 461.685 62.8504 463.196 64.0724C464.72 65.2808 465.99 66.7294 467.006 68.4183C468.022 70.0935 468.723 71.9541 469.107 74H463.834ZM490.708 103.659C487.659 103.659 485.03 102.986 482.819 101.641C480.622 100.281 478.926 98.3864 477.732 95.956C476.551 93.5118 475.961 90.6695 475.961 87.429C475.961 84.1884 476.551 81.3324 477.732 78.8608C478.926 76.3755 480.588 74.4394 482.716 73.0526C484.858 71.652 487.357 70.9517 490.213 70.9517C491.861 70.9517 493.488 71.2263 495.095 71.7756C496.701 72.3248 498.164 73.2173 499.482 74.4531C500.8 75.6752 501.85 77.2955 502.633 79.3139C503.416 81.3324 503.807 83.8177 503.807 86.7699V88.8295H479.421V84.6278H498.864C498.864 82.8428 498.507 81.25 497.793 79.8494C497.093 78.4489 496.09 77.3435 494.786 76.5334C493.495 75.7232 491.971 75.3182 490.213 75.3182C488.277 75.3182 486.602 75.7988 485.188 76.7599C483.787 77.7074 482.709 78.9432 481.954 80.4673C481.199 81.9915 480.821 83.6255 480.821 85.3693V88.1705C480.821 90.5597 481.233 92.585 482.057 94.2464C482.895 95.8942 484.055 97.1506 485.538 98.0156C487.021 98.867 488.744 99.2926 490.708 99.2926C491.985 99.2926 493.138 99.1141 494.168 98.7571C495.212 98.3864 496.111 97.8371 496.866 97.1094C497.621 96.3679 498.205 95.4479 498.617 94.3494L503.313 95.6676C502.819 97.2604 501.988 98.661 500.821 99.8693C499.654 101.064 498.212 101.998 496.495 102.67C494.779 103.33 492.85 103.659 490.708 103.659ZM516.062 83.9688V103H511.201V71.3636H515.897V76.3068H516.309C517.051 74.7003 518.177 73.4096 519.687 72.4347C521.198 71.446 523.147 70.9517 525.537 70.9517C527.679 70.9517 529.553 71.3911 531.159 72.2699C532.766 73.1349 534.016 74.4531 534.908 76.2244C535.801 77.982 536.247 80.2064 536.247 82.8977V103H531.386V83.2273C531.386 80.742 530.741 78.8059 529.45 77.419C528.159 76.0185 526.388 75.3182 524.136 75.3182C522.584 75.3182 521.198 75.6546 519.975 76.3274C518.767 77.0002 517.813 77.982 517.113 79.2727C516.412 80.5634 516.062 82.1288 516.062 83.9688ZM558.393 103.659C555.345 103.659 552.715 102.986 550.505 101.641C548.308 100.281 546.612 98.3864 545.417 95.956C544.237 93.5118 543.646 90.6695 543.646 87.429C543.646 84.1884 544.237 81.3324 545.417 78.8608C546.612 76.3755 548.273 74.4394 550.402 73.0526C552.544 71.652 555.043 70.9517 557.899 70.9517C559.547 70.9517 561.174 71.2263 562.78 71.7756C564.387 72.3248 565.849 73.2173 567.167 74.4531C568.486 75.6752 569.536 77.2955 570.319 79.3139C571.101 81.3324 571.493 83.8177 571.493 86.7699V88.8295H547.106V84.6278H566.55C566.55 82.8428 566.193 81.25 565.479 79.8494C564.778 78.4489 563.776 77.3435 562.471 76.5334C561.181 75.7232 559.657 75.3182 557.899 75.3182C555.963 75.3182 554.288 75.7988 552.873 76.7599C551.473 77.7074 550.395 78.9432 549.64 80.4673C548.885 81.9915 548.507 83.6255 548.507 85.3693V88.1705C548.507 90.5597 548.919 92.585 549.743 94.2464C550.58 95.8942 551.741 97.1506 553.224 98.0156C554.707 98.867 556.43 99.2926 558.393 99.2926C559.67 99.2926 560.824 99.1141 561.854 98.7571C562.897 98.3864 563.796 97.8371 564.552 97.1094C565.307 96.3679 565.89 95.4479 566.302 94.3494L570.998 95.6676C570.504 97.2604 569.673 98.661 568.506 99.8693C567.339 101.064 565.897 101.998 564.181 102.67C562.465 103.33 560.535 103.659 558.393 103.659ZM578.887 103V71.3636H583.583V76.142H583.912C584.489 74.5767 585.533 73.3066 587.043 72.3317C588.554 71.3568 590.256 70.8693 592.151 70.8693C592.508 70.8693 592.954 70.8762 593.49 70.8899C594.025 70.9036 594.43 70.9242 594.705 70.9517V75.8949C594.54 75.8537 594.163 75.7919 593.572 75.7095C592.996 75.6134 592.385 75.5653 591.739 75.5653C590.201 75.5653 588.828 75.888 587.62 76.5334C586.425 77.165 585.478 78.0438 584.778 79.1697C584.091 80.282 583.748 81.5521 583.748 82.9801V103H578.887ZM609.777 103.741C607.772 103.741 605.953 103.364 604.319 102.609C602.685 101.84 601.387 100.734 600.426 99.2926C599.465 97.8371 598.984 96.0795 598.984 94.0199C598.984 92.2074 599.341 90.7382 600.055 89.6122C600.769 88.4725 601.723 87.58 602.918 86.9347C604.113 86.2893 605.431 85.8087 606.873 85.4929C608.328 85.1634 609.79 84.9025 611.26 84.7102C613.182 84.4631 614.74 84.2777 615.935 84.1541C617.143 84.0168 618.022 83.7902 618.571 83.4744C619.134 83.1586 619.416 82.6094 619.416 81.8267V81.6619C619.416 79.6297 618.86 78.0507 617.748 76.9247C616.649 75.7988 614.981 75.2358 612.743 75.2358C610.422 75.2358 608.603 75.7438 607.284 76.7599C605.966 77.776 605.039 78.8608 604.504 80.0142L599.89 78.3665C600.714 76.4441 601.813 74.9474 603.186 73.8764C604.573 72.7917 606.083 72.0365 607.717 71.6108C609.365 71.1714 610.985 70.9517 612.578 70.9517C613.594 70.9517 614.761 71.0753 616.079 71.3224C617.411 71.5559 618.695 72.0433 619.931 72.7848C621.18 73.5263 622.217 74.6454 623.041 76.142C623.865 77.6387 624.277 79.6435 624.277 82.1562V103H619.416V98.7159H619.169C618.839 99.4025 618.29 100.137 617.521 100.92C616.752 101.702 615.729 102.368 614.452 102.918C613.175 103.467 611.617 103.741 609.777 103.741ZM610.518 99.375C612.44 99.375 614.061 98.9974 615.379 98.2422C616.711 97.487 617.713 96.5121 618.386 95.3175C619.073 94.1229 619.416 92.8665 619.416 91.5483V87.0994C619.21 87.3466 618.757 87.5732 618.056 87.7791C617.37 87.9714 616.574 88.143 615.667 88.294C614.775 88.4313 613.903 88.5549 613.051 88.6648C612.214 88.7609 611.534 88.8433 611.012 88.9119C609.749 89.0767 608.568 89.3445 607.47 89.7152C606.385 90.0722 605.506 90.6146 604.833 91.3423C604.174 92.0563 603.845 93.0312 603.845 94.267C603.845 95.956 604.47 97.233 605.719 98.098C606.982 98.9493 608.582 99.375 610.518 99.375ZM638.009 60.8182V103H633.149V60.8182H638.009ZM663.884 103V60.8182H678.631C681.569 60.8182 683.993 61.3262 685.902 62.3423C687.81 63.3447 689.231 64.6972 690.165 66.3999C691.099 68.0888 691.566 69.9631 691.566 72.0227C691.566 73.8352 691.243 75.3319 690.598 76.5128C689.966 77.6937 689.128 78.6274 688.085 79.3139C687.055 80.0005 685.936 80.5085 684.728 80.8381V81.25C686.018 81.3324 687.316 81.7855 688.62 82.6094C689.925 83.4332 691.016 84.6141 691.895 86.152C692.774 87.6899 693.213 89.571 693.213 91.7955C693.213 93.91 692.733 95.8118 691.772 97.5007C690.81 99.1896 689.293 100.528 687.22 101.517C685.146 102.506 682.448 103 679.125 103H663.884ZM668.992 98.4688H679.125C682.462 98.4688 684.831 97.8234 686.231 96.5327C687.645 95.2282 688.353 93.6491 688.353 91.7955C688.353 90.3674 687.989 89.0492 687.261 87.8409C686.533 86.6188 685.497 85.6439 684.151 84.9162C682.805 84.1747 681.212 83.804 679.373 83.804H668.992V98.4688ZM668.992 79.3551H678.466C680.004 79.3551 681.391 79.053 682.627 78.4489C683.876 77.8447 684.865 76.9934 685.593 75.8949C686.334 74.7964 686.705 73.5057 686.705 72.0227C686.705 70.169 686.06 68.5968 684.769 67.3061C683.478 66.0017 681.432 65.3494 678.631 65.3494H668.992V79.3551ZM700.947 103V71.3636H705.808V103H700.947ZM703.419 66.0909C702.472 66.0909 701.655 65.7682 700.968 65.1229C700.295 64.4775 699.959 63.7017 699.959 62.7955C699.959 61.8892 700.295 61.1134 700.968 60.468C701.655 59.8227 702.472 59.5 703.419 59.5C704.366 59.5 705.177 59.8227 705.849 60.468C706.536 61.1134 706.879 61.8892 706.879 62.7955C706.879 63.7017 706.536 64.4775 705.849 65.1229C705.177 65.7682 704.366 66.0909 703.419 66.0909ZM719.242 91.4659L719.16 85.4517H720.149L733.99 71.3636H740.004L725.257 86.2756H724.845L719.242 91.4659ZM714.711 103V60.8182H719.572V103H714.711ZM734.813 103L722.455 87.3466L725.916 83.9688L740.992 103H734.813ZM758.221 103.659C755.173 103.659 752.544 102.986 750.333 101.641C748.136 100.281 746.44 98.3864 745.246 95.956C744.065 93.5118 743.474 90.6695 743.474 87.429C743.474 84.1884 744.065 81.3324 745.246 78.8608C746.44 76.3755 748.102 74.4394 750.23 73.0526C752.372 71.652 754.871 70.9517 757.727 70.9517C759.375 70.9517 761.002 71.2263 762.608 71.7756C764.215 72.3248 765.677 73.2173 766.996 74.4531C768.314 75.6752 769.364 77.2955 770.147 79.3139C770.93 81.3324 771.321 83.8177 771.321 86.7699V88.8295H746.934V84.6278H766.378C766.378 82.8428 766.021 81.25 765.307 79.8494C764.606 78.4489 763.604 77.3435 762.3 76.5334C761.009 75.7232 759.485 75.3182 757.727 75.3182C755.791 75.3182 754.116 75.7988 752.702 76.7599C751.301 77.7074 750.223 78.9432 749.468 80.4673C748.713 81.9915 748.335 83.6255 748.335 85.3693V88.1705C748.335 90.5597 748.747 92.585 749.571 94.2464C750.408 95.8942 751.569 97.1506 753.052 98.0156C754.535 98.867 756.258 99.2926 758.221 99.2926C759.498 99.2926 760.652 99.1141 761.682 98.7571C762.725 98.3864 763.625 97.8371 764.38 97.1094C765.135 96.3679 765.719 95.4479 766.131 94.3494L770.827 95.6676C770.332 97.2604 769.501 98.661 768.334 99.8693C767.167 101.064 765.725 101.998 764.009 102.67C762.293 103.33 760.363 103.659 758.221 103.659ZM801.124 78.4489L796.758 79.6847C796.483 78.9569 796.078 78.2498 795.542 77.5632C795.021 76.8629 794.307 76.2862 793.4 75.8331C792.494 75.38 791.334 75.1534 789.92 75.1534C787.983 75.1534 786.37 75.5997 785.079 76.4922C783.802 77.371 783.164 78.4901 783.164 79.8494C783.164 81.0578 783.603 82.0121 784.482 82.7124C785.361 83.4126 786.734 83.9962 788.601 84.4631L793.297 85.6165C796.126 86.303 798.234 87.3535 799.621 88.7678C801.007 90.1683 801.701 91.974 801.701 94.1847C801.701 95.9972 801.179 97.6174 800.135 99.0455C799.106 100.473 797.664 101.599 795.81 102.423C793.957 103.247 791.801 103.659 789.343 103.659C786.116 103.659 783.445 102.959 781.331 101.558C779.216 100.158 777.877 98.1117 777.314 95.4205L781.928 94.267C782.367 95.9697 783.198 97.2467 784.42 98.098C785.656 98.9493 787.269 99.375 789.26 99.375C791.526 99.375 793.325 98.8944 794.657 97.9332C796.002 96.9583 796.675 95.7912 796.675 94.4318C796.675 93.3333 796.291 92.4134 795.522 91.6719C794.753 90.9167 793.572 90.3537 791.979 89.983L786.707 88.7472C783.809 88.0606 781.681 86.9964 780.322 85.5547C778.976 84.0992 778.303 82.2798 778.303 80.0966C778.303 78.3116 778.804 76.7325 779.807 75.3594C780.823 73.9863 782.203 72.9084 783.947 72.1257C785.704 71.343 787.695 70.9517 789.92 70.9517C793.05 70.9517 795.508 71.6383 797.293 73.0114C799.092 74.3845 800.369 76.197 801.124 78.4489ZM813.879 83.9688V103H809.018V60.8182H813.879V76.3068H814.29C815.032 74.6728 816.144 73.3752 817.627 72.4141C819.124 71.4392 821.115 70.9517 823.6 70.9517C825.756 70.9517 827.644 71.3842 829.264 72.2493C830.884 73.1006 832.141 74.4119 833.033 76.1832C833.94 77.9408 834.393 80.179 834.393 82.8977V103H829.532V83.2273C829.532 80.7145 828.88 78.7715 827.575 77.3984C826.285 76.0116 824.493 75.3182 822.2 75.3182C820.607 75.3182 819.179 75.6546 817.915 76.3274C816.666 77.0002 815.677 77.982 814.95 79.2727C814.236 80.5634 813.879 82.1288 813.879 83.9688ZM852.595 103.741C850.59 103.741 848.771 103.364 847.137 102.609C845.503 101.84 844.205 100.734 843.244 99.2926C842.283 97.8371 841.802 96.0795 841.802 94.0199C841.802 92.2074 842.159 90.7382 842.873 89.6122C843.587 88.4725 844.542 87.58 845.736 86.9347C846.931 86.2893 848.249 85.8087 849.691 85.4929C851.146 85.1634 852.609 84.9025 854.078 84.7102C856 84.4631 857.559 84.2777 858.753 84.1541C859.962 84.0168 860.84 83.7902 861.39 83.4744C861.953 83.1586 862.234 82.6094 862.234 81.8267V81.6619C862.234 79.6297 861.678 78.0507 860.566 76.9247C859.467 75.7988 857.799 75.2358 855.561 75.2358C853.24 75.2358 851.421 75.7438 850.103 76.7599C848.785 77.776 847.858 78.8608 847.322 80.0142L842.709 78.3665C843.532 76.4441 844.631 74.9474 846.004 73.8764C847.391 72.7917 848.901 72.0365 850.535 71.6108C852.183 71.1714 853.803 70.9517 855.396 70.9517C856.412 70.9517 857.579 71.0753 858.898 71.3224C860.229 71.5559 861.513 72.0433 862.749 72.7848C863.999 73.5263 865.035 74.6454 865.859 76.142C866.683 77.6387 867.095 79.6435 867.095 82.1562V103H862.234V98.7159H861.987C861.657 99.4025 861.108 100.137 860.339 100.92C859.57 101.702 858.547 102.368 857.27 102.918C855.993 103.467 854.435 103.741 852.595 103.741ZM853.336 99.375C855.259 99.375 856.879 98.9974 858.197 98.2422C859.529 97.487 860.532 96.5121 861.204 95.3175C861.891 94.1229 862.234 92.8665 862.234 91.5483V87.0994C862.028 87.3466 861.575 87.5732 860.875 87.7791C860.188 87.9714 859.392 88.143 858.486 88.294C857.593 88.4313 856.721 88.5549 855.87 88.6648C855.032 88.7609 854.353 88.8433 853.831 88.9119C852.568 89.0767 851.387 89.3445 850.288 89.7152C849.203 90.0722 848.325 90.6146 847.652 91.3423C846.993 92.0563 846.663 93.0312 846.663 94.267C846.663 95.956 847.288 97.233 848.537 98.098C849.801 98.9493 851.4 99.375 853.336 99.375ZM875.967 103V71.3636H880.663V76.142H880.993C881.569 74.5767 882.613 73.3066 884.123 72.3317C885.634 71.3568 887.336 70.8693 889.231 70.8693C889.588 70.8693 890.034 70.8762 890.57 70.8899C891.105 70.9036 891.511 70.9242 891.785 70.9517V75.8949C891.62 75.8537 891.243 75.7919 890.652 75.7095C890.076 75.6134 889.465 75.5653 888.819 75.5653C887.281 75.5653 885.908 75.888 884.7 76.5334C883.505 77.165 882.558 78.0438 881.858 79.1697C881.171 80.282 880.828 81.5521 880.828 82.9801V103H875.967ZM909.848 103.659C906.8 103.659 904.171 102.986 901.96 101.641C899.763 100.281 898.067 98.3864 896.873 95.956C895.692 93.5118 895.101 90.6695 895.101 87.429C895.101 84.1884 895.692 81.3324 896.873 78.8608C898.067 76.3755 899.729 74.4394 901.857 73.0526C903.999 71.652 906.498 70.9517 909.354 70.9517C911.002 70.9517 912.629 71.2263 914.235 71.7756C915.842 72.3248 917.304 73.2173 918.623 74.4531C919.941 75.6752 920.991 77.2955 921.774 79.3139C922.556 81.3324 922.948 83.8177 922.948 86.7699V88.8295H898.561V84.6278H918.005C918.005 82.8428 917.648 81.25 916.934 79.8494C916.233 78.4489 915.231 77.3435 913.926 76.5334C912.636 75.7232 911.112 75.3182 909.354 75.3182C907.418 75.3182 905.743 75.7988 904.328 76.7599C902.928 77.7074 901.85 78.9432 901.095 80.4673C900.34 81.9915 899.962 83.6255 899.962 85.3693V88.1705C899.962 90.5597 900.374 92.585 901.198 94.2464C902.035 95.8942 903.196 97.1506 904.679 98.0156C906.162 98.867 907.885 99.2926 909.848 99.2926C911.125 99.2926 912.279 99.1141 913.309 98.7571C914.352 98.3864 915.252 97.8371 916.007 97.1094C916.762 96.3679 917.346 95.4479 917.757 94.3494L922.453 95.6676C921.959 97.2604 921.128 98.661 919.961 99.8693C918.794 101.064 917.352 101.998 915.636 102.67C913.92 103.33 911.99 103.659 909.848 103.659ZM947.314 103V60.8182H972.606V65.3494H952.422V79.6023H970.711V84.1335H952.422V103H947.314ZM991.637 103.659C988.589 103.659 985.96 102.986 983.749 101.641C981.552 100.281 979.856 98.3864 978.662 95.956C977.481 93.5118 976.89 90.6695 976.89 87.429C976.89 84.1884 977.481 81.3324 978.662 78.8608C979.856 76.3755 981.518 74.4394 983.646 73.0526C985.788 71.652 988.287 70.9517 991.143 70.9517C992.791 70.9517 994.418 71.2263 996.025 71.7756C997.631 72.3248 999.093 73.2173 1000.41 74.4531C1001.73 75.6752 1002.78 77.2955 1003.56 79.3139C1004.35 81.3324 1004.74 83.8177 1004.74 86.7699V88.8295H980.35V84.6278H999.794C999.794 82.8428 999.437 81.25 998.723 79.8494C998.022 78.4489 997.02 77.3435 995.716 76.5334C994.425 75.7232 992.901 75.3182 991.143 75.3182C989.207 75.3182 987.532 75.7988 986.118 76.7599C984.717 77.7074 983.639 78.9432 982.884 80.4673C982.129 81.9915 981.751 83.6255 981.751 85.3693V88.1705C981.751 90.5597 982.163 92.585 982.987 94.2464C983.824 95.8942 984.985 97.1506 986.468 98.0156C987.951 98.867 989.674 99.2926 991.637 99.2926C992.914 99.2926 994.068 99.1141 995.098 98.7571C996.141 98.3864 997.041 97.8371 997.796 97.1094C998.551 96.3679 999.135 95.4479 999.547 94.3494L1004.24 95.6676C1003.75 97.2604 1002.92 98.661 1001.75 99.8693C1000.58 101.064 999.141 101.998 997.425 102.67C995.709 103.33 993.779 103.659 991.637 103.659ZM1025.4 103.659C1022.35 103.659 1019.72 102.986 1017.51 101.641C1015.31 100.281 1013.61 98.3864 1012.42 95.956C1011.24 93.5118 1010.65 90.6695 1010.65 87.429C1010.65 84.1884 1011.24 81.3324 1012.42 78.8608C1013.61 76.3755 1015.28 74.4394 1017.4 73.0526C1019.55 71.652 1022.04 70.9517 1024.9 70.9517C1026.55 70.9517 1028.18 71.2263 1029.78 71.7756C1031.39 72.3248 1032.85 73.2173 1034.17 74.4531C1035.49 75.6752 1036.54 77.2955 1037.32 79.3139C1038.1 81.3324 1038.49 83.8177 1038.49 86.7699V88.8295H1014.11V84.6278H1033.55C1033.55 82.8428 1033.19 81.25 1032.48 79.8494C1031.78 78.4489 1030.78 77.3435 1029.47 76.5334C1028.18 75.7232 1026.66 75.3182 1024.9 75.3182C1022.96 75.3182 1021.29 75.7988 1019.88 76.7599C1018.47 77.7074 1017.4 78.9432 1016.64 80.4673C1015.89 81.9915 1015.51 83.6255 1015.51 85.3693V88.1705C1015.51 90.5597 1015.92 92.585 1016.74 94.2464C1017.58 95.8942 1018.74 97.1506 1020.23 98.0156C1021.71 98.867 1023.43 99.2926 1025.4 99.2926C1026.67 99.2926 1027.83 99.1141 1028.86 98.7571C1029.9 98.3864 1030.8 97.8371 1031.55 97.1094C1032.31 96.3679 1032.89 95.4479 1033.3 94.3494L1038 95.6676C1037.51 97.2604 1036.68 98.661 1035.51 99.8693C1034.34 101.064 1032.9 101.998 1031.18 102.67C1029.47 103.33 1027.54 103.659 1025.4 103.659ZM1057.83 103.659C1055.2 103.659 1052.87 102.993 1050.85 101.661C1048.83 100.316 1047.26 98.4207 1046.12 95.9766C1044.98 93.5187 1044.41 90.6146 1044.41 87.2642C1044.41 83.9413 1044.98 81.0578 1046.12 78.6136C1047.26 76.1695 1048.84 74.2815 1050.87 72.9496C1052.91 71.6177 1055.25 70.9517 1057.92 70.9517C1059.98 70.9517 1061.6 71.295 1062.8 71.9815C1064.01 72.6544 1064.93 73.4233 1065.56 74.2884C1066.2 75.1397 1066.71 75.84 1067.06 76.3892H1067.47V60.8182H1072.33V103H1067.64V98.1392H1067.06C1066.71 98.7159 1066.2 99.4437 1065.54 100.322C1064.88 101.187 1063.94 101.963 1062.72 102.65C1061.49 103.323 1059.87 103.659 1057.83 103.659ZM1058.49 99.2926C1060.44 99.2926 1062.09 98.7846 1063.44 97.7685C1064.78 96.7386 1065.81 95.3175 1066.51 93.505C1067.21 91.6787 1067.56 89.571 1067.56 87.1818C1067.56 84.8201 1067.21 82.7535 1066.53 80.9822C1065.84 79.1972 1064.82 77.8104 1063.48 76.8217C1062.13 75.8194 1060.47 75.3182 1058.49 75.3182C1056.43 75.3182 1054.72 75.8468 1053.34 76.9041C1051.99 77.9477 1050.96 79.3688 1050.28 81.1676C1049.6 82.9527 1049.27 84.9574 1049.27 87.1818C1049.27 89.4337 1049.61 91.4796 1050.3 93.3196C1051 95.1458 1052.03 96.6013 1053.39 97.6861C1054.76 98.7571 1056.46 99.2926 1058.49 99.2926ZM1121.95 71.3636C1121.7 69.2765 1120.7 67.6562 1118.94 66.5028C1117.19 65.3494 1115.03 64.7727 1112.48 64.7727C1110.61 64.7727 1108.98 65.0748 1107.58 65.679C1106.19 66.2831 1105.1 67.1139 1104.32 68.1712C1103.55 69.2285 1103.17 70.4299 1103.17 71.7756C1103.17 72.9015 1103.44 73.8696 1103.97 74.6797C1104.52 75.4761 1105.22 76.142 1106.07 76.6776C1106.92 77.1993 1107.82 77.6319 1108.75 77.9751C1109.68 78.3047 1110.54 78.5724 1111.32 78.7784L1115.61 79.9318C1116.71 80.2202 1117.93 80.6184 1119.27 81.1264C1120.63 81.6345 1121.93 82.3279 1123.17 83.2067C1124.42 84.0717 1125.45 85.1839 1126.26 86.5433C1127.07 87.9027 1127.47 89.571 1127.47 91.5483C1127.47 93.8277 1126.87 95.8873 1125.68 97.7273C1124.5 99.5672 1122.77 101.03 1120.49 102.114C1118.22 103.199 1115.47 103.741 1112.23 103.741C1109.21 103.741 1106.59 103.254 1104.38 102.279C1102.19 101.304 1100.46 99.9448 1099.19 98.201C1097.94 96.4571 1097.24 94.4318 1097.07 92.125H1102.34C1102.48 93.7178 1103.02 95.036 1103.95 96.0795C1104.9 97.1094 1106.09 97.8783 1107.53 98.3864C1108.99 98.8807 1110.56 99.1278 1112.23 99.1278C1114.18 99.1278 1115.93 98.812 1117.48 98.1804C1119.03 97.535 1120.26 96.6425 1121.17 95.5028C1122.08 94.3494 1122.53 93.0038 1122.53 91.4659C1122.53 90.0653 1122.14 88.9257 1121.35 88.0469C1120.57 87.1681 1119.54 86.4541 1118.27 85.9048C1116.99 85.3556 1115.61 84.875 1114.13 84.4631L1108.94 82.9801C1105.64 82.0327 1103.03 80.6802 1101.11 78.9226C1099.19 77.165 1098.22 74.8651 1098.22 72.0227C1098.22 69.661 1098.86 67.6013 1100.14 65.8438C1101.43 64.0724 1103.16 62.6993 1105.33 61.7244C1107.51 60.7358 1109.95 60.2415 1112.64 60.2415C1115.36 60.2415 1117.78 60.7289 1119.89 61.7038C1122.01 62.665 1123.68 63.9832 1124.92 65.6584C1126.17 67.3336 1126.83 69.2353 1126.9 71.3636H1121.95ZM1135.21 114.864V71.3636H1139.91V76.3892H1140.48C1140.84 75.84 1141.34 75.1397 1141.97 74.2884C1142.61 73.4233 1143.53 72.6544 1144.73 71.9815C1145.94 71.295 1147.57 70.9517 1149.63 70.9517C1152.29 70.9517 1154.64 71.6177 1156.67 72.9496C1158.7 74.2815 1160.29 76.1695 1161.43 78.6136C1162.57 81.0578 1163.14 83.9413 1163.14 87.2642C1163.14 90.6146 1162.57 93.5187 1161.43 95.9766C1160.29 98.4207 1158.71 100.316 1156.69 101.661C1154.67 102.993 1152.35 103.659 1149.71 103.659C1147.68 103.659 1146.05 103.323 1144.83 102.65C1143.61 101.963 1142.67 101.187 1142.01 100.322C1141.35 99.4437 1140.84 98.7159 1140.48 98.1392H1140.07V114.864H1135.21ZM1139.99 87.1818C1139.99 89.571 1140.34 91.6787 1141.04 93.505C1141.74 95.3175 1142.76 96.7386 1144.11 97.7685C1145.45 98.7846 1147.1 99.2926 1149.05 99.2926C1151.08 99.2926 1152.78 98.7571 1154.14 97.6861C1155.51 96.6013 1156.54 95.1458 1157.23 93.3196C1157.93 91.4796 1158.28 89.4337 1158.28 87.1818C1158.28 84.9574 1157.94 82.9527 1157.25 81.1676C1156.58 79.3688 1155.55 77.9477 1154.18 76.9041C1152.82 75.8468 1151.11 75.3182 1149.05 75.3182C1147.07 75.3182 1145.41 75.8194 1144.07 76.8217C1142.72 77.8104 1141.71 79.1972 1141.02 80.9822C1140.33 82.7535 1139.99 84.8201 1139.99 87.1818ZM1183.82 103.659C1180.77 103.659 1178.14 102.986 1175.93 101.641C1173.73 100.281 1172.04 98.3864 1170.84 95.956C1169.66 93.5118 1169.07 90.6695 1169.07 87.429C1169.07 84.1884 1169.66 81.3324 1170.84 78.8608C1172.04 76.3755 1173.7 74.4394 1175.83 73.0526C1177.97 71.652 1180.47 70.9517 1183.32 70.9517C1184.97 70.9517 1186.6 71.2263 1188.21 71.7756C1189.81 72.3248 1191.28 73.2173 1192.59 74.4531C1193.91 75.6752 1194.96 77.2955 1195.74 79.3139C1196.53 81.3324 1196.92 83.8177 1196.92 86.7699V88.8295H1172.53V84.6278H1191.98C1191.98 82.8428 1191.62 81.25 1190.9 79.8494C1190.2 78.4489 1189.2 77.3435 1187.9 76.5334C1186.61 75.7232 1185.08 75.3182 1183.32 75.3182C1181.39 75.3182 1179.71 75.7988 1178.3 76.7599C1176.9 77.7074 1175.82 78.9432 1175.07 80.4673C1174.31 81.9915 1173.93 83.6255 1173.93 85.3693V88.1705C1173.93 90.5597 1174.34 92.585 1175.17 94.2464C1176.01 95.8942 1177.17 97.1506 1178.65 98.0156C1180.13 98.867 1181.86 99.2926 1183.82 99.2926C1185.1 99.2926 1186.25 99.1141 1187.28 98.7571C1188.32 98.3864 1189.22 97.8371 1189.98 97.1094C1190.73 96.3679 1191.32 95.4479 1191.73 94.3494L1196.42 95.6676C1195.93 97.2604 1195.1 98.661 1193.93 99.8693C1192.76 101.064 1191.32 101.998 1189.61 102.67C1187.89 103.33 1185.96 103.659 1183.82 103.659ZM1217.16 103.659C1214.2 103.659 1211.65 102.959 1209.5 101.558C1207.36 100.158 1205.71 98.2285 1204.56 95.7706C1203.41 93.3127 1202.83 90.5047 1202.83 87.3466C1202.83 84.1335 1203.42 81.2981 1204.6 78.8402C1205.8 76.3686 1207.46 74.4394 1209.59 73.0526C1211.73 71.652 1214.23 70.9517 1217.08 70.9517C1219.31 70.9517 1221.31 71.3636 1223.1 72.1875C1224.88 73.0114 1226.34 74.1648 1227.48 75.6477C1228.62 77.1307 1229.33 78.8608 1229.61 80.8381H1224.74C1224.37 79.3963 1223.55 78.1193 1222.27 77.0071C1221.01 75.8812 1219.31 75.3182 1217.16 75.3182C1215.27 75.3182 1213.61 75.8125 1212.18 76.8011C1210.77 77.776 1209.66 79.156 1208.86 80.9411C1208.08 82.7124 1207.69 84.7926 1207.69 87.1818C1207.69 89.6259 1208.07 91.7543 1208.84 93.5668C1209.63 95.3793 1210.73 96.7867 1212.14 97.7891C1213.57 98.7914 1215.24 99.2926 1217.16 99.2926C1218.43 99.2926 1219.57 99.0729 1220.6 98.6335C1221.63 98.1941 1222.51 97.5625 1223.22 96.7386C1223.93 95.9148 1224.44 94.9261 1224.74 93.7727H1229.61C1229.33 95.6402 1228.65 97.3222 1227.57 98.8189C1226.5 100.302 1225.07 101.483 1223.3 102.362C1221.55 103.227 1219.5 103.659 1217.16 103.659ZM1236.71 103V71.3636H1241.57V103H1236.71ZM1239.18 66.0909C1238.24 66.0909 1237.42 65.7682 1236.73 65.1229C1236.06 64.4775 1235.72 63.7017 1235.72 62.7955C1235.72 61.8892 1236.06 61.1134 1236.73 60.468C1237.42 59.8227 1238.24 59.5 1239.18 59.5C1240.13 59.5 1240.94 59.8227 1241.61 60.468C1242.3 61.1134 1242.64 61.8892 1242.64 62.7955C1242.64 63.7017 1242.3 64.4775 1241.61 65.1229C1240.94 65.7682 1240.13 66.0909 1239.18 66.0909ZM1264.56 71.3636V75.483H1247.51V71.3636H1264.56ZM1252.62 103V66.9972C1252.62 65.1847 1253.04 63.6742 1253.89 62.4659C1254.75 61.2576 1255.85 60.3513 1257.21 59.7472C1258.57 59.143 1260 58.8409 1261.51 58.8409C1262.71 58.8409 1263.68 58.937 1264.44 59.1293C1265.19 59.3215 1265.76 59.5 1266.13 59.6648L1264.73 63.8665C1264.48 63.7841 1264.14 63.6811 1263.7 63.5575C1263.27 63.4339 1262.71 63.3722 1262.01 63.3722C1260.4 63.3722 1259.24 63.7772 1258.53 64.5874C1257.83 65.3975 1257.48 66.5852 1257.48 68.1506V103H1252.62ZM1271.38 103V71.3636H1276.24V103H1271.38ZM1273.85 66.0909C1272.9 66.0909 1272.08 65.7682 1271.4 65.1229C1270.72 64.4775 1270.39 63.7017 1270.39 62.7955C1270.39 61.8892 1270.72 61.1134 1271.4 60.468C1272.08 59.8227 1272.9 59.5 1273.85 59.5C1274.79 59.5 1275.6 59.8227 1276.28 60.468C1276.96 61.1134 1277.31 61.8892 1277.31 62.7955C1277.31 63.7017 1276.96 64.4775 1276.28 65.1229C1275.6 65.7682 1274.79 66.0909 1273.85 66.0909ZM1297.99 103.659C1295.03 103.659 1292.47 102.959 1290.33 101.558C1288.19 100.158 1286.54 98.2285 1285.39 95.7706C1284.23 93.3127 1283.66 90.5047 1283.66 87.3466C1283.66 84.1335 1284.25 81.2981 1285.43 78.8402C1286.62 76.3686 1288.28 74.4394 1290.41 73.0526C1292.55 71.652 1295.05 70.9517 1297.91 70.9517C1300.13 70.9517 1302.14 71.3636 1303.92 72.1875C1305.71 73.0114 1307.17 74.1648 1308.31 75.6477C1309.45 77.1307 1310.16 78.8608 1310.43 80.8381H1305.57C1305.2 79.3963 1304.38 78.1193 1303.1 77.0071C1301.84 75.8812 1300.13 75.3182 1297.99 75.3182C1296.1 75.3182 1294.43 75.8125 1293.01 76.8011C1291.59 77.776 1290.49 79.156 1289.69 80.9411C1288.91 82.7124 1288.52 84.7926 1288.52 87.1818C1288.52 89.6259 1288.9 91.7543 1289.67 93.5668C1290.45 95.3793 1291.55 96.7867 1292.97 97.7891C1294.39 98.7914 1296.07 99.2926 1297.99 99.2926C1299.25 99.2926 1300.4 99.0729 1301.43 98.6335C1302.46 98.1941 1303.33 97.5625 1304.05 96.7386C1304.76 95.9148 1305.27 94.9261 1305.57 93.7727H1310.43C1310.16 95.6402 1309.48 97.3222 1308.39 98.8189C1307.32 100.302 1305.9 101.483 1304.13 102.362C1302.37 103.227 1300.33 103.659 1297.99 103.659ZM1326.85 103.741C1324.84 103.741 1323.02 103.364 1321.39 102.609C1319.75 101.84 1318.46 100.734 1317.5 99.2926C1316.53 97.8371 1316.05 96.0795 1316.05 94.0199C1316.05 92.2074 1316.41 90.7382 1317.13 89.6122C1317.84 88.4725 1318.79 87.58 1319.99 86.9347C1321.18 86.2893 1322.5 85.8087 1323.94 85.4929C1325.4 85.1634 1326.86 84.9025 1328.33 84.7102C1330.25 84.4631 1331.81 84.2777 1333.01 84.1541C1334.21 84.0168 1335.09 83.7902 1335.64 83.4744C1336.2 83.1586 1336.49 82.6094 1336.49 81.8267V81.6619C1336.49 79.6297 1335.93 78.0507 1334.82 76.9247C1333.72 75.7988 1332.05 75.2358 1329.81 75.2358C1327.49 75.2358 1325.67 75.7438 1324.35 76.7599C1323.04 77.776 1322.11 78.8608 1321.57 80.0142L1316.96 78.3665C1317.78 76.4441 1318.88 74.9474 1320.26 73.8764C1321.64 72.7917 1323.15 72.0365 1324.79 71.6108C1326.44 71.1714 1328.06 70.9517 1329.65 70.9517C1330.66 70.9517 1331.83 71.0753 1333.15 71.3224C1334.48 71.5559 1335.77 72.0433 1337 72.7848C1338.25 73.5263 1339.29 74.6454 1340.11 76.142C1340.94 77.6387 1341.35 79.6435 1341.35 82.1562V103H1336.49V98.7159H1336.24C1335.91 99.4025 1335.36 100.137 1334.59 100.92C1333.82 101.702 1332.8 102.368 1331.52 102.918C1330.25 103.467 1328.69 103.741 1326.85 103.741ZM1327.59 99.375C1329.51 99.375 1331.13 98.9974 1332.45 98.2422C1333.78 97.487 1334.78 96.5121 1335.46 95.3175C1336.14 94.1229 1336.49 92.8665 1336.49 91.5483V87.0994C1336.28 87.3466 1335.83 87.5732 1335.13 87.7791C1334.44 87.9714 1333.64 88.143 1332.74 88.294C1331.85 88.4313 1330.97 88.5549 1330.12 88.6648C1329.28 88.7609 1328.6 88.8433 1328.08 88.9119C1326.82 89.0767 1325.64 89.3445 1324.54 89.7152C1323.46 90.0722 1322.58 90.6146 1321.9 91.3423C1321.24 92.0563 1320.92 93.0312 1320.92 94.267C1320.92 95.956 1321.54 97.233 1322.79 98.098C1324.05 98.9493 1325.65 99.375 1327.59 99.375ZM1363.98 71.3636V75.483H1347.58V71.3636H1363.98ZM1352.36 63.7841H1357.22V93.9375C1357.22 95.3106 1357.42 96.3404 1357.82 97.027C1358.23 97.6998 1358.75 98.1529 1359.38 98.3864C1360.03 98.6061 1360.71 98.7159 1361.42 98.7159C1361.96 98.7159 1362.4 98.6884 1362.74 98.6335C1363.08 98.5649 1363.36 98.5099 1363.57 98.4688L1364.55 102.835C1364.22 102.959 1363.76 103.082 1363.17 103.206C1362.58 103.343 1361.84 103.412 1360.93 103.412C1359.56 103.412 1358.21 103.117 1356.89 102.526C1355.59 101.936 1354.5 101.036 1353.64 99.8281C1352.79 98.6198 1352.36 97.0956 1352.36 95.2557V63.7841ZM1371.29 103V71.3636H1376.15V103H1371.29ZM1373.76 66.0909C1372.81 66.0909 1372 65.7682 1371.31 65.1229C1370.64 64.4775 1370.3 63.7017 1370.3 62.7955C1370.3 61.8892 1370.64 61.1134 1371.31 60.468C1372 59.8227 1372.81 59.5 1373.76 59.5C1374.71 59.5 1375.52 59.8227 1376.19 60.468C1376.88 61.1134 1377.22 61.8892 1377.22 62.7955C1377.22 63.7017 1376.88 64.4775 1376.19 65.1229C1375.52 65.7682 1374.71 66.0909 1373.76 66.0909ZM1397.91 103.659C1395.05 103.659 1392.54 102.979 1390.39 101.62C1388.25 100.261 1386.57 98.3589 1385.36 95.9148C1384.17 93.4706 1383.57 90.6146 1383.57 87.3466C1383.57 84.0511 1384.17 81.1745 1385.36 78.7166C1386.57 76.2588 1388.25 74.3501 1390.39 72.9908C1392.54 71.6314 1395.05 70.9517 1397.91 70.9517C1400.76 70.9517 1403.26 71.6314 1405.4 72.9908C1407.56 74.3501 1409.23 76.2588 1410.43 78.7166C1411.64 81.1745 1412.24 84.0511 1412.24 87.3466C1412.24 90.6146 1411.64 93.4706 1410.43 95.9148C1409.23 98.3589 1407.56 100.261 1405.4 101.62C1403.26 102.979 1400.76 103.659 1397.91 103.659ZM1397.91 99.2926C1400.07 99.2926 1401.86 98.7365 1403.26 97.6243C1404.66 96.5121 1405.7 95.0497 1406.37 93.2372C1407.04 91.4247 1407.38 89.4612 1407.38 87.3466C1407.38 85.232 1407.04 83.2616 1406.37 81.4354C1405.7 79.6091 1404.66 78.133 1403.26 77.0071C1401.86 75.8812 1400.07 75.3182 1397.91 75.3182C1395.74 75.3182 1393.95 75.8812 1392.55 77.0071C1391.15 78.133 1390.11 79.6091 1389.44 81.4354C1388.77 83.2616 1388.43 85.232 1388.43 87.3466C1388.43 89.4612 1388.77 91.4247 1389.44 93.2372C1390.11 95.0497 1391.15 96.5121 1392.55 97.6243C1393.95 98.7365 1395.74 99.2926 1397.91 99.2926ZM1424.52 83.9688V103H1419.66V71.3636H1424.36V76.3068H1424.77C1425.51 74.7003 1426.64 73.4096 1428.15 72.4347C1429.66 71.446 1431.61 70.9517 1434 70.9517C1436.14 70.9517 1438.01 71.3911 1439.62 72.2699C1441.22 73.1349 1442.47 74.4531 1443.37 76.2244C1444.26 77.982 1444.71 80.2064 1444.71 82.8977V103H1439.84V83.2273C1439.84 80.742 1439.2 78.8059 1437.91 77.419C1436.62 76.0185 1434.85 75.3182 1432.59 75.3182C1431.04 75.3182 1429.66 75.6546 1428.43 76.3274C1427.23 77.0002 1426.27 77.982 1425.57 79.2727C1424.87 80.5634 1424.52 82.1288 1424.52 83.9688Z" fill="white"></path></svg><p>Most of the bikeshare-related projects are tinkering with the <a href="https://s3.amazonaws.com/tripdata/index.html">trips dataset</a>, which shows start &amp; end points for a given trip. That’s fun data to visualize, but I’m really interested in different dimensions of the dataset. So, I’m using the GBFS feed, which instead shows the capacity and status of the docks where the bikes are parked.</p><p><a href="https://github.com/MobilityData/gbfs">GBFS</a> is a standard for how cities with bikeshare systems share their data. In practice, it’s a really nice specification to work with: it’s pretty well-designed, simple, easy to parse. And Citi Bike’s <a href="https://citibikenyc.com/system-data">system data implementation</a> is stellar. In the whole time I’ve been working with it, I haven’t noticed downtime or a significant bug. The API responds quickly and doesn’t require any kind of authentication. Whoever implemented it did a good job.</p><h3 id="the-worker">The Worker</h3><p>The rest of the system is still kind of in flux, but the archiving step has been working well for months.</p><p>It uses a <a href="https://workers.cloudflare.com/">Cloudflare Worker</a>, which is scheduled to run every 5 minutes. It fetches from the API, gzips the response, and saves it to <a href="https://developers.cloudflare.com/r2">Cloudflare R2</a>, which is Cloudflare’s equivalent to Amazon S3 - a storage service.</p><p>The worker itself is written in TypeScript and it fetches, compresses, and stores the data:</p><div><div><pre><code><span>export</span> <span>interface</span> <span>Env</span> <span>{</span>
  <span>DATA</span><span>:</span> <span>R2Bucket</span><span>;</span>
<span>}</span>

<span>export</span> <span>default</span> <span>{</span>
  <span>async</span> <span>scheduled</span><span>(</span>
    <span>controller</span><span>:</span> <span>ScheduledController</span><span>,</span>
    <span>env</span><span>:</span> <span>Env</span><span>,</span>
    <span>ctx</span><span>:</span> <span>ExecutionContext</span><span>,</span>
  <span>):</span> <span>Promise</span><span>&lt;</span><span>void</span><span>&gt;</span> <span>{</span>
    <span>const</span> <span>res</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span>
      <span>&#34;</span><span>https://gbfs.citibikenyc.com/gbfs/en/station_status.json</span><span>&#34;</span><span>,</span>
    <span>);</span>
    <span>if </span><span>(</span><span>!</span><span>res</span><span>.</span><span>ok</span><span>)</span> <span>{</span>
      <span>throw</span> <span>new</span> <span>Error</span><span>(</span><span>`Endpoint down, status: </span><span>${</span><span>res</span><span>.</span><span>status</span><span>}</span><span>`</span><span>);</span>
    <span>}</span>

    <span>const</span> <span>compressionStream</span> <span>=</span> <span>new</span> <span>CompressionStream</span><span>(</span><span>&#34;</span><span>gzip</span><span>&#34;</span><span>);</span>
    <span>const</span> <span>compressed</span> <span>=</span> <span>await</span> <span>new</span> <span>Response</span><span>(</span>
      <span>res</span><span>.</span><span>body</span><span>?.</span><span>pipeThrough</span><span>(</span><span>compressionStream</span><span>),</span>
    <span>).</span><span>arrayBuffer</span><span>();</span>

    <span>const</span> <span>time</span> <span>=</span> <span>new</span> <span>Date</span><span>(</span><span>controller</span><span>.</span><span>scheduledTime</span><span>);</span>
    <span>const</span> <span>key</span> <span>=</span> <span>`station_status/</span><span>${</span><span>time</span><span>.</span><span>toISOString</span><span>()}</span><span>.json.gz`</span><span>;</span>
    <span>await</span> <span>env</span><span>.</span><span>DATA</span><span>.</span><span>put</span><span>(</span><span>key</span><span>,</span> <span>compressed</span><span>);</span>
    <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;</span><span>OK: Scrape done</span><span>&#34;</span><span>);</span>
  <span>},</span>
<span>};</span>
</code></pre></div></div><p>And is scheduled using its <code>wrangler.toml</code> configuration file:</p><div><div><pre><code><span>name</span> <span>=</span> <span>&#34;station_scraper&#34;</span>
<span>main</span> <span>=</span> <span>&#34;src/index.ts&#34;</span>
<span>compatibility_date</span> <span>=</span> <span>&#34;2023-06-29&#34;</span>
 
<span>[[r2_buckets]]</span>
<span>binding</span> <span>=</span> <span>&#34;DATA&#34;</span>
<span>bucket_name</span> <span>=</span> <span>&#34;citibike-data-1&#34;</span>
<span>preview_bucket_name</span> <span>=</span> <span>&#34;citibike-data-1-test&#34;</span>
 
<span>[triggers]</span>
<span>crons</span> <span>=</span> <span>[</span> <span>&#34;*/5 * * * *&#34;</span> <span>]</span>
</code></pre></div></div><p>I have to bind the worker to the R2 bucket to give it access, and then that’s it - the worker runs on its own. Each new version of the <code>station_status</code> endpoint is named with a timestamp so that I can fetch a specific day by listing objects with a prefix.</p><h3 id="the-collector">The Collector</h3><p>The Worker produces gzipped JSON - not the best format for analysis. What <em>is</em> the best format for analysis? I think the current answer is Parquet. I wrote about Parquet a little in the context of <a href="https://macwright.com/2022/05/30/new-formats">geospatial formats</a>, and my friend <a href="https://kylebarron.dev/">Kyle</a> has been singing the praises of Parquet and Arrow, so I was excited to take a look.</p><p>I implemented a “collector” in Rust for fun, and because I didn’t want to install Python on my laptop. There’s a good <a href="https://github.com/apache/arrow-rs">canonical implementation of Parquet and Arrow, arrow-rs</a>, in Rust. To read JSON, there’s <a href="https://serde.rs/">serde</a>. To handle dates, there’s <a href="https://docs.rs/chrono/latest/chrono/">chrono</a>.</p><p>Overall, it was a good time hacking it together. As long as I avoid refactoring and splitting up functions, I can write Rust without bothering the borrow checker too much. The only thing that really got me was around the edges of Parquet: how should I structure my data - is it better to have lots of rows, or lots of columns? I could picture three different ways, at least, to model this data, and it was hard to figure out which was best. Plus, some of the knobs to <a href="https://github.com/apache/arrow-rs/issues/4804">optimize Parquet</a> were confusing to tweak.</p><p>But anyway, the collector is able to take about 2 gigabytes of gzipped JSON and turn it into a 180MB Parquet file: a good 91% savings. I suspect that I could do better with tweaking some other settings, and being smarter about structuring the data.</p><h3 id="web">Web</h3><p>This is the part I’m still not sure about. I shipped a demo a while ago on <a href="https://bikesharecharts.com/">bikesharecharts.com</a>, but I think it needs a rethink. There are a few things bugging me about the existing demo:</p><ul><li>It’s doing too much custom visualization code: it’s rendering charts in a combination of raw d3 and Svelte. It’s annoyingly manual to tweak the charts.</li><li>The charts aren’t very understandable anyway, and I don’t really think that there needs to be this small-multiples view of all the bikeshare stations as a stack. It’s cool, but it doesn’t tell a story.</li></ul><p>So, I’m tinkering with other solutions. Part of the appeal of Parquet is that I can use it with <a href="http://duckdb.org/">DuckDB</a>, a database that can run in the browser and let me query the data with SQL. DuckDB is <em>very hot right now</em> and is great, except for how much time it took me to figure out <a href="https://github.com/duckdb/duckdb-wasm/issues/393">how to get it to convert timestamps</a>.</p><p><a href="https://uwdata.github.io/mosaic/">Mosaic</a> is like <a href="https://observablehq.com/plot/">Observable Plot</a> combined with DuckDB. It’s very exciting in theory but it’s been hard to get the pieces to fit together and become familiar with the project by reading the documentation.</p><p><a href="https://observablehq.com/plot/">Observable Plot</a> is itself a viable option, and connecting it manually to DuckDB is very possible, though it’ll be more code to connect it in the efficient way that Mosaic does. But it’s very limited in terms of <a href="https://observablehq.com/plot/features/interactions">interactivity</a> and this project could really benefit from at least being able to zoom into a day range.</p><p>So, for now I’ve hooked up an <a href="https://observablehq.com/@tmcw/bikeshare-charts">Observable Notebook</a> to explore the dataset. It’s fun to be able to use Observable as just a user, after helping build the platform itself in its very very early history. It’s a good platform, and lends itself pretty well to this problem area - it’s super easy to wire together inputs, processing, and visualization steps.</p><h3 id="plans">Plans</h3><ul><li>If the Citi Bike system changes, like if Lyft pulls out of its contract, or New York takes more ownership over the program, I think this will be a great dataset to see the effect of the change.</li><li>There are a few places in the city where bicycle rebalancing seems to be failing on a regular basis. For example, docks in <a href="https://en.wikipedia.org/wiki/Red_Hook,_Brooklyn">Red Hook</a> are consistently full. I’d like to figure out how often these docks are getting rebalanced - how often Lyft or Motivate or a third party is, in fact, driving to the docks and moving the bikes. There’s an attempt at crowdsourcing that rebalancing by encouraging people to ride bikes from full docks to empty ones, called Bike Angels - does that have any effect?</li><li>Based on the demand curve of each station, it should be possible to figure out which are associated with workplaces more than homes - which absorb bikes between 9-5, and which lose them?</li><li>In the event that there’s system expansion, it’ll be interesting to see how quickly there’s adoption - outer Brooklyn expansion is likely in the short term, whereas South Williamsburg expansion might never come.</li></ul><p>In any case, I’m having fun with it, and enjoyed the excuse to produce a watercolor yesterday!</p></div></div>
  </body>
</html>
