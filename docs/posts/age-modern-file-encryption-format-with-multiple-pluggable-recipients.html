<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/C2SP/C2SP/blob/main/age.md">Original</a>
    <h1>Age: Modern file encryption format with multiple pluggable recipients</h1>
    
    <div id="readability-page-1" class="page"><div>

    <div data-target="readme-toc.content">
      
  


        <div id="readme">
    <article itemprop="text">
<p dir="auto"><a href="https://c2sp.org/age" rel="nofollow">c2sp.org/age</a>,
<a href="https://age-encryption.org/v1" rel="nofollow">age-encryption.org/v1</a></p>
<p dir="auto">age is a modern file encryption format with multiple pluggable recipients, and
seekable streaming encryption.</p>
<h2 dir="auto"><a id="user-content-conventions-used-in-this-document" aria-hidden="true" href="#conventions-used-in-this-document"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Conventions used in this document</h2>
<p dir="auto">ABNF syntax follows <a href="https://www.rfc-editor.org/rfc/rfc5234.html" rel="nofollow">RFC 5234</a> and <a href="https://www.rfc-editor.org/rfc/rfc7405.html" rel="nofollow">RFC 7405</a> and references the core rules
in RFC 5234, Appendix B.1.</p>
<p dir="auto">The base64 encoding used throughout is the standard Base 64 encoding specified
in <a href="https://www.rfc-editor.org/rfc/rfc4648.html" rel="nofollow">RFC 4648</a>, Section 4, without <code>=</code> padding characters (sometimes referred
to as &#34;raw&#34; or &#34;unpadded&#34; base64). Encoders MUST generate canonical base64
according to RFC 4648, Section 3.5, and decoders MUST reject non-canonical
encodings and encodings ending with <code>=</code> padding characters.</p>
<p dir="auto">Keys derived with HKDF-SHA-256 are produced by applying HKDF-Extract with the
specified salt followed by HKDF-Expand with the specified info according to
<a href="https://www.rfc-editor.org/rfc/rfc5869.html" rel="nofollow">RFC 5869</a>. The hash used with HKDF in this specification is always SHA-256.
The length of the output keying material is always 32 bytes.</p>
<p dir="auto">ChaCha20-Poly1305 is the AEAD encryption function from <a href="https://www.rfc-editor.org/rfc/rfc7539.html" rel="nofollow">RFC 7539</a>.</p>
<p dir="auto"><code>||</code> denotes concatenation. <code>0x</code> followed by two hexadecimal characters denotes
a byte value in the 0-255 range.</p>
<p dir="auto">The key words &#34;MUST&#34;, &#34;MUST NOT&#34;, &#34;REQUIRED&#34;, &#34;SHALL&#34;, &#34;SHALL NOT&#34;, &#34;SHOULD&#34;,
&#34;SHOULD NOT&#34;, &#34;RECOMMENDED&#34;, &#34;NOT RECOMMENDED&#34;, &#34;MAY&#34;, and &#34;OPTIONAL&#34; in this
document are to be interpreted as described in <a href="https://www.rfc-editor.org/info/bcp14" rel="nofollow">BCP 14</a> <a href="https://www.rfc-editor.org/rfc/rfc2119.html" rel="nofollow">RFC 2119</a>
<a href="https://www.rfc-editor.org/rfc/rfc8174.html" rel="nofollow">RFC 8174</a> when, and only when, they appear in all capitals, as shown here.</p>
<h2 dir="auto"><a id="user-content-encrypted-file-format" aria-hidden="true" href="#encrypted-file-format"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Encrypted file format</h2>
<p dir="auto">An age file is composed of two parts: a textual <a href="#header">header</a> that carries
the <em>file key</em>, and a binary <a href="#payload">payload</a> encrypted with it. Overall, age
files MUST be treated as binary, and are not malleable without knowledge of the
file key.</p>
<p dir="auto">age files MAY use the extension <code>.age</code>, in both their binary and
<a href="#ascii-armor">armored</a> formats.</p>
<h3 dir="auto"><a id="user-content-file-key" aria-hidden="true" href="#file-key"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>File key</h3>
<p dir="auto">Each file is encrypted with a 128-bit symmetric <em>file key</em>.</p>
<p dir="auto">The <em>file key</em> MUST be generated as 16 bytes of CSPRNG output. It MUST NOT be
reused across multiple files.</p>
<h3 dir="auto"><a id="user-content-header" aria-hidden="true" href="#header"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Header</h3>
<p dir="auto">The textual file header wraps the <em>file key</em> for one or more <em>recipients</em>, so
that it can be unwrapped by one of the corresponding <em>identities</em>. It starts with a
version line, followed by one or more recipient stanzas, and ends with a MAC.</p>
<div data-snippet-clipboard-copy-content="age-encryption.org/v1
-&gt; X25519 XEl0dJ6y3C7KZkgmgWUicg63EyXJiwBJW8PdYJ/cYBE
qRS0AMjdjPvZ/WT08U2KL4G+PIooA3hy38SvLpvaC1E
--- HK2NmOBN9Dpq0Gw6xMCuhFcQlQLvZ/wQUi/2scLG75s"><pre><code>age-encryption.org/v1
-&gt; X25519 XEl0dJ6y3C7KZkgmgWUicg63EyXJiwBJW8PdYJ/cYBE
qRS0AMjdjPvZ/WT08U2KL4G+PIooA3hy38SvLpvaC1E
--- HK2NmOBN9Dpq0Gw6xMCuhFcQlQLvZ/wQUi/2scLG75s
</code></pre></div>
<p dir="auto">Note that each section of the header can be parsed by looking at its first three
characters, and it ends either at the next newline (for version and MAC lines)
or at the first line shorter than 64 columns (for stanzas).</p>
<h4 dir="auto"><a id="user-content-version-line" aria-hidden="true" href="#version-line"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Version line</h4>
<p dir="auto">The version line always starts with &#34;age-encryption.org/&#34;, is followed by an
arbitrary version string, and ends with a line feed (<code>0x0A</code>).</p>
<div data-snippet-clipboard-copy-content="version-line = %s&#34;age-encryption.org/&#34; version LF

version = 1*VCHAR"><pre><code>version-line = %s&#34;age-encryption.org/&#34; version LF

version = 1*VCHAR
</code></pre></div>
<p dir="auto">This document only specifies the <code>v1</code> format. Anything after the end of the
version line may change in future versions.</p>
<h4 dir="auto"><a id="user-content-recipient-stanza" aria-hidden="true" href="#recipient-stanza"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Recipient stanza</h4>
<p dir="auto">A recipient stanza starts with <code>-&gt;</code>, followed after a space by one or more space-separated
arguments, and a base64-encoded body wrapped at 64 columns. The body MUST end
with a line shorter than 64 characters, which MAY be empty.</p>
<p dir="auto">Each recipient stanza wraps the same <em>file key</em> independently. Identity
implementations are provided the full set of stanzas and recognize those
addressed to them from their arguments. Identity implementations MUST ignore
unrecognized stanzas, unless they wish to require that the recipient type they
implement is not mixed with other types.</p>
<p dir="auto">It is RECOMMENDED that non-native recipient implementations use fully-qualified
names as the first stanza argument, such as <code>example.com/enigma</code>, to avoid
ambiguity and conflicts.</p>
<p dir="auto">Recipient implementations MAY choose to include an identifier of the specific
recipient (for example, a short hash of the public key) as an argument. Note
that this sacrifices any chance of ciphertext anonymity and unlinkability.</p>
<h4 dir="auto"><a id="user-content-header-mac" aria-hidden="true" href="#header-mac"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Header MAC</h4>
<p dir="auto">The final header line starts with <code>---</code> and is followed after a space by the
base64-encoded MAC of the header. The MAC is computed with HMAC-SHA-256 (see
<a href="https://www.rfc-editor.org/rfc/rfc2104.html" rel="nofollow">RFC 2104</a>) over the whole header up to and including the <code>---</code> mark
(excluding the space following it).</p>
<p dir="auto">The HMAC key is computed as follows:</p>
<div data-snippet-clipboard-copy-content="HMAC key = HKDF-SHA-256(ikm = file key, salt = empty, info = &#34;header&#34;)"><pre><code>HMAC key = HKDF-SHA-256(ikm = file key, salt = empty, info = &#34;header&#34;)
</code></pre></div>
<h4 dir="auto"><a id="user-content-abnf-definition-of-file-header" aria-hidden="true" href="#abnf-definition-of-file-header"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ABNF definition of file header</h4>
<p dir="auto">The following is the ABNF definition of the v1 file header.</p>
<div data-snippet-clipboard-copy-content="header = v1-line 1*stanza end

v1-line = %s&#34;age-encryption.org/v1&#34; LF

end = &#34;--- &#34; 43base64char LF

base64char = ALPHA / DIGIT / &#34;+&#34; / &#34;/&#34;

stanza = arg-line *full-line final-line

arg-line = &#34;-&gt; &#34; argument *(SP argument) LF

argument = 1*VCHAR

full-line = 64base64char LF

final-line = *63base64char LF"><pre><code>header = v1-line 1*stanza end

v1-line = %s&#34;age-encryption.org/v1&#34; LF

end = &#34;--- &#34; 43base64char LF

base64char = ALPHA / DIGIT / &#34;+&#34; / &#34;/&#34;

stanza = arg-line *full-line final-line

arg-line = &#34;-&gt; &#34; argument *(SP argument) LF

argument = 1*VCHAR

full-line = 64base64char LF

final-line = *63base64char LF
</code></pre></div>
<h3 dir="auto"><a id="user-content-payload" aria-hidden="true" href="#payload"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Payload</h3>
<p dir="auto">The binary payload encrypts the file body and starts immediately after the
header. It begins with a 16-byte nonce generated by the sender from a CSPRNG.
A new nonce MUST be generated for each file.</p>
<p dir="auto">The payload key is computed as follows:</p>
<div data-snippet-clipboard-copy-content="payload key = HKDF-SHA-256(ikm = file key, salt = nonce, info = &#34;payload&#34;)"><pre><code>payload key = HKDF-SHA-256(ikm = file key, salt = nonce, info = &#34;payload&#34;)
</code></pre></div>
<p dir="auto">The payload is split in chunks of 64 KiB, and each of them is encrypted with
ChaCha20-Poly1305, using the payload key and a 12-byte nonce composed as
follows: the first 11 bytes are a big endian chunk counter starting at zero and
incrementing by one for each subsequent chunk; the last byte is 0x01 for the
final chunk and 0x00 for all preceding ones. The final chunk MAY be shorter than
64 KiB but MUST NOT be empty unless the whole payload is empty.</p>
<p dir="auto">This is a STREAM variant from <a href="https://eprint.iacr.org/2015/189" rel="nofollow">Online Authenticated-Encryption and its
Nonce-Reuse Misuse-Resistance</a>. It is similar to those used by <a href="https://github.com/google/tink/blob/59bb34495d1cb8f9d9dbc0f0a52c4f9e21491a14/docs/WIRE-FORMAT.md#streaming-encryption">Tink</a>
and <a href="https://github.com/miscreant/meta/wiki/STREAM">Miscreant</a>, but it doesn&#39;t prefix the AEAD nonce with key material as the
payload key is 256 bits (enough even to provide a security margin in the
multi-target setting) and derived from both file key and nonce.</p>
<p dir="auto">The payload can be streamed by decrypting or encrypting one chunk at a time.
Streaming decryption MUST signal an error if the end of file is reached without
successfully decrypting a final chunk.</p>
<p dir="auto">The payload can be seeked by jumping ahead in chunk increments, and decrypting
the whole chunk that contains the seeked position. Seeking relatively to the end
of file MUST first decrypt and verify that the last chunk is a valid final
chunk.</p>
<p dir="auto">The payload MUST NOT be modified without re-encrypting it as a new file with a
fresh nonce.</p>
<h2 dir="auto"><a id="user-content-native-recipient-types" aria-hidden="true" href="#native-recipient-types"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Native recipient types</h2>
<p dir="auto">This document specifies two core age recipient types: an asymmetric encryption
type based on X25519, and a passphrase encryption type based on scrypt.</p>
<h3 dir="auto"><a id="user-content-the-x25519-recipient-type" aria-hidden="true" href="#the-x25519-recipient-type"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>The X25519 recipient type</h3>
<p dir="auto">An X25519 identity is generated as</p>
<div data-snippet-clipboard-copy-content="identity = read(CSPRNG, 32)"><pre><code>identity = read(CSPRNG, 32)
</code></pre></div>
<p dir="auto">and encoded as <a href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki">Bech32</a> with HRP <code>AGE-SECRET-KEY-</code>.</p>
<div data-snippet-clipboard-copy-content="AGE-SECRET-KEY-1GFPYYSJZGFPYYSJZGFPYYSJZGFPYYSJZGFPYYSJZGFPYYSJZGFPQ4EGAEX"><pre><code>AGE-SECRET-KEY-1GFPYYSJZGFPYYSJZGFPYYSJZGFPYYSJZGFPYYSJZGFPYYSJZGFPQ4EGAEX
</code></pre></div>
<p dir="auto">The corresponding recipient is computed as</p>
<div data-snippet-clipboard-copy-content="recipient = X25519(identity, basepoint)"><pre><code>recipient = X25519(identity, basepoint)
</code></pre></div>
<p dir="auto">where <code>X25519</code> is from <a href="https://www.rfc-editor.org/rfc/rfc7748.html" rel="nofollow">RFC 7748</a>, Section 5, and <code>basepoint</code> is the
Curve25519 base point from RFC 7748, Section 4.1.</p>
<p dir="auto">The recipient is encoded as Bech32 with HRP <code>age</code>.</p>
<div data-snippet-clipboard-copy-content="age1zvkyg2lqzraa2lnjvqej32nkuu0ues2s82hzrye869xeexvn73equnujwj"><pre><code>age1zvkyg2lqzraa2lnjvqej32nkuu0ues2s82hzrye869xeexvn73equnujwj
</code></pre></div>
<p dir="auto">Note that Bech32 strings can only be all uppercase or all lowercase, but the
checksum is always computed over the lowercase string.</p>
<h4 dir="auto"><a id="user-content-x25519-recipient-stanza" aria-hidden="true" href="#x25519-recipient-stanza"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>X25519 recipient stanza</h4>
<p dir="auto">An X25519 recipient stanza has two arguments.</p>
<div data-snippet-clipboard-copy-content="-&gt; X25519 O6DLx/wDIawpUC978NSPjYvrfDtJVnZApXKp4FMPHCY
3aKjozt9agh7jGmvOKvR4iax41Wl4zj95MKK4X9JuWc"><pre><code>-&gt; X25519 O6DLx/wDIawpUC978NSPjYvrfDtJVnZApXKp4FMPHCY
3aKjozt9agh7jGmvOKvR4iax41Wl4zj95MKK4X9JuWc
</code></pre></div>
<p dir="auto">The first is the fixed string <code>X25519</code> and the second is the base64-encoded
ephemeral share computed by the recipient implementation as follows:</p>
<div data-snippet-clipboard-copy-content="ephemeral secret = read(CSPRNG, 32)
ephemeral share = X25519(ephemeral secret, basepoint)"><pre><code>ephemeral secret = read(CSPRNG, 32)
ephemeral share = X25519(ephemeral secret, basepoint)
</code></pre></div>
<p dir="auto">A new ephemeral secret MUST be generated for each stanza and each file.</p>
<p dir="auto">The body of the recipient stanza is computed by the recipient implementation as</p>
<div data-snippet-clipboard-copy-content="salt = ephemeral share || recipient
info = &#34;age-encryption.org/v1/X25519&#34;
shared secret = X25519(ephemeral secret, recipient)
wrap key = HKDF-SHA-256(ikm = shared secret, salt, info)
body = ChaCha20-Poly1305(key = wrap key, plaintext = file key)"><pre><code>salt = ephemeral share || recipient
info = &#34;age-encryption.org/v1/X25519&#34;
shared secret = X25519(ephemeral secret, recipient)
wrap key = HKDF-SHA-256(ikm = shared secret, salt, info)
body = ChaCha20-Poly1305(key = wrap key, plaintext = file key)
</code></pre></div>
<p dir="auto">where the ChaCha20-Poly1305 nonce is fixed as 12 0x00 bytes.</p>
<p dir="auto">The identity implementation MUST ignore any stanza that does not have <code>X25519</code>
as the first argument, and MUST otherwise reject any stanza that has more or
less than two arguments, or where the second argument is not a canonical
encoding of a 32-byte value. It MUST check that the body length is exactly 32
bytes before attempting to decrypt it.</p>
<p dir="auto">The identity implementation computes the shared secret as follows:</p>
<div data-snippet-clipboard-copy-content="shared secret = X25519(identity, ephemeral share)"><pre><code>shared secret = X25519(identity, ephemeral share)
</code></pre></div>
<p dir="auto">If the shared secret is all 0x00 bytes, the identity implementation MUST abort.</p>
<p dir="auto">Finally, it derives the key as above and decrypts the file key in the body.</p>
<h3 dir="auto"><a id="user-content-the-scrypt-recipient-type" aria-hidden="true" href="#the-scrypt-recipient-type"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>The scrypt recipient type</h3>
<p dir="auto">The scrypt recipient and identity implementations encrypt and decrypt the file
key with a provided passphrase.</p>
<h4 dir="auto"><a id="user-content-scrypt-recipient-stanza" aria-hidden="true" href="#scrypt-recipient-stanza"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>scrypt recipient stanza</h4>
<p dir="auto">An scrypt recipient stanza has three arguments.</p>
<div data-snippet-clipboard-copy-content="-&gt; scrypt ajMFur+EJLGaohv/dLRGnw 18
8SHBz/ldWnjyGFQqfjat6uNBarWqqEMDS7W8X7+Xq5Q"><pre><code>-&gt; scrypt ajMFur+EJLGaohv/dLRGnw 18
8SHBz/ldWnjyGFQqfjat6uNBarWqqEMDS7W8X7+Xq5Q
</code></pre></div>
<p dir="auto">The first is the string <code>scrypt</code>, the second is a base64-encoded salt computed
by the recipient implementation as 16 bytes from a CSPRNG, and the third is the
base-two logarithm of the scrypt work factor in decimal.</p>
<p dir="auto">A new salt MUST be generated for each stanza and each file.</p>
<p dir="auto">The body is computed as</p>
<div data-snippet-clipboard-copy-content="wrap key = scrypt(N = work factor, r = 8, p = 1, dkLen = 32,
    S = &#34;age-encryption.org/v1/scrypt&#34; || salt, P = passphrase)
body = ChaCha20-Poly1305(key = wrap key, plaintext = file key)"><pre><code>wrap key = scrypt(N = work factor, r = 8, p = 1, dkLen = 32,
    S = &#34;age-encryption.org/v1/scrypt&#34; || salt, P = passphrase)
body = ChaCha20-Poly1305(key = wrap key, plaintext = file key)
</code></pre></div>
<p dir="auto">where the ChaCha20-Poly1305 nonce is fixed as 12 0x00 bytes and scrypt is from
<a href="https://www.rfc-editor.org/rfc/rfc7914.html" rel="nofollow">RFC 7914</a>.</p>
<p dir="auto">The identity implementation MUST reject any scrypt stanza that has more or less
than three arguments, where the second argument is not a canonical encoding of a
16-byte value, or where the third argument is not a decimal number composed of
only digits with no leading zeroes (<code>%x31-39 *DIGIT</code> in ABNF or <code>^[1-9][0-9]*$</code>
in regular expression). The identity implementation SHOULD apply an upper limit
to the work factor, and it MUST check that the body length is exactly 32 bytes
before attempting to decrypt it.</p>
<p dir="auto">An scrypt stanza, if present, MUST be the only stanza in the header. In other
words, scrypt stanzas MAY NOT be mixed with other scrypt stanzas or stanzas of
other types. This is to uphold an expectation of authentication that is
implicit in password-based encryption. The identity implementation MUST reject
headers where an scrypt stanza is present alongside any other stanza.</p>
<h2 dir="auto"><a id="user-content-ascii-armor" aria-hidden="true" href="#ascii-armor"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ASCII armor</h2>
<p dir="auto">age files that need to be transmitted as 7-bit ASCII SHOULD be encoded according
to the strict PEM encoding specified in <a href="https://www.rfc-editor.org/rfc/rfc7468.html" rel="nofollow">RFC 7468</a>, Section 3 (Figure 3), with
case-sensitive label &#34;AGE ENCRYPTED FILE&#34;. Note that this encoding employs
base64 with <code>=</code> padding characters, unlike the rest of this document.</p>
<p dir="auto">Note that ASCII armored files are malleable unless care is taken to reject any
data before and after the PEM encoding, a strict PEM parser is used, and
canonical base64 is enforced. age implementations SHOULD reject non-canonical
ASCII armor encodings except for whitespace before and after the PEM block, and
MAY choose to accept both LF and CRLF line endings.</p>
<h2 dir="auto"><a id="user-content-test-vectors" aria-hidden="true" href="#test-vectors"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Test vectors</h2>
<p dir="auto">A comprehensive set of test vectors is avaliable at
<a href="https://age-encryption.org/testkit" rel="nofollow">https://age-encryption.org/testkit</a>.</p>
</article>
  </div>

    </div>

  </div></div>
  </body>
</html>
