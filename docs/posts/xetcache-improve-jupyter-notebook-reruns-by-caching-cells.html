<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/xetdata/xetcache">Original</a>
    <h1>XetCache: Improve Jupyter notebook reruns by caching cells</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">XetCache provides persistent caching of long running functions or jupyter
notebook cells.</p>
<p dir="auto">The cache can be stored on local disk together with your notebooks and code
(and using LFS, or the git-xet extension to store it with your git repo).
Or alternatively, it can be fully managed by the <a href="http://www.xethub.com" rel="nofollow">XetHub</a> service
to easily share the cache with your collaborators.</p>

<ul dir="auto">
<li><a href="#install">Install</a></li>
<li><a href="#setup">Setup</a>
<ul dir="auto">
<li><a href="#setup-with-local">Setup With Local</a></li>
<li><a href="#setup-with-git-storage">Setup with Git Storage</a></li>
<li><a href="#setup-with-xethub">Setup With XetHub</a>
<ul dir="auto">
<li><a href="#authentication">Authentication</a>
<ul dir="auto">
<li><a href="#command-line">Command Line</a></li>
<li><a href="#environment-variable">Environment Variable</a></li>
<li><a href="#in-python">In Python</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#usage">Usage</a>
<ul dir="auto">
<li><a href="#usage-for-jupyter-notebooks">Usage For Jupyter Notebooks</a></li>
<li><a href="#usage-for-function-caching">Usage For Function Caching</a></li>
<li><a href="#usage-for-function-call-caching">Usage For Function Call Caching</a></li>
</ul>
</li>
<li><a href="#license">License</a></li>
</ul>

<p dir="auto">We created the <code>xetcache</code> library after our own frustrations working with Jupyter Notebooks with long running functions. You can get the full context by reading <a href="https://about.xethub.com/blog/xetcache-cache-jupyter-notebook-cells-for-performance-reproducibility?utm_source=github" rel="nofollow">this blog post</a>.</p>


<p dir="auto">Or to install from source from GitHub:</p>
<div data-snippet-clipboard-copy-content="pip install git+https://github.com/xetdata/xetcache.git"><pre><code>pip install git+https://github.com/xetdata/xetcache.git
</code></pre></div>

<h2 tabindex="-1" dir="auto"><a id="user-content-setup-with-local" aria-hidden="true" tabindex="-1" href="#setup-with-local"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Setup With Local</h2>
<p dir="auto">No additional set up needed. See Usage below.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-setup-with-git-storage" aria-hidden="true" tabindex="-1" href="#setup-with-git-storage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Setup with Git Storage</h2>
<p dir="auto">If using LFS, you can just directly commit and push the cache files in the
<code>xmemo</code> folder.</p>
<p dir="auto">However, if using GitHub we recommend the use of <a href="https://xetdata.com" rel="nofollow">XetHub&#39;s extensions to
GitHub</a> for performance and the ability to lazily fetch
cached objects.</p>
<p dir="auto">For instance, a repository with the XetHub extension will allow you to
lazy clone the repository with</p>
<div data-snippet-clipboard-copy-content="git xet clone --lazy [repo]"><pre><code>git xet clone --lazy [repo]
</code></pre></div>
<p dir="auto">which will avoid fetching any large cached objects until they are
actually needed.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-setup-with-xethub" aria-hidden="true" tabindex="-1" href="#setup-with-xethub"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Setup With XetHub</h2>
<p dir="auto">The use of the fully managed XetHub service provides more powerful data
deduplication capabilities that allows similar objects to be stored or loaded,
without needing to upload or download everything. We can also deploy caches near
your compute workloads to accelerate dataloading by over 10x.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-authentication" aria-hidden="true" tabindex="-1" href="#authentication"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Authentication</h3>
<p dir="auto">Signup on <a href="https://xethub.com/user/sign_up" rel="nofollow">XetHub</a> and obtain
a username and access token. You should write this down.</p>
<p dir="auto">There are three ways to authenticate with XetHub:</p>
<h4 tabindex="-1" dir="auto"><a id="user-content-command-line" aria-hidden="true" tabindex="-1" href="#command-line"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Command Line</h4>
<div dir="auto" data-snippet-clipboard-copy-content="xet login -e &lt;email&gt; -u &lt;username&gt; -p &lt;personal_access_token&gt;"><pre>xet login -e <span>&lt;</span>email<span>&gt;</span> -u <span>&lt;</span>username<span>&gt;</span> -p <span>&lt;</span>personal_access_token<span>&gt;</span></pre></div>
<p dir="auto">Xet login will write authentication information to <code>~/.xetconfig</code></p>
<h4 tabindex="-1" dir="auto"><a id="user-content-environment-variable" aria-hidden="true" tabindex="-1" href="#environment-variable"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Environment Variable</h4>
<p dir="auto">Environment variables may be sometimes more convenient:</p>
<div dir="auto" data-snippet-clipboard-copy-content="export XET_USER_EMAIL = &lt;email&gt;
export XET_USER_NAME = &lt;username&gt;
export XET_USER_TOKEN = &lt;personal_access_token&gt;"><pre><span>export</span> XET_USER_EMAIL = <span>&lt;</span>email<span>&gt;</span>
<span>export</span> XET_USER_NAME = <span>&lt;</span>username<span>&gt;</span>
<span>export</span> XET_USER_TOKEN = <span>&lt;</span>personal_access_token<span>&gt;</span></pre></div>
<h4 tabindex="-1" dir="auto"><a id="user-content-in-python" aria-hidden="true" tabindex="-1" href="#in-python"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>In Python</h4>
<p dir="auto">Finally if in a notebook environment, or a non-persistent environment,
we also provide a method to authenticate directly from Python. Note that
this must be the first thing you run before any other operation:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import pyxet
pyxet.login(&lt;username&gt;, &lt;personal_access_token&gt;, &lt;email&gt;)"><pre><span>import</span> <span>pyxet</span>
<span>pyxet</span>.<span>login</span>(<span>&lt;</span><span>username</span><span>&gt;</span>, <span>&lt;</span><span>personal_access_token</span><span>&gt;</span>, <span>&lt;</span><span>email</span><span>&gt;</span>)</pre></div>

<p dir="auto"><em>Optional</em> : to cache on XetHub, you need to run:</p>
<div data-snippet-clipboard-copy-content="import xetcache
xetcache.set_xet_project([give a project name here])"><pre><code>import xetcache
xetcache.set_xet_project([give a project name here])
</code></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-usage-for-jupyter-notebooks" aria-hidden="true" tabindex="-1" href="#usage-for-jupyter-notebooks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage For Jupyter Notebooks</h2>
<p dir="auto">For Jupyter notebooks, run the following command to load the extension</p>

<p dir="auto">After which adding the following line to the top of a cell</p>
<div dir="auto" data-snippet-clipboard-copy-content="%%xetmemo input=v1,v2 output=v3,v4"><pre><span>%</span><span>%</span><span>xetmemo</span> <span>input</span><span>=</span><span>v1</span>,<span>v2</span> <span>output</span><span>=</span><span>v3</span>,<span>v4</span></pre></div>
<p dir="auto">will cache the specified output variables (v3,v4 here) each time it is called.
If called later with the same input values for v1,v2, the cached value is
returned and not reevaluated. The cache is persistent across Python runs.</p>
<p dir="auto">By default, the output will only be cached if the cell takes longer the 3
seconds to run. &#34;always=True&#34; can be added to the xetmemo arguments to
ignore the runime and to always cache:</p>
<div data-snippet-clipboard-copy-content="%%xetmemo input=v1,v2 output=v3,v4 always=True"><pre><code>%%xetmemo input=v1,v2 output=v3,v4 always=True
</code></pre></div>
<p dir="auto">Note that inputs can be anything picklable including functions.</p>
<p dir="auto">A key parameter can be added to group the stored objects together.
Objects stored with one key will not be retrievable with a different
key</p>
<div dir="auto" data-snippet-clipboard-copy-content="%%xetmemo input=v1,v2 output=v3,v4 always=True key=experiment1"><pre><span>%</span><span>%</span><span>xetmemo</span> <span>input</span><span>=</span><span>v1</span>,<span>v2</span> <span>output</span><span>=</span><span>v3</span>,<span>v4</span> <span>always</span><span>=</span><span>True</span> <span>key</span><span>=</span><span>experiment1</span></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-usage-for-function-caching" aria-hidden="true" tabindex="-1" href="#usage-for-function-caching"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage For Function Caching</h2>
<p dir="auto">To cache the output of a function:</p>
<div dir="auto" data-snippet-clipboard-copy-content="from xetcache import xetmemo

@xetmemo
def slowfunction(arg1, arg2):
   ...

# Stores with a key
@xetmemo(key=&#34;hello&#34;)
def slowfunction(arg1, arg2):
   ..."><pre><span>from</span> <span>xetcache</span> <span>import</span> <span>xetmemo</span>

<span>@<span>xetmemo</span></span>
<span>def</span> <span>slowfunction</span>(<span>arg1</span>, <span>arg2</span>):
   ...

<span># Stores with a key</span>
<span>@<span>xetmemo</span>(<span>key</span><span>=</span><span>&#34;hello&#34;</span>)</span>
<span>def</span> <span>slowfunction</span>(<span>arg1</span>, <span>arg2</span>):
   ...</pre></div>
<p dir="auto">By default, the output will only be cached if the cell takes longer the 3
seconds to run. &#34;always=True&#34; can be added to the xetmemo arguments to
ignore the runtime and to always cache:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# This will always cache irrespective of runtime
@xetmemo(always=True)
def slowfunction(arg1, arg2):
   ..."><pre><span># This will always cache irrespective of runtime</span>
<span>@<span>xetmemo</span>(<span>always</span><span>=</span><span>True</span>)</span>
<span>def</span> <span>slowfunction</span>(<span>arg1</span>, <span>arg2</span>):
   ...</pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-usage-for-function-call-caching" aria-hidden="true" tabindex="-1" href="#usage-for-function-call-caching"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage For Function Call Caching</h2>
<p dir="auto">To cache a function call:</p>
<div dir="auto" data-snippet-clipboard-copy-content="def slowfn(x):
    ..do stuff..

# caches the call to slowfn with argument x
xeteval(slowfn, x)

# Stores with a key
xeteval(&#34;key&#34;, slowfn, x)"><pre><span>def</span> <span>slowfn</span>(<span>x</span>):
    ..<span>do</span> <span>stuff</span>..

<span># caches the call to slowfn with argument x</span>
<span>xeteval</span>(<span>slowfn</span>, <span>x</span>)

<span># Stores with a key</span>
<span>xeteval</span>(<span>&#34;key&#34;</span>, <span>slowfn</span>, <span>x</span>)</pre></div>
<p dir="auto">By default, the output will only be cached if the cell takes longer the 3
seconds to run. <code>xeteval_always</code> can be used instead to
ignore the runtime and to always cache:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Store even if function is quick to run
xeteval_always(quickfn, x)

# Store with a key and to always store even the function is quick to run
xeteval_always(&#34;key&#34;, quickfn, x)"><pre><span># Store even if function is quick to run</span>
<span>xeteval_always</span>(<span>quickfn</span>, <span>x</span>)

<span># Store with a key and to always store even the function is quick to run</span>
<span>xeteval_always</span>(<span>&#34;key&#34;</span>, <span>quickfn</span>, <span>x</span>)</pre></div>

<p dir="auto"><a href="https://blog.nelhage.com/xetdata/xetcache/blob/main/LICENSE">BSD 3</a></p>
</article>
          </div></div>
  </body>
</html>
