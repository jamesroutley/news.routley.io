<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://snufk.in/blog/silly-compression-text.html">Original</a>
    <h1>Silly Lossy Text Compression Idea</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>Oh no, I&#39;ve done it again. I&#39;ve heard your cries, this time I have a decoder
idea too.</p>

<p>The idea this time is to remove random letters from the text to make it shorter,
and then &#39;decode&#39; using autocorrect.</p>
<h2>Encoder</h2>
<div><pre><span></span><code><span>import</span> <span>random</span>
<span>import</span> <span>re</span>
<span>import</span> <span>string</span>


<span>def</span> <span>encode</span><span>(</span><span>text</span><span>:</span> <span>str</span><span>,</span> <span>remove_rate</span><span>:</span> <span>float</span><span>)</span> <span>-&gt;</span> <span>str</span><span>:</span>
    <span>&#34;&#34;&#34;</span>
<span>    Remove random letters from the string</span>

<span>    We shouldn&#39;t remove any spaces, to give autocorrect a fighting chance</span>

<span>    Args:</span>
<span>        text (str): String to be &#39;encoded&#39;</span>
<span>        remove_rate (float): [0,1] proportion of characters to be removed.</span>

<span>    Returns:</span>
<span>        str: lossily encoded string</span>
<span>    &#34;&#34;&#34;</span>
    <span>if</span> <span>remove_rate</span> <span>&gt;</span> <span>1</span><span>:</span>
        <span>raise</span> <span>ValueError</span><span>(</span><span>&#34;Remove rate greater than 1&#34;</span><span>)</span>
    <span>if</span> <span>remove_rate</span> <span>&lt;</span> <span>0</span><span>:</span>
        <span>raise</span> <span>ValueError</span><span>(</span><span>&#34;Remove rate less than 0&#34;</span><span>)</span>

    <span>text_list</span> <span>=</span> <span>list</span><span>(</span><span>text</span><span>)</span>

    <span># Strip out spaces, punctuation since we don&#39;t need them here</span>
    <span>stripped_punc</span> <span>=</span> <span>text</span><span>.</span><span>translate</span><span>(</span><span>str</span><span>.</span><span>maketrans</span><span>(</span><span>&#34;&#34;</span><span>,</span> <span>&#34;&#34;</span><span>,</span> <span>string</span><span>.</span><span>punctuation</span> <span>+</span> <span>&#34; &#34;</span><span>))</span>
    <span>letters_to_remove</span> <span>=</span> <span>int</span><span>(</span><span>remove_rate</span> <span>*</span> <span>len</span><span>(</span><span>stripped_punc</span><span>))</span>

    <span>for</span> <span>_</span> <span>in</span> <span>range</span><span>(</span><span>letters_to_remove</span><span>):</span>
        <span>choice</span> <span>=</span> <span>random</span><span>.</span><span>randint</span><span>(</span><span>0</span><span>,</span> <span>len</span><span>(</span><span>text_list</span><span>)</span> <span>-</span> <span>1</span><span>)</span>
        <span>while</span> <span>text_list</span><span>[</span><span>choice</span><span>]</span> <span>in</span> <span>string</span><span>.</span><span>punctuation</span> <span>+</span> <span>&#34; &#34;</span><span>:</span>
            <span>choice</span> <span>=</span> <span>random</span><span>.</span><span>randint</span><span>(</span><span>0</span><span>,</span> <span>len</span><span>(</span><span>text_list</span><span>)</span> <span>-</span> <span>1</span><span>)</span>

        <span>del</span> <span>text_list</span><span>[</span><span>choice</span><span>]</span>

    <span>removed_letters</span> <span>=</span> <span>&#34;&#34;</span><span>.</span><span>join</span><span>(</span><span>text_list</span><span>)</span>

    <span># Make multiple spaces just one</span>
    <span>return</span> <span>re</span><span>.</span><span>sub</span><span>(</span><span>&#34; +&#34;</span><span>,</span> <span>&#34; &#34;</span><span>,</span> <span>removed_letters</span><span>)</span>
</code></pre></div>
<p>Here we can provide a string and a proportion of the text to randomly remove.
I opted to keep punctuation and spaces, but at the end I collapse consecutive
spaces into just one (this keeps the string nice if whole words are removed). This also makes the decoder simple.</p>
<p>Some examples using the text</p>
<blockquote>
<p>The Quick Brown Fox Jumps Over The Lazy Dog</p>
</blockquote>
<p>With a 0.1 rate</p>
<blockquote>
<p>Th Quick Bown Fox Jump Over The Lazy Dog</p>
</blockquote>
<p>and a 0.9 rate</p>
<blockquote>
<p>Qu u g</p>
</blockquote>
<p>Okay so there&#39;s not a great chance that removing 90% of the letters in a text is very useful for decoding.</p>
<h2>Decoder</h2>
<div><pre><span></span><code><span>from</span> <span>spellchecker</span> <span>import</span> <span>SpellChecker</span>


<span>def</span> <span>decode</span><span>(</span><span>text</span><span>:</span> <span>str</span><span>)</span> <span>-&gt;</span> <span>str</span><span>:</span>
    <span>&#34;&#34;&#34;</span>
<span>    Tries to auto-correct a &#39;lossily&#39; encoded string</span>

<span>    Args:</span>
<span>        text (str): lossy string</span>

<span>    Returns:</span>
<span>        str: Auto-corrected string, &#39;decoded&#39;</span>
<span>    &#34;&#34;&#34;</span>
    <span>spell</span> <span>=</span> <span>SpellChecker</span><span>()</span>
    <span>words</span> <span>=</span> <span>text</span><span>.</span><span>split</span><span>(</span><span>&#34; &#34;</span><span>)</span>

    <span>results</span> <span>=</span> <span>[]</span>
    <span>for</span> <span>word</span> <span>in</span> <span>words</span><span>:</span>
        <span>results</span><span>.</span><span>append</span><span>(</span><span>spell</span><span>.</span><span>correction</span><span>(</span><span>word</span><span>))</span>

    <span>return</span> <span>&#34; &#34;</span><span>.</span><span>join</span><span>(</span><span>results</span><span>)</span>
</code></pre></div>
<p>We can try our 0.1 rate text and see if this produces a useful output</p>
<blockquote>
<p>the Quick down Fox Jump Over The Lazy Dog</p>
</blockquote>
<p>Okay, so we&#39;re slightly wrong but &#39;down&#39; is probably more likely to be a misspelling than &#39;brown&#39; I think this is understandable.</p>
<p>Let&#39;s try the 0.9 rate text for kicks</p>
<blockquote>
<p>Qu u i</p>
</blockquote>
<p>We notice a slightly interesting thing in that the spell checker will actually try and turn any lone consonant into &#39;i&#39; (and not &#39;I&#39;), I&#39;m not really sure why it&#39;s lowercase.</p>

<p>Vowels area bit more of a &#39;gluey&#39; letter, removing them from words tends to make more sense than just random letters. A word losing most of its consonants turns it into more &#39;primordial soup&#39; than just the vowels generally.</p>
<div><pre><span></span><code><span>import</span> <span>random</span>
<span>import</span> <span>re</span>

<span>VOWELS</span> <span>=</span> <span>[</span><span>&#34;a&#34;</span><span>,</span> <span>&#34;e&#34;</span><span>,</span> <span>&#34;i&#34;</span><span>,</span> <span>&#34;o&#34;</span><span>,</span> <span>&#34;u&#34;</span><span>]</span>


<span>def</span> <span>encode</span><span>(</span><span>text</span><span>:</span> <span>str</span><span>,</span> <span>remove_rate</span><span>:</span> <span>float</span><span>)</span> <span>-&gt;</span> <span>str</span><span>:</span>
    <span>&#34;&#34;&#34;</span>
<span>    Remove vowels from the string</span>

<span>    We shouldn&#39;t remove any spaces, to give autocorrect a fighting chance</span>

<span>    Args:</span>
<span>        text (str): String to be &#39;encoded&#39;</span>
<span>        remove_rate (float): [0,1] proportion of vowels to be removed.</span>

<span>    Returns:</span>
<span>        str: lossily encoded string</span>
<span>    &#34;&#34;&#34;</span>

    <span>if</span> <span>remove_rate</span> <span>&gt;</span> <span>1</span><span>:</span>
        <span>raise</span> <span>ValueError</span><span>(</span><span>&#34;Remove rate greater than 1&#34;</span><span>)</span>
    <span>if</span> <span>remove_rate</span> <span>&lt;</span> <span>0</span><span>:</span>
        <span>raise</span> <span>ValueError</span><span>(</span><span>&#34;Remove rate less than 0&#34;</span><span>)</span>

    <span>text_list</span> <span>=</span> <span>list</span><span>(</span><span>text</span><span>)</span>

    <span># Strip out spaces, punctuation since we don&#39;t need them here</span>
    <span>stripped</span> <span>=</span> <span>[</span><span>l</span> <span>for</span> <span>l</span> <span>in</span> <span>text_list</span> <span>if</span> <span>l</span> <span>in</span> <span>VOWELS</span><span>]</span>
    <span>letters_to_remove</span> <span>=</span> <span>int</span><span>(</span><span>remove_rate</span> <span>*</span> <span>len</span><span>(</span><span>stripped</span><span>))</span>

    <span>for</span> <span>_</span> <span>in</span> <span>range</span><span>(</span><span>letters_to_remove</span><span>):</span>
        <span>choice</span> <span>=</span> <span>random</span><span>.</span><span>randint</span><span>(</span><span>0</span><span>,</span> <span>len</span><span>(</span><span>text_list</span><span>)</span> <span>-</span> <span>1</span><span>)</span>
        <span>while</span> <span>text_list</span><span>[</span><span>choice</span><span>]</span> <span>not</span> <span>in</span> <span>VOWELS</span><span>:</span>
            <span>choice</span> <span>=</span> <span>random</span><span>.</span><span>randint</span><span>(</span><span>0</span><span>,</span> <span>len</span><span>(</span><span>text_list</span><span>)</span> <span>-</span> <span>1</span><span>)</span>

        <span>del</span> <span>text_list</span><span>[</span><span>choice</span><span>]</span>

    <span>removed_letters</span> <span>=</span> <span>&#34;&#34;</span><span>.</span><span>join</span><span>(</span><span>text_list</span><span>)</span>

    <span># Make multiple spaces just one</span>
    <span>return</span> <span>re</span><span>.</span><span>sub</span><span>(</span><span>&#34; +&#34;</span><span>,</span> <span>&#34; &#34;</span><span>,</span> <span>removed_letters</span><span>)</span>
</code></pre></div>
<p>Again using that phrase:</p>
<blockquote>
<p>The Quick Brown Fox Jumps Over The Lazy Dog</p>
</blockquote>
<p>We can see the results for 0.5</p>
<blockquote>
<p>Th Qck Brown Fx Jmps Over The Lazy Dog</p>
</blockquote>
<p>This makes much more sense in my opinion but is obviously a smaller &#39;saving&#39; than the first approach</p>
<p>We can even remove all the vowels</p>
<blockquote>
<p>Th Qck Brwn Fx Jmps Ovr Th Lzy Dg</p>
</blockquote>
<p>And this is pretty much intelligible still even without &#39;decoding&#39;.</p>
<p>Using the same decoding scheme we end up with something like</p>
<blockquote>
<p>the ack brown fix jumps or the lay do</p>
</blockquote>
<p>However, this is probably because the autocorrect favours words that are the same length. It&#39;s also worth noting there&#39;s no real contextual information for each word &#39;brown fix&#39; makes no sense where &#39;fox&#39; would be a better option.</p>
<h2>Demo on Longer Text</h2>
<p>We can take Genesis 1:1 as our text to be encoded:</p>
<blockquote>
<p>In the beginning God created the heavens and the earth. Now the earth was formless and empty, darkness was over the surface of the deep, and the Spirit of God was hovering over the waters.</p>
</blockquote>
<p>Encoded with 50% of the vowels dropped:</p>
<blockquote>
<p>In th bgnning Gd cratd th hevns and the arth. Nw the earth was formlss nd empty, darkness was ovr th surfac of th dep, and the Sprt of God was hverng ver th wtrs.</p>
</blockquote>
<p>Decoded:</p>
<blockquote>
<p>In the banning go crate the hens and the earth no the earth was formless and empty darkness was or the surface of the dept and the sort of God was hovering ver the worse</p>
</blockquote>
<p>We get a compression ratio of 1.16, which is not great considering how different the decoded text is! However, perhaps this shows some promise of a sort of poetic re-imagining of the input text.</p>
<p>Removing all of the vowels from the text ends up with this after decoding:</p>
<blockquote>
<p>In the boning go crud the hans and the the no the ruth is frills and empty dress is or the safe i the do and the sort i go is having or the worse</p>
</blockquote>
<p>Which I think is at least somewhat interesting for having the same structure as the original text but interprets very differently.</p>
</div></div>
  </body>
</html>
