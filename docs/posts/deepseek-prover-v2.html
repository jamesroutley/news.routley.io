<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/deepseek-ai/DeepSeek-Prover-V2">Original</a>
    <h1>DeepSeek-Prover-V2</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">


<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/deepseek-ai/DeepSeek-V2/blob/main/figures/logo.svg?raw=true"><img src="https://github.com/deepseek-ai/DeepSeek-V2/raw/main/figures/logo.svg?raw=true" width="60%" alt="DeepSeek-V3"/></a>
</p>
<hr/>

<p dir="auto">
  <a href="#2-model-summary">Model Summary</a> |
  <a href="#3-proverbench">ProverBench</a> |
  <a href="#4-model-dataset-downloads">Model&amp;Dataset Download</a> |
  <a href="#5-quick-start">Quick Start</a> |
  <a href="#6-license">License</a> |
  <a href="#7-contact">Contact</a>
</p>


<p dir="auto">We introduce DeepSeek-Prover-V2, an open-source large language model designed for formal theorem proving in Lean 4, with initialization data collected through a recursive theorem proving pipeline powered by DeepSeek-V3. The cold-start training procedure begins by prompting DeepSeek-V3 to decompose complex problems into a series of subgoals. The proofs of resolved subgoals are synthesized into a chain-of-thought process, combined with DeepSeek-V3&#39;s step-by-step reasoning, to create an initial cold start for reinforcement learning. This process enables us to integrate both informal and formal mathematical reasoning into a unified model.</p>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://writing.natwelch.com/deepseek-ai/DeepSeek-Prover-V2/blob/main/figures/performance.png"><img width="100%" src="https://writing.natwelch.com/deepseek-ai/DeepSeek-Prover-V2/raw/main/figures/performance.png"/></a>
</p>

<hr/>
<p dir="auto"><strong>Synthesize Cold-Start Reasoning Data through Recursive Proof Search</strong></p>
<ul dir="auto">
<li>
<p dir="auto">To construct the cold-start dataset, we develop a simple yet effective pipeline for recursive theorem proving, utilizing DeepSeek-V3 as a unified tool for both subgoal decomposition and formalization. We prompt DeepSeek-V3 to decompose theorems into high-level proof sketches while simultaneously formalizing these proof steps in Lean 4, resulting in a sequence of subgoals.</p>
</li>
<li>
<p dir="auto">We use a smaller 7B model to handle the proof search for each subgoal, thereby reducing the associated computational burden. Once the decomposed steps of a challenging problem are resolved, we pair the complete step-by-step formal proof with the corresponding chain-of-thought from DeepSeek-V3 to create cold-start reasoning data.</p>
</li>
</ul>
<hr/>
<p dir="auto"><strong>Reinforcement Learning with Synthetic Cold-Start Data</strong></p>
<ul dir="auto">
<li>
<p dir="auto">We curate a subset of challenging problems that remain unsolved by the 7B prover model in an end-to-end manner, but for which all decomposed subgoals have been successfully resolved. By composing the proofs of all subgoals, we construct a complete formal proof for the original problem. This proof is then appended to DeepSeek-V3&#39;s chain-of-thought, which outlines the corresponding lemma decomposition, thereby producing a cohesive synthesis of informal reasoning and subsequent formalization.</p>
</li>
<li>
<p dir="auto">After fine-tuning the prover model on the synthetic cold-start data, we perform a reinforcement learning stage to further enhance its ability to bridge informal reasoning with formal proof construction. Following the standard training objective for reasoning models, we use binary correct-or-incorrect feedback as the primary form of reward supervision.</p>
</li>
<li>
<p dir="auto">The resulting model, DeepSeek-Prover-V2-671B, achieves state-of-the-art performance in neural theorem proving, reaching <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="10c342b53976c609710245a8ba9916e2">$88.9$</math-renderer>% pass ratio on the MiniF2F-test and solving 49 out of 658 problems from PutnamBench. The proofs generated by DeepSeek-Prover-V2 for the miniF2F dataset are available for download as a <a href="https://github.com/deepseek-ai/DeepSeek-Prover-V2/blob/master/minif2f-solutions.zip">ZIP archive</a>.</p>
</li>
</ul>
<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">3. ProverBench: Formalization of AIME and Textbook Problems</h2><a id="user-content-3-proverbench-formalization-of-aime-and-textbook-problems" aria-label="Permalink: 3. ProverBench: Formalization of AIME and Textbook Problems" href="#3-proverbench-formalization-of-aime-and-textbook-problems"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">we introduce ProverBench, a benchmark dataset comprising 325 problems. Of these, 15 are formalized from number theory and algebra questions featured in the recent AIME competitions (AIME 24 and 25), offering authentic high-school competition-level challenges. The remaining 310 problems are drawn from curated textbook examples and educational tutorials, contributing a diverse and pedagogically grounded collection of formalized mathematical problems. This benchmark is designed to enable more comprehensive evaluation across both high-school competition problems and undergraduate-level mathematics.</p>
<div dir="auto">
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Area</th>
<th>Count</th>
</tr>
</thead>
<tbody>
<tr>
<td>AIME 24&amp;25</td>
<td>15</td>
</tr>
<tr>
<td>Number Theory</td>
<td>40</td>
</tr>
<tr>
<td>Elementary Algebra</td>
<td>30</td>
</tr>
<tr>
<td>Linear Algebra</td>
<td>50</td>
</tr>
<tr>
<td>Abstract Algebra</td>
<td>40</td>
</tr>
<tr>
<td>Calculus</td>
<td>90</td>
</tr>
<tr>
<td>Real Analysis</td>
<td>30</td>
</tr>
<tr>
<td>Complex Analysis</td>
<td>10</td>
</tr>
<tr>
<td>Functional Analysis</td>
<td>10</td>
</tr>
<tr>
<td>Probability</td>
<td>10</td>
</tr>
<tr>
<td>Total</td>
<td>325</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
</div>
<div dir="auto"><h2 tabindex="-1" dir="auto">4. Model &amp; Dataset Downloads</h2><a id="user-content-4-model--dataset-downloads" aria-label="Permalink: 4. Model &amp; Dataset Downloads" href="#4-model--dataset-downloads"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">We release DeepSeek-Prover-V2 in two model sizes: 7B and 671B parameters. DeepSeek-Prover-V2-671B is trained on top of DeepSeek-V3-Base. DeepSeek-Prover-V2-7B is built upon DeepSeek-Prover-V1.5-Base and features an extended context length of up to 32K tokens.</p>



<p dir="auto">You can directly use <a href="https://github.com/huggingface/transformers">Huggingface&#39;s Transformers</a> for model inference. DeepSeek-Prover-V2-671B shares the same architecture as DeepSeek-V3. For detailed information and supported features, please refer to <a href="https://github.com/huggingface/transformers/blob/main/docs/source/en/model_doc/deepseek_v3.md">the DeepSeek-V3 documentation on Hugging Face</a>.</p>
<p dir="auto">The following is a basic example of generating a proof for a problem from the miniF2F dataset:</p>
<div dir="auto" data-snippet-clipboard-copy-content="from transformers import AutoModelForCausalLM, AutoTokenizer
import torch
torch.manual_seed(30)

model_id = &#34;DeepSeek-Prover-V2-7B&#34;  # or DeepSeek-Prover-V2-671B
tokenizer = AutoTokenizer.from_pretrained(model_id)

formal_statement = &#34;&#34;&#34;
import Mathlib
import Aesop

set_option maxHeartbeats 0

open BigOperators Real Nat Topology Rat

/-- What is the positive difference between $120\%$ of 30 and $130\%$ of 20? Show that it is 10.-/
theorem mathd_algebra_10 : abs ((120 : ℝ) / 100 * 30 - 130 / 100 * 20) = 10 := by
  sorry
&#34;&#34;&#34;.strip()

prompt = &#34;&#34;&#34;
Complete the following Lean 4 code:

```lean4
{}
```

Before producing the Lean 4 code to formally prove the given theorem, provide a detailed proof plan outlining the main proof steps and strategies.
The plan should highlight key ideas, intermediate lemmas, and proof structures that will guide the construction of the final formal proof.
&#34;&#34;&#34;.strip()

chat = [
  {&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: prompt.format(formal_statement)},
]

model = AutoModelForCausalLM.from_pretrained(model_id, device_map=&#34;auto&#34;, torch_dtype=torch.bfloat16, trust_remote_code=True)
inputs = tokenizer.apply_chat_template(chat, tokenize=True, add_generation_prompt=True, return_tensors=&#34;pt&#34;).to(model.device)

import time
start = time.time()
outputs = model.generate(inputs, max_new_tokens=8192)
print(tokenizer.batch_decode(outputs))
print(time.time() - start)"><pre><span>from</span> <span>transformers</span> <span>import</span> <span>AutoModelForCausalLM</span>, <span>AutoTokenizer</span>
<span>import</span> <span>torch</span>
<span>torch</span>.<span>manual_seed</span>(<span>30</span>)

<span>model_id</span> <span>=</span> <span>&#34;DeepSeek-Prover-V2-7B&#34;</span>  <span># or DeepSeek-Prover-V2-671B</span>
<span>tokenizer</span> <span>=</span> <span>AutoTokenizer</span>.<span>from_pretrained</span>(<span>model_id</span>)

<span>formal_statement</span> <span>=</span> <span>&#34;&#34;&#34;</span>
<span>import Mathlib</span>
<span>import Aesop</span>
<span></span>
<span>set_option maxHeartbeats 0</span>
<span></span>
<span>open BigOperators Real Nat Topology Rat</span>
<span></span>
<span>/-- What is the positive difference between $120\%$ of 30 and $130\%$ of 20? Show that it is 10.-/</span>
<span>theorem mathd_algebra_10 : abs ((120 : ℝ) / 100 * 30 - 130 / 100 * 20) = 10 := by</span>
<span>  sorry</span>
<span>&#34;&#34;&#34;</span>.<span>strip</span>()

<span>prompt</span> <span>=</span> <span>&#34;&#34;&#34;</span>
<span>Complete the following Lean 4 code:</span>
<span></span>
<span>```lean4</span>
<span>{}</span>
<span>```</span>
<span></span>
<span>Before producing the Lean 4 code to formally prove the given theorem, provide a detailed proof plan outlining the main proof steps and strategies.</span>
<span>The plan should highlight key ideas, intermediate lemmas, and proof structures that will guide the construction of the final formal proof.</span>
<span>&#34;&#34;&#34;</span>.<span>strip</span>()

<span>chat</span> <span>=</span> [
  {<span>&#34;role&#34;</span>: <span>&#34;user&#34;</span>, <span>&#34;content&#34;</span>: <span>prompt</span>.<span>format</span>(<span>formal_statement</span>)},
]

<span>model</span> <span>=</span> <span>AutoModelForCausalLM</span>.<span>from_pretrained</span>(<span>model_id</span>, <span>device_map</span><span>=</span><span>&#34;auto&#34;</span>, <span>torch_dtype</span><span>=</span><span>torch</span>.<span>bfloat16</span>, <span>trust_remote_code</span><span>=</span><span>True</span>)
<span>inputs</span> <span>=</span> <span>tokenizer</span>.<span>apply_chat_template</span>(<span>chat</span>, <span>tokenize</span><span>=</span><span>True</span>, <span>add_generation_prompt</span><span>=</span><span>True</span>, <span>return_tensors</span><span>=</span><span>&#34;pt&#34;</span>).<span>to</span>(<span>model</span>.<span>device</span>)

<span>import</span> <span>time</span>
<span>start</span> <span>=</span> <span>time</span>.<span>time</span>()
<span>outputs</span> <span>=</span> <span>model</span>.<span>generate</span>(<span>inputs</span>, <span>max_new_tokens</span><span>=</span><span>8192</span>)
<span>print</span>(<span>tokenizer</span>.<span>batch_decode</span>(<span>outputs</span>))
<span>print</span>(<span>time</span>.<span>time</span>() <span>-</span> <span>start</span>)</pre></div>

<p dir="auto">The use of DeepSeek-Prover-V2 models is subject to <a href="https://writing.natwelch.com/deepseek-ai/DeepSeek-Prover-V2/blob/main/LICENSE-MODEL">the Model License</a>.</p>

<p dir="auto">If you have any questions, please raise an issue or contact us at <a href="mailto:service@deepseek.com">service@deepseek.com</a>.</p>
</article></div></div>
  </body>
</html>
