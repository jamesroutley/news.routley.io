<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://matan-h.com/analyze-stackoverflow">Original</a>
    <h1>I Analyzed StackOverflow for Secrets</h1>
    
    <div id="readability-page-1" class="page"><div>
      
        <header>
          
          

  <p>
    

    

    
      
      

      <span>
        <i aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


        </header>
      

      <section itemprop="text">
        
        

<h2 id="backstory">backstory</h2>

<p>I read hackernews sometimes, and articles like <a href="https://py-code.org/stats">I mirrored all the code from PyPI to GitHub and analysed it</a> made me think, maybe there are less obvious places with leaked information.</p>

<p>This was in the back of my mind until recently, when I tried to <a href="https://github.com/kivy/buildozer/pull/1709">contribute</a> to the <a href="https://github.com/kivy/buildozer">buildozer</a> project. 
I implemented rich logs, and I felt like I understood buildozer, so I searched for <a href="https://stackoverflow.com/tags/buildozer">stackoverflow</a> questions about it. Then I discovered that buildozer, <a href="https://github.com/beeware/briefcase/blob/4db325af8381789ad5e049fb80bb4f03d1810208/src/briefcase/console.py#L402">unlike beeware</a> , actually dumps the <a href="https://github.com/kivy/buildozer/blob/dda7eaaf94d56813f48570b277752318555301f6/buildozer/logger.py#L81">full</a> environment when a command fails (for example output, see <a href="https://stackoverflow.com/questions/66628535/facing-buildozer-error-stating-command-failed">this</a> old question), and thought “what if this user built the app with a sensitive api ?”</p>

<p><img src="https://matan-h.com/assets/images/stackoverflow-random-data2.webp" alt="screenshot of stackoverflow quistion with random (fake) ghp tokens instead of the buildozer logs. "/></p>



<p>So, I downloaded stackOverflow from the <a href="https://archive.org/download/stackexchange">stackexchange archive.org dump</a>, and started to think how to parse it. It’s a huge (103G) XML file, where each line is a question or answer.</p>

<p>I tried different “leak detect” tools, most of them crashed or taking too much cpu:</p>

<ul>
  <li>
    <p>gitleaks : <code>fatal error: runtime: out of memory</code></p>
  </li>
  <li>
    <p>truffleHog : Actually works (and takes 100% cpu), but giving very poor results (e.g. a simple <code>%s</code> is considered a SQL server base64 encoded: <code>Detector Type: SQLServer,Decoder Type: BASE64,Raw result: %s</code> ).</p>
  </li>
  <li>
    <p>ripsecrets : no output 1 hour after I run it.</p>
  </li>
  <li>
    <p>(Yelp) detect-secrets: <code>Traceback (most recent call last): ... MemoryError</code></p>
  </li>
  <li>
    <p>ripgrep : freeze my system after few minutes.</p>
  </li>
</ul>

<p>So I ended up returning to my zsh and doing <code>grep</code>  , and even writing a my own rust script to do the searches.</p>



<p>As I suspected , there are a lot of leaks in stackoverflow (on the graph, only unique and not junk data is displayed. click on a label to hide it ):</p>




<p>As you can see, a lot of data.</p>

<p>Then, I asked myself, what could an attacker do with this information? Turns out, most of it is useless:</p>

<p>For using most data, you need more information then just the api key. For example, for stripe , you need the customer ID. For grafana, an instance url. For aws, a site url.</p>

<p>And even if you have an api key which goes to a centralized location without need for a “username”, most of the data is old. All the JWTs (<a href="https://jwt.io">JSON Web Tokens</a>) - forget about them, the average life of a JWT is a month.</p>

<p>Until I run a simple scan (again using the best hacking tools : <code>xargs</code> and <code>curl</code> ) against all the 74 real looking GitHub user tokens (which is a token that grants access to pretty much the full GitHub user) and discovered that 6 of them are actually valid.</p>

<p>Still, only 2 of them actually have bio and email, but one of them (a c/c++ developer)  has a repo with <code>3.4k</code> stars. So I finally found the path an attacker would take.</p>

<p>I sent both developers an email (I told them about this research and referred them to the question where they leak the token, with a little “if you find this message helpful, you can <a href="https://www.buymeacoffee.com/matanh">buy me a coffee</a>” at the end) and they both revoked the tokens (and both actually bought me a coffee, the first time I got money since I opened this buymeacoffee account in March 2021!).</p>

<p>I obviously couldn’t verify all the secrets. From most of them I’ll probably be banned,  so I stooped here.</p>

<h2 id="cause">cause</h2>

<p>Unlike PyPi and GitHub leaks articles, this article is not because of people leaving the password in their <code>deploy-to-server.py</code> and accidentally committing it (well, sometimes they copy <code>deploy-to-server-example.py</code> into stackoverflow and forget to mask the id …).</p>

<p>Most leaks are in the output of tools, a long output that people like to copy/paste right into stackoverflow, without actually looking at it,  because of people publish <strong>the output/ the tool config file</strong> of the tool they using (e.g. did you know that <code>curl -v</code> also displays your request with the headers, or that a long <code>package.json</code> with private dependencies can contain <code>git+your-private-gh-token</code> ? )</p>

<div>

  <pre><code>why is this not working?  I run this command curl -v --path-as-is &#39;https://matan-h.com/[redundant]&#39;
and I get this output:
*   Trying 185.199.108.153:80...
* Connected to matan-h.com (185.199.108.153) port 80 (#0)
&gt; GET /404/../ddebug/../my-windows-shell/../list-of-online-converter-tools/../exec_python_code_super_secret_4h0a4b?code=print(&#34;hi&#34;) HTTP/1.1
&gt; Host: matan-h.com
&gt; User-Agent: curl/40.4.0
&gt; Accept: */*
&gt; Accept-Encoding: deflate, gzip, br
&gt;
&lt; HTTP/1.1 301 Moved Permanently
</code></pre>

</div>

<p>I hope you enjoyed the article, and pay more attention to what you copy/paste in StackOverflow.</p>

        
      </section>

      

      


      
  

    </div></div>
  </body>
</html>
