<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.sergeantbiggs.net/posts/aerc-a-well-crafted-tui-for-email/">Original</a>
    <h1>Aerc: A well-crafted TUI for email</h1>
    
    <div id="readability-page-1" class="page"><div>
				<p><a href="https://aerc-mail.org/">Aerc</a> is a TUI email client.  It had its first release
~4 years ago. This makes it a “baby” compared to most of its “competitors” (Pine
was released in 1992, Mutt in 1995). I heard about this program shortly after
its first release but ignored it at the time, because I was still reasonably
happy with Thunderbird and it seemed quite bare-bones in comparison.
I recently decided to revisit this piece of software.  It seemed to have reached a
certain level of maturity and had enough features that I wanted to use
it as a daily driver.</p>
<p>Full disclosure: I tried to use neomutt as an email client multiple times but
got frustrated and gave up quite quickly. I was prepared for the eventuality
that I would have the same experience with aerc, so I approached it with almost
zero expectations. I’m glad to say that not only were my expectations more than
met, I can tentatively say that I’ve enjoyed using this client more than any
other client I’ve ever used. Whether it is <em>better</em> than any other email client
remains to be seen.</p>
<p>This article will contain a quick rundown of the different features of the
client and how I interacted with them. It tries to highlight how I personally
experienced and used the program, so it will be highly subjective.</p>
<h2 id="documentation">Documentation<a href="#documentation" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>The program has an inbuilt help feature that can be accessed via the command
<code>:help</code>. The tutorial is a good place to start and succinctly describes the
most important features and keybinds to get set up quickly. The other help
pages describe different parts of the application and are written clearly and
concisely. It makes it possible to use the client and all of its features
without having to rely on any external source. A handy feature is that all
of the help articles are just man pages that are piped to less. This means
they are also installed as plain man pages
(eg. <code>aerc-tutorial (7)</code>). This is a really nice way of shipping a “portable”
help system inside your TUI applications! I hope other applications/projects start
using this approach.</p>
<h2 id="account-configuration">Account Configuration<a href="#account-configuration" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Accounts are relatively easy to add, thanks to a simple and intuitive wizard.
This wizard creates a new entry in the accounts config file
(<code>~/.config/aerc/accounts.conf</code>). This file uses a simple INI syntax, so it is
really easy to read and modify. For example, this is my config section for a
private account:</p>
<div><pre tabindex="0"><code data-lang="ini"><span><span><span>[Sergeant Personal]</span>
</span></span><span><span><span>source</span>        <span>=</span> <span>imaps://user:password@mail.example.com:993</span>
</span></span><span><span><span>outgoing</span>      <span>=</span> <span>smtps://user:password@mail.example.com:465</span>
</span></span><span><span><span>default</span>       <span>=</span> <span>INBOX</span>
</span></span><span><span><span>from</span>          <span>=</span> <span>&#34;User&#34; &lt;user@example.com&gt;</span>
</span></span><span><span><span>copy-to</span>       <span>=</span> <span>Sent</span>
</span></span><span><span><span>cache-headers</span> <span>=</span> <span>true</span>
</span></span><span><span><span>folders-sort</span>  <span>=</span> <span>INBOX, Drafts, Sent, spambucket, Active, Waiting, Done</span>
</span></span><span><span><span>archive</span>       <span>=</span> <span>Archives</span>
</span></span><span><span><span>check-mail</span>    <span>=</span> <span>1m</span>
</span></span><span><span><span>folder-map</span>    <span>=</span> <span>/home/user/.config/aerc/folder-maps/foo.map</span>
</span></span></code></pre></div><p>Most of these options are self-explanatory, but there are a few that I want to
draw special attention to. These are the options for folder management
(<code>folders-sort</code> and <code>folder-map</code>)</p>
<h3 id="folders-sort">folders-sort<a href="#folders-sort" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>This option is really simple: It allows us to override automatic sorting
for certain folders. The specified folders are shown at the top of
the folder list in the provided order. The rest are sorted
alphabetically. This option should be in every email client. Sadly, I’ve never
seen it in a graphical client (Thunderbird/Outlook) before.</p>
<h3 id="folder-map">folder-map<a href="#folder-map" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>This is an amazing feature that solves a really annoying problem:
different email providers have different folder structures. For example, Gmail puts
everything in a folder named [Gmail], some providers put ‘Sent’ and ‘Drafts’
under ‘INBOX’, others don’t, etc. Since this folder structure is provided by
the server, there is no way to change it (unless you administer the email
server). Aerc has a really nice solution for this problem.
It consists of a
file with mapping rules, that maps server folders to displayed folder names.
This makes for a flexible remapping system that works on single and multiple folders,
allows removing prefixes from folders and much more. The
examples from the man page show this feature quite well.</p>
<pre tabindex="0"><code>Remap a single folder:
Spam = [Gmail]/Spam

Remap the folder and all of its subfolders:
G = [Gmail]*

Remove a prefix for all subfolders:
* = [Gmail]/*

Remap all subfolders and avoid a folder collision:
Archive/existing = Archive*
Archive = OldArchive*
</code></pre><p>It’s hard to overstate how much I love this feature. It allows me to have a
consistent folder structure that I can interact with in exactly the same way
for each and every one of my accounts (regardless of the folder structure on
the server). Consistent folder structures are especially important when you manage emails via a CLI
instead of a GUI.</p>
<h2 id="email-viewing">Email Viewing<a href="#email-viewing" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>My email viewing experience has been generally mediocre. This has nothing
to do with aerc itself, but rather with HTML emails. I suspected that this
would be non-ideal in a TUI client and that fact has been proven correct.
In most multipart emails the plain text version is
much less readable than the HTML version. It’s possible to grasp the meaning
most of the time but sometimes it is just a garbled mess.
Aerc has a few features to make this experience less bad. One option is
viewing them through a HTML parser/browser (a combination of
<a href="https://w3m.sourceforge.net/">w3m</a> and <a href="https://www.inet.no/dante/">dante</a>.
This works well for some emails. The generated output is sometimes better than
the plain text version of the email. As a last resort I just use <code>:open</code> to open
them in my default web browser.
The way aerc does this is actually quite nice: it uses custom filters. These
are *nix pipelines that allow the message to be piped through the
filter before being displayed. It has default filters for plain text
(colorising rules), calendar entries and HTML emails. These filters can be set
on mimetypes but can also be matched with specific headers. The configuration
contains a few examples and shows the flexibility and power of this feature:</p>
<div><pre tabindex="0"><code data-lang="ini"><span><span><span>text/plain</span><span>=</span><span>colorize</span>
</span></span><span><span><span>text/calendar</span><span>=</span><span>calendar</span>
</span></span><span><span><span>message/delivery-status</span><span>=</span><span>colorize</span>
</span></span><span><span><span>message/rfc822</span><span>=</span><span>colorize</span>
</span></span><span><span><span>#text/html=pandoc -f html -t plain | colorize</span>
</span></span><span><span><span>text/html</span><span>=</span><span>html | colorize</span>
</span></span><span><span><span>#text/*=bat -fP --file-name=&#34;$AERC_FILENAME&#34;</span>
</span></span><span><span><span>#application/x-sh=bat -fP -l sh</span>
</span></span><span><span><span>#image/*=catimg -w $(tput cols) -</span>
</span></span><span><span><span>#subject,~Git(hub|lab)=lolcat -f</span>
</span></span><span><span><span>#from,thatguywhodoesnothardwraphismessages=wrap -w 100 | colorize</span>
</span></span></code></pre></div>
<p>Email authoring is an absolute pleasure. I really like the fact I can now
compose my emails in vim.</p>
<h2 id="address-book">Address Book<a href="#address-book" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>The address book was something I struggled with quite a bit.
Like many things, theoretically this is handled quite elegantly in
aerc: it defers address book organisation to an external program. This is done
by allowing the user to specify a search query to the address book
software in question. The results of that query are then used for autocomplete
in relevant header fields. The default program aerc uses for this is
<a href="https://github.com/hhirsch/abook">abook</a>. My problems with this
software were twofold: first (at least in my tests) it did not seem to support
names with non-ascii characters. Since I frequently converse with German
people, this made this software useless to me. Also, there wasn’t an easy way
to get new addresses from the email program to abook, since it can not parse a
complete email and take out all of the addresses. This might have been solvable
with custom filters, but I didn’t want to put much time into this since it
didn’t work with non-ascii characters anyway. The second piece of software I
tried was <a href="https://sr.ht/~renerocksai/aercbook/">aercbook</a>. This had the same
problem with non-ascii characters as abook, but it does support parsing all
header fields for email addresses. I then found a third option, called
<a href="https://git.sr.ht/~maxgyver83/emailbook-janet">emailbook-janet</a>. This is a
rewrite of aercbook that is unfortunately not as performant, but it solves the
ascii problem. Using keybinds, one can even select emails, parse them and
automatically add all addresses to the address book:</p>
<div><pre tabindex="0"><code data-lang="ini"><span><span><span>aa</span> <span>=</span> <span>:pipe -m emailbook.janet /home/biggs/.config/aerc/address_book --parse --all&lt;Enter&gt;</span>
</span></span></code></pre></div><p>One limitation of this software (and aercbook) is that they are
not really “address books”. They simply save the name and email of contacts, to
make autocomplete work. This is all I need at the moment, so that
works out. If I ever need a more powerful solution, I might switch over to
<a href="https://github.com/lucc/khard">khard</a> or some similar solution. Who knows, I
might even set up an LDAP Server :)</p>
<h2 id="pgp-support">PGP Support<a href="#pgp-support" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>One big problem I’ve had with Thunderbird is its strange PGP/GPG support.
The biggest annoyance is its separate keychain. This makes using Thunderbird
with something like a smartcard finicky at best and impossible at worst (at
least, I’ve never got it to work properly). Aerc also has its own keychain, but
it is entirely optional. The default mode is to just use the GPG keychain.
You can set a specific key ID to sign messages, or just let aerc look up the
key by email. There are options for automatically signing all emails and to use
opportunistic encryption. All in all, as long as you have a working GPG setup,
this works flawlessly.</p>
<h2 id="general-configuration">General Configuration<a href="#general-configuration" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Here are some general features that did not really fit into a separate
category, but that I wanted to highlight nonetheless.</p>
<p>The first is that aerc supports signatures. Hardly a surprising or
groundbreaking feature for an email client, but nice nonetheless. Signatures
are just text files that can be included for each account with
<code>signature-file=</code>. Alternatively, aerc can also execute an external command to
create a signature.</p>
<p>Aerc also supports email templates. I haven’t looked at those in detail yet,
but it seems like a nice feature.</p>
<p>It also tries to intelligently remove repetitions of ‘Re:’ prefixes in email
headers (in multiple languages). To accomplish this, it uses a regex that can
be optionally overwritten or extended.</p>
<p>Two other nice (but kinda default) features of aerc are its forget subject and
attachment reminder. The first just checks if the subject is empty, but the
second one is actually quite clever, and very easily extensible: it’s just a
regex! Specifically, this one:</p>
<div><pre tabindex="0"><code data-lang="re"><span><span><span>^</span><span>[</span><span>^&gt;</span><span>]*</span><span>attach</span><span>(</span><span>ed</span><span>|</span><span>ment</span><span>)</span>
</span></span></code></pre></div><p>This does several smart things, one of them is filtering the line out if it
begins with a ‘&gt;’ (which would mean that someone else mentioned an attachment,
not you). Because I also write a lot of emails in German, I decided to extend
this regex so it also works in German (NB: the regex is case-insensitive and
multi-line by default):</p>
<div><pre tabindex="0"><code data-lang="re"><span><span><span>^</span><span>[</span><span>^&gt;</span><span>]*(</span><span>attach</span><span>(</span><span>ed</span><span>|</span><span>ment</span><span>))|</span><span>an</span><span>(</span><span>ge</span><span>)?</span><span>h</span><span>[</span><span>aä</span><span>]</span><span>ngt</span><span>?</span>
</span></span></code></pre></div><p>All in all, I’ve really enjoyed using aerc over the last few days. It seems
really polished and it is a pleasure to use. I think I’ll
stick with this email client for a while longer and see how it goes.</p>

			</div></div>
  </body>
</html>
