<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/utdemir/nixlisp">Original</a>
    <h1>Nix-Lisp: A Lisp implementation written in Nix</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">A lisp implementation written in Nix.</p>
<h2 dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h2>
<ul dir="auto">
<li>No IFD. Just plain Nix.</li>
<li>Macros (non-hygienic)</li>
<li>Nix interop
<ul dir="auto">
<li>Shares most of its data types with Nix</li>
<li>Contains syntax support and helpers to use Nix lists and attrsets</li>
<li>Can call Nix functions seamlessly</li>
<li>Can export functions that can be called from Nix</li>
</ul>
</li>
</ul>
<h3 dir="auto"><a id="user-content-example" aria-hidden="true" href="#example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Example</h3>
<div dir="auto" data-snippet-clipboard-copy-content="(import ./default.nix).eval {} &#39;&#39;
  (define nixpkgs
    (fetchTarball
       &#39;url &#34;https://github.com/nixos/nixpkgs/archive/a39ee95a86b1fbdfa9edd65f3810b23d82457241.tar.gz&#34;
       &#39;sha256 &#34;11sk5hz51189g6a5ahq3s1y65145ra8kcgzfjkmrjp1jzn7h68q8&#34;))
  (define pkgs (import nixpkgs (attrs)))

  ((pkgs &#39;haskellPackages &#39;ghcWithPackages)
      (lambda (ps) (vector (ps &#39;relude) (ps &#39;pipes))))
  &#39;&#39;"><pre>(import ./default.nix).eval {} <span>&#39;<span>&#39;</span></span>
  (<span>define</span> <span>nixpkgs</span>
    (fetchTarball
       <span>&#39;url</span> <span><span>&#34;</span>https://github.com/nixos/nixpkgs/archive/a39ee95a86b1fbdfa9edd65f3810b23d82457241.tar.gz<span>&#34;</span></span>
       <span>&#39;sha256</span> <span><span>&#34;</span>11sk5hz51189g6a5ahq3s1y65145ra8kcgzfjkmrjp1jzn7h68q8<span>&#34;</span></span>))
  (<span>define</span> <span>pkgs</span> (import nixpkgs (attrs)))

  ((pkgs <span>&#39;haskellPackages</span> <span>&#39;ghcWithPackages</span>)
      (<span>lambda</span> (<span>ps</span>) (vector (ps <span>&#39;relude</span>) (ps <span>&#39;pipes</span>))))
  <span>&#39;<span>&#39;</span></span></pre></div>
<h2 dir="auto"><a id="user-content-current-state" aria-hidden="true" href="#current-state"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Current state</h2>
<p dir="auto">It&#39;s kinda-sorta working. It can use Nix values and call Nix functions. It is probably not very performant, and is easy to hit the stack limit. There standard library is pretty minimal, but since it&#39;s easy to use Nix builtins and nixpkgs functions, I do not expect it to be
the biggest problem. PR&#39;s very welcome.</p>
<h2 dir="auto"><a id="user-content-docs" aria-hidden="true" href="#docs"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Docs</h2>
<h3 dir="auto"><a id="user-content-standard-library" aria-hidden="true" href="#standard-library"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Standard library</h3>
<p dir="auto">See <a href="https://github.com/utdemir/nixlisp/blob/main/stdlib.nixlisp">stdlib.nixlisp</a>. It is also the best place look for examples.</p>
<h3 dir="auto"><a id="user-content-defining-a-function" aria-hidden="true" href="#defining-a-function"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Defining a function</h3>
<div dir="auto" data-snippet-clipboard-copy-content="(defun myDouble (x) 
  (define two 2)
  (+ x two))"><pre>(defun myDouble (x) 
  (<span>define</span> <span>two</span> 2)
  (<span>+</span> x two))</pre></div>
<p dir="auto"><code>defun</code> is a macro; the above function expands to:</p>
<div dir="auto" data-snippet-clipboard-copy-content="(define myDouble (lambda (x) 
  (begin
    (define two 2)
    (+ x two))))"><pre>(<span>define</span> <span>myDouble</span> (<span>lambda</span> (<span>x</span>) 
  (<span>begin</span>
    (<span>define</span> <span>two</span> 2)
    (<span>+</span> x two))))</pre></div>
<h3 dir="auto"><a id="user-content-defining-a-macro" aria-hidden="true" href="#defining-a-macro"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Defining a macro</h3>
<div dir="auto" data-snippet-clipboard-copy-content="(defmacro cond args
  (defun go (xs)
    (if
      (nil? xs) &#39;nil
      (begin
        (define clause (car xs))
        (define condition (car clause))
        (define value (car (cdr clause)))
        (list &#39;if condition value (go (cdr xs))))))
  (go args))"><pre>(defmacro <span>cond</span> args
  (defun go (xs)
    (<span>if</span>
      (nil? xs) <span>&#39;nil</span>
      (<span>begin</span>
        (<span>define</span> <span>clause</span> (<span>car</span> xs))
        (<span>define</span> <span>condition</span> (<span>car</span> clause))
        (<span>define</span> <span>value</span> (<span>car</span> (<span>cdr</span> clause)))
        (<span>list</span> <span>&#39;if</span> condition value (go (<span>cdr</span> xs))))))
  (go args))</pre></div>
<h3 dir="auto"><a id="user-content-defining-an-attribute-set" aria-hidden="true" href="#defining-an-attribute-set"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Defining an attribute set</h3>
<div dir="auto" data-snippet-clipboard-copy-content="(attrs
  &#39;firstKey &#34;foo&#34;
  &#39;anotherKey 12
  &#39;yetAnotherKey (vector 1 2 3))"><pre>(attrs
  <span>&#39;firstKey</span> <span><span>&#34;</span>foo<span>&#34;</span></span>
  <span>&#39;anotherKey</span> <span>12</span>
  <span>&#39;yetAnotherKey</span> (vector <span>1</span> <span>2</span> <span>3</span>))</pre></div>
<h3 dir="auto"><a id="user-content-types" aria-hidden="true" href="#types"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Types</h3>
<table>
<thead>
<tr>
<th>Nix</th>
<th>Nixlisp</th>
</tr>
</thead>
<tbody>
<tr>
<td>int</td>
<td>int</td>
</tr>
<tr>
<td>string</td>
<td>string</td>
</tr>
<tr>
<td>bool</td>
<td>bool</td>
</tr>
<tr>
<td>null</td>
<td>nil</td>
</tr>
<tr>
<td>function</td>
<td>nix-function</td>
</tr>
<tr>
<td>attrs</td>
<td>attrs</td>
</tr>
<tr>
<td>list</td>
<td>vector</td>
</tr>
<tr>
<td>-</td>
<td>lambda</td>
</tr>
<tr>
<td>-</td>
<td>symbol</td>
</tr>
<tr>
<td>-</td>
<td>cons</td>
</tr>
<tr>
<td>-</td>
<td>macro</td>
</tr>
<tr>
<td>float</td>
<td>(not implemented yet)</td>
</tr>
<tr>
<td>path</td>
<td>(not implemented yet)</td>
</tr>
</tbody>
</table>
<h4 dir="auto"><a id="user-content-nix-compatibility" aria-hidden="true" href="#nix-compatibility"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Nix compatibility</h4>
<ul dir="auto">
<li>Types that are unique to Nixlisp are implemented as attribute sets with a special tag on Nix side. They are not meant to be accessed, but you can pass them back to Nixlisp.</li>
<li>Nixlisp lambda&#39;s can be called as normal functions from the Nix side, but they have to have at least one named parameter, and can not have
variable numbero of arguments. Macros can not be called from Nix.</li>
<li>nix-function&#39;s can be called just as lambda&#39;s within Nixlisp. Since they are curried by default, all of the parameters will be passed to them
one after another.</li>
<li>Attribute sets behave like functions, where you can pass them strings or symbols and they can do a lookup.</li>
<li>Beware that a Nixlisp &#34;list&#34; (a nil-terminated cons-list) is not a Nix &#34;list&#34;. A Nix list is called a &#34;vector&#34;, and you can use the <code>vector</code>, or <code>list-&gt;vector</code> functions to construct them.</li>
</ul>
<h2 dir="auto"><a id="user-content-thanks" aria-hidden="true" href="#thanks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Thanks</h2>
<ul dir="auto">
<li><a href="https://github.com/nprindle/nix-parsec">nprindle/nix-parsec</a></li>
</ul>
</article>
          </div></div>
  </body>
</html>
