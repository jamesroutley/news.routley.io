<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://16years.secvuln.info/">Original</a>
    <h1>16 years of CVE-2008-0166 – Debian OpenSSL Bug</h1>
    
    <div id="readability-page-1" class="page"><section>
<h3>DKIM keys vulnerable to Debian OpenSSL bug</h3>
<p>DKIM is a mechanism that allows sending mail servers to sign emails with a cryptographic
key published via a DNS TXT record.</p>
<p>By scanning DKIM keys with my tool <a href="https://badkeys.info/">badkeys</a>,
I discovered a surprisingly large number of hosts vulnerable to the 2008 Debian
OpenSSL bug. This trivially allowed sending emails with forged DKIM signatures for those
hosts and thereby also passing DMARC checks.</p>
<p>The hosts included notable names like <em>@cisco.com</em>, <em>@oracle.com</em>,
<em>@skype.net</em>, <em>@github.partners</em>, <em>@partner.crowdstrike.com</em>,
and <em>@seznam.cz</em> (unfixed).
</p>
<h3>How many keys were vulnerable?</h3>
<p>By scanning the Tranco Top 1 Million list, I collected 355,055 TXT records
with a valid RSA key. Ed25519 keys
were only found in negligible numbers (to be precise, two). DKIM does not support
other key types.</p>
<p>Of the records with RSA keys, 855 were vulnerable to CVE-2008-0166 - around 0.24 %.
777 records contained identical keys. Overall, there were 22 unique vulnerable
keys.</p>
<p>I found 21 additional records with vulnerable keys through other methods.
(Details about the <a href="https://16years.secvuln.info/scandkim.html">scanning methodology can be found here</a>.)
</p>
<h3>Most keys came from one company</h3>
<p>Most records in the large set of 777 identical keys
were configured as a CNAME to a host belonging to
the company Cakemail.</p>
<p>I tried disclosing this issue to Cakemail.
The affected host has
a <a href="https://md02.com/.well-known/security.txt" rel="nofollow">security.txt</a>
file with a security contact address (<em>security@cakemail.com</em>) and a link to a PGP
key that does not work (404 error).</p>
<p>After trying to contact
<em>security@cakemail.com</em>, I got this error message:
<em>&#34;We&#39;re writing to let you know that the group you tried to contact (security) may not exist, or you may not have permission to post messages to the group.&#34;</em>
</p>
<p>Therefore, I did not directly communicate with Cakemail, but they appear to have replaced
their DKIM key. I have disclosed this
issue to many affected organizations. Some have probably contacted Cakemail.</p>
<h3>Why are people using keys with a vulnerability from 2008 in 2024?</h3>
<p>I can only speculate, but it may have to do with timing.
The Debian OpenSSL bug was introduced in 2006. It was discovered and fixed in 2008.
The DKIM specification was published as <a href="https://datatracker.ietf.org/doc/html/rfc4871">RFC 4871</a> in 2007.</p>
<p>DKIM has no requirement to rotate keys. It appears that a sizeable number of companies
configured DKIM TXT records in 2007 and never changed them.</p>
<h3>Why is seznam.cz listed as unfixed?</h3>
<p>The security team at Seznam - a Czech search engine and email provider -
did not believe me when I reported this issue.
They assume that as they are not actively using that key
(<em>beta._domainkey.seznam.cz</em>), that means that it cannot be used to forge emails.
This is, of course, not true.</p>

<h3>Any other disclosure stories?</h3>
<p>While disclosing this issue, I had plenty of bad experiences
with bug bounty programs. In multiple instances, triagers showed
incompetent or highly problematic behavior. I am still in the process of trying
to clarify some issues, I may share some stories at a later point in time.</p>

<h3>Did you find any other vulnerabilities?</h3>
<p>I found some RSA keys with very short key sizes, some with 512 bits, some even
smaller. Those can be broken on consumer hardware these days. I have not looked closer into
this.</p>
<p>I also found some unparseable or defective keys. I have not found any other
interesting vulnerabilities.</p>
<p>Generally, large parts of the DKIM ecosystem use substandard cryptographic security.
The majority of DKIM keys use RSA with 1024 bits. The standard recommendation for RSA keys is
to use a minimum key size of 2048 bit. While it has been assumed that powerful
attackers may be able to break 1024-bit RSA for more than 20 years,
such attacks have not been publicly documented.</p>

<h3>How can I check if my DKIM keys are affected by this vulnerability?</h3>
<p>The latest version of badkeys allows you to scan DKIM keys directly.
badkeys is a Python tool that can be <a href="https://pypi.org/project/badkeys/">installed via pip</a>.</p>
<p>With the parameter <em>--dkim</em>, it checks DKIM records in text files. It supports common
formats like DNS zone files or the output from tools like dig or host:</p>
<pre><span>$ </span><span>badkeys -aw --dkim example.org.zone</span>
rsa[2048] key ok, example.org.zone[12]</pre>
<p>The <em>-a</em> parameter shows all keys found, not
just vulnerable ones.
The <em>-w</em> parameter enables warnings about insecure or discouraged key
sizes and exponent values.</p>
<p>badkeys can also directly scan DKIM TXT records with the parameter <em>--dkim-dns</em>:</p>
<pre><span>$ </span><span>badkeys -aw --dkim-dns 20230601._domainkey.gmail.com dkim._domainkey.entrust.com</span>
rsa[2048] key ok, 20230601._domainkey.gmail.com
blocklist/debianssl vulnerability, rsa[1024], dkim._domainkey.entrust.com
rsawarnings/too_small vulnerability, rsa[1024], dkim._domainkey.entrust.com</pre>
<p>Obvious caveat: a tool like badkeys can
never find all possible vulnerabilities or compromised keys.</p>

<h3>What is BIMI?</h3>
<p>It is a moneymaking scheme invented by certificate authorities.</p>

<h3>What is BIMI, really?</h3>
<p>BIMI allows publishing a logo in SVG format that some email services will display
alongside your emails. While not strictly required by the specification,
usually, that will only happen if you also buy an expensive certificate (so-called
Verified Mark Certificate) that asserts that this is your logo.</p>
<p>Those certificates are very expensive (above $1,000 per year).</p>
<p>Here&#39;s a Gmail screenshot showing some logos:</p>
<img src="https://16years.secvuln.info/gmailscreenshot.avif" alt="Gmail screenshot" width="500" height="350"/>
<h3>What does BIMI have to do with this vulnerability?</h3>
<p>While testing to send DKIM-signed emails, I noticed
that some would show a company logo in Gmail.</p>
<p>BIMI is designed in a way that when you publish a default BIMI
record, all DKIM-signed emails will automatically get BIMI treatment and show a logo.
In some cases, I only controlled the DKIM key of a subdomain, but even then,
the BIMI logo configured for the main domain is shown automatically.</p>

<h3>Wait, haven&#39;t you just said that I need an expensive certificate?
Doesn&#39;t that mean that there needs to be some signature involved from that certificate?</h3>
<p>No, and I was very surprised by this.</p>
<p>The <a href="https://www.ietf.org/archive/id/draft-brand-indicators-for-message-identification-05.html">BIMI spec</a>
is written in a way that there is no cryptographic connection
between the certificate and the DKIM key. As soon as one is able to sign a mail with DKIM,
it passes BIMI.</p>
<p>While BIMI certificates are standard X.509 certificates that contain a cryptographic
key, that key is not used at all.</p>
<p>Certificate authorities in other areas, e.g., in the WebPKI,
are required to guarantee some basic security checking of cryptographic keys, disallow
short RSA keys, and revoke known-compromised keys. No such mechanisms exist for BIMI
and DKIM.
</p>
<h3>Can you explain this with an example?</h3>
<p>Sure. Let&#39;s take the domain <em>entrust.com</em>. It has a DKIM TXT record configured
at <em>dkim._domainkey.entrust.com</em>:</p>
<pre>v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCyGF0xzO7Eig1H8QdIErjEKOGnIVvoLU5VjcMRBRWZK65NinL+gVnjuMD2mYdjC3f+7sQCWxGDSKIFn/bB+iXxO2x1/ktkwXHQfQ/9FcFuy+LE0Snsm0SwXN/2l1m5f9e1xdswC+dzHt6DIpDSDENsRal019YKQTqwVyB++7QORwIDAQAB</pre>
<p>This is a 1024-bit RSA key generated with a version of Debian vulnerable to
CVE-2008-0166. We can use badkeys to figure out that
the <a href="https://github.com/badkeys/debianopenssl/blob/main/rsa1024/ssl/le32/25731-rnd.key">private key is this one</a>:</p>
<pre>-----BEGIN RSA PRIVATE KEY-----
MIICWwIBAAKBgQCyGF0xzO7Eig1H8QdIErjEKOGnIVvoLU5VjcMRBRWZK65NinL+
gVnjuMD2mYdjC3f+7sQCWxGDSKIFn/bB+iXxO2x1/ktkwXHQfQ/9FcFuy+LE0Sns
m0SwXN/2l1m5f9e1xdswC+dzHt6DIpDSDENsRal019YKQTqwVyB++7QORwIDAQAB
AoGAH7zFxt0tY6ryaPKkCI0Fjjd21xDTzxFb11U3AO52BeDJ5BmbGo20lidTg96i
SN0/Whf0qDLQcSPdc8Eo+TJ51jIbLPdy16Rn7cPPJzUDIzJPas4ewkI7lsU37hlC
cr7T521l8g6w/mS2TtTZykpsHvb0tztjQuElS7TxWUuVuskCQQDmrvjJU3u9CMkb
3avhUAXlsK4nboo8GTPt4Ss9O2/ipTx3K+qtAfHM7HiZie3iYwxCKQQ3MdMlmh/N
fPR/rTS9AkEAxaPt3EN8wB4w95FAQd9J338n1hXF0lE7UH1aBemuIbWXgY1UTlL4
X1Kx7rLeuQv8mzFkuQyXSFbq7eBXSBOZUwJACKxLbkZVQKYz6XhMHgyELD6YTaM6
T0gjS65LkeHKMxtDSre7+wU3shyx7BPjfb97loE0R174MVG6IF+yUZqRgQJALhtt
LTqNSuCAOfEn1XY67KnkaDxSFxueQ8vKiaCXYAPWIYIQDemrScmn+vC9ptvWBXqD
bewzCsxEKFRy6DyyQwJAGVyC2vMIL7aeMhB+V9YVDZJlV3MEGCYmbF84ZtLhSWTX
QfUe81qGdL3IBMRqz2GnSS0y7qPN/8CP5W9cKy8aDg==
-----END RSA PRIVATE KEY-----</pre>
<p>We can use a tool like <a href="https://manpages.ubuntu.com/manpages/trusty/man1/dkimsign.1.html">dkimsign</a> (part of <a href="https://pypi.org/project/dkimpy/">dkimpy</a>)
to sign a mail with a sender using
an <em>@entrust.com</em> mail address:</p>
<pre><span>$ </span><span>dkimsign dkim entrust.com 25731-rnd.key &lt; unsigned.txt &gt; signed.txt</span></pre>
<p>You can find a <a href="https://16years.secvuln.info/testmail.msg">signed test mail here</a>.</p>
<p><em>entrust.com</em> has a BIMI default record configured at <em>default._bimi.entrust.com</em>.
Therefore, all DKIM-signed emails automatically get BIMI treatment.
The record looks like this:</p>
<pre>v=BIMI1;l=https://bimi.entrust.net/entrust.com/logo.svg;a=https://bimi.entrust.net/entrust.com/certchain.pem</pre>
<p>The URLs point to a logo in SVG format (<em>l=</em>)
and a corresponding certificate (<em>a=</em>).</p>
<p>A BIMI-supporting email service receiving an email with a valid DKIM signature for <em>entrust.com</em> - which
we can generate, as we have the private key - will show a BIMI logo.</p>
<p>By the way, have I mentioned that Entrust is one of only two companies that sell
BIMI certificates?</p>

<h3>Any other security problems with BIMI?</h3>
<p>Yes, after learning about this, I started reading the specification. It is extremely
weird and has
<a href="https://mailarchive.ietf.org/arch/msg/bimi/PS8Xf1hQ41oCAwtsUvVsbRSs34Q/">obvious security design flaws</a>.
It does &#34;trustworthy&#34; things like explaining
that certain things (that are crucial for a secure implementation) are explained
<em>&#34;elsewhere&#34;</em> or <em>&#34;in other documents&#34;</em> - without revealing
where <em>&#34;elsewhere&#34;</em> is or where to
find these <em>&#34;other documents&#34;</em>.</p>

<h3>I am an email provider. Should I implement BIMI?</h3>
<p>No.</p>

<h3>I develop an email client. Should I implement BIMI?</h3>
<p>It is impossible to implement BIMI in mail user agents in a secure way based on its specification.
You need additional security measures that are explained
<em>&#34;elsewhere&#34;</em> and <em>&#34;in other documents&#34;</em>.</p>

<h3>I am developing a mail server. What should I do about BIMI?</h3>
<p>You could implement BIMI troll mode by inserting a logo &#34;say no to BIMI&#34;
into emails with BIMI records configured.</p>

<h3>Wait, that works? What about the certificates and all that?</h3>
<p>It would work in any MUA that implements the current version of
the BIMI specification. However, I am not aware of any that do.</p>
<p>According to the specification, the mail server checks the certificate and sets
those headers. The MUA
should trust the MTA based on <em>&#34;locally defined checks</em>&#34;. It is not explained what that
means. (Possibly, that explanation is <em>&#34;elsewhere&#34;</em>
or <em>&#34;in other documents&#34;</em>.)</p>


<h3>Why have you created a logo for this vulnerability?</h3>
<p>I haven&#39;t. It is
<a href="https://www.svgrepo.com/svg/41964/confetti">a free icon (CC0) from SVG Repo</a>.</p>

<h3>Anything else?</h3>

<p>If you need help with email security, DKIM, or cryptography,
<a href="https://itsec.hboeck.de/">you can find more information and reach me here</a>.</p>

<p>These days, I spend a lot less time working on IT security. Most of my time, I try
to understand the technologies we need to fix the climate crisis and create hopefully
insightful and well-researched content. If that sounds interesting to you, you can
<a href="https://industrydecarbonization.com/">you can read some articles here</a> and
<a href="https://industrydecarbonization.com/subscribe.html">subscribe to my newsletter</a>.</p>

<p><a href="https://hboeck.de/">Hanno Böck</a></p>


</section></div>
  </body>
</html>
