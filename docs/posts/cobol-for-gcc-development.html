<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://cobolworx.com/pages/cobforgcc.html">Original</a>
    <h1>COBOL for GCC Development</h1>
    
    <div id="readability-page-1" class="page"><article>
    <section id="content">

    
        <p>COBOLworx is developing a COBOL front end for the GCC Gnu Compiler
Collection. GCOBOL is very much still under development, but it has
reached a point where interested users can experiment with it.</p>
<p>We are also working on a version of GDB – the GNU Debugger – that has
the capability of working with GCOBOL.</p>
<h2 id="installation-package-for-the-gcobol-compiler">Installation
package for the GCOBOL compiler</h2>
<p>We have a Debian installation package for the GCOBOL compiler that is
known to install properly on a Debian-11 distribution and on an
Ubuntu-22.04 distribution You can download the latest experimental
package for the compiler <a href="https://cobolworx.com/pages/downloads/gcobol-13_13.0.15_x86_64.deb">here</a>.
These are considered “Checkpoint” packages and are best most uses.</p>
<p>Install the downloaded file with
<code>sudo apt install ./gcobol-13_13.0.15_x86_64.deb</code>. That
installs the executable as <code>/usr/bin/gcobol</code> and moves the
necessary libraries into place.</p>
<p>For those wanting to upgrade more frequently, to be closer to the
current state of development, packages are built automatically for each
commit. See <a href="https://gitlab.cobolworx.com/COBOLworx/gcc-cobol/-/packages/2">our
private registry</a> for recent activity. These are not for the easily
frustrated or faint of heart (<em>win</em>). They are downloaded by
right-click and installed like the experimental packages.</p>
<h2 id="using-cobol-for-gcc">Using COBOL for GCC</h2>
<p>Because it is part of the GCC family, GCOBOL works very much like the
<code>gcc</code> compiler.</p>
<p>Compile a COBOL program like this:</p>
<pre><code>gcobol -o hello hello.cbl</code></pre>
<p>and then run the resulting executable with <code>./hello</code></p>
<h2 id="installation-packages-for-the-matching-gdb-cobol-debugger">Installation
packages for the matching GDB-COBOL debugger</h2>
<p>We are creating a version of the GDB debugger that can trap through
code generated by the GCOBOL compiler and display the contents of COBOL
variables using GDB’s <code>print</code> command. The debugger is in the
very early stages of development. Reports of missing features,
unexpected behavior, and problems – it’s too soon to call them “bugs” –
will be gratefully accepted.</p>
<p>Because Python3 is important to GDB, the executable links to the
system’s libpython shared library. In order to make sure gdb-cobol
executable links with the correct python library, we have separate
installation packages for Ubuntu-20.04 (Python3.8), Ubuntu-22.04
(Python3.10), and Debian-11 (Python3.9)</p>
<p><a href="https://cobolworx.com/pages/downloads/gdb-cobol-14_14.0.3_ubuntu20_x86_64.deb">GDB-COBOL
for Ubuntu 20.04</a></p>
<p><a href="https://cobolworx.com/pages/downloads/gdb-cobol-14_14.0.6_ubuntu22_x86_64.deb">GDB-COBOL
for Ubuntu 22.04</a></p>
<p><a href="https://cobolworx.com/pages/downloads/gdb-cobol-14_14.0.3_debian11_x86_64.deb">GDB-COBOL
for Debian 11</a></p>
<p>Depending on the version downloaded, install the downloaded file with
one of</p>
<pre><code>sudo apt install ./gdb-cobol-14_14.0.3_ubuntu20_x86_64.deb
sudo apt install ./gdb-cobol-14_14.0.6_ubuntu22_x86_64.deb
sudo apt install ./gdb-cobol-14_14.0.3_debian11_x86_64.deb</code></pre>
<p>The executable file is installed as <code>/usr/bin/gdb-cobol</code>
and is invoked with the <code>gdb-cobol</code> command. It is a
full-functioned version of GDB based on the current “bleeding edge”
development branch at
<code>https://sourceware.org/git/binutils-gdb.git</code>. We give it the
name <code>gdb-cobol</code> to avoid interfering with the distribution
<code>/usr/bin/gdb</code> that you very likely already have on your own
system.</p>
<p>Things to try:</p>
<pre><code>`break &lt;line number&gt;`
`break &lt;program-id&gt;`
`print &lt;variable&gt;`
`print/p &lt;variable&gt;`
`print/r &lt;variable&gt;`
`print &lt;variable&gt;=&lt;new value&gt;`
`print &lt;table_name&gt;(&lt;subscript&gt;)`
`print &lt;variable&gt;(&lt;start&gt;:&lt;length&gt;)`</code></pre>
<h2 id="source-code">Source Code</h2>
<p>The source code for the compiler is available at
<code>https://gitlab.cobolworx.com/COBOLworx/gcc-cobol.git</code> That
repository is public; you should be able to clone it.</p>
<p>As mentioned, this project is very much under development. We are
trying to make sure that the <code>master+cobol</code> branch of the
repository compiles and runs, but as it is the active development
branch, there can be no guarantees. The <code>relcan</code> branch is
intended to be more stable.</p>
<p>We plan to make tarballs of the source code available soon, but for
now your best bet is to clone the repository.</p>
<h2 id="configuration-considerations">Configuration considerations</h2>
<p>These prerequisites should suffice to compile GCOBOL on Debian and
Ubuntu systems:</p>
<pre><code>sudo apt install -y git g++ make m4 flex \
libgmp-dev libmpfr-dev libmpc-dev libz-dev</code></pre>
<p>You will also need <code>bison</code>, but it has to be version 3.8
or later. On Ubuntu 22.04 LTS, <code>sudo apt install bison</code>
installs BISON-3.8</p>
<p>But on Debian-11, the same command installs BISON-3.7.5, which
doesn’t do the job.</p>
<p>On a Debian-11 system, this worked:</p>
<pre><code>cd~
mkdir -p builds
cd builds
wget https://ftp.gnu.org/gnu/bison/bison-3.8.2.tar.xz
tar -xvf bison-3.8.2.tar.xz
cd bison-3.8.2
mkdir build
cd build
../configure --prefix=/usr/local
make
sudo make install</code></pre>
<p>That reflects certain prejudices and practices with regards to where
to put things and how to build them. In particular, it’s usually safer
to avoid putting things into <code>/usr/bin</code> on systems where a
package manager expects to be in charge. Hence the prefix
<code>/usr/local</code></p>
<p>This script is known to work on Debian-11 and Ubuntu-22.04</p>
<pre><code>cd ~
mkdir repos
cd repos
git clone https://gitlab.cobolworx.com/COBOLworx/gcc-cobol.git
cd gcc-cobol
git checkout relcan
mkdir builds
cd builds
../configure \
--enable-languages=c,c++,cobol \
--prefix=/usr/local \
--with-gcc-major-version-only \
--program-suffix=-13 \
--enable-shared \
--enable-linker-build-id \
--without-included-gettext \
--enable-threads=posix \
--disable-bootstrap \
--enable-clocale=gnu \
--enable-libstdcxx-debug \
--enable-libstdcxx-time=yes \
--with-default-libstdcxx-abi=new \
--enable-gnu-unique-object \
--disable-vtable-verify \
--enable-plugin \
--enable-default-pie \
--with-system-zlib \
--with-target-system-zlib=auto \
--disable-werror \
--disable-cet \
--with-abi=m64 \
--disable-multilib \
--with-tune=generic \
--without-cuda-driver \
--enable-checking=release \
--build=x86_64-linux-gnu \
--host=x86_64-linux-gnu \
--target=x86_64-linux-gnu \
--with-build-config=bootstrap-lto-lean \
--enable-link-mutex
make
sudo make install</code></pre>
<p>Because this is a manual build into <code>/usr/local</code>, there
are shared library files that need to be moved into place so that the
system can find them when the executable created with GCOBOL runs. (We
haven’t yet modified the GCC <code>make install</code> to know about
these shared libraries.)</p>
<pre><code>sudo cp -d /usr/local/lib64/libgcobol* /usr/local/lib/
sudo ldconfig</code></pre>
<p>At this point you’ll be able to compile a cobol file and run the
resulting a.out executable:</p>
<pre><code>cd ~/repos/gcc-cobol/gcc/cobol/tests/check_88
gcobol-13 check_88.cbl
./a.out</code></pre>
<h2 id="what-are-we-developing">What are we developing?</h2>
<p>The GCC architecture consists of a “front end” for each language;
there is a front end for C, another for FORTRAN, yet another for ADA,
and so on. Each front end parses the source code and passes the decoded
intent of the programmer to a “code generator” that converts each
instruction to an intermediate form known as GIMPLE. The intermediate
form is fed into the GCC optimizer and from there to the assembly
language generator.</p>
<p>We are developing a COBOL front end for GCC. It takes COBOL source
code as input, parses it and generates the GIMPLE tree. The COBOL front
end is incorporated into GCC and becomes an executable named
<code>gcobol</code>, which is used to compile COBOL source code files.
Because <code>gcobol</code> is part of GCC, the output can be .o object
files, .so shared objects, or executable binaries.</p>
<h2 id="the-developers">The Developers</h2>
<p>The primary development team:</p>
<p><a href="mailto:mheyman@symas.com">Marty Heyman</a> is the team
leader. He is the subject matter expert for COBOL and its uses, and is
the orchestrator of our business plans.</p>
<p><a href="mailto:jklowden@symas.com">James K. Lowden</a> is
responsible for the non-trivial effort of parsing COBOL source code.
COBOL was originally created around 1958, and computer science has
learned a lot about compilation in general, and context-free grammars in
specific, since then. Coping with a language intentionally designed to
be “…like English…” from that era is an “interesting” project.</p>
<p><a href="mailto:rdubner@dubner.com">Robert Dubner</a> is responsible
for code generation. Code generation is also an “interesting” project,
mainly because so few people have occasion to generate GIMPLE that there
is little documentation, and less guidance, for <em>how</em> to do it.
Mr. Dubner suspects he is the latest in a line of front end developers
forced to reverse engineer what came before in order to do it at
all.</p>
    </section>
</article></div>
  </body>
</html>
