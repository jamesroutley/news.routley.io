<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/dsekz/chrome-x-browser-validation-header">Original</a>
    <h1>Chrome&#39;s hidden X-Browser-Validation header reverse engineered</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Chrome recently added a few new headers:</p>
<div data-snippet-clipboard-copy-content="&#34;x-browser-channel&#34;: &#34;stable&#34;,
&#34;x-browser-copyright&#34;: &#34;Copyright 2025 Google LLC. All rights reserved.&#34;,
&#34;x-browser-validation&#34;: &#34;6h3XF8YcD8syi2FF2BbuE2KllQo=&#34;,
&#34;x-browser-year&#34;: &#34;2025&#34;"><pre><code>&#34;x-browser-channel&#34;: &#34;stable&#34;,
&#34;x-browser-copyright&#34;: &#34;Copyright 2025 Google LLC. All rights reserved.&#34;,
&#34;x-browser-validation&#34;: &#34;6h3XF8YcD8syi2FF2BbuE2KllQo=&#34;,
&#34;x-browser-year&#34;: &#34;2025&#34;
</code></pre></div>
<p dir="auto">Apart from one of them, there isn’t much that’s interesting. They’re just bits of client specific information. However, base64 decoding x-browser-validation yields what appears to be a hash whose purpose remains undocumented.</p>
<p dir="auto">Chrome almost certainly uses this header as an integrity signal. Verifying that the declared user agent matches the underlying platform, spotting user agent string spoofing attempts etc.</p>
<hr/>

<div dir="auto" data-snippet-clipboard-copy-content="from xbv import generate_validation_header


ua = &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36&#34;

# You may supply an explicit api_key alongside the ua
# if omitted, the function automatically selects the appropriate key based on the user agent
api_key = &#34;AIzaSyA2KlwBX3mkFo30om9LUFYQhpqLoa_BNhE&#34;

header_value = generate_validation_header(ua)

print(header_value)"><pre><span>from</span> <span>xbv</span> <span>import</span> <span>generate_validation_header</span>


<span>ua</span> <span>=</span> <span>&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36&#34;</span>

<span># You may supply an explicit api_key alongside the ua</span>
<span># if omitted, the function automatically selects the appropriate key based on the user agent</span>
<span>api_key</span> <span>=</span> <span>&#34;AIzaSyA2KlwBX3mkFo30om9LUFYQhpqLoa_BNhE&#34;</span>

<span>header_value</span> <span>=</span> <span>generate_validation_header</span>(<span>ua</span>)

<span>print</span>(<span>header_value</span>)</pre></div>
<hr/>

<ol dir="auto">
<li>
<p dir="auto"><strong>Grab two strings</strong></p>
<ul dir="auto">
<li>A hard-coded, platform specific API key</li>
<li>The browser’s full user agent string</li>
</ul>
</li>
<li>
<p dir="auto"><strong>Concatenate</strong></p>
<div data-snippet-clipboard-copy-content="DATA = API_KEY + USER_AGENT"><pre><code>DATA = API_KEY + USER_AGENT
</code></pre></div>
</li>
<li>
<p dir="auto"><strong>Hash</strong> <code>DATA</code> with SHA-1 and base64 encode it.</p>
</li>
</ol>
<hr/>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Platform</th>
<th>Default Key (found in Chrome binaries)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Windows</td>
<td><code>AIzaSyA2KlwBX3mkFo30om9LUFYQhpqLoa_BNhE</code></td>
</tr>
<tr>
<td>Linux</td>
<td><code>AIzaSyBqJZh-7pA44blAaAkH6490hUFOwX0KCYM</code></td>
</tr>
<tr>
<td>macOS</td>
<td><code>AIzaSyDr2UxVnv_U85AbhhY8XSHSIavUW0DC-sY</code></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<hr/>

<p dir="auto">Opened <code>chrome.dll</code> in IDA. The master routine <code>sub_1806C95B0</code> builds every <code>X-Browser-*</code> header (you can find this function by searching <code>browser-validation</code> etc):</p>
<ul dir="auto">
<li>
<p dir="auto">Data prep - grabs the first hard-coded API key for the OS and appends the full user agent.</p>
<div dir="auto" data-snippet-clipboard-copy-content="__int64 __fastcall sub_1806C95B0(__int64 a1, __int64 a2)
{
    // ... setup ...

    // Data Preparation
    // Retrieves credentials and combines the API key and user agent into a buffer.
    v7 = sub_1806C9B30();
    v9 = sub_183EBC7D0(v41, 0LL, v7, v8);

    // ... more setup ...

    // Hashing
    // The call to the SHA-1 hashing function.
    sub_183B509D0(v46, v38);

    // ... more setup ...
    
    // Encoding
    // The call to the Base64 encoding function.
    sub_1806C9A80((__int64 *)v40, v39);

    // ... more setup ...

    // Header Setting
    // Adds the final encoded string to the request headers.
    v30 = &#34;X-Browser-Validation&#34;;
    sub_183C6B920(v27);
    
    // ...
}"><pre><span>__int64</span> __fastcall <span>sub_1806C95B0</span>(<span>__int64</span> <span>a1</span>, <span>__int64</span> <span>a2</span>)
{
    <span>// ... setup ...</span>

    <span>// Data Preparation</span>
    <span>// Retrieves credentials and combines the API key and user agent into a buffer.</span>
    <span>v7</span> <span>=</span> <span>sub_1806C9B30</span>();
    <span>v9</span> <span>=</span> <span>sub_183EBC7D0</span>(<span>v41</span>, <span>0LL</span>, <span>v7</span>, <span>v8</span>);

    <span>// ... more setup ...</span>

    <span>// Hashing</span>
    <span>// The call to the SHA-1 hashing function.</span>
    <span>sub_183B509D0</span>(<span>v46</span>, <span>v38</span>);

    <span>// ... more setup ...</span>
    
    <span>// Encoding</span>
    <span>// The call to the Base64 encoding function.</span>
    <span>sub_1806C9A80</span>((<span>__int64</span> <span>*</span>)<span>v40</span>, <span>v39</span>);

    <span>// ... more setup ...</span>

    <span>// Header Setting</span>
    <span>// Adds the final encoded string to the request headers.</span>
    <span>v30</span> <span>=</span> <span>&#34;X-Browser-Validation&#34;</span>;
    <span>sub_183C6B920</span>(<span>v27</span>);
    
    <span>// ...</span>
}</pre></div>
</li>
<li>
<p dir="auto">Hash - passes that buffer into <code>sub_183B509D0</code>, which is SHA-1 algo. Open this guy and the first assignment jumps out:</p>
<div dir="auto" data-snippet-clipboard-copy-content="v12[0] = xmmword_7FFE2C9A7D50;
LODWORD(v12[1]) = -1009589776;   // 0xC3D2E1F0"><pre><span>v12</span>[<span>0</span>] <span>=</span> <span>xmmword_7FFE2C9A7D50</span>;
<span>LODWORD</span>(<span>v12</span>[<span>1</span>]) <span>=</span> <span>-1009589776</span>;   <span>// 0xC3D2E1F0</span></pre></div>
<p dir="auto">The second you see that &#34;-1009589776&#34; number, you can literally smell SHA-1.</p>
</li>
<li>
<p dir="auto">Base64 - the 20-byte digest is encoded.</p>
</li>
</ul>
<p dir="auto">Dynamic confirmation: pause one instruction before the hash call, dump RDX, and the ~150-byte buffer is nothing but</p>

<p dir="auto">Base64(SHA-1(buffer)) = header. Mystery solved.</p>
</article></div></div>
  </body>
</html>
