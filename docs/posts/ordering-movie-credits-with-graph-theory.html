<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://endcrawl.com/credits-ordering/">Original</a>
    <h1>Ordering movie credits with graph theory</h1>
    
    <div id="readability-page-1" class="page"><div>


<h3>How Graphs &amp; Games Untangled &#34;The Golden Hairball&#34;</h3>




<p>At <a href="https://endcrawl.com">Endcrawl</a> we&#39;re always thinking about the hard work that goes into making film and TV, and how that work translates to on-screen credits.</p>
<p>A feature film may involve <strong>thousands</strong> of people, <strong>hundreds</strong> of distinct job titles or &#34;roles,&#34; and <strong>dozens</strong> of departments. So there&#39;s plenty for a producer to worry about, like:</p>
<ul>
<li>Did we forget or misspell a name?</li>
<li>Is this the correct way to credit that role?</li>
<li>Do all these departments and roles appear in the right order on screen?</li>
</ul>
<p>Today we&#39;ll tackle that last question: how do you order end credits?</p>
<figure><img src="https://endcrawl.com/credits-ordering/img/ordering-movie-credits-with-graph-theory.png"/><figcaption>We&#39;ll get to this.</figcaption>
</figure>

<p>This is surprisingly hard to answer. Pick any two films and you&#39;ll find conflict in how screen credits are ordered. There are so many minor disagreements, in fact, that a human can&#39;t hope to reconcile them. (And there&#39;s a terrifying graph farther down to prove it.) You&#39;ll need math and computers to make sense of it all.</p>
<p>The other thing you&#39;ll need is granular <em>data</em>. Lots of it. And after running over 2,500 films and TV shows through our <a href="https://endcrawl.com">end credits SaaS</a>, we have that, too. In fact we have higher quality crediting data than anyone on the planet, since Endcrawl&#39;s database records are canonical -- the very records used to bake out the final on-screen titles. We also have precise positional and ordering data that no one else has. (Not even that big movie website you&#39;re thinking of.)</p>
<p>So we&#39;ve got a story to tell you about how we used graph theory to untangle the collective wisdom of our filmmaker customers, and to start answering some of the questions they face around properly attributing creative labor.</p>
<p>Before we go on, it&#39;s important to note that our <a href="https://endcrawl.com/template/">Perfect End Credits Template</a> isn&#39;t merely the result of an algorithm applied to lots of data. To pull it off, we also had to compile a massive Credits Thesaurus by hand, interview a number of industry experts, and use domain knowledge to shape the final results. But we&#39;ll talk about those efforts another day. This post is for anyone who&#39;s interested in solutions to hard technical problems -- and especially for those of you who like to stay in the theater until the last credit rolls out. So buckle up.</p>
<p>And let&#39;s ease into it with a few examples that are closer to home.</p>
<h2 id="three-examples-from-real-end-credits">Three Examples from Real End Credits</h2>
<p>There are 70 departments and 500+ roles in our <a href="https://endcrawl.com/template/">Template</a>. That&#39;s a lot.</p>
<p>For simplicity, we&#39;ll narrow in on one department containing 16 standardized roles: the Electric department. As the name implies, these folks are responsible for all things electricity-related. They generate power, they set up and operate lighting, and they run power to the lights and other things on set.</p>
<h3 id="example-1-black-is-king">Example 1: Black Is King</h3>
<p>Let&#39;s have a look at the Electric department credits for <a href="https://www.imdb.com/title/tt12607910/">&#34;Black is King&#34;</a>, the 2020 visual album from BeyoncÃ©. (All the examples we&#39;ll present here used <a href="https://endcrawl.com/">Endcrawl</a> for their end credits.)</p>
<figure id="example1">
  <img src="https://endcrawl.com/credits-ordering/img/credits.example.1.png"/>
  <sup></sup>
  <sub></sub>
  <img src="https://endcrawl.com/credits-ordering/img/graph.example.1.trail.png"/>
  <figcaption>The Electric Department from <a href="https://www.imdb.com/title/tt12607910/">Black is King</a>.</figcaption>
</figure>

<p>In this article we&#39;re focusing on roles -- things like <em>Gaffers</em> and <em>Best Boy Electrics</em>. So we&#39;ll extract a list of standardized roles in the order they appear on screen, which is what you see in the blue-green boxes.</p>
<p>What are all these roles exactly, and what do they do? A rundown:</p>
<ol>
<li>ğŸ•´ï¸ <em>Gaffer</em> -- The Electric department head. They work closely with the Director of Photography to achieve the &#34;look&#34; that the director is after. The word is likely an archaic derivation of <em>godfather</em> meaning &#34;boss&#34; or &#34;chief&#34;. (See also: Ted Lasso.) Some think it derives from the &#34;gaff&#34; pole used by Victorian-era lamplighters.</li>
<li>ğŸ¥‡ <em>Best Electric</em> -- Reports directly to the Gaffer and is arguably the the second most senior electrician on the crew. They are the on-set electric &#34;foreperson&#34;, responsible for executing the gaffer&#39;s decisions. Although this job has historically been named Best <em>Boy</em> Electric, we&#39;ve seen &#34;Best Electric&#34; show up increasingly in credits and in labor union documents. Endcrawl&#39;s <a href="https://endcrawl.com/template/">template</a> defaults to gender-neutral language.</li>
<li>ğŸ”‘ <em>Key Rigging Gaffer</em> -- The &#34;rigging&#34; contingent of the electric crew pre-stages lighting equipment typically days before shooting. The <em>Key Rigging Gaffer</em> is in charge of this group. Arguably, this is the second most senior electrician.</li>
<li>ğŸ—œ <em>Best Rigging Electric</em> -- Works directly under the <em>Key Rigging Gaffer</em>.</li>
<li>ğŸ’¡ <em>Lighting Electrician</em> -- Sometimes just called Electrician, Electric, Lighting Technician, or Spark. This is the core contingent of the lighting department. They are responsible for running power to everything on set: not just lights, but also monitors, trailers, and coffee makers.</li>
<li>ğŸ”‹ <em>Generator Operator</em> -- Sometimes <em>Genny Operator</em> or just <em>Genny Op</em>, this person provides power when regular &#34;house power&#34; is either unavailable or not up to the task.</li>
<li>ğŸ•¹ï¸  <em>Lighting Board Operator</em> -- This role goes by a variety of names like <em>Dimmer Board Operator</em>, <em>Console Operator</em>, or <em>Console Programmer</em>. They&#39;re in charge of a control console with lots of buttons. Buttons that make the lights do cool things.</li>
<li>ğŸˆ <em>Balloon Tech</em> -- When you need large amounts of diffuse light, especially on a huge set with tall ceilings, simple <a href="https://www.bhphotovideo.com/explora/video/tips-and-solutions/china-balls-classic-affordable-lighting-hack">China Balls</a> won&#39;t cut it. Enter the balloon tech, who operates <a href="https://www.iatse728.org/members/lms/classes/balloon-lighting-technician-101">large helium lighting balloons</a>.</li>
</ol>
<p>Is this the standard ordering for the Electric department? To find out, let&#39;s look at another example.</p>
<h3 id="example-2-love-hard">Example 2: Love Hard</h3>
<p>Here&#39;s the Electric department from <a href="https://www.imdb.com/title/tt10752004/">&#34;Love Hard&#34;</a>, a Christmas romcom that spent 5 weeks in the <a href="https://top10.netflix.com/films/2021-12-05">Netflix top 10 films list</a>.</p>
<figure id="example2">
  <img src="https://endcrawl.com/credits-ordering/img/credits.example.2.png"/>
  <img src="https://endcrawl.com/credits-ordering/img/graph.example.2.trail.png"/>
  <sup></sup>
  <sub></sub>
  <figcaption>The Electric Department from <a href="https://www.imdb.com/title/tt10752004/">Love Hard</a>.</figcaption>
</figure>

<p>At first glance, the list of standardized roles looks the same. But look closer...</p>
<p>There&#39;s a small disagreement: this time, <em>Lighting Electrician</em> appears last. In the previous example it preceded <em>Generator Operator</em>. Which one is right?</p>
<h3 id="examples-1-2-things-start-to-get-interesting">Examples 1 + 2: Things Start to Get Interesting</h3>
<p>Let&#39;s see what happens when we combine the orderings from the previous two examples:</p>
<figure id="examples-1-2-interactive">
  
  <figcaption>Role Ordering for Black is King + Love Hard</figcaption>
</figure>

<p>You&#39;ll notice the magenta lines with arrows -- called <strong>edges</strong> -- now have labels with numbers telling us how likely a role is to follow another one.</p>
<p>The golden edges are part of a <strong>cycle</strong>. If you&#39;re following the edge arrows from role to role, you can end up traveling in a loop:</p>
<ol>
<li>ğŸ’¡ <em>Lighting Electrician</em> â¡ï¸</li>
<li>ğŸ”‹ <em>Generator Operator</em> â¡ï¸</li>
<li>ğŸ•¹ï¸  <em>Lighting Board Operator </em>â¡ï¸</li>
<li>ğŸ’¡ <em>Lighting Electrician</em> -- and we&#39;re back to where we started ğŸ”.</li>
</ol>
<p>This cycle is a problem for us because a loop has no clear ordering. Every role comes before every other role. But it also comes after every role, if you keep going around. And around we go.</p>
<figure><img src="https://endcrawl.com/credits-ordering/img/ouroboros-simple.png"/><figcaption>The <a href="https://en.wikipedia.org/wiki/Ouroboros">Ouroboros</a>, image credit <a href="https://freesvg.org/ouroboros-vector-drawing">freesvg public domain</a></figcaption>
</figure>

<p>Would a third example help clear things up?</p>
<h3 id="example-3-chi-raq">Example 3: Chi-Raq</h3>
<p>Here&#39;s the Electric Department from Spike Lee&#39;s 2015 film <a href="https://www.imdb.com/title/tt4594834/">&#34;Chi-Raq&#34;</a>.</p>
<figure id="example3">
  <img src="https://endcrawl.com/credits-ordering/img/credits.example.3.png"/>
  <img src="https://endcrawl.com/credits-ordering/img/graph.example.3.trail.png"/>
  <sup></sup>
  <sub></sub>
  <figcaption>The Electric Department from <a href="https://www.imdb.com/title/tt4594834/">Chi-Raq</a>.</figcaption>
</figure>

<p>This time, the <em>Balloon Tech</em> role appears midway through instead of at the very end, so you can probably already sense trouble. Let&#39;s combine all three example orderings and see.</p>
<h3 id="examples-1-2-3-the-plot-thickens">Examples 1 + 2 + 3: The Plot Thickens</h3>
<figure id="examples-1-2-3-interactive">
  
  <figcaption>Role Ordering for Black is King + Love Hard + Chi-Raq</figcaption>
</figure>

<p>The golden cycle mess got bigger! There&#39;s even more uncertainty in the ordering than before.</p>
<p>Full disclosure: what we&#39;re showing you here is known as a <strong>graph</strong>, a <a href="https://en.wikipedia.org/wiki/Graph_(discrete_mathematics)">mathematical structure</a> that consists of <strong>nodes</strong> and the <strong>edges</strong> that connect them. In fact, even the role ordering from <a href="#example-1-black-is-king">Black is King above</a> -- where the nodes form a sort of vertical congo line -- was a basic graph. <sup id="fnref:bacon"><a href="#fn:bacon" rel="footnote">1</a></sup></p>
<p>We may have started out with nice vertical lines, but the graphs are getting fatter as we combine more examples. As they lose their sense of clear ordering, they also lose their top-to-bottom-ness. When this happens we&#39;ll start using a circular graph layout. Click the interactive graph above see it animate between layouts.</p>
<h3 id="all-examples-combined-the-golden-hairball">All Examples Combined: The Golden Hairball</h3>
<p>Thousands of film &amp; TV productions have used Endcrawl. Combining the Electric department orderings for all of them gets us this...</p>
<figure id="the-golden-hairball">
  
  <figcaption>The Golden Hairball</figcaption>
</figure>

<p>Yikes. The mess is now a veritable snake pit. As you can see, we&#39;ve had to switch to a circular graph layout, since most of the edges are now part of golden cycles, and there&#39;s no real &#34;top&#34; or &#34;bottom&#34; anymore. Our clear Electric department ordering has gone from obvious to seemingly nonexistent.</p>
<p>How do we get out of this mess? Is a clear ordering even possible?</p>
<p>It turns out it is. But getting there involved many dead-ends, a graph theory deep dive, a recent research paper, and -- unexpectedly -- the XBox player rating system. Read on.</p>
<h2 id="the-problem">The Problem</h2>
<blockquote>
<p>A good problem definition is worth a thousand solutions.</p>
<p>-- <a href="https://twitter.com/alangrow/status/1137963816170315778">Me</a></p>
</blockquote>
<p>Now we can state the problem.</p>
<p>Given thousands of example orderings for roles in credits, many of which have disagreements, how can we find the &#34;best&#34; ordering?</p>
<p>The same thing, said in math: given a <a href="https://en.wikipedia.org/wiki/Directed_graph">directed graph</a> with <a href="https://en.wikipedia.org/wiki/Cycle_(graph_theory)">cycles</a>, find an ordering of the nodes which minimizes a <a href="https://en.wikipedia.org/wiki/Loss_function">cost function</a>.</p>
<h2 id="chasing-a-solution">Chasing a Solution</h2>
<p>We need something that takes a messy set of example orderings as input, then outputs each role exactly once in some order. In other words, we&#39;re looking for an algorithm.</p>
<h3 id="what-even-is-a-best-ordering">What Even is a &#34;Best&#34; Ordering?</h3>
<p>Before we start experimenting with algorithms, how do we define this &#34;best&#34; ordering? Without that, we don&#39;t know if we&#39;re headed in the right direction, much less whether we&#39;ve arrived. We need a compass. To fashion one, suppose there were only 3 roles in the Electric department, and this was their correct order:</p>
<ol>
<li>ğŸ•´ï¸ <em>Gaffer</em></li>
<li>ğŸ¥‡ <em>Best Electric</em></li>
<li>ğŸ’¡ <em>Lighting Electrician</em></li>
</ol>
<p>If the algorithm outputs...</p>
<ol>
<li>ğŸ¥‡ <em>Best Electric</em></li>
<li>ğŸ•´ï¸<em> Gaffer</em></li>
<li>ğŸ’¡ <em>Lighting Electrician</em></li>
</ol>
<p>...then the algorithm is wrong and should be punished. <em>Best Electric</em> and <em>Gaffer</em> are swapped. But hang on, it&#39;s also kinda right, too: it correctly put <em>Lighting Electrician</em> in the 3rd slot. Can we quantify how wrong the algorithm is?</p>
<p>We can, and one way to measure that is the permutation distance <sup id="fnref:permutation-distance"><a href="#fn:permutation-distance" rel="footnote">2</a></sup> between the algorithm&#39;s output and the correct ordering. There are lots of ways to do this; we&#39;ll pick one called Squared Deviation Distance (SDD).</p>
<p>In the above example, SDD tells us we&#39;re <code>(-1)*(-1) + 1*1 + 0*0 = 2</code> away from the correct ordering. If the algorithm nailed it, the distance would be <code>0*0 + 0*0 + 0*0 = 0</code>. Lower is better, and a measure of zero is best.</p>
<p>Each of the following experiments will yield a candidate for &#34;best&#34; ordering. Since we don&#39;t know the correct ordering yet, we&#39;ll grade the experiment by reporting its average permutation distance to the example orderings. <sup id="fnref:sdd"><a href="#fn:sdd" rel="footnote">3</a></sup> Alas, since the example orderings don&#39;t fully agree, an overall SDD grade of 0 is out of reach. How low can we go? We don&#39;t know, and we may hit a limit. To distinguish similar SDDs that may be near the limit, we&#39;ll also report a subjective human grade.</p>
<h3 id="experiment-1-brute-force-search">Experiment 1: Brute Force Search</h3>
<blockquote>
<p>When in doubt, use brute force.</p>
<p>-- <a href="https://en.wikipedia.org/wiki/Ken_Thompson">Ken Thompson</a></p>
</blockquote>
<p>Speaking of permutation distance, what if the algorithm simply searched for the ordering that yielded the smallest total distance against all the ordering examples? By definition this ordering is &#34;best.&#34;</p>
<p>Unfortunately, permutation search space is big. Really big, like <code>O(N!)</code> big.</p>
<p>To make this concrete, we&#39;ve identified 16 standardized roles in the Electric department, so we&#39;d need to check <code>16! = 20,922,789,888,000</code> different orderings. That&#39;s <strong>21 trillion</strong> permutations to check. We&#39;d be here all day. <sup id="fnref:permutation-search"><a href="#fn:permutation-search" rel="footnote">4</a></sup></p>
<p>It gets worse for large departments. Sound Post-Production, with its 93 standardized roles, would involve checking <code>1 x 10 ^ 144</code> possible orderings. That&#39;s far more than the estimated number of atoms in the universe. We&#39;d be here until the lights went out.</p>
<p>Sorry Ken, this one&#39;s a no-go.</p>
<p><strong>Grade (SDD)</strong>: <code>does not compute</code></p>
<p><strong>Grade (Human)</strong>: <strong>Incomplete</strong></p>
<h3 id="experiment-2-average-position">Experiment 2: Average Position</h3>
<p>What if we averaged the position of each role across all the ordering examples, then sorted the roles by average position?</p>
<p>For instance, if <em>Gaffer</em> appears 1st, 2nd, 1st, and 1st in your 4 examples, it would have an average position of <code>(1 + 2 + 1 + 1) / 4 = 1.25</code>. That would guarantee it the first place spot in the final algorithmic ordering.</p>
<p>This does seem to work okay for the first few roles in the department. Things start to fall apart in the middle, a failure mode we called the &#34;muddy middle&#34;. Here&#39;s the ordering, together with each role&#39;s average position:</p>
<ol>
<li>ğŸ¥‡ <em>Best Electric</em> (<code>0.2696</code>)</li>
<li>ğŸ•´ï¸ <em>Additional Gaffer</em> (<code>0.2821</code>)</li>
<li>ğŸ’¡ <em>Lighting Electrician</em> (<code>0.3106</code>)</li>
<li>ğŸ•´ï¸ <em>Gaffer</em> (<code>0.3401</code>)</li>
<li>ğŸ”‹ <em>Generator Operator</em> (<code>0.3668</code>)</li>
<li>ğŸ›‹ï¸ <em>Lamp Operator</em> (<code>0.3739</code>)</li>
<li>ğŸªš <em>Shop Electric</em> (<code>0.3744</code>)</li>
<li>ğŸª¢ <em>Rigging Electrician</em> (<code>0.3765</code>)</li>
<li>ğŸ“ <em>Electric Intern</em> (<code>0.3798</code>)</li>
<li>âš¡ <em>Additional Electric</em> (<code>0.3881</code>)</li>
<li>ğŸ•¹ï¸ <em>Lighting Board Operator</em> (<code>0.3911</code>)</li>
<li>ğŸ”‘ <em>Key Rigging Gaffer</em> (<code>0.4190</code>)</li>
<li>ğŸ•ï¸ <em>Basecamp Electrician</em> (<code>0.4229</code>)</li>
<li>ğŸˆ <em>Balloon Tech</em> (<code>0.4382</code>)</li>
<li>ğŸ”‹ <em>Basecamp Generator Operator</em> (<code>0.4537</code>)</li>
<li>ğŸ—œ <em>Best Rigging Electric</em> (<code>0.4836</code>)</li>
</ol>
<p>Squinting at the average positions for these middle roles, we see plenty of near-ties that only differ in the 3rd decimal place (<code>0.3739</code>, <code>0.3744</code>, <code>0.3765</code>, <code>0.3798</code>). There isn&#39;t much useful positional information in these tiny fluctuations -- we realized we were squinting at noise.</p>
<p>Placing <em>Best Rigging Electric</em> last is also utter nonsense.</p>
<p><strong>Grade (SDD)</strong>: <code>0.49</code></p>
<p><strong>Grade (Human)</strong>: <strong>F</strong></p>

<p>The next thing we reached for was <a href="https://en.wikipedia.org/wiki/PageRank">PageRank</a>, the famous algorithm at the heart of Google.</p>
<figure><img src="https://endcrawl.com/credits-ordering/img/pagerank.gif"/><figcaption>Tfw your happiness level depends on your PageRank.</figcaption>
</figure>

<p>To apply PageRank to credits, imagine each role is a page. If <em>Best Electric</em> comes immediately after <em>Gaffer</em>, we&#39;ll pretend a page <em>Best Electric</em> links to a page <em>Gaffer</em>.</p>


<p>PageRank tells you what pages you&#39;re likely to land on if you click links at random. We thought applying PageRank to credits might tell you what roles you&#39;re most likely to land on, and that would give you an ordering. And we know PageRank is fine with cycles (<a href="https://en.wikipedia.org/wiki/Webring">webrings</a>, anyone?).</p>
<p>So we tried it with all Electric department roles, and it was our first real breakthrough. Here&#39;s the ordering, together with the PageRank score for each role:</p>
<ol>
<li>ğŸ•´ï¸ <em>Gaffer</em> (<code>0.2607</code>)</li>
<li>ğŸ¥‡ <em>Best Electric</em> (<code>0.2177</code>)</li>
<li>ğŸ’¡ <em>Lighting Electrician</em> (<code>0.1526</code>)</li>
<li>ğŸ”‘ <em>Key Rigging Gaffer</em> (<code>0.0985</code>)</li>
<li>ğŸ”‹ <em>Generator Operator</em> (<code>0.0652</code>)</li>
<li>ğŸ•¹ï¸ <em>Lighting Board Operator</em> (<code>0.0454</code>)</li>
<li>ğŸ—œ <em>Best Rigging Electric</em> (<code>0.0442</code>)</li>
<li>ğŸª¢ <em>Rigging Electrician</em> (<code>0.0374</code>)</li>
<li>ğŸ›‹ï¸ <em>Lamp Operator</em> (<code>0.0259</code>)</li>
<li>ğŸªš <em>Shop Electric</em> (<code>0.0155</code>)</li>
<li>ğŸ•ï¸ <em>Basecamp Electrician</em> (<code>0.0096</code>)</li>
<li>ğŸ•´ï¸ <em>Additional Gaffer</em> (<code>0.0083</code>)</li>
<li>ğŸ”‹ <em>Basecamp Generator Operator</em> (<code>0.0064</code>)</li>
<li>ğŸˆ <em>Balloon Tech</em> (<code>0.0063</code>)</li>
<li>ğŸ“ <em>Electric Intern</em> (<code>0.0046</code>)</li>
<li>âš¡ <em>Additional Electric</em> (<code>0.0016</code>)</li>
</ol>
<p>Alas, although it starts and ends well, on closer inspection we saw a similar &#34;muddy middle&#34; problem. Does it make sense that <em>Key Rigging Gaffer</em> is separated from <em>Best Rigging Electric</em> by several unrelated roles? That the generalist <em>Lighting Electrician</em> role landed in the third slot? Or that <em>Shop Electric</em> is thrown randomly into the middle of things?</p>
<p><strong>Grade (SDD)</strong>: <code>0.10</code></p>
<p><strong>Grade (Human)</strong>: <strong>B-</strong></p>
<h3 id="experiment-4-breaking-cycles-naively">Experiment 4: Breaking Cycles NaÃ¯vely</h3>
<p>The last two experiments suffered from the muddy middle problem. We theorized that they threw away too much graph structure, and that &#34;fine&#34; graph structure was somehow essential to ordering.</p>
<p>Specifically, we wondered if we could remove the &#34;worst&#34; edges of a graph, returning it to a <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">directed acyclic graph (DAG)</a>? In theory we&#39;d only need to concentrate on removing golden edges, since the magenta edges never participate in a cycle. Here&#39;s that graph from examples 1 + 2 + 3 again:</p>
<figure id="examples-1-2-3-circle">
  
  <figcaption>Our goal is to remove the &#34;worst&#34; golden edges.</figcaption>
</figure>

<p>To see why a DAG helps, let&#39;s touch on <a href="https://en.wikipedia.org/wiki/Topological_sorting">topological sorting</a>. This takes a graph -- and not just any graph, it must be a DAG -- and orders the nodes so that the edges always point forward. For instance, here&#39;s a DAG together with a topological sorting of its nodes:</p>
<figure id="toposort1">
  
  <figcaption>One way to topologically sort a DAG.</figcaption>
</figure>

<p>And here&#39;s the same DAG with a different, but equally valid, topological sorting:</p>
<figure id="toposort2">
  
  <figcaption>A different way to topologically sort the same DAG.</figcaption>
</figure>

<p>Since there are many ways to topologically sort a DAG, it can&#39;t take us all the way to a solution. But it does get us closer. And from there, a clear ordering might be within reach.</p>
<p>How do we decide which golden edges to remove on the way to a DAG? Since we&#39;re trying to preserve graph structure, ideally we&#39;d remove as few edges as possible. This idea sounds great in theory! Unfortunately, the theory has decided our idea is awful: this is known as the <a href="https://en.wikipedia.org/wiki/Feedback_arc_set">minimum feedback arc set</a> problem, and it&#39;s NP-hard. We&#39;d be waiting days (or decades).</p>
<p>So that&#39;s out. We considered various naÃ¯ve strategies for edge removal. One of these strategies was &#34;take from those who have the most&#34;: nodes with lots of edges could afford to have some of their edges removed. This eventually got us to a DAG, but not before removing 188 of the 198 total edges! There was very little graph left.</p>
<p>Despite that, the ordering looks okay:</p>
<ol>
<li>ğŸªš <em>Shop Electric</em></li>
<li>ğŸ•´ï¸ <em>Gaffer</em></li>
<li>ğŸ•´ï¸ <em>Additional Gaffer</em></li>
<li>ğŸ¥‡ <em>Best Electric</em></li>
<li>ğŸ”‹ <em>Generator Operator</em></li>
<li>ğŸ’¡ <em>Lighting Electrician</em></li>
<li>ğŸ•ï¸ <em>Basecamp Electrician</em></li>
<li>ğŸˆ <em>Balloon Tech</em></li>
<li>ğŸ“ <em>Electric Intern</em></li>
<li>âš¡ <em>Additional Electric</em></li>
<li>ğŸ”‘ <em>Key Rigging Gaffer</em></li>
<li>ğŸ—œ <em>Best Rigging Electric</em></li>
<li>ğŸª¢ <em>Rigging Electrician</em></li>
<li>ğŸ›‹ï¸ <em>Lamp Operator</em></li>
<li>ğŸ•¹ï¸ <em>Lighting Board Operator</em></li>
<li>ğŸ”‹ <em>Basecamp Generator Operator</em></li>
</ol>
<p>But there are some questionable choices here. Why on earth is <em>Shop Electric</em> first? Does <em>Basecamp Generator Operator</em> deserve to be last, or might it be better grouped with <em>Basecamp Electrician</em> or <em>Generator Operator</em>? Should <em>Balloon Tech</em> and <em>Electric Intern</em> appear midway through, ahead of the rigging roles? Something still wasn&#39;t right.</p>
<p><strong>Grade (SDD)</strong>: <code>0.11</code></p>
<p><strong>Grade (Human)</strong>: <strong>B+</strong></p>
<h3 id="experiment-5-breaking-cycles-in-noisy-hierarchies">Experiment 5: Breaking Cycles in Noisy Hierarchies</h3>
<p>We cast about for other ways to turn cyclic graphs into acyclic ones. The search turned up a research paper from 2017 titled <a href="https://par.nsf.gov/servlets/purl/10028167">&#34;Breaking Cycles in Noisy Hierarchies&#34;</a>. The paper&#39;s code is <a href="https://github.com/zhenv5/breaking_cycles_in_noisy_hierarchies">opensource</a>, and it uses the excellent python graph analysis library <a href="https://networkx.org/">networkx</a> we&#39;d used in the previous two experiments.</p>
<p>It wasn&#39;t clear at first whether this paper applied to the problem of ordering credits. It opens by discussing taxonomy graphs and ontology. But farther in, there are experimental results on a variety of datasets: the Google web graph, messaging graphs, even the expertise graph of Q&amp;A sites like StackOverflow. Might end credits involve the same kind of noisy but hierarchical structure? It seemed plausible.</p>
<p>First we adapted the paper&#39;s code into a simple python program. Like the solution we&#39;re after, this program takes a stream of example orderings, combines them into a single directed graph, and then starts removing edges to break cycles. Once all the cycles are broken and we have a DAG, it uses topological sorting plus tiebreaking to find an ordering. Here&#39;s the program in its entirety:</p>
<div><pre><span>import</span> <span>networkx</span> <span>as</span> <span>nx</span>
<span>import</span> <span>sys</span>

<span>def</span> <span>main</span><span>():</span>
  <span>graph</span> <span>=</span> <span>build_graph</span><span>(</span><span>sys</span><span>.</span><span>stdin</span><span>)</span>
  <span>for</span> <span>v</span> <span>in</span> <span>inferred_ordering</span><span>(</span><span>graph</span><span>):</span>
    <span>print</span><span>(</span><span>v</span><span>)</span>

<span>def</span> <span>inferred_ordering</span><span>(</span><span>graph</span><span>):</span>
  <span>ranks</span> <span>=</span> <span>rank_nodes</span><span>(</span><span>graph</span><span>)</span>
  <span>removals</span> <span>=</span> <span>remove_edges_greedily</span><span>(</span><span>graph</span><span>,</span> <span>ranks</span><span>)</span>
  <span>graph</span><span>.</span><span>remove_edges_from</span><span>(</span><span>list</span><span>(</span><span>graph</span><span>.</span><span>selfloop_edges</span><span>())</span> <span>+</span> <span>removals</span><span>)</span>
  <span>tiebreaker</span> <span>=</span> <span>lambda</span> <span>v</span><span>:</span> <span>-</span><span>ranks</span><span>[</span><span>v</span><span>]</span>
  <span>ordering</span> <span>=</span> <span>nx</span><span>.</span><span>lexicographical_topological_sort</span><span>(</span><span>graph</span><span>,</span> <span>key</span><span>=</span><span>tiebreaker</span><span>)</span>
  <span>return</span> <span>reversed</span><span>(</span><span>list</span><span>(</span><span>ordering</span><span>))</span>

<span>def</span> <span>rank_nodes</span><span>(</span><span>graph</span><span>):</span>
  <span>return</span> <span>dict</span><span>(</span><span>graph</span><span>.</span><span>degree</span><span>())</span>

<span>def</span> <span>remove_edges_greedily</span><span>(</span><span>graph</span><span>,</span> <span>ranks</span><span>):</span>
  <span>removals</span><span>,</span> <span>sccs</span> <span>=</span> <span>[],</span> <span>nontrivial_sccs</span><span>(</span><span>graph</span><span>)</span>
  <span>costs</span> <span>=</span> <span>dict</span><span>([</span> <span>((</span><span>u</span><span>,</span><span>v</span><span>),</span> <span>ranks</span><span>[</span><span>u</span><span>]</span><span>-</span><span>ranks</span><span>[</span><span>v</span><span>])</span> <span>for</span> <span>u</span><span>,</span><span>v</span> <span>in</span> <span>graph</span><span>.</span><span>edges</span><span>()</span> <span>])</span>
  <span>while</span> <span>sccs</span><span>:</span>
    <span>subgraph</span> <span>=</span> <span>sccs</span><span>.</span><span>pop</span><span>(</span><span>0</span><span>)</span>
    <span>max_cost_edge</span> <span>=</span> <span>max</span><span>(</span><span>subgraph</span><span>.</span><span>edges</span><span>,</span> <span>key</span><span>=</span><span>lambda</span> <span>edge</span><span>:</span> <span>max</span><span>(</span><span>costs</span><span>[</span><span>edge</span><span>],</span><span>0</span><span>))</span>
    <span>removals</span><span>.</span><span>append</span><span>(</span><span>max_cost_edge</span><span>)</span>
    <span>subgraph</span><span>.</span><span>remove_edge</span><span>(</span><span>*</span><span>max_cost_edge</span><span>)</span>
    <span>sccs</span> <span>+=</span> <span>nontrivial_sccs</span><span>(</span><span>subgraph</span><span>)</span>
  <span>return</span> <span>removals</span>

<span>def</span> <span>nontrivial_sccs</span><span>(</span><span>graph</span><span>):</span>
  <span>return</span> <span>[</span> <span>scc</span> <span>for</span> <span>scc</span> <span>in</span> <span>scc_subgraphs</span><span>(</span><span>graph</span><span>)</span> <span>if</span> <span>len</span><span>(</span><span>scc</span><span>.</span><span>nodes</span><span>)</span> <span>&gt;=</span> <span>2</span> <span>]</span>

<span>def</span> <span>scc_subgraphs</span><span>(</span><span>graph</span><span>):</span>
  <span>return</span> <span>nx</span><span>.</span><span>strongly_connected_component_subgraphs</span><span>(</span><span>graph</span><span>)</span>

<span>def</span> <span>build_graph</span><span>(</span><span>stream</span><span>):</span>
  <span>graph</span><span>,</span> <span>last_example</span><span>,</span> <span>last_item</span> <span>=</span> <span>nx</span><span>.</span><span>DiGraph</span><span>(),</span> <span>None</span><span>,</span> <span>None</span>
  <span>for</span> <span>line</span> <span>in</span> <span>stream</span><span>:</span>
    <span>example</span><span>,</span> <span>item</span> <span>=</span> <span>line</span><span>.</span><span>rstrip</span><span>(</span><span>&#39;</span><span>\n</span><span>&#39;</span><span>)</span><span>.</span><span>split</span><span>(</span><span>&#39;</span><span>\t</span><span>&#39;</span><span>)</span>
    <span>if</span> <span>example</span> <span>!=</span> <span>last_example</span><span>:</span>
      <span>last_item</span> <span>=</span> <span>None</span>
    <span>if</span> <span>last_item</span><span>:</span>
      <span>graph</span><span>.</span><span>add_edge</span><span>(</span><span>item</span><span>,</span> <span>last_item</span><span>)</span>
    <span>last_example</span> <span>=</span> <span>example</span>
    <span>last_item</span> <span>=</span> <span>item</span>
  <span>return</span> <span>graph</span>

<span>if</span> <span>__name__</span> <span>==</span> <span>&#39;__main__&#39;</span><span>:</span>
  <span>main</span><span>()</span>
</pre></div>


<p>Considering all the work it&#39;s doing, this code is short and sweet. (Thanks again <a href="https://networkx.org/">networkx</a>!)</p>
<p>However: the function <code>rank_nodes</code> is an impostor. Right now it says nodes with more total edges -- both incoming and outgoing -- rank higher. In reality this is a poor measure of hierarchical rank. For a better ranking algorithm, we&#39;ll turn to the paper, which considers two different possibilities.</p>

<p>One ranking algorithm discussed in the paper is called Social Agony: &#34;It&#39;s assumed that in social networks such as Twitter, agony can be caused when people follow other people who are lower in the hierarchy.&#34; While agony may have other causes on Twitter -- such as opening the app, or reading a tweet -- the authors of the <a href="https://www.researchgate.net/publication/221022162_Finding_Hierarchy_in_Directed_Online_Social_Networks">original Social Agony paper</a> had a precise mathematical definition in mind. Here it is for fun:</p>
<figure><img src="https://endcrawl.com/credits-ordering/img/social-agony-definition.png"/><figcaption>An equation for that special Hellsite feeling?</figcaption>
</figure>

<p>Social Agony finds a ranking that minimizes the number of &#34;backwards&#34; edges. The Social Agony paper was written in the heyday of social networks nearly a decade ago, and unfortunately the code was both a little hard to find, and a little hard to compile. Instead we skipped ahead to...</p>
<h4 id="2-ranking-by-trueskill">2. Ranking by TrueSkill</h4>
<p>The other ranking algorithm used in the paper is called <a href="https://trueskill.org/">TrueSkill</a>, and it comes to us by way of <em>checks notes</em> ... gaming? It says here it comes from gaming.</p>
<figure><img src="https://endcrawl.com/credits-ordering/img/ron-burgundy.jpg"/><figcaption>Newscaster reacts to &#34;Breaking Cycles in Noisy Hierarchies.&#34;</figcaption>
</figure>

<p>TrueSkill was developed by Microsoft Research to rank XBox Live players. To get an intuition for how it works, consider two players in head-to-head matches.</p>
<table>
<thead>
<tr>
<th>Match</th>
<th>Outcome</th>
<th></th>
<th>TrueSkill Odds</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td>50% - 50%</td>
</tr>
<tr>
<td>1</td>
<td>win: player 1</td>
<td>â†’</td>
<td>77% - 23%</td>
</tr>
<tr>
<td>2</td>
<td>win: player 1</td>
<td>â†’</td>
<td>87% - 13%</td>
</tr>
<tr>
<td>3</td>
<td>win: player 2 (!)</td>
<td>â†’</td>
<td>53% - 47%</td>
</tr>
<tr>
<td>4</td>
<td>win: player 1</td>
<td>â†’</td>
<td>73% - 27%</td>
</tr>
</tbody>
</table>
<p>Before they&#39;ve faced each other, the players are 50-50; TrueSkill knows nothing. After 2 straight wins, TrueSkill thinks player 1 is likely to win the 3rd match. But there&#39;s an upset, and TrueSkill revises the odds almost back to even. Even though player 1 wins the final match, their odds don&#39;t quite bounce back to those early, undefeated heights.</p>
<p>You can think of TrueSkill as a way to measure &#34;surprise&#34; in iterated games. If a loss would be surprising, you rank higher. If a loss would be unsurprising, you rank lower. Initially TrueSkill isn&#39;t very sure of the rankings, but as it sees more and more matches between the same players, the rankings become more certain -- and upsets become more surprising.</p>
<p>This intuition may translate over to end credits. If, after looking at the credits for thousands of productions, it&#39;s surprising for role A to appear immediately after role B, we could say role A ranks higher. It&#39;s also a good omen that we&#39;ve been constructing graphs throughout this analysis in a similar way -- adding edges whenever role A immediately precedes role B.</p>
<p>To top it off, TrueSkill has a <a href="https://github.com/sublee/trueskill">nice opensource python implementation</a>. All this to say: we decided to use TrueSkill to break cycles.</p>
<h4 id="breaking-cycles-with-trueskill">Breaking Cycles with TrueSkill</h4>
<p>TrueSkill, it turns out, is a good cycle breaker. It was much better at preserving graph structure than the naÃ¯ve strategies. Instead of removing 95% of edges, TrueSkill removed half of all edges before arriving at a DAG. Maybe this still sounds like a lot, but think back to <a href="#all-examples-combined-the-golden-hairball">the Golden Hairball</a>. Half of all edges is a small price to pay.</p>
<p>The resulting graph is acyclic as promised, but has lots of superfluous magenta edges. These make it difficult for a human to see the graph&#39;s backbone. Or anything, really:</p>
<figure id="dag-with-superfluous-edges">
  
  <figcaption>A messy graph without cycles, but with superfluous edges.</figcaption>
</figure>

<p>What do we really mean by &#34;superfluous&#34; edges? Well, if there&#39;s a well-worn path directly from node A to node D, then we probably don&#39;t need the more roundabount path <code>A -&gt; B -&gt; C -&gt; D</code>. A formal version of this idea is the <a href="https://en.wikipedia.org/wiki/Minimum_spanning_tree">minimum spanning tree (MST)</a> -- or in our case, a slight variation called the maximum spanning tree.</p>
<p>After applying MST to the graph above, the following leaps off the page:</p>
<figure id="electric-department-tree">
  
  <figcaption>The final Electric Department graph is a lovely tree.</figcaption>
</figure>

<p>This was astonishing to see! <sup id="fnref:orgchart"><a href="#fn:orgchart" rel="footnote">5</a></sup> Some immediate observations:</p>
<ol>
<li>ğŸŒ² Thanks to MST, it&#39;s no longer a graph, but more specifically a <a href="https://en.wikipedia.org/wiki/Tree_(graph_theory)">tree</a>.</li>
<li>ğŸ•´ï¸ <em>Gaffer</em> is the star on this christmas tree, as it should be. It almost always comes first.</li>
<li>ğŸ•´ï¸<em> Additional Gaffer </em>is a solitary offshoot that appears directly under <em>Gaffer</em>, which makes sense.</li>
<li>ğŸ¥‡ <em>Best Electric</em> immediately follows <em>Gaffer</em>, and is the main conduit to the rest of the tree.</li>
<li>ğŸ”‘ <em>Key Rigging Gaffer</em> has two other Rigging roles that commonly appear after it.</li>
<li>ğŸ”‹ <em>Generator Operator</em> is grouped with <em>Basecamp Generator Operator</em>, which makes semantic sense.</li>
<li>ğŸ’¡ <em>Lighting Electrician</em> is the gateway to other Electrical roles, and to the rarer <em>Balloon Tech.</em></li>
</ol>
<p>As alluded to in <a href="#experiment-4-breaking-cycles-naively">topological sorting</a>, there are still many possible orderings of this tree. We&#39;ll need to choose from among them. The observations above, however, have already given us some clues.</p>
<p><em>Gaffer</em> is unambiguously first. The next question is whether to go left or right.</p>
<p>If we go right and pick <em>Best Electric</em>, then we&#39;ll have to return to <em>Additional Gaffer</em> at some later point, probably after exploring everything under <em>Best Electric</em>. It doesn&#39;t make sense to separate <em>Gaffer</em> and <em>Additional Gaffer</em> -- if the latter appears, it&#39;s best to list it immediately, then continue with the weightier subtree starting with <em>Best Electric</em>.</p>
<p>This can be extrapolated into a general rule: when faced with a branching choice, prefer &#34;lighter&#34; subtrees to &#34;heavier&#34; ones. Subtree weight could simply be node count -- or, it could be something more nuanced like the total TrueSkill rating of its nodes.</p>
<p>We tried both, and total TrueSkill rating got us slightly better results. Here&#39;s the ordering:</p>
<ol>
<li>ğŸ•´ï¸ <em>Gaffer</em></li>
<li>ğŸ•´ï¸ <em>Additional Gaffer</em></li>
<li>ğŸ¥‡ <em>Best Electric</em></li>
<li>ğŸ›‹ï¸ <em>Lamp Operator</em></li>
<li>ğŸ•ï¸ <em>Basecamp Electrician</em></li>
<li>ğŸ•¹ï¸ <em>Lighting Board Operator</em></li>
<li>ğŸ”‹ <em>Generator Operator</em></li>
<li>ğŸ”‹ <em>Basecamp Generator Operator</em></li>
<li>ğŸ”‘ <em>Key Rigging Gaffer</em></li>
<li>ğŸ—œ <em>Best Rigging Electric</em></li>
<li>ğŸª¢ <em>Rigging Electrician</em></li>
<li>ğŸ’¡ <em>Lighting Electrician</em></li>
<li>âš¡ <em>Additional Electric</em></li>
<li>ğŸˆ <em>Balloon Tech</em></li>
<li>ğŸ“ <em>Electric Intern</em></li>
<li>ğŸªš <em>Shop Electric</em></li>
</ol>
<p>This ties our best score, and the ordering makes intuitive sense too.</p>
<p><strong>Grade (SDD)</strong>: <code>0.10</code></p>
<p><strong>Grade (Human)</strong>: <strong>A-</strong></p>
<h2 id="results-and-future-directions">Results and Future Directions</h2>
<p>We set out to order end credits from real examples -- thousands of films &amp; TV shows, with lots of minor ordering disagreements -- and fared well, all things considered. There are more sources of noise we could eliminate, and more algorithmic improvements we could make. In the end we think a &#34;correct&#34; ordering for the 16 standardized Electric department roles looks something like this:</p>
<ol>
<li>ğŸ•´ï¸ <em>Gaffer</em></li>
<li>ğŸ•´ï¸ <em>Additional Gaffer</em></li>
<li>ğŸ¥‡ <em>Best Electric</em></li>
<li>ğŸ›‹ï¸ <em>Lamp Operator</em></li>
<li>ğŸ”‹ <em>Generator Operator</em></li>
<li>ğŸ”‹ <em>Basecamp Generator Operator</em></li>
<li>ğŸ•¹ï¸ <em>Lighting Board Operator</em></li>
<li>ğŸ’¡ <em>Lighting Electrician</em></li>
<li>ğŸ•ï¸ <em>Basecamp Electrician</em></li>
<li>âš¡ <em>Additional Electric</em></li>
<li>ğŸ“ <em>Electric Intern</em></li>
<li>ğŸ”‘ <em>Key Rigging Gaffer</em></li>
<li>ğŸ—œ <em>Best Rigging Electric</em></li>
<li>ğŸª¢ <em>Rigging Electrician</em></li>
<li>ğŸˆ <em>Balloon Tech</em></li>
<li>ğŸªš <em>Shop Electric</em></li>
</ol>
<p>If we measure distance to this &#34;correct&#34; ordering instead of measuring against the noisy example orderings, these are the final grades:</p>
<ul>
<li><strong>Experiment 1 Grade (SDD)</strong>: <code>does not compute</code></li>
<li><strong>Experiment 2 Grade (SDD)</strong>: <code>0.22</code></li>
<li><strong>Experiment 3 Grade (SDD)</strong>: <code>0.31</code></li>
<li><strong>Experiment 4 Grade (SDD)</strong>: <code>0.41</code></li>
<li><strong>Experiment 5 Grade (SDD)</strong>: <code>0.12</code></li>
</ul>
<h3 id="the-perfect-end-credits-template">The Perfect End Credits Template</h3>
<p>The obvious next step is to apply this to the other 70 departments! And that&#39;s exactly what we&#39;ve done with <a href="https://endcrawl.com/template/">The Perfect End Credits Template</a>.</p>
<h3 id="how-this-will-evolve">How this will evolve</h3>
<p>This is a work in progress, and we&#39;ll continue to revise it as we learn more.</p>
<p>We&#39;re also looking at automatically structuring and ordering raw job data for our customers. Today the typical <a href="https://endcrawl.com/">Endcrawl</a> customer turns over an ordered list of credits to us. In the future, customers can hand off a flat list of jobs, and Endcrawl will be able to standardize, structure, and order it for them -- another small step towards democratized filmmaking.</p>
<p>With our data together with this algorithm, we can quickly react to the changing times. Crediting conventions evolve, new roles appear, and Endcrawl can help its customers stay on top of it all. Although <em>Gaffer</em> dates back to the Victorian era, we frequently see new roles appearing in credits. Consider that <em>COVID Compliance Officer</em> didn&#39;t appear a single time in credits 18 months ago. Now it&#39;s credited in hundreds of Endcrawl productions -- and we know exactly where it goes.</p>
<p>Thanks for sticking it out. We hope you enjoyed this little break from your work day. May you always receive proper credit for your labor.</p>
<p>Until next time,</p>
<p>-- <a href="https://twitter.com/alangrow">Alan</a> + <a href="https://twitter.com/iampliny">Pliny</a></p>


<hr/>
<h2 id="credits-acknowledgments">Credits &amp; Acknowledgments</h2>
<p>Special thanks to the authors of <a href="https://par.nsf.gov/servlets/purl/10028167">&#34;Breaking Cycles in Noisy Hierarchies&#34;</a>: Sun, Ajwani, Nicholson, Sala, and Parthasarathy. Bet you didn&#39;t see this one coming!</p>
<p>Thanks to <a href="https://endcrawl.com/#team">The Endcrawl Team</a> for feedback and support. Thanks to <a href="https://twitter.com/RodBogart">Rod Bogart</a>, <a href="https://science.gsfc.nasa.gov/sed/bio/eric.r.switzer">Eric Switzer</a>, <a href="https://twitter.com/tweetingpauls">Paul Shapiro</a>, Ethel, Jacob, Alex, Julianne, and the others who read drafts.</p>
<p>All the interactive graphs were made with <a href="https://js.cytoscape.org/">cytoscape.js</a>. Graph analysis was done with <a href="https://networkx.org/">networkx</a>. Kudos to Microsoft Research and the <a href="https://trueskill.org/">TrueSkill</a> project.</p>



<!-- Third party analytics. -->


</div></div>
  </body>
</html>
