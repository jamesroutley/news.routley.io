<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://retrocoding.net/building-for-dos-os2-and-dos-on-a-macbook-apple-silicon">Original</a>
    <h1>Building for DOS, OS/2, and DOS on a MacBook Apple Silicon</h1>
    
    <div id="readability-page-1" class="page"><div id="post-content-parent"><div id="post-content-wrapper"><p>I&#39;ve previously written about <a target="_blank" href="https://retrocoding.net/openwatcom-gateway-to-ancient-world-of-x86">OpenWatcom as a gateway to the ancient world</a>. However, at that time, I focused on installing it using Docker, as OpenWatcom 1.9 only works on Windows and Linux. I&#39;m not a full-time Windows or Linux user, so when I discovered that OpenWatcom&#39;s 2.0 series can be compiled and run on macOS, <strong>and</strong> it can run on ARM macOS, I was thrilled.</p>
<p>It&#39;s not mentioned on their website, and only in less prominent places like GitHub Issues. However, after testing it out, I believe it&#39;s worth sharing with others who share my hobby: writing old Windows (and DOS) applications but still wants to use their newest, shiniest MacBook to do so.</p>
<h2 id="heading-preparation">Preparation</h2>
<p>There are some preparations you need to do before building OpenWatcom source code on an Apple Silicon.</p>
<p><strong>First, the compiler and platform SDK</strong>. To build anything on macOS, you need their official compiler and IDE. Xcode. Recently, they tried to slim everything down, so it&#39;ll be 2 GB-ish download from <a href="http://developer.apple.com" target="_blank">developer.apple.com</a>.</p>
<p><strong>Second, homebrew</strong>. This is optional if you know what you&#39;re doing. However, to smoothly compile OpenWatcom, you&#39;d need DOSBOX command line and I feel the easiest way to obtain DosBox is using homebrew. Instal it from <a target="_blank" href="https://brew.sh">brew.sh</a>.</p>
<h2 id="heading-getting-dependencies">Getting Dependencies</h2>
<p>To get the dependencies, first we install DosBox. In Terminal, use this command to install dosbox.</p>
<pre><code>brew install dosbox
</code></pre>
<p>That&#39;s the only dependencies you need.</p>
<h2 id="heading-compilation">Compilation</h2>
<p>Compilation is actually straightforward. You&#39;d only to obtain the source code for &#34;latest&#34; OpenWatcom v2.0 series. I&#39;m using the February 2024 archive. Go to the release page and dowload the source (.tar.gz). Extract it</p>
<pre><code>tar xvzf open-watcom-v2-2024-02-02-Build.tar.gz
</code></pre>
<p>Before we do everything, now open the file <code>setenv.h</code> and search for line with <code>export OWTOOLS</code> and change it to:</p>
<pre><code><span>export</span> OWTOOLS=CLANG
</code></pre>
<p>This will change the compilation to clang, the compiler built into Xcode and then search for the line with <code>export OWDOSBOX</code>, uncomment and change it to.</p>
<pre><code><span>export</span> OWDOSBOX=dosbox
</code></pre>
<p>From this point forward you&#39;re ready. The last step is just run this</p>
<pre><code>./build.sh
</code></pre>
<p>And, wait. This will compile the OpenWatcom compiler using your <code>clang</code> compiler on your ARM64 platform. If everything is finished, you can put the compiled product by using this command.</p>
<pre><code>./build.sh rel
</code></pre>
<p>This will copy the resulting compilers, supporting headers for all supported platforms, as well as the libraries into <code>rel</code> directory.</p>

<p>I&#39;m usually using watcom on a directory that I put on paths. For me it&#39;s on <code>/opt/watcom</code>. So if you haven&#39;t made it yet, you can run this to create a directory for your watcom installation and copy everything into that place.</p>
<pre><code>mkdir -p /opt/watcom
<span>cd</span> rel &amp;&amp; copy -a . /opt/watcom
</code></pre>
<p>To use the binary, you need to add the toolchain to <code>PATH</code>. The toolchain for Apple Silicon mac is in <code>armo64</code> subdirectory. You need to also setup the <code>WATCOM</code> environment variable. That will point to our installation directory.</p>
<pre><code><span>export</span> WATCOM=/opt/watcom
<span>export</span> PATH=<span>$PATH</span>:<span>$WATCOM</span>/armo64
<span>export</span> EDDAT=<span>$WATCOM</span>/eddat
</code></pre>
<p>For each platform (16-bit Windows, 32-bit Windows, DOS, OS2) you need to set different environment variables for <code>INCLUDE</code> and <code>LIBS</code>. Here&#39;s for 32-bit Windows platform.</p>
<pre><code><span>export</span> INCLUDE=<span>$WATCOM</span>/h:<span>$WATCOM</span>/h/nt:<span>$WATCOM</span>/h/nt/ddk:<span>$WATCOM</span>/h/nt/sdk:<span>$WATCOM</span>/h/nt/sdk/ntddk:<span>$WATCOM</span>/h/nt/sdk/wdm:<span>$WATCOM</span>/h/nt/sdk/wdm/dd
<span>export</span> LIBS=<span>$WATCOM</span>/lib386:<span>$WATCOM</span>/lib386/nt:<span>$WATCOM</span>/lib386/nt/ddk:<span>$WATCOM</span>/lib386/nt/sdk:<span>$WATCOM</span>/lib386/nt/sdk/ntddk:<span>$WATCOM</span>/lib386/nt/sdk/wdm:<span>$WATCOM</span>/lib386/nt/sdk/wdm/ddk
</code></pre>
<p>Please refer to the OpenWatcom/Watcom manual on where the headers and the libs are. You can basically guess from <code>/h</code> directory and <code>/libxxx</code> directory.</p>
<p>After that you can run <code>wcl386</code> to see whether it works or not.</p>
<pre><code>‚ùØ wcl386 -h
Open Watcom C/C++ x86 32-bit Compile and Link Utility
Version 2.0 beta Feb 10 2024 00:00:59
Copyright (c) 2002-2024 The Open Watcom Contributors. All Rights Reserved.
Portions Copyright (c) 1988-2002 Sybase, Inc. All Rights Reserved.
Source code is available under the Sybase Open Watcom Public License.
See https://github.com/open-watcom/open-watcom-v2
</code></pre>
<p>This means that your watcom compilers are ready to be used to target old platforms.</p>
</div></div></div>
  </body>
</html>
