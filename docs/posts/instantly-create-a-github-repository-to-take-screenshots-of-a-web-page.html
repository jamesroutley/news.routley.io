<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://simonwillison.net/2022/Mar/14/shot-scraper-template/">Original</a>
    <h1>Show HN: Instantly create a GitHub repository to take screenshots of a web page</h1>
    
    <div id="readability-page-1" class="page"><div id="primary">

<div>




<p>I just released <strong><a href="https://github.com/simonw/shot-scraper-template">shot-scraper-template</a></strong>, a GitHub repository template that helps you start taking automated screenshots of a web page by filling out a form.</p>
<p><a href="https://github.com/simonw/shot-scraper">shot-scraper</a> is my command line tool for <a href="https://simonwillison.net/2022/Mar/10/shot-scraper/">taking screenshots</a> of web pages and <a href="https://simonwillison.net/2022/Mar/14/scraping-web-pages-shot-scraper/">scraping data from them</a> using JavaScript.</p>
<p>One of its uses is to help create and maintain screenshots for documentation, making it easy to update them to include changes to the design of the underlying pages.</p>
<p>To make this as easy as possible, I’ve created a GitHub repository template that automates the process of setting up <code>shot-scraper</code> to run against a URL.</p>
<p>To try it out, start here:</p>
<p><a href="https://github.com/simonw/shot-scraper-template/generate">https://github.com/simonw/shot-scraper-template/generate</a></p>
<p><img alt="Screenshot of the &#39;create new repository from shot-scraper-template&#39; page, which asks for a repository name and a description. The URL for the page you want to take screenshots of goes in the description." src="https://static.simonwillison.net/static/2022/create-new-repository.png"/></p>
<p>Pick a name for your new repository and paste the URL of the page you want to screenshot into the description field.</p>
<p>Then click “Create repository from template”.</p>
<p>That’s it! Your new repository will be created, a GitHub Actions automation script will run for a few seconds and your new screenshot will be added to the repository as a file called <code>shot.png</code>.</p>
<p>Here’s an example repository I created using the template: <a href="https://github.com/simonw/simonwillison-net-shot">simonw/simonwillison-net-shot</a>—and here’s the <code>shot.png</code> file from that repo:</p>
<p><img alt="A screenshot of simonwillison.net" src="https://raw.githubusercontent.com/simonw/simonwillison-net-shot/main/shot.png"/></p>
<p>You can re-take the screenshot any time you want by clicking the “Run workflow” button in the Actions tab:</p>
<p><img alt="Click Actions, Take screenshots, Run workflow and then Run workflow" src="https://static.simonwillison.net/static/2022/take-screenshots.png"/></p>
<p>Your repository will have a file in it called <code>shots.yml</code> that initially looks like this:</p>
<div><pre>- <span>url</span>: <span>https://simonwillison.net/</span>
  <span>output</span>: <span>shot.png</span>
  <span>height</span>: <span>800</span></pre></div>
<p>You can edit that file to change the settings that apply to your screenshot, or to add further URLs to take shots of like this:</p>
<div><pre>- <span>url</span>: <span>https://simonwillison.net/</span>
  <span>output</span>: <span>shot.png</span>
  <span>height</span>: <span>800</span>
- <span>url</span>: <span>https://www.example.com/</span>
  <span>output</span>: <span>example.png</span>
  <span>height</span>: <span>800</span></pre></div>
<p>Further options are available here, as described in <a href="https://github.com/simonw/shot-scraper#taking-multiple-screenshots">the shot-scraper README</a>.</p>
<h4>How this works</h4>
<p>This entire system is based around a single GitHub Actions workflow, in <a href="https://github.com/simonw/shot-scraper-template/blob/main/.github/workflows/shots.yml">.github/workflows/shots.yml</a>.</p>
<p>Here’s an annotated copy of that workflow showing how it all works.</p>
<div><pre><span>name</span>: <span>Take screnshots</span>

<span>on</span>:
  <span>push</span>:
  <span>workflow_dispatch</span>:</pre></div>
<p>The workflow triggers when a change is made to the repository (including edits to the <code>shots.yml</code> file) or when the user manually clicks “Run workflow”.</p>
<div><pre><span>jobs</span>:
  <span>shot-scraper</span>:
    <span>runs-on</span>: <span>ubuntu-latest</span>
    <span>if</span>: <span>${{ github.repository != &#39;simonw/shot-scraper-template&#39; }}</span></pre></div>
<p>This is the trick that makes everything else work, which I picked up <a href="https://simonwillison.net/2021/Aug/28/dynamic-github-repository-templates/">from Bruno Rocha last year</a>. It ensures that this workflow job only runs on copies of the template, not on the initial template repository itself.</p>
<p>This is necessary because a later step creates a file in the repository if it doesn’t yet exist based on the description URL provided by the user.</p>
<div><pre>    <span>steps</span>:
    - <span>uses</span>: <span>actions/checkout@v2</span>
    - <span>name</span>: <span>Set up Python 3.10</span>
      <span>uses</span>: <span>actions/setup-python@v2</span>
      <span>with</span>:
        <span>python-version</span>: <span><span>&#34;</span>3.10<span>&#34;</span></span>
    - <span>uses</span>: <span>actions/cache@v2</span>
      <span>name</span>: <span>Configure pip caching</span>
      <span>with</span>:
        <span>path</span>: <span>~/.cache/pip</span>
        <span>key</span>: <span>${{ runner.os }}-pip-${{ hashFiles(&#39;requirements.txt&#39;) }}</span>
        <span>restore-keys</span>: <span>|</span>
<span>          ${{ runner.os }}-pip-</span></pre></div>
<p>This is boilerplate that I use in most of my GitHub Actions workflows: it sets up Python 3.10, and also <a href="https://github.com/actions/cache">configures a cache</a> such that Python requirements in a <code>requirements.txt</code> file persist from one invocation to another without having to be re-downloaded from PyPI.</p>
<div><pre>    - <span>name</span>: <span>Cache Playwright browsers</span>
      <span>uses</span>: <span>actions/cache@v2</span>
      <span>with</span>:
        <span>path</span>: <span>~/.cache/ms-playwright/</span>
        <span>key</span>: <span>${{ runner.os }}-browsers</span></pre></div>
<p><code>shot-scraper</code> uses Microsoft’s open source <a href="https://playwright.dev/">Playwright</a> browser automation tool. Playwright works by installing its own full Chromium browser. This line configures a cache for that browser, such that future invocations of the Action don’t need to download another copy.</p>
<div><pre>    - <span>name</span>: <span>Install dependencies</span>
      <span>run</span>: <span>|</span>
<span>        pip install -r requirements.txt</span>
<span>    - <span>name</span>: <span>Install Playwright dependencies</span>
      <span>run</span>: <span>|</span>
<span>        shot-scraper install</span></span></pre></div>
<p>The <code>pip install</code> line here installs the <code>shot-scraper</code> CLI tool, which is written in Python.</p>
<p>That <code>shot-scraper install</code> line then triggers the Playwright mechanism to download and install the browser. This will do nothing if the browser has already been cached.</p>
<div><pre>    - <span>uses</span>: <span>actions/github-script@v6</span>
      <span>name</span>: <span>Create shots.yml if missing on first run</span>
      <span>with</span>:
        <span>script</span>: <span>|</span>
<span>          const fs = require(&#39;fs&#39;);</span>
<span>          if (!fs.existsSync(&#39;shots.yml&#39;)) {</span>
<span>              const desc = context.payload.repository.description;</span>
<span>              let line = &#39;&#39;;</span>
<span>              if (desc &amp;&amp; (desc.startsWith(&#39;http://&#39;) || desc.startsWith(&#39;https://&#39;))) {</span>
<span>                  line = `- url: ${desc}` + &#39;\n  output: shot.png\n  height: 800&#39;;</span>
<span>              } else {</span>
<span>                  line = &#39;# - url: https://www.example.com/\n#   output: shot.png\n#   height: 800&#39;;</span>
<span>              }</span>
<span>              fs.writeFileSync(&#39;shots.yml&#39;, line + &#39;\n&#39;);</span>
<span>          }</span></pre></div>
<p>This is the other key piece of magic. This uses GitHub’s <a href="https://github.com/actions/github-script">github-script</a> action, which provides a Node.js environment with a <code>context</code> object containing details about the actions run.</p>
<p>It starts by reading the repository description from <code>context.payload.repository.description</code>.</p>
<p>Then it creates a <code>shots.yml</code> file based on that description—but only if the file does not exist already.</p>
<p>If there’s no repository description it creates one with a commented-out configuration instead, that looks like this:</p>
<div><pre><span><span>#</span> - url: https://www.example.com/</span>
<span><span>#</span>   output: shot.png</span>
<span><span>#</span>   height: 800</span></pre></div>
<p>The next step is to take the screenshots:</p>
<div><pre>    - <span>name</span>: <span>Take shots</span>
      <span>run</span>: <span>|</span>
<span>        shot-scraper multi shots.yml</span></pre></div>
<p><code>shot-scraper multi</code> is <a href="https://github.com/simonw/shot-scraper#taking-multiple-screenshots">documented here</a>—it runs through the YAML file and takes each of the screenshots configured there in turn.</p>
<p>Final step is to commit and push the new <code>shots.yml</code> and <code>shot.png</code> files to the repository:</p>
<div><pre>    - <span>name</span>: <span>Commit and push</span>
      <span>run</span>: <span>|-</span>
<span>        git config user.name &#34;Automated&#34;</span>
<span>        git config user.email &#34;actions@users.noreply.github.com&#34;</span>
<span>        git add -A</span>
<span>        timestamp=$(date -u)</span>
<span>        git commit -m &#34;${timestamp}&#34; || exit 0</span>
<span>        git pull --rebase</span>
<span>        git push</span></pre></div>
<p>This uses a pattern I describe <a href="https://til.simonwillison.net/github-actions/commit-if-file-changed">in this TIL</a>.</p>
<h4>GitHub Actions as a platform</h4>
<p>I <a href="https://twitter.com/simonw/status/1502838806113763329">tweeted this</a> the other day, shortly before I came up with the idea for the <code>shot-scraper-template</code> repository.</p>
<blockquote><p dir="ltr" lang="en">Genuinely think GitHub Actions might be my favourite serverless platform right now</p>- Simon Willison (@simonw) <a href="https://twitter.com/simonw/status/1502838806113763329?ref_src=twsrc%5Etfw">March 13, 2022</a></blockquote>
<p>This project demonstrates why. The amount of complex moving parts involved in <code>shot-scraper-template</code> is pretty bewildering, but the end result is a free tool that anyone can use to start taking automated screenshots.</p>
<p>And it doesn’t cost me anything to provide it to them either!</p>




</div>

</div></div>
  </body>
</html>
