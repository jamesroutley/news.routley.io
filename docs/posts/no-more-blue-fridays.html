<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.brendangregg.com/blog/2024-07-22/no-more-blue-fridays.html">Original</a>
    <h1>No More Blue Fridays</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>In the future, computers will not crash due to bad software updates, even those updates that involve kernel code. In the future, these updates will push <a href="https://ebpf.io/">eBPF</a> code.</p>

<p>Friday July 19th provided an unprecedented example of the inherent dangers of kernel programming, and has been called the largest outage in the <a href="https://en.m.wikipedia.org/wiki/2024_CrowdStrike_incident#Cost">history</a> of information technology. Windows computers around the world encountered blue-screens-of-death and boot loops, causing <a href="https://www.washingtonpost.com/technology/2024/07/19/microsoft-windows-outage-blue-screen-bsod/">outages</a> for hospitals, airlines, banks, grocery stores, media broadcasters, and more. This was caused by a <a href="https://www.crowdstrike.com/blog/falcon-update-for-windows-hosts-technical-details/">config update</a> by a security company for their widely used product that included a kernel driver on Windows systems. The update caused the kernel driver to <a href="https://medium.com/@shyamsundarb/technical-details-of-the-windows-bsod-disaster-due-to-crowdstrike-58de2371c19c">try to read invalid memory</a>, an error type that will crash the kernel.</p>

<p>For Linux systems, the company behind this outage was already in the process of adopting eBPF, which is immune to such crashes. Once Microsoft&#39;s <a href="https://github.com/microsoft/ebpf-for-windows">eBPF support for Windows</a> becomes production-ready, Windows security software can be ported to eBPF as well. These security agents will then be safe and unable to cause a Windows kernel crash.</p>

<p>eBPF (no longer an acronym) is a secure kernel execution environment, similar to the secure JavaScript runtime built into web browsers. If you&#39;re using Linux, you likely already have eBPF available on your systems whether you know it or not, as it was included in the kernel several years ago. eBPF programs cannot crash the entire system because they are safety-checked by a software verifier and are effectively run in a sandbox. If the verifier finds any unsafe code, the program is rejected and not executed. The verifier is rigorous -- the Linux implementation has <a href="https://github.com/torvalds/linux/blob/master/kernel/bpf/verifier.c">over 20,000 lines of code</a> -- with contributions from industry (e.g., Meta, Isovalent, Google) and academia (e.g., <a href="https://people.cs.rutgers.edu/~sn624/verified-sandboxing.html">Rutgers University</a>, <a href="https://unsat.cs.washington.edu/projects/jitterbug/">University of Washington</a>). The safety this provides is a key benefit of eBPF, along with heightened security and lower resource usage.</p>

<p>Some eBPF-based security startups (e.g., <a href="https://www.oligo.security/blog/recent-crowdstrike-outage-emphasizes-the-need-for-ebpf-based-sensors">Oligo</a>, <a href="https://www.uptycs.com/blog/crowdstrike-outage-less-intrusive-malware-detection">Uptycs</a>) have made their own statements about the recent outage, and the advantages of migrating to eBPF. Larger tech companies are also adopting eBPF for security. As an example, Cisco acquired the eBPF-startup Isovalent and has announced a new eBPF security product: <a href="https://blogs.cisco.com/security/cisco-hypershield-reimagining-security">Cisco Hypershield</a>, a fabric for security enforcement and monitoring. <a href="https://www.youtube.com/watch?v=N4YKcMV8iaY">Google</a> and <a href="https://lpc.events/event/17/contributions/1602/">Meta</a> already rely on eBPF to detect and stop bad actors in their fleet, thanks to eBPF&#39;s speed, deep visibility, and safety guarantees. Beyond security, eBPF is also used for networking and observability.</p>

<p>The worst thing an eBPF program can do is to merely consume more resources than is desirable, such as CPU cycles and memory. eBPF cannot prevent developers writing poor code -- wasteful code -- but it will prevent serious issues that cause a system to crash. That said, as a new technology eBPF has had some bugs in its management code, including a <a href="https://access.redhat.com/solutions/7068083">Linux kernel panic</a> discovered by the same security company in the news today. This doesn&#39;t mean that eBPF has solved nothing, substituting a vendor&#39;s bug for its own. Fixing these bugs in eBPF means fixing these bugs for <em>all</em> eBPF vendors, and more quickly improving the security of everyone.</p>

<p>There are other ways to reduce risks during software deployment that can be employed as well: canary testing, staged rollouts, and &#34;resilience engineering&#34; in general. What&#39;s important about the eBPF method is that it is a software solution that will be available in both Linux and Windows kernels by default, and has already been adopted for this use case.</p>

<p>If your company is paying for commercial software that includes kernel drivers or kernel modules, you can make eBPF a requirement. It&#39;s possible for Linux today, and Windows soon. While some vendors have already proactively adopted eBPF (thank you), others might need a little encouragement from their paying customers. Please help raise awareness, and together we can make such global outages a lesson of the past.</p>

<p><em>Authors: Brendan Gregg, Intel; Daniel Borkmann, Isovalent; Joe Stringer, Isovalent; KP Singh, Google.</em></p>

</div></div>
  </body>
</html>
