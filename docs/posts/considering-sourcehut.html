<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://postmarketos.org/blog/2022/07/25/considering-sourcehut/">Original</a>
    <h1>Considering Sourcehut</h1>
    
    <div id="readability-page-1" class="page"><article>
    <p><a href="https://postmarketos.org/static/img/2022-07/sourcehut.jpg"><img alt="" src="https://postmarketos.org/static/img/2022-07/sourcehut_thumb.jpg"/></a></p>
<p>After gitlab.com&#39;s
<a href="https://about.gitlab.com/blog/2022/03/24/efficient-free-tier/">recent changes</a>
to the free tier, we have been seriously reconsidering if gitlab.com is still
the best development platform for postmarketOS. It was not at all an easy
question to answer for us, given how much we depend on a place for our code,
issues and CI. To reflect this rather long thought process we already had, we
decided to publish this short blog post with the most important thoughts we
currently arrived at together with a
<a href="https://cast.postmarketos.org/episode/20-Considering-SourceHut-special/">41 minute discussion</a>
where we go into a lot more detail.</p>
<h2 id="selfhosting-is-too-much-effort"><a href="#selfhosting-is-too-much-effort">Selfhosting is too much effort</a></h2>
<p>It&#39;s important to us that the software we use could be selfhosted. But there&#39;s
a lot of maintenance effort that comes with running a selfhosted instance of
pretty much any code hosting or CI infrastructure related software: making sure
it is constantly available, has no unpatched vulnerabilities, doesn&#39;t run into
performance problems etc. All the time we would spend on that is time we can&#39;t
spend actually hacking on phones. We would very much like to avoid that.</p>
<p>So platforms where we would need to selfhost either the whole code forge or
CI for it are out of the picture. As you can guess from the title,
<a href="https://sourcehut.org/">SourceHut</a> is the prime candidate right now and there
we could just use the official instance at <a href="https://sr.ht/">sr.ht</a> for
everything, including CI. In fact, we have been using the CI component already
since end of 2019 to
<a href="https://postmarketos.org/blog/2019/12/14/new-build-infra/">build all packages and images</a>.</p>
<h2 id="why-sourcehut"><a href="#why-sourcehut">Why SourceHut</a></h2>
<p>SourceHut is a great match for the
<a href="https://wiki.postmarketos.org/wiki/About_postmarketOS#Principles">postmarketOS principles</a>:</p>
<ul>
<li>AGPL licensed, no <a href="https://en.wikipedia.org/wiki/Open-core_model">Open-core model</a></li>
<li>No tracking or advertising</li>
<li>It&#39;s <a href="https://forgeperf.org/">fast</a></li>
</ul>
<h2 id="patch-workflow"><a href="#patch-workflow">Patch workflow</a></h2>
<p>The most controversial point about this move would be the patch workflow. In
2022, many developers are now used to the merge request / pull request
submit and review workflow via web UI. On SourceHut, developers are supposed to
send patches via <a href="https://git-send-email.io/">git send-email</a>.</p>
<p>While there are <a href="https://drewdevault.com/2018/07/02/Email-driven-git.html">good reasons</a>
for this approach, after many long discussions we realized that if we just
switched over one day and required everybody to use git send-email, we would
probably drive away many of the great contributors that made postmarketOS what
it is today.</p>
<p>But we can have the best of both worlds. The workflow of pushing your code to
your own repository on SourceHut and then creating the patch mail like a MR/PR
with a few clicks in the web UI is already implemented. Right now the review
process is only possible via mail, but compositing code reviews on the web is
planned as well
(<a href="https://todo.sr.ht/~sircmpwn/lists.sr.ht/111">lists.sr.ht#111</a>). We talked to
Drew DeVault (the main developer of SourceHut) and he told us that having the
whole review process in the web UI available is one of the top priorities for
SourceHut.</p>
<h2 id="rollout-plan"><a href="#rollout-plan">Rollout plan</a></h2>
<p>With all that in mind, we wrote the following tentative rollout plan. Note that
we only move pmbootstrap.git, not even the pmbootstrap issues, and no other
repository, starting from some time in August until December of 2022. Most
people are contributing to pmaports.git, so they won&#39;t be affected by this
change, but it will give us as maintainers a good chance to practice the email
based workflow with one of the most important postmarketOS git repositories.</p>
<p>Afterwards, in January of 2023 there&#39;s a chance to roll back if this experiment
failed. If it went well, we would move pmbootstrap issues and once the web UI
based patch review workflow is implemented, we would move pmaports.git and
everything else over as well.</p>
<h3 id="timeline"><a href="#timeline">Timeline</a></h3>
<h4 id="2022-08"><a href="#2022-08">2022-08</a></h4>
<ul>
<li>Migrate pmbootstrap.git repo (only the git repository, <em>not</em> the issues
  etc)</li>
<li>Adjust CI as necessary</li>
<li>Get comfortable with the patch workflow</li>
<li>By using it, find out what else would be missing for us</li>
</ul>
<h4 id="2022-12"><a href="#2022-12">2022-12</a></h4>
<ul>
<li>v22.12 release</li>
</ul>
<h4 id="2023-01"><a href="#2023-01">2023-01</a></h4>
<ul>
<li>Review the idea of moving to SourceHut based on experience with pmbootstrap.git<ul>
<li>If it failed: abort here, move pmbootstrap.git back to gitlab.com</li>
<li>We didn&#39;t move the issues or anything else, so it&#39;s easy</li>
</ul>
</li>
<li>Check if web based patch workflow is implemented enough<ul>
<li>If not, we work towards implementing it ourselves</li>
<li>Two months to implement before moving pmaports</li>
</ul>
</li>
</ul>
<h4 id="2023-02"><a href="#2023-02">2023-02</a></h4>
<ul>
<li>Import pmbootstrap issues</li>
<li>Archive pmbootstrap repo</li>
<li>pmbootstrap is now completely in sourcehut</li>
</ul>
<h4 id="2023-03"><a href="#2023-03">2023-03</a></h4>
<ul>
<li>Move pmaports.git + issues at the same time</li>
<li>Rewrite CI stuff, mrhlpr etc.</li>
<li>Add tools for local CI checks for patch workflow</li>
<li>Archive pmaports</li>
</ul>
<h4 id="2023-05"><a href="#2023-05">2023-05</a></h4>
<ul>
<li>Move all other repositories + issues (fine if takes more than a month)</li>
</ul>
<h4 id="2023-06"><a href="#2023-06">2023-06</a></h4>
<ul>
<li>v23.06 release</li>
</ul>
<h2 id="what-do-you-think"><a href="#what-do-you-think">What do you think?</a></h2>
<p>If you have contributed to postmarketOS in the past, we are really curious
about what you think about all of the above. Do you like the idea? Did we miss
something? What are your hopes and concerns? We would be happy to read your
feedback in
<a href="https://gitlab.com/postmarketOS/postmarketos/-/issues/49">postmarketos#49</a>.</p>
</article></div>
  </body>
</html>
