<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.veitheller.de/A_quick_apology_to_Dyalog_APL.html">Original</a>
    <h1>A quick apology to Dyalog APL</h1>
    
    <div id="readability-page-1" class="page"><div>
      <p>Today I get to do something that’s exceedingly fun for me: “well,
actually” my old self. In this case, I get to post a correction to my
recent Dyalog APL Sudoku solver.</p>
<p>A few days ago, <a href="https://apl.wiki/adam">Adám Brudzewsky</a>
from the Dyalog APL team reached out with detailed notes and a
cleaned-up rewrite. He had some very kind words about my solution, but
pointed out some things to improve, which is just incredible.</p>
<p>He also graciously granted me permission to quote and attribute, so
here we go.</p>
<h3 id="prelude-golf-isnt-apl-like">Prelude: Golf isn’t “APL-like”</h3>
<p>In the original post I leaned into golfing to make the code feel
“APL-like”. That aesthetic is definitely common online, but Adám
reminded me that it doesn’t have to be golfed to look APL-like, and that
production APL tends to be much less dense. That’s a fair point. I got
carried away a bit when shrinking my solution, and truth be told, it was
quite fun! But I feel like it’s important to point out that that’s
optional.</p>
<p>The more useful lesson is: APL rewards good representations. If you
pick shapes that align with array operations, the code often becomes
short without trying. I tried anyway, but I should disclose that it
isn’t a requirement for idiomatic APL.</p>
<h3 id="concrete-improvements">Concrete improvements</h3>
<p>Adám also came to me with some concrete improvements that I want to
dig into to make sure I understand them correctly.</p>
<p>Adám suggested a tighter <code>S</code> that removes redundant
parentheses (in line with <a href="https://abrudz.github.io/style/">his
style guide</a>), replaces my “find minimum” with a sort-based pick,
simplifies how <code>@</code> is applied, and uses a more tacit step for
picking the first solution:</p>
<pre><code>S←{
    b←P ⍵ ⋄ 0=≢b:⍬ ⋄ ~0∊b:b
    i←⍸0=b ⋄ cs←↑b∘C¨i ⋄ l←+/cs ⋄ k←⊃⍋l ⋄ idx←i[k]
    sols←⊂∘∇¨⊣@idx∘b¨cs[k;]/D
    ⊃(×∘≢∘⊃¨⍛/sols),⊂⍬
}</code></pre>
<p>I also got a nicer candidate function <code>C</code>: it avoids
explicit box-index arithmetic by extracting the 3x3 box via drop/take
(<code>↓</code>/<code>↑</code>), which reads very “APL” once you know
the idiom (which, uh, I didn’t really):</p>
<pre><code>C←{
    m←9 9⍴⍺ ⋄ r c←9 9⊤⍵
    ~D∊0~⍨∪m[r;],m[;c],,3 3↑(3×⌊r c÷3)↓m
}</code></pre>
<p>If you compare this to my original <code>C</code>, the big change is
that the box is obtained by:</p>
<ul>
<li>computing the box origin (<code>3×⌊r c÷3</code>)</li>
<li>dropping that many rows/cols (<code>↓m</code>)</li>
<li>taking a 3x3 (<code>3 3↑…</code>)</li>
</ul>
<p>Much cooler.</p>
<h3 id="one-note-on-boxing-and-unboxing">One note on boxing and
unboxing</h3>
<p>My original solver boxed <code>sols</code> just to unbox it again.
This was a defensive step against shooting myself in the foot with my
own limited understanding. Dyalog may sometimes mix same-shaped results
into a plain array because it can—and I don’t understand the rules it
follows completely—which breaks a pipeline that filters non-empty
solutions and then takes the first remaining one.</p>
<p>The rewrite above makes the selection step cleaner by doing away with
the need for explicit unboxing. It feels less brittle and is more
readable to boot!</p>
<h3 id="thanks-and-where-to-find-adám">Thanks, and where to find
Adám</h3>
<p>Thanks again to Adám for the review. He mentioned he’s reachable in
the <a href="https://apl.chat/">APL Orchard</a> (which I understand he
started!). He was exceedingly kind and helpful, so I encourage anyone
who’s even remotely interested in APL to hop in and say hi!</p>

      
    </div></div>
  </body>
</html>
