<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rwmj.wordpress.com/2023/06/14/i-booted-linux-292612-times/">Original</a>
    <h1>I booted Linux 293k times in 21 hours</h1>
    
    <div id="readability-page-1" class="page"><div id="post-8238">
	<p>

		June 14, 2023 · 9:42 am	</p><!-- .entry-meta -->

		
	
	<div>
		
<p>And it only took 21 hours.</p>



<p><a href="https://gitlab.com/qemu-project/qemu/-/issues/1696">Linux 6.4 has a bug where it hangs on boot</a>, but probably only 1 in 1000 boots (and rarer if using Intel hardware for some reason).  It’s surprising to me that no one has noticed this, but I certainly did because our <a href="https://gitlab.com/nbdkit/nbdkit">nbdkit</a> tests which use <a href="https://libguestfs.org/">libguestfs</a> were randomly hanging, always at the same place early in booting the libguestfs qemu appliance:</p>



<pre><code>[    0.070120] Freeing SMP alternatives memory: 48K</code></pre>



<p>So to bisect this I had to run guestfish in a loop until it either hangs or doesn’t.  How many times?  I chose 10,000 boots as a good threshold.  To make this easier I <a href="https://gitlab.com/qemu-project/qemu/-/issues/1696#note_1428829389">wrote a test harness</a> which uses up to 8 threads and parses the output to detect the hang.</p>



<p>After a painful bisection between v6.0 and v6.4-rc6 which took many days I found the culprit, a regression in the printk time feature: <a href="https://lkml.org/lkml/2023/6/13/733">https://lkml.org/lkml/2023/6/13/733</a> </p>



<p>To prove it I booted Linux 292,612 times before the faulty commit (successfully), and then after (failed after under 1,000 boots).</p>
	</div><!-- .entry-content -->

	<!-- .entry-links -->

</div></div>
  </body>
</html>
