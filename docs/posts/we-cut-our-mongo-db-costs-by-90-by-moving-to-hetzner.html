<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://prosopo.io/blog/we-cut-our-mongodb-costs-by-90-percent/">Original</a>
    <h1>We cut our Mongo DB costs by 90% by moving to Hetzner</h1>
    
    <div id="readability-page-1" class="page"><div><div><div><p>Running databases in the cloud can be convenient, but it can also get expensive fast. For the Prosopo team, MongoDB Atlas was initially a fast, reliable way to run a cloud database, but as our data grew, so did the bills. Over the last year, we realised that we were spending <em>thousands of dollars</em> per month on infrastructure that we could run more efficiently ourselves. We explored various options but ultimately decided to migrate our MongoDB deployment to Hetzner, a cost-effective cloud provider.</p><p>Here&#39;s how we managed to cut our costs by 90% without sacrificing performance or reliability.</p><h2 id="starting-with-mongodb-atlas-for-free-but-scaling-costs-added-up" tabindex="-1"><a href="#starting-with-mongodb-atlas-for-free-but-scaling-costs-added-up">Starting with MongoDB Atlas for <em>Free</em> but Scaling Costs Added Up</a></h2><p>When we first started building, MongoDB Atlas was an easy choice. Everything was set up for us, and we could focus on building our application without worrying about database management. The free tier was sufficient for our initial needs, and as we grew, scaling up was as simple as a few clicks. However, scaling came with a steep price tag. We went from paying $0 per month for a small database to over $3,000 per month for a few hundred GBs of data. The cost breakdown before we migrated looked roughly like this:</p><table><thead><tr><th>Service</th><th>Monthly Cost</th><th></th></tr></thead><tbody><tr><td>Atlas M40 Instance - AWS</td><td>$1000</td><td></td></tr><tr><td>Atlas Continuous Cloud Backup Storage</td><td>$700</td><td></td></tr><tr><td>Atlas AWS Data Transfer (Same Region)</td><td>$10</td><td></td></tr><tr><td>Atlas AWS Data Transfer (Different Region)</td><td>$1</td><td></td></tr><tr><td>Atlas AWS Data Transfer (Internet)</td><td>$1,000</td><td>‚ùó</td></tr><tr><td>Total + VAT</td><td>$3000+</td><td></td></tr></tbody></table><p>The more keen eyed among you will have noticed the huge cost associated with data transfer over the internet - its as much as the servers! We&#39;re building Prosopo to be resilient to outages, such as the recent <a href="https://www.msn.com/en-us/news/other/heres-what-experts-say-the-aws-outage-reveals-about-the-cloud/ar-AA1OUxC6">massive AWS outage</a>, so we use many different cloud providers. This means that a lot of our database traffic goes over the internet, which is very expensive on MongoDB Atlas, due to it running on AWS (other options are available, but we chose AWS).</p><p>When your entire stack is on AWS, data transfer costs are minimal, as shown by the &#34;Same Region&#34; line item above. However, this architecture creates <a href="https://scisimple.com/en/articles/2025-07-23-measuring-internet-centralization-a-new-approach--a9rgqe5">centralisation and single points of failure</a>, which we want to avoid.</p><p>Oh, and even though we were paying this much, we didn&#39;t have access to any support! That&#39;s a separate paid plan.</p><h2 id="why-we-chose-hetzner" tabindex="-1"><a href="#why-we-chose-hetzner">Why We Chose Hetzner</a></h2><p>Hetzner offered a compelling alternative:</p><ul><li><strong>High-performance dedicated servers</strong> at a fraction of AWS pricing</li><li><strong>Predictable, flat-rate pricing</strong> without surprise bills</li><li><strong>Strong European data center presence</strong>, which aligns with our privacy requirements</li><li><strong>No Data Transfer fees</strong> between our application servers and database</li></ul><p>We decided that the only way to regain control over our costs was to move to a self-hosted solution. MongoDB Atlas was running in replica set mode but we opted to instead set up a much beefier machine with a huge amount of RAM (256GB) and fast SSDs to handle our workload. In future, if we want to move back to a distributed setup, we can always add more nodes.</p><p><strong>The server in question costs $160 per month</strong>, which is a huge saving over our previous costs.</p><h2 id="migration" tabindex="-1"><a href="#migration">Migration</a></h2><p>Our Atlas instance held about 500GB of data but the product doesn&#39;t rely on this data in real-time - its used for generating detection rules using ML modelling, and the rules are applied to our CAPTCHA providers in a follow-up step. The reason for this architecture stems from our <a href="https://prosopo.io/blog/prosopo-web3-foundation-grant/">blockchain beginnings</a>.</p><p><img src="https://prosopo.io/static/mongo-provider-architecture.webp" alt="MongoDB Provider Architecture"/></p><p>We were able to take a mongodump of the database, restore it to the new Hetzner server, and then use scripts to sync any changes that happened during the migration window.</p><p>Setting up our Hetzner server wasn&#39;t just a matter of spinning up MongoDB. We run Proxmox on the host machine, created an Ubuntu VM, and deployed MongoDB in Docker. Networking added another layer of complexity: the VM sits on a private subnet (10.0.0.x) with the host handling DHCP, NAT, and port forwarding. We also use Traefik as a reverse proxy to handle SSL and route traffic from the outside world to MongoDB, which saves us from wrestling with MongoDB&#39;s own SSL certificates. While this setup gives us flexibility and security, it does require a bit more technical know-how compared to fully managed solutions.</p><h2 id="things-you&#39;ll-need-to-do-yourself" tabindex="-1"><a href="#things-you&#39;ll-need-to-do-yourself">Things You&#39;ll Need To Do Yourself</a></h2><p>When you migrate from MongoAtlas to a self-hosted solution, you&#39;re taking on more responsibility for managing your database. You need to make sure it is secure, backed up, monitored, and can be recreated in case of failure or the need for extra servers arises. We used the following tools:</p><table><thead><tr><th>Tool</th><th>Purpose</th></tr></thead><tbody><tr><td><a href="https://docs.ansible.com/">Ansible</a></td><td>Automated server provisioning</td></tr><tr><td><a href="https://www.docker.com/">Docker</a></td><td>Running MongoDB in a container</td></tr><tr><td><a href="https://www.mongodb.com/docs/database-tools/mongodump/">mongodump</a></td><td>Backup CLI tool</td></tr><tr><td><a href="https://openobserve.ai/">OpenObserve</a></td><td>Log aggregation and alerting</td></tr><tr><td><a href="https://help.ubuntu.com/community/UFW">UFW</a></td><td>Firewall management</td></tr><tr><td><a href="https://www.wireguard.com/">WireGuard</a></td><td>Secure connections over VPN</td></tr></tbody></table><p>The monitoring in MongoDB Atlas was very useful. It highlighted times when we were opening up unlimited connections due to connection leaks in our application code. However, <strong>MongoDB Atlas wouldn&#39;t let us kill the connections using admin shell commands</strong>! This meant we reached our connection limit and we had no way to restart the server. We had to kill our services to free up connections. With our own server, we can now monitor and manage connections directly via <a href="https://openobserve.ai/">OpenObserve</a> and, crucially, the MongoDB shell.</p><p>Backups in MongoDB Atlas were also convenient but expensive. We now use <code>mongodump</code>, a cron, and a storage box from Hetzner to take daily backups of our database. The backups are compressed and encrypted before being sent to the remote storage box.</p><h2 id="conclusion" tabindex="-1"><a href="#conclusion">Conclusion</a></h2><p>We&#39;ve opted for a DIY approach to our servers and databases, which has significantly reduced our costs whilst giving us more control over our infrastructure. However, this approach isn&#39;t for everyone. We&#39;re still a small team, and managing the limited number of servers we run is feasible.</p><p>The performance we&#39;re seeing from our new standalone MongoDB server is very much improved over the Atlas setup. This is simply because the specs are so much higher and the indexes can mostly be held in memory. We are aware that MongoDB Atlas has something called vector search but we weren&#39;t using it, so it wasn&#39;t a factor in our decision.</p><p>For reference, the specs look like this:</p><table><thead><tr><th>Specification</th><th>Atlas M40 Instance</th><th>Hetzner Dedicated Server</th></tr></thead><tbody><tr><td>CPU</td><td>8 vCPU</td><td>8 cores Intel Xeon W-2145</td></tr><tr><td>RAM</td><td>16 GB</td><td>256 GB</td></tr><tr><td>Storage</td><td>380 GB SSD</td><td>4 x 3.84 TB NVMe SSD RAID 5</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><p>Its more than likely that as we grow, we&#39;ll start to see value in hosted solutions again, but for now we&#39;re quite pleased with the new setup. Hopefully this experience helps to inform others starting out on their cloud journey - for a small amount of pain you can save a lot of money!</p></div></div></div></div>
  </body>
</html>
