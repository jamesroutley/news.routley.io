<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.richard-towers.com/2025/02/16/representing-graphs-in-postgres.html">Original</a>
    <h1>Representing Graphs in PostgreSQL</h1>
    
    <div id="readability-page-1" class="page"><p>Let’s say we’ve got some graph-like data, such as a social network.</p><div><div><pre><code><span>create</span> <span>table</span> <span>nodes</span> <span>(</span>
  <span>id</span> <span>serial</span> <span>primary</span> <span>key</span><span>,</span>
  <span>name</span> <span>text</span><span>,</span>
  <span>details</span> <span>jsonb</span>
<span>);</span>

<span>create</span> <span>table</span> <span>edges</span> <span>(</span>
  <span>id</span> <span>serial</span> <span>primary</span> <span>key</span><span>,</span>
  <span>type</span> <span>text</span><span>,</span>
  <span>from_id</span> <span>integer</span> <span>references</span> <span>nodes</span><span>(</span><span>id</span><span>),</span>
  <span>to_id</span> <span>integer</span> <span>references</span> <span>nodes</span><span>(</span><span>id</span><span>),</span>
  <span>details</span> <span>jsonb</span>
<span>);</span>
</code></pre></div></div><div><div><pre><code><span>insert</span> <span>into</span> <span>nodes</span> <span>(</span><span>name</span><span>,</span> <span>details</span><span>)</span> <span>values</span>
  <span>(</span><span>&#39;Frodo Baggins&#39;</span><span>,</span> <span>&#39;{&#34;species&#34;: &#34;Hobbit&#34;}&#39;</span><span>),</span> <span>-- 1</span>
  <span>(</span><span>&#39;Bilbo Baggins&#39;</span><span>,</span> <span>&#39;{&#34;species&#34;: &#34;Hobbit&#34;}&#39;</span><span>),</span> <span>-- 2</span>
  <span>(</span><span>&#39;Samwise Gamgee&#39;</span><span>,</span> <span>&#39;{&#34;species&#34;: &#34;Hobbit&#34;}&#39;</span><span>),</span> <span>-- 3</span>
  <span>(</span><span>&#39;Hamfast Gamgee&#39;</span><span>,</span> <span>&#39;{&#34;species&#34;: &#34;Hobbit&#34;}&#39;</span><span>),</span> <span>-- 4</span>
  <span>(</span><span>&#39;Gandalf&#39;</span><span>,</span> <span>&#39;{&#34;species&#34;: &#34;Wizard&#34;}&#39;</span><span>),</span> <span>-- 5</span>
  <span>(</span><span>&#39;Aragorn&#39;</span><span>,</span> <span>&#39;{&#34;species&#34;: &#34;Human&#34;}&#39;</span><span>),</span> <span>-- 6</span>
  <span>(</span><span>&#39;Arathorn&#39;</span><span>,</span> <span>&#39;{&#34;species&#34;: &#34;Human&#34;}&#39;</span><span>),</span> <span>-- 7</span>
  <span>(</span><span>&#39;Legolas&#39;</span><span>,</span> <span>&#39;{&#34;species&#34;: &#34;Elf&#34;}&#39;</span><span>),</span> <span>-- 8</span>
  <span>(</span><span>&#39;Thranduil&#39;</span><span>,</span> <span>&#39;{&#34;species&#34;: &#34;Elf&#34;}&#39;</span><span>),</span> <span>-- 9</span>
  <span>(</span><span>&#39;Gimli&#39;</span><span>,</span> <span>&#39;{&#34;species&#34;: &#34;Dwarf&#34;}&#39;</span><span>),</span> <span>-- 10</span>
  <span>(</span><span>&#39;Gloin&#39;</span><span>,</span> <span>&#39;{&#34;species&#34;: &#34;Dwarf&#34;}&#39;</span><span>);</span> <span>-- 11</span>

<span>-- Parents</span>
<span>insert</span> <span>into</span> <span>edges</span> <span>(</span><span>type</span><span>,</span> <span>from_id</span><span>,</span> <span>to_id</span><span>,</span> <span>details</span><span>)</span> <span>values</span>
  <span>(</span><span>&#39;parent&#39;</span><span>,</span> <span>2</span><span>,</span> <span>1</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span>
  <span>(</span><span>&#39;parent&#39;</span><span>,</span> <span>4</span><span>,</span> <span>3</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span>
  <span>(</span><span>&#39;parent&#39;</span><span>,</span> <span>7</span><span>,</span> <span>6</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span>
  <span>(</span><span>&#39;parent&#39;</span><span>,</span> <span>9</span><span>,</span> <span>8</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span>
  <span>(</span><span>&#39;parent&#39;</span><span>,</span> <span>11</span><span>,</span> <span>10</span><span>,</span> <span>&#39;{}&#39;</span><span>);</span>
</code></pre></div></div><p>We can find someone’s parents by joining the <code>edges</code> table to the <code>nodes</code> table.</p><div><div><pre><code><span>select</span> <span>parent</span><span>.</span><span>name</span> <span>from</span> <span>nodes</span> <span>child</span>
<span>join</span> <span>edges</span> <span>on</span> <span>edges</span><span>.</span><span>to_id</span> <span>=</span> <span>child</span><span>.</span><span>id</span>
<span>join</span> <span>nodes</span> <span>parent</span> <span>on</span> <span>edges</span><span>.</span><span>from_id</span> <span>=</span> <span>parent</span><span>.</span><span>id</span>
<span>where</span> <span>child</span><span>.</span><span>id</span> <span>=</span> <span>3</span><span>;</span>
</code></pre></div></div><div><div><pre><code><span>with</span> <span>child</span> <span>as</span> <span>(</span><span>select</span> <span>id</span> <span>from</span> <span>nodes</span> <span>where</span> <span>name</span> <span>=</span> <span>&#39;Samwise Gamgee&#39;</span><span>)</span>
<span>select</span> <span>parent</span><span>.</span><span>name</span> <span>from</span> <span>child</span>
<span>join</span> <span>edges</span> <span>on</span> <span>edges</span><span>.</span><span>to_id</span> <span>=</span> <span>child</span><span>.</span><span>id</span>
<span>join</span> <span>nodes</span> <span>parent</span> <span>on</span> <span>edges</span><span>.</span><span>from_id</span> <span>=</span> <span>parent</span><span>.</span><span>id</span><span>;</span>
</code></pre></div></div><p>Not all of our characters knew each other directly. The friendship graph is a bit more complex:</p><div><div><pre><code><span>insert</span> <span>into</span> <span>edges</span> <span>(</span><span>type</span><span>,</span> <span>from_id</span><span>,</span> <span>to_id</span><span>,</span> <span>details</span><span>)</span> <span>values</span>
  <span>-- Everyone in the fellowship is friends with everyone else</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>1</span><span>,</span> <span>3</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Frodo and Sam</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>1</span><span>,</span> <span>5</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Frodo and Gandalf</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>1</span><span>,</span> <span>6</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Frodo and Aragorn</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>1</span><span>,</span> <span>8</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Frodo and Legolas</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>1</span><span>,</span> <span>10</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Frodo and Gimli</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>3</span><span>,</span> <span>1</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Sam and Frodo</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>3</span><span>,</span> <span>5</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Sam and Gandalf</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>3</span><span>,</span> <span>6</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Sam and Aragorn</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>3</span><span>,</span> <span>8</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Sam and Legolas</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>3</span><span>,</span> <span>10</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Sam and Gimli</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>5</span><span>,</span> <span>1</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gandalf and Frodo</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>5</span><span>,</span> <span>3</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gandalf and Sam</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>5</span><span>,</span> <span>6</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gandalf and Aragorn</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>5</span><span>,</span> <span>8</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gandalf and Legolas</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>5</span><span>,</span> <span>10</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gandalf and Gimli</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>6</span><span>,</span> <span>1</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Aragorn and Frodo</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>6</span><span>,</span> <span>3</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Aragorn and Sam</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>6</span><span>,</span> <span>5</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Aragorn and Gandalf</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>6</span><span>,</span> <span>8</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Aragorn and Legolas</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>6</span><span>,</span> <span>10</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Aragorn and Gimli</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>8</span><span>,</span> <span>1</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Legolas and Frodo</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>8</span><span>,</span> <span>3</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Legolas and Sam</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>8</span><span>,</span> <span>5</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Legolas and Gandalf</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>8</span><span>,</span> <span>6</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Legolas and Aragorn</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>8</span><span>,</span> <span>10</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Legolas and Gimli</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>10</span><span>,</span> <span>1</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gimli and Frodo</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>10</span><span>,</span> <span>3</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gimli and Sam</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>10</span><span>,</span> <span>5</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gimli and Gandalf</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>10</span><span>,</span> <span>6</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gimli and Aragorn</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>10</span><span>,</span> <span>8</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gimli and Legolas</span>
  <span>-- Bilbo was friends with Hamfast and Gandalf</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>2</span><span>,</span> <span>4</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Bilbo and Hamfast</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>2</span><span>,</span> <span>5</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Bilbo and Gandalf</span>
  <span>-- And vice versa</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>4</span><span>,</span> <span>2</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Hamfast and Bilbo</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>5</span><span>,</span> <span>2</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gandalf and Bilbo</span>
  <span>-- Gandalf was friends with Bilbo, Hamfast and Thranduil, but for the sake of</span>
  <span>-- argument let&#39;s say he didn&#39;t know Gloin or Arathorn</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>5</span><span>,</span> <span>2</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gandalf and Bilbo</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>5</span><span>,</span> <span>4</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gandalf and Hamfast</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>5</span><span>,</span> <span>9</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Gandalf and Thranduil</span>
  <span>-- And vice versa</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>2</span><span>,</span> <span>5</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Bilbo and Gandalf</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>&#39;{}&#39;</span><span>),</span> <span>-- Hamfast and Gandalf</span>
  <span>(</span><span>&#39;friend&#39;</span><span>,</span> <span>9</span><span>,</span> <span>5</span><span>,</span> <span>&#39;{}&#39;</span><span>);</span> <span>-- Thranduil and Gandalf</span>
</code></pre></div></div><p>We could follow two friendship links using CTEs like before. Let’s say friends of friends of Samwise:</p><div><div><pre><code><span>with</span> <span>samwise</span> <span>as</span> <span>(</span><span>select</span> <span>id</span> <span>from</span> <span>nodes</span> <span>where</span> <span>name</span> <span>=</span> <span>&#39;Samwise Gamgee&#39;</span><span>),</span>
<span>samwise_friends</span> <span>as</span> <span>(</span>
  <span>select</span> <span>distinct</span> <span>edges</span><span>.</span><span>to_id</span> <span>from</span> <span>edges</span>
  <span>join</span> <span>samwise</span> <span>on</span> <span>edges</span><span>.</span><span>from_id</span> <span>=</span> <span>samwise</span><span>.</span><span>id</span> <span>and</span> <span>edges</span><span>.</span><span>type</span> <span>=</span> <span>&#39;friend&#39;</span>
<span>),</span>
<span>friends_of_friends</span> <span>as</span> <span>(</span>
  <span>select</span> <span>distinct</span> <span>edges</span><span>.</span><span>to_id</span> <span>from</span> <span>edges</span>
  <span>join</span> <span>samwise_friends</span> <span>on</span> <span>edges</span><span>.</span><span>from_id</span> <span>=</span> <span>samwise_friends</span><span>.</span><span>to_id</span> <span>and</span> <span>edges</span><span>.</span><span>type</span> <span>=</span> <span>&#39;friend&#39;</span>
<span>)</span>
<span>select</span> <span>name</span> <span>from</span> <span>friends_of_friends</span> <span>join</span> <span>nodes</span> <span>on</span> <span>nodes</span><span>.</span><span>id</span> <span>=</span> <span>friends_of_friends</span><span>.</span><span>to_id</span><span>;</span>
</code></pre></div></div><p>This returns almost everyone, except for Arathorn and Gloin who we’ve decided weren’t friends with anyone Samwise knew
(even though they probably knew Gandalf, in reality).</p><p>If we don’t mind building up arbitrarily long chains of CTEs, we can follow any number of edges using this technique.</p><p>It would be kind of nice to be able to pass in the root node and the edge paths as parameters though, rather than
dynamically building up the CTEs.</p><p>Let’s say we want to find the parents of the friends-of-friends of Samwise.</p><div><div><pre><code><span>with</span> <span>samwise</span> <span>as</span> <span>(</span><span>select</span> <span>id</span> <span>from</span> <span>nodes</span> <span>where</span> <span>name</span> <span>=</span> <span>&#39;Samwise Gamgee&#39;</span><span>),</span>
<span>samwise_friends</span> <span>as</span> <span>(</span>
  <span>select</span> <span>distinct</span> <span>edges</span><span>.</span><span>to_id</span> <span>from</span> <span>edges</span>
  <span>join</span> <span>samwise</span> <span>on</span> <span>edges</span><span>.</span><span>from_id</span> <span>=</span> <span>samwise</span><span>.</span><span>id</span> <span>and</span> <span>edges</span><span>.</span><span>type</span> <span>=</span> <span>&#39;friend&#39;</span>
<span>),</span>
<span>friends_of_friends</span> <span>as</span> <span>(</span>
  <span>select</span> <span>distinct</span> <span>edges</span><span>.</span><span>to_id</span> <span>from</span> <span>edges</span>
  <span>join</span> <span>samwise_friends</span> <span>on</span> <span>edges</span><span>.</span><span>from_id</span> <span>=</span> <span>samwise_friends</span><span>.</span><span>to_id</span> <span>and</span> <span>edges</span><span>.</span><span>type</span> <span>=</span> <span>&#39;friend&#39;</span>
<span>),</span>
<span>friends_of_friends_parents</span> <span>as</span> <span>(</span>
  <span>select</span> <span>distinct</span> <span>edges</span><span>.</span><span>from_id</span> <span>from</span> <span>edges</span>
  <span>join</span> <span>friends_of_friends</span> <span>on</span> <span>edges</span><span>.</span><span>to_id</span> <span>=</span> <span>friends_of_friends</span><span>.</span><span>to_id</span> <span>and</span> <span>edges</span><span>.</span><span>type</span> <span>=</span> <span>&#39;parent&#39;</span>
<span>)</span>
<span>select</span> <span>name</span> <span>from</span> <span>friends_of_friends_parents</span> <span>join</span> <span>nodes</span> <span>on</span> <span>nodes</span><span>.</span><span>id</span> <span>=</span> <span>friends_of_friends_parents</span><span>.</span><span>from_id</span><span>;</span>
</code></pre></div></div><p>But this quickly becomes unwieldy. Instead, let’s pull the variable bits out, and use a recursive CTE:</p><div><div><pre><code><span>with</span> <span>recursive</span> 
<span>root</span><span>(</span><span>id</span><span>)</span> <span>as</span> <span>(</span><span>select</span> <span>id</span> <span>from</span> <span>nodes</span> <span>where</span> <span>name</span> <span>=</span> <span>&#39;Samwise Gamgee&#39;</span><span>),</span>
<span>paths</span><span>(</span><span>path</span><span>)</span> <span>as</span> <span>(</span><span>values</span> <span>(</span><span>&#39;{friend,friend,parent}&#39;</span><span>::</span><span>text</span><span>[])),</span>
<span>results</span><span>(</span><span>id</span><span>)</span> <span>as</span> <span>(</span>
  <span>select</span> <span>root</span><span>.</span><span>id</span><span>,</span> <span>1</span> <span>as</span> <span>path_index</span> <span>from</span> <span>root</span>
<span>union</span>
  <span>select</span> <span>edges</span><span>.</span><span>from_id</span><span>,</span> <span>path_index</span> <span>+</span> <span>1</span> <span>as</span> <span>path_index</span> <span>from</span> <span>results</span>
  <span>join</span> <span>edges</span> <span>on</span> <span>edges</span><span>.</span><span>to_id</span> <span>=</span> <span>results</span><span>.</span><span>id</span>
  <span>join</span> <span>paths</span> <span>on</span> <span>edges</span><span>.</span><span>type</span> <span>=</span> <span>paths</span><span>.</span><span>path</span><span>[</span><span>path_index</span><span>]</span>
<span>)</span>
<span>select</span> <span>*</span> <span>from</span> <span>results</span>
<span>join</span> <span>nodes</span> <span>on</span> <span>nodes</span><span>.</span><span>id</span> <span>=</span> <span>results</span><span>.</span><span>id</span>
<span>join</span> <span>paths</span> <span>on</span> <span>cardinality</span><span>(</span><span>paths</span><span>.</span><span>path</span><span>)</span> <span>+</span> <span>1</span> <span>=</span> <span>results</span><span>.</span><span>path_index</span><span>;</span>
</code></pre></div></div><p>This can then be parameterised, so we can create this as a prepared statement and call it lots of times with
different root nodes and paths.</p><div><div><pre><code><span>with</span> <span>recursive</span> 
<span>root</span><span>(</span><span>id</span><span>)</span> <span>as</span> <span>(</span><span>select</span> <span>id</span> <span>from</span> <span>nodes</span> <span>where</span> <span>name</span> <span>=</span> <span>?</span><span>),</span>
<span>paths</span><span>(</span><span>path</span><span>)</span> <span>as</span> <span>(</span><span>values</span> <span>(</span><span>?</span><span>::</span><span>text</span><span>[])),</span>
<span>results</span><span>(</span><span>id</span><span>)</span> <span>as</span> <span>(</span>
  <span>select</span> <span>root</span><span>.</span><span>id</span><span>,</span> <span>1</span> <span>as</span> <span>path_index</span> <span>from</span> <span>root</span>
<span>union</span>
  <span>select</span> <span>edges</span><span>.</span><span>from_id</span><span>,</span> <span>path_index</span> <span>+</span> <span>1</span> <span>as</span> <span>path_index</span> <span>from</span> <span>results</span>
  <span>join</span> <span>edges</span> <span>on</span> <span>edges</span><span>.</span><span>to_id</span> <span>=</span> <span>results</span><span>.</span><span>id</span>
  <span>join</span> <span>paths</span> <span>on</span> <span>edges</span><span>.</span><span>type</span> <span>=</span> <span>paths</span><span>.</span><span>path</span><span>[</span><span>path_index</span><span>]</span>
<span>)</span>
<span>select</span> <span>*</span> <span>from</span> <span>results</span>
<span>join</span> <span>nodes</span> <span>on</span> <span>nodes</span><span>.</span><span>id</span> <span>=</span> <span>results</span><span>.</span><span>id</span>
<span>join</span> <span>paths</span> <span>on</span> <span>cardinality</span><span>(</span><span>paths</span><span>.</span><span>path</span><span>)</span> <span>+</span> <span>1</span> <span>=</span> <span>results</span><span>.</span><span>path_index</span><span>;</span>
</code></pre></div></div><p>If we wanted every node along the path, instead of just the end node, we could remove the join to <code>paths</code> in the final
line.</p><p>This is one way of representing graph-like data in Postgresql, and querying it in a flexible way.</p><p>I’d be very interested in hearing about other techniques or improvements.</p></div>
  </body>
</html>
