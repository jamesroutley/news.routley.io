<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/waj/shell-secrets">Original</a>
    <h1>Shell-secrets â€“ GPG-encrypted environment variables</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">This is a small tool to set environment variables from encrypted (with GPG) files</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/22697/74163644-6e741100-4c01-11ea-8c10-41c53d21eba0.gif"><img src="https://user-images.githubusercontent.com/22697/74163644-6e741100-4c01-11ea-8c10-41c53d21eba0.gif" alt="shell-secrets" data-animated-image=""/></a></p>
<p dir="auto">There are many command line tools that require environment variables with secret values to work.
These values are often saved in unencrypted shell files. I created this simple but useful script
to read secret values from encrypted files and at the same time make it easy to login in and out
from diferent accounts.</p>

<p dir="auto"><strong>NOTICE</strong>: GPG is assumed to be installed and configured for the current user.</p>
<p dir="auto">Copy the <code>shell-secrets.sh</code> file anywhere in your disk. Add the following line in your profile shell script:</p>
<div data-snippet-clipboard-copy-content="source /path/to/shell-secrets.sh"><pre><code>source /path/to/shell-secrets.sh
</code></pre></div>
<p dir="auto">Also is recommended to modify the shell prompt to display the current login. For example this
can be inserted in your <code>PS1</code> variable:</p>
<div data-snippet-clipboard-copy-content="export PS1=&#39;... \e[31m$SECRET_LOGIN\e[0m ...&#39;"><pre><code>export PS1=&#39;... \e[31m$SECRET_LOGIN\e[0m ...&#39;
</code></pre></div>
<p dir="auto">The variable <code>$SECRET_LOGIN</code> keeps the list of account names being used in the current shell.</p>


<p dir="auto">First, make sure the <code>~/.shell-secrets/</code> directory exists. This is where encrypted files will be stored:</p>
<div data-snippet-clipboard-copy-content="mkdir -p ~/.shell-secrets"><pre><code>mkdir -p ~/.shell-secrets
</code></pre></div>
<p dir="auto">Now create new encrypted files using GPG:</p>
<div data-snippet-clipboard-copy-content="$ gpg --encrypt -r yourself@some.email.com --armor --output ~/.shell-secrets/foo.gpg
export FOO=E9yyQ7MApwoQHXBCIs7or5aQ9W
export BAR=lLvxSCbY4j+Kdn
...
^D"><pre><code>$ gpg --encrypt -r yourself@some.email.com --armor --output ~/.shell-secrets/foo.gpg
export FOO=E9yyQ7MApwoQHXBCIs7or5aQ9W
export BAR=lLvxSCbY4j+Kdn
...
^D
</code></pre></div>
<p dir="auto">Done!</p>

<p dir="auto">To login using any of the encrypted files, just call the <code>login</code> function with the file name (without the <code>.gpg</code> extension)</p>
<div data-snippet-clipboard-copy-content="$ login foo
foo $ env
...
FOO=E9yyQ7MApwoQHXBCIs7or5aQ9W
BAR=lLvxSCbY4j+Kdn
..."><pre><code>$ login foo
foo $ env
...
FOO=E9yyQ7MApwoQHXBCIs7or5aQ9W
BAR=lLvxSCbY4j+Kdn
...
</code></pre></div>
<p dir="auto">The enviroment variables are set and ready to be used and the <code>SECRET_LOGIN</code> environment variable is updated to be used by the prompt. The script also includes autocomplete for the
available file names in the <code>.shell-secrets</code> directory.</p>
<p dir="auto">Several logins can also be nested:</p>
<div data-snippet-clipboard-copy-content="$ login foo
foo $ login bar
foo bar $"><pre><code>$ login foo
foo $ login bar
foo bar $
</code></pre></div>

<p dir="auto">Every time the <code>login</code> function is used, a new sub-shell process is created. To logout from the current
account, call <code>logout</code> or just press <code>Ctrl+D</code>.</p>
</article></div></div>
  </body>
</html>
