<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tangled.sh/@rockorager.dev/lsr">Original</a>
    <h1>lsr: ls with io_uring</h1>
    
    <div id="readability-page-1" class="page"><div>
    

    <section>
        <nav>
            
        </nav>
        <section>
            
    <main>
        
            
    

        
        
        
    </main>

        </section>
        <section>
            <article>
<p><code>ls(1)</code> but with io_uring</p>
<p><img src="https://camo.tangled.sh/2c623797d5efb3148d8aa7dd5ed5d88f40461a2243f9cde482faffe8e3d36484/68747470733a2f2f6b6e6f74312e74616e676c65642e73682f6469643a706c633a766b3262656d737233757861773466647a6e6f33636873682f6c73722f7261772f6d61696e2f73637265656e73686f742e706e67" alt="screenshot"/></p>
<h2 id="installation">Installation</h2>
<p><code>lsr</code> uses the zig build system. To install, you will need zig 0.14.0. To
install for the local user (assuming <code>$HOME/.local/bin</code> is in <code>$PATH</code>), run:</p>
<pre><code>zig build -Doptimize=ReleaseSmall --prefix $HOME/.local
</code></pre>
<p>which will install <code>lsr</code> and the associated manpage appropriately. Replace
<code>$HOME/.local</code> with your preferred installation directory.</p>
<h2 id="usage">Usage</h2>
<pre><code>lsr [options] [path]

  --help                           Print this message and exit
  --version                        Print the version string

DISPLAY OPTIONS
  -1, --oneline                    Print entries one per line
  -a, --all                        Show files that start with a dot (ASCII 0x2E)
  -A, --almost-all                 Like --all, but skips implicit &#34;.&#34; and &#34;..&#34; directories
  -C, --columns                    Print the output in columns
      --color=WHEN                 When to use colors (always, auto, never)
      --group-directories-first    Print all directories before printing regular files
      --hyperlinks=WHEN            When to use OSC 8 hyperlinks (always, auto, never)
      --icons=WHEN                 When to display icons (always, auto, never)
  -l, --long                       Display extended file metadata
  -r, --reverse                    Reverse the sort order
  -t, --time                       Sort the entries by modification time, most recent first

</code></pre>
<h2 id="benchmarks">Benchmarks</h2>
<p>Benchmarks were all gathered on the same set of directories, using the latest
releases of each program (versions are shown below). All benchmarks run on Linux
(because io_uring). <code>lsr</code> does work on macOS/BSD as well, but will not see the
syscall batching benefits that are available with io_uring.</p>
<table>
<thead>
<tr>
<th>Program</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>lsr</td>
<td>0.1.0</td>
</tr>
<tr>
<td>ls</td>
<td>9.7</td>
</tr>
<tr>
<td>eza</td>
<td>0.21.3</td>
</tr>
<tr>
<td>lsd</td>
<td>1.1.5</td>
</tr>
<tr>
<td>uutils</td>
<td>0.0.30</td>
</tr>
<tr>
<td>busybox</td>
<td>1.36.1</td>
</tr>
</tbody>
</table>
<h3 id="time">Time</h3>
<p>Data gathered with <code>hyperfine</code> on a directory of <code>n</code> plain files.</p>
<table>
<thead>
<tr>
<th>Program</th>
<th>n=10</th>
<th>n=100</th>
<th>n=1,000</th>
<th>n=10,000</th>
</tr>
</thead>
<tbody>
<tr>
<td>lsr -al</td>
<td>372.6 µs</td>
<td>634.3 µs</td>
<td>2.7 ms</td>
<td>22.1 ms</td>
</tr>
<tr>
<td>busybox ls -al</td>
<td>403.8 µs</td>
<td>1.1 ms</td>
<td>3.5 ms</td>
<td>32.5 ms</td>
</tr>
<tr>
<td>ls -al</td>
<td>1.4 ms</td>
<td>1.7 ms</td>
<td>4.7 ms</td>
<td>38.0 ms</td>
</tr>
<tr>
<td>eza -al</td>
<td>2.9 ms</td>
<td>3.3 ms</td>
<td>6.6 ms</td>
<td>40.2 ms</td>
</tr>
<tr>
<td>lsd -al</td>
<td>2.1 ms</td>
<td>3.5 ms</td>
<td>17.0 ms</td>
<td>153.4 ms</td>
</tr>
<tr>
<td>uutils ls -al</td>
<td>2.9 ms</td>
<td>3.6 ms</td>
<td>11.3 ms</td>
<td>89.6 ms</td>
</tr>
</tbody>
</table>
<h3 id="syscalls">Syscalls</h3>
<p>Data gathered with <code>strace -c</code> on a directory of <code>n</code> plain files. (Lower is better)</p>
<table>
<thead>
<tr>
<th>Program</th>
<th>n=10</th>
<th>n=100</th>
<th>n=1,000</th>
<th>n=10,000</th>
</tr>
</thead>
<tbody>
<tr>
<td>lsr -al</td>
<td>20</td>
<td>28</td>
<td>105</td>
<td>848</td>
</tr>
<tr>
<td>busybox ls -al</td>
<td>84</td>
<td>410</td>
<td>2,128</td>
<td>20,383</td>
</tr>
<tr>
<td>ls -al</td>
<td>405</td>
<td>675</td>
<td>3,377</td>
<td>30,396</td>
</tr>
<tr>
<td>eza -al</td>
<td>319</td>
<td>411</td>
<td>1,320</td>
<td>10,364</td>
</tr>
<tr>
<td>lsd -al</td>
<td>508</td>
<td>1,408</td>
<td>10,423</td>
<td>100,512</td>
</tr>
<tr>
<td>uutils ls -al</td>
<td>445</td>
<td>986</td>
<td>6,397</td>
<td>10,005</td>
</tr>
</tbody>
</table>
</article>
        </section>
    
    
        
    
    <section>
        <div>
            <p><strong>push</strong></p><p><code>git remote add origin
                    git@tangled.sh:rockorager.dev/lsr</code>
            </p>
        </div>

        <div>
            <p><strong>clone</strong></p><div>
                <div>
                    <p><span>HTTP</span></p><p><code>git clone
                            https://tangled.sh/@rockorager.dev/lsr</code>
                    </p>
                </div>

                <div>
                    <p><span>SSH</span></p><p><code>git clone
                            git@tangled.sh:rockorager.dev/lsr</code>
                    </p>
                </div>
            </div>
        </div>

        <p>
            Note that for self-hosted knots, clone URLs may be different based
            on your setup.
        </p>
    </section>


    </section>
</div></div>
  </body>
</html>
