<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/cyring/CoreFreq">Original</a>
    <h1>CoreFreq, a CPU monitoring software frequencies, ratios, C-states</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<h2 dir="auto"><a id="user-content-purpose" aria-hidden="true" href="#purpose"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Purpose</h2>
<p dir="auto"><em>CoreFreq</em>, a CPU monitoring software with BIOS like functionalities, is designed for the 64-bits Processors of architecture Intel Atom, Core2, Nehalem, SandyBridge and superiors; AMD Families from 0Fh ... up to 17h (Zen , Zen+ , Zen2), 18h (Hygon Dhyana), 19h (Zen3)</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/e199bbe28958e3a415d49e5513d9e3f53c514fe3447854a1ffd94b44542f52e9/687474703a2f2f626c6f672e637972696e672e667265652e66722f696d616765732f436f7265467265715f546f702e676966"><img src="https://camo.githubusercontent.com/e199bbe28958e3a415d49e5513d9e3f53c514fe3447854a1ffd94b44542f52e9/687474703a2f2f626c6f672e637972696e672e667265652e66722f696d616765732f436f7265467265715f546f702e676966" alt="alt text" title="CoreFreq Top" data-animated-image="" data-canonical-src="http://blog.cyring.free.fr/images/CoreFreq_Top.gif"/></a></p>
<p dir="auto"><em>CoreFreq</em> provides a framework to retrieve CPU data with a high degree of precision:</p>
<ul dir="auto">
<li>Core frequencies &amp; ratios; SpeedStep (EIST), Turbo Boost, Hyper-Threading (HTT) and Base Clock</li>
<li>Performance counters including Time Stamp Counter (TSC), Unhalted Core Cycles (UCC), Unhalted Reference Cycles (URC)</li>
<li>Number of instructions per cycle or second, IPS, IPC, or CPI</li>
<li>CPU C-States C0 C1 C3 C6 C7 - C1E - Auto/UnDemotion of C1 C3</li>
<li>DTS Temperature and Tjunction Max, Thermal Monitoring TM1 TM2 state, Vcore</li>
<li>Topology map including Caches for boostrap &amp; application CPU</li>
<li>Processor features, brand &amp; architecture strings</li>
<li>In progress: Uncore, Memory Controller channels &amp; geometry, DIMM timings,</li>
</ul>
<p dir="auto">To reach this goal, <em>CoreFreq</em> implements a Linux Kernel module which employs the followings:</p>
<ul dir="auto">
<li>asm code to keep as near as possible the readings of the performance counters;</li>
<li>per-CPU, implements slab data memory and high-resolution timer;</li>
<li>compliant with suspend / resume and CPU Hot-Plug;</li>
<li>a shared memory to protect kernel from the user-space part of the software;</li>
<li>atomic synchronization of threads to avoid mutexes and deadlock.</li>
</ul>
<h2 dir="auto"><a id="user-content-build--run" aria-hidden="true" href="#build--run"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Build &amp; Run</h2>
<h3 dir="auto"><a id="user-content-prerequisites" aria-hidden="true" href="#prerequisites"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Prerequisites</h3>
<p dir="auto"><strong>a-</strong> <em>Intel only</em>: For a better accuracy, <em>disable</em> the Kernel <em>NMI Watchdog</em></p>
<p dir="auto">Add the below <a href="https://github.com/torvalds/linux/blob/master/Documentation/admin-guide/kernel-parameters.txt">parameter</a> in the kernel boot loader { <a href="https://www.gnu.org/software/grub/manual/grub/grub.html#GNU_002fLinux" rel="nofollow">Grub</a>, <a href="https://wiki.syslinux.org/wiki/index.php?title=Config#APPEND" rel="nofollow">SysLinux</a> } ...</p>

<p dir="auto">... and build with the fixed performance counters</p>
<div data-snippet-clipboard-copy-content="make MSR_CORE_PERF_UC=MSR_CORE_PERF_FIXED_CTR1 MSR_CORE_PERF_URC=MSR_CORE_PERF_FIXED_CTR2"><pre><code>make MSR_CORE_PERF_UC=MSR_CORE_PERF_FIXED_CTR1 MSR_CORE_PERF_URC=MSR_CORE_PERF_FIXED_CTR2
</code></pre></div>
<p dir="auto"><strong>b-</strong> <em>AMD and Intel</em>: Some Virtualization</p>
<p dir="auto">VMs don&#39;t provide access to the registers that the <em>CoreFreq</em> driver employs :</p>
<ul dir="auto">
<li>Fixed Performance Counters</li>
<li>Model Specific Registers</li>
<li>PCI Registers</li>
</ul>
<p dir="auto">However <em>CoreFreq</em> is making use of the virtualized performance counter :</p>
<ul dir="auto">
<li>HV_X64_MSR_VP_RUNTIME(0x40000010)</li>
</ul>
<p dir="auto"><strong>c-</strong> Rendering</p>
<p dir="auto">The UI renders best with an ASCII console or a Xterm with VT100 support, ANSI <strong>colors</strong>; optionally transparency.</p>
<h4 dir="auto"><a id="user-content-ubuntu-terminal" aria-hidden="true" href="#ubuntu-terminal"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Ubuntu Terminal</h4>
<p dir="auto">In the Preferences - Colors tab, select <code>Show bold text in bright colors</code></p>
<h4 dir="auto"><a id="user-content-alacritty-terminal" aria-hidden="true" href="#alacritty-terminal"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>alacritty terminal</h4>
<p dir="auto">Uncomment and set <code>draw_bold_text_with_bright_colors: true</code> in <code>&lt;config-file&gt;</code></p>
<h3 dir="auto"><a id="user-content-dependencies" aria-hidden="true" href="#dependencies"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Dependencies</h3>
<ul dir="auto">
<li>The Linux Kernel with a minimum version 3.3</li>
<li>The GNU C Library</li>
</ul>
<h3 dir="auto"><a id="user-content-build" aria-hidden="true" href="#build"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Build</h3>
<ol dir="auto">
<li>Software needed:</li>
</ol>
<ul dir="auto">
<li>GNU C Compiler with GNU extensions</li>
<li>GNU Make tool</li>
<li>Linux Kernel Header files to build modules
<ul dir="auto">
<li>Mandatory : <code>CONFIG_MODULES, CONFIG_SMP, CONFIG_X86_MSR</code></li>
<li>Optionally: <code>CONFIG_HOTPLUG_CPU, CONFIG_CPU_IDLE, CONFIG_CPU_FREQ, CONFIG_PM_SLEEP, CONFIG_DMI, CONFIG_XEN, CONFIG_AMD_NB, CONFIG_SCHED_MUQSS, CONFIG_SCHED_BMQ, CONFIG_SCHED_PDS, CONFIG_SCHED_ALT, CONFIG_SCHED_BORE</code></li>
</ul>
</li>
</ul>
<ol start="2" dir="auto">
<li>
<p dir="auto">Clone the source code into a working directory.</p>
</li>
<li>
<p dir="auto">Build the programs.</p>
</li>
</ol>
<div data-snippet-clipboard-copy-content="cc -Wall -pthread -c corefreqd.c -o corefreqd.o
cc -Wall -c corefreqm.c -o corefreqm.o
cc corefreqd.c corefreqm.c -o corefreqd -lpthread -lm -lrt
cc -Wall -c corefreq-cli.c -o corefreq-cli.o
cc -Wall -c corefreq-ui.c -o corefreq-ui.o
cc corefreq-cli.c corefreq-ui.c -o corefreq-cli -lm -lrt
make -C /lib/modules/x.y.z/build M=/workdir/CoreFreq modules
make[1]: Entering directory &#39;/usr/lib/modules/x.y.z/build&#39;
  CC [M]  /workdir/CoreFreq/corefreqk.o
  Building modules, stage 2.
  MODPOST 1 modules
  CC      /workdir/CoreFreq/corefreqk.mod.o
  LD [M]  /workdir/CoreFreq/corefreqk.ko
make[1]: Leaving directory &#39;/usr/lib/modules/x.y.z/build&#39;"><pre><code>cc -Wall -pthread -c corefreqd.c -o corefreqd.o
cc -Wall -c corefreqm.c -o corefreqm.o
cc corefreqd.c corefreqm.c -o corefreqd -lpthread -lm -lrt
cc -Wall -c corefreq-cli.c -o corefreq-cli.o
cc -Wall -c corefreq-ui.c -o corefreq-ui.o
cc corefreq-cli.c corefreq-ui.c -o corefreq-cli -lm -lrt
make -C /lib/modules/x.y.z/build M=/workdir/CoreFreq modules
make[1]: Entering directory &#39;/usr/lib/modules/x.y.z/build&#39;
  CC [M]  /workdir/CoreFreq/corefreqk.o
  Building modules, stage 2.
  MODPOST 1 modules
  CC      /workdir/CoreFreq/corefreqk.mod.o
  LD [M]  /workdir/CoreFreq/corefreqk.ko
make[1]: Leaving directory &#39;/usr/lib/modules/x.y.z/build&#39;
</code></pre></div>
<ol start="4" dir="auto">
<li>(Optionally) Sign the driver
If module signature verification is enabled into Kernel, you will have to sign the <code>corefreqk.ko</code> driver.</li>
</ol>
<ul dir="auto">
<li>See <a href="https://github.com/torvalds/linux/blob/master/Documentation/admin-guide/module-signing.rst">module-signing.rst</a> from the Kernel documentation</li>
<li>See the <a href="https://wiki.gentoo.org/wiki/Signed_kernel_module_support#Manually_signing_modules" rel="nofollow">Gentoo Wiki</a></li>
</ul>
<h3 dir="auto"><a id="user-content-install" aria-hidden="true" href="#install"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Install</h3>
<h4 dir="auto"><a id="user-content-manual" aria-hidden="true" href="#manual"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Manual</h4>
<ol start="5" dir="auto">
<li>Copying <em>CoreFreq</em> into the binaries directory</li>
</ol>
<h4 dir="auto"><a id="user-content-distribution-package" aria-hidden="true" href="#distribution-package"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Distribution package</h4>
<ol start="6" dir="auto">
<li>Although <em>CoreFreq</em> is released in the ArchLinux AUR ; other sources of distribution may require to reload the systemd daemons:</li>
</ol>
<h3 dir="auto"><a id="user-content-start" aria-hidden="true" href="#start"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Start</h3>
<ol start="7" dir="auto">
<li>When built from source code:</li>
</ol>
<ul dir="auto">
<li>Load the kernel module, from current directory, as root.</li>
<li>Start the daemon, as root.</li>
<li>Start the client, as a user (<em>in another terminal or console</em>).</li>
</ul>
<ol start="8" dir="auto">
<li>When manually installed or from a distribution package:</li>
</ol>
<ul dir="auto">
<li>Load the kernel module, as root.</li>
<li>Start the daemon, as root.</li>
<li>Start the client, as a user.</li>
</ul>
<h3 dir="auto"><a id="user-content-stop" aria-hidden="true" href="#stop"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Stop</h3>
<ol start="9" dir="auto">
<li>
<p dir="auto">Press <kbd>Ctrl+x</kbd> or <kbd>Ctrl+c</kbd> to stop the client.</p>
</li>
<li>
<p dir="auto">Press <kbd>Ctrl+c</kbd> to stop the daemon (in foreground) or kill its background job.</p>
</li>
<li>
<p dir="auto">Unload the kernel module</p>
</li>
</ol>
<h3 dir="auto"><a id="user-content-try" aria-hidden="true" href="#try"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Try</h3>
<p dir="auto">Download the <em>CoreFreq</em> Live CD from the <a href="http://github.com/cyring/CoreFreq/wiki/Live-CD">Wiki</a></p>
<h2 dir="auto"><a id="user-content-screenshots" aria-hidden="true" href="#screenshots"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Screenshots</h2>
<h3 dir="auto"><a id="user-content-linux-kernel-module" aria-hidden="true" href="#linux-kernel-module"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Linux kernel module</h3>
<p dir="auto">Use <code>lsmod</code>, <code>dmesg</code> or <code>journalctl -k</code> to check if the module is started:</p>
<div data-snippet-clipboard-copy-content="CoreFreq: Processor [06_1A] Architecture [Nehalem/Bloomfield] CPU [8/8]"><pre><code>CoreFreq: Processor [06_1A] Architecture [Nehalem/Bloomfield] CPU [8/8]
</code></pre></div>
<h3 dir="auto"><a id="user-content-daemon" aria-hidden="true" href="#daemon"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Daemon</h3>
<div data-snippet-clipboard-copy-content="CoreFreq Daemon.  Copyright (C) 2015-2022 CYRIL COURTIAT

  Processor [Intel(R) Core(TM) i7 CPU 920 @ 2.67GHz]
  Architecture [Nehalem/Bloomfield] 8/8 CPU Online."><pre><code>CoreFreq Daemon.  Copyright (C) 2015-2022 CYRIL COURTIAT

  Processor [Intel(R) Core(TM) i7 CPU 920 @ 2.67GHz]
  Architecture [Nehalem/Bloomfield] 8/8 CPU Online.
</code></pre></div>
<h3 dir="auto"><a id="user-content-client" aria-hidden="true" href="#client"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Client</h3>
<p dir="auto">Without arguments, the corefreq-cli program displays Top Monitoring</p>
<ul dir="auto">
<li>
<p dir="auto">With the option &#39;-c&#39;, the client traces counters.
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/90cf62b655ba52bef81ec81aaf52e6afb7b84ed8f8851e3e2b7729c4540f586c/687474703a2f2f626c6f672e637972696e672e667265652e66722f696d616765732f436f7265467265715f436f756e746572732e676966"><img src="https://camo.githubusercontent.com/90cf62b655ba52bef81ec81aaf52e6afb7b84ed8f8851e3e2b7729c4540f586c/687474703a2f2f626c6f672e637972696e672e667265652e66722f696d616765732f436f7265467265715f436f756e746572732e676966" alt="alt text" title="CoreFreq Counters" data-animated-image="" data-canonical-src="http://blog.cyring.free.fr/images/CoreFreq_Counters.gif"/></a></p>
</li>
<li>
<p dir="auto">Using option &#39;-m&#39; corefreq-cli shows the CPU topology
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/b55b5f267d2e3e3771c0071bdc33be03079a3ed563effa1486aa91862a66452f/687474703a2f2f626c6f672e637972696e672e667265652e66722f696d616765732f436f7265467265715f546f706f6c6f67792e706e67"><img src="https://camo.githubusercontent.com/b55b5f267d2e3e3771c0071bdc33be03079a3ed563effa1486aa91862a66452f/687474703a2f2f626c6f672e637972696e672e667265652e66722f696d616765732f436f7265467265715f546f706f6c6f67792e706e67" alt="alt text" title="CoreFreq CPU &amp; caches topology" data-canonical-src="http://blog.cyring.free.fr/images/CoreFreq_Topology.png"/></a></p>
</li>
<li>
<p dir="auto">With the option &#39;-i&#39; corefreq-cli traces the number of instructions per second / cycle</p>
</li>
</ul>
<div data-snippet-clipboard-copy-content="CPU     IPS            IPC            CPI
#00     0.000579/s     0.059728/c    16.742698/i
#01     0.000334/s     0.150569/c     6.641471/i
#02     0.000598/s     0.161326/c     6.198641/i
#03     0.000294/s     0.233535/c     4.282013/i
#04     0.000240/s     0.042931/c    23.293141/i
#05     0.000284/s     0.158661/c     6.302765/i
#06     0.000128/s     0.128031/c     7.810631/i
#07     0.000088/s     0.150406/c     6.648674/i"><pre><code>CPU     IPS            IPC            CPI
#00     0.000579/s     0.059728/c    16.742698/i
#01     0.000334/s     0.150569/c     6.641471/i
#02     0.000598/s     0.161326/c     6.198641/i
#03     0.000294/s     0.233535/c     4.282013/i
#04     0.000240/s     0.042931/c    23.293141/i
#05     0.000284/s     0.158661/c     6.302765/i
#06     0.000128/s     0.128031/c     7.810631/i
#07     0.000088/s     0.150406/c     6.648674/i
</code></pre></div>
<ul dir="auto">
<li>Use the option &#39;-s&#39; to show the Processor information (BSP)</li>
</ul>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/e2a9380e8c5aed24da8d1e91315d03c5c1b289e9c1bcf0c0887f396fb859b463/687474703a2f2f626c6f672e637972696e672e667265652e66722f696d616765732f436f7265467265715f537973496e666f2e706e67"><img src="https://camo.githubusercontent.com/e2a9380e8c5aed24da8d1e91315d03c5c1b289e9c1bcf0c0887f396fb859b463/687474703a2f2f626c6f672e637972696e672e667265652e66722f696d616765732f436f7265467265715f537973496e666f2e706e67" alt="alt text" title="CoreFreq System Info" data-canonical-src="http://blog.cyring.free.fr/images/CoreFreq_SysInfo.png"/></a></p>
<h2 dir="auto"><a id="user-content-archlinux" aria-hidden="true" href="#archlinux"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ArchLinux</h2>

<h2 dir="auto"><a id="user-content-debian-ubuntu" aria-hidden="true" href="#debian-ubuntu"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Debian, Ubuntu</h2>
<ul dir="auto">
<li>Installing the DKMS package will pull the Kernel development packages</li>
<li>Or, install selectively the development packages prerequisites.</li>
</ul>
<h2 dir="auto"><a id="user-content-red-hat-centos" aria-hidden="true" href="#red-hat-centos"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Red Hat, CentOS</h2>
<ul dir="auto">
<li>Development packages prerequisites.</li>
</ul>
<h2 dir="auto"><a id="user-content-opensuse" aria-hidden="true" href="#opensuse"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>openSUSE</h2>
<ul dir="auto">
<li>Packages</li>
</ul>
<ol dir="auto">
<li><a href="https://software.opensuse.org/package/CoreFreq" rel="nofollow">CoreFreq</a> official release</li>
<li><a href="https://software.opensuse.org/package/CoreFreq-kmp-default" rel="nofollow">CoreFreq-kmp-default</a></li>
</ol>
<h2 dir="auto"><a id="user-content-unraid" aria-hidden="true" href="#unraid"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Unraid</h2>
<ul dir="auto">
<li>Plugin</li>
</ul>
<ol dir="auto">
<li><code>corefreq.plg</code> from <a href="https://github.com/ich777/unraid-corefreq">ich777/unraid-corefreq</a></li>
<li>Based on latest developments, please contact <a href="https://github.com/ich777">ich777</a></li>
</ol>
<h2 dir="auto"><a id="user-content-qa" aria-hidden="true" href="#qa"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Q&amp;A</h2>
<ul dir="auto">
<li>
<p dir="auto">Q: How many CPUs are supported by <em>CoreFreq</em> ?</p>
<p dir="auto">A: Up to 1024 CPUs can be built using the <code>make</code> <code>CORE_COUNT</code> option.  256 as a default.</p>
</li>
<li>
<p dir="auto">Q: Turbo Technology is activated however CPUs don&#39;t reach those frequencies ?</p>
</li>
<li>
<p dir="auto">Q: The CPU ratio does not go above its minimum value ?</p>
</li>
<li>
<p dir="auto">Q: The UI shows erratic counters values !</p>
<p dir="auto">A: In the kernel boot command argument line, <em>disable the NMI Watchdog</em></p>
</li>
<li>
<p dir="auto">Q: The Processor does not enter the C-States ?</p>
<p dir="auto">A1: Check if at least one Idle driver is running.</p>
<p dir="auto">A2: <em>CoreFreq</em> can also register itself as a cpuidle driver.</p>
</li>
<li>
<p dir="auto">Q: The <em>CoreFreq</em> UI refreshes itself slowly, with a delay after the actual CPUs usage ?</p>
<p dir="auto">A: The sampling time to read the counters can be reduced or increased using a <em>CoreFreq</em> module argument:</p>
</li>
<li>
<p dir="auto">Q: The base clock reports a wrong frequency value ?</p>
<p dir="auto">A: <em>CoreFreq</em> uses various algorithms to estimate the base clock.</p>
<ol dir="auto">
<li>The delta of two TimeStamp counters during a defined interval</li>
<li>The value provided in the Processor brand string divided by the maximum ratio (without Turbo)</li>
<li>A static value advertised by the manufacturer specs.</li>
<li>The MSR_FSB_FREQ bits provided with the Core, Core2 and Atom architectures.</li>
</ol>
<p dir="auto">The <em>CoreFreq</em> module can be started as follow to ignore the first algorithm (frequency estimation):</p>
<p dir="auto"><em>Remark: algorithms # 2, 3 and 4 will not return any under/over-clock frequency.</em></p>
</li>
<li>
<p dir="auto">Q: The CPU temperature is wrong ?</p>
<p dir="auto">A: <em>CoreFreq</em> employs two MSR registers to calculate the temperature.</p>
<p dir="auto"><em>Remark</em>: if the MSR_IA32_TEMPERATURE_TARGET is not provided by the Processor, a default value of 100 degree Celsius is considered as a target.</p>
</li>
<li>
<p dir="auto">Q: The menu option &#34;Memory Controller&#34; does not open any window ?</p>
<p dir="auto">A: Although Uncore and IMC features are under development, they can be activated with the Experimental driver argument:</p>
</li>
<li>
<p dir="auto">Q: The Instructions and PMC0 counters are stuck to zero ?</p>
</li>
<li>
<p dir="auto">Q: The Daemon crashes whenever its stress tools are executing !</p>
<p dir="auto">A: The <code>PCE</code> bit of control register <code>CR4</code> allows RDPMC in ring <code>3</code></p>
<p dir="auto">Next, load the driver with the <code>RDPMC_Enable</code> argument to override the <code>CR4</code> register:</p>
</li>
<li>
<p dir="auto">Q: How to solely control the P-States or the HWP Performance States ?</p>
<p dir="auto">A1: Without the Kernel <code>cpufreq</code> framework (aka <code>CONFIG_CPU_FREQ</code>), <em>CoreFreq</em> will take the full control over P-States.</p>
<p dir="auto">A2: With <code>cpufreq</code> built into Kernel, allow <em>CoreFreq</em> to register as a cpufreq driver.</p>
</li>
</ul>
<ol dir="auto">
<li>
<p dir="auto">disable <code>cpufreq</code> with the Kernel <a href="https://github.com/torvalds/linux/blob/master/Documentation/admin-guide/kernel-parameters.txt">parameter</a></p>
</li>
<li>
<p dir="auto">blacklist any P-state driver; such as:</p>
</li>
</ol>
<ul dir="auto">
<li>
<p dir="auto">hardware CPPC (MSR registers)</p>
</li>
<li>
<p dir="auto">firmware CPPC (ACPI registers)</p>
</li>
</ul>
<ol start="3" dir="auto">
<li>load the <em>CoreFreq</em> driver with its <code>Register_CPU_Freq</code> parameter:</li>
</ol>
<ul dir="auto">
<li>
<p dir="auto">Q: Governor is missing in Kernel window even after a successful registration.</p>
<p dir="auto">A: When Registrations are done through the UI, they have  to be done in the following order:</p>
</li>
</ul>
<ol dir="auto">
<li>Clock Source</li>
<li>Governor driver</li>
<li>CPU-FREQ driver</li>
<li>CPU-IDLE driver</li>
<li>CPU-IDLE route</li>
</ol>
<ul dir="auto">
<li>
<p dir="auto">Q: The CPU freezes or the System crashes.</p>
<p dir="auto">A1: Changing the <code>Max</code> ratio frequency (aka P0 P-State) makes the Kernel TSC clock source unstable.</p>
<ol dir="auto">
<li>Boot the Kernel with these command line parameters <code>notsc nowatchdog</code></li>
<li>Optionally, build the <em>CoreFreq</em> driver with its <code>udelay()</code> TSC implementation</li>
<li>Allow <em>CoreFreq</em> to register a new TSC clock source using driver arguments:</li>
<li>Switch the current system clock source to <code>corefreq</code></li>
</ol>
<p dir="auto">A2: <code>[AMD][Zen]</code> SMU:</p>
<p dir="auto">A3: This Processor is not or partially implemented in <em>CoreFreq</em>.</p>
</li>
<li>
<p dir="auto">Q: No voltage is showing up with Nehalem or Westmere processors ?</p>
<p dir="auto">A: Build <em>CoreFreq</em> as below if one of those chips is present:</p>
</li>
<li>
<p dir="auto">Q: <code>[AMD][Zen]</code> How to read the idle states ?</p>
<p dir="auto">A: As a workarround to the missing documentation of the hardware counters, <em>CoreFreq</em> implements virtual counters based on the TSC</p>
<ol dir="auto">
<li>Boot the Kernel without its idle drivers and no <code>TSC</code> default clock source set</li>
<li>Build <em>CoreFreq</em> with its <code>TSC</code> implementation</li>
<li>Load and <strong>register</strong> the <em>CoreFreq</em> kernel module as the system handler</li>
<li>Define <em>CoreFreq</em> as the System clock source</li>
<li>Start the Daemon then the Client</li>
</ol>
<ul dir="auto">
<li>The registration is confirmed into the <code>Settings</code> window</li>
<li>The idle limit can be changed at any time in the <code>Kernel</code> window</li>
</ul>
</li>
<li>
<p dir="auto">Q: How does <em>CoreFreq</em> work with <code>cgroups</code> ?</p>
<p dir="auto">A: The Daemon and the Client have to run in the <code>root cgroups cpugroup</code>, by using these commands:</p>
</li>
<li>
<p dir="auto">Q: How to enable transparency in the User Interface ?</p>
<p dir="auto">A: Transparency is a build option invoked by the compilation directive <code>UI_TRANSPARENCY</code></p>
<ol dir="auto">
<li>Build the project with <code>UI_TRANSPARENCY</code> enabled</li>
<li>Start the Client with one of its transparency compatible colors theme</li>
<li>Or switch to that theme from <code>Menu &gt; Theme</code>, shortcut [<code>E</code>]</li>
</ol>
</li>
<li>
<p dir="auto">Q: How to screenshot the UI ?</p>
<p dir="auto">A: Press <code>[Ctrl]+[p]</code> to save the screen to a rich ascii file.  Use the <code>cat</code> or <code>less -R</code> command to view the file saved with an <code>asc</code> extension.</p>
</li>
<li>
<p dir="auto">Q: How to record the UI ?</p>
<p dir="auto">A: Press <code>[Alt]+[p]</code> to record the screen for the duration set in Settings. A compatible <a href="https://github.com/asciinema/asciinema">asciinema</a> file is saved in the current directory with a <code>cast</code> extension.</p>
</li>
<li>
<p dir="auto">Q: What are the build options for <em>CoreFreq</em> ?</p>
<p dir="auto">A: Enter <code>make help</code> to display them:</p>
</li>
</ul>
<div data-snippet-clipboard-copy-content="o---------------------------------------------------------------o
|  make [all] [clean] [info] [help] [install] [module-install]  |
|                                                               |
|  CC=&lt;COMPILER&gt;                                                |
|    where &lt;COMPILER&gt; is cc, gcc, clang                         |
|                                                               |
|  WARNING=&lt;ARG&gt;                                                |
|    where default argument is -Wall                            |
|                                                               |
|  KERNELDIR=&lt;PATH&gt;                                             |
|    where &lt;PATH&gt; is the Kernel source directory                |
|                                                               |
|  CORE_COUNT=&lt;N&gt;                                               |
|    where &lt;N&gt; is 64, 128, 256, 512 or 1024 builtin CPU         |
|                                                               |
|  LEGACY=&lt;L&gt;                                                   |
|    where level &lt;L&gt;                                            |
|    1: assembly level restriction such as CMPXCHG16            |
|                                                               |
|  UBENCH=&lt;N&gt;                                                   |
|    where &lt;N&gt; is 0 to disable or 1 to enable micro-benchmark   |
|                                                               |
|  TASK_ORDER=&lt;N&gt;                                               |
|    where &lt;N&gt; is the memory page unit of kernel allocation     |
|                                                               |
|  FEAT_DBG=&lt;N&gt;                                                 |
|    where &lt;N&gt; is 0 or N for FEATURE DEBUG level                |
|    3: XMM assembly in RING operations                         |
|                                                               |
|  DELAY_TSC=&lt;N&gt;                                                |
|    where &lt;N&gt; is 1 to build a TSC implementation of udelay()   |
|                                                               |
|  OPTIM_LVL=&lt;N&gt;                                                |
|    where &lt;N&gt; is 0, 1, 2 or 3 of the OPTIMIZATION level        |
|                                                               |
|  MAX_FREQ_HZ=&lt;freq&gt;                                           |
|    where &lt;freq&gt; is at least 4850000000 Hz                     |
|                                                               |
|  HWM_CHIPSET=&lt;chipset&gt;                                        |
|    where &lt;chipset&gt; is W83627 or IT8720 or COMPATIBLE          |
|                                                               |
|  Performance Counters:                                        |
|    -------------------------------------------------------    |
|   |     MSR_CORE_PERF_UCC     |     MSR_CORE_PERF_URC     |   |
|   |----------- REG -----------|----------- REG -----------|   |
|   | MSR_IA32_APERF            |  MSR_IA32_MPERF           |   |
|   | MSR_CORE_PERF_FIXED_CTR1  |  MSR_CORE_PERF_FIXED_CTR2 |   |
|   | MSR_PPERF                 |  MSR_PPERF                |   |
|   | MSR_AMD_F17H_APERF        |  MSR_AMD_F17H_MPERF       |   |
|    -------------------------------------------------------    |
|                                                               |
|  Architectural Counters:                                      |
|    -------------------------------------------------------    |
|   |           Intel           |            AMD            |   |
|   |----------- REG -----------|----------- REG -----------|   |
|   |       ARCH_PMC=PCU        |      ARCH_PMC=L3          |   |
|   |                           |      ARCH_PMC=PERF        |   |
|   |                           |      ARCH_PMC=UMC         |   |
|    -------------------------------------------------------    |
|                                                               |
|  User Interface Layout:                                       |
|    NO_HEADER=&lt;F&gt;  NO_FOOTER=&lt;F&gt;  NO_UPPER=&lt;F&gt;  NO_LOWER=&lt;F&gt;   |
|      when &lt;F&gt; is 1: don&#39;t build and display this area part    |
|    UI_TRANSPARENCY=&lt;F&gt;                                        |
|      when &lt;F&gt; is 1: build with background transparency        |
|                                                               |
|  Example:                                                     |
|    make CC=gcc OPTIM_LVL=3 FEAT_DBG=1 ARCH_PMC=PCU            |
|         MSR_CORE_PERF_UCC=MSR_CORE_PERF_FIXED_CTR1            |
|         MSR_CORE_PERF_URC=MSR_CORE_PERF_FIXED_CTR2            |
|         HWM_CHIPSET=W83627 MAX_FREQ_HZ=5350000000             |
|         CORE_COUNT=1024 NO_FOOTER=1 NO_UPPER=1                |
|         clean all                                             |
o---------------------------------------------------------------o"><pre><code>o---------------------------------------------------------------o
|  make [all] [clean] [info] [help] [install] [module-install]  |
|                                                               |
|  CC=&lt;COMPILER&gt;                                                |
|    where &lt;COMPILER&gt; is cc, gcc, clang                         |
|                                                               |
|  WARNING=&lt;ARG&gt;                                                |
|    where default argument is -Wall                            |
|                                                               |
|  KERNELDIR=&lt;PATH&gt;                                             |
|    where &lt;PATH&gt; is the Kernel source directory                |
|                                                               |
|  CORE_COUNT=&lt;N&gt;                                               |
|    where &lt;N&gt; is 64, 128, 256, 512 or 1024 builtin CPU         |
|                                                               |
|  LEGACY=&lt;L&gt;                                                   |
|    where level &lt;L&gt;                                            |
|    1: assembly level restriction such as CMPXCHG16            |
|                                                               |
|  UBENCH=&lt;N&gt;                                                   |
|    where &lt;N&gt; is 0 to disable or 1 to enable micro-benchmark   |
|                                                               |
|  TASK_ORDER=&lt;N&gt;                                               |
|    where &lt;N&gt; is the memory page unit of kernel allocation     |
|                                                               |
|  FEAT_DBG=&lt;N&gt;                                                 |
|    where &lt;N&gt; is 0 or N for FEATURE DEBUG level                |
|    3: XMM assembly in RING operations                         |
|                                                               |
|  DELAY_TSC=&lt;N&gt;                                                |
|    where &lt;N&gt; is 1 to build a TSC implementation of udelay()   |
|                                                               |
|  OPTIM_LVL=&lt;N&gt;                                                |
|    where &lt;N&gt; is 0, 1, 2 or 3 of the OPTIMIZATION level        |
|                                                               |
|  MAX_FREQ_HZ=&lt;freq&gt;                                           |
|    where &lt;freq&gt; is at least 4850000000 Hz                     |
|                                                               |
|  HWM_CHIPSET=&lt;chipset&gt;                                        |
|    where &lt;chipset&gt; is W83627 or IT8720 or COMPATIBLE          |
|                                                               |
|  Performance Counters:                                        |
|    -------------------------------------------------------    |
|   |     MSR_CORE_PERF_UCC     |     MSR_CORE_PERF_URC     |   |
|   |----------- REG -----------|----------- REG -----------|   |
|   | MSR_IA32_APERF            |  MSR_IA32_MPERF           |   |
|   | MSR_CORE_PERF_FIXED_CTR1  |  MSR_CORE_PERF_FIXED_CTR2 |   |
|   | MSR_PPERF                 |  MSR_PPERF                |   |
|   | MSR_AMD_F17H_APERF        |  MSR_AMD_F17H_MPERF       |   |
|    -------------------------------------------------------    |
|                                                               |
|  Architectural Counters:                                      |
|    -------------------------------------------------------    |
|   |           Intel           |            AMD            |   |
|   |----------- REG -----------|----------- REG -----------|   |
|   |       ARCH_PMC=PCU        |      ARCH_PMC=L3          |   |
|   |                           |      ARCH_PMC=PERF        |   |
|   |                           |      ARCH_PMC=UMC         |   |
|    -------------------------------------------------------    |
|                                                               |
|  User Interface Layout:                                       |
|    NO_HEADER=&lt;F&gt;  NO_FOOTER=&lt;F&gt;  NO_UPPER=&lt;F&gt;  NO_LOWER=&lt;F&gt;   |
|      when &lt;F&gt; is 1: don&#39;t build and display this area part    |
|    UI_TRANSPARENCY=&lt;F&gt;                                        |
|      when &lt;F&gt; is 1: build with background transparency        |
|                                                               |
|  Example:                                                     |
|    make CC=gcc OPTIM_LVL=3 FEAT_DBG=1 ARCH_PMC=PCU            |
|         MSR_CORE_PERF_UCC=MSR_CORE_PERF_FIXED_CTR1            |
|         MSR_CORE_PERF_URC=MSR_CORE_PERF_FIXED_CTR2            |
|         HWM_CHIPSET=W83627 MAX_FREQ_HZ=5350000000             |
|         CORE_COUNT=1024 NO_FOOTER=1 NO_UPPER=1                |
|         clean all                                             |
o---------------------------------------------------------------o
</code></pre></div>
<ul dir="auto">
<li>
<p dir="auto">Q: What are the parameters of the <em>CoreFreq</em> driver ?</p>
<p dir="auto">A: Use the <code>modinfo</code> command to list them:</p>
</li>
</ul>
<div data-snippet-clipboard-copy-content="$ modinfo corefreqk.ko
parm:           ArchID:Force an architecture (ID) (int)
parm:           AutoClock:Estimate Clock Frequency 0:Spec; 1:Once; 2:Auto (int)
parm:           SleepInterval:Timer interval (ms) (uint)
parm:           TickInterval:System requested interval (ms) (uint)
parm:           Experimental:Enable features under development (int)
parm:           CPU_Count:-1:Kernel(default); 0:Hardware; &gt;0: User value (int)
parm:           Target_Ratio_Unlock:1:Target Ratio Unlock; 0:Lock (short)
parm:           Clock_Ratio_Unlock:1:MinRatio; 2:MaxRatio; 3:Both Unlock (short)
parm:           Turbo_Ratio_Unlock:1:Turbo Ratio Unlock; 0:Lock (short)
parm:           Uncore_Ratio_Unlock:1:Uncore Ratio Unlock; 0:Lock (short)
parm:           ServiceProcessor:Select a CPU to run services with (int)
parm:           RDPMC_Enable:Enable RDPMC bit in CR4 register (ushort)
parm:           NMI_Disable:Disable the NMI Handler (ushort)
parm:           Override_SubCstate:Override Sub C-States (array of ushort)
parm:           PkgCStateLimit:Package C-State Limit (short)
parm:           IOMWAIT_Enable:I/O MWAIT Redirection Enable (short)
parm:           CStateIORedir:Power Mgmt IO Redirection C-State (short)
parm:           Config_TDP_Level:Config TDP Control Level (short)
parm:           Custom_TDP_Offset:TDP Limit Offset (watt) (array of short)
parm:           Activate_TDP_Limit:Activate TDP Limiting (array of short)
parm:           Activate_TDP_Clamp:Activate TDP Clamping (array of short)
parm:           Custom_TDC_Offset:TDC Limit Offset (amp) (short)
parm:           Activate_TDC_Limit:Activate TDC Limiting (short)
parm:           L1_HW_PREFETCH_Disable:Disable L1 HW Prefetcher (short)
parm:           L1_HW_IP_PREFETCH_Disable:Disable L1 HW IP Prefetcher (short)
parm:           L2_HW_PREFETCH_Disable:Disable L2 HW Prefetcher (short)
parm:           L2_HW_CL_PREFETCH_Disable:Disable L2 HW CL Prefetcher (short)
parm:           SpeedStep_Enable:Enable SpeedStep (short)
parm:           C1E_Enable:Enable SpeedStep C1E (short)
parm:           TurboBoost_Enable:Enable Turbo Boost (array of short)
parm:           C3A_Enable:Enable C3 Auto Demotion (short)
parm:           C1A_Enable:Enable C3 Auto Demotion (short)
parm:           C3U_Enable:Enable C3 UnDemotion (short)
parm:           C1U_Enable:Enable C1 UnDemotion (short)
parm:           CC6_Enable:Enable Core C6 State (short)
parm:           PC6_Enable:Enable Package C6 State (short)
parm:           ODCM_Enable:Enable On-Demand Clock Modulation (short)
parm:           ODCM_DutyCycle:ODCM DutyCycle [0-7] | [0-14] (short)
parm:           PowerMGMT_Unlock:Unlock Power Management (short)
parm:           PowerPolicy:Power Policy Preference [0-15] (short)
parm:           Turbo_Activation_Ratio:Turbo Activation Ratio (short)
parm:           PState_FID:P-State Frequency Id (int)
parm:           PState_VID:P-State Voltage Id (int)
parm:           Ratio_Boost:Turbo Boost Frequency ratios (array of int)
parm:           Ratio_PPC:Target Performance ratio (int)
parm:           HWP_Enable:Hardware-Controlled Performance States (short)
parm:           HWP_EPP:Energy Performance Preference (short)
parm:           Ratio_HWP:Hardware-Controlled Performance ratios (array of int)
parm:           HDC_Enable:Hardware Duty Cycling (short)
parm:           EEO_Disable:Disable Energy Efficiency Optimization (short)
parm:           R2H_Disable:Disable Race to Halt (short)
parm:           Clear_Events:Clear Thermal and Power Events (ullong)
parm:           ThermalOffset:Thermal Offset (short)
parm:           ThermalScope:[0:None; 1:SMT; 2:Core; 3:Package] (int)
parm:           VoltageScope:[0:None; 1:SMT; 2:Core; 3:Package] (int)
parm:           PowerScope:[0:None; 1:SMT; 2:Core; 3:Package] (int)
parm:           Register_CPU_Idle:Register the Kernel cpuidle driver (short)
parm:           Register_CPU_Freq:Register the Kernel cpufreq driver (short)
parm:           Register_Governor:Register the Kernel governor (short)
parm:           Register_ClockSource:Register Clock Source driver (short)
parm:           Idle_Route:[0:Default; 1:I/O; 2:HALT; 3:MWAIT] (short)
parm:           Mech_IBRS:Mitigation Mechanism IBRS (short)
parm:           Mech_STIBP:Mitigation Mechanism STIBP (short)
parm:           Mech_SSBD:Mitigation Mechanism SSBD (short)
parm:           Mech_IBPB:Mitigation Mechanism IBPB (short)
parm:           Mech_L1D_FLUSH:Mitigation Mechanism Cache L1D Flush (short)
parm:           Mech_PSFD:Mitigation Mechanism PSFD (short)
parm:           Mech_BTC_NOBR:Mitigation Mechanism BTC-NOBR (short)
parm:           WDT_Enable:Watchdog Hardware Timer (short)
parm:           HSMP_Attempt:Attempt the HSMP interface (short)"><pre><code>$ modinfo corefreqk.ko
parm:           ArchID:Force an architecture (ID) (int)
parm:           AutoClock:Estimate Clock Frequency 0:Spec; 1:Once; 2:Auto (int)
parm:           SleepInterval:Timer interval (ms) (uint)
parm:           TickInterval:System requested interval (ms) (uint)
parm:           Experimental:Enable features under development (int)
parm:           CPU_Count:-1:Kernel(default); 0:Hardware; &gt;0: User value (int)
parm:           Target_Ratio_Unlock:1:Target Ratio Unlock; 0:Lock (short)
parm:           Clock_Ratio_Unlock:1:MinRatio; 2:MaxRatio; 3:Both Unlock (short)
parm:           Turbo_Ratio_Unlock:1:Turbo Ratio Unlock; 0:Lock (short)
parm:           Uncore_Ratio_Unlock:1:Uncore Ratio Unlock; 0:Lock (short)
parm:           ServiceProcessor:Select a CPU to run services with (int)
parm:           RDPMC_Enable:Enable RDPMC bit in CR4 register (ushort)
parm:           NMI_Disable:Disable the NMI Handler (ushort)
parm:           Override_SubCstate:Override Sub C-States (array of ushort)
parm:           PkgCStateLimit:Package C-State Limit (short)
parm:           IOMWAIT_Enable:I/O MWAIT Redirection Enable (short)
parm:           CStateIORedir:Power Mgmt IO Redirection C-State (short)
parm:           Config_TDP_Level:Config TDP Control Level (short)
parm:           Custom_TDP_Offset:TDP Limit Offset (watt) (array of short)
parm:           Activate_TDP_Limit:Activate TDP Limiting (array of short)
parm:           Activate_TDP_Clamp:Activate TDP Clamping (array of short)
parm:           Custom_TDC_Offset:TDC Limit Offset (amp) (short)
parm:           Activate_TDC_Limit:Activate TDC Limiting (short)
parm:           L1_HW_PREFETCH_Disable:Disable L1 HW Prefetcher (short)
parm:           L1_HW_IP_PREFETCH_Disable:Disable L1 HW IP Prefetcher (short)
parm:           L2_HW_PREFETCH_Disable:Disable L2 HW Prefetcher (short)
parm:           L2_HW_CL_PREFETCH_Disable:Disable L2 HW CL Prefetcher (short)
parm:           SpeedStep_Enable:Enable SpeedStep (short)
parm:           C1E_Enable:Enable SpeedStep C1E (short)
parm:           TurboBoost_Enable:Enable Turbo Boost (array of short)
parm:           C3A_Enable:Enable C3 Auto Demotion (short)
parm:           C1A_Enable:Enable C3 Auto Demotion (short)
parm:           C3U_Enable:Enable C3 UnDemotion (short)
parm:           C1U_Enable:Enable C1 UnDemotion (short)
parm:           CC6_Enable:Enable Core C6 State (short)
parm:           PC6_Enable:Enable Package C6 State (short)
parm:           ODCM_Enable:Enable On-Demand Clock Modulation (short)
parm:           ODCM_DutyCycle:ODCM DutyCycle [0-7] | [0-14] (short)
parm:           PowerMGMT_Unlock:Unlock Power Management (short)
parm:           PowerPolicy:Power Policy Preference [0-15] (short)
parm:           Turbo_Activation_Ratio:Turbo Activation Ratio (short)
parm:           PState_FID:P-State Frequency Id (int)
parm:           PState_VID:P-State Voltage Id (int)
parm:           Ratio_Boost:Turbo Boost Frequency ratios (array of int)
parm:           Ratio_PPC:Target Performance ratio (int)
parm:           HWP_Enable:Hardware-Controlled Performance States (short)
parm:           HWP_EPP:Energy Performance Preference (short)
parm:           Ratio_HWP:Hardware-Controlled Performance ratios (array of int)
parm:           HDC_Enable:Hardware Duty Cycling (short)
parm:           EEO_Disable:Disable Energy Efficiency Optimization (short)
parm:           R2H_Disable:Disable Race to Halt (short)
parm:           Clear_Events:Clear Thermal and Power Events (ullong)
parm:           ThermalOffset:Thermal Offset (short)
parm:           ThermalScope:[0:None; 1:SMT; 2:Core; 3:Package] (int)
parm:           VoltageScope:[0:None; 1:SMT; 2:Core; 3:Package] (int)
parm:           PowerScope:[0:None; 1:SMT; 2:Core; 3:Package] (int)
parm:           Register_CPU_Idle:Register the Kernel cpuidle driver (short)
parm:           Register_CPU_Freq:Register the Kernel cpufreq driver (short)
parm:           Register_Governor:Register the Kernel governor (short)
parm:           Register_ClockSource:Register Clock Source driver (short)
parm:           Idle_Route:[0:Default; 1:I/O; 2:HALT; 3:MWAIT] (short)
parm:           Mech_IBRS:Mitigation Mechanism IBRS (short)
parm:           Mech_STIBP:Mitigation Mechanism STIBP (short)
parm:           Mech_SSBD:Mitigation Mechanism SSBD (short)
parm:           Mech_IBPB:Mitigation Mechanism IBPB (short)
parm:           Mech_L1D_FLUSH:Mitigation Mechanism Cache L1D Flush (short)
parm:           Mech_PSFD:Mitigation Mechanism PSFD (short)
parm:           Mech_BTC_NOBR:Mitigation Mechanism BTC-NOBR (short)
parm:           WDT_Enable:Watchdog Hardware Timer (short)
parm:           HSMP_Attempt:Attempt the HSMP interface (short)
</code></pre></div>
<h2 dir="auto"><a id="user-content-algorithm" aria-hidden="true" href="#algorithm"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Algorithm</h2>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/f50889d4ce1d3924f040a35fc24c7ebe1347aaa12887cb557637dadeb2ccf570/687474703a2f2f626c6f672e637972696e672e667265652e66722f696d616765732f436f7265467265712d616c676f726974686d2e706e67"><img src="https://camo.githubusercontent.com/f50889d4ce1d3924f040a35fc24c7ebe1347aaa12887cb557637dadeb2ccf570/687474703a2f2f626c6f672e637972696e672e667265652e66722f696d616765732f436f7265467265712d616c676f726974686d2e706e67" alt="alt text" title="CoreFreq algorithm" data-canonical-src="http://blog.cyring.free.fr/images/CoreFreq-algorithm.png"/></a></p>

<p dir="auto"><a href="https://github.com/cyring">CyrIng</a></p>
<h2 dir="auto"><a id="user-content-copyright-c-2015-2022-cyril-courtiat" aria-hidden="true" href="#copyright-c-2015-2022-cyril-courtiat"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Copyright (C) 2015-2022 CYRIL COURTIAT</h2>
</article>
          </div></div>
  </body>
</html>
