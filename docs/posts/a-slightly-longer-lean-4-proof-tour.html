<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/">Original</a>
    <h1>A slightly longer Lean 4 proof tour</h1>
    
    <div id="readability-page-1" class="page"><div>
		
<p>In my <a href="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/">previous post</a>, I walked through the task of formally deducing one lemma from another in <a href="https://en.wikipedia.org/wiki/Lean_(proof_assistant)">Lean 4</a>.  The deduction was deliberately chosen to be short and only showcased a small number of Lean tactics.    Here I would like to walk through the process I used for a slightly longer proof I worked out recently, after seeing the following <a href="https://twitter.com/damekdavis/status/1730983634570510819">challenge from Damek Davis</a>: to formalize (in a civilized fashion) the proof of the following lemma:</p>



<blockquote>
<p><strong>Lemma</strong>.  Let <img src="https://s0.wp.com/latex.php?latex=%5C%7Ba_k%5C%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5C%7Ba_k%5C%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5C%7Ba_k%5C%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\{a_k\}"/> and <img src="https://s0.wp.com/latex.php?latex=%5C%7BD_k%5C%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5C%7BD_k%5C%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5C%7BD_k%5C%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\{D_k\}"/> be sequences of real numbers indexed by natural numbers <img src="https://s0.wp.com/latex.php?latex=k%3D0%2C1%2C%5Cdots&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=k%3D0%2C1%2C%5Cdots&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=k%3D0%2C1%2C%5Cdots&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="k=0,1,\dots"/>, with <img src="https://s0.wp.com/latex.php?latex=a_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=a_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=a_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="a_k"/> non-increasing and <img src="https://s0.wp.com/latex.php?latex=D_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=D_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=D_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="D_k"/> non-negative.  Suppose also that <img src="https://s0.wp.com/latex.php?latex=a_k+%5Cleq+D_k+-+D_%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=a_k+%5Cleq+D_k+-+D_%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=a_k+%5Cleq+D_k+-+D_%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="a_k \leq D_k - D_{k+1}"/> for all <img src="https://s0.wp.com/latex.php?latex=k+%5Cgeq+0&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=k+%5Cgeq+0&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=k+%5Cgeq+0&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="k \geq 0"/>.  Then <img src="https://s0.wp.com/latex.php?latex=a_k+%5Cleq+%5Cfrac%7BD_0%7D%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=a_k+%5Cleq+%5Cfrac%7BD_0%7D%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=a_k+%5Cleq+%5Cfrac%7BD_0%7D%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="a_k \leq \frac{D_0}{k+1}"/> for all <img src="https://s0.wp.com/latex.php?latex=k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="k"/>.</p>
</blockquote>



<p>Here I tried to draw upon the lessons I had learned from the PFR formalization project, and to first set up a human readable proof of the lemma before starting the Lean formalization – a lower-case “blueprint” rather than the fancier <a href="https://github.com/PatrickMassot/leanblueprint">Blueprint</a> used in the PFR project.  The main idea of the proof here is to use the telescoping series identity</p>



<p><img src="https://s0.wp.com/latex.php?latex=%5Cdisplaystyle+%5Csum_%7Bi%3D0%7D%5Ek+D_i+-+D_%7Bi%2B1%7D+%3D+D_0+-+D_%7Bk%2B1%7D.&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cdisplaystyle+%5Csum_%7Bi%3D0%7D%5Ek+D_i+-+D_%7Bi%2B1%7D+%3D+D_0+-+D_%7Bk%2B1%7D.&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cdisplaystyle+%5Csum_%7Bi%3D0%7D%5Ek+D_i+-+D_%7Bi%2B1%7D+%3D+D_0+-+D_%7Bk%2B1%7D.&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\displaystyle \sum_{i=0}^k D_i - D_{i+1} = D_0 - D_{k+1}."/></p>



<p>Since <img src="https://s0.wp.com/latex.php?latex=D_%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=D_%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=D_%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="D_{k+1}"/> is non-negative, and <img src="https://s0.wp.com/latex.php?latex=a_i+%5Cleq+D_i+-+D_%7Bi%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=a_i+%5Cleq+D_i+-+D_%7Bi%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=a_i+%5Cleq+D_i+-+D_%7Bi%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="a_i \leq D_i - D_{i+1}"/> by hypothesis, we have</p>



<p><img src="https://s0.wp.com/latex.php?latex=%5Cdisplaystyle+%5Csum_%7Bi%3D0%7D%5Ek+a_i+%5Cleq+D_0&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cdisplaystyle+%5Csum_%7Bi%3D0%7D%5Ek+a_i+%5Cleq+D_0&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cdisplaystyle+%5Csum_%7Bi%3D0%7D%5Ek+a_i+%5Cleq+D_0&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\displaystyle \sum_{i=0}^k a_i \leq D_0"/></p>



<p>but by the monotone hypothesis on <img src="https://s0.wp.com/latex.php?latex=a_i&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=a_i&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=a_i&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="a_i"/> the left-hand side is at least <img src="https://s0.wp.com/latex.php?latex=%28k%2B1%29+a_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%28k%2B1%29+a_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%28k%2B1%29+a_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="(k+1) a_k"/>, giving the claim.</p>



<p>This is already a human-readable proof, but in order to formalize it more easily in Lean, I decided to rewrite it as a chain of inequalities, starting at <img src="https://s0.wp.com/latex.php?latex=a_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=a_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=a_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="a_k"/> and ending at <img src="https://s0.wp.com/latex.php?latex=D_0+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=D_0+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=D_0+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="D_0 / (k+1)"/>.  With a little bit of pen and paper effort, I obtained</p>



<p><img src="https://s0.wp.com/latex.php?latex=a_k+%3D+%28k%2B1%29+a_k+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=a_k+%3D+%28k%2B1%29+a_k+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=a_k+%3D+%28k%2B1%29+a_k+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="a_k = (k+1) a_k / (k+1)"/></p>



<p>(by field identities)</p>



<p><img src="https://s0.wp.com/latex.php?latex=%3D+%28%5Csum_%7Bi%3D0%7D%5Ek+a_k%29+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%3D+%28%5Csum_%7Bi%3D0%7D%5Ek+a_k%29+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%3D+%28%5Csum_%7Bi%3D0%7D%5Ek+a_k%29+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="= (\sum_{i=0}^k a_k) / (k+1)"/></p>



<p>(by the formula for summing a constant)</p>



<p><img src="https://s0.wp.com/latex.php?latex=%5Cleq+%28%5Csum_%7Bi%3D0%7D%5Ek+a_i%29+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cleq+%28%5Csum_%7Bi%3D0%7D%5Ek+a_i%29+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cleq+%28%5Csum_%7Bi%3D0%7D%5Ek+a_i%29+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\leq (\sum_{i=0}^k a_i) / (k+1)"/></p>



<p>(by the monotone hypothesis)</p>



<p><img src="https://s0.wp.com/latex.php?latex=%5Cleq+%28%5Csum_%7Bi%3D0%7D%5Ek+D_i+-+D_%7Bi%2B1%7D%29+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cleq+%28%5Csum_%7Bi%3D0%7D%5Ek+D_i+-+D_%7Bi%2B1%7D%29+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cleq+%28%5Csum_%7Bi%3D0%7D%5Ek+D_i+-+D_%7Bi%2B1%7D%29+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\leq (\sum_{i=0}^k D_i - D_{i+1}) / (k+1)"/></p>



<p>(by the hypothesis <img src="https://s0.wp.com/latex.php?latex=a_i+%5Cleq+D_i+-+D_%7Bi%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=a_i+%5Cleq+D_i+-+D_%7Bi%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=a_i+%5Cleq+D_i+-+D_%7Bi%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="a_i \leq D_i - D_{i+1}"/></p>



<p><img src="https://s0.wp.com/latex.php?latex=%3D+%28D_0+-+D_%7Bk%2B1%7D%29+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%3D+%28D_0+-+D_%7Bk%2B1%7D%29+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%3D+%28D_0+-+D_%7Bk%2B1%7D%29+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="= (D_0 - D_{k+1}) / (k+1)"/></p>



<p>(by telescoping series)</p>



<p><img src="https://s0.wp.com/latex.php?latex=%5Cleq+D_0+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cleq+D_0+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cleq+D_0+%2F+%28k%2B1%29&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\leq D_0 / (k+1)"/></p>



<p>(by the non-negativity of <img src="https://s0.wp.com/latex.php?latex=D_%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=D_%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=D_%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="D_{k+1}"/>).</p>



<p>I decided that this was a good enough blueprint for me to work with.  The next step is to formalize the statement of the lemma in Lean.  For this quick project, it was convenient to use the <a href="https://live.lean-lang.org/">online Lean playground</a>, rather than my local IDE, so the screenshots will look a little different from those in the previous post.  (If you like, you can follow this tour in that playground, by typing in some version of the code displayed below.) I start by importing Lean’s math library, and starting an example of a statement to state and prove:</p>



<p><img src="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATkAAACaCAYAAADSHj8FAAAYwElEQVR4Ae2dX2wcx33H992vQbGvtPUiWyjEAAV4D0WhQ1hALBQgRPlgNnog+ESwbuDSQu0QQmOGISCZVQGFNWKBUirFx9gSSDtCKLRCT1Fh9GhAxlGJLcqp3CMKtjhXMkRTgnyKSflbzO3M7uzc7t7ece94t/oKONz+nZ35zO6Hv/mzJ+urr74CP2TAe4D3QFrvAevx48fghwx4D/AeSOs9YH399dfghwx4D/AeSOs9YG1vb4MfMuA9wHsgrfeAtbOzA37IgPcA74G03gPWkydPwA8Z8B7gPZDWe8D65ptvwA8Z8B7gPZDWe4CSo+T5R473QKrvAUqON3iqb/C0RicsV/zI2wL/kQAJkECKCVByKa5cFo0ESACg5HgXkAAJpJoAJZfq6mXhSIAE0i25MpA7DcxfY0WTQDoJbN5ZxvzJOSx+vJnOAiZQqvRKrgJM2oBlOZ/xKwnQYhIkgDJyQxYsy8LgQrkJHt75Ig3fZ6rQWHp35jHgppHB3MfRp5cXBp3rDeXQTM6jU+/cvXsjuS9+h/k3z+D5V3+K5149j4t3WwCoDAxLwQnRDS604BppSvIeMH8cGOwDGnzUmqJQmPIe8NGl4Chkc2nUk0CjAoiVqwpKl+cwMZLF6MW4j70nqWYlt/xyFtl+77PfliwaLeONadiu5CxMr0QXmpKL5pPM3gef4eLPz6K3KjchuBZKDkDxNNBjAT1DQPFhMkVIbSorXtTbbslZI4uo1Zwnk2q0c3SxBdGHd434wmrmnKi7xkvPalRyKEEI07ZsZF9eRinqMgAouTqAdrX7wQZ+c+m8K7fn37iMi++ebbnkdpXnp+3ktkqugvwxEb30oveg+B5EbsMALptitm23sInlCaY7JWcwq7NKydUBtJvdWx+87Qjth2fwav4zbD0B7ubPU3K7gZr0uW2VnJLLIKannH6igXP+OKR4qrcqwdmTk5RcQnVNySUEMjCZP9zCP715GYUvdtzdLZHcBjCo9cOpQQfxHdlfIR/wwQtO9paPOc1c+wCwuO5sK10GBvYBlg0MnwYqbkmchWl5XRWRrC0Bo4cAW27PjADLMi3jVG91Gygs+M8TeRg9BuQjuoxyQ05T0+13LANzY0BG5Fc01/uAiQX4m4QRrHRu+nIkQ68UMZY8yeWuyc7zw/Nac6uIWRHhHZxFcXUWvaLfqV/fLy9R2cTalXlMjg0i29fj9t/ZB7IYHJvD8p3aRrDeF+jr9Nf6tnzbazrpVd69gYfytTmMH9kv+8d6kBmZxuJt8w4Jw+KlF6u5ujLtltOXz6Bo2LhkjeTKBeSmRpHZ5/QJ2gcGMH6u6L9PjDS6cXVvBh7Qokgu4sGNfEBVFDMFFKa8vqnqAz4GlFaAjCHP2VV/dbuS+xiYPWKkoc61gdkb/vPctXVgVEpJF4u+PBoyeKJLbu2cI2j9PLWcmdLkHMFKHW9+RzJ0CxJnQT3Yoplawvxh8ZBlMX9HnrvidKj3niwCGzkMVgU0XTMgUl9YPRi96I8Q65/jPPCuQCIlt4bCjOgTM86prmcwfSOO6BQLC+2U3NrKNLJqwMPIf89IK/o/49wXrTkmXZIzGWkPcuQDqiTX58hsQkw3eQiMCznZwOBhwD6KaqSx/JIjsOwZ/8WU5Gw5bSXzElC85xxT2QAm+6T4Djvp+M6+B4zL8+wjwPJtb29lHZiVkZqQzuQH3j61pCTX2+dEjvYhILcqhSaiw5OedF2RqJPVt2JgtWN0tYjp6gPm9MWVzg1Uo5PeU0WIXOdfE/1wUnoRkiueGsD46UUUbpexqfmksr6MyT4pHnscy7UBnSy1J5hm+uRUf2HPyDyK92QGytq1awSpYOvfXh5iSU4/VSy7kV1Av6ZxrBvJHcwgI/jbA5i+VkJlG8D2JopnhqWwbUxc1YAa6XTbKiVXvVE8CdhjXrNuvt/bviiFVV6Q26b8Va0kJ0Q0cEqLmNRhq0CvjOjMKNCNHsX0jZBRYCUyK0CS7j7RNB0BSuKm1f9VgAl57eGL+g5tua2SK2C6Gj3IB/PeIkbFumieVvKYEMuq+RohOS33tYvaHLLwB9YTTDOSE9Fe5qXaUc3K1QnZpIwSrMqyl4e2SU7w7RsP6D7ZxOKI/OMQOOKt8txd35ScqC/tAdcjHSWPzCmvUutJztck9E6rLs0edATpiwI1AY0uGSdoq5VrXv+enkdxiMqnNRQQJco01DFuv52WdnVRY9D6KSRKcqoJqh6uXkweH68KwpWOK7lhLEb0S5rFEfGoI1Kv76z2GE8w7vVqDzK2eOfYR3NaP6J2mJvn+tEVtMnFbZOcPYxcSP/w5mWHv2VNIJ+SYI6SE/dmyAOuxKA3detJTj9Wu+2ri8tjAVGgFuGpQQvzvOr6pmw+BzRZVT4tI7oMTCdsYwiDsMN3tV1Fa5aSHOBFPyKSGIWKnFFexLAe9cW+cOslFyrGTpdcVDNaDfTEGMiIXRV7fCAlJyog5AFX8tDFtRvJuc1SrUkcdu2g+0I1ic1oTOWzayTnSsCTHCp5TKqO8LFlbYRPySokKrq3hvzCHGaPjfreIsj2Z9BTlWPrIrlUSs6tm16Y3SpB92Q3bKPk9kJyx7VbI0Sw2hHuYqolBzGyLQYcbExe09tJSnLa6GuVSAVr50ZdkbmjoVJs+nqojLSmYvgxLn654DVXQ89xRREiZl+SXnpta65GRXJ63kOatL7sd8EKJScqKUQ0KkJKKpJbPOo0V+0Z7c7Qrh23uarnR6Sk8tnVkZyGxL+oJOd/N1M0b52pGzYGZvIo6cOr1QS880JlRMn5UYs1933YOIMmtad34hZKTtSKJhq9013JQ5dK081VbYBh4qp2K2h9bb7t2iFiUR94MKdEqHwmJbnGOviNjMZZdac9aM3V0PM8WXn1sInlsXqjgN55cSRnz4jpK3H+eZFXaLp6NGS+rlZzCS+9TojkSmeyzsiwGt2uyW/3baDkRJ21QXKlC3LQ4SBQ0FtjABZH5L6A6SHqlpo/LKPA12qnpyQiuXXvbZHJVv/+npJcVLNJFVwbJfUkp4nhuP5nyT0J5SuTyNTtkwMKx6UsYz/U3rVTJ7mHBUxW3yWO6sf0GHfLUnsk9+Qxth5s+T63fq1e0D+LX/yXvu8RHj9JCF+jk4GNibBKHt7DJX7JQQrJGMlU/WXirQTDYSgteW9MjF8OKNuqt19MBs5rfSFiMvC0eoPCBhYDIgOVz11FcgCUSK0+bTJxQHZ3vakhyXlSGdZ+DsnpvxMTWocxv6pm+1aweXsZs0PeK16iby5URtUIedLf7A2Zp+iV2ctPaLqdHsn1z6Ig53265bpXxPxR+WMIsYXvnt3RC+2R3N3rGPX9vJL6maWg7+Z/X84dvVSvUUV86+JKMpJTr0Jl+oFsP7Bf++HOsNeyxB0i3o01Xx1TaVW/9wHz2psQ+l2VlOQqAa+v6XnwMdMz0OCyOxcrViQXIpX1HIbVaGzAYEPP0BxmX3KitFAZVfNdQk493AHpWDV5DMmPziBKckrwQdcyt9X89JJ3bX1gJXi5dtDDfeNBXWdfxhmR1t/7PTSNgvqboZepi5cpOVF5CTZXew54k3aFIMTL8eMngUKciazi59qngOwBGS1awP5DwMQ5oGyGh9pNl5TkqknKl/v1PCjRJSU592GrEYhWKHfRe7BrZFXOY25s0H3B3LL3IzsyjdyKA1u9p1pznpu2WtjE2tI0RrVpJ644avIYkR+VXIdKDtsVlFZymBPTbQ6pHxQQ0fB+ZIfGMXelpE3dUYXp/u/2SK77OdUtgWquJiWCuhfkASRAArEIUHKxMNU/iJKrz4hHkMBeEKDkEqJOySUEksmQQMIEKLmEgFJyCYFkMiSQMAFKLiGglFxCIJkMCSRMgJJLGCiTIwES6CwClFxn1QdzQwIkkDABSi5hoEyOBEigswhQcp1VH8wNCZBAwgQouYSBMjkSIIHOIkDJdVZ9MDckQAIJE6DkEgbK5EiABDqLACXXWfXB3JAACSRMgJJLGCiTIwES6CwClFxn1QdzQwIkkDABSi5hoEyOBEigswhQcp1VH8wNCZBAwgQouYSBMjkSIIHOIkDJdVZ9MDckQAIJE6DkEgbK5EiABDqLQHsl92ADv3n/HXz/x97/0tX3k7cxk/897ib13xB2Fl/mhgRIYI8JtElyO9j44B0c+aEnt+eM/6Lw+Z9cRjHif6TaY068PAmQQJcSaI/k/vtfcURK7fuXbuCzL3ccXNtbuJV/B38u9/1Z7hYedylIZpsESKAzCbRHcgA28u9g5qP7ARQeo5h7E05k9zb+5UHAIdxEAiRAAk0SaJvkIvP3yXtScj/FP6xFHsmdJEACJNAQgY6T3MwnDeWfB5MACZBAJIHOkNxNFcmdxcXPI/PLnSRAAiTQEIEOkNxjFM7LUdcTeWw0lH0eTAIkQALRBPZcco8/ec8dXX35P4IGJqILwL0kQAIkEEVgbyX3+XWMyrlzz/9sBVtROeU+EiABEmiCwN5J7sHvMCPffOBE4CZqjqeQAAnEIrA3ktME99yP3+ObDrGqigeRAAk0Q6D9krtfxN8zgmumrngOCZBAEwTaKzkKrokq4ikkQAK7IdA+yemCe+MKbvFl/N3UG88lARKISaA9ktME99yJyyh8voWtB+Gfx9sxc8/DSIAESKAOgbZI7m7+vPtuqvkTS0HrfLWrTq1xNwmQQGwClFxsVDyQBEigGwm0RXLdCIZ5JgESSAcBSi4d9chSkAAJhBCg5ELAcDMJkEA6CFBy6ahHloIESCCEACUXAoabSYAE0kGAkktHPbIUJEACIQQouRAw3EwCJJAOApRcOuqRpSABEgghQMmFgOFmEiCBdBCg5NJRjywFCZBACIFUSO7+/fvgJ/0MLMuC/mGdp7/Ok6hjSo6C7Jo/ELrgxHISDwDTSL8oKTlKrmtkQcmlX0it+KNDyVFylBzvga65B5qRYColF9L/yM1dTsCM5Lq8OMx+mwhQcm0CzcvsngAlt3uGT2MKlNzTWOtdWmZKrksrbo+zTcntcQXw8vEJUHLxWfFIjwAl57HgUocToOQ6vII6NHuUXIdWTNuytQEMWoAV8JleaVsuYl2IkouFiQcZBNonua0NXL90AS8fPY5vv/ADPNPzAzzzwisYOPqPeOvfNvDljpGzBlbNYeUGTuWhZWCiH8iqzyHAlsKj5Hh7pIFAmyT3Od4dkWITcgv4PDv0S9x81BxSSq45boFnaZEdJRdIiBu7jEDbJPerv5nBiUsf4dPyVx6iRxv48K038IKUXvbN//T2NbBEyTUAq96hlFw9QtzfZQTaJLkoKl/j+o9U8/UCbkYdGrKPkgsB08xmSq4Zajyngwl0gOSAzy/NyCbsWXzYBKwayW0D+dPAYJ/Xob7/EDC9BGyGpD+rjrWB5XvBB21e9vqrhhdqj6msA7nTwGg/sN/2rp3pB6YXgPJ27TnlBee4yQ8APATmXnSu0XMYKDx0ji+eluntAyYuG2msyOsMAWWxaxNYnAKyB+T2fcDoFFAKuLaRkrPapOTK14DxIaBH9ufZB5zrroUBD7x49EYOPETz4d5gAp0luRcSiORubmN0n3zAbdmhrgRmAfYhTx4+JOvAsBSTPRYgw3vAuNp/DKj4TgagySFopFJsC7q2ktzgBSB3VOZbiqL3FFBa8MRaTdeUsJLc94C1VWBAk6ueD3HtYk2mzUL4yxGrT24byI14+RZ/TMQghpKdZQOx0gnIirmJkjOJcD0OgQ6Q3BZ+Ne40V5/90Ue18ohRCjeS2/ga43/kPHCZ14zIqQxMStkFSgx+oQxf9F94eUw+yH0hktwAxkeA3BWgpEcvFaB4xhNV5rQ/XSW53j7nmLnbAG4DWSG6w8CgDWSmHKnO9Tt5mLiqpaEkJyQqBTe+AGxKoZWvABkpzYEz2nlhi5qs48gpf8zjslwNJWXC28Dya3KfKeawa9fZTsnVAcTdgQT2VnI7X+D6qSk8KwYevnMWH+5qdPVLXH9dPlSHgVJQce8AA/KBn10NOgBwH1obWNxwjtGbqdM3gs+rt9VNt9+fNyU5EXVlTslUKsCEzKd1ECjKzYUpp3yDelNZk5yImoLKVTwpuWhphea3EcmtAr0yn/N3glOcP+xcu/dk8P5GtlJyjdDisYpAmyV3C2999zgGqp9XvVHVY1fxaZOCEwWpRnLlP2BCRnG+SEeVVH7nvuc8dNmwqOYhMK0ivqNASWvGiiZls/90mRW0RNztNpCXfXBi97SUx7jWB1dPcqGRVwwZuVlqQHJ5FakFNd9lgqULUrCG3N3rNbBAyTUAi4e6BNosud/iRMAcuWd6XsHg376Pm1tuvhpaqEru33fwx1UxfIOcjMCCElGisCIezMoNr4nXI/v3bCG8oARjbnNlZgGBklMDBzI9JTm9LCrvYZGcnq4vW5vAuJRmqAjVCQ1IbvagIzBfflQ66luLNPNx+gTVeQHflFwAFG6qS6DNkjPy8+gLfPrB+3jtL9QUkjfwboSgjLPd1arkru64ryapzm93Fr+azd8PZNSghCEVNzG54EYgQg5GlGUeq6+XV4H5k85Io+/6arRzLyQXEhnq+XaXG5CcErEYSfWVVeOd1QZ9dGG712tggZJrABYPdQnsreRUNh79Fie+0/zggyk5fVQxdDloBFXlB4CKmqrnhw02aMfjHjB5SDbNZNQUdm094nIjPEO6SiC6GFSefJGTFinp6epZE8sqvepUFXOnvt6E5MLKaW5f1gdk9GvGXKbkYoLiYT4CnSE5AOv/fFy+z9r4NBK/5KKbq77Sh6xUVrzmqhqxrNdcVR3sVh+QWwUqxrw0V2Z7EcmVgWHVXK03cNKE5HzSDWGaxGZKLgmKT18aHSO5m2++6khu+NdYb7AeqpL7dBt/qR7k3fx6hjbQIKZubGr9c+7op5k/rWM/aHRTHL6Xkqtc9SLMuv1iDUhuUc7rs6dMIK1Zp+RawzXtqXaG5B59hNf/1GmuDr7deKdcVXL3H+H8XzkPc72oK6pSc0NSCFoTtXTGk0Rgx73WZMwFGXoTmNcm+urNSld+LWyuqjL1yvl2UeXXJzUHllU7eXNJcrGBwHJrxyaxSMklQfHpS2NPJVfZ2sDNy7/Ei9+WAw9NzpVzJHcf5fwO/kRGc/YRYPm2v9lY2QSKS8DEi97cM73KVZ+X6Esy58O5byMEPdBa9FOdhKxGER8ChXNA1ngLoVWS0/vvquWqAIsveSIKe11NZ9CI5MTMbTXdpvpmwxWgrE2DEa+plcRAzDFgtl4z2ZeJ4BVKLpgLt0YTaI/kbpwN/Hkl/SeXXjh6aXdTSKr/rdyXWF144s7wNzu+3XW7VnKiSad+Ry2wWao1Y8WbCOZ0El2Q7nXUAIQNTJzyfpyyVZKrXnefHOnUfhfO2hceaUXmW+U/qhtgHRjXRlBryq7OpeSin0TubRmBPZTcK8h+dwYvn7qK6581OUFOYlGRnPoWb6rnTgKDxoOeHQHml4CyirQUVl1gQ7UCU4eVL2oiDGj6rS0Bo9o1e/qA8dPyNS8t2muV5PZr01SEbDJDwGzIDwOoMu1aciKhbaCw4EybMX+YYOIcUGy8B0Jlz/fNSM6HgysxCbRHcjEz0+xhSm7qu9l0uvI8rT9Ql2dXlqVOpim5OoC4O5AAJReIpYs2UnJdVFnM6l4QoOT2gnqS16TkkqTJtFJIgJLr9kql5Lq9Bpn/FhOg5FoMuOXJP8WS+99vWXh08RctR8wLdDcBSq676y+VuQ8TlznwICRH0aXyFki0UKmUnBpl5fd957f2qnMIu2dZiOvuz3/my7tYNyX3f6//XVVyQcez7runvltdV5Rclwmg1TdEJ6SvIjQlOvEttpmSE3ml6CizevcsJUfJ+SKmejdMO/br4ir/9YgbrQVJzhSdOL4deeQ1ukeulBwl15FS0EX3P9+yqhFbmORM0VFA3SOgdtRVKiSXaC8lEyMBEkgVAUouVdXJwpAACZgEKDmTCNdJgARSRYCSS1V1sjAkQAImAUrOJMJ1EiCBVBGg5FJVnSwMCZCASYCSM4lwnQRIIFUEKLlUVScLQwIkYBKg5EwiXCcBEkgVAUouVdXJwpAACZgEKDmTCNdJgARSRYCSS1V1sjAkQAImAUrOJMJ1EiCBVBGg5FJVnSwMCZCASYCSM4lwnQRIIFUEKLlUVScLQwIkYBKg5EwiXCcBEkgVAUouVdXJwpAACZgEKDmTCNdJgARSRYCSS1V1sjAkQAImAUrOJMJ1EiCBVBGg5FJVnSwMCZCASYCSM4lwnQRIIFUEKLlUVScLQwIkYBKg5EwiXCcBEkgVAUouVdXJwpAACZgEKDmTCNdJgARSRYCSS1V1sjAkQAImAUrOJMJ1EiCBVBGg5FJVnSwMCZCASYCSM4lwnQRIIFUEKLlUVScLQwIkYBKg5EwiXCcBEkgVAUouVdXJwpAACZgEKDmTCNdJgARSReD/ARa8RcYpet5CAAAAAElFTkSuQmCC" alt=""/></p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)"><img data-attachment-id="14279" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-26-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-26.png" data-orig-size="256,124" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-26" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-26.png?w=256" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-26.png?w=256" width="256" height="124" src="https://terrytao.files.wordpress.com/2023/12/image-26.png?w=256" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-26.png 256w, https://terrytao.files.wordpress.com/2023/12/image-26.png?w=150 150w" sizes="(max-width: 256px) 100vw, 256px"/></a></figure>



<p>Now we have to declare the hypotheses and variables.  The main variables here are the sequences <img src="https://s0.wp.com/latex.php?latex=a_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=a_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=a_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="a_k"/> and <img src="https://s0.wp.com/latex.php?latex=D_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=D_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=D_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="D_k"/>, which in Lean are best modeled by functions <code>a</code>, <code>D</code> from the natural numbers ℕ to the reals ℝ.  (One can choose to “hardwire” the non-negativity hypothesis into the <img src="https://s0.wp.com/latex.php?latex=D_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=D_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=D_k&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="D_k"/> by making <code>D</code> take values in the nonnegative reals <img src="https://s0.wp.com/latex.php?latex=%7B%5Cbf+R%7D%5E%2B&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%7B%5Cbf+R%7D%5E%2B&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%7B%5Cbf+R%7D%5E%2B&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="{\bf R}^+"/> (denoted <code><a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Real/NNReal.html#NNReal">NNReal</a></code> in Lean), but this turns out to be inconvenient, because the laws of algebra and summation that we will need are clunkier on the non-negative reals (which are not even a group) than on the reals (which are a field).  So we add in the variables:</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)"><img data-attachment-id="14205" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-26/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image.png" data-orig-size="452,159" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image.png?w=452" width="452" height="159" src="https://terrytao.files.wordpress.com/2023/12/image.png?w=452" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image.png 452w, https://terrytao.files.wordpress.com/2023/12/image.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image.png?w=300 300w" sizes="(max-width: 452px) 100vw, 452px"/></a></figure>



<p>Now we add in the hypotheses, which in Lean convention are usually given names starting with <code>h</code>.  This is fairly straightforward; the one thing is that the property of being monotone decreasing already has a name in Lean’s Mathlib, namely <code><a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Order/Monotone/Basic.html#Antitone">Antitone</a></code>, and it is generally a good idea to use the Mathlib provided terminology (because that library contains a lot of useful lemmas about such terms).</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%20%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)"><img data-attachment-id="14289" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-27/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-27.png" data-orig-size="1519,180" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-27" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-27.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-27.png?w=490" width="1024" height="121" src="https://terrytao.files.wordpress.com/2023/12/image-27.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-27.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/12/image-27.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-27.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-27.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-27.png 1519w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>One thing to note here is that Lean is quite good at filling in implied ranges of variables.  Because <code>a</code> and <code>D</code> have the natural numbers ℕ as their domain, the dummy variable <code>k</code> in these hypotheses is automatically being quantified over ℕ.  We <em>could</em> have made this quantification explicit if we so chose, for instance using <code>∀ k : ℕ, 0 ≤ D k</code> instead of <code>∀ k, 0 ≤ D k</code>, but it is not necessary to do so.  Also note that Lean does not require parentheses when applying functions: we write <code>D k</code> here rather than <code>D(k)</code> (which in fact does not compile in Lean unless one puts a space between the <code>D</code> and the parentheses).  This is slightly different from standard mathematical notation, but is not too difficult to get used to.</p>



<p>This looks like the end of the hypotheses, so we could now add a colon to move to the conclusion, and then add that conclusion:</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%20%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%200%20%2F%20(k%20%2B%201)"><img data-attachment-id="14209" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-1-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-1.png" data-orig-size="1491,187" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-1" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-1.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-1.png?w=490" loading="lazy" width="1024" height="128" src="https://terrytao.files.wordpress.com/2023/12/image-1.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-1.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/12/image-1.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-1.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-1.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-1.png 1491w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>This is a perfectly fine Lean statement.  But it turns out that when proving a universally quantified statement such as <code>∀ k, a k ≤ D 0 / (k + 1)</code>, the first step is almost always to open up the quantifier to introduce the variable <code>k</code> (using the Lean command <code>intro k</code>).  Because of this, it is slightly more efficient to hide the universal quantifier by placing the variable <code>k</code> in the hypotheses, rather than in the quantifier (in which case we have to now specify that it is a natural number, as Lean can no longer deduce this from context):</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%20%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)%20(k%20%3A%20%E2%84%95)%20%3A%20a%20k%20%E2%89%A4%20D%200%20%2F%20(k%20%2B%201)"><img data-attachment-id="14212" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-2-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-2.png" data-orig-size="1628,187" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-2" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-2.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-2.png?w=490" loading="lazy" width="1024" height="117" src="https://terrytao.files.wordpress.com/2023/12/image-2.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-2.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/12/image-2.png?w=1019 1019w, https://terrytao.files.wordpress.com/2023/12/image-2.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-2.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-2.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-2.png 1628w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>At this point Lean is complaining of an unexpected end of input: the example has been stated, but not proved.  We will temporarily mollify Lean by adding a <code>sorry</code> as the purported proof:</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%20%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)%20(k%20%3A%20%E2%84%95)%20%0D%0A%20%20%3A%20a%20k%20%E2%89%A4%20D%200%20%2F%20(k%20%2B%201)%20%3A%3D%20sorry"><img data-attachment-id="14214" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-3-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-3.png" data-orig-size="1622,182" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-3" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-3.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-3.png?w=490" loading="lazy" width="1024" height="114" src="https://terrytao.files.wordpress.com/2023/12/image-3.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-3.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/12/image-3.png?w=1016 1016w, https://terrytao.files.wordpress.com/2023/12/image-3.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-3.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-3.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-3.png 1622w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>Now Lean is content, other than giving a warning (as indicated by the yellow squiggle under the <code>example</code>) that the proof contains a sorry.</p>



<p>It is now time to follow the blueprint.  The Lean tactic for proving an inequality via chains of other inequalities is known as <code><a href="https://leanprover-community.github.io/extras/calc.html">calc</a></code>.  We use the blueprint to fill in the <code>calc</code> that we want, leaving the justifications of each step as “<code>sorry</code>”s for now:</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aopen%20Finset%20BigOperators%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%20%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)%20(k%20%3A%20%E2%84%95)%20%0D%0A%20%20%3A%20a%20k%20%E2%89%A4%20D%200%20%2F%20(k%20%2B%201)%20%3A%3D%20calc%0D%0A%20%20%20%20a%20k%20%3D%20(k%2B1)%20*%20(a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry%0D%0A%20%20%20%20_%20%3D%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20i)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry%20%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20(D%20i%20-%20D%20(i%2B1)))%20%2F%20(k%2B1)%20%20%3A%3D%20by%20sorry%0D%0A%20%20%20%20_%20%3D%20(D%200%20-%20D%20(k%2B1))%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry%0D%0A%20%20%20%20_%20%E2%89%A4%20D%200%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry"><img data-attachment-id="14222" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-6-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-6.png" data-orig-size="1628,481" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-6" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-6.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-6.png?w=490" loading="lazy" width="1024" height="302" src="https://terrytao.files.wordpress.com/2023/12/image-6.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-6.png?w=1022 1022w, https://terrytao.files.wordpress.com/2023/12/image-6.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-6.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-6.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-6.png 1628w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>Here, we “<code>open</code>“ed the <code><a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Finset/Basic.html">Finset</a></code> namespace in order to easily access <code>Finset</code>‘s <code><a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Finset/Basic.html#Finset.range">range</a></code> function, with <code>range k</code> basically being the finite set of natural numbers <img src="https://s0.wp.com/latex.php?latex=%5C%7B0%2C%5Cdots%2Ck-1%5C%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5C%7B0%2C%5Cdots%2Ck-1%5C%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5C%7B0%2C%5Cdots%2Ck-1%5C%7D&amp;bg=ffffff&amp;fg=545454&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\{0,\dots,k-1\}"/>, and also “<code>open</code>“ed the <code><a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/BigOperators/Basic.html">BigOperators</a></code> namespace to access the familiar ∑ notation for (finite) summation, in order to make the steps in the Lean code resemble the blueprint as much as possible.  One could avoid opening these namespaces, but then expressions such as <code>∑ i in range (k+1), a i</code> would instead have to be written as something like <code>Finset.sum (Finset.range (k+1)) (fun i ↦ a i)</code>, which looks a lot less like like standard mathematical writing.  The proof structure here may remind some readers of the “two column proofs” that are somewhat popular in American high school geometry classes.</p>



<p>Now we have six sorries to fill.  Navigating to the first sorry, Lean tells us the ambient hypotheses, and the goal that we need to prove to fill that sorry:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/12/image-5.png"><img data-attachment-id="14219" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-5-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-5.png" data-orig-size="672,235" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-5" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-5.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-5.png?w=490" loading="lazy" width="672" height="235" src="https://terrytao.files.wordpress.com/2023/12/image-5.png?w=672" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-5.png 672w, https://terrytao.files.wordpress.com/2023/12/image-5.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-5.png?w=300 300w" sizes="(max-width: 672px) 100vw, 672px"/></a></figure>



<p>The ⊢ symbol here is Lean’s marker for the goal.  The uparrows ↑ are coercion symbols, indicating that the natural number <code>k</code> has to be converted to a real number in order to interact via arithmetic operations with other real numbers such as <code>a k</code>, but we can ignore these coercions for this tour (for this proof, it turns out Lean will basically manage them automatically without need for any explicit intervention by a human).  </p>



<p>The goal here is a self-evident algebraic identity; it involves division, so one has to check that the denominator is non-zero, but this is self-evident.  In Lean, a convenient way to establish algebraic identities is to use the tactic <code><a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#field_simp">field_simp</a></code> to clear denominators, and then <code><a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#ring">ring</a></code> to verify any identity that is valid for commutative rings.  This works, and clears the first <code>sorry</code>:</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aopen%20Finset%20BigOperators%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%20%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)%20(k%20%3A%20%E2%84%95)%20%0D%0A%20%20%3A%20a%20k%20%E2%89%A4%20D%200%20%2F%20(k%20%2B%201)%20%3A%3D%20calc%0D%0A%20%20%20%20a%20k%20%3D%20(k%2B1)%20*%20(a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20field_simp%3B%20ring%0D%0A%20%20%20%20_%20%3D%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20i)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry%20%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20(D%20i%20-%20D%20(i%2B1)))%20%2F%20(k%2B1)%20%20%3A%3D%20by%20sorry%0D%0A%20%20%20%20_%20%3D%20(D%200%20-%20D%20(k%2B1))%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry%0D%0A%20%20%20%20_%20%E2%89%A4%20D%200%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry"><img data-attachment-id="14223" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-7-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-7.png" data-orig-size="1630,476" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-7" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-7.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-7.png?w=490" loading="lazy" width="1024" height="299" src="https://terrytao.files.wordpress.com/2023/12/image-7.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-7.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/12/image-7.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-7.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-7.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-7.png 1630w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p><code>field_simp</code>, by the way, is smart enough to deduce on its own that the denominator <code>k+1</code> here is manifestly non-zero (and in fact positive); no human intervention is required to point this out.  Similarly for other “clearing denominator” steps that we will encounter in the other parts of the proof.</p>



<p>Now we navigate to the next `sorry`.  Lean tells us the hypotheses and goals:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/12/image-8.png"><img data-attachment-id="14226" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-8-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-8.png" data-orig-size="772,277" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-8" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-8.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-8.png?w=490" loading="lazy" width="772" height="277" src="https://terrytao.files.wordpress.com/2023/12/image-8.png?w=772" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-8.png 772w, https://terrytao.files.wordpress.com/2023/12/image-8.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-8.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-8.png?w=768 768w" sizes="(max-width: 772px) 100vw, 772px"/></a></figure>



<p>We can reduce the goal by canceling out the common denominator <code>↑k+1</code>.  Here we can use the handy Lean tactic <code><a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#congr">congr</a></code>, which tries to match two sides of an equality goal as much as possible, and leave any remaining discrepancies between the two sides as further goals to be proven.  Applying <code>congr</code>, the goal reduces to</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/12/image-9.png"><img data-attachment-id="14229" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-9-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-9.png" data-orig-size="768,226" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-9" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-9.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-9.png?w=490" loading="lazy" width="768" height="226" src="https://terrytao.files.wordpress.com/2023/12/image-9.png?w=768" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-9.png 768w, https://terrytao.files.wordpress.com/2023/12/image-9.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-9.png?w=300 300w" sizes="(max-width: 768px) 100vw, 768px"/></a></figure>



<p> Here one might imagine that this is something that one can prove by induction.  But this particular sort of identity – summing a constant over a finite set – is already covered by Mathlib.  Indeed, searching for <code>Finset</code>, <code>sum</code>, and <code>const</code> soon leads us to the <code><a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/BigOperators/Basic.html#Finset.sum_const">Finset.sum_const</a></code> lemma here.  But there is an even more convenient path to take here, which is to apply the powerful tactic <code>simp</code>, which tries to simplify the goal as much as possible using all the “<code>simp</code> lemmas” Mathlib has to offer (of which <code><a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/BigOperators/Basic.html#Finset.sum_const">Finset.sum_const</a></code> is an example, but there are thousands of others).  As it turns out, <code>simp</code> completely kills off this identity, without any further human intervention:</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aopen%20Finset%20BigOperators%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%20%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)%20(k%20%3A%20%E2%84%95)%20%0D%0A%20%20%3A%20a%20k%20%E2%89%A4%20D%200%20%2F%20(k%20%2B%201)%20%3A%3D%20calc%0D%0A%20%20%20%20a%20k%20%3D%20(k%2B1)%20*%20(a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20field_simp%3B%20ring%0D%0A%20%20%20%20_%20%3D%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20congr%3B%20simp%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20i)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry%20%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20(D%20i%20-%20D%20(i%2B1)))%20%2F%20(k%2B1)%20%20%3A%3D%20by%20sorry%0D%0A%20%20%20%20_%20%3D%20(D%200%20-%20D%20(k%2B1))%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry%0D%0A%20%20%20%20_%20%E2%89%A4%20D%200%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry"><img data-attachment-id="14233" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-10-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-10.png" data-orig-size="1645,511" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-10" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-10.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-10.png?w=490" loading="lazy" width="1024" height="318" src="https://terrytao.files.wordpress.com/2023/12/image-10.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-10.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/12/image-10.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-10.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-10.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-10.png 1645w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>Now we move on to the next sorry, and look at our goal:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/12/image-11.png"><img data-attachment-id="14235" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-11-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-11.png" data-orig-size="785,267" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-11" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-11.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-11.png?w=490" loading="lazy" width="785" height="267" src="https://terrytao.files.wordpress.com/2023/12/image-11.png?w=785" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-11.png 785w, https://terrytao.files.wordpress.com/2023/12/image-11.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-11.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-11.png?w=768 768w" sizes="(max-width: 785px) 100vw, 785px"/></a></figure>



<p><code>congr</code> doesn’t work here because we have an inequality instead of an equality, but there is a powerful relative <code><a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Tactic/GCongr/Core.html">gcongr</a></code> of <code>congr</code> that is perfectly suited for inequalities.  It can also open up sums, products, and integrals, reducing global inequalities between such quantities into pointwise inequalities.  If we invoke <code>gcongr with i hi</code> (where we tell <code>gcongr</code> to use <code>i</code> for the variable opened up, and <code>hi</code> for the constraint this variable will satisfy), we arrive at a greatly simplified goal (and a new ambient variable and hypothesis):</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/12/image-12.png"><img data-attachment-id="14239" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-12-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-12.png" data-orig-size="762,244" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-12" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-12.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-12.png?w=490" loading="lazy" width="762" height="244" src="https://terrytao.files.wordpress.com/2023/12/image-12.png?w=762" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-12.png 762w, https://terrytao.files.wordpress.com/2023/12/image-12.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-12.png?w=300 300w" sizes="(max-width: 762px) 100vw, 762px"/></a></figure>



<p>Now we need to use the monotonicity hypothesis on <code>a</code>, which we have named <code>ha</code> here.  Looking at the <a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Order/Monotone/Basic.html">documentation for Antitone</a>, one finds a lemma that looks applicable here:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/12/image-13.png"><img data-attachment-id="14241" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-13-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-13.png" data-orig-size="1560,253" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-13" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-13.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-13.png?w=490" loading="lazy" width="1024" height="166" src="https://terrytao.files.wordpress.com/2023/12/image-13.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-13.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/12/image-13.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-13.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-13.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-13.png 1560w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>One can apply this lemma in this case by writing <code>apply Antitone.imp ha</code>, but because <code>ha</code> is already of type <code>Antitone</code>, we can abbreviate this to <code>apply ha.imp</code>.  (Actually, as indicated in the documentation, due to the way <code>Antitone</code> is defined, we can even just use <code>apply ha</code> here.)  This reduces the goal nicely:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/12/image-14.png"><img data-attachment-id="14244" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-14-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-14.png" data-orig-size="675,255" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-14" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-14.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-14.png?w=490" loading="lazy" width="675" height="255" src="https://terrytao.files.wordpress.com/2023/12/image-14.png?w=675" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-14.png 675w, https://terrytao.files.wordpress.com/2023/12/image-14.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-14.png?w=300 300w" sizes="(max-width: 675px) 100vw, 675px"/></a></figure>



<p>The goal is now very close to the hypothesis <code>hi</code>.  One could now look up the documentation for <code>Finset.range</code> to see how to unpack <code>hi</code>, but as before <code>simp</code> can do this for us.  Invoking <code>simp at hi</code>, we obtain</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/12/image-15.png"><img data-attachment-id="14247" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-15-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-15.png" data-orig-size="671,263" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-15" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-15.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-15.png?w=490" loading="lazy" width="671" height="263" src="https://terrytao.files.wordpress.com/2023/12/image-15.png?w=671" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-15.png 671w, https://terrytao.files.wordpress.com/2023/12/image-15.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-15.png?w=300 300w" sizes="(max-width: 671px) 100vw, 671px"/></a></figure>



<p>Now the goal and hypothesis are very close indeed.  Here we can just close the goal using the <code><a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#linarith">linarith</a></code> tactic used in the <a href="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/">previous tour</a>:</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aopen%20Finset%20BigOperators%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%20%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)%20(k%20%3A%20%E2%84%95)%20%0D%0A%20%20%3A%20a%20k%20%E2%89%A4%20D%200%20%2F%20(k%20%2B%201)%20%3A%3D%20calc%0D%0A%20%20%20%20a%20k%20%3D%20(k%2B1)%20*%20(a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20field_simp%3B%20ring%0D%0A%20%20%20%20_%20%3D%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20congr%3B%20simp%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20i)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20gcongr%20with%20i%20hi%3B%20apply%20ha%3B%20simp%20at%20hi%3B%20linarith%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20(D%20i%20-%20D%20(i%2B1)))%20%2F%20(k%2B1)%20%20%3A%3D%20by%20sorry%0D%0A%20%20%20%20_%20%3D%20(D%200%20-%20D%20(k%2B1))%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry%0D%0A%20%20%20%20_%20%E2%89%A4%20D%200%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry"><img data-attachment-id="14250" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-16-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-16.png" data-orig-size="1744,519" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-16" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-16.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-16.png?w=490" loading="lazy" width="1024" height="304" src="https://terrytao.files.wordpress.com/2023/12/image-16.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-16.png?w=1022 1022w, https://terrytao.files.wordpress.com/2023/12/image-16.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-16.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-16.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-16.png 1744w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>The next sorry can be resolved by similar methods, using the hypothesis <code>hD</code> applied at the variable <code>i</code>:</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aopen%20Finset%20BigOperators%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%20%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)%20(k%20%3A%20%E2%84%95)%20%0D%0A%20%20%3A%20a%20k%20%E2%89%A4%20D%200%20%2F%20(k%20%2B%201)%20%3A%3D%20calc%0D%0A%20%20%20%20a%20k%20%3D%20(k%2B1)%20*%20(a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20field_simp%3B%20ring%0D%0A%20%20%20%20_%20%3D%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20congr%3B%20simp%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20i)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20gcongr%20with%20i%20hi%3B%20apply%20ha%3B%20simp%20at%20hi%3B%20linarith%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20(D%20i%20-%20D%20(i%2B1)))%20%2F%20(k%2B1)%20%20%3A%3D%20by%20gcongr%20with%20i%20hi%3B%20exact%20hD%20i%0D%0A%20%20%20%20_%20%3D%20(D%200%20-%20D%20(k%2B1))%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry%0D%0A%20%20%20%20_%20%E2%89%A4%20D%200%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry"><img data-attachment-id="14252" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-17-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-17.png" data-orig-size="1739,493" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-17" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-17.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-17.png?w=490" loading="lazy" width="1024" height="290" src="https://terrytao.files.wordpress.com/2023/12/image-17.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-17.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/12/image-17.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-17.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-17.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-17.png 1739w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>Now for the penultimate sorry.  As in a previous step, we can use <code>congr</code> to remove the denominator, leaving us in this state:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/12/image-18.png"><img data-attachment-id="14254" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-18-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-18.png" data-orig-size="764,249" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-18" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-18.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-18.png?w=490" loading="lazy" width="764" height="249" src="https://terrytao.files.wordpress.com/2023/12/image-18.png?w=764" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-18.png 764w, https://terrytao.files.wordpress.com/2023/12/image-18.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-18.png?w=300 300w" sizes="(max-width: 764px) 100vw, 764px"/></a></figure>



<p>This is a telescoping series identity.  One could try to prove it by induction, or one could try to see if this identity is already in Mathlib.  Searching for <code>Finset</code>, <code>sum</code>, and <code>sub</code> will <a href="https://leanprover-community.github.io/mathlib4_docs/search.html?sitesearch=https%3A%2F%2Fleanprover-community.github.io%2Fmathlib4_docs&amp;q=finset+sum+sub">locate the right tool</a> (as the fifth hit), but a simpler way to proceed here is to use the <code>exact?</code> tactic we saw in the <a href="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/">previous tour</a>:</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/12/image-19.png"><img data-attachment-id="14256" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-19-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-19.png" data-orig-size="755,156" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-19" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-19.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-19.png?w=490" loading="lazy" width="755" height="156" src="https://terrytao.files.wordpress.com/2023/12/image-19.png?w=755" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-19.png 755w, https://terrytao.files.wordpress.com/2023/12/image-19.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-19.png?w=300 300w" sizes="(max-width: 755px) 100vw, 755px"/></a></figure>



<p>A brief check of the documentation for <code><a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/BigOperators/Basic.html#Finset.sum_range_sub&#39;">sum_range_sub&#39;</a></code> confirms that this is what we want.  Actually we can just use <code>apply sum_range_sub&#39;</code> here, as the <code><a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#apply">apply</a></code> tactic is smart enough to fill in the missing arguments:</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aopen%20Finset%20BigOperators%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%20%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)%20(k%20%3A%20%E2%84%95)%20%0D%0A%20%20%3A%20a%20k%20%E2%89%A4%20D%200%20%2F%20(k%20%2B%201)%20%3A%3D%20calc%0D%0A%20%20%20%20a%20k%20%3D%20(k%2B1)%20*%20(a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20field_simp%3B%20ring%0D%0A%20%20%20%20_%20%3D%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20congr%3B%20simp%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20i)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20gcongr%20with%20i%20hi%3B%20apply%20ha%3B%20simp%20at%20hi%3B%20linarith%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20(D%20i%20-%20D%20(i%2B1)))%20%2F%20(k%2B1)%20%20%3A%3D%20by%20gcongr%20with%20i%20hi%3B%20exact%20hD%20i%0D%0A%20%20%20%20_%20%3D%20(D%200%20-%20D%20(k%2B1))%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20congr%3B%20apply%20sum_range_sub&#39;%0D%0A%20%20%20%20_%20%E2%89%A4%20D%200%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20sorry"><img data-attachment-id="14259" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-20-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-20.png" data-orig-size="1744,476" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-20" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-20.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-20.png?w=490" loading="lazy" width="1024" height="279" src="https://terrytao.files.wordpress.com/2023/12/image-20.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-20.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/12/image-20.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-20.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-20.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-20.png 1744w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>One last <code>sorry</code> to go.  As before, we use <code>gcongr</code> to cancel denominators, leaving us with</p>



<figure><a href="https://terrytao.files.wordpress.com/2023/12/image-21.png"><img data-attachment-id="14261" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-21-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-21.png" data-orig-size="662,217" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-21" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-21.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-21.png?w=490" loading="lazy" width="662" height="217" src="https://terrytao.files.wordpress.com/2023/12/image-21.png?w=662" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-21.png 662w, https://terrytao.files.wordpress.com/2023/12/image-21.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-21.png?w=300 300w" sizes="(max-width: 662px) 100vw, 662px"/></a></figure>



<p>This looks easy, because the hypothesis <code>hpos</code> will tell us that <code>D (k+1)</code> is nonnegative; specifically, the instance <code>hpos (k+1)</code> of that hypothesis will state exactly this.  The <code>linarith</code> tactic will then resolve this goal once it is told about this particular instance:</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aopen%20Finset%20BigOperators%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%20%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)%20(k%20%3A%20%E2%84%95)%20%0D%0A%20%20%3A%20a%20k%20%E2%89%A4%20D%200%20%2F%20(k%20%2B%201)%20%3A%3D%20calc%0D%0A%20%20%20%20a%20k%20%3D%20(k%2B1)%20*%20(a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20field_simp%3B%20ring%0D%0A%20%20%20%20_%20%3D%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20congr%3B%20simp%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20i)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20gcongr%20with%20i%20hi%3B%20apply%20ha%3B%20simp%20at%20hi%3B%20linarith%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20(D%20i%20-%20D%20(i%2B1)))%20%2F%20(k%2B1)%20%20%3A%3D%20by%20gcongr%20with%20i%20hi%3B%20exact%20hD%20i%0D%0A%20%20%20%20_%20%3D%20(D%200%20-%20D%20(k%2B1))%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20congr%3B%20apply%20sum_range_sub&#39;%0D%0A%20%20%20%20_%20%E2%89%A4%20D%200%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20gcongr%3B%20linarith%20%5Bhpos%20(k%2B1)%5D"><img data-attachment-id="14264" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-22-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-22.png" data-orig-size="1782,513" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-22" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-22.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-22.png?w=490" loading="lazy" width="1024" height="294" src="https://terrytao.files.wordpress.com/2023/12/image-22.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-22.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/12/image-22.png?w=1021 1021w, https://terrytao.files.wordpress.com/2023/12/image-22.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-22.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-22.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-22.png 1782w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>We now have a complete proof – no more yellow squiggly line in the example.  There are two warnings though – there are two variables <code>i</code> and <code>hi</code> introduced in the proof that Lean’s “linter” has noticed are not actually used in the proof.  So we can rename them with underscores to tell Lean that we are okay with them not being used:</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aopen%20Finset%20BigOperators%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%20%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)%20(k%20%3A%20%E2%84%95)%20%0D%0A%20%20%3A%20a%20k%20%E2%89%A4%20D%200%20%2F%20(k%20%2B%201)%20%3A%3D%20calc%0D%0A%20%20%20%20a%20k%20%3D%20(k%2B1)%20*%20(a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20field_simp%3B%20ring%0D%0A%20%20%20%20_%20%3D%20(%E2%88%91%20_i%20in%20range%20(k%2B1)%2C%20a%20k)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20congr%3B%20simp%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20a%20i)%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20gcongr%20with%20i%20hi%3B%20apply%20ha%3B%20simp%20at%20hi%3B%20linarith%0D%0A%20%20%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20(D%20i%20-%20D%20(i%2B1)))%20%2F%20(k%2B1)%20%20%3A%3D%20by%20gcongr%20with%20i%20_%3B%20exact%20hD%20i%0D%0A%20%20%20%20_%20%3D%20(D%200%20-%20D%20(k%2B1))%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20congr%3B%20apply%20sum_range_sub&#39;%0D%0A%20%20%20%20_%20%E2%89%A4%20D%200%20%2F%20(k%2B1)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%3D%20by%20gcongr%3B%20linarith%20%5Bhpos%20(k%2B1)%5D"><img data-attachment-id="14266" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-23-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-23.png" data-orig-size="1763,479" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-23" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-23.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-23.png?w=490" loading="lazy" width="1024" height="278" src="https://terrytao.files.wordpress.com/2023/12/image-23.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-23.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/12/image-23.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-23.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-23.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-23.png 1763w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>This is a perfectly fine proof, but upon noticing that many of the steps are similar to each other, one can do a bit of “code golf” as in the <a href="https://terrytao.wordpress.com/2023/11/18/formalizing-the-proof-of-pfr-in-lean4-using-blueprint-a-short-tour/">previous tour</a> to compactify the proof a bit:</p>



<figure><a href="https://live.lean-lang.org/#code=import%20Mathlib%0D%0A%0D%0Aopen%20Finset%20BigOperators%0D%0A%0D%0Aexample%20(a%20D%20%3A%20%E2%84%95%20%E2%86%92%20%E2%84%9D)%20(hD%20%3A%20%E2%88%80%20k%2C%20a%20k%20%E2%89%A4%20D%20k%20-%20D%20(k%2B1))%20(hpos%3A%20%E2%88%80%20k%2C%200%20%E2%89%A4%20D%20k)%20(ha%20%3A%20Antitone%20a)%20(k%20%3A%20%E2%84%95)%20%3A%20a%20k%20%E2%89%A4%20D%200%20%2F%20(k%20%2B%201)%20%3A%3D%20calc%0D%0A%20%20a%20k%20%3D%20(%E2%88%91%20_i%20in%20range%20(k%2B1)%2C%20a%20k)%20%2F%20(k%2B1)%20%3A%3D%20by%20simp%3B%20field_simp%3B%20ring%0D%0A%20%20_%20%E2%89%A4%20(%E2%88%91%20i%20in%20range%20(k%2B1)%2C%20(D%20i%20-%20D%20(i%2B1)))%20%2F%20(k%2B1)%20%3A%3D%20by%20gcongr%20with%20i%20hi%3B%20apply%20le_trans%20_%20(hD%20i)%3B%20apply%20ha%3B%20simp%20at%20hi%3B%20linarith%0D%0A%20%20_%20%E2%89%A4%20D%200%20%2F%20(k%2B1)%20%3A%3D%20by%20gcongr%3B%20rw%20%5Bsum_range_sub&#39;%5D%3B%20linarith%20%5Bhpos%20(k%2B1)%5D"><img data-attachment-id="14269" data-permalink="https://terrytao.wordpress.com/2023/12/05/a-slightly-longer-lean-4-proof-tour/image-25-2/" data-orig-file="https://terrytao.files.wordpress.com/2023/12/image-25.png" data-orig-size="1642,401" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-25" data-image-description="" data-image-caption="" data-medium-file="https://terrytao.files.wordpress.com/2023/12/image-25.png?w=300" data-large-file="https://terrytao.files.wordpress.com/2023/12/image-25.png?w=490" loading="lazy" width="1024" height="250" src="https://terrytao.files.wordpress.com/2023/12/image-25.png?w=1024" alt="" srcset="https://terrytao.files.wordpress.com/2023/12/image-25.png?w=1024 1024w, https://terrytao.files.wordpress.com/2023/12/image-25.png?w=150 150w, https://terrytao.files.wordpress.com/2023/12/image-25.png?w=300 300w, https://terrytao.files.wordpress.com/2023/12/image-25.png?w=768 768w, https://terrytao.files.wordpress.com/2023/12/image-25.png 1642w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>



<p>With enough familiarity with the Lean language, this proof actually tracks quite closely with (an optimized version of) the human blueprint.</p>



<p>This concludes the tour of a lengthier Lean proving exercise.  I am finding the pre-planning step of the proof (using an informal “blueprint” to break the proof down into extremely granular pieces) to make the formalization process significantly easier than in the past (when I often adopted a sequential process of writing one line of code at a time without first sketching out a skeleton of the argument).  (The proof here took only about 15 minutes to create initially, although for this blog post I had to recreate it with screenshots and supporting links, which took significantly more time.)  I believe that a realistic near-term goal for AI is to be able to fill in automatically a significant fraction of the sorts of atomic “<code>sorry</code>“s of the size one saw in this proof, allowing one to convert a blueprint to a formal Lean proof even more rapidly.</p>



<p>One final remark: in this tour I filled in the “<code>sorry</code>“s in the order in which they appeared, but there is actually no requirement that one does this, and once one has used a blueprint to atomize a proof into self-contained smaller pieces, one can fill them in in any order.  Importantly for a group project, these micro-tasks can be parallelized, with different contributors claiming whichever “<code>sorry</code>” they feel they are qualified to solve, and working independently of each other.  (And, because Lean can automatically verify if their proof is correct, there is no need to have a pre-existing bond of trust with these contributors in order to accept their contributions.)  Furthermore, because the specification of a “<code>sorry</code>” someone can make a meaningful contribution to the proof by working on an extremely localized component of it without needing the mathematical expertise to understand the global argument.   This is not particularly important in this simple case, where the entire lemma is not too hard to understand to a trained mathematician, but can become quite relevant for complex formalization projects.</p>
	</div></div>
  </body>
</html>
