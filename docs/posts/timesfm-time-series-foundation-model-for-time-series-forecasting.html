<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/google-research/timesfm">Original</a>
    <h1>TimesFM (Time Series Foundation Model) for time-series forecasting</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">TimesFM  (Time Series Foundation Model) is a pretrained time-series foundation model developed by Google
Research for time-series forecasting.</p>
<ul dir="auto">
<li>Paper: <a href="https://arxiv.org/abs/2310.10688" rel="nofollow">A decoder-only foundation model for time-series forecasting</a>, to appear in ICML 2024.</li>
<li><a href="https://research.google/blog/a-decoder-only-foundation-model-for-time-series-forecasting/" rel="nofollow">Google Research blog</a></li>
<li><a href="https://huggingface.co/google/timesfm-1.0-200m" rel="nofollow">Hugging Face checkpoint repo</a></li>
</ul>
<p dir="auto">This repo contains the code to load public TimesFM checkpoints and run model
inference. Please visit our
<a href="https://huggingface.co/google/timesfm-1.0-200m" rel="nofollow">Hugging Face checkpoint repo</a>
to download model checkpoints.</p>
<p dir="auto">This is not an officially supported Google product.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Checkpoint timesfm-1.0-200m</h2><a id="user-content-checkpoint-timesfm-10-200m" aria-label="Permalink: Checkpoint timesfm-1.0-200m" href="#checkpoint-timesfm-10-200m"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">timesfm-1.0-200m is the first open model checkpoint:</p>
<ul dir="auto">
<li>It performs univariate time series forecasting for context lengths up tp 512 timepoints and any horizon lengths, with an optional frequency indicator.</li>
<li>It focuses on point forecasts, and does not support probabilistic forecasts. We experimentally offer quantile heads but they have not been calibrated after pretraining.</li>
<li>It requires the context to be contiguous (i.e. no &#34;holes&#34;), and the context and the horizon to be of the same frequency.</li>
</ul>

<p dir="auto">Please refer to our result tables on the <a href="https://eugeneha.ca/google-research/timesfm/blob/master/experiments/extended_benchmarks/tfm_results.png">extended benchmarks</a> and the <a href="https://eugeneha.ca/google-research/timesfm/blob/master/experiments/long_horizon_benchmarks/tfm_long_horizon.png">long horizon benchmarks</a>.</p>
<p dir="auto">Please look into the README files in the respective benchmark directories within <code>experiments/</code> for instructions for running TimesFM on the respective benchmarks.</p>

<p dir="auto">We have two environment files. For GPU installation (assuming CUDA 12 has been
setup), you can create a conda environment <code>tfm_env</code> from the base folder
through:</p>
<div data-snippet-clipboard-copy-content="conda env create --file=environment.yml"><pre><code>conda env create --file=environment.yml
</code></pre></div>
<p dir="auto">For a CPU setup please use,</p>
<div data-snippet-clipboard-copy-content="conda env create --file=environment_cpu.yml"><pre><code>conda env create --file=environment_cpu.yml
</code></pre></div>
<p dir="auto">to create the environment instead.</p>
<p dir="auto">Follow by</p>
<div data-snippet-clipboard-copy-content="conda activate tfm_env
pip install -e ."><pre><code>conda activate tfm_env
pip install -e .
</code></pre></div>
<p dir="auto">to install the package.</p>

<div dir="auto"><h3 tabindex="-1" dir="auto">Initialize the model and load a checkpoint.</h3><a id="user-content-initialize-the-model-and-load-a-checkpoint" aria-label="Permalink: Initialize the model and load a checkpoint." href="#initialize-the-model-and-load-a-checkpoint"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Then the base class can be loaded as,</p>
<div dir="auto" data-snippet-clipboard-copy-content="import timesfm

tfm = timesfm.TimesFm(
    context_len=&lt;context&gt;,
    horizon_len=&lt;horizon&gt;,
    input_patch_len=32,
    output_patch_len=128,
    num_layers=20,
    model_dims=1280,
    backend=&lt;backend&gt;,
)
tfm.load_from_checkpoint(&lt;checkpoint_path&gt;)"><pre><span>import</span> <span>timesfm</span>

<span>tfm</span> <span>=</span> <span>timesfm</span>.<span>TimesFm</span>(
    <span>context_len</span><span>=</span><span>&lt;</span><span>context</span><span>&gt;</span>,
    <span>horizon_len</span><span>=</span><span>&lt;</span><span>horizon</span><span>&gt;</span>,
    <span>input_patch_len</span><span>=</span><span>32</span>,
    <span>output_patch_len</span><span>=</span><span>128</span>,
    <span>num_layers</span><span>=</span><span>20</span>,
    <span>model_dims</span><span>=</span><span>1280</span>,
    <span>backend</span><span>=</span><span>&lt;</span><span>backend</span><span>&gt;</span>,
)
<span>tfm</span>.<span>load_from_checkpoint</span>(<span>&lt;</span><span>checkpoint_path</span><span>&gt;</span>)</pre></div>
<p dir="auto">Note that the four parameters are fixed to load the 200m model</p>
<div dir="auto" data-snippet-clipboard-copy-content="input_patch_len=32,
output_patch_len=128,
num_layers=20,
model_dims=1280,"><pre><span>input_patch_len</span><span>=</span><span>32</span>,
<span>output_patch_len</span><span>=</span><span>128</span>,
<span>num_layers</span><span>=</span><span>20</span>,
<span>model_dims</span><span>=</span><span>1280</span>,</pre></div>
<ol dir="auto">
<li>
<p dir="auto">The context_len here can be set as the max context length <strong>of the model</strong>. You can provide shorter series to the <code>tfm.forecast()</code> function and the model will handle it. Currently the model handles a max context length of 512, which can be increased in later releases. The input time series can have <strong>any context length</strong>. Padding / truncation will be handled by the inference code if needed.</p>
</li>
<li>
<p dir="auto">The horizon length can be set to anything. We recommend setting it to the largest horizon length you would need in the forecasting tasks for your application. We generally recommend horizon length &lt;= context length but it is not a requirement in the function call.</p>
</li>
</ol>

<p dir="auto">We provide APIs to forecast from either array inputs or <code>pandas</code> dataframe. Both forecast methods expect (1) the input time series contexts, (2) along with their frequencies. Please look at the documentation of the functions <code>tfm.forecast()</code> and <code>tfm.forecast_on_df()</code> for detailed instructions.</p>
<p dir="auto">In particular regarding the frequency, TimesFM expects a categorical indicator valued in {0, 1, 2}:</p>
<ul dir="auto">
<li><strong>0</strong> (default): high frequency, long horizon time series. We recommend to use this for time series up to daily granularity.</li>
<li><strong>1</strong>: medium frequency time series. We recommend to use this for weekly and monthly data.</li>
<li><strong>2</strong>: low frequency, short horizon time series. We recommend to use this for anything beyond monthly, e.g. quarterly or yearly.</li>
</ul>
<p dir="auto">This categorical value should be directly provided with the array inputs. For dataframe inputs, we convert the conventional letter coding of frequencies to our expected categories, that</p>
<ul dir="auto">
<li><strong>0</strong>: T, MIN, H, D, B, U</li>
<li><strong>1</strong>: W, M</li>
<li><strong>2</strong>: Q, Y</li>
</ul>
<p dir="auto">Notice you do <strong>NOT</strong> have to strictly follow our recommendation here. Although this is our setup during model training and we expect it to offer the best forecast result, you can also view the frequency input as a free parameter and modify it per your specific use case.</p>
<p dir="auto">Examples:</p>
<p dir="auto">Array inputs, with the frequencies set to low, medium and high respectively.</p>
<div dir="auto" data-snippet-clipboard-copy-content="import numpy as np
forecast_input = [
    np.sin(np.linspace(0, 20, 100))
    np.sin(np.linspace(0, 20, 200)),
    np.sin(np.linspace(0, 20, 400)),
]
frequency_input = [0, 1, 2]

point_forecast, experimental_quantile_forecast = tfm.forecast(
    forecast_input,
    freq=frequency_input,
)"><pre><span>import</span> <span>numpy</span> <span>as</span> <span>np</span>
<span>forecast_input</span> <span>=</span> [
    <span>np</span>.<span>sin</span>(<span>np</span>.<span>linspace</span>(<span>0</span>, <span>20</span>, <span>100</span>))
    <span>np</span>.<span>sin</span>(<span>np</span>.<span>linspace</span>(<span>0</span>, <span>20</span>, <span>200</span>)),
    <span>np</span>.<span>sin</span>(<span>np</span>.<span>linspace</span>(<span>0</span>, <span>20</span>, <span>400</span>)),
]
<span>frequency_input</span> <span>=</span> [<span>0</span>, <span>1</span>, <span>2</span>]

<span>point_forecast</span>, <span>experimental_quantile_forecast</span> <span>=</span> <span>tfm</span>.<span>forecast</span>(
    <span>forecast_input</span>,
    <span>freq</span><span>=</span><span>frequency_input</span>,
)</pre></div>
<p dir="auto"><code>pandas</code> dataframe, with the frequency set to &#34;M&#34; monthly.</p>
<div dir="auto" data-snippet-clipboard-copy-content="import pandas as pd

# e.g. input_df is
#       unique_id  ds          y
# 0     T1         1975-12-31  697458.0
# 1     T1         1976-01-31  1187650.0
# 2     T1         1976-02-29  1069690.0
# 3     T1         1976-03-31  1078430.0
# 4     T1         1976-04-30  1059910.0
# ...   ...        ...         ...
# 8175  T99        1986-01-31  602.0
# 8176  T99        1986-02-28  684.0
# 8177  T99        1986-03-31  818.0
# 8178  T99        1986-04-30  836.0
# 8179  T99        1986-05-31  878.0

forecast_df = tfm.forecast_on_df(
    inputs=input_df,
    freq=&#34;M&#34;,  # monthly
    value_name=&#34;y&#34;,
    num_jobs=-1,
)"><pre><span>import</span> <span>pandas</span> <span>as</span> <span>pd</span>

<span># e.g. input_df is</span>
<span>#       unique_id  ds          y</span>
<span># 0     T1         1975-12-31  697458.0</span>
<span># 1     T1         1976-01-31  1187650.0</span>
<span># 2     T1         1976-02-29  1069690.0</span>
<span># 3     T1         1976-03-31  1078430.0</span>
<span># 4     T1         1976-04-30  1059910.0</span>
<span># ...   ...        ...         ...</span>
<span># 8175  T99        1986-01-31  602.0</span>
<span># 8176  T99        1986-02-28  684.0</span>
<span># 8177  T99        1986-03-31  818.0</span>
<span># 8178  T99        1986-04-30  836.0</span>
<span># 8179  T99        1986-05-31  878.0</span>

<span>forecast_df</span> <span>=</span> <span>tfm</span>.<span>forecast_on_df</span>(
    <span>inputs</span><span>=</span><span>input_df</span>,
    <span>freq</span><span>=</span><span>&#34;M&#34;</span>,  <span># monthly</span>
    <span>value_name</span><span>=</span><span>&#34;y&#34;</span>,
    <span>num_jobs</span><span>=</span><span>-</span><span>1</span>,
)</pre></div>
</article></div></div>
  </body>
</html>
