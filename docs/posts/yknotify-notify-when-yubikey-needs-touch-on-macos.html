<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/noperator/yknotify">Original</a>
    <h1>Show HN: yknotify ‚Äì Notify when YubiKey needs touch on macOS</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><code>yknotify</code> watches macOS logs (via <code>log stream</code> CLI command) for events that I&#39;ve determined, through trial and error, are heuristically associated with the YubiKey waiting for touch. I primarily use the FIDO2 and OpenPGP features and haven&#39;t tested other applications listed in <code>ykman info</code> (e.g., Yubico OTP, FIDO U2F, OATH, PIV, YubiHSM Auth).</p>
<p dir="auto">When waiting for FIDO2 touch, we&#39;ll see this message logged once (with example hex value):</p>
<div data-snippet-clipboard-copy-content="kernel: (IOHIDFamily) IOHIDLibUserClient:0x123456789 startQueue"><pre><code>kernel: (IOHIDFamily) IOHIDLibUserClient:0x123456789 startQueue
</code></pre></div>
<p dir="auto">When waiting for OpenPGP touch, we&#39;ll see this message logged repeatedly:</p>
<div data-snippet-clipboard-copy-content="usbsmartcardreaderd: [com.apple.CryptoTokenKit:ccid] Time extension received"><pre><code>usbsmartcardreaderd: [com.apple.CryptoTokenKit:ccid] Time extension received
</code></pre></div>
<p dir="auto">As soon as the YubiKey is touched, we&#39;ll get a new/different log message in the same category. So the strategy here is to check if either of the above messages are the last one logged in their respective categories, and if so, notify the user to touch the YubiKey.</p>

<div data-snippet-clipboard-copy-content="go install github.com/noperator/yknotify"><pre><code>go install github.com/noperator/yknotify
</code></pre></div>

<div data-snippet-clipboard-copy-content="ùÑ¢ yknotify
{&#34;ts&#34;:&#34;2025-02-12T20:09:03Z&#34;,&#34;type&#34;:&#34;FIDO2&#34;}
{&#34;ts&#34;:&#34;2025-02-12T20:09:14Z&#34;,&#34;type&#34;:&#34;OpenPGP&#34;}"><pre><code>ùÑ¢ yknotify
{&#34;ts&#34;:&#34;2025-02-12T20:09:03Z&#34;,&#34;type&#34;:&#34;FIDO2&#34;}
{&#34;ts&#34;:&#34;2025-02-12T20:09:14Z&#34;,&#34;type&#34;:&#34;OpenPGP&#34;}
</code></pre></div>

<p dir="auto">I&#39;ve seen a few rare false positives (i.e., a log when the YubiKey is not waiting for touch) that I haven&#39;t diagnosed‚Äîbut <em>no</em> false negatives (i.e., no log when the YubiKey is waiting for touch). If you see false anythings, please open an issue with the log message and I&#39;ll try to add a filter for it.</p>

<ul dir="auto">
<li><a data-error-text="Failed to load title" data-id="483702312" data-permission-text="Title is private" data-url="https://github.com/maximbaz/yubikey-touch-detector/issues/5" data-hovercard-type="issue" data-hovercard-url="/maximbaz/yubikey-touch-detector/issues/5/hovercard?comment_id=2568300068&amp;comment_type=issue_comment" href="https://github.com/maximbaz/yubikey-touch-detector/issues/5#issuecomment-2568300068">maximbaz/yubikey-touch-detector#5 (comment)</a></li>
</ul>

<ul>
<li> perhaps add a debug flag to show context around related log messages</li>
<li> add LaunchAgent example</li>
<li> show how to notify with osascript</li>
</ul>
</article></div></div>
  </body>
</html>
