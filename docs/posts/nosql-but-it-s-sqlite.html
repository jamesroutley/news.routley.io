<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/vedantroy/df6b18fa89bc24acfe89fc8493743378">Original</a>
    <h1>Show HN: NoSQL, but it&#39;s SQLite</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="proxy.ts">
        <tbody><tr>
          <td id="file-proxy-ts-L1" data-line-number="1"></td>
          <td id="file-proxy-ts-LC1"><span>import</span> <span>Database</span> <span>from</span> <span>&#39;better-sqlite3&#39;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L2" data-line-number="2"></td>
          <td id="file-proxy-ts-LC2">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L3" data-line-number="3"></td>
          <td id="file-proxy-ts-LC3"><span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L4" data-line-number="4"></td>
          <td id="file-proxy-ts-LC4"><span>// 1. Types</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L5" data-line-number="5"></td>
          <td id="file-proxy-ts-LC5"><span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L6" data-line-number="6"></td>
          <td id="file-proxy-ts-LC6"><span>export</span> <span>type</span> <span>SchemaDefinition</span> <span>=</span> <span>Record</span><span>&lt;</span><span>string</span><span>,</span> <span>any</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L7" data-line-number="7"></td>
          <td id="file-proxy-ts-LC7">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L8" data-line-number="8"></td>
          <td id="file-proxy-ts-LC8"><span>export</span> <span>interface</span> <span>CreateDBOptions</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L9" data-line-number="9"></td>
          <td id="file-proxy-ts-LC9">  <span>idColumn</span>?: <span>string</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L10" data-line-number="10"></td>
          <td id="file-proxy-ts-LC10">  <span>jsonColumn</span>?: <span>string</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L11" data-line-number="11"></td>
          <td id="file-proxy-ts-LC11">  <span>debugSql</span>?: <span>boolean</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L12" data-line-number="12"></td>
          <td id="file-proxy-ts-LC12"><span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L13" data-line-number="13"></td>
          <td id="file-proxy-ts-LC13">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L14" data-line-number="14"></td>
          <td id="file-proxy-ts-LC14"><span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L15" data-line-number="15"></td>
          <td id="file-proxy-ts-LC15"><span>// 2. The shape of what we return</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L16" data-line-number="16"></td>
          <td id="file-proxy-ts-LC16"><span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L17" data-line-number="17"></td>
          <td id="file-proxy-ts-LC17"><span>export</span> <span>interface</span> <span>DBClient</span><span>&lt;</span><span>TSchema</span> <span>extends</span> <span>SchemaDefinition</span><span>&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L18" data-line-number="18"></td>
          <td id="file-proxy-ts-LC18">  <span>/** Reader: returns plain JS objects, no Proxy. */</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L19" data-line-number="19"></td>
          <td id="file-proxy-ts-LC19">  <span>rdr</span>: <span>{</span> <span>[</span><span>TableName</span> <span>in</span> <span>keyof</span> <span>TSchema</span><span>]</span>: <span>TableReader</span><span>&lt;</span><span>TSchema</span><span>[</span><span>TableName</span><span>]</span><span>&gt;</span> <span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L20" data-line-number="20"></td>
          <td id="file-proxy-ts-LC20">  <span>/** Writer: partial updates (Proxies). */</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L21" data-line-number="21"></td>
          <td id="file-proxy-ts-LC21">  <span>wtr</span>: <span>{</span> <span>[</span><span>TableName</span> <span>in</span> <span>keyof</span> <span>TSchema</span><span>]</span>: <span>TableWriter</span><span>&lt;</span><span>TSchema</span><span>[</span><span>TableName</span><span>]</span><span>&gt;</span> <span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L22" data-line-number="22"></td>
          <td id="file-proxy-ts-LC22"><span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L23" data-line-number="23"></td>
          <td id="file-proxy-ts-LC23">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L24" data-line-number="24"></td>
          <td id="file-proxy-ts-LC24"><span>/** Reader interface: bracket-get returns plain objects from memory. */</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L25" data-line-number="25"></td>
          <td id="file-proxy-ts-LC25"><span>export</span> <span>interface</span> <span>TableReader</span><span>&lt;</span><span>TRow</span><span>&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L26" data-line-number="26"></td>
          <td id="file-proxy-ts-LC26">  <span>[</span><span>rowId</span>: <span>string</span><span>]</span>: <span>TRow</span> <span>|</span> <span>undefined</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L27" data-line-number="27"></td>
          <td id="file-proxy-ts-LC27">  <span>forEach</span><span>(</span><span>callback</span>: <span>(</span><span>id</span>: <span>string</span><span>,</span> <span>rowData</span>: <span>TRow</span><span>)</span> <span>=&gt;</span> <span><span>void</span></span><span>)</span>: <span><span>void</span></span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L28" data-line-number="28"></td>
          <td id="file-proxy-ts-LC28">  <span>keys</span><span>(</span><span>)</span>: <span>string</span><span>[</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L29" data-line-number="29"></td>
          <td id="file-proxy-ts-LC29">  <span>values</span><span>(</span><span>)</span>: <span>TRow</span><span>[</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L30" data-line-number="30"></td>
          <td id="file-proxy-ts-LC30">  <span>entries</span><span>(</span><span>)</span>: <span>Array</span><span>&lt;</span><span>[</span><span>string</span><span>,</span> <span>TRow</span><span>]</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L31" data-line-number="31"></td>
          <td id="file-proxy-ts-LC31">  <span>dict</span><span>(</span><span>)</span>: <span>Record</span><span>&lt;</span><span>string</span><span>,</span> <span>TRow</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L32" data-line-number="32"></td>
          <td id="file-proxy-ts-LC32">  <span>has</span><span>(</span><span>id</span>: <span>string</span><span>)</span>: <span>boolean</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L33" data-line-number="33"></td>
          <td id="file-proxy-ts-LC33"><span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L34" data-line-number="34"></td>
          <td id="file-proxy-ts-LC34">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L35" data-line-number="35"></td>
          <td id="file-proxy-ts-LC35"><span>/** Writer interface: bracket-get returns a nested Proxy for partial JSON updates. */</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L36" data-line-number="36"></td>
          <td id="file-proxy-ts-LC36"><span>export</span> <span>interface</span> <span>TableWriter</span><span>&lt;</span><span>TRow</span><span>&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L37" data-line-number="37"></td>
          <td id="file-proxy-ts-LC37">  <span>[</span><span>rowId</span>: <span>string</span><span>]</span>: <span>TRowProxy</span><span>&lt;</span><span>TRow</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L38" data-line-number="38"></td>
          <td id="file-proxy-ts-LC38">  <span>forEach</span><span>(</span><span>callback</span>: <span>(</span><span>id</span>: <span>string</span><span>,</span> <span>rowProxy</span>: <span>TRowProxy</span><span>&lt;</span><span>TRow</span><span>&gt;</span><span>)</span> <span>=&gt;</span> <span><span>void</span></span><span>)</span>: <span><span>void</span></span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L39" data-line-number="39"></td>
          <td id="file-proxy-ts-LC39">  <span>keys</span><span>(</span><span>)</span>: <span>string</span><span>[</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L40" data-line-number="40"></td>
          <td id="file-proxy-ts-LC40">  <span>entries</span><span>(</span><span>)</span>: <span>Array</span><span>&lt;</span><span>[</span><span>string</span><span>,</span> <span>TRowProxy</span><span>&lt;</span><span>TRow</span><span>&gt;</span><span>]</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L41" data-line-number="41"></td>
          <td id="file-proxy-ts-LC41">  <span>has</span><span>(</span><span>id</span>: <span>string</span><span>)</span>: <span>boolean</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L42" data-line-number="42"></td>
          <td id="file-proxy-ts-LC42"><span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L43" data-line-number="43"></td>
          <td id="file-proxy-ts-LC43">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L44" data-line-number="44"></td>
          <td id="file-proxy-ts-LC44"><span>/**</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L45" data-line-number="45"></td>
          <td id="file-proxy-ts-LC45"><span> * A nested Proxy that allows partial updates to single fields.</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L46" data-line-number="46"></td>
          <td id="file-proxy-ts-LC46"><span> * If you do `writer.users[&#39;bob&#39;].nested.foo = 123`,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L47" data-line-number="47"></td>
          <td id="file-proxy-ts-LC47"><span> * it calls `json_set(..., &#39;$.nested.foo&#39;, 123)` in the DB.</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L48" data-line-number="48"></td>
          <td id="file-proxy-ts-LC48"><span> */</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L49" data-line-number="49"></td>
          <td id="file-proxy-ts-LC49"><span>export</span> <span>type</span> <span>TRowProxy</span><span>&lt;</span><span>TRow</span><span>&gt;</span> <span>=</span> <span>TRow</span> <span>&amp;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L50" data-line-number="50"></td>
          <td id="file-proxy-ts-LC50">  <span>[</span><span>nestedKey</span>: <span>string</span><span>]</span>: <span>any</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L51" data-line-number="51"></td>
          <td id="file-proxy-ts-LC51"><span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L52" data-line-number="52"></td>
          <td id="file-proxy-ts-LC52">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L53" data-line-number="53"></td>
          <td id="file-proxy-ts-LC53"><span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L54" data-line-number="54"></td>
          <td id="file-proxy-ts-LC54"><span>// 3. Main entry point</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L55" data-line-number="55"></td>
          <td id="file-proxy-ts-LC55"><span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L56" data-line-number="56"></td>
          <td id="file-proxy-ts-LC56"><span>export</span> <span>function</span> <span>createDatabaseClient</span><span>&lt;</span><span>TSchema</span> <span>extends</span> <span>SchemaDefinition</span><span>&gt;</span><span>(</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L57" data-line-number="57"></td>
          <td id="file-proxy-ts-LC57">  <span>db</span>: <span>Database</span><span>.</span><span>Database</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L58" data-line-number="58"></td>
          <td id="file-proxy-ts-LC58">  <span>schema</span>: <span>TSchema</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L59" data-line-number="59"></td>
          <td id="file-proxy-ts-LC59">  <span>options</span>: <span>CreateDBOptions</span> <span>=</span> <span>{</span><span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L60" data-line-number="60"></td>
          <td id="file-proxy-ts-LC60"><span>)</span>: <span>DBClient</span><span>&lt;</span><span>TSchema</span><span>&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L61" data-line-number="61"></td>
          <td id="file-proxy-ts-LC61">  <span>const</span> <span>idColumn</span> <span>=</span> <span>options</span><span>.</span><span>idColumn</span> <span>??</span> <span>&#39;id&#39;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L62" data-line-number="62"></td>
          <td id="file-proxy-ts-LC62">  <span>const</span> <span>jsonColumn</span> <span>=</span> <span>options</span><span>.</span><span>jsonColumn</span> <span>??</span> <span>&#39;data&#39;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L63" data-line-number="63"></td>
          <td id="file-proxy-ts-LC63">  <span>const</span> <span>debugSql</span> <span>=</span> <span>!</span><span>!</span><span>options</span><span>.</span><span>debugSql</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L64" data-line-number="64"></td>
          <td id="file-proxy-ts-LC64">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L65" data-line-number="65"></td>
          <td id="file-proxy-ts-LC65">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L66" data-line-number="66"></td>
          <td id="file-proxy-ts-LC66">  <span>// A) In-memory cache: Map&lt;tableName, Map&lt;rowId, object&gt;&gt;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L67" data-line-number="67"></td>
          <td id="file-proxy-ts-LC67">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L68" data-line-number="68"></td>
          <td id="file-proxy-ts-LC68">  <span>const</span> <span>memoryCache</span> <span>=</span> <span>new</span> <span>Map</span><span>&lt;</span><span>string</span><span>,</span> <span>Map</span><span>&lt;</span><span>string</span><span>,</span> <span>any</span><span>&gt;</span><span>&gt;</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L69" data-line-number="69"></td>
          <td id="file-proxy-ts-LC69">  <span>for</span> <span>(</span><span>const</span> <span>tableName</span> <span>of</span> <span>Object</span><span>.</span><span>keys</span><span>(</span><span>schema</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L70" data-line-number="70"></td>
          <td id="file-proxy-ts-LC70">    <span>memoryCache</span><span>.</span><span>set</span><span>(</span><span>tableName</span><span>,</span> <span>new</span> <span>Map</span><span>(</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L71" data-line-number="71"></td>
          <td id="file-proxy-ts-LC71">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L72" data-line-number="72"></td>
          <td id="file-proxy-ts-LC72">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L73" data-line-number="73"></td>
          <td id="file-proxy-ts-LC73">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L74" data-line-number="74"></td>
          <td id="file-proxy-ts-LC74">  <span>// B) Precompiled statements for each table</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L75" data-line-number="75"></td>
          <td id="file-proxy-ts-LC75">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L76" data-line-number="76"></td>
          <td id="file-proxy-ts-LC76">  <span>function</span> <span>wrapStmt</span><span>(</span><span>stmt</span>: <span>ReturnType</span><span>&lt;</span><span>Database</span><span>.</span><span>Database</span><span>[</span><span>&#39;prepare&#39;</span><span>]</span><span>&gt;</span><span>,</span> <span>label</span>: <span>string</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L77" data-line-number="77"></td>
          <td id="file-proxy-ts-LC77">    <span>return</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L78" data-line-number="78"></td>
          <td id="file-proxy-ts-LC78">      <span>get</span><span>(</span>...<span>args</span>: <span>any</span><span>[</span><span>]</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L79" data-line-number="79"></td>
          <td id="file-proxy-ts-LC79">        <span>if</span> <span>(</span><span>debugSql</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L80" data-line-number="80"></td>
          <td id="file-proxy-ts-LC80">          <span>console</span><span>.</span><span>log</span><span>(</span><span>`[SQL GET] <span><span>${</span><span>label</span><span>}</span></span>, params: <span><span>${</span><span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>args</span><span>)</span><span>}</span></span>`</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L81" data-line-number="81"></td>
          <td id="file-proxy-ts-LC81">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L82" data-line-number="82"></td>
          <td id="file-proxy-ts-LC82">        <span>return</span> <span>stmt</span><span>.</span><span>get</span><span>(</span>...<span>args</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L83" data-line-number="83"></td>
          <td id="file-proxy-ts-LC83">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L84" data-line-number="84"></td>
          <td id="file-proxy-ts-LC84">      <span>run</span><span>(</span>...<span>args</span>: <span>any</span><span>[</span><span>]</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L85" data-line-number="85"></td>
          <td id="file-proxy-ts-LC85">        <span>if</span> <span>(</span><span>debugSql</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L86" data-line-number="86"></td>
          <td id="file-proxy-ts-LC86">          <span>console</span><span>.</span><span>log</span><span>(</span><span>`[SQL RUN] <span><span>${</span><span>label</span><span>}</span></span>, params: <span><span>${</span><span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>args</span><span>)</span><span>}</span></span>`</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L87" data-line-number="87"></td>
          <td id="file-proxy-ts-LC87">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L88" data-line-number="88"></td>
          <td id="file-proxy-ts-LC88">        <span>return</span> <span>stmt</span><span>.</span><span>run</span><span>(</span>...<span>args</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L89" data-line-number="89"></td>
          <td id="file-proxy-ts-LC89">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L90" data-line-number="90"></td>
          <td id="file-proxy-ts-LC90">      <span>all</span><span>(</span>...<span>args</span>: <span>any</span><span>[</span><span>]</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L91" data-line-number="91"></td>
          <td id="file-proxy-ts-LC91">        <span>if</span> <span>(</span><span>debugSql</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L92" data-line-number="92"></td>
          <td id="file-proxy-ts-LC92">          <span>console</span><span>.</span><span>log</span><span>(</span><span>`[SQL ALL] <span><span>${</span><span>label</span><span>}</span></span>, params: <span><span>${</span><span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>args</span><span>)</span><span>}</span></span>`</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L93" data-line-number="93"></td>
          <td id="file-proxy-ts-LC93">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L94" data-line-number="94"></td>
          <td id="file-proxy-ts-LC94">        <span>return</span> <span>stmt</span><span>.</span><span>all</span><span>(</span>...<span>args</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L95" data-line-number="95"></td>
          <td id="file-proxy-ts-LC95">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L96" data-line-number="96"></td>
          <td id="file-proxy-ts-LC96">    <span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L97" data-line-number="97"></td>
          <td id="file-proxy-ts-LC97">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L98" data-line-number="98"></td>
          <td id="file-proxy-ts-LC98">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L99" data-line-number="99"></td>
          <td id="file-proxy-ts-LC99">  <span>const</span> <span>stmts</span> <span>=</span> <span>new</span> <span>Map</span><span>&lt;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L100" data-line-number="100"></td>
          <td id="file-proxy-ts-LC100">    <span>string</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L101" data-line-number="101"></td>
          <td id="file-proxy-ts-LC101">    <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L102" data-line-number="102"></td>
          <td id="file-proxy-ts-LC102">      <span>selectRow</span>: <span>ReturnType</span><span>&lt;</span><span>typeof</span> <span>wrapStmt</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L103" data-line-number="103"></td>
          <td id="file-proxy-ts-LC103">      <span>upsertWholeRow</span>: <span>ReturnType</span><span>&lt;</span><span>typeof</span> <span>wrapStmt</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L104" data-line-number="104"></td>
          <td id="file-proxy-ts-LC104">      <span>deleteRow</span>: <span>ReturnType</span><span>&lt;</span><span>typeof</span> <span>wrapStmt</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L105" data-line-number="105"></td>
          <td id="file-proxy-ts-LC105">      <span>jsonSet</span>: <span>ReturnType</span><span>&lt;</span><span>typeof</span> <span>wrapStmt</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L106" data-line-number="106"></td>
          <td id="file-proxy-ts-LC106">      <span>jsonRemove</span>: <span>ReturnType</span><span>&lt;</span><span>typeof</span> <span>wrapStmt</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L107" data-line-number="107"></td>
          <td id="file-proxy-ts-LC107">      <span>checkExistence</span>: <span>ReturnType</span><span>&lt;</span><span>typeof</span> <span>wrapStmt</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L108" data-line-number="108"></td>
          <td id="file-proxy-ts-LC108">      <span>selectAllIds</span>: <span>ReturnType</span><span>&lt;</span><span>typeof</span> <span>wrapStmt</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L109" data-line-number="109"></td>
          <td id="file-proxy-ts-LC109">    <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L110" data-line-number="110"></td>
          <td id="file-proxy-ts-LC110">  <span>&gt;</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L111" data-line-number="111"></td>
          <td id="file-proxy-ts-LC111">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L112" data-line-number="112"></td>
          <td id="file-proxy-ts-LC112">  <span>function</span> <span>getStatementsForTable</span><span>(</span><span>tableName</span>: <span>string</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L113" data-line-number="113"></td>
          <td id="file-proxy-ts-LC113">    <span>if</span> <span>(</span><span>stmts</span><span>.</span><span>has</span><span>(</span><span>tableName</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L114" data-line-number="114"></td>
          <td id="file-proxy-ts-LC114">      <span>return</span> <span>stmts</span><span>.</span><span>get</span><span>(</span><span>tableName</span><span>)</span><span>!</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L115" data-line-number="115"></td>
          <td id="file-proxy-ts-LC115">    <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L116" data-line-number="116"></td>
          <td id="file-proxy-ts-LC116">    <span>const</span> <span>selectRowSQL</span> <span>=</span> <span>`</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L117" data-line-number="117"></td>
          <td id="file-proxy-ts-LC117"><span>      SELECT <span><span>${</span><span>jsonColumn</span><span>}</span></span> AS jsonData</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L118" data-line-number="118"></td>
          <td id="file-proxy-ts-LC118"><span>        FROM <span><span>${</span><span>tableName</span><span>}</span></span></span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L119" data-line-number="119"></td>
          <td id="file-proxy-ts-LC119"><span>       WHERE <span><span>${</span><span>idColumn</span><span>}</span></span> = ?`</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L120" data-line-number="120"></td>
          <td id="file-proxy-ts-LC120">    <span>const</span> <span>upsertWholeRowSQL</span> <span>=</span> <span>`</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L121" data-line-number="121"></td>
          <td id="file-proxy-ts-LC121"><span>      INSERT OR REPLACE INTO <span><span>${</span><span>tableName</span><span>}</span></span> (<span><span>${</span><span>idColumn</span><span>}</span></span>, <span><span>${</span><span>jsonColumn</span><span>}</span></span>)</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L122" data-line-number="122"></td>
          <td id="file-proxy-ts-LC122"><span>      VALUES (?, json(?))`</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L123" data-line-number="123"></td>
          <td id="file-proxy-ts-LC123">    <span>const</span> <span>deleteRowSQL</span> <span>=</span> <span>`</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L124" data-line-number="124"></td>
          <td id="file-proxy-ts-LC124"><span>      DELETE FROM <span><span>${</span><span>tableName</span><span>}</span></span></span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L125" data-line-number="125"></td>
          <td id="file-proxy-ts-LC125"><span>       WHERE <span><span>${</span><span>idColumn</span><span>}</span></span> = ?`</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L126" data-line-number="126"></td>
          <td id="file-proxy-ts-LC126">    <span>const</span> <span>jsonSetSQL</span> <span>=</span> <span>`</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L127" data-line-number="127"></td>
          <td id="file-proxy-ts-LC127"><span>      UPDATE <span><span>${</span><span>tableName</span><span>}</span></span></span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L128" data-line-number="128"></td>
          <td id="file-proxy-ts-LC128"><span>         SET <span><span>${</span><span>jsonColumn</span><span>}</span></span> = json_set(<span><span>${</span><span>jsonColumn</span><span>}</span></span>, ?, json(?))</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L129" data-line-number="129"></td>
          <td id="file-proxy-ts-LC129"><span>       WHERE <span><span>${</span><span>idColumn</span><span>}</span></span> = ?`</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L130" data-line-number="130"></td>
          <td id="file-proxy-ts-LC130">    <span>const</span> <span>jsonRemoveSQL</span> <span>=</span> <span>`</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L131" data-line-number="131"></td>
          <td id="file-proxy-ts-LC131"><span>      UPDATE <span><span>${</span><span>tableName</span><span>}</span></span></span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L132" data-line-number="132"></td>
          <td id="file-proxy-ts-LC132"><span>         SET <span><span>${</span><span>jsonColumn</span><span>}</span></span> = json_remove(<span><span>${</span><span>jsonColumn</span><span>}</span></span>, ?)</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L133" data-line-number="133"></td>
          <td id="file-proxy-ts-LC133"><span>       WHERE <span><span>${</span><span>idColumn</span><span>}</span></span> = ?`</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L134" data-line-number="134"></td>
          <td id="file-proxy-ts-LC134">    <span>const</span> <span>checkExistenceSQL</span> <span>=</span> <span>`</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L135" data-line-number="135"></td>
          <td id="file-proxy-ts-LC135"><span>      SELECT 1 FROM <span><span>${</span><span>tableName</span><span>}</span></span></span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L136" data-line-number="136"></td>
          <td id="file-proxy-ts-LC136"><span>       WHERE <span><span>${</span><span>idColumn</span><span>}</span></span> = ?`</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L137" data-line-number="137"></td>
          <td id="file-proxy-ts-LC137">    <span>const</span> <span>selectAllIdsSQL</span> <span>=</span> <span>`</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L138" data-line-number="138"></td>
          <td id="file-proxy-ts-LC138"><span>      SELECT <span><span>${</span><span>idColumn</span><span>}</span></span> AS id</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L139" data-line-number="139"></td>
          <td id="file-proxy-ts-LC139"><span>        FROM <span><span>${</span><span>tableName</span><span>}</span></span>`</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L140" data-line-number="140"></td>
          <td id="file-proxy-ts-LC140">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L141" data-line-number="141"></td>
          <td id="file-proxy-ts-LC141">    <span>const</span> <span>prepared</span> <span>=</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L142" data-line-number="142"></td>
          <td id="file-proxy-ts-LC142">      <span>selectRow</span>: <span>wrapStmt</span><span>(</span><span>db</span><span>.</span><span>prepare</span><span>(</span><span>selectRowSQL</span><span>)</span><span>,</span> <span>`<span><span>${</span><span>tableName</span><span>}</span></span>:selectRow`</span><span>)</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L143" data-line-number="143"></td>
          <td id="file-proxy-ts-LC143">      <span>upsertWholeRow</span>: <span>wrapStmt</span><span>(</span><span>db</span><span>.</span><span>prepare</span><span>(</span><span>upsertWholeRowSQL</span><span>)</span><span>,</span> <span>`<span><span>${</span><span>tableName</span><span>}</span></span>:upsertWholeRow`</span><span>)</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L144" data-line-number="144"></td>
          <td id="file-proxy-ts-LC144">      <span>deleteRow</span>: <span>wrapStmt</span><span>(</span><span>db</span><span>.</span><span>prepare</span><span>(</span><span>deleteRowSQL</span><span>)</span><span>,</span> <span>`<span><span>${</span><span>tableName</span><span>}</span></span>:deleteRow`</span><span>)</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L145" data-line-number="145"></td>
          <td id="file-proxy-ts-LC145">      <span>jsonSet</span>: <span>wrapStmt</span><span>(</span><span>db</span><span>.</span><span>prepare</span><span>(</span><span>jsonSetSQL</span><span>)</span><span>,</span> <span>`<span><span>${</span><span>tableName</span><span>}</span></span>:jsonSet`</span><span>)</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L146" data-line-number="146"></td>
          <td id="file-proxy-ts-LC146">      <span>jsonRemove</span>: <span>wrapStmt</span><span>(</span><span>db</span><span>.</span><span>prepare</span><span>(</span><span>jsonRemoveSQL</span><span>)</span><span>,</span> <span>`<span><span>${</span><span>tableName</span><span>}</span></span>:jsonRemove`</span><span>)</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L147" data-line-number="147"></td>
          <td id="file-proxy-ts-LC147">      <span>checkExistence</span>: <span>wrapStmt</span><span>(</span><span>db</span><span>.</span><span>prepare</span><span>(</span><span>checkExistenceSQL</span><span>)</span><span>,</span> <span>`<span><span>${</span><span>tableName</span><span>}</span></span>:checkExistence`</span><span>)</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L148" data-line-number="148"></td>
          <td id="file-proxy-ts-LC148">      <span>selectAllIds</span>: <span>wrapStmt</span><span>(</span><span>db</span><span>.</span><span>prepare</span><span>(</span><span>selectAllIdsSQL</span><span>)</span><span>,</span> <span>`<span><span>${</span><span>tableName</span><span>}</span></span>:selectAllIds`</span><span>)</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L149" data-line-number="149"></td>
          <td id="file-proxy-ts-LC149">    <span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L150" data-line-number="150"></td>
          <td id="file-proxy-ts-LC150">    <span>stmts</span><span>.</span><span>set</span><span>(</span><span>tableName</span><span>,</span> <span>prepared</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L151" data-line-number="151"></td>
          <td id="file-proxy-ts-LC151">    <span>return</span> <span>prepared</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L152" data-line-number="152"></td>
          <td id="file-proxy-ts-LC152">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L153" data-line-number="153"></td>
          <td id="file-proxy-ts-LC153">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L154" data-line-number="154"></td>
          <td id="file-proxy-ts-LC154">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L155" data-line-number="155"></td>
          <td id="file-proxy-ts-LC155">  <span>// C) Helper: load a row&#39;s JSON into memory cache if not loaded</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L156" data-line-number="156"></td>
          <td id="file-proxy-ts-LC156">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L157" data-line-number="157"></td>
          <td id="file-proxy-ts-LC157">  <span>function</span> <span>loadRow</span><span>(</span><span>tableName</span>: <span>string</span><span>,</span> <span>rowId</span>: <span>string</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L158" data-line-number="158"></td>
          <td id="file-proxy-ts-LC158">    <span>const</span> <span>cacheForTable</span> <span>=</span> <span>memoryCache</span><span>.</span><span>get</span><span>(</span><span>tableName</span><span>)</span><span>!</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L159" data-line-number="159"></td>
          <td id="file-proxy-ts-LC159">    <span>if</span> <span>(</span><span>cacheForTable</span><span>.</span><span>has</span><span>(</span><span>rowId</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L160" data-line-number="160"></td>
          <td id="file-proxy-ts-LC160">      <span>return</span><span>;</span> <span>// already in memory</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L161" data-line-number="161"></td>
          <td id="file-proxy-ts-LC161">    <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L162" data-line-number="162"></td>
          <td id="file-proxy-ts-LC162">    <span>const</span> <span>{</span> selectRow <span>}</span> <span>=</span> <span>getStatementsForTable</span><span>(</span><span>tableName</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L163" data-line-number="163"></td>
          <td id="file-proxy-ts-LC163">    <span>const</span> <span>row</span> <span>=</span> <span>selectRow</span><span>.</span><span>get</span><span>(</span><span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L164" data-line-number="164"></td>
          <td id="file-proxy-ts-LC164">    <span>if</span> <span>(</span><span>!</span><span>row</span><span>)</span> <span>return</span><span>;</span> <span>// not found in DB</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L165" data-line-number="165"></td>
          <td id="file-proxy-ts-LC165">    <span>try</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L166" data-line-number="166"></td>
          <td id="file-proxy-ts-LC166">      <span>cacheForTable</span><span>.</span><span>set</span><span>(</span><span>rowId</span><span>,</span> <span>JSON</span><span>.</span><span>parse</span><span>(</span><span>row</span><span>.</span><span>jsonData</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L167" data-line-number="167"></td>
          <td id="file-proxy-ts-LC167">    <span>}</span> <span>catch</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L168" data-line-number="168"></td>
          <td id="file-proxy-ts-LC168">      <span>cacheForTable</span><span>.</span><span>set</span><span>(</span><span>rowId</span><span>,</span> <span>null</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L169" data-line-number="169"></td>
          <td id="file-proxy-ts-LC169">    <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L170" data-line-number="170"></td>
          <td id="file-proxy-ts-LC170">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L171" data-line-number="171"></td>
          <td id="file-proxy-ts-LC171">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L172" data-line-number="172"></td>
          <td id="file-proxy-ts-LC172">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L173" data-line-number="173"></td>
          <td id="file-proxy-ts-LC173">  <span>// D) JSON path helpers for partial updates</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L174" data-line-number="174"></td>
          <td id="file-proxy-ts-LC174">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L175" data-line-number="175"></td>
          <td id="file-proxy-ts-LC175">  <span>function</span> <span>pathToJsonPathString</span><span>(</span><span>path</span>: <span>string</span><span>[</span><span>]</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L176" data-line-number="176"></td>
          <td id="file-proxy-ts-LC176">    <span>if</span> <span>(</span><span>!</span><span>path</span><span>.</span><span>length</span><span>)</span> <span>return</span> <span>&#39;$&#39;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L177" data-line-number="177"></td>
          <td id="file-proxy-ts-LC177">    <span>return</span> <span>&#39;$.&#39;</span> <span>+</span> <span>path</span><span>.</span><span>map</span><span>(</span><span>escapeJsonKey</span><span>)</span><span>.</span><span>join</span><span>(</span><span>&#39;.&#39;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L178" data-line-number="178"></td>
          <td id="file-proxy-ts-LC178">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L179" data-line-number="179"></td>
          <td id="file-proxy-ts-LC179">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L180" data-line-number="180"></td>
          <td id="file-proxy-ts-LC180">  <span>function</span> <span>escapeJsonKey</span><span>(</span><span>k</span>: <span>string</span><span>)</span>: <span>string</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L181" data-line-number="181"></td>
          <td id="file-proxy-ts-LC181">    <span>// naive</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L182" data-line-number="182"></td>
          <td id="file-proxy-ts-LC182">    <span>return</span> <span>k</span><span>.</span><span>replace</span><span>(</span><span><span>/</span>&#34;<span>/</span>g</span><span>,</span> <span>&#39;\\&#34;&#39;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L183" data-line-number="183"></td>
          <td id="file-proxy-ts-LC183">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L184" data-line-number="184"></td>
          <td id="file-proxy-ts-LC184">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L185" data-line-number="185"></td>
          <td id="file-proxy-ts-LC185">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L186" data-line-number="186"></td>
          <td id="file-proxy-ts-LC186">  <span>// E) Row-level Proxy for partial updates</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L187" data-line-number="187"></td>
          <td id="file-proxy-ts-LC187">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L188" data-line-number="188"></td>
          <td id="file-proxy-ts-LC188">  <span>function</span> <span>createRowProxy</span><span>(</span><span>tableName</span>: <span>string</span><span>,</span> <span>rowId</span>: <span>string</span><span>,</span> <span>pathSoFar</span>: <span>string</span><span>[</span><span>]</span> <span>=</span> <span>[</span><span>]</span><span>)</span>: <span>any</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L189" data-line-number="189"></td>
          <td id="file-proxy-ts-LC189">    <span>return</span> <span>new</span> <span>Proxy</span><span>(</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L190" data-line-number="190"></td>
          <td id="file-proxy-ts-LC190">      <span>{</span><span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L191" data-line-number="191"></td>
          <td id="file-proxy-ts-LC191">      <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L192" data-line-number="192"></td>
          <td id="file-proxy-ts-LC192">        <span>get</span><span>(</span><span>_</span><span>,</span> <span>propKey</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L193" data-line-number="193"></td>
          <td id="file-proxy-ts-LC193">          <span>if</span> <span>(</span><span>typeof</span> <span>propKey</span> <span>===</span> <span>&#39;symbol&#39;</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L194" data-line-number="194"></td>
          <td id="file-proxy-ts-LC194">            <span>return</span> <span>Reflect</span><span>.</span><span>get</span><span>(</span><span>_</span><span>,</span> <span>propKey</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L195" data-line-number="195"></td>
          <td id="file-proxy-ts-LC195">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L196" data-line-number="196"></td>
          <td id="file-proxy-ts-LC196">          <span>loadRow</span><span>(</span><span>tableName</span><span>,</span> <span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L197" data-line-number="197"></td>
          <td id="file-proxy-ts-LC197">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L198" data-line-number="198"></td>
          <td id="file-proxy-ts-LC198">          <span>const</span> <span>cacheForTable</span> <span>=</span> <span>memoryCache</span><span>.</span><span>get</span><span>(</span><span>tableName</span><span>)</span><span>!</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L199" data-line-number="199"></td>
          <td id="file-proxy-ts-LC199">          <span>if</span> <span>(</span><span>!</span><span>cacheForTable</span><span>.</span><span>has</span><span>(</span><span>rowId</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L200" data-line-number="200"></td>
          <td id="file-proxy-ts-LC200">            <span>throw</span> <span>new</span> <span>Error</span><span>(</span><span>`Row &#39;<span><span>${</span><span>rowId</span><span>}</span></span>&#39; not found in table &#39;<span><span>${</span><span>tableName</span><span>}</span></span>&#39; (read).`</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L201" data-line-number="201"></td>
          <td id="file-proxy-ts-LC201">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L202" data-line-number="202"></td>
          <td id="file-proxy-ts-LC202">          <span>const</span> <span>rowData</span> <span>=</span> <span>cacheForTable</span><span>.</span><span>get</span><span>(</span><span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L203" data-line-number="203"></td>
          <td id="file-proxy-ts-LC203">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L204" data-line-number="204"></td>
          <td id="file-proxy-ts-LC204">          <span>const</span> <span>newPath</span> <span>=</span> <span>[</span>...<span>pathSoFar</span><span>,</span> <span>propKey</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L205" data-line-number="205"></td>
          <td id="file-proxy-ts-LC205">          <span>let</span> <span>current</span>: <span>any</span> <span>=</span> <span>rowData</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L206" data-line-number="206"></td>
          <td id="file-proxy-ts-LC206">          <span>for</span> <span>(</span><span>const</span> <span>p</span> <span>of</span> <span>newPath</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L207" data-line-number="207"></td>
          <td id="file-proxy-ts-LC207">            <span>if</span> <span>(</span><span>current</span> <span>==</span> <span>null</span> <span>||</span> <span>typeof</span> <span>current</span> <span>!==</span> <span>&#39;object&#39;</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L208" data-line-number="208"></td>
          <td id="file-proxy-ts-LC208">              <span>return</span> <span>undefined</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L209" data-line-number="209"></td>
          <td id="file-proxy-ts-LC209">            <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L210" data-line-number="210"></td>
          <td id="file-proxy-ts-LC210">            <span>current</span> <span>=</span> <span>current</span><span>[</span><span>p</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L211" data-line-number="211"></td>
          <td id="file-proxy-ts-LC211">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L212" data-line-number="212"></td>
          <td id="file-proxy-ts-LC212">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L213" data-line-number="213"></td>
          <td id="file-proxy-ts-LC213">          <span>// If object or array, return deeper proxy so we can do partial updates</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L214" data-line-number="214"></td>
          <td id="file-proxy-ts-LC214">          <span>if</span> <span>(</span><span>current</span> <span>&amp;&amp;</span> <span>typeof</span> <span>current</span> <span>===</span> <span>&#39;object&#39;</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L215" data-line-number="215"></td>
          <td id="file-proxy-ts-LC215">            <span>return</span> <span>createRowProxy</span><span>(</span><span>tableName</span><span>,</span> <span>rowId</span><span>,</span> <span>newPath</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L216" data-line-number="216"></td>
          <td id="file-proxy-ts-LC216">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L217" data-line-number="217"></td>
          <td id="file-proxy-ts-LC217">          <span>return</span> <span>current</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L218" data-line-number="218"></td>
          <td id="file-proxy-ts-LC218">        <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L219" data-line-number="219"></td>
          <td id="file-proxy-ts-LC219">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L220" data-line-number="220"></td>
          <td id="file-proxy-ts-LC220">        <span>set</span><span>(</span><span>_</span><span>,</span> <span>propKey</span><span>,</span> <span>value</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L221" data-line-number="221"></td>
          <td id="file-proxy-ts-LC221">          <span>loadRow</span><span>(</span><span>tableName</span><span>,</span> <span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L222" data-line-number="222"></td>
          <td id="file-proxy-ts-LC222">          <span>const</span> <span>cacheForTable</span> <span>=</span> <span>memoryCache</span><span>.</span><span>get</span><span>(</span><span>tableName</span><span>)</span><span>!</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L223" data-line-number="223"></td>
          <td id="file-proxy-ts-LC223">          <span>if</span> <span>(</span><span>!</span><span>cacheForTable</span><span>.</span><span>has</span><span>(</span><span>rowId</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L224" data-line-number="224"></td>
          <td id="file-proxy-ts-LC224">            <span>throw</span> <span>new</span> <span>Error</span><span>(</span><span>`Row &#39;<span><span>${</span><span>rowId</span><span>}</span></span>&#39; not found in table &#39;<span><span>${</span><span>tableName</span><span>}</span></span>&#39; (write).`</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L225" data-line-number="225"></td>
          <td id="file-proxy-ts-LC225">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L226" data-line-number="226"></td>
          <td id="file-proxy-ts-LC226">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L227" data-line-number="227"></td>
          <td id="file-proxy-ts-LC227">          <span>const</span> <span>{</span> jsonSet <span>}</span> <span>=</span> <span>getStatementsForTable</span><span>(</span><span>tableName</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L228" data-line-number="228"></td>
          <td id="file-proxy-ts-LC228">          <span>const</span> <span>newPath</span> <span>=</span> <span>[</span>...<span>pathSoFar</span><span>,</span> <span>propKey</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L229" data-line-number="229"></td>
          <td id="file-proxy-ts-LC229">          <span>const</span> <span>jsonPath</span> <span>=</span> <span>pathToJsonPathString</span><span>(</span><span>newPath</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L230" data-line-number="230"></td>
          <td id="file-proxy-ts-LC230">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L231" data-line-number="231"></td>
          <td id="file-proxy-ts-LC231">          <span>jsonSet</span><span>.</span><span>run</span><span>(</span><span>jsonPath</span><span>,</span> <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>value</span><span>)</span><span>,</span> <span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L232" data-line-number="232"></td>
          <td id="file-proxy-ts-LC232">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L233" data-line-number="233"></td>
          <td id="file-proxy-ts-LC233">          <span>// Update local cache</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L234" data-line-number="234"></td>
          <td id="file-proxy-ts-LC234">          <span>const</span> <span>rowData</span> <span>=</span> <span>cacheForTable</span><span>.</span><span>get</span><span>(</span><span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L235" data-line-number="235"></td>
          <td id="file-proxy-ts-LC235">          <span>let</span> <span>cursor</span>: <span>any</span> <span>=</span> <span>rowData</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L236" data-line-number="236"></td>
          <td id="file-proxy-ts-LC236">          <span>for</span> <span>(</span><span>let</span> <span>i</span> <span>=</span> <span>0</span><span>;</span> <span>i</span> <span>&lt;</span> <span>newPath</span><span>.</span><span>length</span> <span>-</span> <span>1</span><span>;</span> <span>i</span><span>++</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L237" data-line-number="237"></td>
          <td id="file-proxy-ts-LC237">            <span>const</span> <span>seg</span> <span>=</span> <span>newPath</span><span>[</span><span>i</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L238" data-line-number="238"></td>
          <td id="file-proxy-ts-LC238">            <span>if</span> <span>(</span><span>cursor</span><span>[</span><span>seg</span><span>]</span> <span>==</span> <span>null</span> <span>||</span> <span>typeof</span> <span>cursor</span><span>[</span><span>seg</span><span>]</span> <span>!==</span> <span>&#39;object&#39;</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L239" data-line-number="239"></td>
          <td id="file-proxy-ts-LC239">              <span>cursor</span><span>[</span><span>seg</span><span>]</span> <span>=</span> <span>{</span><span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L240" data-line-number="240"></td>
          <td id="file-proxy-ts-LC240">            <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L241" data-line-number="241"></td>
          <td id="file-proxy-ts-LC241">            <span>cursor</span> <span>=</span> <span>cursor</span><span>[</span><span>seg</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L242" data-line-number="242"></td>
          <td id="file-proxy-ts-LC242">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L243" data-line-number="243"></td>
          <td id="file-proxy-ts-LC243">          <span>cursor</span><span>[</span><span>newPath</span><span>[</span><span>newPath</span><span>.</span><span>length</span> <span>-</span> <span>1</span><span>]</span><span>]</span> <span>=</span> <span>value</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L244" data-line-number="244"></td>
          <td id="file-proxy-ts-LC244">          <span>return</span> <span>true</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L245" data-line-number="245"></td>
          <td id="file-proxy-ts-LC245">        <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L246" data-line-number="246"></td>
          <td id="file-proxy-ts-LC246">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L247" data-line-number="247"></td>
          <td id="file-proxy-ts-LC247">        <span>deleteProperty</span><span>(</span><span>_</span><span>,</span> <span>propKey</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L248" data-line-number="248"></td>
          <td id="file-proxy-ts-LC248">          <span>loadRow</span><span>(</span><span>tableName</span><span>,</span> <span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L249" data-line-number="249"></td>
          <td id="file-proxy-ts-LC249">          <span>const</span> <span>cacheForTable</span> <span>=</span> <span>memoryCache</span><span>.</span><span>get</span><span>(</span><span>tableName</span><span>)</span><span>!</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L250" data-line-number="250"></td>
          <td id="file-proxy-ts-LC250">          <span>if</span> <span>(</span><span>!</span><span>cacheForTable</span><span>.</span><span>has</span><span>(</span><span>rowId</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L251" data-line-number="251"></td>
          <td id="file-proxy-ts-LC251">            <span>throw</span> <span>new</span> <span>Error</span><span>(</span><span>`Row &#39;<span><span>${</span><span>rowId</span><span>}</span></span>&#39; not found in table &#39;<span><span>${</span><span>tableName</span><span>}</span></span>&#39; (delete).`</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L252" data-line-number="252"></td>
          <td id="file-proxy-ts-LC252">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L253" data-line-number="253"></td>
          <td id="file-proxy-ts-LC253">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L254" data-line-number="254"></td>
          <td id="file-proxy-ts-LC254">          <span>// If it looks like a numeric index =&gt; forbid</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L255" data-line-number="255"></td>
          <td id="file-proxy-ts-LC255">          <span>const</span> <span>keyString</span> <span>=</span> <span>propKey</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L256" data-line-number="256"></td>
          <td id="file-proxy-ts-LC256">          <span>if</span> <span>(</span><span><span>/</span>^\d+$<span>/</span></span><span>.</span><span>test</span><span>(</span><span>keyString</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L257" data-line-number="257"></td>
          <td id="file-proxy-ts-LC257">            <span>throw</span> <span>new</span> <span>Error</span><span>(</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L258" data-line-number="258"></td>
          <td id="file-proxy-ts-LC258">              <span>`Deleting array elements by index is not allowed: .<span><span>${</span><span>keyString</span><span>}</span></span>`</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L259" data-line-number="259"></td>
          <td id="file-proxy-ts-LC259">            <span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L260" data-line-number="260"></td>
          <td id="file-proxy-ts-LC260">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L261" data-line-number="261"></td>
          <td id="file-proxy-ts-LC261">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L262" data-line-number="262"></td>
          <td id="file-proxy-ts-LC262">          <span>const</span> <span>{</span> jsonRemove <span>}</span> <span>=</span> <span>getStatementsForTable</span><span>(</span><span>tableName</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L263" data-line-number="263"></td>
          <td id="file-proxy-ts-LC263">          <span>const</span> <span>newPath</span> <span>=</span> <span>[</span>...<span>pathSoFar</span><span>,</span> <span>keyString</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L264" data-line-number="264"></td>
          <td id="file-proxy-ts-LC264">          <span>const</span> <span>jsonPath</span> <span>=</span> <span>pathToJsonPathString</span><span>(</span><span>newPath</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L265" data-line-number="265"></td>
          <td id="file-proxy-ts-LC265">          <span>jsonRemove</span><span>.</span><span>run</span><span>(</span><span>jsonPath</span><span>,</span> <span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L266" data-line-number="266"></td>
          <td id="file-proxy-ts-LC266">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L267" data-line-number="267"></td>
          <td id="file-proxy-ts-LC267">          <span>// Update in-memory object</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L268" data-line-number="268"></td>
          <td id="file-proxy-ts-LC268">          <span>const</span> <span>rowData</span> <span>=</span> <span>cacheForTable</span><span>.</span><span>get</span><span>(</span><span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L269" data-line-number="269"></td>
          <td id="file-proxy-ts-LC269">          <span>let</span> <span>cursor</span>: <span>any</span> <span>=</span> <span>rowData</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L270" data-line-number="270"></td>
          <td id="file-proxy-ts-LC270">          <span>for</span> <span>(</span><span>let</span> <span>i</span> <span>=</span> <span>0</span><span>;</span> <span>i</span> <span>&lt;</span> <span>newPath</span><span>.</span><span>length</span> <span>-</span> <span>1</span><span>;</span> <span>i</span><span>++</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L271" data-line-number="271"></td>
          <td id="file-proxy-ts-LC271">            <span>const</span> <span>seg</span> <span>=</span> <span>newPath</span><span>[</span><span>i</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L272" data-line-number="272"></td>
          <td id="file-proxy-ts-LC272">            <span>if</span> <span>(</span><span>cursor</span><span>[</span><span>seg</span><span>]</span> <span>==</span> <span>null</span> <span>||</span> <span>typeof</span> <span>cursor</span><span>[</span><span>seg</span><span>]</span> <span>!==</span> <span>&#39;object&#39;</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L273" data-line-number="273"></td>
          <td id="file-proxy-ts-LC273">              <span>return</span> <span>true</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L274" data-line-number="274"></td>
          <td id="file-proxy-ts-LC274">            <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L275" data-line-number="275"></td>
          <td id="file-proxy-ts-LC275">            <span>cursor</span> <span>=</span> <span>cursor</span><span>[</span><span>seg</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L276" data-line-number="276"></td>
          <td id="file-proxy-ts-LC276">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L277" data-line-number="277"></td>
          <td id="file-proxy-ts-LC277">          <span>delete</span> <span>cursor</span><span>[</span><span>newPath</span><span>[</span><span>newPath</span><span>.</span><span>length</span> <span>-</span> <span>1</span><span>]</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L278" data-line-number="278"></td>
          <td id="file-proxy-ts-LC278">          <span>return</span> <span>true</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L279" data-line-number="279"></td>
          <td id="file-proxy-ts-LC279">        <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L280" data-line-number="280"></td>
          <td id="file-proxy-ts-LC280">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L281" data-line-number="281"></td>
          <td id="file-proxy-ts-LC281">        <span>has</span><span>(</span><span>_</span><span>,</span> <span>propKey</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L282" data-line-number="282"></td>
          <td id="file-proxy-ts-LC282">          <span>if</span> <span>(</span><span>typeof</span> <span>propKey</span> <span>===</span> <span>&#39;symbol&#39;</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L283" data-line-number="283"></td>
          <td id="file-proxy-ts-LC283">            <span>return</span> <span>Reflect</span><span>.</span><span>has</span><span>(</span><span>_</span><span>,</span> <span>propKey</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L284" data-line-number="284"></td>
          <td id="file-proxy-ts-LC284">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L285" data-line-number="285"></td>
          <td id="file-proxy-ts-LC285">          <span>loadRow</span><span>(</span><span>tableName</span><span>,</span> <span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L286" data-line-number="286"></td>
          <td id="file-proxy-ts-LC286">          <span>const</span> <span>cacheForTable</span> <span>=</span> <span>memoryCache</span><span>.</span><span>get</span><span>(</span><span>tableName</span><span>)</span><span>!</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L287" data-line-number="287"></td>
          <td id="file-proxy-ts-LC287">          <span>if</span> <span>(</span><span>!</span><span>cacheForTable</span><span>.</span><span>has</span><span>(</span><span>rowId</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L288" data-line-number="288"></td>
          <td id="file-proxy-ts-LC288">            <span>return</span> <span>false</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L289" data-line-number="289"></td>
          <td id="file-proxy-ts-LC289">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L290" data-line-number="290"></td>
          <td id="file-proxy-ts-LC290">          <span>const</span> <span>rowData</span> <span>=</span> <span>cacheForTable</span><span>.</span><span>get</span><span>(</span><span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L291" data-line-number="291"></td>
          <td id="file-proxy-ts-LC291">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L292" data-line-number="292"></td>
          <td id="file-proxy-ts-LC292">          <span>let</span> <span>current</span> <span>=</span> <span>rowData</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L293" data-line-number="293"></td>
          <td id="file-proxy-ts-LC293">          <span>for</span> <span>(</span><span>const</span> <span>p</span> <span>of</span> <span>pathSoFar</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L294" data-line-number="294"></td>
          <td id="file-proxy-ts-LC294">            <span>if</span> <span>(</span><span>current</span> <span>==</span> <span>null</span> <span>||</span> <span>typeof</span> <span>current</span> <span>!==</span> <span>&#39;object&#39;</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L295" data-line-number="295"></td>
          <td id="file-proxy-ts-LC295">              <span>return</span> <span>false</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L296" data-line-number="296"></td>
          <td id="file-proxy-ts-LC296">            <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L297" data-line-number="297"></td>
          <td id="file-proxy-ts-LC297">            <span>current</span> <span>=</span> <span>current</span><span>[</span><span>p</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L298" data-line-number="298"></td>
          <td id="file-proxy-ts-LC298">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L299" data-line-number="299"></td>
          <td id="file-proxy-ts-LC299">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L300" data-line-number="300"></td>
          <td id="file-proxy-ts-LC300">          <span>if</span> <span>(</span><span>current</span> <span>&amp;&amp;</span> <span>typeof</span> <span>current</span> <span>===</span> <span>&#39;object&#39;</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L301" data-line-number="301"></td>
          <td id="file-proxy-ts-LC301">            <span>return</span> <span>Object</span><span>.</span><span>prototype</span><span>.</span><span>hasOwnProperty</span><span>.</span><span>call</span><span>(</span><span>current</span><span>,</span> <span>propKey</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L302" data-line-number="302"></td>
          <td id="file-proxy-ts-LC302">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L303" data-line-number="303"></td>
          <td id="file-proxy-ts-LC303">          <span>return</span> <span>false</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L304" data-line-number="304"></td>
          <td id="file-proxy-ts-LC304">        <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L305" data-line-number="305"></td>
          <td id="file-proxy-ts-LC305">      <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L306" data-line-number="306"></td>
          <td id="file-proxy-ts-LC306">    <span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L307" data-line-number="307"></td>
          <td id="file-proxy-ts-LC307">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L308" data-line-number="308"></td>
          <td id="file-proxy-ts-LC308">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L309" data-line-number="309"></td>
          <td id="file-proxy-ts-LC309">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L310" data-line-number="310"></td>
          <td id="file-proxy-ts-LC310">  <span>// F) Create the &#34;Reader&#34; table object</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L311" data-line-number="311"></td>
          <td id="file-proxy-ts-LC311">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L312" data-line-number="312"></td>
          <td id="file-proxy-ts-LC312">  <span>function</span> <span>createTableReader</span><span>(</span><span>tableName</span>: <span>string</span><span>)</span>: <span>TableReader</span><span>&lt;</span><span>any</span><span>&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L313" data-line-number="313"></td>
          <td id="file-proxy-ts-LC313">    <span>const</span> <span>{</span> selectAllIds<span>,</span> checkExistence <span>}</span> <span>=</span> <span>getStatementsForTable</span><span>(</span><span>tableName</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L314" data-line-number="314"></td>
          <td id="file-proxy-ts-LC314">    <span>const</span> <span>cacheForTable</span> <span>=</span> <span>memoryCache</span><span>.</span><span>get</span><span>(</span><span>tableName</span><span>)</span><span>!</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L315" data-line-number="315"></td>
          <td id="file-proxy-ts-LC315">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L316" data-line-number="316"></td>
          <td id="file-proxy-ts-LC316">    <span>const</span> <span>readerImplementation</span> <span>=</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L317" data-line-number="317"></td>
          <td id="file-proxy-ts-LC317">      <span>forEach</span><span>(</span><span>callback</span>: <span>(</span><span>id</span>: <span>string</span><span>,</span> <span>data</span>: <span>any</span><span>)</span> <span>=&gt;</span> <span><span>void</span></span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L318" data-line-number="318"></td>
          <td id="file-proxy-ts-LC318">        <span>const</span> <span>rows</span> <span>=</span> <span>selectAllIds</span><span>.</span><span>all</span><span>(</span><span>)</span> <span>as</span> <span>Array</span><span>&lt;</span><span>{</span> <span>id</span>: <span>string</span> <span>}</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L319" data-line-number="319"></td>
          <td id="file-proxy-ts-LC319">        <span>for</span> <span>(</span><span>const</span> <span>r</span> <span>of</span> <span>rows</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L320" data-line-number="320"></td>
          <td id="file-proxy-ts-LC320">          <span>loadRow</span><span>(</span><span>tableName</span><span>,</span> <span>r</span><span>.</span><span>id</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L321" data-line-number="321"></td>
          <td id="file-proxy-ts-LC321">          <span>const</span> <span>cached</span> <span>=</span> <span>cacheForTable</span><span>.</span><span>get</span><span>(</span><span>r</span><span>.</span><span>id</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L322" data-line-number="322"></td>
          <td id="file-proxy-ts-LC322">          <span>if</span> <span>(</span><span>cached</span> <span>!==</span> <span>undefined</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L323" data-line-number="323"></td>
          <td id="file-proxy-ts-LC323">            <span>callback</span><span>(</span><span>r</span><span>.</span><span>id</span><span>,</span> <span>cached</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L324" data-line-number="324"></td>
          <td id="file-proxy-ts-LC324">          <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L325" data-line-number="325"></td>
          <td id="file-proxy-ts-LC325">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L326" data-line-number="326"></td>
          <td id="file-proxy-ts-LC326">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L327" data-line-number="327"></td>
          <td id="file-proxy-ts-LC327">      <span>keys</span><span>(</span><span>)</span>: <span>string</span><span>[</span><span>]</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L328" data-line-number="328"></td>
          <td id="file-proxy-ts-LC328">        <span>return</span> <span>selectAllIds</span><span>.</span><span>all</span><span>(</span><span>)</span><span>.</span><span>map</span><span>(</span><span>(</span><span>r</span>: <span>any</span><span>)</span> <span>=&gt;</span> <span>r</span><span>.</span><span>id</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L329" data-line-number="329"></td>
          <td id="file-proxy-ts-LC329">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L330" data-line-number="330"></td>
          <td id="file-proxy-ts-LC330">      <span>values</span><span>(</span><span>)</span>: <span>any</span><span>[</span><span>]</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L331" data-line-number="331"></td>
          <td id="file-proxy-ts-LC331">        <span>return</span> <span>selectAllIds</span><span>.</span><span>all</span><span>(</span><span>)</span><span>.</span><span>map</span><span>(</span><span>(</span><span>r</span>: <span>any</span><span>)</span> <span>=&gt;</span> <span>cacheForTable</span><span>.</span><span>get</span><span>(</span><span>r</span><span>.</span><span>id</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L332" data-line-number="332"></td>
          <td id="file-proxy-ts-LC332">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L333" data-line-number="333"></td>
          <td id="file-proxy-ts-LC333">      <span>dict</span><span>(</span><span>)</span>: <span>Record</span><span>&lt;</span><span>string</span><span>,</span> <span>any</span><span>&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L334" data-line-number="334"></td>
          <td id="file-proxy-ts-LC334">        <span>return</span> <span>selectAllIds</span><span>.</span><span>all</span><span>(</span><span>)</span><span>.</span><span>reduce</span><span>(</span><span>(</span><span>acc</span><span>,</span> <span>r</span>: <span>any</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L335" data-line-number="335"></td>
          <td id="file-proxy-ts-LC335">          <span>acc</span><span>[</span><span>r</span><span>.</span><span>id</span><span>]</span> <span>=</span> <span>cacheForTable</span><span>.</span><span>get</span><span>(</span><span>r</span><span>.</span><span>id</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L336" data-line-number="336"></td>
          <td id="file-proxy-ts-LC336">          <span>return</span> <span>acc</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L337" data-line-number="337"></td>
          <td id="file-proxy-ts-LC337">        <span>}</span><span>,</span> <span>{</span><span>}</span> <span>as</span> <span>Record</span><span>&lt;</span><span>string</span><span>,</span> <span>any</span><span>&gt;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L338" data-line-number="338"></td>
          <td id="file-proxy-ts-LC338">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L339" data-line-number="339"></td>
          <td id="file-proxy-ts-LC339">      <span>entries</span><span>(</span><span>)</span>: <span>Array</span><span>&lt;</span><span>[</span><span>string</span><span>,</span> <span>any</span><span>]</span><span>&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L340" data-line-number="340"></td>
          <td id="file-proxy-ts-LC340">        <span>return</span> <span>selectAllIds</span><span>.</span><span>all</span><span>(</span><span>)</span><span>.</span><span>map</span><span>(</span><span>(</span><span>r</span>: <span>any</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L341" data-line-number="341"></td>
          <td id="file-proxy-ts-LC341">          <span>loadRow</span><span>(</span><span>tableName</span><span>,</span> <span>r</span><span>.</span><span>id</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L342" data-line-number="342"></td>
          <td id="file-proxy-ts-LC342">          <span>return</span> <span>[</span><span>r</span><span>.</span><span>id</span><span>,</span> <span>cacheForTable</span><span>.</span><span>get</span><span>(</span><span>r</span><span>.</span><span>id</span><span>)</span><span>]</span> <span>as</span> <span>[</span><span>string</span><span>,</span> <span>any</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L343" data-line-number="343"></td>
          <td id="file-proxy-ts-LC343">        <span>}</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L344" data-line-number="344"></td>
          <td id="file-proxy-ts-LC344">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L345" data-line-number="345"></td>
          <td id="file-proxy-ts-LC345">      <span>has</span><span>(</span><span>id</span>: <span>string</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L346" data-line-number="346"></td>
          <td id="file-proxy-ts-LC346">        <span>if</span> <span>(</span><span>cacheForTable</span><span>.</span><span>has</span><span>(</span><span>id</span><span>)</span><span>)</span> <span>return</span> <span>true</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L347" data-line-number="347"></td>
          <td id="file-proxy-ts-LC347">        <span>const</span> <span>row</span> <span>=</span> <span>checkExistence</span><span>.</span><span>get</span><span>(</span><span>id</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L348" data-line-number="348"></td>
          <td id="file-proxy-ts-LC348">        <span>return</span> <span>!</span><span>!</span><span>row</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L349" data-line-number="349"></td>
          <td id="file-proxy-ts-LC349">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L350" data-line-number="350"></td>
          <td id="file-proxy-ts-LC350">    <span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L351" data-line-number="351"></td>
          <td id="file-proxy-ts-LC351">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L352" data-line-number="352"></td>
          <td id="file-proxy-ts-LC352">    <span>return</span> <span>new</span> <span>Proxy</span><span>(</span><span>readerImplementation</span><span>,</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L353" data-line-number="353"></td>
          <td id="file-proxy-ts-LC353">      <span>get</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>,</span> <span>receiver</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L354" data-line-number="354"></td>
          <td id="file-proxy-ts-LC354">        <span>if</span> <span>(</span><span>typeof</span> <span>propKey</span> <span>===</span> <span>&#39;symbol&#39;</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L355" data-line-number="355"></td>
          <td id="file-proxy-ts-LC355">          <span>return</span> <span>Reflect</span><span>.</span><span>get</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>,</span> <span>receiver</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L356" data-line-number="356"></td>
          <td id="file-proxy-ts-LC356">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L357" data-line-number="357"></td>
          <td id="file-proxy-ts-LC357">        <span>if</span> <span>(</span><span>Reflect</span><span>.</span><span>has</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L358" data-line-number="358"></td>
          <td id="file-proxy-ts-LC358">          <span>return</span> <span>Reflect</span><span>.</span><span>get</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>,</span> <span>receiver</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L359" data-line-number="359"></td>
          <td id="file-proxy-ts-LC359">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L360" data-line-number="360"></td>
          <td id="file-proxy-ts-LC360">        <span>// otherwise treat propKey as rowId</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L361" data-line-number="361"></td>
          <td id="file-proxy-ts-LC361">        <span>const</span> <span>rowId</span> <span>=</span> <span>propKey</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L362" data-line-number="362"></td>
          <td id="file-proxy-ts-LC362">        <span>loadRow</span><span>(</span><span>tableName</span><span>,</span> <span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L363" data-line-number="363"></td>
          <td id="file-proxy-ts-LC363">        <span>return</span> <span>cacheForTable</span><span>.</span><span>get</span><span>(</span><span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L364" data-line-number="364"></td>
          <td id="file-proxy-ts-LC364">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L365" data-line-number="365"></td>
          <td id="file-proxy-ts-LC365">      <span>set</span><span>(</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L366" data-line-number="366"></td>
          <td id="file-proxy-ts-LC366">        <span>throw</span> <span>new</span> <span>Error</span><span>(</span><span>`Cannot write via Reader API`</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L367" data-line-number="367"></td>
          <td id="file-proxy-ts-LC367">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L368" data-line-number="368"></td>
          <td id="file-proxy-ts-LC368">      <span>deleteProperty</span><span>(</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L369" data-line-number="369"></td>
          <td id="file-proxy-ts-LC369">        <span>throw</span> <span>new</span> <span>Error</span><span>(</span><span>`Cannot delete via Reader API`</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L370" data-line-number="370"></td>
          <td id="file-proxy-ts-LC370">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L371" data-line-number="371"></td>
          <td id="file-proxy-ts-LC371">      <span>has</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L372" data-line-number="372"></td>
          <td id="file-proxy-ts-LC372">        <span>if</span> <span>(</span><span>typeof</span> <span>propKey</span> <span>===</span> <span>&#39;symbol&#39;</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L373" data-line-number="373"></td>
          <td id="file-proxy-ts-LC373">          <span>return</span> <span>Reflect</span><span>.</span><span>has</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L374" data-line-number="374"></td>
          <td id="file-proxy-ts-LC374">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L375" data-line-number="375"></td>
          <td id="file-proxy-ts-LC375">        <span>if</span> <span>(</span><span>Reflect</span><span>.</span><span>has</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L376" data-line-number="376"></td>
          <td id="file-proxy-ts-LC376">          <span>return</span> <span>true</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L377" data-line-number="377"></td>
          <td id="file-proxy-ts-LC377">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L378" data-line-number="378"></td>
          <td id="file-proxy-ts-LC378">        <span>const</span> <span>rowId</span> <span>=</span> <span>propKey</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L379" data-line-number="379"></td>
          <td id="file-proxy-ts-LC379">        <span>if</span> <span>(</span><span>cacheForTable</span><span>.</span><span>has</span><span>(</span><span>rowId</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L380" data-line-number="380"></td>
          <td id="file-proxy-ts-LC380">          <span>return</span> <span>true</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L381" data-line-number="381"></td>
          <td id="file-proxy-ts-LC381">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L382" data-line-number="382"></td>
          <td id="file-proxy-ts-LC382">        <span>const</span> <span>row</span> <span>=</span> <span>checkExistence</span><span>.</span><span>get</span><span>(</span><span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L383" data-line-number="383"></td>
          <td id="file-proxy-ts-LC383">        <span>return</span> <span>!</span><span>!</span><span>row</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L384" data-line-number="384"></td>
          <td id="file-proxy-ts-LC384">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L385" data-line-number="385"></td>
          <td id="file-proxy-ts-LC385">    <span>}</span><span>)</span> <span>as</span> <span>TableReader</span><span>&lt;</span><span>any</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L386" data-line-number="386"></td>
          <td id="file-proxy-ts-LC386">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L387" data-line-number="387"></td>
          <td id="file-proxy-ts-LC387">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L388" data-line-number="388"></td>
          <td id="file-proxy-ts-LC388">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L389" data-line-number="389"></td>
          <td id="file-proxy-ts-LC389">  <span>// G) Create the &#34;Writer&#34; table object</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L390" data-line-number="390"></td>
          <td id="file-proxy-ts-LC390">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L391" data-line-number="391"></td>
          <td id="file-proxy-ts-LC391">  <span>function</span> <span>createTableWriter</span><span>(</span><span>tableName</span>: <span>string</span><span>)</span>: <span>TableWriter</span><span>&lt;</span><span>any</span><span>&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L392" data-line-number="392"></td>
          <td id="file-proxy-ts-LC392">    <span>const</span> <span>{</span> checkExistence<span>,</span> selectAllIds<span>,</span> upsertWholeRow<span>,</span> deleteRow <span>}</span> <span>=</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L393" data-line-number="393"></td>
          <td id="file-proxy-ts-LC393">      <span>getStatementsForTable</span><span>(</span><span>tableName</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L394" data-line-number="394"></td>
          <td id="file-proxy-ts-LC394">    <span>const</span> <span>cacheForTable</span> <span>=</span> <span>memoryCache</span><span>.</span><span>get</span><span>(</span><span>tableName</span><span>)</span><span>!</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L395" data-line-number="395"></td>
          <td id="file-proxy-ts-LC395">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L396" data-line-number="396"></td>
          <td id="file-proxy-ts-LC396">    <span>const</span> <span>writerImplementation</span> <span>=</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L397" data-line-number="397"></td>
          <td id="file-proxy-ts-LC397">      <span>forEach</span><span>(</span><span>callback</span>: <span>(</span><span>id</span>: <span>string</span><span>,</span> <span>rowProxy</span>: <span>any</span><span>)</span> <span>=&gt;</span> <span><span>void</span></span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L398" data-line-number="398"></td>
          <td id="file-proxy-ts-LC398">        <span>const</span> <span>rows</span> <span>=</span> <span>selectAllIds</span><span>.</span><span>all</span><span>(</span><span>)</span> <span>as</span> <span>Array</span><span>&lt;</span><span>{</span> <span>id</span>: <span>string</span> <span>}</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L399" data-line-number="399"></td>
          <td id="file-proxy-ts-LC399">        <span>for</span> <span>(</span><span>const</span> <span>r</span> <span>of</span> <span>rows</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L400" data-line-number="400"></td>
          <td id="file-proxy-ts-LC400">          <span>loadRow</span><span>(</span><span>tableName</span><span>,</span> <span>r</span><span>.</span><span>id</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L401" data-line-number="401"></td>
          <td id="file-proxy-ts-LC401">          <span>callback</span><span>(</span><span>r</span><span>.</span><span>id</span><span>,</span> <span>createRowProxy</span><span>(</span><span>tableName</span><span>,</span> <span>r</span><span>.</span><span>id</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L402" data-line-number="402"></td>
          <td id="file-proxy-ts-LC402">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L403" data-line-number="403"></td>
          <td id="file-proxy-ts-LC403">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L404" data-line-number="404"></td>
          <td id="file-proxy-ts-LC404">      <span>keys</span><span>(</span><span>)</span>: <span>string</span><span>[</span><span>]</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L405" data-line-number="405"></td>
          <td id="file-proxy-ts-LC405">        <span>return</span> <span>selectAllIds</span><span>.</span><span>all</span><span>(</span><span>)</span><span>.</span><span>map</span><span>(</span><span>(</span><span>r</span>: <span>any</span><span>)</span> <span>=&gt;</span> <span>r</span><span>.</span><span>id</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L406" data-line-number="406"></td>
          <td id="file-proxy-ts-LC406">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L407" data-line-number="407"></td>
          <td id="file-proxy-ts-LC407">      <span>entries</span><span>(</span><span>)</span>: <span>Array</span><span>&lt;</span><span>[</span><span>string</span><span>,</span> <span>any</span><span>]</span><span>&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L408" data-line-number="408"></td>
          <td id="file-proxy-ts-LC408">        <span>return</span> <span>selectAllIds</span><span>.</span><span>all</span><span>(</span><span>)</span><span>.</span><span>map</span><span>(</span><span>(</span><span>r</span>: <span>any</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L409" data-line-number="409"></td>
          <td id="file-proxy-ts-LC409">          <span>loadRow</span><span>(</span><span>tableName</span><span>,</span> <span>r</span><span>.</span><span>id</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L410" data-line-number="410"></td>
          <td id="file-proxy-ts-LC410">          <span>return</span> <span>[</span><span>r</span><span>.</span><span>id</span><span>,</span> <span>createRowProxy</span><span>(</span><span>tableName</span><span>,</span> <span>r</span><span>.</span><span>id</span><span>)</span><span>]</span> <span>as</span> <span>[</span><span>string</span><span>,</span> <span>any</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L411" data-line-number="411"></td>
          <td id="file-proxy-ts-LC411">        <span>}</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L412" data-line-number="412"></td>
          <td id="file-proxy-ts-LC412">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L413" data-line-number="413"></td>
          <td id="file-proxy-ts-LC413">      <span>has</span><span>(</span><span>id</span>: <span>string</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L414" data-line-number="414"></td>
          <td id="file-proxy-ts-LC414">        <span>if</span> <span>(</span><span>cacheForTable</span><span>.</span><span>has</span><span>(</span><span>id</span><span>)</span><span>)</span> <span>return</span> <span>true</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L415" data-line-number="415"></td>
          <td id="file-proxy-ts-LC415">        <span>const</span> <span>row</span> <span>=</span> <span>checkExistence</span><span>.</span><span>get</span><span>(</span><span>id</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L416" data-line-number="416"></td>
          <td id="file-proxy-ts-LC416">        <span>return</span> <span>!</span><span>!</span><span>row</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L417" data-line-number="417"></td>
          <td id="file-proxy-ts-LC417">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L418" data-line-number="418"></td>
          <td id="file-proxy-ts-LC418">    <span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L419" data-line-number="419"></td>
          <td id="file-proxy-ts-LC419">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L420" data-line-number="420"></td>
          <td id="file-proxy-ts-LC420">    <span>return</span> <span>new</span> <span>Proxy</span><span>(</span><span>writerImplementation</span><span>,</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L421" data-line-number="421"></td>
          <td id="file-proxy-ts-LC421">      <span>get</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>,</span> <span>receiver</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L422" data-line-number="422"></td>
          <td id="file-proxy-ts-LC422">        <span>if</span> <span>(</span><span>typeof</span> <span>propKey</span> <span>===</span> <span>&#39;symbol&#39;</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L423" data-line-number="423"></td>
          <td id="file-proxy-ts-LC423">          <span>return</span> <span>Reflect</span><span>.</span><span>get</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>,</span> <span>receiver</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L424" data-line-number="424"></td>
          <td id="file-proxy-ts-LC424">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L425" data-line-number="425"></td>
          <td id="file-proxy-ts-LC425">        <span>if</span> <span>(</span><span>Reflect</span><span>.</span><span>has</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L426" data-line-number="426"></td>
          <td id="file-proxy-ts-LC426">          <span>return</span> <span>Reflect</span><span>.</span><span>get</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>,</span> <span>receiver</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L427" data-line-number="427"></td>
          <td id="file-proxy-ts-LC427">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L428" data-line-number="428"></td>
          <td id="file-proxy-ts-LC428">        <span>const</span> <span>rowId</span> <span>=</span> <span>propKey</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L429" data-line-number="429"></td>
          <td id="file-proxy-ts-LC429">        <span>loadRow</span><span>(</span><span>tableName</span><span>,</span> <span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L430" data-line-number="430"></td>
          <td id="file-proxy-ts-LC430">        <span>return</span> <span>createRowProxy</span><span>(</span><span>tableName</span><span>,</span> <span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L431" data-line-number="431"></td>
          <td id="file-proxy-ts-LC431">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L432" data-line-number="432"></td>
          <td id="file-proxy-ts-LC432">      <span>set</span><span>(</span><span>_</span><span>,</span> <span>rowId</span><span>,</span> <span>value</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L433" data-line-number="433"></td>
          <td id="file-proxy-ts-LC433">        <span>// upsert entire row</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L434" data-line-number="434"></td>
          <td id="file-proxy-ts-LC434">        <span>const</span> <span>idString</span> <span>=</span> <span>rowId</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L435" data-line-number="435"></td>
          <td id="file-proxy-ts-LC435">        <span>cacheForTable</span><span>.</span><span>set</span><span>(</span><span>idString</span><span>,</span> <span>value</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L436" data-line-number="436"></td>
          <td id="file-proxy-ts-LC436">        <span>upsertWholeRow</span><span>.</span><span>run</span><span>(</span><span>idString</span><span>,</span> <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>value</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L437" data-line-number="437"></td>
          <td id="file-proxy-ts-LC437">        <span>return</span> <span>true</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L438" data-line-number="438"></td>
          <td id="file-proxy-ts-LC438">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L439" data-line-number="439"></td>
          <td id="file-proxy-ts-LC439">      <span>deleteProperty</span><span>(</span><span>_</span><span>,</span> <span>rowId</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L440" data-line-number="440"></td>
          <td id="file-proxy-ts-LC440">        <span>const</span> <span>idString</span> <span>=</span> <span>rowId</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L441" data-line-number="441"></td>
          <td id="file-proxy-ts-LC441">        <span>cacheForTable</span><span>.</span><span>delete</span><span>(</span><span>idString</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L442" data-line-number="442"></td>
          <td id="file-proxy-ts-LC442">        <span>deleteRow</span><span>.</span><span>run</span><span>(</span><span>idString</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L443" data-line-number="443"></td>
          <td id="file-proxy-ts-LC443">        <span>return</span> <span>true</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L444" data-line-number="444"></td>
          <td id="file-proxy-ts-LC444">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L445" data-line-number="445"></td>
          <td id="file-proxy-ts-LC445">      <span>has</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L446" data-line-number="446"></td>
          <td id="file-proxy-ts-LC446">        <span>if</span> <span>(</span><span>typeof</span> <span>propKey</span> <span>===</span> <span>&#39;symbol&#39;</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L447" data-line-number="447"></td>
          <td id="file-proxy-ts-LC447">          <span>return</span> <span>Reflect</span><span>.</span><span>has</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L448" data-line-number="448"></td>
          <td id="file-proxy-ts-LC448">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L449" data-line-number="449"></td>
          <td id="file-proxy-ts-LC449">        <span>if</span> <span>(</span><span>Reflect</span><span>.</span><span>has</span><span>(</span><span>target</span><span>,</span> <span>propKey</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L450" data-line-number="450"></td>
          <td id="file-proxy-ts-LC450">          <span>return</span> <span>true</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L451" data-line-number="451"></td>
          <td id="file-proxy-ts-LC451">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L452" data-line-number="452"></td>
          <td id="file-proxy-ts-LC452">        <span>const</span> <span>rowId</span> <span>=</span> <span>propKey</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L453" data-line-number="453"></td>
          <td id="file-proxy-ts-LC453">        <span>if</span> <span>(</span><span>cacheForTable</span><span>.</span><span>has</span><span>(</span><span>rowId</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L454" data-line-number="454"></td>
          <td id="file-proxy-ts-LC454">          <span>return</span> <span>true</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L455" data-line-number="455"></td>
          <td id="file-proxy-ts-LC455">        <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L456" data-line-number="456"></td>
          <td id="file-proxy-ts-LC456">        <span>const</span> <span>row</span> <span>=</span> <span>checkExistence</span><span>.</span><span>get</span><span>(</span><span>rowId</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L457" data-line-number="457"></td>
          <td id="file-proxy-ts-LC457">        <span>return</span> <span>!</span><span>!</span><span>row</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L458" data-line-number="458"></td>
          <td id="file-proxy-ts-LC458">      <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L459" data-line-number="459"></td>
          <td id="file-proxy-ts-LC459">    <span>}</span><span>)</span> <span>as</span> <span>TableWriter</span><span>&lt;</span><span>any</span><span>&gt;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L460" data-line-number="460"></td>
          <td id="file-proxy-ts-LC460">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L461" data-line-number="461"></td>
          <td id="file-proxy-ts-LC461">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L462" data-line-number="462"></td>
          <td id="file-proxy-ts-LC462">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L463" data-line-number="463"></td>
          <td id="file-proxy-ts-LC463">  <span>// H) Build the overall &#34;rdr&#34; and &#34;wtr&#34; objects</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L464" data-line-number="464"></td>
          <td id="file-proxy-ts-LC464">  <span>////////////////////////////////////////</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L465" data-line-number="465"></td>
          <td id="file-proxy-ts-LC465">  <span>const</span> <span>rdrObj</span> <span>=</span> <span>{</span><span>}</span> <span>as</span> <span>DBClient</span><span>&lt;</span><span>TSchema</span><span>&gt;</span><span>[</span><span>&#39;rdr&#39;</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L466" data-line-number="466"></td>
          <td id="file-proxy-ts-LC466">  <span>const</span> <span>wtrObj</span> <span>=</span> <span>{</span><span>}</span> <span>as</span> <span>DBClient</span><span>&lt;</span><span>TSchema</span><span>&gt;</span><span>[</span><span>&#39;wtr&#39;</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L467" data-line-number="467"></td>
          <td id="file-proxy-ts-LC467">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L468" data-line-number="468"></td>
          <td id="file-proxy-ts-LC468">  <span>for</span> <span>(</span><span>const</span> <span>tableName</span> <span>of</span> <span>Object</span><span>.</span><span>keys</span><span>(</span><span>schema</span><span>)</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L469" data-line-number="469"></td>
          <td id="file-proxy-ts-LC469">    <span>Object</span><span>.</span><span>defineProperty</span><span>(</span><span>rdrObj</span><span>,</span> <span>tableName</span><span>,</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L470" data-line-number="470"></td>
          <td id="file-proxy-ts-LC470">      <span>value</span>: <span>createTableReader</span><span>(</span><span>tableName</span><span>)</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L471" data-line-number="471"></td>
          <td id="file-proxy-ts-LC471">      <span>enumerable</span>: <span>true</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L472" data-line-number="472"></td>
          <td id="file-proxy-ts-LC472">      <span>configurable</span>: <span>false</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L473" data-line-number="473"></td>
          <td id="file-proxy-ts-LC473">      <span>writable</span>: <span>false</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L474" data-line-number="474"></td>
          <td id="file-proxy-ts-LC474">    <span>}</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L475" data-line-number="475"></td>
          <td id="file-proxy-ts-LC475">    <span>Object</span><span>.</span><span>defineProperty</span><span>(</span><span>wtrObj</span><span>,</span> <span>tableName</span><span>,</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L476" data-line-number="476"></td>
          <td id="file-proxy-ts-LC476">      <span>value</span>: <span>createTableWriter</span><span>(</span><span>tableName</span><span>)</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L477" data-line-number="477"></td>
          <td id="file-proxy-ts-LC477">      <span>enumerable</span>: <span>true</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L478" data-line-number="478"></td>
          <td id="file-proxy-ts-LC478">      <span>configurable</span>: <span>false</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L479" data-line-number="479"></td>
          <td id="file-proxy-ts-LC479">      <span>writable</span>: <span>false</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L480" data-line-number="480"></td>
          <td id="file-proxy-ts-LC480">    <span>}</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L481" data-line-number="481"></td>
          <td id="file-proxy-ts-LC481">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L482" data-line-number="482"></td>
          <td id="file-proxy-ts-LC482">
</td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L483" data-line-number="483"></td>
          <td id="file-proxy-ts-LC483">  <span>return</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L484" data-line-number="484"></td>
          <td id="file-proxy-ts-LC484">    <span>rdr</span>: <span>rdrObj</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L485" data-line-number="485"></td>
          <td id="file-proxy-ts-LC485">    <span>wtr</span>: <span>wtrObj</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L486" data-line-number="486"></td>
          <td id="file-proxy-ts-LC486">  <span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-proxy-ts-L487" data-line-number="487"></td>
          <td id="file-proxy-ts-LC487"><span>}</span></td>
        </tr>
  </tbody></div></div>
  </body>
</html>
