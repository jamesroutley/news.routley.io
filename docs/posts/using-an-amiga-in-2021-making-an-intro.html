<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://datagubbe.se/mkdem/">Original</a>
    <h1>Using an Amiga in 2021: Making an intro</h1>
    
    <div id="readability-page-1" class="page"><div>



<p><i>Summer 2021</i></p>

<h2 id="conts">Contents</h2>

<ul>
  <li><a href="#intro">Introduction</a> - short background
    <ul>
      <li><a href="#pres">Istari - Space Swap</a> - watch the intro!</li>
      <li><a href="#deconstruct">Breaking it down</a></li>
    </ul>
  </li>
  <li><a href="#makeit">Making it</a>
    <ul>
      <li><a href="#jargon">Jargon buster</a></li>
      <li><a href="#gfx">The graphics</a>
        <ul>
          <li><a href="#logo">The logo</a></li>
          <li><a href="#bakg">The background</a></li>
          <li><a href="#anims">The animations</a></li>
        </ul>
      </li>
      <li><a href="#music">The music</a></li>
      <li><a href="#font">The font</a></li>
      <li><a href="#code">Putting it all together</a>
        <ul>
          <li><a href="#amos">Almost Professional</a></li>
          <li><a href="#melt">The logo melt and palette change</a></li>
          <li><a href="#writer">The text writer</a></li>
          <li><a href="#codebakg">The background</a></li>
          <li><a href="#codeanim">The animations</a></li>
          <li><a href="#tweak">Tweaking and testing</a></li>
          <li><a href="#crunch">Crunching</a></li>
          <li><a href="#rel">Releasing</a></li>
          <li><a href="#sauce">Special sauce</a></li>
        </ul>
      </li>
      <li><a href="#final">Final notes</a></li>
    </ul>
  </li>
</ul>

<h2 id="intro">Introduction</h2>

<p>
Every once in a while, someone asks about my interests. I usually just say
I&#39;m into home computers from the 1980s and, since most people are very nice
and polite, they then ask what I do with them. I usually say something about
competing in computer graphics at &#34;digital art festivals,&#34;
because explaining what
<a href="https://en.wikipedia.org/wiki/Demoscene">the scene</a> and a
<a href="https://www.youtube.com/watch?v=8Xq0fgfXgq8">demo party</a> is
can be somewhat tricky. That&#39;s usually when they stop asking questions.
Nevertheless, I am the boss of my own home page,
and I&#39;ve decided to detail how I spent my spare time during a few weeks before
easter this year.
</p>

<p>
Because of COVID, (almost) all demo parties have moved online until
further notice.
It&#39;s a bit boring, but it&#39;s better than nothing. The German party
<a href="https://2021.revision-party.net/start">Revision</a> is currently
the biggest of its kind in the world and I decided to make an entry
for the Amiga intro compo.
</p>

<h3 id="pres">Istari - Space Swap</h3>
<p>
<img src="https://datagubbe.se/mkdem/edpic/scr1.png" alt="A screenshot of the intro running"/>
</p>
<p><i>A screenshot from the running intro,
complete with a visit from Miss Spellings.</i></p>

<p>
Let&#39;s start off at the end and consider the final product of
my efforts: <a href="https://youtu.be/AyANMEo8vXU?t=23">It&#39;s available
on Youtube</a> or, if you have an Amiga or an emulator,
<a href="https://datagubbe.se/releases/spaceswap.crank">as a single executable file</a>
and <a href="https://datagubbe.se/releases/IstariSpaceSwap.adf">an ADF disk image</a>.
For Youtube watchers not using the link above but a tool such
as youtube-dl, feel free to skip 23 seconds into the video. The long
wait in the beginning is the decrunch, but more on that
<a href="#crunch">later</a>.
</p>

<p>
The target platform is an Amiga 500 with 1 megabyte of memory, a 7 MHz
68000 CPU and Commodore&#39;s custom chipset for graphics and sound.
The production (as we sceners pompously like to call our programs)
is an <i>intro</i>, which is a term used for non-interactive audiovisual
programs with small file sizes. The file size limit in this particular
competition was 64 kilobytes.
</p>

<p>
I decided to make what&#39;s known as a <i>one screener</i> - a production
that doesn&#39;t alternate between various full screen visual effects, instead
keeping the same screen layout during its entire runtime.
It&#39;s certainly not a technical marvel or big league production, but
I had fun making it and ended up on place 7 (out of 11 entries) in
the competition, which means it ranked first among the one-screener
entries. I&#39;m very happy about that.
</p><p>
For those who wonder, <b>Istari</b> is the name of a (mostly inactive)
demo group I&#39;ve been a member of since 1996. The name is of course from
<a href="https://en.wikipedia.org/wiki/Wizards_(Middle-earth)">Tolkien&#39;s</a>
lore: there were five of us and we at least aspired to become
computer wizards, so it seemed fitting. We organized a couple of small
demo parties in the late 1990s.
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/poly4.jpg" alt="Three massive nerds sitting in front of an Amiga 1200 computer"/>
</p>
<p>
<i>A photo from a demo party organized by Istari. Ahh, to be young again,
and so on.</i>
</p>

<h3 id="deconstruct">Breaking it down</h3>
<p>
The screen layout consists of three main parts: A logo at the top,
a background image and a box with a <i>text writer</i> in the middle
of the screen. The logo is presented using a classic <i>logo melt</i>
effect, meaning it seems to be poured or &#34;melted&#34; into position from the
top of the screen. The logo changes colour before each new &#34;melt&#34;.
There are also several animations: a spaceship
below the logo, the alien&#39;s blinking eyes and, occasionally, either
a confused groundhog emerging from a hole in the ground,
or a small volcano eruption. All the animations are made using sprites.
</p>

<h2 id="makeit">Making it</h2>

<p>
A lot of people who make Amiga demos and programs work on a modern
PC, using cross-compilers, emulators, drawing tablets and Photoshop. I&#39;m
far more stupid and stubborn: I prefer working on an actual Amiga,
with a CRT screen and all. I suppose it&#39;s like people who enjoy
listening to vinyl records or driving vintage cars:
<i>It&#39;s the feeling, man!</i>
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/amy2.jpg" alt="An Amiga 1200 connected to a 14 inch CRT screen"/>
</p>
<p><i>Can you smell the warm plastic? Can you see
the 50 Hz flicker? &#39;Tis truly the way to live!</i></p>

<p>
My main workhorse Amiga is an A1200 with a 14 MHz 68020 CPU and
of 6 megabytes of RAM. It&#39;s more than fast enough to run all the applications
I use and multitask between them.
</p>

<h3 id="jargon">Jargon buster</h3>
<p>
I&#39;m going to use a few terms in the text below that might require
some explanation. Here goes:
</p>

<dl>
<dt>Screens</dt>
<dd>
On the Amiga, a screen is the name for the base area on which the computer can
draw graphics. A program can open several different screens at
once, each of them in different resolutions and colour depths. Screens can
be of arbitrary size and they can be displayed simultaneously by overlapping,
so that part of underlying screens can be visible behind the topmost
screen. This means that you can for example show a 320*20 pixel, 32 colour
screen in &#34;low resolution&#34; (I.E. with square pixels) above a 640*256 pixel,
16 colour screen in &#34;high resolution&#34; (I.E. with pixels twice as high as they
are wide) at the same time. The maximum colour depth on an Amiga 500 is 5 bits,
which means a palette with 32 colours.
</dd>

<dt>Copper</dt>
<dd>
The copper (short for co-processor) is a custom graphics processor in the
Amiga. It is responsible for setting up and handling screens. The copper
can be used to change the value of a given palette index once or several times
per raster line. Doing so results in what&#39;s called a copper gradient. In
effect, this means that a 320*256 screen with a 1-bit (2 colour) depth can
be made to display a gradient with several hundreds different colour values.
</dd>

<dt>Blitter</dt>
<dd>
A bit-blit, or bit-block transfer, is a method of using specialized hardware
to quickly copy large chunks of memory around and apply various rules for
the copy, to achieve things like background transparency. The Amiga has such
a piece of hardware, which is very useful for copying the whole or part of
a screen to a different position on the same screen, or to a completely
different screen. It can also be used to quickly draw E.G. filled boxes.
</dd>

<dt>Sprite multiplexing</dt>
<dd>
On the Amiga, a sprite is a hardware controlled piece of graphics that&#39;s
drawn independently of the underlying screen, which means a sprite can move
between two overlapping screens. The mouse pointer on the Amiga is a sprite.
The Amiga can draw up to 8 hardware sprites simultaneously. They can be
at most 16 pixels wide, but have unlimited height. Each sprite can use up
to three colours (plus one transparent colour). By employing various
programming tricks, one can both display more than eight sprites at the same
time and combine several sprites into one, to achieve greater pixel width
and more colours. This is called sprite multiplexing.
</dd>
</dl>

<h3 id="gfx">The Graphics</h3>
<p>
What I really enjoy doing on Amiga computers is
<a href="https://datagubbe.se/pixels/">pixel graphics</a>. For this, I use my trusty original
copy of Deluxe Paint IV (affectionately DPaint), published by Electronic
Arts in 1991. The overall vibe I was going for in Space Swap is that of
similar one-screener intros from 1993 and 1994. They all had very
particular design aesthetics with lots of vivid pastels, cutesy graphics,
playful fonts and a generally cheerful mood. Perfect for brightening the
gloomy times of pandemic lockdowns!
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/demtro_dpaint.png" alt="Screenshot of Deluxe Paint IV"/>
</p>

<p>
Above, we can see a screenshot of Deluxe Paint IV. Along the top edge of 
the screen is the menu bar, with pull-down menus giving access to many 
of the program&#39;s advanced features. Along the right edge of the screen 
is the toolbar and palette, where the user can select various brushes, 
painting modes and tools. The palette displays all the available
colours for the current image and lets the user pick the current fore- and
background values. The 
screenshot is depicting the magnify mode, in which a smaller part of the 
picture is shown at lower resolution on the right part of the screen, 
and the magnified area is kept visible for reference on the left part of 
the screen. Most pixel graphicians (including myself) spend inordinate 
amounts of time in the magnify mode, since nearly all dithering and 
anti-aliasing is done manually.
</p>

<p>
As you can see above, the background and logo use a 32 colour palette.
The screen mode is 320*256 pixels in the &#34;lowres&#34; mode, which gives
square pixels.
</p>

<h4 id="logo">The logo</h4>
<p>
The Istari logo was made by simply typing &#34;istari&#34; in my own custom
font (more on that <a href="#font">later</a>), scaling it to a higher
resolution, smoothing
the edges by hand and then rotating it using the Perspective tool in
Deluxe Paint. Some depth was added by manually extruding it along the
z-axis. A gradient fill was applied to it and then it was just a matter
of getting busy with manual anti-aliasing. Below is the logo in varying
stages during work.
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/logoexamp.png" alt="Work stages of the Istari logo."/>
</p>

<h4 id="bakg">The background</h4>

<p>
The background image mostly consists of a starry sky. The gradient from
dark to light is a simple line-based one, to avoid the cluttered feeling
an overly dithered image can convey. The stars vary between being a single
pixel to somewhat more complex, employing anti-aliasing to achieve a small
halo. The alien (named Jeff), the mountains and the little &#34;Space Swap&#34; logo
were drawn using the freehand tool in DPaint. The moon outline was made
using the circle tool. All of this was then filled, shaded, dithered and
anti-aliased by hand.
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/spejsy10d_rain.png" alt="The main background image of the intro features a starry sky, a cute space alien and some volcanic mountains."/>
</p>

<p>
The bright yellow field in the bottom of the sky and the bright blue
lava in the volcano and some of the stars are colours that will be changed
in the final program. I find it easier to give those a
contrasting value when working in DPaint, because it makes them easier to
spot.
</p>
<p>
The yellow part of the sky will use a <i>copper gradient</i>. That&#39;s
the reason why the mountains aren&#39;t anti-aliased there - partly because
it&#39;s really hard to anti-alias against a colour you can&#39;t see and partly
because there wasn&#39;t any suitable colour values left to anti-alias with.
</p>
<p>
The bright blue lava and stars will have a flashing colour effect,
fading continuously between nearly black and a bright, purplish red.
</p>

<h4 id="anims">The animations</h4>
<p>
Originally, I had just planned for the spaceship sprite. That felt
a bit boring, so I decided to add a little space groundhog that could appear
randomly across the screen from a moveable hole in the ground. This
cheered things up a whole lot, which made me add a small volcano eruption
as well. Then, as the deadline drew closer, I thought Jeff looked a bit
dull and decided to make his eyes blink - out of sync with each other, of
course, because that&#39;s just how it works when you&#39;re a three-eyed space
alien.
</p>

<p>
All of the animations were also drawn in DPaint, utilizing the animation
mode. This is a very advanced feature that lets you add, insert and remove
frames at will, jump back and forth between them and also enable a light
table mode. Once I was satisfied with an animation, I copied each frame
to a grid in a still image to prepare for their use as sprites.
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/murvolceye.png" alt="Animation frames for the various sprites"/>
</p>
<p><i>Animation frames for the groundhog,
volcano eruption and Jeff&#39;s blinking eyes</i></p>

<h3 id="music">The music</h3>
<p>
The sad truth is I lack any kind
of musicality whatsoever. Lucky for me, there&#39;s a large number of compositions
in the Amiga
<a href="https://en.wikipedia.org/wiki/MOD_(file_format)">MOD format</a>
that are free to use if the author is credited. I opted for
<a href="https://www.exotica.org.uk/mediawiki/index.php?title=Special%3AModland&amp;md=search&amp;mod=hot+fever+chip&amp;aut=grim&amp;for=&amp;col=&amp;ins=">Hot Fever</a>
by Grim of Digital, a funky little chiptune classic I thought fit very
well with the overall mood of the intro.
</p>

<h3 id="font">The font</h3>
<p>
Since there&#39;s a text writer in the intro, I needed a font for the text.
I&#39;ve been working on and off on one I&#39;ve decided to call Istarfont.
I use a program called FEd (Font EDitor) that Commodore shipped with
AmigaOS 1.3, but for some reason left out of later releases.
The font is quite complete - it lacks some
diacritics and other special characters, but other than that it should be
fine for most scrolltext writing. Feel free to use it with credits:
<a href="https://datagubbe.se/mkdem/istarfont.lha">Click here to download it as an LhA archive</a>.

</p><p>
<img src="https://datagubbe.se/mkdem/edpic/demtro_fed.png" alt="The Amiga font editor, showing the glyph for the letter K being edited."/>
</p>

<p>
To use the font in the intro, I had to type all the characters
I wanted to write with onto an image file using DPaint.
When doing so, I also added a dropshadow to it.
</p>

<h3 id="code">Putting it all together</h3>
<p>
Cool guys code their scene productions in assembler. Nowadays mostly because
you can&#39;t beat assembler for speed, but in the old days the prevailing idea
was that programming was supposed to be hard and if you didn&#39;t do things
the hard way, you didn&#39;t belong on the scene. As luck would have it, I&#39;ve
never been a cool guy, so these days I can safely use Amos Professional.
</p>

<h4 id="amos">Almost Professional</h4>

<p>
<img src="https://datagubbe.se/mkdem/edpic/amed.png" alt="The Amos Professional code editor"/>
</p>
<p><i>The Amos Professional code editor.</i></p>

<p>
Amos (or more properly AMOS) is an Amiga version of a BASIC dialect originally
released for the Atari ST, called STOS. Amos Professional is the last and
greatest version of it, containing so many nifty abstractions for working
with the Amiga hardware it feels more like scripting in a modern multimedia
package rather than doing actual programming work. Want to load and display
an IFF image file? Just <b>Load Iff</b>! Want to load and play some music?
<b>Track Load</b> and <b>Track Play</b>, baby! It also has easy to use
functions for sprite multiplexing, working with double buffered screens,
performing blits, manipulating palette values and creating copper gradients.
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/amdir.png" alt="The Amos Professional direct mode"/>
</p>
<p><i>The Amos Professional REPL, called Direct Mode.</i></p>

<p>
Apart from providing great abstractions for the Amiga hardware, Amos
Professional was a very modern and forward-looking piece of software
when it was released in 1992. It features a syntax-sensitive editor
with MDI, code folding (of procedures) and context-sensitive hypertext help.
It also features a REPL of sorts, a visual debugger and several tools
for creating, editing and managing graphics and audio.
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/ammon.png" alt="The Amos Professional monitor"/>
</p>
<p><i>The Amos Professional debugger, called Monitor.</i></p>


<h4 id="melt">The logo melt and palette change</h4>
<p>
The logo melt is a classic effect in Amiga intros. While it can be made
using the copper, working with the copper is often quite a hassle in Amos.
I instead chose to use the blitter. The logo is actually displayed on a
smaller screen positioned on top of the screen containing the main
background image. I then copy a single line of the logo image to all the
remaining lines above it, which creates the feeling of the logo being
&#34;poured&#34; from the top of the screen into an invisible mold.
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/melt.png" alt="Still image of the logo melt effect"/>
</p>

<p>
Since the logo is displayed on its own screen, the logo palette can
also be changed without affecting the underlying background. Before
each new &#34;melt&#34;, the palette is alternated between pink, green, blue
and gold hues.
</p>

<h4 id="writer">The text writer</h4>
<p>
The text box is drawn at the start of the intro using the blitter.
The flashing frame around it is a single colour in the indexed palette
being faded between different values. This flashing is also used for
the lava in the volcano and some of the stars in the sky. The text
itself is colourized using a rainbow gradient created using the copper.
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/demtro_fonto.png" alt="The font with added dropshadow and numbered markings for character counting"/>
</p>
<p><i>A rare insight into the mind of a deranged madman: Counting
characters by hand in an image file in order to translate them to
their corresponding ASCII values. But don&#39;t judge me too hard -
what are <b>you</b> usually doing at 3 AM on Saturday mornings?</i></p>

<p>
All the text is stored as strings in arrays. Amos does have support
for data statements, but it also works very well with arrays and I 
use them for lots of things such as palette values and sprite frame
identifiers. Each character has been programmatically cut out of the
font image described above and stored in memory using an Amos abstraction
called &#34;banks&#34;. The blitter is then used to paste those
characters onto the main background, and to clear the text box before
starting over on the next screen of text.
</p>

<h4 id="codebakg">The background</h4>
<p>
The background is mostly a simple matter of using Amos&#39; built-in
functions for loading, packing, storing and then displaying an image.
The bottom part of the sky is colourized using a copper gradient to
give it that final bit of oomph. Together with the changing logo palettes
and the rainbow gradient used in the text writer, the total number of
colours on screen at any given time is somewhere between 60 and 80 unique
values. Not bad considering it&#39;s just 5 bits deep. Only Amiga makes
it possible!
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/demtro_wrongpal.png" alt="The main background displayed with strange colours."/>
</p>
<p><i>This is what the background image would look like
if the logo hadn&#39;t been displayed on its own screen and the gold logo palette
was applied.</i></p>

<h4 id="codeanim">The animations</h4>
<p>
Just like with the text writer font, each frame of animation has been
programmatically cut out of a larger image and stored in an Amos memory
bank. They are displayed on screen using Amos&#39; built-in sprite multiplexer
and most of the main program code consists of checking the values of
various timers and flags to decide what sprite to display where and
which frame of animation it should contain.
</p>

<h4 id="tweak">Tweaking and testing</h4>
<p>
During development, it&#39;s important to test the code regularly. An executable
file is produced using the Amos Professional Compiler.
The executable is then transferred
onto a floppy disk for testing on my Amiga 500, and onto a compact flash card
for testing in an Amiga emulator on my Linux PC. In this process, new
ideas emerge and old ones are scrapped or refined. The number of animated
sprites grew drastically during the last week of development, for example.
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/swfail.jpg" alt="A photo of a severe software failure dialog taken during a test run of the unfinished intro."/>
</p>
<p><i>Well, crap.</i></p>

<h4 id="crunch">Crunching</h4>
<p>
Once I was satisfied with the intro, it had to be crunched to
meet the compo size limit. A crunched file is basically the demoscene term for
a self-extracting, executable archive. If my intro had been written in
assembler, it probably wouldn&#39;t
have needed much crunching at all, but Amos embeds its support library into
the executable and the programmer can&#39;t exclude unused parts of it.
In other words, the file size was drastically larger than the permitted 64
kilobytes. This crunching was the only thing I actually did completely
on my Linux PC: the Amiga would&#39;ve been far too slow.
</p>
<p>
On the Amiga scene, there are three commonly used crunchers that
produce executable files. They&#39;re all asymmetrical, meaning the crunching
of the file is much slower than the decrunching. There&#39;s
Titanics Cruncher by Titanics, which is old and a bit buggy;
<a href="https://github.com/askeksa/Shrinkler">Shrinkler</a> by Blueberry,
which is very good at compression but aimed at small intros
(4 kilobytes or less) and thus rather slow at decompression; and
<a href="https://www.pouet.net/prod.php?which=68044">Cranker</a> by Bifat,
which offers a good compromise between speed and size.
</p>
<p>
I first tried to crunch the intro using Cranker, but to my chagrin it
ended up roughly 10 kilobytes too large. My only
option seemed to be Shrinkler, which met the size limit but decompressed
very slowly. To make the wait a little less dull for the user, I added
a small text to be displayed during the decrunching. I opted for a slight
rewrite of the famous
<a href="https://en.wikipedia.org/wiki/Trainspotting_(film)">Trainspotting</a>
monologue about choosing life:
</p>

<blockquote>
Choose scene. Choose a platform. Choose coding, pixeling or composing.
Choose a fucking big television, choose disk drives, hard drives, CD-ROMs
and three button mice. Choose bad health, high cholesterol and bleary eyes.
</blockquote>

<h4 id="rel">Releasing</h4>
<p>
With all of this in place, it was now just a simple matter of putting
the final executable onto a bootable floppy, creating an ADF image file
of that and submitting it to the Revision compo system.
</p>

<p>
<img src="https://datagubbe.se/mkdem/edpic/beerdem.jpg" alt="My hand holding up a can of beer, saluting the intro being displayed on the Revision compo stream."/>
</p>
<p><i>There it is, live in the compo!</i></p>

<h4 id="source">Special sauce</h4>
<p>
The source code, then? It&#39;s a mess. I&#39;m not just saying that to be
humble, it&#39;s truly terrible. That&#39;s what you get for cowboy coding
flags and conditions for sprite animations right up until the last
minute. I can&#39;t be bothered to clean it up, but I have added a few
comments to explain roughly what the heck is going on. If you know
how to program, feel free to point and laugh. If you don&#39;t, please
promise me you won&#39;t use this as a reference for learning.
<a href="https://datagubbe.se/mkdem/code.txt">Click here at your own peril!</a>
</p>

<h3 id="final">Final notes</h3>
<p>
As stated above, this is hardly a technical breakthrough. I&#39;m not an
assembler hacker with amazing skills for taming the custom chips and
making them do seemingly impossible things. What I enjoy is the poking
about with pixels, animations and colours and I got to do that in spades
with Space Swap. I&#39;m quite pleased with the end result and even
more pleased with all the fun I had making it!
</p>


</div></div>
  </body>
</html>
