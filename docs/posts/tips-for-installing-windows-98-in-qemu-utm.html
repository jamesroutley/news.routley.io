<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sporks.space/2025/08/28/tips-for-installing-windows-98-in-qemu-utm/">Original</a>
    <h1>Tips for installing Windows 98 in QEMU/UTM</h1>
    
    <div id="readability-page-1" class="page"><article id="post-1469">
	<!-- .entry-header -->

	
		<div>
			
<p>Windows 98 runs surprisingly well in QEMU via <a href="https://apps.apple.com/us/app/utm-se-retro-pc-emulator/id1564628856">UTM SE,</a> but it requires some care in setting it up. It’s a great way to run old 90s Windows and DOS software on your iPad (and Mac too, though you have other options available to you, or an iPhone if you don’t mind the HID difficulties).</p>



<p>This post provides some suggestions and tips for installing Windows and selecting the best emulated devices. The guidance is intended for UTM users on Apple platforms, but should apply to anything QEMU based (or QEMU itself). The advice might also be useful for other operating systems in UTM/QEMU as well.</p>



<figure><img fetchpriority="high" decoding="async" width="1024" height="768" src="https://sporksspace.b-cdn.net/wp-content/uploads/2025/08/IMG_0061-1024x768.jpeg" alt="Windows 95 on UTM SE on an iPad Pro with Magic Keyboard. Note you&#39;re better off using Windows 98, but this does work as well." srcset="https://sporksspace.b-cdn.net/wp-content/uploads/2025/08/IMG_0061-1024x768.jpeg 1024w, https://sporksspace.b-cdn.net/wp-content/uploads/2025/08/IMG_0061-300x225.jpeg 300w, https://sporksspace.b-cdn.net/wp-content/uploads/2025/08/IMG_0061-768x576.jpeg 768w, https://sporksspace.b-cdn.net/wp-content/uploads/2025/08/IMG_0061-1536x1152.jpeg 1536w, https://sporksspace.b-cdn.net/wp-content/uploads/2025/08/IMG_0061-2048x1536.jpeg 2048w, https://sporksspace.b-cdn.net/wp-content/uploads/2025/08/IMG_0061-480x360.jpeg 480w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<h2>Plug and play BIOS issues (or: how to install with ACPI)</h2>



<p>When you install Windows 9x, PCI devices might be broken, and you’ll see a Plug and Play BIOS device with problems in the device manager:</p>



<figure><img decoding="async" width="410" height="448" src="https://sporksspace.b-cdn.net/wp-content/uploads/2025/08/image.png" alt="A broken Plug and Play BIOS device in Device Manager." srcset="https://sporksspace.b-cdn.net/wp-content/uploads/2025/08/image.png 410w, https://sporksspace.b-cdn.net/wp-content/uploads/2025/08/image-275x300.png 275w, https://sporksspace.b-cdn.net/wp-content/uploads/2025/08/image-329x360.png 329w" sizes="(max-width: 410px) 100vw, 410px"/></figure>



<p>This seems to be a bug in SeaBIOS or QEMU; I haven’t yet seen an issue tracking this. Many guides (i.e. <a href="https://computernewb.com/wiki/Install_QEMU_Tablet_Driver_on_Windows_98">this one</a> or <a href="https://github.com/JHRobotics/softgpu/blob/main/qemu.md">this one</a>) suggest changing the device and hoping devices re-enumerate correctly. However, there’s a simpler method available when using Windows 98 SE. (If you’re using Windows 95, you won’t be able to do this.)</p>



<p>Windows 98 can use ACPI to enumerate devices instead of the legacy PnP BIOS. Unfortunately, it doesn’t use ACPI by default. (There seems to be an allowlist of known good ACPI BIOSes, as it was early days for ACPI.) To make it use ACPI anyways, boot with CD-ROM support from the Windows 98 CD instead of running the installer, then run Windows setup with the <code>/p j</code> flag, like so:</p>



<pre><code>C:\&gt; D:
D:\&gt; cd WIN98
D:\WIN98&gt; setup /p j</code></pre>



<p>It’s possible to <a href="http://facsimiliter.com/Windows98/AdvConfigPwrInterface,HelpWithWindows.htm">convert an existing system to ACPI</a>, but it’s much easier to do this from the start. When Windows is installed this way, it should correctly enumerate all devices.</p>



<h2>Device selection</h2>



<h3>System</h3>



<p>QEMU can emulate devices Windows 98 supports out of the box, which is good as there are no VirtIO drivers. Make sure you’re using the i440-based “<code>pc</code>” rather than the Q35 based system, as it’ll be better supported for legacy systems. You don’t need to worry about selecting i386 vs. x86_64, as Windows 98 will obviously never touch 64-bit mode, so they’ll be the same.</p>



<p>(As a tip, if you’re running NT 4, you’ll need to select a different CPU to make sure it’s happy with the CPU flags as the default one is too new. A Pentium II should be sufficiently old.)</p>



<h3>Input</h3>



<p>You may need to disable USB (or at least, USB input devices) to avoid hanging on startup, at least with UTM (It’s possible the ‘Force PS/2 Controller’ option might work, but I haven’t had much luck with it. Unfortunately, this means you won’t have absolute mouse input (through the USB tablet) and must capture your cursor. With UTM SE on an iPad, this doesn’t hurt as much, as it can automatically capture the trackpad or external mouse, while leaving the touchscreen for interacting with iOS.</p>



<h3>Video</h3>



<p>The most sensible video option for Windows 98 is the Cirrus VGA (<code>-vga cirrus</code>). There are unfortunately some bugs (flashing in 16 bit colour modes, blitting issues in 8 bit colour modes), but it’s the only option with accelerated drivers out of the box. (Of course, there is no 3D acceleration with such a card.)</p>



<p>Apparently, Rage 128 emulation is being worked on (<code>ati-vga</code>), but currently only works for Power Mac emulation, and is in rough shape so far.</p>



<h3>Networking and getting files in</h3>



<p>For getting files into the VM easily, you’ll want a network. SLiRP NAT works fine for using a browser or SMB shares, for example. (Note this works better on Windows 98 than 95; 95 has issues with mounting SMB shares by IP and doesn’t come with a browser.) QEMU can emulate a variety of network cards. The tulip (DC2114x), NE2000 (PCI and ISA), and PCNet should all work out of the box with older Windows. I’d recommend using a PCI card if possible, since it saves you the ISA setup headache unless you need it for something old. If you do need to set up an ISA NE2000, it’s at address 300h, IRQ 9, which might require manual configuration in some cases.</p>



<h3>Sound</h3>



<p>For sound hardware, there are a few options available, with different tradeoffs.</p>



<ul>
<li>If you want to run DOS software, the SoundBlaster 16 (<code>sb16</code>) emulation works out of the box, but there is no OPL3 or MPU-401, so MIDI won’t work correctly, just PCM. Games will have a hard time with this unless they’re entirely PCM. For <a href="https://virtuallyfun.com/2011/10/28/soundblaster-16-settings-for-virtualpc-qemu/">setting up your SB16 for DOS games</a>, use <code>SET BLASTER=A220 I5 D1 H5 P330 T5</code> (that’s address 220h, interrupt 5, 8-bit DMA 1, our non-existent MPU-401 at 330h, 16-bit DMA 5).
<ul>
<li>Note that QEMU supports adding an AdLib (OPL2 based) separately, which might help with some software.</li>
</ul>
</li>



<li>The CS4321A I haven’t tested, but might work with WSS or Crystal-specific drivers. As with the SoundBlaster 16, there is no OPL3. QEMU sets this up at 534h, IRQ 9, DMA 3.</li>



<li>The Gravis UltraSound (<code>gus</code>) emulation works <a href="https://virtuallyfun.com/2013/10/29/gravis-ultrasound-under-qemu/">surprisingly well</a>, but the Windows 95 drivers are crusty for the version of the card it emulates (GF1/GUS Classic), so use it only if you want to run old trackers or demoscene stuff. Note you may need to turn off the LPT port (<code>-parallel none</code>) to free up an interrupt used for the UltraSound.</li>



<li>Because of this, the ES1370 might be the best card to emulate for plain Windows usage, as it has relatively few quirks and I believe has drivers on the Windows 98 CD. However, it’s not ideal for DOS software as it requires TSRs to make it work right.</li>



<li>The AC97 emulation will require Realtek drivers. I haven’t tested this.</li>
</ul>



<h3>Potpourri</h3>



<p>In UTM, you may want to turn off the entropy device, to reduce unknown device clutter in Device Manager, though it’s harmless. The VirtIO console device will still be present in Device Manager with UTM’s default flags.</p>



<h2>Other quirks</h2>



<p>In UTM SE, sometimes rebooting might hang when switching video modes. If this happens, it seems safe to shut down the machine and start it again. Avoiding reboots in favour of shutting down seems wise.</p>



<h2>Performance characteristics</h2>



<p>While TCG in QEMU doesn’t have the best reputation for performance, it might be good enough for your needs. On my MacBook Pro with an M1 Pro, benchmarks show performance somewhat around about a 750 MHz Pentium III, albeit with worse floating point performance. This is pretty usable, although most 3D games won’t be usable as even software rendering will be a bit sketchy.</p>



<p>If you’re using UTM SE on iOS, the interpreter is slower, but not unusable for 90s software. On my M1 iPad Pro, I get Pentium 100 performance, with similar penalties for FP. This is good for games up to about 1995 or 1996; titles like MechWarrior 2, Widget Workshop, many edutainment titles, and SimCity 2000 are playable this way, though MIDI or CD music will be missing. Non-game software like Office 97 or Visual C++ will run fine, of course. For OSes, this also puts things like Windows 2000 and beyond just out of reach performance wise – stick with Windows 98 for the best compatibility.</p>
					</div><!-- .entry-content -->

	
	<!-- .entry-footer -->
</article></div>
  </body>
</html>
