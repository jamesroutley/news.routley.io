<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rachelbythebay.com/w/2023/10/16/env/">Original</a>
    <h1>getaddrinfo() on glibc calls getenv(), oh boy</h1>
    
    
<p>
There are more than a few bear traps in the larger Unix environment that 
continue to catch people off-guard.  One of the perennial favorites is 
thread safety, particularly as it applies to the environment 
manipulation functions under glibc.  The usual warning is that if you 
run multiple threads, you&#39;d best not call setenv, because if someone 
else calls getenv, you run a decent chance of segfaulting.
</p>
<p>
The
<a href="https://rachelbythebay.com/w/2017/01/30/env/">last time</a>
I talked about this was 2017 and I said something goofy like &#34;see you 
in 2022&#34; at the bottom.  Well, it&#39;s a little late, but it&#39;s come up 
again, and this time it&#39;s biting people who aren&#39;t even using C or C++!  
</p>
<p>
<a href="https://github.com/golang/go/issues/63567">This one is in Go!</a>
</p>
<p>
Last time, I said that sometimes people run afoul of this by using 
mktime() which calls getenv()... and then sometimes pick *that* up by 
using libzip.  Here, it&#39;s a little different.  getaddrinfo() calls 
getenv().  Did you know that?  Before a few minutes ago, I sure didn&#39;t!
Check out the resolv.conf (5) man page - it looks at LOCALDOMAIN and 
RES_OPTIONS.
</p>
<p>
getaddrinfo() is pretty much required if you want to connect to anything 
beyond mere legacy IPv4 gunk, so it&#39;s not like you can avoid it.  You&#39;re 
probably going to call it quite often if you are opening connections 
over the IPv6 Internet.
</p>
<p>
If you&#39;re on Linux, and you&#39;re using glibc, you&#39;re probably a passenger 
on this boat.  Try not to drill any more holes.
</p>
<p>
Thanks to Evan for the tip on this one (and good luck with the fix).
</p>

  </body>
</html>
