<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/linux/SwapPartitionsNoMore">Original</a>
    <h1>We&#39;re moving away from swap partitions on our Linux servers</h1>
    
    <div id="readability-page-1" class="page"><div><h2>We&#39;re moving away from swap partitions on our Linux servers</h2>

	<p><small>October 13, 2022</small></p>
</div><div><p><a href="https://support.cs.toronto.edu/">We</a> have a reasonable number of
Linux servers, almost all of them running various versions of Ubuntu.
Like pretty much everyone configuring Linux servers, we give them
some swap space; the Linux kernel traditionally is much happier if
it has a bit of swap space (<a href="https://utcc.utoronto.ca/~cks/space/blog/unix/NoSwapConsequence">cf</a>),
although <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/SwapSizingII">you don&#39;t want too much</a>. For
a long time we used a separate disk partition for this (or a mirrored
pair of them in a separate software RAID mirror device), although
Linux distributions themselves were increasingly moving to using
swap files located in the root filesystem (sometimes rather excessively
large ones; the Ubuntu 20.04 and 22.04 installers use 4 GB even for
machines with only 4 GB of RAM). We didn&#39;t have any particularly
strong reasons for using a swap partition instead of a swap file;
it was just what we&#39;d started out with and what we were used to.</p>

<p>(<a href="https://support.cs.toronto.edu/">We&#39;ve</a> been running various
flavours of Unix machines for <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/MachineRoomArchaeology">a very long time</a>, so we&#39;ve been setting up
swap partitions since before Linux had swap files at all, much less
when they were well regarded on software RAID.)</p>

<p>This time around, that&#39;s been changing in our Ubuntu 22.04 installs.
Again, it&#39;s not for any particular reason, it&#39;s mostly merely that
it&#39;s a bit more annoying work to set up an additional mirrored
partition for swap. Swap files appear to work fine, including on
a mirrored root filesystem, and I&#39;ve read that they&#39;re basically
just as efficient as swap partitions these days (I don&#39;t know if
this is true). Plus, adjusting the size of a swap file after you&#39;ve
finished installing a system is a lot easier than doing something
with a swap partition.</p>

<p>(If you&#39;re willing to use swap files anyway you can always add more
swap space with a swap file even if you started with a swap partition.
However, if your swap partition is too big, shrinking it or limiting
how much of it gets used is more annoying.)</p>

<p>I suspect that we&#39;re lagging well behind the adoption curve for
swap files over swap partitions, and that other places transitioned
years ago. Certainly I believe Ubuntu has been defaulting to swap
files since at least 20.04 LTS. We might have made the transition
then if we&#39;d built more 20.04 machines, but <a href="https://utcc.utoronto.ca/~cks/space/blog/linux/Ubuntu2004MaybeMostlySkipping">world events intervened
and we mostly skipped it</a> (it didn&#39;t
help that <a href="https://utcc.utoronto.ca/~cks/space/blog/linux/Ubuntu2004EximSkip">our Exim machines had no choice but to skip 20.04</a>).</p>

<p>PS: Fedora 36 defaults to <a href="https://fedoraproject.org/wiki/Changes/SwapOnZRAM">swap on ZRAM</a>, which is even
more of a radical change than Ubuntu moving to a swap file. <a href="https://utcc.utoronto.ca/~cks/space/blog/linux/ZramSwapSomeNumbers">Swap
on ZRAM hasn&#39;t exploded on my Fedora machines</a>,
but we&#39;d probably never use it on our Ubuntu servers for various
reasons.</p>

<p>PPS: My cynical side suspects that Ubuntu 22.04 defaults to using
a swap file partly because Canonical is increasingly focusing on
the cloud market, and I expect that in the cloud, configuring a
swap file is easier than a swap partition. Although I really don&#39;t
understand that 4 GB swap file size given the cloud; I would think
it&#39;d be far too big for typical cloud VM setups.</p>
</div></div>
  </body>
</html>
