<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://grifel.dev/decentralization/">Original</a>
    <h1>Self hosting in 2023</h1>
    
    <div id="readability-page-1" class="page"><header><nav><a href="https://payments.posthaven.com/"><img alt="Grifel logo - MW written by hand" src="https://payments.posthaven.com/assets/logo.svg" height="48" width="48"/><h2>Grifel</h2></a></nav></header><span>2023-02-18 ‚Ä¢ 8 min read</span><p>The blog that you are currently reading has a perfect <a href="https://pagespeed.web.dev/">PageSpeed</a> score <strong>100¬†/¬†100</strong>. At least at the moment of writing it üòÑ. It‚Äôs not a brag, quite the opposite. Turns out it‚Äôs not <strong>that</strong> hard to achieve it. Just <em>host a static page</em> with simple styles, and you‚Äôre done. Building a static page itself is quite simple. You plop an <code>index.html</code> and send it through a wire. You can get more sophisticated and generate it using a framework, like I‚Äôm doing with <a href="https://astro.build/">Astro</a>. But that‚Äôs not the point of this post.</p><p>The point is the <strong><em>hosting</em></strong> part of <em>hosting a static page</em>. And this page is hosted on my <a href="https://www.raspberrypi.com/products/raspberry-pi-4-model-b/">Raspberry PI 4b</a> at my house. Still doing great in terms of speed, costing close to nothing, and having endless possibilities for extending for free. In this blog post I‚Äôll share with you how easy it was to set up. And how great of a dev experience I think it provides.</p><h3 id="why">Why?</h3><p>I‚Äôve been using <a href="https://nextjs.org/">NextJS</a> for a while and hosting the apps built with it on AWS with custom express servers. One day I‚Äôve noticed that my servers are getting red-hot while doing almost nothing, and response times got huge. Long story short the library introduced a <a href="https://github.com/vercel/next.js/issues/42349">huge performance downgrade</a> that was not caught by existing tests. Why so? Because benchmarks were using only Vercel‚Äôs (creators of NextJS) ‚ÄúEdge‚Äù infrastructure. And the bug was happening everywhere but not there. That‚Äôs when it struck me. We need alternative independent hosting to ensure that the community does not get stuck with a single provider. And that‚Äôs when I‚Äôve decided to host my app on my own server.</p><p>So what do you need to host your own page? Well, a server, a way to deploy your page, and a domain.</p><h3 id="server">Server</h3><p>I‚Äôve already had an <em>ok</em> work from home setup:</p><ul><li>electricity (<em>duh</em>)</li><li>optical fiber internet (300 Mb) with backup LTE connection.</li><li>a cheap UPS to keep it running in case of power outage (which happened once in the past year, so it might be a bit overkill).</li></ul><p>In summary my dev setup is built in a way that it should allow me to work without interruption. What I was missing for a home server setup was well‚Ä¶ <strong>the server</strong>.</p><p>Inspired by <a href="https://www.youtube.com/channel/UCR-DXc1voovS8nhAvccRZhg">@JeffGeerling</a> and his videos about creating a Pi Cluster I bought myself a second hand <a href="https://www.raspberrypi.com/products/raspberry-pi-4-model-b/">Raspberry PI 4b 4GB</a> for around 60$. There are of course alternatives to it, but I‚Äôve had one of those running already for almost a year with literally 0 downtime. Not even once has it turned off or rebooted. I was using it as a <a href="https://pi-hole.net/">Pi Hole</a>. Turns out in 21st century you can even update it without downtime. 10 / 10. If you need a home server just get one.</p><figure><img alt="Raspberries" src="https://payments.posthaven.com/assets/raspberries.jpg" sizes="(max-width: 700px) 320px, 640px" srcset="/assets/raspberries_mobile.jpg 320w, /assets/raspberries.jpeg 640w"/><figcaption>My current Raspberry Server setup</figcaption></figure><h3 id="deployment">Deployment</h3><p>Now that I had my server, how to set it up to work with my app? I‚Äôve looked around how people usually do that and I quickly noticed that you need like 10 complicated time-consuming steps to run an app on metal. Nginx setup, Capistrano or similar tool for automating deployment (running new versions and shutting down old ones), SSL Certs (because no one uses http anymore), and if you want to Dockerize it, then Docker related <em>stuff</em> is required i.e. Kubernetes which itself is hyper-complicated. Soooooo I was screwed. I tried the kubernetes approach which was super uber complicated for a blog and I gave up. Similarly, the bare metal solution consisting of nginx with manual Let‚Äôs Encrypt cert setup was too much of a hassle. So I‚Äôve dropped the idea. A few months later I‚Äôve found <a href="https://coolify.io/">Coolify</a> while browsing reddit.</p><p>It was marketed as a simpler, more web focused version of <a href="https://caprover.com/">CapRover</a>, which itself is an Open Source alternative to <a href="https://www.heroku.com/">Heroku</a>. I come from a Ruby on Rails world so Heroku is GOAT for me (<em>until it gets extremely costly</em>). After I saw it I knew this is the way to do my home setup! Same evening I sat down to test it. It took around an hour to set everything up from the ground up:</p><ul><li>burning a fresh RPi OS system image using <code>rpi-imager</code> with ssh and Wi-Fi config onto the SD card</li><li>installing system updates</li><li>running Coolify install script</li><li>reboot</li><li>done</li></ul><p>After that I went to the <em>Coolify</em> dashboard and <strong>wow</strong>. It‚Äôs really like a quicker, simpler version of Heroku.</p><p>For a test project I‚Äôve decided to try and set up my blog on it which at the time was running on <a href="https://www.netlify.com/">Cloudflare Workers</a>. I‚Äôve picked the <em>Static Page</em> image, and with a few more clicks, plus a <code>git push</code> my app was deployed and running on my <em>Berry</em>. It took like 5 minutes, and was probably easier than deploying it to <em>Heroku</em>. After the experiment I‚Äôve decided to go further with the idea and expose the blog to the world.</p><figure><img alt="Coolify Dashboard" src="https://payments.posthaven.com/assets/raspberries.jpg" sizes="(max-width: 700px) 320px, 640px" srcset="/assets/coolify.webp 1300w"/><figcaption>Coolify Dashboard</figcaption></figure><h3 id="domain">Domain</h3><p>Excited, I‚Äôve bought a domain (<code>grifel.app</code>) on <a href="https://domains.google.com/">Google Domains</a>. I use it because they have all of the extensions like <em>app</em> and <em>dev</em>, don‚Äôt do much marketing BS, and provide a simple but fully featured admin panel.</p><p>So now it‚Äôs time to attach it to my local server and whoops. We‚Äôve got a problem. When assigning the domain to IP address I remembered that I don‚Äôt have a static IP address. I‚Äôve got a dynamic one like most households. <em>(For those unfamiliar with the concept of dynamic external IPs, a modem assigns me a new IP address every time it reboots, or my net disconnects.)</em></p><p>Thankfully I‚Äôve tackled this problem once already. In my childhood when I was hosting my own <a href="https://muonline.webzen.com/">MU Online</a> server I was lacking a static IP. And to get a server to the public I‚Äôve used <a href="https://vpn.net/">Hamachi</a>! It works like this: Every X seconds when your server is connected to internet it sends information about the IP you currently have to a DDNS (Dynamic DNS). Worst case worst, your IP changes, X seconds pass, your server informs DDNS, and it navigates the traffic to the new IP. It turns out that Google Domains even has this feature built in! I‚Äôve installed DDClient, which is the tool Google suggested in their docs, and configured it with my credentials. Whole process took around 10 minutes. I got info that it works by looking at the DDNS record in Google Domains admin panel. It was updated with my current IP.</p><p>I then went back to my Coolify panel and set the <a href="https://blog.grifel.app">https://blog.grifel.app</a> domain as FQDN in my app. Waited 30 seconds and voil√† my blog is reachable at that address. With https working. It‚Äôs like magic. 10 years ago this was the thing that made Heroku so great. Now you can have it in your own setup with a few clicks.</p><h3 id="conclusion">Conclusion</h3><figure><img alt="Coolify Dashboard" src="https://payments.posthaven.com/assets/raspberries.jpg" sizes="(max-width: 700px) 320px, 640px" srcset="/assets/pagespeed.webp 1056w"/><figcaption>Page Speed score still at 100</figcaption></figure><p>PageSpeed score is still <strong>100¬†/¬†100</strong>, so I guess my setup is fast enough and didn‚Äôt screw up my UX. My uptime is 100% for the last month which will obviously stop working at the worst point in time, and you‚Äôll have to live without my great blog for an hour, but I hope you‚Äôll survive. I‚Äôm hosting on a Raspberry PI 4b 4GB, so if anyone wants to DDOS me then I‚Äôm probably not going to live through that. The server is located in Warsaw, so I‚Äôm not on the <em>edge</em> right next to your house, but I guess it‚Äôs not a problem. My packets will need to travel through the whole world to get to you, but light is fast enough. At any point in time I can use a CDN to battle all those struggles though.</p><p>But for the cost of all those problems I have my own <em>Heroku‚Äôish</em> platform, automated deployment pipeline <strong>even feature branches are there</strong>. I can have a 100-person team working on this app, and not pay 5$ monthly for them to be able to access logs. I can directly contribute to it and extend it in any way I want. Would I host my future business on it? Probably not. I would still go with AWS or a similar solution just to avoid any problems that would screw it up in a way that I can‚Äôt even imagine, and they did. But honestly this experiment made me really think about it.</p><p>And if you‚Äôre interested in the operational cost of running this setup it is like 60$ for the RaspberryPi (one time cost) + electricity (less than 1$ a month) + 10$ a year for domain (which I needed anyway). So not more than like 2$ a month if you already have internet in your home.</p><div><p><img alt="Michal Warda" src="https://payments.posthaven.com/assets/avatar.webp"/></p><div><p>Personal blog by Michal Warda.</p></div></div></div>
  </body>
</html>
