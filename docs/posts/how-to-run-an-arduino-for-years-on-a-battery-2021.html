<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://makecademy.com/arduino-battery">Original</a>
    <h1>How to run an Arduino for years on a battery (2021)</h1>
    
    <div id="readability-page-1" class="page"><div><p><em>If you found this article after doing a search on Google, welcome! On this website you will find plenty of content around DIY home automation using open-source hardware. Enjoy the article!</em></p><p>For most of the Arduino tutorials you will find on this website, power is usually not an issue as the Arduino is powered by the USB cable coming from the computer. However, sometimes you want to build systems that are going to be autonomous and powered by a battery.</p><p>For example, you want to power a wireless motion detector just by using a set of batteries. The first idea would be to connect directly an Arduino board like the Arduino Uno R3 to a battery. Easy, right ? Well, it would work, but your battery would be depleted in a matter of days because some components like voltage regulators are always sucking power. So we need something better.</p><p>The first thing we need is to build our own Arduino system with just the minimal set of components. The second part is to optimise the software so that the system only consumes power when it is actually doing something. And that’s exactly what we will see in this article.</p><h3>Hardware &amp; Software Requirements</h3><p>You need several components to build you own Arduino system. The main piece of this project is of course the microcontroller that will run your Arduino sketches, like the <a href="https://www.amazon.com/ATMEGA328P-ATMEGA328P-PU-Microcontroller-Bootloader-Programable/dp/B07LH5SHC9?keywords=atmega328+with+bootloader&amp;qid=1648558355&amp;sprefix=ATmega328+bootloade%2Caps%2C236&amp;sr=8-7&amp;linkCode=ll1&amp;tag=openhomeautomation-20&amp;linkId=5d7bf88b29dcc610d0e97ebf3238a9b3&amp;language=en_US&amp;ref_=as_li_ss_tl">ATMega328</a>. You will need a chip with the Arduino bootloader. Buy your chip with it, it will make your life easier.</p><p>In a previous project I used a <a href="https://www.amazon.com/Micro-Basic-Breakout-Module-Arduino/dp/B00N4MCS1A?s=electronics&amp;ie=UTF8&amp;qid=1495102015&amp;sr=1-1&amp;keywords=FTDI+breakout+board&amp;linkCode=ll1&amp;tag=openhomeautomation-20&amp;linkId=e5f83d527bef3a145550238db560f96a&amp;language=en_US&amp;ref_=as_li_ss_tl">FTDI breakout board</a> to program the Arduino chip directly on the breadboard. But for this project I won’t have any external power running on the breadboard so I will just use an Arduino Uno board to program the microcontroller.</p><p>To power the Arduino, you will need a battery. The best is to power the Arduino directly from the battery, so you don’t have to use any voltage regulators that will suck some power. I used a <a href="https://www.amazon.com/dp/B0006SDBAM?&amp;linkCode=ll1&amp;tag=openhomeautomation-20&amp;linkId=da1b6751833565fd594e7f914a1b219c&amp;language=en_US&amp;ref_=as_li_ss_tl">set of two AA batteries</a> (1.5V each) with a <a href="https://www.amazon.com/dp/B008SNZQ0A?&amp;linkCode=ll1&amp;tag=openhomeautomation-20&amp;linkId=24ee4f91d63571a4151cf58042eec3a7&amp;language=en_US&amp;ref_=as_li_ss_tl">battery holder</a> thus powering the microcontroller with around 3V, which is fine according to the <a href="http://www.atmel.com/devices/atmega328.aspx">ATmega328 documentation</a>.</p><p>You will also need several components around the chip. You will need <a href="http://a-fwd.com/asin-com=B0052GNODM&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">one 10uF capacitor</a>, <a href="http://a-fwd.com/asin-com=B0087ZBK4K&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">two 22pF capacitors</a>, <a href="http://a-fwd.com/asin-com=B00B5RJF1M&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">one 10K Ohm resistor</a>, <a href="http://a-fwd.com/asin-com=B00B5LNEF6&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">one 220 Ohm resistor</a>, <a href="http://a-fwd.com/asin-com=B006G6TKQW&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">one green LED</a>, and one <a href="http://a-fwd.com/asin-com=B005MN8FPW&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">16MHz crystal clock</a>.</p><p>Finally, you will need a <a href="http://a-fwd.com/asin-com=B004RXKWDQ&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">breadboard and some jumper wires</a>.</p><p>This is the list of the components that were used in this article:</p><ul><li><a href="https://www.amazon.com/ATMEGA328P-ATMEGA328P-PU-Microcontroller-Bootloader-Programable/dp/B07LH5SHC9?keywords=atmega328+with+bootloader&amp;qid=1648558355&amp;sprefix=ATmega328+bootloade%2Caps%2C236&amp;sr=8-7&amp;linkCode=ll1&amp;tag=openhomeautomation-20&amp;linkId=5d7bf88b29dcc610d0e97ebf3238a9b3&amp;language=en_US&amp;ref_=as_li_ss_tl">Atmel ATmega328</a></li><li><a href="http://a-fwd.com/asin-com=B0052GNODM&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">10uF capacitor</a></li><li><a href="http://a-fwd.com/asin-com=B0087ZBK4K&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">Two 22pF capacitors</a></li><li><a href="http://a-fwd.com/asin-com=B00B5RJF1M&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">10K Ohm resistor</a></li><li><a href="http://a-fwd.com/asin-com=B00B5LNEF6&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">220 Ohm resistor</a></li><li><a href="http://a-fwd.com/asin-com=B006G6TKQW&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">One green LED</a></li><li><a href="http://a-fwd.com/asin-com=B005MN8FPW&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">16MHz crystal clock</a></li><li><a href="http://a-fwd.com/asin-com=B008SNZQ0A&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">Battery holder</a></li><li><a href="http://a-fwd.com/asin-com=B0006SDBAM&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">2 AA batteries</a></li><li><a href="http://a-fwd.com/asin-com=B004RXKWDQ&amp;com=openhomeautomation-20&amp;ca=openhomeauto-20&amp;uk=openhomeaut09-21&amp;de=openhomeauto-21&amp;fr=leblosed-21&amp;it=openhomeaut08-21&amp;es=openhomeau028-21&amp;sc=w" target="_blank">Breadboard and some jumper wires</a></li></ul><p>On the software side, you just need the usual Arduino IDE. Note that in this tutorial, we will only cover a tiny part of the possibilities offered by the Arduino platform.</p><h3>Hardware Configuration</h3><p>This project is a bit complex to build, so be sure to follow the instructions. This is how it should look like at the end:</p><p><img src="https://makecademy.com/cdn/files/624301e69d872a5c6d1b53f9.jpg"/><br/>
</p><p>First, put the microcontroller in the center of the breadboard. You can then take care about the power: connect power lines on each side, connect the negative power rail to the two GND pins of the microcontroller, and the positive power rail to VCC, AVCC, and AREF. Also, add the 10uF capacitor between two power rails. Finally, add the battery to the system.</p><p>You also have to add the crystal between the X1 and X2 pins, with 22pF capacitors going from each pin to the ground. Also, you need to connect the RST pin to the positive power rail using a 10K Ohm resistor. To see if the system is working, connect the green LED in series with a 220 Ohm resistor to the digital pin 13 of the Arduino board, the other side going to the ground.</p><p>This is the complete schematics of the project:</p><p><img src="https://makecademy.com/cdn/files/624301fa9d872a5c6d1b5424.jpg"/><br/>
</p><h3>Testing your Arduino system</h3><p>It’s now time to test if the hardware part is working. What I did in this project is to use the Arduino Uno board to program the chip, and then I just “transplanted” the chip on the breadboard. You can just use the default “blink” sketch to program the microcontroller. After this is done, just replace the chip on the breadboard, and plug your battery (my battery pack even has a nice on/off switch). The LED should just goes on and off every second as expected.</p><h3>Optimizing for Low-power</h3><p>So now, we have an autonomous Arduino system. But it still consuming way too much power. Indeed, even when the LED is off, the Arduino chip is still active and consumes power. But there are functions on the microcontroller to put it to sleep during the time it is inactive, and re-activate the chip when we need to change the state of an output or to perform some measurements. I tested many solutions to really reduce the power to the lowest value possible, and the best I found is the <a href="https://github.com/jcw/jeelib">JeeLib library</a>. You can just <a href="https://github.com/jcw/jeelib">download it</a> and install it by placing the folder in your Arduino/libraries/ folder.</p><p>This is the sketch I used:</p><pre><b>#include &lt;JeeLib.h;&gt;</b><br/>
</pre><pre><b>ISR(WDT_vect) { Sleepy::watchdogEvent(); }<br/>
</b></pre><pre><b>Sleepy::loseSomeTime(5000);<br/>
</b></pre><p>You basically just have to include the JeeLib library with:</p><pre><b>#include &lt;JeeLib.h;&gt;</b><br/>
</pre><p>Then initialize the watchdog with:</p><pre><span>ISR</span>(<span>WDT_vect</span>) { <span>Sleepy</span>::<span>watchdogEvent</span>(); }</pre><p>Finally, you can put the Arduino to sleep for a given period of time with:</p><pre>Sleepy::loseSomeTime(<span>5000</span>);</pre><p>Upload the sketch with the Arduino IDE and replace the chip on the breadboard. You should see your Arduino having the same behavior as before (with 5 seconds intervals). But the difference is that now when the LED is off, the Arduino chip doesn’t use a lot of power. To finish this article, I wanted to actually quantify the power consumption of the system we just built. You can do the exact same by placing a multimeter between one of the power lines. For example, I connected the positive pin of the battery to one pin of my multimeter, and the other pin to the positive power rail of the breadboard. Here are the results:</p><ul><li>LED off, without the JeeLib library: 6.7 mA</li><li>LED on, without the JeeLib library: 8.8 mA</li><li>LED off, with the JeeLib library: 43 uA (!)</li><li>LED on, with the JeeLib library: 2.2mA</li></ul><p>From these results, we can see that our breadboard-Arduino consumes 6.7 mA when doing nothing without caring about putting it to sleep. For information, that will drain your two batteries in about a month. Which is actually not so bad, but we can do better. With the sleep functions, this can be reduced to 43 uA, which is a 150x improvement.</p><p>Let’s do some calculations to see how it will impact a real project, for example a temperature sensor. It takes about 500 ms to perform a measurement, at about 2.5 mA of current. Then, the systems sleeps for 10 seconds and the loop starts again. The “mean” is then 0.16 mA over a complete loop. With batteries rated at 2500 mAh, it means in theory the system will last … nearly 2 years without changing the batteries! Of course, some other effects will actually modify this number, but it gives you an idea.</p><h3>How to Go Further</h3><p>Really, you can adapt this idea to every system where the active time is small compared to the sleep time, and make your Arduino last for years without changing the battery!</p></div></div>
  </body>
</html>
