<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://cedwards.xyz/tofu-do-you-check/">Original</a>
    <h1>TOFU: Do You Check?</h1>
    
    <div id="readability-page-1" class="page"><div>
            

            <div>
                <div>
                    <p>TOFU: Do You Check?</p>
                    <p>September 22, 2023</p>
                </div>
                <p>Let’s say you’re on a fresh machine. Maybe you’ve just started a new job or you’ve wiped your machine. You’re about to push some code you’ve written and you get this:</p>
<div><pre tabindex="0"><code data-lang="fallback"><span><span>$ git push
</span></span><span><span>The authenticity of host &#39;github.com (140.82.121.4)&#39; can&#39;t be established.
</span></span><span><span>ED25519 key fingerprint is SHA256:+DiY3wvvV6TuJJhbpZisF/zLDA0zPMSvHdkr4UvCOqU.
</span></span><span><span>This key is not known by any other names
</span></span><span><span>Are you sure you want to continue connecting (yes/no/[fingerprint])?
</span></span></code></pre></div><p>What do you do next? You type <code>yes</code> and hit enter. Like most of us do. How do you know you actually just pushed your code to <code>github.com</code>? I’d wager the vast majority of people don’t verify the fingerprint. I don’t, but I’m going to start.</p>
<h2 id="tofu">TOFU</h2>
<p>SSH operates on the principle of Trust On First Use. When you first connect to a server, you’re supposed to verify that the fingerprint matches what you expect. If it does, tuples of the host and its host keys are saved to <code>~/.ssh/known_hosts</code>. If the fingerprint for some reason ever changes, OpenSSH will show you a big MITM warning and refuse to connect.</p>
<h2 id="the-danger">The Danger</h2>
<p>If you don’t verify the fingerprint, your SSH communications can be intercepted. When it comes to <code>git</code>, this might enable an attacker to steal your code, although you would quickly notice something is amiss when your code doesn’t land on the remote and you get a warning later on when connecting to the real GitHub.</p>
<p>For server administration, verifying SSH fingerprints is critical. Although an attacker would not be able to act as a full man-in-the-middle and break into your server, they could present a shell that emulates the real server, perhaps tricking you into handing over a secret or password.</p>
<p>If you use SSH agent forwarding and your TOFU is tampered with, things become much more dangerous. The attacker gains the ability to impersonate you fully, enabling them to intercept and modify communications as a man-in-the-middle. They could modify or inject commands, or push to your git repository and loot CI secrets.</p>
<h2 id="do-you-check">Do You Check?</h2>
<p>You can find GitHub’s fingerprints <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/githubs-ssh-key-fingerprints">here</a>.</p>
<p>GitLab also has a nice documentation <a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#ssh-host-keys-fingerprints">page</a>.</p>
<p>Bitbucket’s are buried in a <a href="https://bitbucket.org/blog/ssh-host-key-changes">blog post</a>.</p>
<p>Sourcehut’s are <a href="https://man.sr.ht/git.sr.ht/#ssh-host-keys">here</a>, although they were not easily found via search engine.</p>
<p>It would really be nice if there were a standardised, well-known path for these.</p>
<h2 id="final-note">Final Note</h2>
<p>I wonder if SSH should really be used at all for git. While TLS certificates are relatively short lived these days thanks to Let’s Encrypt, SSH host keys live a very long time. If GitHub’s SSH host keys were stolen, how long would an attacker get away with intercepting communications?</p>

            </div>
            

        </div></div>
  </body>
</html>
