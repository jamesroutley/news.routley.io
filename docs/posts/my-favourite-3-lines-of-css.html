<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://andy-bell.co.uk/my-favourite-3-lines-of-css/">Original</a>
    <h1>My favourite 3 lines of CSS</h1>
    
    <div id="readability-page-1" class="page"><article>

<time datetime="2023-02-06">February 6, 2023 2:18 pm</time>
<p>In Every Layout, we wrote about <a href="https://every-layout.dev/layouts/stack/">The Stack</a>. It’s a marriage of <a href="https://alistapart.com/article/axiomatic-css-and-lobotomized-owls/">Heydon’s Lobotomised Owl selector</a> and my <a href="https://24ways.org/2018/managing-flow-and-rhythm-with-css-custom-properties/">method of managing Flow and Rhythm with CSS Custom Properties</a>.</p>
<pre><code>.stack &gt; * + * {
  margin-block-start: 1.5rem;
}</code></pre>
<p>Let’s break the selector down: every <strong>direct sibling</strong> <strong>child</strong> element of <code>.stack</code> has <code>margin-block-start</code> added to it. This is achieved by the <a href="https://alistapart.com/article/axiomatic-css-and-lobotomized-owls/">Lobotomised Owl selector</a>, but the <code>&gt;</code> combinator is added to prevent margin being added recursively. In writing modes that are left-to-right or right-to-left—such as English or Arabic—the margin is added to the top of the element.</p>
<p>I’ve been obsessed with this particular snippet for <em>years</em> now, and in recent years, I’ve enhanced it further with the flow utility:</p>
<pre><code>.flow &gt; * + * {
  margin-block-start: var(--flow-space, 1em);
}</code></pre>
<p>As you can see, this is very similar to <a href="https://every-layout.dev/layouts/stack/">The Stack</a>. The only difference aside from the name, is the use of <a href="https://andy-bell.co.uk/getting-started-with-css-custom-properties/">Custom Properties</a>—specifically the fallback value.</p>
<h2>How fallback values work in CSS Custom Properties</h2>
<p>If you try to grab a <a href="https://andy-bell.co.uk/getting-started-with-css-custom-properties/">CSS Custom Property</a> value that hasn’t been defined, the initial or inherited value will be used instead, but if the Custom Property is invalid and you don’t provide a fallback, <a href="https://matthiasott.com/notes/css-custom-properties-fail-without-fallback">it’ll fail</a>.</p>
<p>In the context of the <code>.flow</code> utility, this would be pretty bad, because if you’ve removed element’s default margin, <a href="https://andy-bell.co.uk/a-modern-css-reset/" data-type="post" data-id="673">like I do in a reset</a>, you could end up with no space at all.</p>
<p>The fallback value for <code>.flow</code> gives us two benefits:</p>
<ol>
<li>There’s a sensible fallback for if <code>--flow-space</code> is accidentally set as an invalid value</li>
<li>If <code>--flow-space</code> doesn’t exist, the <code>margin-top-value</code> will be <code>1em</code>, which will be relative to the element’s computed font size</li>
</ol>
<figure><img decoding="async" width="1024" height="530" src="https://andy-bell.co.uk/wp-content/uploads/2023/02/flow-default-1024x530.jpg" alt="Diagram shows the variable space between elements because it is based on 1em: a relative size" srcset="https://andy-bell.co.uk/wp-content/uploads/2023/02/flow-default-1024x530.jpg 1024w, https://andy-bell.co.uk/wp-content/uploads/2023/02/flow-default-300x155.jpg 300w, https://andy-bell.co.uk/wp-content/uploads/2023/02/flow-default-768x397.jpg 768w, https://andy-bell.co.uk/wp-content/uploads/2023/02/flow-default-1536x795.jpg 1536w, https://andy-bell.co.uk/wp-content/uploads/2023/02/flow-default-2048x1060.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>The space is 1em by default, so if the font size is larger, there will be more space. This is a handy way of maintaining flow and rhythm if you’re using a type scale. </figcaption></figure>
<h2>Why do I use flow over The Stack?</h2>
<p>I get asked this <em>a lot</em> and it’s a valid question. The reason is twofold.</p>
<p>Firstly, I use this utility <strong>everywhere</strong> on projects. At <a href="https://set.studio">our studio</a>, it is in every project we do, and probably will be forever. The reason is that because we use <a href="https://utopia.fyi/">fluid type and fluid space</a>, the <code>.flow</code> utility’s flexible, fallback-based setup works in harmony with our methodology of <a href="https://www.youtube.com/watch?v=5uhIiI9Ld5M">letting the browser do all the hard work for us</a>.</p>
<p>Secondly, in contexts like prose content (often long-form content like this article), we like to manage how certain HTML elements space themselves. For example, we might want to reduce the space of elements that directly follow headings and increase the space around <code>figure</code> elements. </p>
<p>This snippet is from this site you’re looking at now:</p>
<pre><code>.prose :is(h2 + *, h3 + *, h4 + *) {
  --flow-space: var(--space-s);
}</code></pre>
<p>What the snippet does is:</p>
<ol>
<li>Look for elements that directly follow a <code>h2</code>, <code>h3</code> or <code>h4</code>. </li>
<li>Assign <code>--flow-space</code> with the small item from the <a href="https://utopia.fyi/space/calculator?c=320,18,1.2,1240,20,1.25,5,2,&amp;s=0.75%7C0.5%7C0.25,1.5%7C2%7C3%7C4%7C6,s-l&amp;g=s,l,xl,12">spacing scale</a></li>
</ol>
<p>As for <code>.prose</code> itself, I’ve set the following:</p>
<pre><code>.prose {
  --flow-space: var(--space-m-l);
}</code></pre>
<p>By default, I tend to leave <code>--flow-space</code> as undefined, but in <code>.prose</code> contexts, I like a nice chunky bit of space between elements, so because Custom Properties are <a href="https://css-tricks.com/a-complete-guide-to-custom-properties/#h-using-the-cascade">affected by specificity and the cascade</a>, I create that more specific value.</p>
<figure><img decoding="async" loading="lazy" width="1024" height="530" src="https://andy-bell.co.uk/wp-content/uploads/2023/02/flow-controlled-1024x530.jpg" alt="The same as the last diagram, but this time the space is equal, because it&#39;s based on 2.5rem" srcset="https://andy-bell.co.uk/wp-content/uploads/2023/02/flow-controlled-1024x530.jpg 1024w, https://andy-bell.co.uk/wp-content/uploads/2023/02/flow-controlled-300x155.jpg 300w, https://andy-bell.co.uk/wp-content/uploads/2023/02/flow-controlled-768x397.jpg 768w, https://andy-bell.co.uk/wp-content/uploads/2023/02/flow-controlled-1536x795.jpg 1536w, https://andy-bell.co.uk/wp-content/uploads/2023/02/flow-controlled-2048x1060.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>With the spacing value used for <code>--flow-space</code>—which computes to around <code>2.5rem</code>—we get consistent space between every element.</figcaption></figure>
<h2>Why use margin and not gap?</h2>
<p>Again, I get asked this <em>a lot</em>. I remember when Safari finally pulled their finger out with <code>gap</code>, I sent Heydon a message saying we should make <strong>everything</strong> on <a href="https://every-layout.dev/">Every Layout</a> <code>gap</code>, which we were rather excited about. While we were putting actual thought into the second edition—which introduced <code>gap</code> to the layouts—we quickly realised we didn’t want to change <a href="https://every-layout.dev/layouts/stack/">The Stack</a>.</p>
<p>This was partly down to the fact that in order to use <code>gap</code>, we would have to make The Stack, either a flex or grid parent. This could cause all sorts of problems for people that grabbed the layout and dropped it in existing projects. This makes up a very large portion of the people who use Every Layout in the real world.</p>
<p>Along with that, all of the control is put on the parent and not the elements themselves. Back in the context of <code>.flow</code> and <code>--flow-space</code> with a fallback value: this wouldn’t be possible with <code>gap</code>. This is because <code>gap</code> is set on the parent (<code>.flow</code>) and <a href="https://web.dev/learn/css/spacing/#grid-and-flexbox">controls the space between child elements</a>. The parent is in complete control and the child elements have no say in what <code>gap</code> is at any given moment.</p>
<p>Lastly, along with the flexibility of letting <code>--flow-space</code> be affected by the cascade, and if it’s not set, letting <code>.flow</code> inherit spacing values from the child element it affects. The other key reason I don’t like to use <code>gap</code> is <a href="https://andy-bell.co.uk/css-logical-properties/">Logical Properties</a>. I personally want everything we build at <a href="https://set.studio/">the studio</a> to use Logical Properties as much as possible, because you get much better multi-language and reading mode support out of the box. They’re really well supported now, too!</p>
<h2>Wrapping up</h2>
<p>I honestly should have retired after making this iteration of <code>.flow</code>:</p>
<pre><code>.flow &gt; * + * {
    margin-block-start: var(--flow-space, 1em);
}</code></pre>
<p>Especially now that we use that and the rest of the layouts from <a href="https://every-layout.dev/">Every Layout</a> at <a href="https://set.studio/">Set Studio</a>. We’re essentially just colouring in front-ends at this point—apart from the odd occasion when we create a complex specific layout, where we use CSS grid layout to its full potential.</p>
<p>The main reason I’ve written this post though, is to send people to it when they ask why I use <code>.flow</code> or use <code>margin</code>, but also, I hope you’ve seen how damn powerful CSS Custom Properties are. They’re certainly more than just CSS variables, that’s for sure.</p>

<hr/>
<div>
<p>👋 Hello, I’m Andy and I’ll help you build fast &amp; visually stunning websites.</p>
<p>I’m the founder of <a href="https://set.studio/?utm_campaign=Personal+Site+Call+To+Action&amp;utm_source=Andy%E2%80%99s+Site&amp;utm_medium=cta&amp;utm_content=my-favourite-3-lines-of-css">Set Studio</a>, a creative agency that specialises in building stunning websites that work for <strong>everyone</strong>. If you’ve got a project in mind, <a href="https://andy-bell.co.uk/cdn-cgi/l/email-protection#a5c4cbc1dce5d6c0d18bd6d1d0c1ccca">get in touch</a>.</p>
</div>
<hr/>
<a href="https://andy-bell.co.uk/blog">Back to blog</a>
</article></div>
  </body>
</html>
