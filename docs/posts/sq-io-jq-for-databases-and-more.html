<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sq.io">Original</a>
    <h1>Sq.io: jq for databases and more</h1>
    
    <div id="readability-page-1" class="page"><div role="document"><div><section><div><div><p><code>sq</code> is a free/libre <a href="https://github.com/neilotoole/sq">open-source</a> data wrangling swiss-army knife
to inspect, query, join, import, and export data. You could think of <code>sq</code>
as <a href="https://jqlang.github.io/jq/">jq</a> for databases and documents, facilitating one-liners
like:</p><div><pre tabindex="0"><code data-lang="shell"><span><span>sq <span>&#39;@postgres_db | .actor | .first_name, .last_name | .[0:5]&#39;</span>
</span></span></code></pre></div><h2 id="installation">Installation <a href="#installation" aria-hidden="true">#</a></h2><div><nav id="sq-install" role="tablist">


</nav><div id="sq-install-content"><div id="sq-install-0" role="tabpanel" aria-labelledby="sq-install-0-tab"><div><pre tabindex="0"><code data-lang="shell"><span><span>brew install neilotoole/sq/sq</span></span></code></pre></div></div><div id="sq-install-1" role="tabpanel" aria-labelledby="sq-install-1-tab"><div><pre tabindex="0"><code data-lang="shell"><span><span>/bin/sh -c <span>&#34;</span><span>$(</span>curl -fsSL https://sq.io/install.sh<span>)</span><span>&#34;</span></span></span></code></pre></div></div><div id="sq-install-2" role="tabpanel" aria-labelledby="sq-install-2-tab"><div><pre tabindex="0"><code data-lang="shell"><span><span>scoop bucket add sq https://github.com/neilotoole/sq
</span></span><span><span>scoop install sq</span></span></code></pre></div></div><p>Install options for <code>apt</code>, <code>yum</code>, <code>apk</code>, <code>pacman</code>, <code>yay</code> over <a href="https://gianluca.ai/docs/install">here</a>.</p></div></div><p>For help, <code>sq help</code> is your starting point. And then see the <a href="https://gianluca.ai/docs/overview">docs</a>.</p><h3 id="lets-get-this-out-of-the-way">Let’s get this out of the way <a href="#lets-get-this-out-of-the-way" aria-hidden="true">#</a></h3><p><code>sq</code> is pronounced like <em>seek</em>. Its query language, <code>SLQ</code>, is pronounced like <em>sleek</em>.</p><h2 id="feature-highlights">Feature Highlights <a href="#feature-highlights" aria-hidden="true">#</a></h2><p>Some feature highlights are shown below. For more, see the <a href="https://gianluca.ai/docs/overview">docs</a>,
including the <a href="https://gianluca.ai/docs/query">query guide</a>, <a href="https://gianluca.ai/docs/tutorial">tutorial</a> and <a href="https://gianluca.ai/docs/cookbook">cookbook</a>.</p><h3 id="diff-database-tables">Diff database tables <a href="#diff-database-tables" aria-hidden="true">#</a></h3><p>Use the <a href="https://gianluca.ai/docs/diff">diff</a> command to compare source metadata or row values.</p><p><img src="https://gianluca.ai/images/sq_diff_table_data.png" alt="sq diff"/></p><h3 id="import-excel-worksheet-into-postgres-table">Import Excel worksheet into Postgres table <a href="#import-excel-worksheet-into-postgres-table" aria-hidden="true">#</a></h3><p><a href="https://gianluca.ai/docs/output#insert">Insert</a> the contents of an Excel XLSX worksheet (from a sheet named <code>actor</code>) into
a new Postgres table named <code>xl_actor</code>. Note that the import mechanism
is reasonably sophisticated in that it tries to preserve data types.</p><h3 id="view-metadata-for-a-database">View metadata for a database <a href="#view-metadata-for-a-database" aria-hidden="true">#</a></h3><p>The <code>--json</code> flag to <a href="https://gianluca.ai/docs/inspect"><code>sq inspect</code></a> outputs schema and other metadata in JSON.
Typically the output is piped to jq to select the interesting elements.</p><h3 id="get-names-of-all-columns-in-a-mysql-table">Get names of all columns in a MySQL table <a href="#get-names-of-all-columns-in-a-mysql-table" aria-hidden="true">#</a></h3><p>Even easier, just get the metadata for the table you want:</p><div><pre tabindex="0"><code data-lang="shell"><span><span>sq inspect @sakila_my.actor -j <span>|</span> jq -r <span>&#39;.columns[] | .name&#39;</span>
</span></span></code></pre></div><h3 id="execute-sql-query-against-sql-server-insert-results-to-sqlite">Execute SQL query against SQL Server, insert results to SQLite <a href="#execute-sql-query-against-sql-server-insert-results-to-sqlite" aria-hidden="true">#</a></h3><p>This snippet adds a (pre-existing) SQL Server source, and creates a
new <a href="https://gianluca.ai/docs/drivers/sqlite">SQLite</a> source. Then, a raw native SQL query is executed against
<a href="https://gianluca.ai/docs/drivers/sqlserver">SQL Server</a>, and the results are inserted into SQLite.</p><h3 id="export-all-database-tables-to-csv">Export all database tables to CSV <a href="#export-all-database-tables-to-csv" aria-hidden="true">#</a></h3><p>Get the (JSON) metadata for the active source; pipe that JSON to jq and
extract the table names; pipe the table names
to <code>xargs</code>, invoking <code>sq</code> once for each table, outputting a CSV file per table. This snippet
was tested on macOS.</p><p>If you instead wanted to use <code>sql</code> mode:</p><div><pre tabindex="0"><code data-lang="shell"><span><span>sq inspect -j <span>|</span> jq -r <span>&#39;.tables[] | .name&#39;</span> <span>|</span> xargs -I % sq sql <span>&#39;SELECT * FROM %&#39;</span> --csv --output %.csv
</span></span></code></pre></div><h3 id="source-commands">Source commands <a href="#source-commands" aria-hidden="true">#</a></h3><p>Commands to <a href="https://gianluca.ai/docs/cmd/add">add</a>, <a href="https://gianluca.ai/docs/cmd/src">activate</a>, <a href="https://gianluca.ai/docs/cmd/mv">move</a>,
<a href="https://gianluca.ai/docs/cmd/ls">list</a>, <a href="https://gianluca.ai/docs/cmd/group">group</a>, <a href="https://gianluca.ai/docs/cmd/ping">ping</a>
or <a href="https://gianluca.ai/docs/cmd/rm">remove</a> sources.</p><div><pre tabindex="0"><code data-lang="shell"><span><span>$ sq src                      <span># show active source</span>
</span></span><span><span>$ sq add ./actor.tsv          <span># add a source</span>
</span></span><span><span>$ sq src @actor_tsv           <span># set active source</span>
</span></span><span><span>$ sq ls                       <span># list sources</span>
</span></span><span><span>$ sq ls -v                    <span># list sources (verbose)</span>
</span></span><span><span>$ sq group                    <span># get active group</span>
</span></span><span><span>$ sq group prod               <span># set active group</span>
</span></span><span><span>$ sq mv @sales @prod/sales    <span># rename a source</span>
</span></span><span><span>$ sq ping --all               <span># ping all sources</span>
</span></span><span><span>$ sq rm @actor_tsv            <span># remove a source</span>
</span></span></code></pre></div><h3 id="database-table-commands">Database table commands <a href="#database-table-commands" aria-hidden="true">#</a></h3><p>Convenient commands that act on database tables: <a href="https://gianluca.ai/docs/cmd/tbl-copy">copy</a>, <a href="https://gianluca.ai/docs/cmd/tbl-truncate">truncate</a>, <a href="https://gianluca.ai/docs/cmd/tbl-drop">drop</a>.</p><p>Note that <code>sq tbl copy</code> only applies within a single database.
If you want to copy a table from one database to another,
use the <a href="https://gianluca.ai/docs/output#insert"><code>--insert</code></a> mechanism.</p><div><pre tabindex="0"><code data-lang="shell"><span><span>$ sq tbl copy .actor .actor2  <span># copy table &#34;actor&#34; to &#34;actor2&#34;, creating if necessary</span>
</span></span><span><span>$ sq tbl truncate .actor2     <span># truncate table &#34;actor2&#34;</span>
</span></span><span><span>$ sq tbl drop .actor2         <span># drop table &#34;actor2&#34;</span>
</span></span></code></pre></div><h3 id="query-jsonl-eg-log-files">Query JSONL (e.g. log files) <a href="#query-jsonl-eg-log-files" aria-hidden="true">#</a></h3><p><a href="https://gianluca.ai/docs/output#jsonl">JSONL</a> output is a row of JSON per line (hence “JSON Lines”). Lots of log output is like this.
We can use <code>sq</code>’s own <a href="https://gianluca.ai/docs/config/#logging">log</a> output as an example:</p><div><pre tabindex="0"><code data-lang="json"><span><span><span>{</span><span>&#34;level&#34;</span><span>:</span><span>&#34;debug&#34;</span><span>,</span><span>&#34;time&#34;</span><span>:</span><span>&#34;00:07:48.799992&#34;</span><span>,</span><span>&#34;caller&#34;</span><span>:</span><span>&#34;sqlserver/sqlserver.go:452:(*database).Close&#34;</span><span>,</span><span>&#34;msg&#34;</span><span>:</span><span>&#34;Close database: @sakila_mssql | sqlserver | sqlserver://sakila:xxxxx@localhost?database=sakila&#34;</span><span>}</span>
</span></span><span><span><span>{</span><span>&#34;level&#34;</span><span>:</span><span>&#34;debug&#34;</span><span>,</span><span>&#34;time&#34;</span><span>:</span><span>&#34;00:07:48.800016&#34;</span><span>,</span><span>&#34;caller&#34;</span><span>:</span><span>&#34;source/files.go:323:(*Files).Close&#34;</span><span>,</span><span>&#34;msg&#34;</span><span>:</span><span>&#34;Files.Close invoked: has 1 clean funcs&#34;</span><span>}</span>
</span></span><span><span><span>{</span><span>&#34;level&#34;</span><span>:</span><span>&#34;debug&#34;</span><span>,</span><span>&#34;time&#34;</span><span>:</span><span>&#34;00:07:48.800031&#34;</span><span>,</span><span>&#34;caller&#34;</span><span>:</span><span>&#34;source/files.go:61:NewFiles.func1&#34;</span><span>,</span><span>&#34;msg&#34;</span><span>:</span><span>&#34;About to clean fscache from dir: /var/folders/68/qthwmfm93zl4mqdw_7wvsv7w0000gn/T/sq_files_fscache_2273841732&#34;</span><span>}</span>
</span></span></code></pre></div></div></div></section></div></div></div>
  </body>
</html>
