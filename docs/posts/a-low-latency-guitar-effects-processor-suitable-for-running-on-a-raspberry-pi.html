<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Quinny/GuitarEffects">Original</a>
    <h1>A low latency guitar effects processor suitable for running on a Raspberry Pi</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">A low latency guitar effects processor in C++ suitable for running on smaller
boards (e.g. a raspberry pi).</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/Quinny/GuitarEffects/blob/master/case/full.JPG"><img src="https://github.com/Quinny/GuitarEffects/raw/master/case/full.JPG" alt="unit in case"/></a></p>

<h2 tabindex="-1" dir="auto"><a id="user-content-high-level-overview" aria-hidden="true" href="#high-level-overview"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>High level overview</h2>
<p dir="auto">The <a href="https://github.com/Quinny/GuitarEffects/tree/master/web/static">web UI</a>
calls into the <a href="https://github.com/Quinny/GuitarEffects/tree/master/web">web server</a>
which then manipulates the <a href="https://github.com/Quinny/GuitarEffects/blob/master/web/pedal_board.h">pedal board</a>.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-sound-card-interface" aria-hidden="true" href="#sound-card-interface"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Sound card interface</h2>
<p dir="auto">The <a href="https://github.com/Quinny/GuitarEffects/blob/master/audio_transformer.h">AudioTransformer</a> class uses <a href="http://www.music.mcgill.ca/~gary/rtaudio/index.html" rel="nofollow">RtAudio</a> to interface with the sound card.</p>
<p dir="auto">The values read from the soundcard are then streamed into the provided
transformation function and written back out to the output device.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-pedals" aria-hidden="true" href="#pedals"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Pedals</h2>
<p dir="auto"><a href="https://github.com/Quinny/GuitarEffects/blob/master/pedal.h">pedal.h</a> defines
an interface for all pedals to conform to.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-transformation" aria-hidden="true" href="#transformation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Transformation</h3>
<p dir="auto">The root of it is the <code>Transform</code> function which takes an input signal, performs
any kind of transformation, and returns an output. All input and output values
should remain in the range [-1, 1] otherwise you&#39;ll produce some really gnarly
popping and cracking.</p>
<p dir="auto">Many of the pedals utilize the <a href="https://github.com/cycfi/Q">Q</a> library for some
signal processing primitives (e.g. filters, compression, etc.). Some other
utility classes can be found in the <a href="https://github.com/Quinny/GuitarEffects/tree/master/fx">fx</a>
directory of this repo.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-knobs" aria-hidden="true" href="#knobs"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Knobs</h3>
<p dir="auto">The <code>Describe</code> function advertises the current state of the pedal, primarily
the knobs. These knob name and values will be used to display in the UI
(covered later).</p>
<p dir="auto"><code>AdjustKnob</code> provides a knob from the UI and relies on the implementation to
make the required changes to the pedal. These changes should be applied in a way
such that subsequent calls to <code>Describe</code> will reflect these changes (otherwise
the UI won&#39;t update).</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-registration" aria-hidden="true" href="#registration"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Registration</h3>
<p dir="auto">Each pedal should register itself via the <code>REGISTER_PEDAL</code> macro. This connects
the pedal to the <a href="https://github.com/Quinny/GuitarEffects/blob/master/pedal_registry.h">PedalRegistry</a> so that other components can find it without explicitly knowing
about its existence.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-pedal-board" aria-hidden="true" href="#pedal-board"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Pedal Board</h2>
<p dir="auto">The <a href="https://github.com/Quinny/GuitarEffects/blob/master/web/pedal_board.h">PedalBoard</a>
essentially just wraps a list of pedals and chains their <code>Transform</code> functions.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-web-server" aria-hidden="true" href="#web-server"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Web Server</h2>
<p dir="auto">The <a href="https://github.com/Quinny/GuitarEffects/blob/master/web/main.cpp">web server</a>
uses the <a href="https://github.com/ipkn/crow">crow</a> library to expose endpoints that
manipulate the pedal board.</p>
<p dir="auto">The <a href="https://github.com/Quinny/GuitarEffects/blob/master/pedal_registry.h">PedalRegistry</a>
is used here to automatically expose newly added pedals. You only need to add
an include statement within the <a href="https://github.com/Quinny/GuitarEffects/blob/master/web/handlers.h">handlers</a> file to trigger the registration.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-web-ui" aria-hidden="true" href="#web-ui"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Web UI</h2>
<p dir="auto">The web UI uses <a href="https://reactjs.org" rel="nofollow">React</a>. The bulk of the logic lives in
<a href="https://github.com/Quinny/GuitarEffects/blob/master/web/static/app.jsx">app.jsx</a>.</p>

<ol dir="auto">
<li>
<p dir="auto">First clone the repo: <code>git clone --recurse-submodules https://github.com/Quinny/GuitarEffects</code></p>
</li>
<li>
<p dir="auto">Then install RtAudio. The steps here depend slightly on the platform you are
building on. See <a href="https://github.com/thestk/rtaudio/blob/master/install.txt">install.txt</a> from the RtAudio repo. After following all the steps there run <code>make install</code> in the RtAudio directory so that the library files can be linked properly.</p>
</li>
<li>
<p dir="auto">Install boost using your package manager (e.g. <code>brew</code>, <code>apt-get</code>, <code>yum</code>, etc).
If you Google &#34;Install boost using <code>&lt;package_manager&gt;</code> you should find the
corresponding package name.</p>
</li>
<li>
<p dir="auto">Install sdl2 using your package manager (e.g. <code>brew</code>, <code>apt-get</code>, <code>yum</code>, etc.).
If you Google &#34;Install sdl on <code>&lt;platform&gt;</code> you should find more detailed
instructions.</p>
</li>
<li>
<p dir="auto">Run <code>make server</code> from this repo&#39;s root.</p>
</li>
<li>
<p dir="auto">Open a github issue if I missed a required dependency.</p>
</li>
</ol>

<p dir="auto">From the <code>web</code> directory, run <code>sudo ../bin/server</code> (sudo is required to run on
port 80).</p>

<h2 tabindex="-1" dir="auto"><a id="user-content-parts-list" aria-hidden="true" href="#parts-list"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Parts List</h2>
<ol dir="auto">
<li>Raspberry Pi 4</li>
<li><a href="https://www.amazon.com/Raspberry-Pi-7-Touchscreen-Display/dp/B0153R2A9I/" rel="nofollow">7 inch touch screen</a></li>
<li><a href="https://www.amazon.com/gp/product/B0751BHY99" rel="nofollow">5 push buttons</a> - Any buttons that are the same diameter shouyd work</li>
<li><a href="https://www.amazon.com/gp/product/B01EV70C78" rel="nofollow">Bunch of jumper wires</a> - Any jumper wires should work</li>
<li><a href="https://www.amazon.com/gp/product/B07PCJP9DY" rel="nofollow">Bread board</a> - You can probably get away without this, but I wanted a common ground</li>
<li><a href="https://www.amazon.com/GeeekPi-Raspberry-30x30x7mm-Brushless-Retroflag/dp/B07C9C99RM" rel="nofollow">Fan</a> - Any small-ish 3.3v fan should work</li>
<li><a href="https://github.com/Quinny/GuitarEffects/blob/master/case">3D printed case</a></li>
<li><a href="https://www.amazon.com/BEHRINGER-Audio-Interface-1-Channel-UM2/dp/B00EK1OTZC" rel="nofollow">Behringer audio interface</a> - Any audio interface will work</li>
<li><a href="https://www.amazon.com/gp/product/B06XXL2H6F" rel="nofollow">USB extension cable</a> - This makes it easier to plug the audio interface into the Pi through the opening in the back of the case, any brand should work</li>
<li><a href="https://www.amazon.com/gp/product/B07WFVQ6K5" rel="nofollow">Pi 4 power switch</a> - This makes it easier to turn the Pi on and off through the opening in the back of the case, any brand should work</li>
</ol>
<h2 tabindex="-1" dir="auto"><a id="user-content-assembly" aria-hidden="true" href="#assembly"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Assembly</h2>
<ol dir="auto">
<li>Mount the Pi to the back of the touch screen and hook up the ribbon cable and GPIO pins according to the instructions on the product page</li>
<li>Mount the buttons to the top of the case by unscrewing the ring on the button, putting the button through the hole in the case, and then screw down the ring again.
Make sure the terminals for the button are facing towards the screen to leave room for the wires</li>
<li>(Optional) Mount the breadboard in the empty space between the buttons and the screen hole</li>
<li>Mount the screen in the top of the case and lay it flat so the terminals of the buttons are facing up</li>
<li>Wire one terminal from each button to a ground connection</li>
<li>Wire the other terminal to a GPIO pin, from left to right:
<ol dir="auto">
<li>GPIO Pin 6 (Pin 31)</li>
<li>GPIO Pin 12 (Pin 32)</li>
<li>GPIO Pin 16 (Pin 36)</li>
<li>GPIO Pin 20 (Pin 38)</li>
<li>GPIO Pin 21 (Pin 40)</li>
</ol>
</li>
<li>Wire the fan to any open 3.3v terminal and ground</li>
<li>Plug in the USB extension and power switch cords</li>
<li>Place the top of the case into the bottom, threading the extension and power
cords through the opening in the back</li>
</ol>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/Quinny/GuitarEffects/blob/master/case/annotated_wiring.jpg"><img src="https://github.com/Quinny/GuitarEffects/raw/master/case/annotated_wiring.jpg" alt=""/></a></p>
<p dir="auto">Note that since the server program exposes an HTTP server you can actually
navigate to the IP address of your PI from any device connected to the same
wifi and control your pedal chain from there.</p>
</article>
          </div></div>
  </body>
</html>
