<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bitfieldconsulting.com/blog/night-of-the-runbooks">Original</a>
    <h1>Night of the Runbooks: a DevOps horror story</h1>
    
    <div id="readability-page-1" class="page"><div data-block-type="44" id="block-9a5475fc7ff758b60f66"><div><h2 id="it-was-a-dark-and-stormy-night-">It was a dark and stormy night...</h2><p>Not really, of course; it was warm and pleasantly mild (the weather never seems to co-operate on these occasions), but indulge me by imagining appropriate meteorological conditions for the spine-tingling story I&#39;m about to relate.</p><p>It was Morgan&#39;s very first night on call, and they were a mite nervous, as you can imagine. They would be solely responsible for an online system handling thousands of users, millions of transactions, including credit card payments, and if anything went wrong, they would have to deal with it. Somehow.</p><p>Fortunately, automated monitoring checks would be keeping an eye on the system second by second, ready to send an alert to Morgan&#39;s phone if any problems were detected. So as the warm summer evening wore on, Morgan settled into a comfortable chair with a blood-chilling tale of terror, phone within reach, and relaxed a little.</p>
</div></div><div data-block-type="44" id="block-yui_3_17_2_1_1634231384968_19412"><div><h2 id="beep-beep">Beep, beep</h2>
<p>At around 11pm, the phone suddenly beeped, the alert sounding absurdly loud in the quiet house. Morgan grabbed it quickly. Would this be a false alarm, or a real incident? &#34;Service <code>process-payments</code> is CRITICAL&#34;, they read. &#34;Oh, great,&#34; thought Morgan. &#34;This is exactly what I need. I don&#39;t know <em>anything</em> about <code>process-payments</code>; it belongs to a completely different team. I wouldn&#39;t even know how to check it. Wait, though... what&#39;s this?&#34; They read on:</p>
<blockquote>
<p>&#34;Please click the following link to troubleshoot this service.&#34;</p>
</blockquote>
<p>Intrigued, Morgan opened the message on their laptop and went to the link provided. It opened a web page entitled &#34;Runbook for <code>process-payments</code> incidents&#34;, with a large, friendly heading saying &#34;Start Here&#34;. &#34;Great!&#34; thought Morgan; where to start was exactly what had been worrying them. It looked like someone had taken the trouble to prepare a complete troubleshooting guide for exactly this kind of incident.</p>
<p>The first thing in the document was a series of clear, simple steps for Morgan to follow. First, an embedded button to click to acknowledge the alert, to let others know that they were handling the incident, so it wouldn&#39;t automatically escalate to someone else.</p>
<p>Next, a set of live images showed the current status of various aspects of the payments service: percentage of failed requests, latency, and so on. The checklist asked Morgan to confirm from these dashboard displays that there was a problem with the service.</p>
<p>It looked like there was, since the number of failures had gone way up, above the alert threshold, and was still rising. Morgan went on to the next step in the checklist. It was a button that triggered a script to capture the current status and log messages from the service, automatically copying them into a new web document for the incident. This would come in handy later when trying to figure out what went wrong.</p>
<p>&#34;So far, so good,&#34; thought Morgan. &#34;What&#39;s next?&#34; Next came another button, to automatically restart the service. Sometimes things just hang up or get stuck for no particular reason, and as we all know, turning them off and on again can be a useful default remedy. To save Morgan having to go to the appropriate cloud control panel, logging in, finding the service, and working out the right sequence of clicks to restart the service, this whole sequence was automated, and all Morgan needed to do was click the button in the runbook.</p>

</div></div><div data-block-type="44" id="block-yui_3_17_2_1_1634231384968_22076"><div><h2 id="computer-says-no">Computer says no</h2>
<p>After watching the graphs for a few minutes, Morgan noticed that the restart didn&#39;t seem to have fixed the issue. &#34;Oh well,&#34; they thought, &#34;it was worth trying. So now what do I do?&#34;</p>
<p>The next step in the checklist said &#34;If the issue is still unresolved, click this button to fail over to the backup service, and continue following this checklist to troubleshoot.&#34; Luckily, Morgan&#39;s team had a Plan B for this service: a third-party equivalent which could take over temporarily and make sure requests still went through, albeit not as fast as with the primary service.</p>
<p>Morgan clicked the failover button, their confidence growing with each step of the runbook they had successfully followed. After confirming from the monitoring dashboard that the backup service was starting to clear down the number of queued requests, they moved on to the next part of the checklist.</p>
<p>This advised them to read the log messages from the failing service (automatically captured in a previous step, and now available as part of the incident report document). There were a small number of examples of different error messages that they might see, with suggestions for what to do in each case.</p>
<p>&#34;Hmm, this says I should look for a message indicating that a new version of the service was deployed recently,&#34; Morgan thought. &#34;Let&#39;s see... wait, here it is. <code>Deploying update</code>... <code>all instances successfully restarted</code>... <code>Version XXX running</code>. So there was a fresh deploy about five minutes before the first errors started coming in. Very suspicious!&#34;</p>
<p>The runbook advised Morgan that, in this situation, the first thing to try was to click the button to automatically roll back to the previously-deployed version. &#34;Oh, very useful!&#34; thought Morgan. &#34;This saves me having to check out the code repo and figure out how to find the last known good version and deploy it from the command line, or from having to do it via the CI/CD platform. Great. Click!&#34;</p>
<p>It took a few minutes for the deploy to complete, while Morgan anxiously refreshed the service dashboard, but one by one, red lights started to turn green, and the graphs started returning to normal. &#34;This is looking good!&#34; Morgan thought. &#34;What do I need to do now?&#34;</p>
<h2 id="that-wasn-t-too-bad-">That wasn&#39;t too bad...</h2>
<p>The checklist said that if a redeploy fixed the problem, they should first of all click a button to switch traffic back to the primary service, cutting out the backup, and then add their own notes to the incident report explaining what they did and what happened. The report would go automatically to Morgan&#39;s team lead to be reviewed the next day, and then for the team to review in their weekly meeting. The other team responsible for the <code>process-payments</code> service would be automatically notified, too, and a ticket would be opened for them to identify what went wrong and fix it; in the meantime, new deploys would be blocked, to prevent someone inadvertently putting the buggy service back into production.</p>
<p>With this done, and the incident officially closed, Morgan could finally relax. &#34;That wasn&#39;t anywhere near as scary as I&#39;d thought it might be,&#34; they mused. &#34;The runbook took a lot of the fear out of the process, and it gave me something to focus on and a clear sequence of actions to take. Even better, most of the actions were automated, so that all I had to do was trigger them. I suppose every time something like this happened in the past, the team learned from it, updated the runbook with information about it, and built a little more automation to help fix the issue. That&#39;s a very enlightened way to run your web operations, now I come to think of it.&#34;</p>
<h2 id="the-terror">The terror</h2>
<p>Suddenly a harsh beeping jolted Morgan out of their reverie. </p>
<blockquote>
<p>&#34;Service <code>process-payments</code> is CRITICAL.&#34; </p>
</blockquote>
<p>With mounting horror, Morgan realized that there was no runbook link attached. It had all been a dream... and now Morgan&#39;s true night of terror was about to begin.</p>

</div></div></div>
  </body>
</html>
