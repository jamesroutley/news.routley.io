<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://unethical.info/2024/01/24/hacking-my-air-purifier/">Original</a>
    <h1>Breaking Free from DRM: Hacking My Air Purifier</h1>
    
    <div id="readability-page-1" class="page"><div>
<figure><img fetchpriority="high" decoding="async" width="960" height="720" src="https://unethical.info/wp-content/uploads/2024/01/FilterEdit-edited-1.jpg" alt="" srcset="https://unethical.info/wp-content/uploads/2024/01/FilterEdit-edited-1.jpg 960w, https://unethical.info/wp-content/uploads/2024/01/FilterEdit-edited-1-300x225.jpg 300w, https://unethical.info/wp-content/uploads/2024/01/FilterEdit-edited-1-768x576.jpg 768w" sizes="(max-width: 960px) 100vw, 960px"/></figure>
<p>I searched the web for a deal on a decent air purifier and the Xiaomi 4 Pro seemed to meet all my requirements. The filter size, scheduler and air volume ticked all the boxes. I set it up and thought nothing of it until last week my room was lit with the â€˜<strong>0% remaining</strong>â€™ replace filter warning. I had set my unit up to disable the LCD so this was an unwelcome surprise. I dismissed the warning by clicking the user button to dismiss the error and 15 minutes later it lit up my room againâ€¦Â Â </p>
<figure><img decoding="async" width="616" height="411" src="https://unethical.info/wp-content/uploads/2024/01/Screenshot-2024-01-24-211648-edited.png" alt="" srcset="https://unethical.info/wp-content/uploads/2024/01/Screenshot-2024-01-24-211648-edited.png 616w, https://unethical.info/wp-content/uploads/2024/01/Screenshot-2024-01-24-211648-edited-300x200.png 300w" sizes="(max-width: 616px) 100vw, 616px"/></figure>
<p>There was nowhere in the app I could disable the warning, having cleaned the filter several times throughout the year I was sure it had at least another 12 months of life left in it. I decided to investigate the nightmare DRM RFID chip that was stuck to the bottom of my filter.</p>
<h2>Grifters and Gatekeepers:</h2>
<p>As I reached for my proxmark I realized that surely someone had already done the heavy lifting, I was partially correct. Introducing <strong><a href="http://www.flamingo-tech.nl">Flamingo Tech</a></strong> he had spent some time reverse engineering these filters and <a href="https://github.com/Flamingo-tech/xiaomi-air-purifier-reverse-engineering">publishing his work</a>. </p>
<p>In his <a href="https://github.com/Flamingo-tech/xiaomi-air-purifier-reverse-engineering/tree/main/Filter%20information">repo</a> he outlines the important blocks from the tag:</p>
<ul>
<li><strong>Block 8 back to 00000000, itâ€™s back to 100%</strong></li>
<li>Other block info:
<ul>
<li>Block4 is rfid-factory-id</li>
<li>Block5 is rfid-product-id (xx:xx:xx:xx Regular Filter)</li>
<li>Block6: rfid-time</li>
<li>Block7: rfid-serial-num</li>
</ul>
</li>
</ul>
<p>Unfortunately the NfcA tag is still locked and we canâ€™t edit the tag without the password. Thankfully the proxmark community had already tackled this. You can review their process in discovering their password key gen <a href="http://www.proxmark.org/forum/viewtopic.php?id=7806">here</a>.</p>
<p>Flamingo Tech <a href="http://flamingo-tech.nl/2022/05/27/this-is-how-they-do-it/">published a script</a> written by <a href="https://twitter.com/doegox">Doegox </a>outlining how the password crack works. Despite the title â€œ<strong>This is how they do it!</strong>â€ he fails to explain the code within the post and uses the blog as a call to action to sell his own tags. Normally this sort of thing doesnâ€™t bother me but the comment â€œ<em>This will significantly decrease the waste footprint from a whole filter.. to just a sticker </em>ğŸ˜€â€ rubbed me the wrong way. If he really cared about the carbon footprint he would have explained how to update the tag already on the filter you own. However if you want to support his work you can still grab his stickers <a href="https://www.tindie.com/products/theflamingo/10x-xiaomi-air-purifier-new-filter-nfc-sticker/">here</a>.</p>
<p>I decided to explain the code here but if you want to skip to the actual filter reset scroll down to <strong>â€œHacking the tagâ€</strong>.</p>
<h2>Password Key Gen:</h2>
<p>The script contains two examples, the first example is based on the tag UID â€œ04A03CAA1E7080â€ resulting in the password â€œCD91AFCCâ€.</p>
<p>First we take the UID and convert it to a byte array. So 04A03CAA1E7080 becomes a sequence of bytes [04, A0, 3C, AA, 1E, 70, 80].</p>
<p>Using the first byte in the array â€œBCâ€ we convert it to decimal to get 188 and use that byte to determine where each byte is within the hash.</p>
<p>188 % 20 = 8</p>
<p>Now back to that hash we generated earlier â€“ bc<strong>af</strong>806333<strong>cc</strong>f720<strong>cd</strong>441a167f<strong>91</strong>4fbe6ea4a513</p>
<p>Grabbing the bytes in the correct order we get:</p>
<p>8th byte: <strong>CD</strong></p>
<p>Concatenating these forms the password:</p>
<p>Now that we know how it works we can modify/reset our own filters. Not everyone has access to a ~$350 Proxmark so Iâ€™ve created instructions for updating your tag with any NFC enabled mobile phone.</p>

<p><strong>Step 1:</strong></p>
<p>Install <a href="https://www.wakdev.com/en/apps.html">NFC tools</a> for your NFC enabled Android or iPhone.</p>
<p><strong>Step 2:</strong></p>
<p>Scan the NFC tag on the bottom of your filter with the read function of the free app.</p>
<figure><img decoding="async" width="591" height="788" src="https://unethical.info/wp-content/uploads/2024/01/photo_2024-01-24_21-11-15-edited.jpg" alt="" srcset="https://unethical.info/wp-content/uploads/2024/01/photo_2024-01-24_21-11-15-edited.jpg 591w, https://unethical.info/wp-content/uploads/2024/01/photo_2024-01-24_21-11-15-edited-225x300.jpg 225w" sizes="(max-width: 591px) 100vw, 591px"/></figure>
<p><strong>Step 3:</strong></p>
<p>Copy the retrieved â€˜Serial Number/UIDâ€™ (14 character hex value) down somewhere.</p>
<figure><img loading="lazy" decoding="async" width="591" height="591" src="https://unethical.info/wp-content/uploads/2024/01/photo_2024-01-24_21-11-16-edited.png" alt="" srcset="https://unethical.info/wp-content/uploads/2024/01/photo_2024-01-24_21-11-16-edited.png 591w, https://unethical.info/wp-content/uploads/2024/01/photo_2024-01-24_21-11-16-edited-300x300.png 300w, https://unethical.info/wp-content/uploads/2024/01/photo_2024-01-24_21-11-16-edited-150x150.png 150w" sizes="(max-width: 591px) 100vw, 591px"/></figure>
<p><strong>Step 4:</strong></p>
<p>Generate your reset command by entering the 14 characters below. If the UID is 12345678901234 the password will be 011853E8 and the command to reset the filter will be: 1B011853E8,3008,A20800000000</p>






<h2>UID to Password Converter</h2>

<p><strong>Step 5:</strong></p>
<p>In the main menu of the app click â€˜Otherâ€™ -&gt; â€˜Advanced NFC commandsâ€™ and accept the disclaimer. Then paste the command above into the data box. (NOTE: Android users will have to select the I/O class which will be â€œNfcA (ISO 14443-3A)â€ from the drop down menu)</p>
<figure><img loading="lazy" decoding="async" width="588" height="488" src="https://unethical.info/wp-content/uploads/2024/01/photo_2024-01-24_21-11-19.png" alt="" srcset="https://unethical.info/wp-content/uploads/2024/01/photo_2024-01-24_21-11-19.png 588w, https://unethical.info/wp-content/uploads/2024/01/photo_2024-01-24_21-11-19-300x249.png 300w" sizes="(max-width: 588px) 100vw, 588px"/></figure>
<p><strong>Step 6:</strong></p>
<p>Ensure the top of the phone is sitting over the tag and click â€˜Send Commandâ€™</p>
<p>Voila! Youâ€™ve successfully reset your filter. Repeat as needed for continuous, hassle-free air purification.</p>
<p>Compatible Device List:</p>
<figure><table><tbody><tr><td>Xiaomi Air Purifier:Â </td><td>Â Compatible:</td><td>Â Tested:</td></tr><tr><td>4 Pro</td><td>Â âœ“</td><td>Â âœ“</td></tr><tr><td>4 Lite</td><td>Â âœ“</td><td>Â â¨¯</td></tr><tr><td>4</td><td>Â âœ“</td><td>Â â¨¯</td></tr><tr><td>MI PRO</td><td>Â âœ“</td><td>Â â¨¯</td></tr><tr><td>MI PRO H</td><td>Â âœ“</td><td>Â â¨¯</td></tr><tr><td>PRO H</td><td>Â âœ“</td><td>Â â¨¯</td></tr><tr><td>PRO</td><td>Â âœ“</td><td>Â â¨¯</td></tr><tr><td>3H</td><td>Â âœ“</td><td>Â âœ“</td></tr></tbody></table><figcaption></figcaption></figure>
<figure><a href="https://www.flamingo-tech.nl/sample-page/"><img loading="lazy" decoding="async" width="107" height="179" src="https://unethical.info/wp-content/uploads/2024/01/017-edy-trodat-Flamingo.png" alt=""/></a></figure>
</div></div>
  </body>
</html>
