<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/openziti-test-kitchen/webhookz">Original</a>
    <h1>Show HN: Send a GitHub webhook to a private URL</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">This repo sends a GitHub webhook to a private server with the <a href="https://github.com/marketplace/actions/ziti-webhook-action-python">OpenZiti Webhook Action</a> over a zero trust, private network based on <a href="https://github.com/openziti/ziti#readme">OpenZiti</a> <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/6c8389b09739fd77ebe53744a52e3029c69e5dbb55534ca8ab02c633a0bb46a7/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f73746172732f6f70656e7a6974692f7a6974693f7374796c653d736f6369616c"><img src="https://camo.githubusercontent.com/6c8389b09739fd77ebe53744a52e3029c69e5dbb55534ca8ab02c633a0bb46a7/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f73746172732f6f70656e7a6974692f7a6974693f7374796c653d736f6369616c" alt="GitHub Repo stars" data-canonical-src="https://img.shields.io/github/stars/openziti/ziti?style=social"/></a>.</p>
<h2 dir="auto"><a id="user-content-use-this-template-repository" aria-hidden="true" href="#use-this-template-repository"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Use this template repository</h2>
<p dir="auto">Do this first: there&#39;s a button in the GitHub UI to &#34;Use this template&#34; which will give you a blank commit history in a repo generated from this one. Clone your new repo and follow the steps below in your Git working copy directory.</p>
<h2 dir="auto"><a id="user-content-decide-how-you-will-configure-your-openziti-network" aria-hidden="true" href="#decide-how-you-will-configure-your-openziti-network"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Decide how you will configure your OpenZiti Network</h2>
<p dir="auto">You might prefer to self-host your network or you may use the network provided by the Ziti Edge Developer Sandbox (ZEDS). Self-hosting means you won&#39;t need to sign up for anything and you&#39;ll have full transparency of the open source software and total control of the network. ZEDS requires a painless and free-forever signup for a private developer sandbox on shared servers and does provide end to end encryption like all OpenZiti Networks.</p>
<h2 dir="auto"><a id="user-content-hosting-option-1-configure-a-self-hosted-openziti-network" aria-hidden="true" href="#hosting-option-1-configure-a-self-hosted-openziti-network"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Hosting Option 1: Configure a self-hosted OpenZiti Network</h2>
<p dir="auto">The steps for this hosting option will guide you to self-host an OpenZiti Network by following <a href="https://openziti.github.io/ziti/quickstarts/network/hosted.html" rel="nofollow">the &#34;Run on your own server&#34; quickstart</a>.</p>
<p dir="auto">With that zero trust overlay in place you can follow these steps on your OpenZiti server to add the necessary entities.</p>
<ol dir="auto">
<li>
<p dir="auto">Create an identity for the webhook sender i.e. API consumer / client</p>
<div dir="auto" data-snippet-clipboard-copy-content="ziti edge create identity device github --jwt-output-file github.jwt --role-attributes webhookz-senders"><pre>ziti edge create identity device github --jwt-output-file github.jwt --role-attributes webhookz-senders</pre></div>
</li>
<li>
<p dir="auto">Create an identity for the webhook server</p>
<div dir="auto" data-snippet-clipboard-copy-content="ziti edge create identity device server --jwt-output-file server.jwt --role-attributes webhookz-servers"><pre>ziti edge create identity device server --jwt-output-file server.jwt --role-attributes webhookz-servers</pre></div>
</li>
<li>
<p dir="auto">Create a config with type <code>intercept.v1</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="ziti edge create config webhookz-intercept-config intercept.v1 &#39;{&#34;protocols&#34;:[&#34;tcp&#34;],&#34;addresses&#34;:[&#34;webhookz.ziti&#34;], &#34;portRanges&#34;:[{&#34;low&#34;:80, &#34;high&#34;:80}]}&#39;"><pre>ziti edge create config webhookz-intercept-config intercept.v1 <span><span>&#39;</span>{&#34;protocols&#34;:[&#34;tcp&#34;],&#34;addresses&#34;:[&#34;webhookz.ziti&#34;], &#34;portRanges&#34;:[{&#34;low&#34;:80, &#34;high&#34;:80}]}<span>&#39;</span></span></pre></div>
</li>
<li>
<p dir="auto">Create a config with type <code>host.v1</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="ziti edge create config webhookz-host-config host.v1 &#39;{&#34;protocol&#34;:&#34;tcp&#34;, &#34;address&#34;:&#34;httpbin&#34;,&#34;port&#34;:8080}&#39;"><pre>ziti edge create config webhookz-host-config host.v1 <span><span>&#39;</span>{&#34;protocol&#34;:&#34;tcp&#34;, &#34;address&#34;:&#34;httpbin&#34;,&#34;port&#34;:8080}<span>&#39;</span></span></pre></div>
</li>
<li>
<p dir="auto">Create a service to associate the two configs</p>
<div dir="auto" data-snippet-clipboard-copy-content="ziti edge create service webhookz-service --configs webhookz-intercept-config,webhookz-host-config"><pre>ziti edge create service webhookz-service --configs webhookz-intercept-config,webhookz-host-config</pre></div>
</li>
<li>
<p dir="auto">Create a bind service policy</p>
<div dir="auto" data-snippet-clipboard-copy-content="ziti edge create service-policy webhookz-bind-policy Bind --service-roles &#39;@webhookz-service&#39; --identity-roles &#39;#webhookz-servers&#39;"><pre>ziti edge create service-policy webhookz-bind-policy Bind --service-roles <span><span>&#39;</span>@webhookz-service<span>&#39;</span></span> --identity-roles <span><span>&#39;</span>#webhookz-servers<span>&#39;</span></span></pre></div>
</li>
<li>
<p dir="auto">Create a dial service policy</p>
<div dir="auto" data-snippet-clipboard-copy-content="ziti edge create service-policy webhookz-dial-policy Dial --service-roles &#39;@webhookz-service&#39; --identity-roles &#39;#webhookz-senders&#39;"><pre>ziti edge create service-policy webhookz-dial-policy Dial --service-roles <span><span>&#39;</span>@webhookz-service<span>&#39;</span></span> --identity-roles <span><span>&#39;</span>#webhookz-senders<span>&#39;</span></span></pre></div>
</li>
<li>
<p dir="auto">Copy &#34;github.jwt&#34; and &#34;server.jwt&#34; from the OpenZiti server to the computer where you cloned this repo.</p>
</li>
</ol>
<h2 dir="auto"><a id="user-content-hosting-option-2-configure-openziti-with-the-developer-sandbox" aria-hidden="true" href="#hosting-option-2-configure-openziti-with-the-developer-sandbox"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Hosting Option 2: Configure OpenZiti with the Developer Sandbox</h2>
<p dir="auto">We&#39;ll use Ziti Edge Developer Sandbox (ZEDS) in this example.</p>
<ol dir="auto">
<li>
<p dir="auto">Sign up for a free developer account at <a href="https://zeds.openziti.org/" rel="nofollow">https://zeds.openziti.org/</a>. We&#39;ll create a couple of identities to attach to an OpenZiti network provided by ZEDS.</p>
</li>
<li>
<p dir="auto">In ZEDS, follow the &#34;build your app&#34; button. Populate the form with an app name like &#34;my webhook app&#34;, two identities &#34;github&#34; and &#34;server&#34;, and a service named &#34;webhookz&#34;. Finish up with the &#34;build my app&#34; button.</p>
</li>
<li>
<p dir="auto">On the following screen click the edit button for the service &#34;webhookz&#34;.</p>
<ol dir="auto">
<li>Create a config with type <code>intercept.v1</code>.</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="{
    &#34;addresses&#34;: [
        &#34;webhookz.ziti&#34;
    ],
    &#34;protocols&#34;: [
        &#34;tcp&#34;
    ],
    &#34;portRanges&#34;: [
        {
        &#34;low&#34;: 80,
        &#34;high&#34;: 80
        }
    ]
}"><pre>{
    <span>&#34;addresses&#34;</span>: [
        <span><span>&#34;</span>webhookz.ziti<span>&#34;</span></span>
    ],
    <span>&#34;protocols&#34;</span>: [
        <span><span>&#34;</span>tcp<span>&#34;</span></span>
    ],
    <span>&#34;portRanges&#34;</span>: [
        {
        <span>&#34;low&#34;</span>: <span>80</span>,
        <span>&#34;high&#34;</span>: <span>80</span>
        }
    ]
}</pre></div>
<ol dir="auto">
<li>Create a config with type <code>host.v1</code>.</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="{
    &#34;port&#34;: 8080,
    &#34;address&#34;: &#34;httpbin&#34;,
    &#34;protocol&#34;: &#34;tcp&#34;
}"><pre>{
    <span>&#34;port&#34;</span>: <span>8080</span>,
    <span>&#34;address&#34;</span>: <span><span>&#34;</span>httpbin<span>&#34;</span></span>,
    <span>&#34;protocol&#34;</span>: <span><span>&#34;</span>tcp<span>&#34;</span></span>
}</pre></div>
</li>
<li>
<p dir="auto">Go back to &#34;manage app&#34; and click the download buttons to get the token files for identities &#34;github&#34; and &#34;server&#34;.</p>
</li>
</ol>
<h2 dir="auto"><a id="user-content-run-the-private-webhook-server" aria-hidden="true" href="#run-the-private-webhook-server"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Run the private webhook server</h2>
<p dir="auto">A private webhook server is included in this repo as a Docker Compose project to demonstrate how to publish an unmodified API producer with OpenZiti. These steps will guide you run and publish the server so it can receive the GitHub webhook via OpenZiti. The Compose project provides an OpenZiti sidecar to host the service that provides zero trust ingress to the server in an isolated Docker network.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/1434400/191101246-dcb23b17-3e33-4b67-98b7-51d7e4a7126e.svg"><img src="https://user-images.githubusercontent.com/1434400/191101246-dcb23b17-3e33-4b67-98b7-51d7e4a7126e.svg" alt="webhookz drawio (2)"/></a></p>
<ol dir="auto">
<li>
<p dir="auto">Copy &#34;github.jwt&#34; and &#34;server.jwt&#34; into the directory where you cloned this repo.</p>
</li>
<li>
<p dir="auto">In your terminal, change to the directory where you cloned this repo. Enroll &#34;github&#34; to obtain the identity file &#34;github.json&#34; in the current directory.</p>
<div dir="auto" data-snippet-clipboard-copy-content="docker run --rm --volume ${PWD}:/mnt/ openziti/quickstart /openziti/ziti-bin/ziti edge enroll /mnt/github.jwt "><pre>docker run --rm --volume <span>${PWD}</span>:/mnt/ openziti/quickstart /openziti/ziti-bin/ziti edge enroll /mnt/github.jwt </pre></div>
</li>
<li>
<p dir="auto">In the GitHub UI, create a new GitHub Actions secret named <code>ZITI_WEBHOOK_IDENTITY</code> with the contents of &#34;github.json&#34;.</p>
</li>
<li>
<p dir="auto">In your terminal, run the Docker Compose project to start the demo webhook server and OpenZiti tunneler.</p>
<div dir="auto" data-snippet-clipboard-copy-content="docker compose up --detach"><pre>docker compose up --detach</pre></div>
<p dir="auto">You should now have a new file &#34;server.json&#34; in the directory where you cloned this repo. That is the OpenZiti identity file used by the tunneler running in one of the containers.</p>
</li>
<li>
<p dir="auto">Finally, trigger the GitHub Actions workflow to demonstrate sending a GitHub webhook to your private server. Navigate to &#34;Actions&#34; / &#34;Main Workflow&#34; in the GitHub UI and punch the &#34;Run workflow&#34; button. You may instead trigger it with the GitHub CLI if your current directory is repo.</p>

</li>
<li>
<p dir="auto">Optionally, follow the private server&#39;s log to see the webhook activity from GitHub</p>
<div dir="auto" data-snippet-clipboard-copy-content="docker compose logs --follow httpbin"><pre>docker compose logs --follow httpbin</pre></div>
</li>
</ol>
<p dir="auto">The result of the triggered workflow will be an HTTP response from the <code>httpbin</code> application echoing the payload and headers it received.</p>
<h2 dir="auto"><a id="user-content-have-questions" aria-hidden="true" href="#have-questions"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Have questions?</h2>
<ul dir="auto">
<li>Follow our <a href="https://openziti.io/" rel="nofollow">Blog</a></li>
<li>Join <a href="https://openziti.discourse.group" rel="nofollow">Discussion</a></li>
<li><a href="https://github.com/openziti">Development</a></li>
<li><a href="https://openziti.github.io" rel="nofollow">Documentation</a></li>
<li>Like it? Give us a <a href="https://github.com/openziti/ziti">star</a></li>
</ul>
</article>
          </div></div>
  </body>
</html>
