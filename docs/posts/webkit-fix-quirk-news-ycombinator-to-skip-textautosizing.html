<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/WebKit/WebKit/commit/84ae355619354ee1bfa7daaa1fc95565a6726be3">Original</a>
    <h1>WebKit fix: Quirk news.ycombinator to skip TextAutoSizing</h1>
    
    <div id="readability-page-1" class="page"><div><pre>rdar://127246368
<a href="https://bugs.webkit.org/show_bug.cgi?id=275221" rel="nofollow">https://bugs.webkit.org/show_bug.cgi?id=275221</a>

Reviewed by Sammy Gill.

We won&#39;t try to adjust computed font sizes if (visibleWidth &gt;= width())
at RenderBlockFlow::adjustComputedFontSizes.

On the first load, RenderBlockFlow::width is calculated to a value that
allows TextAutoSizing to set new computed font sizes for the text nodes
on the page. Width is much larger than visibleWidth, ultimately coming from
WebPageProxy::textAutosizingWidth which returns WebCore::screenSize().width().

At refresh,RenderBlockFlow::width returns a value that is actually equal
to visibleWidth (and screenSize().width()). There seems to depend on
timing. I wasn&#39;t able to reproduce that when simulator CPU load was too
high.

Since the page where the bug manifests itself already has responsive CSS
styling, we can quirk TextAutoSizing to skip adjusting for it, at least
until we figure out why we are calculating RenderBlockFlow width inconsistently:
<a href="https://bugs.webkit.org/show_bug.cgi?id=275223" rel="nofollow">https://bugs.webkit.org/show_bug.cgi?id=275223</a>

* Source/WebCore/page/LocalFrameViewLayoutContext.cpp:
(WebCore::LocalFrameViewLayoutContext::applyTextSizingIfNeeded):
* Source/WebCore/page/Quirks.cpp:
(WebCore::Quirks::skipTextAutoSizing const):
* Source/WebCore/page/Quirks.h:

Canonical link: <a href="https://commits.webkit.org/279788@main" rel="nofollow">https://commits.webkit.org/279788@main</a></pre></div></div>
  </body>
</html>
