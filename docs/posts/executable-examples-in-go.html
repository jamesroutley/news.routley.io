<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bitfieldconsulting.com/golang/examples">Original</a>
    <h1>Executable Examples in Go</h1>
    
    <div id="readability-page-1" class="page"><div data-block-type="23" id="block-yui_3_17_2_1_1667996240487_25377"><div><p>As we saw in <a href="https://bitfieldconsulting.com/golang/test-names">Test names should be sentences</a>, there’s a lot of valuable information our Go tests can communicate to readers, starting with the test names, and continuing with the logic of the tests themselves. By using the system in a test, we can not just verify things about its behaviour, but also show <em>users</em> how they can call the system, and how they should expect it to behave.</p>
<p>That’s great, but sometimes these two aims conflict a little. For example, many tests require a fair amount of code to set up an environment that resembles the one in which it would really be used. But <em>users</em> don’t need to do that, because they’re writing real programs, not tests. So the communication aspect gets slightly obscured by the verification aspect.</p>
<p>Similarly, while we might write wonderful documentation comments on each of our exported functions, our <em>tests</em> won’t appear as part of the resulting autogenerated documentation. So someone reading about your package on <a href="https://pkg.go.dev/"><code>pkg.go.dev</code></a>, for example, will see your documentation, but not your code or tests.</p>
<p>What we’d like is a way to write code that will be included in the autogenerated documentation, <em>and</em> whose behaviour can be automatically verified in the same way as the tests. That’s exactly what Go provides, with a feature called <em>executable examples</em>.</p>
<blockquote>
<p><em>A good example can be a more succinct or intuitive way to convey the behavior of a library function than its prose description, especially when used as a reminder or quick reference.</em><br/>
</p>
<p><em>And unlike examples within comments, example functions are real Go code, subject to compile-time checking, so they don’t become stale as the code evolves.</em><br/>
</p>
<p>—Alan Donovan &amp; Brian Kernighan, <a href="https://amzn.to/3ObBI2O">“The Go Programming Language”</a></p>
</blockquote>
<p>An executable example is like a test function, but even simpler. Its name must begin with the word <code>Example</code>, but it doesn’t take any parameters, or return anything:</p>
<div id="cb1"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span>func</span> ExampleDouble<span>()</span> <span>{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    fmt<span>.</span>Println<span>(</span>double<span>.</span>Double<span>(</span><span>2</span><span>))</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span>// Output:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span>// 4</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>(<a href="https://github.com/bitfield/tpg-tests/blob/main/double/2/double_test.go">Listing <code>double/2</code></a>)</p>
<p>Very straightforward. In this example, we call <code>Double(2)</code> and print the result. A comment shows that the expected output is 4.</p>
<p>So what? Well, the neat thing is that this example function is automatically included in the documentation for your package. Here’s what that might look like on <a href="https://pkg.go.dev/"><code>pkg.go.dev</code></a>:</p>
</div></div><div data-block-type="23" id="block-yui_3_17_2_1_1667998707645_4581"><div><p>We can see that the program has been reformatted to put the example code inside a <code>main</code> function, and that the expected output is shown separately.</p>
<p>Indeed, you can run the example directly in your browser by clicking the <em>Run</em> button on the website. Try it with the examples from the <a href="https://github.com/bitfield/script"><code>script</code></a> package:</p>
<ul>
<li><a href="https://pkg.go.dev/github.com/bitfield/script">https://pkg.go.dev/github.com/bitfield/script</a></li>
</ul>
<p>When you click <em>Run</em>, the example program is built, its dependencies downloaded, the resulting binary run, and the output displayed, all right in the browser. You can also edit the example to do whatever you like, and try out your modified program in the same way.</p>
<p>In fact, the examples are being run using the <a href="https://go.dev/blog/playground">Go Playground</a>, and you can do the same kind of thing by browsing to:</p>
<ul>
<li><a href="https://go.dev/play/">https://go.dev/play/</a></li>
</ul>
<p>and entering whatever program you like.</p>
</div></div><div data-block-type="23" id="block-yui_3_17_2_1_1667998707645_11712"><div><p>There are some common-sense restrictions on code that runs in the playground (and thus on executable examples running on <code>pkg.go.dev</code>). For example, there’s no networking available, and the amounts of CPU, memory, and execution time are limited to prevent abuse.</p>
<p>And, interestingly, you’ll find that the time and date returned the first time you call <code>time.Now</code> in playground programs is always the same: 11pm on <a href="https://opensource.googleblog.com/2009/11/hey-ho-lets-go.html">Tuesday, November 10, 2009</a>. This is a significant date for Gophers, naturally, but it also means that the behaviour of time-related code is deterministic.</p>
<p>When you run your examples locally, on your own machine, using <code>go test</code>, these restrictions don’t apply, but just be aware that they <em>will</em> apply to people running them on <code>go.pkg.dev</code>.</p>
<p>Your executable examples are not only included in the documentation for your package, but they’re also run whenever you run <code>go test</code>. What exactly is being <em>tested</em> here, then, you might wonder? And how could such a test fail?</p>
<p>Let’s try changing the comment showing the expected output, and see what happens. For example, suppose we make it “5”, instead of “4”:</p>
<div id="cb1"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span>func</span> ExampleDouble<span>()</span> <span>{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    fmt<span>.</span>Println<span>(</span>double<span>.</span>Double<span>(</span><span>2</span><span>))</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span>// Output:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span>// 5</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>Running <code>go test</code> produces this result:</p>
<pre><code>--- FAIL: ExampleDouble (0.00s)
got:
4
want:
5
FAIL</code></pre>
<p>So that <code>Output</code> comment is not <em>just</em> a comment, it turns out. It’s also an <em>expectation</em> that the test machinery will verify.</p>
<p>We check the behaviour of the function, in other words, by asserting something about its standard output, ignoring any leading and trailing whitespace.</p>
<p>We can use examples to test functions that <em>print</em> to standard output by just calling them directly. Indeed, it’s easier to test such functions using executable examples than it would be with a regular test:</p>
<div id="cb3"><pre><code><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span>func</span> ExamplePrintHello<span>()</span> <span>{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    PrintHello<span>()</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span>// Output:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span>// Hello</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>If the function doesn’t happen to print anything, but instead returns a result, we can use <code>fmt.Println</code> to print that result, as in the <code>Double</code> example, and then verify it with the <code>Output</code> comment.</p>
<p>We can also match multiline output, if necessary:</p>
<div id="cb4"><pre><code><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span>func</span> ExamplePrintHello<span>()</span> <span>{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    PrintHello<span>()</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    PrintHello<span>()</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span>// Output:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span>// Hello</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span>// Hello</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>If we know what <em>lines</em> should be present in the output, but not in what <em>order</em> they will appear, we can use a different version of the <code>Output</code> comment:</p>
<div id="cb5"><pre><code><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span>func</span> ExamplePrintMap<span>()</span> <span>{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    m <span>:=</span> <span>map</span><span>[</span><span>int</span><span>]</span><span>bool</span><span>{</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span>1</span><span>:</span> <span>true</span><span>,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span>3</span><span>:</span> <span>true</span><span>,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span>2</span><span>:</span> <span>false</span><span>,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span>}</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span>for</span> k<span>,</span> v <span>:=</span> <span>range</span> m <span>{</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        fmt<span>.</span>Println<span>(</span>k<span>,</span> v<span>)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span>}</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span>// Unordered output:</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span>// 1 true</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span>// 2 false</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span>// 3 true</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>By specifying the example’s <em>unordered</em> output, we’re saying that each of these lines must be present in the output, but they can appear in a different order to that given. This will likely be true when ranging over a map, for example.</p>
<p>You might also be wondering how Go knows that <code>ExampleDouble</code>, for instance, should be attached to the documentation for the <code>Double</code> function. That’s easy: whatever follows the word <code>Example</code> in the example name is taken to be the name of the function it documents.</p>
<p>So if your function is called <code>Greet</code>, and you want to provide an example for it, you would name that example function <code>ExampleGreet</code>. The documentation tool will then automatically associate the example with the <code>Greet</code> function.</p>
<p>What if you want to give more than one example for the same function? You can do that by adding a suffix after the function name:</p>
<div id="cb6"><pre><code><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span>func</span> ExampleDouble_with2<span>()</span> <span>{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    fmt<span>.</span>Println<span>(</span>double<span>.</span>Double<span>(</span><span>2</span><span>))</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span>// Output:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span>// 4</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span>}</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span>func</span> ExampleDouble_with3<span>()</span> <span>{</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    fmt<span>.</span>Println<span>(</span>double<span>.</span>Double<span>(</span><span>3</span><span>))</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span>// Output:</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span>// 6</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>(<a href="https://github.com/bitfield/tpg-tests/blob/main/double/2/double_test.go">Listing <code>double/2</code></a>)</p>
<p>In fact, you can supply as many examples as you want, provided each has a unique name, whose suffix begins with a lowercase letter (for example, <code>with2</code>).</p>
<p>If you want to write an example for the whole <em>package</em>, rather than any specific function, just name it <code>Example</code>:</p>
<div id="cb7"><pre><code><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span>func</span> Example<span>()</span> <span>{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span>// this demonstrates how to use the entire package</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span>...</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>Otherwise, Go will assume that whatever follows the word <code>Example</code> is the name of the thing you’re documenting.</p>
<p>This works with types, too. Suppose you define some type <code>User</code>:</p>
<div id="cb8"><pre><code><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span>type</span> User <span>struct</span> <span>{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    Name <span>string</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>(<a href="https://github.com/bitfield/tpg-tests/blob/main/user/1/user.go">Listing <code>user/1</code></a>)</p>
<p>As part of your documentation, you can supply an example in your test file:</p>
<div id="cb9"><pre><code><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span>func</span> ExampleUser<span>()</span> <span>{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    u <span>:=</span> user<span>.</span>User<span>{</span> Name<span>:</span> <span>&#34;Gopher&#34;</span> <span>}</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    fmt<span>.</span>Println<span>(</span>u<span>)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span>// Output:</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span>// </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>(<a href="https://github.com/bitfield/tpg-tests/blob/main/user/1/user_test.go">Listing <code>user/1</code></a>)</p>
<p>What about <em>methods</em> on types? We can give examples for those too. Suppose you add a method on <code>User</code> named <code>NameString</code>, to return the user’s name as a string:</p>
<div id="cb10"><pre><code><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span>func</span> <span>(</span>u User<span>)</span> NameString<span>()</span> <span>string</span> <span>{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span>return</span> u<span>.</span>Name</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>(<a href="https://github.com/bitfield/tpg-tests/blob/main/user/1/user.go">Listing <code>user/1</code></a>)</p>
<p>You can add an example to your test file that shows what this method does:</p>
<div id="cb11"><pre><code><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span>func</span> ExampleUser_NameString<span>()</span> <span>{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    u <span>:=</span> user<span>.</span>User<span>{</span>Name<span>:</span> <span>&#34;Gopher&#34;</span><span>}</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    fmt<span>.</span>Println<span>(</span>u<span>.</span>NameString<span>())</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span>// Output:</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span>// Gopher</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>(<a href="https://github.com/bitfield/tpg-tests/blob/main/user/1/user_test.go">Listing <code>user/1</code></a>)</p>
<p>The convention is simple: the word <code>Example</code> is followed by the name of the type we’re documenting (in this case <code>User</code>), then an underscore, then the name of the specific method (here it’s <code>NameString</code>).</p>
<p>It’s always a great idea to use code examples as part of our documentation anyway, but if they’re just text, there’s a danger that they’ll become out of date and stop working. Indeed, they might never have worked in the first place.</p>
<p>We’ve probably all had the unpleasant experience of copying and pasting an example code snippet from someone’s documentation, and finding not only that it doesn’t behave the way we expected, but that it doesn’t even compile. Not a good look for the project.</p>
<p>So it’s nice that Go provides a way for us to supply examples that are automatically included in our documentation, that users can edit and run in a web browser without even needing Go installed, and that are also automatically checked every time we run <code>go test</code>.</p>
<p>Go itself uses executable examples quite widely in the standard library documentation (see the <a href="https://pkg.go.dev/strings"><code>strings</code> package</a> documentation, for instance). But most third-party packages don’t bother to include examples, which I think is a shame. It’s an easy way to add a lot of value to your package, and also lends a rather professional appearance to its documentation.</p>
</div></div></div>
  </body>
</html>
