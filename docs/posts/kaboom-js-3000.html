<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://kaboomjs.com/blog/3000">Original</a>
    <h1>Kaboom.js 3000</h1>
    
    <div id="readability-page-1" class="page"><div><div>
<blockquote>
<p>tga, 01/15/2023</p>
</blockquote>
<p>We&#39;re releasing Kaboom v3000 beta! This major version update includes a lot of new features and improvements, and also breaking changes (see migration guide below).</p>
<p>To try the beta version, install <code>kaboom@next</code></p>
<pre><code>$ npm install kaboom@next
</code></pre>
<pre><code><span>&lt;<span>script</span> <span>src</span>=<span>&#34;https://unpkg.com/kaboom@next/dist/kaboom.js&#34;</span>&gt;</span><span>&lt;/<span>script</span>&gt;</span>
</code></pre>
<p>or use <a href="https://replit.com/@slmjkdbtl/kaboom3000">this Replit template</a></p>
<p>Note that this is a beta release, there are bugs and possiblly breaking changes before official release. Please report bugs to <a href="https://github.com/replit/kaboom/issues">github issues</a>, and general questions / discussions to <a href="https://github.com/replit/kaboom/discussions">github discussions</a>.</p>
<h2 id="scene-graph">Scene Graph</h2>
<p>Objects can now have children with <code>obj.add()</code>! Children will inherit the transform (position, scale and rotation) of the parent.</p>
<pre><code><span>const</span> bean = <span>add</span>([
    <span>sprite</span>(<span>&#34;bean&#34;</span>),
    <span>pos</span>(<span>160</span>, <span>120</span>),
])

<span>const</span> sword = bean.<span>add</span>([
    <span>sprite</span>(<span>&#34;sword&#34;</span>),
    
    <span>pos</span>(<span>20</span>, <span>20</span>),
    <span>rotate</span>(<span>20</span>),
])

<span>const</span> hat = bean.<span>add</span>([
    <span>sprite</span>(<span>&#34;hat&#34;</span>),
    
    <span>pos</span>(<span>0</span>, -<span>10</span>),
])


bean.<span>moveBy</span>(<span>100</span>, <span>200</span>)


bean.<span>destroy</span>()
</code></pre>
<p>Check out the rotating pineapples in this live example (in case you didn&#39;t notice, it also demonstrates rotating areas!)</p>


<h2 id="more-font-formats">More Font Formats</h2>
<p><code>loadFont()</code> now loads <code>.ttf</code>, <code>.otf</code>, <code>.woff</code>, <code>.woff2</code> fonts (any font that browser <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face#font_mime_types">font-face</a> supports). The function to load bitmap font is renamed to <code>loadBitmapFont()</code>.</p>
<pre><code>
<span>kaboom</span>({
    <span>font</span>: <span>&#34;ComicSans&#34;</span>,
})

<span>loadFont</span>(<span>&#34;ComicSans&#34;</span>, <span>&#34;assets/fonts/ComicSans.ttf&#34;</span>)


<span>loadFont</span>(<span>&#34;apl386&#34;</span>, <span>&#34;assets/fonts/apl386.ttf&#34;</span>, { <span>outline</span>: <span>4</span>, <span>filter</span>: <span>&#34;linear&#34;</span> })


<span>loadBitmapFont</span>(<span>&#34;4x4&#34;</span>, <span>&#34;/examples/fonts/4x4.png&#34;</span>, <span>4</span>, <span>4</span>)
</code></pre>


<h2 id="tweening">Tweening</h2>
<pre><code><span>const</span> t = <span>tween</span>(
    
    obj.<span>pos</span>,
    
    <span>mousePos</span>(),
    
    <span>0.5</span>,
    
    <span>(<span>p</span>) =&gt;</span> obj.<span>pos</span> = p,
    
    easings.<span>easeOutElastic</span>,
)


t.<span>cancel</span>()

t.<span>onEnd</span>(<span>() =&gt;</span> {
    
})


<span>await</span> <span>tween</span>(...)
<span>await</span> <span>wait</span>(<span>1</span>)
<span>await</span> <span>tween</span>(...)
<span>await</span> <span>tween</span>(...)
<span>await</span> <span>wait</span>(<span>1</span>)
</code></pre>
<p>Go to <a href="https://www.cyberdemon.org/play?example=tween">tween example</a> to play around with it! Press left / right arrow key to change the interpolation function, mouse click anywhere to set destination.</p>


<h2 id="rotated-areas">Rotated Areas</h2>
<p>Previously Kaboom only supports unrotated AABB boxes for collision detection, now Kaboom supports collision detection and resolution between any arbitrary convex polygons (e.g. rotated rectangles).</p>
<pre><code>
<span>add</span>([
    <span>sprite</span>(<span>&#34;bean&#34;</span>),
    <span>pos</span>(<span>200</span>, <span>100</span>),
    <span>rotate</span>(<span>30</span>),
    <span>area</span>(),
])


<span>add</span>([
    <span>sprite</span>(<span>&#34;bean&#34;</span>),
    <span>pos</span>(<span>200</span>, <span>100</span>),
    <span>area</span>({ <span>shape</span>: <span>new</span> <span>Polygon</span>([<span>vec2</span>(<span>0</span>), <span>vec2</span>(<span>100</span>), <span>vec2</span>(-<span>100</span>, <span>100</span>)]) }),
])
</code></pre>
<p>Check out the new <a href="https://www.cyberdemon.org/play?example=collision">collision example</a>. Press Q / E to rotate bean, and arrow keys to move around and see how bean now reacts with others!</p>


<h2 id="improved-performance">Improved Performance</h2>
<p>Graphics performance improved ~3x - 50x, collision detection performance improved ~2x - 4x. Read more about this in <a href="https://www.cyberdemon.org/blog/3000-perf">this blog post</a>.</p>
<h2 id="custom-loading-screen">Custom Loading Screen</h2>
<p>Now you can draw your custom loading screen with <code>onLoading()</code> (note that this function runs every frame, you can only use the <code>drawXXX()</code> functions here)</p>
<pre><code>
<span>onLoading</span>(<span>() =&gt;</span> {

    
    <span>drawRect</span>({
        <span>width</span>: <span>width</span>(),
        <span>height</span>: <span>height</span>(),
        <span>color</span>: <span>rgb</span>(<span>0</span>, <span>0</span>, <span>0</span>),
    })

    
    <span>drawCircle</span>({
        <span>pos</span>: <span>center</span>(),
        <span>radius</span>: <span>32</span>,
        <span>end</span>: <span>map</span>(progress, <span>0</span>, <span>1</span>, <span>0</span>, <span>360</span>),
    })

    <span>drawText</span>({
        <span>text</span>: <span>&#34;loading&#34;</span> + <span>&#34;.&#34;</span>.<span>repeat</span>(<span>wave</span>(<span>1</span>, <span>4</span>, <span>time</span>() * <span>12</span>)),
        <span>font</span>: <span>&#34;monospace&#34;</span>,
        <span>size</span>: <span>24</span>,
        <span>anchor</span>: <span>&#34;center&#34;</span>,
        <span>pos</span>: <span>center</span>().<span>add</span>(<span>0</span>, <span>70</span>),
    })

})
</code></pre>
<p>Another option is to turn off loading screen completely, default or custom:</p>
<pre><code><span>kaboom</span>({
    
    <span>loadingScreen</span>: <span>false</span>,
})
</code></pre>
<p>Try it ou in the <a href="https://www.cyberdemon.org/play?example=loader">loader</a> example! It also demonstrated some other loading techniques.</p>


<h2 id="post-effect">Post Effect</h2>
<p>Kaboom now provides an easy way to add full screen visual effect with shader:</p>
<pre><code><span>loadShader</span>(<span>&#34;pixelate&#34;</span>, <span>null</span>, <span>`
uniform float u_size;
uniform vec2 u_resolution;

vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
    if (u_size &lt;= 0.0) return def_frag();
    vec2 nsize = vec2(u_size / u_resolution.x, u_size / u_resolution.y);
    float x = floor(uv.x / nsize.x + 0.5);
    float y = floor(uv.y / nsize.y + 0.5);
    vec4 c = texture2D(tex, vec2(x, y) * nsize);
    return c * color;
}
`</span>)


<span>usePostEffect</span>(<span>&#34;pixelate&#34;</span>, {
    <span>&#34;u_resolution&#34;</span>: <span>vec2</span>(<span>width</span>(), <span>height</span>()),
    <span>&#34;u_size&#34;</span>: <span>4</span>,
})
</code></pre>
<p>Try it out in the <a href="https://www.cyberdemon.org/play?example=postEffect">postEffect</a> example. Use UP/DOWN arrow to cycle through the example effects!</p>


<h2 id="gamepad">Gamepad</h2>
<p>Added gamepad support.</p>
<pre><code><span>onGamepadButtonPress</span>(<span>&#34;south&#34;</span>, <span>() =&gt;</span> {
    player.<span>jump</span>()
})

<span>onGamepadStick</span>(<span>&#34;left&#34;</span>, <span>(<span>v</span>) =&gt;</span> {
    player.<span>move</span>(v.<span>scale</span>(<span>SPEED</span>))
})
</code></pre>
<p>If you gamepad doesn&#39;t work, add your gamepad mappings to Kaboom&#39;s <a href="https://github.com/replit/kaboom/blob/master/src/gamepad.json">gamepad mapping json file</a>.</p>
<p>Connect a gamepad and go nuts with this classic minigame!</p>


<h2 id="path-finding">Path Finding</h2>
<p>The level API has been rewored and added path finding support. Use the new <code>tile()</code> component with option <code>tile({ isObstacle: true })</code> to define obstacles in a level, and <code>agent()</code> component to</p>
<pre><code><span>const</span> map = <span>addLevel</span>([
    <span>&#34;##########&#34;</span>,
    <span>&#34;#        #&#34;</span>,
    <span>&#34;# @      #&#34;</span>,
    <span>&#34;#.....   #&#34;</span>,
    <span>&#34;#        #&#34;</span>,
    <span>&#34;#    ....#&#34;</span>,
    <span>&#34;#      $ #&#34;</span>,
    <span>&#34;#        #&#34;</span>,
    <span>&#34;##########&#34;</span>,
], {
    <span>tileWidth</span>: <span>64</span>,
    <span>tileHeight</span>: <span>64</span>,
    <span>tiles</span>: {
        <span>&#34;$&#34;</span>: <span>() =&gt;</span> [
            <span>sprite</span>(<span>&#34;coin&#34;</span>),
            <span>area</span>(),
        ],
        <span>&#34;#&#34;</span>: <span>() =&gt;</span> [
            <span>sprite</span>(<span>&#34;wall&#34;</span>),
            <span>tile</span>({ <span>isObstacle</span>: <span>true</span> }),
        ],
        <span>&#34;@&#34;</span>: <span>() =&gt;</span> [
            <span>sprite</span>(<span>&#34;player&#34;</span>),
            <span>tile</span>(),
            <span>agent</span>({ <span>speed</span>: <span>640</span>, <span>allowDiagonals</span>: <span>true</span> }),
            <span>&#34;player&#34;</span>,
        ],
    },
})

<span>const</span> player = <span>get</span>(<span>&#34;player&#34;</span>)[<span>0</span>]

<span>onClick</span>(<span>() =&gt;</span> {
    bean.<span>setTarget</span>(<span>mousePos</span>())
})
</code></pre>
<p>Run this maze example to see for yourself. Click anywhere in the maze to travel to it!</p>


<p>Path finding is implemented by <a href="https://github.com/mflerackers">@mflerackers</a></p>
<h3 id="more-features">More features</h3>
<p>See complete list of changes in <a href="https://github.com/replit/kaboom/blob/master/CHANGELOG.md">CHANGELOG</a></p>
<h2 id="migrating-to-v3000">Migrating to v3000</h2>
<p>You can check this <a href="https://kaboomjs.com/doc/migration-3000">doc</a></p>
</div></div></div>
  </body>
</html>
