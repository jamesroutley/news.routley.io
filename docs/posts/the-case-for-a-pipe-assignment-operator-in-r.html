<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://hughjonesd.github.io/case-for-pipe-assignment.html">Original</a>
    <h1>The case for a pipe assignment operator in R</h1>
    
    <div id="readability-page-1" class="page"><div id="quarto-content">

<main id="quarto-document-content">



<section id="assignment-in-r">

<p>Here are two key facts about R:</p>
<ul>
<li>R is <em>pass by value</em>;</li>
<li>R has complex, expressive idioms for assigning to subsets.</li>
</ul>
<p>Pass by value means that you can almost never change an object like this:</p>

<p>That just gives the function a copy of <code>obj</code>; the original <code>obj</code> will be unchanged. Instead, you write:</p>

<p>Complex subsetting means that not just simple objects can be on the left hand side of assigments. You can also write:</p>
<div id="cb3"><pre><code><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data[condition, cols] <span>&lt;-</span> <span>do_something</span>(data[condition, cols])</span></code></pre></div>
<p>This replaces the rows where <code>condition</code> is <code>TRUE</code> and the columns specified in <code>cols</code>. And there are lvalue functions too:</p>
<div id="cb4"><pre><code><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span>names</span>(data) <span>&lt;-</span> <span>str_remove</span>(<span>names</span>(data), <span>&#34;</span><span>\\</span><span>d+$&#34;</span>)</span></code></pre></div>
<p>Combining these can lead to expressive, but complex, transformations:</p>
<div id="cb5"><pre><code><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span>names</span>(data)[<span>1</span><span>:</span><span>2</span>] <span>&lt;-</span> <span>paste0</span>(<span>names</span>(data)[<span>1</span><span>:</span><span>2</span>], <span>&#34;_suffix&#34;</span>)</span></code></pre></div>
<p>The duplication here makes the code hard to read, and easy to break, for example by updating the subset index on the left hand side and forgetting to do the same on the right. You might prefer to break this down for legibility:</p>
<div id="cb6"><pre><code><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>index <span>&lt;-</span> <span>1</span><span>:</span><span>2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>new_names <span>&lt;-</span> <span>names</span>(data)[index]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>new_names <span>&lt;-</span> <span>paste0</span>(new_names, <span>&#34;_suffix&#34;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span>names</span>(data)[index] <span>&lt;-</span> new_names</span></code></pre></div>
</section>
<section id="the-pipe-operator">

<p>R 4.1.0 introduced the native pipe operator. A simple syntax transformation converts</p>

<p>into</p>

<p>The <code>x</code> on the left enters the function on the right, as its first argument.</p>
<p>In terms of language capabilities, this was a no-op: R didn’t gain the ability to do anything it couldn’t already do. But by putting the subject of the code first, and operations done to it in order, the pipe can make R code much more expressive:</p>
<div id="cb9"><pre><code><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span>library</span>(dplyr)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>mtcars <span>|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span>group_by</span>(gear) <span>|&gt;</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span>mutate</span>(<span>kw =</span> hp <span>*</span> <span>0.746</span>) <span>|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span>summarize</span>(<span>mean_kw =</span> <span>mean</span>(kw))</span></code></pre></div>
</section>
<section id="pipe-assignment">

<p>I’d like to propose a new <strong>pipe assignment</strong> operator for R. The pipe assignment operator would convert:</p>
<div id="cb10"><pre><code><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>obj <span>&lt;</span><span>|&gt;</span> <span>do_something</span>(...)</span></code></pre></div>
<p>into:</p>
<div id="cb11"><pre><code><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>obj <span>&lt;-</span> <span>do_something</span>(obj, ...)</span></code></pre></div>
<p>Equivalently, <code>obj &lt;|&gt; do_something()</code> can be read as <code>obj &lt;- obj |&gt; do_something()</code>.</p>
<p>Having this operator would make code simpler and more expressive, and reduce bugs. For example, the complex assignments above could be rewritten:</p>
<div id="cb12"><pre><code><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data[condition, cols] <span>&lt;-</span> <span>do_something</span>(data[condition, cols])</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span># becomes</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>data[condition, cols] <span>&lt;</span><span>|&gt;</span> <span>do_something</span>()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span>names</span>(data)[<span>1</span><span>:</span><span>2</span>] <span>&lt;-</span> <span>paste0</span>(<span>names</span>(data)[<span>1</span><span>:</span><span>2</span>], <span>&#34;_suffix&#34;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span># becomes</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span>names</span>(data)[<span>1</span><span>:</span><span>2</span>] <span>&lt;</span><span>|&gt;</span> <span>paste0</span>(<span>&#34;_suffix&#34;</span>)</span></code></pre></div>
<p>The new versions are easier to read: you only need to parse one complex expression, instead of two. And they are harder to break, because the left and right hand sides don’t need to be kept in sync.</p>
</section>
<section id="some-evidence">

<p>How useful would pipe assignment be? I used a <a href="https://github.com/hughjonesd/codesamples">newly-created database of R code</a> to look for assignments. The tables below show statistics from about 26,000 code snippets, from GitHub repositories, StackOverflow questions and R package examples (<a href="http://hughjonesd.github.io/find-pipeable-assignments.R">code</a>). I counted what proportion of assignments were <em>pipeable</em>, i.e. of the form <code>a &lt;- foo(a, ...)</code>. I also counted how many were <em>complex</em>, i.e. like <code>a$blah &lt;- foo(a$blah, ...)</code> or <code>a[subset] &lt;- foo(a[subset], ...)</code>.</p>
<div>
<div>

<table data-quarto-disable-processing="true" id="tab:unnamed-chunk-2">
<caption>Statistics of code snippets</caption><colgroup><col/><col/><col/><col/></colgroup><tbody><tr>
<th>Source</th><th>N</th><th>Pipeable (%)</th><th>Pipeable and complex (%)</th></tr>
<tr>
<td>GitHub</td><td>9738</td><td>10.8%</td><td>1.3%</td></tr>
<tr>
<td>StackOverflow</td><td>11333</td><td>7.6%</td><td>1.7%</td></tr>
<tr>
<td>Examples</td><td>6323</td><td>3.9%</td><td>0.7%</td></tr>
</tbody></table>

</div>
</div>
<p>About 4-10% of all assignments could be simplified using an assignment pipe. That is a big potential gain, because assignment is probably the single most common operation in R code. The GitHub data contains about 9000 uses of <code>&lt;-</code>, of which about 900 could be simplified. For comparison, it contains about 740 uses of the function <code>median</code>. Even in the R examples, which are meant to be concise, 4% of assignments were of the form <code>x &lt;- foo(x)</code>.</p>
<p>A smaller proportion of assignments are both pipeable and complex. Here are some standout cases of long, complex assignments:</p>
<div id="cb13"><pre><code><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span># from StackOverflow questions:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>w[(midpoint <span>-</span> formerBreak)<span>:</span>(midpoint <span>+</span> formerBreak), </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  (midpoint <span>-</span> formerBreak)<span>:</span>(midpoint <span>+</span> formerBreak)] <span>&lt;-</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  w[(midpoint <span>-</span> formerBreak)<span>:</span>(midpoint <span>+</span> formerBreak), </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    (midpoint <span>-</span> formerBreak)<span>:</span>(midpoint <span>+</span> formerBreak)] <span>*</span> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    (wOld <span>==</span> <span>0</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>paretoData<span>$</span>EffectNames <span>=</span> <span>factor</span>(paretoData<span>$</span>EffectNames, </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span>levels =</span> <span>c</span>(<span>&#34;Pull Back(A)&#34;</span>, <span>&#34;Hook(B)&#34;</span>, <span>&#34;Peg(C)&#34;</span>, <span>&#34;AB&#34;</span>, <span>&#34;BC&#34;</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>             <span>&#34;AC&#34;</span>, <span>&#34;ABC&#34;</span>))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>mean.vis.aud.long<span>$</span>Visual <span>=</span> <span>Relevel</span>(mean.vis.aud.long<span>$</span>Visual,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                <span>ref =</span> <span>c</span>(<span>&#34;LeftCust&#34;</span>, <span>&#34;SIMCust&#34;</span>, <span>&#34;RightCust&#34;</span>))</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>data[data<span>$</span>category <span>==</span> category, ]<span>$</span>value <span>=</span> </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  data[data<span>$</span>category <span>==</span> category, ]<span>$</span>value <span>/</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  data[data<span>$</span>category <span>==</span> category <span>&amp;</span> </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>       data<span>$</span>year <span>==</span> baseYear,]<span>$</span>value[[<span>1</span>]]</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>wardmap<span>@</span>data <span>=</span> <span>data.frame</span>(</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                 wardmap<span>@</span>data, </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>                 mayor2015[</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                   <span>match</span>(wardmap<span>@</span>data[, <span>&#34;WARD&#34;</span>], </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>                   mayor2015[, <span>&#34;WARD&#34;</span>]), ])</span></code></pre></div>
<p>Got that 😉? Note that the last expression could be rewritten as</p>
<div id="cb14"><pre><code><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>wardmap<span>@</span>data <span>&lt;</span><span>|&gt;</span> (<span>function</span> (x) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span>data.frame</span>(x, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>             mayor2015[</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>               <span>match</span>(x[, <span>&#34;WARD&#34;</span>], mayor2015[, <span>&#34;WARD&#34;</span>]), </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>             ])<span>)</span>()</span></code></pre></div>
<p>It could be done even more simply if the pipe assignment operator had a way to pass the left hand side into multiple places. (And if there were a nice way to write anonymous function calls in R - but that’s another topic.)</p>
<p>StackOverflow questioners might not be good at writing simple code. What about Github? Here’s some examples:</p>
<div id="cb15"><pre><code><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data_for_model<span>$</span>factor_parameter_dictionary <span>=</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span>bind_rows</span>(data_for_model<span>$</span>factor_parameter_dictionary,    </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        <span>mutate</span>(<span>tibble</span>(<span>design_matrix_col =</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>            <span>names</span>(<span>select_if</span>(<span>distinct</span>(<span>select</span>(.data_spread, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>               <span>all_of</span>(<span>parse_formula</span>(formula)))), <span>function</span>(x) </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                       <span>is.numeric</span>(x)))), </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                       <span>factor =</span> design_matrix_col))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>HillTN95[(<span>1</span> <span>+</span> <span>nrow</span>(BasinSF) <span>*</span> (h <span>-</span> <span>1</span>))<span>:</span>(<span>1</span> <span>+</span> <span>nrow</span>(BasinSF) <span>*</span> (h <span>-</span> <span>1</span>) <span>+</span> (<span>nrow</span>(BasinSF) <span>-</span> <span>1</span>)), ] <span>=</span> </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  HillTN95[(<span>1</span> <span>+</span> <span>nrow</span>(BasinSF) <span>*</span> (h <span>-</span> <span>1</span>))<span>:</span>(<span>1</span> <span>+</span> <span>nrow</span>(BasinSF) <span>*</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    (h <span>-</span> <span>1</span>) <span>+</span> (<span>nrow</span>(BasinSF) <span>-</span> <span>1</span>)), ] <span># if you are lost, this is the end </span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                                      <span># of the original left hand side...</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    [<span>order</span>(HillTN95[(<span>1</span> <span>+</span> <span>nrow</span>(BasinSF) <span>*</span> (h <span>-</span> <span>1</span>))<span>:</span>(<span>1</span> <span>+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>      <span>nrow</span>(BasinSF) <span>*</span> (h <span>-</span> <span>1</span>) <span>+</span> (<span>nrow</span>(BasinSF) <span>-</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>      <span>1</span>)),]<span>$</span>Replicate),] <span># ... and here it is again</span></span></code></pre></div>
<p>I’m not saying duplicated variables are the <em>only</em> problems of this code. But duplicated variables certainly are not helping.</p>
<p>But even experienced R coders could benefit from this idiom. Here’s more GitHub examples, with some famous names:</p>
<div id="cb16"><pre><code><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span># tidyverse/tibble</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>x[needs_ticks] <span>&lt;-</span> <span>tick</span>(x[needs_ticks])</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span># RConsortium/S7</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>signature[sig_is_union] <span>&lt;-</span> <span>lapply</span>(signature[sig_is_union], <span>&#34;[[&#34;</span>, <span>&#34;classes&#34;</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>signature[<span>!</span>sig_is_union] <span>&lt;-</span> <span>lapply</span>(signature[<span>!</span>sig_is_union], list)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span># RevolutionAnalytics/dplyr-spark</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>mask <span>=</span> <span>sapply</span>(values, is.factor)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>values[mask] <span>=</span> <span>lapply</span>(values[mask], as.character)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>mask <span>=</span> <span>sapply</span>(values, is.character)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>values[mask] <span>=</span> <span>lapply</span>(values[mask], encodeString)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span># r-forge/optimizer</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>expr[[i]] <span>&lt;-</span> <span>nlsSimplify</span>(expr[[i]], simpEnv, <span>verbose =</span> verbose)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span># tidyverse/ggplot2</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span>colnames</span>(coef) <span>&lt;-</span> <span>to_lower_ascii</span>(<span>colnames</span>(coef))</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span># cran/Matrix</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>x<span>@</span>x <span>&lt;-</span> <span>zapsmall</span>(x<span>@</span>x, <span>digits =</span> digits)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span># wch/r-source</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span># Yes, this is the R source code itself!</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>x<span>$</span>sec <span>&lt;-</span> <span>trunc</span>(x<span>$</span>sec)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>res<span>$</span>ar <span>&lt;-</span> <span>aperm</span>(res<span>$</span>ar, <span>c</span>(2L,3L,1L))</span></code></pre></div>
<p>Lastly, here’s some example code from R packages:</p>
<div id="cb17"><pre><code><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span># jrSiCKLSNMF::CalculateUMAPSickleJr</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>SimSickleJrSmall<span>&lt;-</span><span>CalculateUMAPSickleJr</span>(SimSickleJrSmall,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span>umap.settings=</span>umap.settings)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>SimSickleJrSmall<span>&lt;-</span><span>CalculateUMAPSickleJr</span>(SimSickleJrSmall,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span>umap.settings=</span>umap.settings,<span>modality=</span><span>1</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>SimSickleJrSmall<span>&lt;-</span><span>CalculateUMAPSickleJr</span>(SimSickleJrSmall,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span>umap.settings=</span>umap.settings,<span>modality=</span><span>2</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span># rms::predictrms</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>dat <span>&lt;-</span> <span>cbind</span>(dat, <span>predict</span>(fit, dat, <span>se.fit=</span><span>TRUE</span>))</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span># oce::`[[&lt;-,section-method`        </span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>section[[<span>&#34;sectionId&#34;</span>]] <span>&lt;-</span> <span>toupper</span>(section[[<span>&#34;sectionId&#34;</span>]])</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>section[[<span>&#34;station&#34;</span>, <span>10</span>]][[<span>&#34;temperature&#34;</span>]] <span>&lt;-</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span>1e-3</span> <span>+</span> section[[<span>&#34;station&#34;</span>, <span>10</span>]][[<span>&#34;temperature&#34;</span>]]</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span># inTrees:Num2Level</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>rfList<span>$</span>list[[i]][, <span>&#34;prediction&#34;</span>] <span>&lt;-</span>   </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span>data.frame</span>(<span>dicretizeVector</span>(rfList<span>$</span>list[[i]][, <span>&#34;prediction&#34;</span>],</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>                             splitV))</span></code></pre></div>
<p>Remember, examples are meant to be short and clear!</p>
<p>In all of these cases, I think <code>&lt;|&gt;</code> could make the code clearer, less repetitive and more readable.</p>
</section>
<section id="avoiding-hacks">

<p>Another advantage of an assignment pipe is that it obviates the need for hacks to get round it. One example, arguably, is dplyr’s <code>mutate()</code> function. Don’t get me wrong, I love dplyr and it really changed R data manipulation for the better. But one of its advantages is just that:</p>
<div id="cb18"><pre><code><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>... <span>|&gt;</span> <span>mutate</span>(<span>foo =</span> foo <span>+</span> <span>1</span>) <span>|&gt;</span> ...</span></code></pre></div>
<p>is easier to read than</p>

<p>And while mutate itself is powerful, it can only deal with one column at a time. When you want to change multiple columns, you have to use <code>across</code>, which looks like this:</p>
<div id="cb20"><pre><code><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>   ... <span>|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>       <span>mutate</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>         <span>across</span>(cols, <span>~</span> <span>foo</span>(.x)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>       ) <span>|&gt;</span> ....</span></code></pre></div>
<p>I’m <a href="https://medium.com/p/ae364da6a46f">not a fan</a> of <code>across</code>, I think it’s complex to read and understand (in fact, I got it wrong in the first version of the code above). But the key point is that it is a workaround for:</p>

</section>
<section id="implementing-it">

<p>If it’s such a good idea, why don’t I submit a patch?</p>
<p>Simply, I can’t code C, certainly not well enough to deal with the R source.</p>
<p><strong>Update</strong>: but in the spirit of laziness, impatience and hubris, here is a <a href="http://hughjonesd.github.io/pipe-assignment.patch">patch</a> and see <a href="https://github.com/hughjonesd/r-source/commit/de9b934ae89e59685f611022344570e0b51f2b3b">this commit on github</a>. Output:</p>
<div id="cb22"><pre><code><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>a <span>&lt;-</span> <span>1</span><span>:</span><span>5</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>a <span>&lt;</span><span>|&gt;</span> <span>mean</span>()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span>## [1] 3</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>a <span>&lt;-</span> <span>1</span><span>:</span><span>5</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>a[<span>1</span><span>:</span><span>2</span>] <span>&lt;</span><span>|&gt;</span> <span>rev</span>()</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span>## [1] 2 1 3 4 5</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span>names</span>(a) <span>&lt;-</span> letters[<span>1</span><span>:</span><span>5</span>]</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span>names</span>(a)[<span>3</span><span>:</span><span>4</span>] <span>&lt;</span><span>|&gt;</span> <span>paste0</span>(<span>&#34;-suffix&#34;</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span>##       a        b c-suffix d-suffix        e </span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span>##       2        1        3        4        5 </span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span># not everything works:</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>a <span>&lt;</span><span>|&gt;</span> <span>sqrt</span>() <span>|&gt;</span> <span>mean</span>()</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span>## Error in sqrt() : 0 arguments passed to &#39;sqrt&#39; which requires 1</span></span></code></pre></div>
<p>I <em>believe</em> that the assignment pipe could be implemented relatively simply, like the original native pipe <code>|&gt;</code>, as a syntax transformation.</p>
<p>So, I’m hoping that R Core will consider this possibility.</p>
<p>Meanwhile, R users can always import the magrittr package’s <code>%&lt;&gt;%</code> operator, which does what I’m calling for:</p>
<div>
<div id="cb23"><pre><code><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span>library</span>(magrittr)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>x <span>&lt;-</span> <span>1</span><span>:</span><span>5</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>x <span>%&lt;&gt;%</span> <span>mean</span>()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>

</div>
<p>The magrittr <code>%&lt;&gt;%</code> is not implemented at R source level, which makes it relatively slow and complex. I think the advantage of <code>&lt;|&gt;</code> is just the same as the advantage of <code>|&gt;</code> versus <code>%&gt;%</code>: it can be native and fast.</p>
<p>If you have comments or thoughts, drop me a line. I’m <span data-cites="davidhughjones">@davidhughjones</span> on X, or davidhughjones on gmail.</p>
<p>Merry Christmas/Season’s Greetings and a Happy New Year!</p>
</section>

</main>
<!-- /main column -->

</div></div>
  </body>
</html>
