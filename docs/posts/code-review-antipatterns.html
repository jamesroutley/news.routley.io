<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.chiark.greenend.org.uk/~sgtatham/quasiblog/code-review-antipatterns/">Original</a>
    <h1>Code review antipatterns</h1>
    
    <div id="readability-page-1" class="page">
    
    <p>[Simon Tatham, 2024-08-21]</p>
    <ul>
      <li>
        <a href="#intro">Introduction</a>
      </li>
      <li>
        <a href="#antipatterns">The antipatterns</a>
        <ul>
          <li>
            <a href="#round-trips">The Death of a Thousand Round Trips</a>
          </li>
          <li>
            <a href="#ransom-note">The Ransom Note</a>
          </li>
          <li>
            <a href="#double-team">The Double Team</a>
          </li>
          <li>
            <a href="#guessing-game">The Guessing Game</a>
          </li>
          <li>
            <a href="#priority-inversion">The Priority Inversion</a>
          </li>
          <li>
            <a href="#late-design">The Late-Breaking Design Review</a>
          </li>
          <li>
            <a href="#catch-22">The Catch-22</a>
          </li>
          <li>
            <a href="#flip-flop">The Flip Flop</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#the-point">But seriously, folks …</a>
        <ul>
          <li>
            <a href="#authority">Authority</a>
          </li>
          <li>
            <a href="#types">Gatekeeping code review</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#disclaimer">Disclaimer</a>
      </li>
    </ul>
    <h2 id="intro">Introduction</h2>
    <p>Code review seems like a great idea, right? Two developers
      looking at the same code means two chances to spot problems; it
      spreads understanding of the way the project is evolving; the
      reviewer can learn useful tricks from reading the author’s code
      in detail, or spot opportunities to teach the author a useful
      trick that they didn’t know already.</p>
    <p>But that’s only for ‘light side’ code reviewers, who use it to
      try to improve the code base and the developers’ collective
      skills. Code review can also be a powerful tool for totally
      different purposes. When a code reviewer turns to the dark side,
      they have a huge choice of ways to obstruct or delay
      improvements to the code, to annoy patch authors or discourage
      them completely, or to pursue other goals of their own.</p>
    <p>If you’ve only recently turned to the dark side, you might not
      have thought of all the possibilities yet. So here’s a list of
      code-review antipatterns, for the dark-side code reviewer who’s
      running out of ideas.</p>
    <h2 id="antipatterns">The antipatterns</h2>

    <h3 id="round-trips">The Death of a Thousand Round Trips</h3>
    <p>You start reading the code. As soon as you see a nitpick, you
      add a review comment pointing it out. Then you stop reading.</p>
    <p>The developer conscientiously fixes your nitpick, and submits a
      revised patch.</p>
    <p>You start reading that version. You spot another nitpick,
      independent of the first. You <em>could</em> perfectly well have
      mentioned it the first time, but you didn’t, because you didn’t
      get that far. So you point that out – and stop reading
      again.</p>
    <p>And so on. Iterate until the developer loses hope.</p>
    <p>If you’re in a very different time zone from the developer, you
      get a natural 24-hour round-trip time, so that the patch evolves
      as slowly as possible. If you’re in a nearby time zone, or the
      same one, then to delay the patch properly, you’ll have to
      arrange to be busy with several other things, so you have a good
      excuse for it taking you a day or two to get round to looking at
      each new version.</p>
    <p>Resist the temptation to make any remarks like ‘This is
      looking much better now.’ If you hint that you’re getting closer
      to being satisfied, you’ll give them reason to keep trying!</p>

    <h3 id="ransom-note">The Ransom Note</h3>
    <p>This particular patch seems <em>especially</em> important to
      the developer who submitted it. (Maybe they said that outright,
      as part of their argument trying to persuade you to take the
      patch. Or maybe you just read between the lines.)</p>
    <p>But this patch isn’t especially vital to you – so you’re in a
      position of power! Now you can hold the change they need hostage
      until they do lots of extra tangentially related work, which
      doesn’t really need to be in the same commit, but which is
      important to <em>you</em>.</p>
    <p>‘If you ever want to see your beloved patch again …’</p>

    <h3 id="double-team">The Double Team</h3>
    <p>One patch. Two reviewers.</p>
    <p>Every time one of you demands a change, the developer
      obediently makes it – and now the other one can complain
      instead!</p>
    <p>Keep taking turns to make incompatible demands. But always
      direct your comments at the developer. Avoid arguing directly
      with <em>each other</em> on the review thread, and don’t
      acknowledge any suggestion from the patch author that the two of
      you should talk to each other and come to a consensus about what
      the patch is supposed to look like.</p>
    <p>See how many times you can ping-pong the developer back and
      forth before they give up.</p>
    <p>(In a real emergency, if you can’t find an accomplice, you can
      try contradicting <em>your own</em> previous review comments.
      But normally someone will notice. It works better with two
      reviewers.)</p>

    <h3 id="guessing-game">The Guessing Game</h3>
    <p>There’s a problem, and lots of different possible ways to
      solve it. A developer has picked one solution and submitted a
      patch.</p>
    <p>Criticise that <em>particular</em> solution, on some grounds
      that don’t relate to whether or not it solves the problem. Keep
      your criticism vague and woolly: violation of an obscure design
      principle, perhaps, or incompatibility with some vapourware plan
      for future development in the same area. Make the criticism as
      irrelevant as possible to the thing they were really trying to
      achieve.</p>
    <p>If you make it vague enough, the developer won’t be able to
      think of any way to adapt their existing patch that they’re
      confident will address your criticisms. Their best bet is to
      choose a totally <em>different</em> solution to the original
      problem, and try implementing that instead.</p>
    <p>So now you can smack that one down too, in just as unhelpful a
      way!</p>
    <p>Don’t let the developer trap you into any conversation like
      ‘ok, how do you think this problem <em>should</em> be solved?’,
      or give any hint at a solution you’d be happy with. Sooner or
      later, they’ll lose the will to keep guessing.</p>

    <h3 id="priority-inversion">The Priority Inversion</h3>
    <p>In your first code review passes, pick small and simple nits.
      Variable names are a bit unclear; comments have typos in.</p>
    <p>Wait for the developer to fix those, and <em>then</em> drop
      your bombshell: there’s a much more fundamental problem with the
      patch, that needs a chunk of it to be completely rewritten –
      which means throwing away a lot of the nitpick fixes you’ve
      already made the developer do in that part of the patch.</p>
    <p>Nothing says ‘your work is not wanted, and your time is not
      valued’ better than making someone do a lot of work and then
      making them throw it away. This might be enough to make the
      developer give up, all by itself.</p>

    <h3 id="late-design">The Late-Breaking Design Review</h3>
    <p>An enormously complicated piece of work has been ongoing for
      weeks or months, in lots of separate patches. Half the work is
      already committed.</p>
    <p>You personally don’t agree with the design of the entire piece
      of work, but you weren’t consulted in the original discussions.
      Or maybe you were, but you were on the losing side of the
      debate.</p>
    <p>But now you’ve been asked to review a minor but important thing
      in the middle of it, like an easy fix for a bug that’s blocking
      lots of developers. This is your opportunity!</p>
    <p>Demand justification for the entire design of the work so far.
      If the developer doesn’t know the answers, because they’re just
      working on one small part of the overall job, then shrug –
      that’s not your problem, and you’re not hitting the ‘Approve’
      button until you’re satisfied.</p>
    <p>If you’re really lucky, perhaps you can even manipulate this
      developer into undoing some of the already-done work, by giving
      a plausible excuse why it’s necessary. Carefully avoid letting
      them know where to find the design discussions that contradict
      you.</p>

    <h3 id="catch-22">The Catch-22</h3>
    <p>If there’s one big patch, then it’s too hard to read! Demand it
      be split up into self-contained sub-pieces.</p>
    <p>On the other hand, if there are lots of little patches, then
      some of them make no sense on their own! So insist that they be
      glued back together.</p>
    <p>With any large enough piece of work you can surely find a
      reason to make <em>one</em> of those complaints; it’s just a
      matter of deciding which.</p>
    <p>It doesn’t have to be ‘number of patches in the pull request’.
      You can do this one with any kind of tradeoff that seems
      relevant in the particular case. For example, if the code is
      written legibly, it probably has unacceptably poor performance –
      or if it’s well optimised, it’s unreadable and hard to
      maintain.</p>

    <h3 id="flip-flop">The Flip Flop</h3>
    <p>There’s a type of change that people commonly make to the same
      part of the code, like adding an extra thing to a list. You’ve
      reviewed several of these changes before. Another one has just
      come along: the author has looked at the prior changes,
      carefully followed the existing pattern, and chosen you as a
      code reviewer because you’re clearly used to this area.</p>
    <p>Keep everybody on their toes by suddenly objecting to an aspect
      of the change that you’ve never had a problem with before.
      Following the existing pattern just isn’t good enough! The
      author ought to have anticipated that you’ve recently changed
      your mind about what this type of change should look like.</p>
    <p>What if the author points out your inconsistency, by showing
      the previous three identical changes where you didn’t raise this
      objection?</p>
    <p>Then you say ‘You’re right, those should be changed too.’ Be
      careful not to take any personal responsibility
      – <em>you’re</em> not volunteering to change all the existing
      cases. If you’re really lucky the developer will interpret this
      as instructions to change the existing cases themself, and then
      you’ve saved yourself a lot of effort.</p>

    <h2 id="the-point">But seriously, folks …</h2>
    <p>Up to here, this article has been a joke.</p>
    <p>(I’d hope I don’t even have to say that at all, but I’m
      sure <em>somebody</em> would have misunderstood otherwise.)</p>
    <p>I’m not <em>really</em> intending to encourage code reviewers
      to be annoying and obstructive. And I’m not even really
      suggesting that code reviewers <em>do</em> do all these bad
      things, at least on purpose, at least most of the time. Most of
      the descriptions above are exaggerations of what the reviewer
      really does. Or not even that: just an exaggeration of what
      it <em>feels</em> like, when you’re the frustrated patch
      submitter, and your patch has been stuck in review for weeks,
      and doesn’t feel as if it’s getting any closer.</p>
    <p>I really mean: <em>don’t</em> do these things! Try to minimise
      round trips, rather than maximising them. Ask for important
      rewrites (if needed) <em>before</em> picking all the trivial
      nits. When you criticise the patch, make constructive
      suggestions about what version of it you <em>would</em> accept.
      If you have opinions about the code base as a whole, raise them
      with all the developers in a general discussion, rather than
      being petty with the one developer whose patch you’re assigned
      to review. And if you do any of these things <em>by
      accident</em>, have some self-awareness about it: notice that
      you’ve made the developer’s life extra difficult by mistake,
      apologise, and try to compensate by being extra helpful. (Maybe
      even help to improve the actual code, either by writing your own
      revised version of this patch, or doing extra polishing in a
      followup patch of your own.)</p>
    
    <p>But if there’s a serious point to make here, I think it’s this.
      When one developer becomes the code reviewer for another one’s
      patch, that relationship creates temporary <em>authority</em>.
      The reviewer has the power to prevent that particular patch
      being committed, even if they don’t have any kind of authority
      over the patch submitter the rest of the time.</p>
    <p>With authority comes responsibility. You’re supposed to use the
      authority only for its intended purpose, and only as much as
      necessary. In this case, that’s to make the patch as good as
      possible, according to whatever definition of ‘good’ the
      development team as a whole has agreed on.</p>
    <p>So most of these antipatterns (or the milder behaviours that
      they’re caricaturing) are <em>abuses of authority</em>. The
      reviewer is using that temporary power over another developer as
      leverage to pursue some other personal agenda, perhaps
      independent of the goodness of the patch, or perhaps actively
      opposed to it.</p>
    <p>The personal agenda in question varies between these
      antipatterns. It could be some unrelated piece of work the
      reviewer is in favour of; it could be personal stylistic
      preferences that the reviewer hasn’t been able to get the rest
      of the team to adopt; it could be laziness, taking advantage of
      the opportunity to write a one-line description of what you want
      and let someone else do the hard work; it could just be plain
      resistance to change, or perhaps even a personal dislike of the
      patch submitter.</p>
    <p>And that dislike might be quite justifiable, if the patch
      submitter has done any of these bad behaviours when it was
      last <em>their</em> turn to be the code reviewer! That’s another
      reason you should use the code reviewer’s authority sparingly.
      If developers manage to get locked into a cycle of revenge
      against each other, your software project is doomed.</p>
    <h3 id="types">Gatekeeping code review</h3>
    <p>Up to this point, I’ve been focused on <em>peer</em> code
      review. The code reviewer and the patch submitter are
      colleagues; neither is in charge of the other; neither has the
      final say over the code base in general. That’s why the
      authority you get in a code review is <em>temporary</em>:
      tomorrow, after this patch lands, you won’t have it any more.
      The day after that, it might be the other way round.</p>
    <p>Also, in peer review situations, the code reviewer and the
      author are supposed to have basically the same goal. If there’s
      any serious disagreement about what features should go into the
      code at all, or how polished something needs to be before
      approval, or what the acceptable coding style is, it’s supposed
      to be dealt with outside the context of the code review.</p>
    <p>But in other kinds of code review situation, that’s not quite
      the way it works. In particular, if an outsider to your software
      project sends you an unsolicited patch, that’s very different.</p>
    <p>(This scenario usually comes up in free software, since anyone
      in the world can modify your source code, and some of them will
      try sending the changes back to you. But it can happen in other
      situations too – inside a company developing proprietary code, a
      developer in one team might try their luck sending a patch to
      another team’s project, if they particularly want a feature or
      fix that the other team hasn’t found effort for.)</p>
    <p>In this situation, there’s a much bigger chance that the
      receiver of the patch will be unwilling to accept it at all,
      either because they don’t think that change should be made in
      the first place, or they disagree completely with the way it was
      done. And in this case, that’s <em>not</em> an abuse of the
      temporary authority granted by being a peer reviewer: it’s a
      legitimate exercise of the <em>permanent</em> authority of being
      the person or team in charge of the project. It’s my software
      project – I get to decide what direction it goes in.</p>
    <p>When the code reviewer is in this ‘gatekeeping’ role, it’s not
      always wrong to criticise the patch on the grounds that it
      violates an existing general design principle or requirement
      (<a href="#guessing-game">The Guessing Game</a>), without
      suggesting how the same problem could be solved better. Maybe I
      don’t <em>know</em> how that problem could be solved in a way
      that’s consistent with the requirement. In fact, maybe that’s
      precisely the hard part, and the only reason why I haven’t
      already made the same change myself!</p>
    <p>But even in a gatekeeping context, it’s rude to deploy ‘The
      Guessing Game’ <em>without explaining</em>. When I do this, I
      generally try to explain how the developer has overlooked the
      hard part, and if I don’t know the answer myself, I’ll say so.</p>
    <p>And, of course, there’s still no excuse
      for <em>passive-aggressive</em> obstructiveness
      like <a href="#round-trips">The Death of a Thousand Round
      Trips</a>. If you genuinely don’t want the patch in the code at
      all, and you’re in a gatekeeping role with the legitimate
      authority to make that decision, you can <em>say so</em> in
      words, so the submitter doesn’t waste any more time on it!</p>
    <h2 id="disclaimer">Disclaimer</h2>
    <p>I’ve been collecting notes towards this article for many years,
      from code reviews I’ve participated in (on <em>both</em> sides),
      code reviews I’ve observed between others, and code reviews I’ve
      only heard about in conversation.</p>
    <p>So it’s not aimed at any specific person who’s reviewed my code
      recently!</p>
  

</div>
  </body>
</html>
