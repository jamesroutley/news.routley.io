<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.confessionsofadataguy.com/replacing-pandas-with-polars-a-practical-guide/">Original</a>
    <h1>Replacing Pandas with Polars</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="text">
<p>I remember those days, oh so long ago, it seems like another lifetime. I haven’t used <a href="https://pandas.pydata.org/">Pandas</a> in many a year, decades, or whatever. We’ve all been there, done that. <a href="https://pandas.pydata.org/">Pandas</a> I mean. I would dare say it’s a rite of passage for most data folk. For those using Python, it’s probably one of the first packages you use other than say … <a href="https://pypi.org/project/requests/">requests</a>?</p>
<p>You know, Pandas feels like <a href="https://airflow.apache.org/">Airflow</a>, everyone keeps talking about its demise, but there it is everywhere … used by everyone. Sure it’s old, wrinkled, annoying, slow, and obtuse, but it’s ours, and that makes it the words of <a href="https://lotr.fandom.com/wiki/Gollum">Gollum</a> … precious.</p>
<p>We should probably get to the point already. Everyone is talking about <a href="https://www.pola.rs/">Polars</a>. <a href="https://www.pola.rs/">Polars</a> is supposed to replace Pandas. Will it? Maybe 10 years from now. You can’t untangle Pandas from everywhere it exists overnight. Do you still want to replace Pandas with Polars and be one of the cool kids? Ok. Let’s take a look at a practical guide to replacing Pandas with Polars, comparing functionally used by most people. <a href="https://github.com/danielbeach/PandasVsPolars">My code is available on GitHub</a>.</p>

<h2>Gentle Introduction to Polars … and Pandas.</h2>
<p>I’m sure you highly informed people don’t need me to give you a background on what exactly Pandas and Polars are and do, but let’s not assume everything. Here’s what we can say about them both.</p>
<ul>
<li><strong>Both tools are heavily used via Python.</strong></li>
<li><strong>Both tools are used to manipulate data by legions of people.</strong></li>
<li><strong>Both tools are Dataframe based (aka that’s why people use them).</strong></li>
<li><strong>Both tools try to give aggregated-based operations on Dataframes.</strong></li>
<li><strong>Both tools try to give options for the read-and-write complexity of different data sources.</strong></li>
<li><strong>Both tools are used to transform data sets.</strong></li>
</ul>
<p>I mean for better or worse that’s why the data world fell in love with Pandas. It makes working with data <strong>easy</strong>, or <strong>easier</strong> than most other options available. We, humans, are lazy beings, eating potato chips on the couch, we want life to be filled with luxury and fine things. That my friend is why Pandas rose to power and defeats all others trying to dethrone it.</p>
<p>Will Polars be the one to step into the ring, and throw the knockout punch? Who knows. I can say it will depend on how easy it is to replace Pandas with <a href="https://pola-rs.github.io/polars-book/user-guide/">Polars</a>.</p>
<blockquote><p>If it were always a simple question of “what’s faster,” the software world would look much different than it does today. In the end, there are fickle and biased humans at the end of the line, the consumers of this software, and they don’t always follow reason or logic … aka what’s faster.</p></blockquote>
<p>Let’s move on.</p>
<h2>Side-by-side functionality, Pandas vs Polars.</h2>

<p>I’ve been curious about this myself, and I think it’s a good exercise in understanding to find out what the average data user will find when trying to replace Polars with Pandas. Sure, we all know Pandas is slow, runs out of memory, and the like. We know that Polars is fast and able to deal with larger-than-memory data sets, etc, but that I not what I want to focus on today.</p>
<p>I will try to mention some of those nice <a href="https://pola-rs.github.io/polars-book/user-guide/">Polars</a> features later if time permits. But, let’s simply compare normal, everyday things that folks do in and with Pandas, try them with Polars and find out what we find out. That begs the question, what should we try?</p>
<ul>
<li>Reading and writing CSV files.</li>
<li>Reading and writing Parquet files.</li>
<li>Renaming, adding, or removing a column, and also transforming one column into a new one.</li>
<li>Aggregations and Grouping.</li>
</ul>
<p>Let’s get started!</p>
<h3>Reading and writing CVS files.</h3>
<p><img decoding="async" loading="lazy" src="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/carbon-1-4.png" alt="" width="723" height="428" srcset="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/carbon-1-4.png 723w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/carbon-1-4-300x178.png 300w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/carbon-1-4-705x417.png 705w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/carbon-1-4-450x266.png 450w" sizes="(max-width: 723px) 100vw, 723px"/></p>
<p>Well, the formatting is much nicer and contains more info in Polars.</p>
<p><img decoding="async" loading="lazy" src="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-11.14.12-AM-1030x253.png" alt="" width="1030" height="253" srcset="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-11.14.12-AM-1030x253.png 1030w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-11.14.12-AM-300x74.png 300w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-11.14.12-AM-768x189.png 768w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-11.14.12-AM-1536x378.png 1536w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-11.14.12-AM-2048x503.png 2048w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-11.14.12-AM-1500x369.png 1500w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-11.14.12-AM-705x173.png 705w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-11.14.12-AM-450x111.png 450w" sizes="(max-width: 1030px) 100vw, 1030px"/></p>
<p>Polars.</p>
<p>Having the nice format and data types at your fingertips with Polars is very nice. Especially when trying to explore new datasets, probably seems small detail but is very helpful.</p>
<h3>Reading and writing Parquet files.</h3>
<p>Parquet files have become very common these days, when exploring and munging data it’s very common to read and write local parquet files. Let’s see it in action. Let’s read our CSV file, write it to parquet with a partition, and then read it back again.</p>
<p>Something interesting happened. According to the <a href="https://pola-rs.github.io/polars/py-polars/html/reference/api/polars.DataFrame.write_parquet.html">Polars documentation</a>  there is no option to write parquet files with a partition column(s) … which kinda defeats the purpose of parquet files. It isn’t clear if we should just import <code>pyarrow</code> and write the Polars Dataframe to a PyArrow dataset and use the functionality there.</p>
<p>The <a href="https://pola-rs.github.io/polars/py-polars/html/reference/api/polars.DataFrame.write_parquet.html">documentation</a> also says “<em>Use C++ parquet implementation vs Rust parquet implementation. At the moment C++ supports more features.</em>” So I guess we can set that to <code>True</code> and pass the partition columns? Polars should be more clear and get with the game. Parquets are important and deserve first-class support or clear documentation. I would assume we would use the options listed in the PyArrow <code>write_table</code> functionality <a href="https://arrow.apache.org/docs/python/generated/pyarrow.parquet.write_table.html">listed here</a>.</p>
<p>Polars gives the option to “<em><strong>pyarrow_options </strong>Arguments passed to <code><span>pyarrow.parquet.write_table</span></code>.</em>” If you look at the <a href="https://arrow.apache.org/docs/python/generated/pyarrow.parquet.write_table.html">docks for PyArrow</a> <code>write_table</code> no mention of partitions. Those docs in turn mention <code>ParquetWriter</code>, but <a href="https://arrow.apache.org/docs/python/generated/pyarrow.parquet.ParquetWriter.html">those docs</a> have no mention of partitions either.</p>
<p>At this point let’s suffice it to say, Polars doesn’t match Pandas with the ability to write partitioned parquet data sets … at least not without some anticks apparently.</p>
<p>Also, it’s worthy of note IF you try to write to a newly appointed, non-existentParquet directory like this … in Polars … <code>pl_df.write_parquet(&#39;data/polars_parquet/&#39;)</code></p>
<p><img decoding="async" loading="lazy" src="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.50.13-PM-1030x165.png" alt="" width="1030" height="165" srcset="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.50.13-PM-1030x165.png 1030w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.50.13-PM-300x48.png 300w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.50.13-PM-768x123.png 768w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.50.13-PM-1536x246.png 1536w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.50.13-PM-2048x328.png 2048w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.50.13-PM-1500x240.png 1500w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.50.13-PM-705x113.png 705w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.50.13-PM-450x72.png 450w" sizes="(max-width: 1030px) 100vw, 1030px"/></p>
<p>Funny as it sounds, you must remove the offending, trailing <code>/</code> to get Polars not to puke. This is probably because Polars, with no partitions (arg) for parquets, is going to try to write a single parquet file for whatever you are writing. Blah.</p>
<p><img decoding="async" loading="lazy" src="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.10-PM-1030x440.png" alt="" width="1030" height="440" srcset="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.10-PM-1030x440.png 1030w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.10-PM-300x128.png 300w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.10-PM-768x328.png 768w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.10-PM-705x301.png 705w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.10-PM-450x192.png 450w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.10-PM.png 1438w" sizes="(max-width: 1030px) 100vw, 1030px"/></p>
<p>Again, the output is what I expected … except that I’m a little miffed that Polars and parquets with partitions is such a deal.</p>
<p><img decoding="async" loading="lazy" src="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.57-PM-1030x247.png" alt="" width="1030" height="247" srcset="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.57-PM-1030x247.png 1030w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.57-PM-300x72.png 300w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.57-PM-768x184.png 768w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.57-PM-1536x369.png 1536w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.57-PM-2048x492.png 2048w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.57-PM-1500x360.png 1500w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.57-PM-705x169.png 705w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-1.56.57-PM-450x108.png 450w" sizes="(max-width: 1030px) 100vw, 1030px"/></p>
<p>BTW, it’s worth noting that trying to read the directory of Parquet files output by Pandas, is super common, the Polars <code>read_parquet()</code>cannot do this, it pukes and complains, wanting a single file.</p>
<p><img decoding="async" loading="lazy" src="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-2.00.21-PM.png" alt="" width="2556" height="572" srcset="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-2.00.21-PM.png 2556w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-2.00.21-PM-300x67.png 300w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-2.00.21-PM-1030x231.png 1030w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-2.00.21-PM-768x172.png 768w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-2.00.21-PM-1536x344.png 1536w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-2.00.21-PM-2048x458.png 2048w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-2.00.21-PM-1500x336.png 1500w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-2.00.21-PM-705x158.png 705w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-2.00.21-PM-450x101.png 450w" sizes="(max-width: 2556px) 100vw, 2556px"/></p>
<p>Yikes, enough of that. Time to move on.</p>
<h3>Renaming, adding, or removing a column. With transformation as well.</h3>
<p>Ok, I’m glad to try something else now. What about the trivial task of renaming, adding, or removing columns from Pandas vs Polars. This is very a very common task when munging data.</p>
<p><img decoding="async" loading="lazy" src="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.18.55-PM-1030x347.png" alt="" width="1030" height="347" srcset="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.18.55-PM-1030x347.png 1030w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.18.55-PM-300x101.png 300w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.18.55-PM-768x259.png 768w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.18.55-PM-1536x517.png 1536w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.18.55-PM-1500x505.png 1500w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.18.55-PM-705x237.png 705w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.18.55-PM-450x152.png 450w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.18.55-PM.png 1568w" sizes="(max-width: 1030px) 100vw, 1030px"/></p>
<p>Not much to see, how about adding and removing columns?</p>
<p><img decoding="async" loading="lazy" src="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.48.57-PM-1030x539.png" alt="" width="1030" height="539" srcset="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.48.57-PM-1030x539.png 1030w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.48.57-PM-300x157.png 300w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.48.57-PM-768x402.png 768w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.48.57-PM-705x369.png 705w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.48.57-PM-450x235.png 450w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-3.48.57-PM.png 1262w" sizes="(max-width: 1030px) 100vw, 1030px"/></p>
<p>Pretty much what you would expect, I do enjoy the <code>PySpark</code> style of renaming columns with <code>with_column</code>.</p>
<h3>Aggregations and Grouping.</h3>
<p>This is probably one of the other most common steps to take with a Dataframe, Pandas or Polars, doing some aggregation and grouping. Let’s see how they work out.</p>
<p><img decoding="async" loading="lazy" src="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.04.31-PM-1030x461.png" alt="" width="1030" height="461" srcset="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.04.31-PM-1030x461.png 1030w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.04.31-PM-300x134.png 300w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.04.31-PM-768x344.png 768w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.04.31-PM-705x316.png 705w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.04.31-PM-450x201.png 450w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.04.31-PM.png 1184w" sizes="(max-width: 1030px) 100vw, 1030px"/></p>
<p>The results are the same for both.</p>
<p><img decoding="async" loading="lazy" src="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.05.40-PM-1030x409.png" alt="" width="1030" height="409" srcset="https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.05.40-PM-1030x409.png 1030w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.05.40-PM-300x119.png 300w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.05.40-PM-768x305.png 768w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.05.40-PM-705x280.png 705w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.05.40-PM-450x179.png 450w, https://www.confessionsofadataguy.com/wp-content/uploads/2023/01/Screenshot-2023-01-19-at-4.05.40-PM.png 1174w" sizes="(max-width: 1030px) 100vw, 1030px"/></p>
<p>Not much to say there, pretty much the same.</p>
<h2>Thoughts on replacing Pandas with Polars.</h2>
<p>I’m not sure what to think, will Polars really come to replace Python? Probably not anytime soon. I don’t think it’s necessarily a problem with Polars per say, but just that Pandas is so embedded everywhere and it’s hard to back out of those decisions once they get spread throughout a code base.</p>
<p>Now, if you’re using Pandas for simple data munging on your local laptop, could Polars be the better choice? Of course, it has way better speed, seems to be more Pythonic to write, and won’t blow up on memory if you start to use the <code>scan</code> options. I was taken aback a bit by its inability to write and read parquets with partitions, as this feature seems to be kind of an obvious one.</p>
<p>Overall someone could with very little trouble, and a day of work, replace Pandas with Polars, and the code would run faster, look better, and probably not drive so many people crazy like Pandas and it’s strange syntax. Part of the allure of Polars from my point of view is that it “flows” better than Pandas, Pandas can just be plain awkward to write.</p>
</div></div>
  </body>
</html>
