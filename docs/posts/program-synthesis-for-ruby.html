<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ngsankha/rbsyn">Original</a>
    <h1>Show HN: Program Synthesis for Ruby</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/ngsankha/rbsyn/blob/master/rbsyn-logo.png"><img src="https://github.com/ngsankha/rbsyn/raw/master/rbsyn-logo.png" width="110"/></a></p>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/ngsankha/rbsyn/actions/workflows/build.yml/badge.svg"><img src="https://github.com/ngsankha/rbsyn/actions/workflows/build.yml/badge.svg" alt="RbSyn Build Status"/></a></p>
<p dir="auto">Program synthesis for Ruby, guided by type and effect annotations. See the <a href="https://arxiv.org/abs/2102.13183" rel="nofollow">PLDI 2021</a> paper for more details on the approach.</p>
<p dir="auto">Given a method specification in the form of tests, type and effect annotations with <a href="https://github.com/tupl-tufts/rdl">RDL</a>, this synthesizes a Ruby function that will pass the tests. This reduces programmer effort to just writing tests that specify the function behavior and the computer writing the function implementation for you.</p>
<h2 dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installation</h2>
<p dir="auto">You need a working Ruby installation with <a href="https://bundler.io/" rel="nofollow">Bundler</a> installed. Then install all the dependencies by executing <code>bundle install</code>.</p>
<p dir="auto">We have tested RbSyn on Ruby 2.6.3 and 3.0.2 with Bundler 2.1.4. Other versions should work, but we have not tested it. Let us know if there are any issues.</p>
<h2 dir="auto"><a id="user-content-running-tests" aria-hidden="true" href="#running-tests"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Running Tests</h2>
<p dir="auto">All the benchmark programs can be run using the following command:</p>

<p dir="auto">Prefix the environment variable <code>CONSOLE_LOG=1</code> to the above command to print the synthesized method. To run a single test use the following command:</p>
<div data-snippet-clipboard-copy-content="bundle exec rake bench TEST=&lt;path-to-test-file&gt;"><pre><code>bundle exec rake bench TEST=&lt;path-to-test-file&gt;
</code></pre></div>
<p dir="auto">All the benchmarks can be found in <a href="https://github.com/ngsankha/rbsyn/blob/master/test/benchmark"><code>test/benchmark</code></a> and custom benchmarks can be run by updating in <a href="https://github.com/ngsankha/rbsyn/blob/master/Rakefile"><code>Rakefile</code></a> in line 15, for the <code>t.test_files</code> value.</p>
<h2 dir="auto"><a id="user-content-environment-variables" aria-hidden="true" href="#environment-variables"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Environment Variables</h2>
<p dir="auto">Multiple flags can be passed to RbSyn to explore different configurations of synthesis:</p>
<ul dir="auto">
<li><code>CONSOLE_LOG=1</code>: Print the programs that are bring synthesized.</li>
<li><code>DISABLE_TYPES=1</code>: Disable type directed synthesis.</li>
<li><code>DISABLE_EFFECTS=1</code>: Disable effect guided synthesis.</li>
<li><code>EFFECT_PREC=0</code> or <code>EFFECT_PREC=1</code> or <code>EFFECT_PREC=2</code>: Set the level of effect precision to use. 0 is the most precise, 1 is class level precision and 2 reduces annotations to pure or impure only.</li>
</ul>
<p dir="auto">These environment variables can be passed in any combination in the bench command like so:</p>
<div data-snippet-clipboard-copy-content="CONSOLE_LOG=1 DISABLE_EFFECTS=1 bundle exec rake bench"><pre><code>CONSOLE_LOG=1 DISABLE_EFFECTS=1 bundle exec rake bench
</code></pre></div>
<h2 dir="auto"><a id="user-content-using-rbsyn" aria-hidden="true" href="#using-rbsyn"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Using RbSyn</h2>
<p dir="auto">You can try to play with the implementation of RbSyn, the purpose of some of the key modules are given in the file structure section above.</p>
<p dir="auto">To write a new test, you can either copy an example from the existing benchmark and modify it. Update the <code>Rakefile</code> so the <code>t.test_files</code> contain your new benchmark.</p>
<p dir="auto">Benchmarks follow roughly this format:</p>
<div data-snippet-clipboard-copy-content="# type definitions for methods that will be used for synthesis
RDL.type Array, :first, &#39;() -&gt; t&#39;, wrap: false

define :username_available?, &#34;(String) -&gt; %bool&#34; do

  spec &#34;returns true when user doesn&#39;t exist&#34; do
    username_available? &#39;bruce1&#39;

    post { |result|
      result == true
    }
  end

  spec &#34;returns false when user exists&#34; do
    setup {
      u = User.create(name: &#39;Bruce Wayne&#39;, username: &#39;bruce1&#39;, password: &#39;coolcool&#39;)
      u.emails.create(email: &#39;bruce1@wayne.com&#39;)
    }

    username_available? &#39;bruce1&#39;

    post { |result|
      result == false
    }
  end

  puts generate_program
end"><pre><span># type definitions for methods that will be used for synthesis</span>
<span>RDL</span><span>.</span><span>type</span> <span>Array</span><span>,</span> <span>:first</span><span>,</span> <span>&#39;() -&gt; t&#39;</span><span>,</span> <span>wrap</span>: <span>false</span>

<span>define</span> <span>:username_available?</span><span>,</span> <span>&#34;(String) -&gt; %bool&#34;</span> <span>do</span>

  <span>spec</span> <span>&#34;returns true when user doesn&#39;t exist&#34;</span> <span>do</span>
    <span>username_available?</span> <span>&#39;bruce1&#39;</span>

    <span>post</span> <span>{</span> |<span>result</span>|
      <span>result</span> == <span>true</span>
    <span>}</span>
  <span>end</span>

  <span>spec</span> <span>&#34;returns false when user exists&#34;</span> <span>do</span>
    <span>setup</span> <span>{</span>
      <span>u</span> <span>=</span> <span>User</span><span>.</span><span>create</span><span>(</span><span>name</span>: <span>&#39;Bruce Wayne&#39;</span><span>,</span> <span>username</span>: <span>&#39;bruce1&#39;</span><span>,</span> <span>password</span>: <span>&#39;coolcool&#39;</span><span>)</span>
      <span>u</span><span>.</span><span>emails</span><span>.</span><span>create</span><span>(</span><span>email</span>: <span>&#39;bruce1@wayne.com&#39;</span><span>)</span>
    <span>}</span>

    <span>username_available?</span> <span>&#39;bruce1&#39;</span>

    <span>post</span> <span>{</span> |<span>result</span>|
      <span>result</span> == <span>false</span>
    <span>}</span>
  <span>end</span>

  <span>puts</span> <span>generate_program</span>
<span>end</span></pre></div>
<p dir="auto">The above <code>generate_program</code> runs RbSyn and produces the following snippet:</p>
<div data-snippet-clipboard-copy-content="def username_available?(arg0)
  !User.exists?(username: arg0)
end"><pre><span>def</span> <span>username_available?</span><span>(</span><span>arg0</span><span>)</span>
  !<span>User</span><span>.</span><span>exists?</span><span>(</span><span>username</span>: <span>arg0</span><span>)</span>
<span>end</span></pre></div>
<p dir="auto">By default RbSyn will only use &#34;&#34; (empty string), 0 and 1 for constants during synthesis. To include some other constants in this set, add them to <code>lib/rbsyn/context.rb</code> lines 26 and 27.</p>
<p dir="auto"><code>nil</code> is not synthesized by default, to enable the synthesis of <code>nil</code> set the option <code>enable_nil: true</code>. For an example see, <code>test/benchmark/diaspora/user_confirm_email_benchmark.rb</code>.</p>
<h2 dir="auto"><a id="user-content-issues-questions-or-comments" aria-hidden="true" href="#issues-questions-or-comments"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Issues, questions or comments?</h2>
<p dir="auto">Please file an issue on Github if you have problem running RbSyn. Feel free to send an email to <a href="mailto:sankha@cs.umd.edu">sankha@cs.umd.edu</a>.</p>
<hr/>
<p dir="auto"><em>Logo derived from icon by <a href="https://www.flaticon.com/authors/ultimatearm" rel="nofollow">ultimatearm</a> from <a href="https://www.flaticon.com/" rel="nofollow">www.flaticon.com</a>.</em></p>
</article>
          </div></div>
  </body>
</html>
