<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.hopefullyuseful.com/blog/advantage-air-ezone-tablet-diy-repair/">Original</a>
    <h1>Air Con: $1697 for an on/off switch</h1>
    
    <div id="readability-page-1" class="page"><section>
    
    
    <p><strong>Forcing customers to replace an entire system just because the cheapest component failed might be really profitable</strong>, I have no idea… But I do know that it annoyed me enough to make me want to fix it myself. While I understand that what I do next is beyond a large number of Advantage Air customers, in my investigation I found that there seems to be only software choices preventing modern tablets from working with older control systems.  Adding a simple “system” chooser to their software applications would give solutions to everyone, while the custom POE connector would ensure they still need their hardware.</p>
<h2 id="aircon-controller">Aircon Controller
</h2><p>My family had a new home built in 2019. As part of the build package a large ducted reverse cycle (heatpump) air conditioning system was installed.  As it was part of the entire build I am not sure on the specific price of this system but based on other quotes I have seen for a similar sized house I would guess $10k-$12k.  The system has two main parts, the actual Daikin airconditioner and an Advantage Air control box in attic that opens the vents to the various zones. This control system is operated by a cheap POE powered Android tablet on the wall of the living room.</p>
<p>The Advantage Air e-zone system is an adequate interface that does its job reasonably well, it has the ability to actively monitor temperature and adjust vent opening angles and fan speed to achieve desired temperatures across multiple zones. This combined with the ability to allow remote control via phone apps from anywhere meant <strong>I would have happily recommended this system to anyone</strong>.</p>
<h2 id="control-lost">Control Lost
</h2><p>On Sunday the 18th of August 2024 approximately 6 months past warranty this changed.  The tablet was complaining that “Sorry Google services has stopped”.  I dismissed this message and continued with the task I had intended and turned off the heater.  Later that day I returned home and went to turn the heater on again, only to find that this time the e-zone app itself had died and refused to launch.  I restarted the tablet only to be greeted with a never ending ANDROID loading screen.</p>
<p>Being a Sunday the next few hours I researched and tried everything I could find to get this tablet working again.  I entered recovery modes both English and Chinese and cleared every setting/partition I could.  There was no visible USB interface on the device so I couldn’t connect it to a computer.  Clearly there was something wrong with the operating system, a “system integrity check” returned multiple errors.</p>
<h2 id="disappointing-service">Disappointing Service
</h2><p>I called Advantage Air support the next day and waited for a call back.  Eventually a support agent called and I explained my problem.  One of the first questions I received was on the age of the system.  Once he had established it was out of warranty <strong>it was explained to me that if the tablet was dead I would need a whole new control system for $1245</strong>.  When I pushed back complaining that I only needed the cheap tablet replaced I received what sounded like a well rehearsed excuse along the lines of “Well technology keeps moving forward and systems aren’t compatible, new phones come out every year”.  I was incredulous, <strong>I’m all for smart things, but this is effectively just the on/off switch for my air conditioner</strong>.  To be clear, the Airconditioner worked fine, the control box worked fine, only the Android tablet had failed.  We ended the call with him offering to send me instructions on how to hard reset the tablet.</p>
<p><img src="https://blog.hopefullyuseful.com/blog/advantage-air-ezone-tablet-diy-repair/recovery.jpeg" width="3024" height="4032" srcset="/blog/advantage-air-ezone-tablet-diy-repair/recovery_hu12918632069216153079.jpeg 480w, /blog/advantage-air-ezone-tablet-diy-repair/recovery_hu16335612587761864593.jpeg 1024w" loading="lazy" alt="Recovery: System Check Failed" data-flex-grow="75" data-flex-basis="180px"/> <img src="https://blog.hopefullyuseful.com/blog/advantage-air-ezone-tablet-diy-repair/chinese.jpeg" width="3024" height="4032" srcset="/blog/advantage-air-ezone-tablet-diy-repair/chinese_hu16529903957547862901.jpeg 480w, /blog/advantage-air-ezone-tablet-diy-repair/chinese_hu17718868437222073798.jpeg 1024w" loading="lazy" alt="Factory recovery menu" data-flex-grow="75" data-flex-basis="180px"/> <img src="https://blog.hopefullyuseful.com/blog/advantage-air-ezone-tablet-diy-repair/productreview.png" width="1818" height="2012" srcset="/blog/advantage-air-ezone-tablet-diy-repair/productreview_hu3147721685027291179.png 480w, /blog/advantage-air-ezone-tablet-diy-repair/productreview_hu13397316582959955098.png 1024w" loading="lazy" alt="Very common problem" data-flex-grow="90" data-flex-basis="216px"/></p>
<p>When the instructions arrived I found they were nothing I hadn’t already tried.  In the meantime I had my hopes buoyed with <a href="https://forums.whirlpool.net.au/thread/3n1jljwq?p=2#r37" target="_blank" rel="noopener">evidence of people effectively using the latest tablet models</a> with systems older than mine.  This began a series of back and forth emails between myself and support where I would get increasingly frustrated at their complete refusal to sell me a control tablet and the bullshit excuses that always came along with it.  <strong>I was angry and <a href="https://www.productreview.com.au/listings/advantage-air?sortBy=ratingLowest" target="_blank" rel="noopener">it is clear that I’m not the only one</a></strong>.</p>
<p>The straw that broke the camels back was when their official quote came through.  <strong>Apparently not only the tablet and control system would need replacing but also the wireless temperature sensors too</strong>.  This brought the price to $1697.  $1697 so I could turn my heater on again.  This is frankly outrageous and seems almost predatory.  Fortunately it was nearly spring here in Australia, but <strong>in Summer people would pay nearly anything to get the aircon on again</strong>.</p>
<h2 id="ok-ill-fix-it-myself">Ok I’ll fix it myself
</h2><p>I now had an angry fire lit.  I was not going to pay this company a cent and became determined to fix/replace their tablet or install another companies system entirely.  <strong>My first step was to rip the tablet off the wall and take it apart</strong>.  The POE connection wasn’t something I recognised as standard as it was sending 12V and 2V on the middle pins.</p>
<p>Upon opening the tablet I found a hidden USB port! Connecting this to my computer allowed me to charge the device but no matter what I did, fastboot, recovery, adb sideload mode, everything… it wouldn’t recognise it.  I initially thought this was due to me never enabling “USB Debugging” inside the android interface but I would later realise it was the POE connector.</p>
<p>After a couple of hours of frustratingly trying to load different firmwares via SDCard (I should state I am a total Android noob and was clumsily doing all of this)  I finally decided to unscrew the main board and see where the extra wires from the POE connector went.</p>
<p><img src="https://blog.hopefullyuseful.com/blog/advantage-air-ezone-tablet-diy-repair/insidetablet.jpeg" width="4032" height="3024" srcset="/blog/advantage-air-ezone-tablet-diy-repair/insidetablet_hu14582507760185044323.jpeg 480w, /blog/advantage-air-ezone-tablet-diy-repair/insidetablet_hu10318497328469925549.jpeg 1024w" loading="lazy" alt="Inside the tablet" data-flex-grow="133" data-flex-basis="320px"/> <img src="https://blog.hopefullyuseful.com/blog/advantage-air-ezone-tablet-diy-repair/usb.jpg" width="3019" height="2585" srcset="/blog/advantage-air-ezone-tablet-diy-repair/usb_hu16766451404790598658.jpg 480w, /blog/advantage-air-ezone-tablet-diy-repair/usb_hu3571500084571447256.jpg 1024w" loading="lazy" alt="POE to USB connection found!" data-flex-grow="116" data-flex-basis="280px"/></p>
<p>AHA 3 wires, connected to USB 5V and data lines!  The first thing I did was cut those datalines and immediately I could see the tablet when I ran <code>fastboot devices</code>This lead to another couple of hours going down the rabbit hole of trying to use <code>mtktool</code> to unlock the bootloader.  While it looked promising it would always fail on <code>stage2</code> what ever that is and did feel hardware related.</p>
<p><strong>In retrospect I wasted way too much time trying to resurrect this clearly broken tablet</strong>.  For whatever reason (I suspect some sort of storage failure) everyone’s tablets die around the same time.</p>
<p><strong>When I finally gave up on the existing tablet, everything started falling into place</strong>.  The only really unique part of this tablet, hardware wise was the POE adapter.  I could see it served two functions.  First it was wired to replace the battery to allow always on use, and secondly it was a USB device.</p>
<p>My first instinct was to go buy another cheap android tablet and wire it up exactly as this one was.  But I know next to nothing about circuit boards and my soldering of small components is atrocious.  So my second instinct was to wire this POE connector up to a USB-A plug, connect it to my computer (via a hub, I didn’t trust my wiring at all ) then see if I could detect it.</p>
<p>I couldn’t detect anything, then realised that maybe it was acting as a host and therefore could only connect to tablets/phones.  I needed an Android tablet or phone.  Fortunately I remembered that I did have an Android tablet, <a href="https://blog.hopefullyuseful.com/blog/advantage-air-ezone-tablet-diy-repair/beercomp.png">I won a Samsung Galaxy Tab 4 back in 2015 in a Hahn beer competition I entered randomly</a>.  I had no idea where it was so spent another hour turning the house upside down for this forgotten relic.  My wife asked me what I was doing and when I told her she nonchalantly said “Oh the white one, yeah I saw it in the laundry cupboard a while back, does it even work?”</p>
<p>I had no idea if it worked or not, but after 5 minutes of charging I saw the lock screen and excitedly attached my terribly soldered connector.</p>
<p><img src="https://blog.hopefullyuseful.com/blog/advantage-air-ezone-tablet-diy-repair/terrible-soldering.jpeg" width="3024" height="4032" srcset="/blog/advantage-air-ezone-tablet-diy-repair/terrible-soldering_hu5368250854703282792.jpeg 480w, /blog/advantage-air-ezone-tablet-diy-repair/terrible-soldering_hu13417741372613334431.jpeg 1024w" loading="lazy" alt="POE to USB connection" data-flex-grow="75" data-flex-basis="180px"/> <img src="https://blog.hopefullyuseful.com/blog/advantage-air-ezone-tablet-diy-repair/first-connect.jpeg" width="3024" height="4032" srcset="/blog/advantage-air-ezone-tablet-diy-repair/first-connect_hu13139286892098828596.jpeg 480w, /blog/advantage-air-ezone-tablet-diy-repair/first-connect_hu13758548242967598701.jpeg 1024w" loading="lazy" alt="First connection attempt" data-flex-grow="75" data-flex-basis="180px"/></p>
<p>Whoa! <strong>This was a step forward and also the exact point when I knew my venture would be successful</strong>.  I am not a hardware/electronics expert, but I am <em>very comfortable</em> in software.</p>
<p>The original ezone tablet had been running Android 6.0, this Samsung was still on 5.0 but I didnt think that would cause any issues so I got started on doing what was clearly missing: The required apps.  All ezone apps are available both on the Advantage Air website and the apkpure site.  I only learned of the apkpure site from a post claiming he had been directed to it by a AA tech support person.</p>
<p>I installed two apps.  The AAService app, which I guessed was the always on “service” and the Ezone “interface” app.  I excitedly connected the poe dongle again:</p>


“Not on AA Hardware”
<p>Well duh, I didn’t expect it to be THAT easy but it was another roadblock,  I would have to learn how to patch Android apps.  I cut my teeth on Softice in DOS reversing much more complicated software for fun so I wasn’t daunted by this, but I also wasn’t expecting it to be so damn easy.</p>
<h2 id="android-app-patching">Android app patching
</h2><p>Thanks to <a href="https://yasoob.me/posts/reverse-engineering-android-apps-apktool/" target="_blank" rel="noopener">this article</a>.  I learned that you can use a tool, er… <code>apktool</code>  that allows you to not only disassemble an apk into smali ( <a href="https://payatu.com/blog/an-introduction-to-smali/" target="_blank" rel="noopener">a kind of Java runtime machine code</a> ) but <strong>you can make modifications and run the command in reverse <code>apktool b</code> and it rebuilds it into a runnable app!</strong>  No need for replacing bytes with a hex editor to stay within bounds etc… lol this seems like magic.</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>$ apktool d app-aaservice2-release-14.116
</span></span></code></pre></div><p>Cherry on the top is that <strong>you can also use a de-compiler JAXE on an apk that does its best to turn it back into Java</strong>.  This code wont compile, but it has the exact same structure as the smali code.  So you can identify what you need to modify in the pseudo-java, then make the changes in the smali. I used the <a href="http://www.javadecompilers.com/apk" target="_blank" rel="noopener">awesome hosted version here</a>.</p>
<p>So I opened the decompiled java project in VSCode, then one search for “AA Hardware” and I was here:</p>
<div><pre tabindex="0"><code data-lang="java"><span><span>    <span>/* access modifiers changed from: protected */</span>
</span></span><span><span>    <span>public</span> <span>void</span> <span>onResume</span>() {
</span></span><span><span>        <span>super</span>.<span>onResume</span>();
</span></span><span><span>        f2272e.<span>set</span>(<span>true</span>);
</span></span><span><span>        Log.<span>d</span>(f2271d, <span>&#34;onResume&#34;</span>);
</span></span><span><span>        <span>if</span> (ServicePleaseReboot.<span>f2283b</span>.<span>get</span>()) {
</span></span><span><span>            setContentView(R.<span>layout</span>.<span>reboot_now</span>);
</span></span><span><span>            e.<span>a</span>((Activity) <span>this</span>);
</span></span><span><span>        } <span>else</span> <span>if</span> (f.<span>a</span>()) {
</span></span><span><span>            a();
</span></span><span><span>        } <span>else</span> {
</span></span><span><span>            Log.<span>d</span>(f2271d, <span>&#34;Not on AA Hardware&#34;</span>);
</span></span><span><span>            Toast.<span>makeText</span>(<span>this</span>, R.<span>string</span>.<span>not_on_aa_hardware_error</span>, 1).<span>show</span>();
</span></span><span><span>            finish();
</span></span><span><span>        }
</span></span><span><span>    }
</span></span></code></pre></div><p>Excellent, so if <code>f.a()</code> is false then the “Not on AA Hardware” error will display and the app will quit.  Following the imports ( I am not a Java person so this caught me out ) I found the <code>f</code> class was this:</p>
<div><pre tabindex="0"><code data-lang="java"><span><span><span>import</span> b.a.a.a.i;
</span></span><span><span>
</span></span><span><span><span>/* compiled from: GetTabletInfo */</span>
</span></span><span><span><span>class</span> <span>f</span> {
</span></span><span><span>    <span>static</span> <span>boolean</span> <span>a</span>() {
</span></span><span><span>        <span>return</span> i.<span>c</span>() <span>||</span> i.<span>d</span>() <span>||</span> i.<span>e</span>() <span>||</span> i.<span>g</span>() <span>||</span> i.<span>f</span>() <span>||</span> i.<span>b</span>();
</span></span><span><span>    }
</span></span><span><span>}
</span></span></code></pre></div><p>Now if you now go to <code>sources/b/a/a/a/i.java</code> you will find that each one of these is a check against the device <code>Build.MODEL</code></p>
<p>for example i.c() is:</p>
<div><pre tabindex="0"><code data-lang="java"><span><span>    <span>public</span> <span>static</span> <span>boolean</span> <span>c</span>() {
</span></span><span><span>        <span>return</span> a().<span>contains</span>(<span>&#34;eZone&#34;</span>) <span>||</span> a().<span>contains</span>(<span>&#34;e-zone&#34;</span>) <span>||</span> a().<span>equals</span>(<span>&#34;PIC7KS-EZ&#34;</span>) <span>||</span> a().<span>equals</span>(<span>&#34;PIC7KS6&#34;</span>) <span>||</span> a().<span>equals</span>(<span>&#34;PIC7KS6-EZ&#34;</span>);
</span></span><span><span>    }
</span></span></code></pre></div><p>So each of these i.c() i.d() etc… just feature flag functions checking against the model name.  This c() function above is probably named something like <code>isEzone()</code>. Another might be something like <code>isMyAir4()</code> or <code>isZone10()</code> etc…  So I had two easy options to make this work with my e-Zone controller box.  I could make the i.c() (isEzone()) function always return true, or I could make the a() function always return my old tablet devicename.  In retrospect I think the first option would have worked fine, but at the time I didn’t know if the model name was being checked anywhere else so I chose the latter.</p>
<p>My old tablet’s model name was on a sticker on the inside of the case, but looking at the code I saw it needed the <code>-EZ</code> identifier tagged to end.  So the string I was to return was “PIC7KS6-EZ”. The original Java function looked like this:</p>
<div><pre tabindex="0"><code data-lang="java"><span><span>    <span>private</span> <span>static</span> String <span>a</span>() {
</span></span><span><span>        String str <span>=</span> Build.<span>MODEL</span>;
</span></span><span><span>        <span>if</span> (str.<span>equals</span>(<span>&#34;SM-T113&#34;</span>)) {
</span></span><span><span>            str <span>=</span> <span>&#34;MyAir5&#34;</span>;
</span></span><span><span>        }
</span></span><span><span>        .
</span></span><span><span>        . <span>// other if statements overriding Build.MODEL</span>
</span></span><span><span>        .
</span></span><span><span>        <span>if</span> (str.<span>equals</span>(<span>&#34;PIC8GS8&#34;</span>)) {
</span></span><span><span>            <span>return</span> <span>&#34;MyAir5&#34;</span>;
</span></span><span><span>        }
</span></span><span><span>        <span>return</span> str; <span>// &lt;-- I needed to change this to return &#34;PIC7KS6-EZ&#34;</span>
</span></span><span><span>    }
</span></span></code></pre></div><p>Jumping over to <code>sources/b/a/a/a/i.smali</code> I found the same function, but with the smali code.  I could see the same if statements and the same return str.  I just had to change the return str to return “PIC7KS6-EZ”</p>
<div><pre tabindex="0"><code data-lang="smali"><span><span>
</span></span><span><span>    :cond_4
</span></span><span><span>    const-string v1, <span>&#34;PIC8GS8&#34;</span>
</span></span><span><span>
</span></span><span><span>    <span>.line</span> <span>7</span>
</span></span><span><span>    invoke-virtual {v0, v1}, <span>L</span>java/lang/<span>String</span>;-&gt;<span>equals</span>(<span>L</span>java/lang/<span>Object</span>;)<span>Z</span>
</span></span><span><span>
</span></span><span><span>    move-result v1
</span></span><span><span>
</span></span><span><span>    if-eqz v1, :cond_5
</span></span><span><span>
</span></span><span><span>    goto :goto_0
</span></span><span><span>
</span></span><span><span>    :cond_5
</span></span><span><span>    <span>#move-object v2, v0 # &lt;-- this was return str;
</span></span></span><span><span><span></span>    const-string v2, <span>&#34;PIC7KS6-EZ&#34;</span>  <span># this returning the new string instead
</span></span></span><span><span><span></span>
</span></span><span><span>    :goto_0
</span></span><span><span>    return-object v2
</span></span><span><span><span>.end</span> <span>method</span>
</span></span></code></pre></div><p>Ok modification done time to rebuild it</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>$ apktool b app-aaservice2-release-14.116
</span></span></code></pre></div><p>Like magic you now have a new apk in the <code>dist</code> folder.  This apk is unsigned though so I needed to sign it.  I don’t do any android work so I had to google what to do, but I ended up creating a key store like this.</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>$ keytool -genkey -v -keystore my-release-key.jks -keyalg RSA -keysize <span>2048</span> -validity <span>10000</span> -alias my-android-release
</span></span></code></pre></div><p>Then I signed the apk with this command</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>jarsigner -verbose -sigalg MD5withRSA -digestalg SHA1 -keystore ../my-release-key.jks -storepass passwordiused dist/app-aaservice2-release-14.116.apk my-android-release
</span></span></code></pre></div><p>Then I connected my tablet and tried to install.  Only to be hit with <code>INSTALL_FAILED_DUPLICATE_PERMISSION</code>.  Turns out this was because I was installing the aaservice app which was requesting the same permissions as the ezone app.  This is fine <em>if they are both signed by the same key</em> but they were not.  To get things moving I just deleted the ezone app.</p>
<p>This time I fired up the aaservice app and it worked! I even got a nice notification announcing “System connected”.  OK Great! I had a working service, now only needed the UI app eZone working.  I did did the exact same <code>apktool d</code> and <code>JAXE</code> decompile as before but VSCode didn’t find any device strings or “Build.MODEL” checks. I quickly signed the eZone app with the matching key and installed, hoping that it didn’t need any other modifications.  Upon opening it seemed to be attempting to connect but ended up returning an error about an un-recognised system.</p>
<p>I went back to the decompiled java and realised that actually VSCode’s search was just taking a long time, so I restricted the search to the java files.  It didn’t take long to find the exact same device checking code.  I made the exact same change to <code>smali/com/air/advantage/w1/k.smali</code> and rebuilt the apk.  Installed it, connected to the POE and …</p>
<p><img src="https://blog.hopefullyuseful.com/blog/advantage-air-ezone-tablet-diy-repair/it-works.jpeg" width="3024" height="4032" srcset="/blog/advantage-air-ezone-tablet-diy-repair/it-works_hu4393131111181304838.jpeg 480w, /blog/advantage-air-ezone-tablet-diy-repair/it-works_hu14442212562343589111.jpeg 1024w" loading="lazy" alt="E-Zone running on a normal Android tablet" data-flex-grow="75" data-flex-basis="180px"/></p>
<p><strong>E-Zone running perfectly on an ancient Samsung Galaxy Tab 4</strong>.  I was elated.  After I gave up on repairing the original, getting this tablet working took only a few hours and was a hell of a lot of fun.  This tablet is 10+ years old and yet still is much snappier than the junk that came with the system, but if I want to upgrade to something more powerful, say to control my homeassistant etc… all I need to do is plug it into the usb.  But for turning the AC on and off it is more than enough and I am currently waiting on a nice flush connector to arrive then will mount it on the wall.</p>
<p>My aircon company (Not Advantage Air) kindly emailed me the next day to let me know that one of their installers had found an old tablet in the back of a van that I could purchase for $400.  Although still outrageously expensive for what it is, had Advantage Air offered this originally I probably would have jumped at it.  Instead I am thankful I had the opportunity to get this working on my own.</p>
<p>Hopefully this post is useful to someone else in the same situation.  None of this can be done without the original POE connector so it won’t help anyone that doesn’t already have AA hardware, but if this extremely common tablet failure is the problem you are facing then a little soldering and a new tablet is all you need.</p>
<h3 id="followup">Followup
</h3><p>This post is being discussed on <a href="https://news.ycombinator.com/item?id=41386319" target="_blank" rel="noopener">Hacker News</a> which sparked some great comments like this <a href="https://news.ycombinator.com/item?id=41387108" target="_blank" rel="noopener">one from gstar</a> who lives in the same city and was working on the same problem:
</p><blockquote>
    <p>The system uses RS422…Incidentally, if you root your tablet you can just change the build.MODEL to “MyAir5” and everything will work on a third party tablet…Oh, and you just need one of these and a TTL to RS422 converter off aliexpress to replicate the interface:</p>
<p><a href="https://www.aliexpress.com/item/1005005918675239.html" target="_blank" rel="noopener">https://www.aliexpress.com/item/1005005918675239.html</a></p>
<p>The connectors on the small RJ45 daughter board are JST-SH 1.0
The yellow lead puts out 4.2v to replicate a Li-Ion battery (as far as I can tell). You can ignore this.</p>
<p>Red is positive</p>
<p>Black is negative</p>
<p>Green is usb d+</p>
<p>Blue is usb d-</p>
<span><span>― </span><span>gstar, </span><a href="https://news.ycombinator.com/item?id=41387108"><cite>Hacker News Comment</cite></a></span></blockquote>

</section></div>
  </body>
</html>
