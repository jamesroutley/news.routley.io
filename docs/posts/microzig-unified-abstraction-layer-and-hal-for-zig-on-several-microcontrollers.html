<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ZigEmbeddedGroup/microzig">Original</a>
    <h1>MicroZig: Unified abstraction layer and HAL for Zig on several microcontrollers</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://discord.gg/ShUWykk38X" rel="nofollow"><img src="https://camo.githubusercontent.com/558e641519df1ff43899582e36453256f04cdf4f9d4cd2a977f643e342f45137/68747470733a2f2f696d672e736869656c64732e696f2f646973636f72642f3832343439333532343431333731303333362e7376673f6c6f676f3d646973636f7264" alt="Chat" data-canonical-src="https://img.shields.io/discord/824493524413710336.svg?logo=discord"/></a>
<a href="https://downloads.microzig.tech/" rel="nofollow"><img src="https://camo.githubusercontent.com/8d40a583cc706c28fe8616e8cae6bbed7e37ac7f24a6cfcd188c3360d374f135/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f5a69675f5061636b6167652d446f776e6c6f61642d626c7565" alt="Downloads" data-canonical-src="https://img.shields.io/badge/Zig_Package-Download-blue"/></a>
<a href="https://github.com/ZigEmbeddedGroup/microzig/actions/workflows/build.yml"><img src="https://github.com/ZigEmbeddedGroup/microzig/actions/workflows/build.yml/badge.svg" alt="Continuous Integration"/></a></p>
<blockquote>
<p dir="auto"><strong>NOTE:</strong> This is in development; breaks in the API are bound to happen.</p>
</blockquote>
<div dir="auto"><h2 tabindex="-1" dir="auto">What version of Zig to use</h2><a id="user-content-what-version-of-zig-to-use" aria-label="Permalink: What version of Zig to use" href="#what-version-of-zig-to-use"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">0.11.0</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Getting Started With MicroZig</h2><a id="user-content-getting-started-with-microzig" aria-label="Permalink: Getting Started With MicroZig" href="#getting-started-with-microzig"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>

<p dir="auto"><strong>IMPORTANT:</strong> You don&#39;t have to clone this repository to get started!</p>
<p dir="auto">MicroZig uses a monorepo architecture, but provides a lot of different packages. If you just want to get started, head over to <a href="https://downloads.microzig.tech/" rel="nofollow">downloads.microzig.tech</a> and download an example for the chip family you desire.</p>
<p dir="auto">We support several chip families like the <a href="https://www.raspberrypi.com/products/rp2040/" rel="nofollow">RP2 family by RaspberryPi Foundation</a>, <a href="https://www.st.com/content/st_com/en.html" rel="nofollow">STM32 by STMicroelectronics</a>, and many others.</p>
<p dir="auto">Unpack the example, and run <code>zig build</code> in the resulting example folder gives you <code>zig-out/firmware</code> which contains the resulting files.</p>
<p dir="auto">Right now, you gotta figure out how to flash the MCU yourself, but as people say: Google is your friend. But you can also ask for help <a href="https://discord.gg/ShUWykk38X" rel="nofollow">on our Discord server</a>.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">I Want To Contribute To MicroZig</h3><a id="user-content-i-want-to-contribute-to-microzig" aria-label="Permalink: I Want To Contribute To MicroZig" href="#i-want-to-contribute-to-microzig"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><strong>IMPORTANT:</strong> Developer experience is degraded right now, and not really good. Windows isn&#39;t really a supported dev target and you got to expect some friction. <a href="https://github.com/orgs/ZigEmbeddedGroup/projects/4">There&#39;s a project for improving DX, feel free to grab tasks from there!</a></p>
<p dir="auto">Please see the <a href="https://github.com/orgs/ZigEmbeddedGroup/projects/1/views/1">project page</a>, itâ€™s used as a place to brainstorm and organize work in ZEG. There will be issues marked as good first issue or drafts for larger ideas that need scoping/breaking ground on.</p>
<p dir="auto">More words on contribution and development on MicroZig are <a href="#developing">further down below</a>.</p>

<p dir="auto">This repo contains the infrastructure for getting started in an embedded Zig project; it &#34;gets you to main()&#34;. Specifically, it offers:</p>
<ul dir="auto">
<li>a single easy-to-use builder function that:
<ul dir="auto">
<li>generates your linker script</li>
<li>sets up packages and startup code</li>
</ul>
</li>
<li>generalized interfaces for common devices, such as UART.</li>
<li>device drivers for interacting with external hardware</li>
<li>an uncomplicated method to define xref:interrupts[interrupts]</li>
</ul>

<p dir="auto">For MicroZig internals please see the <a href="https://github.com/ZigEmbeddedGroup/microzig/blob/main/docs/design.adoc">Design Document</a>.</p>

<p dir="auto">Right now, the developer experience is not optimal due to 0.11 not really supporting what we&#39;re doing at all.</p>
<p dir="auto">If you want to test your changes, you gotta to the following:</p>
<p dir="auto"><strong>Step 1:</strong> Install required python packages, either systemwide or via a <a href="https://docs.python.org/3/library/venv.html" rel="nofollow">virtual environment</a>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# systemwide:
[user@host] microzig-monorepo/ $ pip install -r tools/requirements.txt
[user@host] microzig-monorepo/ $ 

# using virtual environments:
[user@host] microzig-monorepo/ $ python3 -m venv .venv
[user@host] microzig-monorepo/ $ . .venv/bin/activate # on linux, macos
[user@host] microzig-monorepo/ $ . .venv/Scripts/activate # on windows
[user@host] microzig-monorepo/ $ pip3 install -r tools/requirements.txt
[user@host] microzig-monorepo/ $ "><pre># <span>systemwide:</span>
<span>[user@host] microzig-monorepo/</span> $ <span>pip install -r tools/requirements.txt</span>
<span>[user@host] microzig-monorepo/</span> $ 

# <span>using virtual environments:</span>
<span>[user@host] microzig-monorepo/</span> $ <span>python3 -m venv .venv</span>
<span>[user@host] microzig-monorepo/</span> $ <span><span>.</span> .venv/bin/activate <span><span>#</span> on linux, macos</span></span>
<span>[user@host] microzig-monorepo/</span> $ <span><span>.</span> .venv/Scripts/activate <span><span>#</span> on windows</span></span>
<span>[user@host] microzig-monorepo/</span> $ <span>pip3 install -r tools/requirements.txt</span>
<span>[user@host] microzig-monorepo/</span> $ </pre></div>
<p dir="auto"><strong>Step 2:</strong> Create a deployment for local usage:</p>
<div dir="auto" data-snippet-clipboard-copy-content="[user@host] microzig-monorepo/ $ python3 ./tools/bundle.py --debug
preparing environment...
validating packages...
loaded packages:
  * microzig-build
  * examples:microchip/avr
  * examples:...
  * microzig-core
  * microchip/avr
  * ...
resolving inner dependencies...
creating packages...
bundling microzig-build...
bundling microzig-core...
bundling microchip/avr...
...
[user@host] microzig-monorepo/ $ "><pre><span>[user@host] microzig-monorepo/</span> $ <span>python3 ./tools/bundle.py --debug</span>
<span>preparing environment...</span>
<span>validating packages...</span>
<span>loaded packages:</span>
<span>  * microzig-build</span>
<span>  * examples:microchip/avr</span>
<span>  * examples:...</span>
<span>  * microzig-core</span>
<span>  * microchip/avr</span>
<span>  * ...</span>
<span>resolving inner dependencies...</span>
<span>creating packages...</span>
<span>bundling microzig-build...</span>
<span>bundling microzig-core...</span>
<span>bundling microchip/avr...</span>
<span>...</span>
<span>[user@host] microzig-monorepo/</span> $ </pre></div>
<p dir="auto">This command yields output in <code>./microzig-deploy</code> that is meant to be fetched via <code>http://localhost:8080/</code>.</p>
<p dir="auto"><strong>Step 3:</strong> To serve the files on this port, you can start a pre-bundled web server:</p>
<div dir="auto" data-snippet-clipboard-copy-content="[user@host] microzig-monorepo/ $ python3 ./tools/demo-server.py
..."><pre><span>[user@host] microzig-monorepo/</span> $ <span>python3 ./tools/demo-server.py</span>
<span>...</span></pre></div>
<p dir="auto">This way, you spawn a local HTTP server that will serve <code>./microzig-deploy</code> on port 8080 on your machine, and you can then
start fetching packages from this.</p>
<p dir="auto">Now you can use curl to fetch the packages, or you can just create a local development project.</p>
<p dir="auto"><strong>Step 4:</strong> Create a local test environment</p>
<p dir="auto">This is basically done by unpacking an example from the <code>./microzig-deploy/examples</code> folder, and starting to test changes.
As the <code>build.zig.zon</code> has to be updated after running <code>./tools/bundle.py</code> again, there&#39;s a script that helps here:
<code>tools/patch-build-zon.py</code> can be used to patch/upgrade your development project inplace based on what it finds in <code>./microzig-deploy</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="[user@host] microzig-monorepo/ $ python3 ./tools/patch-build-zon.py /tmp/dev-project/build.zig.zon
Updating hash of http://localhost:8080/packages/microzig-build.tar.gz to 12200040a36bbbb2fe09809861f565fcda9a10ec3064d70357aa40ad0a61596c16fb
Updating hash of http://localhost:8080/packages/microzig-core.tar.gz to 122013a37ce9ac295303f26057c203e722b9ceaefa5b4403fe5a18ab065f03079e7d
Updating hash of http://localhost:8080/packages/board-support/stmicro/stm32.tar.gz to 12207c278b78c5aeb08cd7889647d7d0d9a359cb28fe68105d2e43f85dabb3865981
[user@host] microzig-monorepo/ $"><pre><span>[user@host] microzig-monorepo/</span> $ <span>python3 ./tools/patch-build-zon.py /tmp/dev-project/build.zig.zon</span>
<span>Updating hash of http://localhost:8080/packages/microzig-build.tar.gz to 12200040a36bbbb2fe09809861f565fcda9a10ec3064d70357aa40ad0a61596c16fb</span>
<span>Updating hash of http://localhost:8080/packages/microzig-core.tar.gz to 122013a37ce9ac295303f26057c203e722b9ceaefa5b4403fe5a18ab065f03079e7d</span>
<span>Updating hash of http://localhost:8080/packages/board-support/stmicro/stm32.tar.gz to 12207c278b78c5aeb08cd7889647d7d0d9a359cb28fe68105d2e43f85dabb3865981</span>
<span>[user@host] microzig-monorepo/</span> $</pre></div>
<p dir="auto">Both compiling the local example and updating the <code>build.zig.zon</code> requires running the local development server.</p>

<ul dir="auto">
<li><code>build/</code> contains the build components of MicroZig.</li>
<li><code>core/</code> contains the shared components of MicroZig.</li>
<li><code>board-support/</code> contains all official board support package.</li>
<li><code>examples/</code> contains examples that can be used with the board support packages.</li>
<li><code>tools/</code> contains tooling to work <em>on</em> MicroZig itself, so deployment, testing, ...</li>
<li><code>design/</code> contains images and logos</li>
</ul>

<p dir="auto">MicroZig versions are tightly locked with Zig versions.</p>
<p dir="auto">The general scheme is <code>${zig_version}-${commit}-${count}</code>, so the MicroZig versions will look really similar to
Zigs versions, but with our own commit abbreviations and counters.</p>
<p dir="auto">As MicroZig sticks to tagged Zig releases, <code>${zig_version}</code> will show to which Zig version the MicroZig build is compatible.</p>
<p dir="auto">Consider the version <code>0.11.0-abcdef-123</code> means that this MicroZig version has a commit starting with <code>abcdef</code>, which was the 123rd commit of the version that is compatible with Zig 0.11.0.</p>
</article></div></div>
  </body>
</html>
