<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.linen.dev/s/linen/t/10511167/linen-dev-the-500kb-slack-alternative">Original</a>
    <h1>Linen.dev: A 500 kb Slack alternative</h1>
    
    <div id="readability-page-1" class="page"><div><div><div><p>Linen is an open source Google searchable open-source Slack/Discord alternative for communities. Our vision is to merge the advantages of a forum with the real-time interaction of chat. We launched the first version of Linen a few months ago. Our initial client bundle size of  ~1MB gzipped was already more streamlined than most chat apps. But we knew we could do better, so after a bunch of small optimizations, we shrunk it down to ~2MB parsed and ~500KB gzipped. We wanted to share the techniques we used and the process we went through.

</p><h3>Why Focus on Reducing Bundle Size?
</h3><p>
Linen has millions of pages, and search engines have a specific budget on how much compute resources they allocate to crawling a website. By reducing the bundle size by half, we can potentially double the number of pages that search engines can crawl with all things being equal. Beyond search engine friendliness, a smaller bundle size also means faster initial page load speed, especially on slower connections. As a bonus side effect, it makes us more disciplined when choosing packages and libraries, which helps reduce the security attack surface area.

</p><h3>What does these numbers mean:
</h3><p>
To identify areas for improvement, we used the webpack bundle analyzer to target our app/web directory, allowing us to visually pinpoint the space-consuming components.

</p><div><p>https://static.main.linendev.com/attachments/5b12e431-c19b-426d-a9a3-0df889e1ac22/Screen_Shot_2023-04-26_at_12.02.57_PM.jpg<span>â–¾</span></p></div><p>

This returned three numbers. 
Stat: 7.27 MB
Parsed: 3.52MB
Gzipped: 984.32KB

</p><ul><li><strong>Stat</strong> is what webpack returns the raw amount of packages and files that is in your folder this is the least important of the three since it isn&#39;t what the client ultimately sees.</li><li><strong>Parsed</strong> is what gets ran on the client side after the bundler minimizes/uglifies your package this is how much space it takes up on the client&#39;s machine. We want to reduce this number but not the highest priority.</li><li><strong>Gzipped</strong> is what gets sent over the internet and downloaded this will impact download and page load speed the most. For us we cared the most about gzipped size since it will impact bandwidth the most. </li></ul><p>
For a more detailed look we&#39;ve made our January bundle size public <a href="https://static.main.linendev.com/attachments/b6ca8bde-1e08-43b3-96b5-b5154f7cffed/Jan1st.html" title="" rel="noreferrer ugc" target="_blank">here</a></p><h3>Our Optimization Strategies:
</h3>
<p><strong>Fixing import issues and tree shaking problems</strong> 

We saw that React Icon utilized ~200KB parsed and ~50KB gzipped, even though we were only using a few SVGs from the library. Most of the time if you are only selectively importing specific functions your bundler will remove dead code through tree-shaking. We found that react-icons had an issue that lead to everything being imported. This meant that we were including every single react-icon in our package whether we need it or not. The work around was to use change the ipmorts to react-icons/all-files instead of react-icons, reducing the bundle size to 10KB parsed and 2KB gzipped.

<strong>Replace libraries with custom code</strong> 

HeadlessUI didn&#39;t support individual importing. Although the package is small we were only using one component. We decided to replace the library with own custom written component  
We also noticed that we were only using AWS client for s3 upload on the client side and it was taking up significantly more bundle size we need so we replaced the entire client side package with a 2 api calls to the AWS api. 
Finally we were using _loadash&#39;s Union method. That was a bit heavier function which handled a lot more edge cases we needed so we replaced it all with our own custom function.

All in all this strategic move saved us ~600KB parsed and ~100KB gzipped. It can be a bit time consuming but it helps you become more disciplined about which packages to add 

<strong>Moving code to the backend</strong> 

Finally, we saw that highlight.js (the library for code highlighting) was taking up 30% of our bundle size (~949.06KB parsed, ~292.58KB gzipped). Since most of our users are technical communities, it was obviously required. There was no way we could write our own, and it didn&#39;t seem like there was a lighter alternative since the ability to parse programming languages is very complicated.  We ended up moving the code highlight code to a backend api that would cache the results. This meant that our bundles wouldn&#39;t need to load entire highlightjs. 

</p><h3>Conclusion
</h3><p>
Ultimately we were able to drop our bundle size down by 50% which meant faster load time and better user experience and SEO performance. We focused mainly on the low hanging fruits which ended up taking us a few days of engineering effort. All in all we were happy with the investment we made and took less time than we expected.

This is what our bundle size looked like at the <a href="https://static.main.linendev.com/attachments/8a1ffd1c-88df-4b2d-b822-97fc79ae3e09/client.html" title="" rel="noreferrer ugc" target="_blank">end</a> (April of 2023)

If you see something that you think we can reduce feel free to open a Github issue or pull request:
in our <a href="https://github.com/linen-dev/linen.dev" title="" rel="noreferrer ugc" target="_blank">repo</a></p></div></div></div></div>
  </body>
</html>
