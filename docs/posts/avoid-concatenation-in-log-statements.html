<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://blog.bonnieeisenman.com/blog/avoid-concatenation-in-log-statements/">Original</a>
    <h1>Avoid concatenation in log statements</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>This is a really small programming “style” best practice that came up at work last week.</p>
<p>TLDR; don’t pre-concatenate strings in Java log calls!</p>
<p>I’m working in Java now after a long stint in Scala-land. I used Java in university and at my first few internships but haven’t worked in it since then. So, there are a lot of coding conventions and best practices that I’m having to re-learn…</p>
<p>One of them is about <strong>logs</strong>!</p>
<p>Fun fact, my very first internship project at Google was about calculating the memory usage of log strings in Gmail. Log strings can be <em>expensive</em>. Let’s look at some code.</p>
<div><div><pre><code><span>// Version 1 - boo</span>
<span>log</span><span>.</span><span>info</span><span>(</span><span>&#34;Data processed for user &#34;</span> <span>+</span> <span>user</span><span>.</span><span>getId</span><span>());</span>

<span>// Version 2 - yay</span>
<span>log</span><span>.</span><span>info</span><span>(</span><span>&#34;Data processed for user {}&#34;</span><span>,</span> <span>user</span><span>.</span><span>getId</span><span>());</span>
</code></pre></div></div>
<p>Though they look very similar, Version 1 is more expensive than the Version 2.</p>
<p>Let’s say that you have your logging level configured so that only ERROR level logs are actually logged. However, the concatenation in version 1 will happen <strong>before</strong> the invocation of <code>log.info</code>. That means that you’re doing extra work on every request to concatenate those strings…and then throw them away! Yuck! If you are processing lots of traffic, all of those extra (useless) string allocations can add up and really impact your newgen memory churn. And worst of all, those strings are unique per user (or message ID, or whatever other variable you’re logging).</p>
<p>In version 2, the user’s ID is passed as an argument to the logger. The logger will only build the string if it actually needs it. Yay! Much better.</p>
<p>It feels like a small style nit but these kinds of allocations can have a real impact. Also, logs are a common place to find this kind of wasted work, but the same principle applies generally. “Don’t pre-build unique strings unless you have to” is a good rule of thumb.</p>
<p><em>Thanks to Sean Wu for discussing this with me in <a href="https://www.recurse.com/">Recurse Center</a> chat!</em></p>
<p>Related links:</p>
<ul>
<li>
<p><a href="https://dba-presents.com/jvm/java/120-use-the-built-in-formatting-to-construct-this-argument">DBA Presents: Use the Built in Formatting to Construct This Argument</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/42388341/built-in-string-formatting-vs-string-concatenation-as-logging-parameter">StackOverflow: Built-in string formatting vs string concatenation as logging parameter</a></p>
</li>
</ul>
<hr/>

</div></div>
  </body>
</html>
