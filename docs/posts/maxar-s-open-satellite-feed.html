<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tech.marksblogg.com/maxar-open-data-free-satellite-imagery.html">Original</a>
    <h1>Maxar&#39;s Open Satellite Feed</h1>
    
    <div id="readability-page-1" class="page"><div id="article_text">
            <p>Maxar operates a fleet of satellites that capture imagery of the Earth. Some of these satellites offered the best resolution commercially available when they were first launched into space. Last year, Maxar earned ~$1.6B largely from selling imagery these satellites produced.</p>
<p>I found a <a href="https://landinfo.com/satellite-imagery-pricing/">price list</a> for new images taken and it stated that each KM2 of imagery costs between $25 - $44. This could end up becoming an expensive hobby but thankfully Maxar also runs an <a href="https://www.maxar.com/open-data">Open Data</a> Programme. In exchange for your contact details, you can get access to over 100 imagery sets taken in areas before and after they were struck by disasters.</p>
<p>But for anyone unwilling to part with their contact information, there is a freely available <a href="https://radiantearth.github.io/stac-browser/#/external/maxar-opendata.s3.amazonaws.com/events/catalog.json">SpatioTemporal Asset Catalog</a> (STAC) published by Maxar that details imagery URLs and metadata for 28 disaster events. Below is a map of these locations and event details.</p>
<p><a href="https://tech.marksblogg.com/theme/images/maxar-events.jpg"><img alt="Maxar Open Data Event Locations" src="https://tech.marksblogg.com/theme/images/maxar-events.jpg"/></a></p><p>In this post, I&#39;ll download and examine Maxar&#39;s freely available satellite imagery.</p>
<div id="installing-prerequisites">
<h2>Installing Prerequisites</h2>
<p>The following was run on Ubuntu for Windows which is based on Ubuntu 20.04 LTS. The system is powered by an Intel Core i5 4670K running at 3.40 GHz and has 32 GB of RAM. The primary partition is a 2 TB Samsung 870 QVO SSD which will host the applications used in this post. The images will live on an 8 TB mechanical drive.</p>
<p>I&#39;ll be using GDAL and Python to help analyse the images in this post.</p>
<div><pre><span></span>$<span> </span>sudo<span> </span>apt<span> </span>update
$<span> </span>sudo<span> </span>apt<span> </span>install<span> </span><span>\</span>
<span>    </span>gdal-bin<span> </span><span>\</span>
<span>    </span>jq<span> </span><span>\</span>
<span>    </span>libtiff-tools<span> </span><span>\</span>
<span>    </span>python3-pip<span> </span><span>\</span>
<span>    </span>python3-virtualenv
</pre></div>
<p>I&#39;ll set up a Python Virtual Environment and install a few packages.</p>
<div><pre><span></span>$<span> </span>virtualenv<span> </span>~/.maxar
$<span> </span><span>source</span><span> </span>~/.maxar/bin/activate
$<span> </span>python<span> </span>-m<span> </span>pip<span> </span>install<span> </span><span>\</span>
<span>    </span>rich<span> </span><span>\</span>
<span>    </span>shapely<span> </span><span>\</span>
<span>    </span>typer
</pre></div>
<p>I&#39;ll also use DuckDB, along with its <a href="https://duckdb.org/docs/extensions/json">JSON</a> and <a href="https://duckdb.org/docs/extensions/spatial.html">Spatial</a> extensions, in this post.</p>
<div><pre><span></span>$<span> </span><span>cd</span><span> </span>~
$<span> </span>wget<span> </span>-c<span> </span>https://github.com/duckdb/duckdb/releases/download/v0.9.1/duckdb_cli-linux-amd64.zip
$<span> </span>unzip<span> </span>-j<span> </span>duckdb_cli-linux-amd64.zip
$<span> </span>chmod<span> </span>+x<span> </span>duckdb
$<span> </span>~/duckdb
</pre></div>
<div><pre><span></span><span>INSTALL</span><span> </span><span>json</span><span>;</span>
<span>INSTALL</span><span> </span><span>spatial</span><span>;</span>
</pre></div>
<p>I&#39;ll set up DuckDB to load all these extensions each time it launches.</p>

<div><pre><span></span>.timer on
.width 180
LOAD json;
LOAD spatial;
</pre></div>
<p>The maps in this post were rendered with <a href="https://www.qgis.org/en/site/forusers/download.html">QGIS</a> version 3.34. QGIS is a desktop application that runs on Windows, macOS and Linux.</p>
<p>I used QGIS&#39; <a href="https://geoinformaticsworld.com/how-to-download-and-install-google-earth-images-in-qgis-using-tiles-plugin/">Tile+ plugin</a> to add Esri&#39;s World Imagery Basemap to each of the map renderings. This basemap helps provide visual context around Maxar&#39;s imagery.</p>
</div>
<div id="downloading-satellite-imagery">
<h2>Downloading Satellite Imagery</h2>
<p><a href="https://www.linkedin.com/in/giswqs/">Qiusheng Wu</a>, an Associate Professor at the University of Tennessee manages a <a href="https://github.com/opengeos/maxar-open-data/">GitHub repository</a> that contains metadata and manifests for the 28 image sets Maxar has made freely available. I&#39;ll clone this repo on my mechanical drive and create a downloads folder for the imagery.</p>
<div><pre><span></span>$<span> </span>git<span> </span>clone<span> </span>https://github.com/opengeos/maxar-open-data/
$<span> </span><span>cd</span><span> </span>maxar-open-data
$<span> </span>mkdir<span> </span>-p<span> </span>downloads
</pre></div>
<p>I&#39;ve put together a script that will download all of the &#39;visual&#39; images from Maxar&#39;s datasets. It contains a progress bar to give you an idea of how long the whole process will take.</p>
<p>If this script fails, it can be run again and it won&#39;t re-download any existing images, only ones not yet downloaded.</p>
<p>It will skip past certain errors and when the script has finished, you can run it again to re-try those URLs it wasn&#39;t able to download from already.</p>
<p>If new datasets are published, you can run <tt>git pull</tt> to get the new metadata and manifests and then run the download script again.</p>

<div><pre><span></span><span>#!/usr/bin/env python3</span>
<span># -*- coding: utf-8 -*-</span>
<span>from</span>   <span>glob</span>     <span>import</span> <span>glob</span>
<span>import</span> <span>json</span>
<span>from</span>   <span>os</span>       <span>import</span> <span>makedirs</span><span>,</span> <span>path</span>
<span>from</span>   <span>random</span>   <span>import</span> <span>shuffle</span>
<span>import</span> <span>requests</span>

<span>from</span>   <span>rich.progress</span> <span>import</span> <span>track</span>
<span>import</span> <span>typer</span>


<span>app</span> <span>=</span> <span>typer</span><span>.</span><span>Typer</span><span>(</span><span>rich_markup_mode</span><span>=</span><span>&#39;rich&#39;</span><span>)</span>


<span>@app</span><span>.</span><span>command</span><span>()</span>
<span>def</span> <span>download</span><span>(</span><span>timeout</span><span>:</span> <span>int</span> <span>=</span> <span>60</span><span>):</span>
    <span>geojsons</span> <span>=</span> <span>[</span><span>x</span>
                <span>for</span> <span>x</span> <span>in</span> <span>glob</span><span>(</span><span>&#39;datasets/*.geojson&#39;</span><span>)</span>
                <span>if</span> <span>&#39;union&#39;</span> <span>not</span> <span>in</span> <span>x</span><span>]</span>
    <span>shuffle</span><span>(</span><span>geojsons</span><span>)</span>

    <span>for</span> <span>geojson</span> <span>in</span> <span>geojsons</span><span>:</span>
        <span>print</span><span>(</span><span>geojson</span><span>)</span>
        <span>recs</span> <span>=</span> <span>json</span><span>.</span><span>loads</span><span>(</span><span>open</span><span>(</span><span>geojson</span><span>,</span> <span>&#39;r&#39;</span><span>)</span><span>.</span><span>read</span><span>())</span>

        <span>urls</span> <span>=</span> <span>[</span><span>x</span><span>[</span><span>&#39;properties&#39;</span><span>][</span><span>&#39;visual&#39;</span><span>]</span>
                <span>for</span> <span>x</span> <span>in</span> <span>recs</span><span>[</span><span>&#39;features&#39;</span><span>]]</span>
        <span>shuffle</span><span>(</span><span>urls</span><span>)</span>

        <span>folder</span> <span>=</span> <span>&#39;downloads/&#39;</span> <span>+</span> <span>geojson</span><span>.</span><span>split</span><span>(</span><span>&#39;/&#39;</span><span>)[</span><span>-</span><span>1</span><span>]</span><span>.</span><span>split</span><span>(</span><span>&#39;.&#39;</span><span>)[</span><span>0</span><span>]</span>

        <span>try</span><span>:</span>
            <span>makedirs</span><span>(</span><span>folder</span><span>)</span>
        <span>except</span> <span>FileExistsError</span><span>:</span>
            <span>pass</span>

        <span>for</span> <span>url</span> <span>in</span> <span>track</span><span>(</span><span>urls</span><span>,</span> <span>description</span><span>=</span><span>&#39;Downloading..&#39;</span><span>):</span>
            <span>date</span> <span>=</span> <span>url</span><span>.</span><span>split</span><span>(</span><span>&#39;/&#39;</span><span>)[</span><span>-</span><span>2</span><span>]</span>
            <span>assert</span> <span>len</span><span>(</span><span>date</span><span>)</span> <span>==</span> <span>len</span><span>(</span><span>&#39;YYYY-MM-DD&#39;</span><span>)</span>
            <span>out_filename</span> <span>=</span> <span>&#39;ard&#39;</span> <span>+</span> <span>url</span><span>.</span><span>split</span><span>(</span><span>&#39;/ard&#39;</span><span>)[</span><span>-</span><span>1</span><span>]</span><span>.</span><span>replace</span><span>(</span><span>&#39;/&#39;</span><span>,</span> <span>&#39;_&#39;</span><span>)</span>
            <span>output_path</span> <span>=</span> <span>&#39;</span><span>%s</span><span>/</span><span>%s</span><span>/</span><span>%s</span><span>&#39;</span> <span>%</span> <span>(</span><span>folder</span><span>,</span> <span>date</span><span>,</span> <span>out_filename</span><span>)</span>

            <span>try</span><span>:</span>
                <span>makedirs</span><span>(</span><span>folder</span> <span>+</span> <span>&#39;/&#39;</span> <span>+</span> <span>date</span><span>)</span>
            <span>except</span> <span>FileExistsError</span><span>:</span>
                <span>pass</span>

            <span>if</span> <span>path</span><span>.</span><span>isfile</span><span>(</span><span>output_path</span><span>):</span>
                <span>continue</span>

            <span>print</span><span>(</span><span>out_filename</span><span>)</span>

            <span>try</span><span>:</span>
                <span>r</span> <span>=</span> <span>requests</span><span>.</span><span>get</span><span>(</span><span>url</span><span>,</span> <span>timeout</span><span>=</span><span>timeout</span><span>)</span>
            <span>except</span> <span>Exception</span> <span>as</span> <span>exc</span><span>:</span>
                <span>print</span><span>(</span><span>exc</span><span>)</span>
                <span>continue</span>

            <span>with</span> <span>open</span><span>(</span><span>output_path</span><span>,</span> <span>&#39;wb&#39;</span><span>)</span> <span>as</span> <span>f</span><span>:</span>
                <span>f</span><span>.</span><span>write</span><span>(</span><span>r</span><span>.</span><span>content</span><span>)</span>


<span>if</span> <span>__name__</span> <span>==</span> <span>&#34;__main__&#34;</span><span>:</span>
    <span>app</span><span>()</span>
</pre></div>

<p>The script downloaded almost 1 TB worth of TIFFs. Here is the breakdown with file counts for each event.</p>
<div><pre><span></span>  Size | Number of Files | Event
-------|-----------------|----------------------------------------
386 GB |           8,724 | Morocco-Earthquake-Sept-2023
164 GB |           4,207 | Hurricane-Ian-9-26-2022
101 GB |           2,549 | pakistan-flooding22
 80 GB |           2,024 | Kahramanmaras-turkey-earthquake-23
 38 GB |             933 | southafrica-flooding22
 29 GB |             677 | Hurricane-Idalia-Florida-Aug23
 29 GB |             794 | cyclone-emnati22
 19 GB |             395 | afghanistan-earthquake22
 13 GB |             339 | tonga-volcano21
 13 GB |             280 | yellowstone-flooding22
 11 GB |             284 | volcano-indonesia21
8.1 GB |             206 | BayofBengal-Cyclone-Mocha-May-23
8.1 GB |             245 | Emilia-Romagna-Italy-flooding-may23
8.0 GB |             274 | Hurricane-Fiona-9-19-2022
7.2 GB |             296 | ghana-explosion22
6.1 GB |             186 | Libya-Floods-Sept-2023
4.8 GB |             185 | kentucky-flooding-7-29-2022
3.5 GB |             246 | Maui-Hawaii-fires-Aug-23
3.4 GB |             124 | Indonesia-Earthquake22
2.8 GB |              86 | NWT-Canada-Aug-23
2.1 GB |              80 | Gambia-flooding-8-11-2022
1.5 GB |              57 | Sudan-flooding-8-22-2022
1.4 GB |              51 | India-Floods-Oct-2023
1.1 GB |              31 | McDougallCreekWildfire-BC-Canada-Aug-23
  1 GB |              37 | New-Zealand-Flooding23
598 MB |              24 | Kalehe-DRC-Flooding-5-8-23
446 MB |              18 | shovi-georgia-landslide-8Aug23
424 MB |              15 | Marshall-Fire-21-Update
</pre></div>
<p>The following naming convention was used for the images.</p>
<div><pre><span></span>downloads/&lt;event&gt;/&lt;date&gt;/ard_&lt;utm_zone&gt;_&lt;quadkey&gt;_&lt;date&gt;_&lt;catalog_id&gt;-visual.tif
</pre></div>
</div>
<div id="tiled-multi-resolution-tiffs">
<h2>Tiled Multi-Resolution TIFFs</h2>
<p>The TIFF files are containers called <a href="https://iipimage.sourceforge.io/documentation/images">Tiled Multi-Resolution TIFFs</a>  / Tiled Pyramid TIFFs. There are several versions of the same image at different resolutions within the TIFF file.</p>
<p>Below I&#39;ll write a parser to convert the output from <tt>tiffinfo</tt> into JSON.</p>

<div><pre><span></span><span>import</span> <span>json</span>
<span>import</span> <span>re</span>
<span>import</span> <span>sys</span>


<span>stack</span><span>,</span> <span>stack_id</span> <span>=</span> <span>{},</span> <span>None</span>

<span>for</span> <span>line</span> <span>in</span> <span>sys</span><span>.</span><span>stdin</span><span>.</span><span>read</span><span>()</span><span>.</span><span>splitlines</span><span>():</span>
    <span>if</span> <span>not</span> <span>stack_id</span><span>:</span>
        <span>stack_id</span> <span>=</span> <span>1</span>
    <span>elif</span> <span>line</span><span>.</span><span>startswith</span><span>(</span><span>&#39;TIFF Directory&#39;</span><span>):</span>
        <span>stack_id</span> <span>=</span> <span>stack_id</span> <span>+</span> <span>1</span>
    <span>elif</span> <span>line</span><span>.</span><span>startswith</span><span>(</span><span>&#39;  &#39;</span><span>)</span> <span>and</span> <span>line</span><span>.</span><span>count</span><span>(</span><span>&#39;:&#39;</span><span>)</span> <span>==</span> <span>1</span><span>:</span>
        <span>if</span> <span>stack_id</span> <span>not</span> <span>in</span> <span>stack</span><span>.</span><span>keys</span><span>():</span>
            <span>stack</span><span>[</span><span>stack_id</span><span>]</span> <span>=</span> <span>{</span><span>&#39;stack_num&#39;</span><span>:</span> <span>stack_id</span><span>}</span>

        <span>x</span><span>,</span> <span>y</span> <span>=</span> <span>line</span><span>.</span><span>strip</span><span>()</span><span>.</span><span>split</span><span>(</span><span>&#39;:&#39;</span><span>)</span>

        <span>if</span> <span>len</span><span>(</span><span>x</span><span>)</span> <span>&gt;</span> <span>1</span> <span>and</span> <span>not</span> <span>x</span><span>.</span><span>startswith</span><span>(</span><span>&#39;Tag &#39;</span><span>)</span> <span>and</span> <span>y</span> <span>and</span> <span>len</span><span>(</span><span>str</span><span>(</span><span>y</span><span>)</span><span>.</span><span>strip</span><span>())</span> <span>&gt;</span> <span>1</span><span>:</span>
            <span>stack</span><span>[</span><span>stack_id</span><span>][</span><span>x</span><span>.</span><span>strip</span><span>()]</span> <span>=</span> <span>y</span><span>.</span><span>strip</span><span>()</span>
    <span>elif</span> <span>line</span><span>.</span><span>startswith</span><span>(</span><span>&#39;  &#39;</span><span>)</span> <span>and</span> <span>line</span><span>.</span><span>count</span><span>(</span><span>&#39;:&#39;</span><span>)</span> <span>==</span> <span>2</span> <span>and</span> <span>&#39;Image Width&#39;</span> <span>in</span> <span>line</span><span>:</span>
        <span>if</span> <span>stack_id</span> <span>not</span> <span>in</span> <span>stack</span><span>.</span><span>keys</span><span>():</span>
            <span>stack</span><span>[</span><span>stack_id</span><span>]</span> <span>=</span> <span>{</span><span>&#39;stack_num&#39;</span><span>:</span> <span>stack_id</span><span>}</span>

        <span>_</span><span>,</span> <span>width</span><span>,</span> <span>_</span><span>,</span> <span>_</span><span>,</span> <span>_</span> <span>=</span> <span>re</span><span>.</span><span>split</span><span>(</span><span>&#39;([0-9]*)&#39;</span><span>,</span> <span>line</span><span>)</span>
        <span>stack</span><span>[</span><span>stack_id</span><span>][</span><span>&#39;width&#39;</span><span>]</span> <span>=</span> <span>int</span><span>(</span><span>width</span><span>.</span><span>strip</span><span>())</span>

<span>print</span><span>(</span><span>json</span><span>.</span><span>dumps</span><span>([</span><span>y</span> <span>for</span> <span>x</span><span>,</span> <span>y</span> <span>in</span> <span>stack</span><span>.</span><span>items</span><span>()],</span> <span>indent</span><span>=</span><span>4</span><span>,</span> <span>sort_keys</span><span>=</span><span>True</span><span>))</span>
</pre></div>
<p>The following will produce a JSON file with the metadata of one of Maxar&#39;s TIFFs.</p>
<div><pre><span></span>$<span> </span>tiffinfo<span> </span>-i<span> </span>downloads/BayofBengal-Cyclone-Mocha-May-23/2023-01-03/ard_46_033113111121_2023-01-03_104001007EBB7C00-visual.tif<span> </span><span>\</span>
<span>    </span><span>|</span><span> </span>python<span> </span>json_tiff.py<span> </span><span>\</span>
<span>    </span>&gt;<span> </span>metadata.json
</pre></div>
<p>I&#39;ll use DuckDB to cherry-pick a few columns of interest.</p>

<div><pre><span></span><span>SELECT</span><span> </span><span>stack_num</span><span>,</span>
<span>       </span><span>&#34;Compression Scheme&#34;</span><span>,</span>
<span>       </span><span>&#34;Photometric Interpretation&#34;</span><span>,</span>
<span>       </span><span>&#34;width&#34;</span>
<span>FROM</span><span> </span><span>READ_JSON</span><span>(</span><span>&#39;metadata.json&#39;</span><span>,</span>
<span>               </span><span>auto_detect</span><span>=</span><span>true</span><span>)</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>2</span><span> </span><span>DESC</span><span>,</span>
<span>         </span><span>4</span><span> </span><span>DESC</span><span>;</span>
</pre></div>
<div><pre><span></span>┌───────────┬────────────────────┬────────────────────────────┬───────┐
│ stack_num │ Compression Scheme │ Photometric Interpretation │ width │
│   int64   │      varchar       │          varchar           │ int64 │
├───────────┼────────────────────┼────────────────────────────┼───────┤
│         1 │ JPEG               │ YCbCr                      │ 17408 │
│         3 │ JPEG               │ YCbCr                      │  8704 │
│         4 │ JPEG               │ YCbCr                      │  4352 │
│         5 │ JPEG               │ YCbCr                      │  2176 │
│         6 │ JPEG               │ YCbCr                      │  1088 │
│         7 │ JPEG               │ YCbCr                      │   544 │
│         8 │ JPEG               │ YCbCr                      │   272 │
│         2 │ AdobeDeflate       │ transparency mask          │ 17408 │
│         9 │ AdobeDeflate       │ transparency mask          │  8704 │
│        10 │ AdobeDeflate       │ transparency mask          │  4352 │
│        11 │ AdobeDeflate       │ transparency mask          │  2176 │
│        12 │ AdobeDeflate       │ transparency mask          │  1088 │
│        13 │ AdobeDeflate       │ transparency mask          │   544 │
│        14 │ AdobeDeflate       │ transparency mask          │   272 │
├───────────┴────────────────────┴────────────────────────────┴───────┤
│ 14 rows                                                   4 columns │
└─────────────────────────────────────────────────────────────────────┘
</pre></div>
<p>Within the TIFF, the original JPEG&#39;s image width is 17,408 pixels wide. There are 6 subsequent images each roughly half the width of their parent image. There is also an alpha channel with 6 alternative widths as well.</p>
</div>
<div id="maxar-s-satellite-fleet">
<h2>Maxar&#39;s Satellite Fleet</h2>
<p>Four of Maxar&#39;s Satellites have provided the imagery available in these image sets. Every image&#39;s metadata contains the platform / satellite name used to take the photo.</p>
<p>GeoEye-1 (GE01) was built by General Dynamics and launched by Boeing in 2008. It was expected to run for 7 years but it still running to this day, 15 years later. It&#39;s located 673 KM above the Earth&#39;s surface and can capture 41 cm panchromatic imagery and 165 cm multispectral imagery.</p>
<p>WorldView-2 (WV02) was built by Ball Aerospace and launched by Boeing in 2009. It was expected to run for ~7 years but it still running to this day, 14 years later. It&#39;s located 772 KM above the Earth&#39;s surface and can capture 46 cm panchromatic imagery and 184 cm eight-band multispectral imagery. It can take a photograph of anywhere on early every 1.1 days. This satellite was hit by space debris in 2016 but Maxar deemed the damage to be minimal.</p>
<p>WorldView-3 (WV03) was built by Ball Aerospace and launched by Lockheed Martin in 2014. It was expected to run for ~7 years but it still running to this day, 9 years later. It&#39;s located 619 KM above the Earth&#39;s surface and can capture 31 cm panchromatic imagery, 124 cm eight-band multispectral imagery, 370 cm short wave infrared imagery and 3000 cm CAVIS (Clouds, Aerosols, Vapors, Ice, and Snow) data imagery. This satellite <a href="https://landsat.gsfc.nasa.gov/article/satellite-sees-satellite-landsat-8-in-orbit/">took a photo</a> of the Landsat 8 satellite last year.</p>
<p>WorldView-4 (WV04) was built by Lockheed Martin and launched in 2016. In 2019, it failed and it re-entered the Earth&#39;s Atmosphere over New Zealand in late 2021. It&#39;s was located 613 KM above the Earth&#39;s surface and could capture 31 cm panchromatic imagery, 124 cm multispectral imagery, 450-800 nm panchromatic wavelengths and 450-920 nm multispectral imagery.</p>
</div>

<div id="years-x-4-satellites">
<h2>13 years x 4 Satellites</h2>
<p>Below are the number of images per year that were produced by each satellite in this dataset.</p>

<div><pre><span></span><span>SELECT</span><span> </span><span>YEAR</span><span>(</span><span>datetime</span><span>)</span><span> </span><span>AS</span><span> </span><span>year</span><span>,</span>
<span>       </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>FILTER</span><span> </span><span>(</span><span>WHERE</span><span> </span><span>platform</span><span> </span><span>=</span><span> </span><span>&#39;GE01&#39;</span><span>)</span><span> </span><span>AS</span><span> </span><span>GE01</span><span>,</span>
<span>       </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>FILTER</span><span> </span><span>(</span><span>WHERE</span><span> </span><span>platform</span><span> </span><span>=</span><span> </span><span>&#39;WV02&#39;</span><span>)</span><span> </span><span>AS</span><span> </span><span>WV02</span><span>,</span>
<span>       </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>FILTER</span><span> </span><span>(</span><span>WHERE</span><span> </span><span>platform</span><span> </span><span>=</span><span> </span><span>&#39;WV03&#39;</span><span>)</span><span> </span><span>AS</span><span> </span><span>WV03</span><span>,</span>
<span>       </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>FILTER</span><span> </span><span>(</span><span>WHERE</span><span> </span><span>platform</span><span> </span><span>=</span><span> </span><span>&#39;WV04&#39;</span><span>)</span><span> </span><span>AS</span><span> </span><span>WV04</span>
<span>FROM</span><span> </span><span>maxar</span>
<span>GROUP</span><span> </span><span>BY</span><span> </span><span>1</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>1</span><span>;</span>
</pre></div>
<div><pre><span></span>┌───────┬───────┬───────┬───────┬───────┐
│ year  │ GE01  │ WV02  │ WV03  │ WV04  │
│ int64 │ int64 │ int64 │ int64 │ int64 │
├───────┼───────┼───────┼───────┼───────┤
│  2010 │     0 │   133 │     0 │     0 │
│  2011 │     5 │    41 │     0 │     0 │
│  2012 │     0 │    44 │     0 │     0 │
│  2013 │     0 │   121 │     0 │     0 │
│  2014 │     0 │   217 │     0 │     0 │
│  2015 │    32 │     0 │    94 │     0 │
│  2016 │     0 │    75 │     0 │     0 │
│  2017 │   205 │   118 │    78 │     0 │
│  2018 │    88 │   250 │   770 │   248 │
│  2019 │   152 │   238 │   773 │     0 │
│  2020 │   168 │   281 │   471 │     0 │
│  2021 │   512 │  1038 │   752 │     0 │
│  2022 │  1949 │  4930 │  3033 │     0 │
│  2023 │   774 │  2484 │  1743 │     0 │
├───────┴───────┴───────┴───────┴───────┤
│ 14 rows                     5 columns │
└───────────────────────────────────────┘
</pre></div>
<p>Within any one event&#39;s dataset, there can be imagery from multiple years and multiple satellites. The Moroccan dataset is 386 GB and has 8,700 images taken by four satellites at different times over a 13-year period.</p>
<p>Below I&#39;ve coloured the image footprints by year using the following expression in QGIS.</p>
<div><pre><span></span><span>ramp_color</span><span>(</span><span>&#39;Wiener Challah&#39;</span><span>,</span><span> </span><span>(</span><span>2023</span><span> </span><span>-</span><span> </span><span>to_int</span><span>(</span><span>substr</span><span>(</span><span>&#34;datetime&#34;</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>4</span><span>)))</span><span> </span><span>/</span><span> </span><span>13</span><span>)</span>
</pre></div>
<p><a href="https://tech.marksblogg.com/theme/images/maxar-morocco-years.jpg"><img alt="Maxar Open Data Years of Morocco Imagery" src="https://tech.marksblogg.com/theme/images/maxar-morocco-years.jpg"/></a></p><p>Multiple satellites could provide imagery over a short period of time as well. Below both WorldView-02 and WorldView-03 imagery were sourced for New Zealand with the images taken a few weeks apart from one another. The outlines are labelled with the abbreviations for their respective satellites and for clarity, the satellite imagery basemap is from Esri, not Maxar.</p>
<p><a href="https://tech.marksblogg.com/theme/images/maxar-nz-2022.jpg"><img alt="Maxar Open Data New Zealand 2022 Satellite Platforms" src="https://tech.marksblogg.com/theme/images/maxar-nz-2022.jpg"/></a></p><p>Below are the number of images taken by each satellite for each event in this dataset.</p>
<div><pre><span></span><span>SELECT</span><span> </span><span>event</span><span>,</span>
<span>       </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>FILTER</span><span> </span><span>(</span><span>WHERE</span><span> </span><span>platform</span><span> </span><span>=</span><span> </span><span>&#39;GE01&#39;</span><span>)</span><span> </span><span>AS</span><span> </span><span>GE01</span><span>,</span>
<span>       </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>FILTER</span><span> </span><span>(</span><span>WHERE</span><span> </span><span>platform</span><span> </span><span>=</span><span> </span><span>&#39;WV02&#39;</span><span>)</span><span> </span><span>AS</span><span> </span><span>WV02</span><span>,</span>
<span>       </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>FILTER</span><span> </span><span>(</span><span>WHERE</span><span> </span><span>platform</span><span> </span><span>=</span><span> </span><span>&#39;WV03&#39;</span><span>)</span><span> </span><span>AS</span><span> </span><span>WV03</span><span>,</span>
<span>       </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>FILTER</span><span> </span><span>(</span><span>WHERE</span><span> </span><span>platform</span><span> </span><span>=</span><span> </span><span>&#39;WV04&#39;</span><span>)</span><span> </span><span>AS</span><span> </span><span>WV04</span>
<span>FROM</span><span> </span><span>maxar</span>
<span>GROUP</span><span> </span><span>BY</span><span> </span><span>1</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>UPPER</span><span>(</span><span>event</span><span>);</span>
</pre></div>
<div><pre><span></span>┌─────────────────────────────────────────┬───────┬───────┬───────┬───────┐
│                  event                  │ GE01  │ WV02  │ WV03  │ WV04  │
│                 varchar                 │ int64 │ int64 │ int64 │ int64 │
├─────────────────────────────────────────┼───────┼───────┼───────┼───────┤
│ afghanistan-earthquake22                │    42 │   234 │   119 │     0 │
│ BayofBengal-Cyclone-Mocha-May-23        │     0 │    85 │   121 │     0 │
│ cyclone-emnati22                        │   482 │   259 │    53 │     0 │
│ Emilia-Romagna-Italy-flooding-may23     │   154 │    73 │    18 │     0 │
│ Gambia-flooding-8-11-2022               │     6 │    18 │    56 │     0 │
│ ghana-explosion22                       │    73 │   150 │     0 │     0 │
│ Hurricane-Fiona-9-19-2022               │   139 │    12 │    99 │     0 │
│ Hurricane-Ian-9-26-2022                 │   591 │  2126 │   776 │     0 │
│ Hurricane-Idalia-Florida-Aug23          │   207 │   223 │   224 │     0 │
│ India-Floods-Oct-2023                   │     9 │    30 │    12 │     0 │
│ Indonesia-Earthquake22                  │    12 │    97 │    15 │     0 │
│ Kahramanmaras-turkey-earthquake-23      │    58 │  1579 │   381 │     0 │
│ Kalehe-DRC-Flooding-5-8-23              │     0 │     8 │    16 │     0 │
│ kentucky-flooding-7-29-2022             │    78 │   107 │     0 │     0 │
│ Libya-Floods-Sept-2023                  │   100 │    53 │    33 │     0 │
│ Marshall-Fire-21-Update                 │     0 │     0 │     0 │     0 │
│ Maui-Hawaii-fires-Aug-23                │    60 │    63 │     0 │     0 │
│ McDougallCreekWildfire-BC-Canada-Aug-23 │    17 │    14 │     0 │     0 │
│ Morocco-Earthquake-Sept-2023            │  1028 │  2830 │  4626 │   240 │
│ New-Zealand-Flooding23                  │     0 │    26 │    11 │     0 │
│ NWT-Canada-Aug-23                       │     0 │     0 │    86 │     0 │
│ pakistan-flooding22                     │   305 │   858 │   603 │     0 │
│ shovi-georgia-landslide-8Aug23          │    13 │     0 │     5 │     0 │
│ southafrica-flooding22                  │   128 │   305 │   109 │     0 │
│ Sudan-flooding-8-22-2022                │    24 │     0 │    24 │     0 │
│ tonga-volcano21                         │    51 │   188 │   100 │     0 │
│ volcano-indonesia21                     │   152 │   132 │     0 │     0 │
│ yellowstone-flooding22                  │    30 │   250 │     0 │     0 │
├─────────────────────────────────────────┴───────┴───────┴───────┴───────┤
│ 28 rows                                                       5 columns │
└─────────────────────────────────────────────────────────────────────────┘
</pre></div>
</div>
<div id="finding-a-location-s-imagery">
<h2>Finding a Location&#39;s Imagery</h2>
<p>Below I&#39;ll search through the 20K+ images for an area of interest. I&#39;ll use OpenStreetMap (OSM) to get the coordinates for the main Airport in Marrakesh, Morocco.</p>
<div><pre><span></span>$<span> </span>curl<span> </span>--silent<span> </span><span>\</span>
<span>       </span>--get<span> </span><span>\</span>
<span>       </span>--data-urlencode<span> </span><span>&#34;format=json&#34;</span><span> </span><span>\</span>
<span>       </span>--data-urlencode<span> </span><span>&#34;limit=1&#34;</span><span> </span><span>\</span>
<span>       </span>--data-urlencode<span> </span><span>&#34;q=Marrakesh Airport&#34;</span><span> </span><span>\</span>
<span>       </span>https://nominatim.openstreetmap.org/search<span> </span><span>\</span>
<span>    </span><span>|</span><span> </span>jq<span> </span>--slurp<span> </span><span>\</span>
<span>        </span><span>&#39;.[0][0] | &#34;\(.lon) \(.lat)&#34;&#39;</span>
</pre></div>
<div><pre><span></span><span>&#34;-8.032439841503606 31.60587285&#34;</span>
</pre></div>
<p>I&#39;ll then find the latest record that has geometry covering that point.</p>

<div><pre><span></span><span>.</span><span>mode</span><span> </span><span>line</span>

<span>SELECT</span><span>   </span><span>*</span>
<span>FROM</span><span>     </span><span>maxar</span>
<span>WHERE</span><span>    </span><span>ST_INTERSECTS</span><span>(</span><span>ST_POINT</span><span>(</span><span>-</span><span>8</span><span>.</span><span>032439841503606</span><span>,</span><span> </span><span>31</span><span>.</span><span>60587285</span><span>),</span>
<span>                       </span><span>geom</span><span>)</span>
<span>AND</span><span>      </span><span>datetime</span><span> </span><span>&gt;=</span><span> </span><span>&#39;2023-01-01&#39;</span><span>::</span><span>timestamp</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>datetime</span><span> </span><span>DESC</span>
<span>LIMIT</span><span>    </span><span>1</span><span>;</span>
</pre></div>
<p>The following image was taken by WorldView-03 the day after the earthquake.</p>
<div><pre><span></span>            datetime = 2023-09-10 11:25:15
            platform = WV03
                 gsd = 0.36
ard_metadata_version = 0.0.1
          catalog_id = 1040050057DC8500
            utm_zone = 29
             quadkey = 120202010210
      view:off_nadir = 23.9
        view:azimuth = 337.2
view:incidence_angle = 63.7
    view:sun_azimuth = 147.2
  view:sun_elevation = 59.5
           proj:epsg = 32629
           grid:code = MXRA-Z29-120202010210
           proj:bbox = 589843.75,3494843.75,595156.25,3500156.25
      tile:data_area = 28.2
    tile:clouds_area = 0.0
 tile:clouds_percent = 0
              visual = https://maxar-opendata.s3.amazonaws.com/events/Morocco-Earthquake-Sept-2023/ard/29/120202010210/2023-09-10/1040050057DC8500-visual.tif
               event = Morocco-Earthquake-Sept-2023
                geom = POLYGON ((-8.052596 31.633081, -8.053081 31.585156, -7.997097 31.584729, -7.996583 31.632653, -8.052596 31.633081))
</pre></div>
<p>The image has its position and projection details embedded within it. It&#39;ll place itself on the globe automatically when imported into QGIS or ArcGIS Pro.</p>
<div><pre><span></span>$<span> </span>gdalinfo<span> </span>downloads/Morocco-Earthquake-Sept-2023/2023-09-10/ard_29_120202010210_2023-09-10_1040050057DC8500-visual.tif
</pre></div>
<div><pre><span></span>...
Coordinate System is:
PROJCRS[&#34;WGS 84 / UTM zone 29N&#34;,
...
Corner Coordinates:
Upper Left  (  589843.750, 3500156.250) (  8d 3&#39; 9.35&#34;W, 31d37&#39;59.09&#34;N)
Lower Left  (  589843.750, 3494843.750) (  8d 3&#39;11.09&#34;W, 31d35&#39; 6.56&#34;N)
Upper Right (  595156.250, 3500156.250) (  7d59&#39;47.70&#34;W, 31d37&#39;57.55&#34;N)
Lower Right (  595156.250, 3494843.750) (  7d59&#39;49.55&#34;W, 31d35&#39; 5.02&#34;N)
</pre></div>
<p>I&#39;ll drop the image onto a new QGIS workspace and outline it in yellow to differentiate it from the Esri World Imagery Basemap surrounding it. I&#39;ve also imported polygons from OSM for this area as well. I&#39;ve colour coded and labelled the polygons by their <tt>landuse</tt> field.</p>
<p><a href="https://tech.marksblogg.com/theme/images/maxar-airport.jpg"><img alt="Maxar Open Data Morocco Marrakesh Airport" src="https://tech.marksblogg.com/theme/images/maxar-airport.jpg"/></a></p><p>Below is the image at 100% zoom. There is good visibility of cars and buildings on the ground and a lot could be inferred from imagery at this resolution.</p>
<p><a href="https://tech.marksblogg.com/theme/images/maxar-near-airport.jpg"><img alt="Maxar Open Data Morocco Marrakesh Airport" src="https://tech.marksblogg.com/theme/images/maxar-near-airport.jpg"/></a>
</p></div>

        </div><p>
            Thank you for taking the time to read this post. I offer both consulting and hands-on development services to clients in North America and Europe. If you&#39;d like to discuss how my offerings can help your business please contact me via <a href="https://uk.linkedin.com/in/marklitwintschik/">LinkedIn</a>.
        </p></div>
  </body>
</html>
