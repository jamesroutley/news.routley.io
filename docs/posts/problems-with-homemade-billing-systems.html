<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.getlago.com/blog/the-4-biggest-problems-with-homemade-billing-systems">Original</a>
    <h1>Problems with homemade billing systems</h1>
    
    <div id="readability-page-1" class="page"><div><div><div><a href="https://www.getlago.com/blog"><p>Blog</p></a><p>The 4 biggest problems with homemade billing systems</p></div></div></div><div><div><p>This article was written by <a href="https://www.linkedin.com/in/vincentpochet/" target="_blank">Vincent Pochet</a>, Senior Backend Developer at Lago.</p><p>——</p><p>In 2017, I joined Qonto, a B2B neobank in the making (<a href="https://techcrunch.com/2022/01/10/business-banking-startup-qonto-raises-552-million-at-5-billion-valuation/" target="_blank">now worth more than $5B</a>), and got involved in the design of the billing system.</p><p>As the company was scaling from cradle to unicorn, we faced many billing challenges: monthly and yearly plans, “pay-as-you-go” components (percentage on FX transfers, fixed fee on ATM withdrawals, user seats, printed cards, etc.), creation of invoices at scale, taxes, accounting… It was a never-ending nightmare.</p><p>Now, when someone asks for advice about their billing system, my answer is clear: <strong>DO NOT build it yourself</strong>.</p><p>It may look like an interesting project at the beginning, but you’ll soon regret it. And believe me, it only gets worse. As an engineer, if you’re told it’s a “two-month project”, run as far as you can before it’s too late and you become the “billing guy”!</p><p>‍</p><h3>#1 Pricing changes all the time and billing needs to follow</h3><p>After creating the first billing engine of Qonto, we were pretty happy with what we had built. We could ingest <strong>millions of events every week</strong>, our calculations were correct, we could generate sequential invoices, we were able to apply marketing coupons and we managed to debit our internal ledger. Everything was going well!</p><p>But then…</p><p>‍</p><h4>The marketing team came up with a new yearly plan</h4><p>Billing was performed on a monthly basis. At the end of each month, we had to query the database to compute fees and display them as billing items on the invoices. Customers were able to switch from a “monthly_solo” plan to a “monthly_premium” plan (and vice versa), and the upgrade/downgrade logic was working well (although it had been difficult to implement).</p><p>When the marketing team devised a new yearly plan to secure revenue for the next 12 months, I started to freak out: <strong>the entire billing logic was based on monthly boundaries</strong>. It took us two months to modify this logic. The hardest part was that the subscription fee had to be billed in advance, at the beginning of the annual period, but the overage related to usage-based features still had to be billed on a monthly basis.</p><p>‍</p><h4>The finance team asked to switch from anniversary to calendar dates</h4><p>At the time, customers were billed based on the anniversary date of their contract. For instance, if a customer had signed up for a monthly plan on March 16th, they were billed on the 16th of each month.</p><p>One day, the finance team requested a meeting with the engineering team and the CFO said:</p><p>‍</p><blockquote><em>“It would be easier for everyone if we switched from anniversary dates to calendar dates for subscriptions. Right now it’s a mess from an accounting perspective, so let’s bill everyone at the beginning of the calendar period.”</em></blockquote><p>‍</p><p>In other words, they wanted to switch from this…</p><figure class="w-richtext-align-fullwidth w-richtext-figure-type-image"><p><img src="https://uploads-ssl.webflow.com/63569f390f3a7ad4c76d2bd6/6357e464c526ce28312ccbe4_632c2492bb03b806277bb038_anniversary-billing.png" alt="Anniversary billing periods"/></p></figure><p>‍</p><p>To this...</p><figure class="w-richtext-align-fullwidth w-richtext-figure-type-image"><p><img src="https://uploads-ssl.webflow.com/63569f390f3a7ad4c76d2bd6/6357e464c526ce59c22ccbe5_632c24bc129a6f15e47f56a7_calendar-billing.png" alt="Calendar billing periods"/></p></figure><p>‍</p><p><strong>100,000 customers were affected</strong> by this migration. The accounting mess turned into an engineering nightmare, resulting in a three-month project.</p><p>Implementing billing logics takes time and things get incredibly complicated over time. Other typical organic changes include (but are not limited to):</p><p>• New features to be added to the pricing;</p><p>‍</p><h3>#2 Your billing system needs to scale with your user base</h3><p>A home-made billing system is not scalable if you don’t maintain it. At Qonto, our billing database contained millions of rows. This database was linked to our internal ledger, which was used to deduct fees from our customers’ accounts. Processing high volumes of events is hard, and when something breaks, you need to check whether past events need to be computed again (but you can’t afford to ingest the same event twice).</p><p>Generating invoices is also an important task. It’s not hard to create PDF files with line items on it. We used a library called <a href="https://gotenberg.dev/" target="_blank">Gotenberg</a> to display backend aggregations on a beautiful HTML template. However, it’s hard to process fees and generate millions of invoices at the same time. Your backend queries and aggregates millions of rows asynchronously, and the calculation must be correct for each customer.</p><p>The more complex the pricing, the more complicated the calculations. And the more customers you have, the more IT resources you need.</p><p>‍</p><h3>#3 Grandfathering causes headaches</h3><p>A few weeks ago, <a href="https://www.getlago.com/blog/pricing-billing-open-source-interview-with-algolias-co-founder" target="_blank">we interviewed Nicolas Dessaigne</a>, founder of Algolia and Group Partner at YC. He told us about their terrible experience with pricing and billing. After a series of “minor” changes to their price plans, they decided a few months ago to adopt a full usage-based pricing model and had to rebuild the entire billing logic.</p><p>As most customers had signed long-term contracts based on existing plans, they had to exclude them from the migration. This is called “<strong>grandfathering</strong>”. In this situation, engineers must not only implement new billing rules, but they also need to maintain the old logic for grandfathered plans.</p><p>In 2013, the pricing of Algolia was like this...</p><figure class="w-richtext-align-fullwidth w-richtext-figure-type-image"><p><img src="https://uploads-ssl.webflow.com/63569f390f3a7ad4c76d2bd6/6357e464c526ce1d8e2ccbe8_632c24e7491cef6fe07397bc_algolia-2013.png" alt="The pricing of Algolia in 2013"/></p></figure><p>‍</p><p>Then in 2015 it was like this...</p><figure class="w-richtext-align-fullwidth w-richtext-figure-type-image"><p><img src="https://uploads-ssl.webflow.com/63569f390f3a7ad4c76d2bd6/6357e464c526ce34662ccbe6_632c2505090891f38d817c95_algolia-2015.png" alt="The pricing of Algolia in 2015"/></p></figure><p>‍</p><p>And here is the 2022 update!</p><figure class="w-richtext-align-fullwidth w-richtext-figure-type-image"><p><img src="https://uploads-ssl.webflow.com/63569f390f3a7ad4c76d2bd6/6357e464c526ce64ad2ccbe7_632c25151344fba10f40b3eb_algolia-2022.png" alt="The pricing of Algolia in 2022"/></p></figure><p>‍</p><h3>#4 You must be prepared to staff an entire team</h3><p>Billing is never considered an expertise. It’s perceived as a background task and not as a prestigious project that engineers will fight for (they may even leave if they’re forced to work on it for a long time).</p><p>However, sooner or later, billing will be a full-time job for at least one engineer. Because of pricing changes, scalability challenges and grandfathered plans, complexity increases and so does the workload. Billing is built around your company’s product, it’s a living organism, not a feature.</p><p>At Qonto, the billing project was supposed to be completed by a single backend engineer in only two months. One year later, two backend engineers were still working on it full time.</p><p>Then <strong>the team of two backend engineers grew into a team of 20 people</strong>, including product managers, backend engineers and frontend engineers as well. Hiring, onboarding and retaining people to take care of our billing system was a constant challenge. They would have preferred to work on our core product, and our management team also wanted to downsize the team.</p><p>We considered implementing an off-the-shelf billing solution but there was nothing flexible enough and <strong>the switching costs were too high</strong>. Algolia also tried to migrate to Zuora before backing out and rebuilding their billing system for the fourth time. This is a decision you have to make in the early days, otherwise, at some point, your billing will be too complex and won’t fit any software product.</p><p>I left Qonto in March 2021 and I still get phone calls from engineers currently working there and struggling with billing. They learned these four lessons the hard way. They now know what it costs to build a homemade billing system.</p></div></div></div>
  </body>
</html>
