<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/unix/WindowSizeIoctlAndSignal">Original</a>
    <h1>The history of Unix&#39;s ioctl and signal about window sizes</h1>
    
    <div id="readability-page-1" class="page"><div><h2>The history of Unix&#39;s ioctl and signal about window sizes</h2>

	<p><small>November  3, 2024</small></p>
</div><div><p>One of the somewhat obscure features of Unix is that the kernel has
a specific interface to get (and set) the &#39;window size&#39; of your
terminal, and can also send a Unix signal to your process when that
size changes. The official POSIX interface for the former is
<a href="https://pubs.opengroup.org/onlinepubs/9799919799/functions/tcgetwinsize.html">tcgetwinsize()</a>,
but in practice actual Unixes have a standard tty <a href="https://en.wikipedia.org/wiki/Ioctl">ioctl</a> for this, <code>TIOCGWINSZ</code> (see
eg <a href="https://man7.org/linux/man-pages/man2/ioctl_tty.2.html">Linux ioctl_tty(2)</a> (<a href="https://man7.org/linux/man-pages/man2/TIOCSWINSZ.2const.html">also</a>) or
<a href="https://man.freebsd.org/cgi/man.cgi?tty(4)">FreeBSD tty(4)</a>). The
signal is officially standardized by POSIX as <a href="https://pubs.opengroup.org/onlinepubs/9799919799/basedefs/signal.h.html">SIGWINCH</a>,
which is the name it always has had.  Due to <a href="https://mastodon.social/@cks/113420346633001178">a Fediverse conversation</a>, I looked into
the history of this today, and it turns out to be more interesting
than I expected.</p>

<p>(The inclusion of these interfaces in POSIX turns out to be <a href="https://austingroupbugs.net/view.php?id=1151">fairly
recent</a>.)</p>

<p>As far as I can tell, 4.2 BSD did not have either TIOCGWINSZ or
SIGWINCH (based on its <a href="https://www.tuhs.org/cgi-bin/utree.pl?file=4.2BSD/usr/man/man2/sigvec.2">sigvec(2)</a>
and <a href="https://www.tuhs.org/cgi-bin/utree.pl?file=4.2BSD/usr/man/man4/tty.4">tty(4)</a>
manual pages). Both of these appear in the main BSD line in 4.3
BSD, where <a href="https://www.tuhs.org/cgi-bin/utree.pl?file=4.3BSD/usr/man/man2/sigvec.2">sigvec(2)</a>
has added SIGWINCH (<a href="https://utcc.utoronto.ca/~cks/space/blog/unix/SignalsHowOld">as the first new signal along with some others</a>) and <a href="https://www.tuhs.org/cgi-bin/utree.pl?file=4.3BSD/usr/man/man4/tty.4">tty(4)</a> has
TIOCGWINSZ. This timing makes a certain amount of sense in Unix
history. At the time of 4.2 BSD&#39;s development and release, people
were connecting to Unix systems using serial terminals, which had
more or less fixed sizes that were covered by termcap&#39;s basic size
information. By the time of 4.3 BSD in 1986, Unix workstations
existed and with them, terminal windows that could have their size
changed on the fly; a way of finding out (and changing) this size
was an obvious need, along with a way for full-screen programs like
vi to get notified if their terminal window was resized on the fly.</p>

<p>However, as far as I can tell 4.3 BSD itself did not originate
SIGWINCH, although it may be the source of TIOCGWINSZ. The FreeBSD
project has manual pages for a variety of Unixes, including &#39;Sun
OS 0.4&#39;, which seems to be an extremely early release from early
1983. This release has a <a href="https://man.freebsd.org/cgi/man.cgi?query=signal&amp;apropos=0&amp;sektion=0&amp;manpath=Sun+UNIX+0.4&amp;arch=default&amp;format=html">signal(2)</a>
with a SIGWINCH signal (using signal number 28, which is what 4.3
BSD will use for it), but no (documented) TIOCGWINSZ. However, it
does have <a href="https://man.freebsd.org/cgi/man.cgi?query=sizesh&amp;sektion=1&amp;apropos=0&amp;manpath=Sun+UNIX+0.4">some programs that generate custom $TERMCAP values with
the right current window sizes</a>.</p>

<p>The Internet Archives has <a href="https://archive.org/search?query=creator%3A%22Sun+Microsystems%22">a variety of historical material from
Sun Microsystems</a>,
including (some) documentation for both SunOS 2.0 and SunOS 3.0.
This documentation makes it clear that the primary purpose of
SIGWINCH was to tell graphical programs that their window (or one
of them) had been changed, and they should repaint the window or
otherwise refresh the contents (a program with multiple windows
didn&#39;t get any indication of which window was damaged; the programming
advice is to repaint them all). The SunOS 2.0 <a href="https://archive.org/details/sun-system-interface/page/n302/mode/1up">tgetent()</a>
termcap function will specifically update what it gives you with
the current size of your window, but as far as I can tell there&#39;s
no other documented support of getting window sizes; it&#39;s not
mentioned in <a href="https://archive.org/details/sun-system-interface/page/n359/mode/1up">tty(4)</a> or
<a href="https://archive.org/details/sun-system-interface/page/n350/mode/1up">pty(4)</a>.
Similar wording appears in <a href="https://archive.org/details/unix-interface-ref">the SunOS 3.0 Unix Interface Reference
Manual</a>.</p>

<p>(There are PDFs of some SunOS documentation online (<a href="https://bitsavers.org/pdf/sun/sunos/">eg</a>), and up through SunOS 3.5 I
can&#39;t find any mention of directly getting the &#39;window size&#39;.  In
SunOS 4.0, we finally get a TIOCGWINSZ, documented in termio(4).
However, I have access to SunOS 3.5 source, and it does have a
TIOCGWINSZ ioctl, although that ioctl isn&#39;t documented. It&#39;s entirely
likely that TIOCGWINSZ was added (well) before SunOS 3.5.)</p>

<p>According to <a href="https://github.com/weiss/original-bsd">this Git version of the original BSD development
history</a>, BSD itself added
both SIGWINCH and TIOCGWINSZ at the end of 1984. The early SunOS
had SIGWINCH and it may well have had TIOCGWINSZ as well, so it&#39;s
possible that BSD got both from SunOS. It&#39;s also possible that early
SunOS had a different (terminal) window size mechanism than TIOCGWINSZ,
one more specific to their window system, and the UCB CSRG decided
to create a more general mechanism that Sun then copied back by the
time of SunOS 3.5 (possibly before the official release of 4.3 BSD,
since I suspect everyone in the BSD world was talking to each other
at that time).</p>

<p>PS: SunOS also appears to be the source of the mysteriously missing
signal 29 in 4.3 BSD (mentioned in my entry on <a href="https://utcc.utoronto.ca/~cks/space/blog/unix/SignalsHowOld">how old various
Unix signals are</a>). As described in the SunOS 3.4
sigvec() manual page, signal 29 is &#39;SIGLOST&#39;, &#34;resource lost (see
lockd(8C))&#34;. This appears to have been added at some point between
the initial SunOS 3.0 release and SunOS 3.4, but I don&#39;t know exactly
when.</p>
</div></div>
  </body>
</html>
