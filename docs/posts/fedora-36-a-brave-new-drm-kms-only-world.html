<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.dowhile0.org/2022/04/22/fedora-36-a-brave-new-drm-kms-only-world/">Original</a>
    <h1>Fedora 36: A brave new (DRM/KMS only) world</h1>
    
    <div id="readability-page-1" class="page"><article id="post-1879">
	<!-- .entry-header -->

	<div>
		
<div><p>The upcoming Fedora release includes a <a href="https://fedoraproject.org/wiki/Changes/ReplaceFbdevDrivers">change</a> proposed by <a href="https://nullr0ute.com/about">Peter Robinson</a> and yours truly, that disables all the <a href="https://www.kernel.org/doc/Documentation/fb/framebuffer.txt">Frame Buffer Device (fbdev)</a> drivers in the Linux kernel package.</p>
<p>This means that starting from Fedora 36, only <a href="https://www.kernel.org/doc/html/v4.15/gpu/drm-kms.html">DRM/KMS</a> drivers will be used, no more legacy stuff.</p>
<p>Many Linux developers have been arguing for over a decade now that <a href="https://www.ideasonboard.org/media/meetings/talks/20120829-lpc.pdf">fbdev is deprecated</a> and it has been almost 7 years since the previous <code>fbdev</code> maintainer <a href="https://lkml.org/lkml/2015/9/24/253">said</a> that no new <code>fbdev</code> drivers would be added to the kernel. So this feels like a change long overdue.</p>
<p>This was possible thanks to the work of <a href="https://github.com/tdz">Thomas Zimmermann</a> @ SUSE, who <a href="https://lore.kernel.org/dri-devel/20210430105840.30515-1-tzimmermann@suse.de">added the simpledrm driver</a>, that exposes the system framebuffer set-up by the firmware as a <code>DRM</code> device.</p>
<p>Using the <code>simpledrm</code> driver, a framebuffer would be available even if the platform does not have a <code>DRM</code> driver or the user disables it using the <code>nomodeset</code> <a href="https://www.kernel.org/doc/html/latest/admin-guide/kernel-parameters.html">kernel command-line parameter</a>.</p>
<p>Before this change, the video drivers used when <code>DRM</code> drivers were disabled with the <code>nomodeset</code> parameter, where either <code>efifb</code> (for systems booted with <a href="https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface">EFI</a>) or <code>vesafb</code> (for systems booted with legacy <a href="https://en.wikipedia.org/wiki/BIOS">BIOS</a> and a <a href="https://en.wikipedia.org/wiki/Video_Electronics_Standards_Association">VESA</a> video mode <a href="https://www.kernel.org/doc/html/latest/admin-guide/svga.html">selected on boot</a> using the <code>vga</code> kernel command line parameter).</p>
<p>The need to rely on the system framebuffer initialized by the firmware was the primary reason why these <code>fbdev</code> drivers were still enabled in the Fedora kernel.</p>
<p>But the <code>simpledrm</code> replaces both, since is able to expose any system framebuffer, as long as platform code pass it as a proper I/O memory region for the driver to use it.</p>
<p>That includes not only the EFI system framebuffer provided through the <a href="https://wiki.osdev.org/GOP">Graphics Output Protocol (GOP)</a> and the VESA framebuffer configured with the <code>vga</code> parameter, but also framebuffers whose information is passed to the kernel through other hardware description mechanisms. For example, as a <a href="https://www.kernel.org/doc/Documentation/devicetree/bindings/display/simple-framebuffer.yaml">&#34;simple-framebuffer&#34;</a> Device Tree node, which is common on <code>aarch64</code> devices.</p>
<p>Even when no <code>fbdev</code> drivers are used anymore, the <code>fbdev</code> subsystem is still enabled. This is needed because the <a href="https://www.kernel.org/doc/html/latest/fb/fbcon.html">The Framebuffer Console (fbcon)</a> needs an <code>fbdev</code> device to bind. But fortunately the <code>DRM</code> subsystem provides a generic <code>fbdev</code> emulation layer, so <code>DRM</code> drivers can also provide a <code>fbdev</code> interface for <code>fbcon</code> (or even to user-space that still expects an <code>fbdev</code> device to work).</p>
<p>While working on this, we found that a lot of assumptions made all over the stack were no longer true once <code>simpledrm</code> was used instead of <code>{efi,vesa}fb</code>. So changes were needed in the Linux kernel, Plymouth, GDM, Xorg, etc.</p>
<p>But that will be a topic for another post since this one got too long already!</p>
</div>
























			</div><!-- .entry-content -->

	<!-- .entry-meta -->
</article></div>
  </body>
</html>
