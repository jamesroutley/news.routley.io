<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://leandromoreira.com/2019/08/02/linux-ffmpeg-source-internals-a-good-software-design/">Original</a>
    <h1>Exploring Polymorphism in C: Lessons from Linux and FFmpeg&#39;s Code Design (2019)</h1>
    
    <div id="readability-page-1" class="page"><div>
		<main id="main" role="main">

					<div>
				
<article id="post-2412">
	<!-- .entry-header -->

	<div>
		<div>
<p>Learn how <a href="https://github.com/torvalds/linux" target="_blank" rel="noopener">Linux</a>/<a href="https://github.com/FFmpeg/FFmpeg" target="_blank" rel="noopener">FFmpeg</a> C partial codebase is organized to be extensible and act as if it were meant to have “polymorphism”. Specifically, we’re going to briefly explore how <strong>Linux concept of everything is a file</strong> works at the source code level as well as <strong>how FFmpeg can add support</strong> fast and easy <strong>for new formats</strong> and codecs.</p>
<p><img data-attachment-id="2424" data-permalink="https://leandromoreira.com/2019/08/02/linux-ffmpeg-source-internals-a-good-software-design/diagram_components/#main" data-orig-file="https://leandromoreira.com/wp-content/uploads/2019/08/diagram_components.png" data-orig-size="1086,311" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="diagram_components" data-image-description="" data-image-caption="" data-medium-file="https://leandromoreira.com/wp-content/uploads/2019/08/diagram_components.png?w=300" data-large-file="https://leandromoreira.com/wp-content/uploads/2019/08/diagram_components.png?w=700" src="https://leandromoreira.com/wp-content/uploads/2019/08/diagram_components.png?w=700" alt="diagram_components" srcset="https://leandromoreira.com/wp-content/uploads/2019/08/diagram_components.png 1086w, https://leandromoreira.com/wp-content/uploads/2019/08/diagram_components.png?w=150&amp;h=43 150w, https://leandromoreira.com/wp-content/uploads/2019/08/diagram_components.png?w=300&amp;h=86 300w, https://leandromoreira.com/wp-content/uploads/2019/08/diagram_components.png?w=768&amp;h=220 768w, https://leandromoreira.com/wp-content/uploads/2019/08/diagram_components.png?w=1024&amp;h=293 1024w" sizes="(max-width: 1086px) 100vw, 1086px"/></p>

<h3>Good software design – Introduction</h3>
<p>To write useful and long term maintainable software we tend to look out for patterns and group them into abstractions and it seems that’s the case for devs behind Linux and FFmpeg too.</p>
<blockquote>
<h4>Software design</h4>
<p>When we’re creating software, we’re building data structures and defining their behaviors and dependencies. The way we create and link them can be seen as the design/architecture of the software.</p>
<p>Let’s say we’re building a media framework that encodes/decodes video and audio. The codecs <a href="https://aomedia.org/" target="_blank" rel="noopener">AV1</a>, H264, HEVC, and AAC all do some common operations and if we can provide a <strong>generic abstraction that holds these common operations</strong> and data we can use this concept <strong>instead of</strong> relying on the concrete idea of what <strong>a specific codec</strong> does.</p></blockquote>
<p>Through the years many <a href="https://martinfowler.com/articles/is-quality-worth-cost.html" target="_blank" rel="noopener">developers noticed that software with a good design</a> is a good idea that <a href="https://www.martinfowler.com/bliki/Yagni.html" target="_blank" rel="noopener">pays off as software grows in complexity</a>.</p>
<p>This is one of the ideas behind the good design for software, to rely on <strong>components</strong> that are <strong>weakly linked</strong> and with <strong>boundaries</strong> around <strong>what it should do</strong>.</p>
<h3>Ruby</h3>
<p>Maybe it’s easier to see all these concepts in practice. Let’s code a quick pseudo media stream framework that provides encoding and decoding for several codecs.</p>

<div id="gist97583641">
<div translate="no" data-color-mode="light" data-light-theme="light">
<div>
<div>
<div id="file-ruby-rb">
<div itemprop="text" tabindex="0" role="region" aria-label="file-ruby-rb">
<div>

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="ruby.rb">
<tbody><tr>
<td id="file-ruby-rb-L1" data-line-number="1"></td>
<td id="file-ruby-rb-LC1">class AV1</td>
</tr>
<tr>
<td id="file-ruby-rb-L2" data-line-number="2"></td>
<td id="file-ruby-rb-LC2">  def encode(bytes)</td>
</tr>
<tr>
<td id="file-ruby-rb-L3" data-line-number="3"></td>
<td id="file-ruby-rb-LC3">  end</td>
</tr>
<tr>
<td id="file-ruby-rb-L4" data-line-number="4"></td>
<td id="file-ruby-rb-LC4">  def decode(bytes)</td>
</tr>
<tr>
<td id="file-ruby-rb-L5" data-line-number="5"></td>
<td id="file-ruby-rb-LC5">  end</td>
</tr>
<tr>
<td id="file-ruby-rb-L6" data-line-number="6"></td>
<td id="file-ruby-rb-LC6">end</td>
</tr>
<tr>
<td id="file-ruby-rb-L7" data-line-number="7"></td>
<td id="file-ruby-rb-LC7">
</td>
</tr>
<tr>
<td id="file-ruby-rb-L8" data-line-number="8"></td>
<td id="file-ruby-rb-LC8">class H264</td>
</tr>
<tr>
<td id="file-ruby-rb-L9" data-line-number="9"></td>
<td id="file-ruby-rb-LC9">  def encode(bytes)</td>
</tr>
<tr>
<td id="file-ruby-rb-L10" data-line-number="10"></td>
<td id="file-ruby-rb-LC10">  end</td>
</tr>
<tr>
<td id="file-ruby-rb-L11" data-line-number="11"></td>
<td id="file-ruby-rb-LC11">  def decode(bytes)</td>
</tr>
<tr>
<td id="file-ruby-rb-L12" data-line-number="12"></td>
<td id="file-ruby-rb-LC12">  end</td>
</tr>
<tr>
<td id="file-ruby-rb-L13" data-line-number="13"></td>
<td id="file-ruby-rb-LC13">end</td>
</tr>
<tr>
<td id="file-ruby-rb-L14" data-line-number="14"></td>
<td id="file-ruby-rb-LC14">
</td>
</tr>
<tr>
<td id="file-ruby-rb-L15" data-line-number="15"></td>
<td id="file-ruby-rb-LC15"># …</td>
</tr>
<tr>
<td id="file-ruby-rb-L16" data-line-number="16"></td>
<td id="file-ruby-rb-LC16">
</td>
</tr>
<tr>
<td id="file-ruby-rb-L17" data-line-number="17"></td>
<td id="file-ruby-rb-LC17">supported_codecs = [AV1.new, H264.new, HEVC.new]</td>
</tr>
<tr>
<td id="file-ruby-rb-L18" data-line-number="18"></td>
<td id="file-ruby-rb-LC18">
</td>
</tr>
<tr>
<td id="file-ruby-rb-L19" data-line-number="19"></td>
<td id="file-ruby-rb-LC19">class MediaFramework</td>
</tr>
<tr>
<td id="file-ruby-rb-L20" data-line-number="20"></td>
<td id="file-ruby-rb-LC20">  def encode(type, bytes)</td>
</tr>
<tr>
<td id="file-ruby-rb-L21" data-line-number="21"></td>
<td id="file-ruby-rb-LC21">    codec = supported_codecs.find {|c| c.class.name.downcase == type}</td>
</tr>
<tr>
<td id="file-ruby-rb-L22" data-line-number="22"></td>
<td id="file-ruby-rb-LC22">
</td>
</tr>
<tr>
<td id="file-ruby-rb-L23" data-line-number="23"></td>
<td id="file-ruby-rb-LC23">    codec.encode(bytes)</td>
</tr>
<tr>
<td id="file-ruby-rb-L24" data-line-number="24"></td>
<td id="file-ruby-rb-LC24">  end</td>
</tr>
<tr>
<td id="file-ruby-rb-L25" data-line-number="25"></td>
<td id="file-ruby-rb-LC25">end</td>
</tr>
</tbody></table>
</div></div>
</div>
</div></div>

</div>
</div>
<p>This pseudo-code in <a href="https://www.ruby-lang.org/en/" target="_blank" rel="noopener">ruby</a> tries to recreate what we’re discussing above, there is an <strong>implicit concept here</strong> of what operations a codec must have, in this case, the operations are <em>encode</em> and <em>decode</em>. Since <a href="https://en.wikipedia.org/wiki/Duck_typing" target="_blank" rel="noopener">ruby is a dynamically typed language</a> any class can present these two operations and act as a codec for us.</p>
<blockquote><p>Developers sometimes may use the words: contract, API, interface, behavior and operations as synonyms.</p></blockquote>
<p>This design might be considered good because if we want to add a new codec we just need to provide an implementation and add it to the list, even the list could be built in a dynamic way but the idea is that this code seems easy to extend and maintain because it tries to keep link between the components weak (<strong>low coupling</strong>) and each component does only what it should do (<strong>cohese</strong>).</p>
<blockquote><p>Rails framework even enforce some way to organize the code, it adopts the model-view-controller (MVC) architecture</p></blockquote>
<h3>Golang</h3>
<p>When we go (no pun intended) to a <strong>statically typed language</strong> like <a href="https://golang.org/" target="_blank" rel="noopener">golang</a> we need to be more formal, describing the required types but it’s still doable.</p>

<div id="gist97583673">
<div translate="no" data-color-mode="light" data-light-theme="light">
<div>
<div>
<div id="file-file-go">
<div itemprop="text" tabindex="0" role="region" aria-label="file-file-go">
<div>

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="file.go">
<tbody><tr>
<td id="file-file-go-L1" data-line-number="1"></td>
<td id="file-file-go-LC1">type Codec interface {</td>
</tr>
<tr>
<td id="file-file-go-L2" data-line-number="2"></td>
<td id="file-file-go-LC2">   Encode(data []int) ([]int, error)</td>
</tr>
<tr>
<td id="file-file-go-L3" data-line-number="3"></td>
<td id="file-file-go-LC3">   Decode(data []int) ([]int, error)</td>
</tr>
<tr>
<td id="file-file-go-L4" data-line-number="4"></td>
<td id="file-file-go-LC4">} </td>
</tr>
<tr>
<td id="file-file-go-L5" data-line-number="5"></td>
<td id="file-file-go-LC5">
</td>
</tr>
<tr>
<td id="file-file-go-L6" data-line-number="6"></td>
<td id="file-file-go-LC6">type H264 struct {</td>
</tr>
<tr>
<td id="file-file-go-L7" data-line-number="7"></td>
<td id="file-file-go-LC7">}</td>
</tr>
<tr>
<td id="file-file-go-L8" data-line-number="8"></td>
<td id="file-file-go-LC8">
</td>
</tr>
<tr>
<td id="file-file-go-L9" data-line-number="9"></td>
<td id="file-file-go-LC9">func (H264) Encode(data []int) ([]int, error) {</td>
</tr>
<tr>
<td id="file-file-go-L10" data-line-number="10"></td>
<td id="file-file-go-LC10">  // … lots of code</td>
</tr>
<tr>
<td id="file-file-go-L11" data-line-number="11"></td>
<td id="file-file-go-LC11">  return data, nil</td>
</tr>
<tr>
<td id="file-file-go-L12" data-line-number="12"></td>
<td id="file-file-go-LC12">}</td>
</tr>
<tr>
<td id="file-file-go-L13" data-line-number="13"></td>
<td id="file-file-go-LC13">
</td>
</tr>
<tr>
<td id="file-file-go-L14" data-line-number="14"></td>
<td id="file-file-go-LC14">var supportedCodecs := []Codec{H264{}, AV1{}}</td>
</tr>
<tr>
<td id="file-file-go-L15" data-line-number="15"></td>
<td id="file-file-go-LC15">
</td>
</tr>
<tr>
<td id="file-file-go-L16" data-line-number="16"></td>
<td id="file-file-go-LC16">func Encode(codec string, data int[]) {</td>
</tr>
<tr>
<td id="file-file-go-L17" data-line-number="17"></td>
<td id="file-file-go-LC17"> // here we can chose e use</td>
</tr>
<tr>
<td id="file-file-go-L18" data-line-number="18"></td>
<td id="file-file-go-LC18"> // supportedCodecs[0].Encode(data)</td>
</tr>
<tr>
<td id="file-file-go-L19" data-line-number="19"></td>
<td id="file-file-go-LC19">}</td>
</tr>
</tbody></table>
</div></div>
</div>
</div></div>

</div>
</div>
<blockquote><p>The <a href="https://medium.com/golangspec/interfaces-in-go-part-i-4ae53a97479c" target="_blank" rel="noopener">interface type in golang</a> is much more powerful than <a href="https://docs.oracle.com/javase/tutorial/java/IandI/createinterface.html" target="_blank" rel="noopener">Java’s similar construct</a> because its definition is totally disconnected from the implementation and vice versa. We could even make each codec a <a href="https://golang.org/pkg/io/#ReadWriter" target="_blank" rel="noopener">ReadWriter</a> and use it all around.</p></blockquote>
<h3>Clang</h3>
<p>In the <a href="https://en.wikipedia.org/wiki/C_(programming_language)" target="_blank" rel="noopener">C language</a> we still can create the same behavior but it’s a little bit different.</p>

<div id="gist97583688">
<div translate="no" data-color-mode="light" data-light-theme="light">
<div>
<div>
<div id="file-file-c">
<div itemprop="text" tabindex="0" role="region" aria-label="file-file-c">
<div>

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="file.c">
<tbody><tr>
<td id="file-file-c-L1" data-line-number="1"></td>
<td id="file-file-c-LC1">struct Codec</td>
</tr>
<tr>
<td id="file-file-c-L2" data-line-number="2"></td>
<td id="file-file-c-LC2">{</td>
</tr>
<tr>
<td id="file-file-c-L3" data-line-number="3"></td>
<td id="file-file-c-LC3">	*int (*encode)(*int);</td>
</tr>
<tr>
<td id="file-file-c-L4" data-line-number="4"></td>
<td id="file-file-c-LC4">	*int (*decode)(*int);</td>
</tr>
<tr>
<td id="file-file-c-L5" data-line-number="5"></td>
<td id="file-file-c-LC5">};</td>
</tr>
<tr>
<td id="file-file-c-L6" data-line-number="6"></td>
<td id="file-file-c-LC6">
</td>
</tr>
<tr>
<td id="file-file-c-L7" data-line-number="7"></td>
<td id="file-file-c-LC7">
</td>
</tr>
<tr>
<td id="file-file-c-L8" data-line-number="8"></td>
<td id="file-file-c-LC8">*int h264_encode(int *bytes)</td>
</tr>
<tr>
<td id="file-file-c-L9" data-line-number="9"></td>
<td id="file-file-c-LC9">{</td>
</tr>
<tr>
<td id="file-file-c-L10" data-line-number="10"></td>
<td id="file-file-c-LC10">// …</td>
</tr>
<tr>
<td id="file-file-c-L11" data-line-number="11"></td>
<td id="file-file-c-LC11">}</td>
</tr>
<tr>
<td id="file-file-c-L12" data-line-number="12"></td>
<td id="file-file-c-LC12">
</td>
</tr>
<tr>
<td id="file-file-c-L13" data-line-number="13"></td>
<td id="file-file-c-LC13">*int h264_decode(int *bytes)</td>
</tr>
<tr>
<td id="file-file-c-L14" data-line-number="14"></td>
<td id="file-file-c-LC14">{</td>
</tr>
<tr>
<td id="file-file-c-L15" data-line-number="15"></td>
<td id="file-file-c-LC15">// …</td>
</tr>
<tr>
<td id="file-file-c-L16" data-line-number="16"></td>
<td id="file-file-c-LC16">}</td>
</tr>
<tr>
<td id="file-file-c-L17" data-line-number="17"></td>
<td id="file-file-c-LC17">
</td>
</tr>
<tr>
<td id="file-file-c-L18" data-line-number="18"></td>
<td id="file-file-c-LC18">struct Codec av1 =</td>
</tr>
<tr>
<td id="file-file-c-L19" data-line-number="19"></td>
<td id="file-file-c-LC19">{</td>
</tr>
<tr>
<td id="file-file-c-L20" data-line-number="20"></td>
<td id="file-file-c-LC20">	.encode = av1_encode,</td>
</tr>
<tr>
<td id="file-file-c-L21" data-line-number="21"></td>
<td id="file-file-c-LC21">	.decode = av1_decode</td>
</tr>
<tr>
<td id="file-file-c-L22" data-line-number="22"></td>
<td id="file-file-c-LC22">};</td>
</tr>
<tr>
<td id="file-file-c-L23" data-line-number="23"></td>
<td id="file-file-c-LC23">
</td>
</tr>
<tr>
<td id="file-file-c-L24" data-line-number="24"></td>
<td id="file-file-c-LC24">struct Codec h264 =</td>
</tr>
<tr>
<td id="file-file-c-L25" data-line-number="25"></td>
<td id="file-file-c-LC25">{</td>
</tr>
<tr>
<td id="file-file-c-L26" data-line-number="26"></td>
<td id="file-file-c-LC26">	.encode = h264_encode,</td>
</tr>
<tr>
<td id="file-file-c-L27" data-line-number="27"></td>
<td id="file-file-c-LC27">	.decode = h264_decode</td>
</tr>
<tr>
<td id="file-file-c-L28" data-line-number="28"></td>
<td id="file-file-c-LC28">};</td>
</tr>
<tr>
<td id="file-file-c-L29" data-line-number="29"></td>
<td id="file-file-c-LC29">
</td>
</tr>
<tr>
<td id="file-file-c-L30" data-line-number="30"></td>
<td id="file-file-c-LC30">int main(int argc, char *argv[])</td>
</tr>
<tr>
<td id="file-file-c-L31" data-line-number="31"></td>
<td id="file-file-c-LC31">{</td>
</tr>
<tr>
<td id="file-file-c-L32" data-line-number="32"></td>
<td id="file-file-c-LC32">	h264.encode(argv[1]);</td>
</tr>
<tr>
<td id="file-file-c-L33" data-line-number="33"></td>
<td id="file-file-c-LC33">}</td>
</tr>
</tbody></table>
</div></div>
</div>
</div></div>

</div>
</div>
<blockquote><p>Code inspired by <a href="https://www.bottomupcs.com/abstration.xhtml" target="_blank" rel="noopener">https://www.bottomupcs.com/abstration.xhtml</a></p></blockquote>
<p>We first define the abstract operations (functions in this case) in a <strong>generic struct</strong> and then <strong>we fill it</strong> with the <strong>concrete code</strong>, like the av1 decoder and encoder real code.</p>
<p>Many other languages have somewhat <a href="https://clojure.org/reference/protocols" target="_blank" rel="noopener">similar mechanisms</a> to dispatch methods or functions as if they were part of an agreed protocol and then the system integration code can deal only with this high-level abstractions.</p>
<h3>Linux Kernel – Everything is a file</h3>
<p>Have you ever heard the expression <a href="https://en.wikipedia.org/wiki/Everything_is_a_file" target="_blank" rel="noopener">everything is a file in Linux</a>? The idea is to have a common interface for all kinds of resources in Linux, for instance, Linux handles network socket, special files (like /<a href="https://www.tldp.org/LDP/Linux-Filesystem-Hierarchy/html/proc.html" target="_blank" rel="noopener">proc</a>/cpuinfo) or even USB devices as files.</p>
<p>This is a powerful idea that can make easy to write or use programs for linux since we can rely in a set of well known operations from this <strong>abstraction called file</strong>. Let’s see this in action:</p>

<div id="gist97885357">
<div translate="no" data-color-mode="light" data-light-theme="light">
<div>
<div>
<div id="file-bash-sh">
<div itemprop="text" tabindex="0" role="region" aria-label="file-bash-sh">
<div>

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="bash.sh">
<tbody><tr>
<td id="file-bash-sh-L1" data-line-number="1"></td>
<td id="file-bash-sh-LC1"><span><span>#</span> the first case is the easiest, we&#39;re just reading a plain text file</span></td>
</tr>
<tr>
<td id="file-bash-sh-L2" data-line-number="2"></td>
<td id="file-bash-sh-LC2">$ cat /etc/passwd</td>
</tr>
<tr>
<td id="file-bash-sh-L3" data-line-number="3"></td>
<td id="file-bash-sh-LC3">root:x:0:0:root:/root:/bin/bash</td>
</tr>
<tr>
<td id="file-bash-sh-L4" data-line-number="4"></td>
<td id="file-bash-sh-LC4">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</td>
</tr>
<tr>
<td id="file-bash-sh-L5" data-line-number="5"></td>
<td id="file-bash-sh-LC5">…</td>
</tr>
<tr>
<td id="file-bash-sh-L6" data-line-number="6"></td>
<td id="file-bash-sh-LC6">
</td>
</tr>
<tr>
<td id="file-bash-sh-L7" data-line-number="7"></td>
<td id="file-bash-sh-LC7"><span><span>#</span> now here, we think we&#39;re reading a file but we are not! (technically yes.. anyway)</span></td>
</tr>
<tr>
<td id="file-bash-sh-L8" data-line-number="8"></td>
<td id="file-bash-sh-LC8">$ cat /proc/meminfo</td>
</tr>
<tr>
<td id="file-bash-sh-L9" data-line-number="9"></td>
<td id="file-bash-sh-LC9">MemTotal:        2046844 kB</td>
</tr>
<tr>
<td id="file-bash-sh-L10" data-line-number="10"></td>
<td id="file-bash-sh-LC10">MemFree:          546984 kB</td>
</tr>
<tr>
<td id="file-bash-sh-L11" data-line-number="11"></td>
<td id="file-bash-sh-LC11">MemAvailable:    1535688 kB</td>
</tr>
<tr>
<td id="file-bash-sh-L12" data-line-number="12"></td>
<td id="file-bash-sh-LC12">Buffers:          162676 kB</td>
</tr>
<tr>
<td id="file-bash-sh-L13" data-line-number="13"></td>
<td id="file-bash-sh-LC13">Cached:           892000 kB</td>
</tr>
<tr>
<td id="file-bash-sh-L14" data-line-number="14"></td>
<td id="file-bash-sh-LC14"> </td>
</tr>
<tr>
<td id="file-bash-sh-L15" data-line-number="15"></td>
<td id="file-bash-sh-LC15"><span><span>#</span> and finally we open a file (using fd=3) for read/write</span></td>
</tr>
<tr>
<td id="file-bash-sh-L16" data-line-number="16"></td>
<td id="file-bash-sh-LC16"><span><span>#</span> the &#34;file&#34; being a socket, we then send a request to this file &gt;&amp;3</span></td>
</tr>
<tr>
<td id="file-bash-sh-L17" data-line-number="17"></td>
<td id="file-bash-sh-LC17"><span><span>#</span> and we read from this same &#34;file&#34;</span></td>
</tr>
<tr>
<td id="file-bash-sh-L18" data-line-number="18"></td>
<td id="file-bash-sh-LC18">$ <span>exec</span> <span>3&lt;&gt;</span> /dev/tcp/www.google.com/80</td>
</tr>
<tr>
<td id="file-bash-sh-L19" data-line-number="19"></td>
<td id="file-bash-sh-LC19">$ <span>printf</span> <span><span>&#39;</span>HEAD / HTTP/1.1\nHost: <a href="http://www.google.com" rel="nofollow">http://www.google.com</a>\nConnection: close\n\n<span>&#39;</span></span> <span>&gt;&amp;3</span></td>
</tr>
<tr>
<td id="file-bash-sh-L20" data-line-number="20"></td>
<td id="file-bash-sh-LC20">$ cat <span>&lt;</span><span>&amp;</span>3</td>
</tr>
<tr>
<td id="file-bash-sh-L21" data-line-number="21"></td>
<td id="file-bash-sh-LC21">HTTP/1.1 200 OK</td>
</tr>
<tr>
<td id="file-bash-sh-L22" data-line-number="22"></td>
<td id="file-bash-sh-LC22">Date: Wed, 21 Aug 2019 12:48:40 GMT</td>
</tr>
<tr>
<td id="file-bash-sh-L23" data-line-number="23"></td>
<td id="file-bash-sh-LC23">Expires: -1</td>
</tr>
<tr>
<td id="file-bash-sh-L24" data-line-number="24"></td>
<td id="file-bash-sh-LC24">Cache-Control: private, max-age=0</td>
</tr>
<tr>
<td id="file-bash-sh-L25" data-line-number="25"></td>
<td id="file-bash-sh-LC25">Content-Type: text/html<span>;</span> charset=ISO-8859-1</td>
</tr>
<tr>
<td id="file-bash-sh-L26" data-line-number="26"></td>
<td id="file-bash-sh-LC26">P3P: CP=<span><span>&#34;</span>This is not a P3P policy! See g.co/p3phelp for more info.<span>&#34;</span></span></td>
</tr>
<tr>
<td id="file-bash-sh-L27" data-line-number="27"></td>
<td id="file-bash-sh-LC27">Server: gws</td>
</tr>
<tr>
<td id="file-bash-sh-L28" data-line-number="28"></td>
<td id="file-bash-sh-LC28">X-XSS-Protection: 0</td>
</tr>
<tr>
<td id="file-bash-sh-L29" data-line-number="29"></td>
<td id="file-bash-sh-LC29">X-Frame-Options: SAMEORIGIN</td>
</tr>
<tr>
<td id="file-bash-sh-L30" data-line-number="30"></td>
<td id="file-bash-sh-LC30">Set-Cookie: 1P_JAR=2019-08-21-12<span>;</span> expires=Fri, 20-Sep-2019 12:48:40 GMT<span>;</span> path=/<span>;</span> domain=.google.com</td>
</tr>
<tr>
<td id="file-bash-sh-L31" data-line-number="31"></td>
<td id="file-bash-sh-LC31">Set-Cookie: NID=188=K69nLKjqge87Ymv4h-gAW_lRfLCo7-KrTf01ULtY278lUUcaNxlEqXExDtVB104pdA8CLUZI8LMvJv26P_D8RMF3qCDzLTpjji96B9v_miGlZOIBro6pDreHP0yW7dz-9myBfOgdQjroAc0wWvOAkBu-zgFW_Of9VpK3IfIaBok<span>;</span> expires=Thu, 20-Feb-2020 12:48:40 GMT<span>;</span> path=/<span>;</span> domain=.google.com<span>;</span> HttpOnly</td>
</tr>
<tr>
<td id="file-bash-sh-L32" data-line-number="32"></td>
<td id="file-bash-sh-LC32">Accept-Ranges: none</td>
</tr>
<tr>
<td id="file-bash-sh-L33" data-line-number="33"></td>
<td id="file-bash-sh-LC33">Vary: Accept-Encoding</td>
</tr>
<tr>
<td id="file-bash-sh-L34" data-line-number="34"></td>
<td id="file-bash-sh-LC34">Connection: close</td>
</tr>
</tbody></table>
</div></div>
</div>
</div></div>

</div>
</div>
<p>This only is possible because the concept of a file (data structure and operations) was design to be one of the main way to communicate among sub-systems. Here’s a gist of the file_operations’ API.</p>

<div id="gist97583719">
<div translate="no" data-color-mode="light" data-light-theme="light">
<div>
<div>
<div id="file-file_operations-c">
<div itemprop="text" tabindex="0" role="region" aria-label="file-file_operations-c">
<div>

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="file_operations.c">
<tbody><tr>
<td id="file-file_operations-c-L1" data-line-number="1"></td>
<td id="file-file_operations-c-LC1"><span>struct</span> <span>file_operations</span> {</td>
</tr>
<tr>
<td id="file-file_operations-c-L2" data-line-number="2"></td>
<td id="file-file_operations-c-LC2">	<span>struct</span> <span>module</span> <span>*</span><span>owner</span>;</td>
</tr>
<tr>
<td id="file-file_operations-c-L3" data-line-number="3"></td>
<td id="file-file_operations-c-LC3">	<span>loff_t</span> (<span>*</span><span>llseek</span>) (<span>struct</span> <span>file</span> <span>*</span>, <span>loff_t</span>, <span>int</span>);</td>
</tr>
<tr>
<td id="file-file_operations-c-L4" data-line-number="4"></td>
<td id="file-file_operations-c-LC4">	<span>ssize_t</span> (<span>*</span><span>read</span>) (<span>struct</span> <span>file</span> <span>*</span>, <span>char</span> <span>__user</span> <span>*</span>, <span>size_t</span>, <span>loff_t</span> <span>*</span>);</td>
</tr>
<tr>
<td id="file-file_operations-c-L5" data-line-number="5"></td>
<td id="file-file_operations-c-LC5">	<span>ssize_t</span> (<span>*</span><span>write</span>) (<span>struct</span> <span>file</span> <span>*</span>, <span>const</span> <span>char</span> <span>__user</span> <span>*</span>, <span>size_t</span>, <span>loff_t</span> <span>*</span>);</td>
</tr>
<tr>
<td id="file-file_operations-c-L6" data-line-number="6"></td>
<td id="file-file_operations-c-LC6">  <span>//…</span></td>
</tr>
<tr>
<td id="file-file_operations-c-L7" data-line-number="7"></td>
<td id="file-file_operations-c-LC7">}</td>
</tr>
</tbody></table>
</div></div>
</div>
</div></div>

</div>
</div>
<p>The struct <a href="https://github.com/torvalds/linux/blob/master/include/linux/fs.h#L1789" target="_blank" rel="noopener">file_operations</a> define what one should expect from a concept of what file can do.</p>

<div id="gist97583739">
<div translate="no" data-color-mode="light" data-light-theme="light">
<div>
<div>
<div id="file-ext4-c">
<div itemprop="text" tabindex="0" role="region" aria-label="file-ext4-c">
<div>

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="ext4.c">
<tbody><tr>
<td id="file-ext4-c-L1" data-line-number="1"></td>
<td id="file-ext4-c-LC1">const struct file_operations ext4_dir_operations = {</td>
</tr>
<tr>
<td id="file-ext4-c-L2" data-line-number="2"></td>
<td id="file-ext4-c-LC2">	.llseek		= ext4_dir_llseek,</td>
</tr>
<tr>
<td id="file-ext4-c-L3" data-line-number="3"></td>
<td id="file-ext4-c-LC3">	.read		= generic_read_dir,</td>
</tr>
<tr>
<td id="file-ext4-c-L4" data-line-number="4"></td>
<td id="file-ext4-c-LC4">	//..</td>
</tr>
<tr>
<td id="file-ext4-c-L5" data-line-number="5"></td>
<td id="file-ext4-c-LC5">};</td>
</tr>
</tbody></table>
</div></div>
</div>
</div></div>

</div>
</div>
<p>Here we can see the directory implementation of <a href="https://github.com/torvalds/linux/blob/master/fs/ext4/dir.c#L653" target="_blank" rel="noopener">these operations for the ext4 file system</a>.</p>

<div id="gist97583749">
<div translate="no" data-color-mode="light" data-light-theme="light">
<div>
<div>
<div id="file-proc_cpuinfo_operations-c">
<div itemprop="text" tabindex="0" role="region" aria-label="file-proc_cpuinfo_operations-c">
<div>

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="proc_cpuinfo_operations.c">
<tbody><tr>
<td id="file-proc_cpuinfo_operations-c-L1" data-line-number="1"></td>
<td id="file-proc_cpuinfo_operations-c-LC1">static const struct file_operations proc_cpuinfo_operations = {</td>
</tr>
<tr>
<td id="file-proc_cpuinfo_operations-c-L2" data-line-number="2"></td>
<td id="file-proc_cpuinfo_operations-c-LC2">	.open		= cpuinfo_open,</td>
</tr>
<tr>
<td id="file-proc_cpuinfo_operations-c-L3" data-line-number="3"></td>
<td id="file-proc_cpuinfo_operations-c-LC3">	.read		= seq_read,</td>
</tr>
<tr>
<td id="file-proc_cpuinfo_operations-c-L4" data-line-number="4"></td>
<td id="file-proc_cpuinfo_operations-c-LC4">	.llseek		= seq_lseek,</td>
</tr>
<tr>
<td id="file-proc_cpuinfo_operations-c-L5" data-line-number="5"></td>
<td id="file-proc_cpuinfo_operations-c-LC5">	.release	= seq_release,</td>
</tr>
<tr>
<td id="file-proc_cpuinfo_operations-c-L6" data-line-number="6"></td>
<td id="file-proc_cpuinfo_operations-c-LC6">};</td>
</tr>
</tbody></table>
</div></div>
</div>
</div></div>

</div>
</div>
<p>And even the <a href="https://github.com/torvalds/linux/blob/master/fs/proc/cpuinfo.c#L19" target="_blank" rel="noopener">cpuinfo proc files</a> is done over this abstraction. When you’re operating files under linux you’re actually dealing with the <a href="https://en.wikipedia.org/wiki/Virtual_file_system" target="_blank" rel="noopener">VFS system</a>, this system delegates to the proper implementation file implemenation.</p>
<p><img data-attachment-id="2433" data-permalink="https://leandromoreira.com/2019/08/02/linux-ffmpeg-source-internals-a-good-software-design/screen-shot-2019-08-21-at-10-14-07-am/#main" data-orig-file="https://leandromoreira.com/wp-content/uploads/2019/08/screen-shot-2019-08-21-at-10.14.07-am.png" data-orig-size="2536,1492" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="Screen Shot 2019-08-21 at 10.14.07 AM" data-image-description="" data-image-caption="" data-medium-file="https://leandromoreira.com/wp-content/uploads/2019/08/screen-shot-2019-08-21-at-10.14.07-am.png?w=300" data-large-file="https://leandromoreira.com/wp-content/uploads/2019/08/screen-shot-2019-08-21-at-10.14.07-am.png?w=700" src="https://leandromoreira.com/wp-content/uploads/2019/08/screen-shot-2019-08-21-at-10.14.07-am.png?w=700" alt="Screen Shot 2019-08-21 at 10.14.07 AM" srcset="https://leandromoreira.com/wp-content/uploads/2019/08/screen-shot-2019-08-21-at-10.14.07-am.png 2536w, https://leandromoreira.com/wp-content/uploads/2019/08/screen-shot-2019-08-21-at-10.14.07-am.png?w=150&amp;h=88 150w, https://leandromoreira.com/wp-content/uploads/2019/08/screen-shot-2019-08-21-at-10.14.07-am.png?w=300&amp;h=176 300w, https://leandromoreira.com/wp-content/uploads/2019/08/screen-shot-2019-08-21-at-10.14.07-am.png?w=768&amp;h=452 768w, https://leandromoreira.com/wp-content/uploads/2019/08/screen-shot-2019-08-21-at-10.14.07-am.png?w=1024&amp;h=602 1024w" sizes="(max-width: 2536px) 100vw, 2536px"/></p>
<p>Source: <a href="https://ops.tips/blog/what-is-that-proc-thing/" target="_blank" rel="noopener">https://ops.tips/blog/what-is-that-proc-thing/</a></p>
<h3>FFmpeg – Formats</h3>
<p>Here’s an <a href="https://github.com/leandromoreira/ffmpeg-libav-tutorial#ffmpeg-libav-architecture" target="_blank" rel="noopener">overview of FFmpeg flow/architecture</a> that shows that the internal componets are linked mostly to the abstract concepts like <a href="https://ffmpeg.org/doxygen/trunk/structAVCodec.html" target="_blank" rel="noopener">AVCodec</a> but not directly to their implemenation, H264, AV1 or etc.</p>
<div>
<figure data-shortcode="caption" id="attachment_2422" aria-describedby="caption-attachment-2422"><img data-attachment-id="2422" data-permalink="https://leandromoreira.com/2019/08/02/linux-ffmpeg-source-internals-a-good-software-design/remuxing_libav_components/#main" data-orig-file="https://leandromoreira.com/wp-content/uploads/2019/08/remuxing_libav_components.png" data-orig-size="1113,634" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="remuxing_libav_components" data-image-description="" data-image-caption="" data-medium-file="https://leandromoreira.com/wp-content/uploads/2019/08/remuxing_libav_components.png?w=300" data-large-file="https://leandromoreira.com/wp-content/uploads/2019/08/remuxing_libav_components.png?w=700" src="https://leandromoreira.com/wp-content/uploads/2019/08/remuxing_libav_components.png?w=700" alt="remuxing_libav_components" srcset="https://leandromoreira.com/wp-content/uploads/2019/08/remuxing_libav_components.png 1113w, https://leandromoreira.com/wp-content/uploads/2019/08/remuxing_libav_components.png?w=150&amp;h=85 150w, https://leandromoreira.com/wp-content/uploads/2019/08/remuxing_libav_components.png?w=300&amp;h=171 300w, https://leandromoreira.com/wp-content/uploads/2019/08/remuxing_libav_components.png?w=768&amp;h=437 768w, https://leandromoreira.com/wp-content/uploads/2019/08/remuxing_libav_components.png?w=1024&amp;h=583 1024w" sizes="(max-width: 1113px) 100vw, 1113px"/><figcaption id="caption-attachment-2422">FFmpeg architecture view from transmuxing flow</figcaption></figure>

</div>
<p>For the input files, FFmpeg creates a struct called <a href="https://github.com/FFmpeg/FFmpeg/blob/master/libavformat/avformat.h#L640" target="_blank" rel="noopener">AVInputFormat</a> that is implemented by any format (video container) that wants to be used as an input. <a href="https://github.com/FFmpeg/FFmpeg/blob/master/libavformat/matroskadec.c#L4229" target="_blank" rel="noopener">MKV files fill this structure with</a> its implementation as the <a href="https://github.com/FFmpeg/FFmpeg/blob/master/libavformat/mov.c#L7997" target="_blank" rel="noopener">MP4 format</a> too.</p>

</div>

<div id="gist97591476">
<div translate="no" data-color-mode="light" data-light-theme="light">
<div>
<div>
<div id="file-ffmpeg-c">
<div itemprop="text" tabindex="0" role="region" aria-label="file-ffmpeg-c">
<div>

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="ffmpeg.c">
<tbody><tr>
<td id="file-ffmpeg-c-L1" data-line-number="1"></td>
<td id="file-ffmpeg-c-LC1">typedef struct AVInputFormat {</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L2" data-line-number="2"></td>
<td id="file-ffmpeg-c-LC2">    const char *name;</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L3" data-line-number="3"></td>
<td id="file-ffmpeg-c-LC3">    const char *long_name;</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L4" data-line-number="4"></td>
<td id="file-ffmpeg-c-LC4">    const char *extensions;</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L5" data-line-number="5"></td>
<td id="file-ffmpeg-c-LC5">    const char *mime_type;</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L6" data-line-number="6"></td>
<td id="file-ffmpeg-c-LC6">    ff_const59 struct AVInputFormat *next;</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L7" data-line-number="7"></td>
<td id="file-ffmpeg-c-LC7">    int raw_codec_id;</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L8" data-line-number="8"></td>
<td id="file-ffmpeg-c-LC8">    int priv_data_size;</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L9" data-line-number="9"></td>
<td id="file-ffmpeg-c-LC9">    int (*read_probe)(const AVProbeData *);</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L10" data-line-number="10"></td>
<td id="file-ffmpeg-c-LC10">    int (*read_header)(struct AVFormatContext *);</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L11" data-line-number="11"></td>
<td id="file-ffmpeg-c-LC11">  }</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L12" data-line-number="12"></td>
<td id="file-ffmpeg-c-LC12">  </td>
</tr>
<tr>
<td id="file-ffmpeg-c-L13" data-line-number="13"></td>
<td id="file-ffmpeg-c-LC13">  // matroska</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L14" data-line-number="14"></td>
<td id="file-ffmpeg-c-LC14">  </td>
</tr>
<tr>
<td id="file-ffmpeg-c-L15" data-line-number="15"></td>
<td id="file-ffmpeg-c-LC15">  AVInputFormat ff_matroska_demuxer = {</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L16" data-line-number="16"></td>
<td id="file-ffmpeg-c-LC16">    .name           = &#34;matroska,webm&#34;,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L17" data-line-number="17"></td>
<td id="file-ffmpeg-c-LC17">    .long_name      = NULL_IF_CONFIG_SMALL(&#34;Matroska / WebM&#34;),</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L18" data-line-number="18"></td>
<td id="file-ffmpeg-c-LC18">    .extensions     = &#34;mkv,mk3d,mka,mks&#34;,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L19" data-line-number="19"></td>
<td id="file-ffmpeg-c-LC19">    .priv_data_size = sizeof(MatroskaDemuxContext),</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L20" data-line-number="20"></td>
<td id="file-ffmpeg-c-LC20">    .read_probe     = matroska_probe,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L21" data-line-number="21"></td>
<td id="file-ffmpeg-c-LC21">    .read_header    = matroska_read_header,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L22" data-line-number="22"></td>
<td id="file-ffmpeg-c-LC22">    .read_packet    = matroska_read_packet,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L23" data-line-number="23"></td>
<td id="file-ffmpeg-c-LC23">    .read_close     = matroska_read_close,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L24" data-line-number="24"></td>
<td id="file-ffmpeg-c-LC24">    .read_seek      = matroska_read_seek,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L25" data-line-number="25"></td>
<td id="file-ffmpeg-c-LC25">    .mime_type      = &#34;audio/webm,audio/x-matroska,video/webm,video/x-matroska&#34;</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L26" data-line-number="26"></td>
<td id="file-ffmpeg-c-LC26">};</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L27" data-line-number="27"></td>
<td id="file-ffmpeg-c-LC27">
</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L28" data-line-number="28"></td>
<td id="file-ffmpeg-c-LC28">// mov (mp4)</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L29" data-line-number="29"></td>
<td id="file-ffmpeg-c-LC29">
</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L30" data-line-number="30"></td>
<td id="file-ffmpeg-c-LC30">AVInputFormat ff_mov_demuxer = {</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L31" data-line-number="31"></td>
<td id="file-ffmpeg-c-LC31">    .name           = &#34;mov,mp4,m4a,3gp,3g2,mj2&#34;,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L32" data-line-number="32"></td>
<td id="file-ffmpeg-c-LC32">    .long_name      = NULL_IF_CONFIG_SMALL(&#34;QuickTime / MOV&#34;),</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L33" data-line-number="33"></td>
<td id="file-ffmpeg-c-LC33">    .priv_class     = &amp;mov_class,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L34" data-line-number="34"></td>
<td id="file-ffmpeg-c-LC34">    .priv_data_size = sizeof(MOVContext),</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L35" data-line-number="35"></td>
<td id="file-ffmpeg-c-LC35">    .extensions     = &#34;mov,mp4,m4a,3gp,3g2,mj2&#34;,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L36" data-line-number="36"></td>
<td id="file-ffmpeg-c-LC36">    .read_probe     = mov_probe,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L37" data-line-number="37"></td>
<td id="file-ffmpeg-c-LC37">    .read_header    = mov_read_header,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L38" data-line-number="38"></td>
<td id="file-ffmpeg-c-LC38">    .read_packet    = mov_read_packet,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L39" data-line-number="39"></td>
<td id="file-ffmpeg-c-LC39">    .read_close     = mov_read_close,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L40" data-line-number="40"></td>
<td id="file-ffmpeg-c-LC40">    .read_seek      = mov_read_seek,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L41" data-line-number="41"></td>
<td id="file-ffmpeg-c-LC41">    .flags          = AVFMT_NO_BYTE_SEEK | AVFMT_SEEK_TO_PTS,</td>
</tr>
<tr>
<td id="file-ffmpeg-c-L42" data-line-number="42"></td>
<td id="file-ffmpeg-c-LC42">};</td>
</tr>
</tbody></table>
</div></div>
</div>
</div></div>

</div>
</div>
<p>This design allows new codecs, formats, and protocols to be integrated and released easier. <a href="https://code.videolan.org/videolan/dav1d" target="_blank" rel="noopener">DAV1d</a> (an av1 open-source implementation) was integrated into FFmpeg May this year and <a href="https://git.ffmpeg.org/gitweb/ffmpeg.git/commitdiff/beaa350e24167f4ff31275a6114693f5ce7cd409" target="_blank" rel="noopener">you can follow along the commit diff</a> to see how easy it was. In the end, it needs to register itself as an available codec and follow the expected operations.</p>
<div>

<div id="gist97583764">
<div translate="no" data-color-mode="light" data-light-theme="light">
<div>
<div>
<div id="file-diff-diff">
<div itemprop="text" tabindex="0" role="region" aria-label="file-diff-diff">
<div>

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-path="diff.diff">
<tbody><tr>
<td id="file-diff-diff-L1" data-line-number="1"></td>
<td id="file-diff-diff-LC1">+AVCodec ff_libdav1d_decoder = {</td>
</tr>
<tr>
<td id="file-diff-diff-L2" data-line-number="2"></td>
<td id="file-diff-diff-LC2">+    .name           = &#34;libdav1d&#34;,</td>
</tr>
<tr>
<td id="file-diff-diff-L3" data-line-number="3"></td>
<td id="file-diff-diff-LC3">+    .long_name      = NULL_IF_CONFIG_SMALL(&#34;dav1d AV1 decoder by VideoLAN&#34;),</td>
</tr>
<tr>
<td id="file-diff-diff-L4" data-line-number="4"></td>
<td id="file-diff-diff-LC4">+    .type           = AVMEDIA_TYPE_VIDEO,</td>
</tr>
<tr>
<td id="file-diff-diff-L5" data-line-number="5"></td>
<td id="file-diff-diff-LC5">+    .id             = AV_CODEC_ID_AV1,</td>
</tr>
<tr>
<td id="file-diff-diff-L6" data-line-number="6"></td>
<td id="file-diff-diff-LC6">+    .priv_data_size = sizeof(Libdav1dContext),</td>
</tr>
<tr>
<td id="file-diff-diff-L7" data-line-number="7"></td>
<td id="file-diff-diff-LC7">+    .init           = libdav1d_init,</td>
</tr>
<tr>
<td id="file-diff-diff-L8" data-line-number="8"></td>
<td id="file-diff-diff-LC8">+    .close          = libdav1d_close,</td>
</tr>
<tr>
<td id="file-diff-diff-L9" data-line-number="9"></td>
<td id="file-diff-diff-LC9">+    .flush          = libdav1d_flush,</td>
</tr>
<tr>
<td id="file-diff-diff-L10" data-line-number="10"></td>
<td id="file-diff-diff-LC10">+    .receive_frame  = libdav1d_receive_frame,</td>
</tr>
<tr>
<td id="file-diff-diff-L11" data-line-number="11"></td>
<td id="file-diff-diff-LC11">+    .capabilities   = AV_CODEC_CAP_DELAY | AV_CODEC_CAP_AUTO_THREADS,</td>
</tr>
<tr>
<td id="file-diff-diff-L12" data-line-number="12"></td>
<td id="file-diff-diff-LC12">+    .caps_internal  = FF_CODEC_CAP_INIT_THREADSAFE | FF_CODEC_CAP_INIT_CLEANUP |</td>
</tr>
<tr>
<td id="file-diff-diff-L13" data-line-number="13"></td>
<td id="file-diff-diff-LC13">+                      FF_CODEC_CAP_SETS_PKT_DTS,</td>
</tr>
<tr>
<td id="file-diff-diff-L14" data-line-number="14"></td>
<td id="file-diff-diff-LC14">+    .priv_class     = &amp;libdav1d_class,</td>
</tr>
<tr>
<td id="file-diff-diff-L15" data-line-number="15"></td>
<td id="file-diff-diff-LC15">+    .wrapper_name   = &#34;libdav1d&#34;,</td>
</tr>
<tr>
<td id="file-diff-diff-L16" data-line-number="16"></td>
<td id="file-diff-diff-LC16">+};`</td>
</tr>
</tbody></table>
</div></div>
</div>
</div></div>

</div>
</div>
<p>No matter the language we use we can (or at least try to) build a software with <a href="https://en.wikipedia.org/wiki/Loose_coupling" target="_blank" rel="noopener">low coupling</a> and <a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)#High_cohesion" target="_blank" rel="noopener">high cohesion</a> in mind, these two basic properties can allow you to build easier to maintain and extend software.</p>
</div>
			</div><!-- .entry-content -->

	<!-- .entry-meta -->
</article><!-- #post-## -->
			</div>

				<nav role="navigation" id="nav-below">
		

	
				
	
	</nav><!-- #nav-below -->
	
			
<!-- #comments -->

		
		</main><!-- #main -->
	</div></div>
  </body>
</html>
