<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://pganalyze.com/blog/a-practical-introduction-to-constraint-programming-using-cp-sat">Original</a>
    <h1>A practical introduction to constraint programming using CP-SAT and Python</h1>
    
    <div id="readability-page-1" class="page"><div><div><p>Imagine you&#39;re an e-commerce giant that would like to build a new warehouse to improve service to your customers, but you need to know what is the best location for it. Or you&#39;re a global shipping company that assigns packages to their delivery trucks and has to choose the best routes in order to save gas and reduce driver overtime. Or an airline that is looking to offer service to a new location, and needs to know which types of planes they should use and on what schedule, to maximize the resulting revenue.</p>
<p>These kinds of problems mentioned above are known as <strong>discrete optimization problems</strong>. There exist several methods that can be used to tackle such problems. In this article, we will discuss the theory and practice for one of them, called <strong><a href="https://en.wikipedia.org/wiki/Constraint_programming">constraint programming</a></strong>.</p>
<p>This is the first part in a two part series on constraint programming, used inside <a href="https://pganalyze.com/docs/indexing-engine/cp-model">pganalyze Indexing Engine</a> and <a href="https://pganalyze.com/docs/index-advisor/getting-started">pganalyze Index Advisor</a>. We&#39;re sharing this knowledge to help the wider programming community become familiar with how to utilize solvers like <a href="https://developers.google.com/optimization/cp/cp_solver">CP-SAT</a> in practice.</p>

<h2 id="a-declarative-paradigm"><a href="#a-declarative-paradigm" aria-label="a declarative paradigm permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A declarative paradigm</h2>
<p>Constraint programming (CP) is a declarative paradigm used to solve discrete optimization problems. This contrasts with the imperative paradigm that we are generally used to. When programming imperatively, we describe the steps necessary to reach a result. For example, suppose that we want to know who the adults are from a given list of people:</p>








<table><colgroup>
<col/></colgroup><colgroup><col/>
</colgroup><thead><tr><th scope="col">Name</th><th scope="col">Age</th></tr></thead><tbody><tr><td>Phil</td><td>20</td></tr><tr><td>Emma</td><td>17</td></tr><tr><td>David</td><td>11</td></tr><tr><td>Thomas</td><td>51</td></tr><tr><td>Sarah</td><td>45</td></tr><tr><td>Rebecca</td><td>6</td></tr></tbody></table>
<p>A typical imperative approach would explain the sequence of operations required to get the desired result:</p>
<div data-language="python"><pre><code>adult_people <span>=</span> <span>[</span><span>]</span>
<span>for</span> person <span>in</span> people<span>:</span>
    <span>if</span> person<span>.</span>Age <span>&gt;=</span> <span>18</span><span>:</span>
        adult_people <span>+=</span> person<span>.</span>Name</code></pre></div>

<p>Meanwhile, the same result can be described declaratively as:</p>
<div data-language="sql"><pre><code><span>SELECT</span> person_name <span>FROM</span> people <span>WHERE</span> age <span>&gt;=</span> <span>18</span><span>;</span></code></pre></div>

<p>Both approaches are equivalent in their outcome, but the two processes are different. In the imperative case, the program follows each step in sequence in order to reach the result. In the declarative case, the program is given a description of the desired result (using the available constructs of the language) and gets there by itself.</p>
<h2 id="the-basics-of-constraint-programming-cp"><a href="#the-basics-of-constraint-programming-cp" aria-label="the basics of constraint programming cp permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The basics of constraint programming (CP)</h2>
<p>Similarly to the declarative example mentioned above, with CP we describe the desired result to a problem. This description is called a <strong>model</strong>. The main components of a model are variables and constraints. Variables represent <strong>what</strong> we are looking for, and each variable has an associated <strong>domain</strong> which is the set of values that this variable is allowed to take. Constraints describe <strong>relationships</strong> between variables.</p>
<p>A solution is an assignment of values to the variables (from their domains) such that the constraints are satisfied. Let&#39;s jump straight in with a simple example:</p>
<blockquote>
<p>Alice, Bob, and Carol each have $20, and they want to pool their money to purchase a candy bar worth $50 (yes, inflation is running wild). Alice has stated that she will put in at least as much money as Bob. Carol only has $5 bills, so her contribution will be a multiple of that. None of them want to contribute the exact same amount as any other.
</p>
</blockquote>
<p>Here, we are looking for the amount of money each person should contribute to the purchase of the candy bar. This means that we need one variable per person, indicating the amount of money that this person should contribute toward the purchase (<code>a</code> for Alice, <code>b</code> for Bob, and <code>c</code> for Carol). We start by setting the domains of these variables (the symbol <code>∈</code> means &#34;in&#34;):</p>
<div data-language="text"><pre><code>a ∈ {0, ..., 20}
b ∈ {0, ..., 20}
c ∈ {0, ..., 20}</code></pre></div>
<p>These domains ensure that the final values of the variables represent amounts of money that the contributors actually have in their pockets (that is, a maximum of $20). Next, we want to make sure that the combined contributions are enough to cover the price of the candy bar, so we add the constraint:</p>

<p>Alice will contribute at least as much as Bob, so we translate this into:</p>

<p>Carol&#39;s contribution must be a multiple of 5:</p>

<p>Finally, the amount of each of their contributions must be unique. We could model this using the following constraints:</p>

<p>We only have a handful of people in this example so these disequalities would work well. But what if they were hundreds, or thousands? It turns out that CP has a rich catalogue of expressive constraints that can encapsulate complex concepts, called <strong>global constraints</strong>. An alternative to the above would be to use the so-called <code>alldifferent</code> constraint, which ensures that a set of variables are all assigned different values:</p>

<p>This completes the model of this problem. You will note that we have not assigned any values to <code>a</code>, <code>b</code>, or <code>c</code> ourselves. We have simply defined three variables and their domains, and described the properties of the problem using constraints on those variables. Our job is done.</p>
<p>The piece of software that interprets this model and returns a solution is called a <strong>solver</strong>. The inner workings of a solver are outside the scope of this article, so for our purposes we will consider the solver as a black box that takes a model as input, and returns a valid solution:</p>

<p>The solution returned is valid as each variable takes a value from its domain and all the constraints are satisfied. However, we see that Carol contributes almost twice Bob&#39;s amount. Perhaps there exists another valid solution where all parties contribute more equally to the purchase?</p>
<p>We can add an <strong>objective</strong> to our CP model to try to reach this goal. Adding an objective to a model allows us to minimize or maximize an expression, without compromising the validity of the resulting solution (with respect to the constraints). If we can somehow minimize the amount of money spent by the largest contributor, this should push the three contributions closer together. Our objective will then be to find a valid solution where this value is minimal:</p>
<div data-language="text"><pre><code>x ∈ {0, ..., 20}
maximum(x, [a, b, c])
minimize: x</code></pre></div>
<p>To achieve this, we create a new variable <code>x</code> representing the amount of the largest contribution. The <code>maximum</code> constraint takes care of assigning to <code>x</code> the largest value from <code>[a, b, c]</code>. The objective is then to minimize <code>x</code>. The solution returned by the solver is now:</p>
<div data-language="text"><pre><code>a = 18
b = 17
c = 15
x = 18</code></pre></div>
<p>Previously there was a $9 difference between the largest and smallest contributions. With the objective we introduced this has now been reduced to $3, and this is as fair as this is going to get. Now that the basic concepts are cleared up, let&#39;s move on to a more challenging problem.</p>
<h2 id="a-practical-example-with-python-and-cp-sat"><a href="#a-practical-example-with-python-and-cp-sat" aria-label="a practical example with python and cp sat permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A practical example with Python and CP-SAT</h2>
<p>Let&#39;s use this new CP knowledge to solve a more complex real-world example: the scheduling of employees for a small business.</p>
<blockquote>
<p>A store owner wishes to create the weekly work schedule for its employees. The store is open from 8AM to 8PM every day, and each day is divided into three shifts of 4 hours: morning, afternoon, and evening. There are two roles in the store: cashier and restocker.
</p>
<ul>
<li>
<p>Some employees are qualified to do either role, but others can only be a cashier, or a restocker.</p>
</li>
<li>
<p>There has to be a cashier scheduled at all times, but restocking only takes about 4 hours every day. Hence, for the restocking task we only need to schedule an employee for a single shift every day. This can be any shift, but two restocking shifts cannot be scheduled one after the other. If a restocking is scheduled on the evening shift on Tuesday, for example, we cannot schedule the Wednesday restocking on the morning shift.</p>
</li>
<li>
<p>An employee that is qualified in both roles can still only be assigned to one role per shift.</p>
</li>
<li>
<p>Employees cannot work more than 8 hours per day, which is 2 shifts. If they do work 2 shifts in a day, we must ensure that there is no idle time between these shifts—for example, we can&#39;t schedule them on both the morning and the evening shifts of the same day, as they would be idle for 4 hours during the afternoon shift.</p>
</li>
</ul>
</blockquote>
<p>This is the basic premise of the problem. Let&#39;s break this down into manageable parts.</p>
<h3 id="an-empty-model"><a href="#an-empty-model" aria-label="an empty model permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>An empty model</h3>
<p>We first start by creating an empty model using <a href="https://developers.google.com/optimization/cp/cp_solver">CP-SAT</a>, an open-source CP solver developed by Google as part of it&#39;s <a href="https://developers.google.com/optimization">OR-Tools</a> project.</p>
<div data-language="python"><pre><code><span>from</span> ortools<span>.</span>sat<span>.</span>python <span>import</span> cp_model

model <span>=</span> cp_model<span>.</span>CpModel<span>(</span><span>)</span></code></pre></div>
<h3 id="the-data"><a href="#the-data" aria-label="the data permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The data</h3>
<blockquote>
<p>A store owner wishes to create the <span>weekly work schedule</span> for its <span>employees</span>. The store is open from 8AM to 8PM every day, and each day is divided into <span>three shifts</span> of 4 hours: <span>morning, afternoon, and evening</span>. There are <span>two roles</span> in the store: <span>cashier and restocker</span>. Some employees are <span>qualified</span> to do either role, but others can only be a cashier, or a restocker.</p>
</blockquote>
<p>Let&#39;s create a list of employees and the roles they are qualified for:</p>
<div data-language="python"><pre><code>employees <span>=</span> <span>{</span><span>&#34;Phil&#34;</span><span>:</span> <span>[</span><span>&#34;Restocker&#34;</span><span>]</span><span>,</span>
             <span>&#34;Emma&#34;</span><span>:</span> <span>[</span><span>&#34;Cashier&#34;</span><span>,</span> <span>&#34;Restocker&#34;</span><span>]</span><span>,</span>
             <span>&#34;David&#34;</span><span>:</span> <span>[</span><span>&#34;Cashier&#34;</span><span>,</span> <span>&#34;Restocker&#34;</span><span>]</span><span>,</span>
             <span>&#34;Rebecca&#34;</span><span>:</span> <span>[</span><span>&#34;Cashier&#34;</span><span>]</span><span>}</span></code></pre></div>
<p>The schedule is said to span a week, and we are told that there are three types of shifts, and two types of roles:</p>
<div data-language="python"><pre><code>days <span>=</span> <span>[</span><span>&#34;Monday&#34;</span><span>,</span>
        <span>&#34;Tuesday&#34;</span><span>,</span>
        <span>&#34;Wednesday&#34;</span><span>,</span>
        <span>&#34;Thursday&#34;</span><span>,</span>
        <span>&#34;Friday&#34;</span><span>,</span>
        <span>&#34;Saturday&#34;</span><span>,</span>
        <span>&#34;Sunday&#34;</span><span>]</span>

shifts <span>=</span> <span>[</span><span>&#34;Morning&#34;</span><span>,</span>
          <span>&#34;Afternoon&#34;</span><span>,</span>
          <span>&#34;Evening&#34;</span><span>]</span>

roles <span>=</span> <span>[</span><span>&#34;Cashier&#34;</span><span>,</span>
         <span>&#34;Restocker&#34;</span><span>]</span></code></pre></div>
<h3 id="the-variables"><a href="#the-variables" aria-label="the variables permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The variables</h3>
<p>Now, let&#39;s define <strong>what</strong> we are looking for. To describe the schedule, we need to refer to employees, roles, days, and shifts: <strong>Does Emma work as a restocker on the Monday evening shift?</strong> This can be achieved using boolean variables. A boolean variable is a variable with a domain of <code>{0, 1}</code>.</p>
<div data-language="python"><pre><code>schedule <span>=</span> <span>{</span>e<span>:</span>
             <span>{</span>r<span>:</span>
               <span>{</span>d<span>:</span>
                 <span>{</span>s<span>:</span> model<span>.</span>new_bool_var<span>(</span><span><span>f&#34;schedule_</span><span><span>{</span>e<span>}</span></span><span>_</span><span><span>{</span>r<span>}</span></span><span>_</span><span><span>{</span>d<span>}</span></span><span>_</span><span><span>{</span>s<span>}</span></span><span>&#34;</span></span><span>)</span>
                   <span>for</span> s <span>in</span> shifts<span>}</span>
                 <span>for</span> d <span>in</span> days<span>}</span>
               <span>for</span> r <span>in</span> roles<span>}</span>
             <span>for</span> e <span>in</span> employees<span>}</span></code></pre></div>
<p>The function <code>model.new_bool_var()</code> creates and then returns a boolean variable, which we store in <code>schedule</code>. Within this structure, <code>schedule[&#34;Emma&#34;][&#34;Restocker&#34;][&#34;Monday&#34;][&#34;Evening&#34;]</code> refers to one of those boolean variables. This variable is equal to <code>1</code> if Emma <strong>does</strong> work as a restocker on the Monday evening shift, or to <code>0</code> if she <strong>doesn&#39;t</strong>.</p>
<p>Our <code>schedule</code> variables are currently unconstrained. By following the problem description presented earlier and constraining these variables accordingly, we should be able to get a schedule that satisfies the requirements of the store owner.</p>
<h3 id="the-constraints"><a href="#the-constraints" aria-label="the constraints permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The constraints</h3>
<p>Let&#39;s go through the rest of the problem description to correctly constrain the <code>schedule</code> variables. To add a new constraint to the model, we simply use <code>model.add(...)</code>.</p>
<blockquote>
<p>There has to be a <span>cashier</span> scheduled at <span>all times</span>.</p>
</blockquote>
<p>Since the schedule is comprised of boolean variables, it&#39;s easy to see how we can put limits on subsets of these variables by summing them and enforcing constraints on these sums:</p>
<div data-language="python"><pre><code><span>for</span> d <span>in</span> days<span>:</span>
    <span>for</span> s <span>in</span> shifts<span>:</span>
        model<span>.</span>add<span>(</span><span>sum</span><span>(</span>schedule<span>[</span>e<span>]</span><span>[</span><span>&#34;Cashier&#34;</span><span>]</span><span>[</span>d<span>]</span><span>[</span>s<span>]</span> <span>for</span> e <span>in</span> employees<span>)</span> <span>==</span> <span>1</span><span>)</span></code></pre></div>
<p>If we need a cashier at all times, this means that for every day-shift pair, the sum of employees assigned the <code>&#34;Cashier&#34;</code> role has to be equal to <code>1</code>.</p>
<blockquote>
<p>For the <span>restocking</span> task we only need to schedule an employee for <span>a single shift every day</span>.</p>
</blockquote>
<p>Similarly to the previous constraint, we now want the sum of all employees assigned the <code>&#34;Restocker&#34;</code> role for all shifts of a given day to be equal to <code>1</code>:</p>
<div data-language="python"><pre><code><span>for</span> d <span>in</span> days<span>:</span>
    model<span>.</span>add<span>(</span><span>sum</span><span>(</span>schedule<span>[</span>e<span>]</span><span>[</span><span>&#34;Restocker&#34;</span><span>]</span><span>[</span>d<span>]</span><span>[</span>s<span>]</span> <span>for</span> e <span>in</span> employees <span>for</span> s <span>in</span> shifts<span>)</span> <span>==</span> <span>1</span><span>)</span></code></pre></div>
<blockquote>
<p>This [restocking] can be any shift, but <span>two restocking shifts cannot be scheduled one after the other</span>.</p>
</blockquote>
<p>Because of the previous constraint, we already know that two restocking shifts cannot take place on the same day. The only way two restocking shifts could be scheduled one after the other would be to assign one on the evening shift of a day, and another one on the morning shift of the next day. By enforcing that the sum of restocking shifts for each evening-morning pair is not greater than <code>1</code>, we ensure that <strong>at most one</strong> restocking shift is scheduled for those pairs:</p>
<div data-language="python"><pre><code><span>for</span> i <span>in</span> <span>range</span><span>(</span><span>len</span><span>(</span>days<span>)</span><span>-</span><span>1</span><span>)</span><span>:</span>
    model<span>.</span>add<span>(</span><span>sum</span><span>(</span>schedule<span>[</span>e<span>]</span><span>[</span><span>&#34;Restocker&#34;</span><span>]</span><span>[</span>days<span>[</span>i<span>]</span><span>]</span><span>[</span><span>&#34;Evening&#34;</span><span>]</span> <span>+</span> schedule<span>[</span>e<span>]</span><span>[</span><span>&#34;Restocker&#34;</span><span>]</span><span>[</span>days<span>[</span>i<span>+</span><span>1</span><span>]</span><span>]</span><span>[</span><span>&#34;Morning&#34;</span><span>]</span> <span>for</span> e <span>in</span> employees<span>)</span> <span>&lt;=</span> <span>1</span><span>)</span></code></pre></div>
<blockquote>
<p>An <span>employee</span> that is qualified in both roles can still <span>only be assigned to one role per shift</span>.</p>
</blockquote>
<p>For every employee, the sum of all assigned roles for all day-shift pairs is either going to be <code>1</code> (they work a <em>single</em> role on this day-shift slot), or <code>0</code> (they don&#39;t work on that day-shift slot):</p>
<div data-language="python"><pre><code><span>for</span> e <span>in</span> employees<span>:</span>
    <span>for</span> d <span>in</span> days<span>:</span>
        <span>for</span> s <span>in</span> shifts<span>:</span>
            model<span>.</span>add<span>(</span><span>sum</span><span>(</span>schedule<span>[</span>e<span>]</span><span>[</span>r<span>]</span><span>[</span>d<span>]</span><span>[</span>s<span>]</span> <span>for</span> r <span>in</span> roles<span>)</span> <span>&lt;=</span> <span>1</span><span>)</span></code></pre></div>
<blockquote>
<p>Some employees are qualified to do either role, but <span>others can only be a cashier, or a restocker</span>.</p>
</blockquote>
<p>To prevent an employee from being assigned a role that they are not qualified for, we simply match the value of that role to 0 (or put differently, we&#39;re adding a constraint asserting that it&#39;s zero) everywhere for that employee:</p>
<div data-language="python"><pre><code><span>for</span> e <span>in</span> employees<span>:</span>
    <span>for</span> r <span>in</span> roles<span>:</span>
        <span>for</span> d <span>in</span> days<span>:</span>
            <span>for</span> s <span>in</span> shifts<span>:</span>
                <span>if</span> r <span>not</span> <span>in</span> employees<span>[</span>e<span>]</span><span>:</span>
                    model<span>.</span>add<span>(</span>schedule<span>[</span>e<span>]</span><span>[</span>r<span>]</span><span>[</span>d<span>]</span><span>[</span>s<span>]</span> <span>==</span> <span>0</span><span>)</span></code></pre></div>
<blockquote>
<p><span>Employees cannot work more</span> than 8 hours per day, which is <span>2 shifts</span>. If they do work 2 shifts in a day, we must ensure that there is <span>no idle time between these shifts</span>—in other words, we can&#39;t schedule them on both the morning and the evening shifts of the same day, as they would be idle for 4 hours during the afternoon shift.</p>
</blockquote>
<p>It turns out that a single constraint can take care of both of these requirements: An employee can work <strong>either</strong> the morning shift, <strong>or</strong> the evening shift, <strong>or</strong> neither of these shifts:</p>
<div data-language="python"><pre><code><span>for</span> e <span>in</span> employees<span>:</span>
    <span>for</span> d <span>in</span> days<span>:</span>
        model<span>.</span>add<span>(</span><span>sum</span><span>(</span>schedule<span>[</span>e<span>]</span><span>[</span>r<span>]</span><span>[</span>d<span>]</span><span>[</span><span>&#34;Morning&#34;</span><span>]</span> <span>+</span> schedule<span>[</span>e<span>]</span><span>[</span>r<span>]</span><span>[</span>d<span>]</span><span>[</span><span>&#34;Evening&#34;</span><span>]</span> <span>for</span> r <span>in</span> roles<span>)</span> <span>&lt;=</span> <span>1</span><span>)</span></code></pre></div>
<p>Note that the above constraint does not need to specify anything about the afternoon shift. If the employee works in the morning, they can&#39;t work in the evening, and vice-versa. This both ensures that the employee works a maximum of two shifts per day, and also that there is no idle time, since there can only be idle time if the employee works both the morning <strong>and</strong> the evening shift.</p>
<p>The modeling of the problem is now complete. Let&#39;s see what the results are.</p>
<h3 id="solving-the-model"><a href="#solving-the-model" aria-label="solving the model permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Solving the model</h3>
<p>To solve the model, we simply call a solver, with the model as an argument:</p>
<div data-language="python"><pre><code>solver <span>=</span> cp_model<span>.</span>CpSolver<span>(</span><span>)</span>

solver<span>.</span>solve<span>(</span>model<span>)</span></code></pre></div>
<p>After the solving process, we can get the resulting values of the <code>schedule</code> variables with <code>solver.value(...)</code>. We have organized these values in the schedule shown below:</p>
<div data-language="text"><pre><code>           |  Monday   |  Tuesday  | Wednesday | Thursday  |  Friday   | Saturday  |  Sunday   | Total |
           | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E |       |
Phil       |   | R |   |   | R |   |   | R |   |   | R |   |   | R |   |   | R |   |   | R |   |   7   |
Emma       |   |   |   | C |   |   | C |   |   | C |   |   | C |   |   | C |   |   | C |   |   |   6   |
David      | C |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   1   |
Rebecca    |   | C | C |   | C | C |   | C | C |   | C | C |   | C | C |   | C | C |   | C | C |  14   |</code></pre></div>
<p>The resulting schedule satisfies the constraints of the problem. Now let&#39;s think of additional real-world constraints that would make this more interesting.</p>
<h3 id="adding-more-constraints"><a href="#adding-more-constraints" aria-label="adding more constraints permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding more constraints</h3>
<p>We see that Rebecca works 14 shifts for that week. The store owner is not keen on paying overtime wages, so they wish to cap each employee&#39;s schedule to a maximum of 40 hours per week (10 work shifts):</p>
<div data-language="python"><pre><code><span>for</span> e <span>in</span> employees<span>:</span>
    model<span>.</span>add<span>(</span><span>sum</span><span>(</span>schedule<span>[</span>e<span>]</span><span>[</span>r<span>]</span><span>[</span>d<span>]</span><span>[</span>s<span>]</span> <span>for</span> r <span>in</span> roles <span>for</span> d <span>in</span> days <span>for</span> s <span>in</span> shifts<span>)</span> <span>&lt;=</span> <span>10</span><span>)</span></code></pre></div>
<div data-language="text"><pre><code>           |  Monday   |  Tuesday  | Wednesday | Thursday  |  Friday   | Saturday  |  Sunday   | Total |
           | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E |       |
Phil       |   | R |   |   | R |   |   | R |   |   | R |   |   | R |   |   | R |   |   | R |   |   7   |
Emma       |   | C | C |   | C | C | C |   |   | C |   |   | C |   |   | C |   |   | C |   |   |   9   |
David      | C |   |   | C |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   2   |
Rebecca    |   |   |   |   |   |   |   | C | C |   | C | C |   | C | C |   | C | C |   | C | C |  10   |</code></pre></div>
<p>Phil is a full-time student and would like to work exactly 4 shifts per week. He also cannot work the morning and afternoon shifts during the week, in order to attend his classes.</p>
<div data-language="python"><pre><code>model<span>.</span>add<span>(</span><span>sum</span><span>(</span>schedule<span>[</span><span>&#34;Phil&#34;</span><span>]</span><span>[</span>r<span>]</span><span>[</span>d<span>]</span><span>[</span>s<span>]</span> <span>for</span> r <span>in</span> roles <span>for</span> d <span>in</span> days <span>for</span> s <span>in</span> shifts<span>)</span> <span>==</span> <span>4</span><span>)</span>

model<span>.</span>add<span>(</span><span>sum</span><span>(</span>schedule<span>[</span><span>&#34;Phil&#34;</span><span>]</span><span>[</span>r<span>]</span><span>[</span>d<span>]</span><span>[</span>s<span>]</span> <span>for</span> r <span>in</span> roles <span>for</span> d <span>in</span> days <span>if</span> d <span>not</span> <span>in</span> <span>[</span><span>&#34;Saturday&#34;</span><span>,</span> <span>&#34;Sunday&#34;</span><span>]</span> <span>for</span> s <span>in</span> shifts <span>if</span> s <span>in</span> <span>[</span><span>&#34;Morning&#34;</span><span>,</span> <span>&#34;Afternoon&#34;</span><span>]</span><span>)</span> <span>==</span> <span>0</span><span>)</span></code></pre></div>
<div data-language="text"><pre><code>           |  Monday   |  Tuesday  | Wednesday | Thursday  |  Friday   | Saturday  |  Sunday   | Total |
           | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E |       |
Phil       |   |   |   |   |   | R |   |   | R |   |   | R |   |   |   |   | R |   |   |   |   |   4   |
Emma       | C | R |   |   |   | C | C |   |   | C |   |   | C | R |   | C |   |   | C | R |   |  10   |
David      |   | C | C | C | C |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   4   |
Rebecca    |   |   |   |   |   |   |   | C | C |   | C | C |   | C | C |   | C | C |   | C | C |  10   |</code></pre></div>
<p>Phil and Emma do not get along very well, and as such we don&#39;t want them working the same shifts.</p>
<div data-language="python"><pre><code><span>for</span> d <span>in</span> days<span>:</span>
    <span>for</span> s <span>in</span> shifts<span>:</span>
        model<span>.</span>add<span>(</span><span>sum</span><span>(</span>schedule<span>[</span>e<span>]</span><span>[</span>r<span>]</span><span>[</span>d<span>]</span><span>[</span>s<span>]</span> <span>for</span> e <span>in</span> <span>[</span><span>&#34;Phil&#34;</span><span>,</span> <span>&#34;Emma&#34;</span><span>]</span> <span>for</span> r <span>in</span> roles<span>)</span> <span>&lt;=</span> <span>1</span><span>)</span></code></pre></div>
<div data-language="text"><pre><code>           |  Monday   |  Tuesday  | Wednesday | Thursday  |  Friday   | Saturday  |  Sunday   | Total |
           | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E |       |
Phil       |   |   | R |   |   | R |   |   | R |   |   | R |   |   |   |   |   |   |   |   |   |   4   |
Emma       | C |   |   | C | C |   | C | C |   | C | C |   | C | C |   |   | C |   |   |   |   |  10   |
David      |   | C | C |   |   | C |   |   | C |   |   | C |   | R |   |   | R | C | C | R |   |  10   |
Rebecca    |   |   |   |   |   |   |   |   |   |   |   |   |   |   | C | C |   |   |   | C | C |   4   |</code></pre></div>
<p>No employee really likes to work on the weekend, so we would like to distribute these shifts equally between all employees. There are 8 such shifts (3 cashier shifts and 1 restocker shift on each day), and since we have 4 employees, we can give them all 2 shifts each for the weekend.</p>
<div data-language="python"><pre><code><span>for</span> e <span>in</span> employees<span>:</span>
    model<span>.</span>add<span>(</span><span>sum</span><span>(</span>schedule<span>[</span>e<span>]</span><span>[</span>r<span>]</span><span>[</span>d<span>]</span><span>[</span>s<span>]</span> <span>for</span> r <span>in</span> roles <span>for</span> d <span>in</span> <span>[</span><span>&#34;Saturday&#34;</span><span>,</span> <span>&#34;Sunday&#34;</span><span>]</span> <span>for</span> s <span>in</span> shifts<span>)</span> <span>==</span> <span>2</span><span>)</span></code></pre></div>
<div data-language="text"><pre><code>           |  Monday   |  Tuesday  | Wednesday | Thursday  |  Friday   | Saturday  |  Sunday   | Total |
           | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E |       |
Phil       |   |   |   |   |   | R |   |   | R |   |   |   |   |   |   | R |   |   | R |   |   |   4   |
Emma       | R | C |   | C | C |   | C |   |   |   |   | C |   | C | C |   |   |   |   | C | C |  10   |
David      | C |   |   |   |   | C |   | C | C | C | R |   | C | R |   |   |   | C | C |   |   |  10   |
Rebecca    |   |   | C |   |   |   |   |   |   |   | C |   |   |   |   | C | C |   |   |   |   |   4   |</code></pre></div>
<p>Emma would like to take Monday to Friday off, and asks us if this is possible. Let&#39;s see:</p>
<div data-language="python"><pre><code>model<span>.</span>add<span>(</span><span>sum</span><span>(</span>schedule<span>[</span><span>&#34;Emma&#34;</span><span>]</span><span>[</span>r<span>]</span><span>[</span>d<span>]</span><span>[</span>s<span>]</span> <span>for</span> r <span>in</span> roles <span>for</span> d <span>in</span> <span>[</span><span>&#34;Monday&#34;</span><span>,</span> <span>&#34;Tuesday&#34;</span><span>,</span> <span>&#34;Wednesday&#34;</span><span>,</span> <span>&#34;Thursday&#34;</span><span>,</span> <span>&#34;Friday&#34;</span><span>]</span> <span>for</span> s <span>in</span> shifts<span>)</span> <span>==</span> <span>0</span><span>)</span></code></pre></div>

<p>The solver returns a status of &#34;infeasible&#34;. What does this mean?</p>
<h3 id="interlude-the-solver-status"><a href="#interlude-the-solver-status" aria-label="interlude the solver status permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Interlude: The solver status</h3>
<p>The solver takes as input a model, and returns a status and a solution. Consider this simple case:</p>
<div data-language="text"><pre><code>x ∈ {0, ..., 10}
y ∈ {0, ..., 10}
x + y &gt;= 5
minimize: x + y

Status: OPTIMAL
x = 5
y = 0</code></pre></div>
<p>The variables <code>x</code> and <code>y</code> both have the domain <code>{0, ..., 10}</code>. The sum of the values assigned to them must be 5 or greater, and the objective is to minimize this sum. The solution <code>(x, y) = (5, 0)</code> is called <strong>optimal</strong>. A solution is optimal when there does not exist another solution that is <strong>strictly better</strong> than it. For instance, the solution <code>(x, y) = (3, 2)</code> would also be optimal.</p>
<p>Now consider the case:</p>
<div data-language="text"><pre><code>x ∈ {0, ..., 10}
x &gt;= 15

Status: INFEASIBLE</code></pre></div>
<p>An <strong>infeasible</strong> status means that there exists no assignment of values to the variables such that the constraints are satisfied. In the above example, it is not possible to assign a value to <code>x</code> that is at least as large as 15, since the largest value in its domain is 10.</p>
<p>There are also other possibilities. Let&#39;s take a look at this last example:</p>
<div data-language="text"><pre><code>x ∈ {0, ..., 10}
y ∈ {0, ..., 10}
...  // Many more variables
x + y &lt;= 12
x &gt;= 5
... // Many more constraints
minimize: x - 3*y + ...  // Very complex objective</code></pre></div>
<p>Sometimes, a problem is so large and complex, and takes so much time to solve, that we must interrupt the solver due to time constraints. In such a case, the solver will return one of two statuses:</p>
<ul>
<li>If a solution has been found, the status returned is <strong>feasible</strong>. A feasible solution means that the solution satisfies the constraints, but the solver does not know if that solution is optimal. In other words, we have a solution that works, but there may still exist a better one.</li>
<li>If no solution has been found, the status returned is <strong>unknown</strong>. This means that while the solver has not found a solution, it does not know whether one exists (feasible) or if the problem has no solution (infeasible).</li>
</ul>
<p>Let&#39;s get back to our schedule.</p>
<h3 id="sorry-emma"><a href="#sorry-emma" aria-label="sorry emma permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>&#34;Sorry, Emma&#34;</h3>
<p>With the infeasible status returned to us previously, we are forced to inform Emma that she can&#39;t take the whole week off, otherwise it would be impossible to fill the schedule without violating some of the other constraints. She decides to only take Monday to Wednesday off instead:</p>
<div data-language="python"><pre><code>model<span>.</span>add<span>(</span><span>sum</span><span>(</span>schedule<span>[</span><span>&#34;Emma&#34;</span><span>]</span><span>[</span>r<span>]</span><span>[</span>d<span>]</span><span>[</span>s<span>]</span> <span>for</span> r <span>in</span> roles <span>for</span> d <span>in</span> <span>[</span><span>&#34;Monday&#34;</span><span>,</span> <span>&#34;Tuesday&#34;</span><span>,</span> <span>&#34;Wednesday&#34;</span><span>]</span> <span>for</span> s <span>in</span> shifts<span>)</span> <span>==</span> <span>0</span><span>)</span></code></pre></div>
<div data-language="text"><pre><code>           |  Monday   |  Tuesday  | Wednesday | Thursday  |  Friday   | Saturday  |  Sunday   | Total |
           | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E |       |
Phil       |   |   | R |   |   |   |   |   | R |   |   |   |   |   |   | R |   |   | R |   |   |   4   |
Emma       |   |   |   |   |   |   |   |   |   |   | R | C |   | R | C |   |   |   |   | C | C |   6   |
David      | C |   |   | C | R |   | C |   |   | C | C |   | C | C |   |   |   | C | C |   |   |  10   |
Rebecca    |   | C | C |   | C | C |   | C | C |   |   |   |   |   |   | C | C |   |   |   |   |   8   |</code></pre></div>
<p>Phil works exactly 4 shifts as he wants, but the other shifts are not very well distributed: Emma gets 6, David gets 10, and Rebecca gets 8. Let&#39;s see if we can improve this by adding an objective.</p>
<h3 id="objective-distributing-the-shifts-more-evenly"><a href="#objective-distributing-the-shifts-more-evenly" aria-label="objective distributing the shifts more evenly permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Objective: Distributing the shifts more evenly</h3>
<p>We would like to distribute the shifts as fairly as possible between Emma, David, and Rebecca. We will recall that an objective allows us to minimize the value of an expression. We could, for example, minimize the shift difference between the employee who is assigned the fewest shifts, and the one who is assigned the most. Currently, Emma is assigned 6 shifts to David&#39;s 10, so this difference stands at 4 shifts.</p>
<p>We start by creating integer variables to track the number of shifts assigned to each employee, and enforcing the values of these variables:</p>
<div data-language="python"><pre><code>
total_shifts <span>=</span> <span>{</span>e<span>:</span> model<span>.</span>new_int_var<span>(</span><span>0</span><span>,</span> <span>10</span><span>,</span> <span><span>f&#34;total_shifts_</span><span><span>{</span>e<span>}</span></span><span>&#34;</span></span><span>)</span>
                <span>for</span> e <span>in</span> employees<span>}</span>

<span>for</span> e <span>in</span> employees<span>:</span>
    model<span>.</span>add<span>(</span>total_shifts<span>[</span>e<span>]</span> <span>==</span> <span>sum</span><span>(</span>schedule<span>[</span>e<span>]</span><span>[</span>r<span>]</span><span>[</span>d<span>]</span><span>[</span>s<span>]</span> <span>for</span> r <span>in</span> roles <span>for</span> d <span>in</span> days <span>for</span> s <span>in</span> shifts<span>)</span><span>)</span></code></pre></div>
<p>Integer variables are created with <code>model.new_int_var(...)</code>, and the parameters allow us to specify the lower and upper bounds of the domain (in this case, the domain is <code>{0, ..., 10}</code>). We then create variables to track the highest and lowest number of shifts assigned to any employee (with the exception of Phil, who works part-time):</p>
<div data-language="python"><pre><code>min_shifts <span>=</span> model<span>.</span>new_int_var<span>(</span><span>0</span><span>,</span> <span>10</span><span>,</span> <span>&#34;min_shifts&#34;</span><span>)</span>
model<span>.</span>add_min_equality<span>(</span>min_shifts<span>,</span> <span>[</span>total_shifts<span>[</span>e<span>]</span> <span>for</span> e <span>in</span> employees <span>if</span> e <span>!=</span> <span>&#34;Phil&#34;</span><span>]</span><span>)</span>

max_shifts <span>=</span> model<span>.</span>new_int_var<span>(</span><span>0</span><span>,</span> <span>10</span><span>,</span> <span>&#34;max_shifts&#34;</span><span>)</span>
model<span>.</span>add_max_equality<span>(</span>max_shifts<span>,</span> <span>[</span>total_shifts<span>[</span>e<span>]</span> <span>for</span> e <span>in</span> employees <span>if</span> e <span>!=</span> <span>&#34;Phil&#34;</span><span>]</span><span>)</span></code></pre></div>
<p>The constraints <code>model.add_min_equality(...)</code> and <code>model.add_max_equality(...)</code> work in the same fashion as the <code>maximum(...)</code> constraint presented in the candy bar example (with Alice, Bob, and Carol). For example, <code>model.add_min_equality(var, list)</code> assigns to integer variable <code>var</code> the smallest value among the integer variables in <code>list</code>.</p>
<p>Finally, we minimize the difference between <code>max_shifts</code> and <code>min_shifts</code>:</p>
<div data-language="python"><pre><code>model<span>.</span>minimize<span>(</span>max_shifts <span>-</span> min_shifts<span>)</span></code></pre></div>
<div data-language="text"><pre><code>           |  Monday   |  Tuesday  | Wednesday | Thursday  |  Friday   | Saturday  |  Sunday   | Total |
           | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E | M | A | E |       |
Phil       |   |   | R |   |   |   |   |   | R |   |   |   |   |   |   | R |   |   | R |   |   |   4   |
Emma       |   |   |   |   |   |   |   |   |   |   | R | C |   | R | C |   |   |   |   | C | C |   6   |
David      | C |   |   | C | R |   | C |   |   |   | C |   | C | C |   |   |   | C | C |   |   |   9   |
Rebecca    |   | C | C |   | C | C |   | C | C | C |   |   |   |   |   | C | C |   |   |   |   |   9   |</code></pre></div>
<p>This looks pretty good. David and Rebecca both get 9 shifts. Emma only gets 6, but that is understandable as she is taking 3 days off that week. Phil gets exactly 4 shifts, as he is supposed to. Hopefully, everyone will be happy with this schedule.</p>

<p>We have introduced the basics of constraint programming and discussed its main components. We have built a model to generate work schedules that can take into account the types of constraints that one could reasonably expect to be faced with in the real world.</p>
<p>Thanks to this model, we could easily see that it would not be possible for Emma to take five days off as she initially wanted, and we were able to distribute the work shifts as fairly as possible between the employees. In the end, we created a schedule that satisfied both the requiremends of the store owner, as well as the needs of the employees.</p>
<p>In the next article, we will discuss how to use constraint programming for index selection in Postgres.</p>
<p><strong>The code presented in this article can be found on the <a href="https://github.com/pganalyze/cp-sat-python-example">pganalyze GitHub</a>.</strong></p></div></div></div>
  </body>
</html>
