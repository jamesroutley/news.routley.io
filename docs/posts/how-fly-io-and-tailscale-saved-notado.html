<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://notado.substack.com/p/how-flyio-and-tailscale-saved-notado">Original</a>
    <h1>How Fly.io and Tailscale Saved Notado</h1>
    
    <div id="readability-page-1" class="page"><div><div><article><div class=""><div><div dir="auto"><p><em>tl;dr Impact of Digital Ocean’s 2022 price hikes, technical details of how Notado was modified to migrate from Digital Ocean to Fly.io, technical details of using Tailscale to make private connections from a Fly micro VM to a Digital Ocean managed Postgres database, overview of new features on Notado, the end of the free open beta and the introduction of subscriptions for Notado in 2023 at $5.99/month.</em></p><p><span>Since the </span><a href="https://notado.substack.com/p/november-2020-four-months-of-notado" rel="nofollow ugc noopener">last blog post back in 2020</a><span>, and until a few weeks ago, </span><a href="https://notado.app" rel="nofollow ugc noopener">Notado</a><span> had been quietly running on a </span><a href="https://www.digitalocean.com/products/kubernetes" rel="nofollow ugc noopener">Digital Ocean Kubernetes</a><span> cluster, working hard saving, indexing and serving content highlights across the internet for over 3000 beta users.</span></p><p><span>Before getting into the details of how that cluster was replaced by a microVM on </span><a href="https://fly.io" rel="nofollow ugc noopener">Fly.io</a><span>, allow me to take a moment to re-introduce Notado, the service, and to introduce for the first time the cast behind Notado.</span></p><p><a href="https://notado.app" rel="nofollow ugc noopener">Notado</a><span> is a content-first bookmarking service, where the paragraphs and sentences that make you want to bookmark something are treated as first-class citizens rather than pieces of additional metadata.</span></p><p>You may be in the target audience for Notado if</p><ul><li><p>You are interested in topics for which a significant portion of the thought-provoking content is produced in discussion comments rather than online articles and published books</p></li><li><p>You like the idea of being able to save both highlights from an article and analytical comments on the same article together in one place</p></li><li><p>You miss the days of the internet when there was an RSS feed for everything (Notado has public and private RSS feeds for everything)</p></li></ul><p>Now, onto the cast.</p><blockquote><p><code>notado</code></p><p><em><span>The brain, a </span><a href="https://rocket.rs" rel="nofollow ugc noopener">Rocket</a><span> web application that serves </span><a href="https://notado.app" rel="nofollow ugc noopener">notado.app</a><span> and the GraphQL public API</span></em></p></blockquote><blockquote><p><code>notado-scraper</code></p><p><em><span>The muscle, an </span><a href="https://actix.rs" rel="nofollow ugc noopener">Actix-Web</a><span> micro service that handles extracting content from the comment permalinks of different websites, either via their APIs or by scraping HTML where an API doesn’t exist</span></em></p></blockquote><blockquote><p><code>notado-integrations</code></p><p><em><span>The diplomat, an </span><a href="https://actix.rs" rel="nofollow ugc noopener">Actix-Web</a><span> micro service that handles sending saved content to external services for which integrations have been built; Readwise, Instapaper, Pinboard</span></em></p></blockquote><blockquote><p><code>notado-discord</code></p><p><em><span>The socialite, a Discord bot powered by </span><a href="https://github.com/serenity-rs/serenity" rel="nofollow ugc noopener">Serenity</a><span> which users can share comment permalinks and highlights with to save them to their accounts</span></em></p></blockquote><blockquote><p><code>notado-postgres-listener</code></p><p><em><span>The caretaker, a Go micro service that listens for inserts to a PostgreSQL table and sends the content over to </span><a href="https://www.meilisearch.com" rel="nofollow ugc noopener">Meilisearch</a><span> to enable best-in-class, fault and typo-tolerant multilingual search</span></em></p></blockquote><p><span>For over 95% of my career working in software development, I have worked in Platform, Infrastructure, DevOps, whatever you want to call it. I live and breathe </span><a href="https://www.hashicorp.com" rel="nofollow ugc noopener">HashiCorp</a><span> and </span><a href="https://kubernetes.io" rel="nofollow ugc noopener">Kubernetes</a><span>. Well, not </span><em>really</em><span>. But </span><em>kind of</em><span>.</span></p><p><span>Naturally, when I was building Notado, my first thought was “</span><em>oh, I’ll just throw it on a managed Kubernetes cluster somewhere</em><span>”.</span></p><p><span>For getting up and running, it was not a bad idea. I was able to throw together a </span><a href="https://www.terraform.io" rel="nofollow ugc noopener">Terraform</a><span> project and the required Kubernetes manifests without much thought and everything just worked. For almost two years, it just worked largely uninterrupted.</span></p><p>So… What was the problem? For the smallest Kubernetes cluster I could configure on Digital Ocean at the time (and a load balancer, of course) I was paying just shy of $54 a month. With the cost of a managed Postgres database, some storage and taxes on top, the bill for running Notado came up to just under $100 every month.</p><p><span>If you think that sounds like overkill, it’s because </span><em>it was completely overkill</em><span>.</span></p><p>One of the nice things about deploying Rust services is the low resource usage footprint, but unfortunately that doesn’t really mean anything if you make lazy infrastructure choices like I did.</p><p>A few months ago there must have been a price hike over at Digital Ocean because my monthly bill started coming up to over $100, and for me, this was the straw that broke the camel’s back.</p><p><span>That silly mental threshold of “</span><em>at least the bill is under $100 a month</em><span>” had been crossed, and there was no turning back.</span></p><p>That sounds pretty sudden, dramatic, and triumphant, right? Well, if I’m being honest, this price hike marked the beginning of a period of depression for me in relation to Notado. At a particularly low point I had even reached out to Readwise on Twitter to see if they were interested in acquiring any parts of the Notado codebase.</p><p><span>I had been watching </span><a href="https://fly.io" rel="nofollow ugc noopener">Fly.io</a><span> with great admiration over the past two years. Whenever they would put out a new blog post, I would briefly think “</span><em>damn, I wish I could migrate Notado over to Fly</em><span>” but ultimately, I did not have the energy or mental capacity to rearchitect Notado to fully take advantage of Fly’s deployment model.</span></p><p>After the Digital Ocean price hike and hitting a rock bottom of sorts with my relationship to Notado, I started to spend time poring through the Fly.io documentation and putting together a plan to migrate as much of Notado as I could off of Digital Ocean and on to Fly.</p><p><span>In the Kubernetes world, </span><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="nofollow ugc noopener">Deployments</a><span> that you expect connectivity with tend to also have </span><a href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="nofollow ugc noopener">Services</a><span>. I won’t go into too much detail, but you can basically connect to something running inside a cluster on an address that looks something like </span><code>&lt;service&gt;.&lt;namespace&gt;.svc.cluster.local</code><span>. If you send something to this address, your requests will go to the matching service if it exists and if it accepts connections.</span></p><p>Let’s go back to our cast for a moment; they are mostly services that take requests and give responses among each other, so they all had DNS records like this inside of the Kubernetes cluster, and this is how they communicated with each other.</p><p>For example, when a user sent a comment permalink to Notado to be saved, something like the following happened:</p><ol><li><p><span>User sends a request to save a comment to </span><a href="https://notado.app" rel="nofollow ugc noopener">notado.app</a></p></li><li><p><a href="https://notado.app" rel="nofollow ugc noopener">notado.app</a><span> sends a request to </span><code>notado-scraper.production.svc.cluster.local</code><span> to get the content of the comment from the permalink</span></p></li><li><p><a href="https://notado.app" rel="nofollow ugc noopener">notado.app</a><span> sends another request to </span><code>notado-integrations.production.svc.cluster.local</code><span> to push this newly saved content to any external integrations that the user has configured</span></p></li></ol><p>Hopefully this is still making sense.</p><p><span>My first task was to get these services communicating with each other in a different way, because these </span><code>svc.cluster.local</code><span> addresses only exist within the context of a Kubernetes cluster.</span></p><p><span>Thankfully, it was in my very first job that I learned to read configuration values like these from environment variables instead of hard-coding them, so this step was as simple as making a couple of configuration changes from </span><code>svc.cluster.local</code><span> addresses to </span><code>localhost</code><span> addresses.</span></p><p><span>“</span><em>Hang on!!</em><span>” I hear some readers exclaim. “</span><code>localhost</code><span>?? </span><em>I thought we were deploying this thing to a production environment on Fly.io!?</em><span>”</span></p><p><span>Yes my friends, we are, but since Notado is composed largely of resource-efficient Rust services, I thought, “</span><em>why not get this all running on a single Fly micro VM and reduce all the unnecessary complexity (and cost!) that was added to the deployment architecture by my initial lazy choice of Kubernetes as the deployment target?</em><span>”</span></p><p><span>After switching out the configuration variables to allow all of the services to communicate with each other on </span><code>localhost</code><span>, my next task was to figure out how to handle multiple processes on a single Fly micro VM.</span></p><p><span>Fly.io has </span><a href="https://fly.io/docs/app-guides/multiple-processes/" rel="nofollow ugc noopener">an entire page dedicated to this</a><span> and it wasn’t long until I decided to use </span><a href="https://github.com/DarthSim/overmind" rel="nofollow ugc noopener">Overmind</a><span> with a </span><code>Procfile</code><span> to manage all of the processes that would be living on my future Fly micro VM.</span></p><p><span>I highly recommend this approach to anyone else who finds themselves in a similar situation; it is simple, elegant and it </span><em>just works</em><span>.</span></p><p>You may have noticed at this point that I was not just planning a move from Digital Ocean to Fly.io, but I was in fact also planning a fundamental shift in strategy from horizontal scaling to vertical scaling.</p><p><span>With Kubernetes, it’s pretty common to scale services horizontally. This basically means that when you have a service that is struggling to respond to all of the requests being received, you can just add </span><em>another one</em><span> (insert DJ Khaled meme) alongside it to help spread the load of the requests.</span></p><p>If you keep adding more and more replicas of a service, you can start to visualise a horizontal line of services all trying to catch incoming requests.</p><p>In moving away from Digital Ocean’s managed Kubernetes offering, I was planning to run everything on a single micro VM on Fly.io, and then simply increase the capacity of that micro VM whenever I needed in the future.</p><p>This is vertical scaling in a nutshell; using a bigger boat.</p><p>I think that especially for those of us working in the areas of Platform, Infrastructure, DevOps etc., who then go on to build services as solo developers, we can get a little lost in all of the complex and fancy tooling that we become accustomed to in our day jobs.</p><p>With some careful planning, we can make it so that a single VM is all that is needed, and whenever that is within the realm of possibility, it is worth putting in the additional work up-front to make it a reality.</p><p>All in all, migrating services seemed pretty easy, right? Next came the part that I was dreading. Database migration. I am not exaggerating when I say that I was actually losing sleep over this.</p><p><span>One day I noticed a submission on Hacker News, a new blog post from </span><a href="https://tailscale.com" rel="nofollow ugc noopener">Tailscale</a><span>, and I had a thought. “</span><em>What if I don’t even have to migrate the database?</em><span>” </span></p><p><span>After consuming the excellent documentation on the Tailscale website about </span><a href="https://tailscale.com/kb/1019/subnets/#setting-up-a-subnet-router" rel="nofollow ugc noopener">setting up a subnet router</a><span>, I decided that for the foreseeable future I would keep using my managed Postgres database service on Digital Ocean and just use Tailscale to be able to connect from the Fly MicroVM to Postgres on a private IP address.</span></p><p>Let’s break this down a little.</p><p><span>This is pretty straight forward, I used </span><a href="https://cloudinit.readthedocs.io/en/latest/" rel="nofollow ugc noopener">cloud-init</a><span> to provision a VM in the same VPC as the managed Postgres database, installed Tailscale, and started it with the private CIDR range of the VPC passed to the </span><code>--advertise-routes</code><span> flag.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fcdb8ad74-1f92-4b98-a78f-f5bf1f458137_1840x1166.png" rel="nofollow ugc noopener"><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fcdb8ad74-1f92-4b98-a78f-f5bf1f458137_1840x1166.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fcdb8ad74-1f92-4b98-a78f-f5bf1f458137_1840x1166.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fcdb8ad74-1f92-4b98-a78f-f5bf1f458137_1840x1166.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fcdb8ad74-1f92-4b98-a78f-f5bf1f458137_1840x1166.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fcdb8ad74-1f92-4b98-a78f-f5bf1f458137_1840x1166.png" width="1456" height="923" data-attrs="{&#34;src&#34;:&#34;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/cdb8ad74-1f92-4b98-a78f-f5bf1f458137_1840x1166.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:923,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:541107,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fcdb8ad74-1f92-4b98-a78f-f5bf1f458137_1840x1166.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fcdb8ad74-1f92-4b98-a78f-f5bf1f458137_1840x1166.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fcdb8ad74-1f92-4b98-a78f-f5bf1f458137_1840x1166.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fcdb8ad74-1f92-4b98-a78f-f5bf1f458137_1840x1166.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>Example of a bash script that can be run when bringing up a VM to install and start Tailscale as a subnet router</figcaption></figure></div><p>By default, the new proxy VM was not able to connect to Postgres due to the strict database firewall rules I had previously set, so I updated the firewall rules to allow connections from the private IP address of the proxy VM.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffddb47df-c734-4d5e-8607-f22400badd11_1444x806.png" rel="nofollow ugc noopener"><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffddb47df-c734-4d5e-8607-f22400badd11_1444x806.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffddb47df-c734-4d5e-8607-f22400badd11_1444x806.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffddb47df-c734-4d5e-8607-f22400badd11_1444x806.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffddb47df-c734-4d5e-8607-f22400badd11_1444x806.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffddb47df-c734-4d5e-8607-f22400badd11_1444x806.png" width="1444" height="806" data-attrs="{&#34;src&#34;:&#34;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/fddb47df-c734-4d5e-8607-f22400badd11_1444x806.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:806,&#34;width&#34;:1444,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:317024,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffddb47df-c734-4d5e-8607-f22400badd11_1444x806.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffddb47df-c734-4d5e-8607-f22400badd11_1444x806.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffddb47df-c734-4d5e-8607-f22400badd11_1444x806.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Ffddb47df-c734-4d5e-8607-f22400badd11_1444x806.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>Example of a database firewall rule granting access to connections from a Digital Ocean droplet</figcaption></figure></div><p><span>The final step was to ensure that Tailscale was also installed in the Docker container deployed to Fly.io, and then starting Tailscale with the </span><code>—-accept-rules=true</code><span> flag before letting </span><code>overmind</code><span> bring up all the processes that run on the micro VM.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc5d72401-c002-4bad-bb1d-23c5ce259947_1444x896.png" rel="nofollow ugc noopener"><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc5d72401-c002-4bad-bb1d-23c5ce259947_1444x896.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc5d72401-c002-4bad-bb1d-23c5ce259947_1444x896.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc5d72401-c002-4bad-bb1d-23c5ce259947_1444x896.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc5d72401-c002-4bad-bb1d-23c5ce259947_1444x896.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc5d72401-c002-4bad-bb1d-23c5ce259947_1444x896.png" width="1444" height="896" data-attrs="{&#34;src&#34;:&#34;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/c5d72401-c002-4bad-bb1d-23c5ce259947_1444x896.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:896,&#34;width&#34;:1444,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:346649,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc5d72401-c002-4bad-bb1d-23c5ce259947_1444x896.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc5d72401-c002-4bad-bb1d-23c5ce259947_1444x896.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc5d72401-c002-4bad-bb1d-23c5ce259947_1444x896.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc5d72401-c002-4bad-bb1d-23c5ce259947_1444x896.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>Example of a start.sh script that can be run at startup on Fly.io</figcaption></figure></div><p>With all of this finally in place, whenever a service running on the Fly MicroVM made a request to a domain resolving to an IP address in the CIDR block passed to Tailscale in step 2, the request would be sent through Tailscale, over to the Digital Ocean droplet with Tailscale installed, and from there on to the managed Postgres database.</p><p>The nice thing about this approach is that you can pretty much apply it to any managed database on any cloud provider if you want to move your actual services over to Fly.io but keep the same managed database. The main consideration to keep in mind is the geographical distance between the managed database and your desired Fly.io region(s).</p><p>At this point, I had a fully functioning staging environment on Fly.io and I felt a huge weight lifted from my shoulders.</p><p>I realised that I had started believing in myself and my ability to build and manage a non-trivial service again. I also realised that somewhere along the way, I had stopped believing in myself and my ability to build and manage a non-trivial service, but that is a topic for another article.</p><p>I guess this technically deserves its own “phase” heading, since it covers switching the production environment from Digital Ocean to Fly.io, but in actual fact it was pretty uneventful.</p><p>I had both production instances running side by side for a while, reading from and writing to the same database, but with separate Meilisearch instances. </p><p><span>When I was ready, I changed the DNS record for </span><a href="https://notado.app" rel="nofollow ugc noopener">notado.app</a><span> to point to the instance running on Fly.io and waited for the updates to propagate. To make sure nothing was missing from the new Meilisearch instance, I fully rehydrated it from Postgres. That’s pretty much it.</span></p><p>I then went ahead and deleted the trusty old Kubernetes cluster on Digital Ocean that had served me so well for the last two years while burning a hole in my pocket, and started looking to the future.</p><p>To say that my productivity working on the Notado codebase skyrocketed once I had migrated everything over to Fly.io would be a huge understatement.</p><p>The cast of Notado services introduced at the beginning of this article have morphed and changed in ways better adapted to the new environment on which they are deployed and now live. I will be sharing more on what those transformations look like here in the future.</p><p><span>I am excited to share my lessons and takeaways from building, iterating on and managing </span><a href="https://notado.app" rel="nofollow ugc noopener">Notado</a><span> over the past two years in a series of upcoming technical articles. Stay tuned for my thoughts on:</span></p><ul><li><p><span>Betting on the </span><a href="https://www.rust-lang.org" rel="nofollow ugc noopener">Rust programming language</a></p></li><li><p><span>The </span><a href="https://rocket.rs" rel="nofollow ugc noopener">Rocket</a><span> v0.4 to v0.5 migration, </span><a href="https://actix.rs" rel="nofollow ugc noopener">Actix-Web</a><span> and the </span><a href="https://www.arewewebyet.org" rel="nofollow ugc noopener">Rust web framework ecosystem</a></p></li><li><p><a href="https://github.com/pest-parser/pest" rel="nofollow ugc noopener">Pest</a><span> and </span><a href="https://github.com/zesterer/chumsky" rel="nofollow ugc noopener">Chumsky</a><span> for parsing the DSLs that power Notado’s automatic tagging rules and tag aliases</span></p></li><li><p><a href="https://tokio.rs" rel="nofollow ugc noopener">Tokio</a><span>, Messaging Queues and Async Rust</span></p></li><li><p><a href="https://tailwindcss.com" rel="nofollow ugc noopener">Tailwind</a><span>, </span><a href="https://bulma.io" rel="nofollow ugc noopener">Bulma</a><span> and how (not) to handle a redesign</span></p></li><li><p><a href="https://tera.netlify.app" rel="nofollow ugc noopener">Tera</a><span>, HTML Templating, </span><a href="https://htmx.org" rel="nofollow ugc noopener">htmx</a><span> and Javascript</span></p></li><li><p>SwiftUI, Flutter, Native Applications and iOS Shortcuts</p></li></ul><p><span>If you can’t wait, check out my </span><a href="https://notado.app/feeds/jado/software-development" rel="nofollow ugc noopener">Software Development Feed</a><span>, where all of the interesting highlights from everything I read online related to building good (and bad) software development experiences get published (there is of course also </span><a href="https://notado.app/rss/jado/software-development/feed.rss" rel="nofollow ugc noopener">an RSS feed if you want to subscribe</a><span>).</span></p><p><a href="https://notado.app" rel="nofollow ugc noopener">Notado</a><span> is healthier and happier than ever!</span></p><p><span>After two years of using Notado exclusively, I could not imagine going back to any other service. Notado just </span><em>feels right</em><span>. It is everything that I have ever wanted in a bookmarking service.</span></p><p>There is nothing quite like being perpetually frustrated with every tool available for a job, finally biting the bullet and creating a tool that addresses your needs, and then having the pleasure and satisfaction of using that tool which now does exactly what you want and then gets out of the way.</p><p>After putting in this recent work to bring the operating cost down to a more sustainable sum, and significantly reducing the complexity of managing hosting and deployments, I can confidently say that Notado will live on as long as I do (and hopefully beyond!), even if as nothing else, then as the one place where I will save and organise the highlights from everything I read online until the end of my time.</p><p>Here is a run down of some of the new features that have rolled out since the migration to Fly.io was completed:</p><ul><li><p>Kindle highlight import (without requiring access to your Amazon account or having to copy and upload files from your physical device!)</p></li><li><p>Full support for Readwise-style inline tagging for Kindle highlight imports</p></li><li><p>Hacker News favourite comments import</p></li><li><p><span>Tag aliases to make tagging even easier on Kindle or anywhere else (eg </span><code>.qsf =&gt; quotes science-fiction</code><span>)</span></p></li><li><p>Login via NotadoBot</p></li><li><p>Deeply integrated iOS shortcuts for saving comment permalinks and saving text selection highlights from Safari</p></li><li><p><a href="https://notado.app/feeds/jado/software-development" rel="nofollow ugc noopener">Smart Feeds for specific topics that are automatically populated from your tags</a></p></li><li><p>Real-time filtering for titles in your Notado Library as you type</p></li><li><p><span>Real-time fault and typo-tolerant multilingual search across all of your saved content as you type (thanks </span><a href="https://www.meilisearch.com" rel="nofollow ugc noopener">Meilisearch</a><span> and </span><a href="https://htmx.org" rel="nofollow ugc noopener">htmx</a><span>!)</span></p></li><li><p>A new landing page with some nice interactive elements</p></li></ul><p>There will be dedicated articles taking a closer look at some of these features coming out soon.</p><p>I am incredibly grateful to the 3000+ users that have been participating in Notado’s free open beta since it began in 2020. I honestly never thought that my idea of “content-first bookmarking” would resonate with so many people.</p><p>The open beta will come to an end this year, and from January 2023, subscriptions for Notado will be available at $5.99/month. Users who create an account in 2023 will have a free 30 day trial (no payment details required) before being asked to purchase a subscription.</p><p>Users will always have access to all of their previously saved content regardless of subscription status.</p><p>There will always be a quick and easy way to export all of your content in a machine-readable format with a sane schema that closely resembles what Notado shows you, and respects the time, energy and effort that you have put into the organisation of your saved content library on Notado.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc38fb32e-b46f-4b4a-8aec-fcc1ef9a4954_1444x1212.png" rel="nofollow ugc noopener"><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc38fb32e-b46f-4b4a-8aec-fcc1ef9a4954_1444x1212.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc38fb32e-b46f-4b4a-8aec-fcc1ef9a4954_1444x1212.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc38fb32e-b46f-4b4a-8aec-fcc1ef9a4954_1444x1212.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc38fb32e-b46f-4b4a-8aec-fcc1ef9a4954_1444x1212.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc38fb32e-b46f-4b4a-8aec-fcc1ef9a4954_1444x1212.png" width="1444" height="1212" data-attrs="{&#34;src&#34;:&#34;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/c38fb32e-b46f-4b4a-8aec-fcc1ef9a4954_1444x1212.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1212,&#34;width&#34;:1444,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:499705,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc38fb32e-b46f-4b4a-8aec-fcc1ef9a4954_1444x1212.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc38fb32e-b46f-4b4a-8aec-fcc1ef9a4954_1444x1212.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc38fb32e-b46f-4b4a-8aec-fcc1ef9a4954_1444x1212.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc38fb32e-b46f-4b4a-8aec-fcc1ef9a4954_1444x1212.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>An example of how a JSON export of your data will look - very similar to what you see on your Notado home page!</figcaption></figure></div><p><span>Of course, if you wish for your account and all related saved content to be removed from Notado at the end of the open beta or a trial period, just </span><a href="mailto:support@notado.app" rel="nofollow ugc noopener">send an email</a><span>. You don’t have to worry about giving a reason, just say that you want your account and related content deleted, and I’ll be happy to confirm once it is done (I mean really </span><em>deleted</em><span>, not just a soft-delete with a “deleted” column in the database set to “true”!)</span></p><p><span>Thanks for sticking around until the end! If you want to get in touch, my Twitter handle is </span><a href="https://twitter.com/notado_app" rel="nofollow ugc noopener">@notado_app</a><span> and you can also find me in the </span><a href="https://discord.gg/WqtZUj4" rel="nofollow ugc noopener">Notado Discord server</a><span>.</span></p></div></div></div></article></div></div></div>
  </body>
</html>
