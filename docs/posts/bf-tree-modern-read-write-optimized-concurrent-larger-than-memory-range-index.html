<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/microsoft/bf-tree">Original</a>
    <h1>Bf-Tree: modern read-write-optimized concurrent larger-than-memory range index</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Bf-Tree is a modern read-write-optimized concurrent larger-than-memory range index in Rust from MSR.</p>

<p dir="auto">You can find the Bf-Tree research paper <a href="https://badrish.net/papers/bftree-vldb2024.pdf" rel="nofollow">here</a>. You can find more design docs <a href="https://github.com/microsoft/bf-tree/blob/main/doc">here</a>.</p>


<p dir="auto">Bf-Tree is written in Rust, and is available as a Rust crate. You can add Bf-Tree to your <code>Cargo.toml</code> like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="[dependencies]
bf-tree = &#34;0.1.0&#34;"><pre>[<span>dependencies</span>]
<span>bf-tree</span> = <span><span>&#34;</span>0.1.0<span>&#34;</span></span></pre></div>
<p dir="auto">An example use of Bf-Tree:</p>
<div dir="auto" data-snippet-clipboard-copy-content="use bf_tree::BfTree;
use bf_tree::LeafReadResult;

let mut config = bf_tree::Config::default();
config.cb_min_record_size(4);
let tree = BfTree::with_config(config, None).unwrap();
tree.insert(b&#34;key&#34;, b&#34;value&#34;);

let mut buffer = [0u8; 1024];
let read_size = tree.read(b&#34;key&#34;, &amp;mut buffer);

assert_eq!(read_size, LeafReadResult::Found(5));
assert_eq!(&amp;buffer[..5], b&#34;value&#34;);"><pre><span>use</span> bf_tree<span>::</span><span>BfTree</span><span>;</span>
<span>use</span> bf_tree<span>::</span><span>LeafReadResult</span><span>;</span>

<span>let</span> <span>mut</span> config = bf_tree<span>::</span><span>Config</span><span>::</span><span>default</span><span>(</span><span>)</span><span>;</span>
config<span>.</span><span>cb_min_record_size</span><span>(</span><span>4</span><span>)</span><span>;</span>
<span>let</span> tree = <span>BfTree</span><span>::</span><span>with_config</span><span>(</span>config<span>,</span> <span>None</span><span>)</span><span>.</span><span>unwrap</span><span>(</span><span>)</span><span>;</span>
tree<span>.</span><span>insert</span><span>(</span><span>b&#34;key&#34;</span><span>,</span> <span>b&#34;value&#34;</span><span>)</span><span>;</span>

<span>let</span> <span>mut</span> buffer = <span>[</span><span>0u8</span><span>;</span> <span>1024</span><span>]</span><span>;</span>
<span>let</span> read_size = tree<span>.</span><span>read</span><span>(</span><span>b&#34;key&#34;</span><span>,</span> <span>&amp;</span><span>mut</span> buffer<span>)</span><span>;</span>

<span>assert_eq</span><span>!</span><span>(</span>read_size<span>,</span> <span>LeafReadResult</span><span>::</span><span>Found</span><span>(</span><span>5</span><span>)</span><span>)</span><span>;</span>
<span>assert_eq</span><span>!</span><span>(</span><span>&amp;</span>buffer<span>[</span>..<span>5</span><span>]</span><span>,</span> <span>b&#34;value&#34;</span><span>)</span><span>;</span></pre></div>
<p dir="auto">PRs are accepted and preferred over feature requests. Feel free to reach out if you have any design questions.</p>



<p dir="auto">Bf-Tree supports Linux, Windows, and macOS, although only a recently version of Linux is rigorously tested. Bf-Tree is written in Rust, which you can install <a href="https://rustup.rs" rel="nofollow">here</a>.</p>
<p dir="auto">Please install pre-commit hooks to ensure that your code is formatted and linted in the same way as the rest of the project; the coding style will be enforced in CI, these hooks act as a pre-filter.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# If on Ubuntu
sudo apt update &amp;&amp; sudo apt install pre-commit
pre-commit install"><pre><span><span>#</span> If on Ubuntu</span>
sudo apt update <span>&amp;&amp;</span> sudo apt install pre-commit
pre-commit install</pre></div>






<p dir="auto">Concurrent systems are nondeterministic, and subject to exponential amount of different thread interleaving. We use <a href="https://github.com/awslabs/shuttle">shuttle</a>
to deterministically and systematically explore different thread interleaving to uncover the bugs caused by subtle multithread interactions.</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo test --features &#34;shuttle&#34; --release shuttle_bf_tree_concurrent_operations"><pre>cargo <span>test</span> --features <span><span>&#34;</span>shuttle<span>&#34;</span></span> --release shuttle_bf_tree_concurrent_operations</pre></div>
<p dir="auto">(Takes about 5 minute to run)</p>

<p dir="auto">Fuzz testing is a bug finding technique that generates random inputs to the system and test for crash. Bf-Tree employs fuzzing to generate random operation sequences
(e.g., insert, read, scan) to the system and check that none of the operation sequence will crash the system or lead to inconsistent state. Check the
<a href="https://github.com/microsoft/bf-tree/blob/main/fuzz/README.md">fuzz</a> folder for more details.</p>

<p dir="auto">Check the <a href="https://github.com/microsoft/bf-tree/blob/main/benchmark/README.md">benchmark</a> folder for more details.</p>
<div dir="auto" data-snippet-clipboard-copy-content="cd benchmark
env SHUMAI_FILTER=&#34;inmemory&#34; MIMALLOC_LARGE_OS_PAGES=1 cargo run --bin bftree --release"><pre><span>cd</span> benchmark
env SHUMAI_FILTER=<span><span>&#34;</span>inmemory<span>&#34;</span></span> MIMALLOC_LARGE_OS_PAGES=1 cargo run --bin bftree --release</pre></div>
<p dir="auto">More advanced benchmarking, with metrics collecting, numa-node binding, huge page, etc:</p>
<div dir="auto" data-snippet-clipboard-copy-content="env MIMALLOC_SHOW_STATS=1 MIMALLOC_LARGE_OS_PAGES=1 MIMALLOC_RESERVE_HUGE_OS_PAGES_AT=0 numactl --membind=0 --cpunodebind=0 cargo bench --features &#34;metrics-rt&#34; micro"><pre>env MIMALLOC_SHOW_STATS=1 MIMALLOC_LARGE_OS_PAGES=1 MIMALLOC_RESERVE_HUGE_OS_PAGES_AT=0 numactl --membind=0 --cpunodebind=0 cargo bench --features <span><span>&#34;</span>metrics-rt<span>&#34;</span></span> micro</pre></div>

<p dir="auto">This project has adopted the <a href="https://opensource.microsoft.com/codeofconduct/" rel="nofollow">Microsoft Open Source Code of Conduct</a>.
For more information see the <a href="https://opensource.microsoft.com/codeofconduct/faq/" rel="nofollow">Code of Conduct FAQ</a>
or contact <a href="mailto:opencode@microsoft.com">opencode@microsoft.com</a> with any additional questions or comments.</p>

<p dir="auto">Please see <a href="https://github.com/microsoft/bf-tree/blob/main/CONTRIBUTING.md">CONTRIBUTING.md</a>.</p>

<p dir="auto">See <a href="https://github.com/microsoft/bf-tree/blob/main/SECURITY.md">SECURITY.md</a> for security reporting details.</p>

<p dir="auto">This project may contain trademarks or logos for projects, products, or services. Authorized use of Microsoft trademarks
or logos is subject to and must follow <a href="https://www.microsoft.com/en-us/legal/intellectualproperty/trademarks/usage/general" rel="nofollow">Microsoft’s Trademark &amp; Brand Guidelines</a>. Use of Microsoft trademarks or logos in
modified versions of this project must not cause confusion or imply Microsoft sponsorship. Any use of third-party
trademarks or logos are subject to those third-party’s policies.</p>

<ul dir="auto">
<li><a href="mailto:bftree@microsoft.com">bftree@microsoft.com</a></li>
</ul>
</article></div></div>
  </body>
</html>
