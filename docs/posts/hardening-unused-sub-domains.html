<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.mailhardener.com/kb/hardening-unused-domains">Original</a>
    <h1>Hardening unused (sub)domains</h1>
    
    <div id="readability-page-1" class="page"><div>
    
    <div>
        <nav><a href="https://www.mailhardener.com/kb">Knowledge base</a> &gt; <span>Hardening unused (sub)domains</span></nav>
        
<p>Even if a domain is not intended to be used for email, whether it being inbound (receiving) or outbound (sending) email, it is still recommended to apply proper email hardening techniques to prevent the domain from being abused for fraudulent activities.</p>
<p>Domains that are not used for email may be parked domains, legacy domains, testing domains, black-hole domains, or any other domain that may be used for applications other than email.
It is also possible that a domain accepts inbound email, but does not send email, or vise versa.</p>
<p>In this article we&#39;ll explain:</p>
<ul>
<li>How a domain can be set up with DMARC so that no email can be sent on behalf of the domain. This helps prevent fraudulent activities that may affect the reputation of the domain and brand.</li>
<li>Using rfc7575 &#39;null MX&#39; records as a best practice for domains that do not accept inbound email. This improves the experience of the customer when accidentally sending email to the domain.</li>
</ul>
<p>We&#39;ll also explain how these techniques can be used selectively to include, or exclude selected subdomains.</p>
<h2 id="outbound-email">Outbound email</h2>
<p>Domains that are not used to send email may still be susceptible to fraudulent abuse.
An adversary may try to send email on behalf of the domain. That is: using the domain in the sender address. Proper hardening can prevent this.</p>
<p>The goal here is to leverage DMARC to prevent any email sent on behalf of the domain from being accepted by any receiver. 
We achieve this by configuring the domain so that it is no longer possible for any email to reach DMARC alignment, thus forcing the receiver to follow the DMARC policy, which we will set to &#39;reject&#39;.
By publishing the &#39;reject&#39; policy, any email that is attempted to be sent on behalf of the domain will be rejected by (DMARC capable) receivers.</p>
<blockquote>
<p>Remember that for an email to be considered DMARC aligned, at least one of DKIM and SPF must reach alignment.
So, in order to prevent any email from reaching DMARC alignment, neither SPF nor DKIM may reach alignment.</p>
</blockquote>
<h3 id="spf">SPF</h3>
<p>To prevent any sender from reaching SPF alignment for a domain, we create an SPF DNS record with just one rule: <code>-all</code>.</p>
<p>As the name implies, the <code>all</code> mechanism matches every sender, thus every email.
By prefixing the rule with the <code>-</code> (fail) policy, each email sent on behalf of the domain will fail SPF validation, thus failing SPF alignment.</p>
<p>To prevent any sender from reaching SPF alignment, a TXT record should be created at the domain apex with the following value:</p>
<p><code>v=spf1 -all</code></p>
<p>If the domain already has an (old) SPF record set, then that existing SPF record should be replaced with the one displayed above, since a domain should only have 1 SPF record.</p>
<p>Be aware that SPF does not propagate, meaning that for email sent from subdomain.yourdomain.com, the SPF record at the domain apex will <em>not</em> be used. So, it is recommended to also create this same SPF record for all subdomains, by creating a wildcard DNS record at <code>*.yourdomain.com</code>.</p>
<blockquote>
<p><strong>Note:</strong> an alternative option would be not to publish an SPF record at all.
This is the same as publishing a <code>?all</code> rule.
The <code>?</code> (neutral) policy means SPF is not to be used during evaluation of email by the receiver.
It is effectively an opt-out from using SPF.</p>
<p>However, how a &#39;neutral&#39; policy is handled differs with the various SMTP software implementations, so the email may still be accepted by some if a neutral policy (or no SPF record at all) is used.
It is therefore recommended to use SPF with the <code>-all</code> rule to give a strong statement to receivers that email should not be accepted.</p>
</blockquote>
<h3 id="dkim">DKIM</h3>
<p>The goal is that no sender can ever reach DMARC alignment, which means that no sender should ever be able to reach DKIM alignment.</p>
<p>This is achieved by simply removing any existing DKIM DNS records.
That are any TXT records at <code>*._domainkey.yourdomain.com</code>, or DKIM records published for subdomains at <code>*._domainkey.subdomain.yourdomain.com</code>.</p>
<blockquote>
<p>Be aware that the <code>v=DKIM1;</code> part in a DKIM record is actually optional, so even if a TXT record does not start with &#39;v=DKIM1&#39;, it may actually be a valid DKIM record.</p>
<p>However, since no TXT type records other than DKIM records should be published under the <code>_domainkey</code> label anyway, you probably want to remove all TXT records published under the <code>_domainkey</code> label as part of good hygiene.</p>
</blockquote>
<h3 id="dmarc">DMARC</h3>
<p>With the SPF policy set to <code>-all</code> and any DKIM records removed, it will no longer be possible for any email that is sent on behalf of the domain to achieve DMARC alignment.
As a result, a DMARC capable receiver will apply the DMARC policy that is published in the DMARC DNS record. By creating a DMARC record with the <code>reject</code> policy, any email sent on behalf of the domain should be rejected by the receiver.</p>
<p>Create a DNS TXT type record at <code>_dmarc.yourdomain.com</code> with the following content:</p>
<p><code>v=DMARC1; p=reject;</code></p>
<p>Note that a domain should only have one DMARC record (a TXT type record starting with <code>v=DMARC1</code>, at <code>_dmarc.yourdomain.com</code> ). If the domain already has a DMARC record, the existing record can be re-used by setting the <code>p</code> value to <code>reject</code>. If there is an existing DMARC record with the <code>sp</code> value set, remove that so that the <code>reject</code> policy will also apply to subdomains.</p>
<p>This DMARC record advises any receiver that email from the domain should be rejected if the email does not reach DMARC alignment. Since we ensured that no email can ever reach SPF or DKIM alignment, it is ensured that no email can ever be DMARC aligned.
Therefore, any email sent on behalf of the domain should be rejected by the receiver.</p>
<blockquote>
<p><strong>Note</strong>: Unlike, for example with SPF, DMARC does propagate.
This means that if an email is sent using <code>subdomain.yourdomain.com</code> in the sender address, and no DMARC record exists at <code>_dmarc.subdomain.yourdomain.com</code>, the receiver will look for a DMARC record at <code>_dmarc.yourdomain.com</code>.
So, verify that no other DMARC records exist at subdomains, to ensure that no email can be sent from any subdomains.</p>
</blockquote>
<p>With the SPF, DKIM and DMARC set up as explained above, it should no longer be possible for any sender to send email on behalf of the domain (using the domain in the sender address).</p>
<h2 id="inbound-email">Inbound email</h2>
<p>Inbound email is email that is being delivered to a domain.
Not every domain is intended to accept inbound email, even if the domain is used for outbound (sending) email.</p>
<p>But even if a domain is not intended to accept inbound email, senders may still attempt to deliver email.
This will obviously fail, but due to resend policies it may take up to a week before the user is notified that the email is undeliverable.
By properly configuring the domain, we can indicate a &#39;positive denial&#39; to potential senders that the domain does not accept inbound email. This gives a better experience to the end user, as they will get an immediate response that the email cannot be delivered to the domain.</p>
<blockquote>
<p>There is a lesser known &#39;feature&#39; in rfc5321 section 5.1, which describes how a sending SMTP service must locate the host to deliver email to. If a domain has no MX records, the sending SMTP server must attempt to deliver email on the host found in the DNS <code>A</code> (or <code>AAAA</code>) records.</p>
<p><strong>Yes, you read that right. Even if a domain has no <code>MX</code> type records set up, delivery of email will still be attempted at the host pointed to by the <code>A</code> or <code>AAAA</code> records.</strong></p>
<p>The reason for this behavior is to provide a fallback method in case of DNS misconfiguration, or if the DNS service does not support the MX type record (which, in 1982 when the original RFC for SMTP was released, was a concern).</p>
</blockquote>
<p>So, not having any <code>MX</code> type records set for a domain, will cause two different issues:</p>
<ul>
<li>The sending SMTP service will retry delivery of an email message for an extended period (often up to a week). This results in the user not being notified on the delivery issue until the retry timeouts have passed.</li>
<li>It causes undesired connection attempts to the hosts configured in the A/AAAA records on port 25.</li>
</ul>
<p>To solve these issues, a &#39;null MX&#39; record is proposed in rfc7505.</p>
<h3 id="null-mx-records-rfc7505">&#39;null MX&#39; records (rfc7505)</h3>
<p>The <a href="https://datatracker.ietf.org/doc/html/rfc7505" target="_blank" rel="external">rfc7505</a> standard describes a method of &#39;positive denial&#39; of inbound email.
By placing a &#34;null MX&#34; record, a domain can indicate that it does not accept inbound email.</p>
<p>This offers a better overall experience for the end user who is attempting to send the email, as delivery will fail immediately (instead of after a week or so). Properly designed email clients will be able to hint the user that the used domain in the recipient&#39;s address is likely mistyped.</p>
<p>A rfc7505 &#39;null MX&#39; record is an MX record with the highest priority (0), and an empty host label (&#34;.&#34;). This &#39;null MX&#39; record should be the only <code>MX</code> type record for the (sub)domain.</p>
<p><code>MX 0 .</code></p>
<p>This will cause a sending SMTP service to use this record, and not fall back to the A/AAAA record. Since the hostname in the &#39;null MX&#39; record is not usable (it is empty), the sending SMTP service will not be able to use this record. Since there are no further MX records published by the domain, the SMTP service has no other delivery methods, and the email will hard-bounce.</p>
<p>Properly designed SMTP services, and email agents (MUA) will be able to recognize the rfc7505 &#39;null MX&#39; record (one MX record, with prio 0 and an empty host name), and will notify the user attempting to send the email that the domain does not accept email, and even hint the user that they may have mistyped the domain name, like an email client may do for non-existing domains.</p>
<h2 id="allowing-certain-subdomains">Allowing (certain) subdomains</h2>
<p>Up till this point, this article assumed that the entire domain should no longer be usable for email.
However, if certain subdomains are still to be used for email, you can override your policies for a subdomain.</p>
<h3 id="spf-1">SPF</h3>
<p>We want to allow email from a subdomain to reach SPF alignment, while still preventing email from the domain apex or other subdomains to reach alignment.
To achieve that, an SPF record can be created for the specific subdomain, or by creating an SPF record for a wildcard subdomain (which will then apply to <em>all</em> subdomains).
The SPF record is then used to designate the allowed senders for this specific subdomain.
The domain apex can still use the <code>-all</code> policy as explained above.</p>
<h3 id="dkim-1">DKIM</h3>
<p>DKIM DNS records may be created at the subdomain level (for example: <code>selector._domainkey.subdomain.mailhardener.com</code>).
To ensure this key can only be used for the subdomain, it is recommended to set the &#39;strict&#39; flag in the DKIM DNS record, by adding <code>t=s</code> to the record. Using strict mode will prevent the key from being accepted for any other subdomains.</p>
<h3 id="dmarc-1">DMARC</h3>
<p>Strictly speaking, DMARC does not have to be changed if a subdomain is allowed to send email.
If the SPF and/or DKIM configuration for the subdomain is set up correctly, then email from the subdomain will achieve DMARC alignment, thus the DMARC policy is not applied, thus the email will be accepted.</p>
<p>If needed, the DMARC policy for any (or all) subdomain(s) can be overridden by any of the following methods.</p>
<ul>
<li>Create a DMARC DNS record for the subdomain at _dmarc.subdomain.yourdomain.com, and set the <code>p=</code> to the desired policy for that specific subdomain.</li>
<li>Or, set the <code>sp=</code> subdomain policy configuration in the domain apex DMARC record (at _dmarc.yourdomain.com), this policy will apply to all subdomains of yourdomain.com</li>
</ul>
<h3 id="mx-inbound-email">MX (inbound email)</h3>
<p>When a subdomain does accept inbound email (but the domain apex does not), then MX records can be created at the subdomain level.
The domain apex, or other subdomains may still use the rfc7505 &#39;null MX&#39; record at the same time.</p>
<h2 id="disallowing-certain-subdomains">Disallowing (certain) subdomains</h2>
<p>Conversely, it is also possible to disable email for a subdomain, while still retaining email functionality for the domain apex, or other subdomains.
We apply the same techniques as described above, but in such a way that the domain apex, and/or other subdomains can still be used for email.</p>
<h3 id="spf-2">SPF</h3>
<p>To prevent email from a subdomain from reaching SPF alignment, an SPF record can be created for the specific subdomain, or by creating an SPF record for a wildcard subdomain (which will then apply to <em>all</em> subdomains).
This SPF record should then use the <code>-all</code> policy.
Since SPF does not propagate, the domain apex (or any other subdomains) can still use permissive SPF records that designate permitted senders for that (sub)domain.</p>
<h3 id="dkim-2">DKIM</h3>
<p>To prevent email from a subdomain from reaching DKIM alignment (and thus DMARC alignment), the obvious first step is to remove any existing DKIM DNS records published under the subdomain.
That is for example: all TXT records at <code>*._domainkey.subdomain.mailhardener.com</code>.
However, additional steps must be taken to prevent the subdomain from using any other DKIM records (from the domain apex, or other subdomains).
By default, the used DKIM record does not have to be published under the exact subdomain.
For example: it is possible for email from <code>jane@subdomain.mailhardener.com</code> to use a DKIM key from <code>mailhardener.com</code>.</p>
<p>Therefore, we must augment the existing DKIM records that are published under the domain apex and other subdomains, with the &#39;strict&#39; flag.
By adding <code>t=s</code> to the DKIM records, the DKIM record becomes &#39;strict&#39;, meaning that the DKIM signature will only be accepted if the DKIM record is published under the exact same (sub)domain as is used in the domain portion of the sender email address (the part after the &#39;@&#39; symbol).</p>
<h3 id="dmarc-2">DMARC</h3>
<p>When disallowing email from a subdomain, we want a strict DMARC policy for that subdomain.
Other subdomains, or the domain apex may still use a less-strict (or even no) DMARC policy.
If no DMARC policy is published for the subdomain, a receiver will propagate &#39;up&#39; to the domain apex looking for a DMARC policy.</p>
<p>So, in case it is desired to have a DMARC policy for a subdomain that differs from other subdomains, or the domain apex, a DMARC policy record can be published at the subdomain level:</p>
<p><code>_dmarc.[subdomain].example.com</code></p>
<h2 id="re-enabling-email-functionality">Re-enabling email functionality</h2>
<p>Re-enabling email functionality for a domain that was previously set up not to handle email, may actually be slightly simpler than hardening an existing domain, as there should not be any legacy to consider.
It is like starting with a clean slate.</p>
<h3 id="spf-3">SPF</h3>
<p>To re-enable email for the domain, add the sender (via for example an <code>a</code>, or <code>include</code> rule) to the existing SPF record.
The <code>-all</code> that was placed earlier can remain in place, but the slightly less strict <code>~all</code> (&#39;soft fail&#39;) may be used during the initial setup period, to verify the SPF policy is correct and complete.
It is recommended to use <a href="https://www.mailhardener.com" target="_blank" rel="external">DMARC reporting</a> to verify that all legitimate senders pass SPF alignment.</p>
<h3 id="dkim-3">DKIM</h3>
<p>To re-enable email for a (sub)domain, add the DKIM DNS records as recommended by the vendor of the email service or software used to send the email.
It is recommended to use DMARC reporting to verify and monitor that all legitimate senders are passing DKIM alignment.</p>
<h3 id="dmarc-3">DMARC</h3>
<p>If a DMARC record was created following the examples above, then it should already be set up to use a strong (<code>reject</code>) policy, and have DMARC reporting enabled.
During the initial setup of the email services, it might be beneficial to set a less strict policy (for example: <code>quarantine</code>, or even <code>none</code>), and use DMARC monitoring to verify the email services are aligned before switching back to the strong policy (<code>reject</code>).</p>
<p>Because the domain is starting from a &#39;clean slate&#39; again, it is a great opportunity to use the strong <code>reject</code> policy, and ensure that all senders are (at least) reaching DKIM alignment.</p>
<h2 id="always-be-monitoring">Always be monitoring</h2>
<h3 id="monitoring-outbound-email">Monitoring outbound email</h3>
<p>Regardless if a (sub)domain is used for outbound (sending) email or not, it is always recommended to use rfc7489 <a href="https://www.mailhardener.com/kb/dmarc">DMARC monitoring</a>.
A DMARC report aggregation service such as <a href="https://www.mailhardener.com/">Mailhardener</a> can be used to create an overview of all sources of email.</p>
<p>Even if a (sub)domain is not used for outbound email, DMARC reports can still be used to verify that no email service is reaching alignment.
It can also be used for digital forensics, fraud investigations and detecting suspicious activity of an adversary.</p>
<p>If a (sub)domain is used for outbound email, then DMARC reports are used to verify that all legitimate senders are reaching DKIM and/or SPF alignment.
This helps improve deliverability, and allows for adopting a strong (<code>reject</code>) DMARC policy, which reduces fraudulent use of the domain in email.</p>
<h3 id="monitoring-inbound-email">Monitoring inbound email</h3>
<p>Regardless if a domain accepts inbound email, it is always recommended to use rfc8460 <a href="https://www.mailhardener.com/kb/smtp-tls-reporting">SMTP TLS reporting</a>.</p>
<p>SMTP TLS reports are used to monitor inbound email traffic from the sender&#39;s perspective, mostly (but not exclusively) related to TLS (SSL) aspects of the SMTP session.
For (sub)domains that do <em>not</em> accept inbound email, SMTP TLS reporting can be used to verify that no SMTP session is ever successful for the monitored (sub)domain.</p>
<p>Conversely, for (sub)domains that <em>do</em> accept inbound email, SMTP TLS reports are used to verify that senders are not experiencing TLS (SSL) related delivery issues.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Proper implementation of email hardening techniques can be beneficial even to (sub)domains that are not intended to be used with email.
These may be parked domains, legacy domains, testing domains, or any other domain that are used for other services than email.</p>
<p>Deploying a strict DMARC policy, whilst ensuring that email sent on behalf of the (sub)domain can never reach alignment, is an effective anti-fraud mechanism that helps maintain the reputation of the domain and brand.</p>
<p>By using a &#39;null MX&#39; setup as defined by rfc7505, a better user-experience is created for customers that may be accidentally attempting to send email to a domain that is not intended to receive email.</p>
<p>Regardless if the domain is intended to be used for email or not, it is always recommended to use DMARC monitoring for outbound email, and SMTP TLS report monitoring for inbound email.
It is recommended to use an email monitoring suite, such as <a href="https://www.mailhardener.com/features">Mailhardener</a>, to monitor domain assets from being abused.</p>
<h3 id="further-reading">Further reading</h3>
<ul>
<li><a href="https://www.mailhardener.com/kb/dmarc">DMARC knowledge base</a></li>
<li><a href="https://www.mailhardener.com/kb/dkim">DKIM knowledge base</a></li>
<li><a href="https://www.mailhardener.com/kb/spf">SPF knowledge base</a></li>
</ul>
<h3 id="free-validation-tools">Free validation tools</h3>
<ul>
<li><a href="https://www.mailhardener.com/tools/spf-validator">SPF record validator</a></li>
<li><a href="https://www.mailhardener.com/tools/dmarc-validator">DMARC record validator</a></li>
<li><a href="https://www.mailhardener.com/tools/dkim-validator">DKIM record validator</a></li>
</ul>
<h3 id="related-articles">Related articles</h3>
<ul>
<li><a href="https://www.mailhardener.com/features">Mailhardener features</a></li>
<li><a href="https://www.mailhardener.com/pricing">Mailhardener pricing</a></li>
</ul>

        <div>
            <h3>Share your thoughts!</h3>
            <p>On last thing: If you have questions, comments or thoughts on this article, don&#39;t hesitate to <a href="mailto:kb@mailhardener.com?subject=re:%20Hardening%20unused%20(sub)domains">shoot us an email</a>.</p>
            <p>You can also follow and reach us on Twitter <a href="https://twitter.com/mailhardener">@Mailhardener</a>.</p>
        </div>
            <div>
                <p>With Mailhardener you can configure, validate and monitor your domain for all aspects of email security. Mailhardener is free to use for a single domain.</p>
                <p><a href="https://www.mailhardener.com/dashboard/sign-up">Sign up now</a>
            </p></div>
    </div>
</div></div>
  </body>
</html>
