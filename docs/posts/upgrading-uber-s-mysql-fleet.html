<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.uber.com/en-JO/blog/upgrading-ubers-mysql-fleet/">Original</a>
    <h1>Upgrading Uber&#39;s MySQL Fleet</h1>
    
    <div id="readability-page-1" class="page"><div data-baseweb="block">




<p>At Uber, our MySQL fleet is the backbone of our data infrastructure, supporting a vast array of operations critical to our platform. Starting 2023, we embarked on a significant journey to upgrade our MySQL fleet to the latest version (i.e., MySQL v8.0). </p>



<p>In this blog post, we delve into the motivations, challenges, and solutions involved in this monumental upgrade process and how we completed this upgrade without impacting our Service Level Objectives (SLO).</p>



<hr aria-hidden="true" role="separator"/>



<p><h2 id="h-motivation-for-the-upgrade">Motivation for the Upgrade</h2></p>



<p>Several compelling factors drove our decision to transition from MySQL v5.7 to v8.0:</p>



<p><strong>Addressing End-of-Life Concerns:</strong> As MySQL v5.7 reached its <span><a href="https://endoflife.date/mysql" target="_blank" rel="noreferrer noopener">extended support end date</a></span>, continuing to use it exposed us to potential security vulnerabilities and a lack of ongoing bug fixes. This posed a significant risk to the stability and integrity of our data.</p>



<p><strong>Boosting Performance and Concurrency:</strong> MySQL v8.0 offered a compelling proposition with its promise of <span><a href="https://www.mysql.com/why-mysql/benchmarks/mysql/" target="_blank" rel="noreferrer noopener">substantial performance enhancements</a></span>. Optimizations in indexing and resource utilization translated to faster query execution speeds and improved concurrency handling. This directly translates to a smoother user experience for our customers.</p>



<p><strong>Unlocking New Functionality:</strong> Beyond performance improvements, v8.0 introduced valuable features like support for window functions, enhanced JSON handling, and better spatial data capabilities. These features opened new avenues for data manipulation and analysis, empowering us to unlock new functionalities within our platform.</p>



<p><strong>Password Rotation:</strong> The introduction of <span><a href="https://www.percona.com/blog/using-mysql-8-dual-passwords/" target="_blank" rel="noreferrer noopener">“Dual passwords”</a></span> in v8.0 allows for smoother password rotations during security incidents, minimizing service disruptions.</p>



<p><strong>Streamlining Operational Efficiency:</strong> Managing schema changes is an ongoing task. The <span><a href="https://dev.mysql.com/blog-archive/mysql-8-0-instant-add-and-drop-columns/#:~:text=This%20feature%20enables%20users%20to,28%20(before%20MySQL%208.0." target="_blank" rel="noreferrer noopener">Instant ADD Column feature</a></span> in v8.0 significantly streamlined this process. This translates to reduced downtime during schema alterations, improving our overall operational efficiency.</p>



<hr aria-hidden="true" role="separator"/>



<p><h2 id="h-a-closer-look-uber-s-massive-mysql-infrastructure">A Closer Look: Uber’s Massive MySQL Infrastructure</h2></p>



<p>Before delving into the details of our MySQL upgrade journey, it’s essential to grasp the scale and complexity of Uber’s MySQL infrastructure:</p>



<p><strong>Scale:</strong> Uber’s MySQL infrastructure comprises over 2,100 clusters, distributed across 19 production zones spanning three regions. With over 16,000 nodes, our infrastructure forms the backbone of Uber’s data storage and processing capabilities.</p>



<p><strong>Data Volume and Query Load:</strong> Supporting multiple Petabytes of data and serving approximately 3 million queries per second, our MySQL infrastructure handles a vast amount of data and traffic on a daily basis.</p>



<p><strong>Clustered Architecture:</strong> Each MySQL cluster consolidates multiple MySQL processes running on individual nodes. While each node within a cluster contains identical data, they are strategically distributed across different data centers to ensure data availability and support failover mechanisms.</p>



<p><strong>Primary-Secondary Replication:</strong> Within each cluster, a primary node manages all write traffic, while secondary nodes replicate data asynchronously. This architecture ensures redundancy and fault tolerance, allowing for seamless failover in the event of primary node failure.</p>



<p><strong>Upgrade Considerations:</strong> Notably, while MySQL v5.7 primary to MySQL v8.0 read replica replication is compatible, the reverse scenario—MySQL v8.0 primary to MySQL v5.7 read replica replication—is not supported. This distinction played a crucial role in our upgrade planning and execution strategy.</p>



<hr aria-hidden="true" role="separator"/>



<p><h2 id="h-navigating-challenges-in-the-mysql-upgrade-journey">Navigating Challenges in the MySQL Upgrade Journey</h2></p>



<p>The sheer scale of Uber’s MySQL infrastructure, with over 2,100 clusters and 16,000+ nodes spread across regions and zones, presented a significant challenge. Manual upgrades were simply not an option. To address this, we devised a comprehensive, multi-step upgrade strategy that could be executed efficiently across diverse environments, requiring meticulous coordination.</p>



<p>Another key concern was minimizing downtime during the upgrade process.  Maintaining Service Level Objectives (SLOs) and Service Level Agreements (SLAs) was paramount to ensure uninterrupted service for our users.  Our solution involved meticulous planning and a focus on minimizing downtime throughout the upgrade process.</p>



<p>Compatibility with existing applications and services was another hurdle. Ensuring seamless integration with our existing ecosystem necessitated extensive testing, including thorough validation and regression checks.</p>



<p>To further enhance system reliability and minimize service disruptions, we implemented automated rollback mechanisms. These mechanisms could automatically revert upgrades in case of failures or compatibility issues.</p>



<p>Finally, minimizing manual intervention during the upgrade process was crucial.  To streamline operations and reduce the risk of human error, we developed robust automated workflows. These workflows automated repetitive tasks, enabling seamless upgrades across thousands of clusters and nodes.</p>



<p>Overall, upgrading to v8.0 seemed like a huge win for everyone at Uber, as it promised a security boost, performance leap, and exciting new features. But manually tackling this across thousands of clusters? No, thanks! We needed a smarter solution–a solution that scaled. Enter our custom-built automation system, designed to guide each cluster meticulously through the multi-step upgrade process, all without a single human touch.</p>



<hr aria-hidden="true" role="separator"/>



<p><h2 id="h-path-to-mysql-upgrade-uber">Path to MySQL Upgrade @ Uber</h2></p>



<p>When we were considering an upgrade of our MySQL clusters from version 5.7 to 8.0, there were two possible approaches that we could have taken:</p>



<p><h3 id="h-side-by-side-upgrade">Side-By-Side Upgrade</h3></p>



<p>In a side-by-side upgrade, the new version of MySQL (in this case, v8.0) is installed alongside the existing version (v5.7). This approach involves setting up a separate server where the new version is deployed and configured. Once the new server is ready, traffic is gradually redirected to the new version, allowing for a smooth transition.</p>



<p><h3 id="h-in-place-upgrade">In Place Upgrade</h3></p>



<p>An in-place upgrade involves directly upgrading the existing MySQL installation to the new version (v8.0) without setting up a separate environment. This process typically requires stopping the MySQL service, performing the upgrade, and then restarting the service. In-place upgrades are simpler in terms of setup, but may involve longer downtime compared to side-by-side upgrades. Additionally, there is less room for rollback in case of unexpected issues during the upgrade process.</p>



<p><h3 id="h-chosen-strategy">Chosen Strategy</h3></p>



<p>After careful consideration and thorough evaluation of the advantages and disadvantages, we made the decision to <strong>opt for a side-by-side upgrade approach</strong> from v5.7 nodes to v8.0, rather than pursuing an in-place upgrade. This choice was made in anticipation of the following benefits:</p>



<div><ol>
<li><strong>Minimal downtime:</strong> With a side-by-side upgrade, we can keep the old MySQL 5.7 nodes running while we set up the new MySQL 8.0 nodes. This means we can gradually migrate the applications to the new nodes without any significant downtime.</li>



<li><strong>Reduced risk:</strong> Since the old MySQL 5.7 nodes remain operational, we can roll back to it if there are any issues with the new MySQL 8.0 nodes. This reduces the risk of performance degradation, data loss <em>(only until the maintenance phase in the upgrade process)</em> or other issues that may arise during the upgrade process.</li>



<li><strong>Better testing:</strong> By running the new MySQL 8.0 nodes alongside the old MySQL 5.7 nodes, we can test the new nodes with <strong>production read-only application load</strong> before making the switch. This can help us identify any issues and ensure that everything works as expected before we complete the migration.</li>
</ol></div>



<hr aria-hidden="true" role="separator"/>


<div>
<figure data-wp-block-name="core/image" data-wp-block="{&#34;align&#34;:&#34;center&#34;,&#34;hash&#34;:&#34;9a536828-d504-4f47-ab73-662f46b5046d&#34;,&#34;alt&#34;:&#34;&#34;}"><img alt="Image" src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXd0hJcLDpWUQ-XXtX5ir-K31hrBrAV5xEGHRNh3pVrUKfXdyBvw95eOfAvdnuUGqEygD4ERT0mINBrNBnT1PQI4awgvSiH8rI64n65HCQ5lOPwHAww6raRta6ZlGLHvS844LdQWv3eVTOQH6uPYgARnScES?key=t0GcRSII3lNuPS3m8oPG7g" loading="lazy"/><figcaption>Figure 1: Side-by-side upgrade of MySQL cluster.</figcaption></figure></div>


<hr aria-hidden="true" role="separator"/>



<p>To address these challenges, we developed a system designed to completely automate the transition of a MySQL cluster from v5.7 to v8.0. Our automated alerts and monitoring system actively oversees the process to ensure a seamless transition and promptly alerts of any issues that may arise.</p>



<div><ol>
<li><strong>Node Replication:</strong> For each MySQL v5.7 node in the cluster, a corresponding MySQL v8.0 replica node is added in the same region/zone, maintaining the distribution consistency between v5.7 and v8.0 nodes.</li>



<li><strong>Soak Period:</strong> A monitoring period of approximately one week allows us to observe the system’s performance and detect any degradation or SLA breaches caused by the newer version nodes.</li>



<li><strong>Traffic Diversion:</strong> Once the soak period concludes, MySQL v5.7 replica nodes are disabled to divert traffic away from them.</li>



<li><strong>Primary Node Promotion:</strong> A MySQL v8.0 node is promoted to primary status for the cluster.</li>



<li><strong>Removal of Old Nodes:</strong> Finally, all MySQL v5.7 nodes are removed, completing the upgrade to MySQL v8.0.</li>
</ol></div>



<p>The above process will be broken into <strong>4</strong><strong> Stages</strong>:</p>



<p><strong>Pre-Maintenance:</strong> During this stage, the cluster is prepared for upgrade by adding MySQL v8.0 nodes as replicas, which operate alongside existing v5.7 nodes to serve real production traffic.</p>



<hr aria-hidden="true" role="separator"/>


<div>
<figure data-wp-block-name="core/image" data-wp-block="{&#34;align&#34;:&#34;center&#34;,&#34;hash&#34;:&#34;eecdf69d-f52a-4be4-bc98-e8b3f732b8ea&#34;,&#34;alt&#34;:&#34;&#34;}"><img alt="Image" src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXfXQGfGyf0Jm0cvg16o7CUl1x-mBjvtbi6AemObjFyEUuWgINVVtCjXWIIUZudZeziyB04Zkqg8U1rcLKDxWq0zJRTxj0nAyWU2YY0Dp_bcUvwX5VeLSKl-xOl8az7UHCMkwYBbxzzfD9TtBL69Dme-R6I?key=t0GcRSII3lNuPS3m8oPG7g" loading="lazy"/><figcaption>Figure 2: Pre Maintenance Stage.</figcaption></figure></div>


<hr aria-hidden="true" role="separator"/>



<p><strong>System Monitoring:</strong> Newly added MySQL v8.0 nodes serve as replicas, allowing for real production traffic to be monitored. Any deviations from expected behavior are noted and addressed.<br/></p>



<p><strong>Maintenance:</strong> Once the system monitoring stage is successfully completed, a MySQL v8.0 node is promoted to primary status, and system stability is monitored.</p>



<hr aria-hidden="true" role="separator"/>


<div>
<figure data-wp-block-name="core/image" data-wp-block="{&#34;align&#34;:&#34;center&#34;,&#34;hash&#34;:&#34;e169bbe5-827b-4bba-81ce-1c08c26aa2ad&#34;,&#34;alt&#34;:&#34;&#34;}"><img alt="Image" src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXfab4oapkF9tbiXzKmqg7cyQeArU7oAfiA-R0PzqDixAil7Nd9PHYEh5jvjoPMEJ8GPy0bttCqFktr7de6TyFQBVSzYwU6z-DRrrQKiusdETIhdHW34ktae59msa5BR2ojPGivYPcjLXNtOPr72eI1gtnA2?key=t0GcRSII3lNuPS3m8oPG7g" loading="lazy"/><figcaption>Figure 3: Maintenance Stage.</figcaption></figure></div>


<hr aria-hidden="true" role="separator"/>



<p><strong>Post-Maintenance:</strong> In the final stage, non-replicating MySQL v5.7 nodes are deleted, resulting in a pure MySQL v8.0 cluster.</p>



<hr aria-hidden="true" role="separator"/>


<div>
<figure data-wp-block-name="core/image" data-wp-block="{&#34;width&#34;:&#34;700px&#34;,&#34;height&#34;:&#34;auto&#34;,&#34;align&#34;:&#34;center&#34;,&#34;hash&#34;:&#34;8651255e-e7cb-41de-ab05-90e8f9ecd71e&#34;,&#34;alt&#34;:&#34;&#34;}"><img alt="Image" src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXfhWi7L4bW3mXRuWkdlDba-7AWqAv5RBGXMYCD6t2OcQKtypKwJ86xX0RlD_iT8Fvq-PvANhyarq7QqWtVdBrWdIVcE7jK3yKyMNGayOuWbDJEZCLGqavgd-8W2aLEpAgdT6UtyZ2Uz9Kvow90oTqUP71k?key=t0GcRSII3lNuPS3m8oPG7g" loading="lazy"/><figcaption>Figure 4: Post Maintenance Stage.</figcaption></figure></div>


<hr aria-hidden="true" role="separator"/>



<p><h2 id="h-rollback">Rollback</h2></p>



<p>While there was a gradual rollout strategy, we still needed the ability to rollback at every step and we needed the observability to identify signals to indicate when a rollback was needed. We prioritized minimizing risks and ensuring data integrity throughout the upgrade process. Until the Maintenance Step, all actions are fully reversible without any risk of data loss. Should our customers encounter service degradation due to factors like high latency or CPU usage, we can seamlessly and instantly revert to MySQL v5.7 with absolutely no data loss. This means that by simply deleting or disabling the MySQL v8.0 replica nodes introduced during the pre-maintenance stage, we can swiftly return to the previous state.</p>



<hr aria-hidden="true" role="separator"/>



<p><h2 id="h-stakeholder-communication">Stakeholder Communication</h2></p>



<p>We systematically advanced through each tier, commencing from tier 5 and descending to tier 0. At every tier, we organized the clusters into manageable batches, ensuring a systematic and controlled transition process. Before embarking on each stage of the version upgrade, we actively involved the on-call teams responsible for each cluster, fostering collaboration and ensuring comprehensive oversight.</p>



<p>This deliberate and structured methodology allowed us to effectively navigate the complexities inherent in upgrading our MySQL fleet. By prioritizing coordination, communication, and teamwork, we successfully traversed through each tier, seamlessly transitioning to MySQL version 8.0.</p>



<hr aria-hidden="true" role="separator"/>



<p><h2 id="h-issues-experienced">Issues Experienced</h2></p>



<p><h3 id="h-change-of-query-execution-plan-in-v8-0-vs-5-7">Change of Query Execution Plan in v8.0 vs. 5.7</h3></p>



<p>Upgrading to MySQL 8.0 brought not only new features, but also some unexpected tweaks in query execution plans for certain clusters. This resulted in increased latencies and resource consumption, potentially impacting user experience. This happened for the cluster which powers all the dashboards running at Uber. To address this issue, we collaborated with Percona, identified a patch fix, and successfully implemented it for the affected clusters. The resolution ensured the restoration of optimized query performance and resource efficiency in alignment with the upgraded MySQL version.</p>



<p><h3 id="h-unsupported-queries-amp-configurations">Unsupported Queries &amp; Configurations</h3></p>



<p>The transition from MySQL version 5.7 to version 8.0 introduced syntax changes for certain keywords, disrupting some queries in production. Additionally, a notable portion of our existing clusters did not have the “STRICT_TRANS_TABLES” SQL mode enabled, which is a default setting in MySQL 8.0. This absence resulted in errors for many customers during the upgrade procedure. Similarly, challenges emerged with the “ONLY_FULL_GROUP_BY” SQL mode, underscoring the necessity for meticulous configuration modifications to ensure compatibility with the specifications of the upgraded version. </p>



<p><h3 id="h-previous-default-collation">Previous Default Collation</h3></p>



<p>In MySQL 8.0, the default character set is <em>utf8mb4</em>, accompanied by the <em>utf8mb4_0900_ai_ci</em> collation. In contrast, the preceding MySQL 5.7 version employed the <em>utf8mb4_unicode_520_ci</em> collation, lacking support for the latest <em>utf8mb4_0900_ai_ci</em>. This transition introduced challenges in aligning collation settings across the upgraded system.</p>



<p><h3 id="h-client-library-incompatibility">Client Library Incompatibility</h3></p>



<p><strong>Library Upgrade Requirement:</strong> Many existing client libraries were incompatible with MySQL v8.0. To address this, we had to upgrade these libraries, conduct thorough testing to ensure their proper functionality in a staging environment, and subsequently proceed with the primary upgrade. This step was crucial to guarantee a seamless transition without compromising client interactions.</p>



<hr aria-hidden="true" role="separator"/>



<p><h2 id="h-improvements">Improvements</h2></p>



<p>With the new version, we can harness the following performance improvements: </p>



<p><h3 id="h-server-side-performance-improvements-for-mysql-v8-0">Server-side Performance Improvements for MySQL v8.0</h3></p>



<p>29% improvement in p99 latency for 1 million inserts at 1024 threads.</p>


<div>
<figure data-wp-block-name="core/image" data-wp-block="{&#34;id&#34;:1093800,&#34;sizeSlug&#34;:&#34;full&#34;,&#34;linkDestination&#34;:&#34;none&#34;,&#34;align&#34;:&#34;center&#34;,&#34;hash&#34;:&#34;bb293eff-27fc-48ad-90d3-e04fa093d2ce&#34;,&#34;alt&#34;:&#34;&#34;}"><img alt="Image" src="https://blog.uber-cdn.com/cdn-cgi/image/width=2160,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure5.png" srcset="https://blog.uber-cdn.com/cdn-cgi/image/width=771,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure5.png 771w, https://blog.uber-cdn.com/cdn-cgi/image/width=300,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure5.png 300w, https://blog.uber-cdn.com/cdn-cgi/image/width=768,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure5.png 768w" sizes="(max-width: 771px) 100vw, 771px" loading="lazy" width="771" height="497"/><figcaption>Figure 5: MySQL v5.7 v/s 8.0 at 1M inserts 1024 Threads.</figcaption></figure></div>


<hr aria-hidden="true" role="separator"/>



<p>33% improvement in p99 latency for 1 million reads at 1024 threads.</p>


<div>
<figure data-wp-block-name="core/image" data-wp-block="{&#34;id&#34;:1093801,&#34;width&#34;:&#34;700px&#34;,&#34;height&#34;:&#34;auto&#34;,&#34;sizeSlug&#34;:&#34;full&#34;,&#34;linkDestination&#34;:&#34;none&#34;,&#34;align&#34;:&#34;center&#34;,&#34;hash&#34;:&#34;8968bca1-2493-4f2b-8c79-f370d7577d88&#34;,&#34;alt&#34;:&#34;&#34;}"><img alt="Image" src="https://blog.uber-cdn.com/cdn-cgi/image/width=2160,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure6.png" srcset="https://blog.uber-cdn.com/cdn-cgi/image/width=805,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure6.png 805w, https://blog.uber-cdn.com/cdn-cgi/image/width=300,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure6.png 300w, https://blog.uber-cdn.com/cdn-cgi/image/width=768,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure6.png 768w" sizes="(max-width: 805px) 100vw, 805px" loading="lazy" width="805" height="477"/><figcaption>Figure 6: MySQL v5.7 v/s 8.0 at 1M Reads 1024 Threads.</figcaption></figure></div>


<hr aria-hidden="true" role="separator"/>



<p>47% improvement in p99 latency for 1 million updates at 1024 threads.<br/></p>


<div>
<figure data-wp-block-name="core/image" data-wp-block="{&#34;id&#34;:1093802,&#34;sizeSlug&#34;:&#34;full&#34;,&#34;linkDestination&#34;:&#34;none&#34;,&#34;align&#34;:&#34;center&#34;,&#34;hash&#34;:&#34;e1445c23-edba-4e0d-bd18-4a0ab796c7d9&#34;,&#34;alt&#34;:&#34;&#34;}"><img alt="Image" src="https://blog.uber-cdn.com/cdn-cgi/image/width=2160,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure7.png" srcset="https://blog.uber-cdn.com/cdn-cgi/image/width=763,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure7.png 763w, https://blog.uber-cdn.com/cdn-cgi/image/width=300,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure7.png 300w" sizes="(max-width: 763px) 100vw, 763px" loading="lazy" width="763" height="406"/><figcaption>Figure 7: MySQL v5.7 v/s 8.0 at 1M Updates 1024 Threads.</figcaption></figure></div>


<hr aria-hidden="true" role="separator"/>



<p><h3 id="h-client-side-improvements-due-to-mysql-upgrade">Client-side Improvements due to MySQL Upgrade</h3></p>



<p>~94% reduction in overall database lock time.</p>


<div>
<figure data-wp-block-name="core/image" data-wp-block="{&#34;id&#34;:1093803,&#34;sizeSlug&#34;:&#34;large&#34;,&#34;linkDestination&#34;:&#34;none&#34;,&#34;align&#34;:&#34;center&#34;,&#34;hash&#34;:&#34;05a3a43d-e0e4-468d-a938-04b62ca7900e&#34;,&#34;alt&#34;:&#34;&#34;}"><img alt="Image" src="https://blog.uber-cdn.com/cdn-cgi/image/width=2160,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure8-1024x533.png" srcset="https://blog.uber-cdn.com/cdn-cgi/image/width=1024,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure8.png 1024w, https://blog.uber-cdn.com/cdn-cgi/image/width=300,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure8.png 300w, https://blog.uber-cdn.com/cdn-cgi/image/width=768,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure8.png 768w, https://blog.uber-cdn.com/cdn-cgi/image/width=1536,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure8.png 1536w, https://blog.uber-cdn.com/cdn-cgi/image/width=2048,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Figure8.png 2048w" sizes="(max-width: 1024px) 100vw, 1024px" loading="lazy" width="1024" height="533"/><figcaption>Figure 8: Reduced locktime post upgrade.</figcaption></figure></div>


<hr aria-hidden="true" role="separator"/>



<p>~78% reduction in query time for some queries.</p>


<div>
<figure data-wp-block-name="core/image" data-wp-block="{&#34;id&#34;:1093804,&#34;sizeSlug&#34;:&#34;large&#34;,&#34;linkDestination&#34;:&#34;none&#34;,&#34;align&#34;:&#34;center&#34;,&#34;hash&#34;:&#34;21989855-e431-47a9-a9b1-703890102ce8&#34;,&#34;alt&#34;:&#34;&#34;}"><img alt="Image" src="https://blog.uber-cdn.com/cdn-cgi/image/width=2160,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Screenshot-2024-08-07-at-11.26.13-1024x576.png" srcset="https://blog.uber-cdn.com/cdn-cgi/image/width=1024,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Screenshot-2024-08-07-at-11.26.13.png 1024w, https://blog.uber-cdn.com/cdn-cgi/image/width=300,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Screenshot-2024-08-07-at-11.26.13.png 300w, https://blog.uber-cdn.com/cdn-cgi/image/width=768,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Screenshot-2024-08-07-at-11.26.13.png 768w, https://blog.uber-cdn.com/cdn-cgi/image/width=1536,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Screenshot-2024-08-07-at-11.26.13.png 1536w, https://blog.uber-cdn.com/cdn-cgi/image/width=2048,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Screenshot-2024-08-07-at-11.26.13.png 2048w, https://blog.uber-cdn.com/cdn-cgi/image/width=1080,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Screenshot-2024-08-07-at-11.26.13.png 1080w, https://blog.uber-cdn.com/cdn-cgi/image/width=2127,quality=80,onerror=redirect,format=auto/wp-content/uploads/2024/08/Screenshot-2024-08-07-at-11.26.13.png 2127w" sizes="(max-width: 1024px) 100vw, 1024px" loading="lazy" width="1024" height="576"/><figcaption>Figure 9: Improved query time post upgrade.</figcaption></figure></div>


<hr aria-hidden="true" role="separator"/>



<p><h2 id="h-learning-and-takeaways">Learning and Takeaways</h2></p>



<p>Throughout the comprehensive upgrade journey, which spanned over a year, our dedicated team of engineers from the MySQL Team flawlessly navigated through a series of critical stages.</p>



<p>The monumental task of transitioning our entire fleet to MySQL 8.0 encompassed not only staging clusters, but also production clusters supporting Uber and internal tool instances. This extensive upgrade underscores the indispensable role played by our observability platform, testing regimen, and robust rollback capabilities.</p>



<p>Our meticulous testing procedures and phased rollout strategy proved invaluable, allowing us to unearth and address potential issues early on. By adopting this approach, we significantly mitigated the risk of encountering new failure modes during the primary upgrade phase.</p>



<hr aria-hidden="true" role="separator"/>







<p>The journey of upgrading our MySQL fleet at Uber to version 8.0 has been challenging but rewarding. By embracing the latest technology and leveraging automation, we’ve not only ensured the security and performance of our database infrastructure, but also demonstrated our commitment to innovation and excellence.</p>



<p>The upgrade process, meticulously planned and executed by our dedicated team of engineers, underscores our unwavering dedication to maintaining the highest standards of reliability and efficiency. Through careful consideration of the benefits and challenges, we successfully navigated the transition, mitigating risks and minimizing disruptions to our services.</p>



<p>Cover Photo Attribution: “<span><a href="https://www.flickr.com/photos/43767277@N04/5059176446">North Lake CA</a></span>” by <span><a href="https://www.flickr.com/photos/pachecophotography/">Pacheco</a></span> licensed as Attribution-NoDerivs.</p>
</div></div>
  </body>
</html>
