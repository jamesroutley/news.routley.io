<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ssoready.com/blog/engineering/a-gentle-intro-to-saml/">Original</a>
    <h1>A Gentle Introduction to SAML</h1>
    
    <div id="readability-page-1" class="page"><p>
            The SAML spec is an absolute beast. We&#39;ve each read it multiple times. Here&#39;s a simpler explanation.
        </p><div>
            <p>I recently attended an open-source event in San Francisco. Introducing myself to random strangers – as one does at such events – I soon met a true hacker, a dyed-in-the-wool computer fanatic, the kind of person who’d have worked as a software engineer before it was cool. We chatted for a bit about random projects.</p>
<p>Upon discovering that my company works on SAML single sign-on, this person’s eyes lit up. <em>Oh, oh no, you’re in SAML hell</em>, they exclaimed, obviously recalling some technical side quest gone awry. <em>I’m so sorry,</em> they continued, laughing. <em>I don’t ever want to touch SAML again.</em></p>
<p>This is a common experience for me. Most developers know basically nothing about SAML at all. On rare occasions, I’ll meet someone like my acquaintance from the meetup, someone who knows a little bit about SAML … and actively avoids it.</p>
<p>And honestly, I think that’s reasonable. SAML occupies an arcane little corner of the B2B internet, and there’s not a lot of coherent information out there. Guides seem either to bury the reader in obscure technical details or vomit AI-generated SEO spam with virtually no useful detail.</p>
<p>I’ve written this post for curious developers who want a foundational understanding of SAML without wading too deeply into the details.</p>
<p>I don’t intend this post as a comprehensive explanation. I’ll elide some important facts and even get things technically incorrect in the hopes of illustrating ideas. I’d analogize the approach to introductory mechanics courses: <em>imagine the object as a sphere and ignore air resistance</em>.</p>
<p>Moreover, I welcome critique and correction here. Reach out at <a href="mailto:ned.oleary@ssoready.com">ned.oleary@ssoready.com</a> with any comments. (Thank you to those of you who helpfully flagged some typos for me! Markdown doesn’t have spellcheck.)</p>

<p>SAML (or Security Assertion Markup Language), defines a flexible set of rules for exchanging security-related messages in XML.</p>
<p>We typically use SAML to exchange messages in settings that involve three or more independent-ish entities. A very common scenario involves two software systems – made by two different companies – and a user. The two software systems need to exchange information about the user. One system might query the other: <em>what’s this user’s email address?</em> The other might respond: <em>this user’s email address is <a href="mailto:edwardkoleary@gmail.com">edwardkoleary@gmail.com</a></em>.</p>
<p>The two software companies could collaborate on a bespoke integration. But doing so can get really unwieldy. Imagine what happens if you need to build and maintain a lot of bespoke integrations that follow their own rules; it’s kind of a nightmare.</p>
<p>SAML erects scaffolding around the kinds of messages that systems can pass to one another.  It exists to help us all follow the same rules, speak the same language. By following standardized SAML rules, we don’t have to invent new, convoluted rules.</p>
<p>So even though SAML can feel really complicated, remember that things could be worse!</p>

<p>Here’s an example of a SAML message. Let’s not worry about the details.</p>
<p>All SAML basically looks like this. We’re just moving XML messages around.</p>
<p>SAML defines a syntax for our message and tells us how we can safely process other SAML messages’ contents.</p>
<p>If we receive a <code>&lt;Response&gt;</code>, we know a few things about how it’ll look. We know to look for an <code>&lt;Assertion&gt;</code> within the <code>&lt;Response&gt;</code>. We know how to interpret the <code>&lt;AuthnContext&gt;</code> data within an <code>&lt;Assertion&gt;</code>. We can anticipate what the digital signature will look like. We have guidelines on how to process the message in order to avoid security lapses.</p>
<div><pre tabindex="0"><code data-lang="xml"><span><span><span>&lt;Response</span> <span>IssueInstant=</span><span>&#34;2003-04-17T00:46:02Z&#34;</span> <span>Version=</span><span>&#34;2.0&#34;</span> <span>ID=</span><span>&#34;_c7055387-af61-4fce-8b98-e2927324b306&#34;</span> <span>xmlns=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:protocol&#34;</span> <span>xmlns:saml=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:assertion&#34;</span><span>&gt;</span>
</span></span><span><span>    <span>&lt;saml:Issuer&gt;</span>https://www.opensaml.org/IDP&#34;<span>&lt;/saml:Issuer&gt;</span>
</span></span><span><span>    <span>&lt;ds:Signature</span> <span>xmlns:ds=</span><span>&#34;http://www.w3.org/2000/09/xmldsig#&#34;</span><span>&gt;</span>
</span></span><span><span>        <span>&lt;ds:SignedInfo&gt;</span>
</span></span><span><span>            <span>&lt;ds:CanonicalizationMethod</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span>/&gt;</span>
</span></span><span><span>            <span>&lt;ds:SignatureMethod</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2000/09/xmldsig#rsa-sha1&#34;</span><span>/&gt;</span>
</span></span><span><span>            <span>&lt;ds:Reference</span> <span>URI=</span><span>&#34;#_c7055387-af61-4fce-8b98-e2927324b306&#34;</span><span>&gt;</span>
</span></span><span><span>                <span>&lt;ds:Transforms&gt;</span>
</span></span><span><span>                    <span>&lt;ds:Transform</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2000/09/xmldsig#enveloped-signature&#34;</span><span>/&gt;</span>
</span></span><span><span>                    <span>&lt;ds:Transform</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span>&gt;</span>
</span></span><span><span>                        <span>&lt;InclusiveNamespaces</span> <span>PrefixList=</span><span>&#34;#default saml ds xs xsi&#34;</span> <span>xmlns=</span><span>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span>/&gt;</span>
</span></span><span><span>                    <span>&lt;/ds:Transform&gt;</span>
</span></span><span><span>                <span>&lt;/ds:Transforms&gt;</span>
</span></span><span><span>                <span>&lt;ds:DigestMethod</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2000/09/xmldsig#sha1&#34;</span><span>/&gt;</span>
</span></span><span><span>                <span>&lt;ds:DigestValue&gt;</span>TCDVSuG6grhyHbzhQFWFzGrxIPE=<span>&lt;/ds:DigestValue&gt;</span>
</span></span><span><span>            <span>&lt;/ds:Reference&gt;</span>
</span></span><span><span>        <span>&lt;/ds:SignedInfo&gt;</span>
</span></span><span><span>        <span>&lt;ds:SignatureValue&gt;</span>
</span></span><span><span>            x/GyPbzmFEe85pGD3c1aXG4Vspb9V9jGCjwcRCKrtwPS6vdVNCcY5rHaFPYWkf+5
</span></span><span><span>            EIYcPzx+pX1h43SmwviCqXRjRtMANWbHLhWAptaK1ywS7gFgsD01qjyen3CP+m3D
</span></span><span><span>            w6vKhaqledl0BYyrIzb4KkHO4ahNyBVXbJwqv5pUaE4=
</span></span><span><span>        <span>&lt;/ds:SignatureValue&gt;</span>
</span></span><span><span>        <span>&lt;ds:KeyInfo&gt;</span>
</span></span><span><span>            <span>&lt;ds:X509Data&gt;</span>
</span></span><span><span>                <span>&lt;ds:X509Certificate&gt;</span>
</span></span><span><span>                    MIICyjCCAjOgAwIBAgICAnUwDQYJKoZIhvcNAQEEBQAwgakxCzAJBgNVBAYTAlVT
</span></span><span><span>                    MRIwEAYDVQQIEwlXaXNjb25zaW4xEDAOBgNVBAcTB01hZGlzb24xIDAeBgNVBAoT
</span></span><span><span>                    F1VuaXZlcnNpdHkgb2YgV2lzY29uc2luMSswKQYDVQQLEyJEaXZpc2lvbiBvZiBJ
</span></span><span><span>                    bmZvcm1hdGlvbiBUZWNobm9sb2d5MSUwIwYDVQQDExxIRVBLSSBTZXJ2ZXIgQ0Eg
</span></span><span><span>                    LS0gMjAwMjA3MDFBMB4XDTAyMDcyNjA3Mjc1MVoXDTA2MDkwNDA3Mjc1MVowgYsx
</span></span><span><span>                    CzAJBgNVBAYTAlVTMREwDwYDVQQIEwhNaWNoaWdhbjESMBAGA1UEBxMJQW5uIEFy
</span></span><span><span>                    Ym9yMQ4wDAYDVQQKEwVVQ0FJRDEcMBoGA1UEAxMTc2hpYjEuaW50ZXJuZXQyLmVk
</span></span><span><span>                    dTEnMCUGCSqGSIb3DQEJARYYcm9vdEBzaGliMS5pbnRlcm5ldDIuZWR1MIGfMA0G
</span></span><span><span>                    CSqGSIb3DQEBAQUAA4GNADCBiQKBgQDZSAb2sxvhAXnXVIVTx8vuRay+x50z7GJj
</span></span><span><span>                    IHRYQgIv6IqaGG04eTcyVMhoekE0b45QgvBIaOAPSZBl13R6+KYiE7x4XAWIrCP+
</span></span><span><span>                    c2MZVeXeTgV3Yz+USLg2Y1on+Jh4HxwkPFmZBctyXiUr6DxF8rvoP9W7O27rhRjE
</span></span><span><span>                    pmqOIfGTWQIDAQABox0wGzAMBgNVHRMBAf8EAjAAMAsGA1UdDwQEAwIFoDANBgkq
</span></span><span><span>                    hkiG9w0BAQQFAAOBgQBfDqEW+OI3jqBQHIBzhujN/PizdN7s/z4D5d3pptWDJf2n
</span></span><span><span>                    qgi7lFV6MDkhmTvTqBtjmNk3No7v/dnP6Hr7wHxvCCRwubnmIfZ6QZAv2FU78pLX
</span></span><span><span>                    8I3bsbmRAUg4UP9hH6ABVq4KQKMknxu1xQxLhpR1ylGPdiowMNTrEG8cCx3w/w==
</span></span><span><span>                <span>&lt;/ds:X509Certificate&gt;</span>
</span></span><span><span>            <span>&lt;/ds:X509Data&gt;</span>
</span></span><span><span>        <span>&lt;/ds:KeyInfo&gt;</span>
</span></span><span><span>    <span>&lt;/ds:Signature&gt;</span>
</span></span><span><span>    <span>&lt;Status&gt;</span>
</span></span><span><span>        <span>&lt;StatusCode</span> <span>Value=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:status:Success&#34;</span><span>/&gt;</span>
</span></span><span><span>    <span>&lt;/Status&gt;</span>
</span></span><span><span>    <span>&lt;Assertion</span> <span>ID=</span><span>&#34;_a75adf55-01d7-40cc-929f-dbd8372ebdfc&#34;</span> <span>IssueInstant=</span><span>&#34;2003-04-17T00:46:02Z&#34;</span> <span>Version=</span><span>&#34;2.0&#34;</span> <span>xmlns=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:assertion&#34;</span><span>&gt;</span>
</span></span><span><span>        <span>&lt;Issuer&gt;</span>https://www.opensaml.org/IDP<span>&lt;/Issuer&gt;</span>
</span></span><span><span>        <span>&lt;ds:Signature</span> <span>xmlns:ds=</span><span>&#34;http://www.w3.org/2000/09/xmldsig#&#34;</span><span>&gt;</span>
</span></span><span><span>            <span>&lt;ds:SignedInfo&gt;</span>
</span></span><span><span>                <span>&lt;ds:CanonicalizationMethod</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span>/&gt;</span>
</span></span><span><span>                <span>&lt;ds:SignatureMethod</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2000/09/xmldsig#rsa-sha1&#34;</span><span>/&gt;</span>
</span></span><span><span>                <span>&lt;ds:Reference</span> <span>URI=</span><span>&#34;#_a75adf55-01d7-40cc-929f-dbd8372ebdfc&#34;</span><span>&gt;</span>
</span></span><span><span>                    <span>&lt;ds:Transforms&gt;</span>
</span></span><span><span>                        <span>&lt;ds:Transform</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2000/09/xmldsig#enveloped-signature&#34;</span><span>/&gt;</span>
</span></span><span><span>                        <span>&lt;ds:Transform</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span>&gt;</span>
</span></span><span><span>                            <span>&lt;InclusiveNamespaces</span> <span>PrefixList=</span><span>&#34;#default saml ds xs xsi&#34;</span> <span>xmlns=</span><span>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span>/&gt;</span>
</span></span><span><span>                        <span>&lt;/ds:Transform&gt;</span>
</span></span><span><span>                    <span>&lt;/ds:Transforms&gt;</span>
</span></span><span><span>                    <span>&lt;ds:DigestMethod</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2000/09/xmldsig#sha1&#34;</span><span>/&gt;</span>
</span></span><span><span>                    <span>&lt;ds:DigestValue&gt;</span>Kclet6XcaOgOWXM4gty6/UNdviI=<span>&lt;/ds:DigestValue&gt;</span>
</span></span><span><span>                <span>&lt;/ds:Reference&gt;</span>
</span></span><span><span>            <span>&lt;/ds:SignedInfo&gt;</span>
</span></span><span><span>            <span>&lt;ds:SignatureValue&gt;</span>
</span></span><span><span>                hq4zk+ZknjggCQgZm7ea8fI79gJEsRy3E8LHDpYXWQIgZpkJN9CMLG8ENR4Nrw+n
</span></span><span><span>                7iyzixBvKXX8P53BTCT4VghPBWhFYSt9tHWu/AtJfOTh6qaAsNdeCyG86jmtp3TD
</span></span><span><span>                MwuL/cBUj2OtBZOQMFn7jQ9YB7klIz3RqVL+wNmeWI4=
</span></span><span><span>            <span>&lt;/ds:SignatureValue&gt;</span>
</span></span><span><span>            <span>&lt;ds:KeyInfo&gt;</span>
</span></span><span><span>                <span>&lt;ds:X509Data&gt;</span>
</span></span><span><span>                    <span>&lt;ds:X509Certificate&gt;</span>
</span></span><span><span>                        MIICyjCCAjOgAwIBAgICAnUwDQYJKoZIhvcNAQEEBQAwgakxCzAJBgNVBAYTAlVT
</span></span><span><span>                        MRIwEAYDVQQIEwlXaXNjb25zaW4xEDAOBgNVBAcTB01hZGlzb24xIDAeBgNVBAoT
</span></span><span><span>                        F1VuaXZlcnNpdHkgb2YgV2lzY29uc2luMSswKQYDVQQLEyJEaXZpc2lvbiBvZiBJ
</span></span><span><span>                        bmZvcm1hdGlvbiBUZWNobm9sb2d5MSUwIwYDVQQDExxIRVBLSSBTZXJ2ZXIgQ0Eg
</span></span><span><span>                        LS0gMjAwMjA3MDFBMB4XDTAyMDcyNjA3Mjc1MVoXDTA2MDkwNDA3Mjc1MVowgYsx
</span></span><span><span>                        CzAJBgNVBAYTAlVTMREwDwYDVQQIEwhNaWNoaWdhbjESMBAGA1UEBxMJQW5uIEFy
</span></span><span><span>                        Ym9yMQ4wDAYDVQQKEwVVQ0FJRDEcMBoGA1UEAxMTc2hpYjEuaW50ZXJuZXQyLmVk
</span></span><span><span>                        dTEnMCUGCSqGSIb3DQEJARYYcm9vdEBzaGliMS5pbnRlcm5ldDIuZWR1MIGfMA0G
</span></span><span><span>                        CSqGSIb3DQEBAQUAA4GNADCBiQKBgQDZSAb2sxvhAXnXVIVTx8vuRay+x50z7GJj
</span></span><span><span>                        IHRYQgIv6IqaGG04eTcyVMhoekE0b45QgvBIaOAPSZBl13R6+KYiE7x4XAWIrCP+
</span></span><span><span>                        c2MZVeXeTgV3Yz+USLg2Y1on+Jh4HxwkPFmZBctyXiUr6DxF8rvoP9W7O27rhRjE
</span></span><span><span>                        pmqOIfGTWQIDAQABox0wGzAMBgNVHRMBAf8EAjAAMAsGA1UdDwQEAwIFoDANBgkq
</span></span><span><span>                        hkiG9w0BAQQFAAOBgQBfDqEW+OI3jqBQHIBzhujN/PizdN7s/z4D5d3pptWDJf2n
</span></span><span><span>                        qgi7lFV6MDkhmTvTqBtjmNk3No7v/dnP6Hr7wHxvCCRwubnmIfZ6QZAv2FU78pLX
</span></span><span><span>                        8I3bsbmRAUg4UP9hH6ABVq4KQKMknxu1xQxLhpR1ylGPdiowMNTrEG8cCx3w/w==
</span></span><span><span>                    <span>&lt;/ds:X509Certificate&gt;</span>
</span></span><span><span>                <span>&lt;/ds:X509Data&gt;</span>
</span></span><span><span>            <span>&lt;/ds:KeyInfo&gt;</span>
</span></span><span><span>        <span>&lt;/ds:Signature&gt;</span>
</span></span><span><span>        <span>&lt;Subject&gt;</span>
</span></span><span><span>            <span>&lt;NameID</span> <span>Format=</span><span>&#34;urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress&#34;</span><span>&gt;</span>
</span></span><span><span>                scott@example.org
</span></span><span><span>            <span>&lt;/NameID&gt;</span>
</span></span><span><span>            <span>&lt;SubjectConfirmation</span> <span>Method=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:cm:bearer&#34;</span><span>/&gt;</span>
</span></span><span><span>        <span>&lt;/Subject&gt;</span>
</span></span><span><span>        <span>&lt;Conditions</span> <span>NotBefore=</span><span>&#34;2003-04-17T00:46:02Z&#34;</span> <span>NotOnOrAfter=</span><span>&#34;2003-04-17T00:51:02Z&#34;</span><span>&gt;</span>
</span></span><span><span>            <span>&lt;AudienceRestriction&gt;</span>
</span></span><span><span>                <span>&lt;Audience&gt;</span>http://www.opensaml.org/SP<span>&lt;/Audience&gt;</span>
</span></span><span><span>            <span>&lt;/AudienceRestriction&gt;</span>
</span></span><span><span>        <span>&lt;/Conditions&gt;</span>
</span></span><span><span>        <span>&lt;AuthnStatement</span> <span>AuthnInstant=</span><span>&#34;2003-04-17T00:46:00Z&#34;</span><span>&gt;</span>
</span></span><span><span>            <span>&lt;AuthnContext&gt;</span>
</span></span><span><span>                <span>&lt;AuthnContextClassRef&gt;</span>
</span></span><span><span>                    urn:oasis:names:tc:SAML:2.0:ac:classes:Password
</span></span><span><span>                <span>&lt;/AuthnContextClassRef&gt;</span>
</span></span><span><span>            <span>&lt;/AuthnContext&gt;</span>
</span></span><span><span>        <span>&lt;/AuthnStatement&gt;</span>
</span></span><span><span>    <span>&lt;/Assertion&gt;</span>
</span></span><span><span><span>&lt;/Response&gt;</span>
</span></span></code></pre></div><p>Kind of gnarly.</p>

<p>SAML’s design emphasizes flexibility; at least in principle, you can do an awful lot of different stuff with SAML. Unfortunately, that flexibility results in complexity.</p>
<p>If you read the SAML specification front to back, you will stumble across countless asides. Here’s one that’s not even that bad (don’t worry about what it actually means):</p>
<blockquote>
<p>If it chooses to proxy to a SAML identity provider, when creating the new <code>&lt;AuthnRequest&gt;</code>, the proxying identity provider MUST include equivalent or stricter forms of all the information included in the original request (such as authentication context policy). Note, however, that the proxying provider is free to specify whatever <code>&lt;NameIDPolicy&gt;</code> it wishes to maximize the chances of a successful response.</p>
</blockquote>
<blockquote>
<p>If the authenticating identity provider is not a SAML identity provider, then the proxying provider MUST have some other way to ensure that the elements governing user agent interaction (<code>&lt;IsPassive&gt;</code>, for example) will be honored by the authenticating provider.</p>
</blockquote>
<p>There’s a lot of <em>if</em>s and <em>for example</em>s here – every one of which adds at least one edge case. We’re talking about hundreds of pages of this stuff.</p>
<p>Now, SAML’s been around for a while, so some people capitalize on its flexibility. In the wild, especially in legacy systems, you will occasionally encounter SAML doing unusual things.</p>
<p>Nearly all of us can make our lives easier. We’ll ignore most of SAML and focus only on the tiny subset that people typically use.</p>

<p>We most commonly use SAML for single sign-on (hereafter abbreviated as SSO). For what it’s worth, SAML actually defines a few weird flavors of SSO, but we generally use the simplest of these, the Web Browser SSO Profile (see 4.1 <a href="https://groups.oasis-open.org/higherlogic/ws/public/document?document_id=35389">here</a> for details). We won’t concern ourselves with the more complicated stuff.</p>
<p>Under the Web Browser SSO Profile, end users will access any number of software applications by authenticating first into one centralized system, which then communicates users’ authentication status to the desired software applications. Users don’t authenticate directly with the applications themselves.</p>
<p><img src="https://ssoready.com/blog/engineering/a-gentle-intro-to-saml/saml-sso-concept.png" alt=""/></p>
<p>If you have ever used a service like Okta to access your email, you’ve likely used the Web Browser SSO Profile.</p>

<p>For simplicity, let’s imagine you make application software, and your users want to sign in via SAML SSO. You have to figure out how to support SAML SSO in your software.</p>
<p>We care about three entities in SSO:</p>
<ol>
<li>A user: someone that wants to use your application</li>
<li>A service provider (SP): your application</li>
<li>An identity provider (IDP): the centralized service your user will use to authenticate</li>
</ol>
<p>We can imagine each customer’s IDP as a database. It keeps track of data about people and their credentials, e.g. hashed passwords, email addresses, names, departments, etc. Companies often use identity providers to assign employees to different departments and assign them different privileges; for instance, the Accounting department will have access to the general ledger, but they won’t have access to AWS.</p>
<p>Every time we want a user to sign in via SAML, we’ll have to get information from their IDP; in SSO, we’re mostly just asking the IDP to confirm the user’s identity.</p>
<p>In order to do so, we will always need a pre-configured trust relationship with the IDP. Every customer that uses SAML SSO will require its own set-up in your application. It doesn’t matter which IDP your customers use – if you have 10 Okta customers, you will need to set up 10 different trust relationships.</p>
<p>Although you will need to establish trust relationships with the IDP, you won’t actually pass messages to/from the IDP directly. In SAML SSO, the service provider and the identity provider communicate via the user’s browser.</p>

<p>Here’s a typical SAML SSO process:</p>
<ol>
<li>A user attempts to access part of your application in their web browser.</li>
<li>You check whether the user has a valid security context.</li>
<li>The user doesn’t have a valid security context, so you present a login page.</li>
<li>The user fills in some information (e.g. an email address), which you use to determine the appropriate login method. You have pre-set records that tell you (1) that the user requires SAML SSO for authentication and (2) which IDP the user needs to use.</li>
<li>You redirect the user to the IDP’s web address, passing a SAML message to the IDP via the user’s browser.</li>
<li>The IDP prompts your user for credentials. The user successfully authenticates.</li>
<li>The IDP redirects the user back to your application along with a SAML message communicating information about the user’s authentication.</li>
<li>You process the SAML message and determine that you should, in fact, establish a security context for the user.</li>
<li>You grant the user access to the desired part of your application.</li>
</ol>
<p>A successful login process basically looks like this:</p>
<p><img src="https://ssoready.com/blog/engineering/a-gentle-intro-to-saml/saml-sso-flow.png" alt=""/></p>
<p>Note that it’s also possible for the user to initiate a SAML SSO process from the identity provider. When this happens, mostly everything works the same way, except the service provider receives an authentication response without having sent an authentication request. If you are implementing SAML SSO support, <strong>make sure</strong> you’re prepared for IDP-initiated SSO.</p>

<p>You may have noticed that we basically have two messages of interest in SAML SSO: a message from the service provider to the IDP; and then the corresponding message back from the IDP to the service provider.</p>
<p>We call this first message – from the service provider to the IDP – a SAML <em>request</em>. We call the other message – from the IDP to the service provider – a SAML <em>response</em>.</p>
<p>SAML requests aren’t too complicated in practice. We can do a bunch of stuff with them, but it’s often fine simply to send the following XML via HTTP redirect:</p>
<div><pre tabindex="0"><code data-lang="xml"><span><span><span>&lt;AuthnRequest</span> <span>xmlns=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:protocol&#34;</span> <span>ID=</span><span>&#34;saml_flow_1bkwa10x7lhmh1zvrnhnj76r3&#34;</span> <span>Version=</span><span>&#34;2.0&#34;</span> <span>IssueInstant=</span><span>&#34;2024-05-28T19:18:54.805967185Z&#34;</span><span>&gt;</span>
</span></span><span><span>    <span>&lt;Issuer</span> <span>xmlns=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:assertion&#34;</span><span>&gt;</span>
</span></span><span><span>        https://auth.ssoready.com/v1/saml/saml_conn_8ufe2hyst7s2jdovzdvd53ldm
</span></span><span><span>    <span>&lt;/Issuer&gt;</span>
</span></span><span><span><span>&lt;/AuthnRequest&gt;</span>
</span></span></code></pre></div><p>We’re just sending a message to an IDP URL that we already know. We include an ID in the <code>&lt;AuthnRequest&gt;</code> tag; this allows the IDP to share a <code>&lt;Response&gt;</code> that we can link back to our original request. We also send the IDP some data wrapped up in an <code>&lt;Issuer&gt;</code> tag. The <code>&lt;Issuer&gt;</code> data tells the IDP who we are. When our user authenticates, the IDP will return the user back to us with a <code>&lt;Response&gt;</code>. Remember, we’re passing this data via the user’s browser, so the IDP won’t know what application the user wants access to unless we specify.</p>
<p>SAML responses are trickier. They usually look something like this, sent via a POST:</p>
<div><pre tabindex="0"><code data-lang="xml"><span><span><span>&lt;samlp:Response</span> <span>ID=</span><span>&#34;id-9c961a70-708d-497d-8d51-1f8110600838&#34;</span> <span>Version=</span><span>&#34;2.0&#34;</span> <span>IssueInstant=</span><span>&#34;2024-05-28T19:23:17.443Z&#34;</span> <span>InResponseTo=</span><span>&#34;saml_flow_1bkwa10x7lhmh1zvrnhnj76r3&#34;</span> <span>Destination=</span><span>&#34;https://auth.ssoready.com/v1/saml/saml_conn_8ufe2hyst7s2jdovzdvd53ldm/acs&#34;</span> <span>xmlns:samlp=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:protocol&#34;</span><span>&gt;</span>
</span></span><span><span>    <span>&lt;saml:Issuer</span> <span>xmlns:saml=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:assertion&#34;</span><span>&gt;</span>
</span></span><span><span>        https://auth.pingone.com/c761aef4-f636-402f-b29d-6cc84c13a436
</span></span><span><span>    <span>&lt;/saml:Issuer&gt;</span>
</span></span><span><span>    <span>&lt;ds:Signature</span> <span>xmlns:ds=</span><span>&#34;http://www.w3.org/2000/09/xmldsig#&#34;</span><span>&gt;</span>
</span></span><span><span>        <span>&lt;ds:SignedInfo&gt;</span>
</span></span><span><span>            <span>&lt;ds:CanonicalizationMethod</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span>/&gt;</span>
</span></span><span><span>            <span>&lt;ds:SignatureMethod</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2001/04/xmldsig-more#rsa-sha256&#34;</span><span>/&gt;</span>
</span></span><span><span>            <span>&lt;ds:Reference</span> <span>URI=</span><span>&#34;#id-9c961a70-708d-497d-8d51-1f8110600838&#34;</span><span>&gt;</span>
</span></span><span><span>                <span>&lt;ds:Transforms&gt;</span>
</span></span><span><span>                    <span>&lt;ds:Transform</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2000/09/xmldsig#enveloped-signature&#34;</span><span>/&gt;</span>
</span></span><span><span>                    <span>&lt;ds:Transform</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span>/&gt;</span>
</span></span><span><span>                <span>&lt;/ds:Transforms&gt;</span>
</span></span><span><span>                <span>&lt;ds:DigestMethod</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2001/04/xmlenc#sha256&#34;</span><span>/&gt;</span>
</span></span><span><span>                <span>&lt;ds:DigestValue&gt;</span>
</span></span><span><span>                    XwEljHxQiNdJYGDSvtNHQsFfQfN7+jAZ8ZJ1pwKqVuE=
</span></span><span><span>                <span>&lt;/ds:DigestValue&gt;</span>
</span></span><span><span>            <span>&lt;/ds:Reference&gt;</span>
</span></span><span><span>        <span>&lt;/ds:SignedInfo&gt;</span>
</span></span><span><span>        <span>&lt;ds:SignatureValue&gt;</span>
</span></span><span><span>            cJbmGIdlBnr1B1//P7mb5ECFK6QZjuH3eqyCinFrSsFMMORNjiT8TJRX8bsAT8lv76zPuBvMOBJSer9Ca7MDLLOQX+u43KufHVLvLarQUWo6fBJIjWsA3UHKFxCaw5h3wUnXZJ94NTqHl0d5An5RgwRcvVLOe3Bdv/hAykNrvQnMRNfbCcD6TWN7IKbl6MDk9o56vR0ubYQ1wqIN3UDcoOUruul9wQ5jtjBo//klKHDr7X+SYqY4oOExVrKNIUhj0DPh89pXKwY3IKR/3yXYas/J8aOWl/f+1bByUcL0jDx4bBc9T7OLw+w/DLMHFwlbxzO4R74WvxryfcVH6GZp7A==
</span></span><span><span>        <span>&lt;/ds:SignatureValue&gt;</span>
</span></span><span><span>        <span>&lt;ds:KeyInfo&gt;</span>
</span></span><span><span>            <span>&lt;ds:X509Data&gt;</span>
</span></span><span><span>                <span>&lt;ds:X509Certificate&gt;</span>
</span></span><span><span>                    MIIDrjCCApagAwIBAgIGAY+TeKX7MA0GCSqGSIb3DQEBCwUAMIGXMQswCQYDVQQGEwJVUzEWMBQGA1UECgwNUGluZyBJZGVudGl0eTEWMBQGA1UECwwNUGluZyBJZGVudGl0eTFYMFYGA1UEAwxPUGluZ09uZSBTU08gQ2VydGlmaWNhdGUgZm9yIFdvcmtmb3JjZSBTb2x1dGlvbiBFbnZpcm9ubWVudCA4MjBiOGQ2OSBlbnZpcm9ubWVudDAeFw0yNDA1MjAwMDQ4MjhaFw0yNTA1MjAwMDQ4MjhaMIGXMQswCQYDVQQGEwJVUzEWMBQGA1UECgwNUGluZyBJZGVudGl0eTEWMBQGA1UECwwNUGluZyBJZGVudGl0eTFYMFYGA1UEAwxPUGluZ09uZSBTU08gQ2VydGlmaWNhdGUgZm9yIFdvcmtmb3JjZSBTb2x1dGlvbiBFbnZpcm9ubWVudCA4MjBiOGQ2OSBlbnZpcm9ubWVudDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAI5Xnz5FeA+5zOMYpjLxkksCT5216B9Iq8Y4ly7dQQHMAlTkAz6ONi6itrTTe+4lVKOOexGFikFnsD2zDXEXcBzP/SVxPp4H9bObL0IBAvMZ6WhluK3d6oZDWzw/7SEmcA+T93d/ovqkxrd5+R4+yk0lmKGJOSi+mP0LYqWtjTQqmiMhdZ2mV6Y/8iNg419+5QFNAtrwIcAQA8rI4AUfyiLVZnP1qdxuvY+rkhS54OALAVv14sU2dRiDR5uEmRbjfvVZ92jOEYwmpdLUHz+tTwPWtnhB4+GkQ8bX0Nz+Hzh0GVnk+NMH5+m/A/hl+qG6ea60KaRsIzB4eMxH6GeTTWkCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAgYYlef5BTuMYkH3MKRV5huyM36WIvak1WF05mxXLq66eXjRjwFklNb2D6Cw6Hn3U/0kHtur3tfdK4o+K6+PHkYkFPS5kYuFDSIcR+WhLxq9ZkdIRg1EM5e8Z+FOAm1ogaSsalu++WLdgw0GJRW0jNaBLn40cABTnNXSjJfCFBgoLZjdHNhwW3A3BrXqg3LCaU1vJSamQceK6okP8dMLU4TFUhcwKlYdd8Wubp/wdnP065LZvmLgpLFPKVpQKsNJXigP71oRtteM9/E5DiPvgScZCQSJ+xVKqAAG2MffmYE+UOFfNlLPW4lG/cxCYVkh8M1iYetad04tHBcL2PSQj7g==
</span></span><span><span>                <span>&lt;/ds:X509Certificate&gt;</span>
</span></span><span><span>            <span>&lt;/ds:X509Data&gt;</span>
</span></span><span><span>            <span>&lt;ds:KeyValue&gt;</span>
</span></span><span><span>                <span>&lt;ds:RSAKeyValue&gt;</span>
</span></span><span><span>                    <span>&lt;ds:Modulus&gt;</span>
</span></span><span><span>                        jlefPkV4D7nM4ximMvGSSwJPnbXoH0irxjiXLt1BAcwCVOQDPo42LqK2tNN77iVUo457EYWKQWewPbMNcRdwHM/9JXE+ngf1s5svQgEC8xnpaGW4rd3qhkNbPD/tISZwD5P3d3+i+qTGt3n5Hj7KTSWYoYk5KL6Y/Qtipa2NNCqaIyF1naZXpj/yI2DjX37lAU0C2vAhwBADysjgBR/KItVmc/Wp3G69j6uSFLng4AsBW/XixTZ1GINHm4SZFuN+9Vn3aM4RjCal0tQfP61PA9a2eEHj4aRDxtfQ3P4fOHQZWeT40wfn6b8D+GX6obp5rrQppGwjMHh4zEfoZ5NNaQ==
</span></span><span><span>                    <span>&lt;/ds:Modulus&gt;</span>
</span></span><span><span>                    <span>&lt;ds:Exponent&gt;</span>
</span></span><span><span>                        AQAB
</span></span><span><span>                    <span>&lt;/ds:Exponent&gt;</span>
</span></span><span><span>                <span>&lt;/ds:RSAKeyValue&gt;</span>
</span></span><span><span>            <span>&lt;/ds:KeyValue&gt;</span>
</span></span><span><span>        <span>&lt;/ds:KeyInfo&gt;</span>
</span></span><span><span>    <span>&lt;/ds:Signature&gt;</span>
</span></span><span><span>    <span>&lt;samlp:Status&gt;</span>
</span></span><span><span>        <span>&lt;samlp:StatusCode</span> <span>Value=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:status:Success&#34;</span><span>/&gt;</span>
</span></span><span><span>    <span>&lt;/samlp:Status&gt;</span>
</span></span><span><span>    <span>&lt;saml:Assertion</span> <span>ID=</span><span>&#34;id-bb6ad0b6-7cec-4a2a-b151-f8d6bb29ff0c&#34;</span> <span>Version=</span><span>&#34;2.0&#34;</span> <span>IssueInstant=</span><span>&#34;2024-05-28T19:23:17.443Z&#34;</span> <span>xmlns:saml=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:assertion&#34;</span><span>&gt;</span>
</span></span><span><span>        <span>&lt;saml:Issuer&gt;</span>
</span></span><span><span>            https://auth.pingone.com/c761aef4-f636-402f-b29d-6cc84c13a436
</span></span><span><span>        <span>&lt;/saml:Issuer&gt;</span>
</span></span><span><span>        <span>&lt;ds:Signature</span> <span>xmlns:ds=</span><span>&#34;http://www.w3.org/2000/09/xmldsig#&#34;</span><span>&gt;</span>
</span></span><span><span>            <span>&lt;ds:SignedInfo&gt;</span>
</span></span><span><span>                <span>&lt;ds:CanonicalizationMethod</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span>/&gt;</span>
</span></span><span><span>                <span>&lt;ds:SignatureMethod</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2001/04/xmldsig-more#rsa-sha256&#34;</span><span>/&gt;</span>
</span></span><span><span>                <span>&lt;ds:Reference</span> <span>URI=</span><span>&#34;#id-bb6ad0b6-7cec-4a2a-b151-f8d6bb29ff0c&#34;</span><span>&gt;</span>
</span></span><span><span>                    <span>&lt;ds:Transforms&gt;</span>
</span></span><span><span>                        <span>&lt;ds:Transform</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2000/09/xmldsig#enveloped-signature&#34;</span><span>/&gt;</span>
</span></span><span><span>                        <span>&lt;ds:Transform</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span>/&gt;</span>
</span></span><span><span>                    <span>&lt;/ds:Transforms&gt;</span>
</span></span><span><span>                    <span>&lt;ds:DigestMethod</span> <span>Algorithm=</span><span>&#34;http://www.w3.org/2001/04/xmlenc#sha256&#34;</span><span>/&gt;</span>
</span></span><span><span>                    <span>&lt;ds:DigestValue&gt;</span>
</span></span><span><span>                        ayAvzJwqV8Nf5XH8StCZKpctPkNIfwX4rvfmbBYYVkU=
</span></span><span><span>                    <span>&lt;/ds:DigestValue&gt;</span>
</span></span><span><span>                <span>&lt;/ds:Reference&gt;</span>
</span></span><span><span>            <span>&lt;/ds:SignedInfo&gt;</span>
</span></span><span><span>            <span>&lt;ds:SignatureValue&gt;</span>
</span></span><span><span>                HYZKndwzyjHIxB/TEiycySfdydu080a4BbYWiq7MNwrGHGe79vOg30VmOHd60WCQO8yuQgeYXiNHCoGEFV861EVGz/iLHawBnNXRyAwv0mm3p98tBe4l2gnonVgUviUGuXz4HU6b8wPTZ4QFspL/K4t0OZoKtoAj/OlIxQ4aWaWQkHTtnER/Rv5AYAfVmgf90tHq4WBxRKOMH+7nFvXRoCiUyuevtjWBVYjVF+mD8kVVLazwGNQ/71DihYUyNTXkPZXcPsXxXDgB6PNTTx3pK9GEY5C8f0uPx847QEVuWP87K4Xg+iLVio8L5a8ENIAPGpoG5/hzWghJJ+u3Dn7oMw==
</span></span><span><span>            <span>&lt;/ds:SignatureValue&gt;</span>
</span></span><span><span>            <span>&lt;ds:KeyInfo&gt;</span>
</span></span><span><span>                <span>&lt;ds:X509Data&gt;</span>
</span></span><span><span>                    <span>&lt;ds:X509Certificate&gt;</span>
</span></span><span><span>                        MIIDrjCCApagAwIBAgIGAY+TeKX7MA0GCSqGSIb3DQEBCwUAMIGXMQswCQYDVQQGEwJVUzEWMBQGA1UECgwNUGluZyBJZGVudGl0eTEWMBQGA1UECwwNUGluZyBJZGVudGl0eTFYMFYGA1UEAwxPUGluZ09uZSBTU08gQ2VydGlmaWNhdGUgZm9yIFdvcmtmb3JjZSBTb2x1dGlvbiBFbnZpcm9ubWVudCA4MjBiOGQ2OSBlbnZpcm9ubWVudDAeFw0yNDA1MjAwMDQ4MjhaFw0yNTA1MjAwMDQ4MjhaMIGXMQswCQYDVQQGEwJVUzEWMBQGA1UECgwNUGluZyBJZGVudGl0eTEWMBQGA1UECwwNUGluZyBJZGVudGl0eTFYMFYGA1UEAwxPUGluZ09uZSBTU08gQ2VydGlmaWNhdGUgZm9yIFdvcmtmb3JjZSBTb2x1dGlvbiBFbnZpcm9ubWVudCA4MjBiOGQ2OSBlbnZpcm9ubWVudDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAI5Xnz5FeA+5zOMYpjLxkksCT5216B9Iq8Y4ly7dQQHMAlTkAz6ONi6itrTTe+4lVKOOexGFikFnsD2zDXEXcBzP/SVxPp4H9bObL0IBAvMZ6WhluK3d6oZDWzw/7SEmcA+T93d/ovqkxrd5+R4+yk0lmKGJOSi+mP0LYqWtjTQqmiMhdZ2mV6Y/8iNg419+5QFNAtrwIcAQA8rI4AUfyiLVZnP1qdxuvY+rkhS54OALAVv14sU2dRiDR5uEmRbjfvVZ92jOEYwmpdLUHz+tTwPWtnhB4+GkQ8bX0Nz+Hzh0GVnk+NMH5+m/A/hl+qG6ea60KaRsIzB4eMxH6GeTTWkCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAgYYlef5BTuMYkH3MKRV5huyM36WIvak1WF05mxXLq66eXjRjwFklNb2D6Cw6Hn3U/0kHtur3tfdK4o+K6+PHkYkFPS5kYuFDSIcR+WhLxq9ZkdIRg1EM5e8Z+FOAm1ogaSsalu++WLdgw0GJRW0jNaBLn40cABTnNXSjJfCFBgoLZjdHNhwW3A3BrXqg3LCaU1vJSamQceK6okP8dMLU4TFUhcwKlYdd8Wubp/wdnP065LZvmLgpLFPKVpQKsNJXigP71oRtteM9/E5DiPvgScZCQSJ+xVKqAAG2MffmYE+UOFfNlLPW4lG/cxCYVkh8M1iYetad04tHBcL2PSQj7g==
</span></span><span><span>                    <span>&lt;/ds:X509Certificate&gt;</span>
</span></span><span><span>                <span>&lt;/ds:X509Data&gt;</span>
</span></span><span><span>                <span>&lt;ds:KeyValue&gt;</span>
</span></span><span><span>                    <span>&lt;ds:RSAKeyValue&gt;</span>
</span></span><span><span>                        <span>&lt;ds:Modulus&gt;</span>
</span></span><span><span>                            jlefPkV4D7nM4ximMvGSSwJPnbXoH0irxjiXLt1BAcwCVOQDPo42LqK2tNN77iVUo457EYWKQWewPbMNcRdwHM/9JXE+ngf1s5svQgEC8xnpaGW4rd3qhkNbPD/tISZwD5P3d3+i+qTGt3n5Hj7KTSWYoYk5KL6Y/Qtipa2NNCqaIyF1naZXpj/yI2DjX37lAU0C2vAhwBADysjgBR/KItVmc/Wp3G69j6uSFLng4AsBW/XixTZ1GINHm4SZFuN+9Vn3aM4RjCal0tQfP61PA9a2eEHj4aRDxtfQ3P4fOHQZWeT40wfn6b8D+GX6obp5rrQppGwjMHh4zEfoZ5NNaQ==
</span></span><span><span>                        <span>&lt;/ds:Modulus&gt;</span>
</span></span><span><span>                        <span>&lt;ds:Exponent&gt;</span>
</span></span><span><span>                            AQAB
</span></span><span><span>                        <span>&lt;/ds:Exponent&gt;</span>
</span></span><span><span>                    <span>&lt;/ds:RSAKeyValue&gt;</span>
</span></span><span><span>                <span>&lt;/ds:KeyValue&gt;</span>
</span></span><span><span>            <span>&lt;/ds:KeyInfo&gt;</span>
</span></span><span><span>        <span>&lt;/ds:Signature&gt;</span>
</span></span><span><span>        <span>&lt;saml:Subject&gt;</span>
</span></span><span><span>            <span>&lt;saml:NameID&gt;</span>
</span></span><span><span>                ned.oleary@ssoready.com
</span></span><span><span>            <span>&lt;/saml:NameID&gt;</span>
</span></span><span><span>            <span>&lt;saml:SubjectConfirmation</span> <span>Method=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:cm:bearer&#34;</span><span>&gt;</span>
</span></span><span><span>                <span>&lt;saml:SubjectConfirmationData</span> <span>NotOnOrAfter=</span><span>&#34;2024-05-28T19:28:17.443Z&#34;</span> <span>Recipient=</span><span>&#34;https://auth.ssoready.com/v1/saml/saml_conn_8ufe2hyst7s2jdovzdvd53ldm/acs&#34;</span> <span>InResponseTo=</span><span>&#34;saml_flow_1bkwa10x7lhmh1zvrnhnj76r3&#34;</span><span>/&gt;</span>
</span></span><span><span>            <span>&lt;/saml:SubjectConfirmation&gt;</span>
</span></span><span><span>        <span>&lt;/saml:Subject&gt;</span>
</span></span><span><span>        <span>&lt;saml:Conditions</span> <span>NotBefore=</span><span>&#34;2024-05-28T19:22:17.443Z&#34;</span> <span>NotOnOrAfter=</span><span>&#34;2024-05-28T19:28:17.443Z&#34;</span><span>&gt;</span>
</span></span><span><span>            <span>&lt;saml:AudienceRestriction&gt;</span>
</span></span><span><span>                <span>&lt;saml:Audience&gt;</span>
</span></span><span><span>                    https://auth.ssoready.com/v1/saml/saml_conn_8ufe2hyst7s2jdovzdvd53ldm
</span></span><span><span>                <span>&lt;/saml:Audience&gt;</span>
</span></span><span><span>            <span>&lt;/saml:AudienceRestriction&gt;</span>
</span></span><span><span>        <span>&lt;/saml:Conditions&gt;</span>
</span></span><span><span>        <span>&lt;saml:AuthnStatement</span> <span>AuthnInstant=</span><span>&#34;2024-05-28T19:23:17.443Z&#34;</span> <span>SessionNotOnOrAfter=</span><span>&#34;2024-05-28T19:28:17.443Z&#34;</span> <span>SessionIndex=</span><span>&#34;bc8b16dc-4397-4169-85d4-dc3cfb23a0c9&#34;</span><span>&gt;</span>
</span></span><span><span>            <span>&lt;saml:AuthnContext&gt;</span>
</span></span><span><span>                <span>&lt;saml:AuthnContextClassRef&gt;</span>
</span></span><span><span>                    urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified
</span></span><span><span>                <span>&lt;/saml:AuthnContextClassRef&gt;</span>
</span></span><span><span>                <span>&lt;saml:AuthenticatingAuthority&gt;</span>
</span></span><span><span>                    https://auth.pingone.com/c761aef4-f636-402f-b29d-6cc84c13a436
</span></span><span><span>                <span>&lt;/saml:AuthenticatingAuthority&gt;</span>
</span></span><span><span>            <span>&lt;/saml:AuthnContext&gt;</span>
</span></span><span><span>        <span>&lt;/saml:AuthnStatement&gt;</span>
</span></span><span><span>        <span>&lt;saml:AttributeStatement&gt;</span>
</span></span><span><span>            <span>&lt;saml:Attribute</span> <span>Name=</span><span>&#34;saml_subject&#34;</span> <span>NameFormat=</span><span>&#34;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&#34;</span><span>&gt;</span>
</span></span><span><span>                <span>&lt;saml:AttributeValue</span> <span>xsi:type=</span><span>&#34;xs:string&#34;</span> <span>xmlns:xs=</span><span>&#34;http://www.w3.org/2001/XMLSchema&#34;</span> <span>xmlns:xsi=</span><span>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span>&gt;</span>
</span></span><span><span>                    ned.oleary@ssoready.com
</span></span><span><span>                <span>&lt;/saml:AttributeValue&gt;</span>
</span></span><span><span>            <span>&lt;/saml:Attribute&gt;</span>
</span></span><span><span>        <span>&lt;/saml:AttributeStatement&gt;</span>
</span></span><span><span>    <span>&lt;/saml:Assertion&gt;</span>
</span></span><span><span><span>&lt;/samlp:Response&gt;</span>
</span></span></code></pre></div><p>Conceptually, the <code>&lt;Response&gt;</code> just wraps up a few <code>&lt;Assertion&gt;</code> tags. An <code>&lt;Assertion&gt;</code> just wraps up claims about our user, e.g. who this is and how they authenticated with the IDP. We process the assertions to determine whether we should log in our user.</p>
<p>SAML <code>&lt;Response&gt;</code> messages seem simple at first glance. Conceptually, they aren’t too complicated. In practice, though, they’re pretty frustrating. You see, the IDP will sign its <code>&lt;Response&gt;</code> and will often sign each <code>&lt;Assertion&gt;</code> too. The signature just assures us that the message actually originated from the IDP and that no one has tampered with it. And <strong>SAML digital signatures are weird.</strong></p>
<p>The IDP builds messages (or nested components within a message) first by piling in the data it wants you to interpret. For instance, it will create the <code>&lt;AttributeValue&gt;</code>, my email address in this case. Then it’ll wrap up the <code>&lt;AttributeValue&gt;</code> in an <code>&lt;Attribute&gt;</code> tag, and so on until it completes its <code>&lt;Assertion&gt;</code> data. Then the IDP signs the <code>&lt;Assertion&gt;</code>. It converts the <code>&lt;Assertion&gt;</code> into bytes, then signs the bytes with its private key.</p>
<p>Critically, it then <strong>inserts the signature back into the <code>&lt;Assertion&gt;</code></strong>. So the <code>&lt;Assertion&gt;</code> you receive as a service provider isn’t the same <code>&lt;Assertion&gt;</code> that the IDP signed. The IDP signed a message that didn’t yet have a signature embedded inside. In order to trust the SAML message you’ve received, you need very carefully to remove the digital signature from the <code>&lt;Assertion&gt;</code>, then convert the modified <code>&lt;Assertion&gt;</code> to bytes and verify the digital signature.</p>
<p>Because you need to convert the <code>&lt;Assertion&gt;</code> into bytes, even the smallest error – e.g. forgetting to clear some whitespace – will cause you not to process the message properly. And given all the flexibility in SAML, this can be pretty hard. Moreover, you can accidentally expose yourself to severe security vulnerabilities.</p>
<p>Assuming you’ve correctly processed the <code>&lt;Response&gt;</code> signature and any <code>&lt;Assertion&gt;</code> signatures, you can proceed to log your user in. In the example I’ve given, the IDP confirms that I, <em><a href="mailto:ned.oleary@ssoready.com">ned.oleary@ssoready.com</a></em>, have authenticated using PingOne. Because you have confirmed that PingOne sent the message (and because you have a pre-configured trust relationship with PingOne that entitles it to make claims about my authentication status), you can proceed to log me in.</p>

<p>I’ve omitted a lot of details here, some of which matter <strong>greatly</strong> for security reasons. Unless you find SAML personally interesting or have some professional reason to investigate deeply, I do not recommend trying to implement SAML-based login yourself. It’s just not a good use of time.</p>
<p>If you’re curious, we post about auth stuff on our <a href="https://ssoready.com/blog">engineering blog</a> from time to time.</p>
<p>If you’re not especially curious and just want to set up SAML as soon as possible, our company makes a free, <a href="https://github.com/ssoready/ssoready">open-source</a> service that abstracts all the SAML away. It’ll save you a lot of time and grief.</p>

        </div></div>
  </body>
</html>
