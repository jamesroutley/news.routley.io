<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Battelle/movfuscator">Original</a>
    <h1>M/o/Vfuscator: A single instruction C compiler</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><div data-snippet-clipboard-copy-content="       ___     ___            ___    ___     ___     ___     ___          ___     ___      
      /\  \   /\  \    ___   /\__\  /\  \   /\__\   /\__\   /\  \        /\  \   /\  \    .
     |::\  \ /::\  \  /\  \ /:/ _/_ \:\  \ /:/ _/_ /:/  /  /::\  \  ___ /::\  \ /::\  \   .
     |:::\  \:/\:\  \ \:\  \:/ /\__\ \:\  \:/ /\  \:/  /  /:/\:\  \/\__\:/\:\  \:/\:\__\  .
   __|:|\:\  \  \:\  \ \:\  \ /:/  /  \:\  \ /::\  \  /  _:/ /::\  \/  //  \:\  \ /:/  /   
  /::::|_\:\__\/ \:\__\ \:\__\:/  / \  \:\__\:/\:\__\/  /\__\:/\:\__\_//__/ \:\__\:/__/___ 
  \:\~~\  \/__/\ /:/  / |:|  |/  /\  \ /:/  // /:/  /\ /:/  //  \/__/ \\  \ /:/  /::::/  / 
   \:\  \  \:\  /:/  / \|:|  |__/\:\  /:/  // /:/  /  /:/  //__/:/\:\  \\  /:/  //~~/~~~~  
    \:\  \  \:\/:/  /\__|:|__|  \ \:\/:/  //_/:/  /:\/:/  /:\  \/__\:\  \\/:/  /:\~~\     .
     \:\__\  \::/  /\::::/__/:\__\ \::/  /  /:/  / \::/  / \:\__\   \:\__\:/  / \:\__\    .
      \/__/   \/__/  ~~~~    \/__/  \/__/   \/__/   \/__/   \/__/    \/__/ __/   \/__/    2
                                                                                           

 M/o/Vfuscator2

 github.com/xoreaxeaxeax/movfuscator :: the single instruction C compiler
 chris domas           @xoreaxeaxeax
"><pre><code>       ___     ___            ___    ___     ___     ___     ___          ___     ___      
      /\  \   /\  \    ___   /\__\  /\  \   /\__\   /\__\   /\  \        /\  \   /\  \    .
     |::\  \ /::\  \  /\  \ /:/ _/_ \:\  \ /:/ _/_ /:/  /  /::\  \  ___ /::\  \ /::\  \   .
     |:::\  \:/\:\  \ \:\  \:/ /\__\ \:\  \:/ /\  \:/  /  /:/\:\  \/\__\:/\:\  \:/\:\__\  .
   __|:|\:\  \  \:\  \ \:\  \ /:/  /  \:\  \ /::\  \  /  _:/ /::\  \/  //  \:\  \ /:/  /   
  /::::|_\:\__\/ \:\__\ \:\__\:/  / \  \:\__\:/\:\__\/  /\__\:/\:\__\_//__/ \:\__\:/__/___ 
  \:\~~\  \/__/\ /:/  / |:|  |/  /\  \ /:/  // /:/  /\ /:/  //  \/__/ \\  \ /:/  /::::/  / 
   \:\  \  \:\  /:/  / \|:|  |__/\:\  /:/  // /:/  /  /:/  //__/:/\:\  \\  /:/  //~~/~~~~  
    \:\  \  \:\/:/  /\__|:|__|  \ \:\/:/  //_/:/  /:\/:/  /:\  \/__\:\  \\/:/  /:\~~\     .
     \:\__\  \::/  /\::::/__/:\__\ \::/  /  /:/  / \::/  / \:\__\   \:\__\:/  / \:\__\    .
      \/__/   \/__/  ~~~~    \/__/  \/__/   \/__/   \/__/   \/__/    \/__/ __/   \/__/    2
                                                                                           

 M/o/Vfuscator2

 github.com/xoreaxeaxeax/movfuscator :: the single instruction C compiler
 chris domas           @xoreaxeaxeax

</code></pre></div>
<h2 tabindex="-1" id="user-content-overview" dir="auto"><a href="#overview">Overview<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">The M/o/Vfuscator (short &#39;o&#39;, sounds like &#34;mobfuscator&#34;) compiles programs into
&#34;mov&#34; instructions, and only &#34;mov&#34; instructions.  Arithmetic, comparisons,
jumps, function calls, and everything else a program needs are all performed
through mov operations; there is no self-modifying code, no transport-triggered
calculation, and no other form of non-mov cheating.</p>
<p dir="auto">The basic effects of the process can be seen in <a href="https://thewitchofendor.com/Battelle/movfuscator/blob/master/overview">overview</a>, which
illustates compiling a simple prime number function with gcc and the
M/o/Vfuscator.</p>
<p dir="auto">Assembly:</p>
<table>
<thead>
<tr>
<th>GCC</th>
<th>M/o/Vfuscator</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" rel="noopener noreferrer" href="https://thewitchofendor.com/Battelle/movfuscator/blob/master/overview/gcc_asm.png"><img src="https://thewitchofendor.com/Battelle/movfuscator/raw/master/overview/gcc_asm.png" alt="gcc asm"/></a></td>
<td><a target="_blank" rel="noopener noreferrer" href="https://thewitchofendor.com/Battelle/movfuscator/blob/master/overview/mov_asm.png"><img src="https://thewitchofendor.com/Battelle/movfuscator/raw/master/overview/mov_asm.png" alt="mov asm"/></a></td>
</tr>
</tbody>
</table>
<p dir="auto">Control flow graphs:</p>
<table>
<thead>
<tr>
<th>GCC</th>
<th>M/o/Vfuscator</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" rel="noopener noreferrer" href="https://thewitchofendor.com/Battelle/movfuscator/blob/master/overview/gcc_cfg.png"><img src="https://thewitchofendor.com/Battelle/movfuscator/raw/master/overview/gcc_cfg.png" alt="gcc CFG"/></a></td>
<td><a target="_blank" rel="noopener noreferrer" href="https://thewitchofendor.com/Battelle/movfuscator/blob/master/overview/mov_cfg.png"><img src="https://thewitchofendor.com/Battelle/movfuscator/raw/master/overview/mov_cfg.png" alt="mov CFG"/></a></td>
</tr>
</tbody>
</table>
<p dir="auto">In action:</p>
<table>
<thead>
<tr>
<th>movcc prime.c -o prime</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" rel="noopener noreferrer" href="https://thewitchofendor.com/Battelle/movfuscator/blob/master/overview/demo_mov.gif"><img src="https://thewitchofendor.com/Battelle/movfuscator/raw/master/overview/demo_mov.gif" alt="demo_mov" data-animated-image=""/></a></td>
</tr>
</tbody>
</table>
<p dir="auto">Of course, as a complete C compiler, it is not limited to simple programs:</p>
<table>
<thead>
<tr>
<th>movcc nibbles.c -o nibbles -lncurses</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" rel="noopener noreferrer" href="https://thewitchofendor.com/Battelle/movfuscator/blob/master/overview/demo_nibbles.gif"><img src="https://thewitchofendor.com/Battelle/movfuscator/raw/master/overview/demo_nibbles.gif" alt="demo_nibbles" data-animated-image=""/></a></td>
</tr>
</tbody>
</table>
<p dir="auto">The compiler currently targets the C programming language and x86 processor
architecture, but is easily adaptable to other languages and architectures.</p>
<h2 tabindex="-1" id="user-content-building" dir="auto"><a href="#building">Building<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">The M/o/Vfuscator uses LCC as the compiler frontend.  The included build script
will automatically download LCC, configure it for the mov backend, and build the
M/o/Vfuscator tool.</p>
<p dir="auto">If you are building on a 64 bit system, ensure that you have a 32 bit libc
available (for example, &#39;apt-get install libc6-dev-i386&#39; or &#39;yum install
glibc-devel.i686&#39;).</p>
<div data-snippet-clipboard-copy-content="git clone https://github.com/xoreaxeaxeax/movfuscator
cd movfuscator
./build.sh
sudo ./install.sh"><pre><code>git clone https://github.com/xoreaxeaxeax/movfuscator
cd movfuscator
./build.sh
sudo ./install.sh
</code></pre></div>
<p dir="auto">If you have trouble building LCC, you can get more details on the LCC build
process at: <a href="http://drh.github.io/lcc/current/doc/install.html" rel="nofollow">http://drh.github.io/lcc/current/doc/install.html</a></p>
<h2 tabindex="-1" id="user-content-testing" dir="auto"><a href="#testing">Testing<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Check that the build was successful with the check script.  This will
automatically download an open source AES implementation, compile it to mov
instructions, objdump the result, and run the program.</p>

<h2 tabindex="-1" id="user-content-usage" dir="auto"><a href="#usage">Usage<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Compile programs as you would with any traditional C compiler:</p>
<div data-snippet-clipboard-copy-content="movcc example.c -o example"><pre><code>movcc example.c -o example
</code></pre></div>
<h2 tabindex="-1" id="user-content-flags" dir="auto"><a href="#flags">Flags<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Flags are passed to the compiler proper via -Wfflag, e.g. -Wf--no-mov-id</p>
<div data-snippet-clipboard-copy-content="--mov-id
  Add reference instructions for each basic block to assist debugging.

--no-mov-id
  Do not add reference instructions.  This is the default.

--mov-flow
  Use mov instructions in implementing control flow.  This is the default.

--no-mov-flow
  Use jmp instructions in implementing control flow.  This will substantially
  speed up execution in larger projects.

--mov-extern
  Use mov instructions to implement external function calls.  This is the
  default.

--no-mov-extern
  Use jmp instructions to implement external function calls.  This is useful for
  debugging.

--mov-loop
  Use mov instructions to implement the primary execution loop.  This is the
  default.

--no-mov-loop
  Use jmp instructions to implement the primary execution loop.  This is useful
  for debugging.

--crt0
  Build the M/o/Vfuscator crt0 library (_start routines).

--crtf
  Build the M/o/Vfuscator crtf library (primary execution loop routines).

--crtd
  Build the M/o/Vfuscator crtd library (data tables).

--crt
  Same as --crt0 --crtf --crtd."><pre><code>--mov-id
  Add reference instructions for each basic block to assist debugging.

--no-mov-id
  Do not add reference instructions.  This is the default.

--mov-flow
  Use mov instructions in implementing control flow.  This is the default.

--no-mov-flow
  Use jmp instructions in implementing control flow.  This will substantially
  speed up execution in larger projects.

--mov-extern
  Use mov instructions to implement external function calls.  This is the
  default.

--no-mov-extern
  Use jmp instructions to implement external function calls.  This is useful for
  debugging.

--mov-loop
  Use mov instructions to implement the primary execution loop.  This is the
  default.

--no-mov-loop
  Use jmp instructions to implement the primary execution loop.  This is useful
  for debugging.

--crt0
  Build the M/o/Vfuscator crt0 library (_start routines).

--crtf
  Build the M/o/Vfuscator crtf library (primary execution loop routines).

--crtd
  Build the M/o/Vfuscator crtd library (data tables).

--crt
  Same as --crt0 --crtf --crtd.
</code></pre></div>
<h2 tabindex="-1" id="user-content-floats" dir="auto"><a href="#floats">Floats<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>
<p dir="auto">The M/o/Vfuscator contains a complete mov-only floating point emulator.  Since
it is approximately 500,000 instructions, you must explicitly link to it if
you need it.  Use the smaller softfloat32.o if you only use floats,
softfloat64.o if you need floats and doubles, and softfloatfull.o for a full
IEEE floating point emulator.</p>
<div data-snippet-clipboard-copy-content="movcc your_code.c movfuscator/lib/softfloat32.o"><pre><code>movcc your_code.c movfuscator/lib/softfloat32.o
</code></pre></div>
</li>
</ul>
<h2 tabindex="-1" id="user-content-recommendations" dir="auto"><a href="#recommendations">Recommendations<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>
<p dir="auto">Due to the lookup tables used for arithmetic, the symbol tables in the
compiled binary can be extremely large.  Stripping symbols with the -s flag
can cut the final binary size by half.</p>

</li>
</ul>
<h2 tabindex="-1" id="user-content-warnings" dir="auto"><a href="#warnings">Warnings<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>
<p dir="auto">You may occassionally run into ABI conflicts when calling into libraries
compiled with other compilers.  These are relatively rare, but do
occassionally pop up.  Watch out for:</p>
<ul dir="auto">
<li>
<p dir="auto">Passing a pointer to a callback function into a library.  The M/o/Vfuscator
will clobber registers the library was expecting to have preserved.</p>
</li>
<li>
<p dir="auto">Using the long long type.  The M/o/Vfuscator uses a 32 bit long long; your
library may be expecting 64 bits.</p>
</li>
<li>
<p dir="auto">Such ABI issues are relatively rare; they can be roughly fixed with some
coding caution, or more robustly fixed by recompiling your libraries with
the M/o/Vfuscator.</p>
</li>
</ul>
</li>
<li>
<p dir="auto">LCC is a C89 compiler.  If you try to compile C99 code, you will get errors.
Don&#39;t use C99 features like bool, for (int ...), etc.  Don&#39;t declare variables
in the middle of blocks.</p>
</li>
<li>
<p dir="auto">To generate code correctly, the M/o/Vfuscator must be able to determine
when a call is being made to a shared library.  If a function is used before
it is declared, this determination may be incorrect.  If your executable
hangs, it may be because a function prototype was missing.</p>
</li>
<li>
<p dir="auto">LCC strongly enforces type and const rules.  You may not be able to compile
code with unsafe type or const conversions, unless you explicitly cast for it.</p>
</li>
<li>
<p dir="auto">These are by far the most common causes of the M/o/Vfuscator &#34;breaking&#34;.  Make
sure you handle these before you try to compile your code.</p>
</li>
</ul>
<h2 tabindex="-1" id="user-content-limitations" dir="auto"><a href="#limitations">Limitations<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>
<p dir="auto">Calls to external functions (printf, etc) through function pointers are not
yet implemented.  That is,</p>

<p dir="auto">works, but</p>
<div data-snippet-clipboard-copy-content="int (*f)(void)=getchar; f();"><pre><code>int (*f)(void)=getchar; f();
</code></pre></div>
<p dir="auto">does not.</p>
<p dir="auto">If you need to do this, wrap the function internally:</p>
<div data-snippet-clipboard-copy-content="int g(void) { return getchar(); }
int (*f)(void)=g; f();"><pre><code>int g(void) { return getchar(); }
int (*f)(void)=g; f();
</code></pre></div>
</li>
</ul>
<h2 tabindex="-1" id="user-content-mov-violations" dir="auto"><a href="#mov-violations">MOV violations<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>
<p dir="auto">When calling into libraries compiled with other compilers, an occassional
non-mov instruction is necessary.  This can be fixed by compiling all of your
libraries with the M/o/Vfuscator.  To be clear, this is not a limitation of
the M/o/Vfuscator, or a violation of mov Turing-completeness - non-mov
instructions are only necessary to accommodate non-mov calling conventions.
If you do not recompile your libraries, the non-mov instructions are as
follows:</p>
<ul dir="auto">
<li>
<p dir="auto">A single jmp instruction at the end of the program is used to dispatch
the program&#39;s external functions.  If you wish to avoid this jmp instruction
to have a truly mov only program, compile with --no-mov-extern, and avoid
calling into shared libraries.  If you still need an external function,
recompile the library with the M/o/Vfuscator, and statically link it to your
program.</p>
</li>
<li>
<p dir="auto">An fstp instruction is used following every call to an external function
returning a float or a double.  This is because there is no way to access
the x86 floating point registers with a mov instruction.  To get rid of the
fstp instruction, recompile your libraries to use the M/o/Vfuscator&#39;s
floating point emulator, instead of the x86 FPU.</p>
</li>
</ul>
</li>
</ul>
<h2 tabindex="-1" id="user-content-post-processing" dir="auto"><a href="#post-processing">Post-processing<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">The M/o/Vfuscator post-processors take assembly from the M/o/Vfuscator and
translate it for additional obfuscation, new instructions, or optimization.  At
some point they may be integrated into the actual compiler; for now they are
separate scripts.</p>
<p dir="auto">Current post-processing scripts include:</p>
<ul dir="auto">
<li>
<p dir="auto">Instruction shuffling and register renaming, to prevent simple decompilation
through pattern matching.</p>
</li>
<li>
<p dir="auto">Assembly translation into only: XOR, SUB, ADD, XADD, ADC, SBB, AND/OR,
PUSH/POP, 1-bit shifts, or CMPXCHG/XCHG instructions.</p>
</li>
<li>
<p dir="auto">Translation into only 32 bit register-to-memory and memory-to-register
transfers.  This may assist in translating M/o/Vfuscated code to other
instructions or architectures.</p>
</li>
<li>
<p dir="auto">Translation into only indexed addressing forms.</p>
</li>
<li>
<p dir="auto">Randomization of the above translations.</p>
</li>
</ul>
<h2 tabindex="-1" id="user-content-other-source-languages" dir="auto"><a href="#other-source-languages">Other source languages<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>
<p dir="auto">The M/o/Vfuscator currently uses C as the source language.  The following
proof of concept, provided by Adam Schwalm, illustrates how to use a variety
of other source languages:</p>
<div data-snippet-clipboard-copy-content="# Compile c++ to llvm bytecode
clang++ -S -emit-llvm -o bytecode.ll $1

# Convert bytecode to C
llc -march=c -o code.c bytecode.ll

# &#39;fix&#39; static inline. This is a workaround for a bug
# in one of the parsers, I think.
sed -i &#39;s/static inline.*//&#39; code.c

# hack
sed -i &#39;s/extern unsigned char \*__dso_handle;/unsigned char \*__dso_handle=0;/&#39; code.c

# Compile the resulting C as usual (but with the c++ stdlib)
movcc code.c -lstdc++"><pre><code># Compile c++ to llvm bytecode
clang++ -S -emit-llvm -o bytecode.ll $1

# Convert bytecode to C
llc -march=c -o code.c bytecode.ll

# &#39;fix&#39; static inline. This is a workaround for a bug
# in one of the parsers, I think.
sed -i &#39;s/static inline.*//&#39; code.c

# hack
sed -i &#39;s/extern unsigned char \*__dso_handle;/unsigned char \*__dso_handle=0;/&#39; code.c

# Compile the resulting C as usual (but with the c++ stdlib)
movcc code.c -lstdc++
</code></pre></div>
</li>
</ul>
<h2 tabindex="-1" id="user-content-other-architectures" dir="auto"><a href="#other-architectures">Other architectures<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>A common observation on the M/o/Vfuscator output is that it uses all available
forms and addressing modes for the mov instruction.  Although the point was
never anything different, the RISC post-processor (risc.py) illustrates
transforming the program into RISC-like data transfers, reducing the program
to 4 byte memory accesses, only indexed addressing modes, and only two
registers.  With this, all mov instructions become either
&#34;mov esi/edi, [BASE+esi/edi]&#34; or &#34;mov [BASE+esi/edi], esi/edi&#34;, where BASE is
some constant address.  This should demonstrate the applicability of the
approach on non-x86 architectures, and deter complaints about the diversity of
the x86 mov instruction.</li>
</ul>
<h2 tabindex="-1" id="user-content-notes" dir="auto"><a href="#notes">Notes<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>While Dolan&#39;s paper required a jmp instruction, the M/o/Vfuscator does not -
it uses a faulting mov instruction to achieve the infinite execution loop.  If
you&#39;re worried that this is still &#34;jumping&#34;, the same effect could be achieved
through pages aliased to the same address, wrapping execution around the upper
range of memory, ring 0 exception handling, or simply repeating the mov loop
indefinitely.  A jmp <em>is</em> currently used to dispatch external functions - if
this is a problem, avoid using external functions, or compile libraries with
the M/o/Vfuscator as well.</li>
</ul>
<h2 tabindex="-1" id="user-content-history" dir="auto"><a href="#history">History<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>
<p dir="auto">The original M/o/Vfuscator (M/o/Vfuscator 1.0) compiles programs from the
esoteric language BrainF@$!, and is best used in conjunction with the BFBASIC
compiler by Jeffry Johnston.  It is still available as a proof of concept in
the <a href="https://thewitchofendor.com/Battelle/movfuscator/blob/master/poc">poc</a> directory.</p>
</li>
<li>
<p dir="auto">M/o/Vfuscator2 is a complete single-instruction C compiler.</p>
</li>
</ul>
<h2 tabindex="-1" id="user-content-faq" dir="auto"><a href="#faq">F.A.Q.<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>Q: Why did you make this?
A: I thought it would be funny.</li>
</ul>
<h2 tabindex="-1" id="user-content-references" dir="auto"><a href="#references">References<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>
<p dir="auto">A presentation explaining the ideation, design, and goals of the M/o/Vfuscator
can be found <a href="https://www.youtube.com/watch?v=R7EEoWg6Ekk" rel="nofollow">here</a>.</p>
</li>
<li>
<p dir="auto">Slides outlining the mechanisms used are <a href="https://thewitchofendor.com/Battelle/movfuscator/blob/master/slides/domas_2015_the_movfuscator.pdf">here</a>.</p>
</li>
<li>
<p dir="auto">The inspiration for the compiler is the paper <a href="http://www.cl.cam.ac.uk/~sd601/papers/mov.pdf" rel="nofollow">&#34;mov is Turing-complete&#34;,
by Stephen Dolan</a>.</p>
</li>
</ul>
<h2 tabindex="-1" id="user-content-author" dir="auto"><a href="#author">Author<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>chris domas, @xoreaxeaxeax</li>
</ul>
</article>
          </div></div>
  </body>
</html>
