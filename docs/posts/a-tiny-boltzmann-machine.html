<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://eoinmurray.info/boltzmann-machine">Original</a>
    <h1>A Tiny Boltzmann Machine</h1>
    
    <div id="readability-page-1" class="page"><div><div><div id="appendix"><div><p>Appendix: Contrastive Divergence</p><p>Starting with a Boltzmann machine as defined earlier, we
want to derive the contrastive divergence algorithm for training.
The goal is to adjust the weights of the network to minimize the energy of the training data.</p><p>We have:</p><ul>
<li>A visible layer <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>v</span></span></span></span> and a hidden layer <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>h</span></span></span></span>.</li>
<li>A weight matrix <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>W</span></span></span></span> that connects the visible and hidden layers.</li>
<li>A bias vector <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>b</span></span></span></span> for the visible layer and a bias vector <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>c</span></span></span></span> for the hidden layer.</li>
</ul><p>Energy function in matrix form:</p><p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><mi>h</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>v</mi><mi>i</mi></msub><msub><mi>h</mi><mi>j</mi></msub><mo>−</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><msub><mi>b</mi><mi>i</mi></msub><msub><mi>v</mi><mi>i</mi></msub><mo>−</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>c</mi><mi>j</mi></msub><msub><mi>h</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">E(v,h) = -\sum_{i=1}^{m} \sum_{j=1}^{n} w_{ij} v_i h_j - \sum_{i=1}^{m} b_i v_i - \sum_{j=1}^{n} c_j h_j</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>E</span><span>(</span><span>v</span><span>,</span><span></span><span>h</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>−</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>1</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>m</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span><span><span><span><span><span></span><span><span><span>j</span><span>=</span><span>1</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>ij</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>v</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>h</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>1</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>m</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>v</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>j</span><span>=</span><span>1</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>h</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></p><p>Joint distribution:</p><p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><mi>h</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>Z</mi></mfrac><msup><mi>e</mi><mrow><mo>−</mo><mi>E</mi><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><mi>h</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">P(v,h) = \frac{1}{Z} e^{-E(v,h)}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>P</span><span>(</span><span>v</span><span>,</span><span></span><span>h</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>Z</span></span></span><span><span></span><span></span></span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>−</span><span>E</span><span>(</span><span>v</span><span>,</span><span>h</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>Where <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>Z</span></span></span></span> is the partition function, which normalizes the distribution.</p></div><div><p>We train the RBM by maximizing the likelihood of the training data, i.e. maximizing <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>log</mtext><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{log}(P(v))</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>log</span></span><span>(</span><span>P</span><span>(</span><span>v</span><span>))</span></span></span></span>.</p><p>The marginal likelihood of the visible layer is given by:</p><p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mi>h</mi></munder><mi>P</mi><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><mi>h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(v) = \sum_{h} P(v,h)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>P</span><span>(</span><span>v</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>h</span></span></span></span><span><span></span><span><span>∑</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>P</span><span>(</span><span>v</span><span>,</span><span></span><span>h</span><span>)</span></span></span></span></span></p><p>Then the log-likelihood is:</p><p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>log</mtext><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mtext>log</mtext><munder><mo>∑</mo><mi>h</mi></munder><mfrac><mn>1</mn><mi>Z</mi></mfrac><msup><mi>e</mi><mrow><mo>−</mo><mi>E</mi><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><mi>h</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mtext>log</mtext><munder><mo>∑</mo><mi>h</mi></munder><msup><mi>e</mi><mrow><mo>−</mo><mi>E</mi><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><mi>h</mi><mo stretchy="false">)</mo></mrow></msup><mo>−</mo><mtext>log</mtext><mo stretchy="false">(</mo><mi>Z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{log}(P(v)) = \text{log}\sum_{h} \frac{1}{Z} e^{-E(v,h)} = \text{log}\sum_{h} e^{-E(v,h)} - \text{log}(Z)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>log</span></span><span>(</span><span>P</span><span>(</span><span>v</span><span>))</span><span></span><span>=</span><span></span></span><span><span></span><span><span>log</span></span><span></span><span><span><span><span><span><span></span><span><span><span>h</span></span></span></span><span><span></span><span><span>∑</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>Z</span></span></span><span><span></span><span></span></span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>−</span><span>E</span><span>(</span><span>v</span><span>,</span><span>h</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>log</span></span><span></span><span><span><span><span><span><span></span><span><span><span>h</span></span></span></span><span><span></span><span><span>∑</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>−</span><span>E</span><span>(</span><span>v</span><span>,</span><span>h</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span><span>log</span></span><span>(</span><span>Z</span><span>)</span></span></span></span></span></p><p>Differentiating with respect to the weights <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{ij}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>ij</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span> gives:</p><p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><mi mathvariant="bold">v</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><munder><mo>∑</mo><mi mathvariant="bold">h</mi></munder><msup><mi>e</mi><mrow><mo>−</mo><mi>E</mi><mo stretchy="false">(</mo><mi mathvariant="bold">v</mi><mo separator="true">,</mo><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac><munder><mo>∑</mo><mi mathvariant="bold">h</mi></munder><mrow><mo fence="true">(</mo><mo>−</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>E</mi><mo stretchy="false">(</mo><mi mathvariant="bold">v</mi><mo separator="true">,</mo><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow></mfrac><mo fence="true">)</mo></mrow><msup><mi>e</mi><mrow><mo>−</mo><mi>E</mi><mo stretchy="false">(</mo><mi mathvariant="bold">v</mi><mo separator="true">,</mo><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mspace width="1em"></mspace><mo>−</mo><mfrac><mn>1</mn><mi>Z</mi></mfrac><munder><mo>∑</mo><mrow><mi mathvariant="bold">v</mi><mo separator="true">,</mo><mi mathvariant="bold">h</mi></mrow></munder><mrow><mo fence="true">(</mo><mo>−</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>E</mi><mo stretchy="false">(</mo><mi mathvariant="bold">v</mi><mo separator="true">,</mo><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow></mfrac><mo fence="true">)</mo></mrow><msup><mi>e</mi><mrow><mo>−</mo><mi>E</mi><mo stretchy="false">(</mo><mi mathvariant="bold">v</mi><mo separator="true">,</mo><mi mathvariant="bold">h</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\frac{\partial \log P(\mathbf{v})}{\partial w_{ij}} 
&amp;= \frac{1}{\sum_{\mathbf{h}} e^{-E(\mathbf{v}, \mathbf{h})}} 
\sum_{\mathbf{h}} \left( -\frac{\partial E(\mathbf{v}, \mathbf{h})}{\partial w_{ij}} \right) e^{-E(\mathbf{v}, \mathbf{h})} \\
&amp;\quad - \frac{1}{Z} \sum_{\mathbf{v}, \mathbf{h}} \left( -\frac{\partial E(\mathbf{v}, \mathbf{h})}{\partial w_{ij}} \right) e^{-E(\mathbf{v}, \mathbf{h})}
\end{align*}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span></span><span><span><span><span><span><span></span><span><span>∂</span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>ij</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span>∂</span><span></span><span>lo<span>g</span></span><span></span><span>P</span><span>(</span><span>v</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>∑</span><span><span><span><span><span><span></span><span><span><span>h</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>−</span><span>E</span><span>(</span><span>v</span><span>,</span><span>h</span><span>)</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span><span><span><span></span><span><span><span>h</span></span></span></span><span><span></span><span><span>∑</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span><span><span>(</span></span><span>−</span><span><span></span><span><span><span><span><span><span></span><span><span>∂</span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>ij</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span>∂</span><span>E</span><span>(</span><span>v</span><span>,</span><span></span><span>h</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>−</span><span>E</span><span>(</span><span>v</span><span>,</span><span>h</span><span>)</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span></span><span>−</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>Z</span></span></span><span><span></span><span></span></span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span><span><span><span></span><span><span><span>v</span><span>,</span><span>h</span></span></span></span><span><span></span><span><span>∑</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span><span><span>(</span></span><span>−</span><span><span></span><span><span><span><span><span><span></span><span><span>∂</span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>ij</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span>∂</span><span>E</span><span>(</span><span>v</span><span>,</span><span></span><span>h</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>−</span><span>E</span><span>(</span><span>v</span><span>,</span><span>h</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></p><p>Similar forms exist for the biases <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">b_i</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">c_j</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span>.</p><p>Since we are performing gradient ascent:</p><p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>←</mo><mi mathvariant="normal">Δ</mi><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>+</mo><mi>η</mi><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\Delta w_{ij} \leftarrow \Delta w_{ij} + \eta \frac{\partial \log P(v)}{\partial w_{ij}}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>Δ</span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>ij</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>←</span><span></span></span><span><span></span><span>Δ</span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>ij</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>η</span><span><span></span><span><span><span><span><span><span></span><span><span>∂</span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>ij</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span>∂</span><span></span><span>lo<span>g</span></span><span></span><span>P</span><span>(</span><span>v</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span></span></p><p>Therefore we get our weight update rule:</p><p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>η</mi><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow></mfrac><mo>=</mo><mi>η</mi><mrow><mo fence="true">(</mo><mo stretchy="false">⟨</mo><msub><mi>v</mi><mi>i</mi></msub><msub><mi>h</mi><mi>j</mi></msub><msub><mo stretchy="false">⟩</mo><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi></mrow></msub><mo>−</mo><mo stretchy="false">⟨</mo><msub><mi>v</mi><mi>i</mi></msub><msub><mi>h</mi><mi>j</mi></msub><msub><mo stretchy="false">⟩</mo><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta w_{ij} = \eta \frac{\partial \log P(v)}{\partial w_{ij}} = \eta \left( \langle v_i h_j \rangle_{data} - \langle v_i h_j \rangle_{model} \right)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>Δ</span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>ij</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>η</span><span><span></span><span><span><span><span><span><span></span><span><span>∂</span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>ij</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span>∂</span><span></span><span>lo<span>g</span></span><span></span><span>P</span><span>(</span><span>v</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>η</span><span></span><span><span>(</span><span>⟨</span><span><span>v</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>h</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>d</span><span>a</span><span>t</span><span>a</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span><span>⟨</span><span><span>v</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>h</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>m</span><span>o</span><span>d</span><span>e</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></span></p></div><div><p>A similar process can be followed for the biases <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">b_i</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">c_j</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span>.</p><p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi>b</mi><mi>i</mi></msub><mo>=</mo><mi>η</mi><mrow><mo fence="true">(</mo><mo stretchy="false">⟨</mo><msub><mi>v</mi><mi>i</mi></msub><msub><mo stretchy="false">⟩</mo><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi></mrow></msub><mo>−</mo><mo stretchy="false">⟨</mo><msub><mi>v</mi><mi>i</mi></msub><msub><mo stretchy="false">⟩</mo><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta b_i = \eta \left( \langle v_i \rangle_{data} - \langle v_i \rangle_{model} \right)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>Δ</span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>η</span><span></span><span><span>(</span><span>⟨</span><span><span>v</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>d</span><span>a</span><span>t</span><span>a</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span><span>⟨</span><span><span>v</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>m</span><span>o</span><span>d</span><span>e</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi>c</mi><mi>j</mi></msub><mo>=</mo><mi>η</mi><mrow><mo fence="true">(</mo><mo stretchy="false">⟨</mo><msub><mi>h</mi><mi>j</mi></msub><msub><mo stretchy="false">⟩</mo><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi></mrow></msub><mo>−</mo><mo stretchy="false">⟨</mo><msub><mi>h</mi><mi>j</mi></msub><msub><mo stretchy="false">⟩</mo><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta c_j = \eta \left( \langle h_j \rangle_{data} - \langle h_j \rangle_{model} \right)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>Δ</span><span><span>c</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>η</span><span></span><span><span>(</span><span>⟨</span><span><span>h</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>d</span><span>a</span><span>t</span><span>a</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span><span>⟨</span><span><span>h</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>m</span><span>o</span><span>d</span><span>e</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></span></p><p>Where <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⟨</mo><mo>⋅</mo><msub><mo stretchy="false">⟩</mo><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\langle \cdot \rangle_{data}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>⟨</span><span>⋅</span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>d</span><span>a</span><span>t</span><span>a</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span> is the expectation with respect to the training data and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⟨</mo><mo>⋅</mo><msub><mo stretchy="false">⟩</mo><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\langle \cdot \rangle_{model}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>⟨</span><span>⋅</span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>m</span><span>o</span><span>d</span><span>e</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span> is the expectation with respect to the model distribution.</p><p>The next step is to approximate the model expectation using Gibbs sampling.</p><ol>
<li>Positive phase: Sample <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="bold">h</mi><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup><mo>≈</mo><mi>P</mi><mo stretchy="false">(</mo><mi mathvariant="bold">h</mi><mi mathvariant="normal">∣</mi><msup><mi mathvariant="bold">v</mi><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mtext>data</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathbf{h}^{(0)} \approx P(\mathbf{h}|\mathbf{v}^{(0)} = \text{data})</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>h</span><span><span><span><span><span><span></span><span><span><span>(</span><span>0</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>≈</span><span></span></span><span><span></span><span>P</span><span>(</span><span>h</span><span>∣</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>(</span><span>0</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>data</span></span><span>)</span></span></span></span></li>
<li>Negative phase: Run k steps of Gibbs sampling:</li>
</ol><ul>
<li>Alternating between <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="bold">v</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>≈</mo><mi>P</mi><mo stretchy="false">(</mo><mi mathvariant="bold">v</mi><mi mathvariant="normal">∣</mi><msup><mi mathvariant="bold">h</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathbf{v}^{(t+1)} \approx P(\mathbf{v}|\mathbf{h}^{(t)})</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>(</span><span>t</span><span>+</span><span>1</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>≈</span><span></span></span><span><span></span><span>P</span><span>(</span><span>v</span><span>∣</span><span><span>h</span><span><span><span><span><span><span></span><span><span><span>(</span><span>t</span><span>)</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></li>
<li>and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="bold">h</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>≈</mo><mi>P</mi><mo stretchy="false">(</mo><mi mathvariant="bold">h</mi><mi mathvariant="normal">∣</mi><msup><mi mathvariant="bold">v</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathbf{h}^{(t+1)} \approx P(\mathbf{h}|\mathbf{v}^{(t)})</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>h</span><span><span><span><span><span><span></span><span><span><span>(</span><span>t</span><span>+</span><span>1</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>≈</span><span></span></span><span><span></span><span>P</span><span>(</span><span>h</span><span>∣</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>(</span><span>t</span><span>)</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></li>
</ul><p>Once those steps are done we update the weights and biases according to:</p><p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>η</mi><mrow><mo fence="true">(</mo><mo stretchy="false">⟨</mo><msub><mi>v</mi><mi>i</mi></msub><msub><mi>h</mi><mi>j</mi></msub><msub><mo stretchy="false">⟩</mo><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi></mrow></msub><mo>−</mo><mo stretchy="false">⟨</mo><msub><mi>v</mi><mi>i</mi></msub><msub><mi>h</mi><mi>j</mi></msub><msub><mo stretchy="false">⟩</mo><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta w_{ij} = \eta \left( \langle v_i h_j \rangle_{data} - \langle v_i h_j \rangle_{model} \right)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>Δ</span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>ij</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>η</span><span></span><span><span>(</span><span>⟨</span><span><span>v</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>h</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>d</span><span>a</span><span>t</span><span>a</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span><span>⟨</span><span><span>v</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>h</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>m</span><span>o</span><span>d</span><span>e</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi>b</mi><mi>i</mi></msub><mo>=</mo><mi>η</mi><mrow><mo fence="true">(</mo><mo stretchy="false">⟨</mo><msub><mi>v</mi><mi>i</mi></msub><msub><mo stretchy="false">⟩</mo><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi></mrow></msub><mo>−</mo><mo stretchy="false">⟨</mo><msub><mi>v</mi><mi>i</mi></msub><msub><mo stretchy="false">⟩</mo><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta b_i = \eta \left( \langle v_i \rangle_{data} - \langle v_i \rangle_{model} \right)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>Δ</span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>η</span><span></span><span><span>(</span><span>⟨</span><span><span>v</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>d</span><span>a</span><span>t</span><span>a</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span><span>⟨</span><span><span>v</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>m</span><span>o</span><span>d</span><span>e</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi>c</mi><mi>j</mi></msub><mo>=</mo><mi>η</mi><mrow><mo fence="true">(</mo><mo stretchy="false">⟨</mo><msub><mi>h</mi><mi>j</mi></msub><msub><mo stretchy="false">⟩</mo><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi></mrow></msub><mo>−</mo><mo stretchy="false">⟨</mo><msub><mi>h</mi><mi>j</mi></msub><msub><mo stretchy="false">⟩</mo><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta c_j = \eta \left( \langle h_j \rangle_{data} - \langle h_j \rangle_{model} \right)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>Δ</span><span><span>c</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>η</span><span></span><span><span>(</span><span>⟨</span><span><span>h</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>d</span><span>a</span><span>t</span><span>a</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span><span>⟨</span><span><span>h</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>⟩</span><span><span><span><span><span><span></span><span><span><span>m</span><span>o</span><span>d</span><span>e</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></span></p></div></div></div></div></div>
  </body>
</html>
