<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bitfehler.srht.site/posts/2024-04-15_m2dir-treating-mails-as-files-without-going-crazy.html">Original</a>
    <h1>M2dir: Treating mails as files without going crazy</h1>
    
    <div id="readability-page-1" class="page"><div>
 <div>
<section id="M2dir-treating-mails-as-files-without-going-crazy">

<p>Sometime <del>recently</del> <ins><a href="https://bitfehler.srht.site/posts/2023-09-07_sorry--maildir--i-am-breaking-up-with-you.html">in the past</a></ins> I complained about Maildir.
You can go read the post, but the executive summary is that I think Maildir
uses an actively user-hostile directory structure and extremely convoluted
filenames that do not convey any meaning at all. For good measure, I will also
reiterate that Maildir does this for a good reason, and is simply often being
used for a purpose it wasn‚Äôt designed for - storing your mails locally.</p>
<p>Unfortunately, there seem to be no real alternatives. The only other common
format for storing mails locally is <em>mbox</em>. But it stores all messages in a
single file, which is unacceptable if you‚Äôd like to access them with regular
tools.</p>
<p><strong>Note:</strong> if you have never had the desire or need to access your mails like a
regular file, this post is likely not of interest to you. If you did, or at
least find the idea intriguing, read on, because I am looking for feedback! üòé</p>
<p>And so, without further ado, I present to you: <a href="https://man.sr.ht/~bitfehler/m2dir">m2dir</a>. If you like
specifications, just go and read the whole thing, why not. But for those only
mildly curious so far, I‚Äôll spell out the basic idea and provide an example
here.</p>
<section id="The-gist-of-it">
<h2><a href="#The-gist-of-it" aria-hidden="true">_</a>The gist of it</h2>
<p>To get you started, the main design principles of m2dir are:</p>
<ol>
<li>
each message is a file, with a static <a id="fnref1" href="#fn1" role="doc-noteref"><sup>1</sup></a> filename
</li>
<li>
support for arbitrary message flags <a id="fnref2" href="#fn2" role="doc-noteref"><sup>2</sup></a>
</li>
<li>
a simple and standardized directory structure
</li>
<li>
a customizable, human-centric part of the filename
</li>
</ol>
<p>I think the first two are pretty self-explanatory.</p>
<p>About the third one, I‚Äôll just say: if some mail is in a folder
<code>INBOX/subfolder</code>, then the file is in <code>$MAIL/INBOX/subfolder</code>. There is no
<code>cur</code> or <code>new</code>, no <code>.INBOX.subfolder</code>, or any such shenanigans. Plain and
simple, and much more strict about it <a id="fnref3" href="#fn3" role="doc-noteref"><sup>3</sup></a>.</p>
<p>What I am most excited about, though, is number four. The spec only dictates
that each filename must end a certain way. Since it can be parsed from the end,
the beginning of the filename is up to the application, and by extension to the
user. The spec provides an example, which I will also use here for
illustration. A user might choose a naming scheme such that they may end up
with the following filename:</p>
<p><code>2023-09-04_13:47_builds@sr.ht:GTfrlwJfN5vyR28R</code></p>
<p>For any spec-compliant application, only the part <code>:GTfrlwJfN5vyR28R</code> is
relevant - that‚Äôs the message‚Äôs unique ID. In fact, the spec even <em>forbids</em>
applications from attempting to parse the other part. That part is called the
<em>human-centric</em> part of the filename. It is - in this example - chosen to be a
representation of the messages <code>Date</code> and <code>From</code> headers.</p>
<p>Note that this is merely a <em>subjective</em> example. So, what value would such a
naming scheme provide (for me)? First and foremost, lexicographical ordering,
which many tools readily provide (<code>ls</code>, <code>| sort</code>, etc.) also establishes
<em>chronological</em> order, which matches <em>my</em> mental model of my mails. In
combination with the ‚Äúfrom‚Äù address, I am confident that, given a moderate
amount of file names, I could pin-point the one I am looking for just from the
filename.</p>
<p>An example use case might be grepping through all mails. Imagine it returns
20-30 matches, and the filenames provide enough context that you can spot the
one you‚Äôre after. How nice would that be?</p>
<p>Or how about cleaning up? Deleting (or moving) all mails from the previous
year would just be a simple shell glob away. The same could be true for
restoring backups, for example.</p>
<p>I mean, I know very few people get excited about using dusty CLI tools on their
mails, but given that there is no reason <em>not to</em>, why not at least make it
possible?</p>
<p>And again, this is just an example of how <em>I</em> would like it. The spec lets you
go crazy. Prefer the time with seconds? No problem. Fancy your dates in roman
numerals? Be my (weird) guest. More seriously, of course, you might live
someplace that uses a different calendar, doesn‚Äôt use Arabic numerals, or maybe
you just don‚Äôt want any date in the filename at all. The spec has you covered,
by not covering this part.</p>
</section>
<section id="Now-what">
<h2><a href="#Now-what" aria-hidden="true">_</a>Now what?</h2>
<p>‚ÄúCool‚Äù, you might think, ‚Äúwhere do I sign up?‚Äù. Well‚Ä¶</p>
<p>There is work ongoing, but frankly, nothing is done yet. In fact, I wanted to
get this out now, because maybe someone out there has some really valuable
feedback that should be incorporated before I declare the spec done. So if you
find this interesting, have questions or comments, why not reach out to the
<a href="https://lists.sr.ht/~bitfehler/m2dir">mailing list</a>?</p>
<p>Just to set expectations, though: drastic changes are very unlikely. This has
been through quite some iterations, and many things are now the way they are
for pretty good reasons. But any arguments may still be worth having, so if in
doubt, I‚Äôd like to hear from you!</p>
<p>That of course also means: if you think this might be something you‚Äôd like to
implement in a project you maintain, there is probably not much harm in
starting with some prototype - any potential changes <em>should</em> be minor. And of
course, let me know about it!</p>
<p>So, there, I did it. I‚Äôd like to thank Drew and Simon for their very early
feedback, which tremendously helped me finding the right direction, and Knut
for his enthusiasm, which helped me to finally kick this out the door!</p>
</section>
</section>
<section role="doc-endnotes">
<hr/>
<ol>
<li id="fn1">
<p>The name of a file does not change when the message‚Äôs flags change,
like it does with Maildir<a href="#fnref1" role="doc-backlink">‚Ü©Ô∏é</a></p>
</li>
<li id="fn2">
<p>Sometimes also called ‚Äúkeywords‚Äù in IMAP<a href="#fnref2" role="doc-backlink">‚Ü©Ô∏é</a></p>
</li>
<li id="fn3">
<p>This paragraph assumes some basic knowledge of Maildir/Maildir++ - if
you‚Äôre not familiar, see my <a href="https://bitfehler.srht.site/posts/2023-09-07_sorry--maildir--i-am-breaking-up-with-you.html">previous rant about it</a><a href="#fnref3" role="doc-backlink">‚Ü©Ô∏é</a></p>
</li>
</ol>
</section>

 </div>
</div></div>
  </body>
</html>
