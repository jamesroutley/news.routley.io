<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/jart/blink/releases/tag/1.0.0">Original</a>
    <h1>Blink 1.0</h1>
    
    <div id="readability-page-1" class="page"><div data-pjax="true" data-test-selector="body-content" data-view-component="true"><p>The Blink Team (short for Blinkenlights) is proud to announce its first milestone release, version 1.0. Blink is a brand-new unprivileged userspace virtual machine that can emulate x86-64-linux binaries on any POSIX platform. It&#39;s basically a 220kb dependency-free static binary that implements about 600 x86 instructions and 180 Linux system calls, which makes Blink pretty good at running simple command line programs.</p>
<div data-snippet-clipboard-copy-content="./configure        # use `./configure --help | less` for help
make -j8           # build blink and blinkenlights
doas make install  # doas is modern sudo
blink program      # use `man blink` for help"><pre><code>./configure        # use `./configure --help | less` for help
make -j8           # build blink and blinkenlights
doas make install  # doas is modern sudo
blink program      # use `man blink` for help
</code></pre></div>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/jart/blink/assets/49262/c303c3ad-88f5-4dab-b432-3252b062c2a8"><img src="https://github.com/jart/blink/assets/49262/c303c3ad-88f5-4dab-b432-3252b062c2a8" alt="image"/></a></p>
<p>Blink has a snappy JIT that in some cases goes 2x faster than Qemu for use-cases like ephemeral programs. That&#39;s because Blink has a baseline JIT that generates code fast using a printf-style DSL. That means Blink has an approachable codebase since we&#39;ve only got 63,500 lines of ANSI C11 code. Blink currently doesn&#39;t even try to perform optimizations, which makes this project a total greenfield for algorithms. The only complicated things it does right now are (1) trapping segfaults to RWX memory fast, (2) managing a trie of semaphores for tracking memory pages, and (3) storing JIT hooks in a multithreaded lockless hashtable. Here&#39;s a screenshot of Blink vs. Qemu running GCC&#39;s CC1 command. You&#39;ll notice that Blink is able to compile Hello World at least 2x faster.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/jart/blink/assets/49262/3243576f-40ff-4ff9-859b-20adaa923be8"><img src="https://github.com/jart/blink/assets/49262/3243576f-40ff-4ff9-859b-20adaa923be8" alt="image"/></a></p>
<p>While the <code>blink</code> command is headless, Blink also has a TUI interface (called <code>blinkenlights</code>) which lets you debug and visualize programs in real time. Here&#39;s an example of it running a bare metal Game of Life demo, written in Rust, which boots from BIOS in i8086 mode, bootstraps to long mode, and then draws to Blinkenlight&#39;s text-based CGA display.</p>
<div data-snippet-clipboard-copy-content="man blinkenlights
blinkenlights -jmr third_party/gameoflife/gameoflife.bin
# Press CTRL-T several times for Turbo mode"><pre><code>man blinkenlights
blinkenlights -jmr third_party/gameoflife/gameoflife.bin
# Press CTRL-T several times for Turbo mode
</code></pre></div>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/jart/blink/assets/49262/f823bcd2-a72a-4858-9681-9ad9b537a74c"><img src="https://github.com/jart/blink/assets/49262/f823bcd2-a72a-4858-9681-9ad9b537a74c" alt="image"/></a></p>
<p>Blinkenlights supports running the dynamically-linked binaries shipped by your Linux distro. Here&#39;s a screenshot of Blink executing the <code>ls</code> program on an actual Alpine Linux install. Alpine is such a great distro for Blink, since Musl Libc only uses the sane POSIX subset of Linux system calls that are easy for Blink to support.</p>
<div data-snippet-clipboard-copy-content="blinkenlights ls  # on alpine linux"><pre><code>blinkenlights ls  # on alpine linux
</code></pre></div>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/jart/blink/assets/49262/5e1ae71b-eeee-48bb-83f6-805b9311b70c"><img src="https://github.com/jart/blink/assets/49262/5e1ae71b-eeee-48bb-83f6-805b9311b70c" alt="image"/></a></p>
<p>The best feature offered by the Blinkenlights TUI is reverse debugging. All you need to do is scroll wheel over the assembly display. Blink also profiles your program functions in real time if you press the <code>p</code> key. You can also control-wheel the memory panels to zoom out memory using a lanczos kernel.</p>
<details open="">
  <summary>
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M16 3.75v8.5a.75.75 0 0 1-1.136.643L11 10.575v.675A1.75 1.75 0 0 1 9.25 13h-7.5A1.75 1.75 0 0 1 0 11.25v-6.5C0 3.784.784 3 1.75 3h7.5c.966 0 1.75.784 1.75 1.75v.675l3.864-2.318A.75.75 0 0 1 16 3.75Zm-6.5 1a.25.25 0 0 0-.25-.25h-7.5a.25.25 0 0 0-.25.25v6.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-6.5ZM11 8.825l3.5 2.1v-5.85l-3.5 2.1Z"></path>
</svg>
    <span aria-label="Video description reverse-debugging2.mp4">reverse-debugging2.mp4</span>
    <span></span>
  </summary>

  <video src="https://user-images.githubusercontent.com/49262/243201910-bc6cf740-a4a8-4fdf-a52b-bad19e76f50c.mp4" data-canonical-src="https://user-images.githubusercontent.com/49262/243201910-bc6cf740-a4a8-4fdf-a52b-bad19e76f50c.mp4" controls="controls" muted="muted">

  </video>
</details>

<p>Blink works best for command line programs, although Blink has <em>some</em> support for emulating GUI applications too. Here&#39;s a screenshot of Blink running the Emacs GUI on Debian Linux.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/jart/blink/assets/49262/93685cab-0bb6-46c4-ba70-9e97b749c64f"><img src="https://github.com/jart/blink/assets/49262/93685cab-0bb6-46c4-ba70-9e97b749c64f" alt="image"/></a></p>
<p>Unlike qemu-user (which only runs on Linux) Blink is able to run on other operating systems. Here&#39;s what happens if you build Blink on Cygwin (Windows) and then run Bash inside an Alpine Linux chroot. Blink emulates the Linux userspace well enough to fool <a href="https://github.com/dylanaraps/neofetch">neofetch</a>, despite Blink being only a 250kb dependency-free executable. See also <a href="https://dl-cdn.alpinelinux.org/alpine/v3.17/releases/x86_64/alpine-minirootfs-3.17.2-x86_64.tar.gz" rel="nofollow">alpine-minirootfs-3.17.2-x86_64.tar.gz</a> and <a href="https://justine.lol/bash-static-x86_64.elf" rel="nofollow">https://justine.lol/bash-static-x86_64.elf</a></p>
<div data-snippet-clipboard-copy-content="./configure --enable-vfs
make -j8 m=tiny
cc -pthread -pie   o/tiny/blink/blink.o o/tiny/blink/blink.a  -lrt -lm  -o o/tiny/blink/blink -lntdll  # xxx
PATH=&#39;/bin:/usr/bin&#39; PS1=&#39;$? &gt; &#39; o/tiny/blink/blink -C alpine-minirootfs-3.17.2-x86_64 bash"><pre>./configure --enable-vfs
make -j8 m=tiny
cc -pthread -pie   o/tiny/blink/blink.o o/tiny/blink/blink.a  -lrt -lm  -o o/tiny/blink/blink -lntdll  <span><span>#</span> xxx</span>
PATH=<span><span>&#39;</span>/bin:/usr/bin<span>&#39;</span></span> PS1=<span><span>&#39;</span>$? &gt; <span>&#39;</span></span> o/tiny/blink/blink -C alpine-minirootfs-3.17.2-x86_64 bash</pre></div>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/jart/blink/assets/49262/00b5af04-53be-433d-8f30-81ec350d36ca"><img src="https://github.com/jart/blink/assets/49262/00b5af04-53be-433d-8f30-81ec350d36ca" alt="image"/></a></p>
<p>Blink works great on Apple Silicon too! Here&#39;s Blink fooling neofetch into thinking MacOS M1 is Alpine x86_64.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/jart/blink/assets/49262/e4af51d0-25cb-4c34-a415-c3b3ed6a221f"><img width="1165" alt="image" src="https://github.com/jart/blink/assets/49262/e4af51d0-25cb-4c34-a415-c3b3ed6a221f"/></a></p>
<h2>Obtaining Blink</h2>
<p>Blink is released under the permissive ISC license. You may download the source code <a href="https://github.com/jart/blink/releases/download/1.0.0/blink-1.0.0.tar.gz">blink-1.0.0.tar.gz</a> and build it yourself on a POSIX with a C11 compiler. You can also download prebuilt binaries attached below, e.g. <a href="https://github.com/jart/blink/releases/download/1.0.0/blink-1.0-linux-x86_64.elf.gz">blink-1.0-linux-x86_64.elf.gz</a> and <a href="https://github.com/jart/blink/releases/download/1.0.0/blink-1.0-linux-aarch64.elf.gz">blink-1.0-linux-aarch64.elf.gz</a>. Finally, if you want to build the ultra tiny version of Blink that&#39;s been advertised, then all you need is the following, which will produce a deterministic binary for Linux x86_64 that&#39;s 221 kilobytes. Please note tiny mode omits some cool features, like system call logging.</p>
<div data-snippet-clipboard-copy-content="wget https://github.com/jart/blink/releases/download/1.0.0/blink-1.0.0.tar.gz
tar xvzf blink-1.0.0.tar.gz
cd blink-1.0.0
./configure MODE=tiny
make -j8 MODE=tiny o/tiny/x86_64/blink/blink
o/third_party/gcc/x86_64/bin/x86_64-linux-musl-strip o/tiny/x86_64/blink/blink
o/tiny/x86_64/blink/blink -v"><pre><code>wget https://github.com/jart/blink/releases/download/1.0.0/blink-1.0.0.tar.gz
tar xvzf blink-1.0.0.tar.gz
cd blink-1.0.0
./configure MODE=tiny
make -j8 MODE=tiny o/tiny/x86_64/blink/blink
o/third_party/gcc/x86_64/bin/x86_64-linux-musl-strip o/tiny/x86_64/blink/blink
o/tiny/x86_64/blink/blink -v
</code></pre></div>
<p>If you want to build Blink as a 119kb binary, then run these commands:</p>
<div data-snippet-clipboard-copy-content="./configure --disable-all MODE=tiny
make -j8 MODE=tiny o/tiny/x86_64/blink/blink
o//third_party/gcc/x86_64/bin/x86_64-linux-musl-strip o/tiny/x86_64/blink/blink
o/tiny/x86_64/blink/blink -v"><pre><code>./configure --disable-all MODE=tiny
make -j8 MODE=tiny o/tiny/x86_64/blink/blink
o//third_party/gcc/x86_64/bin/x86_64-linux-musl-strip o/tiny/x86_64/blink/blink
o/tiny/x86_64/blink/blink -v
</code></pre></div>
<h2>Adopting Blink</h2>
<p>One of the projects currently using Blink is <a href="https://github.com/jart/cosmopolitan">Cosmopolitan Libc</a>. Blink is more embeddable than qemu-x86_64 since Blink is 22x tinier in terms of binary footprint. So what Cosmo does is it vendors prebuilt Blink binaries inside each of the x86-64 executables it compiles. That way, whenever someone tries to run these programs on a different architecture like Arm, the <a href="https://justine.lol/ape.html" rel="nofollow">Actually Portable Executable</a> shell script wrapper will simple extract the appropriate <code>blink</code> binary and re-run itself.</p>
<h2>Joining Blink</h2>
<p>If you find Blink useful or interesting, then please join our Discord community <a href="https://discord.gg/HQNA9faw" rel="nofollow">https://discord.gg/HQNA9faw</a> so you can say thanks and meet the team that built it, namely <a data-hovercard-type="user" data-hovercard-url="/users/jart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jart">@jart</a>, <a data-hovercard-type="user" data-hovercard-url="/users/trungnt2910/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/trungnt2910">@trungnt2910</a>, <a data-hovercard-type="user" data-hovercard-url="/users/tkchia/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tkchia">@tkchia</a>, and <a data-hovercard-type="user" data-hovercard-url="/users/ghaerr/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ghaerr">@ghaerr</a>. The Discord is called &#34;Redbean&#34; and Blink development happens in the #blink channel.</p></div></div>
  </body>
</html>
