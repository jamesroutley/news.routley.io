<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://devblogs.microsoft.com/oldnewthing/20250924-00/?p=111624">Original</a>
    <h1>Why is Windows still tinkering with critical sections? – The Old New Thing</h1>
    
    <div id="readability-page-1" class="page"><div id="single-wrapper">
    
    <article data-clarity-region="article" id="post-111624">
        <div data-bi-area="body_article" data-bi-id="post_page_body_article">
            <p><a href="https://cookieplmonster.github.io/about/">Adrian aka Silent aka CookiePLMonster</a> did a deep investigation into <a title="How a 20 year old bug in GTA San Andreas surfaced in Windows 11 24H2" href="https://cookieplmonster.github.io/2025/04/23/gta-san-andreas-win11-24h2-bug/"> how a 20 year old bug in GTA San Andreas surfaced in Windows 11 24H2</a>.</p>
<p>One reaction I saw to this was “Why is Windows still tinkering with critical sections? Surely there aren’t any bugs in it after all these years.”</p>
<p>While there may not be bugs in critical sections, there may still be performance issues. And since critical sections are so heavily used, small performance issues can add up to large ones.</p>
<p>We saw some time ago that many synchronization objects were made unfair to <a title="Anti-convoy locks in Windows Server 2003 SP1 and Windows Vista" href="https://joeduffyblog.com/2006/12/14/anticonvoy-locks-in-windows-server-2003-sp1-and-windows-vista/"> avoid lock convoys</a>.</p>
<p>At around the same time, critical sections were optimized to reduce their memory footprint, particularly their cost to non-paged pool. Non-paged pool is an expensive resource since (as the name suggests) it cannot be paged out. On systems doing large-scale computing, even a small cost in non-paged pool is multiplied by a enormous number of critical sections, resulting in outsized non-paged pool pressure that creates performance and reliability problems.</p>
<p>More recently, changes were made to critical sections to try to detect and mitigate priority inversions, and (what is significant in 24H2) those mitigations were optimized further by moving more of the work into user mode and avoiding some cases that previously entailed kernel mode transitions.</p>
<p>The critical section may be an old dog, but it’s still learning new tricks in order to keep pace with a computing environment that is bigger, faster, and more concurrent that it was three decades ago.</p>
        </div><!-- .entry-content -->

        <!-- AI Disclaimer -->
            </article>
    
</div></div>
  </body>
</html>
