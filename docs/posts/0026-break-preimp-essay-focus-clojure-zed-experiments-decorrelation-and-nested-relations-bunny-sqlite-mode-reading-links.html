<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://scattered-thoughts.net/log/0026/">Original</a>
    <h1>0026: break, preimp essay, focus &#43; clojure, zed experiments, decorrelation and nested relations, bunny, sqlite mode, reading, links</h1>
    
    <div id="readability-page-1" class="page"><article>
  <h2 id="break">break</h2>
<p>Nobody could come to our covid-era wedding, so instead we have a wave of family and friends visiting for our first anniversary. Which means that between July 16 - Aug 7 I&#39;m barely computering at all. Progress will resume Aug 8.</p>
<h2 id="preimp">preimp</h2>
<p>I wrote a draft of an essay explaining preimp: <a href="https://scattered-thoughts.net/writing/the-program-is-the-database-is-the-interface">the program is the database is the interface</a>.</p>
<p>It&#39;s a long way from publishable. </p>
<p>At minimum I want to allow direct editing of values in derived views, which means that each value needs to track it&#39;s upstream source, which means that I can&#39;t do it in clojure (because only collections can have metadata, not numbers, strings, nulls etc).</p>
<p>I looked around to see if I could at least find a language implementation that I could easily modify but most implementations rely on nan-boxing for numbers, which makes it very difficult to modify the implementation to add extra metadata to numbers. The best candidate so far is <a href="https://janet-lang.org/">janet</a> - there&#39;s an compile-time option to disable nan-boxing.</p>
<p>I also want to use the destructuring forms and type annotations from the argument lists in functions to generate better function UIs. Eg for <code>(fn [{^String foo :foo ^Bool bar :bar}] ...)</code> I would render a form with a textbox input labeled &#39;foo&#39; and a checkbox input labeled &#39;bar&#39;. I can get this information in clojure but it&#39;s not compatible with the incremental evaluation I use for preimp. And it doesn&#39;t seem like janet has any way of adding type tags or other metadata to destructuring forms.</p>
<p>Finally, I would love to support <a href="https://scattered-thoughts.net/writing/making-live-repls-behave">live eval</a> which is difficult in any language implementation that wasn&#39;t explicitly designed for it.</p>
<p>So increasingly it looks like August might be spent hacking together a simple language where I can support all these features.</p>
<p>Clojurescript woes continue too. In the draft essay above I show how the exported code can be run in the repl. In reality it took me over an hour to get a working clojurescript repl due to issues like <a href="https://github.com/emezeske/lein-cljsbuild/issues/490">not being able to start a repl in a too-long working directory</a>.</p>
<h2 id="focus">focus</h2>
<p>I ported <a href="https://github.com/jamii/focus">focus</a> from sdl to <a href="https://github.com/hexops/mach-glfw">mach-glfw</a>. This fixed a few bugs - the most annoying was that if I started focus from the terminal then sdl would report a spurious enter keydown event. </p>
<p>I&#39;ve decided not to try to build on top of <a href="https://github.com/hexops/mach">mach</a> itself until the apis settle down, but I am mirroring their event types and I pushed <a href="https://github.com/hexops/mach/pull/377">my additions</a> upstream.</p>
<p>I added clojure syntax highlighting and structural navigation. I had to <a href="https://github.com/jamii/focus/blob/14eb9c0cce756611d376f07542b8c61e83785e4e/lib/focus/language/clojure.zig">write a clojure tokenizer from scratch</a> since all the existing parsers are either java or js.</p>
<video controls="">
  <source src="/log/0026/clojure.mp4" type="video/mp4"/>
</video>
<p>Completions, smart indent, paren matching etc are now language-aware too, and I added a generic language mode that works ok for most c-like languages.</p>
<h2 id="zed">zed</h2>
<p>I mentioned <a href="https://zed.brimdata.io/">zed</a> previously. Here is a <a href="https://www.youtube.com/watch?v=3eHiZ6omzs">talk</a> introducing the ideas in more depth. </p>
<p>I spent some time reading the spec and trying out examples. </p>
<p>The data language seems ideal. The storage model and type system are very much aligned with the ideas I was pursuing with <a href="https://scattered-thoughts.net/writing/imp-heterogenous-types/">imp&#39;s gradual typing</a> - all data is self-describing but efficient binary representations still exist and schemas can be enforced using first-class types. The only major quibble I had is that all values are nullable. </p>
<p>The query language has some really nice features. Errors are first-class value and are propagated by most functions. Various shorthands make the language usable <a href="https://youtu.be/InT-7WZ5Y2Y?t=590">as a search bar</a> while still allowing complex queries. But when I tried to express the <a href="https://gist.github.com/jamii/001a91b7d50fc2096f7888a394374fe7">tagging logic used in preimp</a> every approach bumped up against one problem or another. The most troublesome is that streams can&#39;t be named - which strikes me as a repeat of the mistakes of sql before the introduction of CTEs. But the language is still very young, so there is plenty of time to improve. </p>
<h2 id="decorrelation-and-nested-relations">decorrelation and nested relations</h2>
<p>The trouble with <a href="https://scattered-thoughts.net/writing/materialize-decorrelation">the way that materialize decorrelates subqueries</a> is that it produces a query plan which is a dag rather than a tree, and that makes other downstream optimizations harder to express.</p>
<p>Semantically, subqueries produce nested relations. But existing query planners require every plan to produce a single flat relation. Encoding arbitrarily nested relations into a single flat relation is very difficult, especially if you also need your encoding to be stable wrt to incremental updates.</p>
<p>What materialize currently does is keep the outer query around, so that it can be joined against the result of the subquery to lazily reconstruct the nested relations. This is just a way to encode nested relations using multiple flat relations. But the query planner doesn&#39;t know about this encoding.</p>
<p>I think it might work better to have an IR where each plan is a tree and each operator produces a nested relation. The pipeline would then be:</p>
<ul>
<li>sql -&gt; nested ir (lift relational operations out of scalar operations)</li>
<li>nested ir -&gt; nested ir (traditional optimizations here)</li>
<li>nested ir -&gt; flat ir (replace nested relations with multiple flat relations, produces a dag)</li>
</ul>
<h2 id="bunny">bunny</h2>
<p>I moved <a href="https://scattered-thoughts.net/">scattered-thoughts.net</a> from <a href="https://app.netlify.com/">netlify</a> to <a href="https://bunny.net/">bunny</a>. The tooling for uploading static content is not nearly as nice but the site now loads much faster outside of the US/EU, and as a bonus I get raw (anonymized) server logs. I expect the total cost to be &lt;$1 per month.</p>
<p>(Bunny vs netlify from a 3g connection in India)</p>
<p><img src="https://scattered-thoughts.net/log/0026/bench.png" alt=""/></p>
<h2 id="sqlite-mode">sqlite mode</h2>
<p>I complained in <a href="https://scattered-thoughts.net/writing/the-shape-of-data">the shape of data</a> that most sql databases don&#39;t print data in the same syntax that you must use to enter it. </p>
<p>Sqlite is an exception - with <code>.mode quote</code> it prints literals using the literal syntax.</p>
<pre><code><span>sqlite&gt; create table foo(x text, y float);
</span><span>sqlite&gt; insert into foo values (&#39;foo&#39;&#39;bar&#39;, 3.14);
</span><span>sqlite&gt; select * from foo;
</span><span>foo&#39;bar|3.14
</span><span>sqlite&gt; .mode quote
</span><span>sqlite&gt; select * from foo;
</span><span>&#39;foo&#39;&#39;bar&#39;,3.1400000000000001243
</span></code></pre>
<h2 id="reading">reading</h2>
<p><a href="https://arxiv.org/pdf/1805.04263.pdf">OpSets: Sequential Specifications for Replicated Datatypes</a>. A generic method for designing crdts by deterministically extending the causal order to some arbitrary total order. </p>
<p><a href="https://www.goodreads.com/book/show/41817546-the-intelligence-trap">The Intelligence Trap</a>. Covering recent research in rationality (why smart people make dumb decisions). But published in 2019 and still uncritically quoting research that weathered the reproducibility crisis. Eg has a whole chapter reporting experiments on <a href="https://en.wikipedia.org/wiki/Grit_(personality_trait)">grit</a> and <a href="https://en.wikipedia.org/wiki/Mindset#Fixed_and_growth_mindset">growth mindset</a> interventions in schools, but fails to mention that wide-scale testing of these interventions has shown <a href="https://journals.sagepub.com/doi/abs/10.1177/0956797617739704?journalCode=pssa">near-zero effect</a>. Read <a href="https://www.goodreads.com/en/book/show/42041926">Scout Mindset</a> instead, in which Julia Galef actually reads the underlying papers and reports the weight of evidence accurately.</p>
<p>Redpanda are offering <a href="https://go.redpanda.com/webassembly-book">free copies</a> of WebAssembly: The Definitive Guide. It&#39;s not a particularly deep book, but a reasonable starting point if you don&#39;t know anything about wasm yet.</p>
<p><a href="https://www.goodreads.com/book/show/31283667-stubborn-attachments">Stubborn Attachments</a>. An argument for longer-term thinking, but from such a theoretical point of view that I found it hard to sustain interest. But I liked this thought experiment on how to hold political views:</p>
<blockquote>
<p>That means your political views, though they are the best ones out there, will have grave negative consequences with probability .98 (one minus two percent, the latter being the chance that you are right on the details of the means-end relationships). In this setting, how confident should you really be about the details of your political beliefs? How firm should your dogmatism be about means-ends relationships? Probably not very; better to adopt a tolerant demeanor and really mean it. As a general rule, we should not pat ourselves on the back and feel that we are on the correct side of an issue.</p>
</blockquote>
<p><a href="https://www.goodreads.com/en/book/show/335864">The Practicing Mind</a>. About being mostly process-oriented in the moment, rather than mostly goal-oriented. Nothing particularly novel or compelling compared to other similar books. I much preferred <a href="https://www.goodreads.com/en/book/show/501200">The Rock Warriors Way</a>, despite it&#39;s goofiness. </p>
<p><a href="https://www.goodreads.com/book/show/1752380.Changing_Minds">Changing Minds</a>. An older book about how teaching programming in schools is going to revolutionize education. 21 years later this has yet to materialize, but I still constantly talk to people who venerate these ideas. I&#39;d be interested in reading an honest attempt to explain why the peak of computer-based education so far looks like the <a href="https://www.khanacademy.org/">Khan Academy</a> rather than the &#39;new literacy&#39; that has been thrown around for decades.</p>
<h2 id="links">links</h2>
<p><a href="https://www.cell-lang.net/example.html">cell</a> is a relational language that bears an uncanny resemblance to the ideas in <a href="https://press.princeton.edu/books/hardcover/9780691225388/the-essence-of-software">the essence of software</a>. Despite the radio silence in the last few years, it appears there is still active work on the new c++ backend.</p>
<p>Ink+Switch <a href="https://www.inkandswitch.com/summit-010-berlin/">published notes</a> from their Berlin conference.</p>
<p><a href="https://github.com/uNetworking/libEpollFuzzer">libEpollFuzzer</a> mocks the epoll syscalls on linux to fuzz network applications. </p>
<p>I&#39;ve mentioned <a href="https://github.com/skiplang/skip">skiplang</a> a while ago - an imperative language that supports incremental/reactive programming. I&#39;d thought it was dormant, but apparently the authors were quietly working on <a href="https://skdb.io/docs.html">skdb</a> instead - a (proprietary?) sqlite-compatible database with incrementally maintained views. I haven&#39;t yet tested it for internal consistency but the documentation is promising.</p>
<p>Examples of information-dense responsive UIs that are trivial with imgui but feel very difficult to implement on the web:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=r9eQth4Q5jg">RemedyBG</a></li>
<li><a href="https://www.youtube.com/watch?v=30wpRpHTTag">Tracy</a></li>
<li><a href="https://vimeo.com/483795097">WhiteBox</a></li>
<li><a href="https://github.com/Celtoys/Remotery">Remotery</a></li>
</ul>
<p>&#34;<a href="https://zeux.io/2022/01/08/on-proebstings-law/">LLVM 11 tends to take 2x longer to compile code with optimizations, and as a result produces code that runs 10-20% faster [...] compared to LLVM 2.7 which is more than 10 years old</a>&#34;</p>
<p>&#34;<a href="https://www.divergent-desktop.org/blog/2020/08/10/principles-overview/#p12">Simplicity is systemic [...] an important aspect is that of a possible local &#39;for a component&#39; perfect simple solution can be &#39;for the system&#39;, a complex one - and vice versa.</a>&#34;</p>
<p><a href="https://mobile.twitter.com/sadisticsystems/status/1465644639059382279">Tyler Neely experimenting with building a database only from components that can each be written in a day.</a></p>

</article></div>
  </body>
</html>
