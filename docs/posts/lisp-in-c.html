<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/codr7/sharpl">Original</a>
    <h1>Show HN: Lisp in C#</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<div data-snippet-clipboard-copy-content="$ dotnet run
sharpl v11

   1 (say &#39;hello)
   2 
hello"><pre><code>$ dotnet run
sharpl v11

   1 (say &#39;hello)
   2 
hello
</code></pre></div>

<p dir="auto">Sharpl is a custom Lisp interpreter implemented in C#.</p>

<ul dir="auto">
<li>Pairs, arrays, maps and method compositions have dedicated syntax.</li>
<li>Varargs use <code>*</code>, similar to Python.</li>
<li>Splatting is supported using <code>*</code>, simlar to Python.</li>
<li>Unified, deeply integrated iterator protocol.</li>
<li>Default decimal type is fixpoint.</li>
<li>Nil is called <code>_</code>.</li>
<li>Both true (<code>T</code>) and false (<code>F</code>) are defined.</li>
<li>Zeros and empty strings, arrays and maps are considered false.</li>
<li><code>=</code> is generic and compares values deeply, <code>is</code> may be used to compare identity.</li>
<li>Lambdas actually look like anonymous methods.</li>
<li><code>eval</code> evaluates its arguments at emit time.</li>
<li>Explicit tail calls using <code>return</code>.</li>
<li>There is no List, except for nested pairs, which is not as bad as it sounds thanks to the syntax.</li>
<li>Parens are used for calls only.</li>
<li>Most things are callable, simlar to Clojure.</li>
<li>Maps are ordered, not hashed.</li>
<li>Errors include line numbers, even inside the REPL.</li>
</ul>

<p dir="auto">Bindings come in two flavors, with lexical or dynamic scope.</p>

<p dir="auto">New lexically scoped bindings may be created using <code>let</code>.</p>

<p dir="auto"><code>3</code></p>

<p dir="auto">New dynamically scoped bindings may be created using <code>define</code>.</p>
<div data-snippet-clipboard-copy-content="(define foo 35)
  
(^bar []
  foo)

(let [foo (+ foo 7)]
  (bar))"><pre><code>(define foo 35)
  
(^bar []
  foo)

(let [foo (+ foo 7)]
  (bar))
</code></pre></div>
<p dir="auto"><code>42</code></p>

<p dir="auto"><code>if</code> may be used to conditionally evaluate a block of code.</p>


<p dir="auto"><code>if-else</code> may be used to specify an else-clause.</p>

<p dir="auto"><code>2</code></p>

<p dir="auto">New methods may be defined using <code>^</code>.</p>

<p dir="auto"><code>42</code></p>

<p dir="auto">Leaving out the name creates a lambda.</p>
<div data-snippet-clipboard-copy-content="(let [f (^[x] x)]
  (f 42))"><pre><code>(let [f (^[x] x)]
  (f 42))
</code></pre></div>
<p dir="auto"><code>42</code></p>

<p dir="auto">External bindings are captured at method definition time.</p>
<div data-snippet-clipboard-copy-content="(^make-countdown [max]
  (let [n max]
    (^[] (dec n))))

(define foo (make-countdown 42))

(foo)"><pre><code>(^make-countdown [max]
  (let [n max]
    (^[] (dec n))))

(define foo (make-countdown 42))

(foo)
</code></pre></div>
<p dir="auto"><code>41</code></p>

<p dir="auto"><code>40</code></p>

<p dir="auto"><code>return</code> may be used to convert any call into a tail call.</p>
<p dir="auto">This example will keep going forever without consuming more space:</p>
<div data-snippet-clipboard-copy-content="(^foo []
  (return (foo)))

(foo)"><pre><code>(^foo []
  (return (foo)))

(foo)
</code></pre></div>
<p dir="auto">Without <code>return</code> it quickly runs out of space:</p>

<div data-snippet-clipboard-copy-content="System.IndexOutOfRangeException: Index was outside the bounds of the array."><pre><code>System.IndexOutOfRangeException: Index was outside the bounds of the array.
</code></pre></div>

<p dir="auto"><code>methods</code> may be defined as taking a variable number of arguments by suffixing the last parameter with <code>*</code>.
The name is bound to an array containing all trailing arguments when the method is called.</p>
<div data-snippet-clipboard-copy-content="(^foo [bar*]
  (say bar*))
  
(foo 1 2 3)"><pre><code>(^foo [bar*]
  (say bar*))
  
(foo 1 2 3)
</code></pre></div>


<p dir="auto">Methods may be composed using <code>&amp;</code>.</p>
<div data-snippet-clipboard-copy-content="(^foo [x]
  (+ x 1))
  
(^bar [x]
  (* x 2))

(let [f foo &amp; bar]
  (say f)
  (f 20))"><pre><code>(^foo [x]
  (+ x 1))
  
(^bar [x]
  (* x 2))

(let [f foo &amp; bar]
  (say f)
  (f 20))
</code></pre></div>

<p dir="auto"><code>42</code></p>

<p dir="auto">Expressions may be quoted by prefixing with <code>&#39;</code>.</p>

<p dir="auto"><code>=</code> may be used to compare values deeply, while <code>is</code> compares identities.</p>
<p dir="auto">For others; like arrays and maps; two values may well be equal despite having different identities.</p>

<p dir="auto"><code>T</code></p>

<p dir="auto"><code>F</code></p>


<p dir="auto">Identifiers turn into symbols when quoted.</p>
<div data-snippet-clipboard-copy-content="(= (Symbol &#39;foo 42) &#39;foo42)"><pre><code>(= (Symbol &#39;foo 42) &#39;foo42)
</code></pre></div>
<p dir="auto"><code>T</code></p>

<p dir="auto">Strings use double quotes.</p>

<p dir="auto"><code>&#34;FOO&#34;</code></p>

<p dir="auto">Integers support the regular arithmetic operations.</p>

<p dir="auto"><code>5</code></p>
<p dir="auto">Negative integers lack syntax, and must be created by way of subtraction.</p>

<p dir="auto"><code>-42</code></p>

<p dir="auto">Decimal expressions are read as fixpoint values with specified number of decimals.</p>

<p dir="auto"><code>1.234</code></p>
<p dir="auto">Leading zero is optional.</p>

<p dir="auto"><code>T</code></p>
<p dir="auto">Also like integers; negative fixpoints lack syntax, and must be created by way of subtraction.</p>

<p dir="auto"><code>-1.234</code></p>


<p dir="auto">Pairs may be formed by putting a colon between two values.</p>

<p dir="auto"><code>1:2:3</code></p>
<p dir="auto">Or by calling the constructor explicitly.</p>

<p dir="auto"><code>1:2:3</code></p>

<p dir="auto">Arrays are fixed size sequences of values.</p>

<p dir="auto">Or by calling the constructor explicitly.</p>

<p dir="auto"><code>[1 2 3]</code></p>

<p dir="auto">Maps are ordered mappings from keys to values.</p>

<p dir="auto">Or by calling the constructor explicitly.</p>
<div data-snippet-clipboard-copy-content="(Map &#39;[foo:1 bar:2 baz:3]*)"><pre><code>(Map &#39;[foo:1 bar:2 baz:3]*)
</code></pre></div>
<p dir="auto"><code>{&#39;bar:2 &#39;baz:3 &#39;foo:1}</code></p>

<p dir="auto"><code>reduce</code> may be used to transform any iterable into a single value.</p>

<p dir="auto"><code>6</code></p>
<p dir="auto">Which could also be expressed in a more condensed form thanks to the fact that integers are iterable.</p>


<p dir="auto"><code>lib</code> may be used to define/extend libraries.</p>
<div data-snippet-clipboard-copy-content="(lib foo
  (define bar 42))

foo/bar"><pre><code>(lib foo
  (define bar 42))

foo/bar
</code></pre></div>
<p dir="auto"><code>42</code></p>
<p dir="auto">When called with one argument, it specifies the current library for the entire file.</p>
<div data-snippet-clipboard-copy-content="(lib foo)
(define bar 42)"><pre><code>(lib foo)
(define bar 42)
</code></pre></div>
<p dir="auto">And when called without arguments, it returns the current library.</p>

<p dir="auto"><code>(Lib user)</code></p>

<p dir="auto"><code>fail</code> may be used to signal an error.</p>

<div data-snippet-clipboard-copy-content="Sharpl.EvalError: repl@1:2 bummer"><pre><code>Sharpl.EvalError: repl@1:2 bummer
</code></pre></div>

<p dir="auto"><code>eval</code> may be used to evaluate a block of code at emit time.</p>
<div data-snippet-clipboard-copy-content="(eval (say &#39;emitting) 42)"><pre><code>(eval (say &#39;emitting) 42)
</code></pre></div>

<p dir="auto"><code>42</code></p>

<p dir="auto"><code>check</code> fails with an error if the result of evaluating its body isn&#39;t equal to the specified value.</p>
<p dir="auto">Take a look at the <a href="https://github.com/codr7/sharpl/blob/main/tests/all-tests.sl">test suite</a> for examples.</p>

<div data-snippet-clipboard-copy-content="Sharpl.EvalError: repl@1:2 Check failed: expected 5, actual 4!"><pre><code>Sharpl.EvalError: repl@1:2 Check failed: expected 5, actual 4!
</code></pre></div>
<p dir="auto">When called with a single argument, it simply checks if it&#39;s true.</p>

<div data-snippet-clipboard-copy-content="Sharpl.EvalError: repl@1:2 Check failed: expected T, actual 0!"><pre><code>Sharpl.EvalError: repl@1:2 Check failed: expected T, actual 0!
</code></pre></div>

<p dir="auto"><code>benchmark</code>may be used to measure the number of milliseconds it takes to repeat a block of code N times with warmup.</p>
<div data-snippet-clipboard-copy-content="dotnet run -c Release benchmarks.sl
497
137
829"><pre><code>dotnet run -c Release benchmarks.sl
497
137
829
</code></pre></div>

<p dir="auto"><code>emit</code> may be used to display the VM operations emitted for an expression.</p>
<div data-snippet-clipboard-copy-content="(emit (+ 1 2))
 
1    Push 1
2    Push 2
3    CallMethod (+ []) 2 False"><pre><code>(emit (+ 1 2))
 
1    Push 1
2    Push 2
3    CallMethod (+ []) 2 False
</code></pre></div>
</article></div></div>
  </body>
</html>
