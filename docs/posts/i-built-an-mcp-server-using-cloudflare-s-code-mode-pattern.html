<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/jx-codes/codemode-mcp">Original</a>
    <h1>Show HN: I built an MCP server using Cloudflare&#39;s code mode pattern</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">A local implementation of the &#34;Code Mode&#34; workflow for MCP servers. Instead of struggling with multiple tool calls, LLMs write TypeScript/JavaScript code that calls a simple HTTP proxy to access your MCP servers.</p>
<p dir="auto">Note: It does not attempt to handle the MCP -&gt; typescript API transpilation layer. Would be cool but I really wanted to test the workflow.</p>
<p dir="auto"><a href="https://blog.cloudflare.com/code-mode/" rel="nofollow">https://blog.cloudflare.com/code-mode/</a></p>

<p dir="auto">This implements the core insight that <strong>LLMs are much better at writing code than at tool calling</strong>. Instead of exposing many tools directly to the LLM (which it struggles with), this server gives the LLM just one tool: <code>execute_code</code>. The LLM writes code that makes HTTP requests to access your other MCP servers.</p>

<ol dir="auto">
<li><strong>LLM gets one tool</strong>: <code>execute_code</code> - executes TypeScript/JavaScript</li>
<li><strong>LLM writes code</strong>: Uses <code>fetch()</code> to call <code>http://localhost:3001/mcp/*</code> endpoints</li>
<li><strong>HTTP proxy forwards</strong>: Transparently proxies requests to your actual MCP servers</li>
<li><strong>Results flow back</strong>: Through the code execution to the LLM</li>
</ol>
<p dir="auto">This gives you all the benefits of complex tool orchestration, but leverages what LLMs are actually good at: writing code.</p>


<ul dir="auto">
<li><a href="https://bun.sh" rel="nofollow">Bun</a> (latest version)</li>
<li><a href="https://deno.land" rel="nofollow">Deno</a> (for code execution sandbox)</li>
<li>An MCP-compatible client (Claude Desktop, Cursor, VS Code with Copilot, etc.)</li>
</ul>

<ol dir="auto">
<li><strong>Clone the repository</strong></li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/jx-codes/codemode-mcp.git
cd codemode-mcp"><pre>git clone https://github.com/jx-codes/codemode-mcp.git
<span>cd</span> codemode-mcp</pre></div>
<ol start="2" dir="auto">
<li><strong>Install dependencies</strong></li>
</ol>

<ol start="3" dir="auto">
<li><strong>Configure the server</strong> (optional)</li>
</ol>
<p dir="auto">Create a <code>codemode-config.json</code> file to customize settings:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
   &#34;proxyPort&#34;: 3001,
   &#34;configDirectories&#34;: [
      &#34;~/.config/mcp/servers&#34;,
      &#34;./mcp-servers&#34;,
      &#34;./&#34;
   ]
}"><pre>{
   <span>&#34;proxyPort&#34;</span>: <span>3001</span>,
   <span>&#34;configDirectories&#34;</span>: [
      <span><span>&#34;</span>~/.config/mcp/servers<span>&#34;</span></span>,
      <span><span>&#34;</span>./mcp-servers<span>&#34;</span></span>,
      <span><span>&#34;</span>./<span>&#34;</span></span>
   ]
}</pre></div>
<ol start="4" dir="auto">
<li><strong>Set up your MCP servers</strong></li>
</ol>
<p dir="auto">Create a <code>.mcp.json</code> file with your MCP server configurations in any of the directories you specified above:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
   &#34;mcpServers&#34;: {
      &#34;fs&#34;: {
         &#34;command&#34;: &#34;npx&#34;,
         &#34;args&#34;: [&#34;-y&#34;, &#34;@modelcontextprotocol/server-filesystem&#34;, &#34;/tmp&#34;],
         &#34;env&#34;: {}
      }
   }
}"><pre>{
   <span>&#34;mcpServers&#34;</span>: {
      <span>&#34;fs&#34;</span>: {
         <span>&#34;command&#34;</span>: <span><span>&#34;</span>npx<span>&#34;</span></span>,
         <span>&#34;args&#34;</span>: [<span><span>&#34;</span>-y<span>&#34;</span></span>, <span><span>&#34;</span>@modelcontextprotocol/server-filesystem<span>&#34;</span></span>, <span><span>&#34;</span>/tmp<span>&#34;</span></span>],
         <span>&#34;env&#34;</span>: {}
      }
   }
}</pre></div>


<p dir="auto">Instead of direct tool calling, the LLM writes:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// List available servers
const servers = await fetch(&#34;http://localhost:3001/mcp/servers&#34;).then((r) =&gt;
  r.json()
);
console.log(&#34;Available servers:&#34;, servers);

// Call a tool on the filesystem server
const result = await fetch(&#34;http://localhost:3001/mcp/call&#34;, {
  method: &#34;POST&#34;,
  headers: { &#34;Content-Type&#34;: &#34;application/json&#34; },
  body: JSON.stringify({
    server: &#34;fs&#34;,
    tool: &#34;read_file&#34;,
    args: { path: &#34;/tmp/example.txt&#34; },
  }),
}).then((r) =&gt; r.json());

console.log(&#34;File contents:&#34;, result);"><pre><span>// List available servers</span>
<span>const</span> <span>servers</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;http://localhost:3001/mcp/servers&#34;</span><span>)</span><span>.</span><span>then</span><span>(</span><span>(</span><span>r</span><span>)</span> <span>=&gt;</span>
  <span>r</span><span>.</span><span>json</span><span>(</span><span>)</span>
<span>)</span><span>;</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Available servers:&#34;</span><span>,</span> <span>servers</span><span>)</span><span>;</span>

<span>// Call a tool on the filesystem server</span>
<span>const</span> <span>result</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;http://localhost:3001/mcp/call&#34;</span><span>,</span> <span>{</span>
  <span>method</span>: <span>&#34;POST&#34;</span><span>,</span>
  <span>headers</span>: <span>{</span> <span>&#34;Content-Type&#34;</span>: <span>&#34;application/json&#34;</span> <span>}</span><span>,</span>
  <span>body</span>: <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span>
    <span>server</span>: <span>&#34;fs&#34;</span><span>,</span>
    <span>tool</span>: <span>&#34;read_file&#34;</span><span>,</span>
    <span>args</span>: <span>{</span> <span>path</span>: <span>&#34;/tmp/example.txt&#34;</span> <span>}</span><span>,</span>
  <span>}</span><span>)</span><span>,</span>
<span>}</span><span>)</span><span>.</span><span>then</span><span>(</span><span>(</span><span>r</span><span>)</span> <span>=&gt;</span> <span>r</span><span>.</span><span>json</span><span>(</span><span>)</span><span>)</span><span>;</span>

<span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;File contents:&#34;</span><span>,</span> <span>result</span><span>)</span><span>;</span></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Chaining Multiple Operations</h3><a id="user-content-chaining-multiple-operations" aria-label="Permalink: Chaining Multiple Operations" href="#chaining-multiple-operations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The real power shows when chaining operations:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// Get list of files
const files = await fetch(&#34;http://localhost:3001/mcp/call&#34;, {
  method: &#34;POST&#34;,
  headers: { &#34;Content-Type&#34;: &#34;application/json&#34; },
  body: JSON.stringify({
    server: &#34;fs&#34;,
    tool: &#34;list_directory&#34;,
    args: { path: &#34;/tmp&#34; },
  }),
}).then((r) =&gt; r.json());

// Process each file
for (const file of files.content[0].text.split(&#34;\n&#34;)) {
  if (file.endsWith(&#34;.txt&#34;)) {
    const content = await fetch(&#34;http://localhost:3001/mcp/call&#34;, {
      method: &#34;POST&#34;,
      headers: { &#34;Content-Type&#34;: &#34;application/json&#34; },
      body: JSON.stringify({
        server: &#34;fs&#34;,
        tool: &#34;read_file&#34;,
        args: { path: `/tmp/${file}` },
      }),
    }).then((r) =&gt; r.json());

    console.log(`${file}: ${content.content[0].text.length} characters`);
  }
}"><pre><span>// Get list of files</span>
<span>const</span> <span>files</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;http://localhost:3001/mcp/call&#34;</span><span>,</span> <span>{</span>
  <span>method</span>: <span>&#34;POST&#34;</span><span>,</span>
  <span>headers</span>: <span>{</span> <span>&#34;Content-Type&#34;</span>: <span>&#34;application/json&#34;</span> <span>}</span><span>,</span>
  <span>body</span>: <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span>
    <span>server</span>: <span>&#34;fs&#34;</span><span>,</span>
    <span>tool</span>: <span>&#34;list_directory&#34;</span><span>,</span>
    <span>args</span>: <span>{</span> <span>path</span>: <span>&#34;/tmp&#34;</span> <span>}</span><span>,</span>
  <span>}</span><span>)</span><span>,</span>
<span>}</span><span>)</span><span>.</span><span>then</span><span>(</span><span>(</span><span>r</span><span>)</span> <span>=&gt;</span> <span>r</span><span>.</span><span>json</span><span>(</span><span>)</span><span>)</span><span>;</span>

<span>// Process each file</span>
<span>for</span> <span>(</span><span>const</span> <span>file</span> <span>of</span> <span>files</span><span>.</span><span>content</span><span>[</span><span>0</span><span>]</span><span>.</span><span>text</span><span>.</span><span>split</span><span>(</span><span>&#34;\n&#34;</span><span>)</span><span>)</span> <span>{</span>
  <span>if</span> <span>(</span><span>file</span><span>.</span><span>endsWith</span><span>(</span><span>&#34;.txt&#34;</span><span>)</span><span>)</span> <span>{</span>
    <span>const</span> <span>content</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;http://localhost:3001/mcp/call&#34;</span><span>,</span> <span>{</span>
      <span>method</span>: <span>&#34;POST&#34;</span><span>,</span>
      <span>headers</span>: <span>{</span> <span>&#34;Content-Type&#34;</span>: <span>&#34;application/json&#34;</span> <span>}</span><span>,</span>
      <span>body</span>: <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span>
        <span>server</span>: <span>&#34;fs&#34;</span><span>,</span>
        <span>tool</span>: <span>&#34;read_file&#34;</span><span>,</span>
        <span>args</span>: <span>{</span> <span>path</span>: <span>`/tmp/<span><span>${</span><span>file</span><span>}</span></span>`</span> <span>}</span><span>,</span>
      <span>}</span><span>)</span><span>,</span>
    <span>}</span><span>)</span><span>.</span><span>then</span><span>(</span><span>(</span><span>r</span><span>)</span> <span>=&gt;</span> <span>r</span><span>.</span><span>json</span><span>(</span><span>)</span><span>)</span><span>;</span>

    <span>console</span><span>.</span><span>log</span><span>(</span><span>`<span><span>${</span><span>file</span><span>}</span></span>: <span><span>${</span><span>content</span><span>.</span><span>content</span><span>[</span><span>0</span><span>]</span><span>.</span><span>text</span><span>.</span><span>length</span><span>}</span></span> characters`</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></pre></div>


<p dir="auto">Executes TypeScript/JavaScript code with network access to the MCP proxy.</p>
<p dir="auto"><strong>Parameters:</strong></p>
<ul dir="auto">
<li><code>code</code> (string): Code to execute</li>
<li><code>typescript</code> (boolean): TypeScript mode (default: true)</li>
</ul>
<p dir="auto"><strong>Proxy Endpoints:</strong></p>
<ul dir="auto">
<li><code>GET /mcp/servers</code> - List available MCP servers</li>
<li><code>GET /mcp/{server}/tools</code> - List tools for server</li>
<li><code>POST /mcp/call</code> - Call tool (body: <code>{server, tool, args}</code>)</li>
</ul>

<p dir="auto">Check Deno installation status.</p>

<p dir="auto">Get a comprehensive overview of all available MCP servers and their tools. Returns structured JSON data optimized for LLM consumption, containing complete tool schemas and server status information.</p>
<p dir="auto"><strong>JSON Output Structure:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;summary&#34;: {
    &#34;totalServers&#34;: 2,
    &#34;successfulServers&#34;: 2,
    &#34;totalTools&#34;: 4
  },
  &#34;servers&#34;: [
    {
      &#34;server&#34;: &#34;filesystem&#34;,
      &#34;status&#34;: &#34;success&#34;,
      &#34;toolCount&#34;: 3,
      &#34;tools&#34;: [
        {
          &#34;name&#34;: &#34;read_file&#34;,
          &#34;description&#34;: &#34;Read contents of a file&#34;,
          &#34;inputSchema&#34;: {
            &#34;type&#34;: &#34;object&#34;,
            &#34;properties&#34;: {
              &#34;path&#34;: {
                &#34;type&#34;: &#34;string&#34;,
                &#34;description&#34;: &#34;File path to read&#34;
              }
            },
            &#34;required&#34;: [&#34;path&#34;]
          }
        }
      ]
    },
    {
      &#34;server&#34;: &#34;database&#34;,
      &#34;status&#34;: &#34;success&#34;,
      &#34;toolCount&#34;: 1,
      &#34;tools&#34;: [
        {
          &#34;name&#34;: &#34;query&#34;,
          &#34;description&#34;: &#34;Execute a SQL query&#34;,
          &#34;inputSchema&#34;: {
            &#34;type&#34;: &#34;object&#34;,
            &#34;properties&#34;: {
              &#34;query&#34;: {
                &#34;type&#34;: &#34;string&#34;,
                &#34;description&#34;: &#34;SQL query to execute&#34;
              }
            },
            &#34;required&#34;: [&#34;query&#34;]
          }
        }
      ]
    }
  ]
}"><pre>{
  <span>&#34;summary&#34;</span>: {
    <span>&#34;totalServers&#34;</span>: <span>2</span>,
    <span>&#34;successfulServers&#34;</span>: <span>2</span>,
    <span>&#34;totalTools&#34;</span>: <span>4</span>
  },
  <span>&#34;servers&#34;</span>: [
    {
      <span>&#34;server&#34;</span>: <span><span>&#34;</span>filesystem<span>&#34;</span></span>,
      <span>&#34;status&#34;</span>: <span><span>&#34;</span>success<span>&#34;</span></span>,
      <span>&#34;toolCount&#34;</span>: <span>3</span>,
      <span>&#34;tools&#34;</span>: [
        {
          <span>&#34;name&#34;</span>: <span><span>&#34;</span>read_file<span>&#34;</span></span>,
          <span>&#34;description&#34;</span>: <span><span>&#34;</span>Read contents of a file<span>&#34;</span></span>,
          <span>&#34;inputSchema&#34;</span>: {
            <span>&#34;type&#34;</span>: <span><span>&#34;</span>object<span>&#34;</span></span>,
            <span>&#34;properties&#34;</span>: {
              <span>&#34;path&#34;</span>: {
                <span>&#34;type&#34;</span>: <span><span>&#34;</span>string<span>&#34;</span></span>,
                <span>&#34;description&#34;</span>: <span><span>&#34;</span>File path to read<span>&#34;</span></span>
              }
            },
            <span>&#34;required&#34;</span>: [<span><span>&#34;</span>path<span>&#34;</span></span>]
          }
        }
      ]
    },
    {
      <span>&#34;server&#34;</span>: <span><span>&#34;</span>database<span>&#34;</span></span>,
      <span>&#34;status&#34;</span>: <span><span>&#34;</span>success<span>&#34;</span></span>,
      <span>&#34;toolCount&#34;</span>: <span>1</span>,
      <span>&#34;tools&#34;</span>: [
        {
          <span>&#34;name&#34;</span>: <span><span>&#34;</span>query<span>&#34;</span></span>,
          <span>&#34;description&#34;</span>: <span><span>&#34;</span>Execute a SQL query<span>&#34;</span></span>,
          <span>&#34;inputSchema&#34;</span>: {
            <span>&#34;type&#34;</span>: <span><span>&#34;</span>object<span>&#34;</span></span>,
            <span>&#34;properties&#34;</span>: {
              <span>&#34;query&#34;</span>: {
                <span>&#34;type&#34;</span>: <span><span>&#34;</span>string<span>&#34;</span></span>,
                <span>&#34;description&#34;</span>: <span><span>&#34;</span>SQL query to execute<span>&#34;</span></span>
              }
            },
            <span>&#34;required&#34;</span>: [<span><span>&#34;</span>query<span>&#34;</span></span>]
          }
        }
      ]
    }
  ]
}</pre></div>
<p dir="auto">This provides complete tool discovery information including parameter schemas, types, and requirements for programmatic access.</p>

<p dir="auto">Create <code>codemode-config.json</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;proxyPort&#34;: 3001,
  &#34;configDirectories&#34;: [&#34;~/.config/mcp/servers&#34;, &#34;./mcp-servers&#34;, &#34;./&#34;]
}"><pre>{
  <span>&#34;proxyPort&#34;</span>: <span>3001</span>,
  <span>&#34;configDirectories&#34;</span>: [<span><span>&#34;</span>~/.config/mcp/servers<span>&#34;</span></span>, <span><span>&#34;</span>./mcp-servers<span>&#34;</span></span>, <span><span>&#34;</span>./<span>&#34;</span></span>]
}</pre></div>
<p dir="auto">Add your MCP servers to <code>.mcp.json</code> files in those directories:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;mcpServers&#34;: {
    &#34;fs&#34;: {
      &#34;command&#34;: &#34;npx&#34;,
      &#34;args&#34;: [&#34;-y&#34;, &#34;@modelcontextprotocol/server-filesystem&#34;, &#34;/tmp&#34;],
      &#34;env&#34;: {}
    }
  }
}"><pre>{
  <span>&#34;mcpServers&#34;</span>: {
    <span>&#34;fs&#34;</span>: {
      <span>&#34;command&#34;</span>: <span><span>&#34;</span>npx<span>&#34;</span></span>,
      <span>&#34;args&#34;</span>: [<span><span>&#34;</span>-y<span>&#34;</span></span>, <span><span>&#34;</span>@modelcontextprotocol/server-filesystem<span>&#34;</span></span>, <span><span>&#34;</span>/tmp<span>&#34;</span></span>],
      <span>&#34;env&#34;</span>: {}
    }
  }
}</pre></div>

<p dir="auto"><strong>Traditional MCP</strong>: LLM → Tool Call → MCP Server → Result → LLM → Tool Call → ...</p>
<ul dir="auto">
<li>LLMs struggle with tool syntax</li>
<li>Each call goes through the neural network</li>
<li>Hard to chain operations</li>
<li>Limited by training on synthetic tool examples</li>
</ul>
<p dir="auto"><strong>Code Mode</strong>: LLM → Write Code → Code calls proxy → Proxy forwards to MCP → Results</p>
<ul dir="auto">
<li>LLMs excel at writing code (millions of real examples in training)</li>
<li>Code can chain operations naturally</li>
<li>Results flow through code logic, not neural network</li>
<li>Natural composition and data processing</li>
</ul>

<ul dir="auto">
<li>Code runs in Deno sandbox with <strong>network access only</strong></li>
<li>No filesystem, environment, or system access</li>
<li>30-second execution timeout</li>
<li>MCP servers accessed through controlled proxy</li>
<li>Temporary files auto-cleanup</li>
</ul>

<p dir="auto"><strong>&#34;Deno not installed&#34;</strong>: Install Deno and restart
<strong>&#34;Permission denied&#34;</strong>: Code trying to access restricted resources
<strong>&#34;Module not found&#34;</strong>: Use <code>https://</code> URLs for imports
<strong>&#34;Execution timeout&#34;</strong>: Optimize code or break into smaller operations</p>

<ul dir="auto">
<li>Provide a simpler API layer for the MCP proxy something like mcp.tool(&#39;name&#39;, args);
<ul dir="auto">
<li>Could easily be done by injecting our own typescript file into the Deno scope before running user code</li>
</ul>
</li>
<li>More config options</li>
<li>Filter out the tools somehow</li>
<li>Test it out more in my workflows and see the results</li>
</ul>

</article></div></div>
  </body>
</html>
