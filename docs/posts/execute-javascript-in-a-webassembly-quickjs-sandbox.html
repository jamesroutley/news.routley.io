<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/sebastianwessel/quickjs">Original</a>
    <h1>Execute JavaScript in a WebAssembly QuickJS Sandbox</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">This TypeScript package allows you to safely execute JavaScript code within a WebAssembly sandbox using the QuickJS engine. Perfect for isolating and running untrusted code securely, it leverages the lightweight and fast QuickJS engine compiled to WebAssembly, providing a robust environment for code execution.</p>

<ul dir="auto">
<li><strong>Security</strong>: Run untrusted JavaScript code in a safe, isolated environment.</li>
<li><strong>File System</strong>: Can mount a virtual file system</li>
<li><strong>Custom Node Modules</strong>: Custom node modules are mountable</li>
<li><strong>Fetch Client</strong>: Can provide a fetch client to make http(s) calls</li>
<li><strong>Test-Runner</strong>: Includes a test runner and chai based <code>expect</code></li>
<li><strong>Performance</strong>: Benefit from the lightweight and efficient QuickJS engine.</li>
<li><strong>Versatility</strong>: Easily integrate with existing TypeScript projects.</li>
<li><strong>Simplicity</strong>: User-friendly API for executing and managing JavaScript code in the sandbox.</li>
</ul>
<p dir="auto"><strong><a href="https://sebastianwessel.github.io/quickjs/" rel="nofollow">View the full documentation</a></strong></p>
<p dir="auto"><strong><a href="https://github.com/sebastianwessel/quickjs/tree/main/example">Find examples in the repository</a></strong></p>

<p dir="auto">Here&#39;s a simple example of how to use the package:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { quickJS } from &#39;@sebastianwessel/quickjs&#39;

// General setup like loading and init of the QuickJS wasm
// It is a ressource intensive job and should be done only once if possible 
const { createRuntime } = await quickJS()

// Create a runtime instance each time a js code should be executed
const { evalCode } = await createRuntime({
  allowFetch: true, // inject fetch and allow the code to fetch data
  allowFs: true, // mount a virtual file system and provide node:fs module
  env: {
    MY_ENV_VAR: &#39;env var value&#39;
  },
})


const result = await evalCode(`
import { join } as path from &#39;path&#39;

const fn = async ()=&gt;{
  console.log(join(&#39;src&#39;,&#39;dist&#39;)) // logs &#34;src/dist&#34; on host system

  console.log(env.MY_ENV_VAR) // logs &#34;env var value&#34; on host system

  const url = new URL(&#39;https://example.com&#39;)

  const f = await fetch(url)

  return f.text()
}
  
export default await fn()
`)

console.log(result) // { ok: true, data: &#39;&lt;!doctype html&gt;\n&lt;html&gt;\n[....]&lt;/html&gt;\n&#39; }"><pre><span>import</span> <span>{</span> <span>quickJS</span> <span>}</span> <span>from</span> <span>&#39;@sebastianwessel/quickjs&#39;</span>

<span>// General setup like loading and init of the QuickJS wasm</span>
<span>// It is a ressource intensive job and should be done only once if possible </span>
<span>const</span> <span>{</span> createRuntime <span>}</span> <span>=</span> <span>await</span> <span>quickJS</span><span>(</span><span>)</span>

<span>// Create a runtime instance each time a js code should be executed</span>
<span>const</span> <span>{</span> evalCode <span>}</span> <span>=</span> <span>await</span> <span>createRuntime</span><span>(</span><span>{</span>
  <span>allowFetch</span>: <span>true</span><span>,</span> <span>// inject fetch and allow the code to fetch data</span>
  <span>allowFs</span>: <span>true</span><span>,</span> <span>// mount a virtual file system and provide node:fs module</span>
  <span>env</span>: <span>{</span>
    <span>MY_ENV_VAR</span>: <span>&#39;env var value&#39;</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span>


<span>const</span> <span>result</span> <span>=</span> <span>await</span> <span>evalCode</span><span>(</span><span>`</span>
<span>import { join } as path from &#39;path&#39;</span>
<span></span>
<span>const fn = async ()=&gt;{</span>
<span>  console.log(join(&#39;src&#39;,&#39;dist&#39;)) // logs &#34;src/dist&#34; on host system</span>
<span></span>
<span>  console.log(env.MY_ENV_VAR) // logs &#34;env var value&#34; on host system</span>
<span></span>
<span>  const url = new URL(&#39;https://example.com&#39;)</span>
<span></span>
<span>  const f = await fetch(url)</span>
<span></span>
<span>  return f.text()</span>
<span>}</span>
<span>  </span>
<span>export default await fn()</span>
<span>`</span><span>)</span>

<span>console</span><span>.</span><span>log</span><span>(</span><span>result</span><span>)</span> <span>// { ok: true, data: &#39;&lt;!doctype html&gt;\n&lt;html&gt;\n[....]&lt;/html&gt;\n&#39; }</span></pre></div>

<p dir="auto">This lib is based on:</p>
<ul dir="auto">
<li><a href="https://github.com/justjake/quickjs-emscripten">quickjs-emscripten</a></li>
<li><a href="https://github.com/reearth/quickjs-emscripten-sync">quickjs-emscripten-sync</a></li>
<li><a href="https://github.com/streamich/memfs">memfs</a></li>
<li><a href="https://www.chaijs.com" rel="nofollow">Chai</a></li>
</ul>
<p dir="auto">Tools used:</p>
<ul dir="auto">
<li><a href="https://bun.sh" rel="nofollow">Bun</a></li>
<li><a href="https://biomejs.dev" rel="nofollow">Biome</a></li>
<li><a href="https://hono.dev" rel="nofollow">Hono</a></li>
<li><a href="https://github.com/poolifier/poolifier-web-worker">poolifier-web-worker</a></li>
<li><a href="https://github.com/isaacs/tshy">tshy</a></li>
<li><a href="https://github.com/mcollina/autocannon">autocannon</a></li>
</ul>

<p dir="auto">This project is licensed under the MIT License.</p>
<hr/>
<p dir="auto">This package is ideal for developers looking to execute JavaScript code securely within a TypeScript application, ensuring both performance and safety with the QuickJS WebAssembly sandbox.</p>
</article></div></div>
  </body>
</html>
