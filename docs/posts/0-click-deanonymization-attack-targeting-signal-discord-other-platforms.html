<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/hackermondev/45a3cdfa52246f1d1201c1e8cdef6117">Original</a>
    <h1>0-click deanonymization attack targeting Signal, Discord, other platforms</h1>
    
    <div id="readability-page-1" class="page"><p>
    Unique 0-click deanonymization attack targeting Signal, Discord and hundreds of platform
  </p><div>
  <div id="file-research-md">
      
      <div id="file-research-md-readme" tabindex="0" role="region" aria-label="file-research-md">
    <article itemprop="text"><p dir="auto">hi, i&#39;m daniel. i&#39;m a 15-year-old high school junior. in my free time, i <a href="https://hackerone.com/daniel" rel="nofollow">hack billion dollar companies</a> and build cool stuff.</p>
<p dir="auto">3 months ago, I discovered a unique 0-click deanonymization attack that allows an attacker to grab the location of any target within a 250 mile radius. With a vulnerable app installed on a target&#39;s phone (or as a background application on their laptop), an attacker can send a malicious payload and deanonymize you within seconds--and you wouldn&#39;t even know.</p>
<p dir="auto">I&#39;m publishing this writeup and research as a warning, especially for journalists, activists, and hackers, about this type of undetectable attack. Hundreds of applications are vulnerable, including some of the most popular apps in the world: Signal, Discord, Twitter/X, and others. Here&#39;s how it works:</p>

<p dir="auto">By the numbers, Cloudflare is easily the most popular CDN on the market. It beats out competitors such as Sucuri, Amazon CloudFront, Akamai, and Fastly. In 2019, a major Cloudflare outage knocked most of the internet offline for over 30 minutes.</p>
<p dir="auto">One of Cloudflare&#39;s most used feature is Caching. Cloudflare&#39;s Cache stores copies of frequently accessed content (such as images, videos, or webpages) in its datacenters, reducing server load and improving website performance (<a href="https://developers.cloudflare.com/cache/" rel="nofollow">https://developers.cloudflare.com/cache/</a>).</p>
<p dir="auto">When your device sends a request for a resource that can be cached, Cloudflare retrieves the resource from its local datacenter storage, if available. Otherwise, it fetches the resource from the origin server, caches it locally, and then returns it. By default, <a href="https://developers.cloudflare.com/cache/concepts/default-cache-behavior/" rel="nofollow">some file extensions</a> are automatically cached but site operators can also configure new cache rules.</p>
<p dir="auto">Cloudflare has a vast global presence, with hundreds of datacenters in 330 cities across 120+ countries—an estimated 273% more datacenters than Google. In the U.S. East region, for example, the nearest datacenter to me is less than 100 miles. If you live in a developed country, there&#39;s a good chance the nearest datacenter to you is less than 200 miles from you.</p>
<p dir="auto">A few months ago, I had a lightbulb moment: if Cloudflare stores cached data so close to users, could this be exploited for deanonymization attacks on sites we don&#39;t control?</p>
<p dir="auto">You see, Cloudflare returns information about a request&#39;s cache status in the HTTP response.
<a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/60828015/404693583-95e1a39a-ed25-4531-9c57-a1b43c616519.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDQ2OTM1ODMtOTVlMWEzOWEtZWQyNS00NTMxLTljNTctYTFiNDNjNjE2NTE5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWM1ZjM3ZWM2Zjc3OTFlOTQyMTZhZmE4ZGYwOTc2OTBiYzlmNmJlOTQ0ZDc0MDE3MDRlNmIxZDQ1NzU3NmNhZmUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.x-2apIRk-XSSoV9jMjFiO4Y8cYIfl_PScsM9BabHVDY"><img width="426" alt="image" src="https://private-user-images.githubusercontent.com/60828015/404693583-95e1a39a-ed25-4531-9c57-a1b43c616519.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDQ2OTM1ODMtOTVlMWEzOWEtZWQyNS00NTMxLTljNTctYTFiNDNjNjE2NTE5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWM1ZjM3ZWM2Zjc3OTFlOTQyMTZhZmE4ZGYwOTc2OTBiYzlmNmJlOTQ0ZDc0MDE3MDRlNmIxZDQ1NzU3NmNhZmUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.x-2apIRk-XSSoV9jMjFiO4Y8cYIfl_PScsM9BabHVDY"/></a></p>
<p dir="auto"><code>cf-cache-status</code> can be <code>HIT</code>/<code>MISS</code> and <code>cf-ray</code> includes the airport code for the closest airport to the datacenter that handles the request (in my case, IAD).</p>
<p dir="auto">If we can get a user&#39;s device to load a resource on a Cloudflare-backed site, causing it to be cached in their local datacenter, we can then enumerate all Cloudflare datacenters to identify which one cached the resource. This would provide an incredibly precise estimate of the user&#39;s location.</p>

<p dir="auto">There was a one major hurdle I had to get through before I tested this theory.</p>
<p dir="auto">You can&#39;t simply send HTTP requests to individual Cloudflare datacenters. For &#34;security purposes&#34; (presumably DDoS protection), all Cloudflare IP ranges are strictly anycast. All TCP connections opened to their network are always handled by the nearest available datacenter to you, there&#39;s no way you can ask a datacenter in Canada to handle your request if you live in the US.</p>
<p dir="auto">However, after some research, I found a forum post (<a href="https://community.cloudflare.com/t/how-to-run-workers-on-specific-datacenter-colos/385851" rel="nofollow">https://community.cloudflare.com/t/how-to-run-workers-on-specific-datacenter-colos/385851</a>) from a community member showing me exactly how. The author shared a bug he found to send requests to specific Cloudflare datacenters with Cloudflare Workers.</p>
<p dir="auto">I&#39;m still not 100% sure of the specifics of this bug, but using an IP range used internally by Cloudflare WARP (Cloudflare&#39;s VPN client), we could ask certain datacenters to handle HTTP requests. Normally, this IP range blocked inbound connections from external IP addresses but requests sent from Workers could bypass this since the connection would originate from inside Cloudflare&#39;s network.</p>
<p dir="auto">I spent a few minutes reading their post and I quickly spined up a tool for this: Cloudflare Teleport (<a href="https://github.com/hackermondev/cf-teleport">https://github.com/hackermondev/cf-teleport</a>). Certain IP ranges corresponded to different datacenters (<a href="https://github.com/hackermondev/cf-teleport/blob/main/scripts/data/colos.json">https://github.com/hackermondev/cf-teleport/blob/main/scripts/data/colos.json</a>).</p>
<p dir="auto">Cloudflare Teleport is a proxy powered by Cloudflare Workers that redirects HTTP requests to specific datacenters. For example, <a href="https://cfteleport.xyz/?proxy=https://cloudflare.com/cdn-cgi/trace&amp;colo=SEA" rel="nofollow">https://cfteleport.xyz/?proxy=https://cloudflare.com/cdn-cgi/trace&amp;colo=SEA</a> would proxy a HTTP GET request to <a href="https://cloudflare.com/cdn-cgi/trace" rel="nofollow">https://cloudflare.com/cdn-cgi/trace</a> specifically to a Seattle (SEA) datacenter.</p>
<p dir="auto">Cloudflare would end up completely patching this bug a few months later, making this tool obsolete, but more on that later. For a majority of my initial, I used this tool.</p>

<p dir="auto">As soon as the Cloudflare Teleport tool was complete, I was able to confirm my theory. I coded a simple CLI program that would send an HTTP GET request to a specified URL and list all datacenters that had the resource cache and its age.</p>
<p dir="auto">For my first test, I used Namecheap&#39;s favicon (<a href="https://www.namecheap.com/favicon.ico" rel="nofollow">https://www.namecheap.com/favicon.ico</a>). This resource has Cloudflare Caching enabled, it&#39;s just a simple static image of their logo. (This was the quickest site I could find that didn&#39;t have rigorous bot protection):</p>
<a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/60828015/404707140-8da57801-ae8e-4adf-9a2e-ec6feec6086f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDQ3MDcxNDAtOGRhNTc4MDEtYWU4ZS00YWRmLTlhMmUtZWM2ZmVlYzYwODZmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTdmOGNjZDQ2ZTI5NGMxZWExZjlmMDljN2ViMmJlODY0NzBkY2MxODNkZTk2NmI5MmMzNjRjMDk2NTkxMGE4ZjUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.bnQbOvnx6Vo-b06H6hSU01H6B6mJ22zMHeBxmPBe8P0"><img width="814" alt="image" src="https://private-user-images.githubusercontent.com/60828015/404707140-8da57801-ae8e-4adf-9a2e-ec6feec6086f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDQ3MDcxNDAtOGRhNTc4MDEtYWU4ZS00YWRmLTlhMmUtZWM2ZmVlYzYwODZmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTdmOGNjZDQ2ZTI5NGMxZWExZjlmMDljN2ViMmJlODY0NzBkY2MxODNkZTk2NmI5MmMzNjRjMDk2NTkxMGE4ZjUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.bnQbOvnx6Vo-b06H6hSU01H6B6mJ22zMHeBxmPBe8P0"/></a>
<p dir="auto">Boom, it worked. Namecheap had configured their cache age extremely low (5 minutes) but I was able to see every datacenter that had cached the their site&#39;s favicon in the last 5 minutes. Since everytime you load their site, your browser automatically downloads this favicon, this means a user from each one of this locations has visited the Namecheap.com site within the 5 minutes with the last visit from Tokyo, Japan.</p>
<p dir="auto">This was just meant to be a simple test and there&#39;s almost no impact here, but with this I confirmed my theory. This proved the concept of using Cloudflare caching for deanonymization attacks.</p>

<p dir="auto">Signal, an open-source encrypted messaging service, is widely used by journalists and activists for its privacy features. Internally, the app utilizes two CDNs for serving content: <code>cdn.signal.org</code> (powered by CloudFront) for profile avatars and <code>cdn2.signal.org</code> (powered by Cloudflare) for message attachments.</p>

<p dir="auto">When a user sends an attachment (e.g., an image) on Signal, it is uploaded to cdn2.signal.org. Once the recipient opens the conversation, their device automatically downloads the attachment. Since Cloudflare caching is enabled for these URLs, an attacker can use the cache geolocation method to pinpoint the recipient’s location.</p>
<p dir="auto">The <code>https://cdn2.signal.org/attachments/*</code> path is configured to cache responses with Cloudflare. This means once a user&#39;s device automatically downloads an attachment, it&#39;s possible for an attacker to run a cache geolocation attack to find out which local datacenter they&#39;re near--similar to how law enforcement track mobile devices through cell phone towers.</p>
<p dir="auto">To test this, I quickly patched the Signal desktop app to remove SSL pinning and configured Burp to intercept and view HTTP requests/responses sent through the app.
<a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/60828015/404890145-51dd8b7c-375c-4bd1-936c-54c338fe6620.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDQ4OTAxNDUtNTFkZDhiN2MtMzc1Yy00YmQxLTkzNmMtNTRjMzM4ZmU2NjIwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTU1MWJkNzk3NmM0ZjA1MDUwNzM4MTY1ODgzZGIwZDAzZGVmOGVkMjVmOWZlZGJhYmY4NmYzMWJiYTI2ZmVmZGYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.cnOgQmTRJxYX_qfeuwffL9JABOU_QuXTf_jpj6MIpgw"><img width="700" alt="image" src="https://private-user-images.githubusercontent.com/60828015/404890145-51dd8b7c-375c-4bd1-936c-54c338fe6620.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDQ4OTAxNDUtNTFkZDhiN2MtMzc1Yy00YmQxLTkzNmMtNTRjMzM4ZmU2NjIwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTU1MWJkNzk3NmM0ZjA1MDUwNzM4MTY1ODgzZGIwZDAzZGVmOGVkMjVmOWZlZGJhYmY4NmYzMWJiYTI2ZmVmZGYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.cnOgQmTRJxYX_qfeuwffL9JABOU_QuXTf_jpj6MIpgw"/></a></p>

<div dir="auto"><h4 dir="auto">1. Block HTTP GET requests to <code>cdn2.signal.org/attachments/*</code> in from the Signal using Burp.</h4><a id="user-content-1-block-http-get-requests-to-cdn2signalorgattachments-in-from-the-signal-using-burp" aria-label="Permalink: 1. Block HTTP GET requests to cdn2.signal.org/attachments/* in from the Signal using Burp." href="#1-block-http-get-requests-to-cdn2signalorgattachments-in-from-the-signal-using-burp"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This ensures that the app doesn&#39;t download attachments uploaded from the our side (the attacker) since that would cache them to our local datacenter and pollute the results. The best way I found to do this with Burp is to configure intercept rules for attachments, then leave request intercept on and deny all requests.
</p>
<div dir="auto"><h4 dir="auto">2. Send an attachment (image) to a target.</h4><a id="user-content-2-send-an-attachment-image-to-a-target" aria-label="Permalink: 2. Send an attachment (image) to a target." href="#2-send-an-attachment-image-to-a-target"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This should work with any attachment but images are automatically downloaded when the user opens the conversation so they work best. I used a simple 1x1.png image for this test. The upload request is sent to Signal&#39;s CDN and you can see the attachment url in Burp once we send the attachment in the conversation and Signal uploads it (ex. <a href="https://cdn2.signal.org/attachments/UjLld11tvaL16M8mrd86" rel="nofollow">https://cdn2.signal.org/attachments/UjLld11tvaL16M8mrd86</a>).
<a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/60828015/405260342-66b4c6f4-3617-4b79-9612-89a90aa7690c.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDUyNjAzNDItNjZiNGM2ZjQtMzYxNy00Yjc5LTk2MTItODlhOTBhYTc2OTBjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTM2OWI5OTQ4YzgzMGUwZDg2ZDhkOTk4NmE0Y2Q3NzY2MDQyODJmYTExZWNkZmVkYjJiODE0ZTc1ZGIxYzI5MDQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.GkWPekI8dq_jrWbOvzauReRpE0U6tnAPo1lYPomNRTg"><img src="https://private-user-images.githubusercontent.com/60828015/405260342-66b4c6f4-3617-4b79-9612-89a90aa7690c.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDUyNjAzNDItNjZiNGM2ZjQtMzYxNy00Yjc5LTk2MTItODlhOTBhYTc2OTBjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTM2OWI5OTQ4YzgzMGUwZDg2ZDhkOTk4NmE0Y2Q3NzY2MDQyODJmYTExZWNkZmVkYjJiODE0ZTc1ZGIxYzI5MDQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.GkWPekI8dq_jrWbOvzauReRpE0U6tnAPo1lYPomNRTg" alt="image"/></a></p>

<p dir="auto">After the targets opens the conversation (verify this with read recipts), their device should download the attachment which in turn causes Cloudflare to cache the file in a local datacenter.</p>
<p dir="auto">I ran this attack on myself, used the CLI tool I mentioned earlier with the attachment url and found local datacenters that had cached the attachment.</p>
<a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/60828015/404906566-1ae6102d-263e-4af6-9073-f3665589d753.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDQ5MDY1NjYtMWFlNjEwMmQtMjYzZS00YWY2LTkwNzMtZjM2NjU1ODlkNzUzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTZlNDkyNDYwODQ5NjVmMjc2YTY3ZjA3MmMzOTg3MGQ5YTI5MWJmNTQwNzA2MTQxODdhZTM1MTFmNzk1YmEyYjQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.6Yt9C50jckS24WIZMJqDliPQBO2fyFDdt6ddHyCcOaI"><img width="927" alt="image" src="https://private-user-images.githubusercontent.com/60828015/404906566-1ae6102d-263e-4af6-9073-f3665589d753.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDQ5MDY1NjYtMWFlNjEwMmQtMjYzZS00YWY2LTkwNzMtZjM2NjU1ODlkNzUzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTZlNDkyNDYwODQ5NjVmMjc2YTY3ZjA3MmMzOTg3MGQ5YTI5MWJmNTQwNzA2MTQxODdhZTM1MTFmNzk1YmEyYjQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.6Yt9C50jckS24WIZMJqDliPQBO2fyFDdt6ddHyCcOaI"/></a>
<p dir="auto">In my case, I&#39;m in New York and one of the closest datacenters to me is Newark, NJ (EWR) which is about 150 miles from my actual coordinates.</p>
<p dir="auto">With an innocent-looking attachment, an attacker can deanonymize users and find their location within an approximate radius.</p>

<p dir="auto">Here&#39;s where things get interesting. Although the 1-click method works, it requires the user to open the Signal conversation. Is it possible to run this attack without a single user interaction? Enter push notifications.</p>

<p dir="auto">Signal&#39;s mobile app has 3 push notification settings. </p>
<p dir="auto">Push Notifications are triggered if the user receives a message while not actively on the Signal app. By default, the mobile app includes the author, and message when it sends a push notification to your device. </p>
<p dir="auto">The image shown on the right of the notification is the attachment sent with the message from Signal.</p>
<p dir="auto">If the target has push notifications enabled (which it is by default), they don&#39;t even have to open the Signal conversation for their device to download the attachment. Once the push notification is sent to their device, it automatically downloads the image from Signal&#39;s CDN triggering the local datacenter to cache the response.</p>
<p dir="auto">An attacker can run this deanonymization attack any time and grab a user&#39;s current location without a single interaction.</p>
<hr/>
<p dir="auto">Signal, like Telegram, is used by journalists, activists, whisteblowers from all over the world. The potiental for this attack is massive. This attack can be used to track Signal accounts, correlate identities, find employees meeting with journalists and much more.</p>

<p dir="auto">During my research, another app I found vulnerable to this type of attack is Discord. Discord is a free app that allows users to communicate with each other through text, voice, and video. Although the app is targeted towards gamers, Discord has been in the news recently this past year for facilitating government leaks and Discord hosts a significant portion of cybercrime on the internet.</p>
<p dir="auto">The 1-click aspect is very simple and fairly similar to Signal, I would say the impact is even wider with Discord. Discord allows users with a Nitro subscription (their $9.99/mo premium service) to use custom emojis in a variety of places: Messages, User Presence, Channels, etc. These custom emojis are loaded from Discord&#39;s CDN and are configured to be cached on Cloudflare. An attacker can use the same deanonymization attack with Signal to deanonymize users.</p>
<p dir="auto">So, instead of sending an attachment in a Discord channel, an attacker can display a custom emoji in their user status and simply wait for the target to open their profile to run a deanonymization attack.</p>
<p dir="auto">I&#39;ve disclosed the <a href="https://gist.github.com/hackermondev/7d9ae6b372159de7b9d3d7bb82a32ed2">entire HackerOne report</a> I sent to Discord which has specific details, but I want to focus on the 0-click aspect here.</p>
<p dir="auto">In Discord, mobile push notifications are sent for a variety of events (not just for messages recieved like Signal). For example, sending a friend request to a Discord user triggers a push notification on the user&#39;s mobile device.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/60828015/404999739-6a013d85-1c4c-406d-8638-e77430a7c723.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDQ5OTk3MzktNmEwMTNkODUtMWM0Yy00MDZkLTg2MzgtZTc3NDMwYTdjNzIzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTg0ZWNkMzZiNzMzYzFlYTkwZmEyNTNmODc1ZDdhMmExNzQxOTg2ZDNmY2VlYzJmMWRiMzk2YmI0M2E1ZTFmOTImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.HiuuFWWwyBzYtGFfJQbjrqAF3HfDBBZcw7woYP3ON4Q"><img src="https://private-user-images.githubusercontent.com/60828015/404999739-6a013d85-1c4c-406d-8638-e77430a7c723.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDQ5OTk3MzktNmEwMTNkODUtMWM0Yy00MDZkLTg2MzgtZTc3NDMwYTdjNzIzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTg0ZWNkMzZiNzMzYzFlYTkwZmEyNTNmODc1ZDdhMmExNzQxOTg2ZDNmY2VlYzJmMWRiMzk2YmI0M2E1ZTFmOTImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.HiuuFWWwyBzYtGFfJQbjrqAF3HfDBBZcw7woYP3ON4Q" alt="image"/></a></p>
<p dir="auto">Interestingly, even if the user is actively on Discord, friend request notifications are always sent to the user&#39;s mobile device.</p>
<p dir="auto">How would a deanonymization attack be used with a friend request notification? Well, take a look at the notification.
<a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/60828015/405000417-4eaa5e0e-4ebf-4e43-98ca-029ec7dd6591.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDUwMDA0MTctNGVhYTVlMGUtNGViZi00ZTQzLTk4Y2EtMDI5ZWM3ZGQ2NTkxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTBjZmFiYmRjOTRiYjgyYTVjOWE3NjU0MjY2MDU2NDI1ZWVkODcxMGVjYTU2MjFiZTRmNjk1MTk5ODZjMjBkMGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.zIJQQLHqfHeSVdRU9fb9utx3KcC2jAqVPqoCxzpw75c"><img src="https://private-user-images.githubusercontent.com/60828015/405000417-4eaa5e0e-4ebf-4e43-98ca-029ec7dd6591.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDUwMDA0MTctNGVhYTVlMGUtNGViZi00ZTQzLTk4Y2EtMDI5ZWM3ZGQ2NTkxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTBjZmFiYmRjOTRiYjgyYTVjOWE3NjU0MjY2MDU2NDI1ZWVkODcxMGVjYTU2MjFiZTRmNjk1MTk5ODZjMjBkMGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.zIJQQLHqfHeSVdRU9fb9utx3KcC2jAqVPqoCxzpw75c" alt="image"/></a></p>
<p dir="auto">When you recieve a friend request and Discord sends the notification to your device, it includes the user&#39;s avatar url to be shown with the notification. Your phone downloads the avatar url (without any user interaction) and displays it alongside the notification.</p>
<p dir="auto">Discord has Cloudflare caching configured on the CDN path for avatar urls, which means we can simply do the same cache location attack mentioned earlier.</p>
<p dir="auto">In Discord, the avatar URL format used in push notifications is: <code>https://cdn.discordapp.com/avatars/{user_id}/{avatar_hash}</code>. The avatar URL format used in the website to display user avatars is slightly different (it always contains an image extension) (<code>https://cdn.discordapp.com/avatars/{user_id}/{avatar_hash}.png</code>).</p>
<p dir="auto">Both URLs leads to the same image but since images displayed in the app have a different path, they&#39;re cached separately. This ensures our results are not polluted and allows us to ensure we are finding the datacenter of a device that loaded the avatar through a push notification and not just the profile on the Discord app.</p>
<p dir="auto">Just like that, we have the steps for a 0-click version of this attack for Discord:</p>
<ol dir="auto">
<li>Change your user avatar. This randomizes your avatar hash and ensures your avatar URL has not been loaded by anyone yet, increasing the accuracy of the attack.</li>
<li>Send a friend request to the target. Although there&#39;s a variety of ways to trigger push notifications with Discord, I choose friend requests because they are always sent regardless of whether the user is active on Discord. They also don&#39;t require any mutual server with the target, meaning you can practically do this with anyone on Discord.</li>
<li>Use Cloudflare Teleport tool on the user avatar and find all local datacenters that have cached the avatar</li>
</ol>

<p dir="auto">I&#39;m very familar with Discord&#39;s API and I realized I could automate every step in Discord&#39;s 0-click attack, and so I did.</p>
<p dir="auto">Introducing GeoGuesser. This is a private Discord bot with a single command that takes a username, runs an attack with the steps mentioned earlier and returns the result entirely through Discord.</p>
<p dir="auto">When the command is called, it uses my account credentials to access the Discord User API, changes the user avatar to a randomly generated image (to randomize the hash) and sends a friend request to a username specified.
Finally, it uses a private API based on the Cloudflare Teleport CLI to run the same cache enumeration attack and displays the results directly on Discord, all in less than 30 seconds.</p>
<p dir="auto">To show the extent of this attack, one of the first users I tried this attack on was Stanislav Vishnevskiy, Discord&#39;s CTO.
<a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/60828015/405007407-66914f42-880b-4d23-8902-3cb2f3170118.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDUwMDc0MDctNjY5MTRmNDItODgwYi00ZDIzLTg5MDItM2NiMmYzMTcwMTE4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTAyZDJlNjk4YjIyMWM0MWFkOTcwYjk3Y2RjZmM5YzFlYjRhMDhmY2JkYmYzZTA5NWU5YWJkMDU2ZDNmODQzZTImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.2CDQ9wsd0VKaVtAeUMdcNWyEk8jWGknu_1Cc4ThM3Qk"><img width="400" alt="image" src="https://private-user-images.githubusercontent.com/60828015/405007407-66914f42-880b-4d23-8902-3cb2f3170118.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDUwMDc0MDctNjY5MTRmNDItODgwYi00ZDIzLTg5MDItM2NiMmYzMTcwMTE4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTAyZDJlNjk4YjIyMWM0MWFkOTcwYjk3Y2RjZmM5YzFlYjRhMDhmY2JkYmYzZTA5NWU5YWJkMDU2ZDNmODQzZTImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.2CDQ9wsd0VKaVtAeUMdcNWyEk8jWGknu_1Cc4ThM3Qk"/></a></p>
<p dir="auto">Here&#39;s the bot in action:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/e6c10bf50e18f41533bdaa12626f2eb3ceb6644d65f4f11776311a454c3daa69/68747470733a2f2f6e696e6a612e646f672f4b556971684a2e676966"><img src="https://camo.githubusercontent.com/e6c10bf50e18f41533bdaa12626f2eb3ceb6644d65f4f11776311a454c3daa69/68747470733a2f2f6e696e6a612e646f672f4b556971684a2e676966" alt="geogueser live gif" data-animated-image="" data-canonical-src="https://ninja.dog/KUiqhJ.gif"/></a></p>
<p dir="auto">The bot sends a friend request to Stan, then waits a couple of seconds to ensure he receives the push notification.</p>
<p dir="auto">It finds 2 local Cloudflare datacenters that have cached the avatar. This could mean he has multiple devices hooked up with his Discord account that recieved the push notification, or his device loaded the avatar twice and the requests were load balanced within different datacenters.</p>
<p dir="auto">GeoGuesser, powered by the Google Maps API, generates a likely location of the user. It finds the midpoint between the 2 datacenters and draws 2 circles that signify his radius.</p>
<p dir="auto">Discord&#39;s HQ is located in San Francisco, CA (which is in the outer circle) so this map is accurate. Stan is most likely located somewhere near the edge of the inner circle which is about ~300 miles.</p>
<p dir="auto">This entire process took less than a minute to run. I&#39;m sure Stan saw the notification on his phone, didn&#39;t think twice and simply dismissed it. This was just a simple attack but this attack, if calibrated, can be used to track and monitor Stan&#39;s location.</p>
<p dir="auto">An attacker like this can be launched on any Discord user and it&#39;s almost undetectable.</p>

<p dir="auto">I responsibly disclosed to the affected parties my research, hoping something would be done to protect or warn users against this type of deanonymization attack but I was mostly disappointed.</p>

<p dir="auto">Signal instantly dismissed my report, saying it wasn&#39;t their responsibility and it was up to users to hide their identity: &#34;Signal has never attempted to fully replicate the set of network-layer anonymity features that projects like Wireguard, Tor, and other open-source VPN software can provide&#34;.</p>
<p dir="auto">I disagree with this. Signal markets itself as a privacy-first communication platform. While it does not claim to provide network-layer anonymity like Tor, users trust Signal to minimize privacy risks.</p>
<p dir="auto">The vulnerability demonstrates that the platform unintentionally leaks information that could narrow down a user’s location within a few hundred miles. This leakage conflicts with the expectations of many privacy-conscious users who rely on Signal for more than just end-to-end encryption.</p>
<p dir="auto">Telegram, another privacy-focused application, is completely invulnerable to this attack as (1) they use a custom in-house built protocol thats not reliant on HTTP and (2) don&#39;t rely on cloud providers like Cloudflare for caching.</p>

<p dir="auto">Initially, Discord&#39;s Security Team promised to look into this and make changes to protect their users against this type of attack but eventually they also changed their position on this, citing this as a Cloudflare issue other consumers are also vulnerable to.</p>

<p dir="auto">Cloudflare ended up completing patching the bug used by Cloudflare Teleport to traverse datacenters. The bug had been reported to their HackerOne program a year ago by another reporter, but they hadn&#39;t done anything about it back then since they didn&#39;t see any impact of traversing datacenters until I shared my research.</p>
<p dir="auto">Cloudflare reopened the old report, resolved it and awarded a bounty to my report and the original.
<a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/60828015/405028347-30568091-c856-4dc8-a70d-335acf70f397.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDUwMjgzNDctMzA1NjgwOTEtYzg1Ni00ZGM4LWE3MGQtMzM1YWNmNzBmMzk3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTliZDI3ODI0NWU4ZWRlMzE3YmM0ZDJiM2JjZGNiN2JjYmYwNDEwZDY0NjllYThlZDY5MGUwZGFiNzIzMWIzNzMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.ZDRBDEaufbIVcl-XEo6QWszv2xQRNu6TJ1lZRhvfvfc"><img width="681" alt="image" src="https://private-user-images.githubusercontent.com/60828015/405028347-30568091-c856-4dc8-a70d-335acf70f397.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDUwMjgzNDctMzA1NjgwOTEtYzg1Ni00ZGM4LWE3MGQtMzM1YWNmNzBmMzk3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTliZDI3ODI0NWU4ZWRlMzE3YmM0ZDJiM2JjZGNiN2JjYmYwNDEwZDY0NjllYThlZDY5MGUwZGFiNzIzMWIzNzMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.ZDRBDEaufbIVcl-XEo6QWszv2xQRNu6TJ1lZRhvfvfc"/></a></p>
<p dir="auto">Although this is a step in the right direction, this doesn&#39;t actually fix the core issue here. Every attack shown in this write up has been done in the last 24 hours even though Cloudflare patched this bug weeks ago. Cloudflare patched the bug inside their network that facilitated datacenter traversal, but that&#39;s not the only way to easilly traverse datacenters all over the world.</p>
<p dir="auto">24 hours after their patch, I reprogrammed Cloudflare Teleport to use a VPN instead. Numerous VPNs provide multiple locations that users can connect to which sends their traffic through servers in different parts of the world and these servers map to different Cloudflare datacenters all over the world.</p>
<p dir="auto">I chose a VPN provider with over 3,000 servers located in various locations across 31 different countries worldwide. Using this new method, I&#39;m able to reach about 54% of all Cloudflare datacenters again. While this doesn&#39;t sound like a lot, this covers most places in the world with significant population.</p>
<hr/>
<p dir="auto">Cloudflare&#39;s final statement about this says they do not consider the deanonymization attack to be a vulnerability in their own systems and it is up to their consumers to disable caching for resources they wish to protect.
<a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/60828015/405032649-da8cd7ea-2c28-444c-af4e-3fc51fa14f92.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDUwMzI2NDktZGE4Y2Q3ZWEtMmMyOC00NDRjLWFmNGUtM2ZjNTFmYTE0ZjkyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTA1ZjA3NmUwZTRlMzg1NTBiMmYxNDc5YjE4ZDg5MGQ3ZDUzN2E0ZTliOWU4ZDRkOTU5NGRlODVlOTI1YzA5YzQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.Vqsk5ZbAa_5_kPprKBoaYgSTZIYHIBLkzENT5CXMSd0"><img width="889" alt="image" src="https://private-user-images.githubusercontent.com/60828015/405032649-da8cd7ea-2c28-444c-af4e-3fc51fa14f92.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mzc0ODcwNzAsIm5iZiI6MTczNzQ4Njc3MCwicGF0aCI6Ii82MDgyODAxNS80MDUwMzI2NDktZGE4Y2Q3ZWEtMmMyOC00NDRjLWFmNGUtM2ZjNTFmYTE0ZjkyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTIxVDE5MTI1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTA1ZjA3NmUwZTRlMzg1NTBiMmYxNDc5YjE4ZDg5MGQ3ZDUzN2E0ZTliOWU4ZDRkOTU5NGRlODVlOTI1YzA5YzQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.Vqsk5ZbAa_5_kPprKBoaYgSTZIYHIBLkzENT5CXMSd0"/></a></p>
<p dir="auto">There&#39;s clearly a problem here as Cloudflare says consumers are responsible for protecting themselves against these types of attacks, while consumers (ex. Discord) are putting the blame on Cloudflare.</p>

<p dir="auto">The potential for exploitation using this deanonymization attack is significant, especially for users in sensitive positions like journalists, activists, and privacy-conscious individuals. The attack leverages fundamental design decisions in caching and push notification systems, demonstrating how infrastructure meant to enhance performance can be misused for invasive tracking.</p>
<p dir="auto">Although Cloudflare has patched the Teleport bug, and some applications like Discord and Signal may have implemented mitigation measures following my disclosure, the underlying risks remain. Any app using a CDN for content delivery and caching can still be vulnerable if the proper precautions aren’t taken.</p>

<p dir="auto">This attack highlights how complex and interconnected the digital ecosystem has become. While CDNs improve performance and scalability, they also inadvertently introduce risks that can be exploited in novel ways. By raising awareness and promoting best practices, we can work together to minimize the potential for abuse.</p>
<p dir="auto">For users in sensitive roles or those concerned about their privacy, the key takeaway is this: stay informed and vigilant. While no system is entirely foolproof, taking steps to limit your exposure can make a significant difference.</p>
</article>
  </div>

  </div>
</div></div>
  </body>
</html>
