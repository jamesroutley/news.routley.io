<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.yossarian.net/2025/09/22/dear-github-no-yaml-anchors">Original</a>
    <h1>Dear GitHub: no YAML anchors, please</h1>
    
    <div id="readability-page-1" class="page">


<h2><em>Programming, philosophy, pedaling.</em></h2>

<ul>
    <li><a href="https://blog.yossarian.net/">Home</a></li>
    <li><a href="https://blog.yossarian.net/tags">Tags</a></li>
    <li><a href="https://blog.yossarian.net/series">Series</a></li>
    <li><a href="https://blog.yossarian.net/favorites">Favorites</a></li>
    <li><a href="https://blog.yossarian.net/archive">Archive</a></li>
    
    <li><a href="https://yossarian.net">Main Site</a></li>
    <li><a href="https://yossarian.net/til">TILs</a></li>
    
</ul>

<hr/>



<h2>
  <p>
    <span><em>Sep 22, 2025</em></span>

       

    
      <span>
        Tags:
        
        
          <a href="https://blog.yossarian.net/tags#programming">programming</a>,
        
          <a href="https://blog.yossarian.net/tags#rant">rant</a>
        
      </span>
    

       

    
  </p>
</h2>






<hr/>


<p><strong>TL;DR</strong>: for a very long time, GitHub Actions lacked support for YAML anchors.</p>

<p>This was a <strong>good thing</strong>. YAML anchors in GitHub Actions are (1) redundant
with existing functionality, (2) introduce a complication to the data model
that makes CI/CD human and machine comprehension harder, and (3) are
<strong>not even uniquely useful</strong> because GitHub has chosen not to support
the one feature (merge keys) that lacks a semantic equivalent in GitHub Actions.</p>

<p>This step backwards <strong>reinforces</strong> GitHub Actions’ status as an
<strong>insecure by default</strong> CI/CD platform by making
it harder for both humans and machines to analyze action and workflow
definitions for vulnerabilities. GitHub should <strong>immediately remove</strong>
support for YAML anchors, before adoption becomes widespread.</p>

<hr/>

<p>GitHub <a href="https://github.blog/changelog/2025-09-18-actions-yaml-anchors-and-non-public-workflow-templates/">recently announced</a> that YAML anchors are now supported in
GitHub Actions. That means that users can write things like this:</p>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td><pre><span>jobs</span><span>:</span>
  <span>job1</span><span>:</span>
    <span>env</span><span>:</span> <span>&amp;env_vars</span> <span># Define the anchor on first use</span>
      <span>NODE_ENV</span><span>:</span> <span>production</span>
      <span>DATABASE_URL</span><span>:</span> <span>${{ secrets.DATABASE_URL }}</span>
    <span>steps</span><span>:</span>
      <span>-</span> <span>run</span><span>:</span> <span>echo &#34;Using production settings&#34;</span>

  <span>job2</span><span>:</span>
    <span>env</span><span>:</span> <span>*env_vars</span> <span># Reuse the environment variables</span>
    <span>steps</span><span>:</span>
      <span>-</span> <span>run</span><span>:</span> <span>echo &#34;Same environment variables here&#34;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>On face value, this seems like a reasonable feature: the job and step
abstractions in GitHub Actions lend themselves to duplication, and YAML anchors
are <em>one</em> way to reduce that duplication.</p>

<p>Unfortunately, YAML anchors are a <strong>terrible</strong> tool for this job. Furthermore
(as we’ll see) GitHub’s implementation of YAML anchors is <strong>incomplete</strong>,
precluding the actual small subset of use cases where YAML anchors
are uniquely useful (but still not a good idea). We’ll see why below.</p>

<p><img src="https://blog.yossarian.net/assets/product-roadmap.jpeg" alt="Pictured: the author&#39;s understanding of the GitHub Actions product roadmap."/>
<em>Pictured: the author’s understanding of the GitHub Actions product roadmap.</em></p>

<h2 id="redundancy">Redundancy</h2>

<p>The simplest reason why YAML anchors are a bad idea is because they’re
<strong>redundant</strong> with other <em>more explicit</em> mechanisms for reducing duplication
in GitHub Actions.</p>

<p>GitHub’s own example above could be rewritten without YAML anchors as:</p>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td><pre><span>env</span><span>:</span>
  <span>NODE_ENV</span><span>:</span> <span>production</span>
  <span>DATABASE_URL</span><span>:</span> <span>${{ secrets.DATABASE_URL }}</span>

<span>jobs</span><span>:</span>
  <span>job1</span><span>:</span>
    <span>steps</span><span>:</span>
      <span>-</span> <span>run</span><span>:</span> <span>echo &#34;Using production settings&#34;</span>

  <span>job2</span><span>:</span>
    <span>steps</span><span>:</span>
      <span>-</span> <span>run</span><span>:</span> <span>echo &#34;Same environment variables here&#34;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This version is significantly clearer, but has slightly different semantics:
<em>all</em> jobs inherit the workflow-level <code>env</code>. But this, in my opinion,
is a <em>good thing</em>: the need to template environment variables across a <em>subset</em>
of jobs suggests an architectural error in the workflow design.</p>

<p>In other words: if you find yourself wanting to use YAML anchors to
share “global” configuration between jobs or steps, you
<strong>probably actually want</strong> separate workflows, or at least separate jobs with
job-level <code>env</code> blocks.</p>

<p>In summary: YAML anchors further muddy the abstractions of workflows,
jobs, and steps, by introducing a <strong>cross-cutting form of global state</strong> that
<strong>doesn’t play by the rules</strong> of the rest of the system. This, to me, suggests
that the current Actions team lacks a strong set of opinions about how
GitHub Actions <strong>should</strong> be used, leading to a “kitchen sink” approach
that serves <em>all</em> users equally poorly.</p>

<h2 id="non-locality-with-full-generality">Non-locality with full generality</h2>

<p>As noted above: YAML anchors introduce a <em>new</em> form of
<strong>non-locality</strong> into GitHub Actions. Furthermore, this form
of non-locality is <strong>fully general</strong>: <em>any</em> YAML node can be anchored
and referenced. This is a <strong>bad idea</strong> for humans and machines alike:</p>

<ul>
  <li>
    <p>For humans: a <em>new</em> form of non-locality makes it harder to preserve
<em>local understanding</em> of what a workflow, job, or step does: a unit
of work may now depend on <em>any</em> other unit of work in the same file,
including one hundreds or thousands of lines away. This makes it harder
to reason about the behavior of one’s GitHub Actions without context
switching.</p>

    <p>It would only be fair to note that GitHub Actions already has some
  forms of non-locality: global contexts, scoping rules for <code>env</code> blocks,
  <code>needs</code> dependencies, step and job outputs, and so on. These <em>can</em> be
  difficult to debug! But what sets them apart is their <em>lack of
  generality</em>: each has <em>precise</em> semantics and scoping rules,
  meaning that a user who understands those rules can comprehend
  what a unit of work does without referencing the source of an
  environment variable, output, &amp;c.</p>
  </li>
  <li>
    <p>For machines: non-locality makes it significantly harder to write
tools that analyze (or transform) GitHub Actions workflows.</p>

    <p>The pain here boils down to the fact that YAML anchors diverge
  from the <em>one-to-one object model</em><sup id="fnref:om"><a href="#fn:om" rel="footnote" role="doc-noteref">1</a></sup> that GitHub Actions otherwise maps
  onto.</p>

    <p>With anchors, that mapping becomes one-to-many: the same element
  may appear once in the source, but multiple times in the loaded
  object representation.</p>

    <p>In effect, this breaks a critical assumption that many tools
  make about YAML in GitHub Actions: that an entity in the deserialized
  object can be <em>mapped back</em> to a <strong>single concrete location</strong> in the
  <em>source</em> YAML.</p>

    <p>This is needed to present reasonable source locations in error messages,
  but it <strong>doesn’t hold</strong> if the object model doesn’t represent
  anchors and references explicitly.</p>

    <p>Furthermore, this is the reality
  for every YAML parser in wide use: <strong>all widespread YAML parsers</strong>
  choose (reasonably) to <em>copy</em> anchored values into each
  location where they’re referenced, meaning that the analyzing tool
  cannot “see” the original element for source location purposes.</p>

    <p>I feel these pains directly: I maintain <a href="https://docs.zizmor.sh">zizmor</a> as a static analysis tool
  for GitHub Actions, and <code>zizmor</code> makes both of these assumptions.
  Moreover, <code>zizmor</code>’s <em>dependencies</em> make these assumptions:
  <code>serde_yaml</code> (like most other YAML parsers) chooses to deserialize YAML
  anchors by <em>copying</em> the anchored value into each location where it’s
  referenced<sup id="fnref:compat"><a href="#fn:compat" rel="footnote" role="doc-noteref">2</a></sup>.</p>
  </li>
</ul>

<h2 id="no-merging-anyways">No merging anyways</h2>

<p>One of the few things that make YAML anchors <em>uniquely</em> useful is
<a href="https://yaml.org/type/merge.html">merge keys</a>: a merge key allows a user to <em>compose</em> multiple referenced
mappings together into a single mapping.</p>

<p>An example from the YAML spec, which I think tidily demonstrates
both their use case <em>and</em> how incredibly confusing merge keys are:</p>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td><pre><span>---</span>
<span>-</span> <span>&amp;CENTER</span> <span>{</span> <span>x</span><span>:</span> <span>1</span><span>,</span> <span>y</span><span>:</span> <span>2</span> <span>}</span>
<span>-</span> <span>&amp;LEFT</span> <span>{</span> <span>x</span><span>:</span> <span>0</span><span>,</span> <span>y</span><span>:</span> <span>2</span> <span>}</span>
<span>-</span> <span>&amp;BIG</span> <span>{</span> <span>r</span><span>:</span> <span>10</span> <span>}</span>
<span>-</span> <span>&amp;SMALL</span> <span>{</span> <span>r</span><span>:</span> <span>1</span> <span>}</span>

<span># All the following maps are equal:</span>

<span>-</span> <span># Explicit keys</span>
  <span>x</span><span>:</span> <span>1</span>
  <span>y</span><span>:</span> <span>2</span>
  <span>r</span><span>:</span> <span>10</span>
  <span>label</span><span>:</span> <span>center/big</span>

<span>-</span> <span># Merge one map</span>
  <span>&lt;&lt; </span><span>:</span> <span>*CENTER</span>
  <span>r</span><span>:</span> <span>10</span>
  <span>label</span><span>:</span> <span>center/big</span>

<span>-</span> <span># Merge multiple maps</span>
  <span>&lt;&lt; </span><span>:</span> <span>[</span> <span>*CENTER</span><span>,</span> <span>*BIG</span> <span>]</span>
  <span>label</span><span>:</span> <span>center/big</span>

<span>-</span> <span># Override</span>
  <span>&lt;&lt; </span><span>:</span> <span>[</span> <span>*BIG</span><span>,</span> <span>*LEFT</span><span>,</span> <span>*SMALL</span> <span>]</span>
  <span>x</span><span>:</span> <span>1</span>
  <span>label</span><span>:</span> <span>center/big</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>I personally find this syntax incredibly hard to read, but at least it
has a <em>unique</em> use case that could be useful in GitHub Actions:
composing multiple sets of environment variables together with clear
precedence rules is <strong>manifestly</strong> useful.</p>

<p>Except: GitHub Actions <a href="https://github.com/actions/runner/issues/1182#issuecomment-2810242069"><strong>doesn’t support merge keys</strong></a>! They appear to be
using their own internal YAML parser that already had <em>some</em> degree of
support for anchors and references, but not for merge keys.</p>

<p>To me, this takes the situation from a set of bad technical decisions
(and lack of strong opinions around how GitHub Actions <em>should</em> be used)
to <strong>farce</strong>: the <strong>one thing</strong> that makes YAML anchors <em>uniquely</em> useful
in the context of GitHub Actions is the <strong>one thing</strong> that GitHub Actions
doesn’t support.</p>

<h2 id="summary">Summary</h2>

<p>To summarize, I think YAML anchors in GitHub Actions are (1) redundant
with existing functionality, (2) introduce a complication to the data model
that makes CI/CD human and machine comprehension harder, and (3) are
<strong>not even uniquely useful</strong> because GitHub has chosen not to support
the one feature (merge keys) that lacks a semantic equivalent in GitHub Actions.</p>

<p>Of these reasons, I think (2) is the most important: GitHub Actions security
has been <a href="https://www.wiz.io/blog/github-action-tj-actions-changed-files-supply-chain-attack-cve-2025-30066">in the news</a> <a href="https://www.wiz.io/blog/shai-hulud-npm-supply-chain-attack">a great deal recently</a>, with the overwhelming consensus
being that it’s <strong>too easy to introduce vulnerabilities</strong> <em>in</em> (or expose
otherwise latent vulnerabilities <em>through</em>) GitHub Actions workflow.</p>

<p>For this reason, we <strong>need</strong> GitHub Actions to be <strong>easy to analyze</strong>
for humans and machine alike. In effect, this means that GitHub <em>should</em>
be <strong>decreasing the complexity</strong> of GitHub Actions, not increasing it.
YAML anchors are a step in the wrong direction for all of the
reasons aforementioned.</p>

<p>Of course, I’m not without self-interest here: I maintain a
<a href="https://docs.zizmor.sh">static analysis tool</a> for GitHub Actions, and supporting YAML anchors
is going to be an <em>absolute royal pain in my ass</em><sup id="fnref:pita"><a href="#fn:pita" rel="footnote" role="doc-noteref">3</a></sup>. But it’s not just
me: tools like <a href="https://github.com/rhysd/actionlint">actionlint</a>, <a href="https://github.com/Betterment/claws">claws</a>, and <a href="https://github.com/boostsecurityio/poutine">poutine</a> are all likely to
struggle with supporting YAML anchors, as they <strong>fundamentally</strong> alter
each tool’s relationship to GitHub Actions’ assumed data model. As-is,
this change <strong>blows a massive hole</strong> in the larger open source ecosystem’s
ability to analyze GitHub Actions for correctness and security.</p>

<p>All told: I strongly believe that GitHub should <strong>immediately remove</strong> support
for YAML anchors in GitHub Actions. The “good” news is that they can probably
do so with a bare minimum of user disruption, since support has only been
public for a few days and adoption is (probably) still primarily at
the <em>single-use</em> workflow layer and not the reusable action (or workflow) layer.</p>

<hr/>



<hr/>


<span>
  Discussions:
  
  <a href="https://www.reddit.com/r/enosuchblog/comments/1nno3if/dear_github_no_yaml_anchors_please/">Reddit</a>
  
  <a href="https://infosec.exchange/@yossarian/115248433982332273">Mastodon</a>
  
  <a href="https://bsky.app/profile/yossarian.net/post/3lzgms3uobt2y">Bluesky</a>
  
</span>
<hr/>



  






</div>
  </body>
</html>
