<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/vkazanov/elcity">Original</a>
    <h1>Show HN: Micropolis/SimCity Clone in Emacs Lisp</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">

<p dir="auto">ElCity is a small, turn-based city builder that runs entirely inside Emacs.
  The UI is ASCII-based and optimized for terminal Emacs sessions.  The core
  simulation is deterministic and pure, while the UI handles rendering and input.</p>
<p dir="auto">Screenshots for those interested in fancy graphics:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/vkazanov/elcity/blob/main/screenshots/graphic.png"><img src="https://github.com/vkazanov/elcity/raw/main/screenshots/graphic.png" alt="screenshots/graphic.png"/></a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/vkazanov/elcity/blob/main/screenshots/terminal.png"><img src="https://github.com/vkazanov/elcity/raw/main/screenshots/terminal.png" alt="screenshots/terminal.png"/></a></p>
<p dir="auto">This is an excercise in implementing the “functional core / imperative shell” architecture
  in a moderately sized project that with a developed UI. Every tile type is defined through
  a DSL, with a strong separation between state and effects. Most functions in the core are
  either pure or pure-ish.</p>
<p dir="auto">Benefits to this approach:</p>
<ul dir="auto">
  <li>easy to debug</li>
  <li>scalable in terms of code: reduced cognitive load on both people and LLMs</li>
  <li>easy UX/UI as state is always localized</li>
  <li>easy to extend (with some discipline)</li>
  <li>easy to autotest</li>
</ul>

<ul dir="auto">
  <li>Emacs 30.1+</li>
  <li>Optional: Eask for dependency management</li>
</ul>

<p dir="auto">Clone the repository and add it to your Emacs load path.  Example with
  <code>use-package</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="(use-package elcity
  :load-path &#34;/path/to/elcity&#34;
  :commands (elcity-start))"><pre>(<span>use-package</span> elcity
  <span>:load-path</span> <span><span>&#34;</span>/path/to/elcity<span>&#34;</span></span>
  <span>:commands</span> (elcity-start))</pre></div>
<p dir="auto">If you are not using <code>use-package</code>, add the directory to <code>load-path</code>
  and require the entry point:</p>
<div dir="auto" data-snippet-clipboard-copy-content="(add-to-list &#39;load-path &#34;/path/to/elcity&#34;)
(require &#39;elcity)
(elcity-start)"><pre>(<span>add-to-list</span> <span>&#39;load-path</span> <span><span>&#34;</span>/path/to/elcity<span>&#34;</span></span>)
(<span>require</span> <span>&#39;elcity</span>)
(elcity-start)</pre></div>

<p dir="auto">From the project root:</p>

<p dir="auto">Or from Emacs: <code>M-x elcity-start</code></p>

<ul dir="auto">
  <li>The game is turn-based.  Press <code>n</code> to advance one turn.</li>
  <li>Funds increase each turn by: (Population / 2) + (Commercial level + Industrial level).</li>
  <li>City Hall is the source of road connectivity and is unique and non-demolishable.</li>
  <li>Roads are only connected if they trace through other roads to City Hall.</li>
  <li>Power plants provide a Manhattan-radius of 6 tiles.</li>
  <li>Zones grow by 1 level per turn if powered and road-adjacent.</li>
  <li>Zones decay by 1 level per turn if they lose power or road adjacency.</li>
  <li>Maximum zone level is 3.</li>
  <li>Residential (R) supplies Workers in a radius and dislikes Pollution.</li>
  <li>Industrial (I) supplies Goods and Pollution and requires Workers.</li>
  <li>Commercial (C) requires Workers and Goods.</li>
</ul>

<ul dir="auto">
  <li><code>R</code> select Residential and place once</li>
  <li><code>C</code> select Commercial and place once</li>
  <li><code>I</code> select Industrial and place once</li>
  <li><code>r</code> select Road and place once</li>
  <li><code>p</code> select Power plant and place once</li>
  <li><code>h</code> select City Hall and place once</li>
  <li><code>SPC</code> or <code>RET</code> place selected tool at cursor</li>
  <li><code>d</code> demolish at cursor</li>
  <li><code>u</code> undo last action</li>
  <li><code>n</code> advance one turn</li>
  <li>Arrow keys move the cursor</li>
  <li><code>o</code> cycle overlays (goods, polution, connectivity, etc)</li>
</ul>

<ul dir="auto">
  <li>Start with a custom map by calling <code>elcity-start</code> with a list of row strings.</li>
  <li>Example call: <code>(elcity-start &#39;(&#34;H=R0&#34; &#34;....&#34;))</code></li>
  <li>Map tokens are defined in tile definitions.</li>
  <li>Canonical tokens include <code>..</code>, <code>~~</code>, <code>==</code>, <code>PP</code>, <code>HH</code>, <code>R0</code>-=R3=, <code>C0</code>-=C3=, <code>I0</code>-=I3=.</li>
  <li>Short aliases are also accepted: <code>.</code>, <code>~</code>, <code>=</code>, <code>P</code>, <code>H</code>, <code>R</code>, <code>C</code>, <code>I</code>.</li>
  <li>Default map rows live in <code>elcity-maps.el</code> (<code>elcity-map-default-rows</code>).</li>
  <li>Default map size is set by <code>elcity-core-map-width</code> and <code>elcity-core-map-height</code>.</li>
</ul>

<ul dir="auto">
  <li><code>make test</code> runs ERT tests.</li>
  <li><code>make lint</code> runs package lint, checkdoc, and byte compilation.</li>
  <li><code>make compile</code> byte-compiles non-test files.</li>
</ul>

<ul dir="auto">
  <li><code>elcity.el</code> entry point that wires core and UI</li>
  <li><code>elcity-core.el</code> pure simulation and state transitions</li>
  <li><code>elcity-tiles.el</code> tile definitions and effect metadata</li>
  <li><code>elcity-ui.el</code> UI shell and input handling</li>
  <li><code>elcity-maps.el</code> map presets</li>
  <li><code>test/</code> ERT tests</li>
</ul>
</article></div></div>
  </body>
</html>
