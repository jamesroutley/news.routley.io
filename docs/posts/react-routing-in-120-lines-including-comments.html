<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ashok-khanna/react-snippets/blob/main/Router.js">Original</a>
    <h1>Show HN: React Routing in 120 lines (including comments)</h1>
    
    <div id="readability-page-1" class="page"><div data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="JavaScript" data-tagsearch-path="Router.js">
        <tbody><tr>
          <td id="L1" data-line-number="1"></td>
          <td id="LC1"><span>/*</span></td>
        </tr>
        <tr>
          <td id="L2" data-line-number="2"></td>
          <td id="LC2"><span></span></td>
        </tr>
        <tr>
          <td id="L3" data-line-number="3"></td>
          <td id="LC3"><span>Implements React Routing in Plain React, without reliance</span></td>
        </tr>
        <tr>
          <td id="L4" data-line-number="4"></td>
          <td id="LC4"><span>on React-Router or any other libraries.</span></td>
        </tr>
        <tr>
          <td id="L5" data-line-number="5"></td>
          <td id="LC5"><span></span></td>
        </tr>
        <tr>
          <td id="L6" data-line-number="6"></td>
          <td id="LC6"><span>To use:</span></td>
        </tr>
        <tr>
          <td id="L7" data-line-number="7"></td>
          <td id="LC7"><span></span></td>
        </tr>
        <tr>
          <td id="L8" data-line-number="8"></td>
          <td id="LC8"><span>In your top-level React Component (e.g. App or Index.js):</span></td>
        </tr>
        <tr>
          <td id="L9" data-line-number="9"></td>
          <td id="LC9"><span></span></td>
        </tr>
        <tr>
          <td id="L10" data-line-number="10"></td>
          <td id="LC10"><span>- Import Router (e.g.: import Router from &#39;./Router&#39;)</span></td>
        </tr>
        <tr>
          <td id="L11" data-line-number="11"></td>
          <td id="LC11"><span>- Create a const with your routes and their associated component</span></td>
        </tr>
        <tr>
          <td id="L12" data-line-number="12"></td>
          <td id="LC12"><span>- Create a const with the component to show on urls not routed (i.e. 404 page)</span></td>
        </tr>
        <tr>
          <td id="L13" data-line-number="13"></td>
          <td id="LC13"><span>- Return a Router component as the top-level component of your App</span></td>
        </tr>
        <tr>
          <td id="L14" data-line-number="14"></td>
          <td id="LC14"><span></span></td>
        </tr>
        <tr>
          <td id="L15" data-line-number="15"></td>
          <td id="LC15"><span>Example: </span></td>
        </tr>
        <tr>
          <td id="L16" data-line-number="16"></td>
          <td id="LC16"><span></span></td>
        </tr>
        <tr>
          <td id="L17" data-line-number="17"></td>
          <td id="LC17"><span>```function App() {</span></td>
        </tr>
        <tr>
          <td id="L18" data-line-number="18"></td>
          <td id="LC18"><span>   ...</span></td>
        </tr>
        <tr>
          <td id="L19" data-line-number="19"></td>
          <td id="LC19"><span>   const routes = [{path:&#34;/&#34;, component:&lt;Home/&gt;}, {path:&#34;/login&#34;, component:&lt;Login/&gt;}]</span></td>
        </tr>
        <tr>
          <td id="L20" data-line-number="20"></td>
          <td id="LC20"><span>   ...</span></td>
        </tr>
        <tr>
          <td id="L21" data-line-number="21"></td>
          <td id="LC21"><span>   const defaultComponent = &lt;NoPageExists/&gt;</span></td>
        </tr>
        <tr>
          <td id="L22" data-line-number="22"></td>
          <td id="LC22"><span>   </span></td>
        </tr>
        <tr>
          <td id="L23" data-line-number="23"></td>
          <td id="LC23"><span>   return (</span></td>
        </tr>
        <tr>
          <td id="L24" data-line-number="24"></td>
          <td id="LC24"><span>      &lt;Router routes={routes} defaultComponent={defaultComponent}/&gt;</span></td>
        </tr>
        <tr>
          <td id="L25" data-line-number="25"></td>
          <td id="LC25"><span>   )</span></td>
        </tr>
        <tr>
          <td id="L26" data-line-number="26"></td>
          <td id="LC26"><span>}</span></td>
        </tr>
        <tr>
          <td id="L27" data-line-number="27"></td>
          <td id="LC27"><span>```</span></td>
        </tr>
        <tr>
          <td id="L28" data-line-number="28"></td>
          <td id="LC28"><span></span></td>
        </tr>
        <tr>
          <td id="L29" data-line-number="29"></td>
          <td id="LC29"><span>Then to use routes:</span></td>
        </tr>
        <tr>
          <td id="L30" data-line-number="30"></td>
          <td id="LC30"><span></span></td>
        </tr>
        <tr>
          <td id="L31" data-line-number="31"></td>
          <td id="LC31"><span>- If you want to mimic the &lt;a href&gt; experience, use &lt;Link/&gt;, e.g.:</span></td>
        </tr>
        <tr>
          <td id="L32" data-line-number="32"></td>
          <td id="LC32"><span>  &lt;Link className=&#34;someClass&#34; href=&#34;/login&#34;&gt;</span></td>
        </tr>
        <tr>
          <td id="L33" data-line-number="33"></td>
          <td id="LC33"><span>      Text or React Component</span></td>
        </tr>
        <tr>
          <td id="L34" data-line-number="34"></td>
          <td id="LC34"><span>  &lt;/Link&gt;</span></td>
        </tr>
        <tr>
          <td id="L35" data-line-number="35"></td>
          <td id="LC35"><span></span></td>
        </tr>
        <tr>
          <td id="L36" data-line-number="36"></td>
          <td id="LC36"><span>- If you want to add an onClick event handler to buttons etc. use</span></td>
        </tr>
        <tr>
          <td id="L37" data-line-number="37"></td>
          <td id="LC37"><span>  the `navigate` function, e.g.:</span></td>
        </tr>
        <tr>
          <td id="L38" data-line-number="38"></td>
          <td id="LC38"><span>  </span></td>
        </tr>
        <tr>
          <td id="L39" data-line-number="39"></td>
          <td id="LC39"><span>  &lt;Button variant=&#34;contained&#34; onClick={(e) =&gt; navigate(&#34;/Register&#34;)} fullWidth&gt;Register&lt;/Button&gt;</span></td>
        </tr>
        <tr>
          <td id="L40" data-line-number="40"></td>
          <td id="LC40"><span></span></td>
        </tr>
        <tr>
          <td id="L41" data-line-number="41"></td>
          <td id="LC41"><span>- You need to import Link &amp; Navigate to use them, e.g.:</span></td>
        </tr>
        <tr>
          <td id="L42" data-line-number="42"></td>
          <td id="LC42"><span>import { Navigate, Link } from &#34;./Components/AKRouter&#34;;</span></td>
        </tr>
        <tr>
          <td id="L43" data-line-number="43"></td>
          <td id="LC43"><span></span></td>
        </tr>
        <tr>
          <td id="L44" data-line-number="44"></td>
          <td id="LC44"><span></span></td>
        </tr>
        <tr>
          <td id="L45" data-line-number="45"></td>
          <td id="LC45"><span>And that&#39;s it!</span></td>
        </tr>
        <tr>
          <td id="L46" data-line-number="46"></td>
          <td id="LC46"><span></span></td>
        </tr>
        <tr>
          <td id="L47" data-line-number="47"></td>
          <td id="LC47"><span>*/</span></td>
        </tr>
        <tr>
          <td id="L48" data-line-number="48"></td>
          <td id="LC48">
</td>
        </tr>
        <tr>
          <td id="L49" data-line-number="49"></td>
          <td id="LC49">
</td>
        </tr>
        <tr>
          <td id="L50" data-line-number="50"></td>
          <td id="LC50">
</td>
        </tr>
        <tr>
          <td id="L51" data-line-number="51"></td>
          <td id="LC51"><span>/* Code Starts Here */</span></td>
        </tr>
        <tr>
          <td id="L52" data-line-number="52"></td>
          <td id="LC52">
</td>
        </tr>
        <tr>
          <td id="L53" data-line-number="53"></td>
          <td id="LC53"><span>import</span> <span>React</span> <span>from</span> <span>&#39;react&#39;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L54" data-line-number="54"></td>
          <td id="LC54"><span>import</span> <span>{</span> <span>useEffect</span><span>,</span> <span>useState</span> <span>}</span> <span>from</span> <span>&#39;react&#39;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L55" data-line-number="55"></td>
          <td id="LC55">
</td>
        </tr>
        <tr>
          <td id="L56" data-line-number="56"></td>
          <td id="LC56"><span>export</span> <span>default</span> <span>function</span> <span>Router</span> <span>(</span><span>{</span>routes<span>,</span> defaultComponent<span>}</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="L57" data-line-number="57"></td>
          <td id="LC57">
</td>
        </tr>
        <tr>
          <td id="L58" data-line-number="58"></td>
          <td id="LC58">    <span>// state to track URL and force component to re-render on change</span></td>
        </tr>
        <tr>
          <td id="L59" data-line-number="59"></td>
          <td id="LC59">    <span>const</span> <span>[</span><span>currentPath</span><span>,</span> <span>setCurrentPath</span><span>]</span> <span>=</span> <span>useState</span><span>(</span><span>window</span><span>.</span><span>location</span><span>.</span><span>pathname</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L60" data-line-number="60"></td>
          <td id="LC60">
</td>
        </tr>
        <tr>
          <td id="L61" data-line-number="61"></td>
          <td id="LC61">    <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="L62" data-line-number="62"></td>
          <td id="LC62">        <span>// define callback as separate function so it can be removed later with cleanup function</span></td>
        </tr>
        <tr>
          <td id="L63" data-line-number="63"></td>
          <td id="LC63">        <span>const</span> <span>onLocationChange</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="L64" data-line-number="64"></td>
          <td id="LC64">            <span>// update path state to current window URL</span></td>
        </tr>
        <tr>
          <td id="L65" data-line-number="65"></td>
          <td id="LC65">            <span>setCurrentPath</span><span>(</span><span>window</span><span>.</span><span>location</span><span>.</span><span>pathname</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L66" data-line-number="66"></td>
          <td id="LC66">        <span>}</span></td>
        </tr>
        <tr>
          <td id="L67" data-line-number="67"></td>
          <td id="LC67">
</td>
        </tr>
        <tr>
          <td id="L68" data-line-number="68"></td>
          <td id="LC68">        <span>// listen for popstate event</span></td>
        </tr>
        <tr>
          <td id="L69" data-line-number="69"></td>
          <td id="LC69">        <span>window</span><span>.</span><span>addEventListener</span><span>(</span><span>&#39;popstate&#39;</span><span>,</span> <span>onLocationChange</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L70" data-line-number="70"></td>
          <td id="LC70">
</td>
        </tr>
        <tr>
          <td id="L71" data-line-number="71"></td>
          <td id="LC71">        <span>// clean up event listener</span></td>
        </tr>
        <tr>
          <td id="L72" data-line-number="72"></td>
          <td id="LC72">        <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="L73" data-line-number="73"></td>
          <td id="LC73">            <span>window</span><span>.</span><span>removeEventListener</span><span>(</span><span>&#39;popstate&#39;</span><span>,</span> <span>onLocationChange</span><span>)</span></td>
        </tr>
        <tr>
          <td id="L74" data-line-number="74"></td>
          <td id="LC74">        <span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L75" data-line-number="75"></td>
          <td id="LC75">    <span>}</span><span>,</span> <span>[</span><span>]</span><span>)</span></td>
        </tr>
        <tr>
          <td id="L76" data-line-number="76"></td>
          <td id="LC76">
</td>
        </tr>
        <tr>
          <td id="L77" data-line-number="77"></td>
          <td id="LC77">    <span>console</span><span>.</span><span>log</span><span>(</span><span>Array</span><span>.</span><span>isArray</span><span>(</span><span>routes</span><span>)</span><span>)</span></td>
        </tr>
        <tr>
          <td id="L78" data-line-number="78"></td>
          <td id="LC78">    <span>console</span><span>.</span><span>log</span><span>(</span><span>typeof</span> <span>routes</span><span>)</span></td>
        </tr>
        <tr>
          <td id="L79" data-line-number="79"></td>
          <td id="LC79">    <span>return</span> <span>routes</span><span>.</span><span>find</span><span>(</span><span>(</span><span>{</span>path<span>,</span> component<span>}</span><span>)</span> <span>=&gt;</span> <span>path</span> <span>===</span> <span>currentPath</span><span>)</span><span>?.</span><span>component</span> <span>||</span> <span>defaultComponent</span></td>
        </tr>
        <tr>
          <td id="L80" data-line-number="80"></td>
          <td id="LC80"><span>}</span></td>
        </tr>
        <tr>
          <td id="L81" data-line-number="81"></td>
          <td id="LC81">
</td>
        </tr>
        <tr>
          <td id="L82" data-line-number="82"></td>
          <td id="LC82"><span>/* Use the below in buttons and programmatically to navigate to pages */</span></td>
        </tr>
        <tr>
          <td id="L83" data-line-number="83"></td>
          <td id="LC83">
</td>
        </tr>
        <tr>
          <td id="L84" data-line-number="84"></td>
          <td id="LC84"><span>export</span> <span>function</span> <span>navigate</span> <span>(</span><span>href</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="L85" data-line-number="85"></td>
          <td id="LC85">
</td>
        </tr>
        <tr>
          <td id="L86" data-line-number="86"></td>
          <td id="LC86">    <span>// update url</span></td>
        </tr>
        <tr>
          <td id="L87" data-line-number="87"></td>
          <td id="LC87">    <span>window</span><span>.</span><span>history</span><span>.</span><span>pushState</span><span>(</span><span>{</span><span>}</span><span>,</span> <span>&#34;&#34;</span><span>,</span> <span>href</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L88" data-line-number="88"></td>
          <td id="LC88">
</td>
        </tr>
        <tr>
          <td id="L89" data-line-number="89"></td>
          <td id="LC89">    <span>// communicate to Routes that URL has changed</span></td>
        </tr>
        <tr>
          <td id="L90" data-line-number="90"></td>
          <td id="LC90">    <span>const</span> <span>navEvent</span> <span>=</span> <span>new</span> <span>PopStateEvent</span><span>(</span><span>&#39;popstate&#39;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L91" data-line-number="91"></td>
          <td id="LC91">    <span>window</span><span>.</span><span>dispatchEvent</span><span>(</span><span>navEvent</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L92" data-line-number="92"></td>
          <td id="LC92"><span>}</span></td>
        </tr>
        <tr>
          <td id="L93" data-line-number="93"></td>
          <td id="LC93">
</td>
        </tr>
        <tr>
          <td id="L94" data-line-number="94"></td>
          <td id="LC94"><span>/* Use the below when you want the full hyperlink behaviour */</span></td>
        </tr>
        <tr>
          <td id="L95" data-line-number="95"></td>
          <td id="LC95">
</td>
        </tr>
        <tr>
          <td id="L96" data-line-number="96"></td>
          <td id="LC96"><span>export</span> <span>function</span> <span>Link</span> <span>(</span><span>{</span> className<span>,</span> href<span>,</span> children <span>}</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="L97" data-line-number="97"></td>
          <td id="LC97">
</td>
        </tr>
        <tr>
          <td id="L98" data-line-number="98"></td>
          <td id="LC98">    <span>const</span> <span>onClick</span> <span>=</span> <span>(</span><span>event</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="L99" data-line-number="99"></td>
          <td id="LC99">        <span>// if ctrl or meta key are held on click, allow default behavior of opening link in new tab</span></td>
        </tr>
        <tr>
          <td id="L100" data-line-number="100"></td>
          <td id="LC100">        <span>if</span> <span>(</span><span>event</span><span>.</span><span>metaKey</span> <span>||</span> <span>event</span><span>.</span><span>ctrlKey</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="L101" data-line-number="101"></td>
          <td id="LC101">            <span>return</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L102" data-line-number="102"></td>
          <td id="LC102">        <span>}</span></td>
        </tr>
        <tr>
          <td id="L103" data-line-number="103"></td>
          <td id="LC103">
</td>
        </tr>
        <tr>
          <td id="L104" data-line-number="104"></td>
          <td id="LC104">        <span>// prevent full page reload</span></td>
        </tr>
        <tr>
          <td id="L105" data-line-number="105"></td>
          <td id="LC105">        <span>event</span><span>.</span><span>preventDefault</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L106" data-line-number="106"></td>
          <td id="LC106">
</td>
        </tr>
        <tr>
          <td id="L107" data-line-number="107"></td>
          <td id="LC107">        <span>// update url</span></td>
        </tr>
        <tr>
          <td id="L108" data-line-number="108"></td>
          <td id="LC108">        <span>window</span><span>.</span><span>history</span><span>.</span><span>pushState</span><span>(</span><span>{</span><span>}</span><span>,</span> <span>&#34;&#34;</span><span>,</span> <span>href</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L109" data-line-number="109"></td>
          <td id="LC109">
</td>
        </tr>
        <tr>
          <td id="L110" data-line-number="110"></td>
          <td id="LC110">        <span>// communicate to Routes that URL has changed</span></td>
        </tr>
        <tr>
          <td id="L111" data-line-number="111"></td>
          <td id="LC111">        <span>const</span> <span>navEvent</span> <span>=</span> <span>new</span> <span>PopStateEvent</span><span>(</span><span>&#39;popstate&#39;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L112" data-line-number="112"></td>
          <td id="LC112">        <span>window</span><span>.</span><span>dispatchEvent</span><span>(</span><span>navEvent</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L113" data-line-number="113"></td>
          <td id="LC113">    <span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L114" data-line-number="114"></td>
          <td id="LC114">
</td>
        </tr>
        <tr>
          <td id="L115" data-line-number="115"></td>
          <td id="LC115">    <span>return</span> <span>(</span></td>
        </tr>
        <tr>
          <td id="L116" data-line-number="116"></td>
          <td id="LC116">        <span>&lt;</span><span>a</span> <span>className</span><span>=</span><span>{</span><span>className</span><span>}</span> <span>href</span><span>=</span><span>{</span><span>href</span><span>}</span> <span>onClick</span><span>=</span><span>{</span><span>onClick</span><span>}</span><span>&gt;</span></td>
        </tr>
        <tr>
          <td id="L117" data-line-number="117"></td>
          <td id="LC117">            <span>{</span><span>children</span><span>}</span></td>
        </tr>
        <tr>
          <td id="L118" data-line-number="118"></td>
          <td id="LC118">        <span>&lt;</span><span>/</span><span>a</span><span>&gt;</span></td>
        </tr>
        <tr>
          <td id="L119" data-line-number="119"></td>
          <td id="LC119">    <span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="L120" data-line-number="120"></td>
          <td id="LC120"><span>}</span><span>;</span></td>
        </tr>
  </tbody></div></div>
  </body>
</html>
