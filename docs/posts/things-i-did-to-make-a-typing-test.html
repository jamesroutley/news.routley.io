<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://liquidbrain.net/blog/things-i-did-to-make-a-typing-test/">Original</a>
    <h1>Things I did to make a typing test</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
            <p>Around a week ago, I made a typing test as part of a workshop on bad art. You can find it <a href="https://kai-williams.com/small-projects/typing-test/">here</a>. I&#39;d encourage you to try it now! It&#39;ll make the rest make sense.</p>
<p>In the post below, I go through in detail about the process making it, and what I learned along the way. It&#39;s a bit of an info-dump, so feel free to skip it.</p>
<p><em>tl;dr</em> If you have questions about using <a href="https://disco.cloud/">disco</a>, let me know!</p>

<p>The original typing test was exclusively made in html, JavaScript and a little bit of CSS. Within 45 minutes, I had made a minimal viable product. But ... this is evil enough that I need to share it with the world ... yes yes yes.</p>
<p>I started with GitHub pages. I was wanting to make a personal website anyways, and this was good excuse. I learned from the process, but mostly about how DNS caching is both an enemy and a friend.</p>
<p>One small detail I learned: I had not realized that <code>index.html</code> has special behavior<sup id="fnref:1"><a href="#fn:1">1</a></sup></p>

<p>This all was good, but there was a problem: I wanted a leaderboard. There&#39;s nothing quite like spending 6 minutes on a typing test and wondering whether other people can do it faster.</p>
<p>I decided to use FastAPI to implement the backend in python. This was sort of an arbitrary choice; I recently did a small project with Tywen Kelly where we used FastAPI.<sup id="fnref:2"><a href="#fn:2">2</a></sup> Other than that, I had never used a backend before, so there was a lot of learning to do.</p>
<p>The initial implementation was quite simple. All I needed to do was a) create leaderboard entries b) store them and c) return them to a website. Implementing these three functions (initially using a python list within <code>main.py</code>) took about an hour and 40 lines of code. This was mostly good to solidify what I had learned pairing with Python.</p>
<h2 id="html-leaderboard">HTML Leaderboard</h2>
<p>However, it wasn&#39;t enough to create the APIs. I needed to then pair that up with the front-end. Because my operations (get and set) repeated much of the same information, I structured the code to have a single function which performed the appropriate <code>fetch</code> request. Through this process, I learned quite a bit about javascript syntax (I think python ternary operators look better), but it was ultimately a straightfoward process. This felt like a straightforward feature to add.<sup id="fnref:3"><a href="#fn:3">3</a></sup></p>
<h2 id="sql-and-persistence">SQL and persistence</h2>
<p>There was one problem with my implementation: the data was being stored in an incredibly fragile way. Any time I restarted <code>main.py</code>, the leaderboard was initialized to an empty list. While this might not matter in ideal conditions where the script never goes down, I want to set up a more permanent database. Given that I haven&#39;t worked with SQL before, I thought this would be a great chance to do exactly that!</p>
<p>And then, I chose the wrong package to use. I used <code>sqlmodel</code>, which was made by the same people as <code>FastAPI</code>. The two work together very well, but <code>sqlmodel</code> feels very very abstracted and I had a tough time getting a good feel for what was going on under the hood.</p>
<p>The primary challenge I faced (with help from Saleh Alghusson, thanks!) was in storing the data correctly. The data was very simple -- all I&#39;m storing is the name and time -- but we ended up needing to introduce an <code>id</code> field to allow for duplicate names. However, with a little work, we got this running.</p>

<p>Now that I had it running locally, I needed to figure out a place to host the website. Github pages only will host static pages, so I needed someplace else. I heard about <a href="https://disco.cloud/">disco</a> from a <a href="https://www.recurse.com/events/localhost-disco-november-2024">talk</a> that Gred Sadetsky (one of the creators, and an RC alum!) gave. The Recurse Center has a shared raspberry pi running disco, and I figured that I would give it a shot. It was ... a lot. A lot of fun.</p>
<h2 id="downloading-disco">Downloading Disco</h2>
<p>The installation instructions online were simple: download a <code>.tar</code> file, extract it, and then add it to PATH. What could go wrong? I turns out, there were some windows symlink errors, and the default extractor just gave up.</p>
<p>With the help of Iain McDonald and Sebastian Messier, I was able to figure out a working solution, which I then wrote up. It required downloading 7-zip, and extracting the file twice. It ended up being fairly straightforward to figure out, once I calmed down enough to approach it with a straight head.</p>
<p><em>Lessons learned:</em></p>
<ul>
<li>Writing documentation is hard (I spent like 45 minutes trying to type out what I had done in the 30 minutes previous. I probably still failed)</li>
</ul>
<h2 id="starting-server-from-fastapi">Starting server from FastAPI</h2>
<p>Once I got disco downloaded, it was smooth sailing: I added my account to the shared server, added my <a href="https://github.com/ChiWilliams/typing-test/">typing test repo</a> to the Disco App, and created a new project. I copied the boilerplate from the tutorial example, and built the code. And then ... I got errors.</p>
<p>The first error was super simple: I had called my python file a different name than in the tutorial; quick 10 second fix. After asking how to reload a server manually (I can&#39;t read documentation, apparently),<sup id="fnref:4"><a href="#fn:4">4</a></sup> I was ready to display my website! It worked: and showed a blank screen.</p>
<p>After a bit of trial and error, I realized I needed to simplify things.</p>
<h2 id="playing-around-with-the-flaskfastapi-tutorial">Playing around with the ~Flask~FastAPI Tutorial</h2>
<p>There is helpfully a <a href="https://docs.letsdisco.dev/get-started/set-up-your-app">tutorial</a> on the disco apps for a simple flask app. Luckily, the code worked as written.</p>
<p>I started to modify it for FastAPI. The first thing I realized was that I needed to start the server from within the main python file. The FastAPI tutorial recommend using <code>fastapi run file_name.py</code> from the command line to start a server, but the Docker file setup called <code>python file_name.py</code> instead. I know less about Docker than Python, so I figured that I would just stick with modifying python for the moment. The result was simple:</p>
<p><code>import uvicorn
if __name__ == &#34;__main__&#34;:
 uvicorn.run(&#34;main:app&#34;, host=&#34;0.0.0.0&#34;, port=8000)</code></p>
<p>Take note of the port number; that will be important below.</p>
<h2 id="adding-html-and-javascript">Adding HTML and Javascript</h2>
<p>Now that I could call the server, I needed some way to show the HTML. I made the decision that I wanted all of the code together. I learned how FastAPI can work with HTML and javascript. Usually, FastAPI functions return a JSON object. However, using a special call (<code>response_call = HTMLContent</code>), they can return an HTML object which the browser then renders!</p>
<p>I iterated with that concept. It was a little difficult to add a separate javascript file, but I learned that one can mount &#34;static&#34; content in FastAPI, which did the trick. I made a little &#34;hello world&#34; template for FastAPI with disco <a href="https://github.com/ChiWilliams/disco-attempt/tree/3d7965303ed4df847d45244c960f7e3774305bcd">here</a> in case anyone is curious.</p>
<h2 id="ports">Ports</h2>
<p>I was able to get the toy example running, but couldn&#39;t get my typing test to display for the life of me. I tried a bunch of things: I moved the directories around, I modified the docker file, I even changed which version of python I was using. All no dice.</p>
<p>And then, I tried changing the port I was hosting the server on to 8080. It worked! And then I realized that I had been foolish, in my <code>disco.json</code> file, I was setting the server to function on port 8080, so I needed to fix that in my code. Suddenly, the front end displayed! But I couldn&#39;t make requests that went through?</p>
<p>After some more debugging, I asked Claude, who noted that I had hardcoded my front end to make requests to port 8000, and I needed to change that. That fixed this issue, but definitely illustrated bad coding hygeine. Is the correct approach to call both values from a configuration file?</p>
<h2 id="running-on-the-raspberry-pi">Running on the Raspberry Pi</h2>
<p>I was able to get this running locally, but there was an issue: my requests from the front-end were still throwing CORS errors when I hosted it on Disco. (For understandable reasons, servers won&#39;t usually accept requests from unknown endpoints; you have to configure this behavior to change it). I couldn&#39;t quite figure out how to do this locally on the Raspberry Pi, but I realized I didn&#39;t need to! I could just have the front-end call the public API, and all would be right with the world.</p>
<p>And this worked! Except for the bit where I forgot to add <code>kai-williams.com</code> to the CORS setting until after I had publicly released it. But now it&#39;s done. Yay!</p>

<p>It&#39;s now public at <a href="https://tratt.net/laurie/blog/2024/kai-williams.com/small-projects/typing-test"></a>, and I encourage you to give it a try. It&#39;s a little difficult, so don&#39;t lose heart too quickly. I have a couple issues that I might get around to solving (but likely not).</p>
<ol>
<li>
<p>The way I currently have it set up is that when I push a new update to Disco, the SQL file is wiped. I need to figure out how to</p>
</li>
<li>
<p>There should be some sort of cheating prevention -- one of the people at RC did it in 2 seconds ... which really isn&#39;t physically possible.</p>
</li>
</ol>
<p><em>Lessons learned</em>:</p>
<ul>
<li>
<p>Rome wasn&#39;t built in a day; it often takes a bit to understand and build something new. Even if the final project isn&#39;t particularly impressive, the learning is what matters! (That, and infuriating your friends)</p>
</li>
<li>
<p>Starting with a small project is good when trying to learn something completely new. I&#39;m gonna make some questionable decisions (using FastAPI; not keeping my front-end completely separate; etc.), and it&#39;s easier for that not to be a problem in a small project.</p>
</li>
<li>
<p>Writing things is hard!</p>
</li>
<li>
<p>I would like to start writing down a debugging journal; I learned quite a bit from going through my git commits to see what I tried, and how I approached problems.</p>
</li>
</ul>

<p>Thanks to Greg Sadetsky for answering my questions about disco!</p>
<p>Thanks to Saleh Alghusson for pairing with me on the SQL database stuff!</p>
<p>Thanks to Tywen Kelly for showing me FastAPI and being a good sounding board.</p>
<p>Thanks to Iain McDonald and Sebastian Messier for helping me figure out how to install Disco!</p>
<p>Thanks to everyone at RC for the encouragement! </p>

        </div></div>
  </body>
</html>
