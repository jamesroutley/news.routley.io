<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.gentoo.org/news/2023/12/29/Gentoo-binary.html">Original</a>
    <h1>Gentoo goes Binary</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div>
        <div id="content">
          

<p><a href="https://www.gentoo.org/news/2023/12/29/Gentoo-binary.html">
  <img src="https://www.gentoo.org/assets/img/news/2023/larry-packages.png" alt="Larry the cow with packages"/>
</a></p>

<p>You probably all know Gentoo Linux as your favourite source-based distribution.
Did you know that our package manager, Portage, already for years also has support for binary
packages, and that source- and binary-based package installations can be freely mixed?</p>

<p>To speed up working with slow hardware and for overall convenience, we’re now also offering
<strong>binary packages for download and direct installation</strong>! For most architectures, this is
limited to the core system and weekly updates - not so for <strong>amd64 and arm64</strong> however. There we’ve got a 
stunning <strong>&gt;20 GByte of packages</strong> on our mirrors, from LibreOffice to KDE Plasma and from Gnome to Docker.
Gentoo stable, updated daily. Enjoy! And <a href="https://www.gentoo.org/news/2023/12/29/Gentoo-binary.html">read 
on for more details!</a></p>

<!--more-->

<h2 id="questions--answers">Questions &amp; Answers</h2>

<h3 id="how-can-i-set-up-my-existing-gentoo-installation-to-use-these-packages">How can I set up my existing Gentoo installation to use these packages?</h3>

<p><a href="https://wiki.gentoo.org/wiki/Binary_package_quickstart">Quick setup instructions</a> for
the most common cases can be found in our wiki. In short, you need to create a configuration 
file in <code>/etc/portage/binrepos.conf/</code>.</p>

<p>In addition, we have a rather neat <a href="https://wiki.gentoo.org/wiki/Binary_package_guide">binary package guide</a> on
our Wiki that goes into much more detail.</p>

<h3 id="what-do-i-have-to-do-with-a-new-stage--new-installation">What do I have to do with a new stage / new installation?</h3>

<p>New stages already contain the suitable <code>/etc/portage/binrepos.conf/gentoobinhost.conf</code>. You are
good to go from the start, although you may want to replace the <code>src-uri</code> 
setting in there with an URI pointing to the corresponding directory on a 
<a href="https://www.gentoo.org/downloads/mirrors/">local mirror</a>.</p>

<blockquote>
  <p><code>$ emerge -uDNavg @world</code></p>
</blockquote>

<h3 id="what-compile-settings-use-flags--do-the-normal-amd64-packages-use">What compile settings, use flags, … do the ‘‘normal’’ amd64 packages use?</h3>

<p>The binary packages under <code>amd64/binpackages/17.1/x86-64</code> are compiled using
<code>CFLAGS=&#34;-march=x86-64 -mtune=generic -O2 -pipe&#34;</code> and will work with any amd64 / x86-64 machine.</p>

<p>The available useflag settings and versions correspond to the stable packages
of the <code>amd64/17.1/nomultilib</code> (i.e., openrc), <code>amd64/17.1/desktop/plasma/systemd</code>,
and <code>amd64/17.1/desktop/gnome/systemd</code> profiles. This should provide fairly large
coverage.</p>

<h3 id="what-compile-settings-use-flags--do-the-normal-arm64-packages-use">What compile settings, use flags, … do the ‘‘normal’’ arm64 packages use?</h3>

<p>The binary packages under <code>arm64/binpackages/17.0/arm64</code> are compiled using
<code>CFLAGS=&#34;-O2 -pipe&#34;</code> and will work with any arm64 / AArch64 machine.</p>

<p>The available useflag settings and versions correspond to the stable packages
of the <code>arm64/17.0</code> (i.e., openrc), <code>arm64/17.0/desktop/plasma/systemd</code>,
and <code>arm64/17.0/desktop/gnome/systemd</code> profiles.</p>

<h3 id="but-hey-thats-not-optimized-for-my-cpu">But hey, that’s not optimized for my CPU!</h3>

<p>Tough luck. You can still compile packages yourself just as before!</p>

<h3 id="what-settings-do-the-packages-for-other-architectures-and-abis-use">What settings do the packages for other architectures and ABIs use?</h3>

<p>The binary package hosting is wired up with the stage builds. Which
means, for about every stage there is a binary package hosting which 
covers (only) the stage contents and settings. There are no further plans 
to expand coverage for now. But hey, this includes the compiler (gcc or
clang) and the whole build toolchain!</p>

<h3 id="are-the-packages-cryptographically-signed">Are the packages cryptographically signed?</h3>

<p>Yes, with the <a href="https://www.gentoo.org/downloads/signatures/">same key as the stages</a>.</p>

<h3 id="are-the-cryptographic-signatures-verified-before-installation">Are the cryptographic signatures verified before installation?</h3>

<p>Yes, with one limitation (in the default setting).</p>

<p>Portage knows two binary package formats, XPAK (old) and GPKG (new). Only GPKG supports
cryptographic signing. Until recently, XPAK was the default setting (and it may still
be the default on your installation since this is not changed during upgrade, but only
at new installation).</p>

<p>The new, official Gentoo binary packages are all in GPKG format.
GPKG packages have their signature verified, and if this fails, installation is refused.
To avoid breaking compatibility with old binary packages, by default XPAK
packages (which do not have signatures) can still be installed however.</p>

<p>If you want to require verified signatures (which is something we strongly recommend), 
set <code>FEATURES=&#34;binpkg-request-signature&#34;</code> in <code>make.conf</code>. Then, obviously, you can also
only use GPKG packages.</p>

<h3 id="i-get-an-error-that-signatures-cannot-be-verified">I get an error that signatures cannot be verified.</h3>

<p>Try running the Gentoo Trust Tool <code>getuto</code> as root.</p>

<blockquote>
  <p><code>$ getuto</code></p>
</blockquote>

<p>This should set up the required key ring with the Gentoo Release Engineering keys for
Portage.</p>

<p>If you have <code>FEATURES=&#34;binpkg-request-signature&#34;</code> enabled in <code>make.conf</code>, then <code>getuto</code>
is called automatically before every binary package download operation, to make sure
that key updates and revocations are imported.</p>

<h3 id="ive-made-binary-packages-myself-and-portage-refuses-to-use-them-now">I’ve made binary packages myself and portage refuses to use them now!</h3>

<p>Well, you found the side effect of <code>FEATURES=&#34;binpkg-request-signature&#34;</code>.
For your self-made packages you will need to set up a signing key and have that key
trusted by the anchor in <code>/etc/portage/gnupg</code>.</p>

<p>The <a href="https://wiki.gentoo.org/wiki/Binary_package_guide">binary package guide</a> on
our Wiki will be helpful here.</p>

<h3 id="my-download-is-slow">My download is slow.</h3>

<p>Then pretty please use a <a href="https://www.gentoo.org/downloads/mirrors/">local mirror</a>
instead of downloading from University of Oregon. You can just edit the URI 
in your <code>/etc/portage/binrepos.conf</code>. And yes, that’s safe, because of the 
cryptographic signature.</p>

<h3 id="my-portage-still-wants-to-compile-from-source">My Portage still wants to compile from source.</h3>

<p>If you use useflag combinations deviating from the profile default, then
you can’t and won’t use the packages. Portage will happily mix and match though
and combine binary packages with locally compiled ones. Gentoo still remains
a source-based distribution, and we are not aiming for a full binary-only 
installation without any compilation at all.</p>

<h3 id="can-i-use-the-packages-on-a-merged-usr-system">Can I use the packages on a merged-usr system?</h3>

<p>Yes. (If anything breaks, then this is a bug and <a href="https://bugs.gentoo.org/">should be reported</a>.)</p>

<h3 id="can-i-use-the-packages-with-other-older-or-newer-profile-versions">Can I use the packages with other (older or newer) profile versions?</h3>

<p><strong>No.</strong> That’s why the <code>src-uri</code> path contains, e.g.,  “17.1”.
<strong>When there’s a new profile version, we’ll also provide new, separate package directories.</strong></p>

<h3 id="any-plans-to-offer-binary-packages-of-amd64-">Any plans to offer binary packages of ~amd64 ?</h3>

<p>Not yet. This would mean a ton of rebuilds… If we offer it one day, it’ll 
be at a separate URI for technical reasons.</p>

<p>The advice for now is to stick to stable as much as possible, and locally
add in <code>package.accept_keywords</code> whatever packages from testing you want to use.
This means you can still use a large amount of binary packages, and just
compile the rest yourself.</p>

<h3 id="i-have-found-a-problem-with-portage-or-a-specific-package">I have found a problem, with portage or a specific package!</h3>

<p>Then please <strong>ask for advice</strong> (on IRC, the forums, or a mailing list) and/or 
<a href="https://bugs.gentoo.org/"><strong>file a bug!</strong></a></p>

<p>Binary package support has been tested for some time, but with many more people using
it edge cases will certainly occur, and quality bug reports are always appreciated!</p>

<h3 id="any-pretty-pictures">Any pretty pictures?</h3>

<p>Of course! Here’s the amount of binary package data in GByte for each architecture…</p>

<p><img src="https://www.akhuettel.de/~huettel/plots/mirrors/binpackages-month.png" alt="package data over time"/></p>

        </div>
      </div>
    </div></div>
  </body>
</html>
