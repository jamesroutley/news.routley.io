<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mypy-lang.blogspot.com/2023/10/mypy-16-released.html">Original</a>
    <h1>Mypy 1.6</h1>
    
    <div id="readability-page-1" class="page"><div id="post-body-5084670918402599778" itemprop="description articleBody">

<meta charset="utf-8"/>

<p>We’ve just uploaded mypy 1.6 to the Python Package Index (<a href="https://pypi.org/project/mypy/">PyPI</a>). Mypy is a static type checker for Python. This release includes new features, performance improvements and bug fixes. You can install it as follows:


</p><pre>    python3 -m pip install -U mypy
</pre>

<p>You can read the full documentation for this release on <a href="http://mypy.readthedocs.io">Read the Docs</a>.

</p><h2>Introduce Error Subcodes for Import Errors</h2>

<p>Mypy now uses the error code <tt>import-untyped</tt> if an import targets an installed library that doesn’t support static type checking, and no stub files are available. Other invalid imports produce the <tt>import-not-found</tt> error code. They both are subcodes of the <tt>import</tt> error code, which was previously used for both kinds of import-related errors. 

</p><p>Use <tt>--disable-error-code=import-untyped</tt> to only ignore import errors about installed libraries without stubs. This way mypy will still report errors about typos in import statements, for example.

</p><p>If you use  <tt>--warn-unused-ignore</tt> or <tt>--strict</tt>, mypy will complain if you use <tt># type: ignore[import]</tt> to ignore an import error. You are expected to use one of the more specific error codes instead. Otherwise, ignoring the <tt>import</tt> error code continues to silence both errors.

</p><p>This feature was contributed by Shantanu (PR <a href="https://github.com/python/mypy/pull/15840">15840</a>, PR <a href="https://github.com/python/mypy/pull/14740">14740</a>).

</p><h2>Remove Support for Targeting Python 3.6 and Earlier</h2>

<p>Running mypy with <tt>--python-version 3.6</tt>, for example, is no longer supported. Python 3.6 hasn’t been properly supported by mypy for some time now, and this makes it explicit. This was contributed by Nikita Sobolev (PR <a href="https://github.com/python/mypy/pull/15668">15668</a>).

</p><h2>Selective Filtering of <tt>--disallow-untyped-calls</tt> Targets</h2>

<p>Using <tt>--disallow-untyped-calls</tt> could be annoying when using libraries with missing type information, as mypy would generate many errors about code that uses the library. Now you can use <tt>--untyped-calls-exclude=acme</tt>, for example, to disable these errors about calls targeting functions defined in the <tt>acme</tt> package. Refer to the <a href="https://mypy.readthedocs.io/en/latest/command_line.html#cmdoption-mypy-untyped-calls-exclude">documentation</a> for more information.

</p><p>This feature was contributed by Ivan Levkivskyi (PR <a href="https://github.com/python/mypy/pull/15845">15845</a>).

</p><h2>Improved Type Inference between Callable Types</h2>

<p>Mypy now does a better job inferring type variables inside arguments of callable types. For example, this code fragment now type checks correctly:


</p><pre>    def f(c: Callable[[T, S], None]) -&gt; Callable[[str, T, S], None]: ...
    def g(*x: int) -&gt; None: ...
    
    reveal_type(f(g))  # Callable[[str, int, int], None]
</pre>

<p>This was contributed by Ivan Levkivskyi (PR <a href="https://github.com/python/mypy/pull/15910">15910</a>).

</p><h2>Don’t Consider None and TypeVar to Overlap in Overloads</h2>

<p>Mypy now doesn’t consider an overload item with an argument type <tt>None</tt> to overlap with a type variable:

</p><pre>    @overload
    def f(x: None) -&gt; None: ..
    @overload
    def f(x: T) -&gt; Foo[T]: ...
    ...
</pre>

<p>Previously mypy would generate an error about the definition of <tt>f</tt> above. This is slightly unsafe if the upper bound of <tt>T</tt> is <tt>object</tt>, since the value of the type variable could be <tt>None</tt>. We relaxed the rules a little, since this solves a common issue.

</p><p>This feature was contributed by Ivan Levkivskyi (PR <a href="https://github.com/python/mypy/pull/15846">15846</a>).

</p><h2>Improvements to <tt>--</tt><tt>new-type-inference</tt></h2>

<p>The experimental new type inference algorithm (polymorphic inference) introduced as an opt-in feature in mypy 1.5 has several improvements:

</p><ul>
<li>Improve transitive closure computation during constraint solving (Ivan Levkivskyi, PR <a href="https://github.com/python/mypy/pull/15754">15754</a>)
</li><li>Add support for upper bounds and values with <tt>--new-type-inference</tt> (Ivan Levkivskyi, PR <a href="https://github.com/python/mypy/pull/15813">15813</a>)
</li><li>Basic support for variadic types with <tt>--new-type-inference</tt> (Ivan Levkivskyi, PR <a href="https://github.com/python/mypy/pull/15879">15879</a>)
</li><li>Polymorphic inference: support for parameter specifications and lambdas (Ivan Levkivskyi, PR <a href="https://github.com/python/mypy/pull/15837">15837</a>)
</li><li>Invalidate cache when adding <tt>--new-type-inference</tt> (Marc Mueller, PR <a href="https://github.com/python/mypy/pull/16059">16059</a>)
</li></ul>

<p><b>Note:</b> We are planning to enable <tt>--new-type-inference</tt> by default in mypy 1.7. Please try this out and let us know if you encounter any issues.

</p><h2>ParamSpec Improvements</h2>
<ul>
<li>Support self-types containing ParamSpec (Ivan Levkivskyi, PR <a href="https://github.com/python/mypy/pull/15903">15903</a>)
</li><li>Allow “…” in Concatenate, and clean up ParamSpec literals (Ivan Levkivskyi, PR <a href="https://github.com/python/mypy/pull/15905">15905</a>)
</li><li>Fix ParamSpec inference for callback protocols (Ivan Levkivskyi, PR <a href="https://github.com/python/mypy/pull/15986">15986</a>)
</li><li>Infer ParamSpec constraint from arguments (Ivan Levkivskyi, PR <a href="https://github.com/python/mypy/pull/15896">15896</a>)
</li><li>Fix crash on invalid type variable with ParamSpec (Ivan Levkivskyi, PR <a href="https://github.com/python/mypy/pull/15953">15953</a>)
</li><li>Fix subtyping between ParamSpecs (Ivan Levkivskyi, PR <a href="https://github.com/python/mypy/pull/15892">15892</a>)
</li></ul>
<h2>Stubgen Improvements</h2>
<ul>
<li>Add option to include docstrings with stubgen (chylek, PR <a href="https://github.com/python/mypy/pull/13284">13284</a>)
</li><li>Add required <tt>...</tt> initializer to <tt>NamedTuple</tt> fields with default values (Nikita Sobolev, PR <a href="https://github.com/python/mypy/pull/15680">15680</a>)
</li></ul>
<h2>Stubtest Improvements</h2>
<ul>
<li>Fix <tt>__mypy-replace</tt> false positives (Alex Waygood, PR <a href="https://github.com/python/mypy/pull/15689">15689</a>)
</li><li>Fix edge case for <tt>bytes</tt> enum subclasses (Alex Waygood, PR <a href="https://github.com/python/mypy/pull/15943">15943</a>)
</li><li>Generate error if typeshed is missing modules from the stdlib (Alex Waygood, PR <a href="https://github.com/python/mypy/pull/15729">15729</a>)
</li><li>Fixes to new check for missing stdlib modules (Alex Waygood, PR <a href="https://github.com/python/mypy/pull/15960">15960</a>)
</li><li>Fix stubtest <tt>enum.Flag</tt> edge case (Alex Waygood, PR <a href="https://github.com/python/mypy/pull/15933">15933</a>)
</li></ul>
<h2>Documentation Improvements</h2>
<ul>
<li>Do not advertise to create your own <tt>assert_never</tt> helper (Nikita Sobolev, PR <a href="https://github.com/python/mypy/pull/15947">15947</a>)
</li><li>Fix all the missing references found within the docs (Albert Tugushev, PR <a href="https://github.com/python/mypy/pull/15875">15875</a>)
</li><li>Document <tt>await-not-async</tt> error code (Shantanu, PR <a href="https://github.com/python/mypy/pull/15858">15858</a>)
</li><li>Improve documentation of disabling error codes (Shantanu, PR <a href="https://github.com/python/mypy/pull/15841">15841</a>)
</li></ul>
<h2>Other Notable Changes and Fixes</h2>
<ul>
<li>Make unsupported PEP 695 features (introduced in Python 3.12) give a reasonable error message (Shantanu, PR <a href="https://github.com/python/mypy/pull/16013">16013</a>)
</li><li>Remove the <tt>--py2</tt> command-line argument (Marc Mueller, PR <a href="https://github.com/python/mypy/pull/15670">15670</a>)
</li><li>Change empty tuple from <tt>tuple[]</tt> to <tt>tuple[()]</tt> in error messages (Nikita Sobolev, PR <a href="https://github.com/python/mypy/pull/15783">15783</a>)
</li><li>Fix <tt>assert_type</tt> failures when some nodes are deferred (Nikita Sobolev, PR <a href="https://github.com/python/mypy/pull/15920">15920</a>)
</li><li>Generate error on unbound TypeVar with values (Nikita Sobolev, PR <a href="https://github.com/python/mypy/pull/15732">15732</a>)
</li><li>Fix over-eager <tt>types-google-cloud-ndb</tt> suggestion (Shantanu, PR <a href="https://github.com/python/mypy/pull/15347">15347</a>)
</li><li>Fix type narrowing of <tt>== None</tt> and <tt>in (None,)</tt> conditions (Marti Raudsepp, PR <a href="https://github.com/python/mypy/pull/15760">15760</a>)
</li><li>Fix inference for <tt>attrs.fields</tt> (Shantanu, PR <a href="https://github.com/python/mypy/pull/15688">15688</a>)
</li><li>Make “await in non-async function” a non-blocking error and give it an error code (Gregory Santosa, PR <a href="https://github.com/python/mypy/pull/15384">15384</a>)
</li><li>Add basic support for decorated overloads (Ivan Levkivskyi, PR <a href="https://github.com/python/mypy/pull/15898">15898</a>)
</li><li>Fix TypeVar regression with self types (Ivan Levkivskyi, PR <a href="https://github.com/python/mypy/pull/15945">15945</a>)
</li><li>Add <tt>__match_args__</tt> to dataclasses with no fields (Ali Hamdan, PR <a href="https://github.com/python/mypy/pull/15749">15749</a>)
</li><li>Include stdout and stderr in dmypy verbose output (Valentin Stanciu, PR <a href="https://github.com/python/mypy/pull/15881">15881</a>)
</li><li>Improve match narrowing and reachability analysis (Shantanu, PR <a href="https://github.com/python/mypy/pull/15882">15882</a>)
</li><li>Support <tt>__bool__</tt> with <tt>Literal</tt> in <tt>--warn-unreachable</tt> (Jannic Warken, PR <a href="https://github.com/python/mypy/pull/15645">15645</a>)
</li><li>Fix inheriting from generic <tt>@frozen</tt> attrs class (Ilya Priven, PR <a href="https://github.com/python/mypy/pull/15700">15700</a>)
</li><li>Correctly narrow types for <tt>tuple[type[X], ...]</tt> (Nikita Sobolev, PR <a href="https://github.com/python/mypy/pull/15691">15691</a>)
</li><li>Don&#39;t flag intentionally empty generators unreachable (Ilya Priven, PR <a href="https://github.com/python/mypy/pull/15722">15722</a>)
</li><li>Add tox.ini to mypy sdist (Marcel Telka, PR <a href="https://github.com/python/mypy/pull/15853">15853</a>)
</li><li>Fix mypyc regression with pretty (Shantanu, PR <a href="https://github.com/python/mypy/pull/16124">16124</a>)
</li></ul>
<h2>Typeshed Updates</h2>

<p>Typeshed is now modular and distributed as separate PyPI packages for everything except the standard library stubs. Please see <a href="https://github.com/python/typeshed/commits/main?after=6a8d653a671925b0a3af61729ff8cf3f90c9c662+0&amp;branch=main&amp;path=stdlib">git log</a> for full list of typeshed changes.

</p><h2>Acknowledgements</h2>

<p>Thanks to Max Murin, who did most of the release manager work for this release (I just did
  the final steps).
  
</p><p>Thanks to all mypy contributors who contributed to this release:

</p><ul>
<li>Albert Tugushev
</li><li>Alex Waygood
</li><li>Ali Hamdan
</li><li>chylek
</li><li>EXPLOSION
</li><li>Gregory Santosa
</li><li>Ilya Priven
</li><li>Ivan Levkivskyi
</li><li>Jannic Warken
</li><li>KotlinIsland
</li><li>Marc Mueller
</li><li>Marcel Johannesmann
</li><li>Marcel Telka
</li><li>Mark Byrne
</li><li>Marti Raudsepp
</li><li>Max Murin
</li><li>Nikita Sobolev
</li><li>Shantanu
</li><li>Valentin Stanciu
</li></ul>


</div></div>
  </body>
</html>
