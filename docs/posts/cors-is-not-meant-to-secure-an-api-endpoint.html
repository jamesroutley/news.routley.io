<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nikofischer.com/cors-does-not-secure-api-endpoints">Original</a>
    <h1>CORS is not meant to secure an API endpoint</h1>
    
    <div id="readability-page-1" class="page"><div property="schema:text"><p>A few days ago I came across this <a href="https://designkojo.com/post-drupal-using-jsonapi-vuejs-front-end">article</a>. The author shows how to access a <a href="https://drupal.org">Drupal</a> system in the backend with a Vue.js app. For authentication he uses an API key - and I find that dangerous. Here&#39;s why.</p>

<p>First, let me briefly explain the setup presented in the article: The backend is provided by Drupal. Drupal has integrated a JSON API in core since version 8, which can be easily activated via module management. With this it is now possible to access all entities (e.g. users, nodes, etc.) and read them via GET request.</p>

<p>It is also possible to enable write access here.</p>

<p>The JSON API is based on the defined permissions in the Drupal system. So if a user has no read access to a content, then this content can also not be loaded via the JSON API. The same is true here for write access: an entity can only be created, modified or deleted if the accessing user has the appropriate permission.</p>

<h2>He accesses the Drupal backend with Vue.js</h2>

<p>But back to the article: Here, the author describes how he accesses the Drupal backend in a client-side Vue app to create content. In the example shown, he creates a content (also called a node in Drupal) of type &#34;article&#34;.</p>

<p>Now it gets interesting: he has configured his Drupal system so that only logged-in users can create articles. So, in order to create an article via the JSON API, he must first authenticate himself.</p>

<p>There are several ways to authenticate to Drupal. The usual way is via a username and password. This is not only possible directly via the frontend, but also via the API. Here Drupal returns a session ID after successful authentication, which you can cache and use for all further requests.</p>

<h2>Authentication via API Key instead of username &amp; password</h2>

<p>The author now uses another way: he installs the <a href="https://www.drupal.org/project/key_auth">Key auth</a> module. This creates an API key for each user in the backend, which can be used for the authentication to the API. For this purpose, the parameter &#34;api-key&#34; must be passed with the key as value for each call. With this the user is automatically authenticated in Drupal and has all assigned rights.</p>

<h2>The mistake: API Key in the source code</h2>

<p>And here he makes a dangerous mistake: he integrates the API key from the Drupal backend into his Vue.js app to be able to authenticate to the API and create content.</p>

<h2>Why is this a mistake?</h2>

<p>A Vue.js app is executed client-side nin the user&#39;s browser. This means that the source code is sent from the server directly to the browser. Now here the user has full access to the source code and can also read the auth key it contains.</p>

<h2>But I have stored the Auth Key in an environment variable</h2>

<p>An environment variable is written to the source code during the build process of the web app. Environment variables are meant (as the name suggests) to provide different variables for different environments. For example, you can use different variables in a development environment than in a staging environment or a production environment. For example, if you want to integrate the payment provider <a href="https://stripe.com">Stripe</a>, you can use Stripe&#39;s test mode in the development and staging environment, while you use Stripe&#39;s live mode in the production environment.</p>

<h2>But the CORS setting makes sure that I can only access the backend from a certain domain</h2>

<p><strong>No!</strong> CORS is an implementation in the browser and is designed to protect the user from malicious applications by ensuring that the resource in the browser is only allowed to access specific endpoints.</p>

<p>This browser implementation can be bypassed at any time. First, it is up to the browser itself: if CORS is not integrated, or not integrated cleanly, then it will not work. The server sends a CORS header and it is up to the browser to decide how to handle it. This is not a security element, because it is not in the hands of the server to deny access here, but solely in the hands of the browser.</p>

<h2>A possible attack scenario</h2>

<p>An attacker can access the API key via the source code of the web app and use it, for example, via a cURL request to directly access the API resources of the backend. With cURL, no CORS takes effect, so the attacker has direct access with the full rights of the user.</p>

<h2>Would you publish a username with password?</h2>

<p>An API key is an alternative to a username and password. Nobody would think of storing a username and password in the source code of a web app.</p>

<p>However, there are scenarios where this would still be possible. For example, if the API key had restricted rights. This is certainly the case for some services (e.g. some Google services, like Google Maps).</p>

<p>However, the &#34;Key auth&#34; module described in the article does not restrict the rights of the key. It is just an alternative to the username &amp; password.</p>

<h2>Why I think the article by Designkojo is dangerous</h2>

<p>I came across the article because I was looking for ways to authenticate a Vue APP to a Drupal backend. Designkojo&#39;s article was one of the first to show up at the top of the search engine. In addition, the article has charm: it is well and compactly described. Especially for beginners the described way is easy and fast to implement. And it suggests: authentication via API key is a common way for a Web-App. And this is where it gets dangerous: especially inexperienced developers can fall for it and think that this is a common way to authenticate with a web app to a backend.</p>

<p>I contacted the author of the article via Twitter and explained my point of view. We had a discussion about it and he got my point. He added a warning to his article.</p></div></div>
  </body>
</html>
