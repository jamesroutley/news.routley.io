<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lwn.net/SubscriberLink/888043/66bf43728bb39692/">Original</a>
    <h1>Python finally offloads some batteries</h1>
    
    <div id="readability-page-1" class="page"><div>
<!-- $Id: slink-none,v 1.2 2005-11-04 22:11:18 corbet Exp $ -->
<blockquote>
<div>
<h3>Welcome to LWN.net</h3>
<p>
The following subscription-only content has been made available to you 
by an LWN subscriber.  Thousands of subscribers depend on LWN for the 
best news from the Linux and free software communities.  If you enjoy this 
article, please consider <a href="https://chanind.github.io/subscribe/">subscribing to LWN</a>.  Thank you
for visiting LWN.net!
</p></div>
</blockquote>

<p>
Python has often been touted as a &#34;batteries included&#34; language because of
its rich <a href="https://docs.python.org/3/library/">standard library</a>
that provides access to numerous utility modules and is distributed with
the language itself.  But those libraries need maintenance, of course, and
that is provided by the Python core development team.  Over the years, it
has become clear that some of the modules are not really being maintained
any longer and they probably are not really needed by most Python
users—either because better alternatives exist or because they address
extremely niche use cases.  A long-running project to start the removal of those
modules has recently been approved.
</p>

<p>
A 2018 Python Language Summit <a href="https://chanind.github.io/Articles/755229/">session</a> was
the start of Christian Heimes&#39;s quest to unplug some of the old batteries
in the standard library.  That discussion <a href="https://chanind.github.io/Articles/790677/">led</a> to the <a href="https://chanind.github.io/ml/python-dev/bf0bf5b8-1ef0-556b-632c-eaebfb325496@python.org/">first
draft</a> of <a href="https://peps.python.org/pep-0594/">PEP 594</a>
(&#34;<span>Removing dead batteries from the standard library</span>&#34;) in
May 2019.  It listed more than two dozen modules, scattered across the
standard library, to consider for removal.
</p>

<p>
The PEP has been floating around in Python space since that time; in
general, core developers have been favorably inclined toward the idea,
though deciding exactly <i>which</i> modules would be removed was always
difficult.  The process of removing a module from the standard library
starts with deprecation for two release cycles, followed by the actual removal.  But
the project has struggled with how to handle deprecations in the language over the last few
years, as our <a href="https://chanind.github.io/Archives/PythonIndex/#Deprecation">Python article
index entry</a> shows.
</p>

<h4>Revival</h4>

<p>
Discussion of the PEP occurred sporadically in a <a href="https://discuss.python.org/t/pep-594-removing-dead-batteries-from-the-standard-library/1704">thread
on the Python discussion forum</a> since Heimes first posted the PEP there
in 2019.  In early February, the PEP was revived
by new co-author Brett Cannon in a <a href="https://discuss.python.org/t/pep-594-take-2-removing-dead-batteries-from-the-standard-library/13508">new
forum post</a>.  Cannon said that he expected to propose it for a decision
by the steering council (of which he is a member) soon, &#34;<span>barring any
major objections that come up in this topic</span>&#34;.  As can be seen in the
<a href="https://peps.python.org/pep-0594/#update-history">update
history</a> section of the PEP, the list of modules to be removed has
evolved over time.
</p>

<p>
The current version removes 21 separate modules that are described in
the PEP abstract as: &#34;<span>mostly historic data formats
(e.g. Commodore and SUN file formats), APIs and operating systems that have
been superseded a long time ago (e.g. Mac OS 9), or modules that have
security implications and better alternatives (e.g. password and
login).</span>&#34;  
The full list of modules that would be removed in the PEP is as follows:
</p><blockquote>
<table>
<tbody><tr><th>Type</th> <th>Modules</th></tr>
<tr><td>Data encoding</td>
    <td>
        <a href="https://docs.python.org/3/library/uu.html"><tt>uu</tt></a> (and the
	associated uu codec) and
	<a href="https://docs.python.org/3/library/xdrlib.html"><tt>xdrlib</tt></a></td>
	</tr>
<tr><td>Multimedia</td>
    <td><a href="https://docs.python.org/3/library/aifc.html"><tt>aifc</tt></a>, 
    <a href="https://docs.python.org/3/library/audioop.html"><tt>audioop</tt></a>, 
    
    <a href="https://docs.python.org/3/library/chunk.html"><tt>chunk</tt></a>, 
    <a href="https://docs.python.org/3/library/imghdr.html"><tt>imghdr</tt></a>, 
    <a href="https://docs.python.org/3/library/ossaudiodev.html"><tt>ossaudiodev</tt></a>, 
    <a href="https://docs.python.org/3/library/sndhdr.html"><tt>sndhdr</tt></a>, and
    <a href="https://docs.python.org/3/library/sunau.html"><tt>sunau</tt></a></td>
</tr>
<tr><td>Networking</td>
    <td><a href="https://docs.python.org/3/library/asynchat.html"><tt>asynchat</tt></a>, 
    <a href="https://docs.python.org/3/library/asyncore.html"><tt>asyncore</tt></a>, 
    <a href="https://docs.python.org/3/library/cgi.html"><tt>cgi</tt></a>, 
    <a href="https://docs.python.org/3/library/cgitb.html"><tt>cgitb</tt></a>, 
    <a href="https://docs.python.org/3/library/smtpd.html"><tt>smtpd</tt></a>,
    <a href="https://docs.python.org/3/library/nntplib.html"><tt>nntplib</tt></a>,
    and <a href="https://docs.python.org/3/library/telnetlib.html"><tt>telnetlib</tt></a></td>
</tr>
<tr><td>OS interface</td>
    <td><a href="https://docs.python.org/3/library/crypt.html"><tt>crypt</tt></a>, 
    <a href="https://docs.python.org/3/library/nis.html"><tt>nis</tt></a>, and
    <a href="https://docs.python.org/3/library/spwd.html"><tt>spwd</tt></a></td>
</tr>
<tr><td>Miscellaneous</td>
    <td>
    <a href="https://docs.python.org/3/library/msilib.html"><tt>msilib</tt></a> and
    <a href="https://docs.python.org/3/library/pipes.html"><tt>pipes</tt></a></td>
</tr>
</tbody></table>
</blockquote>

<p>
Comparing that table with the one in our article on the introduction of the
PEP shows that the broad strokes are the
same, but the details have changed somewhat.  The removals were meant to be
largely non-controversial, so if good reasons to keep a module were
raised—and the maintenance burden was low—it was retained.  The list is
also different because some of the modules have <a href="https://pythondev.readthedocs.io/stdlib.html#removed-modules">already
been removed</a>. 
Modules that were considered for removal along the way, but
retained (at least for now), were also <a href="https://peps.python.org/pep-0594/#modules-to-keep">described in the
PEP</a> along with the reasons behind keeping them.  One of the more
amusing reasons for  retaining a  module is for <a href="https://docs.python.org/3/library/wave.html"><tt>wave</tt></a>, which
handles the WAV sound-file format:
</p><blockquote>
<a href="https://twitter.com/dabeaz/status/1130278844479545351">According
to David Beazley</a> the wave module is easy to teach to kids and 
can make crazy sounds. Making a computer generate sounds is a powerful and
highly motivating exercise for a nine-year-old aspiring developer. It’s a
fun battery to keep. 
</blockquote>


<p>
The <tt>wave</tt> module also provides an example of the kinds of work that
remains to be done if the modules are removed; <tt>wave</tt> relies on the
<tt>audioop</tt> module that 
is being removed:
</p><blockquote>
The module uses one simple function from the <tt>audioop</tt> module to perform byte
swapping between little and big endian formats. Before 24 bit WAV support
was added, byte swap used to be implemented with the <tt>array</tt> module. To
remove <tt>wave</tt>’s dependency on <tt>audioop</tt>, the byte swap function could be either
be moved to another module (e.g. <tt>operator</tt>) or the <tt>array</tt> module could gain
support for 24-bit (3-byte) arrays. 
</blockquote>


<p>
A few of the <a href="https://peps.python.org/pep-0594/#deprecated-modules">to-be-removed
modules</a> were actually deprecated long
ago—even more modules had been proposed for deprecation
in two now-inactive PEPs—while the bulk of the modules would be deprecated for the upcoming
Python 3.11 (due in October) and potentially removed in Python 3.13 (due in
October 2024). Three modules, <tt>asynchat</tt>, <tt>asyncore</tt>,
and <tt>smtpd</tt>, would be removed in Python 3.12 in 2023.  This
would be the biggest upheaval in the standard library for quite a long
time, if not in its history.
</p>

<p>
The discussion thread on the PEP revival had relatively few comments,
mostly corrections or clarifications, but there were a few muted complaints about some of the
choices.  The PEP does not specify what will happen to the modules after
they are removed; the code will obviously still be available, so interested
users could create <a href="https://pypi.org/">Python Package Index</a>
(PyPI) modules or incorporate parts into other projects.  &#34;Vendoring&#34; some
pieces, by copying the code directly into an affected project (e.g. <a href="https://discuss.python.org/t/pep-594-take-2-removing-dead-batteries-from-the-standard-library/13508/8">into</a>
the <a href="https://www.roundup-tracker.org/">Roundup Issue Tracker</a>)
is another possibility.
</p>

<p>
On February 16, Cannon <a href="https://discuss.python.org/t/pep-594-take-2-removing-dead-batteries-from-the-standard-library/13508/17">submitted
the PEP to the steering council</a> and on March 11, Gregory P. Smith
<a href="https://discuss.python.org/t/pep-594-take-2-removing-dead-batteries-from-the-standard-library/13508/22">accepted
the PEP</a> on behalf of the council.  There were a few suggestions from
the council as part of the acceptance, starting with backporting the deprecation notices
into the module documentation for earlier—but still
active—versions of the language, so that more developers will be aware of
the upcoming removals.
</p>

<p>
In addition, the council asked that care be taken
during the alpha and beta parts of the release cycle to ensure that there
were no problems being caused. &#34;<span>If it turns out the removal of a
module proves to be a problem in practice despite the clear deprecation,
deferring the removal of that module should be considered to avoid
disruption.</span>&#34;  We saw just that kind of deferral back in February
when <a href="https://chanind.github.io/Articles/883391/">deprecated portions of two modules</a>
were causing problems for Fedora.
</p>

<p>
While Smith said that the council expects this kind of mass-removal event
to be a one-time thing, it does mean that more ongoing attention should be
paid to the contents of the standard library:
</p><blockquote>
Doing a “mass cleanup” of long obsolete modules is a sign that we as a
project have been ignoring rather than maintaining parts of the standard
library, or not doing so with the diligence being in the standard library
implies they deserve. Resolving ongoing discussions around how we define
the stdlib for the long term does not block this PEP. It seems worthwhile
for us to conduct regular reviews of the contents of the stdlib every few
releases so we can avoid accumulating such a large pile of dead batteries,
but this is outside the scope of this particular PEP. 
</blockquote>


<h4><tt>urllib</tt> too?</h4>

<p>
At roughly the same time Cannon revived PEP 594, Victor Stinner was <a href="https://chanind.github.io/ml/python-dev/CABqyc3wGDmdnDjrhYh0SxT_Tgr5M8Za3JTw4CUapnSOVQ-ci3A@mail.gmail.com/">proposing</a>
the deprecation (and eventual removal) of the <a href="https://docs.python.org/3/library/urllib.html"><tt>urllib</tt></a>
module on the python-dev mailing list.  As its name would imply,
<tt>urllib</tt> is for handling URLs, but 
it does quite a bit more than just that. In his lengthy message, Stinner
described a number of problems that he sees with the module, including a
complicated API, many better alternatives, no support for HTTP/2 or HTTP/3, and
a lack of maintenance, with lots of open issues, including some security issues.
</p>

<p>
There are four different sub-modules for <tt>urllib</tt>, with <a href="https://docs.python.org/3/library/urllib.request.html"><tt>urllib.request</tt></a>,
for opening URLs, and <a href="https://docs.python.org/3/library/urllib.parse.html"><tt>urllib.parse</tt></a>, 
for parsing URLs, as the most prominent and widely used of them.  Stinner
proposed deprecating all four, but, as he recognized, deprecating all, or
even parts, of <tt>urllib</tt> is going to be controversial.  It is likely
going to be an uphill battle (and require a PEP of its own) as the discussion showed.
</p>

<p>
There were a number of objections raised, including Dong-hee Na&#39;s <a href="https://chanind.github.io/ml/python-dev/CA+Z=B_nPDsRSEQ4AaXaazGMCLb01Dvafi1sq1+wFkLPp7GgM-Q@mail.gmail.com/">concern</a>
about the use of <tt>urllib</tt> in the <a href="https://pypi.org/project/pip/">pip</a> PyPI-package installer.  While
Stinner <a href="https://chanind.github.io/ml/python-dev/CABqyc3yeBCEf8rNRdgzg0hY1oZADx0SfghSM=6YRgpTx+3yU1w@mail.gmail.com/">thought</a>
that perhaps retaining <tt>urllib.parse</tt> would be sufficient for pip, Damian
Shaw <a href="https://chanind.github.io/ml/python-dev/CAHMvfn0osRpAcie72+Z8Z8CEKppo+gouF_TyYRbMyiRoLkb+Vw@mail.gmail.com/">disagreed</a>,
noting that pip is dependent on parts of <tt>urllib.request</tt> as well.
Beyond that, Shaw <a href="https://chanind.github.io/ml/python-dev/CAHMvfn2Hc4AkFPNjdmfzvK7h7uVUNZ3uBUP1K67toiTwyJxVTA@mail.gmail.com/">said</a>
that some of the alternative libraries mentioned by Stinner rely on parts
of <tt>urllib</tt> too.
</p>

<p>
Paul Moore was <a href="https://chanind.github.io/ml/python-dev/CACac1F9K2GByv2mfdAQw4tjipuYk_qEJ8gdb9VVVxa9=CxexTg@mail.gmail.com/">strongly
against</a> the proposal; he said that while use of <tt>urllib.request</tt> was not a best
practice, it is &#34;<span>still extremely
useful for simple situations</span>&#34;.  Beyond that, the standard library
itself uses parts of <tt>urllib</tt> heavily and dependencies on
modules outside the standard library are unsuitable in some domains; he was
concerned about pip as well:
</p><blockquote>
[...] pip relies pretty heavily on urllib (parse and request),
and pip has a bootstrapping issue, so using 3rd party libraries is
non-trivial. Also, of pip&#39;s existing vendored dependencies,
webencodings, urllib3, requests, pkg_resources, packaging, html5lib,
distlib and cachecontrol all import urllib. So this would be *hugely*
disruptive to the whole packaging ecosystem (which is under-resourced
at the best of times, so this would put a lot of strain on us).
</blockquote>


<p>
No one really directly refuted Stinner&#39;s contentions about the problems
with <tt>urllib</tt>; the complaints and concerns were about removing it
without adequate replacement in the standard library itself.  Heimes
generally <a href="https://chanind.github.io/ml/python-dev/5ca82a07-3b0e-ae6c-7e4c-fa39a8576a94@python.org/">agreed</a>
that the problems are real:
</p><blockquote>
The urllib package -- and to some degree also the http package -- are
constant source of security bugs. The code is old and the parsers for HTTP
and URLs don&#39;t handle edge cases well. Python core lacks a true maintainer
of the code. To be honest, we have to admit defeat and be up front that
urllib is not up to the task for this decade. It was designed [and] written
during a more friendly, less scary time on the internet.
</blockquote>


<p>
He also said that if he &#34;<span>had the power and time</span>&#34;, he would
replace <tt>urllib</tt> with a simpler HTTP client that used the services
provided by the underlying operating systems.  For more complex uses, there
are other options available in PyPI.  Another possibility would be to
&#34;<span>reduce the feature set of urllib to core HTTP 
(no ftp, proxy, HTTP auth)</span>&#34; coupled with a partial rewrite to make
the other remaining pieces more standards-compliant and simpler.
</p>

<p>
Several were in favor of either of those options, though Smith <a href="https://chanind.github.io/ml/python-dev/CAGE7PNJmQaL4rDTBnx4fzYmGgP1834kjwKNhr0nCvWGaWNpGww@mail.gmail.com/">felt</a>
that even the simplification options would cause &#34;<span>disruption to the
world and loss of trust in Python</span>&#34;.   There are, it seems, lots of
good reasons to keep <tt>urllib</tt> around, but the question of
maintenance remains.  No one volunteered to take on <tt>urllib</tt> and
address some of its obvious problems, though Senthil Kumaran <a href="https://chanind.github.io/ml/python-dev/Yf%2F4Ax+VXs+uepwK@88665a371033.ant.amazon.com/">said</a>
that <tt>urllib.parse</tt> &#34;<span>is semi-maintained</span>&#34;. 
</p>

<p>
Given all of that, users of <tt>urllib</tt> can be pretty confident it will
be around for quite a bit longer, perhaps forever.  But the maintenance
problem needs to be addressed somehow given that <tt>urllib</tt> interacts
with the internet and all of the inherent messiness and danger that comes
along for the ride.  With luck, part of the frequent re-evaluation of the
contents of the standard library that the steering council recommended will
also find ways to identify and address the maintenance holes in the
standard library as well.  If not, it would seem that there are some
ticking time bombs lurking there.
</p></div></div>
  </body>
</html>
