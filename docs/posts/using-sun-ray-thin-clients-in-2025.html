<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://catstret.ch/202506/sun-ray-shenanigans/">Original</a>
    <h1>Using Sun Ray thin clients in 2025</h1>
    
    <div id="readability-page-1" class="page"><div id="page-content">
    

<p>i’ve used thin clients at home for quite a while - both for their <em>intended</em> use (remotely accessing a desktop of another system); and in the sense of “modern thin clients are x86 boxes that are wildly overpowered for what they run, so they make good mini servers.”</p>

<p>recently, i saw a bulk lot of Sun Ray thin clients pop up on Trade Me (NZ’s eBay-like auction site) - and with very little idea of how many clients were actually included in this lot, i jumped on it. after a 9 hour round-trip drive (on some of the worst roads i’ve seen!), i returned home with the back of my car completely packed with Sun Rays. time for some interesting shenanigans!</p>

<!--cut-->

<h2 id="sections">sections</h2>

<ul id="markdown-toc">
  <li><a href="#cataloguing-the-haul" id="markdown-toc-cataloguing-the-haul">cataloguing the haul</a></li>
  <li><a href="#setting-up-the-sun-ray-server-software" id="markdown-toc-setting-up-the-sun-ray-server-software">setting up the Sun Ray Server Software</a>    <ul>
      <li><a href="#getting-srss-installed-on-openindiana" id="markdown-toc-getting-srss-installed-on-openindiana">getting SRSS installed on OpenIndiana</a></li>
      <li><a href="#getting-the-sun-ray-firmware-in-place" id="markdown-toc-getting-the-sun-ray-firmware-in-place">getting the Sun Ray firmware in place</a></li>
    </ul>
  </li>
  <li><a href="#kiosk-sessions" id="markdown-toc-kiosk-sessions">kiosk sessions</a>    <ul>
      <li><a href="#rdp" id="markdown-toc-rdp">RDP</a></li>
      <li><a href="#browser-sessions" id="markdown-toc-browser-sessions">browser sessions</a></li>
    </ul>
  </li>
  <li><a href="#where-to-from-here" id="markdown-toc-where-to-from-here">where to from here?</a></li>
</ul>

<h2 id="cataloguing-the-haul">cataloguing the haul</h2>

<p>when picking all of these up from the seller, i had guesstimated there was maybe 30 clients in total. turns out i was off by quite a bit.</p>

<p>i ended up bringing home:</p>

<ul>
  <li>12x <a href="https://dogemicrosystems.ca/pub/Sun/System_Handbook/Sun_syshbk_V3.4/Systems/SunRay2/SunRay2.html">Sun Ray 2</a></li>
  <li>12x <a href="https://dogemicrosystems.ca/pub/Sun/System_Handbook/Sun_syshbk_V3.4/Systems/SunRay2FS/SunRay2FS.html">Sun Ray 2FS</a></li>
  <li>11x <a href="https://dogemicrosystems.ca/pub/Sun/System_Handbook/Sun_syshbk_V3.4/Systems/SunRay3/">Sun Ray 3</a></li>
  <li>4x <a href="https://dogemicrosystems.ca/pub/Sun/System_Handbook/Sun_syshbk_V3.4/Systems/SunRay3_Plus/SunRay3_Plus.html">Sun Ray 3+</a></li>
  <li>3x <a href="https://dogemicrosystems.ca/pub/Sun/System_Handbook/Sun_syshbk_V3.4/Systems/SunRay270/SunRay270.html">Sun Ray 270</a> - 17” (1280x1024) LCD screens with integrated Sun Ray clients</li>
  <li>4x <a href="https://web.archive.org/web/20170218173523/https://incarta.com.au/uvo">Incarta Uvo</a> - 24” 1080p LCD screens with integrated clients
    <ul>
      <li>i can’t find any info about these other than the linked page on the Wayback Machine - if you know more about these, please send me an email!</li>
    </ul>
  </li>
  <li>about 40 smart cards, for authentication/hotdesking</li>
  <li>a small pile of Sun Type 7 USB keyboards, and some Sun-branded optical mice</li>
</ul>

<p>so that’s <strong>46</strong> clients all up!</p>

<p>a few days prior to picking all this up, i rented a storage unit in a local facility, and put some garage shelving units in there - and boy howdy i’m glad i did!</p>

<h2 id="setting-up-the-sun-ray-server-software">setting up the Sun Ray Server Software</h2>

<p>looking at the Oracle (eugh.) documentation for the Sun Ray Server Software, it appeared there were two options: run it on ancient Linux, or run it on ancient Solaris. Oracle dropped support for the Sun Rays in 2014, as part of extinguishing everything Sun Microsystems stood for after the 2010 acquisition. i didn’t <em>really</em> want to have a RHEL 6 box kicking around, nor did i want to deal with trying to make Solaris 10 work in a VM on my home Proxmox cluster, so i did some digging.</p>

<p>enter <strong>illumos</strong> - well, in my case, OpenIndiana. illumos is, essentially, a fork of the pre-Oracle-acquisition OpenSolaris codebase. OpenIndiana is one of many illumos <em>distributions</em> (in a very similar sense to Linux distributions), and OpenIndiana is more suited for desktop use than most other illumos distributions. the OpenIndiana documentation has <a href="https://docs.openindiana.org/handbook/sunray/">a section on setting up the Sun Ray Server Software on OpenIndiana</a>, but even with that in hand there was a lot of pieces to figure out on my own!</p>



<p>this is mostly a copy of the docs from the OpenIndiana handbook, with some adjustments to fix things i ran into. i did this on top of a text-only install - <code>OpenIndiana Hipster 2025.04 Text Install DVD (64-bit x86)</code> was the install media i used (from <a href="https://www.openindiana.org/downloads/">https://www.openindiana.org/downloads/</a>).</p>

<p>to get the desktop environment installed:</p>

<div><div><pre><code># pkg install mate_install
</code></pre></div></div>

<p>unlocking the dependencies for SRSS:</p>

<div><div><pre><code># pkg change-facet facet.version-lock.gnome/gnome-session=false
# pkg change-facet facet.version-lock.gnome/gnome-settings-daemon=false
# pkg change-facet facet.version-lock.system/display-manager/gdm=false
# pkg change-facet facet.version-lock.library/gnome/libgnomekbd=false
# pkg change-facet facet.version-lock.gnome/window-manager/metacity=false
# pkg change-facet facet.version-lock.library/desktop/gnome-desktop=false
# pkg change-facet facet.version-lock.cde/cde-runtime=false
# pkg change-facet facet.version-lock.library/motif=false
# pkg change-facet facet.version-lock.library/tooltalk=false
# pkg change-facet facet.version-lock.compatibility/packages/SUNWxwplt=false
</code></pre></div></div>

<p>setting up the package source, and installing the SRSS dependencies:</p>

<div><div><pre><code># pkg set-publisher --search-before=openindiana.org -g http://pkg.toc.de/sunray sunray
# pkg set-publisher --non-sticky openindiana.org
# pkg install sunray-essential
</code></pre></div></div>

<p>after unpacking the Sun Ray Server Software installers (both the Solaris and Linux versions) into <code>/root</code>, i ran the <code>update_dhcp_dependency</code> script from the OI Handbook, then tried to install SRSS, which bombed out spectacularly with package manager rejections of the <code>This version is excluded by installed incorporation consolidation/userland/userland-incorporation@...</code> sort. so here’s the correct (read: “worked for me!”) steps:</p>

<div><div><pre><code># /root/update_dhcp_dependency /root/srs_5.4.0.0-Solaris_11plus.i386/IPS.i386/
# pkg set-publisher -g /root/srs_5.4.0.0-Solaris_11plus.i386/IPS.i386/ sunray
# pkg uninstall entire userland-incorporation
# pkg install SUNWut-srss SUNWut-srwc SUNWuti
</code></pre></div></div>

<details>
  <summary>the <code>update_dhcp_dependency</code> script, for posterity</summary>

  

</details>

<p>to make SRSS happy with isc-dhcp:</p>

<div><div><pre><code># rpm2cpio /root/srs_5.4.0.0-Linux.i386/Components/10-SRSS/Content/Sun_Ray_Core_Services_4.5/Linux/Packages/SUNWuto-4.5-44.i386.rpm | bsdtar -C /root -xf - ./opt/SUNWut/lib/dhcp/
# sed &#39;s#$UTDHCPDIR | sort#$UTDHCPDIR | gsort#g&#39; -i.bak /root/opt/SUNWut/lib/dhcp/isc/dhcp_config_linux 
# cp -R /root/opt/SUNWut/lib/dhcp/isc /opt/SUNWut/lib/dhcp/
# cp /opt/SUNWut/lib/dhcp/isc/dhcp_config_linux /opt/SUNWut/lib/dhcp/isc/dhcp_config_solaris
# ln -s /opt/SUNWut/lib/dhcp/isc /etc/opt/SUNWut/dhcp
</code></pre></div></div>

<p>then apply the needed patch to <code>/opt/SUNWut/sbin/utadm</code>:</p>



<p>now, get the ancient JRE in place:</p>

<div><div><pre><code># cd /root/srs_5.4.0.0-Solaris_11plus.i386/Supplemental/Java_Runtime_Environment/Solaris
# ./jre-6u41-solaris-i586.sh
# mv ./jre1.6.0_41 /opt/
# ln -s /opt/jre1.6.0_41 /etc/opt/SUNWut/jre
</code></pre></div></div>

<p>and, since i wanted the web administration tools to work too:</p>

<div><div><pre><code># bsdtar -C /opt -xf /root/srs_5.4.0.0-Solaris_11plus.i386/Supplemental/Apache_Tomcat/apache-tomcat-5.5.36.tar.gz
# ln -s /opt/apache-tomcat /opt/apache-tomcat-5.5.36
</code></pre></div></div>

<p>i then configured the Sun Ray server:</p>

<div><div><pre><code># /opt/SUNWut/sbin/utconfig
# /opt/SUNWut/sbin/utpolicy -a -z both -g -M
# /opt/SUNWut/sbin/utadm -L on
# /opt/SUNWut/sbin/utstart -c
</code></pre></div></div>

<p>and…</p>

<p><a href="https://archive.catstret.ch/media/sr270-mate.jpg"><img src="https://archive.catstret.ch/media/sr270-mate.jpg" alt="a Sun Ray 270, with a smart card inserted, showing a MATE desktop on OpenIndiana"/></a></p>

<p>it fuckin’ worked!</p>

<h3 id="getting-the-sun-ray-firmware-in-place">getting the Sun Ray firmware in place</h3>

<p>since i was using version 5.4.x of the Sun Ray Server Software, the client firmware wasn’t part of the install - from version 5.3 onwards, you had to have an Oracle support contract to get firmware updates. sigh.</p>

<p>thankfully, getting a 5.2.x release (with the firmware included!) wasn’t hard. i grabbed a 5.2.x release for Linux, found the RPM with the firmware in it (<code>SUNWutfw04.3-50.i386.rpm</code>), and extracted that with <code>rpm2cpio</code>.</p>

<p>the Solaris version of SRSS wants to find the firmware in a different place than the Linux version it seems - the Linux versions put it in <code>/opt/SUNWut/lib/firmware</code>, but on Solaris/OpenIndiana, it needs to be in <code>/opt/SUNWutdfw/lib/firmware</code>. easy enough.</p>

<p>once in place, this was all it took to set up the TFTP server, and make SRSS populate the right places with the firmware:</p>

<div><div><pre><code># mkdir /tftpboot
# cd /tftpboot
# ln -f -s . tftpboot
# /opt/SUNWut/sbin/utfwadm -AaV -G force
</code></pre></div></div>

<h2 id="kiosk-sessions">kiosk sessions</h2>

<p>i wanted to use some of the integrated-into-screens Sun Rays to replace some of the Raspberry Pis (and old iMacs) around the house showing Home Assistant dashboards. i also wanted to set up the Sun Ray server so that when i inserted a particular smart card into a client, it would bring up an RDP session to my existing “desktop” (a Fedora VM running Xrdp).</p>

<p>these both turned out to be… interesting to get working.</p>

<h3 id="rdp">RDP</h3>

<p>the Sun Ray Server Software has a built-in method for connecting to Microsoft RDP servers - the Sun Ray Windows Connector, also known as <code>uttsc</code>.
as you might have guessed, it’s broken as fuck on OpenIndiana, even putting aside the fact that the newest RDP server it knows how to handle would be in the Windows Server 2003 era.</p>

<p>so, let’s hack something together with XFreeRDP!</p>

<p>i wanted to be able to specify what RDP server each token would connect to. this was a fairly common use case back in the day, and some people wrote helpers to allow things like that - one of which being <a href="https://web.archive.org/web/20131212042126/https://blogs.oracle.com/danielc/entry/meta_kiosk_how_to_run">Daniel Cifuentes’ meta-kiosk</a>, which i borrowed some ideas from.</p>

<p>after much trial and error, i got something working!</p>

<div id="fcb-freerdp-session">
  
  <figure>
    <pre><code data-lang="shell">
<span>KIOSK_SESSION_EXEC</span><span>=</span><span>$KIOSK_SESSION_DIR</span>/freerdp
<span>KIOSK_SESSION_LABEL</span><span>=</span><span>&#34;FreeRDP session&#34;</span></code></pre>
  </figure>
</div>

<div id="fcb-freerdp-script">
  
  <figure>
    <pre><code data-lang="shell">
<span>#!/bin/sh</span>

openbox <span>--replace</span> &amp;
/opt/SUNWut/bin/utscreenresize <span>-s</span> all <span>-l</span> &amp;

<span>REG_OTHER</span><span>=</span><span>`</span>/opt/SUNWut/sbin/utuser <span>-p</span> <span>$SUN_SUNRAY_TOKEN</span> | <span>grep</span> <span>&#34;Other Info&#34;</span> | <span>cut</span> <span>-f2</span> <span>-d</span><span>=</span><span>`</span>
<span>if</span> <span>[</span> <span>&#34;</span><span>$REG_OTHER</span><span>&#34;</span> <span>=</span> <span>&#34;&#34;</span> <span>]</span>
<span>then
        </span>zenity <span>--error</span> <span>--text</span><span>=</span><span>&#34;freerdp: idk what you want me to do! </span><span>$SUN_SUNRAY_TOKEN</span><span>&#34;</span>
        <span>exit </span>1
<span>fi

</span><span>exec </span>xterm <span>-e</span> xfreerdp /cert:tofu /f <span>-toggle-fullscreen</span> /dynamic-resolution /gfx +gfx-thin-client /smartcard /bpp:24 <span>$REG_OTHER</span></code></pre>
  </figure>
</div>

<p>after throwing those in place, install the dependencies and configure the session:</p>

<div><div><pre><code># pkg install openbox freerdp
# printf &#34;KIOSK_SESSION=freerdp\n&#34; | /opt/SUNWut/sbin/utkiosk -i FreeRDP
</code></pre></div></div>

<p>then it’s just a matter of adding the needed data to each token, and assigning the tokens to the FreeRDP session:</p>

<p><a href="https://archive.catstret.ch/media/srss-token-freerdp.png"><img src="https://archive.catstret.ch/media/srss-token-freerdp.png" alt="the Sun Ray Administration web UI, editing a token to use kiosk mode and specifying the FreeRDP parameters"/></a></p>

<div><div><pre><code># /opt/SUNWut/sbin/utkioskoverride -s kiosk -r OpenPlatform.47905167523905788499 -c FreeRDP
</code></pre></div></div>

<p>upon inserting that token into a client…</p>

<p><a href="https://archive.catstret.ch/media/srss-uvo-freerdp.jpg"><img src="https://archive.catstret.ch/media/srss-uvo-freerdp.jpg" alt="an Incarta Uvo, showing an Xrdp login screen"/></a></p>

<p><strong>success!</strong></p>

<h3 id="browser-sessions">browser sessions</h3>

<p>with much the same setup as the RDP sessions, it’s pretty easy to start a kiosk-mode Firefox, pulling the URL to open from the token data:</p>

<div id="fcb-kioskbrowser-session">
  
  <figure>
    <pre><code data-lang="shell">
<span>KIOSK_SESSION_EXEC</span><span>=</span><span>$KIOSK_SESSION_DIR</span>/kiosk-browser
<span>KIOSK_SESSION_LABEL</span><span>=</span><span>&#34;Kiosk Browser&#34;</span></code></pre>
  </figure>
</div>

<div id="fcb-kioskbrowser-script">
  
  <figure>
    <pre><code data-lang="shell">
<span>#!/bin/sh</span>

openbox <span>--replace</span> &amp;
/opt/SUNWut/bin/utscreenresize <span>-s</span> all <span>-l</span> &amp;

<span># get rid of the cursor</span>
<span>cat</span> <span>&lt;&lt;-</span><span>EOF</span><span> | xrdb -merge -
Xcursor.theme: InvisibleCursor
</span><span>EOF

</span><span># disable screen blanking</span>
xset s off
xset s noblank
xset <span>-dpms</span>

<span>REG_OTHER</span><span>=</span><span>`</span>/opt/SUNWut/sbin/utuser <span>-p</span> <span>$SUN_SUNRAY_TOKEN</span> | <span>grep</span> <span>&#34;Other Info&#34;</span> | <span>cut</span> <span>-f2</span> <span>-d</span><span>=</span><span>`</span>
<span>if</span> <span>[</span> <span>&#34;</span><span>$REG_OTHER</span><span>&#34;</span> <span>=</span> <span>&#34;&#34;</span> <span>]</span>
<span>then
        </span>zenity <span>--error</span> <span>--text</span><span>=</span><span>&#34;kiosk-browser: No browser URL provided! </span><span>$SUN_SUNRAY_TOKEN</span><span>&#34;</span>
        <span>exit </span>1
<span>fi

</span>firefox <span>--new-instance</span> <span>--kiosk</span> <span>--private-window</span> <span>&#34;</span><span>$REG_OTHER</span><span>&#34;</span></code></pre>
  </figure>
</div>

<p>i needed to hide the mouse cursor, and <code>unclutter</code> simply <em>does not</em> work in Sun Ray sessions, so i went with an invisible cursor theme - <a href="https://github.com/l-theanine/invisible-cursor-theme">https://github.com/l-theanine/invisible-cursor-theme</a> works well.</p>

<p>a problem, though. Firefox would show its first-run “Welcome to Firefox” popup… every time. Sun Ray kiosk sessions run as a random user named  <code>utkuXX</code> (where <code>XX</code> is a number), and after the kiosk session ends the home directory of the kiosk user gets fully deleted, so the user can be recycled for other sessions. given i wanted to use this with some always-on Sun Rays, with no input devices attached…</p>

<p>thankfully, Firefox policies allow turning that off! throwing this hunk of JSON into <code>/etc/firefox/policies/policies.json</code> fixed that:</p>

<div id="fcb-firefoxpolicy">
  
  <figure>
    <pre><code data-lang="json"><span>
</span><span>{</span><span>
  </span><span>&#34;policies&#34;</span><span>:</span><span> </span><span>{</span><span>
    </span><span>&#34;DontCheckDefaultBrowser&#34;</span><span>:</span><span> </span><span>true</span><span>,</span><span>
    </span><span>&#34;SkipTermsOfUse&#34;</span><span>:</span><span> </span><span>true</span><span>,</span><span>
    </span><span>&#34;Preferences&#34;</span><span>:</span><span> </span><span>{</span><span>
      </span><span>&#34;browser.startup.upgradeDialog.enabled&#34;</span><span>:</span><span> </span><span>{</span><span>
        </span><span>&#34;Value&#34;</span><span>:</span><span> </span><span>false</span><span>,</span><span>
        </span><span>&#34;Status&#34;</span><span>:</span><span> </span><span>&#34;locked&#34;</span><span>
      </span><span>},</span><span>
      </span><span>&#34;browser.startup.homepage_override.mstone&#34;</span><span>:</span><span> </span><span>{</span><span>
        </span><span>&#34;Value&#34;</span><span>:</span><span> </span><span>&#34;ignore&#34;</span><span>,</span><span>
        </span><span>&#34;Status&#34;</span><span>:</span><span> </span><span>&#34;locked&#34;</span><span>
      </span><span>}</span><span>
    </span><span>}</span><span>
  </span><span>}</span><span>
</span><span>}</span><span>
</span></code></pre>
  </figure>
</div>

<p>and with that, i could create a token for an individual client (the tokens for this are <code>pseudo.&lt;MAC&gt;</code>, where the MAC is all lower-case), set that token’s “Other Info” field to the URL to show, and assign the kiosk session to that pseudo-token the same way as with smart card tokens.</p>

<h2 id="where-to-from-here">where to from here?</h2>

<p>this was a lot of fun to get working. i need to take a break from reading the Sun Ray Administration Guide though, so here’s my thinking for a potential part 2:</p>

<ul>
  <li>i want to see how well the multi-head stuff works in SRSS - which joins multiple physical clients together into one desktop session, using the peripherals connected to the “primary” client. unfortunately the Xinerama support is weird (Xinerama and xrandr are mutually exclusive…), but if i can make it play ball it could be a neat thing to use.</li>
  <li>i want to try and find a newer firmware package too, but that might be a little bit of a lost cause, given i refuse to give Oracle a bunch of money.</li>
  <li>maybe i’ll set up another OpenIndiana VM and configure the HA failover in SRSS?</li>
</ul>

<p>for now, though… that’s all.</p>




</div></div>
  </body>
</html>
