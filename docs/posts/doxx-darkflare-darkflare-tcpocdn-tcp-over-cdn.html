<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/doxx/darkflare">Original</a>
    <h1>Doxx/Darkflare: DarkFlare TCPoCDN (TCP over CDN)</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">A stealthy TCP-over-CDN tunnel that keeps your connections cozy and comfortable behind Cloudflare&#39;s welcoming embrace.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">🤔 What is this sorcery?</h2><a id="user-content--what-is-this-sorcery" aria-label="Permalink: 🤔 What is this sorcery?" href="#-what-is-this-sorcery"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">DarkFlare is a clever little tool that disguises your TCP traffic as innocent HTTPS requests, letting them pass through corporate firewalls like a VIP at a nightclub. It&#39;s like a tunnel, but with more style and less dirt.</p>
<p dir="auto">It has two parts: a client-side proxy (darkflare-client) that encodes TCP data into HTTPS requests and sends it to a Cloudflare-protected domain, and a server-side proxy (darkflare-server) that decodes the requests and forwards the data to a local service (like SSH on port 22). It’s protocol-agnostic, secure, and uses Cloudflare&#39;s encrypted infrastructure, making it stealthy and scalable for accessing internal resources or bypassing network restrictions.</p>
<p dir="auto">When using this remember the traffic over the tunnel is only as secure as the Cloudflare protection. Use your own encryption.</p>

<p dir="auto">Services like Cloudflare, Akamai Technologies, Fastly, and Amazon CloudFront are not only widely accessible but also integral to the global internet infrastructure. In regions with restrictive networks, alternatives such as CDNetworks in Russia, ArvanCloud in Iran, or ChinaCache in China may serve as viable proxies. These CDNs support millions of websites across critical sectors, including government and healthcare, making them indispensable. Blocking them risks significant collateral damage, which inadvertently makes them reliable pathways for bypassing restrictions.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">⛓️‍💥 Stop Network Censorship</h2><a id="user-content-️-stop-network-censorship" aria-label="Permalink: ⛓️‍💥 Stop Network Censorship" href="#️-stop-network-censorship"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Internet censorship is a significant issue in many countries, where governments restrict access to information by blocking websites and services. For instance, China employs the &#34;Great Firewall&#34; to block platforms like Facebook and Twitter, while Iran restricts access to social media and messaging apps. In Russia, authorities have intensified efforts to control information flow by blocking virtual private networks (VPNs) and other tools that citizens use to bypass censorship.</p>
<p dir="auto">AP NEWS
In such environments, a tool that tunnels TCP traffic over HTTP(S) through a Content Delivery Network (CDN) like Cloudflare can be invaluable. By disguising restricted traffic as regular web traffic, this method can effectively circumvent censorship measures, granting users access to blocked content and preserving the free flow of information.</p>
<div data-snippet-clipboard-copy-content="                                FIREWALL/CENSORSHIP
                                |     |     |     |
                                v     v     v     v

[Client]──────┐                ┌──────────────────┐                ┌─────────[Target Service]
              │                │                  │                │       (e.g., SSH Server)
              │                │   CLOUDFLARE     │                │tcp      localhost:22
              │tcp             │     NETWORK      │                │
[darkflare    │                │                  │                │ [darkflare
 client]──────┼───HTTPS───────&gt;│ (looks like      │─-HTTPS-───────&gt;│  server]
localhost:2222│                │  normal traffic) │                │ :8080
              │                │                  │                │
              └────────────────┼──────────────────┼────────────────┘
                               │                  │
                               └──────────────────┘

Flow:
1. TCP traffic ──&gt; darkflare-client
2. Wrapped as HTTPS ──&gt; Cloudflare CDN
3. Forwarded to ──&gt; darkflare-server
4. Unwrapped back to TCP ──&gt; Target Service"><pre><code>                                FIREWALL/CENSORSHIP
                                |     |     |     |
                                v     v     v     v

[Client]──────┐                ┌──────────────────┐                ┌─────────[Target Service]
              │                │                  │                │       (e.g., SSH Server)
              │                │   CLOUDFLARE     │                │tcp      localhost:22
              │tcp             │     NETWORK      │                │
[darkflare    │                │                  │                │ [darkflare
 client]──────┼───HTTPS───────&gt;│ (looks like      │─-HTTPS-───────&gt;│  server]
localhost:2222│                │  normal traffic) │                │ :8080
              │                │                  │                │
              └────────────────┼──────────────────┼────────────────┘
                               │                  │
                               └──────────────────┘

Flow:
1. TCP traffic ──&gt; darkflare-client
2. Wrapped as HTTPS ──&gt; Cloudflare CDN
3. Forwarded to ──&gt; darkflare-server
4. Unwrapped back to TCP ──&gt; Target Service
</code></pre></div>

<p dir="auto">ssh, rdp, or anything tcp to bypass restrictive firewalls or state controled internet.</p>
<p dir="auto">Tunneling ppp or other vpn services that leverage TCP.</p>
<p dir="auto">Breaking past blocked sites!</p>
<p dir="auto"><a href="https://support.nordvpn.com/hc/en-us/articles/19683394518161-OpenVPN-connection-on-NordVPN#:~:text=With%20NordVPN%2C%20you%20can%20connect,differences%20between%20TCP%20and%20UDP." title="Configure NordVPN over TCP" rel="nofollow">How to use NordVPN over TCP</a></p>

<ol dir="auto">
<li>Download the OpenVPN client</li>
<li>Under Manual setup in your NordVPN account download the .ovpn file for TCP</li>
<li>Also in Manual setup select username and password authentication.</li>
<li>Edit the .ovpn file and change the IP and port to your darkflare server IP and Port.</li>
<li>Configure darkflare-server to use the IP and port defined in the .ovpn file.</li>
<li>Import the .ovpn file to OpenVPN and setup your username and password.</li>
</ol>
<p dir="auto">Note: OpenVPN does some weird thing with the default gateway/route. For testing purposes I added: pull-filter ignore &#34;redirect-gateway&#34; to the .ovpn file. That allows me to force the tunnel to not eat my network.</p>
<p dir="auto">Latency over VPN and TCPoCDN was shockly low, around 100ms.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/doxx/darkflare/main/images/openvpn.jpg"><img src="https://raw.githubusercontent.com/doxx/darkflare/main/images/openvpn.jpg" alt="OpenVPN on NordVPN over TCPoCDN"/></a></p>
<div dir="auto"><h2 tabindex="-1" dir="auto">🔐 Few Obscureation Techniques</h2><a id="user-content--few-obscureation-techniques" aria-label="Permalink: 🔐 Few Obscureation Techniques" href="#-few-obscureation-techniques"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Requests are randomized to look like normal web traffic with jpg, php, and random file names.</p>
<p dir="auto">Client and server headers are set to look like normal web traffic.</p>
<p dir="auto">If you have other ideas please send them my way.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">🌩️ Cloudflare Configuration</h2><a id="user-content-️-cloudflare-configuration" aria-label="Permalink: 🌩️ Cloudflare Configuration" href="#️-cloudflare-configuration"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Add your new proxy hostname into a free Cloudflare account.</p>
<p dir="auto">Setup your origin rules to send that host to the origin server (darkflare-server) via the proxy port you choose.</p>
<p dir="auto">I used 8080.</p>

<ul dir="auto">
<li><strong>Sneaky TCP Tunneling</strong>: Wraps your TCP connections in a fashionable HTTPS outfit</li>
<li><strong>Cloudflare Integration</strong>: Because who doesn&#39;t want their traffic to look like it&#39;s just visiting Cloudflare?</li>
<li><strong>Debug Mode</strong>: For when things go wrong and you need to know why (spoiler: it&#39;s always DNS)</li>
<li><strong>Session Management</strong>: Keeps your connections organized like a Type A personality</li>
<li><strong>TLS Security</strong>: Because we&#39;re sneaky, not reckless</li>
</ul>

<ul dir="auto">
<li><strong>Include Spoofed Heasers for Files</strong>: Add real headers to the jpegs and php files to appear to be exactly and they are to be. Add more support for PDF, MOV, and MP4 files to make the traffic looks more realistic.</li>
</ul>


<ol dir="auto">
<li>Download the latest release from the releases page</li>
<li>Extract the binaries to your preferred location</li>
<li>Make the binaries executable:
<div dir="auto" data-snippet-clipboard-copy-content="chmod +x darkflare-client darkflare-server"><pre>chmod +x darkflare-client darkflare-server</pre></div>
</li>
</ol>

<div dir="auto" data-snippet-clipboard-copy-content="./darkflare-client -h ssh.foo.host -l 2222 -d"><pre>./darkflare-client -h ssh.foo.host -l 2222 -d</pre></div>
<p dir="auto">Add <code>-debug</code> flag for debug mode</p>

<div dir="auto" data-snippet-clipboard-copy-content="./darkflare-server -d localhost:22 -p 8080 -debug"><pre>./darkflare-server -d localhost:22 -p 8080 -debug</pre></div>
<p dir="auto">Add <code>-debug</code> for server debug messages</p>

<div dir="auto" data-snippet-clipboard-copy-content="ssh user@localhost -p 2222"><pre>ssh user@localhost -p 2222</pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto"><g-emoji alias="warning">⚠️</g-emoji> Security Considerations</h2><a id="user-content-️-security-considerations" aria-label="Permalink: ⚠️ Security Considerations" href="#️-security-considerations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Always use end-to-end encryption for sensitive traffic</li>
<li>The tunnel itself provides obscurity, not security</li>
<li>Monitor your Cloudflare logs for suspicious activity</li>
<li>Regularly update both client and server components</li>
</ul>

<p dir="auto">This tool is for educational purposes only. Please don&#39;t use it to bypass your company&#39;s firewall - your IT department has enough headaches already.</p>

<p dir="auto">Found a bug? Want to add a feature? PRs are welcome! Just remember:</p>
<ul dir="auto">
<li>Keep it clean</li>
<li>Keep it clever</li>
<li>Keep it working</li>
</ul>

<p dir="auto">MIT License - Because sharing is caring, but attribution is nice.</p>
<hr/>
<p dir="auto"><em>Built with ❤️ and a healthy dose of mischief</em></p>
</article></div></div>
  </body>
</html>
