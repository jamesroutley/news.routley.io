<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://aaronhertzmann.com/2023/07/31/occluding-contours-part-1.html">Original</a>
    <h1>Occluding Contour Breakthroughs, Part 1: A Surprisingly Hard Problem</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article>

  

  <div>
    <p>The <a href="https://aaronhertzmann.com/2020/09/12/how-to-draw-pictures-contours.html">occluding contours of a smooth surface</a> let you render 3D objects <a href="https://aaronhertzmann.com/2020/09/14/how-to-draw-pictures-style.html">in many different artistic styles</a>, such as this pen-and-ink hatching style:</p>

<center>
<figure>
  <img src="https://aaronhertzmann.com/images/howtodraw/cupid_hatch.png" alt="Cupid hatching"/>
  <figcaption><i>3D hatching, <a href="https://www.mrl.nyu.edu/publications/illustrating-smooth/">automatically generated</a> from the 3D model on the left.
</i></figcaption>
</figure>
</center>
<p>Simple occluding contour renderings appear throughout many kinds of animations, TV shows and films throughout the past few decades, often consisting of basic black outlines. 
Some recent examples include <a href="https://www.youtube.com/watch?v=pgd4aU56Kig">the game “Hi-Fi Rush”</a>
and the Spider-Verse movies:</p>
<center>
<figure>
  <img src="https://aaronhertzmann.com/images/howtodraw/spiderverse.jpg" alt="Spiderverse image"/>
  <figcaption><i>The character on the left has occluding contour outlines.
</i></figcaption>
</figure>
</center>

<p>But there are entire classes of occluding contour stylizations we can’t do reliably or robustly—and we’re not seeing them in movies or games. Here are some examples of occluding contour stylizations from research papers over the years:</p>
<center>
<figure>
  <img src="https://aaronhertzmann.com/images/howtodraw/styles.jpg" alt="NPR contour styles"/>
</figure>
</center>
<p>We can author all sorts of beautiful rendering styles.  But the algorithms aren’t robust. All of the existing contour algorithms for smooth surfaces have unpredictable failure cases. And we’ve never really understood why.</p>

<p>This year, we finally cracked the case.</p>

<p>In a paper called <a href="https://dgp.toronto.edu/~hertzman/contesse/">ConTesse</a>, we finally explain exactly what the problem really is, and describe when a solution works or doesn’t; moreover, we describe a method that produces correct results for subdivision surfaces. And, in <a href="http://ryanjcapouellez.com/papers/algebraic_smooth_occluding_contours.html">a second paper</a>, we show
how to generate exact smooth contours based on input meshes, allowing for very fast and accurate contours.</p>

<p>In this blog post, I explain exactly what the problem is, and, in <a href="https://aaronhertzmann.com/2023/07/31/occluding-contours-part-2.html">the next post</a>, what the breakthroughs are. In <a href="https://aaronhertzmann.com/2023/07/31/occluding-contours-part-3.html">the third post</a>, I recommend which of the existing methods to try for different types of problems, and point to where more research and development is needed to move these ideas from research to practical applications.</p>

<p>This post is intended for readers knowledgable about computer graphics algorithms. You can find <a href="https://aaronhertzmann.com/2020/09/12/how-to-draw-pictures-contours.html">a non-technical introduction to these topics here</a>.</p>



<p>Here’s an example of occluding contours, drawn as black lines on a 3D model:</p>

<center>
<figure>
   <p float="left">
<img src="https://aaronhertzmann.com/images/howtodraw/pig_toon.png" alt="Occluding contour rendering" width="60%"/>
</p>
</figure>
</center>

<p>The occluding contours occur where a surface overlaps itself in image space:</p>

<center>
<figure>
   <p float="left">
   <img src="https://aaronhertzmann.com/images/howtodraw/pig_side.png" alt="Contour defintions" width="60%"/>
</p>
</figure>
</center>

<p>For a triangle mesh, it’s easy to find the occluding contours: take all the edges that connect a front-face to a back-face, and then compute which of those edges are visible:</p>

<center>
<figure>
   <p float="left">
<img src="https://aaronhertzmann.com/images/howtodraw/mesh-contour-def.png" alt="Occluding contours for meshes" width="80%"/>
</p>
</figure>
</center>

<p>In this post, I am being very casual with definitions and terminology.  You can see <a href="https://arxiv.org/abs/1810.01175">our tutorial paper for a detailed and precise definitions</a>.</p>

<p>I’m also assuming that the surface is <em>oriented</em>: the faces have normal directions consistent with their neighbors, and the camera position is constrained, so that only front-facing surface will ever be visible. These assumptions are common in computer graphics applications.</p>

<p>For smooth surfaces, i.e., surfaces with continous normals, the occluding contours are still the places where the folds over itself in image space. This happens at any <em>visible</em> surface point where <em>the tangent plane contains the view vector</em>. For example:</p>

<center>
<figure>
   <p float="left">
<img src="https://aaronhertzmann.com/images/howtodraw/smooth-contour-def.png" alt="Occluding contours for meshes" width="80%"/>
</p>
</figure>
</center>

<p>That shouldn’t be so hard to compute, right?</p>



<p>What makes the problem difficult isn’t computing the contour points, it’s computing the <em>visible</em> points. We want the visible curves to have sensible topology: no gaps at all in the outlines, nor extra curves and junctions, or other mistakes that would mess up stylization.</p>

<p>For example, suppose you start with this smooth object:</p>
<center>
<figure>
   <p float="left">
<img src="https://aaronhertzmann.com/images/howtodraw/ovoid-smooth.png" alt="Occluding contours for meshes" width="40%"/>
</p>
</figure>
</center>
<p>The obvious thing is to triangulate it into a mesh, and then compute the contours of the mesh. But look what happens:</p>
<center>
<figure>
   <p float="left">
<img src="https://aaronhertzmann.com/images/howtodraw/ovoid-mesh.png" alt="Occluding contours for meshes" width="40%"/>
</p>
</figure>
</center>
<p>The smooth object has a simple contour, but the triangle mesh’s contour has lots of extra complicated pieces. This is because the surface is no longer cleanly split into one front-facing region and one back-facing region.  The simple contour has become a mess, and this gets worse as surfaces get more complicated:</p>
<center>
<figure>
   <p float="left">
<img src="https://aaronhertzmann.com/images/howtodraw/bunny-purple.png" alt="Occluding contours for meshes" width="60%"/>
</p>
</figure>
</center>
<p>(This is an older rendering with a different color scheme for front and back faces.)</p>

<p>This matters when you try to stylize the contours, such as this animation:</p>
<center>
<video width="720" height="480" controls="">
  <source src="../../../images/howtodraw/Angela_candle_meshC-17288.mp4" type="video/mp4"/>
Your browser does not support the video tag.
</video></center>

<p>Note how the stylization flickers and strokes appear and disappear, despite a number of attempts in this algorithm to keep things coherent.</p>



<p>If you are like most researchers, you might think there are simple solutions to this problem. In my experience, pretty much <em>everyone</em>, when confronted with these problems, immediately suggests simple solutions that they confidently believe will solve the problem.</p>

<p>For example, you could come up with <a href="https://www.cs.princeton.edu/courses/archive/fall00/cs597b/papers/artistic-sils-300dpi.pdf">simple rules to fix up the curves</a>, but these will all fail in various ways. One might think you could subdivide the surface so that it converges (as did one very confident paper reviewer this year), but, this doesn’t fix anything (we analyzed why <a href="https://aaronhertzmann.com/2023/07/31/enard/publications/contours/">in our 2014 paper</a>).  Nothing has worked robustly.  Many other algorithms are surveyed in <a href="https://arxiv.org/abs/1810.01175">our tutorial paper</a>, Chapters 6 and 7.</p>

<p><a href="https://mrl.cs.nyu.edu/publications/illustrating-smooth/">We proposed one of these algorithms in our 2001 paper</a>, an interpolation-based approach that makes nice smooth curves. But, if you zoom in on the figures, you can see gaps in the outlines camoflaged by the hatching:</p>
<center>
<figure>
   <p float="left">
<img src="https://aaronhertzmann.com/images/howtodraw/cupid-gaps.png" alt="Occluding contours for meshes" width="40%"/>
</p>
</figure>
</center>

<p>And this affects real applications. For example,  <a href="https://en.wikipedia.org/wiki/Freestyle_(software)">Blender Freestyle</a> uses  our 2001 algorithm, from the implementation in <a href="https://dl.acm.org/doi/abs/10.1145/1731047.1731056">Stephane Grabli’s work</a>.  <a href="https://www.google.com/search?q=freestyle+gaps+blender">Online, you can find many complaints about the gaps</a> in Freestyle’s contours:</p>
<center>
<figure>
   <p float="left">
   	<a href="https://blenderartists.org/t/trying-to-close-gaps-in-freestyle-lines/688753">
<img src="https://aaronhertzmann.com/images/howtodraw/freestyle.png" alt="Occluding contours for meshes" width="60%"/></a>
</p>
</figure>
</center>
<p>And, here’s an animation from <a href="https://dl.acm.org/doi/10.1145/2024676.2024683">a 2011 paper</a> that tries to fix our method using planar maps, but still has gaps in the outline in some frames:</p>

<center>
<video width="640" height="360" controls="">
  <source src="../../../images/howtodraw/karsch-hart-snaxels.mp4" type="video/mp4"/>
Your browser does not support the video tag.
</video></center>
<p>Even <a href="https://aaronhertzmann.com/images/howtodraw/pig_toon.png">the pig image</a>, which we showed in our survey paper, has an incorrect gap that I only just noticed writing this post.</p>

<p>In addition to their effects on animation, gaps and other errors prevent <em>vectorization</em>, converting these curves to 2D vector graphics. This is important for region-based stylization, filling regions with styles, since style is not just about outline curves, it’s about how you fill in regions as well.</p>

<p>This problem was <a href="https://dl.acm.org/doi/abs/10.1145/321328.321330">first published in 1966</a>; it’s older than photorealistic computer graphics. Depending on how you count, I’ve spent nearly <em>a decade</em> of my career working on this one little problem (that’s <a href="https://en.wikipedia.org/wiki/Elapsed_real_time">wall-clock time</a>, not system time).  You try implementing something, and it seems like there’s just one or two cases to fix with heuristics, but then other cases don’t work… and it becomes whack-a-mole. Nothing works reliably.</p>

<p>And it wasn’t just that we didn’t know how to get the curves looking “right”, we didn’t even know how, exactly, to define the problem… what does “right” even mean here?</p>



  </div>

</article>

      </div>
    </div></div>
  </body>
</html>
