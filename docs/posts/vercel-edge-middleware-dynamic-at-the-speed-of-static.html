<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://vercel.com/blog/vercel-edge-middleware-dynamic-at-the-speed-of-static">Original</a>
    <h1>Vercel Edge Middleware: Dynamic at the speed of static</h1>
    
    <div id="readability-page-1" class="page"><div><div><p>Since we announced Middleware last October, we’ve seen 80% month-over-month growth and over 30 billion requests routed through Edge Middleware on Vercel during public beta. Customers like Vox Media, Hackernoon, Datastax, and HashiCorp are using Edge Middleware to have complete control over routing requests in their Next.js applications.<!-- --></p><p>With the release of <!-- --><a href="https://nextjs.org/blog/next-12-2" rel="noopener" target="_blank">Next.js 12.2<!-- --></a>, Vercel Edge Middleware for Next.js is now generally available (GA) for all customers. Edge Middleware is also available for <!-- --><i>all</i> frameworks—now available in public beta along with a suite of other edge-first tools.<!-- --></p><h2><span id="what-is-vercel-edge-middleware"></span><a href="#what-is-vercel-edge-middleware"><b>What is Vercel Edge Middleware?</b></a><span><svg data-testid="geist-icon" fill="none" height="0.75em" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="0.75em" style="color:currentColor"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></span></h2><div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271971%27%20height=%27790%27/%3e"/></span><img alt="Edge Middleware runs before the Edge Network Cache, for fast rewrites and redirects" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Edge Middleware runs before the Edge Network Cache, for fast rewrites and redirects<!-- --></figcaption></figure></div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271971%27%20height=%27790%27/%3e"/></span><img alt="Edge Middleware runs before the Edge Network Cache, for fast rewrites and redirects" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Edge Middleware runs before the Edge Network Cache, for fast rewrites and redirects<!-- --></figcaption></figure></div></div><div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27375%27%20height=%27547%27/%3e"/></span><img alt="Edge Middleware in your application" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Edge Middleware in your application<!-- --></figcaption></figure></div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27375%27%20height=%27547%27/%3e"/></span><img alt="Edge Middleware in your application" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Edge Middleware in your application<!-- --></figcaption></figure></div></div><p>Edge Middleware helps developers escape lengthy configuration files to instead define routing rules like rewrites, redirects, and headers with code. When deployed to Vercel, Edge Middleware is automatically configured as a special set of Edge Functions. <!-- --></p><p>Edge Middleware runs <!-- --><i>before</i> serving requests from the Edge Cache, giving it the ability to quickly route and rewrite requests to return pre-rendered pages. Some tasks that previously required a trip to the core data center or bulky client-side code can now be done at the edge, configured entirely by custom code. <!-- --></p><h2><span id="why-edge-middleware"></span><a href="#why-edge-middleware">Why Edge Middleware?<!-- --></a><span><svg data-testid="geist-icon" fill="none" height="0.75em" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="0.75em" style="color:currentColor"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></span></h2><p>While in beta, over 100,000 developers used Edge Middleware on Vercel, including almost half of our Enterprise customers. It’s clear that dynamic Edge Middleware at the speed of static is changing how we build for the Web.
<!-- --></p><section><blockquote><figure><div><p><span aria-label="" data-geist-avatar="" role="img"><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2760%27%20height=%2760%27/%3e"/></span><img alt="" async="" decoding="async" importance="low" title="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-nimg="intrinsic"/></span></span></p><p><span aria-label="" data-geist-avatar="" role="img"><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2768%27%20height=%2768%27/%3e"/></span><img alt="" async="" decoding="async" importance="low" title="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-nimg="intrinsic"/></span></span></p></div></figure><p>We&#39;ve been using Edge Middleware to drive experiments and personalization on our marketing surfaces. We keep our ability to customize our content workflows while keeping the performance that Next.js on Vercel gives us. <!-- --></p><p><span>Jon Eide Johnsen</span><span>Growth Manager<!-- --> at Sanity.io<!-- --></span></p></blockquote></section><h3><span id="experiment-at-the-edge"></span><a href="#experiment-at-the-edge">Experiment <!-- --><b>at the edge</b></a><span><svg data-testid="geist-icon" fill="none" height="0.75em" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="0.75em" style="color:currentColor"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></span></h3><p>Customers like <!-- --><b>SumUp </b>and <!-- --><b>Sanity</b> use Edge Middleware to personalize content at the edge through custom experimentation—even for otherwise-static content. <!-- --></p><p>Based on the incoming request, Edge Middleware is able to connect to tools like LaunchDarkly, ConfigCat, Koala, Optimizely, Split, and more to run A/B tests for the current visitor. If the visitor is part of the split test, they’ll be routed to one of the possible variants from the edge server.<!-- --></p><div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27950%27%20height=%27536%27/%3e"/></span><img alt="A/B testing and feature flags, directly in your code with Edge Middleware" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->A/B testing and feature flags, directly in your code with Edge Middleware<!-- --></figcaption></figure></div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27950%27%20height=%27536%27/%3e"/></span><img alt="A/B testing and feature flags, directly in your code with Edge Middleware" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->A/B testing and feature flags, directly in your code with Edge Middleware<!-- --></figcaption></figure></div></div><div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27375%27%20height=%27560%27/%3e"/></span><img alt="A/B testing and feature flags, at the edge" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->A/B testing and feature flags, at the edge<!-- --></figcaption></figure></div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27375%27%20height=%27561%27/%3e"/></span><img alt="A/B testing and feature flags, at the edge" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->A/B testing and feature flags, at the edge<!-- --></figcaption></figure></div></div><p>SumUp can bucket their users on the server side and rewrite the URL as necessary to show the appropriate page to each user immediately. Rather than needing to load heavy client-side libraries for personalization or deal with layout shift from validating whether the visitor was part of the current experiment or not, personalization at the edge helps you achieve great performance, and a great user experience.<!-- --></p><p>Check out <!-- --><a href="https://github.com/vercel/examples/tree/main/edge-functions/ab-testing-simple" rel="noopener" target="_blank">this Middleware A/B test example<!-- --></a> to get started.<!-- --></p><section><blockquote><figure><div><p><span aria-label="" data-geist-avatar="" role="img"><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2760%27%20height=%2760%27/%3e"/></span><img alt="" async="" decoding="async" importance="low" title="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-nimg="intrinsic"/></span></span></p><p><span aria-label="" data-geist-avatar="" role="img"><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2768%27%20height=%2768%27/%3e"/></span><img alt="" async="" decoding="async" importance="low" title="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-nimg="intrinsic"/></span></span></p></div></figure><p>“With Edge Middleware, we can show the control or experiment version of a page immediately instead of using third-party scripts. This results in better performance and removes the likelihood of flickering/layout shifts.” <!-- --></p><p><span>Jillian Anderson Slate</span><span>Software Engineer at SumUp<!-- --></span></p></blockquote></section><h3><span id="localize-at-the-edge"></span><a href="#localize-at-the-edge"><b>Localize at the edge</b></a><span><svg data-testid="geist-icon" fill="none" height="0.75em" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="0.75em" style="color:currentColor"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></span></h3><p>When it comes to localizing content at the edge for their globally distributed customer base, <!-- --><b>HashiCorp</b> is excited about the possibilities of Edge Middleware. The Edge Middleware API contains a geolocation object, pre-populated with the visitor&#39;s country, region, and city based on their IP address. This information can then be used to conditionally show or restrict content based on your company&#39;s regulatory requirements.<!-- --></p><div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27950%27%20height=%27536%27/%3e"/></span><img alt="Personalize content based on geolocation headers with Edge Middleware" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Personalize content based on geolocation headers with Edge Middleware<!-- --></figcaption></figure></div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27950%27%20height=%27536%27/%3e"/></span><img alt="Personalize content based on geolocation headers with Edge Middleware" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Personalize content based on geolocation headers with Edge Middleware<!-- --></figcaption></figure></div></div><div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27375%27%20height=%27553%27/%3e"/></span><img alt="Localize content from the edge" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Localize content from the edge<!-- --></figcaption></figure></div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27375%27%20height=%27553%27/%3e"/></span><img alt="Localize content from the edge" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Localize content from the edge<!-- --></figcaption></figure></div></div><p>Rather than needing to integrate and pay for an additional service to geolocate requests, Vercel includes this functionality for all customers.<!-- --></p><p>Check out this <!-- --><a href="https://github.com/vercel/examples/tree/main/edge-functions/i18n" rel="noopener" target="_blank">Middleware localization example<!-- --></a> to get started.<!-- --></p><section><blockquote><figure><div><p><span aria-label="" data-geist-avatar="" role="img"><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2760%27%20height=%2760%27/%3e"/></span><img alt="" async="" decoding="async" importance="low" title="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-nimg="intrinsic"/></span></span></p><p><span aria-label="" data-geist-avatar="" role="img"><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2768%27%20height=%2768%27/%3e"/></span><img alt="" async="" decoding="async" importance="low" title="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-nimg="intrinsic"/></span></span></p></div></figure><p>&#34;The API for Middleware is pretty intuitive, it allows developers to build features without worrying too much about framework-specific details since it conforms to the same standard that browsers use for requests and responses.&#34;<!-- --></p><p><span>Dylan Staley</span><span>Software Engineer at HashiCorp<!-- --></span></p></blockquote></section><h3><span id="authenticate-at-the-edge"></span><a href="#authenticate-at-the-edge"><b>Authenticate at the edge</b></a><span><svg data-testid="geist-icon" fill="none" height="0.75em" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="0.75em" style="color:currentColor"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></span></h3><p>With Vercel Edge Middleware, authentication at the edge is fast and reliable. When a visitor makes a request to an application, Edge Middleware validates the incoming request to check if the visitor has access to view the content. If they don’t, Edge Middleware routes visitors to a page explaining that they’re not authorized, <!-- --><i>even</i> for CDN-cached content.<!-- --></p><div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27950%27%20height=%27536%27/%3e"/></span><img alt="Authenticate and authorize at the edge, before the initial page load" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Authenticate and authorize at the edge, before the initial page load<!-- --></figcaption></figure></div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27950%27%20height=%27536%27/%3e"/></span><img alt="Authenticate and authorize at the edge, before the initial page load" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Authenticate and authorize at the edge, before the initial page load<!-- --></figcaption></figure></div></div><div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27375%27%20height=%27536%27/%3e"/></span><img alt="Edge Middleware for Authentication" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Edge Middleware for Authentication<!-- --></figcaption></figure></div><div><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27375%27%20height=%27536%27/%3e"/></span><img alt="Edge Middleware for Authentication" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Edge Middleware for Authentication<!-- --></figcaption></figure></div></div><p>Rather than having to wait to authorize on the client-side or authorize on the origin server, requests can be validated close to the customer at their nearest edge in the Vercel Edge Network.<!-- --></p><p>Get started with this <!-- --><a href="https://github.com/vercel/examples/tree/main/edge-functions/basic-auth-password" rel="noopener" target="_blank">Middleware authentication example<!-- --></a>.<!-- --></p><h2><span id="agility-for-all-frameworks"></span><a href="#agility-for-all-frameworks">Agility for all frameworks<!-- --></a><span><svg data-testid="geist-icon" fill="none" height="0.75em" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="0.75em" style="color:currentColor"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></span></h2><p>We&#39;re working to bring more capabilities to the edge, to give developers the ability to choose what&#39;s best for their application, without having to factor in tradeoffs in latency and performance. <!-- --></p><h3><span id="edge-api-routes"></span><a href="#edge-api-routes">Edge API Routes<!-- --></a><span><svg data-testid="geist-icon" fill="none" height="0.75em" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="0.75em" style="color:currentColor"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></span></h3><p>Often, moving API routes to the edge will drastically reduce latency and improve performance. With Edge Functions on Vercel, we&#39;re giving you the power to choose which runtime is the right one to use for your application <!-- --><i>directly </i>within your code. <!-- --></p><div><pre><pre><code><span>import<!-- --></span> <!-- --><span>{<!-- --></span> <!-- --><span>NextRequest<!-- --></span> <!-- --><span>}<!-- --></span> <!-- --><span>from<!-- --></span> <!-- --><span>&#39;next/server&#39;<!-- --></span><span>;<!-- --></span>

<!-- --><span>export<!-- --></span> <!-- --><span>default<!-- --></span> <!-- --><span>(<!-- --></span><span>req<!-- --><span>:<!-- --></span> <!-- --><span>NextRequest<!-- --></span></span><span>)<!-- --></span> <!-- --><span>=&gt;<!-- --></span> <!-- --><span>{<!-- --></span>
  <!-- --><span>return<!-- --></span> <!-- --><span>new<!-- --></span> <!-- --><span>Response<!-- --><span>.<!-- --></span>json<!-- --></span><span>(<!-- --></span><span>{<!-- --></span>
    name<!-- --><span>:<!-- --></span> <!-- --><span><span>`<!-- --></span><span>Hello, from <!-- --></span><span><span>${<!-- --></span>req<!-- --><span>.<!-- --></span><span>url<!-- --></span><span>}<!-- --></span></span><span> I&#39;m now an Edge Function!<!-- --></span><span>`<!-- --></span></span><span>,<!-- --></span>
  <!-- --><span>}<!-- --></span><span>)<!-- --></span><span>;<!-- --></span>
<!-- --><span>}<!-- --></span><span>;<!-- --></span>

<!-- --><span>export<!-- --></span> <!-- --><span>const<!-- --></span> config <!-- --><span>=<!-- --></span> <!-- --><span>{<!-- --></span>
  runtime<!-- --><span>:<!-- --></span> <!-- --><span>&#39;experimental-edge&#39;<!-- --></span><span>,<!-- --></span>
<!-- --><span>}<!-- --></span><span>;<!-- --></span>
<!-- --></code></pre></pre><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Build API Routes at the edge, with the new Edge Runtime<!-- --></figcaption></div><p>Together with traditional Serverless Functions and static caching, Vercel is working to bring granular control over your end-user experience without leaving your code.<!-- --></p><h3><span id="edge-for-all-frameworks"></span><a href="#edge-for-all-frameworks"><b>Edge for all frameworks</b></a><span><svg data-testid="geist-icon" fill="none" height="0.75em" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="0.75em" style="color:currentColor"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></span></h3><p>We believe in the power of edge-first capabilities, and tools built with the edge in mind. We’re working with framework authors to give them tools to access the Vercel primitives, and build edge functionality into any framework. <!-- --></p><p>With this release, we’re also bringing Edge Middleware and Edge Functions to the Vercel CLI, which allows you to build edge capabilities into your deployment no matter what framework you’re building with. Add a <!-- --><code>middleware.js</code> or <!-- --><code>.ts</code> file to your project, run <!-- --><code>vercel dev</code>, and start building for the edge today.<!-- --></p><div><pre><pre><code><span>export<!-- --></span> <!-- --><span>default<!-- --></span> <!-- --><span>function<!-- --></span> <!-- --><span>middleware<!-- --></span><span>(<!-- --></span><span>request<!-- --></span><span>)<!-- --></span> <!-- --><span>{<!-- --></span>
  <!-- -->
  <!-- --><span>const<!-- --></span> url <!-- --><span>=<!-- --></span> <!-- --><span>new<!-- --></span> <!-- --><span>URL<!-- --></span><span>(<!-- --></span>request<!-- --><span>.<!-- --></span><span>url<!-- --></span><span>)<!-- --></span><span>;<!-- --></span>

  <!-- -->
  <!-- --><span>if<!-- --></span> <!-- --><span>(<!-- --></span>url<!-- --><span>.<!-- --></span><span>pathname<!-- --></span> <!-- --><span>===<!-- --></span> <!-- --><span>&#39;/&#39;<!-- --></span><span>)<!-- --></span> <!-- --><span>{<!-- --></span>
    <!-- -->
    <!-- --><span>let<!-- --></span> country <!-- --><span>=<!-- --></span> request<!-- --><span>.<!-- --></span><span>headers<!-- --></span><span>.<!-- --></span><span>get<!-- --></span><span>(<!-- --></span><span>&#39;x-vercel-ip-country&#39;<!-- --></span><span>)<!-- --></span><span>.<!-- --></span><span>toLowerCase<!-- --></span><span>(<!-- --></span><span>)<!-- --></span><span>;<!-- --></span>

    <!-- -->
    url<!-- --><span>.<!-- --></span><span>pathname<!-- --></span> <!-- --><span>=<!-- --></span> <!-- --><span><span>`<!-- --></span><span>/<!-- --></span><span><span>${<!-- --></span>country<!-- --><span>}<!-- --></span></span><span>.html<!-- --></span><span>`<!-- --></span></span><span>;<!-- --></span>

    <!-- -->
    <!-- --><span>return<!-- --></span> <!-- --><span>Response<!-- --></span><span>.<!-- --></span><span>redirect<!-- --></span><span>(<!-- --></span>url<!-- --><span>)<!-- --></span><span>;<!-- --></span>
  <!-- --><span>}<!-- --></span>
<!-- --><span>}<!-- --></span></code></pre></pre><figcaption><svg fill="none" height="12" viewBox="0 0 11 12" width="11"><path clip-rule="evenodd" d="M2 6l8 5V1L2 6z" fill="var(--geist-foreground)" fill-rule="evenodd" stroke="var(--geist-foreground)" stroke-width="1.5"></path></svg> <!-- -->Edge Middleware can be added to any application, using any framework<!-- --></figcaption></div><p>We’re helping framework authors build dedicated support for the edge with tools to let them build native edge functionality for their users. Frameworks like Svelte, Nuxt, and Astro have already begun implementing support for Edge Middleware and Edge Functions.<!-- --></p><p>For customers who have started using Edge Middleware while it was in beta, we’ve created an <!-- --><a href="https://nextjs.org/docs/messages/middleware-upgrade-guide" rel="noopener" target="_blank">upgrade guide<!-- --></a> to help migrate to the new API for Next.js 12.2. For users new to Edge Middleware, <!-- --><a href="https://vercel.com/docs/concepts/functions/edge-middleware/quickstart" rel="noopener" target="_blank">check out our quickstart guides<!-- --></a>.<!-- --></p><p>Every Vercel account has 1 million monthly Middleware invocations included for <!-- --><i>free</i>; Pro and Enterprise teams can <!-- --><a href="https://vercel.com/pricing" rel="noopener" target="_blank">pay for additional usage<!-- --></a>. While still in beta, Edge Functions will be free to use.<!-- --></p><p>Whether you’re using Vercel Edge Middleware to authenticate, personalize, or localize at the edge, now you can provide tailor-made experiences at the speed of static. You have the power to serve the exact end-user experience you envisioned, every time.<!-- --></p></div></div></div>
  </body>
</html>
