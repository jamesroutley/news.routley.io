<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://benjamincongdon.me/blog/2022/07/17/In-Praise-of-Stacked-PRs/">Original</a>
    <h1>In Praise of Stacked PRs</h1>
    
    <div id="readability-page-1" class="page"><div>
            <p>“Stacked PRs” is the practice of breaking up a large change into smaller,
individually reviewable PRs which can depend on each other, forming a DAG:</p>
<figure>
    
    <a href="https://benjamincongdon.me/blog/2022/07/17/In-Praise-of-Stacked-PRs/stacked-prs.excalidraw.png">
        
            
                
                
            
        
        <img src="https://d33wubrfki0l68.cloudfront.net/1af685abe0823927d9b50ab2fde5ea5cb4c5ca5b/eb406/blog/2022/07/17/in-praise-of-stacked-prs/stacked-prs.excalidraw_hu90fddf3c838b76d2bdf0e3122db7f271_33618_0x400_resize_lanczos_3.png" loading="lazy"/> 
        </a>
</figure>

<p>I wrote about this in my post about
<a href="https://benjamincongdon.me/blog/2021/12/07/Branchless-Git/">git-branchless</a>, but I think the practice
itself deserves its own post.</p>
<h2 id="why-am-i-so-enthusiastic-about-stacked-prs">Why am I so enthusiastic about stacked PRs?</h2>
<ul>
<li>They encourage sending out smaller PRs. This, in it of itself, has many
<a href="https://google.github.io/eng-practices/review/developer/small-cls.html">demonstrable benefits</a>.
In particular, smaller PRs are:
<ul>
<li>… Easier &amp; quicker to review, since the reviewer has fewer changes to
sign-off on.</li>
<li>… Easier to rollback if they cause breakage.</li>
</ul>
</li>
<li>Stacking PRs keeps the author unblocked.
<ul>
<li>Authors don’t need to wait on a particular change to be merged before
starting to build something on top of those changes.</li>
<li>This makes the authors less sensitive to the review time of any
particular PR, since they can keep writing new changes as older changes
are still in review.</li>
</ul>
</li>
<li>Stacking PRs allows you to easily manage dependent changes.
<ul>
<li>Since stacking PRs allows you to create a DAG of dependent changes, this
natually allows you to manage code changes that need to be submitted in
a particular order.</li>
</ul>
</li>
</ul>
<h2 id="critical-features-for-implementing-stacked-prs">Critical features for implementing stacked PRs:</h2>
<ul>
<li>The ability to sync the tree of PRs with an upstream easily, while
maintaining the DAG structure.
<ul>
<li>Similarly: The ability to push up the local contents of PRs up to the
centralized tool being used for code review.</li>
</ul>
</li>
<li>The ability to incorporate changes into a PR, and easily propagate/merge
those changes into its dependants.</li>
<li>The ability to rearrange PRs.
<ul>
<li>For example: changing a PR’s parent, rearranging the order of PRs in the
“stack”, adding a new PR between 2 existing PRs, etc.</li>
</ul>
</li>
<li>The ability to create a PR that presents it’s diff against another PR. That
is, the displayed diff when reviewing code uses it’s “parent” PR as the
base.</li>
<li>The ability to quickly switch between PRs.</li>
<li>The ability to view the size of a PR, to advertise that it’s an easily
reviewable
<a href="https://google.github.io/eng-practices/review/developer/small-cls.html">small PR</a>.
<em>(h/t <a href="https://lobste.rs/s/4zjln3/praise_stacked_prs">FeepingCreature </a>)</em></li>
<li>The ability to view the PR DAG <em>both</em> locally, and within the code review
tool.</li>
</ul>
<h2 id="stacked-pull-requests-vs-stacked-commits">Stacked Pull Requests vs. Stacked Commits</h2>
<p>“Pull Request” has a specific meaning in Git, though it’s come to mean something
colloquially equivalent to “change list” or “patch” over time. For the
“stacking” pattern, the important thing is that atomic units of code changes can
be (1) ordered as a DAG and (2) reviewed independently. This post should really
be named something like <em>“In Prase of Stacked ‘Individually Reviewable Units of
Code’”</em>, but that’s much less catchy.</p>
<p>The alternative to “Stacked Pull Requests” is “Stacked Commits”. The difference
is mostly pragmatic: stacked PRs use branches, and can have multiple commits in
a single atomic change; stacked commits use a single commit as the unit of
atomic change.</p>
<p>Github encourages the Stacked PR approach, whereas tools like Gerrit encourage
stacked commits. Personally, I’m agnostic on which is the better approach. I’m
more familiar using Stacked Commits, but it does feel like you’re fighting
against git with this approach – since you eschew the use of branches.</p>
<p>Either approach benefits mightily from the use of specialized tooling. The
vanilla <code>git</code> CLI <em>can</em> be used for either approach, but you’ll spend more of
your time doing low-level commit/branch modification operations than I think is
wise.</p>

<ul>
<li><a href="https://github.com/VirtusLab/git-machete">git-machete</a> – Tagline:
<em>“Probably the sharpest git repository organizer &amp; rebase/merge workflow
automation tool you’ve ever seen”</em>
<ul>
<li>Currently, this is my favorite tool for Stacked PRs.</li>
</ul>
</li>
<li><a href="https://github.com/arxanas/git-branchless">git-branchless</a> – Tagline:
<em>“High-velocity, monorepo-scale workflow for Git”</em>
<ul>
<li>This is my favorite tool for Stacked Commits. It’s built with
performance in mind too, which helps when operating on large monorepos.</li>
</ul>
</li>
<li><a href="https://github.com/gitext-rs/git-stack">git-stack</a> – Tagline: <em>“Stacked
branch management for Git”</em>
<ul>
<li>I haven’t used this one enough to have an opinion on it, but it seems
useful for working with Stacked PRs – since it has the approach that
“Branches are the unit of work and review”</li>
</ul>
</li>
</ul>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="https://timothya.com/blog/git-stack/">A Better Model for Stacked (GitHub) Pull Requests • Timothy Andrew</a></li>
<li><a href="https://drewdevault.com/2020/04/06/My-weird-branchless-git-workflow.html">My unorthodox, branchless git workflow</a>
(Drew DeVault)</li>
<li><a href="https://benjamincongdon.me/blog/2021/10/17/Features-of-Excellent-Code-Review-Tools/">Features of Excellent Code Review Tools</a></li>
<li><a href="https://jg.gg/2018/09/29/stacked-diffs-versus-pull-requests/">Stacked Diffs Versus Pull Requests | Jackson Gabbard’s Blog</a></li>
</ul>
<hr/>
<p><em>See discussion on <a href="https://lobste.rs/s/4zjln3/praise_stacked_prs">Lobste.rs</a>.</em></p>

        </div></div>
  </body>
</html>
