<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/Spuffynism/446c7c2d498477491d8137e8f234d4a9">Original</a>
    <h1>Solving a Dungeons and Dragons riddle using Prolog</h1>
    
    <div id="readability-page-1" class="page"><div>
  <div id="file-1-solving-a-dungeons-and-dragons-riddle-using-prolog-md">
      
      <div id="file-1-solving-a-dungeons-and-dragons-riddle-using-prolog-md-readme">
    <article itemprop="text">
<h4 dir="auto"><a id="user-content-bringing-back-the-magic-of-christmas-using-the-magic-of-prolog" aria-hidden="true" href="#bringing-back-the-magic-of-christmas-using-the-magic-of-prolog"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Bringing back the magic of Christmas using the magic of prolog</h4>
<p dir="auto">As part of a holiday D&amp;D one-shot session where Santa Claus&#39;s toy factory had been sabotaged, our dungeon master presented to us, a group of Christmas elves, a riddle to solve.</p>
<p dir="auto">9 cards, labeled with the names of Santa&#39;s reindeer were presented to us. The instructions indicated that we had to find the order reindeer were in, according to this riddle:</p>
<blockquote>
<p dir="auto">Vixen should be behind Rudolph, Prancer and Dasher, whilst Vixen should be in front of Dancer and Comet. Dancer should be behind Donder, Blitzen and Rudolph. Comet should be behind Cupid, Prancer and Rudolph. Donder should be behind Comet, Vixen, Dasher, Prancer and Cupid. Cupid should be in front of Comet, Blitzen, Vixen, Dancer and Rudolph. Prancer should be in front of Blitzen, Donder and Cupid. Blitzen should be behind Cupid but in front of Dancer, Vixen and Donder. Rudolph should be behind Prancer but in front of Dasher, Dancer and Donder. Finally, Dasher should be behind Prancer but in front of Blitzen, Dancer and Vixen.</p>
</blockquote>
<p dir="auto">These sentences seem a lot like prolog facts to me! Let&#39;s translate them to prolog facts, and then use said facts to solve the riddle.</p>
<h2 dir="auto"><a id="user-content-solution-with-the-least-knowledge-about-the-problem" aria-hidden="true" href="#solution-with-the-least-knowledge-about-the-problem"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Solution with the least knowledge about the problem</h2>
<p dir="auto">First, we declare facts for all relationships between reindeer as described in the riddle.</p>
<p dir="auto">We&#39;ll use <code>is_behind(Second, First)</code> to describe when a <code>Second</code> reindeer is behind the <code>First</code> reindeer, and the opposite for when a reindeer is in front of the other one (<code>Second</code> is in front of <code>First</code> becomes <code>is_behind(First, Second)</code>).</p>
<div dir="auto"><pre><span>% Vixen should be behind Rudolph, Prancer and Dasher,</span>
<span>is_behind</span>(<span>vixen</span>, <span>rudolph</span>)<span>.</span>
<span>is_behind</span>(<span>vixen</span>, <span>prancer</span>)<span>.</span>
<span>is_behind</span>(<span>vixen</span>, <span>dasher</span>)<span>.</span>

<span>% whilst Vixen should be in front of Dancer and Comet.</span>
<span>is_behind</span>(<span>dancer</span>, <span>vixen</span>)<span>.</span>
<span>is_behind</span>(<span>comet</span>, <span>vixen</span>)<span>.</span>

<span>% Dancer should be behind Donder, Blitzen and Rudolph.</span>
<span>is_behind</span>(<span>dancer</span>, <span>donder</span>)<span>.</span>
<span>is_behind</span>(<span>dancer</span>, <span>blitzen</span>)<span>.</span>
<span>is_behind</span>(<span>dancer</span>, <span>rudolph</span>)<span>.</span>

<span>% Comet should be behind Cupid, Prancer and Rudolph.</span>
<span>is_behind</span>(<span>comet</span>, <span>cupid</span>)<span>.</span>
<span>is_behind</span>(<span>comet</span>, <span>prancer</span>)<span>.</span>
<span>is_behind</span>(<span>comet</span>, <span>rudolph</span>)<span>.</span>

<span>% Donder should be behind Comet, Vixen, Dasher, Prancer and Cupid.</span>
<span>is_behind</span>(<span>donder</span>, <span>comet</span>)<span>.</span>
<span>is_behind</span>(<span>donder</span>, <span>vixen</span>)<span>.</span>
<span>is_behind</span>(<span>donder</span>, <span>dasher</span>)<span>.</span>
<span>is_behind</span>(<span>donder</span>, <span>prancer</span>)<span>.</span>
<span>is_behind</span>(<span>donder</span>, <span>cupid</span>)<span>.</span>

<span>% Cupid should be in front of Comet, Blitzen, Vixen, Dancer and Rudolph.</span>
<span>is_behind</span>(<span>comet</span>, <span>cupid</span>)<span>.</span>
<span>is_behind</span>(<span>blitzen</span>, <span>cupid</span>)<span>.</span>
<span>is_behind</span>(<span>vixen</span>, <span>cupid</span>)<span>.</span>
<span>is_behind</span>(<span>dancer</span>, <span>cupid</span>)<span>.</span>
<span>is_behind</span>(<span>rudolph</span>, <span>cupid</span>)<span>.</span>

<span>% Prancer should be in front of Blitzen, Donder and Cupid.</span>
<span>is_behind</span>(<span>blitzen</span>, <span>prancer</span>)<span>.</span>
<span>is_behind</span>(<span>donder</span>, <span>prancer</span>)<span>.</span>
<span>is_behind</span>(<span>cupid</span>, <span>prancer</span>)<span>.</span>

<span>% Blitzen should be behind Cupid but in front of Dancer, Vixen and Donder.</span>
<span>is_behind</span>(<span>blitzen</span>, <span>cupid</span>)<span>.</span>
<span>is_behind</span>(<span>dancer</span>, <span>blitzen</span>)<span>.</span>
<span>is_behind</span>(<span>vixen</span>, <span>blitzen</span>)<span>.</span>
<span>is_behind</span>(<span>donder</span>, <span>blitzen</span>)<span>.</span>

<span>% Rudolph should be behind Prancer but in front of Dasher, Dancer and Donder.</span>
<span>is_behind</span>(<span>rudolph</span>, <span>prancer</span>)<span>.</span>
<span>is_behind</span>(<span>dasher</span>, <span>rudolph</span>)<span>.</span>
<span>is_behind</span>(<span>dancer</span>, <span>rudolph</span>)<span>.</span>
<span>is_behind</span>(<span>donder</span>, <span>rudolph</span>)<span>.</span>

<span>% Finally, Dasher should be behind Prancer but in front of Blitzen, Dancer and Vixen.</span>
<span>is_behind</span>(<span>dasher</span>, <span>prancer</span>)<span>.</span>
<span>is_behind</span>(<span>blitzen</span>, <span>dasher</span>)<span>.</span>
<span>is_behind</span>(<span>dancer</span>, <span>dasher</span>)<span>.</span>
<span>is_behind</span>(<span>vixen</span>, <span>dasher</span>)<span>.</span></pre></div>
<p dir="auto">Using a rule, we declare that if <code>Last</code> is behind <code>Middle</code> and <code>Middle</code> is behind <code>First</code>, then <code>Last</code> is behind <code>First</code>. In other words, by <a href="https://en.wikipedia.org/wiki/Transitive_relation" rel="nofollow">transitivity</a>, if <code>x &gt; y</code> and <code>y &gt; z</code>, then <code>x &gt; z</code>. We&#39;ll need it when testing if a sequence respects the reindeer order described by the facts.</p>
<div dir="auto"><pre><span>follows</span>(<span>Last</span>, <span>First</span>) <span>:-</span> is_behind(<span>Last</span>, <span>First</span>)<span>.</span>
<span>follows</span>(<span>Last</span>, <span>First</span>) <span>:-</span> is_behind(<span>Middle</span>, <span>First</span>), follows(<span>Last</span>, <span>Middle</span>)<span>.</span></pre></div>
<p dir="auto">A sequence respects the order if reindeer follow each other according to the facts. Let&#39;s specify that in a rule.</p>
<div dir="auto"><pre><span>respects_order</span>([<span>First</span>|[<span>Second</span>]]) <span>:-</span> follows(<span>Second</span>, <span>First</span>)<span>.</span>
<span>respects_order</span>([<span>First</span>|[<span>Second</span>|<span>Rest</span>]]) <span>:-</span>
    follows(<span>Second</span>, <span>First</span>), respects_order([<span>Second</span>|<span>Rest</span>])<span>.</span></pre></div>
<p dir="auto">Finally, let&#39;s declare a rule that will find a valid solution. We first list all unique known reindeer. Then, we compute possible reindeer sequence permutations. Lastly, we find the first permutation that&#39;s a valid solution â€” the one that respects the reindeer order.</p>
<div dir="auto"><pre><span>solution</span>(<span>Permutation</span>) <span>:-</span>
    <span>findall</span>(<span>Reindeer</span>, (is_behind(<span>Reindeer</span>, <span>_</span>); is_behind(<span>_</span>, <span>Reindeer</span>)), <span>List</span>),
    list_to_set(<span>List</span>, <span>UniqueReindeer</span>),
    permutation(<span>UniqueReindeer</span>, <span>Permutation</span>),
    once(respects_order(<span>Permutation</span>))<span>.</span></pre></div>
<p dir="auto">We can now query <code>solution</code> to find the reindeer sequence...</p>
<div dir="auto"><pre>?- solution(Sequence)
    <span>Sequence</span> = [
        <span>prancer</span>,
        <span>cupid</span>,
        <span>rudolph</span>,
        <span>dasher</span>,
        <span>blitzen</span>,
        <span>vixen</span>,
        <span>comet</span>,
        <span>donder</span>,
        <span>dancer</span>
    ]</pre></div>
<p dir="auto">And there you have it, the answer to our riddle! We only needed a few elements:</p>
<ul dir="auto">
<li>Facts about the reindeer</li>
<li>Rules to confirm that a sequence is valid</li>
<li>A rule to test possible sequences</li>
</ul>
<p dir="auto">Although this works great, we are not taking full advantage of the power of prolog, nor the knowledge we have about what a valid solution consists of.</p>
<h2 dir="auto"><a id="user-content-other-solution-knowing-there-are-9-reindeer" aria-hidden="true" href="#other-solution-knowing-there-are-9-reindeer"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Other solution, knowing there are 9 reindeer</h2>
<p dir="auto">We can combine the knowledge that there are exactly 9 unique reindeer with this <a href="https://en.wikibooks.org/wiki/Prolog/Solving_a_Logic_Puzzle" rel="nofollow">Prolog wiki solution</a> for a similar logic puzzle to create a more succinct solution. Furthermore, whereas in the previous solution we had to manually make the <code>is_behind</code> rule transitive by declaring the <code>follows</code> rule, we&#39;ll depend on the transitivity of comparison operators (&#34;less than&#34; and &#34;greater than&#34;) in this solution.</p>
<p dir="auto">We&#39;ll generate permutations by associating every reindeer to a unique number. Then, we&#39;ll test the permutations against the riddle.</p>
<p dir="auto">First, we list the reindeer with a list of possible positions for them (1 through 9). We use the permutation predicate to have prolog generate reindeer sequences:</p>
<div dir="auto"><pre><span>permutation</span>(
    [<span>Vixen</span>, <span>Rudolph</span>, <span>Prancer</span>, <span>Dasher</span>, <span>Dancer</span>, <span>Comet</span>, <span>Donder</span>, <span>Blitzen</span>, <span>Cupid</span>],
    [<span>1</span>, <span>2</span>, <span>3</span>, <span>4</span>, <span>5</span>, <span>6</span>, <span>7</span>, <span>8</span>, <span>9</span>])</pre></div>
<p dir="auto">Then, we declare the riddle sentences as comparisons on free variables. Second &gt; First means that Second is behind First. First &lt; Second means that First is in front of Second.</p>
<div dir="auto"><pre><span>% Vixen should be behind Rudolph, Prancer and Dasher,</span>
<span>Vixen</span> &gt; <span>Rudolph</span>, <span>Vixen</span> &gt; <span>Prancer</span>, <span>Vixen</span> &gt; <span>Dasher</span>,

% <span>whilst</span> <span>Vixen</span> <span>should</span> <span>be</span> <span>in</span> <span>front</span> <span>of</span> <span>Dancer</span> <span>and</span> <span>Comet</span><span>.</span>
<span>Vixen</span> &lt; <span>Dancer</span>, <span>Vixen</span> &lt; <span>Comet</span>,

% <span>Dancer</span> <span>should</span> <span>be</span> <span>behind</span> <span>Donder</span>, <span>Blitzen</span> <span>and</span> <span>Rudolph</span><span>.</span>
<span>Dancer</span> &gt; <span>Donder</span>, <span>Dancer</span> &gt; <span>Blitzen</span>, <span>Dancer</span> &gt; <span>Comet</span>,

% <span>Comet</span> <span>should</span> <span>be</span> <span>behind</span> <span>Cupid</span>, <span>Prancer</span> <span>and</span> <span>Rudolph</span><span>.</span>
<span>Comet</span> &gt; <span>Cupid</span>, <span>Comet</span> &gt; <span>Prancer</span>, <span>Comet</span> &gt; <span>Rudolph</span>,

% <span>Donder</span> <span>should</span> <span>be</span> <span>behind</span> <span>Comet</span>, <span>Vixen</span>, <span>Dasher</span>, <span>Prancer</span> <span>and</span> <span>Cupid</span><span>.</span>
<span>Donder</span> &gt; <span>Comet</span>, <span>Donder</span> &gt; <span>Vixen</span>, <span>Donder</span> &gt; <span>Dasher</span>, <span>Donder</span> &gt; <span>Prancer</span>, <span>Donder</span> &gt; <span>Cupid</span>,

% <span>Cupid</span> <span>should</span> <span>be</span> <span>in</span> <span>front</span> <span>of</span> <span>Comet</span>, <span>Blitzen</span>, <span>Vixen</span>, <span>Dancer</span> <span>and</span> <span>Rudolph</span><span>.</span>
<span>Cupid</span> &lt; <span>Comet</span>, <span>Cupid</span> &lt; <span>Blitzen</span>, <span>Cupid</span> &lt; <span>Vixen</span>, <span>Cupid</span> &lt; <span>Dancer</span>, <span>Cupid</span> &lt; <span>Rudolph</span>,

% <span>Prancer</span> <span>should</span> <span>be</span> <span>in</span> <span>front</span> <span>of</span> <span>Blitzen</span>, <span>Donder</span> <span>and</span> <span>Cupid</span><span>.</span>
<span>Prancer</span> &lt; <span>Blitzen</span>, <span>Prancer</span> &lt; <span>Donder</span>, <span>Prancer</span> &lt; <span>Cupid</span>,

% <span>Blitzen</span> <span>should</span> <span>be</span> <span>behind</span> <span>Cupid</span> <span>but</span> <span>in</span> <span>front</span> <span>of</span> <span>Dancer</span>, <span>Vixen</span> <span>and</span> <span>Donder</span><span>.</span>
<span>Blitzen</span> &gt; <span>Cupid</span>, <span>Blitzen</span> &lt; <span>Dancer</span>, <span>Blitzen</span> &lt; <span>Vixen</span>, <span>Blitzen</span> &lt; <span>Donder</span>,

% <span>Rudolph</span> <span>should</span> <span>be</span> <span>behind</span> <span>Prancer</span> <span>but</span> <span>in</span> <span>front</span> <span>of</span> <span>Dasher</span>, <span>Dancer</span> <span>and</span> <span>Donder</span><span>.</span>
<span>Rudolph</span> &gt; <span>Prancer</span>, <span>Rudolph</span> &lt; <span>Dasher</span>, <span>Rudolph</span> &lt; <span>Dancer</span>, <span>Rudolph</span> &lt; <span>Donder</span>,

% <span>Finally</span>, <span>Dasher</span> <span>should</span> <span>be</span> <span>behind</span> <span>Prancer</span> <span>but</span> <span>in</span> <span>front</span> <span>of</span> <span>Blitzen</span>, <span>Dancer</span> <span>and</span> <span>Vixen</span><span>.</span>
<span>Dasher</span> &gt; <span>Prancer</span>, <span>Dasher</span> &lt; <span>Blitzen</span>, <span>Dasher</span> &lt; <span>Dancer</span>, <span>Dasher</span> &lt; <span>Vixen</span><span>.</span></pre></div>
<p dir="auto">Finally, we put it together under a solution rule...</p>
<div dir="auto"><pre><span>solution</span>([<span>Vixen</span>, <span>Rudolph</span>, <span>Prancer</span>, <span>Dasher</span>, <span>Dancer</span>, <span>Comet</span>, <span>Donder</span>, <span>Blitzen</span>, <span>Cupid</span>]) <span>:-</span>
    permutation([<span>Vixen</span>, <span>Rudolph</span>, <span>Prancer</span>, <span>Dasher</span>, <span>Dancer</span>, <span>Comet</span>, <span>Donder</span>, <span>Blitzen</span>, <span>Cupid</span>], [<span>1</span>, <span>2</span>, <span>3</span>, <span>4</span>, <span>5</span>, <span>6</span>, <span>7</span>, <span>8</span>, <span>9</span>]),
    <span>% Vixen should be behind Rudolph, Prancer and Dasher,</span>
    <span>Vixen</span> <span>&gt;</span> <span>Rudolph</span>, <span>Vixen</span> <span>&gt;</span> <span>Prancer</span>, <span>Vixen</span> <span>&gt;</span> <span>Dasher</span>,
    <span>% ... more comparison rules</span></pre></div>
<p dir="auto">... and we query it!</p>
<div dir="auto"><pre>?- solution([Vixen, Rudolph, Prancer, Dasher, Dancer, Comet, Donder, Blitzen, Cupid])
    <span>Blitzen</span> = <span>5</span>,
    <span>Comet</span> = <span>7</span>,
    <span>Cupid</span> = <span>2</span>,
    <span>Dancer</span> = <span>9</span>,
    <span>Dasher</span> = <span>4</span>,
    <span>Donder</span> = <span>8</span>,
    <span>Prancer</span> = <span>1</span>,
    <span>Rudolph</span> = <span>3</span>,
    <span>Vixen</span> = <span>6</span></pre></div>
<p dir="auto">Sorting them by hand, we get the answer to the riddle:</p>
<div dir="auto"><pre><span>Prancer</span> = <span>1</span>,
<span>Cupid</span> = <span>2</span>,
<span>Rudolph</span> = <span>3</span>,
<span>Dasher</span> = <span>4</span>,
<span>Blitzen</span> = <span>5</span>,
<span>Vixen</span> = <span>6</span>
<span>Comet</span> = <span>7</span>,
<span>Donder</span> = <span>8</span>,
<span>Dancer</span> = <span>9</span>,</pre></div>
<p dir="auto">In the first solution, we defined transitivity of the <code>is_behind</code> rule using the <code>follows</code> rule. In this solution, we equate reindeer to numbers and rely on the transitivity of comparison operators to arrive at the solution! We didn&#39;t even need to write an algorithm to solve the riddle, we only needed to declare the riddle constraints, and then let prolog find a sequence that fits within said constraints!</p>
</article>
  </div>

  </div>
</div></div>
  </body>
</html>
