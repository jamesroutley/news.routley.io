<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://hpyproject.org/">Original</a>
    <h1>HPy – A better C API for Python</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody text">
    <section id="what-is-hpy"><h2>What is HPy?<a href="#what-is-hpy" title="Permalink to this heading">¶</a></h2>
<p>HPy provides a new API for extending Python in C.  In other words, you use
<code>#include &lt;hpy.h&gt;</code> instead of <code>#include &lt;Python.h&gt;</code>.</p>
</section><section id="what-are-the-advantages-of-hpy"><h2>What are the advantages of HPy?<a href="#what-are-the-advantages-of-hpy" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p><strong>Zero overhead</strong> on CPython: extensions written in HPy run at the same
speed as &#34;normal&#34; extensions.</p></li>
<li><p><strong>Much faster</strong> on alternative implementations such as <a href="https://pypy.org">PyPy</a>, <a href="https://www.graalvm.org/python">GraalPy</a>.</p></li>
<li><p><strong>Universal binaries</strong>: extensions built for the <a href="https://docs.hpyproject.org/en/latest/overview.html#target-abis">HPy Universal ABI</a> can be
loaded unmodified on CPython, PyPy, GraalPython, etc.</p></li>
<li><p><strong>A migration path</strong> for mixing legacy C-API calls with HPy API calls. Once
all the code is migrated, the extension can be compiled as a universal binary
that works on any CPython version, PyPy, or GraalPy.</p></li>
<li><p><strong>Debug mode</strong>: in <a href="https://docs.hpyproject.org/en/latest/debug-mode.html">debug mode</a>, you can easily identify common problems such
as memory leaks, invalid lifetime of objects, invalid usage of APIs. Have
you ever forgot a <code>Py_INCREF</code> or <code>Py_DECREF</code>? The HPy debug mode can be
activated at runtime to detect these mistakes for you on universal binaries.</p></li>
<li><p><strong>Nicer API</strong>: the standard Python/C API shows its age. HPy is designed to
overcome some of its limitations, be more consistent, produce better quality
extensions and to make it harder to introduce bugs.</p></li>
<li><p><strong>Evolvability</strong>: As nicely summarized in
<a href="https://peps.python.org/pep-0620/">PEP 620</a> the standard Python/C API
exposes a lot of internal implementation details which makes it hard to
evolve the C API. HPy doesn&#39;t have this problem because all internal
implementation details are hidden.</p></li>
</ul></section><section id="current-status"><h2>Current status<a href="#current-status" title="Permalink to this heading">¶</a></h2>
<p>HPy is under active development. <a href="https://hpyproject.org/blog/posts/2023/10/hpy-0.9.0-fourth-public-release/">0.9.0</a> is the latest alpha release but we
will soon leave the _alpha_ state and are working hard towards a stable release.</p>
<p>We feel that the HPy ABI is stable enough now that we can fulfill our backwards
and forwards binary compatibility promises with the upcoming release, and that
the API now covers enough use cases to migrate important packages (in
particular, checkout our <a href="https://github.com/hpyproject/numpy-hpy/tree/graal-team/hpy#readme">numpy</a> port). We also provide porting guides and
extensive documentation (in particular the <a href="https://docs.hpyproject.org/en/latest/api-reference/index.html">API reference</a>).</p>
<p>We are, of course, always open for design discussions and new reqiurements.</p>
<p>The Python/C API is huge. At the moment many popular functions are
available. Is something missing for the port of your favorite extension?
Please open an issue or even better a PR.</p>
<section id="hpy-compatible-extensions"><h3>HPy-compatible extensions<a href="#hpy-compatible-extensions" title="Permalink to this heading">¶</a></h3>
<p>The extensions that we are experimenting with include:</p>
<ul>
<li><p><a href="https://github.com/hpyproject/ultrajson-hpy">ultrajson-hpy</a>: this was the first real-world module to be ported to HPy. It is
a nice fit because it only exports functions (as opposed as custom types)
and requires only a small number of API functions.</p></li>
<li><p><a href="https://github.com/hpyproject/piconumpy">piconumpy</a>: as the name suggests, this is a minimal numpy-like module which
defines a custom type (similar to <code>ndarray</code> but with many fewer features of
course).</p></li>
<li><p><a href="https://github.com/hpyproject/numpy-hpy/tree/graal-team/hpy#readme">numpy</a>: one of our ambitious goals is to port numpy to HPy, and to use this
experience to better understand how to design the API. This port is close to
passing the test suite.</p></li>
<li><p><a href="https://github.com/hpyproject/matplotlib-hpy/">matplotlib</a>: Since Matplotlib also has a dependency to NumPy, the migration
to universal mode is not fully finished. HPy provides the legacy compatibility API
such that we can still call legacy C API functions from HPy and successfully
run the test suite.</p></li>
<li><p><a href="https://github.com/hpyproject/kiwi-hpy/">kiwi-solver</a>: A dependency of Matplotlib, it has been fully ported to
universal mode.</p></li>
</ul>
<p>Benchmarks and more information about the Matplotlib and kiwi-solver ports can
be found in the <a href="https://medium.com/graalvm/porting-matplotlib-from-c-api-to-hpy-aa32faa1f0b5">GraalVM blog post</a>. The benchmarks show that the HPy ports
have little impact on CPython performance, while enabling close-to-cpython
performance with GraalVM Python for the kiwi-solver complete HPy port.</p>
</section></section><section id="where-we-need-help"><h2>Where we need help<a href="#where-we-need-help" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p><strong>Documentation:</strong> Our resources are very limited and we therefore concentrate
on technical tasks. We already wrote a significant amount of documentation
(see <a href="https://hpy.readthedocs.io/en/latest/">Documentation</a>) but it is not complete yet. If this non-coding work is
something you can do, let us know.</p></li>
<li><p><strong>Publicity:</strong> HPy is already well received among core developers of some
important projects. For instance, we are actively talking to Python, NumPy,
and Cython core developers. However, we need to get more package developers to
be interested in and even use HPy. We appreciate any help for advertising HPy
and we are also happy to help preparing talks, demos, etc.</p></li>
<li><p><strong>Tooling:</strong> This is also a topic we would need help. We are, for example,
thinking of migration helper tools that do all the boilerplate work that can
be automated when migrating a package from C API to HPy API.</p></li>
<li>
<p><strong>Packaging:</strong> There are several open questions we need to discuss and answer.</p>
<ul>
<li><p>How to package a universal extension and how to put it on PyPI?</p></li>
<li><p>How best to package HPy itself</p></li>
<li><p>How does HPy integrate with setuptools, mesonpy, or other build systems</p></li>
<li><p>Upstreaming completed forks of the packages listed below, or upstreaming
parts of the forks so the code does not suffer from bit-rot</p></li>
</ul>
</li>
<li><p><strong>Website and logo design:</strong> You don&#39;t like this website and the HPy logo?
Well, we have expertise in virtual machines, compilers, low-level programming,
etc, but zero expertise in web development or graphic design. <a href="https://github.com/hpyproject/hpyproject.org/">PRs are welcome
;)</a></p></li>
</ul></section><section id="more-info"><h2>More info<a href="#more-info" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p><a href="https://hpy.readthedocs.io/en/latest/">Documentation</a></p></li>
<li><p><a href="https://hpyproject.org/blog/">HPy blog</a></p></li>
<li><p><a href="https://github.com/hpyproject/hpy/">Github repository</a></p></li>
<li><p><a href="https://discord.gg/xSzxUbPkTQ">HPy Discord server</a></p></li>
<li><p>#hpy <a href="irc://irc.libera.chat/hpy">IRC channel</a> (obsolete but still there)</p></li>
<li><p><a href="https://mail.python.org/archives/list/hpy-dev@python.org/latest">Mailing list</a></p></li>
<li><p>HPy is pronounced <cite>/h/ - pie</cite> (or using IPA notation: <cite>/eɪtʃ-paɪ/</cite>)</p></li>
</ul></section><section id="recent-blog-posts"><h2>Recent blog posts<a href="#recent-blog-posts" title="Permalink to this heading">¶</a></h2>
<!-- Begin post-list post_list_3083f6e11d7747c98bd37ec46c431723 -->

<!-- End post-list post_list_3083f6e11d7747c98bd37ec46c431723 -->
</section>
</div></div>
  </body>
</html>
