<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.jetpens.com/blog/The-41-Best-Pens-for-2022-Gel-Ballpoint-Rollerball-and-Fountain-Pens/pt/974">Original</a>
    <h1>Best Pens for 2022: Gel, Ballpoint, Rollerball, and Fountain Pens</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>One of the things that makes DNS difficult to understand is that it’s
<strong>decentralized</strong>. There are thousands (maybe hundreds of thousands? I don’t know!) of authoritative nameservers, and at least
<a href="https://www.icann.org/en/blogs/details/ten-million-dns-resolvers-on-the-internet-22-3-2012-en">10 million resolvers</a>.
And they’re running lots of different software! All these different servers
running software means that there’s a lot of inconsistency in how DNS works,
which can cause all kinds of frustrating problems.</p>
<p>But instead of talking about the problems, I’m interested in figuring out –
why is it a good thing that DNS is decentralized?</p>
<h3 id="why-is-it-good-that-dns-is-decentralized">why is it good that DNS is decentralized?</h3>
<p>One reason is <strong>scalability</strong> – the decentralized design of DNS makes it
easier to scale and more resilient to failures. I find it really amazing that
DNS is still scaling well even though it’s almost 40 years old. This is very
important but it’s not what this post is about.</p>
<p>Instead, I want to talk about how the fact that it’s decentralized means that
you can have <strong>control</strong> of how your DNS works. You can add more servers to the
giant complicated mess of DNS servers! Servers that you control!</p>
<p>Yesterday I <a href="https://twitter.com/b0rk/status/1478490484406468614">asked on Twitter</a> why you might
want to run your own DNS servers, and I got a lot of great answers that I
wanted to summarize here.</p>
<h3 id="you-can-run-2-types-of-dns-servers">you can run 2 types of DNS servers</h3>
<p>There are 2 main types of DNS servers you can run:</p>
<ol>
<li>if you own a domain, you can run an <strong>authoritative nameserver</strong> for that domain</li>
<li>if you have a computer (or a company with lots of computers), you can run a <strong>resolver</strong> that’s resolves DNS for those computers</li>
</ol>
<h3 id="dns-isn-t-a-static-database">DNS isn’t a static database</h3>
<p>I’ve seen the “phone book” metaphor for DNS a lot, where domain names are like
names and IP addresses are like phone numbers.</p>
<p>This is an okay mental model to start with. But the “phone book” mental model
might make you think that if you make a DNS query for <code>google.com</code>, you’ll
always get the same result. And that’s not true at all!</p>
<p>Which record you get in reply to a DNS query can depend on:</p>
<ul>
<li>where you are in the world (maybe you’ll get an IP address of a server that’s physically closer to you!)</li>
<li>if you’re on a corporate network (where you might be able to resolve internal domain names)</li>
<li>whether the domain name is considered “bad” by your DNS resolver (it might be blocked!)</li>
<li>the previous DNS query (maybe the DNS resolver is doing DNS-based load balancing to give you a different IP address every time)</li>
<li>whether you’re using an airport wifi captive portal (airport wifi will resolve DNS records differently before you log in, it’ll send you a special IP to redirect you)</li>
<li>literally anything</li>
</ul>
<p>A lot of the reasons you might want to control your own server are related to
the fact that DNS isn’t a static database – there are a lot of choices you
might want to make about how DNS queries are handled (either for your domain or for your organization).</p>
<h3 id="reasons-to-run-an-authoritative-nameserver">reasons to run an authoritative nameserver</h3>
<p>These reasons aren’t in any particular order.</p>
<p>For some of these you don’t necessarily have to run your own authoritative
nameserver, you can just choose an authoritative nameserver service that has
the features you want.</p>
<p>To be clear: there are lots of reasons <strong>not</strong> to run your own authoritative
nameserver – I don’t run my own, and I’m not trying to convince you that you
should. It takes time to maintain, your service might not be as reliable, etc.</p>
<p><strong>reason: security</strong></p>
<p><a href="https://twitter.com/thatcks/status/1478503078680838153">this tweet phrased it well</a>:</p>
<blockquote>
<p>[There’s a] risk of an attacker gaining DNS change access through your vendor’s customer
support people, who only want to be helpful. Or getting locked out from your
DNS (perhaps because of the lack of that). In-house may be easier to audit and
verify the contents.</p>
</blockquote>
<p><strong>reason: you like running bind/nsd</strong></p>
<p>One reason several people mentioned was “I’m used to writing zone files and
running <code>bind</code> or <code>nsd</code>, it’s easier for me to just do that”.</p>
<p>If you like the interface of bind/nsd but don’t want to operate your own
server, a couple of people mentioned that you can also get the advantages of
bind by running a “hidden primary” server which stores the records, but serve
all of the actual DNS queries from a “secondary” server. Here are some pages
I found about configuring secondary DNS from from <a href="https://help.ns1.com/hc/en-us/articles/360017508173-Configuring-NS1-as-a-secondary-provider-a-k-a-Creating-secondary-zones-">NS1</a> and <a href="https://blog.cloudflare.com/secondary-dns-a-faster-more-resilient-way-to-serve-your-dns-records/">cloudflare</a> and <a href="https://help.dyn.com/standard-dns/dyn-secondary-dns-information/">Dyn</a> as an example.</p>
<p>I don’t really know what the best authoritative DNS server to run is. I think
I’ve only used nsd at work.</p>
<p><strong>reason: you can use new record types</strong></p>
<p>Some newer DNS record types aren’t supported by all DNS services, but if you
run your own you can support any record types you want.</p>
<p><strong>reason: user interface</strong></p>
<p>You might not like the user interface (or API, or lack of API) of the DNS
service you’re using. This is pretty related to the “you like running BIND”
reason – maybe you like the zone file interface!</p>
<p><strong>reason: you can fix problems yourself</strong></p>
<p>There are some obvious pros and cons to being able to fix problems yourself
when they arise (pro: you can fix the problem, con: you have to fix the
problem).</p>
<p><strong>reason: do something weird and custom</strong></p>
<p>You can write a DNS server that does anything you want, it doesn’t have to just return a static set of records.</p>
<p>A few examples:</p>
<ul>
<li>Replit has a blog post about <a href="https://blog.replit.com/dns">why they wrote their own authoritative DNS server to handle routing</a></li>
<li><a href="https://nip.io">nip.io</a> maps 10.0.0.1.nip.io to 10.0.0.1</li>
<li>I wrote a custom DNS server for <a href="https://jvns.ca/blog/2021/12/15/mess-with-dns/">mess with dns</a></li>
</ul>
<p><strong>reason: to save money</strong></p>
<p>Authoritative nameservers seem to generally charge per million DNS queries. As
an example, at a quick glance it looks like Route 53 charges about $0.50 per
million queries and <a href="https://ns1.com/plans">NS1</a> charges about $8 per million queries.</p>
<p>I don’t have the best sense for how many queries a large website’s
authoritative DNS server can expect to actually need to resolve (what kinds of
sites get 1 billion DNS queries to their authoritative DNS server? Probably a
lot, but I don’t have experience with that.). But a few people in the replies
mentioned cost as a reason.</p>
<p><strong>reason: you can change your registrar</strong></p>
<p>If you use a separate authoritative nameserver for your domain instead of your
registrar’s nameserver, then when you move to a different registrar all you hvae
to do to get your DNS back up is to set your authoritative DNS server to the
right value. You don’t need to migrate all your DNS records, which is a huge
pain!</p>
<p>You don’t need to run your own nameserver to do this.</p>
<p><strong>reason: geo DNS</strong></p>
<p>You might want to return different IP addresses for your domain depending on
where the client is, to give them a server that’s close to them.</p>
<p>This is a service lots of authoritative nameserver services offer, you don’t
need to write your own to do this.</p>
<p><strong>reason: avoid denial of service attacks targeted at someone else</strong></p>
<p>Many authoritative DNS servers are shared. This means that if someone attacks
the DNS server for <code>google.com</code> or something and you happen to be using the
same authoritative DNS server, you could be affected even though the attack
wasn’t aimed at you. For example, this <a href="https://en.wikipedia.org/wiki/DDoS_attack_on_Dyn">DDoS attack on Dyn</a> in 2016.</p>
<p><strong>reason: keep all of your configuration in one place</strong></p>
<p>One person mentioned that they like to keep all of their configuration (DNS
records, let’s encrypt, nginx, etc) in the same place on one server.</p>
<p><strong>wild reason: use DNS as a VPN</strong></p>
<p>Apparently <a href="https://github.com/yarrick/iodine">iodine</a> is an authoritative DNS
server that lets you tunnel your traffic over DNS, if you’re on a network that
only allows you to contact the outside world as a VPN.</p>
<h3 id="reasons-to-run-a-resolver">reasons to run a resolver</h3>
<p><strong>reason: privacy</strong></p>
<p>If someone can see all your DNS lookups, they have a complete list of all the
domains you (or everyone from your organization) is visiting! You might prefer
to keep that private.</p>
<p><strong>reason: block malicious sites</strong></p>
<p>If you run your own resolver, you can refuse to resolve DNS queries (by just
not returning any results) for domains that you consider “bad”.</p>
<p>A few examples of resolvers that you can run yourself (or just use):</p>
<ul>
<li><a href="https://pi-hole.net/">Pi-Hole</a> blocks advertisers</li>
<li><a href="https://www.quad9.net/">Quad9</a> blocks domains that do malware/phishing/spyware. Cloudflare seems to have a <a href="https://developers.cloudflare.com/1.1.1.1/1.1.1.1-for-families">similar service</a></li>
<li>I imagine there’s also corporate security software that blocks DNS queries for domains that host malware</li>
<li>DNS isn’t a static database. It’s very dynamic, and answers often depend in
real time on the IP address a query came from, current load on content
servers etc. That’s hard to do in real time unless you delegate serving those
records to the entity making those decisions.</li>
<li>DNS delegating control makes access control very simple. Everything under a
zone cut is controlled by the person who controls the delegated server, so
responsibility for a hostname is implicit in the DNS delegation.</li>
</ul>
<p><strong>reason: get dynamic proxying in nginx</strong></p>
<p>Here’s a cool story from <a href="https://twitter.com/jordanorelli/status/1478795241876504577">this tweet</a>:</p>
<blockquote>
<p>I wrote a DNS server into an app and then set it as nginx’s resolver so that I could get dynamic backend proxying without needing nginx to run lua. Nginx sends DNS query to app, app queries redis and responds accordingly. It worked pretty great for what I was doing.</p>
</blockquote>
<p><strong>reason: avoid malicious resolvers</strong></p>
<p>Some ISPs run DNS resolvers that do bad things like nonexistent domains to an
IP they control that shows you ads or a weird search page that they control.</p>
<p>Using either a resolver you control or a different resolver that you trust
can help you avoid that.</p>
<p><strong>reason: resolve internal domains</strong></p>
<p>You might have an internal network with domains (like
<code>blah.corp.yourcompany.com</code>) that aren’t on the public internet. Running your
own resolver for machines in the internal network makes it possible to access
those domains.</p>
<p>You can do the same thing on a home network, either to access local-only
services or to just get local addresses for services that are on the public
internet.</p>
<p><strong>reason: avoid your DNS queries being MITM’d</strong></p>
<p>One person <a href="https://twitter.com/passcod/status/1478806468539269120">said</a>:</p>
<blockquote>
<p>I run a resolver on my LAN router that uses DNS over HTTPS for its upstream, so
IoT and other devices that don’t support DoH or DoT don’t spray plaintext DNS
outside</p>
</blockquote>
<h3 id="that-s-all-for-now">that’s all for now</h3>
<p>It feels important to me to explore the “why” of DNS, because it’s such a
complicated messy system and I think most people find it hard to get motivated
to learn about complex topics if they don’t understand why all this complexity
is useful.</p>
<p><small>
Thanks to Marie and Kamal for discussing this post, and to everyone on Twitter
who provided reasons
</small></p>
</div></div>
  </body>
</html>
