<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://b3n.org/automatic-ripping-machine/">Original</a>
    <h1>Automatic Ripping Machine (2016)</h1>
    
    <div id="readability-page-1" class="page"><article id="post-1877"><div><p>The A.R.M. (Automatic Ripping Machine) detects the insertion of an optical disc, identifies the type of media and autonomously performs the appropriate action:</p><ul><li>DVD / Blu-ray -&gt; Rip with MakeMKV and Transcode with Handbrake</li><li>Audio CD -&gt; Rip and Encode to FLAC and Tag the files if possible.</li><li>Data Disc -&gt; Make an ISO backup</li></ul><p>It runs on Linux, it’s completely headless and fully automatic requiring no interaction or manual input to complete it’s tasks (other than inserting the disk).  Once it completes a rip it ejects the disc for you and you can pop in another one.</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDUgNTkxIiB3aWR0aD0iNjQ1IiBoZWlnaHQ9IjU5MSIgZGF0YS11PSJodHRwcyUzQSUyRiUyRmIzbi5vcmclMkZ3cC1jb250ZW50JTJGdXBsb2FkcyUyRjIwMTYlMkYwNyUyRmFybV9mbG93Y2hhcnRfMi5wbmciIGRhdGEtdz0iNjQ1IiBkYXRhLWg9IjU5MSIgZGF0YS1iaXA9IiI+PC9zdmc+" data-spai="1" alt="Flowchart of Ripping Process" width="645" height="591"/></p><h2>Automatic Ripping Machine Features</h2><ul><li>Determines if disc is Video, Data, or Audio<ul><li>If video get the Title</li><li>Determine if it’s a TV or Movie</li><li>Rip using MakeMKV</li><li>Send rip to Handbrake and eject disc asynchronously</li><li>When done transcoding tell Emby to rescan library, or send notifications using PushBullet or IFTT</li></ul></li><li>If audio CD – rip to mp3 or flac using abcde and eject</li><li>If data disc make an ISO backup</li><li>Can rip from multiple optical drives simultaneously</li><li>Completely headless design–no graphical interface.  The only interaction is inserting the disc and it takes it from there, ejecting it when done.</li><li>Can send push notifications to your phone using Pushbullet or IFTT.</li></ul><h2>Free Software</h2><p>I uploaded the scripts to <a href="https://github.com/ahnooie/automatic-ripping-machine">GitHub</a> under the MIT license.  Since then quite a few contributors have made many improvements.  Now the ARM has been rewritten in Python and has a number of options to customize the way different people handle media.</p><p>Instructions to get it installed on Ubuntu 16.04 or 18.04 LTS follows.</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3MTcgOTExIiB3aWR0aD0iNzE3IiBoZWlnaHQ9IjkxMSIgZGF0YS11PSJodHRwcyUzQSUyRiUyRmIzbi5vcmclMkZ3cC1jb250ZW50JTJGdXBsb2FkcyUyRjIwMTYlMkYwNyUyRmFybS0xLnBuZyIgZGF0YS13PSI3MTciIGRhdGEtaD0iOTExIiBkYXRhLWJpcD0iIj48L3N2Zz4=" data-spai="1" alt="Automatic Ripping Machine (Supermicro MicroServer) under my desk" width="404" height="513"/></p><h2>ARM Equipment &amp; Hardware</h2><h3>Blu-Ray Hardware and VMware Settings</h3><h3>A WARNING ABOUT SOME BLU-RAY DRIVES</h3><p>Most Blu-Ray drives have an anti-feature called “riplock” where it will purposefully cripple the read-speed on dvds and blue-rays to around 2X to 4X instead of the advertised drive speed (I believe this to be false advertising).  If you have a normal 5 1/4″ drive bay I suggest getting the LG <a href="https://www.amazon.com/gp/product/B00E7B08MS/ref=as_li_qf_asin_il_tl?ie=UTF8&amp;tag=b3norg-20&amp;creative=9325&amp;linkCode=as2&amp;creativeASIN=B00E7B08MS&amp;linkId=dc72c4659d4ca9905cc1c4e997dd55b7">WH16NS40 16X blu-ray drive</a> since it is known to not be speed limited.  LG seems to be one of the better drive manufacturers in my experience.</p><p>You will need a server.  You can use Ubuntu on bare metal or run it under VMware.   I am using my <a href="https://b3n.org/supermicro-x10sdv-f-build-datacenter-in-a-box/">Datacenter in a Box Build</a> and run the ARM on Ubuntu Linux 16.04 LTS under VMware.  At first I tried using an external USB Blu-Ray drive but the VM didn’t seem to be able to get direct access to it.  Unfortunately my server case only has a slim-DVD slot on it so I’m using an LG BT30N (these can be found on eBay).</p><p>I wasn’t sure if VMware would recognize the Blu-Ray functions on the drive but it does!  Once physically installed edit the VM properties so that it uses the host device as the CD/DVD drive and then select the optical drive.</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2MTQgNDYxIiB3aWR0aD0iNjE0IiBoZWlnaHQ9IjQ2MSIgZGF0YS11PSJodHRwcyUzQSUyRiUyRmIzbi5vcmclMkZ3cC1jb250ZW50JTJGdXBsb2FkcyUyRjIwMTYlMkYwNyUyRnZtd2FyZV9ibHVyYXlfZHJpdmUucG5nIiBkYXRhLXc9IjYxNCIgZGF0YS1oPSI0NjEiIGRhdGEtYmlwPSIiPjwvc3ZnPg==" data-spai="1" alt="VMware Machine Properties, select CD/DVD drive, set Device Type to Host Device and select the optical drive." width="614" height="461"/></p><h3>Regions…</h3><p>I kept getting this error while trying to rip a movie:</p><blockquote><p>MSG:3031,0,1,”Drive BD-ROM NECVMWar VMware IDE CDR10 1.00 has RPC protection that can not be bypassed. Change drive region or update drive firmware from http://tdb.rpc1.org. Errors likely to follow.”,”Drive %1 has RPC protection that can not be bypassed. Change drive region or update drive firmware from http://tdb.rpc1.org. Errors likely to follow.”,”BD-ROM NECVMWar VMware IDE CDR10 1.00″</p></blockquote><p><a href="https://www.defectivebydesign.org/"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNDAgODYiIHdpZHRoPSIyNDAiIGhlaWdodD0iODYiIGRhdGEtdT0iaHR0cHMlM0ElMkYlMkZiM24ub3JnJTJGd3AtY29udGVudCUyRnVwbG9hZHMlMkYyMDE2JTJGMDclMkZkYmRfY29sb3JfbG9nb190cmltLnNtYWxsXy5wbmciIGRhdGEtdz0iMjQwIiBkYXRhLWg9Ijg2IiBkYXRhLWJpcD0iIj48L3N2Zz4=" data-spai="1" alt="Defective By Design Logo" width="240" height="86"/></a></p><p>After doing a little research I found out DVD and Blu-Ray players have region codes that only allow them to play movies in the region they were intended–by default the Panosonic drive shipped with a region code set to 0.</p><figure id="attachment_1881" aria-describedby="caption-attachment-1881"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMzUwIDYyNSIgd2lkdGg9IjEzNTAiIGhlaWdodD0iNjI1IiBkYXRhLXU9Imh0dHBzJTNBJTJGJTJGYjNuLm9yZyUyRndwLWNvbnRlbnQlMkZ1cGxvYWRzJTJGMjAxNiUyRjA3JTJGRFZELVJlZ2lvbnNfd2l0aF9rZXkucG5nIiBkYXRhLXc9IjEzNTAiIGRhdGEtaD0iNjI1IiBkYXRhLWJpcD0iIj48L3N2Zz4=" data-spai="1" alt="World Map with DVD Region Codes" width="300" height="139"/><figcaption id="caption-attachment-1881">CC BY-SA 3.0 from https://en.wikipedia.org/wiki/DVD_region_code#/media/File:DVD-Regions_with_key-2.svg</figcaption></figure><p>Notice that North America is not 0.</p><p>Looking at <a href="http://tdb.rpc1.org/">http://tdb.rpc1.org/</a> it looks like it is possible to flash some drives so that they can play videos in all region codes.  Fortunately before I got too far down the flash the drive path I discovered you can simply change the region code!  Since I’m only playing North American movies I set the region code to 1 using:</p><pre>sudo apt-get install regionset
sudo regionset /dev/sr0</pre><p>You can only change this setting 4 or 5 times then it gets stuck so if you’re apt to watch movies from multiple regions you’ll want to look at getting a drive that you can flash the firmware.</p><h3>Install MakeMKV, Handbrake, ABCDE and At</h3><p>Please follow the instructions in the README.md file in the <a href="https://github.com/automatic-ripping-machine/automatic-ripping-machine">GitHub repository</a>.</p><h3>Mount Samba/CIFS Media Share</h3><p>If you’re ripping to the local machine skip this section, if you’re ripping to a NAS like I am do something like this…</p><p>In FreeNAS I created a media folder on my data share at \zfs\data\media</p><pre>sudo apt-get install cifs-utils</pre><p>Edit /etc/fstab</p><pre>\\zfs\data\media /mnt/media cifs rw,user,auto,suid,username=your_cifs_username,password=your_cifs_password 0 0</pre><p>Once that’s in the file mount the folder and create an ARM and an ARM/raw folder.</p><pre>sudo mkdir /mnt/media
sudo mount /mnt/media
sudo mkdir -p /mnt/media/ARM/raw</pre><h3>Configure ARM Settings</h3><pre></pre><p>You should look over the config file to make sure it suits your needs, if you want to add Android or iOS push notifications, trans-coding options, subtitle options, etc. that’s where to do it.</p><p><span>Figure out how to restart udev, or reboot the VM (make sure your media folder gets mounted on reboot).  You should be set.</span></p><h2>Automatic Ripping Machine Usage</h2><ol><li>Insert Disc.</li><li>Wait until the A.R.M. ejects the disc.</li><li>Repeat</li></ol><p>Test out a movie, audio cd, and data cd and make sure it’s working as expected.  Check the logs. If you run into trouble feel free to <a href="https://github.com/ahnooie/automatic-ripping-machine/issues">post an issue here</a>.</p><h2>Install MakeMKV License</h2><p>MakeMKV will run on a trial basis for 30 days.  Once it expires you’ll need to purchase a key or while it’s in BETA you can get a free key…  I would love to build this solution on 100% free open source software but MakeMKV saves so much time and is more reliable compared to anything else I’ve tried.  I ended up purchasing a license key for myself.</p><p>Grab the latest license key from: <a href="http://www.makemkv.com/forum2/viewtopic.php?f=5&amp;t=1053">http://www.makemkv.com/forum2/viewtopic.php?f=5&amp;t=1053</a></p><p>Edit the /root/.MakeMKV/settings.conf  and add a line:</p><pre>app_Key = &#34;whatever_the_latest_key_is&#34;</pre><h2>Get an OMDB API Key</h2><p>Next you’ll want to get an OMDB API key and put it in your ARM config file.  A free key will let you do 1,000 API queries a day which should be more than enough: <a href="https://www.omdbapi.com/apikey.aspx">http://www.omdbapi.com/apikey.aspx</a></p><h2>How it Works?</h2><p>When UDEV/systemd detects a disc insert as defined by /lib/udev/rules.d/51-automedia.rules it runs the wrapper which in turn runs /opt/arm/identify.sh which identifies the type of media inserted and then calls the appropriate scripts.  (if you ever need it this is a great command get get info on a disk):</p><pre>udevadm info -q env -n /dev/sr0</pre><h3>Video Discs (Blu-Ray/DVD)</h3><p>For video discs the first step is ARM tries to obtain the disc title.   If it’s a blu-ray it can often be extracted from the disc, if it’s a DVD we calculate a hash of the DVD and then query Windows Media Metaservice (which is what Windows Media Player queries when a disc is inserted) to get the title.</p><p>Once the title is obtained we send that to the OMDB API which will tell us whether the video is a Movie, or a TV Show.  If the video is a Movie ARM can usually determine the main title feature, and rip that.  And optionally rip all the other titles into an Extras folder.  Once done ARM can automatically tell Emby to rescan the library.  If the video is a TV Show ARM will rip all the titles and you’ll need to use Filebot to rename the shows.</p><p>All tracks get ripped using MakeMKV and placed in the /mnt/media/ARM/raw folder as soon as ripping is complete the disk ejects and transcoding starts with HandBrakeCli transcoding every track into /mnt/media/ARM/timestamp_discname.  You don’t have to wait for transcoding to complete, you can immediately insert the next disk to get it started.</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMTAxIDYzMCIgd2lkdGg9IjExMDEiIGhlaWdodD0iNjMwIiBkYXRhLXU9Imh0dHBzJTNBJTJGJTJGYjNuLm9yZyUyRndwLWNvbnRlbnQlMkZ1cGxvYWRzJTJGMjAxNiUyRjA3JTJGZmlsZWJvdF9zY3JlZW5zaG90LnBuZyIgZGF0YS13PSIxMTAxIiBkYXRhLWg9IjYzMCIgZGF0YS1iaXA9IiI+PC9zdmc+" data-spai="1" alt="FileBot Screenshot Selecting files for rename" width="840" height="481"/></p><p>Most of the time everything just works, but in some cases if ARM can’t determine the title some video file renaming needs to be done by hand.  The ARM will name the folder using the disc title, but this isn’t always accurate.  For a Season of TV shows I’ll name them using <a href="http://www.filebot.net/">FileBot</a> and then move them to one of the Movie or TV folders that my <a href="http://emby.media/">Emby Server</a> looks at.  Fortunately this manual part of the process can be done at any time, it won’t hold up ripping more media.  The Emby Server then downloads artwork and metadata for the videos.</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA4ODkgODAzIiB3aWR0aD0iODg5IiBoZWlnaHQ9IjgwMyIgZGF0YS11PSJodHRwcyUzQSUyRiUyRmIzbi5vcmclMkZ3cC1jb250ZW50JTJGdXBsb2FkcyUyRjIwMTYlMkYwNyUyRmVtYnlfa2lkc19tb3ZpZXMucG5nIiBkYXRhLXc9Ijg4OSIgZGF0YS1oPSI4MDMiIGRhdGEtYmlwPSIiPjwvc3ZnPg==" data-spai="1" alt="Screenshot of Emby&#39;s Movies Page" width="549" height="496"/></p><h3>Audio CDs</h3><p>If an audio track is detected it is ripped to a FLAC file (or mp3 or whatever you want) using the <a href="https://abcde.einval.com/wiki/">abcde</a> ripper.  I opted for the FLAC format because it’s lossless, well supported, and is un-proprietary.  If you’d prefer a different format ABCDE can be configured to rip to MP3, AAC, OGG, whatever you want.  I have it dropping the audio files in the same location as the video files but I could probably just move it directly to the music folder where Emby is looking.</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NjAgNTQ1IiB3aWR0aD0iNjYwIiBoZWlnaHQ9IjU0NSIgZGF0YS11PSJodHRwcyUzQSUyRiUyRmIzbi5vcmclMkZ3cC1jb250ZW50JTJGdXBsb2FkcyUyRjIwMTYlMkYwNyUyRmVtYnlfYmVldGhvdmVuc19sYXN0X25pZ2h0LnBuZyIgZGF0YS13PSI2NjAiIGRhdGEtaD0iNTQ1IiBkYXRhLWJpcD0iIj48L3N2Zz4=" data-spai="1" alt="emby_beethovens_last_night" width="300" height="248"/></p><h3>Data Disks (Software, Pictures, etc.)</h3><p>If ARM determines there is no video on the disc, then a simple script is run to make a backup ISO image of the disc.</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MDEgMTI2IiB3aWR0aD0iNTAxIiBoZWlnaHQ9IjEyNiIgZGF0YS11PSJodHRwcyUzQSUyRiUyRmIzbi5vcmclMkZ3cC1jb250ZW50JTJGdXBsb2FkcyUyRjIwMTYlMkYwNyUyRnR1cmJvdGF4X2RhdGFfcmlwLnBuZyIgZGF0YS13PSI1MDEiIGRhdGEtaD0iMTI2IiBkYXRhLWJpcD0iIj48L3N2Zz4=" data-spai="1" alt="Screenshot of TurboTax ISO file" width="501" height="126"/></p><h2>What about the stuff that fails?</h2><p>So, I built the ARM with the 80/20 rule in mind.  My goal was it to automate 90% of my rips.  There are always oddball discs that don’t quite work right or need to be handled manually.  Here’s a good article with a <a href="https://thesweetbits.com/best-dvd-ripper-software/">comparison of ripping software by the TheSweetBits </a>that will do that job.</p><h2>Morality of Ripping</h2><h3>Two Evils: Piracy vs. DRM</h3><p>I am for neither Piracy or DRM.  Where I stand morally is I make sure we own every CD, DVD, and Blu-Ray that we rip using the ARM.</p><p>I don’t advocate piracy.  It is immoral for people to make copies of movies and audio they don’t own.  On the other hand there is a difference between Piracy and copying for fair use  which publisher’s often wrongly lump together.</p><p>What really frustrates me is DRM.  It’s waste of time.  I shouldn’t have to mess with region codes, and have to use software like MakeMKV to decrypt a movie that I bought! And unfortunately the copy-protection methods in place <a href="https://i.imgur.com/dXiNAhu.jpg">do nothing to stop piracy and everything to hinder legitimate customers</a>.</p><p>For me it doesn’t really even matter because I don’t really like watching movies anyway–there’s not much more painful than sitting for an hour to get through a movie.  I just like making automatic ripping machines.</p><p>Well, hope you enjoy the ARM.</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3OTkgNDk4IiB3aWR0aD0iNzk5IiBoZWlnaHQ9IjQ5OCIgZGF0YS11PSJodHRwcyUzQSUyRiUyRmIzbi5vcmclMkZ3cC1jb250ZW50JTJGdXBsb2FkcyUyRjIwMTYlMkYwNyUyRmFybV93YXJnYW1lcy1lMTQ2OTUxNjUxMjMzOC5wbmciIGRhdGEtdz0iNzk5IiBkYXRhLWg9IjQ5OCIgZGF0YS1iaXA9IiI+PC9zdmc+" data-spai="1" alt="War Games DVD in Tray" width="799" height="498"/></p>  </div></article></div>
  </body>
</html>
