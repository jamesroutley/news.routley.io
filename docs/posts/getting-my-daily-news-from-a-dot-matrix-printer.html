<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://aschmelyun.com/blog/getting-my-daily-news-from-a-dot-matrix-printer/">Original</a>
    <h1>Getting my daily news from a dot matrix printer</h1>
    
    <div id="readability-page-1" class="page"><div>
        <div>
            <p>For a while now I&#39;ve started my day by unlocking my phone and scrolling through different news and social media sites to see what&#39;s going on. It&#39;s not exactly <em>great</em> for my mental health and I&#39;ve been trying to cut down on screen time for a while. I still want to stay up-to-date though, especially after I get up in the morning.</p>
<p>I recently purchased a dot matrix printer from eBay, and thought it would be a great excuse to have a custom &#34;front page&#34; printed out and ready for me each day. So, that&#39;s what I built!</p>
<p>Printer ASMR noises in the video below ðŸ‘‡</p>
<video width="270" height="360" controls="" title="Dotmatrix Printing Example">
  <source src="/storage/images/blog/dotmatrix_example_2_bt709.mp4" type="video/mp4"/>
</video>
<p>I&#39;ll take this article to dive in and show you what I used, how I set it up, and the <strong>PHP script</strong> that powers it all.</p>
<blockquote>
<p>Interested in that full source code? Check it out on the <a href="https://github.com/aschmelyun/dotmatrix-daily-news">GitHub repo</a>!</p>
</blockquote>
<h2>Purchasing the hardware</h2>
<p>The supply list for this project was pretty small, and with the exception of the printer, most of this can be found on Amazon or other online retailers.</p>
<ul>
<li>Dot matrix printer</li>
<li>Raspberry Pi Zero W [<a href="https://vilros.com/products/raspberry-pi-zero-w-basic-starter-kit-1">link</a>]</li>
<li>Serial to USB adapter [<a href="https://www.amazon.com/dp/B00IDU0T1Y?ref=ppx_yo2ov_dt_b_fed_asin_title&amp;th=1">link</a>]</li>
<li>Power supply</li>
</ul>
<p>The printer I purchased was a <a href="https://www.computerhistory.org/collections/catalog/102666267">Star NP-10</a> from what looks like the mid-80&#39;s. I can&#39;t be 100% sure, but any dot matrix printer with a serial port should do the trick. The prices range from about $80-120 USD, but I was able to get this one for about half that price because it was marked as &#34;unsure if working&#34;.</p>
<p>It did need a little cleaning up and some tuning of the ink ribbon cartridge (isn&#39;t that cool, it&#39;s like a typewriter!), but after that it fired right up and ran through the test page print.</p>
<p>After that, I hooked everything up. The Raspberry Pi is connected to my WiFi, and then via USB to the serial port of the printer. After turning on the printer and <code>ssh</code>ing into the Pi, I can verify that the printer is available at <code>/dev/usb/lp0</code>.</p>
<p>Now, <strong>how do I get this thing to print?</strong></p>
<h2>Figuring out the printer&#39;s code</h2>
<p>Because the printer is available at <code>lp0</code> I wanted to see if I could just echo raw text to it and have it come through the printer. So I ran the following:</p>
<pre><code data-theme="material-theme-palenight" data-lang="bash"><!-- Syntax highlighted by torchlight.dev --><p><span>echo</span><span> </span><span>&#34;</span><span>Hello, world!</span><span>&#34;</span><span> </span><span>&gt;</span><span> </span><span>/dev/usb/lp0</span></p></code></pre>
<p>Which resulted in an error that the file couldn&#39;t be accessed. Bummer, a permissions issue. Easily fixed though with some <code>chmod</code>&#39;ing:</p>
<pre><code data-theme="material-theme-palenight" data-lang="bash"><!-- Syntax highlighted by torchlight.dev --><p><span>sudo</span><span> </span><span>chmod</span><span> </span><span>666</span><span> </span><span>/dev/usb/lp0</span></p></code></pre>
<p>There might be a better way to handle that, but it allowed my echo to go through, and I saw the text available on the printer! Alright, I can send raw data to the printer via this file, so let&#39;s find a way to scale this up.</p>
<p>I use PHP as my language of choice in a day-to-day basis, and this is no exception. I write a basic script that accesses the file through <code>fopen()</code> and starts writing text to it. I try a few sentences, some spacing, and then some unicode art, but quickly find out that there&#39;s not as much character support on the printer as I was sending.</p>
<p><img src="https://bytes.zone/storage/images/blog/dotmatrix-encoding-errors.jpg" alt="Picture of a printed sheet showing a bunch of wrongly-encoded characters"/></p>
<p>So I thought it was about time that I start digging into how this thing <em>actually works</em>. Thanks to the hard work and dedication of internet hoarders, I found a <a href="https://www.minuszerodegrees.net/manuals/Star%20Micronics/dot_matrix/Star%20Micronics%20-%20NP-10%20-%20Users%20Manual.pdf">full manual for the printer</a> scanned and uploaded as a PDF.</p>
<p>Come to find out, either because of the age or just the manufacturing decision, this printer has a <strong>very specific character set</strong> that it accepts. Loosely based off of the IBM PC&#39;s <a href="https://en.wikipedia.org/wiki/Code_page_437">Code Page 437</a> it consists mostly of your standard alpha-numeric characters, but with a small set of special symbols, lines, and boxes. Neat!</p>
<p>Sending these characters to the printer is pretty straightforward, I can just echo out the hex values with PHP like so:</p>
<pre><code data-theme="material-theme-palenight" data-lang="php"><!-- Syntax highlighted by torchlight.dev --><p><span>$</span><span>horizontalDouble </span><span>=</span><span> </span><span>&#34;</span><span>\xCD</span><span>&#34;</span><span>;</span></p><p><span>$</span><span>deg </span><span>=</span><span> </span><span>&#34;</span><span>\xF8</span><span>&#34;</span><span>;</span></p><p><span>echo</span><span> </span><span>str_repeat</span><span>($</span><span>horizontalDouble</span><span>,</span><span> </span><span>24</span><span>);</span></p><p><span>echo</span><span> </span><span>&#39;</span><span>78</span><span>&#39;</span><span> </span><span>.</span><span> </span><span>$</span><span>deg </span><span>.</span><span> </span><span>&#39;</span><span>F</span><span>&#39;</span><span> </span><span>.</span><span> PHP_EOL</span><span>;</span></p></code></pre>
<p>Alright, so I&#39;m able to write text to the printer just fine, and include some special characters and design symbols. Now I need to figure out <em>what</em> I want to see every morning.</p>
<h2>Gathering the data</h2>
<p>I knew I wanted four distinct sections for my personal front page: <strong>weather, stocks, major news headlines, and a few top reddit posts</strong>. After all, that&#39;s usually what I end up look at on my phone in the morning.</p>
<p>Additionally, since this is an experimental project, I wanted to remain super cheap for this data, free if at all possible. Thankfully there&#39;s an amazing <a href="https://github.com/public-apis/public-apis">GitHub repo</a> for free and public APIs, so I just went through there and found the ones I needed.</p>
<ul>
<li>The weather pulls from <a href="https://open-meteo.com/en/docs">Open-Meteo</a> and no API key is needed</li>
<li>Stocks data pulls from <a href="https://twelvedata.com/docs">twelvedata</a> that offers a generous free tier</li>
<li>News headlines pull from <a href="https://developer.nytimes.com/get-started">NYTimes</a> which has a decent free tier, good enough for this project</li>
<li>Reddit posts pull from <a href="https://www.reddit.com/r/redditdev/comments/rvqirc/how_to_get_reddit_api_data_using_json/">Reddit JSON</a> which is free (but I had to spoof my User-Agent)</li>
</ul>
<p>For each of the sections, I wrote some basic PHP code to pull in the payload from the API endpoint and compile the data I wanted into a larger overall array. I only wanted specific stocks, types of headlines, and subreddit posts, and if any of the sections couldn&#39;t have data to present I just simply crash the script early so I can start it again at a later time.</p>
<p>This can be seen in this snippet which I use for pulling news headlines:</p>
<pre><code data-theme="material-theme-palenight" data-lang="php"><!-- Syntax highlighted by torchlight.dev --><p><span>// Get news headlines data</span></p><p><span>echo</span><span> </span><span>&#34;</span><span>Fetching news headlines data...</span><span>&#34;</span><span> </span><span>.</span><span> PHP_EOL</span><span>;</span></p><p><span>$</span><span>newsUrl </span><span>=</span><span> NEWS </span><span>.</span><span> </span><span>&#34;</span><span>?api-key=</span><span>&#34;</span><span> </span><span>.</span><span> NEWSKEY</span><span>;</span></p><p><span>$</span><span>newsData </span><span>=</span><span> </span><span>[];</span></p><p><span>$</span><span>newsAmount </span><span>=</span><span> </span><span>0</span><span>;</span></p><p><span>$</span><span>data </span><span>=</span><span> </span><span>json_decode</span><span>(</span><span>file_get_contents</span><span>($</span><span>newsUrl</span><span>),</span><span> </span><span>true);</span></p><p><span>if</span><span> </span><span>(!</span><span>isset</span><span>($</span><span>data</span><span>[</span><span>&#39;</span><span>results</span><span>&#39;</span><span>]))</span><span> </span><span>{</span></p><p><span>    </span><span>die</span><span>(</span><span>&#34;</span><span>Unable to retrieve news data</span><span>&#34;</span><span>);</span></p><p><span>}</span></p><p><span>foreach</span><span> </span><span>($</span><span>data</span><span>[</span><span>&#39;</span><span>results</span><span>&#39;</span><span>]</span><span> </span><span>as</span><span> </span><span>$</span><span>article</span><span>)</span><span> </span><span>{</span></p><p><span>    </span><span>if</span><span> </span><span>(</span></p><p><span>        </span><span>($</span><span>article</span><span>[</span><span>&#39;</span><span>type</span><span>&#39;</span><span>]</span><span> </span><span>===</span><span> </span><span>&#39;</span><span>Article</span><span>&#39;</span><span>)</span><span> </span><span>&amp;&amp;</span></p><p><span>        </span><span>(</span><span>in_array</span><span>($</span><span>article</span><span>[</span><span>&#39;</span><span>section</span><span>&#39;</span><span>],</span><span> </span><span>[</span><span>&#39;</span><span>U.S.</span><span>&#39;</span><span>,</span><span> </span><span>&#39;</span><span>World</span><span>&#39;</span><span>,</span><span> </span><span>&#39;</span><span>Weather</span><span>&#39;</span><span>,</span><span> </span><span>&#39;</span><span>Arts</span><span>&#39;</span><span>]))</span><span> </span><span>&amp;&amp;</span></p><p><span>        </span><span>($</span><span>newsAmount </span><span>&lt;</span><span> MAXNEWS</span><span>)</span></p><p><span>    </span><span>)</span><span> </span><span>{</span></p><p><span>        </span><span>$</span><span>newsData</span><span>[]</span><span> </span><span>=</span><span> </span><span>$</span><span>article</span><span>;</span></p><p><span>        </span><span>$</span><span>newsAmount</span><span>++;</span></p><p><span>    </span><span>}</span></p><p><span>}</span></p></code></pre>
<p>The <code>NEWS</code>, <code>NEWSKEY</code>, and <code>MAXNEWS</code> variables are all constants instantiated at the top of the script for easy editing.</p>
<p>Running this compiles everything I want to see displayed on the paper, but now I need to take on the actual task of formatting everything for the printer, and sending it the raw data.</p>
<h2>Printing out my front page</h2>
<p>I could just print out a heading for each section, but that&#39;s a little boring. I wanted a bit of <strong><em>flair</em></strong> to the project, so I decided to have a box at the top displaying the current date, day of the week, and my front page name all nicely bordered.</p>
<p>It took a little math, but I got everything working by using a combination of the hex values I talked about above, <code>str_repeat</code> and the knowledge that the page width for this printer is <strong>80 characters</strong>.</p>
<p>Now, just simply go through each section, print a little heading:</p>
<pre><code data-theme="material-theme-palenight" data-lang="php"><!-- Syntax highlighted by torchlight.dev --><p><span>str_repeat</span><span>($</span><span>horizontalSingle</span><span>,</span><span> </span><span>3</span><span>)</span><span> </span><span>.</span><span> </span><span>&#34;</span><span> WEATHER </span><span>&#34;</span><span> </span><span>.</span><span> </span><span>str_repeat</span><span>($</span><span>horizontalSingle</span><span>,</span><span> </span><span>(</span><span>PAGEWIDTH </span><span>-</span><span> </span><span>9</span><span>))</span><span> </span><span>.</span><span> </span><span>&#34;</span><span>\n</span><span>&#34;</span><span>;</span></p></code></pre>
<p>And then print out the data that I want displayed for that section:</p>
<pre><code data-theme="material-theme-palenight" data-lang="php"><!-- Syntax highlighted by torchlight.dev --><p><span>&#34;</span><span>   </span><span>&#34;</span><span> </span><span>.</span><span> </span><span>round</span><span>(($</span><span>weatherData</span><span>[</span><span>&#39;</span><span>daily</span><span>&#39;</span><span>][</span><span>&#39;</span><span>daylight_duration</span><span>&#39;</span><span>][</span><span>0</span><span>]</span><span> </span><span>/</span><span> </span><span>3600</span><span>),</span><span> </span><span>2</span><span>)</span><span> </span><span>.</span><span> </span><span>&#34;</span><span>h of Sunlight  -  Sunrise: </span><span>&#34;</span><span> </span><span>.</span><span> </span><span>date</span><span>(</span><span>&#39;</span><span>g:ia</span><span>&#39;</span><span>,</span><span> </span><span>strtotime</span><span>($</span><span>weatherData</span><span>[</span><span>&#39;</span><span>daily</span><span>&#39;</span><span>][</span><span>&#39;</span><span>sunrise</span><span>&#39;</span><span>][</span><span>0</span><span>]))</span><span> </span><span>.</span><span> </span><span>&#34;</span><span>  -  Sunset: </span><span>&#34;</span><span> </span><span>.</span><span> </span><span>date</span><span>(</span><span>&#39;</span><span>g:ia</span><span>&#39;</span><span>,</span><span> </span><span>strtotime</span><span>($</span><span>weatherData</span><span>[</span><span>&#39;</span><span>daily</span><span>&#39;</span><span>][</span><span>&#39;</span><span>sunset</span><span>&#39;</span><span>][</span><span>0</span><span>]))</span><span> </span><span>.</span><span> </span><span>&#34;</span><span>\n</span><span>&#34;</span><span>;</span></p></code></pre>
<p>For the weather and stocks, I knew I wouldn&#39;t hit the edge of the paper so I just wrote everything in single long lines. But that&#39;s different for the news headlines and Reddit posts.</p>
<p>If I just feed the printer one long line of text, it&#39;s smart enough to cut it and start printing on another line. But, I didn&#39;t want a word getting cut off in the middle and starting on the next line. So I implemented a small function to handle line length and instead return back an array of lines with a max length corresponding to the page width.</p>
<pre><code data-theme="material-theme-palenight" data-lang="php"><!-- Syntax highlighted by torchlight.dev --><p><span>function</span><span> </span><span>splitString</span><span>($</span><span>string</span><span>,</span><span> </span><span>$</span><span>maxLength </span><span>=</span><span> PAGEWIDTH</span><span>)</span><span> </span><span>{</span></p><p><span>    </span><span>$</span><span>result </span><span>=</span><span> </span><span>[];</span></p><p><span>    </span><span>$</span><span>words </span><span>=</span><span> </span><span>explode</span><span>(</span><span>&#39;</span><span> </span><span>&#39;</span><span>,</span><span> </span><span>$</span><span>string</span><span>);</span></p><p><span>    </span><span>$</span><span>currentLine </span><span>=</span><span> </span><span>&#39;&#39;</span><span>;</span></p><p><span>    </span><span>foreach</span><span> </span><span>($</span><span>words </span><span>as</span><span> </span><span>$</span><span>word</span><span>)</span><span> </span><span>{</span></p><p><span>        </span><span>if</span><span> </span><span>(</span><span>strlen</span><span>($</span><span>currentLine </span><span>.</span><span> </span><span>$</span><span>word</span><span>)</span><span> </span><span>&lt;=</span><span> </span><span>$</span><span>maxLength</span><span>)</span><span> </span><span>{</span></p><p><span>            </span><span>$</span><span>currentLine </span><span>.=</span><span> </span><span>($</span><span>currentLine </span><span>?</span><span> </span><span>&#39;</span><span> </span><span>&#39;</span><span> </span><span>:</span><span> </span><span>&#39;&#39;</span><span>)</span><span> </span><span>.</span><span> </span><span>$</span><span>word</span><span>;</span></p><p><span>        </span><span>}</span><span> </span><span>else</span><span> </span><span>{</span></p><p><span>            </span><span>if</span><span> </span><span>($</span><span>currentLine</span><span>)</span><span> </span><span>{</span></p><p><span>                </span><span>$</span><span>result</span><span>[]</span><span> </span><span>=</span><span> </span><span>$</span><span>currentLine</span><span>;</span></p><p><span>                </span><span>$</span><span>currentLine </span><span>=</span><span> </span><span>$</span><span>word</span><span>;</span></p><p><span>            </span><span>}</span><span> </span><span>else</span><span> </span><span>{</span></p><p><span>                </span><span>// If a single word is longer than maxLength, split it</span></p><p><span>                </span><span>$</span><span>result</span><span>[]</span><span> </span><span>=</span><span> </span><span>substr</span><span>($</span><span>word</span><span>,</span><span> </span><span>0</span><span>,</span><span> </span><span>$</span><span>maxLength</span><span>);</span></p><p><span>                </span><span>$</span><span>currentLine </span><span>=</span><span> </span><span>substr</span><span>($</span><span>word</span><span>,</span><span> </span><span>$</span><span>maxLength</span><span>);</span></p><p><span>            </span><span>}</span></p><p><span>        </span><span>}</span></p><p><span>    </span><span>}</span></p><p><span>    </span><span>if</span><span> </span><span>($</span><span>currentLine</span><span>)</span><span> </span><span>{</span></p><p><span>        </span><span>$</span><span>result</span><span>[]</span><span> </span><span>=</span><span> </span><span>$</span><span>currentLine</span><span>;</span></p><p><span>    </span><span>}</span></p><p><span>    </span><span>return</span><span> </span><span>$</span><span>result</span><span>;</span></p><p><span>}</span></p></code></pre>
<p>Then I can just use it like so:</p>
<pre><code data-theme="material-theme-palenight" data-lang="php"><!-- Syntax highlighted by torchlight.dev --><p><span>foreach</span><span> </span><span>(</span><span>splitString</span><span>($</span><span>redditPost</span><span>)</span><span> </span><span>as</span><span> </span><span>$</span><span>line</span><span>)</span><span> </span><span>{</span></p><p><span>    </span><span>fwrite</span><span>($</span><span>printer</span><span>,</span><span> </span><span>$</span><span>line</span><span>)</span><span> </span><span>.</span><span> </span><span>&#34;</span><span>\n</span><span>&#34;</span><span>;</span></p><p><span>}</span></p></code></pre>
<p>Now all that&#39;s left to do is run the script!</p>
<h2>Usage and wrapping up</h2>
<p>I can fire off the printer manually by just running <code>php print.php</code> but I&#39;ve instead set up a cron job to handle it for me.</p>
<p>Every morning at around 8am it starts printing out my personalized front page. I rip it off and check it out in the morning while drinking my coffee.</p>
<p><img src="https://bytes.zone/storage/images/blog/dotmatrix-example-print.jpg" alt="Example page printed"/></p>
<p>As silly as it might sound, it just feels better having that finite amount of news on a single sheet of paper. Of being able to stop there instead of endlessly scrolling through websites and social media apps.</p>
<p>Also, this was a super fun project and I&#39;m hoping I can find more uses for this dot matrix printer. Working with physical hardware (especially older specimens like this) is always a blast for me, and being able to integrate them with new technology or use them in interesting ways just ignites pure passion and reinforces why I became a programmer in the first place.</p>
<p>So, what do you think? If you have any ideas for projects like this, or just have a question or comment, I&#39;d love to hear it! Catch me on <a href="https://twitter.com/aschmelyun">Twitter</a> if you&#39;d like to chat more.</p>


            <div>
                
                <p>Subscribe using the form below and about 1-2 times a month you&#39;ll receive an email containing helpful hints, new packages, and interesting articles I&#39;ve found on PHP, JavaScript, Docker and more.</p>
                
            </div>
        </div>
    </div></div>
  </body>
</html>
