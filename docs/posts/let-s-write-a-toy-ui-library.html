<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nakst.gitlab.io/tutorial/ui-part-1.html">Original</a>
    <h1>Let&#39;s write a toy UI library</h1>
    
    <div id="readability-page-1" class="page"><div>
<p dir="auto" data-sourcepos="1:1-1:45">Good afternoon! Let&#39;s write a toy UI library.</p>
<p dir="auto" data-sourcepos="3:1-3:256">We begin by writing a few helper functions that will invariably prove useful to us later. We will be dealing with a lot of rectangular regions on the screen, so it makes sense to start by defining a rectangle structure and write some code to manipulate it.</p>
<div>
<pre data-sourcepos="5:1-9:3" lang="c"><code><span id="LC1" lang="c"><span>typedef</span> <span>struct</span> <span>Rectangle</span> <span>{</span></span>
<span id="LC2" lang="c">	<span>int</span> <span>l</span><span>,</span> <span>r</span><span>,</span> <span>t</span><span>,</span> <span>b</span><span>;</span></span>
<span id="LC3" lang="c"><span>}</span> <span>Rectangle</span><span>;</span></span></code></pre>

</div>
<p dir="auto" data-sourcepos="11:1-11:108">My preferred method of encoding rectangles is as a quartet comprising the left, right, top and bottom sides.</p>
<p dir="auto" data-sourcepos="13:1-13:154"><a data-canonical-src="https://raw.githubusercontent.com/nakst/cdn/main/Group3.png" rel="nofollow noreferrer noopener" href="https://user-content.gitlab-static.net/2ec040a086aa920ee77c504723d87894e5936a99/68747470733a2f2f7261772e67697468756275736572636f6e74656e742e636f6d2f6e616b73742f63646e2f6d61696e2f47726f7570332e706e67"><img width="300px" decoding="async" data-canonical-src="https://raw.githubusercontent.com/nakst/cdn/main/Group3.png" alt="A diagram of a 2D grid showing a square enclosed by its left, right, top and bottom sides." src="https://user-content.gitlab-static.net/2ec040a086aa920ee77c504723d87894e5936a99/68747470733a2f2f7261772e67697468756275736572636f6e74656e742e636f6d2f6e616b73742f63646e2f6d61696e2f47726f7570332e706e67" loading="lazy"/></a></p>
<p dir="auto" data-sourcepos="15:1-15:72">Here are the helper functions we&#39;ll implement that deal with rectangles.</p>
<div>
<pre data-sourcepos="17:1-24:3" lang="c"><code><span id="LC1" lang="c"><span>Rectangle</span> <span>RectangleMake</span><span>(</span><span>int</span> <span>l</span><span>,</span> <span>int</span> <span>r</span><span>,</span> <span>int</span> <span>t</span><span>,</span> <span>int</span> <span>b</span><span>);</span> <span>// Initialise a Rectangle structure with the provided values.</span></span>
<span id="LC2" lang="c"><span>bool</span> <span>RectangleValid</span><span>(</span><span>Rectangle</span> <span>a</span><span>);</span> <span>// Returns true if the rectangle is &#39;valid&#39;, which I define to mean it has positive width and height.</span></span>
<span id="LC3" lang="c"><span>Rectangle</span> <span>RectangleIntersection</span><span>(</span><span>Rectangle</span> <span>a</span><span>,</span> <span>Rectangle</span> <span>b</span><span>);</span> <span>// Compute the intersection of the rectangles, i.e. the biggest rectangle that fits into both. If the rectangles don&#39;t overlap, an invalid rectangle is returned (as per RectangleValid).</span></span>
<span id="LC4" lang="c"><span>Rectangle</span> <span>RectangleBounding</span><span>(</span><span>Rectangle</span> <span>a</span><span>,</span> <span>Rectangle</span> <span>b</span><span>);</span> <span>// Compute the smallest rectangle containing both of the input rectangles.</span></span>
<span id="LC5" lang="c"><span>bool</span> <span>RectangleEquals</span><span>(</span><span>Rectangle</span> <span>a</span><span>,</span> <span>Rectangle</span> <span>b</span><span>);</span> <span>// Returns true if all sides are equal.</span></span>
<span id="LC6" lang="c"><span>bool</span> <span>RectangleContains</span><span>(</span><span>Rectangle</span> <span>a</span><span>,</span> <span>int</span> <span>x</span><span>,</span> <span>int</span> <span>y</span><span>);</span> <span>// Returns true if the pixel with its top-left at the given coordinate is contained inside the rectangle.</span></span></code></pre>

</div>
<p dir="auto" data-sourcepos="26:1-26:168">If you&#39;re following along with the tutorial, I recommend trying to implement these yourself, and then comparing with my implementation. Here&#39;s a few to get you started.</p>
<div>
<pre data-sourcepos="28:1-42:3" lang="c"><code><span id="LC1" lang="c"><span>Rectangle</span> <span>RectangleIntersection</span><span>(</span><span>Rectangle</span> <span>a</span><span>,</span> <span>Rectangle</span> <span>b</span><span>)</span> <span>{</span></span>
<span id="LC2" lang="c">	<span>if</span> <span>(</span><span>a</span><span>.</span><span>l</span> <span>&lt;</span> <span>b</span><span>.</span><span>l</span><span>)</span> <span>a</span><span>.</span><span>l</span> <span>=</span> <span>b</span><span>.</span><span>l</span><span>;</span></span>
<span id="LC3" lang="c">	<span>if</span> <span>(</span><span>a</span><span>.</span><span>t</span> <span>&lt;</span> <span>b</span><span>.</span><span>t</span><span>)</span> <span>a</span><span>.</span><span>t</span> <span>=</span> <span>b</span><span>.</span><span>t</span><span>;</span></span>
<span id="LC4" lang="c">	<span>if</span> <span>(</span><span>a</span><span>.</span><span>r</span> <span>&gt;</span> <span>b</span><span>.</span><span>r</span><span>)</span> <span>a</span><span>.</span><span>r</span> <span>=</span> <span>b</span><span>.</span><span>r</span><span>;</span></span>
<span id="LC5" lang="c">	<span>if</span> <span>(</span><span>a</span><span>.</span><span>b</span> <span>&gt;</span> <span>b</span><span>.</span><span>b</span><span>)</span> <span>a</span><span>.</span><span>b</span> <span>=</span> <span>b</span><span>.</span><span>b</span><span>;</span></span>
<span id="LC6" lang="c">	<span>return</span> <span>a</span><span>;</span></span>
<span id="LC7" lang="c"><span>}</span></span>
<span id="LC8" lang="c"></span>
<span id="LC9" lang="c"><span>bool</span> <span>RectangleContains</span><span>(</span><span>Rectangle</span> <span>a</span><span>,</span> <span>int</span> <span>x</span><span>,</span> <span>int</span> <span>y</span><span>)</span> <span>{</span></span>
<span id="LC10" lang="c">	<span>// (x, y) gives the top-left corner of the pixel.</span></span>
<span id="LC11" lang="c">	<span>// Therefore we use strict inequalities when comparing against the right and bottom sides of the rectangle.</span></span>
<span id="LC12" lang="c">	<span>return</span> <span>a</span><span>.</span><span>l</span> <span>&lt;=</span> <span>x</span> <span>&amp;&amp;</span> <span>a</span><span>.</span><span>r</span> <span>&gt;</span> <span>x</span> <span>&amp;&amp;</span> <span>a</span><span>.</span><span>t</span> <span>&lt;=</span> <span>y</span> <span>&amp;&amp;</span> <span>a</span><span>.</span><span>b</span> <span>&gt;</span> <span>y</span><span>;</span></span>
<span id="LC13" lang="c"><span>}</span></span></code></pre>

</div>
<p dir="auto" data-sourcepos="44:1-44:244">We need just one more helper function, <code>StringCopy</code>. This copies a string to a heap allocated buffer, and stores the pointer to the buffer in the given output, making sure not to leak the old buffer. I think the code is fairly self-explanatory.</p>
<div>
<pre data-sourcepos="46:1-53:3" lang="c"><code><span id="LC1" lang="c"><span>void</span> <span>StringCopy</span><span>(</span><span>char</span> <span>**</span><span>destination</span><span>,</span> <span>size_t</span> <span>*</span><span>destinationBytes</span><span>,</span> <span>const</span> <span>char</span> <span>*</span><span>source</span><span>,</span> <span>ptrdiff_t</span> <span>sourceBytes</span><span>)</span> <span>{</span></span>
<span id="LC2" lang="c">	<span>if</span> <span>(</span><span>sourceBytes</span> <span>==</span> <span>-</span><span>1</span><span>)</span> <span>sourceBytes</span> <span>=</span> <span>strlen</span><span>(</span><span>source</span><span>);</span></span>
<span id="LC3" lang="c">	<span>*</span><span>destination</span> <span>=</span> <span>(</span><span>char</span> <span>*</span><span>)</span> <span>realloc</span><span>(</span><span>*</span><span>destination</span><span>,</span> <span>sourceBytes</span><span>);</span></span>
<span id="LC4" lang="c">	<span>*</span><span>destinationBytes</span> <span>=</span> <span>sourceBytes</span><span>;</span></span>
<span id="LC5" lang="c">	<span>memcpy</span><span>(</span><span>*</span><span>destination</span><span>,</span> <span>source</span><span>,</span> <span>sourceBytes</span><span>);</span></span>
<span id="LC6" lang="c"><span>}</span></span></code></pre>

</div>
<p dir="auto" data-sourcepos="55:1-55:90">While we&#39;re at it, I&#39;ll also create the one global variable we&#39;ll need for the UI library.</p>
<div>
<pre data-sourcepos="57:1-62:3" lang="c"><code><span id="LC1" lang="c"><span>typedef</span> <span>struct</span> <span>GlobalState</span> <span>{</span></span>
<span id="LC2" lang="c"><span>}</span> <span>GlobalState</span><span>;</span></span>
<span id="LC3" lang="c"></span>
<span id="LC4" lang="c"><span>GlobalState</span> <span>global</span><span>;</span></span></code></pre>

</div>
<p dir="auto" data-sourcepos="64:1-64:59">We&#39;ll keep all our global state together in this structure.</p>
<p dir="auto" data-sourcepos="66:1-66:184">Here&#39;s the full code for this article. I&#39;ve also added some code to check that the helper functions are doing what I want them to do. Don&#39;t forget to build with <code>-fsanitize=address</code> :)</p>
</div></div>
  </body>
</html>
