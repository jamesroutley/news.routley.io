<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.vice.com/en/article/v7veg8/anom-app-source-code-operation-trojan-shield-an0m">Original</a>
    <h1>Code from the FBI’s Anom encrypted messaging app</h1>
    
    <div id="readability-page-1" class="page"><div data-component="BodyComponentRenderer"><div><div><p><a href="https://www.vice.com/en/topic/cyber"><img src="https://video-images.vice.com/topics/57a205628cb727dec795a6b1/callout_logo/1614199980283-screen-shot-2021-02-24-at-34918-pm.png?resize=240:*" alt="Screen Shot 2021-02-24 at 3"/></a></p><p>Hacking. Disinformation. Surveillance. CYBER is Motherboard&#39;s podcast and reporting on the dark underbelly of the internet.</p></div><p><span data-component="TextBlock"><p>The FBI operation in which the agency intercepted messages from thousands of encrypted phones around the world was powered by cobbled together code. Motherboard has obtained that code and is now publishing sections of it that show how the FBI was able to create its honeypot. The code shows that the messages were secretly duplicated and sent to a “ghost” contact that was hidden from the users’ contact lists. This ghost user, in a way, was the FBI and its law enforcement partners, reading over the shoulder of organized criminals as they talked to each other.</p></span></p></div><div><p><span data-component="TextBlock"><p>Last year, the FBI and its international partners announced Operation Trojan Shield, in which the FBI secretly ran an encrypted phone company called Anom for years and used it to hoover up tens of millions of messages from Anom users. Anom was marketed to criminals, and ended up in the hands of over 300 criminal syndicates worldwide. The landmark operation has led to more than 1,000 arrests including alleged top tier drug traffickers and massive seizures of weapons, cash, narcotics, and luxury cars.</p></span><span data-component="TextBlock"><p>Motherboard has obtained this underlying code of the Anom app and is now publishing sections of it due to the public interest in understanding how law enforcement agencies are tackling the so-called Going Dark problem, where criminals use encryption to keep their communications out of the hands of the authorities. The code provides greater insight into the hurried nature of its development, the freely available online tools that Anom’s developers copied for their own purposes, and how the relevant section of code copied the messages as part of one of the largest law enforcement operations ever.</p></span></p><blockquote data-component="QuoteBlock"><p><em><strong>Do you know anything else about Anom? Were you a user? Did you work for the company? Did you work on the investigation? Are you defending an alleged Anom user? We&#39;d love to hear from you. Using a non-work phone or computer, you can contact Joseph Cox securely on Signal on +44 20 8133 5190, Wickr on josephcox, or email</strong></em> <a href="mailto:joseph.cox@vice.com">joseph.cox@vice.com</a><em><strong>.</strong></em></p></blockquote></div><p><span data-component="TextBlock"><p>The key part of the Anom app is a section called “bot.”</p></span></p><div><div data-component="ImageBlock"><div><div><picture><source media="(min-width: 1000px)" srcset="https://video-images.vice.com/_uncategorized/1657139146937-1.png?resize=20:*"/><source media="(min-width: 700px)" srcset="https://video-images.vice.com/_uncategorized/1657139146937-1.png?resize=20:*"/><source media="(min-width: 0px)" srcset="https://video-images.vice.com/_uncategorized/1657139146937-1.png?resize=20:*"/><img alt="1.png"/></picture></div></div><p>A section of the Anom code. Image: Motherboard.</p></div></div><p><span data-component="TextBlock"><p>The app uses XMPP to communicate, a long-established protocol for sending instant messages. On top of that, Anom wrapped messages in a layer of encryption. XMPP works by having each contact use a handle that in some way looks like an email address. For Anom, these included an XMPP account for the customer support channel that Anom users could contact. Another of these was bot.</p></span><span data-component="TextBlock"><p>Unlike the support channel, bot hid itself from Anom users’ contact lists and operated in the background, according to the code and to photos of active Anom devices obtained by Motherboard. In practice the app scrolled through the user’s list of contacts, and when it came across the bot account, the app filtered that out and removed it from view. </p></span><span data-component="TextBlock"><p>That finding is corroborated by law enforcement files Motherboard obtained which say that bot was a hidden or “ghost” contact that made copies of Anom users’ messages.</p></span><span data-component="TextBlock"><p>Authorities have previously floated the idea of using a ghost contact to penetrate encrypted communications. In a <a href="https://www.lawfareblog.com/principles-more-informed-exceptional-access-debate" target="_blank">November 2018 piece published on </a><em><a href="https://www.lawfareblog.com/principles-more-informed-exceptional-access-debate" target="_blank">Lawfare</a></em>, Ian Levy and Crispin Robinson, two senior officials from UK intelligence agency GCHQ, wrote that “It’s relatively easy for a service provider to silently add a law enforcement participant to a group chat or call,” and “You end up with everything still being end-to-end encrypted, but there’s an extra ‘end’ on this particular communication.”</p></span></p><div><div data-component="ImageBlock"><div><div><picture><source media="(min-width: 1000px)" srcset="https://video-images.vice.com/_uncategorized/1657139203492-bot-diagram-redacted.png?resize=20:*"/><source media="(min-width: 700px)" srcset="https://video-images.vice.com/_uncategorized/1657139203492-bot-diagram-redacted.png?resize=20:*"/><source media="(min-width: 0px)" srcset="https://video-images.vice.com/_uncategorized/1657139203492-bot-diagram-redacted.png?resize=20:*"/><img alt="bot-diagram-redacted.png"/></picture></div></div><p>A diagram of how the bot functioned included in law enforcement files obtained by Motherboard. Image: Motherboard.</p></div></div><p><span data-component="TextBlock"><p>The code also shows that in the section that handles sending messages, the app attached location information to any message that is sent to bot. On top of that, the AndroidManifest.xml file in the app, which shows what permissions an app accesses, includes the permission for “ACCESS_FINE_LOCATION.” This confirms what <a href="https://www.vice.com/en/article/93b3ay/fbi-backdoor-anom-phones-gps-data">Motherboard previously reported</a> after reviewing thousands of pages of police files in an Anom-related investigation. Many of the intercepted Anom messages in those documents included the precise GPS location of the device at the time the message was sent. </p></span><span data-component="TextBlock"><p>In some cases, police officers reported that the Anom system failed to record those GPS locations correctly, but that authorities believe the coordinates are generally reliable as they have in some cases been matched with other information such as photos, according to those police files.</p></span><span data-component="TextBlock"><p>A lot of the code for handling communications was apparently copied from an open source messaging app.</p></span><span data-component="TextBlock"><p>The code itself is messy, with large chunks commented out and the app repeatedly logging debug messages to the phone itself.</p></span></p><div><div data-component="ImageBlock"><div><div><picture><source media="(min-width: 1000px)" srcset="https://video-images.vice.com/_uncategorized/1657140208501-2.png?resize=20:*"/><source media="(min-width: 700px)" srcset="https://video-images.vice.com/_uncategorized/1657140208501-2.png?resize=20:*"/><source media="(min-width: 0px)" srcset="https://video-images.vice.com/_uncategorized/1657140208501-2.png?resize=20:*"/><img alt="2.png"/></picture></div></div><p>A section of the Anom code. Image: Motherboard.</p></div></div><p><span data-component="TextBlock"><p>Cooper Quintin, a senior staff technologist at activist organization the Electronic Frontier Foundation (EFF), didn’t think it was unusual for developers to use other modules of code found online. But he did find it “bonkers” that the FBI used ordinary developers for this law enforcement operation.</p></span></p><p><span data-component="TextBlock"><p>“This would be like if Raytheon hired the fireworks company down the street to make missile primers, but didn’t tell them they were making missile primers,” he said in a phone call. “I would typically assume the FBI would want to keep tighter control on what they’re working on,” such as working with inhouse computer engineers who had security clearance and not bringing in people who are unknowingly taking down criminal organizations, he added. (One reason for the use of third-party developers was that Anom already existed as a company in its own right, with coders hired by the company’s creator who worked on an early version of the app, before the FBI became secretly involved in Anom’s management).</p></span><span data-component="TextBlock"><p>Recently courts in Europe and Australia have seen the next step of the Anom operation: the prosecution of these alleged criminals with Anom messages making up much of the evidence against them. Defense lawyers in Australia have started legal requests to obtain the code of the Anom app itself, arguing that access to the code is important to determine that the messages being presented in court by the prosecution are accurate. The Australian Federal Police (AFP) has refused to release the code. </p></span><span data-component="TextBlock"><p>“Anybody who has been charged with an offence arising from messages that are alleged to have been made on the so called ‘Anom Platform’ has a clear and obvious interest in understanding how the device worked, how anyone was able to access these messages and most importantly whether the original accessing and subsequent dissemination of these messages to Australian authorities was lawful,” Jennifer Stefanac, an Australian solicitor who is defending some of the people arrested as part of Operation Ironside, the Australian authorities’ side of the Anom operation, told Motherboard in an email.</p></span></p><div><div data-component="RelatedArticleBlock"><div><div><a href="https://www.vice.com/en/article/n7b4gg/anom-phone-arcaneos-fbi-backdoor" tabindex="-1"><div><div><picture><source media="(min-width: 1000px)" srcset="data://image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAMAAAAM9FwAAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjQ2QjUwODI3MUI1NTExRTk5RjE3QTJDRDlCQzU1MDg0IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjQ2QjUwODI4MUI1NTExRTk5RjE3QTJDRDlCQzU1MDg0Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NDZCNTA4MjUxQjU1MTFFOTlGMTdBMkNEOUJDNTUwODQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NDZCNTA4MjYxQjU1MTFFOTlGMTdBMkNEOUJDNTUwODQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5A+02rAAAABlBMVEX///8AAABVwtN+AAAAAXRSTlMAQObYZgAAAA5JREFUeNpiYBikACDAAACZAAGHvThgAAAAAElFTkSuQmCC"/><source media="(min-width: 700px)" srcset="data://image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAMAAAAM9FwAAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjQ2QjUwODI3MUI1NTExRTk5RjE3QTJDRDlCQzU1MDg0IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjQ2QjUwODI4MUI1NTExRTk5RjE3QTJDRDlCQzU1MDg0Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NDZCNTA4MjUxQjU1MTFFOTlGMTdBMkNEOUJDNTUwODQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NDZCNTA4MjYxQjU1MTFFOTlGMTdBMkNEOUJDNTUwODQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5A+02rAAAABlBMVEX///8AAABVwtN+AAAAAXRSTlMAQObYZgAAAA5JREFUeNpiYBikACDAAACZAAGHvThgAAAAAElFTkSuQmCC"/><source media="(min-width: 0px)" srcset="data://image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAMAAAAM9FwAAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjQ2QjUwODI3MUI1NTExRTk5RjE3QTJDRDlCQzU1MDg0IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjQ2QjUwODI4MUI1NTExRTk5RjE3QTJDRDlCQzU1MDg0Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NDZCNTA4MjUxQjU1MTFFOTlGMTdBMkNEOUJDNTUwODQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NDZCNTA4MjYxQjU1MTFFOTlGMTdBMkNEOUJDNTUwODQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5A+02rAAAABlBMVEX///8AAABVwtN+AAAAAXRSTlMAQObYZgAAAA5JREFUeNpiYBikACDAAACZAAGHvThgAAAAAElFTkSuQmCC"/><img alt=""/></picture></div></div></a></div></div></div><p><span data-component="TextBlock"><p>A second lawyer handling Anom related cases said they didn&#39;t think the Anom code would be of much relevance to defendants’ cases. A third said they saw why defendants may seek access to the code, but that they believed it shouldn’t be publicly available. </p></span><span data-component="TextBlock"><p>When asked for comment, the San Diego FBI told Motherboard in a statement that “We appreciate the opportunity to provide feedback on potentially publishing portions of the Anom source code. We have significant concerns that releasing the entire source code would result in a number of situations not in the public interest like the exposure of sources and methods, as well as providing a playbook for others, to include criminal elements, to duplicate the application without the substantial time and resource investment necessary to create such an application. We believe producing snippets of the code could produce similar results.”</p></span><span data-component="TextBlock"><p>Motherboard is not publishing the full code of Anom. Motherboard believes the code contains identifying information on who worked on the app. Most of the people who worked on the Anom app <a href="https://www.vice.com/en/article/n7nnmg/inside-anom-video-operation-trojan-shield-ironside">were not aware it was secretly an FBI tool</a> for surveilling organized crime, and exposing their identities could put them at serious risk. Motherboard will not be releasing the app publicly or distributing it further.</p></span><span data-component="TextBlock"><p><a href="https://www.vice.com/en/article/n7b4gg/anom-phone-arcaneos-fbi-backdoor">Motherboard previously obtained one of the Anom phones</a> from the secondary market after the law enforcement operation was announced. In that case, the phone had a locked bootloader, meaning it was more difficult to extract files from the device. For this new analysis of the code, a source provided a copy of the Anom APK as a standalone file which Motherboard then decompiled. Motherboard granted multiple sources in this piece anonymity to protect them from retaliation. </p></span><span data-component="TextBlock"><p>Decompiling an app is an everyday process used by reverse engineers to access the code used to construct an app. It can be used to fix problems with the software, find vulnerabilities, or generally to research how an app was put together. Two reverse engineering experts corroborated and elaborated upon Motherboard’s own analysis of the app.</p></span><span data-component="TextBlock"><p>Operation Trojan Shield has been widely successful. On top of the wave of arrests, authorities were also able to intervene using the messages and stop multiple planned murders. In June to mark the one year anniversary of the operation’s announcement, the AFP revealed it has shifted some of its focus to <a href="https://www.abc.net.au/news/2022-06-07/afp-target-italian-mafia-ndrangheta-activities-in-australia/101131092" target="_blank">investigating thousands of people suspected of being linked to Italian organized crime</a> in Australia and that it is working with international partners.</p></span><span data-component="TextBlock"><p><em><strong>Subscribe to our cybersecurity podcast, <a href="https://itunes.apple.com/gb/podcast/cyber/id1441708044?mt=2" target="_blank">CYBER</a>. Subscribe to <a href="https://www.twitch.tv/motherboardtv" target="_blank">our new Twitch channel</a>.</strong></em></p></span></p></div></div><div><div><div><p><h3>ORIGINAL REPORTING ON EVERYTHING THAT MATTERS IN YOUR INBOX.</h3></p><p>By signing up, you agree to the<!-- --> <a href="https://vice-web-statics-cdn.vice.com/privacy-policy/en_us/page/terms-of-use.html">Terms of Use</a> <!-- -->and<!-- --> <a href="https://vice-web-statics-cdn.vice.com/privacy-policy/en_us/page/privacy-policy.html">Privacy Policy</a> <!-- -->&amp; to receive electronic communications from Vice Media Group, which may include marketing promotions, advertisements and sponsored content.</p></div></div></div></div>
  </body>
</html>
