<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://timsh.org/everyone-knows-your-location-part-2-try-it-yourself/">Original</a>
    <h1>Everyone knows your location, Part 2: try it yourself and share the results</h1>
    
    <div id="readability-page-1" class="page"><section>
            <p>It&#39;s been more than 2 months now since my first post on the topic of location data sharing between various 3rd parties came out – in case you haven&#39;t seen it, you should definitely start from there: </p><figure><a href="https://timsh.org/tracking-myself-down-through-in-app-ads/"><div><p>Everyone knows your location</p><p>How I tracked myself down using leaked location data in the in-app ads, and what I found along the way.</p><p><img src="https://timsh.org/content/images/icon/wg-4.jpg" alt=""/><span>tim.sh</span><span>tim</span></p></div><p><img src="https://timsh.org/content/images/thumbnail/dataflow_upd-1.png" alt="" onerror="this.style.display = &#39;none&#39;"/></p></a></figure><p>Since then I had a chat with a lot of people working in this field – both members of non-profit organisations, fighting for data privacy rights in various countries, and employees of adtech companies, proving my words right or wrong (but mostly right). I was even invited to &#34;<a href="https://www.malwarebytes.com/blog/podcast/2025/03/how-ads-weirdly-know-your-screen-brightness-headphone-jack-use-and-location-with-tim-shott-lock-and-code-s06e05?ref=timsh.org" rel="noreferrer">Lock and Code</a>&#34; podcast to talk about geolocation data and privacy. Ok, enough with the bragging. </p><p>I went through the process described in my initial post and decided to make it faster and more scalable: manually going through hundreds of requests in Charles was very cool for research and educational purposes, but it also took me a lot of time to find &#34;interesting&#34; requests coming from a single app. </p><p>I&#39;ve significantly upgraded my approach (though it could definitely be more efficient), and in this post I wanted to share it with you.</p><h3 id="tldr">TL;DR</h3><p>I have created a small guide and a Python notebook that allow anyone to record mobile app traffic and find surprising things in it. </p><p>Here&#39;s <a href="https://github.com/tim-sha256/analyse-ad-traffic/?ref=timsh.org" rel="noreferrer">the link to a GitHub repo</a> with it. </p><p>The initial setup takes 10-30 minutes. </p><p><strong>I came up with an idea</strong>: it would take me hundreds of hours to go through each app and record the traffic, though I would love to do that – let&#39;s not blindly trust some table from the internet, but find out for ourselves. </p><figure><a href="https://forms.gle/Wyj1K54B5NQw3Vxt7?ref=timsh.org"><div><p>I found something interesting in the app traffic</p><p>Hey! I don’t know how much people will go through with all the instructions and analysis, but since you’re here, you probably already did it and found something. Thanks for being here and doing this. Fill in the form below and your response will be recorded to a shared spreadsheet. PLEASE CHECK ALL OF YOUR INPUTS FOR YOUR PERSONAL INFORMATION. This form is set in a way that I collect nothing personal from you (like email or Google account or whatever), but your response will be viewable by virtually anyone - so be aware!</p><p><img src="https://timsh.org/content/images/icon/android_192.png" alt=""/><span>Google Docs</span></p></div><p><img src="https://timsh.org/content/images/thumbnail/jRCp4Akn5TH6KUw5HNa4mv0XrSReregDtVFTKJDD2eOqZtk6c3J69uGb5z85mbBlNu4ACbHFWRkUTBA-w1200-h630-p" alt="" onerror="this.style.display = &#39;none&#39;"/></p></a></figure><p>Please edit all the private information in your submission (in case it&#39;s there). </p><hr/><h2 id="visualising-domain-power">Visualising &#34;domain power&#34;</h2><p>Before jumping into the guide, I wanted to share a few cool-looking visualisations with you. </p><p>While analysing the traffic I found myself curious: how are the adtech companies domains distributed across all of the requests? </p><figure><img src="https://timsh.org/content/images/2025/04/Screenshot-2025-04-16-at-20.26.37.png" alt="" loading="lazy" width="1618" height="1022" srcset="https://timsh.org/content/images/size/w600/2025/04/Screenshot-2025-04-16-at-20.26.37.png 600w, https://timsh.org/content/images/size/w1000/2025/04/Screenshot-2025-04-16-at-20.26.37.png 1000w, https://timsh.org/content/images/size/w1600/2025/04/Screenshot-2025-04-16-at-20.26.37.png 1600w, https://timsh.org/content/images/2025/04/Screenshot-2025-04-16-at-20.26.37.png 1618w" sizes="(min-width: 720px) 720px"/></figure><p>Here&#39;s some context: </p><ol><li>Every circle is a domain or a subdomain. </li><li>Colors represent the app (I analysed 5) that the request corresponds to. </li><li>Circle sizes, or masses, represent the frequency: how often did this or that domain appear in the requests data. </li></ol><blockquote><strong>Unity</strong> rules the mobile game app traffic scene. </blockquote><p>Take a look at it in motion: </p><figure><iframe src="https://player.vimeo.com/video/1076497133?h=a6aa5702c9&amp;app_id=122963" width="420" height="240" frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media" title="domain power"></iframe></figure><p>I included the code for it – <a href="https://github.com/tim-sha256/analyse-ad-traffic/blob/main/visualise_domains.ipynb?ref=timsh.org" rel="noreferrer"><code>visualise_domains.ipynb</code></a> in the same repo so that you could create the same visualisation out of the data you record. </p><p>I also was curious of the density of the requests – in my last post, I mentioned that hundreds of requests happen in just a few seconds, and now I could finally take a look at them:</p><figure><img src="https://timsh.org/content/images/2025/04/Screenshot-2025-04-17-at-15.32.48.png" alt="" loading="lazy" width="2000" height="942" srcset="https://timsh.org/content/images/size/w600/2025/04/Screenshot-2025-04-17-at-15.32.48.png 600w, https://timsh.org/content/images/size/w1000/2025/04/Screenshot-2025-04-17-at-15.32.48.png 1000w, https://timsh.org/content/images/size/w1600/2025/04/Screenshot-2025-04-17-at-15.32.48.png 1600w, https://timsh.org/content/images/2025/04/Screenshot-2025-04-17-at-15.32.48.png 2124w" sizes="(min-width: 720px) 720px"/></figure><p>Filenames in the legend are flows collected from 5 different games. </p><figure><img src="https://timsh.org/content/images/2025/04/Screenshot-2025-04-17-at-15.50.19.png" alt="" loading="lazy" width="2000" height="886" srcset="https://timsh.org/content/images/size/w600/2025/04/Screenshot-2025-04-17-at-15.50.19.png 600w, https://timsh.org/content/images/size/w1000/2025/04/Screenshot-2025-04-17-at-15.50.19.png 1000w, https://timsh.org/content/images/size/w1600/2025/04/Screenshot-2025-04-17-at-15.50.19.png 1600w, https://timsh.org/content/images/2025/04/Screenshot-2025-04-17-at-15.50.19.png 2272w" sizes="(min-width: 720px) 720px"/></figure><p>This one is again a different view of the domain power – look at the list on the right.</p><ul><li>It should be obvious by now that Unity is the leader in this strange contest – it has the most subdomains called and the most requests made to. </li><li>Applovin is a Palo Alto-based company that acquired above mentioned Adjust in 2021, has shown <a href="https://investors.applovin.com/news/news-details/2025/AppLovin-Announces-Fourth-Quarter-and-Full-Year-2024-Financial-Results/default.aspx?ref=timsh.org" rel="noreferrer">$1.58 bln net income in 2024</a>, and decided to get rid of it&#39;s mobile games development products and focus on its advertising business just a few months ago.</li><li>Doubleclick.net is Google Ads</li><li>And surprisingly, Facebook, that I&#39;ve seen in the requests from every single game, is in the last place among these. Well, at least based on this strange metric observed on 5 examples </li></ul><p>Now that you&#39;ve seen these obscure but good-looking graphs - let&#39;s move on to the actual guide that you could follow to analyse any app traffic. </p><hr/><h2 id="getting-started">Getting started</h2><h3 id="step-1-install-mitmproxy-on-your-pc">Step 1: Install mitmproxy on your PC</h3><p><code>mitmproxy</code> is an open-source tool for intercepting traffic with wide capabilities and a surprisingly nice web version called <code>mitmweb</code>.</p><p>Go to their <a href="https://mitmproxy.org/downloads/?ref=timsh.org" rel="noreferrer">official downloads page</a> and choose whatever installation way you like more. </p><p>After installation run this command to start <code>mitmweb</code> (mitmproxy + web interface): <code>mitmweb --listen-host 0.0.0.0 --listen-port 8080</code></p><figure><img src="https://timsh.org/content/images/2025/04/Screenshot-2025-04-13-at-21.31.52.png" alt="" loading="lazy" width="2000" height="708" srcset="https://timsh.org/content/images/size/w600/2025/04/Screenshot-2025-04-13-at-21.31.52.png 600w, https://timsh.org/content/images/size/w1000/2025/04/Screenshot-2025-04-13-at-21.31.52.png 1000w, https://timsh.org/content/images/size/w1600/2025/04/Screenshot-2025-04-13-at-21.31.52.png 1600w, https://timsh.org/content/images/size/w2400/2025/04/Screenshot-2025-04-13-at-21.31.52.png 2400w" sizes="(min-width: 720px) 720px"/></figure><p>We use <code>--listen-host 0.0.0.0</code> to avoid <code>mitmproxy</code> starting in the default location, which is localhost <code>128.0.0.1</code> – this way, you don&#39;t record your PC traffic and will see 0 requests until you complete the next step. </p><h3 id="step-2-prepare-your-mobile-device">Step 2: prepare your mobile device</h3><p>What you&#39;ll need to do is to then setup proxy on your iPhone / Android device and install + trust a certificate. </p><p>I believe you might need to turn on the developer mode, otherwise you won&#39;t have Certificate Trust in your settings. Or maybe not. </p><h3 id="step-3-start-collecting-requests">Step 3: start collecting requests! </h3><ol><li>Run <code>ipconfig getifaddr en0</code> to find your PC local IP address.</li><li>Next, open the wifi network settings on iPhone, scroll down and setup manual proxy with:</li></ol><p>On iPhone, open browser and go to <code>mitm.it</code></p><blockquote><strong><em>What is this for?</em></strong></blockquote><p>Congrats! If you completed all the steps correctly, you should now see requests in the <code>mitmweb</code> interface.</p><figure><img src="https://timsh.org/content/images/2025/04/Screenshot-2025-04-13-at-21.34.21.png" alt="" loading="lazy" width="1292" height="298" srcset="https://timsh.org/content/images/size/w600/2025/04/Screenshot-2025-04-13-at-21.34.21.png 600w, https://timsh.org/content/images/size/w1000/2025/04/Screenshot-2025-04-13-at-21.34.21.png 1000w, https://timsh.org/content/images/2025/04/Screenshot-2025-04-13-at-21.34.21.png 1292w" sizes="(min-width: 720px) 720px"/></figure><p>If you don&#39;t have an app installed yet, you might have to turn off proxy on iPhone, download the app and then turn it on again and clear the flows - AppStore refused to work with proxy on for me. </p><p>If you don&#39;t have anything specific on your mind – pick any app with &#34;Checked = False&#34; in the &#34;original list&#34; sheet. <a href="https://docs.google.com/spreadsheets/d/1fJbNT-kmfuWUlIpYr9sduvjZS1ggrmhydCzoDlqaMaA/?ref=timsh.org">https://docs.google.com/spreadsheets/d/1fJbNT-kmfuWUlIpYr9sduvjZS1ggrmhydCzoDlqaMaA/</a></p><hr/><h2 id="lets-find-something-interesting">Let&#39;s find something interesting</h2><p>All right, now we can record the data! </p><p>You can already find interesting requests manually - for example, I&#39;m pretty sure you&#39;ll see this Facebook request no matter what app you analyse: </p><figure><img src="https://timsh.org/content/images/2025/04/Screenshot-2025-04-07-at-11.49.09.png" alt="" loading="lazy" width="2000" height="2028" srcset="https://timsh.org/content/images/size/w600/2025/04/Screenshot-2025-04-07-at-11.49.09.png 600w, https://timsh.org/content/images/size/w1000/2025/04/Screenshot-2025-04-07-at-11.49.09.png 1000w, https://timsh.org/content/images/size/w1600/2025/04/Screenshot-2025-04-07-at-11.49.09.png 1600w, https://timsh.org/content/images/size/w2400/2025/04/Screenshot-2025-04-07-at-11.49.09.png 2400w" sizes="(min-width: 720px) 720px"/></figure><p>But looking through the requests in <code>mitmweb</code>, even with ok (not advanced) filtering is a very slow process. And you&#39;ll see – there will be hundreds (if not thousands) of requests in just a few minutes. </p><p>When you feel like there&#39;s enough (you could even leave it open or play for an hour or so to collect more data), close the app and switch off the phone, then in <code>mitmweb</code> press File → Save.</p><p>This will give you a <code>flows</code> file - rename it as <code>appname.flow</code>.</p><h3 id="filtering-analysing-the-data">Filtering &amp; analysing the data</h3><p>Open the <a href="https://github.com/tim-sha256/analyse-ad-traffic/blob/main/mitm_test.ipynb?ref=timsh.org" rel="noreferrer"><code>mitm_test.ipynb</code> </a>- either in a local Jupyter Notebook or in Google Colab (or wherever you work with <code>.ipynb</code>s).</p><figure><img src="https://timsh.org/content/images/2025/04/Screenshot-2025-04-14-at-17.11.12.png" alt="" loading="lazy" width="2000" height="1271" srcset="https://timsh.org/content/images/size/w600/2025/04/Screenshot-2025-04-14-at-17.11.12.png 600w, https://timsh.org/content/images/size/w1000/2025/04/Screenshot-2025-04-14-at-17.11.12.png 1000w, https://timsh.org/content/images/size/w1600/2025/04/Screenshot-2025-04-14-at-17.11.12.png 1600w, https://timsh.org/content/images/2025/04/Screenshot-2025-04-14-at-17.11.12.png 2040w" sizes="(min-width: 720px) 720px"/></figure><p>There are quite clear and broad instructions in the file, so I won&#39;t repeat the full process, but just highlight a few things: </p><p>A very important step - fill in as many keywords as you have on your mind. </p><figure><img src="https://timsh.org/content/images/2025/04/Screenshot-2025-04-14-at-17.18.04.png" alt="" loading="lazy" width="2000" height="720" srcset="https://timsh.org/content/images/size/w600/2025/04/Screenshot-2025-04-14-at-17.18.04.png 600w, https://timsh.org/content/images/size/w1000/2025/04/Screenshot-2025-04-14-at-17.18.04.png 1000w, https://timsh.org/content/images/size/w1600/2025/04/Screenshot-2025-04-14-at-17.18.04.png 1600w, https://timsh.org/content/images/2025/04/Screenshot-2025-04-14-at-17.18.04.png 2050w" sizes="(min-width: 720px) 720px"/></figure><p>Now that you&#39;ve put all the keywords in the list, run the cells below and it will create a <code>df_filtered</code> table with the requests (or responses) that match the keywords.</p><figure><img src="https://timsh.org/content/images/2025/04/Screenshot-2025-04-15-at-13.27.01.png" alt="" loading="lazy" width="2000" height="576" srcset="https://timsh.org/content/images/size/w600/2025/04/Screenshot-2025-04-15-at-13.27.01.png 600w, https://timsh.org/content/images/size/w1000/2025/04/Screenshot-2025-04-15-at-13.27.01.png 1000w, https://timsh.org/content/images/size/w1600/2025/04/Screenshot-2025-04-15-at-13.27.01.png 1600w, https://timsh.org/content/images/size/w2400/2025/04/Screenshot-2025-04-15-at-13.27.01.png 2400w" sizes="(min-width: 720px) 720px"/></figure><p>Here you&#39;ll see a snippet of the match (<code>matched_in_request</code> and <code>matched_in_response</code>), as well as the &#34;reason&#34; for both cases - the keyword(s) that are in the match. </p><p>Below is a simple <code>.loc</code> where you can input the index of the row (the first column on the left) and see the full value of a given column – in the example below, <code>&#34;full_reponse&#34;</code>.</p><figure><img src="https://timsh.org/content/images/2025/04/Screenshot-2025-04-15-at-13.29.55.png" alt="" loading="lazy" width="2000" height="261" srcset="https://timsh.org/content/images/size/w600/2025/04/Screenshot-2025-04-15-at-13.29.55.png 600w, https://timsh.org/content/images/size/w1000/2025/04/Screenshot-2025-04-15-at-13.29.55.png 1000w, https://timsh.org/content/images/size/w1600/2025/04/Screenshot-2025-04-15-at-13.29.55.png 1600w, https://timsh.org/content/images/size/w2400/2025/04/Screenshot-2025-04-15-at-13.29.55.png 2400w" sizes="(min-width: 720px) 720px"/></figure><p>And that&#39;s it! </p><p>Finally, if you want to help crowdsource the information on the kinds of data the apps from the list collect and share – <a href="https://forms.gle/Wyj1K54B5NQw3Vxt7?ref=timsh.org" rel="noreferrer">fill in the form</a>: </p><figure><a href="https://forms.gle/Wyj1K54B5NQw3Vxt7?ref=timsh.org"><div><p>I found something interesting in the app traffic</p><p>Hey! I don’t know how much people will go through with all the instructions and analysis, but since you’re here, you probably already did it and found something. Thanks for being here and doing this. Fill in the form below and your response will be recorded to a shared spreadsheet. PLEASE CHECK ALL OF YOUR INPUTS FOR YOUR PERSONAL INFORMATION. This form is set in a way that I collect nothing personal from you (like email or Google account or whatever), but your response will be viewable by virtually anyone - so be aware!</p><p><img src="https://timsh.org/content/images/icon/android_192.png" alt=""/><span>Google Docs</span></p></div><p><img src="https://timsh.org/content/images/thumbnail/jRCp4Akn5TH6KUw5HNa4mv0XrSReregDtVFTKJDD2eOqZtk6c3J69uGb5z85mbBlNu4ACbHFWRkUTBA-w1200-h630-p" alt="" onerror="this.style.display = &#39;none&#39;"/></p></a></figure><p>Please edit all the private information in your submission (in case it&#39;s there). </p><h3 id="room-for-improvement">Room for improvement?</h3><p>I know this is a very primitive way of doing things – I could&#39;ve done this all with <code>mitmdump</code> and automated saving / filtering straight to .csv, but I deliberately kept it semi-manual. </p><p>So I turned off the filters... and found this: </p><figure><img src="https://timsh.org/content/images/2025/04/Screenshot-2025-04-15-at-13.49.10.png" alt="" loading="lazy" width="1158" height="134" srcset="https://timsh.org/content/images/size/w600/2025/04/Screenshot-2025-04-15-at-13.49.10.png 600w, https://timsh.org/content/images/size/w1000/2025/04/Screenshot-2025-04-15-at-13.49.10.png 1000w, https://timsh.org/content/images/2025/04/Screenshot-2025-04-15-at-13.49.10.png 1158w" sizes="(min-width: 720px) 720px"/></figure><p><code>gs-loc.apple.com</code> is an endpoint used by Apple to request user&#39;s location information. </p><p>Anyway, the response to this request was encoded in protobuf format, so I had to find a way to decode it, obviously. And I found it. </p><p>But that&#39;s a topic for another post – stay tuned!</p><p>I really hope some people find this interesting enough to check at least 1 app and contribute to this process, or just to experiment and have fun. </p><p>If you have any comments, ideas or just want to chat about it – hit me up at <a href="mailto:hello@timsh.org" rel="noreferrer">hello@timsh.org</a>. </p>
        </section></div>
  </body>
</html>
