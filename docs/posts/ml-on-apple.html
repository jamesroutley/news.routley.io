<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mdcramer.github.io/apple-2-blog/k-means/">Original</a>
    <h1>ML on Apple ][&#43;</h1>
    
    <div id="readability-page-1" class="page"><div>
      
        <header>
          
          
        </header>
      

      <section itemprop="text">
        <p>Wait. Does k-means count as machine learning? Yes. Yes, it does.</p>

<p><a href="https://cs229.stanford.edu/" target="_blank">CS229</a> is the graduate-level machine learning course I took at Stanford as part of the <a href="https://www.linkedin.com/pulse/graduate-certificate-ai-achievement-unlocked-mark-cramer/" target="_blank">Graduate Certificate in AI</a> which I received back in 2021. While k-means is my choice as the easiest to understand algorithm in machine learning, it was taught as the introductory clustering algorithm for unsupervised learning. As a TA for <a href="https://online.stanford.edu/courses/xcs229-machine-learning" target="_blank">XCS229</a>, which I have been doing since 2022 and most recently did this Spring, I know that it is still being taught as part of this seminal course in AI.</p>

<h2 id="we-have-liftoff">We have liftoff!</h2>

<p>Unlike <a href="https://typesafety.net/apple-2-blog/synthesizing-data/">previously</a> where I saved the result for the end, let’s start by taking a look at the algorithm in action!</p>

<p><a href="https://youtube.com/shorts/Cy0wMMLObVA?autoplay=1" title="Video of Apple ]\[+ running k-means" target="_blank"><img src="https://img.youtube.com/vi/Cy0wMMLObVA/0.jpg" alt="Video of Apple 2+ running k-means"/></a></p>

<p>Here is a screenshot of the final decision boundary after convergence.</p>

<p><img src="https://typesafety.net/assets/images/apple2/k-means-convergence.jpg" alt="K-means decision boundary after convergence" title="K-means decision boundary after convergence"/></p>

<p>The final accuracy is 90% because 1 of the 10 observations is on the incorrect side of the decision boundary.</p>

<p>For debugging purposes, to speed up execution, I reduced the number of samples in each class to 5. (You might note that, on the graph, there are only 4 points in class 1, which are the □s. That’s because one of the points is at <code>(291, 90)</code>, which is off the edge of the screen. Gaussian distributions can generate extreme outliers, so I decided to preserve those points rather than clip them to the edge of the screen.) That’s obviously pretty small but you can see the algorithm iterating.</p>

<p>At the end of each loop I draw a line between the latest estimates of cluster centroids. The perpendicular bisector of these segments are the decision boundaries between the classes, so I draw them, too. Some of the code was written to handle more than two classes but here there are only two which makes this relatively easy.</p>

<h2 id="k-means-explained">K-means explained</h2>

<p><a href="https://en.wikipedia.org/wiki/K-means_clustering" target="_blank">K-means clustering</a> is a recursive algorithm that aims to partition \(n\) observations into \(k\) clusters in which each observation belongs to the cluster with the nearest mean, called the cluster centroid.</p>

<table>
  <thead>
    <tr>
      <th>Step</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Initialize</td>
      <td>Produce and initial set of k cluster centroids. This can be done by randomly choosing k observations from the dataset.</td>
    </tr>
    <tr>
      <td>Step 1 - Assignment</td>
      <td>Using Euclidean distance to the centroids, assign each observation to a cluster.</td>
    </tr>
    <tr>
      <td>Step 2 - Update</td>
      <td>For each cluster, recompute the centroid using the newly assigned observations. If the centroids change (outside of a certain tolerance), go back to step 1 and repeat.</td>
    </tr>
  </tbody>
</table>

<p>Ezpz.</p>

<p>The math is also simple. In step 1, the distance between two points, \(x\) and \(y\), is simply \(\sqrt{(x_0 - y_0)^2 + (x_1 - y_1)^2 + \cdots + (x_{d-1} - y_{d-1})^2}\), where \(d\) is the dimensionality of the observations. In our case \(d=2\) which is why we only have \(x_0\) and \(x_1\). Also, since we’re only using the distances for comparative purposes, it’s not even necessary to take the square root. In step 2, the centroid is simply the sum of all the points divided by the number of points.</p>

<h2 id="implementation">Implementation</h2>

<p>First, a little housekeeping before getting to the implementation of the algorithm.</p>

<div><div><pre><code><span>10</span>  <span>HOME</span> <span>:</span> <span>VTAB</span> <span>21</span>
<span>20</span>  <span>PI</span> <span>=</span> <span>3.14159265</span>
<span>30</span>  <span>GOSUB</span> <span>1000</span> <span>:</span> <span>REM  DRAW AXIS</span>
<span>40</span>  <span>GOSUB</span> <span>100</span> <span>:</span> <span>REM  GENERATE DATA</span>
<span>50</span>  <span>GOSUB</span> <span>900</span> <span>:</span> <span>REM  WAIT FOR KEY</span>
<span>60</span>  <span>GOSUB</span> <span>2000</span> <span>:</span> <span>REM  RUN K-MEANS</span>
<span>70</span>  <span>END</span>

<span>100</span> <span>REM  == HYPERPARAMETERS ==</span>
<span>...</span>
<span>450</span> <span>DIM</span> <span>P%</span><span>(</span><span>2</span><span>,</span><span>1</span><span>)</span> <span>:</span> <span>REM  RANDOM POINTS</span>
<span>460</span> <span>REM  == K-MEANS DATA TABLES ==</span>
<span>470</span> <span>DIM</span> <span>DI</span><span>(</span><span>NS</span> <span>-</span> <span>1</span><span>,</span><span>KN</span> <span>-</span> <span>1</span><span>)</span>
<span>480</span> <span>REM  -- K - MU-XO, MU-X1, N-K --</span>
<span>490</span> <span>DIM</span> <span>KM</span><span>(</span><span>KN</span> <span>-</span> <span>1</span><span>,</span><span>2</span><span>)</span>
<span>500</span> <span>REM  -- K - OLD MU-X0, OLD MU-X1 --</span>
<span>510</span> <span>DIM</span> <span>KO</span><span>(</span><span>KN</span> <span>-</span> <span>1</span><span>,</span><span>1</span><span>)</span>
<span>...</span>

<span>900</span> <span>REM  == WAIT FOR KEYSTROKE ==</span>
<span>910</span> <span>POKE</span> <span>49168</span><span>,</span><span>0</span> <span>:</span> <span>REM  CLEAR BUFFER</span>
<span>920</span> <span>IF</span> <span>PEEK</span><span>(</span><span>49152</span><span>)</span> <span>&lt;</span> <span>128</span> <span>GOTO</span> <span>920</span>
<span>930</span> <span>POKE</span> <span>49168</span><span>,</span><span>0</span>
<span>940</span> <span>RETURN</span>
</code></pre></div></div>

<p>At the very top of the program I decided to organize everything into subroutines. The idea here is to enable expansion into other ML algorithms.</p>

<p>The “wait for key” subroutine is the APPLESOFT BASIC method for simply waiting for any keystroke before continuing. (<code>PEEK</code> and <code>POKE</code> are commands for directly accessing addresses in memory. I had those numbers memorized in high school but, naturally, I had to look them up.) I thought it’d be nice to add this pause after generating the data but I might take it out later.</p>

<p>Lastly, at the end of the “hyperparameters” section I declare a convenience array, <code>P%(2,1)</code> to keep track of 3 random points as well as a few arrays I’m going to use in the k-means algorithm. The reason I do this here is because in APPLESOFT BASIC you get an error if you declare an array that already exists. Should at some point I want to call the k-means algorithm multiple times, this won’t be a problem.</p>

<h3 id="initialize">Initialize</h3>

<p>Getting started, the first thing to do is initialize the algorithm by generating \(k\) cluster centroids. (\(k\) is a hyperparameter that specifies the number of clusters to be “found.” I set it previously with <code>KN = 2</code>.)</p>

<div><div><pre><code><span>2000</span> <span>REM  == K-MEANS ==</span>
<span>2010</span> <span>PRINT</span> <span>&#34;RUN K-MEANS&#34;</span>
<span>2020</span> <span>REM  -- CLEAR PREDICTIONS --</span>
<span>2030</span> <span>FOR</span> <span>I</span> <span>=</span> <span>0</span> <span>TO</span> <span>NS</span> <span>-</span> <span>1</span>
<span>2040</span>   <span>DS%</span><span>(</span><span>I</span><span>,</span><span>3</span><span>)</span> <span>=</span> <span>0</span>
<span>2050</span> <span>NEXT</span> <span>I</span>
<span>2100</span> <span>REM  -- INITIALIZE CENTROIDS --</span>
<span>2110</span> <span>FOR</span> <span>I</span> <span>=</span> <span>0</span> <span>TO</span> <span>KN</span> <span>-</span> <span>1</span>
<span>2120</span>   <span>J</span> <span>=</span> <span>INT</span><span>(</span><span>RND</span><span>(</span><span>1</span><span>)</span> <span>*</span> <span>NS</span><span>)</span>
<span>2130</span>   <span>IF</span> <span>DS%</span><span>(</span><span>J</span><span>,</span><span>3</span><span>)</span> <span>=</span> <span>1</span> <span>GOTO</span> <span>2120</span>
<span>2140</span>   <span>KM</span><span>(</span><span>I</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>DS%</span><span>(</span><span>J</span><span>,</span><span>1</span><span>)</span>
<span>2150</span>   <span>KM</span><span>(</span><span>I</span><span>,</span><span>2</span><span>)</span> <span>=</span> <span>DS%</span><span>(</span><span>J</span><span>,</span><span>2</span><span>)</span>
<span>2160</span>   <span>DS%</span><span>(</span><span>J</span><span>,</span><span>3</span><span>)</span> <span>=</span> <span>1</span>
<span>2170</span> <span>NEXT</span> <span>I</span>
<span>2200</span> <span>REM  -- DRAW LINES BETWEEN CENTROIDS --</span>
<span>2210</span> <span>FOR</span> <span>I</span> <span>=</span> <span>1</span> <span>TO</span> <span>KN</span> <span>-</span> <span>1</span>
<span>2220</span>   <span>HPLOT</span> <span>KM</span><span>(</span><span>I</span><span>-</span><span>1</span><span>,</span><span>0</span><span>)</span><span>,</span> <span>159</span><span>-</span><span>KM</span><span>(</span><span>I</span><span>-</span><span>1</span><span>,</span><span>1</span><span>)</span> <span>TO</span> <span>KM</span><span>(</span><span>I</span><span>,</span><span>0</span><span>)</span><span>,</span> <span>159</span><span>-</span><span>KM</span><span>(</span><span>I</span><span>,</span><span>1</span><span>)</span>
<span>2230</span> <span>NEXT</span> <span>I</span>
<span>2240</span> <span>GOSUB</span> <span>3000</span><span>:</span> <span>REM  DRAW DECISION BOUNDARY</span>
</code></pre></div></div>

<p>I start by clearing out the prediction column, \(y\), of the dataset table, <code>DS%(NS - 1,3)</code> because I’m going to use this to make sure I don’t randomly pick the same point twice. Then for each class I randomly pick a point from the dataset. If it’s already been used I randomly pick another. <code>KM(KN - 1, 2)</code> is where I store the means for each cluster along with a count of the number of points in each cluster.</p>

<p>Finally, I draw a line between the cluster centroids. This loop does not take into account all combinations of centroids (it works fine if \(k=2\)) and generates an error if a centroid is off the screen, which is possible, so I might just get rid of this later, since it’s not really necessary, rather than try to fix it.</p>

<h3 id="step-1---assignment">Step 1 - Assignment</h3>

<p>The fist step is to assign every data point to the nearest cluster centroid.</p>

<div><div><pre><code><span>2300</span> <span>REM  -- COMPUTE ASSIGNMENTS --</span>
<span>2310</span> <span>FOR</span> <span>I</span> <span>=</span> <span>0</span> <span>TO</span> <span>NS</span> <span>-</span> <span>1</span>
<span>2320</span>   <span>PRINT</span> <span>&#34;POINT &#34;</span><span>;</span><span>I</span><span>;</span><span>&#34; AT &#34;</span><span>;</span><span>DS%</span><span>(</span><span>I</span><span>,</span><span>0</span><span>)</span><span>;</span><span>&#34;,&#34;</span><span>;</span><span>DS%</span><span>(</span><span>I</span><span>,</span><span>1</span><span>)</span><span>;</span>
<span>2330</span>   <span>DS%</span><span>(</span><span>I</span><span>,</span><span>3</span><span>)</span> <span>=</span> <span>0</span>
<span>2340</span>   <span>FOR</span> <span>J</span> <span>=</span> <span>0</span> <span>TO</span> <span>KN</span> <span>-</span> <span>1</span>
<span>2350</span>     <span>DI</span><span>(</span><span>I</span><span>,</span><span>J</span><span>)</span> <span>=</span> <span>(</span><span>DS%</span><span>(</span><span>I</span><span>,</span><span>0</span><span>)-</span><span>KM</span><span>(</span><span>J</span><span>,</span><span>0</span><span>))^</span><span>2</span> <span>+</span> <span>(</span><span>DS%</span><span>(</span><span>I</span><span>,</span><span>1</span><span>)-</span><span>KM</span><span>(</span><span>J</span><span>,</span><span>1</span><span>))^</span><span>2</span>
<span>2360</span>     <span>IF</span> <span>J</span> <span>&gt;</span><span>0</span> <span>AND</span> <span>(</span><span>DI</span><span>(</span><span>I</span><span>,</span><span>J</span><span>)</span> <span>&lt;</span> <span>DI</span><span>(</span><span>I</span><span>,</span><span>DS%</span><span>(</span><span>I</span><span>,</span><span>3</span><span>)))</span> <span>THEN</span> <span>DS%</span><span>(</span><span>I</span><span>,</span><span>3</span><span>)</span> <span>=</span> <span>J</span>
<span>2370</span>   <span>NEXT</span> <span>J</span>
<span>2380</span>   <span>PRINT</span> <span>&#34; -&gt; &#34;</span><span>;</span><span>DS%</span><span>(</span><span>I</span><span>,</span><span>3</span><span>)</span><span>;</span><span>&#34; Y^=&#34;</span><span>;</span><span>DS%</span><span>(</span><span>I</span><span>,</span><span>2</span><span>)</span>
<span>2390</span> <span>NEXT</span> <span>I</span>
<span>2500</span> <span>REM  -- COMPUTE ACCURACY --</span>
<span>2510</span> <span>CT</span> <span>=</span> <span>0</span>
<span>2520</span> <span>FOR</span> <span>I</span> <span>=</span> <span>0</span> <span>TO</span> <span>NS</span> <span>-</span> <span>1</span>
<span>2530</span>   <span>IF</span> <span>DS%</span><span>(</span><span>I</span><span>,</span><span>2</span><span>)</span> <span>=</span> <span>DS%</span><span>(</span><span>I</span><span>,</span><span>3</span><span>)</span> <span>THEN</span> <span>CT</span> <span>=</span> <span>CT</span> <span>+</span> <span>1</span>
<span>2540</span> <span>NEXT</span> <span>I</span>
<span>2550</span> <span>A</span> <span>=</span> <span>CT</span> <span>/</span> <span>NS</span>
<span>2560</span> <span>IF</span> <span>A</span> <span>&lt;</span> <span>0.5</span> <span>THEN</span> <span>A</span> <span>=</span> <span>1</span> <span>-</span> <span>A</span>
<span>2570</span> <span>PRINT</span> <span>&#34;ACCURACY = &#34;</span><span>;</span> <span>INT</span><span>(</span><span>A</span><span>*</span><span>10000</span><span>+</span><span>0.5</span><span>)/</span><span>100</span><span>;</span><span>&#34;%&#34;</span>
</code></pre></div></div>

<p>The assignment step is also quite easy. I loop through all the data points, computing the Euclidean distance to each cluster centroid. (Since <code>SQRT()</code> is expensive, and unnecessary here since we’re just comparing, I actually just compute the square of the Euclidean distance.) If the distance is less than the previous minimum distance, <code>DI(I,DS%(I,3))</code>, I update the assignment, <code>DS%(I,3) = J</code>.</p>

<p>At the end, I compute the accuracy of the computed assignments by simply counting the number of assignments, <code>DS%(I,3)</code>, that match the actual labels, <code>DS%(I,2)</code>. Here, however, there’s an interesting wrinkle: with two classes, half the time the label I choose for the assignment is the opposite of the label from the original dataset. K-means doesn’t require the distinction, so at times I was seeing a perfect classification reporting 0% accuracy. The line <code>IF A &lt; 0.5 THEN A = 1 - A</code> addresses this, however, it only works for 2 classes. I’ll need something more robust should I want this to work for \(k &gt; 2\).</p>

<h3 id="step-2---update">Step 2 - Update</h3>

<p>The second step is to recompute the cluster centroids based on the assigned data points. Convergence occurred if the centroids don’t change (within a tolerance) from the previous iteration.</p>

<div><div><pre><code><span>2600</span> <span>REM  -- COMPUTE CENTROIDS --</span>
<span>2610</span> <span>FOR</span> <span>J</span> <span>=</span> <span>0</span> <span>TO</span> <span>KN</span> <span>-</span> <span>1</span>
<span>2620</span>   <span>K0</span><span>(</span><span>J</span><span>,</span><span>0</span><span>)</span> <span>=</span> <span>KM</span><span>(</span><span>J</span><span>,</span><span>0</span><span>)</span>
<span>2630</span>   <span>K0</span><span>(</span><span>J</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>KM</span><span>(</span><span>J</span><span>,</span><span>1</span><span>)</span>
<span>2640</span>   <span>KM</span><span>(</span><span>J</span><span>,</span><span>0</span><span>)</span> <span>=</span> <span>0</span><span>:</span> <span>KM</span><span>(</span><span>J</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>0</span>
<span>2650</span>   <span>KM</span><span>(</span><span>J</span><span>,</span><span>2</span><span>)</span> <span>=</span> <span>0</span>
<span>2660</span> <span>NEXT</span>
<span>2670</span> <span>FOR</span> <span>I</span> <span>=</span> <span>0</span> <span>TO</span> <span>NS</span> <span>-</span> <span>1</span>
<span>2680</span>   <span>Y</span> <span>=</span> <span>DS%</span><span>(</span><span>I</span><span>,</span><span>3</span><span>)</span>
<span>2690</span>   <span>KM%</span><span>(</span><span>Y</span><span>,</span><span>0</span><span>)</span> <span>=</span> <span>KM%</span><span>(</span><span>Y</span><span>,</span><span>0</span><span>)</span> <span>+</span> <span>DS%</span><span>(</span><span>I</span><span>,</span><span>0</span><span>)</span>
<span>2700</span>   <span>KM%</span><span>(</span><span>Y</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>KM%</span><span>(</span><span>Y</span><span>,</span><span>1</span><span>)</span> <span>+</span> <span>DS%</span><span>(</span><span>I</span><span>,</span><span>1</span><span>)</span>
<span>2710</span>   <span>KM%</span><span>(</span><span>Y</span><span>,</span><span>2</span><span>)</span> <span>=</span> <span>KM%</span><span>(</span><span>Y</span><span>,</span><span>2</span><span>)</span> <span>+</span> <span>1</span>
<span>2720</span> <span>NEXT</span>
<span>2730</span> <span>FOR</span> <span>I</span> <span>=</span> <span>0</span> <span>TO</span> <span>KN</span> <span>-</span> <span>1</span>
<span>2740</span>   <span>KM%</span><span>(</span><span>I</span><span>,</span><span>0</span><span>)</span> <span>=</span> <span>KM%</span><span>(</span><span>I</span><span>,</span><span>0</span><span>)</span> <span>/</span> <span>KM%</span><span>(</span><span>I</span><span>,</span><span>2</span><span>)</span>
<span>2750</span>   <span>KM%</span><span>(</span><span>I</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>KM%</span><span>(</span><span>I</span><span>,</span><span>1</span><span>)</span> <span>/</span> <span>KM%</span><span>(</span><span>I</span><span>,</span><span>2</span><span>)</span>
<span>2760</span> <span>NEXT</span>
<span>2800</span> <span>REM  -- DETERMINE CONVERGENCE --</span>
<span>2810</span> <span>DI</span> <span>=</span> <span>0</span>
<span>2820</span> <span>FOR</span> <span>I</span> <span>=</span> <span>0</span> <span>TO</span> <span>KN</span> <span>-</span> <span>1</span>
<span>2830</span>   <span>DI</span> <span>=</span> <span>DI</span> <span>+</span> <span>(</span><span>KM%</span><span>(</span><span>I</span><span>,</span><span>0</span><span>)</span> <span>-</span> <span>KO%</span><span>(</span><span>I</span><span>,</span><span>0</span><span>))</span> <span>^</span> <span>2</span> <span>+</span> <span>(</span><span>KM%</span><span>(</span><span>I</span><span>,</span><span>1</span><span>)</span> <span>-</span> <span>KO%</span><span>(</span><span>I</span><span>,</span><span>1</span><span>))</span> <span>^</span> <span>2</span>
<span>2840</span> <span>NEXT</span>
<span>2850</span> <span>IF</span> <span>DI</span> <span>&gt;</span> <span>0.01</span> <span>THEN</span> <span>GOTO</span> <span>2200</span>
<span>2860</span> <span>PRINT</span> <span>&#34;K-MEANS CONVERGED&#34;</span>
<span>2900</span> <span>REM  -- CLEAR GRAPHICS AND REDRAW WITH DECISION BOUNDARY --</span>
<span>2910</span> <span>GOSUB</span> <span>1000</span>
<span>2920</span> <span>FOR</span> <span>I</span> <span>=</span> <span>0</span> <span>TO</span> <span>NS</span> <span>-</span> <span>1</span>
<span>2930</span>   <span>X0%</span> <span>=</span> <span>DS%</span><span>(</span><span>I</span><span>,</span><span>0</span><span>)</span>
<span>2940</span>   <span>X1%</span> <span>=</span> <span>DS%</span><span>(</span><span>I</span><span>,</span><span>1</span><span>)</span>
<span>2950</span>   <span>K</span> <span>=</span> <span>DS%</span><span>(</span><span>I</span><span>,</span><span>2</span><span>)</span>
<span>2960</span>   <span>ON</span> <span>K</span> <span>+</span> <span>1</span> <span>GOSUB</span> <span>1200</span><span>,</span><span>1300</span>
<span>2970</span> <span>NEXT</span>
<span>2980</span> <span>GOSUB</span> <span>3000</span>
<span>2990</span> <span>RETURN</span>
</code></pre></div></div>

<p>I start by saving the cluster centroids to <code>KO(KN - 1,1)</code>. This is used later to determine convergence. I then iterate through ever data point, adding it’s values to the cluster to which it belongs while keeping track of the number of data points in each cluster. Next I iterate through each cluster and compute the mean of each dimension by dividing by the number of data point in that cluster.</p>

<p>Lastly, I determine if there’s convergence by measuring how far all the centroid have moved. (Again, I don’t bother with the <code>SQRT()</code>.) If the answer is more than the specified tolerance, \(0.01\), I go back to Step #1. Otherwise, I clear the graphics, redraw the axis and data points and finish by drawing the decision boundary.</p>

<h3 id="drawing-the-decision-boundary">Drawing the decision boundary</h3>

<p>This code is a slog and it’s not really critical to understanding ML but I thought it’d be cool to drawn a decision boundary while k-means is iterating and then again at the end. Given a point (the midpoint on the segment between two cluster centroids) and a slope (which is perpendicular to that segment), the challenge is to drawn a line inside the ‘box’ of the screen, assuming the line intersects that box.</p>

<div><div><pre><code><span>3000</span> <span>REM  -- DRAW DECISION BOUNDARY --</span>
<span>3010</span> <span>FOR</span> <span>I</span> <span>=</span> <span>1</span> <span>TO</span> <span>KN</span> <span>-</span> <span>1</span>
<span>3020</span>   <span>M</span> <span>=</span> <span>1</span><span>E6</span>
<span>3030</span>   <span>IF</span> <span>KM%</span><span>(</span><span>I</span> <span>-</span> <span>1</span><span>,</span><span>1</span><span>)</span> <span>-</span> <span>KM%</span><span>(</span><span>I</span><span>,</span><span>1</span><span>)</span> <span>&lt;&gt;</span> <span>0</span> <span>THEN</span> <span>M</span> <span>=</span> <span>-</span><span>1</span> <span>*</span> <span>(</span><span>KM%</span><span>(</span><span>I</span> <span>-</span> <span>1</span><span>,</span><span>0</span><span>)</span> <span>-</span> <span>KM%</span><span>(</span><span>I</span><span>,</span><span>0</span><span>))</span> <span>/</span> <span>(</span><span>KM%</span><span>(</span><span>I</span> <span>-</span> <span>1</span><span>,</span><span>1</span><span>)</span> <span>-</span> <span>KM%</span><span>(</span><span>I</span><span>,</span><span>1</span><span>))</span>
<span>3040</span>   <span>P%</span><span>(</span><span>0</span><span>,</span><span>0</span><span>)</span> <span>=</span> <span>(</span><span>KM%</span><span>(</span><span>I</span><span>,</span><span>0</span><span>)</span> <span>-</span> <span>KM%</span><span>(</span><span>I</span> <span>-</span> <span>1</span><span>,</span><span>0</span><span>))</span> <span>/</span> <span>2</span> <span>+</span> <span>KM%</span><span>(</span><span>I</span> <span>-</span> <span>1</span><span>,</span><span>0</span><span>)</span>
<span>3050</span>   <span>P%</span><span>(</span><span>0</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>(</span><span>KM%</span><span>(</span><span>I</span><span>,</span><span>1</span><span>)</span> <span>-</span> <span>KM%</span><span>(</span><span>I</span> <span>-</span> <span>1</span><span>,</span><span>1</span><span>))</span> <span>/</span> <span>2</span> <span>+</span> <span>KM%</span><span>(</span><span>I</span> <span>-</span> <span>1</span><span>,</span><span>1</span><span>)</span>
<span>3060</span>   <span>GOSUB</span> <span>3500</span>
<span>3070</span> <span>NEXT</span>
<span>3080</span> <span>REM  -- DRAW LINE FROM SLOPE AND POINT --</span>
<span>3090</span> <span>NX</span> <span>=</span> <span>1</span> <span>:</span> <span>REM  -- REM NUMBER OF INTERSECTIONS --</span>
<span>3100</span> <span>IF</span> <span>ABS</span><span>(</span><span>M</span><span>)</span> <span>&gt;</span> <span>1</span><span>E5</span> <span>THEN</span> <span>GOSUB</span> <span>3240</span> <span>:</span> <span>GOTO</span> <span>3210</span> <span>:</span> <span>REM  VERTICAL LINE</span>
<span>3110</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>M</span> <span>*</span> <span>(</span><span>10</span> <span>-</span> <span>P%</span><span>(</span><span>0</span><span>,</span><span>0</span><span>))</span> <span>+</span> <span>P%</span><span>(</span><span>0</span><span>,</span><span>1</span><span>)</span>
<span>3120</span> <span>IF</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>1</span><span>)</span> <span>&gt;</span> <span>10</span> <span>AND</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>1</span><span>)</span> <span>&lt;</span> <span>149</span> <span>THEN</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>0</span><span>)</span> <span>=</span> <span>10</span> <span>:</span> <span>NX</span> <span>=</span> <span>NX</span> <span>+</span> <span>1</span>
<span>3130</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>M</span> <span>*</span> <span>(</span><span>269</span> <span>-</span> <span>P%</span><span>(</span><span>0</span><span>,</span><span>0</span><span>))</span> <span>+</span> <span>P%</span><span>(</span><span>0</span><span>,</span><span>1</span><span>)</span>
<span>3140</span> <span>IF</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>1</span><span>)</span> <span>&gt;</span> <span>10</span> <span>AND</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>1</span><span>)</span> <span>&lt;</span> <span>149</span> <span>THEN</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>0</span><span>)</span> <span>=</span> <span>269</span> <span>:</span> <span>NX</span> <span>=</span> <span>NX</span> <span>+</span> <span>1</span>
<span>3150</span> <span>IF</span> <span>NX</span> <span>=</span> <span>3</span> <span>THEN</span> <span>GOTO</span> <span>3210</span>
<span>3160</span> <span>IF</span> <span>M</span> <span>&lt;&gt;</span> <span>0</span> <span>THEN</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>0</span><span>)</span> <span>=</span> <span>(</span><span>10</span> <span>-</span> <span>P%</span><span>(</span><span>0</span><span>,</span><span>1</span><span>))</span> <span>/</span> <span>M</span> <span>+</span> <span>P%</span><span>(</span><span>0</span><span>,</span><span>0</span><span>)</span>
<span>3170</span> <span>IF</span> <span>M</span> <span>&lt;&gt;</span> <span>0</span> <span>AND</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>0</span><span>)</span> <span>&gt;</span> <span>10</span> <span>AND</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>0</span><span>)</span> <span>&lt;</span> <span>269</span> <span>THEN</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>10</span> <span>:</span> <span>NX</span> <span>=</span> <span>NX</span> <span>+</span> <span>1</span>
<span>3180</span> <span>IF</span> <span>NX</span> <span>=</span> <span>3</span> <span>THEN</span> <span>GOTO</span> <span>3210</span>
<span>3190</span> <span>IF</span> <span>M</span> <span>&lt;&gt;</span> <span>0</span> <span>THEN</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>0</span><span>)</span> <span>=</span> <span>(</span><span>149</span> <span>-</span> <span>P%</span><span>(</span><span>0</span><span>,</span><span>1</span><span>))</span> <span>/</span> <span>M</span> <span>+</span> <span>P%</span><span>(</span><span>0</span><span>,</span><span>0</span><span>)</span>
<span>3200</span> <span>IF</span> <span>M</span> <span>&lt;&gt;</span> <span>0</span> <span>AND</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>0</span><span>)</span> <span>&gt;</span> <span>10</span> <span>AND</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>0</span><span>)</span> <span>&lt;</span> <span>269</span> <span>THEN</span> <span>P%</span><span>(</span><span>NX</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>149</span> <span>:</span> <span>NX</span> <span>=</span> <span>NX</span> <span>+</span> <span>1</span>
<span>3210</span> <span>REM  -- DRAW LINE --</span>
<span>3220</span> <span>IF</span> <span>NX</span> <span>=</span> <span>3</span> <span>THEN</span> <span>HPLOT</span> <span>P%</span><span>(</span><span>1</span><span>,</span><span>0</span><span>)</span><span>,</span><span>159</span> <span>-</span> <span>P%</span><span>(</span><span>1</span><span>,</span><span>1</span><span>)</span> <span>TO</span> <span>P%</span><span>(</span><span>2</span><span>,</span><span>0</span><span>)</span><span>,</span><span>159</span> <span>-</span> <span>P%</span><span>(</span><span>2</span><span>,</span><span>1</span><span>)</span>
<span>3230</span> <span>RETURN</span>
<span>3240</span> <span>REM  -- VERTICAL LINE --</span>
<span>3250</span> <span>P%</span><span>(</span><span>1</span><span>,</span><span>0</span><span>)</span> <span>=</span> <span>P%</span><span>(</span><span>0</span><span>,</span><span>0</span><span>)</span>
<span>3260</span> <span>P%</span><span>(</span><span>2</span><span>,</span><span>0</span><span>)</span> <span>=</span> <span>P%</span><span>(</span><span>0</span><span>,</span><span>0</span><span>)</span>
<span>3270</span> <span>P%</span><span>(</span><span>1</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>10</span>
<span>3280</span> <span>P%</span><span>(</span><span>2</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>269</span>
<span>3290</span> <span>RETURN</span>
</code></pre></div></div>

<p>Without delving too far into the details, this routine relies heavily on the convenience array, <code>P%(2,1)</code>, that I declared during the “hyperparameters” routine. I start by computing the slope of the perpendicular segment connecting two centroids. I then find the midpoint of that segment. (By the way, this routine also does not account for all combinations of centroids, but it works when \(k=2\).) I accommodate for when the slope is vertical and use <code>P%(0,0)</code> and <code>P%(0,1)</code> to store the midpoint between the two centroids and <code>M</code> for the slope.</p>

<p>I then iterate through the 4 sides of the ‘box’ on the screen, using the corners <code>(10,10)</code> and <code>(269,149)</code> so that the decision boundary isn’t drawn all the way to the edges of the screen. I thought that would look prettier this way. I next determine if the decision boundary intersects, respectively, the left, right, top and bottom edges of the box. I use <code>NX</code> to keep track of the number of sides of the box intersected by the decision boundary and <code>P%(NX,0)</code> and <code>P%(NX,1)</code> to keep track of those intersections. If <code>NX = 3</code>, which means there are two intersections, I draw the line because it’s inside the box.</p>

<h2 id="can-we-do-better">Can we do better?</h2>

<p>Yes! Yes, we can.</p>

<p>While k-means is simple, it does not take advantage of our knowledge of the Gaussian nature of the data. If we know that the distributions are Gaussian, which is very frequently the case in machine learning, we can employ a more powerful algorithm: Expectation Maximization (EM). This post is already long enough, so we’ll deal with that another day. Eventually, perhaps, we’ll also get to deep learning, although developing back propagation for an arbitrary size neural net using APPLESOFT BASIC on an <span>Apple ][+</span> is not going to be easy.</p>

        
      </section>

      

  
</div></div>
  </body>
</html>
