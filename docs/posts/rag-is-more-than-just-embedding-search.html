<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jxnl.github.io/instructor/blog/2023/09/17/rag-is-more-than-just-embedding-search/">Original</a>
    <h1>Rag is more than just embedding search</h1>
    
    <div id="readability-page-1" class="page"><div data-md-component="container">
      
      
        
      
      <main data-md-component="main">
        <div>
          
            
              
                
              
              
            
            
              
                
              
              
            
          
          
  <div data-md-component="content">
    
    <article>
      
        

  
  



<p>With the advent of large language models (LLM), retrival augmented generation (RAG) has become a hot topic. However throught the past year of <a href="https://jxnl.notion.site/Working-with-me-ec2bb36a5ac048c2a8f6bd888faea6c2?pvs=4">helping startups</a> integrate LLMs into their stack I&#39;ve noticed that the pattern of taking user queries, embedding them, and directly searching a vector store is effectively demoware.</p>
<div>
<p>What is RAG?</p>
<p>Retrival augmented generation (RAG) is a technique that uses a LLM to generate responses, but uses a search backend to augment the generation, in the past year using text embeddings with a vector databases has been the most popular approach I&#39;ve seen being socialized.</p>
</div>
<figure>
<p><img alt="RAG" src="https://jxnl.github.io/instructor/blog/img/dumb_rag.png"/>
  </p>
<figcaption>Simple RAG that embedded the user query and makes a search.</figcaption>
</figure>
<p>So let&#39;s kick things off by examining what I like to call the &#39;Dumb&#39; RAG Modelâ€”a basic setup that&#39;s more common than you&#39;d think.</p>
<h2 id="the-dumb-rag-model">The &#39;Dumb&#39; RAG Model</h2>
<p>When you ask a question like, &#34;what is the capital of France?&#34; The RAG &#39;dumb&#39; model embeds the query and searches in some unopinonated search endpoint. Limited to a single method API like <code>search(query: str) -&gt; List[str]</code>. This is fine for simple queries, since you&#39;d expect words like &#39;paris is the capital of france&#39; to be in the top results of say, your wikipedia embeddings.</p>
<h3 id="why-is-this-a-problem">Why is this a problem?</h3>
<ul>
<li>
<p><strong>Query-Document Mismatch</strong>: This model assumes that query embedding and the content embedding are similar in the embedding space, which is not always true based on the text you&#39;re trying to search over. Only using queries that are semantically similar to the content is a huge limitation!</p>
</li>
<li>
<p><strong>Monolithic Search Backend</strong>: Assumes a single search backend, which is not always the case. You may have multiple search backends, each with their own API, and you want to route the query to vector stores, search clients, sql databases, and more.</p>
</li>
<li>
<p><strong>Limitation of text search</strong>: Restricts complex queries to a single string (<code>{query: str}</code>), sacrificing expressiveness, in using keywords, filters, and other advanced features. For example, <code>what problems did we fix last week</code> that cannot be answered by a simple text search, since documents that contain <code>problem, last week</code> are going to be present at every week.</p>
</li>
<li>
<p><strong>Limited ability to plan</strong>: Assumes that the query is the only input to the search backend, but you may want to use other information to improve the search, like the user&#39;s location, or the time of day using the context to rewrite the query. For example, if you present the language model of more context its able to plan a suite of queries to execute to return the best results.</p>
</li>
</ul>
<p>Now let&#39;s dive into how we can make it smarter with query understanding. This is where things get interesting.</p>
<h2 id="improving-the-rag-model-with-query-understanding">Improving the RAG Model with Query Understanding</h2>

<p>Ultimately what you want to deploy is a <a href="https://en.wikipedia.org/wiki/Query_understanding">system that understands</a> how to take the query and rewrite it to improve precision and recall. </p>
<figure>
<p><img alt="RAG" src="https://jxnl.github.io/instructor/blog/img/query_understanding.png"/>
  </p>
<figcaption>Query Understanding system routes to multiple search backends.</figcaption>
</figure>
<p>Not convinced? Let&#39;s move from theory to practice with a real-world example. First up, Metaphor Systems.</p>
<h2 id="whats-instructor">Whats instructor?</h2>
<p>Instructor uses Pydantic to simplify the interaction between the programmer and language models via the function calling api..</p>
<ul>
<li><strong>Widespread Adoption</strong>: Pydantic is a popular tool among Python developers.</li>
<li><strong>Simplicity</strong>: Pydantic allows model definition in Python.</li>
<li><strong>Framework Compatibility</strong>: Many Python frameworks already use Pydantic.</li>
</ul>

<p>Take <a href="https://metaphor.systems">Metaphor Systems</a>, which turns natural language queries into their custom search-optimized query. If you take a look web ui you&#39;ll notice that they have an auto-prompt option, which uses function calls to furthur optimize your query using an language model, and turn it into a fully specified metaphor systems query.</p>
<figure>
<p><img alt="Metaphor Systems" src="https://jxnl.github.io/instructor/blog/img/meta.png"/></p>
<figcaption>Metaphor Systems UI</figcaption>
</figure>
<p>If we peek under the hood, we can see that the query is actually a complex object, with a date range, and a list of domains to search in. Its actually more complex than this but this is a good start. We can model this structured output in Pydantic using the instructor library</p>
<div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span>class</span> <span>DateRange</span><span>(</span><span>BaseModel</span><span>):</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span>start</span><span>:</span> <span>datetime</span><span>.</span><span>date</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span>end</span><span>:</span> <span>datetime</span><span>.</span><span>date</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span>class</span> <span>MetaphorQuery</span><span>(</span><span>BaseModel</span><span>):</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span>rewritten_query</span><span>:</span> <span>str</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span>published_daterange</span><span>:</span> <span>DateRange</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span>domains_allow_list</span><span>:</span> <span>List</span><span>[</span><span>str</span><span>]</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span>async</span> <span>def</span> <span>execute</span><span>():</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>        <span>return</span> <span>await</span> <span>metaphor</span><span>.</span><span>search</span><span>(</span><span>...</span><span>)</span>
</span></code></pre></div>
<p>Note how we model a rewritten query, range of published dates, and a list of domains to search in. This is a powerful pattern allows the user query to be restructured for better performance without the user having to know the details of how the search backend works. </p>
<div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span>import</span> <span>instructor</span> 
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span>import</span> <span>openai</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span># Enables response_model in the openai client</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span>instructor</span><span>.</span><span>patch</span><span>()</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span>query</span> <span>=</span> <span>openai</span><span>.</span><span>ChatCompletion</span><span>.</span><span>create</span><span>(</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span>model</span><span>=</span><span>&#34;gpt-4&#34;</span><span>,</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span>response_model</span><span>=</span><span>MetaphorQuery</span><span>,</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span>messages</span><span>=</span><span>[</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>        <span>{</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>            <span>&#34;role&#34;</span><span>:</span> <span>&#34;system&#34;</span><span>,</span> 
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>            <span>&#34;content&#34;</span><span>:</span> <span>&#34;You&#39;re a query understanding system for the Metafor Systems search engine. Here are some tips: ...&#34;</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>        <span>},</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>        <span>{</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>            <span>&#34;role&#34;</span><span>:</span> <span>&#34;user&#34;</span><span>,</span> 
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>            <span>&#34;content&#34;</span><span>:</span> <span>&#34;What are some recent developments in AI?&#34;</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>        <span>}</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    <span>],</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span>)</span>
</span></code></pre></div>
<p><strong>Example Output</strong></p>
<div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span>{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span>    </span><span>&#34;rewritten_query&#34;</span><span>:</span><span> </span><span>&#34;novel developments advancements ai artificial intelligence machine learning&#34;</span><span>,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span>    </span><span>&#34;published_daterange&#34;</span><span>:</span><span> </span><span>{</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span>        </span><span>&#34;start&#34;</span><span>:</span><span> </span><span>&#34;2023-09-17&#34;</span><span>,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span>        </span><span>&#34;end&#34;</span><span>:</span><span> </span><span>&#34;2021-06-17&#34;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span>    </span><span>},</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span>    </span><span>&#34;domains_allow_list&#34;</span><span>:</span><span> </span><span>[</span><span>&#34;arxiv.org&#34;</span><span>]</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span>}</span>
</span></code></pre></div>
<p>This isn&#39;t just about adding some date ranges. It&#39;s about nuanced, tailored searches, that is deeply integrated with the backend. Metaphor Systems has a whole suite of other filters and options that you can use to build a powerful search query. They can even use some chain of thought prompting to improve how they use some of these advanced features.</p>
<div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span>class</span> <span>DateRange</span><span>(</span><span>BaseModel</span><span>):</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span>start</span><span>:</span> <span>datetime</span><span>.</span><span>date</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span>end</span><span>:</span> <span>datetime</span><span>.</span><span>date</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span>chain_of_thought</span><span>:</span> <span>str</span> <span>=</span> <span>Field</span><span>(</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        <span>None</span><span>,</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span>description</span><span>=</span><span>&#34;Think step by step to plan what is the best time range to search in&#34;</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span>)</span>
</span></code></pre></div>
<p>Now, let&#39;s see how this approach can help model an agent like personal assistant.</p>
<h2 id="case-study-2-personal-assistant">Case Study 2: Personal Assistant</h2>
<p>Another great example of this multiple dispatch pattern is a personal assistant. You might ask, &#34;What do I have today?&#34;, from a vague query you might want events, emails, reminders etc. That data will likely exist in multiple backends, but what you want is one unified summary of results. Here you can&#39;t assume that text of those documents are all embedded in a search backend. There might be a calendar client, email client, across personal and profession accounts.</p>
<div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span>class</span> <span>ClientSource</span><span>(</span><span>enum</span><span>.</span><span>Enum</span><span>):</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span>GMAIL</span> <span>=</span> <span>&#34;gmail&#34;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span>CALENDAR</span> <span>=</span> <span>&#34;calendar&#34;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span>class</span> <span>SearchClient</span><span>(</span><span>BaseModel</span><span>):</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span>query</span><span>:</span> <span>str</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span>keywords</span><span>:</span> <span>List</span><span>[</span><span>str</span><span>]</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span>email</span><span>:</span> <span>str</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span>source</span><span>:</span> <span>ClientSource</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span>start_date</span><span>:</span> <span>datetime</span><span>.</span><span>date</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span>end_date</span><span>:</span> <span>datetime</span><span>.</span><span>date</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span>async</span> <span>def</span> <span>execute</span><span>(</span><span>self</span><span>)</span> <span>-&gt;</span> <span>str</span><span>:</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>        <span>if</span> <span>self</span><span>.</span><span>source</span> <span>==</span> <span>ClientSource</span><span>.</span><span>GMAIL</span><span>:</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>            <span>...</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>        <span>elif</span> <span>self</span><span>.</span><span>source</span> <span>==</span> <span>ClientSource</span><span>.</span><span>CALENDAR</span><span>:</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>            <span>...</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span>class</span> <span>Retrival</span><span>(</span><span>BaseModel</span><span>):</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>    <span>queries</span><span>:</span> <span>List</span><span>[</span><span>SearchClient</span><span>]</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>    <span>async</span> <span>def</span> <span>execute</span><span>(</span><span>self</span><span>)</span> <span>-&gt;</span> <span>str</span><span>:</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>        <span>return</span> <span>await</span> <span>asyncio</span><span>.</span><span>gather</span><span>(</span><span>*</span><span>[</span><span>query</span><span>.</span><span>execute</span><span>()</span> <span>for</span> <span>query</span> <span>in</span> <span>self</span><span>.</span><span>queries</span><span>])</span>
</span></code></pre></div>
<p>Now we can call this with a simple query like &#34;What do I have today?&#34; and it will try to async dispatch to the correct backend. Its will important to prompt the language model well, but we&#39;ll leave that for another day.</p>
<div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span>import</span> <span>instructor</span> 
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span>import</span> <span>openai</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span># Enables response_model in the openai client</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span>instructor</span><span>.</span><span>patch</span><span>()</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span>retrival</span> <span>=</span> <span>openai</span><span>.</span><span>ChatCompletion</span><span>.</span><span>create</span><span>(</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span>model</span><span>=</span><span>&#34;gpt-4&#34;</span><span>,</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span>response_model</span><span>=</span><span>Retrival</span><span>,</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span>messages</span><span>=</span><span>[</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>        <span>{</span><span>&#34;role&#34;</span><span>:</span> <span>&#34;system&#34;</span><span>,</span> <span>&#34;content&#34;</span><span>:</span> <span>&#34;You are Jason&#39;s personal assistant.&#34;</span><span>},</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>        <span>{</span><span>&#34;role&#34;</span><span>:</span> <span>&#34;user&#34;</span><span>,</span> <span>&#34;content&#34;</span><span>:</span> <span>&#34;What do I have today?&#34;</span><span>}</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    <span>],</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span>)</span>
</span></code></pre></div>
<p><strong>Example Output</strong></p>
<div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span>{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span>    </span><span>&#34;queries&#34;</span><span>:</span><span> </span><span>[</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span>        </span><span>{</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span>            </span><span>&#34;query&#34;</span><span>:</span><span> </span><span>No</span><span>ne</span><span>,</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span>            </span><span>&#34;keywords&#34;</span><span>:</span><span> </span><span>No</span><span>ne</span><span>,</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span>            </span><span>&#34;email&#34;</span><span>:</span><span> </span><span>&#34;jason@example.com&#34;</span><span>,</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span>            </span><span>&#34;source&#34;</span><span>:</span><span> </span><span>&#34;gmail&#34;</span><span>,</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span>            </span><span>&#34;start_date&#34;</span><span>:</span><span> </span><span>&#34;2023-09-17&#34;</span><span>,</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span>            </span><span>&#34;end_date&#34;</span><span>:</span><span> </span><span>No</span><span>ne</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span>        </span><span>},</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span>        </span><span>{</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span>            </span><span>&#34;query&#34;</span><span>:</span><span> </span><span>No</span><span>ne</span><span>,</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span>            </span><span>&#34;keywords&#34;</span><span>:</span><span> </span><span>[</span><span>&#34;meeting&#34;</span><span>,</span><span> </span><span>&#34;call&#34;</span><span>,</span><span> </span><span>&#34;zoom&#34;</span><span>]]],</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span>            </span><span>&#34;email&#34;</span><span>:</span><span> </span><span>&#34;jason@example.com&#34;</span><span>,</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span>            </span><span>&#34;source&#34;</span><span>:</span><span> </span><span>&#34;calendar&#34;</span><span>,</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span>            </span><span>&#34;start_date&#34;</span><span>:</span><span> </span><span>&#34;2023-09-17&#34;</span><span>,</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span>            </span><span>&#34;end_date&#34;</span><span>:</span><span> </span><span>No</span><span>ne</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span>        </span><span>}</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span>    </span><span>]</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span>}</span>
</span></code></pre></div>
<p>Notice that we have a list of queries, that route to different search backends, email and calendar. We can even dispatch them async to be as performance as possible. Not only do we dispatch to different backends (that we have no control over), but you are likely going to render them to the user differently as well, perhaps you want to summarize the emails in text, but you want to render the calendar events as a list that they can scroll across on a mobile app.</p>
<div>
<p>Can I used framework X?</p>
<p>I get this question many times, but its just code, within these dispatchs you can do whatever you want. You can use <code>input()</code> to ask the user for more information, make a post request, call a Langchain agent or LLamaindex query engine to get more information, the sky is the limit.</p>
</div>
<p>Both of these examples show case how both search providors and consumers can use <code>instructor</code> to model their systems. This is a powerful pattern that allows you to build a system that can be used by anyone, and can be used to build a LLM layer, from scratch, in front of any arbitrary backend.</p>
<h2 id="conclusion">Conclusion</h2>
<p>This isnt about fancy embedding tricks, its just plain old information retrival and query understanding. The beauty of instructor is that it simplifies modeling the complex and lets you define the output of the language model, the prompts, and the payload we send to the backend in a single place.</p>
<h2 id="whats-next">What&#39;s Next?</h2>
<p>Here I want to show that `instructor`` isnâ€™t just about data extraction. Itâ€™s a powerful framework for building a data model and integrating it with your LLM. Structured output is just the beginning â€” the untapped goldmine is skilled use of tools and APIs.</p>
<p>I believe collaboration between domain experts and AI engineers the key to enable advanced tool use. Iâ€™ve been building a new tool on top of instructor that enables seamless collaboration and experimentation on LLMs with structured outputs. If youâ€™re interested, visit <a href="https://useinstructor.com">useinstructor.com</a> and take our survey to join the waitlist.
Together, letâ€™s create tools that are as brilliant as the minds that use them.</p>


  


  



      
    </article>
  </div>

          
        </div>
        
      </main>
      
        
      
    </div></div>
  </body>
</html>
