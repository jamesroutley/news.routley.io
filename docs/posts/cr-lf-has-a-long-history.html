<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.revk.uk/2022/02/crlf-has-long-history.html">Original</a>
    <h1>CR&#43;LF Has a Long History</h1>
    
    <div id="readability-page-1" class="page"><div id="post-body-77342602011081504" itemprop="description articleBody">
<p>The ASR33, like most teletypes of the era, works at a fixed rate. It does 10 characters per second. It is 110 Baud, using 1 start, 8 data (inc parity), and 2 stop, so 10cps Tx and 10cps Rx; 10cps printing; 10cps punching tape; 10cps reading tape; 10cps maximum typing speed. Everything happens based on one motor that does this 10cps working, engaging clutches to start an operation which completes in one turn. So everything has to happen within 100ms, well, sort of.</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEh9_L5zwZOEH5Ku2fIX5LBP8GAzb0xRRnUx6j7y6nYNDFrTjtB4NH4UYK_1q4Qt6DfCs4SEFsXentQWm-ib38EMFjQbzYsCU2u-oR_GWHfaBcJP5YldhIELajOeXn4oI66xtWpYmR11qNHzAWub96BYhlh3JGIVs_L2mjr_f_J0HQqGf_x-HrF_pVgJtg=s4031"><img data-original-height="3023" data-original-width="4031" height="300" src="https://blogger.googleusercontent.com/img/a/AVvXsEh9_L5zwZOEH5Ku2fIX5LBP8GAzb0xRRnUx6j7y6nYNDFrTjtB4NH4UYK_1q4Qt6DfCs4SEFsXentQWm-ib38EMFjQbzYsCU2u-oR_GWHfaBcJP5YldhIELajOeXn4oI66xtWpYmR11qNHzAWub96BYhlh3JGIVs_L2mjr_f_J0HQqGf_x-HrF_pVgJtg=w400-h300" width="400"/></a></p><p>There is one exception: <i>carriage return</i> [CR]. The carriage is released within the 100ms time, but the carriage is on a spring, and does not get back to the left within 100ms if it is too far over to the right. The usual fix is to send another <i>non printing</i> character, such as a <i>line feed</i> [LF], as the next character, where CR and LF are used for each <i>new line</i>. The paper advances whilst the carriage is returning so giving the carriage a whole 200ms to complete the return. This allows enough time to get to the left, but can leave the carriage still bouncing and mean the first printable character is not well aligned. The fact that 200ms is enough is usually fine, unless you are particularly fussy. The fix to this is to send another <i>non printing</i> character, such as a NULL, another CR, or even a <i>rub out</i> [RO]. The standard HEREIS drum coding even specifies CR, LF and RO at the start.</p><p>If you do send characters immediately following a CR, you get them printed in the <i>fly-back</i> of the carriage, like this...</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEiYfUvDl8e2clGF2Co8vJ3bYE5rImmF3BBRYbNCr9X8_uTrQZPPazr7ZXYMgZJcunHIw6AkpA3PRKrdV1frB2kvKz4ehgByhs7COtqSa85MiHMY28KQ94uaAQGxCFquTCJVW4NcGENd3xHZ0veFBpjOGRuSUgMxdy784UNhTN9f5QcDPhm7iLe5cV8S_w=s2267"><img data-original-height="1506" data-original-width="2267" height="266" src="https://blogger.googleusercontent.com/img/a/AVvXsEiYfUvDl8e2clGF2Co8vJ3bYE5rImmF3BBRYbNCr9X8_uTrQZPPazr7ZXYMgZJcunHIw6AkpA3PRKrdV1frB2kvKz4ehgByhs7COtqSa85MiHMY28KQ94uaAQGxCFquTCJVW4NcGENd3xHZ0veFBpjOGRuSUgMxdy784UNhTN9f5QcDPhm7iLe5cV8S_w=w400-h266" width="400"/></a></p><p>The whole “new line = CR+LF” thing has plagued computing for the last 6 decades, with some systems and file formats using CR as new line, some LF, and some CR+LF. Even today I can find I have a file in <i>DOS format</i> using CR+LF that needs converting.</p><div><p>The software I have written in the controller allows for this when printing text itself, doing CR, LF for new line, and adding a NULL if beyond 40 columns at the time. This works, and is used for prompts and even the Colossal Cave game that is built in.</p><p>However, this presents a few issues :- </p><ul><li>This works when generating text, but if in some sort of <i>raw</i> mode it mean the sending device needs to know to do this. Some systems know, some do not.</li><li>If this is done automatically, so extra characters are inserted that is not a problem for printing, but for punching paper tape it records those extra characters. That said, a NULL or RO on paper tape should not normally be an issue when read in. But it is not ideal, and assumes it is not binary data on the paper tape for some reason. So you sort of need a <i>raw</i> or <i>processed</i> mode for handling such tape, which is messy.</li><li>Paper tape is sometimes used for raw / binary data, but can also be used for “large text” or patterns (which is gibberish as printed). Whilst fun, this also has a practical use to label reels of paper tape at the start in a human readable format. If automatic extra characters for CR handling are added, they mess this up.</li></ul><h3>A new solution to an old problem...</h3><p>My solution works because we are now using a soft UART. I am doing this, working the individual data bits on a timer interrupt, to allow the extra low Baud rates used by some teletypes, which are not supported by hardware UARTs. Some work as low as 45.45 Baud even.</p><p>The soft UART has now been coded so that the bytes, as actually sent to the teletype (i.e. not when buffered/queued, but in real time), are tracked to know carriage position, and operate a timer between sending a CR and the next <i>printable</i> character. A <i>non printable</i> character like a NL, NULL, RO, are allowed within this timeout, but the timeout has to finish before the first <i>printable</i> character after a CR. This allows the CR to complete and avoids printing a character during the fly-back of the carriage.</p><p>This means :- </p><ul><li>Where the sending device is sending the extra characters, even just a CR, LF, to allow for CR, then the operation is totally unchanged. This makes it 100% backwards compatible with existing working of teletypes and means no special <i>raw</i> or <i>processed</i> modes needed.</li><li>Where the CR needs this extra time it can be done in sub character, even sub bit, periods, not wasting the time for a whole extra character such as a NULL.</li><li>The delay can be adjusted for the position of the carriage, and hence allow just the time it will take to complete the return.</li><li>This works even when CR is immediately followed by a printable character (causing a pause you can just hear on longer lines).</li><li>No extra characters are actually inserted, so characters as punched on paper tape are perfect, no gaps or ROs, etc.</li></ul><p>This works well, even with a printable character immediately following the CR, like this...</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEjpybrrupsNeVqtp4FKBdCKWtZHB_I7_DoFX8qWjw2hCxkf0h7g9Ir9ZVtdtwIhN1EUWphquSMAwCHdIaK3zcBFQ3TqiX2eXt2qgzMDxlG8QwGpQ8Aw6kbtudwy4ADRbwKkdf9x04l7Y1MJ9kHMRlraCWIpN-ywUr486zU40k-DuuO_E_zC8AIC-RWwvw=s2273"><img data-original-height="1535" data-original-width="2273" height="270" src="https://blogger.googleusercontent.com/img/a/AVvXsEjpybrrupsNeVqtp4FKBdCKWtZHB_I7_DoFX8qWjw2hCxkf0h7g9Ir9ZVtdtwIhN1EUWphquSMAwCHdIaK3zcBFQ3TqiX2eXt2qgzMDxlG8QwGpQ8Aw6kbtudwy4ADRbwKkdf9x04l7Y1MJ9kHMRlraCWIpN-ywUr486zU40k-DuuO_E_zC8AIC-RWwvw=w400-h270" width="400"/></a></p><h3>Today I learned...</h3><p>What is funny (well, for me) is that there will be people who have worked in computing and IT for decades and encountered the whole craziness that is CR and LF, but have no idea why it was ever a thing. I hope this, in some way, explains some of the background.</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEjVfsRUmZTp6Zx-hYVwLeg63Ia6fEnnzwUPqin3ZHmG0_xVtUEG0nq5vE9wnMi0UU_gF89lnf8-TV0Joh4i1VYEeaft0DaO_uVGIL8ljFsjIsX0eqyzuNSEWpn7upyipF5WWIFCOaqF7Vp3QOv__7a-4HoGLuw28HWRrsZFizzaFDfQcIec6bEXGgQu-Q=s924"><img data-original-height="633" data-original-width="924" height="274" src="https://blogger.googleusercontent.com/img/a/AVvXsEjVfsRUmZTp6Zx-hYVwLeg63Ia6fEnnzwUPqin3ZHmG0_xVtUEG0nq5vE9wnMi0UU_gF89lnf8-TV0Joh4i1VYEeaft0DaO_uVGIL8ljFsjIsX0eqyzuNSEWpn7upyipF5WWIFCOaqF7Vp3QOv__7a-4HoGLuw28HWRrsZFizzaFDfQcIec6bEXGgQu-Q=w400-h274" width="400"/></a></p></div>

</div></div>
  </body>
</html>
