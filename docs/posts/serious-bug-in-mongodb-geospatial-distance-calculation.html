<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.icod.de/2022/05/19/serious-bug-in-mongodb-geospatial-distance-calculation/">Original</a>
    <h1>Serious Bug in MongoDB Geospatial distance calculation</h1>
    
    <div id="readability-page-1" class="page"><article id="post-1770">
		<!-- .entry-header -->

	
	<div>
		
<p><span>Since reporting bugs in MongoDB is not longer possible for the average human, because you now have to be a MongoDB employee with an @mongodb.com email address and 2FA to even link your mongodb account with MongoDB’s JIRA, I’ll have to write this blog post.</span></p>
<p><span>I did try to contact customer service online but I’m not waiting around to help YOU on my time. Seriously WTF? If you don’t want bug reports don’t put up a “reporting bugs” page and make it virtually impossible to do. Just say “we don’t want bug reports from common plebs”.</span></p>
<p><strong>Correction</strong>: You have a very short window where you can select if you’re an employee or customer/user when trying to sign in to MongoDB’s Jira. Since I was gathering information in other tabs I have missed that window and it redirected to the login for employees by default.</p>
<p><strong>Correction2</strong>: It’s not MongoDB, it’s MongoDB’s Go driver.</p>
<p>On to the bug. It started when I hit inconsistencies in the distance results vs the results of 2 other geospatial libraries. The 2 libraries are:</p>
<p>“github.com/kellydunn/golang-geo”</p>
<p>MongoDB uses the s2 lib (c++ version) as well. And from their <a href="https://www.mongodb.com/docs/manual/reference/geojson/">GeoJSON documentation</a> they require the ‘Point’ type to be in Longitude, Latitude order.</p>
<p>At first I didn’t know how to use the s2 lib so I asked the question on their repository on github:</p>
<p>And everything is explained there, but I’ll give you a summary.</p>
<p>In essence, as I already wrote, MongoDB requires the GeoJSON Point to be in Long, Lat order, but internally, since the very beginning MongoDB calculates the distance between 2 points in Lat, Long order. It uses Latitude for Longitude and Longitude for Latitude in their Point to Point distance calculation.</p>
<p>And since I can’t report the bug I have 2 options:</p>
<p>I’m now stuck at a project I’ve been working on for the last 3 months that was close to being feature complete and now I have to switch technologies.</p>
<p>So TL;DR</p>

<p>When doing the same $geoNear aggregation query in MongoDB Compass the results are correct.</p>

<!-- AI CONTENT END 1 -->
	</div><!-- .entry-content -->

	 <!-- .entry-footer -->
</article></div>
  </body>
</html>
