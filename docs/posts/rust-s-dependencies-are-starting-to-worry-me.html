<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://vincents.dev/blog/rust-dependencies-scare-me/?">Original</a>
    <h1>Rustâ€™s dependencies are starting to worry me</h1>
    
    <div id="readability-page-1" class="page">
        

        <a href="https://ntietz.com/">
            <img src="https://ntietz.com/home.png"/>
        </a>

        <p>
            I do not pretend to have more experience or understanding than the top level engineers I often see writing blogs here, but what I am is annoyed. I love rust. It&#39;s by far my favorite language, I enjoy the community and the language ergonomics. I&#39;ve been able to incorporate it into projects in my day job where fit.
        </p>

        <picture>
            <img src="https://ntietz.com/blog/taking-a-break/images/crates.png"/>
        </picture>

        <p>
            Rust&#39;s dependencies are starting to worry me. For those who don&#39;t code in Rust, Rust provides an ecosystem of crates through crates.io, allowing users to helpfully install them with the command cargo add, or by simply adding the requested crate and version to the Cargo.toml file. This paradigm is similar to NPM for nodejs.
        </p>

         <h2>The Good</h2>

         <p>Cargo is helpful and a huge productivity booster, ensuring I don&#39;t have to hunt around and link files myself with something like CMake. This also allows me to swap between architectures and operating systems pretty frequently, mainly my M1 macbook air and my x86 Debian desktop. In general I don&#39;t have to think much about package management and gets me right into writing code.</p>

        <h2>The Bad</h2>

        <p>Not thinking about package management careful makes me sloppy. In a recent production project I pulled in dotenv a crate I&#39;ve seen many other rust developers use. This worked fine for multiple weeks until recently when checking a rust security advisory mentioning that dotenv is <a href="https://rustsec.org/advisories/RUSTSEC-2021-0141.html">unmaintained</a>. Below is a suggested alternative dotenvy. This whole fiasco led me tho think .... do I even need this crate at all? 35 lines later I had the parts of dotenv I needed. Packages become un-mainted in every language and it was my choice to pull in an arguably trivial dependency. So what happens when I have dependencies I do need?</p>

        <h2>So Much Code</h2>

        <picture>
            <img src="https://ntietz.com/blog/taking-a-break/images/why.png"/>
        </picture>

        <p>Tokio is one of rust&#39;s most well maintained packages of all time. This was added with axum a webserver by the same folks that sits on top of the tokio (the async runtime). Tokio is legitimately one of the coolest things  I&#39;ve ever gotten to work with, touting itself as a work stealing multithreaded runtime. Tokio has performed leaps and bounds better than I ever could have hoped. </p>

        <p>So with that I chose to add a couple more dependencies that I belived were needed, bringing my total cargo file to these
Axum, Reqwest , ripunzip, serde, serde_json, tokio, tower-http, tracing, and tracing-subscriber</p>

        <p>In general I considered the project to be trivial, a webserver that handles requests, unzips files, and has logs</p>

        <p>In an attempt to build resilient software I decided to vendor my packages, a cargo feature that downloads all my dependencies so I can host them locally.</p>

        <p>Out of curiosity I ran <a href="https://github.com/XAMPPRocky/tokei">toeki</a> a tool for counting lines of code, and found a staggering 3.6 million lines of rust. Removing the vendored packages reduces this to 11136 lines of rust.</p>

        <picture>
            <img src="https://ntietz.com/blog/taking-a-break/images/vendored.png"/>
        </picture>

        <p>Now I understand that webservers are complex, and a full asyncronous runtime is even more complex. However the entire linux kernel is 27.8 million lines according to this <a href="https://www.theregister.com/2020/01/06/linux_2020_kernel_systemd_code/">register article</a></p>

        <p>That&#39;s only 7 of my project....</p>

        <p>How could I ever audit all of that code?</p>

        <p>The code that I personally wrote is only around 1000 lines</p>

        <picture>
            <img src="https://ntietz.com/blog/taking-a-break/images/onlymine.png"/>
        </picture>


        <h2>What&#39;s the solution?</h2>

        <p>I have no idea... Many call for adding more to the rust standard library much like Go, however this causes its own set of issues. Rust is positioned as a high performance, safe, and modular language meaning to compete with CPP and C. That means it targets things like embedded devices. Every new thing that gets added to the std library is one more thing for the rust team to have to manage and work on. Just Tokio itself has one of the most active Github and programming discords Ive seen.</p>

        <p>I can&#39;t rewrite the world, an async runtime and web server are just too difficult and take to long for me to justify writing for a project like this (although I should eventually just for a better understanding).</p>

        <p>With a question I&#39;ve asked during an interview at cloudflare I was told that cloudflare just leverages tokio like everyone else and pulls from crates.io.  How often do they audit that code?</p>

        <p>Clickhouse has mentioned problems with <a href="https://clickhouse.com/blog/rust">binary sizes</a> and I doubt they even have the same amount of crates.</p>

        <p>With cargo there is no easy way (as far as I can tell) to see what lines ACTUALLY get compiled into the final binary, many crates include items for windows which I don&#39;t necessarily need (but there&#39;s no official way to tell cargo that).</p>

        <p>So now I pose the question to you what do we do?</p>



        <a href="https://ntietz.com/resume">Hiring for a rust role?  consider me :)</a>
    

</div>
  </body>
</html>
