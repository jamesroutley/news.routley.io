<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://eaton-works.com/2023/01/24/how-the-xbox-360-knows-if-your-hard-drive-is-genuine/">Original</a>
    <h1>How the Xbox 360 knows if your hard drive is genuine</h1>
    
    <div id="readability-page-1" class="page"><article>
    
    <div>
        <picture><source type="image/avif" srcset="/assets/images/ew-logo-4circle-48.avif?cb=4c20b575 48w"/><source type="image/webp" srcset="/assets/images/ew-logo-4circle-48.webp?cb=97f21988 48w"/><img alt="" loading="lazy" decoding="async" src="https://eaton-works.com/assets/images/ew-logo-4circle-48.png?cb=c3e5d908" width="24"/></picture>
        <p><span title="Author: Eaton">Eaton</span>
        <span>•</span>
        <time title="Published: Tuesday, January 24, 2023 at 1:27:21 PM Eastern Standard Time" datetime="2023-01-24T18:27:21Z">Jan 24, 2023</time>
    </p></div>
    
    
    
<p>The Xbox 360 was launched in 2005 with 2 models – a “Core” model and a “Pro” model. The idea behind the Core was to provide a lower-cost model so gamers could play their games from disc, while the Pro included a 20 GB hard-drive, which was plenty for the limited amount of downloadable content and other extras at the time. The hard-drive has always been an optional accessory, but it quickly became a necessity for gamers who wanted to save their profiles and download content from Xbox Live. The downside is that the Xbox 360 branded hard-drives were expensive. The 20 GB at launch was $99! Looking at an old <a rel="noreferrer noopener" href="https://www.anandtech.com/show/1866" target="_blank">AnandTech price guide from November 2005</a>, for $57 you could get an 80 GB hard-drive for your PC. Xbox 360 storage came at a large premium.</p>



<p>Instinctively, modders explored the possibility of using custom hard-drives in order to get lots of storage on a budget. Unfortunately, they quickly found it was impossible.</p>



<h2><strong>Kernel-mode Authenticity Check</strong></h2>



<p>Every genuine Xbox 360 hard-drive has a unique piece of data in sector 16 called the “security sector” that contains the following information:</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/551fb214-019c-4e46-3bba-39fae2c4ab00/full" alt=""/></figure>



<p>The security sector data is processed in a kernel function named <em>SataDiskAuthenticateDevice</em>. It looks like this in IDA:</p>



<figure><a href="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/e30b1d30-e86b-4fd7-fbdf-f4d87510e300/full" target="_blank" rel=" noreferrer noopener"><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/e30b1d30-e86b-4fd7-fbdf-f4d87510e300/full" alt="" width="580" height="518"/></a></figure>



<p>The decompiled version:</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/d0664034-0ff6-4b6c-ec96-12f7389ae300/full" alt=""/></figure>



<p>The function is relatively simple. It starts by calling <em>IoSynchronousFsdRequest</em>. This is a function carried over from the original Xbox, and you won’t find it on Windows. It basically executes an asynchronous IO request, and then waits for it to complete. In this case, it is a read request for sector 16:</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/22a35ddd-6019-46bf-11ab-d8f817616600/full" alt=""/></figure>



<p>After that function runs, <em>Buffer</em> will contain the security sector data, or, if the read failed, the console will display an E69 error screen. That will only happen if the disk is very loosely connected, or if the disk is failing.</p>



<p>When the security sector is in memory, the authenticity check takes place. All hard-drives report a serial number, firmware revision, and model number <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ata/ns-ata-_identify_device_data" target="_blank" rel="noreferrer noopener">as part of the <em>IDE_COMMAND_IDENTIFY_DEVICE</em> command</a>. The data the disk firmware reports is compared against what is stored in the security sector. It does this using a dedicated helper function named <em>SataDiskEqualAuthenticationStrings</em>, which basically works like memcmp (a function that checks if bytes are equal).</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/aa398f0a-ceea-4e4a-ab1b-5cc896858c00/full" alt=""/></figure>



<p>If any of those 3 strings do not match, the check fails. You might be thinking, it should be trivial to just change the security sector to match the data the disk firmware, reports, right? Unfortunately, the entire security sector is RSA-signed using a private key only Microsoft possesses. This means that if you modify the security sector to match the disk firmware information, it will fail the cryptographic check. Here is the RSA signature verification:</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/a924387c-95dd-47b7-e724-40db2dd67900/full" alt=""/></figure>



<h2><strong>The Workarounds</strong></h2>



<p>If you do not want to buy the genuine Microsoft Xbox 360 hard-drive, there are 2 workarounds </p>



<h3><strong>1. HDDHackr</strong></h3>



<p>Since the security sector cannot be modified to match the disk firmware information, the only possible workaround is to change the disk firmware so it will match the security sector. <a rel="noreferrer noopener" href="https://www.xbins.org/nfo.php?file=xboxnfo2320.nfo" target="_blank">HDDHackr</a> was created – an MS-DOS app that updates the firmware on Western Digital drives to impersonate another. For example, if a security sector says the disk is a Hitachi, HDDHackr would change the disk firmware to report Hitachi information.</p>



<p>There are still a few limitations to the HDDHackr workaround:</p>



<ol>
<li>It’s not maintained anymore and only works on older PC hardware.</li>



<li>There are reports it doesn’t work well on newer Western Digital drives.</li>



<li>It cannot make drives larger than 500 GB work. The security sector limits the amount of addressable sectors, and 500 GB is the biggest hard-drive size Microsoft officially released.</li>
</ol>



<h3><strong>2. Modded Console</strong></h3>



<p>When modding Xbox 360 consoles became possible through the JTAG and RGH hacks, the hard-drive authenticity check and size limitations were one of the first things patched out. With the checks removed, any hard-drive up to 2 TB in size could be connected, formatted on the dashboard, and be ready for use. These hacks require hardware modifications though, and you give up Xbox Live access in the process.</p>



<h2><strong>Microsoft knows about your hacked/custom hard-drive</strong></h2>



<p>If you use the HDDHackr workaround, you would download a valid security sector from the internet to use for your hard-drive. For example, when the 500 GB HDD came out in 2014, the community <a rel="noreferrer noopener" href="https://digiex.net/threads/xbox-360-500gb-hard-drive-security-sector-download-hddss-bin-hddss500gb-bin.13433/" target="_blank">quickly uploaded the security sector</a> so others could make their own, custom 500 GB HDDs. What most people do not realize is that Microsoft has been collecting your hard-drive info this entire time. Specifically, while connected to Xbox Live the following information from the security sector is sent to Microsoft periodically as part of a security challenge response:</p>



<ul>
<li>Serial number</li>



<li>Firmware revision</li>



<li>Model number</li>



<li>User addressable sectors</li>
</ul>



<p>Microsoft knows about every Xbox Live-connected console that has a HDDHackr’d drive connected, since it will see tens of thousands of consoles using the same hard-drive. Security sectors are unique and can be used to uniquely identify a hard-drive. Xbox 360 hard-drives can be used on different consoles, so Microsoft seeing a few consoles using the same hard-drive won’t be a red flag, but when potentially hundreds or thousands of consoles are reporting the same hard-drive info at once, it’s pretty clear they are using a hacked/custom hard-drive.</p>



<p>Microsoft could have banned consoles for using a non-genuine hard-drive, but there is no evidence this has ever occurred.</p>



<h2><strong>Logo Verification</strong></h2>



<p>If you looked closely at the <em>HDD_SECURITY_BLOB</em> structure at the beginning, you may have noticed the <em>LogoBitmapDigest</em>. Right after the security sector, in sector 17, a PNG image of the old Microsoft logo can be found:</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/e0fc4810-e9d1-4680-2546-b5bcac26c700/full" alt=""/></figure>



<p>Fun fact: Based on metadata embedded in the image, it was created in Macromedia Fireworks MX 2004 on July 19, 2005. The Xbox 360 launched later that year on November 22. After looking at a few early and late security sector samples, I believe this exact same image is used in every security sector on every hard-drive sent to retail.</p>



<p>The logo is used when viewing the storage on the Xbox 360 dashboard:</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/ec1ff9e7-8400-4417-2535-a7eef4878300/full" alt=""/></figure>



<p>Microsoft cared enough about their logo to SHA1 hash it. That hash is RSA-signed in the security sector, so you cannot change the hash or the logo.</p>



<p>It’s possible Microsoft considered allowing third parties to sell their own branded hard-drives for Xbox 360, much like how Seagate exclusively sells the <a rel="noreferrer noopener" href="https://www.seagate.com/products/gaming-drives/xbox-gaming/storage-expansion-for-xbox-series-x/" target="_blank">Xbox Series X|S expansion cards</a> today. Presumably, the Microsoft logo would have been replaced with their own. This is all just conjecture and it’s possible the answer boils down to Microsoft wanting you to feel good knowing you purchased a genuine accessory.</p>



<h2><strong>Logo Fun</strong></h2>



<p>With a modded console it is possible to change the logo to any other image you want, since the cryptographic checks are no longer enforced. Some fun images are below. Note that while the HDD is named Retail, changing the logo is only possible on a modded console. These are also screen captures from the console – not photoshops!</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/206f08c7-b756-4231-c67d-9f1af17c6000/full" alt=""/></figure>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/5716f75f-9d88-4fda-1201-9b72f43b5b00/full" alt=""/></figure>



<h2><strong>Unfortunate Mistakes</strong></h2>



<p>The security sector is located at the beginning of the disk. If you connect the disk to Windows and open Disk Management, it will show up as “Not Initialized” since Windows doesn’t recognize the Xbox 360 partitioning scheme. A popup will also appear asking you to initialize the disk in MBR or GPT format, to get it set up for Windows partitioning.</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/ee2bc1ec-0a1b-4378-bc60-af9143ccac00/full" alt=""/></figure>



<p>Unfortunately, the consequences of clicking OK are devastating. The security sector will be overwritten with Windows partition tables. Unless you made a backup of it, the hard-drive will never work in an unmodded Xbox 360 again. I get emails about this all the time and it pains me to tell people there is no way to save the hard-drive. The problem became so common that I added automatic security sector backups to <a rel="noreferrer noopener" href="https://fatxplorer.eaton-works.com/" target="_blank">FATXplorer</a> back in 2015. When it starts, it will immediately back up any valid security sector on all hard-drives it finds. Unfortunately, up to the time this post was published, it has not saved a single hard-drive. Everyone accidentally initializes their disks <em>before</em> opening FATXplorer the first time, rendering the life-saving feature useless. If you still play on your Xbox 360, consider backing up your security sector!</p>

</article></div>
  </body>
</html>
