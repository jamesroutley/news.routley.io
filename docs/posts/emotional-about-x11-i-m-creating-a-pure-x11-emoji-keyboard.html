<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Zirias/xmoji">Original</a>
    <h1>Emotional about X11: I&#39;m creating a pure X11 “emoji keyboard”</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Xmoji is a simple emoji keyboard for X11 designed to work without relying on
any toolkit or input method. It doesn&#39;t use a toolkit itself and instead
renders its GUI using XRender requests.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/Zirias/xmoji/blob/master/.github/screenshots/xmoji.png?raw=true"><img src="https://github.com/Zirias/xmoji/raw/master/.github/screenshots/xmoji.png?raw=true" alt="Xmoji in fvwm3"/></a></p>
<p dir="auto">This is currently work in progress and should become the successor of my
<a href="https://github.com/Zirias/qxmoji">qXmoji</a> tool which used Qt for its GUI.</p>

<ul dir="auto">
<li>Left-clicking an emoji sends it to whatever X11 application currently has
the keyboard focus using faked key press events. It automatically appends
a zero-width space and for ZWJ sequences prepends another ZWJ, which helps
some receiving X clients to get their display correct. This behavior will
be made configurable in a future release.</li>
<li>Middle-clicking an emoji selects it, so it can be transferred using the X11
&#34;primary selection&#34; mechanism (typically middle-click again where you want
to insert it).</li>
<li>Emojis are displayed in tabs with one tab per main group as suggested in
Unicode files.</li>
<li>Emojis with skin-tone variants are grouped again, only the neutral version
is shown and right-clicking it shows a fly-out style menu with all available
versions.</li>
<li>The search tab allows to find emojis by their name.</li>
<li>The history tab shows the most recently used emojis and is automatically
persisted.</li>
</ul>

<p dir="auto">Everything concerning appearance and rendering is configured in the
traditional X11 way, using X resources. Xmoji only looks for them on the
root window of the running X session, so make sure you upload them with
the <code>xrdb</code> tool.</p>
<p dir="auto">The application class name is <code>Xmoji</code>, the instance name defaults to the
name of the executable (<code>xmoji</code>), but can be overridden with the <code>-name</code>
commandline argument. Most resources can also be overridden on the
commandline by giving the instance name of their last component, so e.g.
running <code>xmoji -emojiFont emoji-24</code> will set the emoji font to that
font.</p>

<p dir="auto">Fonts are given as search patterns for <code>fontconfig</code>, multiple patterns
can be given separated by commas, for example <code>Noto Sans-14:bold,sans-14</code>. Fonts are global, so can&#39;t be scoped to
individual widgets.</p>
<ul dir="auto">
<li><code>font</code> (class <code>Font</code>): The font for display of normal text. Default:
<code>sans</code>.</li>
<li><code>emojiFont</code> (class <code>Font</code>): The font for display of emojis. Default:
<code>emoji</code>.</li>
</ul>
<div dir="auto"><h3 tabindex="-1" dir="auto">Generic rendering options</h3><a id="user-content-generic-rendering-options" aria-label="Permalink: Generic rendering options" href="#generic-rendering-options"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><code>backingStore</code> (no class): Use an offscreen pixmap for window contents
and contents of scrollable areas. Disable this to save X server memory
at the cost of visible flicker. Default: <code>1</code>.</li>
<li><code>scrollBarWidth</code> (no class): Width in pixels for scroll bars.
Default: <code>10</code>.</li>
<li><code>scrollBarMinHeight</code> (no class): Minimum height in pixels for scroll
bars. Default: <code>16</code>.</li>
</ul>

<p dir="auto">Colors can be given in these formats:</p>
<ul dir="auto">
<li>A well-known X11 color name</li>
<li>RGB(A) values in simple hex notation: <code>#rgb</code>, <code>#rrggbb</code>, <code>#rrrgggbbb</code>,
<code>#rrrrggggbbbb</code>, <code>#rgba</code>, <code>#rrggbbaa</code>, <code>#rrrrggggbbbbaaaa</code>.</li>
<li>RGB(A) values in X11 notation <code>rgb:&lt;r&gt;/&lt;g&gt;/&lt;b&gt;</code>/<code>rgba:&lt;r&gt;/&lt;g&gt;/&lt;b&gt;/&lt;a&gt;</code>,
where each component can have 1 to 4 hex digits.</li>
<li>RGB(A) values in CSS notation <code>rgb(&lt;r&gt;,&lt;g&gt;,&lt;b&gt;)</code>/<code>rgba(&lt;r&gt;,&lt;g&gt;,&lt;b&gt;,&lt;a&gt;)</code>,
where each component is a decimal number between 0 and 255. The <code>rgb</code>
prefix can also be omitted.</li>
</ul>
<p dir="auto">Colors can be scoped to individual widgets by their class and instance
names. The following colors are available:</p>
<ul dir="auto">
<li><code>foreground</code> (class <code>Foreground</code>): Normal foreground color. Default:
<code>black</code>.</li>
<li><code>background</code> (class <code>Background</code>): Normal background color. Default:
<code>gray</code>.</li>
<li><code>aboveForeground</code> (class <code>Foreground</code>): Foreground color for elemets
appearing above normal. Default: <code>black</code>.</li>
<li><code>aboveBackground</code> (class <code>Background</code>): Background color for elements
appearing above normal. Default: <code>light gray</code>.</li>
<li><code>belowForeground</code> (class <code>Foreground</code>): Foreground color for elements
appearing below normal. Default: <code>black</code>.</li>
<li><code>belowBackground</code> (class <code>Background</code>): Background color for elements
appearing below normal. Default: <code>dark gray</code>.</li>
<li><code>lowestForeground</code> (class <code>Foreground</code>): Foreground color for elements
appearing lowest. Default: <code>black</code>.</li>
<li><code>lowestBackground</code> (class <code>Background</code>): Background color for elements
appearing lowest. Default: <code>web gray</code>.</li>
<li><code>activeForeground</code> (class <code>Foreground</code>): Foreground color for active
elements. Default: <code>dark slate gray</code>.</li>
<li><code>activeBackground</code> (class <code>Background</code>): Background color for active
elements. Default: <code>light blue</code>.</li>
<li><code>disabledForeground</code> (class <code>Foreground</code>): Foreground color for
disabled elements. Default: <code>dim gray</code>.</li>
<li><code>disabledBackground</code> (class <code>Background</code>): Background color for
disabled elements. Default: <code>silver</code>.</li>
<li><code>selectedForeground</code> (class <code>Foreground</code>): Foreground color for
selected elements. Default: <code>light blue</code>.</li>
<li><code>selectedBackground</code> (class <code>Background</code>): Background color for
selected elements. Default: <code>medium blue</code>.</li>
<li><code>tooltipForeground</code> (class <code>Foreground</code>): Foreground color for
tooltips. Default: <code>black</code>.</li>
<li><code>tooltipBackground</code> (class <code>Background</code>): Background color for
tooltips. Default: <code>navajo white</code>.</li>
<li><code>border</code> (class <code>Border</code>): Color for borders. Default: <code>dark gray</code>.</li>
<li><code>tooltipBorder</code> (class <code>Border</code>): Color for the border of tooltips.
Default: <code>black</code>.</li>
</ul>

<p dir="auto">The following X resources configure a different emoji font, a slightly larger
scroll bar and a dark color scheme:</p>
<div data-snippet-clipboard-copy-content="Xmoji*emojiFont: Twitter Color Emoji
Xmoji*Foreground: #c8c6c5
Xmoji*Background: #211f1d
Xmoji*Border: #191210
Xmoji*belowBackground: #191210
Xmoji*lowestBackground: #120f0d
Xmoji*aboveBackground: #302a28
Xmoji*activeBackground: #403830
Xmoji*disabledForeground: #777777
Xmoji*selectedForeground: black
Xmoji*selectedBackground: #77ddff
Xmoji*tooltipForeground: light cyan
Xmoji*tooltipBackground: dark slate gray
Xmoji*tooltipBorder: light sea green
Xmoji*scrollBarWidth: 12
Xmoji*scrollBarMinHeight: 25"><pre><code>Xmoji*emojiFont: Twitter Color Emoji
Xmoji*Foreground: #c8c6c5
Xmoji*Background: #211f1d
Xmoji*Border: #191210
Xmoji*belowBackground: #191210
Xmoji*lowestBackground: #120f0d
Xmoji*aboveBackground: #302a28
Xmoji*activeBackground: #403830
Xmoji*disabledForeground: #777777
Xmoji*selectedForeground: black
Xmoji*selectedBackground: #77ddff
Xmoji*tooltipForeground: light cyan
Xmoji*tooltipBackground: dark slate gray
Xmoji*tooltipBorder: light sea green
Xmoji*scrollBarWidth: 12
Xmoji*scrollBarMinHeight: 25
</code></pre></div>

<p dir="auto">Runtime configuration is stored in a configuration file. This file is
automatically monitored for external changes.</p>
<p dir="auto">By default, Xmoji will use a configuration file in these places:</p>
<ul dir="auto">
<li><code>${XDG_CONFIG_HOME}/xmoji.cfg</code>, if <code>XDG_CONFIG_HOME</code> is set.</li>
<li><code>${HOME}/.config/xmoji.cfg</code>, if <code>HOME</code> is set.</li>
<li><code>~/.config/xmoji.cfg</code>, with <code>~</code> refering to the home directory obtained
from the passwd database.</li>
</ul>
<p dir="auto">The location of the configuration file can be overridden from the command line
with <code>-cfg</code>, e.g.</p>
<div data-snippet-clipboard-copy-content="xmoji -cfg /tmp/xmoji.cfg"><pre><code>xmoji -cfg /tmp/xmoji.cfg
</code></pre></div>
<p dir="auto">CAUTION: Xmoji will attempt to create missing directories for storing its
runtime configuration.</p>
<p dir="auto">The file stores everything available in the Settings dialog, which you can
access by right-clicking in the window, outside of an Emoji with a fly-out.
The settings are described in the dialog using tooltips.</p>
<p dir="auto">Additionally, the history of recently used emojis is also stored in the
configuration file.</p>

<p dir="auto">To obtain the source from git, make sure to include submodules, e.g. with the
<code>--recurse-submodules</code> option to <code>git clone</code>. Release tarballs will include
everything needed for building.</p>
<p dir="auto">Dependencies:</p>
<ul dir="auto">
<li>A C compiler understanding GNU commandline options and the C11 standard
(GNU GCC and LLVM clang work fine)</li>
<li>GNU make</li>
<li>fontconfig</li>
<li>freetype ( &gt;= 2.12 when SVG support is enabled, see below )</li>
<li>harfbuzz</li>
<li>libpng ( &gt;= 1.6 )</li>
<li>libxcb, libxcb-cursor, libxcb-image, libxcb-xkb and libxcb-xtest</li>
<li>xkbcommon and xkbcommon-x11</li>
</ul>
<p dir="auto">For example, on a Debian or Ubuntu system, you would install these packages:</p>
<div data-snippet-clipboard-copy-content="libfontconfig1-dev libfreetype-dev libharfbuzz-dev libxcb-cursor-dev
libxcb-image0-dev libxcb-xkb-dev libxcb-xtest0-dev libxkbcommon-x11-dev"><pre><code>libfontconfig1-dev libfreetype-dev libharfbuzz-dev libxcb-cursor-dev
libxcb-image0-dev libxcb-xkb-dev libxcb-xtest0-dev libxkbcommon-x11-dev
</code></pre></div>
<p dir="auto">To build and install Xmoji, you can simply type</p>

<p dir="auto">If your default <code>make</code> utility is not GNU make (like e.g. on a BSD system),
install GNU make first and type <code>gmake</code> instead of <code>make</code>.</p>

<p dir="auto">Options can be given as variables in each make invocation, e.g. like this:</p>
<div data-snippet-clipboard-copy-content="make FOO=yes
make FOO=yes install"><pre><code>make FOO=yes
make FOO=yes install
</code></pre></div>
<p dir="auto">Alternatively, they can be saved and are then used automatically, like this:</p>
<div data-snippet-clipboard-copy-content="make FOO=on config
make
make install"><pre><code>make FOO=on config
make
make install
</code></pre></div>
<p dir="auto">The following build options are available:</p>
<ul dir="auto">
<li>
<p dir="auto"><code>TRACE</code> (bool): Enables tracing of all X11 requests. When running with
<code>-vv</code>, this prints all requests to stderr. Also, when an error occurs,
the code and location of the request that caused it is printed.
For debugging only. Default: <code>off</code>.</p>
</li>
<li>
<p dir="auto"><code>BUNDLED_POSER</code> (bool): Uses the bundled poser lib and links it statically.
When disabled, poser must be installed and will be linked as a shared
library. Default: <code>on</code>.</p>
</li>
<li>
<p dir="auto"><code>WITH_SVG</code> (bool): Enable support for fonts with SVG glyphs. When enabled,
freetype &gt;= 2.12 is required and the bundled
<a href="https://github.com/memononen/nanosvg">nanosvg</a> is built for rasterizing
the SVG glyphs. Default: <code>on</code>.</p>
</li>
<li>
<p dir="auto"><code>WITH_KQUEUE</code> (bool): Use <code>kqueue</code> (available on BSD systems) for watching
the configuration file instead of periodically calling <code>stat()</code>.
Default: <code>on</code> when <code>kqueue</code> is detected, <code>off</code> otherwise.</p>
</li>
<li>
<p dir="auto"><code>WITH_INOTIFY</code> (bool): Use <code>inotify</code> (available on Linux) for watching the
configuration file instead of periodically calling <code>stat()</code>.
Default: <code>on</code> when <code>inotify</code> is detected, <code>off</code> otherwise.</p>
</li>
</ul>
<p dir="auto">Enabling both <code>WITH_KQUEUE</code> and <code>WITH_INOTIFY</code> at the same time is an error.
Even when one of them is enabled, Xmoji will try to detect whether the
configuration file is stored on NFS and in that case silently fall back to
periodically calling <code>stat()</code> on it.</p>
</article></div></div>
  </body>
</html>
