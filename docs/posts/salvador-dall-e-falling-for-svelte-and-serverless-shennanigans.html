<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gianluca.ai/salvador/">Original</a>
    <h1>Salvador DALL-E: Falling for Svelte and serverless shennanigans</h1>
    
    <div id="readability-page-1" class="page"><div><h2 id="dalle-meet-salvador">DALL.E, meet Salvador</h2><p>Introducing <em>Salvador</em>: a clean, mobile-first interface for OpenAI’s <a href="https://en.wikipedia.org/wiki/DALL-E">DALL-E</a> image generator, built with <a href="https://svelte.dev/">Svelte</a>. Generate visual inspiration with AI using simple prompts and either DALL-E 2 or DALL-E 3.</p><ul><li>Try it at <a href="https://salvador-dalle.vercel.app">salvador-dalle.vercel.app</a></li><li>Find the code and guide to deploy your own at <a href="https://github.com/gianlucatruda/salvador">github.com/gianlucatruda/salvador</a></li></ul><p><img alt="Screenshots of using the Salvador web app" loading="lazy" src="https://gianluca.ai/salvador/images/salvador_banner.png"/></p><h2 id="look-mom-no-react">Look mom, no React</h2><p>This is one from mid-2024 that I’ve recently polished up and released.</p><p>I’ve built <a href="https://gianluca.ai/raytracer">many things</a> in pure JavaScript, which is great until you need to do dynamic DOM updates combined with web requests. I’ve built <a href="https://gianluca.ai/fomo-embeddings">a few things</a> with React, which handles those DOM updates at the cost of defacing your codebase to solve problems only relevant to Facebook-scale platforms.</p><p>I had never built anything with <a href="https://youtu.be/rv3Yq-B8qp4">Svelte</a>, but had <a href="https://youtu.be/ogXETl_I0Dg">heard that it’s lovely</a> and was looking for an excuse to try it:</p><ul><li>Unlike React, Angular, and Vue (which ship a JavaScript runtime to the browser and use a virtual DOM), Svelte actually <em>compiles</em> declarative code (that’s nice to write) into imperative code (that runs fast and lean with native browser APIs).</li><li><code>.svelte</code> files are written in JS or TS. Svelte compiles them to vanilla JS, which is handy for backwards compatibility.</li><li>Svelte kinda just looks like HTML, but can directly reference variables with a template-like syntax.</li></ul><p>My mom is an outstanding visual artist and was curious about using AI-generated imagery as part of her ideation process, but most user interfaces to these models are either generic and overpriced or overcomplicated and technical. I mean, I love the idea that <a href="https://docs.midjourney.com/docs/discord-quick-start">Midjourney only operates out of a Discord server</a>, but that’s kept <em>me</em> from using it much and renders it downright non-existent for many people. And <a href="https://github.com/comfyanonymous/ComfyUI">ComfyUI</a> is clearly cracked, but is not for running on an iPhone.</p><p>Since I have a bunch of OpenAI credits from <a href="https://gianluca.ai/hackathon-watch-and-learn/">hackathon winnings</a>, I decided to gift my mom <em>bespoke</em> software: a clean, mobile-first web app that makes quick iteration and inspiration easy. The result is <em>Salvador</em> and I’m triply delighted with it – I like how it turned out, I’ve really enjoyed using Svelte, and my mom has actually found it useful.</p><p>There was just one small problem…</p><h2 id="the-interesting-challenge">The interesting challenge</h2><p>The core functionality is straightforward. The user enters the image prompt into a text box, picks some options from form elements, and hits a button. That triggers a function that bundles the inputs into the body of an HTTP POST request to OpenAI’s image generation API. The response is a URL for where the resulting image is hosted, which is injected into an <code>&lt;img&gt;</code> element on the page.</p><h3 id="off-to-a-svelte-start">Off to a svelte start</h3><p>Even adding the constraint of dynamic dropdown menus (which only allow valid combinations of model and resolution) and UX niceties (like loading spinners and pretty CSS) this was only about 100 lines of highly-readable Svelte. I was able to both <a href="https://svelte.dev/tutorial/">learn Svelte</a> and whip this up in a single afternoon.</p><div><pre tabindex="0"><code data-lang="svelte"><span><span><span>&lt;</span><span>script</span> <span>lang</span><span>=</span><span>&#34;ts&#34;</span><span>&gt;</span>
</span></span><span><span>  <span>import</span> <span>{</span> <span>onMount</span> <span>}</span> <span>from</span> <span>&#34;svelte&#34;</span><span>;</span>
</span></span><span><span>
</span></span><span><span>  <span>// Define our variables
</span></span></span><span><span><span></span>  <span>let</span> <span>btnText</span> <span>=</span> <span>&#34;Generate Image&#34;</span><span>;</span>
</span></span><span><span>  <span>let</span> <span>promptText</span> <span>=</span> <span>&#34;&#34;</span><span>;</span>
</span></span><span><span>  <span>let</span> <span>modelName</span> <span>=</span> <span>&#34;dall-e-2&#34;</span><span>;</span>
</span></span><span><span>  <span>let</span> <span>imgSize</span> <span>=</span> <span>&#34;256x256&#34;</span><span>;</span>
</span></span><span><span>  <span>let</span> <span>uiDisabled</span> <span>=</span> <span>false</span><span>;</span>
</span></span><span><span>  <span>let</span> <span>imgURL</span> <span>=</span> <span>&#34;&#34;</span><span>;</span>
</span></span><span><span>  <span>let</span> <span>lastPrompt</span>: <span>string</span> <span>|</span> <span>null</span><span>;</span>
</span></span><span><span>
</span></span><span><span>  <span>// Load the previous prompt from browser localStorage
</span></span></span><span><span><span></span>  <span>onMount</span><span>(()</span> <span>=&gt;</span> <span>{</span>
</span></span><span><span>    <span>if</span> <span>(</span><span>localStorage</span><span>.</span><span>getItem</span><span>(</span><span>&#34;lastPrompt&#34;</span><span>))</span> <span>{</span>
</span></span><span><span>      <span>lastPrompt</span> <span>=</span> <span>localStorage</span><span>.</span><span>getItem</span><span>(</span><span>&#34;lastPrompt&#34;</span><span>);</span>
</span></span><span><span>    <span>}</span>
</span></span><span><span>  <span>});</span>
</span></span><span><span>  <span>const</span> <span>loadPreviousPrompt</span> <span>=</span> <span>()</span> <span>=&gt;</span> <span>{</span>
</span></span><span><span>    <span>if</span> <span>(</span><span>!</span><span>lastPrompt</span><span>)</span> <span>{</span>
</span></span><span><span>      <span>console</span><span>.</span><span>error</span><span>(</span><span>&#34;No last prompt specified.&#34;</span><span>);</span>
</span></span><span><span>    <span>}</span>
</span></span><span><span>    <span>promptText</span> <span>=</span> <span>lastPrompt</span><span>;</span>
</span></span><span><span>  <span>};</span>
</span></span><span><span>
</span></span><span><span>  <span>const</span> <span>makeImage</span> <span>=</span> <span>()</span> <span>=&gt;</span> <span>{</span>
</span></span><span><span>    <span>const</span> <span>query</span> <span>=</span> <span>`</span><span>${</span><span>modelName</span><span>}</span><span> (</span><span>${</span><span>imgSize</span><span>}</span><span>): &#34;</span><span>${</span><span>promptText</span><span>}</span><span>&#34;`</span><span>;</span>
</span></span><span><span>    <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Query:&#34;</span><span>,</span> <span>query</span><span>);</span>
</span></span><span><span>    <span>uiDisabled</span> <span>=</span> <span>true</span><span>;</span>
</span></span><span><span>    <span>btnText</span> <span>=</span> <span>&#34;Generating...&#34;</span><span>;</span>
</span></span><span><span>    <span>makeRequest</span><span>();</span>
</span></span><span><span>  <span>};</span>
</span></span><span><span>
</span></span><span><span>  <span>async</span> <span>function</span> <span>makeRequest() {</span>
</span></span><span><span>    <span>localStorage</span><span>.</span><span>setItem</span><span>(</span><span>&#34;lastPrompt&#34;</span><span>,</span> <span>promptText</span><span>);</span>
</span></span><span><span>    <span>const</span> <span>bodyData</span> <span>=</span> <span>{</span>
</span></span><span><span>      <span>model</span>: <span>modelName</span><span>,</span>
</span></span><span><span>      <span>prompt</span>: <span>promptText</span><span>,</span>
</span></span><span><span>      <span>n</span>: <span>1</span><span>,</span>
</span></span><span><span>      <span>size</span>: <span>imgSize</span><span>,</span>
</span></span><span><span>    <span>};</span>
</span></span><span><span>    <span>const</span> <span>response</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;https://api.openai.com/v1/images/generations&#34;</span><span>,</span> <span>{</span>
</span></span><span><span>      <span>method</span><span>:</span> <span>&#34;POST&#34;</span><span>,</span>
</span></span><span><span>      <span>headers</span><span>:</span> <span>{</span>
</span></span><span><span>        <span>&#34;Content-Type&#34;</span><span>:</span> <span>&#34;application/json&#34;</span><span>,</span>
</span></span><span><span>      <span>},</span>
</span></span><span><span>      <span>body</span>: <span>JSON.stringify</span><span>(</span><span>bodyData</span><span>),</span>
</span></span><span><span>    <span>});</span>
</span></span><span><span>
</span></span><span><span>    <span>// Truncated: Error handling
</span></span></span><span><span><span></span>
</span></span><span><span>    <span>imgURL</span> <span>=</span> <span>result</span><span>.</span><span>data</span><span>[</span><span>0</span><span>].</span><span>url</span><span>;</span>
</span></span><span><span>  <span>}</span>
</span></span><span><span><span>&lt;/</span><span>script</span><span>&gt;</span>
</span></span><span><span>
</span></span><span><span><span>&lt;</span><span>main</span><span>&gt;</span>
</span></span><span><span>  <span>&lt;!-- Truncated boilerplate --&gt;</span>
</span></span><span><span>
</span></span><span><span>  <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>&#34;modelParams&#34;</span><span>&gt;</span>
</span></span><span><span>    <span>&lt;</span><span>form</span><span>&gt;</span>
</span></span><span><span>      <span>&lt;!-- Simple form for model selection --&gt;</span>
</span></span><span><span>    <span>&lt;/</span><span>form</span><span>&gt;</span>
</span></span><span><span>
</span></span><span><span>    <span>{</span><span>#if</span> <span>modelName</span> <span>==</span> <span>&#34;dall-e-2&#34;</span><span>}</span>
</span></span><span><span>      <span>&lt;</span><span>form</span><span>&gt;</span>
</span></span><span><span>        <span>&lt;!-- Only show the options for DALL-E 2 --&gt;</span>
</span></span><span><span>      <span>&lt;/</span><span>form</span><span>&gt;</span>
</span></span><span><span>    <span>{</span><span>:else</span> <span>if</span> <span>modelName</span> <span>==</span> <span>&#34;dall-e-3&#34;</span><span>}</span>
</span></span><span><span>      <span>&lt;</span><span>form</span><span>&gt;</span>
</span></span><span><span>        <span>&lt;!-- Only show the options for DALL-E 3 --&gt;</span>
</span></span><span><span>      <span>&lt;/</span><span>form</span><span>&gt;</span>
</span></span><span><span>    <span>{</span><span>/if</span><span>}</span>
</span></span><span><span>
</span></span><span><span>    <span>&lt;</span><span>textarea</span>
</span></span><span><span>      <span>id</span><span>=</span><span>&#34;prompt&#34;</span>
</span></span><span><span>      <span>placeholder</span><span>=</span><span>&#34;A painting of a melting clock in the style of Dali...&#34;</span>
</span></span><span><span>      <span>bind:value</span><span>=</span><span>{</span><span>promptText</span><span>}</span>
</span></span><span><span>      <span>disabled=</span><span>{</span><span>uiDisabled</span><span>}</span>
</span></span><span><span>    <span>&gt;&lt;/</span><span>textarea</span><span>&gt;</span>
</span></span><span><span>
</span></span><span><span>  <span>&lt;/</span><span>div</span><span>&gt;</span>
</span></span><span><span>  <span>{</span><span>#if</span> <span>lastPrompt</span> <span>&amp;&amp;</span> <span>!</span><span>promptText</span><span>}</span>
</span></span><span><span>    <span>&lt;</span><span>button</span>
</span></span><span><span>      <span>class</span><span>=</span><span>&#34;loadPrevButton&#34;</span>
</span></span><span><span>      <span>on:click</span><span>=</span><span>{</span><span>loadPreviousPrompt</span><span>}</span>
</span></span><span><span>      <span>disabled=</span><span>{</span><span>promptText</span> <span>==</span> <span>lastPrompt</span><span>}&gt;</span>Load previous prompt<span>&lt;/</span><span>button</span>
</span></span><span><span>    <span>&gt;</span>
</span></span><span><span>  <span>{</span><span>:else</span> <span>if</span> <span>!</span><span>imgURL</span><span>}</span>
</span></span><span><span>    <span>&lt;</span><span>button</span>
</span></span><span><span>      <span>class</span><span>=</span><span>&#34;clearPromptButton&#34;</span>
</span></span><span><span>      <span>on:click</span><span>=</span><span>{()</span> <span>=&gt;</span> <span>{</span>
</span></span><span><span>        <span>promptText</span> <span>=</span> <span>&#34;&#34;</span><span>;</span>
</span></span><span><span>      <span>}}</span>
</span></span><span><span>      <span>disabled=</span><span>{</span><span>!</span><span>promptText</span> <span>||</span> <span>uiDisabled</span><span>}&gt;</span>Clear prompt<span>&lt;/</span><span>button</span>
</span></span><span><span>    <span>&gt;</span>
</span></span><span><span>  <span>{</span><span>/if</span><span>}</span>
</span></span><span><span>  <span>{</span><span>#if</span> <span>!</span><span>imgURL</span><span>}</span>
</span></span><span><span>    <span>&lt;</span><span>button</span> <span>on:click</span><span>=</span><span>{</span><span>makeImage</span><span>}</span> <span>disabled=</span><span>{</span><span>uiDisabled</span> <span>||</span> <span>!</span><span>promptText</span><span>}</span>
</span></span><span><span>      <span>&gt;{</span><span>btnText</span><span>}&lt;/</span><span>button</span>
</span></span><span><span>    <span>&gt;</span>
</span></span><span><span>  <span>{</span><span>/if</span><span>}</span>
</span></span><span><span>  <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>&#34;results&#34;</span><span>&gt;</span>
</span></span><span><span>    <span>{</span><span>#if</span> <span>imgURL</span><span>}</span>
</span></span><span><span>      <span>&lt;</span><span>img</span> <span>src</span><span>=</span><span>{</span><span>imgURL</span><span>}</span> <span>alt=&#34;Generated</span> <span>AI</span> <span>artwork</span><span>&#34;</span> <span>/&gt;</span>
</span></span><span><span>    <span>{</span><span>:else</span> <span>if</span> <span>uiDisabled</span><span>}</span>
</span></span><span><span>      <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>&#34;spinner&#34;</span><span>&gt;&lt;/</span><span>div</span><span>&gt;</span>
</span></span><span><span>    <span>{</span><span>/if</span><span>}</span>
</span></span><span><span>  <span>&lt;/</span><span>div</span><span>&gt;</span>
</span></span><span><span>
</span></span><span><span>  <span>&lt;!-- Truncated --&gt;</span>
</span></span><span><span><span>&lt;/</span><span>main</span><span>&gt;</span>
</span></span><span><span>
</span></span><span><span><span>&lt;</span><span>style</span><span>&gt;</span>
</span></span><span><span>  <span>/* CSS Styling here. Simple enough for a one-pager. */</span>
</span></span><span><span><span>&lt;/</span><span>style</span><span>&gt;</span>
</span></span></code></pre></div><h3 id="whats-the-catch">What’s the catch?</h3><p>With only client-side code, the request is made on the client device. Normally, that’s no problem. But these requests to the OpenAI API reveal my secret API key to anyone who visits the web app. Even with user authentication, this would be very bad practice.</p><p>And therein lies the rub. Making beautiful bespoke software for my mom is one thing. Making it safe for publicly accessibility is another.</p><h3 id="dont-forget-your-own-backend">Don’t forget your own backend</h3><p>I wracked my brain (and GPT-4’s GPUs) with the problem for quite some time, but there’s simply no way I know of to solve this on client-side code. Even with compiled binaries, API keys can probably <a href="https://www.baeldung.com/linux/find-string-binary-file">still be extracted</a> due to the string encoding.</p><p>So I needed to route it via my own server. In the past, I’ve used AWS EC2 instances or headless Replit servers to serve up a quick API for these scenarios, but Svelte comes with tooling to solve problems like this: SvelteKit.</p><p>SvelteKit allows you to implement server-side rendering (SSR), routing, code-splitting, etc. There’s full support for writing server-side code bundled with Svelte, so why not try it?</p><blockquote><p>Whereas Svelte is a component framework, SvelteKit is an app framework (or ‘metaframework’, depending on who you ask) that solves the tricky problems of building something production-ready
– <a href="https://svelte.dev/tutorial/kit/introducing-sveltekit">Svelte docs</a></p></blockquote><p>It took me another couple hours to figure out the specifics and the syntax, but effectively I could just route the request from the client via my server-side code, attach my OpenAI API key (safely loaded from an environment variable), and forward it on to OpenAI’s API. Then route the response back accordingly.</p><p>I was delighted by how simple this turned out to be with SvelteKit (once I had read enough of the docs to understand it) and it all worked pretty seamlessly with my <a href="https://svelte.dev/docs/kit/building-your-app">Vite build</a>. Excellent.</p><div><pre tabindex="0"><code data-lang="svelte"><span><span>import <span>{</span> <span>OPENAI_API_KEY</span> <span>}</span> from &#34;$env/static/private&#34;;
</span></span><span><span>import <span>{</span> <span>json</span> <span>}</span> from &#34;@sveltejs/kit&#34;;
</span></span><span><span>import <span>{</span> <span>error</span> <span>}</span> from &#34;@sveltejs/kit&#34;;
</span></span><span><span>
</span></span><span><span>/** @type <span>{</span><span>import</span><span>(</span><span>&#39;./$types&#39;</span><span>).</span><span>RequestHandler</span><span>}</span> */
</span></span><span><span>export async function POST(<span>{</span> <span>request</span> <span>}</span>) <span>{</span>
</span></span><span><span>  <span>const</span> <span>url</span> <span>=</span> <span>&#34;https://api.openai.com/v1/images/generations&#34;</span><span>;</span>
</span></span><span><span>  <span>const</span> <span>bodyData</span> <span>=</span> <span>await</span> <span>request</span><span>.</span><span>json</span><span>();</span> <span>// Convert stream to JSON
</span></span></span><span><span><span></span>  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Ready to make OpenAI request&#34;</span><span>,</span> <span>{</span> <span>bodyData</span> <span>});</span>
</span></span><span><span>
</span></span><span><span>  <span>const</span> <span>response</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>url</span><span>,</span> <span>{</span>
</span></span><span><span>    <span>method</span><span>:</span> <span>&#34;POST&#34;</span><span>,</span>
</span></span><span><span>    <span>headers</span><span>:</span> <span>{</span>
</span></span><span><span>      <span>&#34;Content-Type&#34;</span><span>:</span> <span>&#34;application/json&#34;</span><span>,</span>
</span></span><span><span>      <span>Authorization</span><span>:</span> <span>`Bearer $</span><span>{</span><span>OPENAI_API_KEY</span><span>}</span><span>`,
</span></span></span><span><span><span>    </span><span>},</span>
</span></span><span><span>    <span>body</span>: <span>JSON.stringify</span><span>(</span><span>bodyData</span><span>),</span>
</span></span><span><span>  <span>});</span>
</span></span><span><span>
</span></span><span><span>  <span>const</span> <span>result</span> <span>=</span> <span>await</span> <span>response</span><span>.</span><span>json</span><span>();</span>
</span></span><span><span>  <span>if</span> <span>(</span><span>result</span><span>.</span><span>error</span><span>)</span> <span>{</span>
</span></span><span><span>    <span>console</span><span>.</span><span>error</span><span>(</span><span>result</span><span>.</span><span>error</span><span>);</span>
</span></span><span><span>  <span>}</span>
</span></span><span><span>  <span>return</span> <span>json</span><span>(</span><span>result</span><span>);</span>
</span></span><span><span><span>}</span>
</span></span></code></pre></div><p>(And then update the request URL to <code>/api/generate</code> in the client-side code)</p><p>It even deployed to Vercel without any additional fiddling and worked in production too – with no leaked API keys.</p><p>I delightedly shared the public URL with my mom. But when I was making her a demo video, I noticed that when I did larger-resolution DALL-E 2 generations or any DALL-E 3 generations, the app would hang and the request would never resolve.</p><h3 id="your-serverless-server-serves-less">Your serverless server serves less</h3><p>It wasn’t an issue with my code or the OpenAI API. I wasn’t getting <em>any</em> response back so there was no failure message. The client-side was simply being ghosted. I checked my OpenAI dashboard and saw no issues or rate limits and the code still worked perfectly when run locally.</p><p>After checking my free-tier Vercel logs and puzzling it over, I discovered that Vercel deploys the SvelteKit server as a “serverless” function. So when the client was making a request to the server-side API, it was having to spin-up that code somewhere, run it, forward the request to OpenAI, and return the response to the client.</p><p>But <a href="https://vercel.com/guides/what-can-i-do-about-vercel-serverless-functions-timing-out">Vercel’s free tier times these serverless workloads out after 10 seconds</a>. That meant that it <em>often</em> was able to complete the end-to-end request for smaller workloads, but was frequently getting cut-off waiting for the OpenAI API to respond with a high-resolution result, which was leaving my client-side request orphaned to the void.</p><p>Annoying! But I am not dumb enough to <a href="https://youtu.be/SCIfWhAheVw">ever give Vercel my payment information</a>. And frankly, I actually find DALL-E 2 images much more artistically interesting and unusual than the generic, overly-common slop that DALL-E 3 now gives. To my relief, my mom actually found it perfect for her use case.</p><h3 id="just-write-more-code">Just write more code</h3><p>I left the project in stealth and it ran fine for many months while I was at the <a href="https://gianluca.ai/recurse-init/">Recurse Center</a>, building <a href="https://gianluca.ai/made-at-recurse/">other things</a>. But recently I came back to it and, with some help from Claude, whipped up a quick modification to the main Svelte app which allows users to add their own OpenAI API key (stored in the browser <code>localStorage</code>, just like the previous prompt). If this is present then the request is routed <em>directly</em> to the OpenAI API and bypassing my time-limited SvelteKit router.</p><div><pre tabindex="0"><code data-lang="ts"><span><span>  <span>onMount</span><span>(()</span> <span>=&gt;</span> <span>{</span>
</span></span><span><span>    <span>if</span> <span>(</span><span>localStorage</span><span>.</span><span>getItem</span><span>(</span><span>&#34;lastPrompt&#34;</span><span>))</span> <span>{</span>
</span></span><span><span>        <span>lastPrompt</span> <span>=</span> <span>localStorage</span><span>.</span><span>getItem</span><span>(</span><span>&#34;lastPrompt&#34;</span><span>);</span>
</span></span><span><span>    <span>}</span>
</span></span><span><span>    <span>if</span> <span>(</span><span>localStorage</span><span>.</span><span>getItem</span><span>(</span><span>&#34;apiKey&#34;</span><span>))</span> <span>{</span>
</span></span><span><span>        <span>apiKey</span> <span>=</span> <span>localStorage</span><span>.</span><span>getItem</span><span>(</span><span>&#34;apiKey&#34;</span><span>)</span> <span>||</span> <span>&#34;&#34;</span><span>;</span>
</span></span><span><span>    <span>}</span>
</span></span><span><span>  <span>});</span>
</span></span></code></pre></div><div><pre tabindex="0"><code data-lang="ts"><span><span>  <span>async</span> <span>function</span> <span>makeRequest() {</span>
</span></span><span><span>    <span>// ... Setting body data
</span></span></span><span><span><span></span>    <span>let</span> <span>requestURL</span> <span>=</span> <span>&#34;/api/generate&#34;</span><span>;</span>
</span></span><span><span>    <span>if</span> <span>(</span><span>apiKey</span> <span>!=</span> <span>null</span> <span>&amp;&amp;</span> <span>apiKey</span> <span>!=</span> <span>&#34;&#34;</span><span>)</span> <span>{</span>
</span></span><span><span>      <span>requestURL</span> <span>=</span> <span>&#34;https://api.openai.com/v1/images/generations&#34;</span><span>;</span>
</span></span><span><span>    <span>}</span>
</span></span><span><span>    <span>const</span> <span>response</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>requestURL</span><span>,</span> <span>{</span>
</span></span><span><span>      <span>method</span><span>:</span> <span>&#34;POST&#34;</span><span>,</span>
</span></span><span><span>      <span>headers</span><span>:</span> <span>{</span>
</span></span><span><span>        <span>&#34;Content-Type&#34;</span><span>:</span> <span>&#34;application/json&#34;</span><span>,</span>
</span></span><span><span>        <span>&#34;Authorization&#34;</span><span>:</span> <span>`Bearer </span><span>${</span><span>apiKey</span><span>}</span><span>`</span><span>,</span>
</span></span><span><span>      <span>},</span>
</span></span><span><span>      <span>body</span>: <span>JSON.stringify</span><span>(</span><span>bodyData</span><span>),</span>
</span></span><span><span>    <span>});</span>
</span></span><span><span>    <span>// ... Error handling
</span></span></span><span><span><span></span>  <span>}</span>
</span></span></code></pre></div><p>Again, the syntax and compilation of Svelte made the UI changes delightfully easy to implement. To me, it just feels much more intuitive and … well… <em>svelte</em> than the JSX of React. Give it a try sometime.</p><p>Find the code and guide to deploy your own at <a href="https://github.com/gianlucatruda/salvador">github.com/gianlucatruda/salvador</a></p><hr/><p>Thanks for checking this out! If you’re interested in my <a href="https://gianluca.ai/tags/essay/">writing</a>, <a href="https://gianluca.ai/projects">projects</a>, or working with me then please do reach out on <a href="https://x.com/gianluca_truda">X</a>, <a href="https://bsky.app/profile/gianlucatruda.bsky.social">Bluesky</a>, or <a href="mailto:hello+world@gianluca.ai">by email</a>.</p><p>If you think other people might enjoy read this or any of my other posts, shares are always appreciated.</p></div></div>
  </body>
</html>
