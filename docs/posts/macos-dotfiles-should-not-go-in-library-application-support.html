<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://becca.ooo/blog/macos-dotfiles/">Original</a>
    <h1>macOS dotfiles should not go in –/Library/Application Support</h1>
    
    <div id="readability-page-1" class="page"><div id="main">
        
<p>One of my pet peeves is when command-line tools look for user configuration
files in <code>~/Library/Application Support</code> when running on macOS. In addition to
offering poor ergonomics for users, I believe this behavior is <em>incorrect</em>
according to the documentation which is cited to justify it. Instead,
command-line tools should implement the <a href="https://specifications.freedesktop.org/basedir-spec/latest/">XDG Base Directory Specification</a>
and look for configuration files in <code>$XDG_CONFIG_HOME</code>, which defaults to
<code>~/.config</code>.</p>
<p>Usually, when a program looks for configuration files in <code>~/Library/Application Support</code>, it’s not because of an intentional design decision. Instead, the
author delegated that decision to a library, and several popular libraries for
determining platform-specific configuration directories use
<code>~/Library/Application Support</code> as the default configuration directory on
macOS, including <a href="https://pypi.org/project/platformdirs/">Python’s <code>platformdirs</code> package</a> (<a href="https://pypistats.org/packages/platformdirs">242
million downloads / month</a>), <a href="https://www.npmjs.com/package/env-paths">JavaScript’s
<code>env-paths</code></a> (95 million downloads / month), <a href="https://lib.rs/crates/dirs">Rust’s <code>dirs</code>
crate</a> (4.8 million downloads / month), and <a href="https://pkg.go.dev/github.com/adrg/xdg">Go’s <code>adrg/xdg</code>
package</a> (used in 913 packages). While <code>~/Library/Application Support</code>
may be the correct configuration directory for <em>GUI apps</em> which manage their
configuration files for the user automatically, the vast majority of
applications using these libraries are command-line utilities whose
configuration belongs in <code>~/.config</code>.</p>
<p>The main reason I dislike programs looking for dotfiles in
<code>~/Library/Application Support</code> is that it’s <em>unexpected.</em> As <a href="https://github.com/nushell/nushell/issues/893#issuecomment-1736736555">Ashlin Eldridge
explained on GitHub</a>:</p>
<blockquote>
<p>As a new user, it’s extremely surprising to me to that a modern tool like
<code>nu</code> would put config files under Application Support on macOS. It’s even
more surprising to see that some people are
<a href="https://github.com/nushell/nushell/discussions/5279">actively</a>
<a href="https://news.ycombinator.com/item?id=33425312">against</a> adopting the XDG
standard.</p>
<p>The origins of XDG no longer matter at this point. No one really cares what
the X, D, and G stand for. The fact is that
<a href="https://wiki.archlinux.jp/index.php/XDG_Base_Directory">hundreds</a> of tools
support it (including Git, Emacs, Neovim, Tmux) and users have come to expect
support for it. It’s the closest thing we have to a standard that allows
users to control the placement of their config files (which facilitates
users’ ability to source control their files) and it also includes support
for files that shouldn’t be source controlled such as cache and data files.</p>
</blockquote>
<p>If a user explains that they found a program’s behavior surprising, many
engineers will respond by telling the user that their expectations were wrong.
However, I find that the reason users form an incorrect mental model of a
program’s behavior is usually because the program’s design violated an
established convention from some broader context. In accordance with <a href="https://en.wikipedia.org/wiki/Principle_of_least_astonishment">the
Principle of Least Astonishment</a>, I prefer to change the program to
behave how users expect rather than futilely attempt to change what users
expect.</p>
<p>Users expect macOS CLI tools to look for configuration files in <code>~/.config</code> is
because <strong>that’s what almost every other program does.</strong> Your program should
probably not disagree with Bash and Vim and Git about where configuration files
are supposed to go!</p>
<p>These conventions help us explore unfamiliar systems by letting us apply
knowledge about one part of the system to other parts of the system.
Consistency is predictability. When every tool works the same except for a
small handful, users get justifiably annoyed at the exceptions for wasting
their time.</p>
<h2 id="what-do-dotfile-managers-do"><a href="#what-do-dotfile-managers-do" aria-label="Link to section what-do-dotfile-managers-do">#</a>What do dotfile managers do?</h2>
<p>Many engineers use (or maintain) some sort of dotfile manager to handle
tracking these configuration files. If configuration files are really supposed
to go in <code>~/Library/Application Support</code>, we would expect dotfile managers to
put configuration files there by default when running on macOS. After all, the
whole point of a dotfile manager is to simplify managing configuration files
across multiple machines and platforms. Let’s take a quick survey to see how
some popular dotfile managers behave on macOS:</p>
<ul>
<li><a href="https://www.chezmoi.io/">chezmoi</a> (14.3k stars) makes no effort to link
configuration to <code>~/Library/Application Support</code>, despite including
<a href="https://www.chezmoi.io/user-guide/machines/macos/">documentation for using chezmoi on macOS
specifically</a>.</li>
<li><a href="https://github.com/anishathalye/dotbot">dotbot</a> (7.3k stars) ignores
<code>~/Library/Application Support</code>. Despite including macOS-specific
configuration files in the examples, the README shows a configuration for VS
Code that will be completely ignored on macOS.</li>
<li><a href="https://github.com/yadm-dev/yadm">yadm</a> (5.5k stars) makes no effort to
support <code>~/Library/Application Support</code>. The example configurations include
macOS-specific portions but also do not reference <code>~/Library/Application Support</code>.</li>
<li><a href="https://github.com/thoughtbot/rcm">rcm</a> (3.2k stars) makes no effort to
support <code>~/Library/Application Support</code>.</li>
<li><a href="https://www.gnu.org/software/stow/">GNU Stow</a> makes (unsurprisingly) no
effort to support <code>~/Library/Application Support</code>.</li>
</ul>
<p>Most of these tools are <em>able</em> to link configuration files to
<code>~/Library/Application Support</code> if you ask them to explicitly (although macOS
will regularly replace your symlinks with copies of the destination files), but
the fact that they don’t bother to do so by default is revealing. Users only
want this behavior for specific misbehaving programs.</p>
<h2 id="an-appeal-to-logic"><a href="#an-appeal-to-logic" aria-label="Link to section an-appeal-to-logic">#</a>An appeal to logic</h2>
<p>Perhaps “consistency” isn’t a good enough reason for you to place your
program’s configuration files in <code>~/.config</code> like everybody else. Maybe you
think that programs should follow the platform guidelines, even if they don’t
match developer expectations. <a href="https://github.com/dirs-dev/directories-rs/issues/47#issuecomment-478337412">@soc on GitHub</a> phrases it like this:</p>
<blockquote>
<p>As a general advice for macOS devs: If you are developing on their platform,
do what the platform owners tell you. They are the lords, you are the
share-croppers.</p>
</blockquote>
<p>Elsewhere, <a href="https://github.com/nushell/nushell/issues/12103#issuecomment-1982144513">Reilly Wood rebukes</a> a user asking if there would “be any
downside to just not using <code>Application Support</code> ever” by saying that “[Nushell
would] no longer be following the <a href="https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/FileSystemOverview/FileSystemOverview.html#//apple_ref/doc/uid/TP40010672-CH2-SW6">macOS Standard Directories
guidelines</a>.”</p>
<p>We’ll read through those guidelines in a minute, but it’s not entirely clear to
me that they’re relevant in the first place. The <a href="https://specifications.freedesktop.org/basedir-spec/latest/">XDG Base Directory
Specification</a> mentions Unix a few times but lists no carveouts for macOS
or any other operating system. If <code>~/.config</code> is accepted as the standard
location for configuration files on Unix-like operating systems, then surely it
would be the standard location on macOS as well, given that macOS is a Unix by
way of BSD.</p>
<p>But suppose we accept that the XDG specification only applies to <em>some</em> Unix
operating systems, despite making no mention of this. The <a href="https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/FileSystemOverview/FileSystemOverview.html#//apple_ref/doc/uid/TP40010672-CH2-SW6">macOS Standard
Directories</a> documentation starts by stating that
“[w]hether provided by the system or created by your app, every file has its
place in macOS”, and honestly we could stop reading right there, because <strong>a
command-line tool is not the system or an app.</strong></p>
<p>While this might seem like a pedantic nitpick, in reality it’s <em>critical</em> to
correctly interpreting this documentation! I suspect that many of the
developers who cite these guidelines do not know very much about macOS and
think that “app” is just what macOS calls executables, but that’s not true. A
couple screens down, the same page says that <code>/bin</code> “[c]ontains essential
command-line binaries”, so we can be sure the authors aren’t conflating apps
and command-line tools. Apps on macOS are installed in <code>/Applications</code> and are
subject to <a href="https://developer.apple.com/documentation/xcode/preparing-your-app-for-distribution">a number of additional requirements</a>, from a bundle ID
(a unique reverse-DNS identifier for an app, like <code>com.apple.Preview</code> for
<code>Preview.app</code>) to application icons, launch screens, code signing,
notarization, app sandboxing, and runtime hardening. Needless to say, none of
the developers shipping command-line utilities are following any of <em>these</em>
guidelines.</p>
<p>Moving on, <a href="https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/MacOSXDirectories/MacOSXDirectories.html#//apple_ref/doc/uid/TP40010672-CH10-SW1">the documentation for <code>~/Library/Application Support</code></a> says that it:</p>
<blockquote>
<p>Contains all app-specific data and support files. These are the files that
your app creates and manages on behalf of the user and can include files that
contain user data.</p>
</blockquote>
<p>Again, command-line tools do not have <em>any</em> app-specific data because they are
not apps. Further, dotfiles are usually written by hand and not managed <em>on
behalf of</em> the user.</p>
<p>The next paragraph makes it very clear that <code>~/Library/Application Support</code> is
for apps only:</p>
<blockquote>
<p>By convention, all of these items should be put in a subdirectory whose name
matches the bundle identifier of the app. For example, if your app is named
<code>MyApp</code> and has the bundle identifier <code>com.example.MyApp</code>, you would put your
app’s user-specific data files and resources in the <code>~/Library/Application Support/com.example.MyApp/</code> directory. Your app is responsible for creating
this directory as needed.</p>
</blockquote>
<p>Command-line tools do not have a bundle identifier, including many command-line
tools shipped with macOS by Apple (such as <code>ls</code> or <code>vim</code>). And even though
<a href="https://git.lix.systems/lix-project/lix/issues/515">Apple feels very comfortable shipping command-line tools that behave in a
subtly different manner from their equivalents on other modern Unix-descendent
operating systems,</a> the macOS variants of <code>bash</code>, <code>zsh</code>, <code>git</code>, and
<code>vim</code> all look for their configuration files in the same place: <code>~/.config</code>.
Unless your tool is installed in <code>/Applications</code>, there’s no reason for its
configuration to live in <code>~/Library/Application Support</code>.</p>
<h2 id="when-should-you-use-library-application-support"><a href="#when-should-you-use-library-application-support" aria-label="Link to section when-should-you-use-library-application-support">#</a>When <em>should</em> you use <code>~/Library/Application Support</code></h2>
<p>With the guidelines and conventions listed above in mind, your application
should store its configuration files in <code>~/Library/Application Support</code> instead
of <code>$XDG_CONFIG_HOME</code> if both of the following conditions apply:</p>
<ol>
<li>It is a GUI application installed in <code>/Applications</code> or <code>~/Applications</code>.</li>
<li>It manages its configuration files automatically on behalf of the user,
rather than expecting the user to write their configuration in a text file
themself.</li>
</ol>
<h2 id="tl-dr"><a href="#tl-dr" aria-label="Link to section tl-dr">#</a>TL;DR</h2>
<p>Users do not expect command-line tools to look for configuration files in
<code>~/Library/Application Support</code> on macOS. Dotfile managers do not place
configuration files in <code>~/Library/Application Support</code> on macOS. The most
commonly-cited justifications for placing configuration files in
<code>~/Library/Application Support</code> are not meant to apply to command-line tools at
all. Even command-line tools like <code>bash</code> and <code>git</code> shipped by Apple look for
their configuration files in <code>~/.config</code>.</p>
<p>Please, please, <em>please</em> just use the <a href="https://specifications.freedesktop.org/basedir-spec/latest/">XDG Base Directory Specification</a>.</p>

        
        
    </div></div>
  </body>
</html>
