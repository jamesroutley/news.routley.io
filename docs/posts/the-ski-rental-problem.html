<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lesves.github.io/articles/ski-rental/">Original</a>
    <h1>The Ski Rental Problem</h1>
    
    <div id="readability-page-1" class="page"><section>
                    
    
<p>The ski rental problem is a classic example problem in online algorithms. It feels like a small but interesting problem that can be explained relatively easily while some clever tricks can be applied to it.</p>
<p>In this article, I took <a href="https://courses.cs.duke.edu/fall13/compsci530/notes/lec23.pdf">these lecture notes</a> by Debmalya Panigrahi and Hangjie Ji and tried to rewrite them in a way that is easier to understand (at least for me).</p>
<h2 id="formulation">Formulation</h2>
<p>You are going skiing in the mountains but you are unsure about the weather reports and don&#39;t know how many days you will want to ski (and it can be any number of days).
Renting skis costs $1$ unit of currency while buying them costs $B$ units of currency.
The question is whether you should buy skis and on which day.</p>
<h2 id="optimal-offline-algorithm">Optimal offline algorithm</h2>
<p>Assuming you wound know the number $k$ of days you will want to ski in advance, an optimal algorithm can be derived.
If $k \geq B$, you should buy the skis and if $k &lt; B$, you should only rent them.
So you will pay $\min\{k, B\}$.</p>
<p>We will need this later, so let&#39;s call it $\text{opt}(k) = \min\{k, B\}$.</p>
<h2 id="simple-online-algorithm">Simple online algorithm</h2>
<p>But what about if you don&#39;t know $k$?</p>
<p>A simple algorithm is to buy the skis when you paid $B$ for renting them.
So, the cost is $$\text{alg}(k) = \begin{cases}k &amp; \text{if }k\leq B\\ B+B &amp; \text{if }k&gt;B\end{cases}.$$</p>
<p>We will study the competitive ratio $\rho$ defined as the worst-case ratio of a given online algorithm and the optimal offline algorithm.
$$
\rho_\text{simple} = \max_k \frac{\text{alg(k)}}{\text{opt}(k)} = \max_k \begin{Bmatrix}\frac{k}{k} &amp; \text{if }k \leq B\\ \frac{B+B}{B} &amp; \text{if }k &gt; B\end{Bmatrix} = \max_k \begin{Bmatrix}1 &amp; \text{if }k \leq B\\ 2 &amp; \text{if }k &gt; B\end{Bmatrix} = 2
$$
So, the simple online algorithm is at most two times worse than the offline &#34;future knowing&#34; algorithm.</p>
<h2 id="the-randomized-algorithm">The randomized algorithm</h2>
<p>Let&#39;s try to find a better performing randomized algorithm. In fact, an algorithm with $\mathbb{E}[\rho]\approx\frac{e}{e-1}$ exists. This could be useful for example if we do many such decisions and want to do well on average.</p>
<p>In this algorithm, we will buy skis on the $(i+1)$-th day with probability $P_i$. These probabilities should satisfy $\sum_{i=0}^\infty P_i = 1$. We will also assume that the ski buying events are independent.</p>
<p>So when we buy the skis on day $i+1$, we pay $i+B$ if $i &lt; k$ and $k$ if $i \geq k$, thus the expected cost is:
$$
\mathbb{E}\left[\text{alg}(k)\right] = k\sum_{i\geq k}P_i + \sum_{i&lt;k}(i+B)P_i
$$</p>
<p>We will approximate this with a continuous probability distribution with probability density $P(x)$:
$$
\mathbb{E}\left[\text{alg}(k)\right] \approx k\int_k^\infty P(x)\mathrm{d}x + \int_0^k (x+B)P(x)\mathrm{d}x
$$
Thus, we have switched from a discrete algorithm to a continuous one, so it will tell us the exact time when to buy instead of some day. With it we will approximate the discrete solution (which also exists but is more complicated to analyze).</p>
<p>Now, we would like to find the optimal probability distribution $P(x)$ such that the competitive ratio $\rho$ is the lowest. We will use an insight which we won&#39;t prove. The insight is that the optimal choice is such a distribution $P(x)$ that $\alpha = \frac{\mathbb{E}\left[\text{alg}(k)\right]}{\text{opt}(k)}$ does not depend on $k$. Thus, $\mathbb{E}\left[\rho\right] = \max_k\frac{\mathbb{E}\left[\text{alg}(k)\right]}{\text{opt}(k)} = \max_k\alpha = \alpha$.</p>
<p>So, we have
$$
\begin{aligned}
\frac{\mathbb{E}\left[\text{alg}(k)\right]}{\text{opt}(k)} &amp;= \alpha \\
k\int_k^\infty P(x)\mathrm{d}x + \int_0^k (x+B)P(x)\mathrm{d}x &amp;= \alpha\min\{k, B\}
\end{aligned}
$$</p>
<p>And we have two cases,</p>
<h3 id="i-when-k-geq-b">I) When $k \geq B$</h3>
<p>We differentiate both sides with respect to $k$:
$$
\begin{aligned}
\global\def\der{\frac{\mathrm{d}}{\mathrm{d}k}}
\global\def\Der#1{\frac{\mathrm{d}#1}{\mathrm{d}k}}
k\int_k^\infty P(x)\mathrm{d}x + \int_0^k (x+B)P(x)\mathrm{d}x &amp;= \alpha B \\
\der\left(k\int_k^\infty P(x)\mathrm{d}x + \int_0^k (x+B)P(x)\mathrm{d}x\right) &amp;= \Der{\alpha B} \\
\Der{k}\int_k^\infty P(x)\mathrm{d}x + k\der\left(\int_k^\infty P(x)\mathrm{d}x\right) + \der\left(\int_0^k (x+B)P(x)\mathrm{d}x\right) &amp;= 0 \\
\int_k^\infty P(x)\mathrm{d}x - kP(k) + (k+B)P(k) &amp;= 0 \\
\int_k^\infty P(x)\mathrm{d}x + BP(k) &amp;= 0
\end{aligned}
$$
Because $P(x) \geq 0$, the integral is nonnegative. And because $B &gt; 0$, the integral must be zero and $P(k) = 0$ in order to satisfy the equation.</p>
<h3 id="ii-when-k-b">II) When $k &lt; B$</h3>
<p>We proceed in a similar fashion:
$$
\begin{aligned}
k\int_k^\infty P(x)\mathrm{d}x + \int_0^k (x+B)P(x)\mathrm{d}x &amp;= \alpha k \\
\int_k^\infty P(x)\mathrm{d}x + BP(k) &amp;= \alpha
\end{aligned}
$$
However, now we take the derivative once more:
$$
\begin{aligned}
\der\int_k^\infty P(x)\mathrm{d}x + \der BP(k) &amp;= \Der{\alpha} \\
B\Der{P(k)} - P(k) &amp;= 0
\end{aligned}
$$</p>
<p>This is a differential equation, which can be solved as $P(k) = Ae^\frac{k}{B}$, where $A$ is some constant.</p>
<p>We have the constraint that $\int_0^\infty P(x)\mathrm{d}x = 1$, so if we combine both cases, we get:
$$
\begin{aligned}
\int_0^\infty P(x)\mathrm{d}x = \int_0^B Ae^\frac{k}{B}\mathrm{d}k &amp;= 1 \\
\left[ABe^\frac{k}{B}\right]_0^B &amp;= 1 \\
ABe - AB &amp;= 1 \\
AB(e - 1) &amp;= 1 \\
A &amp;= \frac{1}{B(e-1)}
\end{aligned}
$$</p>
<p>So, the probability distribution is
$$
P(x) = \begin{cases}
\frac{1}{B(e-1)}e^\frac{x}{B} &amp; \text{if }x &lt; B \\
0 &amp; \text{else}
\end{cases}
.
$$</p>
<p>Finally, we calculate the expected competitive ratio:
$$
\mathbb{E}\left[\rho_\text{rand}\right] = \max_k \frac{\mathbb{E}\left[\text{alg}(k)\right]}{\text{opt}(k)} = \alpha
$$
And since $\alpha$ is same for all $k$, we have
$$
\mathbb{E}\left[\rho_\text{rand}\right] \approx \frac{\frac{e^\frac{B}{B}}{B(e-1)}}{B} = \frac{e}{e-1}
$$</p>
<h2 id="applications">Applications</h2>
<p>This is probably not applicable in reality, however when one would do many decisions similar to this fictional scenario, the randomized algorithm could theoretically be a way to optimize the cost.</p>
<h2 id="code">Code</h2>
<p>I also coded it in Python just to play around. But be wary that in this code we are again solving the discrete problem by just approximating using the equivalent continuous problem.</p>
<pre data-lang="python"><code data-lang="python"><span>from </span><span>scipy.stats </span><span>import </span><span>rv_discrete
</span><span>from </span><span>scipy.integrate </span><span>import </span><span>quad
</span><span>import </span><span>numpy </span><span>as </span><span>np
</span><span>
</span><span>
</span><span>def </span><span>pdf</span><span>(</span><span>x</span><span>, </span><span>B</span><span>):
</span><span>    </span><span>if </span><span>0 </span><span>&lt;= x &lt; B:
</span><span>        </span><span>return </span><span>np.</span><span>exp</span><span>(x/B)/B/(np.e-</span><span>1</span><span>)
</span><span>    </span><span>return </span><span>0
</span><span>
</span><span>
</span><span>@np.</span><span>vectorize
</span><span>def </span><span>day_prob</span><span>(</span><span>k</span><span>, </span><span>B</span><span>):
</span><span>    </span><span>return </span><span>quad</span><span>(pdf, k, k+</span><span>1</span><span>, </span><span>args</span><span>=(B,))[</span><span>0</span><span>]
</span><span>
</span><span>
</span><span>cost = </span><span>float</span><span>(</span><span>input</span><span>(&#34;</span><span>Enter buy price of the item: </span><span>&#34;))
</span><span>rental_cost = </span><span>float</span><span>(</span><span>input</span><span>(&#34;</span><span>Enter rental price of the item per day: </span><span>&#34;))
</span><span>B_f = cost/rental_cost
</span><span>B = </span><span>int</span><span>(np.</span><span>ceil</span><span>(B_f))
</span><span>
</span><span>disc_prob = </span><span>day_prob</span><span>(np.</span><span>arange</span><span>(B), B_f)
</span><span>dist = </span><span>rv_discrete</span><span>(</span><span>values</span><span>=(</span><span>range</span><span>(B), disc_prob))
</span><span>
</span><span>print</span><span>(</span><span>f</span><span>&#34;</span><span>You should buy at day </span><span>{dist.</span><span>rvs</span><span>(</span><span>1</span><span>)+</span><span>1</span><span>}</span><span> (one based indexing).</span><span>&#34;)
</span></code></pre>


                </section></div>
  </body>
</html>
