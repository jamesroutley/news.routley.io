<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bytes.zone/micro/lffs-006/">Original</a>
    <h1>a dilemma, or is it a conundrum? Maybe it&#39;s a dilendrum!</h1>
    
    <div id="readability-page-1" class="page"><article><p><em>Brian Hicks, February 27, 2025</em></p><p>So I thought I had a pretty good thing going: in my last post, I documented some <a href="https://bytes.zone/micro/lffs-005/">early results from the time-tracking software that I wrote for <em>Local-First From Scratch</em></a>. I thought I was on track for an easy conversion to prose, then an easy beta-reading, then becoming a thousandaire and retiring to my <del>private island</del> couch to drink a budget mojito or whatever.</p><p>But then… I committed to giving a talk to a local meetup group about implementing CRDTs in Rust.</p><p>&#34;Simple!&#34;, I thought, &#34;I can just apply the stuff I&#39;ve already written to a new domain and it&#39;ll all work out.&#34;</p><p>Well… no, not so much.</p><span id="continue-reading"></span><p>It turns out that the time tracker, while valuable, can be represented almost entirely with extremely simple CRDTs. I think a last-write-wins register based on a hybrid logical clock is the most complex thing you need. That&#39;s not exactly CRDTs 101… but, it is like CRDTs 102.</p><p>This is not necessarily a bad thing, of course: it doesn&#39;t make the time tracker any less valuable <em>as software I use</em>, but it does mean that if you learn just enough to make it, then you have not learned enough to make something that acts like a normal CRUD app with records. Whoops! If I stop there, the book will not generalize to the problems that the reader actually might have to work through.</p><p>In this meetup talk, I found this out because I thought through implementing <a href="https://todomvc.com/">TodoMVC</a> (really the table stakes of client-side CRUD apps.) This is specifically because in addition to completing or editing the description of todos, we can also archive completed todos from a key-value map.</p><p>If you know anything about CRDTs, you may have just gone &#34;ahhh, Brian, I see your problem.&#34; If you don&#39;t, here&#39;s the deal: in order to store key removals efficiently, you have to store set removals efficiently (because the keys of a map are a set.) In order to store set removals efficiently, you need to use what some folks call an Observed Remove Set Without Tombstones (ORSWOT.) As the name implies, it doesn&#39;t store tombstones—which most other add/remove sets do!</p><p>Implementing an ORSWOT is not hard, <em>per se</em>, but it requires explaining a lot more of the mechanics of CRDTs than I had planned to in the book. In particular, now I need to explain vector clocks, dot context, dot kernels, etc.</p><p>Again, none of these are hard on their own, but taken together it&#39;s a lot of work that I haven&#39;t needed to do for the book as it&#39;s written so far.</p><p>So that leaves me needing a slightly more complex example for the book. And, I don&#39;t know… is TodoMVC interesting enough as an example to hold people&#39;s attention? Or, worse: does the fact that so much is required to make TodoMVC into a local-first syncable app mean that I&#39;m implicitly telling folks &#34;this seemingly-simple thing is actually super complex. Abandon hope, all ye who enter here.&#34;?</p><p>I think the way to thread the needle might be to make an app that&#39;s <em>nominally</em> more complex than TodoMVC, but not so much as to make the implementation become unmanageable in the prose. Just something to say &#34;oh yeah it&#39;s not so simple as TodoMVC… just a little more complex so we can see the full power of this thing.&#34; Maybe having projects as well as todos? Or dependencies? Or making a contact app with various forms of contact information? Or something else entirely?</p><p>I&#39;m not sure yet. I&#39;m leaning towards TodoMVC + some wrinkle, but if you have an opinion, then please email me. I&#39;d love to hear it.</p></article></div>
  </body>
</html>
