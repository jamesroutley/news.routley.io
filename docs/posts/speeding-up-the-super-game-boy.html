<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nicole.express/2023/super-game-boy-can-go-fast-too.html">Original</a>
    <h1>Speeding up the Super Game Boy</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>The Super Game Boy allows you to play Game Boy games on your Super Nintendo. This is an impressive feat, when you consider that the two consoles share basically nothing in common. Today, we’ll look at the hybrid machine that creates: a multi-processor machine where the two CPUs share nothing in common. And maybe, just maybe, we can make the Super Game Boy go <em>fast</em>.</p>

<h2 id="its-a-bird-its-a-plane">It’s a bird, it’s a plane</h2>

<p><img src="https://nicole.express/assets/img/super-de-duper/sgb.jpeg" title="the REAL tower of power, for those who insist their towers of power have data buses of 8 bits or less" alt="Super Game Boy"/></p>

<p>So, the Super Game Boy. <a href="https://blog.loveconquersallgames.com/post/2350461718/fuck-the-super-game-boy-introduction">Christine Love</a> has already said pretty much everything there is to say about it, right? And I think from an aesthetic standpoint, and from a standpoint of how the thing was actually used by developers, that may well be true. So go read her series. This post will be here when you get back.</p>

<p>Are you back? Great. Never leave me again. So one of the games Christine Love talked about was <em>World Heroes 2 Jet</em>. She notes that it used some clever palette tricks to make it look good. Cool stuff. Unfortunately it’s still a Game Boy fighting game.</p>

<p><img src="https://nicole.express/assets/img/super-de-duper/jet.jpg" title="I&#39;m leaving, on a jet plane" alt="World Heroes 2 Jet on Game Boy"/></p>

<p>Oh hey, it’s Takara again, the same people who ported <a href="https://nicole.express/2023/fatally-slow-fury.html"><em>Fatal Fury</em></a> to the SNES. I swear I’m not targeting them. After all, they went above and beyond in the port– as <a href="https://tcrf.net/World_Heroes_2_Jet_(Game_Boy)"><em>The Cutting Room Floor</em></a> notes, it even included an adorable little “4 Mega Shock” message, though it was removed in the final and you’ll need a Game Genie code to make it show again.</p>

<p><img src="https://nicole.express/assets/img/super-de-duper/4mega.jpg" title="now that&#39;s what i call PRO GEAR SPEC" alt="The 4 Mega Shock"/></p>

<p>No, what this is about is a ROM hack of the game by TCRF contributor nensondubois, <a href="https://www.romhacking.net/hacks/7744/"><em>World Heroes 2 Jet True SGB Turbo Mode</em></a>, which purports to overclock the Super Game Boy. Now, this sort of “turbo mode” is something you might have already heard of; but it was new to me. Let’s dig in.</p>

<h3 id="take-command-or-not">Take command… or not</h3>

<p>Another device that purports to be able to change the speed of the Super Game Boy is third-party controller manufacturer Hori’s <em>Super Game Boy Commander</em>. Hori is known to be a contributor to the Super Game Boy’s development, so it makes sense that they would understand it well. Unfortunately, my SGB Commander looks like this:</p>

<p><img src="https://nicole.express/assets/img/super-de-duper/broken.JPEG" title="Hori hori hori" alt="A disassembled SGB Commander"/></p>

<p>A previous owner of this controller flexed it so aggressively the surface-mount microcontroller tore off all the pads on one side; this is also the side where the buttons press down, so it’s quite a challenge to fix, beyond my repair skills, though I did attempt. For now, it stays in a bag. This is the risk you take by buying “untested” things. We all know they’re broken– you just never know <em>how</em> broken.</p>

<h2 id="clock-speeds">Clock speeds</h2>

<p>I’m using a US-market Super Game Boy. This is well-known to run fast as-is. Listen to this segment from <em>The Castlevania Adventure</em> on the Super Game Boy:</p>

<p><audio controls="" src="/assets/img/super-de-duper/cv-sgb.wav">Your browser does not support the <code>audio</code> element.</audio></p><p>Now, here it is on the Game Boy Player for the Nintendo GameCube, which doesn’t have the speed issue. (This is using the popular <a href="https://www.gc-forever.com/wiki/index.php?title=Game_Boy_Interface">Game Boy Interface</a> homebrew, in case you’re curious)</p>

<p><audio controls="" src="/assets/img/super-de-duper/cv-gbp.wav">Your browser does not support the <code>audio</code> element.</audio></p><p>This might not sound that significant, but this speed difference also causes the link cable to not work. But what causes the speed difference? Did Nintendo just think that early Game Boy games like <em>The Castlevania Adventure</em> were too sluggish? Well, maybe, but probably not. There’s a technical reason.</p>

<p><img src="https://nicole.express/assets/img/super-de-duper/pin1.JPEG" title="That pin, officer, right there" alt="Super Game Boy circuitboard showing pin 1"/></p>

<p>Here’s pin 1 on the Super Game Boy’s circuitboard. SNES connoisseurs will note that this side segment is usually not populated on most games; they contain signals that usually aren’t needed. This signal here is <code>MASTER_CLOCK</code>, the 21.477MHz main clock of the Super Nintendo, generated by a crystal oscillator.</p>

<p>Why 21.477MHz? Why, because that’s the color carrier frequency in <a href="https://nicole.express/2021/shouldve-had-field-sequential.html">composite video</a>! Specifically, it’s six times the <a href="https://en.wikipedia.org/wiki/Colorburst">color burst</a> frequency, which makes it fairly convenient. Every other frequency in the Super Nintendo is derived from this. Remember those three clock speeds?</p>

<table>
  <thead>
    <tr>
      <th>Frequency</th>
      <th>Ratio</th>
      <th>Use</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>21.48MHz</td>
      <td>1</td>
      <td>Main crystal, pin 1</td>
    </tr>
    <tr>
      <td>3.58MHz</td>
      <td>1/6</td>
      <td>S-CPU Fast ROM, hardware registers, color burst</td>
    </tr>
    <tr>
      <td>2.68MHz</td>
      <td>1/8</td>
      <td>S-CPU Slow ROM, RAM</td>
    </tr>
    <tr>
      <td>1.79MHz</td>
      <td>1/12</td>
      <td>Accessing controllers</td>
    </tr>
  </tbody>
</table>

<p>1.79MHz is also the clock speed of the NES CPU. Oh, and all of these, including the console speeds, the color burst frequency, are from the NTSC standard and refer to the Super Nintendo used in North America and Japan. The rest of the world is on its own.</p>

<p>Deriving all your other frequencies from a master clock has a few big benefits. The biggest is you only need one oscillator. The other is that all your pieces will run in a predictable synchronized way; every crystal has some variation, so once you have multiple clocks on one board, you start running into issues with determinism.</p>

<p>You might notice that these are all multiples of even numbers. This makes sense when you think about clock divisions; it’s easy to divide a clock by two and get a nice even clock. Dividing by three, though, can result in an asymmetric clock pulse. Generally, you want each “up” and “down” phase to be the same width, so fractions like 1/2, 1/4, and 1/6 are preferred over 1/3.</p>

<p><img src="https://nicole.express/assets/img/super-de-duper/wavy.png" title="wow" alt="A wave being divided in half"/></p>

<p>The downside, though, is that you can’t really divide things by weird fractions. I mean, you can, but it’s weird and complicated and probably not great. And this is a problem, as the Nintendo Game Boy’s “I can’t believe it’s not a Z80!” CPU runs at a clock speed of 4.19MHz.</p>



<p>And so the Super Game Boy has to fudge the numbers a bit.</p>

<p><img src="https://nicole.express/assets/img/super-de-duper/icd2.JPEG" title="Macro lenses are macrotastic" alt="Highly zoomed in on Nintendo ICD2 chip"/></p>

<p>Specifically, it’s the <a href="https://gbdev.gg8.se/wiki/articles/ICD2">ICD2</a> that fudges the numbers. The default clock divider of the Super Game Boy is divided by 5, giving 4.296MHz. You might notice that this isn’t a nice even number to divide by; I’m not sure if the clock divider is able to equalize this or if that doesn’t matter to the Game Boy.</p>

<p>What’s more worthwhile is that the clock divider can actually be controlled by the lowest two bits of a register on the S-CPU side, <code>0x6003</code>. I’ve gotten some values from <a href="https://github.com/ares-emulator/ares/blob/3ca1f9ebb4ae3f472f7fba661746058f84126536/ares/sfc/coprocessor/icd/io.cpp#L53">the byuu/ares emulator</a>, which I consider the gold standard for SNES documentation.</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>Divider</th>
      <th>CPU Clock</th>
      <th>Change from DMG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>00</code></td>
      <td>1 / 4</td>
      <td>5.12MHz</td>
      <td>+22%</td>
    </tr>
    <tr>
      <td><code>01</code></td>
      <td>1 / 5</td>
      <td>4.30MHz</td>
      <td>+2.5%</td>
    </tr>
    <tr>
      <td><code>10</code></td>
      <td>1 / 7</td>
      <td>3.07MHz</td>
      <td>-27%</td>
    </tr>
    <tr>
      <td><code>11</code></td>
      <td>1 / 9</td>
      <td>2.39MHz</td>
      <td>-43%</td>
    </tr>
  </tbody>
</table>



<h2 id="back-to-fast-mode">Back to fast mode</h2>

<p>So let’s take a look at nensondubois’ hack.</p>

<p><video src="/assets/img/super-de-duper/heroes.mp4" controls="" width="100%"> You don&#39;t have a video tag support or something? So you can&#39;t see this footage of *World Heroes 2 Jet*? Ah too bad.</video></p>

<p>You might not have the experience with <em>World Heroes 2 Jet</em> to recognize it’s running faster, so here’s the audio from <em>Castlevania</em> again.</p>

<p><audio controls="" src="/assets/img/super-de-duper/cv-sgb-fast.wav">Your browser does not support the <code>audio</code> element.</audio></p><p>And look at the <em>World Heroes 2 Jet</em> footage again. Sure, it’s running faster. But why is it so glitchy? And that applies pretty much everywhere. Because I don’t have a working SGB Commander (see above), I took this screenshot using an Everdrive. Since <em>The Castlevania Adventure</em> has no Super Game Boy functionality, it kept the existing border.</p>

<p><img src="https://nicole.express/assets/img/super-de-duper/camera.jpg" title="where in the world is carmen sandiego" alt="Screenshot showing screen glitching"/></p>

<p>By default, the Game Boy CPU runs at, as we saw, runs at 4.19MHz. Its frame rate is 59.73Hz. The Super Nintendo’s frame rate is 60.09Hz; it runs a little fast, much like its predecessor. Realistically, these are close enough; the ICD2 is designed to bridge the gap. But running faster, the ICD2, and the Super Game Boy firmware running on the slow S-CPU for that matter, can’t keep up. Hence, we start getting failed frames, where wrong bits are read out, areas meant for different parts of the screen.</p>

<p>The opposite issue doesn’t seem to be a big deal with slower modes.</p>

<h2 id="how-does-it-work">How does it work?</h2>

<p>So, what if you wanted to do something with this yourself? It seems that Nintendo didn’t quite want people using this mode. For one thing, it’s only accessible from the Super Nintendo side of the system; it’s not exposed by the Super Game Boy BIOS to the Game Boy side. That isn’t a huge deal; a Super Game Boy-aware Game Boy game can upload code to the Super Nintendo the same way it can upload graphics data to use as a border. But it is an extra step compared to the registers.</p>

<p>We actually have <a href="https://archive.org/details/GameBoyProgManVer1.1/page/n5/mode/2up">the documentation Nintendo gave to its developers</a> back in the 1990’s. It documents the <code>0x6003</code> register as follows:</p>

<p><img src="https://nicole.express/assets/img/super-de-duper/manual.png" title="illegal documentation" alt="Manual showing the fixed values for clock"/></p>

<p>Notice that the last two bits, which control the clock divider, are fixed to <code>01</code>; since the speed-changing features are undocumented, my expectation is that Nintendo would probably fail any Game Boy game in lot check that tried to use them if they found out. (As noted, Hori contributed to development of the SGB) And of course, the glitchiness makes the fastest speed not particularly usable.</p>

<p>Still, this is a cool feature to mess around with nowadays, and I didn’t even know it existed until now. I hope I can get my SGB Commander working; though come on, we all know I’ll just buy a working one.</p>

  </div>

  
</article>

      </div>
    </div></div>
  </body>
</html>
