<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/littledivy/b9351c3ccf8ab99f7e14461db37044dc">Original</a>
    <h1>Beware of Bun.js</h1>
    
    <div id="readability-page-1" class="page"><div>
  <div id="file-beware_of_bun-md">
      
      <div id="file-beware_of_bun-md-readme">
    <article itemprop="text"><blockquote>
<p dir="auto">Disclaimer: I work on Deno, these are my own personal opinions.</p>
</blockquote>

<p dir="auto">As a performance engineer, I am disgusted to look at their benchmarks and the fact that it&#39;s &#39;forged&#39;. Makes me very sad.</p>
<p dir="auto">And then you try <a href="https://github.com/oven-sh/bun/pull/657" data-hovercard-type="pull_request" data-hovercard-url="/oven-sh/bun/pull/657/hovercard">correcting them</a>, they don&#39;t want to be corrected. Later, they try to hire you :)</p>
<p dir="auto">Let&#39;s look at their latest benchmarks:</p>
<h3 dir="auto"><a id="user-content-ffi" aria-hidden="true" href="#ffi"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>FFI</h3>
<p dir="auto"><a href="https://github.com/oven-sh/bun/blob/0a1fca5d7d7806b8c9b00ab43f76e5f52148d01b/bench/ffi/deno.js">https://github.com/oven-sh/bun/blob/0a1fca5d7d7806b8c9b00ab43f76e5f52148d01b/bench/ffi/deno.js</a></p>
<p dir="auto">Replace <code>&#34;pointer&#34;</code> with <code>&#34;buffer&#34;</code> and remove redundant calls to  <code>Deno.UnsafePointer.of</code>.</p>
<div dir="auto"><pre>const {
  symbols: { ffi_noop, ffi_hash, ffi_string },
} = Deno.dlopen(path, {
  ffi_noop: { parameters: [], result: &#34;void&#34; },
  ffi_string: { parameters: [], result: &#34;pointer&#34; },
<span><span>-</span> ffi_hash: { parameters: [&#34;pointer&#34;, &#34;u32&#34;], result: &#34;u32&#34; },</span>
<span><span>+</span> ffi_hash: { parameters: [&#34;buffer&#34;, &#34;u32&#34;], result: &#34;u32&#34; },</span>
});

const bytes = new Uint8Array(64);

group(&#34;deno:ffi&#34;, () =&gt; {
  bench(&#34;noop&#34;, () =&gt; ffi_noop());
<span><span>-</span>  bench(&#34;hash&#34;, () =&gt; ffi_hash(Deno.UnsafePointer.of(bytes), bytes.byteLength));</span>
<span><span>+</span>  bench(&#34;hash&#34;, () =&gt; ffi_hash(bytes, bytes.byteLength));</span>
  bench(&#34;c string&#34;, () =&gt;
<span><span>-</span>   new Deno.UnsafePointerView(ffi_string()).getCString()</span>
<span><span>+</span>   Deno.UnsafePointerView.getCString(ffi_string())</span>
  );
});</pre></div>
<p dir="auto">It&#39;s intentional made so Deno is slow: <a href="https://github.com/oven-sh/bun/commit/40506e33e73018103bcf08d3e0087eb915ba472b">https://github.com/oven-sh/bun/commit/40506e33e73018103bcf08d3e0087eb915ba472b</a></p>
<p dir="auto">On my machine, Deno is ~4x faster than Bun on this benchmark.</p>
<h3 dir="auto"><a id="user-content-sqlite" aria-hidden="true" href="#sqlite"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>sqlite</h3>
<p dir="auto"><a href="https://github.com/oven-sh/bun/tree/main/bench/sqlite">https://github.com/oven-sh/bun/tree/main/bench/sqlite</a></p>
<p dir="auto">It&#39;s using <code>deno.land/x/sqlite</code> which is a Wasm module instead of a faster native module: <code>deno.land/x/sqlite3</code>. Fair comparison is not Bun&#39;s thing anyways.</p>
<h3 dir="auto"><a id="user-content-ssr" aria-hidden="true" href="#ssr"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ssr</h3>
<p dir="auto"><a href="https://github.com/oven-sh/bun/tree/main/bench/react-hello-world">https://github.com/oven-sh/bun/tree/main/bench/react-hello-world</a></p>
<p dir="auto">No <code>Date</code> header. <code>bytes/req</code> is not the same. Using a forked react version that is not even readable.</p>
<blockquote>
<p dir="auto">Note, the minfied react is not what is sent to the client. It is the dependency and heavily modified.</p>
</blockquote>
<p dir="auto">its not how you make benchmarks ffs!</p>
<p dir="auto">This is a marketing play and lots of developers fall into the trap sadly :(</p>
</article>
  </div>

  </div>
</div></div>
  </body>
</html>
