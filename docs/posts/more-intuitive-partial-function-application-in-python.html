<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/chrisgrimm/better_partial">Original</a>
    <h1>More intuitive partial function application in Python</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text">
<p dir="auto">Install with:</p>
<div data-snippet-clipboard-copy-content="pip install better-partial"><pre><code>pip install better-partial
</code></pre></div>
<p dir="auto">I find <code>functools.partial</code> unintuitive so I coded up a better version. Let&#39;s play around with it. You apply it as a decorator to your functions:</p>
<div data-snippet-clipboard-copy-content="import better_partial as bp

@bp.partial
def some_operation(x, p1, p2):
  return (x + p1) * p2"><pre><span>import</span> <span>better_partial</span> <span>as</span> <span>bp</span>

<span>@<span>bp</span>.<span>partial</span></span>
<span>def</span> <span>some_operation</span>(<span>x</span>, <span>p1</span>, <span>p2</span>):
  <span>return</span> (<span>x</span> <span>+</span> <span>p1</span>) <span>*</span> <span>p2</span></pre></div>
<p dir="auto">On the surface nothing really changes. <code>some_operation</code> behaves just like a normal function when you pass it values</p>
<div data-snippet-clipboard-copy-content="some_operation(1, 2, 3)  # --&gt; 9"><pre><span>some_operation</span>(<span>1</span>, <span>2</span>, <span>3</span>)  <span># --&gt; 9</span></pre></div>
<p dir="auto">but under the hood my <code>partial</code> decorator is working all kinds of magic. Imagine you need to pass a function of <code>x</code> to some other part of your codebase and <code>some_operation</code>, with a particular setting of <code>p1 = 10</code> and <code>p2 = 20</code>, fits the bill. In order to make this work, you&#39;d have to wrap <code>some_operation</code> like this:</p>
<div data-snippet-clipboard-copy-content="func = lambda x: some_operation(x, 10, 20)"><pre><span>func</span> <span>=</span> <span>lambda</span> <span>x</span>: <span>some_operation</span>(<span>x</span>, <span>10</span>, <span>20</span>)</pre></div>
<p dir="auto">or this</p>
<div data-snippet-clipboard-copy-content="def func(x):
  return some_operation(x, 10, 20)"><pre><span>def</span> <span>func</span>(<span>x</span>):
  <span>return</span> <span>some_operation</span>(<span>x</span>, <span>10</span>, <span>20</span>)</pre></div>
<p dir="auto">The <code>bp.partial</code> decorator makes this a bit nicer. By supplying a <code>bp._</code> placeholder for any argument in <code>some_operation</code> we can produce a new function where the variables replaced by <code>bp._</code> are omitted:</p>
<div data-snippet-clipboard-copy-content="func = some_operation(bp._, 10, 20)
func(x) == some_operation(x, 10, 20)  # --&gt; True"><pre><span>func</span> <span>=</span> <span>some_operation</span>(<span>bp</span>.<span>_</span>, <span>10</span>, <span>20</span>)
<span>func</span>(<span>x</span>) <span>==</span> <span>some_operation</span>(<span>x</span>, <span>10</span>, <span>20</span>)  <span># --&gt; True</span></pre></div>
<p dir="auto">You can replace any positional arguments with <code>bp._</code> to perform partial function applications</p>
<div data-snippet-clipboard-copy-content="@bp.partial
def f(a, b, c, d, e):
  return a + b + c + d + e
  
g = f(bp._, 0, bp._, 0, bp._)
g(1, 3, 5)  # --&gt; 1 + 0 + 3 + 0 + 5"><pre><span>@<span>bp</span>.<span>partial</span></span>
<span>def</span> <span>f</span>(<span>a</span>, <span>b</span>, <span>c</span>, <span>d</span>, <span>e</span>):
  <span>return</span> <span>a</span> <span>+</span> <span>b</span> <span>+</span> <span>c</span> <span>+</span> <span>d</span> <span>+</span> <span>e</span>
  
<span>g</span> <span>=</span> <span>f</span>(<span>bp</span>.<span>_</span>, <span>0</span>, <span>bp</span>.<span>_</span>, <span>0</span>, <span>bp</span>.<span>_</span>)
<span>g</span>(<span>1</span>, <span>3</span>, <span>5</span>)  <span># --&gt; 1 + 0 + 3 + 0 + 5</span></pre></div>
<p dir="auto">The functions produced by these partial applications also support further partial application. Consider using the <code>g</code> from above again:</p>
<div data-snippet-clipboard-copy-content="h = g(1, bp._, bp._)
h(3, 5)  # --&gt; 1 + 0 + 3 + 0 + 5"><pre><span>h</span> <span>=</span> <span>g</span>(<span>1</span>, <span>bp</span>.<span>_</span>, <span>bp</span>.<span>_</span>)
<span>h</span>(<span>3</span>, <span>5</span>)  <span># --&gt; 1 + 0 + 3 + 0 + 5</span></pre></div>
<p dir="auto">This is great if you want to omit a few parameters and specify the rest, but what if it&#39;s the other way around? You just want to fix the values of a few parameters. <code>better_partial</code> lets you do this. Consider <code>f</code> from above and suppose that we want to fix <code>c = 5</code> and <code>a = 7</code>, you can do this too:</p>
<div data-snippet-clipboard-copy-content="g = f(..., c=5, a=7)

g(0, 0, 0)  # --&gt; 7 + 0 + 5 + 0 + 0
g(0, 0, 0) == f(7, 0, 5, 0, 0) == f(7, bp._, 5, bp._, bp._)(0, 0, 0)  # --&gt; True"><pre><span>g</span> <span>=</span> <span>f</span>(..., <span>c</span><span>=</span><span>5</span>, <span>a</span><span>=</span><span>7</span>)

<span>g</span>(<span>0</span>, <span>0</span>, <span>0</span>)  <span># --&gt; 7 + 0 + 5 + 0 + 0</span>
<span>g</span>(<span>0</span>, <span>0</span>, <span>0</span>) <span>==</span> <span>f</span>(<span>7</span>, <span>0</span>, <span>5</span>, <span>0</span>, <span>0</span>) <span>==</span> <span>f</span>(<span>7</span>, <span>bp</span>.<span>_</span>, <span>5</span>, <span>bp</span>.<span>_</span>, <span>bp</span>.<span>_</span>)(<span>0</span>, <span>0</span>, <span>0</span>)  <span># --&gt; True</span></pre></div>
<p dir="auto"><code>better_partial</code> lets you use the <code>...</code> sentenel to indicate that you <em>only</em> want to specify the values of what follows.</p>
<p dir="auto">An easy way to appreciate the flexibility and power of the <code>partial</code> operator is to see the variety of ways you can evaluate functions with it. Using the definition of <code>f</code> from above, all of the following lines are equivalent:</p>
<div data-snippet-clipboard-copy-content="f(1,2,3,4,5)
f(bp._, 2, bp._, 4, bp._)(1, 3, 5)
f(..., b=2, d=4)(1, 3, 5)
f(..., b=2, d=4)(1, bp._, 5)(3)
f(..., b=2, d=4)(..., c=3)(1, 5)"><pre><span>f</span>(<span>1</span>,<span>2</span>,<span>3</span>,<span>4</span>,<span>5</span>)
<span>f</span>(<span>bp</span>.<span>_</span>, <span>2</span>, <span>bp</span>.<span>_</span>, <span>4</span>, <span>bp</span>.<span>_</span>)(<span>1</span>, <span>3</span>, <span>5</span>)
<span>f</span>(..., <span>b</span><span>=</span><span>2</span>, <span>d</span><span>=</span><span>4</span>)(<span>1</span>, <span>3</span>, <span>5</span>)
<span>f</span>(..., <span>b</span><span>=</span><span>2</span>, <span>d</span><span>=</span><span>4</span>)(<span>1</span>, <span>bp</span>.<span>_</span>, <span>5</span>)(<span>3</span>)
<span>f</span>(..., <span>b</span><span>=</span><span>2</span>, <span>d</span><span>=</span><span>4</span>)(..., <span>c</span><span>=</span><span>3</span>)(<span>1</span>, <span>5</span>)</pre></div>
</article>
        </div></div>
  </body>
</html>
