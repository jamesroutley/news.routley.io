<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/luke-clifton/shh">Original</a>
    <h1>Shh: Simple Shell Scripting from Haskell</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><a href="http://hackage.haskell.org/package/shh" rel="nofollow"><img src="https://camo.githubusercontent.com/310fde611ca46b81c8acdec854958024aa76fff9634180c605288c231990a99a/68747470733a2f2f696d672e736869656c64732e696f2f6861636b6167652f762f7368682e7376673f636f6c6f72423d253233393939266c6162656c3d736868" alt="" data-canonical-src="https://img.shields.io/hackage/v/shh.svg?colorB=%23999&amp;label=shh"/></a>
<a href="http://hackage.haskell.org/package/shh-extras" rel="nofollow"><img src="https://camo.githubusercontent.com/7eb4707388f686d5bff558ef693c380dd1304f4e001a650cb5470ecf2ec5033d/68747470733a2f2f696d672e736869656c64732e696f2f6861636b6167652f762f7368682d6578747261732e7376673f636f6c6f72423d253233393939266c6162656c3d7368682d657874726173" alt="" data-canonical-src="https://img.shields.io/hackage/v/shh-extras.svg?colorB=%23999&amp;label=shh-extras"/></a>
<a href="https://builds.sr.ht/~lukec/shh/commits/nix.yml" rel="nofollow"><img src="https://camo.githubusercontent.com/74cc5b8cfb69f03a19c5de541b7ff77246faaaf4a2385e689897b5d1b4282fc3/68747470733a2f2f6275696c64732e73722e68742f7e6c756b65632f7368682f6e69782e796d6c2e737667" alt="" data-canonical-src="https://builds.sr.ht/~lukec/shh/nix.yml.svg"/></a></p>
<details><summary>
Shh is a library to enable convenient shell-like programming in Haskell.
It works well in scripts, and from GHCi, allowing you to use GHCi as a shell.
</summary>
<div dir="auto" data-snippet-clipboard-copy-content="{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE ExtendedDefaultRules #-}
{-# LANGUAGE QuasiQuotes #-}
module Readme (test) where

import Shh

import System.Environment
import Control.Concurrent.Async
import Prelude hiding (head)
import Test.Tasty
import Test.Tasty.HUnit
import Test.Tasty.QuickCheck
import qualified System.Directory
import qualified Data.ByteString.Lazy.Char8 as Char8
import Data.List (nub)
import Data.Char
import PyF

load SearchPath [&#34;echo&#34;, &#34;base64&#34;, &#34;cat&#34;, &#34;head&#34;, &#34;sleep&#34;, &#34;mktemp&#34;, &#34;ls&#34;, &#34;wc&#34;, &#34;find&#34;, &#34;tr&#34;, &#34;users&#34;, &#34;sha256sum&#34;, &#34;false&#34;, &#34;true&#34;]

curl :: Cmd
curl = true

test :: IO ()
test = do"><pre>{-# <span>LANGUAGE</span> TemplateHaskell #-}
{-# <span>LANGUAGE</span> OverloadedStrings #-}
{-# <span>LANGUAGE</span> ExtendedDefaultRules #-}
{-# <span>LANGUAGE</span> QuasiQuotes #-}
<span>module</span> <span>Readme</span> (<span>test</span>) <span>where</span>

<span>import</span> <span>Shh</span>

<span>import</span> <span>System.Environment</span>
<span>import</span> <span>Control.Concurrent.Async</span>
<span>import</span> <span>Prelude</span> <span>hiding</span> (<span>head</span>)
<span>import</span> <span>Test.Tasty</span>
<span>import</span> <span>Test.Tasty.HUnit</span>
<span>import</span> <span>Test.Tasty.QuickCheck</span>
<span>import</span> <span>qualified</span> <span>System.Directory</span>
<span>import</span> <span>qualified</span> <span>Data.ByteString.Lazy.Char8</span> <span>as</span> <span>Char8</span>
<span>import</span> <span>Data.List</span> (<span>nub</span>)
<span>import</span> <span>Data.Char</span>
<span>import</span> <span>PyF</span>

load <span>SearchPath</span> [<span><span>&#34;</span>echo<span>&#34;</span></span>, <span><span>&#34;</span>base64<span>&#34;</span></span>, <span><span>&#34;</span>cat<span>&#34;</span></span>, <span><span>&#34;</span>head<span>&#34;</span></span>, <span><span>&#34;</span>sleep<span>&#34;</span></span>, <span><span>&#34;</span>mktemp<span>&#34;</span></span>, <span><span>&#34;</span>ls<span>&#34;</span></span>, <span><span>&#34;</span>wc<span>&#34;</span></span>, <span><span>&#34;</span>find<span>&#34;</span></span>, <span><span>&#34;</span>tr<span>&#34;</span></span>, <span><span>&#34;</span>users<span>&#34;</span></span>, <span><span>&#34;</span>sha256sum<span>&#34;</span></span>, <span><span>&#34;</span>false<span>&#34;</span></span>, <span><span>&#34;</span>true<span>&#34;</span></span>]

<span>curl</span> <span>::</span> <span>Cmd</span>
curl <span>=</span> true

<span>test</span> <span>::</span> <span><span>IO</span></span> <span>()</span>
test <span>=</span> <span>do</span></pre></div>
</details>
<p dir="auto">It&#39;s primary purpose is in replacing shell scripts. As such, many
functions are provided to mimic the shell environment, and porting shell
scripts to shh should be fairly straightforward. A simple
<a href="https://github.com/luke-clifton/shh/blob/master/docs/porting.md">&#34;cargo culting&#34; port</a> should work in most situations,
and perhaps be even more robust than the original.</p>
<p dir="auto">It is also a wrapper tool around launching GHCi as a shell.</p>
<p dir="auto">It supports</p>
<ul dir="auto">
<li>
<p dir="auto">Automatically defining a function for each executable on your <code>$PATH</code>
using template Haskell, as well as a runtime check to ensure they all
exist on startup.</p>
</li>
<li>
<p dir="auto">Redirection of stdout and stderr</p>
<div dir="auto" data-snippet-clipboard-copy-content="  -- Redirect stdout
  echo &#34;Hello&#34; &amp;&gt; StdErr
  echo &#34;Hello&#34; &amp;&gt; Truncate &#34;.tmp_file&#34;

  -- Redirect stderr
  echo &#34;Hello&#34; &amp;!&gt; Append &#34;/dev/null&#34;
  echo &#34;Hello&#34; &amp;!&gt; StdOut"><pre>  <span><span>--</span> Redirect stdout</span>
  echo <span><span>&#34;</span>Hello<span>&#34;</span></span> <span>&amp;&gt;</span> <span>StdErr</span>
  echo <span><span>&#34;</span>Hello<span>&#34;</span></span> <span>&amp;&gt;</span> <span>Truncate</span> <span><span>&#34;</span>.tmp_file<span>&#34;</span></span>

  <span><span>--</span> Redirect stderr</span>
  echo <span><span>&#34;</span>Hello<span>&#34;</span></span> <span>&amp;!&gt;</span> <span>Append</span> <span><span>&#34;</span>/dev/null<span>&#34;</span></span>
  echo <span><span>&#34;</span>Hello<span>&#34;</span></span> <span>&amp;!&gt;</span> <span>StdOut</span></pre></div>
</li>
<li>
<p dir="auto">Piping stdout or stderr to the input of a chained process</p>
<div dir="auto" data-snippet-clipboard-copy-content="  cat &#34;/dev/urandom&#34; |&gt; base64 |&gt; head &#34;-n&#34; 5"><pre>  cat <span><span>&#34;</span>/dev/urandom<span>&#34;</span></span> <span>|&gt;</span> base64 <span>|&gt;</span> <span>head</span> <span><span>&#34;</span>-n<span>&#34;</span></span> <span>5</span></pre></div>
</li>
<li>
<p dir="auto">Multiple processes sequentially feeding a single process</p>
<div dir="auto" data-snippet-clipboard-copy-content="  (echo 1 &gt;&gt; echo 2) |&gt; cat"><pre>  (echo <span>1</span> <span>&gt;&gt;</span> echo <span>2</span>) <span>|&gt;</span> cat</pre></div>
</li>
<li>
<p dir="auto">Use of Haskell&#39;s concurrency primitives.</p>
<div dir="auto" data-snippet-clipboard-copy-content="  race (sleep 1 &gt;&gt; echo &#34;Slept for 1&#34;) (sleep 2 &gt;&gt; echo &#34;Slept for 2&#34;)
"><pre>  race (sleep <span>1</span> <span>&gt;&gt;</span> echo <span><span>&#34;</span>Slept for 1<span>&#34;</span></span>) (sleep <span>2</span> <span>&gt;&gt;</span> echo <span><span>&#34;</span>Slept for 2<span>&#34;</span></span>)
</pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="  mapConcurrently_ (\url -&gt; curl &#34;-Ls&#34; url |&gt; wc)
    [ &#34;https://raw.githubusercontent.com/luke-clifton/shh/master/shell.nix&#34;
    , &#34;https://raw.githubusercontent.com/luke-clifton/shh/master/README.md&#34;
    ]"><pre>  mapConcurrently_ (<span>\</span>url <span>-&gt;</span> curl <span><span>&#34;</span>-Ls<span>&#34;</span></span> url <span>|&gt;</span> wc)
    [ <span><span>&#34;</span>https://raw.githubusercontent.com/luke-clifton/shh/master/shell.nix<span>&#34;</span></span>
    , <span><span>&#34;</span>https://raw.githubusercontent.com/luke-clifton/shh/master/README.md<span>&#34;</span></span>
    ]</pre></div>
</li>
<li>
<p dir="auto">Capturing of process output</p>
<div dir="auto" data-snippet-clipboard-copy-content="  s &lt;- echo &#34;Hello&#34; |&gt; tr &#34;-d&#34; &#34;l&#34; |&gt; capture
  print s

  loggedIn &lt;- nub . Char8.words &lt;$&gt; (users |&gt; capture)
  putStrLn $ &#34;Logged in users: &#34; ++ show loggedIn

  mapM_ Char8.putStrLn =&lt;&lt; (find &#34;-maxdepth&#34; 1 &#34;-print0&#34; |&gt; captureEndBy0)"><pre>  s <span>&lt;-</span> echo <span><span>&#34;</span>Hello<span>&#34;</span></span> <span>|&gt;</span> tr <span><span>&#34;</span>-d<span>&#34;</span></span> <span><span>&#34;</span>l<span>&#34;</span></span> <span>|&gt;</span> capture
  <span>print</span> s

  loggedIn <span>&lt;-</span> nub <span>.</span> <span>Char8.</span><span>words</span> <span>&lt;$&gt;</span> (users <span>|&gt;</span> capture)
  <span>putStrLn</span> <span>$</span> <span><span>&#34;</span>Logged in users: <span>&#34;</span></span> <span>++</span> <span>show</span> loggedIn

  <span>mapM_</span> <span>Char8.</span><span>putStrLn</span> <span>=&lt;&lt;</span> (find <span><span>&#34;</span>-maxdepth<span>&#34;</span></span> <span>1</span> <span><span>&#34;</span>-print0<span>&#34;</span></span> <span>|&gt;</span> captureEndBy0)</pre></div>
</li>
<li>
<p dir="auto">Capturing infinite output of a process lazily</p>
<div dir="auto" data-snippet-clipboard-copy-content="  cat &#34;/dev/urandom&#34;
    |&gt; base64
    |&gt; readInput (mapM_ Char8.putStrLn . take 3 . Char8.lines)"><pre>  cat <span><span>&#34;</span>/dev/urandom<span>&#34;</span></span>
    <span>|&gt;</span> base64
    <span>|&gt;</span> readInput (<span>mapM_</span> <span>Char8.</span><span>putStrLn</span> <span>.</span> <span>take</span> <span>3</span> <span>.</span> <span>Char8.</span><span>lines</span>)</pre></div>
</li>
<li>
<p dir="auto">Write strings to stdin of a process.</p>
<div dir="auto" data-snippet-clipboard-copy-content="  writeOutput &#34;Hello\n&#34; |&gt; cat
  -- Hello

  &#34;Hello&#34; &gt;&gt;&gt; sha256sum

  sha256sum &lt;&lt;&lt; &#34;Hello&#34;"><pre>  writeOutput <span><span>&#34;</span>Hello<span>\n</span><span>&#34;</span></span> <span>|&gt;</span> cat
  <span><span>--</span> Hello</span>

  <span><span>&#34;</span>Hello<span>&#34;</span></span> <span>&gt;&gt;&gt;</span> sha256<span>sum</span>

  sha256<span>sum</span> <span>&lt;&lt;&lt;</span> <span><span>&#34;</span>Hello<span>&#34;</span></span></pre></div>
</li>
<li>
<p dir="auto">Proper exceptions, when a process exits with a failure code, an exception
is thrown. You can catch these normally. The exception includes the error
code, the command, and all it&#39;s arguments.</p>
<div dir="auto" data-snippet-clipboard-copy-content="  false &#34;Ha, it died&#34;
  --  *** Exception: Command `false &#34;Ha, it died&#34;` failed [exit 1]"><pre>  false <span><span>&#34;</span>Ha, it died<span>&#34;</span></span>
  <span><span>--</span>  *** Exception: Command `false &#34;Ha, it died&#34;` failed [exit 1]</span></pre></div>

</li>
<li>
<p dir="auto">&#34;Native&#34; processes, i.e. Haskell functions that behave like a process.</p>
<div dir="auto" data-snippet-clipboard-copy-content="  echo &#34;Hello&#34; |&gt; pureProc (Char8.map toUpper) |&gt; tr &#34;-d&#34; &#34;L&#34;
  -- HEO"><pre>  echo <span><span>&#34;</span>Hello<span>&#34;</span></span> <span>|&gt;</span> pureProc (<span>Char8.</span><span>map</span> toUpper) <span>|&gt;</span> tr <span><span>&#34;</span>-d<span>&#34;</span></span> <span><span>&#34;</span>L<span>&#34;</span></span>
  <span><span>--</span> HEO</span></pre></div>
</li>
<li>
<p dir="auto">And much, much more! Look at the documentation on Hackage for a
comprehensive overview of all the possibilities.</p>
</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-mnemonics" aria-hidden="true" tabindex="-1" href="#mnemonics"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Mnemonics</h2>
<p dir="auto">Shh has many symbols that might seem intimidating at first, but there
is a simple mnemonic for them.</p>
<div data-snippet-clipboard-copy-content="|     Piping. Looks like a pipe, same as in POSIX shells.
&amp;     Redirection, think of the shell `2&gt;&amp;1`
&gt;,&lt;   The direction of flow of a command
!     Operate on stderr instead of stdout"><pre><code>|     Piping. Looks like a pipe, same as in POSIX shells.
&amp;     Redirection, think of the shell `2&gt;&amp;1`
&gt;,&lt;   The direction of flow of a command
!     Operate on stderr instead of stdout
</code></pre></div>
<p dir="auto">So, for example,</p>
<div data-snippet-clipboard-copy-content="ls |&gt; cat      Pipe the stdout of `ls` into stdin of `cat`
cat &lt;| ls      Same as above
ls &amp;&gt; StdErr   Redirect stdout of `ls` to wherever stderr is going.
StdErr &lt;&amp; ls   Same as above
ls &amp;!&gt; StdOut  Redirect stderr of `ls` to wherever stdout is going.
StdOut &lt;!&amp; ls  Same as above"><pre><code>ls |&gt; cat      Pipe the stdout of `ls` into stdin of `cat`
cat &lt;| ls      Same as above
ls &amp;&gt; StdErr   Redirect stdout of `ls` to wherever stderr is going.
StdErr &lt;&amp; ls   Same as above
ls &amp;!&gt; StdOut  Redirect stderr of `ls` to wherever stdout is going.
StdOut &lt;!&amp; ls  Same as above
</code></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-globbing" aria-hidden="true" tabindex="-1" href="#globbing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Globbing</h2>
<p dir="auto">Currently Shh does not have any built in globbing support. Rather, it is
currently suggested to use another library to do globbing. For example,
using the <a href="http://hackage.haskell.org/package/Glob" rel="nofollow">Glob</a> package, it is
possible to do something like</p>

<p dir="auto">Certainly more verbose than the Bash equivalent, however, also more explicit,
which is probably a good thing. If this turns out to be too cumbersome, we
might introduce a more succinct globbing feature, though it will always be
explicit, and thus always more verbose than most other shells.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-string-interpolationexpansionsubstitution" aria-hidden="true" tabindex="-1" href="#string-interpolationexpansionsubstitution"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>String Interpolation/Expansion/Substitution</h2>
<p dir="auto">String interpolation, much like globbing, is left to an external library.
I lightweight, zero-dependency solution is to use <a href="https://hackage.haskell.org/package/PyF" rel="nofollow">PyF</a>,
which, since 0.10.0.1, has no dependencies other than ones included with GHC.</p>
<div dir="auto" data-snippet-clipboard-copy-content="greet =  do
    user &lt;- getEnv &#34;USER&#34;
    echo [fmt|Hello, {user}!|]"><pre>greet <span>=</span>  <span>do</span>
    user <span>&lt;-</span> getEnv <span><span>&#34;</span>USER<span>&#34;</span></span>
    echo [<span>fmt</span>|Hello, {user}!|]</pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-usage" aria-hidden="true" tabindex="-1" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage</h2>
<p dir="auto">Some of the features in Shh require that you use the threaded runtime.
Please compile with the <code>-threaded</code> flag to avoid deadlocks.</p>
<p dir="auto">Enable Template Haskell and load the environment. It is also strongly
recommended to use <code>ExtendedDefaultRules</code>. This is especially important
if you want to use <code>OverloadedStrings</code>.</p>
<div data-snippet-clipboard-copy-content="{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE ExtendedDefaultRules #-}
$(loadEnv SearchPath)"><pre><code>{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE ExtendedDefaultRules #-}
$(loadEnv SearchPath)
</code></pre></div>
<p dir="auto">You now have all your executables available as simple Haskell
functions. If you don&#39;t want to load your entire environment you
can load specific commands directly:</p>
<div data-snippet-clipboard-copy-content="load SearchPath [&#34;echo&#34;, &#34;grep&#34;, &#34;cat&#34;, &#34;ls&#34;]"><pre><code>load SearchPath [&#34;echo&#34;, &#34;grep&#34;, &#34;cat&#34;, &#34;ls&#34;]
</code></pre></div>
<p dir="auto">If you want to check that all the dependencies still exist, you can use
<code>missingExecutables :: IO [String]</code>, which will tell you if anything is
missing.</p>
<p dir="auto">For use in a project, it makes sense to have a dedicated module for your
project which does the template Haskell above. This will prevent recompilation
of all the executables, and also allow you to easily namespace them to
avoid collisions with normal Haskell functions.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-usage-in-ghci" aria-hidden="true" tabindex="-1" href="#usage-in-ghci"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage in GHCi</h3>
<p dir="auto">If you want <code>^D</code> to be recognised as a EOF marker (when running commands
that read from stdin) when running in GHCi, you will need to run the
<code>initInteractive</code> function. This sets the line buffering appropriately and
ensures the terminal is in canonical mode.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-shh-as-a-shell" aria-hidden="true" tabindex="-1" href="#shh-as-a-shell"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Shh as a Shell</h3>
<p dir="auto">There is a tool called <code>shh</code> which is a fairly small wrapper around launching
GHCi which automatically loads your environment and allows you to have custom
config when using GHCi as a shell.</p>
<p dir="auto">To install it, one option is to use <code>cabal new-install</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="cabal new-install --lib shh
cabal new-install --lib shh-extras"><pre>cabal new-install --lib shh
cabal new-install --lib shh-extras</pre></div>
<p dir="auto">The <code>shh</code> binary will look in your <code>$SHH_DIR</code> (defaults to <code>$HOME/.shh</code>) for
a <code>Shell.hs</code>, <code>init.ghci</code> and <code>wrapper</code> files. If these don&#39;t exist default
ones will be created.</p>
<p dir="auto">The <code>Shell.hs</code> file should contain any top level definitions that you would
like to be available in your Shell. By default it loads your environment.</p>
<p dir="auto">The <code>init.ghci</code> file is loaded by GHCi after your <code>.ghci</code> files. This lets
you specify settings that you want to take effect when using GHCi as a shell.
By default it sets a shell-like prompt.</p>
<p dir="auto">The <code>wrapper</code> file is an executable that is called with the command that is
to be executed. By default it just calls <code>exec</code> with the arguments passed to
it. The use-case for this is to be able to set up the environment for <code>shh</code>.
You might, for example, wrap the execution in a <code>nix-shell</code>. Either way,
it is up to you to make sure that the compiler, and packages you require are
available, either globally, or provided by the <code>wrapper</code> script.</p>
<h4 tabindex="-1" dir="auto"><a id="user-content-faster-startup" aria-hidden="true" tabindex="-1" href="#faster-startup"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Faster Startup</h4>
<p dir="auto"><code>shh</code> precompiles your <code>Shell.hs</code> file so that starting up <code>shh</code> is very
quick on subsequent launches. Unfortunately, <code>shh</code> isn&#39;t quite able to detect
this perfectly. If you see GHCi telling you that it is <code>Compiling Shell</code>,
and you notice the delay when starting <code>shh</code>, try manually forcing a rebuild
by passing in the <code>--rebuild</code> argument to <code>shh</code>.</p>
<p dir="auto">This is particularly likely to happen if you upgrade your GHC, or installed
packages, or even <code>shh</code> itself.</p>
<h4 tabindex="-1" dir="auto"><a id="user-content-nix-wrapper-example" aria-hidden="true" tabindex="-1" href="#nix-wrapper-example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Nix Wrapper Example</h4>
<p dir="auto">The following snippet could act as a <code>wrapper</code> file to set up a suitable
environment using <code>nix-shell</code></p>
<div data-snippet-clipboard-copy-content="#! /usr/bin/env nix-shell
#! nix-shell -i bash -p &#34;(haskellPackages.ghcWithPackages (p: with p; [shh shh-extras]))&#34;
exec &#34;$@&#34;"><pre><code>#! /usr/bin/env nix-shell
#! nix-shell -i bash -p &#34;(haskellPackages.ghcWithPackages (p: with p; [shh shh-extras]))&#34;
exec &#34;$@&#34;
</code></pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-script-usage" aria-hidden="true" tabindex="-1" href="#script-usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Script Usage</h3>
<h4 tabindex="-1" dir="auto"><a id="user-content-nix" aria-hidden="true" tabindex="-1" href="#nix"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Nix</h4>
<p dir="auto">Nixpkgs provides a <code>writeHaskellBin</code> function which is very convenient for
writing quick scripts for your Nix setup.</p>
<div dir="auto" data-snippet-clipboard-copy-content="writers.writeHaskellBin &#34;example&#34; {libraries = [haskellPackages.shh];} &#39;&#39;
  {-# LANGUAGE TemplateHaskell #-}
  import Shh

  -- Load binaries from Nix packages. The dependencies will be captured
  -- in the closure.
  loadFromBins [&#34;${git}&#34;, &#34;${coreutils}&#34;, &#34;${curl}&#34;]

  main :: IO ()
  main = do
    cat &#34;/a/file&#34;
    cp &#34;/a/file&#34; &#34;/b/file&#34;
&#39;&#39;"><pre><span>writers</span><span>.</span><span><span>writeHaskellBin</span></span> <span>&#34;example&#34;</span> <span>{</span><span><span>libraries</span></span> <span>=</span> <span>[</span><span>haskellPackages</span><span>.</span><span><span>shh</span></span><span>]</span><span>;</span><span>}</span> <span>&#39;&#39;</span>
<span>  {-# LANGUAGE TemplateHaskell #-}</span>
<span>  import Shh</span>
<span></span>
<span>  -- Load binaries from Nix packages. The dependencies will be captured</span>
<span>  -- in the closure.</span>
<span>  loadFromBins [&#34;<span><span>${</span><span>git</span><span>}</span></span>&#34;, &#34;<span><span>${</span><span>coreutils</span><span>}</span></span>&#34;, &#34;<span><span>${</span><span>curl</span><span>}</span></span>&#34;]</span>
<span></span>
<span>  main :: IO ()</span>
<span>  main = do</span>
<span>    cat &#34;/a/file&#34;</span>
<span>    cp &#34;/a/file&#34; &#34;/b/file&#34;</span>
<span>&#39;&#39;</span></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-alternatives" aria-hidden="true" tabindex="-1" href="#alternatives"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Alternatives</h2>
<p dir="auto">There are quite a few players in the &#34;shell programming for Haskell&#34; field.</p>
<p dir="auto">This table attempts to summarise some of the differences.</p>
<ul dir="auto">
<li><code>Pipe Style</code> refers to how processes are joined together, &#34;native&#34; means
that the mechanisms provided by the OS are used, while &#34;via Haskell&#34; means
that the data is read into the Haskell process, and then written into the
subprocess.</li>
<li><code>Via Shell</code> refers to whether subprocesses are launched directly or via
a shell (which can provide a &#34;native&#34; piping solution at the cost of
composability)</li>
<li><code>Run in IO</code> refers to whether commands need to be prefixed with <code>run</code> or
similar functions to actually execute them.</li>
<li><code>TH Helper</code> refers to whether the use of TH to generate Haskell functions
based on commands found at compile time is encouraged in the main library.</li>
<li><code>Monadic Subshell</code> refers to the ability to join multiple processes together
and feed them all from the same input and to the same output.
<code>echo a | (cat; echo b) | wc -l</code> should report that 2 lines appeared.</li>
</ul>
<table>
<thead>
<tr>
<th>Library</th>
<th>Pipe Style</th>
<th>Via Shell</th>
<th>Run in IO</th>
<th>Threadsafe <code>cd</code></th>
<th>TH Helper</th>
<th>Monadic Subshell</th>
<th>Redirect <code>stderr</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Shh</td>
<td>Native</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Shelly</td>
<td>Via Haskell</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Turtle</td>
<td>Via Haskell</td>
<td>Optional</td>
<td>No</td>
<td>?</td>
<td>No</td>
<td>No (Alternative)</td>
<td>Yes</td>
</tr>
<tr>
<td>shell-conduit</td>
<td>Via Haskell</td>
<td>Optional</td>
<td>No</td>
<td>?</td>
<td>Yes</td>
<td>Yes</td>
<td>No?</td>
</tr>
</tbody>
</table>
<h3 tabindex="-1" dir="auto"><a id="user-content-errors" aria-hidden="true" tabindex="-1" href="#errors"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Errors</h3>
<table>
<thead>
<tr>
<th>Library</th>
<th>Exception on non-zero</th>
<th>Contains arguments</th>
<th>Contains <code>stderr</code></th>
<th>Terminates pipeline</th>
</tr>
</thead>
<tbody>
<tr>
<td>Shh</td>
<td>Yes</td>
<td>Yes</td>
<td>Optional</td>
<td>Yes</td>
</tr>
<tr>
<td>Shelly</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Turtle</td>
<td>Sometimes</td>
<td>No</td>
<td>No</td>
<td>?</td>
</tr>
<tr>
<td>shell-conduit</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
</tbody>
</table>
</article>
          </div></div>
  </body>
</html>
