<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.scaleyourapp.com/live-video-streaming-infrastructure-at-twitch/">Original</a>
    <h1>An insight into live video streaming infrastructure at Twitch</h1>
    
    <div id="readability-page-1" class="page"><div><p>Twitch engineering developed a scalable, HA live streaming solution to enable broadcasters on their platform live stream their gameplay with minimum latency. </p><p>The live streaming solution (developed by Twitch) is also made available as a Service to the world through <span><a href="https://aws.amazon.com/ivs/" target="_blank" rel="noreferrer noopener">AWS IVS</a></span> (Interactive Video Streaming) that would enable other <span><a href="https://ivs.rocks/examples" target="_blank" rel="noreferrer noopener">businesses leveraging AWS</a></span> to integrate interactive streaming services with their apps or websites.  </p><p>AWS IVS is a fully managed live streaming solution that takes care of ingestion, transcoding, packaging, and delivering live content to the end viewers.</p><figure><img width="1024" height="353" src="https://www.scaleyourapp.com/wp-content/uploads/2022/06/Amazon-IVS-1024x353.png" alt="AWS IVS" srcset="https://www.scaleyourapp.com/wp-content/uploads/2022/06/Amazon-IVS-1024x353.png 1024w, https://www.scaleyourapp.com/wp-content/uploads/2022/06/Amazon-IVS-300x104.png 300w, https://www.scaleyourapp.com/wp-content/uploads/2022/06/Amazon-IVS-768x265.png 768w, https://www.scaleyourapp.com/wp-content/uploads/2022/06/Amazon-IVS-1536x530.png 1536w, https://www.scaleyourapp.com/wp-content/uploads/2022/06/Amazon-IVS-2048x707.png 2048w, https://www.scaleyourapp.com/wp-content/uploads/2022/06/Amazon-IVS-585x202.png 585w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure><p><span>Key points from the Twitch infrastructure</span>:</p><p>They have hundreds of thousands of concurrent live broadcasters on their platform. The streams have five different quality levels to adapt to the viewers’ network conditions. </p><p>The stream also has a buffer of a few seconds to download the video on the viewer’s device ahead of time to make the stream run smoothly. </p><p>Over the years, Twitch has managed to reduce the streaming latency from 15 to 3 seconds. Under best network conditions, for instance, in Korea, the latency is reduced to 1.5 seconds. </p><p>Why is latency important in live steams? Can’t the video be buffered and played like a regular video?</p><p>The lesser the time it takes from when a streamer waves at the camera to when their viewers see that wave on the screen, the better is the user experience on the platform. Reduced latency enables a more real-time interaction between the streamers and the viewers.</p><p>When the streamer starts their stream, their video is transcoded by Twitch servers. Transcoding (system written in C/C++ and Go) converts the stream into multiple formats to be played on the viewer’s device under different network conditions. The transcoded formats are then distributed across the data centers and PoPs (Point of Presence) running on multiple geographic locations worldwide, ensuring proximity to the viewer’s location.</p><p>Transcoding is computationally expensive. Initially, Twitch transcoded only two to three percent of the channels. But with the hardware-based transcoder built in-house, they have brought down the costs significantly, allowing them to scale and transcode every video upload to their servers.</p><figure><img loading="lazy" width="1024" height="503" src="https://www.scaleyourapp.com/wp-content/uploads/2022/06/Twitch-live-video-streaming-min-1024x503.png" alt="Twitch live video streaming" srcset="https://www.scaleyourapp.com/wp-content/uploads/2022/06/Twitch-live-video-streaming-min-1024x503.png 1024w, https://www.scaleyourapp.com/wp-content/uploads/2022/06/Twitch-live-video-streaming-min-300x147.png 300w, https://www.scaleyourapp.com/wp-content/uploads/2022/06/Twitch-live-video-streaming-min-768x377.png 768w, https://www.scaleyourapp.com/wp-content/uploads/2022/06/Twitch-live-video-streaming-min-1536x755.png 1536w, https://www.scaleyourapp.com/wp-content/uploads/2022/06/Twitch-live-video-streaming-min-585x287.png 585w, https://www.scaleyourapp.com/wp-content/uploads/2022/06/Twitch-live-video-streaming-min.png 1868w" sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>Img Src: <a href="https://blog.twitch.tv/en/2022/04/26/ingesting-live-video-streams-at-global-scale/" target="_blank" rel="noreferrer noopener"><span>Twitch engineering</span></a></figcaption></figure><p>Speaking of the physical infrastructure, to ensure smooth streaming, they’ve partnered up with the local ISPs and have several PoPs (Point of Presence) powered by the backbone network that connects them with the data centers. </p><p>If you wish to understand PoPs, and other cloud fundamentals in-depth, including how cloud infrastructure deploys and scales our apps globally and more, check out my platform-agnostic <span><a href="https://courses.scaleyourapp.com/p/cloud-computing-101-master-the-fundamentals" target="_blank" rel="noreferrer noopener">Cloud Computing 101</a></span> course.</p><p>Viewers from around the world download the videos from PoPs. The intelligent network ensures the streamer’s channels are replicated across Twitch’s network in proximity to their viewers. Replicating all the channels across their network would be overkill. </p><p>Replication of data is done based on a metric called <em>reach</em>, which determines the percentage of people with a certain quality of internet access and the quality of streaming they would get from the platform. The approach is not too precise but gives a high-level idea that helps Twitch design its infrastructure to optimize the quality of service and the deployment costs. </p><p>The live video streams received at the PoPs are moved to the origin data centers for processing and distribution across the Twitch network. Origin data centers take care of computation heavy processes such as video transcoding. </p><p>Originally, Twitch started with a single origin data center where it processed the live video streams. The PoPs ran <span><a href="https://www.haproxy.org/" target="_blank" rel="noreferrer noopener">HAProxy</a></span> and routed the streams to the origin data center. As the platform gained traction and the number of data centers increased it brought along a few challenges with the HAProxy approach.</p><p>The PoPs, due to HAProxy configuration, statically sent live video streams to only one of the origin data centers. This led to the inefficient utilization of the infrastructure resources. </p><p>It got difficult to handle the <span><a href="https://www.scaleyourapp.com/how-razorpay-handled-significant-transaction-bursts-during-events-like-ipl/" target="_blank" rel="noreferrer noopener">unexpected traffic surge during key online events</a></span>. </p><p>PoPs couldn’t detect overloaded or faulty origin data centers and still sent traffic their way as opposed to routing it to other data centers. </p><p>In order to deal with these challenges, they retired HAProxy and developed Intelligest—an ingest routing system to intelligently distribute <span><a href="https://www.scaleyourapp.com/how-hotstar-scaled-with-10-3-million-concurrent-users-an-architectural-insight/" target="_blank" rel="noreferrer noopener">live video traffic</a></span> from the PoPs to the origins.</p><p>The Intelligest architecture consists of two components: Intelligest media proxy running in each PoP and Intelligest Routing Service (IRS) running in AWS.</p><p>The media proxy, with the help of IRS, determines the right origin data center to send the traffic to, overcoming the challenges faced with HAProxy. </p><p>IRS has further two sub-services, the <em>Capacitor </em>and the <em>Well</em>. The Capacitor monitors the compute resources available in every origin data center and the Well monitors the backbone network bandwidth availability. With the help of these, IRS can determine in real-time the infrastructure capacity. This has enabled Twitch achieve high availability in their infrastructure. </p><p>If you’ve found the content interesting, consider subscribing to my newsletter to get the latest content delivered right to your inbox.</p><p>Information source: <span><a href="https://blog.twitch.tv/en/2021/10/25/low-latency-high-reach-creating-an-unparalleled-live-video-streaming-network-at-twitch/" target="_blank" rel="noreferrer noopener">Twitch engineering</a></span></p> <p><strong>Distributed Systems</strong></p><p><strong>Handpicked Resources to Learn Software Architecture and Large Scale Distributed Systems Design</strong></p><p>If you liked the article, share it on the web. You can follow scaleyourapp.com on social media, links below, to stay notified of the new content published. I am Shivang, you can read <a href="https://www.scaleyourapp.com/about-us/" target="_blank" rel="noreferrer noopener"><span>about me here!</span></a></p><ul><li><a href="https://www.facebook.com/scaleyourapp/" rel="noopener nofollow" target="_blank"><svg width="24" height="24" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M12 2C6.5 2 2 6.5 2 12c0 5 3.7 9.1 8.4 9.9v-7H7.9V12h2.5V9.8c0-2.5 1.5-3.9 3.8-3.9 1.1 0 2.2.2 2.2.2v2.5h-1.3c-1.2 0-1.6.8-1.6 1.6V12h2.8l-.4 2.9h-2.3v7C18.3 21.1 22 17 22 12c0-5.5-4.5-10-10-10z"></path></svg><span>Facebook</span></a></li><li><a href="https://www.linkedin.com/company/scaleyourapp/" rel="noopener nofollow" target="_blank"><svg width="24" height="24" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M19.7,3H4.3C3.582,3,3,3.582,3,4.3v15.4C3,20.418,3.582,21,4.3,21h15.4c0.718,0,1.3-0.582,1.3-1.3V4.3 C21,3.582,20.418,3,19.7,3z M8.339,18.338H5.667v-8.59h2.672V18.338z M7.004,8.574c-0.857,0-1.549-0.694-1.549-1.548 c0-0.855,0.691-1.548,1.549-1.548c0.854,0,1.547,0.694,1.547,1.548C8.551,7.881,7.858,8.574,7.004,8.574z M18.339,18.338h-2.669 v-4.177c0-0.996-0.017-2.278-1.387-2.278c-1.389,0-1.601,1.086-1.601,2.206v4.249h-2.667v-8.59h2.559v1.174h0.037 c0.356-0.675,1.227-1.387,2.526-1.387c2.703,0,3.203,1.779,3.203,4.092V18.338z"></path></svg><span>LinkedIn</span></a></li><li><a href="https://twitter.com/scaleyourapp" rel="noopener nofollow" target="_blank"><svg width="24" height="24" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M22.23,5.924c-0.736,0.326-1.527,0.547-2.357,0.646c0.847-0.508,1.498-1.312,1.804-2.27 c-0.793,0.47-1.671,0.812-2.606,0.996C18.324,4.498,17.257,4,16.077,4c-2.266,0-4.103,1.837-4.103,4.103 c0,0.322,0.036,0.635,0.106,0.935C8.67,8.867,5.647,7.234,3.623,4.751C3.27,5.357,3.067,6.062,3.067,6.814 c0,1.424,0.724,2.679,1.825,3.415c-0.673-0.021-1.305-0.206-1.859-0.513c0,0.017,0,0.034,0,0.052c0,1.988,1.414,3.647,3.292,4.023 c-0.344,0.094-0.707,0.144-1.081,0.144c-0.264,0-0.521-0.026-0.772-0.074c0.522,1.63,2.038,2.816,3.833,2.85 c-1.404,1.1-3.174,1.756-5.096,1.756c-0.331,0-0.658-0.019-0.979-0.057c1.816,1.164,3.973,1.843,6.29,1.843 c7.547,0,11.675-6.252,11.675-11.675c0-0.178-0.004-0.355-0.012-0.531C20.985,7.47,21.68,6.747,22.23,5.924z"></path></svg><span>Twitter</span></a></li></ul></div></div>
  </body>
</html>
