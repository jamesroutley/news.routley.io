<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lemire.me/blog/2022/07/08/go-generics-are-not-bad/">Original</a>
    <h1>Go generics are not bad</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>When programming, we often need to write ‘generic’ functions where the exact data type is not important. For example, you might want to write a simple function that sums up numbers.</p>
<p>Go lacked this notion until recently, but it was recently added (as of version 1.18). So I took it out for a spin.</p>
<p>In Java, generics work well enough as long as you need “generic” containers (arrays, maps), and as long as stick with functional idioms. But Java will not let me code the way I would prefer. Here is how I would write a function that sums up numbers:</p>
<pre>    <span>int</span> sum<span>(</span><span>int</span><span>[</span><span>]</span> v<span>)</span> <span>{</span>
        <span>int</span> summer <span>=</span> <span>0</span><span>;</span>
        <span>for</span><span>(</span><span>int</span> k <span>=</span> <span>0</span><span>;</span> k <span>&lt;</span> v<span>.</span>length<span>;</span> k<span>+</span><span>+</span><span>)</span> <span>{</span>
            summer <span>+</span><span>=</span> v<span>[</span>k<span>]</span><span>;</span>
        <span>}</span>
        <span>return</span> summer<span>;</span>
    <span>}</span>
</pre>
<p>What if I need to support various number types? Then I would like to write the following generic function, but Java won’t let me.</p>
<pre>    <span>// this Java code won&#39;t compile</span>
    <span>static</span> <span>&lt;</span>T extends Number<span>&gt;</span>  T sum<span>(</span>T<span>[</span><span>]</span> v<span>)</span> <span>{</span>
        T summer <span>=</span> <span>0</span><span>;</span>
        <span>for</span><span>(</span><span>int</span> k <span>=</span> <span>0</span><span>;</span> k <span>&lt;</span> v<span>.</span>length<span>;</span> k<span>+</span><span>+</span><span>)</span> <span>{</span>
            summer <span>+</span><span>=</span> v<span>[</span>k<span>]</span><span>;</span>
        <span>}</span>
        <span>return</span> summer<span>;</span>
    <span>}</span>
</pre>
<p>Go is not object oriented per se, so you do not have a ‘Number’ class. However, you can create your own generic ‘interfaces’ which serves the same function. So here is how you solve the same problem in Go:</p>
<pre>type Number interface <span>{</span>
  uint <span>|</span> <span>int</span> <span>|</span> float32 <span>|</span> float64
<span>}</span>


func sum<span>[</span>T Number<span>]</span><span>(</span>a <span>[</span><span>]</span>T<span>)</span> T<span>{</span>
    var summer T
    <span>for</span> _<span>,</span> v <span>:</span><span>=</span> range<span>(</span>a<span>)</span> <span>{</span>
        summer <span>+</span><span>=</span> v
    <span>}</span>
   <span>return</span> summer
<span>}</span>

</pre>
<p>So, at least in this one instance, Go generics are more expressive than Java generics. What about performance?</p>
<p>If I apply the above code to an array of integers, I get the following tight loop in assembly:</p>
<pre><span>pc11:</span>
        MOVQ    <span>(</span>AX<span>)</span><span>(</span>DX<span>*</span><span>8</span><span>)</span><span>,</span> SI
        INCQ    DX
        ADDQ    SI<span>,</span> CX
        CMPQ    BX<span>,</span> DX
        JGT     pc11
</pre>

<p>As far as Go is concerned, this is as efficient as it gets.</p>
<p>So far, I am giving an A to Go generics.</p>
</div></div>
  </body>
</html>
