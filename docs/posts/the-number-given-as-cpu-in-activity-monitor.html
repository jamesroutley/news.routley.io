<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://eclecticlight.co/2024/11/08/why-cpu-in-activity-monitor-isnt-what-you-think/">Original</a>
    <h1>The number given as % CPU in Activity Monitor</h1>
    
    <div id="readability-page-1" class="page"><article id="post-83479">
	
	<!-- .entry-header -->

	
		<div data-first_letter="O">
		<p>One of the most frequently quoted measurements in Activity Monitor is <strong>% CPU</strong>. When the fans blow, or a Mac becomes sluggish, it’s often the first figure to look at and wonder why that process is pulling over 100%. That’s the first thing you learn: here, <em>per cent</em> doesn’t mean out of 100, but the sum of the real percentage for each core. As this Mac has eight cores, that allows it up to 800%, until you realise that Intel processors can use Hyper-Threading to pretend that each is two cores, making a maximum of 1,600%, not bad for a single processor. Then you come completely unstuck with Apple silicon.</p>
<p>Apple defines <em>% CPU</em> as “the percentage of CPU capability that’s being used”, a phrase that doesn’t appear to have any definition either in Apple’s documentation or elsewhere. So like everyone else, you assume that 100% for a core represents its maximum processing capacity. Only you couldn’t be more incorrect: in truth, the number given as % CPU is nothing like that.</p>
<h4>Tests</h4>
<p>To examine this more clearly, I have an app that runs tight loops of assembly code to load CPU cores on Apple silicon chips and measure their performance. For this, I got it to run several threads, each consisting of 500 million loops of floating point calculations. By running those at different Quality of Service (QoS) settings, macOS will send them to different core types.</p>
<p>When I run two threads at low QoS so they’re run only on E cores of a MacBook Pro M3 Pro, each takes 10.2 seconds to complete. If I instead run eight threads at high QoS, the first six of those will be run on the P cores, but the remaining two spill over onto two of the E cores, where they complete in just 3.0 seconds each.</p>
<p>Yet, according to % CPU in Activity Monitor, the two threads on the E cores come to 200%, and the two from eight run in the second test also come to 200%. You can see this in the CPU History window.</p>
<p><span><img data-attachment-id="83478" data-permalink="https://eclecticlight.co/m3activitymon/" data-orig-file="https://eclecticlight.co/wp-content/uploads/2024/11/m3activitymon.png" data-orig-size="1414,972" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="m3activitymon" data-image-description="" data-image-caption="" data-medium-file="https://eclecticlight.co/wp-content/uploads/2024/11/m3activitymon.png?w=300" data-large-file="https://eclecticlight.co/wp-content/uploads/2024/11/m3activitymon.png?w=940" src="https://eclecticlight.co/wp-content/uploads/2024/11/m3activitymon.png" alt="m3activitymon" width="1414" height="972" srcset="https://eclecticlight.co/wp-content/uploads/2024/11/m3activitymon.png 1414w, https://eclecticlight.co/wp-content/uploads/2024/11/m3activitymon.png?w=150&amp;h=103 150w, https://eclecticlight.co/wp-content/uploads/2024/11/m3activitymon.png?w=300&amp;h=206 300w, https://eclecticlight.co/wp-content/uploads/2024/11/m3activitymon.png?w=768&amp;h=528 768w, https://eclecticlight.co/wp-content/uploads/2024/11/m3activitymon.png?w=1024&amp;h=704 1024w" sizes="(max-width: 1414px) 100vw, 1414px"/></span></p>
<p>Here are the 6 E cores at the top, and 6 P cores below. ① marks the first test on two E cores, and shows the total of 200% spread across all six E cores over the 10.2 seconds it took to complete. ② marks the second test, with all 6 P cores and two E cores hitting 100% each, for a total of 800%, as shown in Activity Monitor’s window.</p>
<p>By now I’m sure you guessing how running the same code on the E cores could vary in speed by a factor of 3.4 (10.2 against 3.0 seconds) although they’re the same % CPU: that measurement doesn’t take into account core frequency.</p>
<h4>Frequency</h4>
<p>Unlike traditional Intel CPUs, CPU cores in Apple silicon chips can be run at a wide range of frequencies, as set by macOS. To make this frequency control a bit simpler, cores are grouped into clusters, that also share L2 cache, and within each cluster all cores run at the same frequency. The M3 Pro chip consists of two clusters, one of 6 E cores, the other of 6 P cores.</p>
<p>When macOS loads two of those E cores with low QoS threads, it sets them to run at a low frequency to make the most of their energy efficiency. When it loads two E cores with threads that were intended to be run on P cores, as they have a high QoS, it runs the E cluster up to high frequency, so they perform better.</p>
<p>Measuring frequency of CPU cores is straightforward using the <code>powermetrics</code> command tool. When those threads were being run on E cores at low QoS, frequency was held at their minimum of 744 MHz, but run at high QoS their frequency was set to maximum, at 2748 MHz, 3.7 times faster. If full load at maximum frequency is 100% of their capability, then at low QoS they were really running at 27%, not the 100% given by Activity Monitor, and that largely accounts for the difference in time that those threads took to complete their floating point calculations.</p>
<h4>What is % CPU?</h4>
<p>What Activity Monitor actually shows as % CPU or “percentage of CPU capability that’s being used” is what’s better known as <em>active residency</em> of each core, that’s the percentage of processor cycles that aren’t idle, but actively processing threads owned by a given process. But it doesn’t take into account the frequency or clock speed of the core at that time, nor the difference in core throughput between P and E cores.</p>
<p>The next time that you open Activity Monitor on an Apple silicon Mac, to look at % CPU figures, bear in mind that while those numbers aren’t completely meaningless, they don’t mean what you might think, and what’s shown as 100% could be anything between 27-100%.</p>
	</div><!-- .entry-content -->

	
	<!-- .entry-footer -->

</article></div>
  </body>
</html>
