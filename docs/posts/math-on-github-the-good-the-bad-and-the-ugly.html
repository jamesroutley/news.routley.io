<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nschloe.github.io/2022/05/20/math-on-github.html">Original</a>
    <h1>Math on GitHub: The Good, the Bad and the Ugly</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>Finally! On May 19, 2022, GitHub released one of its most requested features:
<a href="https://github.blog/2022-05-19-math-support-in-markdown/">Math support on
Markdown</a>! Many had
been anticipating this for years, including myself, so much in fact that I
wrote a browser extension to get there early.
(<a href="https://github.com/nschloe/xhub">xhub</a>, it can do a few other things so check
it out.)</p>

<p>The syntax GitHub has chosen is the <code>$</code>-based TeX syntax.</p>

<div><div><pre><code>Inline math: <span>$</span><span>a</span><span>+</span><span>b</span><span>$</span>

Display math:
<span>$$</span><span>
a </span><span>+</span><span> b
</span><span>$$</span>
</code></pre></div></div>

<p>It’s well-known and popular among scientists although the more modern LaTeX
syntax with <code>\(...\)</code> for inline and <code>\[...\]</code> for display math is actually
recommended in now.
(See <a href="https://tex.stackexchange.com/q/510/13262">here</a> for an explanation.)</p>

<h2 id="the-good">The Good</h2>

<p>The best thing is that <em>something</em> is finally there. This</p>

<div><div><pre><code><span>#### Cauchy&#39;s Theorem</span>

Let $U$ be an open subset of the complex plane $<span>\m</span>athbb{C}$, and suppose the closed
disk $D$ defined as

$$
D = <span>\{</span>z:|z-z_{0}|<span>\l</span>eq r<span>\}</span>
$$

is completely contained in $U$. Let $f: U<span>\t</span>o<span>\m</span>athbb{C}$ be a holomorphic function,
and let $<span>\g</span>amma$ be the circle, oriented counterclockwise, forming the boundary of
$D$. Then for every $a$ in the interior of $D$,

$$
f(a) = <span>\f</span>rac{1}{2<span>\p</span>i i} <span>\o</span>int_{<span>\g</span>amma}<span>\f</span>rac{f(z)}{z-a} dz.
$$
</code></pre></div></div>

<p>gives you</p>

<p><img src="https://nschloe.github.io/images/math-cauchy.png" alt="Cauchy&#39;s theorem"/></p>

<p>You’ll notice that not everything is working here:</p>

<ul>
  <li>The curly brackets are missing in the first indented code block. (bug
report <a href="https://github.com/github/feedback/discussions/16993">here</a>)</li>
  <li>
    <p>The math font is a really small, particularly the</p>

    <blockquote>
      <p>every <em>a</em> in</p>
    </blockquote>

    <p>towards the end.</p>
  </li>
  <li>
    <p>The spacing between the math characters is wrong. (bug report
<a href="https://github.com/github/feedback/discussions/16997">here</a>)</p>
  </li>
  <li>The syntax highlighting in the above code block is off.</li>
</ul>

<p>Apart from that: Great! This works in README.mds, issues, discussions,
including the <em>Preview</em> tab. Also cool: <code>\newcommand</code>s are global, so you can
define a command in one block, and use it everywhere in the page:</p>

<div><div><pre><code>$$
<span>\n</span>ewcommand<span>\m</span>yexp[1]{e^{#1}}
$$

$<span>\m</span>yexp{i}$
$$<span>\m</span>yexp{i}$$
</code></pre></div></div>

<h2 id="the-bad">The Bad</h2>

<h3 id="the-syntax">The syntax</h3>

<p>Getting only one of Markdown and LaTeX rendering right is a big challenge.
Mixing them together gets you in all kinds of trouble.</p>

<p>What I think GitHub does now is the following:</p>

<ol>
  <li>Render the entire page as Markdown, produce the HTML.</li>
  <li>Look for <code>$$...$$</code>, and determine somehow if they toggle math mode or if
they should render as dollar signs.</li>
  <li>Try the same for <code>$...$</code> pairs.</li>
</ol>

<p>This logic brings two fundamental problems.</p>

<h4 id="competing-markdown-and-math-renderer">Competing Markdown and math renderer</h4>

<p>As part of step 1, the Markdown is “sanitized”. This means <a href="https://github.github.com/gfm/#disallowed-raw-html-extension-">the removal of HTML
tags unless they are
allowed</a>, or the
removal of <code>\</code> unless they are right before a letter.</p>

<p>The contents of code blocks are unaffected of course, but <code>$</code> or <code>$$</code> blocks
aren’t code blocks as far as Markdown is concerned. This means that, e.g.,</p>

<ul>
  <li>
    <div><div><pre><code>$<span>\{</span>n<span>\i</span>n<span>\m</span>athbb{N}:<span>\:</span> n <span>\t</span>ext{even}<span>\}</span>$
</code></pre></div>    </div>

    <p>gets transformed to</p>

    <div><div><pre><code>${n<span>\i</span>n<span>\m</span>athbb{N}:: n <span>\t</span>ext{even}}$
</code></pre></div>    </div>

    <p>which as math renders like</p>
    <p>
  <img src="https://nschloe.github.io/images/math-n-even.png" width="30%"/>
</p>
  </li>
  <li>
    <div><div><pre><code><span>&amp;dollar;</span>\frac{f}{a}<span>&amp;dollar;</span>
</code></pre></div>    </div>
    <p>This gets rendered as math because Markdown transforms the <code>&amp;dollar;</code> into
<code>$</code>.</p>
  </li>
</ul>

<h4 id="what-is-math">What is math?</h4>

<p>The second step has to apply <em>some</em> heuristic to get right which <code>$</code> signs
toggle a math group, and which are just dollar signs. Many mistakes happen
there. This get really tricky if the math block seemingly contains HTML code,
e.g.,</p>

<ul>
  <li>
    <div><div><pre><code>$$
a+b
<span>&lt;ul&gt;&lt;li&gt;</span>c<span>&lt;/li&gt;&lt;/ul&gt;</span>
$$
</code></pre></div>    </div>

    <p>This gets rendered as HTML, not math.</p>
  </li>
  <li>
    

    <p>This doesn’t render at all.</p>
  </li>
  <li>
    

    <p>This gets rendered as math. This though</p>

    

    <p>takes <code>&lt;b &gt;</code> as an <a href="https://www.w3schools.com/tags/tag_b.asp">HTML bold
tag</a>, so no math here.</p>
  </li>
  <li>
    
    <p>This gets rendered as a link surrounded by $.</p>
  </li>
</ul>

<h4 id="solution">Solution</h4>

<p>So, how could this be avoided? We need to make sure that the Markdown parser
does not mess with the math. A smart way of achieving this is to use <em>code</em>
blocks for math – their contents are left untouched by Markdown.
In fact, this is how GitLab handles their <a href="https://docs.gitlab.com/ee/user/markdown.html#math">math
support</a>:</p>

<div><div><pre><code>Display math:

<span>```</span><span>math
</span><span>E = mc^2</span>
<span>```</span>

Inline math: $<span>`a^2 + b^2 = c^2`</span>$.
</code></pre></div></div>

<p>With this syntax, rendering becomes easy:</p>

<ol>
  <li>Render the page as Markdown produce the HTML.</li>
  <li>Check for all <code>&lt;code syntax=&#34;math&#34;&gt;</code> blocks, and render their contents as
display math.</li>
  <li>Check for all inline code blocks which are surrounded by <code>$...$</code> and render
their their contents as inline math.</li>
</ol>

<p>No ambiguity, no stress. Whole classes of bugs simply doesn’t exist.</p>

<h3 id="it-doesnt-work-everywhere">It doesn’t work everywhere</h3>

<p>Not everything works. Most notably, there is <em>no math support</em> in</p>

<ul>
  <li>lists,</li>
  <li>tables,</li>
  <li>headers,</li>
</ul>

<p>yet.</p>

<div><div><pre><code><span>-</span> $E = mc^2$
<span>-</span> $a^2 + b^2 = c^2$
</code></pre></div></div>

<p><img src="https://nschloe.github.io/images/math-in-lists.png" alt="math in lists"/></p>

<p>(See <a href="https://github.com/github/feedback/discussions/16992">here</a> for a
bug report.)</p>

<p>Getting math in lists etc. right is hard because of the syntax GitHub chose.
With GitLab’s syntax, math works wherever Markdown code blocks work.</p>

<h3 id="mathjax-vs-katex">MathJax vs KaTeX</h3>

<p>Then there is their choice of rendering engine,
<a href="https://github.com/mathjax/MathJax/">MathJax</a>. Historically, it’s the first
engine that could seriously render math in web pages, and is used in many
places, e.g., <a href="https://math.stackexchange.com/">math.stackexchange</a>. If you
look just a little closer, though, you’ll find there’s at least one serious
competitor: <a href="https://github.com/KaTeX/KaTeX">KaTeX</a>. Its main advantage over
<em>MathJax</em> is that it isn’t dead. Check out the repo activity on the two
projects:</p>

<ul>
  <li>
    <p>MathJax:</p>

    <p><a href="https://github.com/mathjax/MathJax/graphs/contributors"><img src="https://nschloe.github.io/images/mathjax-contributors.png" alt="mathjax contributors"/></a></p>
  </li>
  <li>
    <p>KaTeX:</p>

    <p><a href="https://github.com/KaTeX/KaTeX/graphs/contributors"><img src="https://nschloe.github.io/images/katex-contributors.png" alt="katex contributors"/></a></p>
  </li>
</ul>

<p>With
<a href="https://github.com/nschloe/xhub">xhub</a>, I’ve had a great experience with
KaTeX, especially the support.</p>

<p>More advantages of KaTeX:</p>

<ul>
  <li>It’s <a href="https://www.intmath.com/cg5/katex-mathjax-comparison.php">faster</a>.</li>
  <li>You can copy-and-paste math.</li>
</ul>

<h2 id="the-ugly">The Ugly</h2>

<h3 id="font-sizes">Font sizes</h3>

<p>MathJax’s default font MJXTEX-I and GitHub’s default text Helvetica have a
different x-height/cap-height ratio. This means that, if you match the capitals
in height, the small letters won’t match. This is what it looks like:</p>

<p>
  <img src="https://nschloe.github.io/images/math-font-size.png" width="30%"/>
</p>

<p>Font enthusiasts will also notice that the text font is sans-serif while the
math font has serifs – a no-go in serious typesetting, but forgivable on the web.</p>

<p>There’s probably not too much you can do here. Matching text and math fonts is
a whole branch of science, see, e.g.,
<a href="https://tug.org/pracjourn/2006-1/hartke/hartke.pdf">here</a>.</p>

<p>See the bug report
<a href="https://github.com/github/feedback/discussions/16999">here</a>.</p>

<h3 id="kerning">Kerning</h3>

<p><a href="https://en.wikipedia.org/wiki/Kerning"><em>Kerning</em></a> is a typographist’s way of
saying <em>distance between letters</em>. Compare the kerning in <code>a = b</code> between
GitHub</p>

<p>
  <img src="https://nschloe.github.io/images/kerning-github.png" width="20%"/>
</p>

<p>and LaTeX:</p>

<p>
  <img src="https://nschloe.github.io/images/kerning-latex.png" width="20%"/>
</p>

<p>Clearly, the GitHub kerning is off. This could perhaps be a font issue, or an
issue related to MathJax. (See the bug report
<a href="https://github.com/github/feedback/discussions/16997">here</a>.)</p>

<h2 id="concluding-thoughts">Concluding thoughts</h2>

<p>The reason why I’m so excited about this feature is that, in combination with
version control and the issues/discussions capabilities in GitHub, I can see
tectonic changes in how we’re publishing science. At last, science can really
reap the benefits of a connected internet by moving away from static PDFs to
living, breathing repositories which <em>render</em> like PDFs and provide a central
place where one can actually talk about the article. – And fix bugs!</p>

<p>I’m less enthusiastic about some of the engineering decisions in developing
this product though. The choice of MathJax over KaTeX confuses me.
Since that is more or less a drop-in replacement, perhaps that’s a change
that can be made at some point.</p>

<p>A more serious issue is GitHub’s approach of (not) trying to consolidate math
and Markdown syntax. <em>Something</em> is working now, but knowing how hard it is to
write a parser I’m pessimistic about how quickly bugs can be fixed and features
added. The fact that math support is only on the top level of the document
speaks for itself.</p>

  </div>
</article>

      </div>
    </div></div>
  </body>
</html>
