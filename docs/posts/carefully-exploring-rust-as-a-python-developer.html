<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://karimjedda.com/carefully-exploring-rust/">Original</a>
    <h1>Carefully exploring Rust as a Python developer</h1>
    
    <div id="readability-page-1" class="page"><section>
                    <p>I&#39;ve recently joined a new company where one of the most used programming languages is Rust. </p><p>After using Python for almost a decade now, mostly for data engineering, I thought I&#39;d give this new (to me) programming language a try and see if the praise I was reading about it on different platforms holds. </p><p>Rust is very different than Python and I won&#39;t elaborate on the technicalities that make Rust unique, there are many videos, articles and book written about the intricacies and technicalities of the language. Those pieces of content are excellent in explaining what Rust is but as a beginner I&#39;m more focused in hitting the ground running as fast as possible. </p><p>I&#39;m only focused on using the language to get stuff done with minimum friction but also evaluating at which degree I can figure out stuff on my own in order to learn. In some way, I&#39;m more interested in complete dishes rather than the indexing of the ingredients properties. </p><p>Either way, I&#39;d like to cover the basics before exploring more advanced topics. </p><h3 id="setting-up-a-development-environment">Setting up a development environment</h3><p>This has been straightforward by following the examples on the <a href="https://www.rust-lang.org/tools/install">Rust website</a>. Run a single command in a terminal and you&#39;re good to go. Everything should be configured and installed correctly. </p><p>To verify that Rust has been installed correctly, create an empty project in an empty directory with: ¬†</p><!--kg-card-begin: markdown--><pre><code>cargo new tutorial

cd tutorial

cargo run
</code></pre>
<!--kg-card-end: markdown--><p>Now you can open that folder in your favourite text editor, I recommend VSCode if you&#39;re starting out as a few extensions that could help a lot and guides on how to use those extensions are very accessible. I recommend rust-analyzer as the only extension for VSCode. </p><h3 id="outputting-and-debugging-stuff">Outputting and debugging stuff</h3><p>I want to understand how my program is running and the first interaction with it is seeing what it&#39;s doing or what it has done through outputs to the command line. </p><figure><img src="https://karimjedda.com/content/images/2022/10/rust-for-Python-developers---println.png" alt="" loading="lazy" width="2000" height="1212" srcset="https://karimjedda.com/content/images/size/w600/2022/10/rust-for-Python-developers---println.png 600w, https://karimjedda.com/content/images/size/w1000/2022/10/rust-for-Python-developers---println.png 1000w, https://karimjedda.com/content/images/size/w1600/2022/10/rust-for-Python-developers---println.png 1600w, https://karimjedda.com/content/images/size/w2400/2022/10/rust-for-Python-developers---println.png 2400w" sizes="(min-width: 1200px) 1200px"/><figcaption>Outputting stuff out to the terminal</figcaption></figure><p>It is also pretty much possible to use a regular debugger. On M1 I can recommend Visual Studio Code with LLDB, it works pretty well and is ultimately better than constantly printing things out to stdout (to each their own though). </p><figure><img src="https://karimjedda.com/content/images/2022/10/rust-for-Python-developers---Debugger.png" alt="" loading="lazy" width="2000" height="1212" srcset="https://karimjedda.com/content/images/size/w600/2022/10/rust-for-Python-developers---Debugger.png 600w, https://karimjedda.com/content/images/size/w1000/2022/10/rust-for-Python-developers---Debugger.png 1000w, https://karimjedda.com/content/images/size/w1600/2022/10/rust-for-Python-developers---Debugger.png 1600w, https://karimjedda.com/content/images/size/w2400/2022/10/rust-for-Python-developers---Debugger.png 2400w" sizes="(min-width: 1200px) 1200px"/><figcaption>Debugging rust code¬†</figcaption></figure><p>So far it all looks very similar to what Python has to offer, except that the commands are run using <strong>cargo run</strong> instead of calling a specific file like <strong>python3 somefile.py</strong>. </p><div><p>üí°</p><p>It&#39;s also possible to run <strong>cargo build</strong> and then run the file located at <strong>target/debug/tutorial</strong>. This will give the same result. If you then copy that generated file to another place on your machine, or to another machine similar to yours (another M1 in my case), it will work too without having to install anything Rust related.¬†</p></div><h3 id="handling-errors">Handling errors</h3><p>Let&#39;s face it, shit happens and it&#39;s important to be able to deal with things in a predictable manner. A big challenge in programming is that it&#39;s hard to account for all the possible errors that can happen in a program since we added those errors ourselves by simply writing the code.</p><blockquote>‚ÄúEveryone knows that debugging is twice as hard as writing a program in the first place. So if you&#39;re as clever as you can be when you write it, how will you ever debug it?‚Äù - Brian W. Kernighan</blockquote><p>In Python, this is usually done with try/except methods and raising exceptions. We try some stuff and if it fails we either try to match it to an exception we accounted for (a planned one) or we don&#39;t match it and add it to a generic exception. There are of course different categories of errors. While Python will let you bundle a package with a call to a non existing function on an object (and error on run time), Rust won&#39;t let you compile the code. &#34;Runtime is fun time&#34; doesn&#39;t hold when writing Rust so that eliminates a whole category of semi predictable errors. </p><p>While I can&#39;t fully explain the approach, I will attempt to explain this in Python terms through an example. </p><figure><img src="https://karimjedda.com/content/images/2022/10/rust-for-Python-developers---errors1.png" alt="" loading="lazy" width="2000" height="1212" srcset="https://karimjedda.com/content/images/size/w600/2022/10/rust-for-Python-developers---errors1.png 600w, https://karimjedda.com/content/images/size/w1000/2022/10/rust-for-Python-developers---errors1.png 1000w, https://karimjedda.com/content/images/size/w1600/2022/10/rust-for-Python-developers---errors1.png 1600w, https://karimjedda.com/content/images/size/w2400/2022/10/rust-for-Python-developers---errors1.png 2400w" sizes="(min-width: 1200px) 1200px"/><figcaption>Defining a custom exception</figcaption></figure><figure><img src="https://karimjedda.com/content/images/2022/10/rust-for-Python-developers---errors2.png" alt="" loading="lazy" width="2000" height="1212" srcset="https://karimjedda.com/content/images/size/w600/2022/10/rust-for-Python-developers---errors2.png 600w, https://karimjedda.com/content/images/size/w1000/2022/10/rust-for-Python-developers---errors2.png 1000w, https://karimjedda.com/content/images/size/w1600/2022/10/rust-for-Python-developers---errors2.png 1600w, https://karimjedda.com/content/images/size/w2400/2022/10/rust-for-Python-developers---errors2.png 2400w" sizes="(min-width: 1200px) 1200px"/><figcaption>Calling a custom exception from code</figcaption></figure><p>What is defined above is creating a custom exception that will be raised in the do_something function and checking for it in the main function. It&#39;s almost similar to a try/except but with a bit more boilerplate code. </p><p>All of the boilerplate code above is necessary to get it to work but is too complicated to understand at this stage of my learning. I mainly got it to work by following <a href="https://stevedonovan.github.io/rust-gentle-intro/6-error-handling.html">this guide</a>, <a href="https://learning-rust.github.io/docs/e7.custom_error_types.html">this one</a> and <a href="https://fettblog.eu/rust-error-handling/">this one</a>. </p><p>I might hear you say now &#34;<em>there must be a better way</em>&#34;, especially if you&#39;re writing Python for a while now and there indeed is. We&#39;ll have to use packages. </p><p>For a detailed explanation of the above <a href="https://doc.rust-lang.org/book/ch09-00-error-handling.html">check this out</a>.</p><h3 id="using-external-packages">Using external packages</h3><p>The cool thing about our industry is that we can reuse a lot of stuff that others built. One of the packages that is pretty interesting if you&#39;re planning out the failure modes of your program is <a href="https://crates.io/crates/thiserror">thiserror</a>. Rust leverages cargo as package manager.</p><p>Packages in Rust are called crates. They are installed by editing the <strong>Cargo.toml</strong> file located in the directory we created for this tutorial. In this case, we&#39;d add <strong>thiserror = &#34;1.0&#34;</strong> right after<strong> [dependencies] </strong>and we&#39;re in business.</p><p>We can rewrite all the above code like this:</p><figure><img src="https://karimjedda.com/content/images/2022/10/rust-for-Python-developers---error-better.png" alt="" loading="lazy" width="2000" height="1212" srcset="https://karimjedda.com/content/images/size/w600/2022/10/rust-for-Python-developers---error-better.png 600w, https://karimjedda.com/content/images/size/w1000/2022/10/rust-for-Python-developers---error-better.png 1000w, https://karimjedda.com/content/images/size/w1600/2022/10/rust-for-Python-developers---error-better.png 1600w, https://karimjedda.com/content/images/size/w2400/2022/10/rust-for-Python-developers---error-better.png 2400w" sizes="(min-width: 1200px) 1200px"/><figcaption>Hmm looks a lot better</figcaption></figure><p>Ok now we&#39;re talking. This <em>feels</em> more like writing regular code while exploring Rust. I enjoy this a lot more than building everything from first principles. It took me 4 to 5 years to get to the more interesting parts in Python, so, advanced stuff for Rust can also wait a bit for when it&#39;s necessary. For more in-depth explanation on error handling, <a href="https://nick.groenen.me/posts/rust-error-handling/#counting-words">check this out</a>. There are a lot of ways for how to handle errors in Rust, I prefer the lazy one :) </p><p>Obviously I&#39;m skipping a few things like &#34;what is an enum?&#34;, &#34;what does that pub stand for?&#34;, &#34;why are those hashtags for?&#34; and that&#39;s on purpose. Their utility can be deduced from running the code, their understanding can be deferred after seeing them in action. </p><p>So far we managed quite a few things and to be honest, it&#39;s working out great. Let&#39;s figure out testing now shall we? </p><h3 id="writing-tests">Writing tests</h3><p>Tests should be configured and running on two levels: unit tests and integration tests. There are different ways on how to achieve this. While it&#39;s possible (and recommended by official guides) to put the tests in the same file than the rust code, what I like to do is to always have a separate folder with the tests neatly organised. This reduces the visual overload and screen bloat when editing something or making changes. And to be honest, I&#39;m in a different <em>mood</em> when I write code than when I write tests (one of which involves red wine and cheese). </p><p>One way of doing it is like this: </p><figure><img src="https://karimjedda.com/content/images/2022/10/rust-for-Python-developers---testing-1.png" alt="" loading="lazy" width="2000" height="1137" srcset="https://karimjedda.com/content/images/size/w600/2022/10/rust-for-Python-developers---testing-1.png 600w, https://karimjedda.com/content/images/size/w1000/2022/10/rust-for-Python-developers---testing-1.png 1000w, https://karimjedda.com/content/images/size/w1600/2022/10/rust-for-Python-developers---testing-1.png 1600w, https://karimjedda.com/content/images/size/w2400/2022/10/rust-for-Python-developers---testing-1.png 2400w" sizes="(min-width: 1200px) 1200px"/><figcaption>test folder + new fizz_test.rs file</figcaption></figure><p>You can run the above tests using cargo test resulting in the following:</p><figure><img src="https://karimjedda.com/content/images/2022/10/rust-for-Python-develoeprs---testing-2.png" alt="" loading="lazy" width="2000" height="1137" srcset="https://karimjedda.com/content/images/size/w600/2022/10/rust-for-Python-develoeprs---testing-2.png 600w, https://karimjedda.com/content/images/size/w1000/2022/10/rust-for-Python-develoeprs---testing-2.png 1000w, https://karimjedda.com/content/images/size/w1600/2022/10/rust-for-Python-develoeprs---testing-2.png 1600w, https://karimjedda.com/content/images/size/w2400/2022/10/rust-for-Python-develoeprs---testing-2.png 2400w" sizes="(min-width: 1200px) 1200px"/><figcaption>Tests run and pass</figcaption></figure><p>There is a lot more to unpack here, but without making it too complicated, this is a &#34;Pareto optimal&#34; way of doing it (80/20). It also kinda reminds me of <strong>pytest</strong>, which immediately increases the level of <em>comfyness</em>. </p><p>For more details: </p><ul><li>Unit tests <a href="http://xion.io/post/code/rust-unit-test-placement.html">http://xion.io/post/code/rust-unit-test-placement.html</a> </li><li>Integration tests <a href="https://doc.rust-lang.org/rust-by-example/testing/integration_testing.html">https://doc.rust-lang.org/rust-by-example/testing/integration_testing.html</a> </li></ul><h3 id="read-a-file-run-something-and-write-to-another-file">Read a file, run something and write to another file</h3><p>Now that we covered the basics: printing stuff out, debugging, using external packages and testing, we can do something a bit more productive. The canonical way of doing this is by writing a simple program that will process a local file. This is what I&#39;d call the standard <a href="https://en.wikipedia.org/wiki/Kata">kata</a>, get a CSV file, compute some metrics and write the results out.</p><p>For this to work, add <strong>csv = &#34;1.1&#34;</strong> and <strong>serde = { version = &#34;1&#34;, features = [&#34;derive&#34;] }</strong> to your <strong>Cargo.toml</strong>. I let you guess how the main() method should look like. </p><figure><img src="https://karimjedda.com/content/images/2022/10/rust-for-Python-developers---read-csv.png" alt="" loading="lazy" width="2000" height="1137" srcset="https://karimjedda.com/content/images/size/w600/2022/10/rust-for-Python-developers---read-csv.png 600w, https://karimjedda.com/content/images/size/w1000/2022/10/rust-for-Python-developers---read-csv.png 1000w, https://karimjedda.com/content/images/size/w1600/2022/10/rust-for-Python-developers---read-csv.png 1600w, https://karimjedda.com/content/images/size/w2400/2022/10/rust-for-Python-developers---read-csv.png 2400w" sizes="(min-width: 1200px) 1200px"/><figcaption>Reading and processing a CSV file</figcaption></figure><p>Of course there is a lot more we can do with this. If you have a more complicated CSV file, you can use the pandas pendant in Rust called <a href="https://www.pola.rs/">pola.rs</a> to have more fun with the data. I still have to explore that a bit more but it seems extremely powerful and performant. </p><p>To be honest, when compared to how <a href="https://realpython.com/python-csv/">CSV parsing would work in Python</a> I&#39;d say it&#39;s roughly the same, except the automatic deserialising which I have to admit is pretty nice. ¬†</p><p>We can add a few tests, but I&#39;m not showing them here as it won&#39;t fit in a concise screenshot and won&#39;t add anything. </p><p>PS: consider this code &#34;newbie&#34; code. </p><h3 id="making-http-requests">Making HTTP requests</h3><p>Moving up the hierarchy of a developer&#39;s needs, the next thing would be to make basic HTTP requests and do something with the results. Most of these requests process JSON nowadays so that&#39;s what we&#39;ll try. </p><p>Add the following three lines to your Cargo.toml and you&#39;re good to go: <strong>reqwest = { version = &#34;0.11&#34;, features = [&#34;json&#34;] }</strong> and <strong>tokio = { version = &#34;1&#34;, features = [&#34;full&#34;] } </strong>and<strong> serde_json = &#34;1&#34;</strong>.</p><figure><img src="https://karimjedda.com/content/images/2022/10/rust-for-Python-developers---http-request.png" alt="" loading="lazy" width="2000" height="1137" srcset="https://karimjedda.com/content/images/size/w600/2022/10/rust-for-Python-developers---http-request.png 600w, https://karimjedda.com/content/images/size/w1000/2022/10/rust-for-Python-developers---http-request.png 1000w, https://karimjedda.com/content/images/size/w1600/2022/10/rust-for-Python-developers---http-request.png 1600w, https://karimjedda.com/content/images/size/w2400/2022/10/rust-for-Python-developers---http-request.png 2400w" sizes="(min-width: 1200px) 1200px"/><figcaption>Making an async HTTP request and parse the returned JSON¬†</figcaption></figure><p>Ok now we&#39;re talking, we can request data from API&#39;s. As a data engineer this makes me very happy. Combining the above two methods we can fetch data, analyse it with pola.rs and write the results to a CSV relatively easy, with guarantees of memory safety and a lot more goodies. Noticed how the for loop reads like in Python? That&#39;s nice. </p><p>Now I&#39;m sure the ecosystem will grow to cover a lot more use cases and adding or working with existing crates is a breeze. I&#39;ve hit 0 walls writing this so far and looking things up as I go. </p><h3 id="work-with-sqlite">Work with SQLite </h3><p>SQLite might be an odd addition to this list but I&#39;m using it extensively in many of the programs or tools that I develop. I really like SQL since it&#39;s portable, efficient and requires exactly 0 maintenance. </p><p>The issue with using Python combined with SQL is always this question of using an ORM or not using an ORM. Don&#39;t get me wrong, SQLAlchemy does a great job but sometimes I feel like it&#39;s a bottleneck to the small things I&#39;m developing. Add to that the complicated deployment steps to smaller embedded devices when using Python, it feels like the setup is doing a disservice to SQLite. </p><p>Which is where Rust comes in the picture. There are many examples online for how to use <a href="https://rust-lang-nursery.github.io/rust-cookbook/database/sqlite.html">Rust in combination with SQLite</a> and I believe it&#39;s a perfect combination. </p><p>A simple example would look like this, don&#39;t forget to add <strong>rusqlite = { version = &#34;0.28.0&#34;, features = [&#34;bundled&#34;] }</strong> to Cargo.toml:</p><figure><img src="https://karimjedda.com/content/images/2022/10/rust-for-Python-developers---sqlite.png" alt="" loading="lazy" width="2000" height="1137" srcset="https://karimjedda.com/content/images/size/w600/2022/10/rust-for-Python-developers---sqlite.png 600w, https://karimjedda.com/content/images/size/w1000/2022/10/rust-for-Python-developers---sqlite.png 1000w, https://karimjedda.com/content/images/size/w1600/2022/10/rust-for-Python-developers---sqlite.png 1600w, https://karimjedda.com/content/images/size/w2400/2022/10/rust-for-Python-developers---sqlite.png 2400w" sizes="(min-width: 1200px) 1200px"/><figcaption>SQLite with Rust</figcaption></figure><p>This example is copied from the <a href="https://crates.io/crates/rusqlite/">rusqlite crate</a> itself. It&#39;s a bit more up to date and accessible than the <a href="https://rust-lang-nursery.github.io/rust-cookbook/database/sqlite.html">Rust Cookbook</a>, which also has good examples. </p><p>Of course this only scratches the surface of what is possible. But combining only the methods above and without trying to be <em><strong>too smart</strong></em> about syntax and details, I&#39;d wager it&#39;s possible to implement already a lot of useful things. All the while learning and getting initiated to a new programming language. ¬†</p><h2 id="conclusion">Conclusion</h2><p>All things considered, Rust is a solid language with a lot of very good practices baked in. I respect the efforts put in to make this wonderful language and I&#39;ll explore it more. I&#39;m certain I&#39;m not appreciating it to it&#39;s fullest - yet, but I&#39;ll get there. </p><p>While this was meant as a guide, I&#39;m hoping for more &#34;light touch&#34; beginner guides to pop up to get more people interested to give this a go. I believe a programming language is only as good as whom it welcomes. </p><p>The first interaction with a programming language should be what it can do for you, rather than an exhaustive glossary of what it is. You really don&#39;t need to know in detail what borrowing, inheritance or traits are to do the stuff listed here but somehow too many guides just focus a lot on that. Those are great, but there&#39;s a wider audience (me included) that is just focused on building things that work, and can be maintained, and not that interested in theory and advanced concepts that don&#39;t seem to bring much.</p><p>Going from 0 to 1 is usually a lot more difficult than going from 1 to 10 :) </p><p>I&#39;m aware this might be a bit confusing let me know if you think a video would be better to get the point across, I&#39;m looking for reasons to make videos anyway. </p>
                    
                </section></div>
  </body>
</html>
