<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/supabase/postgres_lsp">Original</a>
    <h1>Postgres Language Server</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/supabase/postgres_lsp/blob/main/docs/images/pls-github.png"><img src="https://github.com/supabase/postgres_lsp/raw/main/docs/images/pls-github.png" alt="Postgres Language Server"/></a></p>

<p dir="auto">A Language Server for Postgres. Not SQL with flavors, just Postgres.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-status" aria-hidden="true" href="#status"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Status</h2>
<p dir="auto">ðŸš§ This is in active development and is only ready for collaborators. The majority of work is still ahead, but we&#39;ve verified that the approach works. We&#39;re making this public so that we can develop it in the open with input from the community.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Features</h2>
<p dir="auto">The <a href="https://microsoft.github.io/language-server-protocol/" rel="nofollow">Language Server Protocol</a> is an open protocol between code editors and servers to provide code intelligence tools such as code completion and syntax highlighting. This project implements such a language server for Postgres, significantly enhancing the developer experience within your favorite editor by adding:</p>
<ul dir="auto">
<li>Semantic Highlighting</li>
<li>Syntax Error Diagnostics</li>
<li>Show SQL comments on hover</li>
<li>Auto-Completion</li>
<li>Code actions such as <code>Execute the statement under the cursor</code>, or <code>Execute the current file</code></li>
<li>Configurable Code Formatting</li>
<li>... and many more</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-motivation" aria-hidden="true" href="#motivation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Motivation</h2>
<p dir="auto">Despite the rising popularity of Postgres, support for the PL/pgSQL in IDEs and editors is limited. While there are some <em>generic</em> SQL Language Servers<sup><a href="#user-content-fn-1-ca1064064698847140c644fab731f944" id="user-content-fnref-1-ca1064064698847140c644fab731f944" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup> offering the Postgres syntax as a &#34;flavor&#34; within the parser, they usually fall short due to the ever-evolving and complex syntax of PostgreSQL. There are a few proprietary IDEs<sup><a href="#user-content-fn-2-ca1064064698847140c644fab731f944" id="user-content-fnref-2-ca1064064698847140c644fab731f944" data-footnote-ref="" aria-describedby="footnote-label">2</a></sup> that work well, but the features are only available within the respective IDE.</p>
<p dir="auto">This Language Server is designed to support Postgres, and only Postgres. The server uses <a href="https://github.com/pganalyze/libpg_query">libpg_query</a>, therefore leveraging the PostgreSQL source to parse the SQL code reliably. Using Postgres within a Language Server might seem unconventional, but it&#39;s the only reliable way of parsing all valid PostgreSQL queries. You can find a longer rationale on why This is the Wayâ„¢ <a href="https://pganalyze.com/blog/parse-postgresql-queries-in-ruby" rel="nofollow">here</a>. While libpg_query was built to execute SQL, and not to build a language server, any shortcomings have been successfully mitigated in the <code>parser</code> crate. You can read the <a href="https://github.com/supabase/postgres_lsp/blob/main/crates/parser/src/lib.rs">commented source code</a> for more details on the inner workings of the parser.</p>
<p dir="auto">Once the parser is stable, and a robust and scalable data model is implemented, the language server will not only provide basic features such as semantic highlighting, code completion and syntax error diagnostics, but also serve as the user interface for all the great tooling of the Postgres ecosystem.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-roadmap" aria-hidden="true" href="#roadmap"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Roadmap</h2>
<p dir="auto">This is a proof of concept for building both a concrete syntax tree and an abstract syntax tree from a potentially malformed PostgreSQL source code. The <code>postgres_lsp</code> crate was created to prove that it works end-to-end, and is just a very basic language server with semantic highlighting and error diagnostics. Before further feature development, we have to complete a bit of groundwork:</p>
<ol dir="auto">
<li><em>Finish the parser</em>
<ul dir="auto">
<li>The parser works, but the enum values for all the different syntax elements and internal conversations are manually written or copied, and, in some places, only cover a few elements required for a simple select statement. To have full coverage without possibilities for a copy and paste error, they should be generated from <code>pg_query.rs</code> source code. (<a href="https://github.com/supabase/postgres_lsp/pull/4" data-hovercard-type="pull_request" data-hovercard-url="/supabase/postgres_lsp/pull/4/hovercard">#4</a>)</li>
<li>There are a few cases such as nested and named dollar quoted strings that cause the parser to fail due to limitations of the regex-based lexer. Nothing that is impossible to fix, or requires any fundamental change in the parser though.</li>
</ul>
</li>
<li><em>Implement a robust and scalable data model</em>
<ul dir="auto">
<li>This is still in a research phase</li>
<li>A great rationale on the importance of the data model in a language server can be found <a href="https://matklad.github.io/2023/05/06/zig-language-server-and-cancellation.html" rel="nofollow">here</a></li>
<li><code>rust-analyzer</code>s <a href="https://github.com/rust-lang/rust-analyzer/tree/master/crates/base-db"><code>base-db</code> crate</a> will serve as a role model</li>
<li>The <a href="https://github.com/salsa-rs/salsa"><code>salsa</code></a> crate will most likely be the underlying data structure</li>
</ul>
</li>
<li><em>Setup the language server properly</em>
<ul dir="auto">
<li>This is still in a research phase</li>
<li>Once again <code>rust-analyzer</code> will serve as a role model, and we will most likely implement the same queueing and cancellation approach</li>
</ul>
</li>
<li><em>Implement basic language server features</em>
<ul dir="auto">
<li>Semantic Highlighting</li>
<li>Syntax Error Diagnostics</li>
<li>Show SQL comments on hover</li>
<li>Auto-Completion</li>
<li>Code Actions, such as <code>Execute the statement under the cursor</code>, or <code>Execute the current file</code></li>
<li>... anything you can think of really</li>
</ul>
</li>
<li><em>Integrate all the existing open source tooling</em>
<ul dir="auto">
<li>Show migration file lint errors from <a href="https://github.com/sbdchd/squawk">squawk</a></li>
<li>Show plpsql lint errors from <a href="https://github.com/okbob/plpgsql_check">plpgsql_check</a></li>
</ul>
</li>
<li><em>Build missing pieces</em>
<ul dir="auto">
<li>An optionated code formatter (think prettier for PostgreSQL)</li>
</ul>
</li>
<li><em>(Maybe) Support advanced features with declarative schema management</em>
<ul dir="auto">
<li>Jump to definition</li>
<li>... anything you can think of really</li>
</ul>
</li>
</ol>
<h2 tabindex="-1" dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<p dir="auto"><span><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Warning</span></p>
<h3 tabindex="-1" dir="auto"><a id="user-content-neovim" aria-hidden="true" href="#neovim"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Neovim</h3>
<p dir="auto">Add the postgres_lsp executable to your path, and add the following to your config to use it.</p>
<div dir="auto" data-snippet-clipboard-copy-content="require(&#39;lspconfig.configs&#39;).postgres_lsp = {
  default_config = {
    name = &#39;postgres_lsp&#39;,
    cmd = {&#39;postgres_lsp&#39;},
    filetypes = {&#39;sql&#39;},
    single_file_support = true,
    root_dir = util.root_pattern &#39;root-file.txt&#39;
  }
}

lsp.configure(&#34;postgres_lsp&#34;, {force_setup = true})"><pre><span>require</span>(<span><span>&#39;</span>lspconfig.configs<span>&#39;</span></span>).<span>postgres_lsp</span> <span>=</span> {
  default_config <span>=</span> {
    name <span>=</span> <span><span>&#39;</span>postgres_lsp<span>&#39;</span></span>,
    cmd <span>=</span> {<span><span>&#39;</span>postgres_lsp<span>&#39;</span></span>},
    filetypes <span>=</span> {<span><span>&#39;</span>sql<span>&#39;</span></span>},
    single_file_support <span>=</span> <span>true</span>,
    root_dir <span>=</span> util.<span>root_pattern</span> <span><span>&#39;</span>root-file.txt<span>&#39;</span></span>
  }
}

lsp.<span>configure</span>(<span><span>&#34;</span>postgres_lsp<span>&#34;</span></span>, {force_setup <span>=</span> <span>true</span>})</pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-building-from-source" aria-hidden="true" href="#building-from-source"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Building from source</h3>
<p dir="auto">You&#39;ll need Cargo, Node, and npm installed.</p>
<p dir="auto">If you are using VS Code, you can install both the server and the client extension by running:</p>

<p dir="auto">If you&#39;re not using VS Code, you can install the server by running:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo xtask install --server"><pre>cargo xtask install --server</pre></div>
<p dir="auto">The server binary will be installed in <code>.cargo/bin</code>. Make sure that <code>.cargo/bin</code> is in <code>$PATH</code>.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-contributors" aria-hidden="true" href="#contributors"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Contributors</h2>
<ul dir="auto">
<li><a href="https://github.com/psteinroe">psteinroe</a> (Maintainer)</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-acknowledgments" aria-hidden="true" href="#acknowledgments"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Acknowledgments</h2>
<ul dir="auto">
<li><a href="https://github.com/rust-lang/rust-analyzer">rust-analyzer</a> for implementing such a robust, well documented, and feature-rich language server. Great place to learn from.</li>
<li><a href="https://github.com/sbdchd/squawk">squawk</a> and <a href="https://pganalyze.com" rel="nofollow">pganalyze</a> for inspiring the use of libpg_query.</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-footnotes" aria-hidden="true" href="#footnotes"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Footnotes</h2>
<section data-footnotes="">
<ol dir="auto">
<li id="user-content-fn-1-ca1064064698847140c644fab731f944">
<p dir="auto">Generic SQL Solutions: <a href="https://github.com/joe-re/sql-language-server">sql-language-server</a>, <a href="https://github.com/darold/pgFormatter/tree/master">pgFormatter</a>, <a href="https://github.com/nene/sql-parser-cst">sql-parser-cst</a> <a href="#user-content-fnref-1-ca1064064698847140c644fab731f944" data-footnote-backref="" aria-label="Back to reference 1"><g-emoji alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">â†©</g-emoji></a></p>
</li>
<li id="user-content-fn-2-ca1064064698847140c644fab731f944">
<p dir="auto">Proprietary IDEs: <a href="https://www.jetbrains.com/datagrip/">DataGrip</a> <a href="#user-content-fnref-2-ca1064064698847140c644fab731f944" data-footnote-backref="" aria-label="Back to reference 2"><g-emoji alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">â†©</g-emoji></a></p>
</li>
</ol>
</section>
</article>
          </div></div>
  </body>
</html>
