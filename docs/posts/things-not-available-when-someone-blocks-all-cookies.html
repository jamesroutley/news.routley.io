<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.tomayac.com/2022/08/30/things-not-available-when-someone-blocks-all-cookies/">Original</a>
    <h1>Things not available when someone blocks all cookies</h1>
    
    <div id="readability-page-1" class="page"><div><article lang="en"><header><a href="https://thevaluable.dev/2022/08/30/things-not-available-when-someone-blocks-all-cookies/"></a></header><section><p>The other day, I received a harmless-looking <a href="https://github.com/tomayac/SVGcode/issues/86">Issue</a> for my app <a href="https://svgco.de/">SVGcode</a> (<a href="https://thevaluable.dev/2021/11/22/releasing-svgcode/index.html">announcement blog post</a>). The Issue read:</p><blockquote><p><strong>Crash when opened with cookies blocked</strong></p><p>Hey I block cookies by default. Unfortunately your website doesn‚Äôt handle that nicely despite it not needing (IMO) cookies to operate. I&#39;m getting this error, because blocking cookies also blocks localStorage.</p><p><code>Uncaught DOMException: Failed to read the &#39;localStorage&#39; property from &#39;Window&#39;: Access is denied for this document.</code> Please add fallback to js provided localStorage, because it makes the app unusable.</p></blockquote><p>I don&#39;t use cookies in the app at all, but for sure, when I disabled cookies in Chrome, the app wasn&#39;t usable.</p><p><img src="https://thevaluable.dev/images/chrome-block-cookies.png" alt="Chrome Settings with all cookies blocked."/></p><p>All I <em>am</em> using is some innocent <code>localStorage</code> and IndexedDB to persist user settings like the values of the sliders or the chosen color scheme.</p><p>Turns out, with all cookies blocked, Chrome disables a lot of (all?) APIs that can be used to persist data and thus potentially profile users. Here are the ones that I found:</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"><code>localStorage</code></a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage"><code>sessionStorage</code></a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API">IndexedDB</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage">CacheStorage</a></li><li><a href="https://www.w3.org/TR/webdatabase/">Web SQL</a> (obsolete)</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">Service Workers</a></li><li><a href="https://web.dev/file-system-access/#accessing-the-origin-private-file-system">Origin Private File System</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/requestFileSystem"><code>webkitRequestFileSystem()</code></a> (obsolete)</li></ul><p>The code sample below shows all these APIs and the error messages they throw when you try to use them with cookies blocked.</p><pre><code>localStorage<span>;</span></code></pre><p>Did I miss anything? If so, please let me know!</p><p><img src="https://thevaluable.dev/images/chrome-cookie-errors.png" alt="Console errors when trying to access localStorage, sessionStorage, the Cache API, IndexedDB, and Web SQL."/></p><p>The fix for the Issue was annoying, but simple. Always <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/try...catch"><code>try...catch</code></a> any potentially blocked calls:</p><ul><li><a href="https://github.com/tomayac/SVGcode/commit/b9d2c59bc579c103b8ac154432d65eec9688e853">Commit <code>b9d2c59</code></a></li><li><a href="https://github.com/tomayac/SVGcode/commit/036ddd27cbcc7923b0f8da7072a34a0e3de764b1">Commit <code>036ddd2</code></a></li></ul><p><img src="https://thevaluable.dev/images/svgcode-errors.png" alt="SVGcode app with blocked cookies working and showing caught exceptions in the DevTools console."/></p><p>Please <a href="https://github.com/tomayac/SVGcode/issues/">report</a> any other errors you encounter (I don&#39;t care for the analytics script failing). And thanks, <a href="https://github.com/JakubekWeg">@JakubekWeg</a> for caring enough to having opened this Issue! Jakub is the proof that users exist who block any and all cookies. Check your error logs, you might be losing users, too!</p><p>(On a tangent, <a href="https://developer.mozilla.org/en-US/">MDN</a> is completely broken with cookies blocked, too. I was about to report this problem (because I care and love MDN üòç), when I discovered a <a href="https://github.com/mdn/yari/pull/6352">PR</a> is already under way that fixes the <a href="https://github.com/mdn/yari/issues/6758">Issue</a>. Thanks, <a href="https://github.com/bershanskiy">@bershanskiy</a>!)</p><p><img src="https://thevaluable.dev/images/mdn-error.png" alt="MDN with blocked cookies"/></p></section></article></div></div>
  </body>
</html>
