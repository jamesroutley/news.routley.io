<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://infinitedigits.co/tinker/zeptocore/?utm_source=atom_feed">Original</a>
    <h1>zeptocore</h1>
    
    <div id="readability-page-1" class="page"><div id="maincontent">
            
<p><img src="https://infinitedigits.co/img/zepto3.png"/>
</p>
<div>
    
    
    
    
    <p>
            <postamble datetime="2024-05-03" 2018-09-04=""><time datetime="2024-05-03 08:00:46">May 3rd, 2024</time></postamble>
         / <a href="https://infinitedigits.co/tags/hardware">#hardware</a> 
    </p>
    <p>creating a sample player machine from scratch.</p>
</div>
<p>the zeptocore is a portable sample player I created from scratch, released on May 3rd, 2024, which is available to buy on my website <a href="https://zeptocore.com/" target="_blank">zeptocore.com</a>.</p>
<p>the zeptocore is a handmade, handheld sample player. Its main purpose is to reimagine samples with fast tactile switches, while reacting, in realtime, to randomly changing patterns and effects.</p>

<p>
  <iframe src="https://www.youtube.com/embed/FZ2C9VIMgeI" allowfullscreen="" title="YouTube Video"></iframe>
</p>

<h2 id="the-beginnings">the beginnings</h2>
<p>I’ve been interested in mangling samples for a long time. I created a number of programs for the <a href="https://monome.org/docs/norns/" target="_blank">norns sound computer</a> using <a href="https://sccode.org" target="_blank">SuperCollider</a> that allow you to mangle samples in interesting ways. here is a selection:</p>
<ul>
<li><a href="https://github.com/schollz/amen" target="_blank">amen</a> - sample mangler and looper</li>
<li><a href="https://github.com/schollz/amenbreak" target="_blank">amenbreak</a> - dedicated amen break script</li>
<li><a href="https://github.com/schollz/makebreakbeat" target="_blank">makebreakbeat</a> - make breakbeats from scamples</li>
<li><a href="https://github.com/schollz/dnb.lua/" target="_blank">dnb.lua</a> - using aubio and sox to generate breakbeats</li>
<li><a href="https://github.com/schollz/sampswap" target="_blank">sampswap</a> - copies and pastes samples together</li>
<li><a href="https://github.com/schollz/glitchlets" target="_blank">glitchlets</a> - glitch audio</li>
</ul>
<p>After a few years of making software, I decided it would be fun and rewarding to make a physical device.</p>
<h2 id="the-breadboard">the breadboard</h2>
<p>I started working on this device a year ago using off-the-shelf components wired into a breadboard. I got the very first prototype working in July, on a long plane trip from Seattle to Berlin. (Strangely no TSA agent ever asked me about the breadboard with wires sticking out of it!)</p>
<p>Here is the first video of the first ever version where instead of tactile switches I’m using the keyboard:</p>

<p>
  <iframe src="https://www.youtube.com/embed/X2uFGZgEpfI" allowfullscreen="" title="YouTube Video"></iframe>
</p>

<p>This version is basically just some off the shelf components (a <a href="https://www.amazon.com/Comimark-Interface-PCM5102-GY-PCM5102-Raspberry/dp/B07W97D2YC/" target="_blank">pcm5102</a>, a <a href="https://www.adafruit.com/product/4682" target="_blank">SD card breakout</a>, and a <a href="https://www.raspberrypi.com/products/raspberry-pi-pico/]" target="_blank">raspberry pi pico</a>.</p>
<p>Most importantly, it was fun. I am a big proponent of <a href="https://en.wikipedia.org/wiki/Eating_your_own_dog_food" target="_blank">dogfooding</a> and at each step in the process of building, it was important that I really enjoyed the device.</p>
<p>I actually still support this breadboard version with off-the-shelf parts, which I call “<a href="https://zeptocore.com/#zeptoboard" target="_blank">zeptoboard</a>”.</p>
<p>
<img src="https://infinitedigits.co/img/zeptoboard.png"/>
</p>
<p>You can build this today and it still works great, especially with the MIDI interface on a Chrome browser:</p>

<p>
  <iframe src="https://www.youtube.com/embed/B09ppAjuyg0" allowfullscreen="" title="YouTube Video"></iframe>
</p>

<h2 id="the-hardware">the hardware</h2>
<p>Once I got the basic concept working I started on the hardware. The basic hardware is not too complicated - it needed to support SD card SDIO interfaces, 20 buttons, and 20 lights, 3 knobs. I am using the Raspberry Pi Pico as the CPU which didn’t have enough GPIOs for all of this, so I added a <a href="https://www.nxp.com/docs/en/data-sheet/PCA9552.pdf" target="_blank">PCA9552</a> as a light controller and did <a href="https://pcbheaven.com/wikipages/How_Key_Matrices_Works/" target="_blank">a keyboard matrix</a> for the tactile switches. Instead of off-the-shelf SD card and audio DAC I also integrated them into the board.</p>
<p>All in all it took me about 28 tries to get the board right (yes, that’s right, I spent about $3,000 over three months to finalize the hardware). There were about 15 versions that just <em>didn’t work</em> and it turned out to be something really silly like a bad soldering pad for the sd card.</p>
<p>
<img src="https://infinitedigits.co/img/zeptocorehard.png"/>
</p>
<p>In the end I was able to get matching colors for the Raspberry Pi Pico and the board which I also liked. (There was a separate incident where a large box of Raspberry Pi Picos got lost on its way to me and everything was delayed weeks).</p>
<h2 id="the-firmware">the firmware</h2>
<p>I spent almost a year writing the firmware which I call “<a href="https://github.com/schollz/_core" target="_blank">_core</a>” as it is somewhat hardware agnostic. I’m still writing the firmware. There are now over 1,500 commits to the codebase, most of them pretty substantial. I never fully realized how much work went into such a small device, but now I know.</p>
<p>
<a href="https://github.com/schollz/_core">
<img src="https://infinitedigits.co/img/zeptocontributions.png"/>
</a>
</p>
<p>One very fun part of doing the firmware was writing my own effects. I’m especially proud of the saturation and fuzz effects. The fuzz, for example, is a very simple transfer function which has a really cool effect on sound:</p>

<p>
  <iframe src="https://www.youtube.com/embed/pue0qsmQA2s" allowfullscreen="" title="YouTube Video"></iframe>
</p>


<p>The zeptocore loads samples from an SD card, but the samples need to be conditioned to a specific format (16-bit, 44.1khz, with appended and prepended audio for better streaming). To aid this, I also created a web tool called “<a href="https://zeptocore.com/tool" target="_blank">the tool</a>” where you can load samples in the browser and then directly download the files to load onto the sd card.</p>
<p>This part was fun to develop, it was a lot of frontend work - somewhat creating a file-browser/DAW in a website - but it paid off in the end to really improve the ease of use.</p>
<h2 id="the-challenges">the challenges</h2>
<p>There were several technical challenges that took me awhile to figure out.</p>
<p>The biggest challenge was the SD card latency. I made a decision early on that I would not limit sample length, so samples would be streamed directly off the SD card instead of loaded into internal memory. This comes with a severe limitation in that seeks to audio blocks can, in worst case scenarios, take up to 3-6 milliseconds. This means, if I choose an audio block of 10 ms (meaning latency of ~10-20 milliseconds which is at just the threshold of perception), it only provides enough time to do one seek per audioblock. This means that I can only do monophonic sample playback.</p>
<p>The problem continued though, in that <a href="https://infinitedigits.co/tinker/sdcard">different SD cards have different worst-case scenario latency</a>. Even when using the “fast” SDIO protocol, some of the SD cards I tried had worst-case latencies of 10-30 milliseconds! So I had to spend a lot of time finding which SD cards are reasonable to use with this device, and make clear disclaimers against using the “wrong” ones.</p>
<p>The other technical challenge was to create <a href="https://zeptocore.com/tool" target="_blank">the sample download tool</a> in a way that was compatible with the onboard C-libraries. The tool was developed in Go which was nice because it came with pretty easy libraries to write <a href="https://github.com/schollz/_core/blob/main/core/src/zeptocore/zeptocorebinary.go" target="_blank">my own marshal/unmarshal functions</a> that would be compatible with my C struct. Even more complicating, is that in the zeptocore firmware I use bit-packing to reduce the memory usage a little more, but since that varies between compilers there is an intermediate unmarshaling inside the zeptocore to take the save data and <a href="https://github.com/schollz/_core/blob/main/lib/savefile.h" target="_blank">unpack it into the bitpacked structs</a>.</p>
<h2 id="the-release">the release</h2>
<p>After two dozen revisions, and months and months of firmware, I am so happy to finally “release” the zeptocore into the wild. Its certainly a fun device - I would spent hours playing with it when I was supposed to be programming it.</p>

<p>
  <iframe src="https://www.youtube.com/embed/AVurAVEAFNo" allowfullscreen="" title="YouTube Video"></iframe>
</p>

<p>I hope that others can find joy in it too.</p>
<p>There are now a couple of vendors to purchase:</p>
<ul>
<li>my website at <a href="https://zeptocore.com" target="_blank">zeptocore.com</a></li>
<li><a href="https://www.thonk.co.uk/shop/infinite-digits-zeptocore/" target="_blank">Thonk</a> (most convenient for EU customers)</li>
<li><a href="https://www.perfectcircuit.com/infinitedigits-zeptocore.html" target="_blank">Perfect Circuit</a></li>
</ul>





            </div></div>
  </body>
</html>
