<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://silly.business/blog/capturing-diffs-in-my-journal-with-org-mode/">Original</a>
    <h1>Capturing Diffs in My Journal with Org Mode</h1>
    
    <div id="readability-page-1" class="page"><div>
  <p>
I deal with a number of long-running projects in my day-to-day, so I like to keep an <a href="https://orgmode.org">Org Mode</a> file for each project, and whenever I work on a project I add a headline to the Org file with the day&#39;s date and a little explanation of what was going on, eg</p>
<div>
<div><pre tabindex="0"><code data-lang="org"><span><span>*<span> &lt;2025-10-11 Sat&gt; developed the query to do the thing</span></span></span></code></pre></div>
</div>
<p>
I have always been terrible at keeping a journal, so one thing I like to do is actually develop in a code block underneath the headline, executing the code with <code>C-c C-c</code> in lieu of a REPL or an edit-save-execute loop with a file, so that when I have a working version, I also have a copy in my notes. That way, I don&#39;t forget to leave an update in the journal when I finish a task.</p>
<p>
This works well when working with a database, using a method <a href="https://gitlab.com/ryanprior/emacs-org-data-starter">similar to the one Ryan Prior outlines here</a> for data analysis or development of queries/schema, or with command-line tools. For me it simultaneously replaces tools like Postman and <code>psql</code> with the added benefit of record keeping with no extra effort.</p>
<p>
It&#39;s very nice to be able to start writing a code block, using a snippet of course, so typing <code>&lt;src TAB</code> expands to <code>#+begin_SRC</code> and <code>#+END_SRC</code>, develop an API call or some other command. Each time I press <code>C-c C-c</code> the result is rewritten, and then when I&#39;m finished, have a little example saved with both the command and its output, which will look something like this:</p>
<div>
<div><pre tabindex="0"><code data-lang="org"><span><span><span>#+begin_src </span><span>fish</span><span> :results output
</span></span></span><span><span><span></span>  <span>whois</span> <span>1</span>.<span>1</span>.<span>1</span>.<span>1</span> <span>|</span> <span>head</span> <span>-n</span> <span>5</span>
</span></span><span><span><span>#+end_src</span>
</span></span><span><span>
</span></span><span><span><span>#+RESULTS</span><span>:</span>
</span></span><span><span>: % [whois.apnic.net]
</span></span><span><span>: % Whois data copyright terms    http://www.apnic.net/db/dbcopyright.html
</span></span><span><span>: 
</span></span><span><span>: % Information related to &#39;1.1.1.0 - 1.1.1.255&#39;
</span></span><span><span>:</span></span></code></pre></div>
</div>
<p>
I find this to be super useful because I don&#39;t have to copy-paste the output to my journal to remember to save it. When I&#39;m done developing the code in the source block, I&#39;m finished and there&#39;s no extra step to copy it into my notes; it&#39;s already there. In some cases I can even go ahead and <code>:tangle</code> the code to wherever it needs to go, and then all I have to do is go check it in, and it is copied into both my journal and the final location.</p>
<p>
However, I haven&#39;t been able to figure out a good workflow for recording work in my journal when the task involves many small edits in different files, as in normal software development, in contrast to <a href="https://silly.business/blog/the-literate-self-hoster">operational tasks</a> or data analysis. In this case, it still makes sense to edit in-place. It&#39;s just more ergonomic.</p>
<p>
Nonetheless, every so often I would like to capture what I&#39;ve been doing in my notes. It recently occurred to me that Org still makes this relatively easy, by letting me generate diffs to display in-line in the document. That way I can see how specific pieces of code appeared a certain period of time, and comment if I want.</p>
<p>
I can do this by defining a code block that runs <code>git</code> in the project working directory and record a diff into my notes:</p>
<p>
 <img src="https://silly.business/blog/capturing-diffs-in-my-journal-with-org-mode/Screenshot_20251011.png" alt="Screenshot_20251011.png" title="Screenshot_20251011.png"/></p>
<p>
The only quirk is that if I edit the diff with <code>org-edit-src-code</code> it gets indented, breaking the highlighting ðŸ˜¢ but since it&#39;s output I probably won&#39;t be editing it, anyway, so it shouldn&#39;t matter very much. Maybe after I publish this post, someone will send me an email and tell me how to address this quirk.</p>
<p>
In any case, this is really handy as a way to grab a snapshot of some change that I&#39;ve made, and it&#39;s handy that the tool isn&#39;t prescriptive about how the diff is generated, but also allows me to record how I generated the diff.</p>
<p>
For those who are new to Org, I want to describe the different options used in this example, because at first glance this seems like a lot of typing. Org blocks (the things that begin with <code>#+begin_</code>) take special options called &#34;header arguments&#34; that can be specified using a <code>:key value</code> pattern on the same line as <code>#+begin_</code>, so here I have a <code>#+begin_src</code> block of type <code>fish</code> where I specified:</p>
<ol>
<li><code>:results output</code> so that Org inserts the raw output from the command instead of interpreting it as a table, which is the default, and</li>
<li><code>:dir</code> which tells Org which directory the code block should be executed in</li>
<li><code>:wrap source diff</code> which tells Org to put <code>#+begin_src diff</code> before the result and <code>#+end_src</code> after it. The <code>wrap</code> directive is what tells Emacs to render the output as a diff when displaying it in the Org buffer.</li>
</ol>
<p>Then when I press <code>C-c C-c</code> to call <code>org-babel-execute-src-block</code> on the source code under the cursor, the diff is automatically updated using the command defined and rendered as a diff by Emacs inline with the rest of my notes.</p>
<p>
Very, very cool, Emacs.</p>
<p>
To avoid typing these options in every code block, the header arguments can be specified as shown for each Org Babel block, or for a specific sub-tree (using a &#34;<code>:PROPERTIES:</code> drawer&#34;) or for the entire file (using <code>#+PROPERTY:</code> directives), and there&#39;s probably a way to do with through <code>.dir-locals.el</code> too, if you wanted to do it for a whole project. However, I will leave this as an exercise for the reader, as this post is long enough as is. ðŸ‘‹</p>

</div></div>
  </body>
</html>
