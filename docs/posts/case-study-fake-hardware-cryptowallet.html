<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.kaspersky.com/blog/fake-trezor-hardware-crypto-wallet/48155/">Original</a>
    <h1>Case study: fake hardware cryptowallet</h1>
    
    <div id="readability-page-1" class="page"><div>
					<div>
						<div>
							<p>Easy to steal and cash out, сryptocurrency is one of the <a href="https://www.kaspersky.com/blog/4-key-steps-to-protect-cryptocurrency-properly/47811/" target="_blank" rel="noopener">most attractive digital assets for attackers</a>. Accordingly, serious investors often use hardware cryptowallets to protect their crypto-investments. Such a wallet stores private keys away from vulnerable computers and smartphones and makes it much safer to sign transactions. But unfortunately, owning a hardware wallet <a href="https://www.kaspersky.com/blog/five-threats-hardware-crypto-wallets/47971/" target="_blank" rel="noopener">doesn’t guarantee the safety of your funds</a>, as one of our clients has learned the hard way.</p>
<h2>Hack symptoms</h2>
<p>Attackers worked stealthily: on a fateful day in the transaction history of a cryptowallet there appeared an operation in which a large sum of money was transferred to someone else. However, no transactions were performed on that day by the victim at all. Moreover, the cryptowallet wasn’t even plugged into a computer!</p>
<div id="attachment_48159"><p><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/92/2023/05/10060231/fake-trezor-hardware-crypto-wallet-01.png"><img aria-describedby="caption-attachment-48159" decoding="async" src="https://media.kasperskydaily.com/wp-content/uploads/sites/92/2023/05/10060231/fake-trezor-hardware-crypto-wallet-01.png" alt="Aaand… It&#39;s gone!" width="1630" height="1272"/></a></p><p id="caption-attachment-48159">Aaand… It’s gone!</p></div>
<h2>Dissecting the wallet</h2>
<p>The victim had purchased the rather popular hardware wallet <strong>Trezor Model T</strong>. It uses fully open-source code — both software and hardware-wise — and is based on the popular STM32F427 microcontroller.</p>
<p>The Trezor Model T vendor has undertaken a wide range security measures that, in theory, should reliably protect the device from attackers. Both the box and the unit housing are sealed with holographic stickers, the microcontroller is in flash memory read-out protection mode (RDP 2). The bootloader checks the digital signature of the firmware and, if an anomaly is detected, displays an unoriginal firmware message and deletes all the data in the wallet. Accessing the device and confirming transactions require a PIN code that — even though it doesn’t protect the master access key (a base for generating the mnemonic seed phrase) — is used to encrypt the storage where it’s kept. Optionally, in addition to the PIN, you can protect your master access key with a password as per the BIP-39 standard.</p>
<div id="attachment_48156"><p><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/92/2023/05/10060226/fake-trezor-hardware-crypto-wallet-02.jpg"><img aria-describedby="caption-attachment-48156" decoding="async" src="https://media.kasperskydaily.com/wp-content/uploads/sites/92/2023/05/10060226/fake-trezor-hardware-crypto-wallet-02.jpg" alt="Do not use me, I am unsafe!" width="545" height="665"/></a></p><p id="caption-attachment-48156">Do not use me, I am unsafe! (<a href="https://www.reddit.com/r/TREZOR/comments/to2e6h/the_most_insane_is_it_genuine_procedure/" target="_blank" rel="nofollow noopener">Source</a>)</p></div>
<p>At first cursory glance, the wallet we examined appeared to be exactly the same as a genuine one, and showed no signs of tampering. The unit was bought from a trusted seller through a popular classifieds website, and the holographic stickers on the box and the wallet itself were all present and undamaged. When started-up in update mode, the wallet displayed firmware version 2.4.3 and bootloader version 2.0.4.</p>
<div id="attachment_48160"><p><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/92/2023/05/10060228/fake-trezor-hardware-crypto-wallet-03.jpg"><img aria-describedby="caption-attachment-48160" decoding="async" src="https://media.kasperskydaily.com/wp-content/uploads/sites/92/2023/05/10060228/fake-trezor-hardware-crypto-wallet-03.jpg" alt="Fake wallet update mode screen" width="807" height="1024"/></a></p><p id="caption-attachment-48160">Fake wallet update mode screen</p></div>
<p>When handling the wallet, nothing felt suspicious either: all the functions worked as they should, and the user interface was no different from the original one. However, mindful of the theft that had occurred via it, we delved deeper. And that’s where our interesting discoveries began.</p>
<p>Right off the bat, we found that the vendor had never released bootloader version 2.0.4. The project change history at GitHub concisely states that this version was “skipped due to fake devices”. After such an intriguing statement, we just had to reach for the scalpel and begin our dissection, of course…</p>
<div id="attachment_48157"><p><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/92/2023/05/10060229/fake-trezor-hardware-crypto-wallet-04.png"><img aria-describedby="caption-attachment-48157" decoding="async" src="https://media.kasperskydaily.com/wp-content/uploads/sites/92/2023/05/10060229/fake-trezor-hardware-crypto-wallet-04.png" alt="What on earth is version 2.0.4?" width="1248" height="752"/></a></p><p id="caption-attachment-48157">What on earth is version 2.0.4?</p></div>
<p>The housing was difficult to open: its two halves were held together with liberal quantities of glue and double-sided adhesive tape instead of the ultrasonic bonding used on factory-made Trezors. Even more curiously, inside there was an entirely different microcontroller showing traces of soldering! Instead of the original STM32F427, the unit had an STM32F429 with fully deactivated microcontroller flash-memory read-out protection mechanisms (RDP 0 instead of RDP 2 in genuine Trezors).</p>
<div id="attachment_48161"><p><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/92/2023/05/10060230/fake-trezor-hardware-crypto-wallet-05.jpg"><img aria-describedby="caption-attachment-48161" decoding="async" src="https://media.kasperskydaily.com/wp-content/uploads/sites/92/2023/05/10060230/fake-trezor-hardware-crypto-wallet-05.jpg" alt="It looked perfectly genuine from the outside; however… (left — original, right — fake)" width="1507" height="1023"/></a></p><p id="caption-attachment-48161">It looked perfectly genuine from the outside; however… (left — original, right — fake)</p></div>
<p>Thus, the fake cryptowallet theory was proved true: it was a classic supply-chain attack in which an unsuspecting victim buys an already-hacked device. But the actual cryptocurrency stealing mechanism was still unclear…</p>
<h2>Trojan firmware</h2>
<p>We won’t repeat the commonplace truths about cryptowallets that we <a href="https://www.kaspersky.com/blog/five-threats-hardware-crypto-wallets/47971/" target="_blank" rel="noopener">covered earlier</a>, but we’ve just one little reminder for you: a cryptowallet contains your private key, and whoever knows that key can sign any transaction and spend your money. The fact that the attackers were able to conduct a transaction while the offline wallet was stashed in its owner’s strongbox means that they either copied the private key after it was generated, or… they knew it all along!</p>
<p>Thanks to the deactivated flash-memory read-out protection, which our attackers decided not to turn on after the new microcontroller was soldered in, we easily extracted the wallet firmware and, by reconstructing its code, discovered that the attackers indeed knew the private key in advance. But how?</p>
<p>The original bootloader and wallet firmware received only three modifications:</p>
<p><em>First</em>, the bootloader-checks for protection mechanisms and digital signatures were removed, thus getting rid of the “red screen” problem during the firmware originality check at startup.</p>
<p><em>Second</em>, at the initialization stage or when resetting the wallet, the randomly generated seed phrase was replaced with one of 20 pre-generated seed phrases saved in the hacked firmware. The owner would begin using it instead of a new and unique one.</p>
<p><em>Third</em>, if the user chose to set an additional master-seed protection password, only its first symbol (<em>a…z</em>, <em>A…Z</em>, <em>0…9</em> or <em>!</em> for any special character) was used, which, together with the no-password option, gave just 64 possible combinations. Thus, to crack a given fake wallet, only 64*20=1280 variants were to be considered.</p>
<p>The fake cryptowallet would operate as normal, but the attackers had full control over it from the very beginning. According to the transaction history, they were in no hurry, waiting a whole month after the wallet was credited for the first time before they grabbed the money. The owner had no protection whatsoever: the game was lost from the very moment the money first arrived in the Trojan wallet.</p>
<h2>How to prevent the fake device threat</h2>
<p>It’s not easy to tell a fake cryptowallet from a real one without special knowledge and experience. The main safeguard is to buy your wallet <strong>directly from the official vendor</strong> and choose models with special versions of protected microcontrollers (even original Trezors aren’t ideal in this sense: there are other brands’ wallets with better protected chips and extra protection mechanisms).</p>
<p>It should be remembered that even an authentic and unmodified wallet can be vulnerable to <a href="https://www.kaspersky.com/blog/five-threats-hardware-crypto-wallets/47971/" target="_blank" rel="noopener">a number of threats</a>. The priority measures include the use of a password (if supported by your wallet), and, of course, <a href="https://www.kaspersky.com/premium?reseller=gl_bb2023-kdplacehd_acq_ona_smm__onl_b2c_kdaily_lnk_sm-team___kprem___" target="_blank">protection for all computers and smartphones</a>.</p>

						</div>
					</div>
				</div></div>
  </body>
</html>
