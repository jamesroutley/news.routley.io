<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://virtuallyfun.com/2023/07/01/64bit-computing-on-a-budget/">Original</a>
    <h1>64bit computing on a budget</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>With all that <a href="https://virtuallyfun.com/2023/05/15/windows-2000-64-bit-for-alpha-axp/">Dec Alpha talk</a>, and how hard it is to get hardware, and how seemingly exclusionary it is, I thought I would try to touch on a more available 64bit ‘risc’ platform, for the masses!</p>
<p>While a couple years ago I had touched on running <a rel="noreferrer noopener" href="https://virtuallyfun.com/2020/07/24/windows-10-on-the-raspberry-pi-4/" data-type="URL" data-id="/2020/07/24/windows-10-on-the-raspberry-pi-4/" target="_blank">Windows 10 on the Raspberry Pi 4</a>, in the brave new world of 2023 getting ahold of a pi4 is expensive, hard to find, and kind of depressive, which lead me to this (old) but exciting project, the <a href="https://renegade-project.tech/en/home" target="_blank" rel="noreferrer noopener">Renegade Project</a>!</p>
<p>Long story short, there exists enough drivers &amp; information to facilitate a port to the Snapdragon 845, a 64bit System On a Chip( SOAC!), meaning that if you have a device with this chip it *can* be slightly possible to install Windows 10 onto it.</p>
<figure><a href="https://renegade-project.tech/en/state"><img decoding="async" width="921" height="428" src="https://virtuallyfun.com/wp-content/uploads/2023/07/renegade-system-matrix.png" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/renegade-system-matrix.png 921w, http://virtuallyfun.com/wp-content/uploads/2023/07/renegade-system-matrix-300x139.png 300w, http://virtuallyfun.com/wp-content/uploads/2023/07/renegade-system-matrix-768x357.png 768w, http://virtuallyfun.com/wp-content/uploads/2023/07/renegade-system-matrix-500x232.png 500w" sizes="(max-width: 921px) 100vw, 921px"/></a><figcaption>system compatibility matrix, for ants.</figcaption></figure>
<p>Glancing at the system matrix, to me the glaring hole is Charging. 3 systems outright support it, all of them from Xiaomi, the <a href="https://renegade-project.tech/en/devices/xiaomi/polaris">Xiaomi Mix 2s</a>, Xiaomi Mix 3 &amp; the <a href="https://renegade-project.tech/en/devices/xiaomi/beryllium">Xiaomi PocoPhone F1</a>. Looking around eBay to start this adventure I found a PocoPhone F1!</p>
<h2>Getting the Phone</h2>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-ebay-listing.png"><img decoding="async" loading="lazy" width="901" height="431" src="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-ebay-listing.png" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-ebay-listing.png 901w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-ebay-listing-300x144.png 300w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-ebay-listing-768x367.png 768w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-ebay-listing-500x239.png 500w" sizes="(max-width: 901px) 100vw, 901px"/></a></figure>
<p>This seemed like a good start, 29.99, 128GB of flash storage, and I’d later learn 6GB of RAM. The first problem came from Xiaomi. Turns out that the phone was still locked, the seller had neglected to logout from his Xiaomi account. Even worse though he had forgotten his login and password. Calling Xiaomi support was basically worthless. Without unlocking the phone on a reset to root the phone lead me to this:</p>
<div>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/locked-pocophone2.jpg"><img decoding="async" loading="lazy" width="384" height="512" src="https://virtuallyfun.com/wp-content/uploads/2023/07/locked-pocophone2.jpg" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/locked-pocophone2.jpg 384w, http://virtuallyfun.com/wp-content/uploads/2023/07/locked-pocophone2-225x300.jpg 225w" sizes="(max-width: 384px) 100vw, 384px"/></a><figcaption>Locked!</figcaption></figure></div>
<p>I got lucky however after talking to the seller, he agreed to go above and beyond and we were able to unlock the phone together. So everything went well. If you do buy one of these phones used, MAKE SURE TO CHECK THE XIOAMI login id! It has to be unlocked and blank so you can register it and get the unlock. It will require a valid email &amp; phone number + sim for it to send/receive SMS codes.</p>
<p>Access to the site is very up &amp; down, so I archived what <a rel="noreferrer noopener" href="https://archive.org/details/miflash_unlock_en_7.6.602.42" target="_blank">I had downloaded to unlock the phone here</a>. <a href="https://archive.org/details/miflash_unlock_en_7.6.602.42" target="_blank" rel="noreferrer noopener">miflash_unlock_en_7.6.602.42.7z</a></p>
<p>I should add that we’ve cleared the first few hurdles of precuring the device and unlocking it. And I’m glossing over stuff. Getting to this point was not easy and took a week. The unlock process is not intuitive, and I’m sure many phones are sold out there that have their google access wiped, but have not been logged out all the way, or the flash erased. I can’t show you mine as I ended up erasing Android but be aware of this!</p>
<h2>Getting ready for Windows</h2>
<p>Basically on the Android side there is three main modes, the boot, the recovery and the ‘fastboot’ mode. Holding power &amp; down brings you to fastboot, where using the fastboot tool you can load an image from your PC into ram and execute it. <a href="https://github.com/edk2-porting/edk2-msm" target="_blank" rel="noreferrer noopener">EDK2 UEFI firmware</a>, is the first part or the renegade project you’ll encouter. It’s really powerful, allowing you to not only boot into Windows, but it also supports a linux disk target mode, allowing you to partition and access the flash directly from a PC. Naturally this is SUPER dangerous, and <a href="https://archive.org/details/pocophone-f1-modem-files" target="_blank" rel="noreferrer noopener">backup your modem files</a>!</p>
<p>With the phone unlocked softbooting E2DK you can put it into a target disk mode, connect it to a pc and partition away!</p>
<div>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/disk-host-mode-reduced.jpg"><img decoding="async" loading="lazy" width="467" height="865" src="https://virtuallyfun.com/wp-content/uploads/2023/07/disk-host-mode-reduced.jpg" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/disk-host-mode-reduced.jpg 467w, http://virtuallyfun.com/wp-content/uploads/2023/07/disk-host-mode-reduced-162x300.jpg 162w" sizes="(max-width: 467px) 100vw, 467px"/></a><figcaption>disk mode… for ants!</figcaption></figure></div>
<p><a rel="noreferrer noopener" href="https://renegade-project.tech/en/install" target="_blank">The guide</a> (section 1.2) advices pushing the disk tools to the phone booted up in <a rel="noreferrer noopener" href="https://archive.org/download/miflash_unlock_en_7.6.602.42/twrp-3.7.0_9-0-beryllium.img" target="_blank">twrp-3.7.0_9-0-beryllium.img</a>. Honestly its easier to just partition it on your computer. HOWEVER if you were to use Windows, there is a slight issue:</p>
<p><strong><span>The device may no longer be able to boot into fastboot mode</span></strong></p>
<p>I ran into this issue and thought I had bricked my phone. I was actually in the middle of researching how to do a physical hard reset, <a href="https://www.youtube.com/watch?v=IlAaRQBtHKw" target="_blank" rel="noreferrer noopener">and place it into EDL mode</a> (taking it apart and finding which pads to short, when I found this section of the troubleshooting guide, where it’s the partition names. So instead, I ended up doing the partitioning on a Virtual Machine using VMware and Ubuntu.</p>
<pre><code>(parted) print
print
Model: SAMSUNG KLUDG4U1EA-B0C1 (scsi)
Disk /dev/block/sda: 123GB
Sector size (logical/physical): 4096B/4096B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name        Flags
 1      24.6kB  41.0kB  16.4kB               switch
 2      41.0kB  73.7kB  32.8kB               ssd
 3      73.7kB  524kB   451kB                bk01
 4      524kB   786kB   262kB                bk02
 5      786kB   1049kB  262kB                bk03
 6      1049kB  1573kB  524kB                keystore
 7      1573kB  2097kB  524kB                frp
 8      2097kB  4194kB  2097kB               bk04
 9      4194kB  8389kB  4194kB               misc
10      8389kB  16.8MB  8389kB               logfs
11      16.8MB  33.6MB  16.8MB               oops
12      33.6MB  50.3MB  16.8MB               devinfo
13      50.3MB  67.1MB  16.8MB               bk05
14      67.1MB  134MB   67.1MB  ext4         persist
15      134MB   201MB   67.1MB  ext4         persistbak
16      201MB   268MB   67.1MB               logdump
17      268MB   403MB   134MB                minidump
18      403MB   1275MB  872MB   ext4         cust
19      1275MB  1342MB  67.1MB               recovery
20      1342MB  1611MB  268MB   ext4         cache
21      1611MB  123GB   121GB                userdata</code></pre>
<p>Before I did anything, this is what the phone partition table looked like. It’s an exceptional amount. The new parted v 3.0 that is recommended to use, doesn’t support the resize command so I had to manually do the numbers after destroying partition 21.</p>
<p>Originally, I had made a 32Gb partition to keep some Android functionality but somewhere it just stopped booting. But I didn’t care.</p>
<pre><code>rm 21
mkpart userdata ext4 1611MB 32G
mkpart esp fat32 32G 32.5G
set 22 esp on
mkpart win ntfs 32.5GB 123G

21      1611MB  32.0GB  30.4GB  ext4         userdata
22      32.0GB  32.5GB  499MB   fat32        esp         boot, esp
23      32.5GB  123GB   90.5GB  ntfs         win         msftdata</code></pre>
<p>Obviously dont follow this. I’m only providing output as an example.</p>
<p>If I were more patient, I guess I would have dd’d the entire phone to get a full entire backup. But I didn’t get this phone to run Android, so I really don’t care.</p>
<p>There is a LOT of disks being presented to Windows, in case you ever wondered how those 128GB flash devices get sold with only 114GB of user space. </p>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-disk-partitions.png"><img decoding="async" loading="lazy" width="887" height="108" src="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-disk-partitions.png" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-disk-partitions.png 887w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-disk-partitions-300x37.png 300w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-disk-partitions-768x94.png 768w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-disk-partitions-500x61.png 500w" sizes="(max-width: 887px) 100vw, 887px"/></a><figcaption>So many partitions!</figcaption></figure>
<p>And even that 112GB is actually usable!</p>
<p>Remember the system partition needs the boot,esp flags, and the windows partition is msftdata. Also make sure the partition names are either single words, or NO words. Spaces will kill the fastboot mode.</p>
<p>I put all the disks that are presented in offline mode, so I don’t get confused. Make sure you are going to mess with the right volumes when formatting after the partitioning. This is NOT for the novice, it would be easy to not only brick the phone but screw up your existing install. If you have physical disks attached you don’t absolutely need, remove them or put them offline to make sure you don’t screw up.</p>
<p>I used diskpart to select the appropriate volumes and format them.</p>
<pre><code>select disk 8
select volume 5
format quick fs=fat32 label=&#34;System&#34;
assign letter=&#34;S&#34;
select volume 6
format quick fs=ntfs label=&#34;Windows&#34;
assign letter=&#34;W&#34;</code></pre>
<p>This isn’t a guide, just a reflection of what I went through.</p>
<p>With the disk now formatted, it’s a matter of selecting an OS to install.</p>
<p>I had really bad luck picking random versions of Windows, so I looked until I could find a confirmed working version in this video, <a rel="noreferrer noopener" href="https://www.youtube.com/watch?v=t81-Ji17fGM" target="_blank">Rodando o Windows 10 ARM nativamente em um Dispositivo Android (Pocophone F1 + UEFI)</a>. Long story short, it’s Windows build 210521-1658 with version <a rel="noreferrer noopener" href="https://github.com/edk2-porting/edk2-msm/releases/tag/v0.4" target="_blank">0.4 of the bootloader</a>. Long story short I messed with LOTS of Windows on ARM driver sets, before I finally had the brave idea to just load it with no drivers:</p>
<div>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-booted-to-windows.jpg"><img decoding="async" loading="lazy" width="491" height="945" src="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-booted-to-windows.jpg" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-booted-to-windows.jpg 491w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-booted-to-windows-156x300.jpg 156w" sizes="(max-width: 491px) 100vw, 491px"/></a><figcaption>booted</figcaption></figure></div>
<p>But that image is far too stale, and expires out very quickly, reducing any useful functionality once it’s connected to the internet. So it’s something that probably could be fixed, but it’s far easier to just grab an image that’s newer.</p>
<p>The x86_64 image I’m using now is 19045.3031, so I guessed to pick something comparable on ARM64. I used something called <a href="https://archive.org/details/19045.3031_arm64_en-us_professional" target="_blank" rel="noreferrer noopener">19045.3031_arm64_en-us_professional</a>, although it too was out of date, but Windows update brought it up to 22H2 19045.3086 . I had tried the downloader tool and apply all the updates offline, but I had issues. I suspect now in retrospect it was drivers.</p>
<p>Another thing I learned the hard way is that some of these images have multiple OS images installed. I guess it’s de-duplication, along with compression, but be sure to index the image first! I accidentally installed a Home version. Yuck.</p>
<pre><code>dism /Get-ImageInfo /imagefile:install.wim

Index : 1
Name : Windows 10 Home
Description : Windows 10 Home
Size : 17,706,743,995 bytes

Index : 4
Name : Windows 10 Pro
Description : Windows 10 Pro
Size : 17,836,320,420 bytes</code></pre>
<p>So just don’t go wildly apply image #1. I wasted too much time on that one.</p>
<p>But in the release I’m using it’s image #1. I checked. Trust me.</p>
<pre><code>dism /apply-image /ImageFile:10.0.21390.1.co_release.210521-1658_arm64fre\install.wim /index:4 /ApplyDir:W:\</code></pre>
<p>The S volume needs to be populated with the UEFI boot files. I had foolishly thought the boot.wim file would include the boot files, but instead bcdboot can set it up based on the location of a Windows install.</p>
<pre><code>bcdboot W:\Windows /s S: /f UEFI</code></pre>
<p>The next thing to do is install the drivers.</p>
<p>I was lucky enough to get some insight into some driver combination to work, and I came up with this much:</p>
<pre>minimal 2210.1-fix
USB beryllium v2.0rc2
FG beryllium v2.0rc2</pre>
<p>The key of course is that there is a minimal set in 2210.1-fix that will bring the system up with working USB. The FG package brings in enough of the power management to know the battery status.</p>
<pre><code>dism /Image:W: /Add-Driver /Driver:drivers /Recurse</code></pre>
<p>The drivers are not signed, so that means we need to change a bunch of boot flags. I also turned on debugging so have Windows dump core files, so you can run analysts on them with <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-tools" target="_blank" rel="noreferrer noopener">Windgb</a>.</p>
<pre><code>S:
cd S:\EFI\Microsoft\Boot
bcdedit /store BCD /set &#34;{default}&#34; testsigning on
bcdedit /store BCD /set &#34;{default}&#34; nointegritychecks on
bcdedit /store BCD /set &#34;{default}&#34; recoveryenabled no
bcdedit /store BCD /set &#34;{default}&#34; debug on</code></pre>
<p>Of course the catch being that with no drivers loaded it’s in a super basic mode, with no USB, no touch screen, no power management, no wifi no nothing. So it’s a brick. But at least we’ve reproduced enough to show that you can boot Windows.</p>
<p>Sadly, loading all the drives from <a href="https://github.com/edk2-porting/WOA-Drivers/releases/tag/2210.1-fix" target="_blank" rel="noreferrer noopener">2210.1-fix</a> or beryllium <a href="https://github.com/edk2-porting/WOA-Drivers/releases/tag/v2.0rc2" target="_blank" rel="noreferrer noopener">v2.0rc2</a> lead to this:</p>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-crashed.jpg"><img decoding="async" loading="lazy" width="567" height="408" src="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-crashed.jpg" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-crashed.jpg 567w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-crashed-300x216.jpg 300w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-crashed-417x300.jpg 417w" sizes="(max-width: 567px) 100vw, 567px"/></a><figcaption>the cracked glass adds to the feeling.</figcaption></figure>
<p>Add in a much needed OTG adapter and a mouse or keyboard, and you can complete the installation. </p>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-Surface-scaled-1.jpg"><img decoding="async" loading="lazy" width="592" height="546" src="https://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-Surface-scaled-1.jpg" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-Surface-scaled-1.jpg 592w, http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-Surface-scaled-1-300x277.jpg 300w, http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-Surface-scaled-1-325x300.jpg 325w" sizes="(max-width: 592px) 100vw, 592px"/></a></figure>
<p>However, since I left off the majority of the device drivers as I didn’t want to spend forever trying to track it down, I used a random USB to Ethernet adapter and thankfully It just worked!</p>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone.png"><img decoding="async" loading="lazy" width="1024" height="597" src="https://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone-1024x597.png" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone-1024x597.png 1024w, http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone-300x175.png 300w, http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone-768x448.png 768w, http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone-500x292.png 500w, http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone.png 1282w" sizes="(max-width: 1024px) 100vw, 1024px"/></a><figcaption>Accessing the phone over RDP.</figcaption></figure>
<p>I added a fancy USB 3.0 ‘dock’ with USB-C connector that you can plug a charger into, so that not only can the phone stay connected to power, but there is room for the Ethernet. It also has HDMI, perhaps is the drivers were more stable, it could be a viable desktop? And I have what I wanted, which was a non Intel/AMD 64bit platform that is hopefully more reliable than the Alpha64 platform, and maybe something to do some kind of contrast of the past vs future</p>
<p>This was NOT a simple thing to go through. I would be extremely hesitant to advise other people to follow suit. But in the off chance anyone who wants to do it, might have a better idea of what is involved.</p>
<p>Read the <a rel="noreferrer noopener" href="https://renegade-project.tech/en/Troubleshooting" target="_blank">Troubleshooting guide</a> &amp; the <a rel="noreferrer noopener" href="https://renegade-project.tech/en/install" target="_blank">Installation guide</a>. Keep notes! I would have absolutely given up, without keeping notes.</p>
<p>Even simple tracking of disasters like this at least helped me along:</p>
<pre><code>210521-1658</code></pre>
<div>
<div>
<pre><code>boot-beryllium Version 0.4.1.img</code></pre>
<pre><code>boot-beryllium-ebbg Release - 2210.1.img</code></pre>
<pre><code>boot-beryllium-ebbg Release - 2210.1.img

boot-beryllium-ebbg Release - 2210.1.img

boot-beryllium-ebbg Release - 2210.1.img

boot-beryllium-ebbg Release - 2210.1.img</code></pre>
</div>
<div>
<pre><code>no drivers</code></pre>
<pre><code>
no drivers</code></pre>
<pre><code>
v1.1.1


v1.1


FocalTechTouch v2.0rc1


v2.0rc1</code></pre>
</div>
<div>
<pre><code>INTERNAL_POWER_ERROR</code></pre>
<pre><code>
installer


SYSTEM THREAD EXCEPTION NOT HANDLED


SYSTEM THREAD EXCEPTION NOT HANDLED

installer


SYSTEM THREAD EXCEPTION NOT HANDLED</code></pre>
</div>
</div>
<p>Sorry the table doesn’t format well.</p>
<p>TL;DR don’t do it, unless you don’t mind spending too much time on this. Get a used Surface X instead.</p>
</div></div>
  </body>
</html>
