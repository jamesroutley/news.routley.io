<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://victorpoughon.github.io/torchlensmaker/">Original</a>
    <h1>Show HN: Torch Lens Maker â€“ Differentiable Geometric Optics in PyTorch</h1>
    
    <div id="readability-page-1" class="page"><div data-v-39a288b8=""><div data-v-39a288b8=""><div><p><img alt="GitHub commit activity" src="https://img.shields.io/github/commit-activity/m/victorpoughon/torchlensmaker?label=commits&amp;color=blue" data-v-d8a5f41e=""/><img alt="Python Version from PEP 621 TOML" src="https://img.shields.io/python/required-version-toml?tomlFilePath=https%3A%2F%2Fraw.githubusercontent.com%2Fvictorpoughon%2Ftorchlensmaker%2Frefs%2Fheads%2Fmain%2Fpyproject.toml&amp;logo=python&amp;logoColor=yellow&amp;color=yellowgreen" data-v-d8a5f41e=""/><img alt="GitHub License" src="https://img.shields.io/github/license/victorpoughon/torchlensmaker?color=gold" data-v-d8a5f41e=""/><img alt="PyPI - Version" src="https://img.shields.io/pypi/v/torchlensmaker" data-v-d8a5f41e=""/><img alt="PyTorch powered" src="https://img.shields.io/badge/PyTorch-powered-red?logo=PyTorch" data-v-d8a5f41e=""/></p><p>Welcome to <strong>Torch Lens Maker</strong>, an open-source Python library for differentiable geometric optics based on <a href="https://pytorch.org/" target="_blank" rel="noreferrer">PyTorch</a>. Currently a very experimental project, the goal is to be able to design complex real-world optical systems (lenses, mirrors, etc.) using modern computer code and state-of-the art numerical optimization.</p><div><p><span>python</span></p><pre tabindex="0"><code><span><span>import</span><span> torchlensmaker </span><span>as</span><span> tlm</span></span>
<span></span>
<span><span>optics </span><span>=</span><span> tlm.Sequential(</span></span>
<span><span>    tlm.ObjectAtInfinity(</span><span>beam_diameter</span><span>=</span><span>10</span><span>, </span><span>angular_size</span><span>=</span><span>20</span><span>),</span></span>
<span><span>    tlm.Gap(</span><span>15</span><span>),</span></span>
<span><span>    tlm.RefractiveSurface(tlm.Sphere(</span><span>diameter</span><span>=</span><span>25</span><span>, </span><span>R</span><span>=-</span><span>45.0</span><span>), </span><span>material</span><span>=</span><span>&#34;BK7-nd&#34;</span><span>),</span></span>
<span><span>    tlm.Gap(</span><span>3</span><span>),</span></span>
<span><span>    tlm.RefractiveSurface(tlm.Sphere(</span><span>diameter</span><span>=</span><span>25</span><span>, </span><span>R</span><span>=</span><span>tlm.parameter(</span><span>-</span><span>20</span><span>)), </span><span>material</span><span>=</span><span>&#34;air&#34;</span><span>),</span></span>
<span><span>    tlm.Gap(</span><span>100</span><span>),</span></span>
<span><span>    tlm.ImagePlane(</span><span>50</span><span>),</span></span>
<span><span>)</span></span>
<span></span>
<span><span>tlm.optimize(optics, tlm.optim.Adam(optics.parameters(), </span><span>lr</span><span>=</span><span>5e-4</span><span>), {</span><span>&#34;base&#34;</span><span>: </span><span>10</span><span>, </span><span>&#34;object&#34;</span><span>: </span><span>5</span><span>}, </span><span>100</span><span>)</span></span>
<span></span>
<span><span>tlm.show2d(optics, </span><span>title</span><span>=</span><span>&#34;Landscape Lens&#34;</span><span>)</span></span></code></pre></div><p>The core of the project is <em>differentiable geometric optics</em>: 3D collision detection and the laws of optics implemented in <a href="https://pytorch.org/" target="_blank" rel="noreferrer">PyTorch</a>. PyTorch provides world-class automatic differentiation, and access to state-of-the-art numerical optimization algorithms with GPU support.</p><p>The key idea is that there is a strong analogy to be made between layers of a neural network, and optical elements in a so-called <em>sequential</em> optical system. If we have a compound optical system made of a series of lenses, mirrors, etc., we can treat each optical element as the layer of a neural network. The data flowing through this network are not images, sounds, or text, but rays of light. Each layer affects light rays depending on its internal parameters (surface shape, refractive material...) and following the very much nonâ€‘linear Snell&#39;s law. Inference, or the forward model, is the optical simulation where given some input light, we compute the system&#39;s output light. Training, or optimization, is finding the best shapes for lenses to focus light where we wantÂ it.</p><table tabindex="0"><thead><tr><th></th><th><strong>Neural Network</strong></th><th><strong>Optical system</strong></th></tr></thead><tbody><tr><td><strong>Data</strong></td><td>Images, Text, Audio</td><td>Light rays</td></tr><tr><td><strong>Layers</strong></td><td>Conv2d, Linear, ReLU</td><td>Refraction, Reflection, Gap</td></tr><tr><td><strong>Loss Function</strong></td><td>Prediction error to labeled examples</td><td>Focusing error in the image plane</td></tr></tbody></table><p>The magic is that we can pretty much use <code>torch.nn</code> and <code>nn.Module</code> directly, stacking lenses and mirrors as if they were <code>Conv2d</code> and <code>ReLU</code>. Then, pass the whole thing through a standard PyTorch <code>optimize()</code> to find the optimal values for parametric surfaces, and designing lenses is surprisingly like training a neural network! Once this is implemented, you get &#39;for free&#39; the massive power of modern open-source machine learning tooling: automatic differentiation, optimization algorithms, composability, GPU training, distributed training, and more.</p><p>On top of that, after having tried software like <a href="https://build123d.readthedocs.io/en/latest/" target="_blank" rel="noreferrer">build123</a> and <a href="https://openscad.org/" target="_blank" rel="noreferrer">OpenSCAD</a>, I strongly believe that writing code is a very powerful way to design mechanical 3D systems and this project is an exploration of that, but for optical systems.</p><div><p>Experimental project!</p><p>This project is in its very early stages, I&#39;ve got a <a href="https://victorpoughon.github.io/torchlensmaker/roadmap">very long roadmap</a> planned and I&#39;m <a href="https://victorpoughon.github.io/torchlensmaker/about#funding">looking for funding</a> to be able to keep working on it full time! If you can, please consider donating, sponsoring or even hiring me! ðŸ˜ŠðŸ’š</p><p>Also, the API <strong>will</strong> change without warning. A stable release is still very far in the future.</p></div></div></div></div></div>
  </body>
</html>
