<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://dolphin-emu.org/blog/2022/07/07/dolphin-progress-report-may-and-june-2022/">Original</a>
    <h1>Dolphin Progress May and June 2022</h1>
    
    <div id="readability-page-1" class="page"><div>
      <header>
<img src="https://dolphin-emu.org/m/user/blog/progress-report/2022-june/progressreportheader-may2022.jpg"/> 
<img src="https://dolphin-emu.org/m/user/blog/progress-report/2022-june/progressreportheader-may2022mini.jpg"/> 
</header>

<p>It&#39;s been a very hectic two months.  Dolphin&#39;s development builds <a href="https://dolphin-emu.org/blog/2022/06/09/leaving-a-legend/">officially dropped support for Windows 7, Windows 8, and Windows 8.1</a> in <a href="https://dolphin-emu.org/download/dev/master/5.0-16393/">5.0-16393</a> when the Windows buildbots were updated to use Qt6.  If you read the last <a href="https://dolphin-emu.org/blog/2022/05/17/dolphin-progress-report-february-march-and-april-2022/">Progress Report</a>, you&#39;d know that Windows 7 was already on shaky terms due to rampant breakages, but it was Qt6 that finally ended the legacy operating systems. We wrote an entire article about this, so be sure to read that <a href="https://dolphin-emu.org/blog/2022/06/09/leaving-a-legend/">here</a> if you haven&#39;t already.</p>
<p>But with loss, some new has also come.  We now have a new builder for Windows on ARM!  Dolphin has supported Windows on ARM <a href="https://dolphin-emu.org/blog/2020/02/07/dolphin-progress-report-dec-2019-and-jan-2020/#50-11409-platform-support-for-windows-on-arm64-and-50-11455-dolphinqt-support-compiling-on-arm64-by-stenzek">for a couple of years now</a>, but we haven&#39;t provided builds due to a lack of prospective users and a lack of space on the buildbot server.  But times have changed - the buildbot has seen some upgrades with a new, bigger harddisk and <strong><a href="https://github.com/shuffle2">shuffle2</a></strong> has renovated parts of the infrastructure to make supporting Windows ARM64 builds easier.  With those two hurdles out of the way, we&#39;ve now configured our buildbot to provide Windows ARM64 builds on our <a href="https://dolphin-emu.org/download/">Downloads</a> page.  We&#39;re not exactly sure how much use these builds will get, but we&#39;re hopeful for the future of the platform. </p>
<p>But by this point, you&#39;re probably as sick of hearing about the gives and takes of supporting various operating systems as we are of writing about them, so let&#39;s get to some emulation goodness.  We&#39;ve got some highly technical changes, including a new &#34;Graphics Mod&#34; system that allows modders and users to create graphical mods.  If you&#39;re into the <em>edge</em> of emulation, we&#39;ve also seen support for the annoying Datel Loader used for Action Replay discs and a few very odd unlicensed devices without needing an original GameCube BIOS or swapping to DSP-LLE.  This is somewhat significant for reasons we&#39;ll get into later, because using <em>real</em> Action Replay discs does make a difference!</p>
<p>For those who love creative homebrew, we&#39;ve also added support for the homebrew libasnd microcode to HLE audio, meaning that you no longer need to switch to LLE audio for many homebrew titles.  We go into the details of all of this and more on this Dolphin Progress Report!</p>

<h3 id="notable-changes"><strong>Notable Changes</strong><a href="#notable-changes" title="Permanent link">¶</a></h3>
<h4 id="50-16763-add-graphics-mod-infrastructure-by-iwubcode"><strong><a href="https://dolphin-emu.org/download/dev/master/5.0-16763/">5.0-16763 - Add &#39;Graphics Mod&#39; Infrastructure</a></strong>  by <strong><a href="https://github.com/iwubcode">iwubcode</a></strong><a href="#50-16763-add-graphics-mod-infrastructure-by-iwubcode" title="Permanent link">¶</a></h4>
<p>Dolphin&#39;s current suite to modify the graphics of games is quite limited.  All that we have are post processing shaders with no access to depth or any other fancy features.  While things like Texture Packs give some freedom, a lot of players have turned to forks and third party programs in order to make larger graphical overhauls.  This situation is due to the fact that post-processing has a fundamental limitation - it&#39;s done <em>after</em> the frame is rendered. This approach seriously hinders the goal of modifying the game&#39;s visuals. For example, if the game crushes its depth during the rendering process, all post-processing sees is a 2D frame. How are we supposed to apply post-processing effects with depth to this? That exact scenario is sadly extremely common on the GameCube and Wii, and why Dolphin&#39;s post-processing excludes depth - it was so unreliable that we decided it be better to not have it.</p>
<p>While most users are probably waiting for our Post Processing system to be rewritten,  <strong><a href="https://github.com/iwubcode">iwubcode</a></strong> has sneakily been working on a different approach, one that addresses that fundamental limitation in post-processing. The first piece of the puzzle has arrived in the form of a feature called <em>Graphics Mods</em>!</p>
<p>Graphics Mods gives users a way to hook into the game&#39;s rendering pipeline and directly modify game assets during the rendering process. It exists as something inbetween post-processing and game modding - it is specific like game modding, but like post-processing it doesn&#39;t require the daunting task of learning PowerPC assembly to order to create a game patch. Right now, the feature is in its infancy, but it&#39;s already shown a ton of promise in allowing quality of life mods to many games.  </p>
<p>These are composed of two parts: an &#34;action&#34; and a &#34;target&#34; group. The action contains what the mod will do with the target, such as a &#34;skip&#34; to prevent the target from rendering, and can be generic. The target is specific, <em>extremely</em> specific, as it defines the precise texture, texture format or EFB Copy format we wish to modify.  The target group can have a single target or many targets depending on what the modder wants to do.</p>
<p>This may all sound complicated, but in actual application it is extremely simple.  To give an example of what Graphics Mods can do, lets look at <a href="https://wiki.dolphin-emu.org/index.php?title=Super_Mario_Galaxy_2">Super Mario Galaxy 2</a> on Dolphin without enabling any Graphics Mods.</p>


<p>But with the power of &#34;Native Bloom&#34; and &#34;No Bloom&#34; Graphics Mods, we can transform how the game looks by directly changing how the game renders!</p>


<p>The Graphics Mods feature installs hooks into Dolphin&#39;s graphics pipeline. This can have a slight cost to performance, so Graphics Mods must be enabled to be used.</p>
<p>For the feature&#39;s debut, the following titles have Graphics Mods:</p>
<ul>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Arc_Rise_Fantasia">Arc Rise Fantasia</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Battalion_Wars_2">Battalion Wars 2</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Donkey_Kong_Country_Returns">Donkey Kong Country Returns</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Fragile_Dreams:_Farewell_Ruins_of_the_Moon">Fragile Dreams - Farewell Ruins of the Moon</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=House_of_the_Dead:_Overkill">The House of the Dead: Overkill</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=The_Last_Story">The Last Story</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Link%27s_Crossbow_Training">Link&#39;s Crossbow Training</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Little_King%27s_Story">Little King&#39;s Story</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Mario_Kart_Wii">Mario Kart Wii</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Monster_Hunter_Tri">Monster Hunter Tri</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Nights:_Journey_of_Dreams">Nights: Journey Into Dreams</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=%C5%8Ckami">Okami</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Super_Mario_Galaxy_2">Super Mario Galaxy 2</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Mario_Strikers_Charged">Mario Strikers: Charged</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=The_Conduit">The Conduit</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=The_Legend_of_Zelda:_Twilight_Princess_(Wii)">The Legend of Zelda: Twilight Princess</a></strong> - Wii version only currently</li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=The_Legend_of_Zelda:_Skyward_Sword">The Legend of Zelda: Skyward Sword</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Wii_Play">Wii Play</a></strong></li>
<li><strong><a href="https://wiki.dolphin-emu.org/index.php?title=Xenoblade_Chronicles">Xenoblade Chronicles</a></strong></li>
</ul>
<p>These mods mostly consist of Bloom definitions, with a few games having definitions for removing GUI elements.  However, Graphics Mods aren&#39;t limited to just generic operations like that, they have a set of actions that can be defined to create a multitude of effects, and users are encouraged to create their own Graphics Mods through the actions available.</p>
<ul>
<li><strong>Skip</strong>:  Allows the modder to skip rendering this target group.</li>
<li><strong>Scale</strong>:  Allows the user to scale/stretch a target group.</li>
<li><strong>Move</strong>:  Allows a user to move a particular target group.</li>
</ul>
<p>However, we cannot stress enough that the system is still very early in this initial release and there is a chance that some textures and effects may be reused for multiple things.   An example of this is Depth of Field and Bloom sometimes using the same efb copy format, meaning that changing one without changing the other may prove difficult in certain games.</p>


<p>If you&#39;re interested in creating your own Graphics Mods, we&#39;ll be maintaining <a href="https://wiki.dolphin-emu.org/index.php?title=Graphics_Mods">a Graphics Mod guide on the Dolphin Wiki</a> that should stay up to date as the feature evolves.</p>
<p><strong>Future Plans</strong></p>
<p><strong><a href="https://github.com/iwubcode">iwubcode</a></strong> has many grand plans to renovate Dolphin&#39;s ability to enhance graphics.  From post-processing to Graphics Mods, they&#39;ve got <em>a lot</em> up the pipeline.  But if anything was going to get merged, that meant breaking down their projects into smaller pieces.  This is just a <em>taste</em> of what Graphics Mods can do, and we can promise that there is more coming in the future.  This is a massive undertaking being powered by a single person, so for now things are very barebones on purpose.  It was a necessary evil to scale things back so that the system itself could be reviewed and merged.</p>
<p>One issue is Android.  While there is nothing stopping Graphics Mods from working on Android, at this point it has not been implemented into the Android GUI.  The Android GUI is a bit of a pain to develop for, and not every developer has an interest in dealing with the JNI parts of Dolphin.  In fact, no one <em>wants</em> to do it, it&#39;s just that some end up <em>having</em> to do it.</p>
<p>As this feature sees more use, we hope to include more Graphics Mods across many titles in Dolphin.  If any other creators want to submit their Graphics Mods to be available in the emulator, they can be submitted as Pull Requests.</p>
<h4 id="50-16448-fix-some-dual-core-full-screen-panic-alert-deadlocks-by-josjuice"><strong><a href="https://dolphin-emu.org/download/dev/master/5.0-16448/">5.0-16448 - Fix Some Dual Core + Full Screen + Panic Alert Deadlocks</a></strong>  by <strong><a href="https://github.com/JosJuice">JosJuice</a></strong><a href="#50-16448-fix-some-dual-core-full-screen-panic-alert-deadlocks-by-josjuice" title="Permanent link">¶</a></h4>
<p>Modern consoles have many cores and do tons of thread management.  That&#39;s something we&#39;re thankful we don&#39;t have to worry about emulating, as  the GameCube and Wii are from a bygone era of single core processors and games that run directly on bare metal.</p>
<p>But if the GameCube and Wii are <em>Single Core</em> devices, what does Dolphin&#39;s Dual Core mode actually do?  Most users seem to think that it splits CPU emulation onto multiple threads, and ask why we can&#39;t just split it even further to use even more cores.  But that&#39;s not what it does.</p>
<p><a href="https://dolphin-emu.org/m/user/blog/progress-report/2022-june/gamecubecpu.jpg"><img src="https://dolphin-emu.org/m/user/blog/progress-report/2022-june/gamecubecpu.jpg"/></a>
</p>

<p>Dual Core is actually moving <em>GPU</em> related CPU tasks onto a separate core.  The CPU has to do a lot of work figuring out what to render, handling the Vertex Loader, mipmaps, and other things.  This &#34;GPU thread&#34; basically does all the legwork to figure out the GPU commands for what your GPU will then have to render.  Because the GPU thread and the CPU thread are almost <em>all</em> of the major work that Dolphin does on a typical configuration, splitting them up can theoretically give <em>up to 100%</em> faster performance depending on the game.  </p>
<p>This was <em>essential</em> in Dolphin&#39;s early days. Back then, both Dolphin&#39;s CPU JIT and the CPUs we&#39;d be running it on were <em>significantly</em> slower than today.  Twelve years ago, hundreds of games were too demanding to run fullspeed <em>on the fastest computers in the world</em>. It was a community effort in those days to buy the latest processors and overclock the hell out of them to see what games were now fullspeed on the bleeding edge. In the face of this incredible struggle, developers were willing to cut a few corners in order to make things faster.  Dual Core&#39;s design is a result of that.</p>
<p>Dual Core relies on the fact that the CPU and GPU threads can do some of their work in parallel without having to interact.  If everything goes well, they both run at full speed and don&#39;t drift too far apart.  Then, when an action  that requires the CPU/GPU to communicate is  <strong>detected</strong>, they can sync up without any major issues.  The more that things can run in parallel, the more efficient that Dual Core is, so it syncs <em>as little as possible</em> in order to get the massive performance gains that it gives.</p>
<p>However, in recent years Dual Core has drawn more and more ire for causing random bugs and crashes across a lot of popular games.  But it wasn&#39;t <em>always</em> this problematic.  Something changed along the way that has exasperated the core problem of Dual Core...</p>
<p>What exactly happened?</p>
<p>After Dolphin 4.0, something <em>flipped</em> that no one in the early days of Dolphin&#39;s development could have predicted.  With the advent of <a href="https://dolphin-emu.org/blog/2014/03/15/pixel-processing-problems/">TEV Fixes New</a> and a huge slate of massive JIT optimizations, we actually made it so that the <em>GPU thread</em> was now the bottleneck most of the time!</p>
<p>This turned Dual Core into a much more unstable beast, as a sudden spike that causes the GPU thread to fall too far behind can cause bad data to be executed (unknown opcodes), visual errors, shaky geometry, spiky polygons, and more!</p>


<p>Since Dual Core has become more unstable, there have been a lot of efforts to fix it, but we&#39;ve ran into a rather difficult conundrum.  If we fix the core problem - the fact we allow the GPU and CPU threads to run apart - we lose the performance gains of Dual Core.  Fake-completion, a method used for netplay to make Dual Core more deterministic, only works in around half of the library and is roughly 20% slower.  It&#39;s great for netplay in the games it supports, but not really viable as a general option.  SyncGPU, a setting that forces the CPU and GPU thread to synchronize every so many cycles, often ends up slower than Single Core due to thread synchronization overhead and still has some of the same issues as Dual Core.</p>
<p>We&#39;ve come to the conclusion that fixing Dual Core within the existing design just isn&#39;t on the table.  If you can&#39;t run the game on Single Core, and the game relies on tighter CPU/GPU synchronization, you just have to deal with the occasional unknown opcodes, weird graphical oddities, and the occasional crash.</p>
<p>This pull request <em>doesn&#39;t</em> fix any of that, but it does fix something that was making it even worse.  A bug in Dolphin&#39;s GUI system on desktops was causing popups from the GPU thread to lockup Dolphin <em>if</em> the game was in exclusive fullscreen.  Because Dual Core&#39;s behaviors can cause various assertions from the GPU thread, this meant that previously non-fatal popups would essentially deadlock the emulator.  The only advice we could give users was to disable panic handlers while in full-screen because Dual Core is occasionally going to mess up.</p>
<p>Thankfully, the panic handler issue has finally been stopped.  <strong><a href="https://github.com/JosJuice">JosJuice</a></strong> introduced a small tweak to the way popups from the GPU thread are handled in order to make sure they do not deadlock when in Full Screen.  It&#39;s a rather messy solution, but Dual Core itself is messy problem.  </p>
<p>This should fix the annoying &#34;Unknown&#34; blank popups that have been stopping people&#39;s games when running in Full Screen.  If these popups were trying to tell you that a fatal error has happened, then the game might still crash.  But if it&#39;s just a harmless Unknown Opcode, you might be able to continue.</p>
<h4 id="50-16443-implement-pi-fifo-reset-by-pokechu22"><strong><a href="https://dolphin-emu.org/download/dev/master/5.0-16443/">5.0-16443 - Implement PI FIFO Reset</a></strong>  by <strong><a href="https://github.com/pokechu22">pokechu22</a></strong><a href="#50-16443-implement-pi-fifo-reset-by-pokechu22" title="Permanent link">¶</a></h4>
<p>Speaking of annoying unknown opcode popups, <strong><a href="https://github.com/pokechu22">pokechu22</a></strong> investigated a case where Dolphin could erroneously execute bad data after a game called the command for a FIFO RESET.</p>
<p>In normal gameplay, you aren&#39;t going to see this command very often.  In fact, the most common place we&#39;ve seen this issue reported is from <a href="https://wiki.dolphin-emu.org/index.php?title=The_Legend_of_Zelda:_Ocarina_of_Time">The Legend of Zelda: Ocarina of Time (VC)</a>.  This is because randomizer players would abuse soft resets to test particular item checks and use save/quit into reset to quickly travel to specific areas.  Randomly during these resets, the data past the FIFO RESET would contain invalid data, which triggered the unknown opcodes.</p>
<p><strong><a href="https://github.com/pokechu22">pokechu22</a></strong> investigated a similar case found in a demo disc that used FIFO RESET between games and menus and found that any data leftover <em>past</em> a FIFO RESET was thrown out.  As such, we now throw out any commands immediately following a FIFO RESET before things are reinitialized.</p>
<h4 id="50-16722-and-50-16737-fix-hle-audio-and-hle-boot-of-datel-titles-by-pokechu22"><strong><a href="https://dolphin-emu.org/download/dev/master/5.0-16722/">5.0-16722</a></strong> and <strong><a href="https://dolphin-emu.org/download/dev/master/5.0-16737/">5.0-16737</a></strong> - <strong>Fix HLE audio and HLE boot of Datel Titles</strong>  by <strong><a href="https://github.com/pokechu22">pokechu22</a></strong><a href="#50-16722-and-50-16737-fix-hle-audio-and-hle-boot-of-datel-titles-by-pokechu22" title="Permanent link">¶</a></h4>
<p>Let&#39;s be honest here.  In the past, booting Datel titles in Dolphin was a pain in the ass.  It required both DSP-LLE <em>and</em> an original GameCube BIOS.  Otherwise, they would simply hang and/or lock up Dolphin.  And when that happens, your settings would likely get reset when Dolphin crashed and then you&#39;d have to figure out what you forgot to change and the cycle continues.</p>
<p>You may wonder: &#34;<em>Why would I want to boot a Datel title in an emulator? All Datel did was make a bunch of unlicensed products, right?</em>&#34; While their stuff may not have been of the highest budget and quality, they did make some rather interesting and useful products.  The Advance Game Port allowed you to play Game Boy Advance games on the GameCube through a <strong>GBA Emulator</strong> which loaded real cartridges through a Memory Card expansion device.  But, Datel is more commonly known on the GameCube for their slew of Action Replay releases, Freeloader discs, and their weird Max Drive gigantic memory cards.</p>
<p>This brings us to a rather <em>weird</em> point.  The Gecko Code loader is free open source software, which allows Dolphin to directly use the same Gecko Code Loader that is used on console.  Thanks to that, our Gecko code support is nearly 1:1 with console. However, Datel&#39;s Action Replay loader is closed source and protected by copyright, and we cannot include it. So Dolphin uses a reversed engineered cheat code loader for Action Replay codes. While Datel&#39;s codes <em>should</em> be able to produce near identical results in Dolphin, it&#39;s very obvious that our Action Replay cheat loader is fairly inaccurate in some respects.  For example, the &#34;Hold R to Mega Jump&#34; Action Replay code in <a href="https://wiki.dolphin-emu.org/index.php?title=The_Legend_of_Zelda:_The_Wind_Waker">The Legend of Zelda: The Wind Waker</a> only works when using a real Action Replay disc to initialize the code.</p>


<p>In an effort to make these unlicensed titles more accessible, <strong><a href="https://github.com/pokechu22">pokechu22</a></strong> dug through them to figure out why they didn&#39;t work with Dolphin&#39;s emulated BS2 (AKA - Skip Main Menu) or with HLE audio. The answers for each were rather interesting.</p>
<p>For the HLE audio issue, the problem was caused by a typo in <em>Datel&#39;s</em> code that ended up not mattering on console or DSP-LLE, but completely broke our HLE implementation.  Namely, they were supposed to write 0x800 to the DSP control register, which would have started the initialization process.  Instead they wrote 0x80, which does absolutely nothing.  How exactly did this work on DSP-LLE and real hardware?  Well, it didn&#39;t, but other data arrived at <em>just</em> the right time just as Datel&#39;s initialization code exited.  We&#39;re not 100% sure why this works, and for once we don&#39;t have an overly complicated summary from <strong><a href="https://github.com/pokechu22">pokechu22</a></strong> to rely on yet.  All we know is that by improving the timings on DSP-HLE, <strong><a href="https://github.com/pokechu22">pokechu22</a></strong> was able to get it working in the same manner that it was on DSP-LLE and console.</p>
<p>Emulated BS2 is our internal name for what users see as &#34;GameCube - Skip Main Menu&#34; in the GUI.  If you don&#39;t hear that jingle and see that cube before booting a GameCube game, then you&#39;re using Dolphin&#39;s Emulated BS2.  Its job is to make sure that all of the registers and memory are setup correctly as if the Main Menu had run, so that games work the same regardless of if you have the Main Menu dumped from a console or not.  Emulated BS2 works so well for most games, that users almost never have to rely on a real Main Menu for compatibility reasons in retail titles.</p>
<p>The reason why Emulated BS2 didn&#39;t work with Datel&#39;s Loader stemmed from the fact that Datel did <em>way</em> less initialization than actual games.  Datel&#39;s titles <strong>heavily</strong> relied on the Main Menu to setup almost everything.  <strong><a href="https://github.com/pokechu22">pokechu22</a></strong> had to go through various registers <em>and</em> even dive into parts of the graphics code and give them proper default values in order to have the games boot correctly without needing a GameCube Main Menu.</p>
<p>The result of all of this work is that Datel&#39;s titles will now boot properly without needing special settings in the latest development builds.   However, there are still a lot of problems when using these titles, especially in Action Replay devices that check memory cards.  Some Action Replay titles will hang if you have a memory card plugged in on boot.  Most Datel titles will throw unknown opcodes as well, and in one rare case in the third Advance Game Port release, enabling MMU will cause the game to crash.  </p>
<p>We highly recommend <em>not</em> using GCI Folders with any Datel products that can write to the memory card, especially Advance Game Port&#39;s third release, which will actively break things with how it writes Savestates to the memory card.  As with any kind of sketchy game (like <a href="https://dolphin-emu.org/blog/2021/11/13/dolphin-progress-report-september-and-october-2021/?nocr=true#50-15330-raise-program-exceptions-on-floating-point-exceptions-by-josjuicewe">True Crime: New York City</a>) or homebrew that can do unexpected things, please use these titles with caution.</p>
<h4 id="50-16730-add-hle-version-of-libasnd-by-pokechu22"><strong><a href="https://dolphin-emu.org/download/dev/master/5.0-16730/">5.0-16730 - Add HLE version of libasnd</a></strong>  by <strong><a href="https://github.com/pokechu22">pokechu22</a></strong><a href="#50-16730-add-hle-version-of-libasnd-by-pokechu22" title="Permanent link">¶</a></h4>
<p>If you use a lot of homebrew in Dolphin, you&#39;re probably someone who commonly swaps over to LLE audio.  This is because a lot of Homebrew use special <em>homebrew</em> DSP microcodes called libasnd and libaesnd.  Dolphin&#39;s DSP-HLE had no way to handle these microcodes!</p>


<p>This is because DSP-HLE doesn&#39;t actually emulate the DSP hardware, instead it identifies what DSP microcode is running (based on a hash) and directly emulates that microcode without bothering to actually emulate the hardware itself.  This is <em>many</em> times faster, to the point where DSP emulation is <em>never</em> a performance bottleneck when using DSP-HLE.  Yet in modern builds of Dolphin, DSP-HLE and DSP-LLE have <em>near</em> parity in supported microcodes.  Users no longer have to choose between the accurate but demanding DSP-LLE or <a href="https://dolphin-emu.org/blog/2015/08/19/new-era-hle-audio/">old HLE audio</a> that was rife with bugs and only supported a handful of titles well.</p>
<p>Because the GameCube and Wii&#39;s retail library is now set, we can be certain that Dolphin&#39;s DSP-HLE completely handles those cases with relative accuracy. However, Homebrew (and one demo we found earlier this year!) are the last bastions of unsupported microcodes under DSP-HLE.</p>
<p>And that&#39;s the main reason why Dolphin&#39;s DSP-HLE hasn&#39;t worked for a lot of homebrew.  A lot of homebrew uses the libasnd and libaesnd microcodes, which were under active development during most of Dolphin&#39;s development life.  Writing support for something that could change at any moment seemed silly, but at this point development on the homebrew microcodes seem to have mostly stabilized. The last changes occurred in 2020, and they were minor changes at that.</p>
<p>As part of making homebrew in Dolphin more accessible, it seemed natural to finally add support for the libasnd and libaesnd microcodes that they use. And because they&#39;re a part of libogc and open source, adding support for them was far easier than it was figuring out all the crazy behaviors present in various AX and Zelda microcodes!  In fact, <strong><a href="https://github.com/pokechu22">pokechu22</a></strong> implemented the libasnd microcode used in most homebrew <em>on the side</em> while working on other audio things.</p>


<p>Some homebrew that use the slightly more complicated liba<strong>e</strong>snd still require LLE audio as of this Progress Report, but work on changing that is already underway.</p>
<h3 id="dev-diary-solving-the-mystery-of-monster-house"><strong>Dev Diary - Solving the Mystery of Monster House</strong><a href="#dev-diary-solving-the-mystery-of-monster-house" title="Permanent link">¶</a></h3>
<p><a href="https://wiki.dolphin-emu.org/index.php?title=Monster_House">Monster House</a> is a game that has been problematic in Dolphin for a very long time.  It&#39;s right in that zone where it&#39;s not <em>popular</em> enough to see a lot of attention, but not <em>awful</em> enough to draw a lot of morbid curiosity. It&#39;s a servicable game that falls apart in the final act.</p>
<p>There have been reports that <a href="https://wiki.dolphin-emu.org/index.php?title=Monster_House">Monster House</a> is a cursed game, and is simply unbeatable in Dolphin.  Invalid read errors would chase away prospective users looking to sneak into the depths of this seemingly haunted labyrinth. Every time we&#39;ve taken a glance at this title, it has looked like nothing else but a normal game with no noticeable issues.  But again and again on the issue tracker and wiki, another soul would be lost to these mysterious crashes.</p>
<p>After many years of avoiding the eyesore, it was time to send someone in for real.  Someone to get to the bottom of <a href="https://wiki.dolphin-emu.org/index.php?title=Monster_House">Monster House</a> and find out the truth.</p>
<p>Our unwilling volunteer this time around was <strong><a href="https://github.com/JMC47">JMC47</a></strong>.  He was a skeptic that there would be anything special with this particular game and rolled his eyes at the request.  We sent him in anyway and armed him with a squirt gun, some savestates, and a cheatcode to refill health.  He should have been completely safe with those tools.  Should have.  Unfortunately, we lost contact soon after he entered the house.  All that we could find were these log files of his exploits.</p>
<hr/>
<p><strong>Testers Log - Day 1</strong></p>
<p>I&#39;ve seen <a href="https://wiki.dolphin-emu.org/index.php?title=Monster_House">Monster House</a> reported a couple of times over the years and bought the game probably over half a decade ago.  I&#39;ve tried it a few times but upon seeing nothing interesting, I&#39;d always put it on the back burner.  This game isn&#39;t aggressively bad or maliciously coded, it just seems like a pretty mediocre movie tie-in.  Compared to something with crazy issues like <a href="https://wiki.dolphin-emu.org/index.php?title=True_Crime:_New_York_City">True Crime: New York City</a>, it just seemed like it wasn&#39;t worth my time.  Yet, supposedly this game still isn&#39;t playable.  We&#39;ll see about that.</p>
<p>The game starts out rather suddenly, with the main cast getting thrown into the <a href="https://wiki.dolphin-emu.org/index.php?title=Monster_House">Monster House</a> with little to no setup.  This is apparently a movie tie-in game, so apparently telling the story properly is just optional.  At the center of the game are three kids.  I will dub them Annoying Child, Sarcastic Girl, and Scared Kid.  The gimmick of the game is that these three kids are exploring the <a href="https://wiki.dolphin-emu.org/index.php?title=Monster_House">Monster House</a> armed with different weapons and they are trying to destroy it in order to... I don&#39;t know honestly.  They just seem to want to destroy it.  But is it evil?  Having played through the first chapter of the game, I&#39;m not entirely sure.</p>


<hr/>
<p><strong>Testers Log - Day 2</strong></p>
<p>This game is starting to get on my nerves.  Maybe it&#39;s because the developers were inexperienced, but I&#39;m constantly ending up going the wrong way in a mostly linear game.  The reason for this is rather silly.</p>
<p>When you unlock a door in other games, say a 3D Legend of Zelda game, the developers tend to show you the door you unlocked.  The developers of this game have seen this and <em>know</em> that, but it seems like they didn&#39;t understand <em>why</em> it works.  They show me that I unlocked a door in a close up, but then zip back to my character facing whatever direction I was facing when the cutscene started.  Compare this to [Wind Waker], which will keep your camera angled toward the door that you unlocked when you regain control. This is a reoccuring problem in Monster House, especially in hallways where you might unlock a vent that is all the way back near where you came.</p>


<p>Does this make it a terrible game?  No.  The game seems solid enough overall, and I haven&#39;t seen any signs of really bad programming that would cause a crash.  Maybe all of the users before me were just using bad dumps or cheats that don&#39;t work.</p>
<hr/>
<p><strong>Testers Log - Day 3</strong></p>
<p>I felt a chill run down my spine.  I was crawling through a vent when I heard the horrible ding of invalid reads. I thought the <a href="https://wiki.dolphin-emu.org/index.php?title=Monster_House">Monster House</a> had swallowed me alive.  </p>
<p>I held frantically mashed enter to try and break free, fearing my journey was over.  In the end, I survived.  The last invalid read error was squashed and the game loaded the next area.  I let out a sigh of relief, as I had made a fatal error in my complacency.</p>
<p>Logging wasn&#39;t enabled this entire time - meaning that if this had been a game crash, I would have lost everything.  Thankfully, because the game didn&#39;t crash, I was able to save and enable logging and other debugging features.  The <a href="https://wiki.dolphin-emu.org/index.php?title=Monster_House">Monster House</a> should have stopped me while it had the chance.  Now it&#39;s war.</p>
<hr/>
<p><strong>Testers Log - Day 4</strong></p>
<p>The game put up a rather spirited fight, but i have emerged victorious.  </p>
<p>It tried the same trick on me again with the invalid reads <em>and</em> this time crashed afterwards thinking it would fell me.  Fortunately, the damage done was minimal as I had been saving regularly since the initial scare.  During this attack, however, the game revealed its weakpoint!  In the logs I caught &#34;Stale icache&#34; messages right alongside the invalid reads.  <strong>This game is just icache sensitive!</strong></p>


<p>If I had been playing this game years ago, perhaps I wouldn&#39;t have known what to do.  Thankfully, by this point we have <a href="https://github.com/dolphin-emu/dolphin/pull/10739">weapons</a> to fight off such a problem thanks to <strong><a href="https://github.com/pokechu22">pokechu22</a></strong> and the infamous <a href="https://wiki.dolphin-emu.org/index.php?title=Scooby-Doo!_Mystery_Mayhem">Scooby Doo!</a> incident.  </p>
<p>Oddly enough, those also dealt with mysteries, haunted houses, and monsters...  Oh well.  It looks like my job is done here.  All I need to do is beat the game and write up a report.</p>
<hr/>
<p><strong>Testers Log - Day 5</strong></p>
<p>Despite disabling the icache, I&#39;m still getting invalid read errors every now and then.  The game hasn&#39;t crashed on me, but this shouldn&#39;t be happening.  Either the game needs <em>accurate</em> icache emulation or the game has programming bugs that cause invalid reads on console that get skipped by their error handler.  In order to verify this myself, I decided to enable MMU emulation.</p>
<p>If the game crashes now, I&#39;ll be able to follow a stack trace and figure out exactly <em>where</em> in the game code the problem is happening.  From there, if the game is relying on icache behaviors to the point of needing <em>accurate</em> emulation of it, we can just patch the game instead.</p>
<p>After dealing with all of that annoying emulator stuff, the game rewarded me with a rather competently made boss fight.  Things are starting to look up after all!</p>
<hr/>
<p><strong>Testers Log - Day 6</strong></p>
<p>Apparently the developers couldn&#39;t design harder enemies and have just decided to make the game harder by throwing a 30+ enemies into every room.  What the hell is their problem?  There are so many enemies in these rooms that you can&#39;t actually move your character half of the time until you clear them out.</p>
<p>And please, can we stop with all the quicktime events?! These QTEs were annoying in the first half of the game, but there they only cost a tiny amount of health as long as you mashed the failure minigame.  Now they cause instant death and reset you to the beginning of the section!</p>


<p>This last section I&#39;m in has been a real doozy.  Multiple rooms packed with tons of enemies and areas that lock you in until you clear all the enemies, followed by a boss fight, followed by not one <em>but two</em> instant death QTEs?!  Come on.  That&#39;s more than enough, especially considering that the boss had an instant KO move too, even if it was easy enough to dodge.</p>
<p>At least I&#39;m almost done with this maze.  Whenever the story switches characters, the game gives me a checkpoint.  I just need to find my way out, and every direction just looks the same.  Oh, and there are a bunch of extra dead-ends with nothing but collectable bonuses.  And if you dare grab the collectable you spawn more enemies.  Thanks!  That&#39;s just wonderful.  </p>
<p>AND ANOTHER INSTANT DEATH QUICKTIME EVENT SPACED JUST FAR ENOUGH OUT THAT I LET MY GUARD DOWN SENDS ME BACK TO BEFORE THE BOSS?!  You know what, I&#39;m just going to spam savestates. </p>
<hr/>
<p><strong>Testers Log - Day 7</strong></p>
<p>Now the #@&amp;$ing cutscenes have #@&amp;$ing quicktime events in them that if you fail you die, or worse, have to fight the boss again.  You can&#39;t even rest during the cutscenes.  At least I&#39;m almost-  What.</p>
<p>This game checks to make sure the memory card you&#39;re using matches the memory card the save was created on, and I apparently loaded a savestate from before my last in-game save, so now it thinks the memory card doesn&#39;t match.  At least it doesn&#39;t refuse to save - oh great, the game #@&amp;$ing crashed after saving because it&#39;s poorly coded.  Now I need to make sure this isn&#39;t a Dolphin bug.</p>
<p>And, why exactly are the cutscenes where you <em>get caught</em> to switch characters exactly the same as the QTEs that you <em>can&#39;t fail</em> or else you game over?  Where is the consistency.  And, you know what would be a great idea?  Putting a room with a thousand #@&amp;$ing enemies and then have a QTE trigger in the same area is just stupid.  And guess what, if you manage to get hit as a QTE loads, the #@&amp;$ button prompt won&#39;t show up so you&#39;re just dead.  GREAT.  And the button prompts are randomized, so you can&#39;t even use the dodge button or something consistent like that.</p>
<p>It&#39;s a horrible conundrum.  Killing all the enemies takes forever, so I just want to rush through the rooms.  But if I don&#39;t kill the enemies, I risk glitching out their precious QTE that instantly kills me if I mess up.  This section of the game is literal garbage, and honestly sours everything else.</p>
<p>I was willing to forgive the fact that the annoying #@&amp;$ing kid needed a #@&amp;$ing ladder hook in order to grab a ladder that was clearly at arm&#39;s height.  I was willing to forgive the fact the game&#39;s enemy design had as much variety as a modern sitcom.  Hell, I was willing forgive the fact that this &#34;movie tie-in&#34; hadn&#39;t actually told me anything about the characters or story!</p>
<p>How come the #@&amp;$ing house can seemingly capture these kids at will and kill them but doesn&#39;t.  The <em>same exact cutscene</em> where the vent comes down and grabs you during a QTE to kill you is used <em>multiple times</em> to force character swaps, but the kid ends up fine in another section anyway!  Why?  How come they&#39;re fine when that happens but not during the QTE?!</p>
<p>This is literally the the final stretch of the game.  I just need to push through and finish it so I can mark the game as playable on the Wiki and forget this ever happened.</p>
<hr/>
<p><strong>Testers Log - Day 8</strong></p>
<p>@#&amp;$ing this stupid #@&amp;$ing house in this stupid #@&amp;$ing game.  You know, the game has truly made me appreciate that last section of enemy mobs and QTEs.  You want to know why?  Because at least there was <em>gameplay</em>.  This is the second to last chapter of the game, and do you want to know what it is composed of?  #@&amp;$ing QTEs! THAT&#39;S IT!  THERE&#39;S NO MORE GAMEPLAY!</p>
<p>Okay, so get this. The house is chasing me, and I have a three button quicktime event where every so often I have to hit a button to avoid rubble with one of the three characters.  Mess up too many times, and you restart the section.  The timings aren&#39;t all that tight, but considering how long the section actually lasts, it&#39;s rather annoying.</p>


<p>This is just wonderful.</p>
<hr/>
<p><strong>Testers Log - Day 9</strong></p>
<p><em>This log has been removed due to excessive profanity.</em></p>


<hr/>
<p><strong>Testers Log - Day 10</strong></p>
<p>The #@&amp;$ing chase cutscene is still #@&amp;$ing going.  I can&#39;t believe it.  And on this section you can&#39;t make any mistakes because the house has caught up.</p>


<hr/>
<p><strong>Testers Log - Day 11</strong></p>
<p>After several minutes of playing the worst version of <em>Simon says</em> I&#39;ve ever seen, the final boss fight has finally commenced.  And considering the quality of the last chapter, it is fitting the final boss is <em>barely</em> gameplay.  Rather than using the third person shooter gameplay that the game has established up until this point, we get an incredibly janky vehicle boss fight where we take a crane, approach the house, mash attack, back away... rinse and repeat.</p>
<p>There&#39;s no actual variety to the fight.  The house has one attack that can be mirrored left or right - an extremely slow swipe followed by a reverse swipe.  You just backup to avoid it, and then after the attack get close and mash the attack button to deal a tiny pixel of damage to its health bar.  But, don&#39;t you dare make a mistake, as if the house so much as <em>grazes</em> your crane, it takes off a huge chunk of your health bar.  Just don&#39;t be greedy and the fight isn&#39;t that bad.  You can&#39;t really get into a rhythm though because there&#39;s yet another randomly occurring #@&amp;$ing QTE during the boss.  It&#39;s just a simple joystick spin, but unless you use the palm of your hand to spin it extremely fast, you&#39;re guaranteed to lose some of your precious life every time.  If the QTE comes up too many times, you can lose half of your health.  It&#39;s worth swapping your hand grip to make sure that doesn&#39;t happen, because this fight takes way too long to lose to chip damage.</p>


<p>The boss&#39;s health bar is almost depleted... please... just end... YES!  IT&#39;S OVER!</p>


<p>After all of that, it&#39;s hard to judge <a href="https://wiki.dolphin-emu.org/index.php?title=Monster_House">Monster House</a> because of how <em>hard</em> it relies on quick time events toward the end of the game.  The core gameplay isn&#39;t <em>bad</em>, and while the developer was inexperienced, they did a decent enough job at varying up the characters, enemies, and their first boss fight was well designed.</p>
<p>It&#39;s just that the latter half of the game became such a QTE fest that it was hard to play.  And the parts after you get out of the house are almost entirely QTEs!  But now we&#39;re in the ending cutscene and it&#39;s all over-</p>


<p>What you want me to <strong>hit buttons</strong> during the end cutscene!  NO!  #@&amp;$ NO NO #@&amp;$!  WHO THE #@&amp;$ PUTS A QUICKTIME EVENT AFTER YOU DEPLETE THE FINAL BOSSES HEALTH BAR WHAT THE #@&amp;$ IS YOUR PROBLEM WHY-</p>
<hr/>
<p>Unfortunately, the log cuts off there.  The random Savestate/Memory Card Crash never happened a second time, so we were unable to confirm if that was a bug in Dolphin or the game, but we can confirm that the game is now playable from start to finish... if you dare.</p>
<h3 id="last-months-contributors"><strong>Last Month&#39;s Contributors...</strong><a href="#last-months-contributors" title="Permanent link">¶</a></h3>
<p>Special thanks to <a href="https://github.com/dolphin-emu/dolphin/graphs/contributors?from=2022-05-01&amp;to=2022-07-01&amp;type=c">all of the contributors</a> that incremented Dolphin from <a href="https://dolphin-emu.org/download/dev/master/5.0-16383/">5.0-16383</a> through to <a href="https://dolphin-emu.org/download/dev/master/5.0-16793/">5.0-16793</a>!</p>


    
    
    

    </div></div>
  </body>
</html>
