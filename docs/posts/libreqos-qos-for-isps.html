<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/rchac/LibreQoS">Original</a>
    <h1>LibreQoS: QoS for ISPs</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text">
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/rchac/LibreQoS/blob/main/docs/Banner.png"><img src="https://github.com/rchac/LibreQoS/raw/main/docs/Banner.png" alt="Banner" title="Banner"/></a>
LibreQoS is designed for Internet Service Providers (such as Fixed Wireless
Internet Service Providers) to manage customer traffic and thus improve the
experience,
prevent <a href="https://www.bufferbloat.net/projects/bloat/wiki/Introduction/" rel="nofollow">bufferbloat,</a>
and keep the network responsive.</p>
<p dir="auto">Because the customers see better performance, ISPs receive fewer support
tickets/calls and reduce network traffic from fewer retransmissions.</p>
<p dir="auto">A sub-$600 computer running LibreQoS should be able to shape traffic for
hundreds or thousands of customers at 2 Gbps.</p>

<p dir="auto">ISPs use LibreQoS to enforce customer plan bandwidth, improve responsiveness,
reduce latency, reduce bufferbloat, and improve overall network performance.</p>
<p dir="auto">LibreQoS runs on a computer that sits between your upstream provider and the
core of your network (see graphic below).
It manages all customer traffic with the
<a href="https://www.bufferbloat.net/projects/codel/wiki/Cake/" rel="nofollow">htb+cake</a>
or <a href="https://www.bufferbloat.net/projects/codel/wiki/" rel="nofollow">htb+fq_codel</a>
Active Queue Management (AQM) algorithms.</p>
<p dir="auto">LibreQoS directs each customer&#39;s traffic into a
<a href="https://linux.die.net/man/8/tc-htb" rel="nofollow">hierarchy token bucket</a>,
where traffic can be shaped both by Access Point capacity and by the
subscriber&#39;s allocated plan bandwidth.</p>
<h2 dir="auto"><a id="user-content-who-should-use-libreqos" aria-hidden="true" href="#who-should-use-libreqos"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Who should use LibreQoS?</h2>
<p dir="auto"><strong>The target for LibreQoS is ISPs</strong> that have a modest number of subscribers.
LibreQoS runs on an inexpensive computer and handles hundreds or thousands of subscribers.</p>
<p dir="auto"><strong>Individuals</strong> can reduce bufferbloat or latency on their home internet connections
(whether or not their service provider offers an AQM solution)
with a router that supports fq_codel, such as
<a href="https://evenroute.com" rel="nofollow">IQrouter</a>,
<a href="https://www.ui.com/edgemax/edgerouter-x/" rel="nofollow">Ubiquiti&#39;s EdgeRouter-X</a> (be sure to enable <em>advanced queue fq_codel</em>),
or installing <a href="https://openwrt.org" rel="nofollow">OpenWrt</a> or <a href="https://dd-wrt.com" rel="nofollow">DD-WRT</a> on their existing router.</p>
<p dir="auto"><strong>Large Internet Service Providers</strong> with significantly more subscribers may
benefit from using commercially supported alternatives with NMS/CRM integrations
such as <a href="https://preseem.com" rel="nofollow">Preseem</a> or <a href="https://www.saisei.com/" rel="nofollow">Saisei</a>.
See the table below.</p>
<p dir="auto"><strong>A comparison of LibreQoS and Preseem</strong></p>
<div data-snippet-clipboard-copy-content="╔══════════════════════╦══════════════════════╦══════════════════╗
║ Feature              ║ LibreQoS             ║ Preseem          ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ IPv4                 ║ ✔                    ║ ✔                ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ IPv6                 ║ v0.8 only            ║ ✔                ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ fq_codel             ║ ✔                    ║ ✔                ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ cake                 ║ ✔                    ║                  ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ Fair Queuing         ║ ✔                    ║ ✔                ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ VoIP Prioritization  ║ ✔ cake diffserv4 [1] ║                  ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ Video Prioritization ║ ✔ cake diffserv4 [1] ║                  ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ CRM Integration      ║                      ║ ✔                ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ Metrics              ║                      ║ ✔                ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ Shape By             ║ Site, AP, Client     ║ Site, AP, Client ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ Throughput           ║ 10G+ (v0.9+)         ║ 20G+ [2]         ║
╚══════════════════════╩══════════════════════╩══════════════════╝"><pre><code>╔══════════════════════╦══════════════════════╦══════════════════╗
║ Feature              ║ LibreQoS             ║ Preseem          ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ IPv4                 ║ ✔                    ║ ✔                ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ IPv6                 ║ v0.8 only            ║ ✔                ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ fq_codel             ║ ✔                    ║ ✔                ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ cake                 ║ ✔                    ║                  ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ Fair Queuing         ║ ✔                    ║ ✔                ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ VoIP Prioritization  ║ ✔ cake diffserv4 [1] ║                  ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ Video Prioritization ║ ✔ cake diffserv4 [1] ║                  ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ CRM Integration      ║                      ║ ✔                ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ Metrics              ║                      ║ ✔                ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ Shape By             ║ Site, AP, Client     ║ Site, AP, Client ║
╠══════════════════════╬══════════════════════╬══════════════════╣
║ Throughput           ║ 10G+ (v0.9+)         ║ 20G+ [2]         ║
╚══════════════════════╩══════════════════════╩══════════════════╝
</code></pre></div>
<ul dir="auto">
<li>[1] <a href="https://arxiv.org/pdf/1804.07617.pdf" rel="nofollow">Piece of CAKE: A Comprehensive Queue Management Solution for Home Gateways</a></li>
<li>[2] <a href="https://www.cengn.ca/wp-content/uploads/2020/02/Aterlo-Networks-Success-Story.pdf" rel="nofollow">Aterlo Validates QoE Measurement Appliance Preseem</a></li>
</ul>
<h2 dir="auto"><a id="user-content-how-do-cake-and-fq_codel-work" aria-hidden="true" href="#how-do-cake-and-fq_codel-work"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>How do Cake and fq_codel work?</h2>
<p dir="auto">These AQM techniques direct each customer&#39;s traffic into its own queue, where
LibreQoS can shape it both by Access Point capacity and by the subscriber&#39;s
allocated plan bandwidth.</p>
<p dir="auto">The difference is dramatic: the chart below shows the ping times during a
<a href="https://www.bufferbloat.net/projects/bloat/wiki/RRUL_Chart_Explanation/" rel="nofollow">Realtime Response Under Load (RRUL) test</a>
before and after enabling LibreQoS AQM.
The RRUL test sends full-rate traffic in both directions, then measures latency
during the transfer.
Note that the latency drops from ~20 msec (green, no LibreQoS) to well
under 1 msec (brown, using LibreQoS).</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/rchac/LibreQoS/blob/main/docs/latency.png"><img src="https://github.com/rchac/LibreQoS/raw/main/docs/latency.png" width="650"/></a></p>
<p dir="auto">The impact of fq_codel on a 3000Mbps connection vs hard rate limiting —
a 30x latency reduction.</p>
<blockquote>
<p dir="auto">“FQ_Codel provides great isolation... if you&#39;ve got low-rate videoconferencing and low rate web traffic they never get dropped. A lot of issues with IW10 go away, because all the other traffic sees is the front of the queue. You don&#39;t know how big its window is, but you don&#39;t care because you are not affected by it. FQ_Codel increases utilization across your entire networking fabric, especially for bidirectional traffic... If we&#39;re sticking code into boxes to deploy codel, don&#39;t do that. Deploy fq_codel. It&#39;s just an across the board win.”</p>
<ul dir="auto">
<li>Van Jacobson | IETF 84 Talk</li>
</ul>
</blockquote>
<p dir="auto"><strong>References</strong></p>
<ul dir="auto">
<li><a href="https://www.bufferbloat.net/projects/codel/wiki/Cake/" rel="nofollow">Cake | Bufferbloat.net</a></li>
<li><a href="https://www.bufferbloat.net/projects/codel/wiki/" rel="nofollow">FQ-Codel | Bufferbloat.net</a></li>
</ul>
<h2 dir="auto"><a id="user-content-typical-client-results" aria-hidden="true" href="#typical-client-results"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Typical Client Results</h2>
<p dir="auto">Here are the <a href="http://www.dslreports.com/speedtest" rel="nofollow">DSLReports Speed Test</a>
results for a Fixed Wireless client averaging 20ms to the test server.
LibreQoS keeps added latency below 5ms in each direction.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/rchac/LibreQoS/blob/main/docs/bloat.png"><img src="https://github.com/rchac/LibreQoS/raw/main/docs/bloat.png" width="350"/></a></p>

<ul dir="auto">
<li>Edge and Core routers with MTU 1500 on links between them
<ul dir="auto">
<li>If you use MPLS, you would terminate MPLS traffic at the core router.
LibreQoS cannot decapsulate MPLS on its own.</li>
</ul>
</li>
<li>OSPF primary link (low cost) through the server running LibreQoS</li>
<li>OSPF backup link</li>
</ul>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/rchac/LibreQoS/blob/main/docs/design.png?raw=true"><img src="https://github.com/rchac/LibreQoS/raw/main/docs/design.png?raw=true" alt="Diagram" title="Diagram"/></a></p>
<h3 dir="auto"><a id="user-content-v08-stable---ipv4--ipv6-2-july-2021" aria-hidden="true" href="#v08-stable---ipv4--ipv6-2-july-2021"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>v0.8 (Stable - IPv4 &amp; IPv6) 2 July 2021</h3>
<h4 dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h4>
<ul dir="auto">
<li>Dual stack: client can be shaped by same qdisc for both IPv4 and IPv6</li>
<li>Up to 1000 clients (IPv4/IPv6)</li>
<li>Real world asymmetrical throughput: between 2Gbps and 4.5Gbps depending on CPU single thread performance.</li>
<li>HTB+fq_codel or HTB+cake</li>
<li>Shape Clients by Access Point / Node capacity</li>
<li>TC filters split into groups through hashing filters to increase throughput</li>
<li>Simple client management via csv file</li>
<li>Simple statistics - table shows top 20 subscribers by packet loss, with APs listed</li>
</ul>
<h4 dir="auto"><a id="user-content-limitations" aria-hidden="true" href="#limitations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Limitations</h4>
<ul dir="auto">
<li>Qdisc locking problem limits throughput of HTB used in v0.8 (solved in v0.9). Tested up to 4Gbps/500Mbps asymmetrical throughput using <a href="https://github.com/microsoft/ethr">Microsoft Ethr</a> with n=500 streams. High quantities of small packets will reduce max throughput in practice.</li>
<li>Linux tc hash tables can only handle <a href="https://stackoverflow.com/questions/21454155/linux-tc-u32-filters-strange-error" rel="nofollow">~4000 rules each.</a> This limits total possible clients to 1000 in v0.8.</li>
</ul>
<h3 dir="auto"><a id="user-content-v09-stable---ipv4-11-jul-2021" aria-hidden="true" href="#v09-stable---ipv4-11-jul-2021"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>v0.9 (Stable - IPv4) 11 Jul 2021</h3>
<h4 dir="auto"><a id="user-content-features-1" aria-hidden="true" href="#features-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h4>
<ul dir="auto">
<li><a href="https://github.com/xdp-project/xdp-cpumap-tc">XDP-CPUMAP-TC</a> integration greatly improves throughput, allows many more IPv4 clients, and lowers CPU use. Latency reduced by half on networks previously limited by single-CPU / TC QDisc locking problem in v.0.8.</li>
<li>Tested up to 10Gbps asymmetrical throughput on dedicated server (lab only had 10G router). v0.9 is estimated to be capable of an asymmetrical throughput of 20Gbps-40Gbps on a dedicated server with 12+ cores.</li>
<li><a target="_blank" rel="noopener noreferrer" href="https://github.com/rchac/LibreQoS/blob/main/docs/10Gbps.png?raw=true"><img src="https://github.com/rchac/LibreQoS/raw/main/docs/10Gbps.png?raw=true" alt="Throughput" title="Throughput"/></a></li>
<li>MQ+HTB+fq_codel or MQ+HTB+cake</li>
<li>Now defaults to &#39;cake diffserv4&#39; for optimal client performance</li>
<li>Client limit raised from 1,000 to 32,767</li>
<li>Shape Clients by Access Point / Node capacity</li>
<li>APs equally distributed among CPUs / NIC queues to greatly increase throughput</li>
<li>Simple client management via csv file</li>
</ul>
<h4 dir="auto"><a id="user-content-considerations" aria-hidden="true" href="#considerations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Considerations</h4>
<ul dir="auto">
<li>Each Node / Access Point is tied to a queue and CPU core. Access Points are evenly distributed across CPUs. Since each CPU can usually only accomodate up to 4Gbps, ensure any single Node / Access Point will not require more than 4Gbps throughput.</li>
</ul>
<h4 dir="auto"><a id="user-content-limitations-1" aria-hidden="true" href="#limitations-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Limitations</h4>
<ul dir="auto">
<li>Not dual stack, clients can only be shaped by IPv4 address for now in v0.9. Once IPv6 support is added to <a href="https://github.com/xdp-project/xdp-cpumap-tc">XDP-CPUMAP-TC</a> we can then shape IPv6 as well.</li>
<li>XDP&#39;s cpumap-redirect achieves higher throughput on a server with direct access to the NIC (XDP offloading possible) vs as a VM with bridges (generic XDP).</li>
</ul>
<h3 dir="auto"><a id="user-content-v10-stable---ipv4-11-dec-2021" aria-hidden="true" href="#v10-stable---ipv4-11-dec-2021"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>v1.0 (Stable - IPv4) 11 Dec 2021</h3>
<h4 dir="auto"><a id="user-content-features-2" aria-hidden="true" href="#features-2"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h4>
<ul dir="auto">
<li>Can now shape by Site, in addition to by AP and by Client</li>
</ul>
<h4 dir="auto"><a id="user-content-considerations-1" aria-hidden="true" href="#considerations-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Considerations</h4>
<ul dir="auto">
<li>If you shape by Site, each site is tied to a queue and CPU core. Sites are evenly distributed across CPUs. Since each CPU can usually only accomodate up to 4Gbps, ensure any single Site will not require more than 4Gbps throughput.</li>
<li>If you shape by Acess Point, each Access Point is tied to a queue and CPU core. Access Points are evenly distributed across CPUs. Since each CPU can usually only accomodate up to 4Gbps, ensure any single Access Point will not require more than 4Gbps throughput.</li>
</ul>
<h4 dir="auto"><a id="user-content-limitations-2" aria-hidden="true" href="#limitations-2"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Limitations</h4>
<ul dir="auto">
<li>As with 0.9, not yet dual stack, clients can only be shaped by IPv4 address until IPv6 support is added to <a href="https://github.com/xdp-project/xdp-cpumap-tc">XDP-CPUMAP-TC</a>. Once that happens we can then shape IPv6 as well.</li>
<li>XDP&#39;s cpumap-redirect achieves higher throughput on a server with direct access to the NIC (XDP offloading possible) vs as a VM with bridges (generic XDP).</li>
</ul>
<h2 dir="auto"><a id="user-content-general-requirements" aria-hidden="true" href="#general-requirements"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>General Requirements</h2>
<ul dir="auto">
<li>VM or physical server. Physical server will perform better and better utilize all CPU cores.</li>
<li>One management network interface, completely seperate from the traffic shaping interfaces.</li>
<li>NIC supporting two interfaces for traffic shaping. Recommendations:
<ul dir="auto">
<li><a href="https://store.mellanox.com/products/nvidia-mcx4121a-xcat-connectx-4-lx-en-adapter-card-10gbe-dual-port-sfp28-pcie3-0-x8-rohs-r6.html" rel="nofollow">NVIDIA ConnectX-4 MCX4121A-XCAT</a></li>
<li><a href="https://www.fs.com/products/75600.html" rel="nofollow">Intel X710</a></li>
</ul>
</li>
<li>Ubuntu Server recommended. Ubuntu Desktop is not recommended as it uses NetworkManager instead of Netplan.</li>
<li>v0.9: Requires kernel version 5.9 or above for physical servers, and kernel version 5.14 or above for VM.</li>
<li>v0.8: Requires kernel version 5.1 or above.</li>
<li>Python 3, PIP, and some modules (listed in respective guides).</li>
<li>Choose a CPU with solid <a href="https://www.cpubenchmark.net/singleThread.html" rel="nofollow">single-thread performance</a> within your budget. Generally speaking, any new CPU above $200 can probably handle shaping up to 2Gbps.</li>
</ul>
<h2 dir="auto"><a id="user-content-installation-and-usage-guide" aria-hidden="true" href="#installation-and-usage-guide"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installation and Usage Guide</h2>
<p dir="auto">Best Performance, IPv4 Only:</p>
<p dir="auto"><g-emoji alias="page_facing_up" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4c4.png">📄</g-emoji> <a href="https://github.com/rchac/LibreQoS/wiki/LibreQoS-v0.9-Installation-&amp;-Usage-Guide----Physical-Server-and-Ubuntu-21.10">LibreQoS v0.9 Installation &amp; Usage Guide Physical Server and Ubuntu 21.10</a></p>
<p dir="auto">Good Performance, IPv4 Only:</p>
<p dir="auto"><g-emoji alias="page_facing_up" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4c4.png">📄</g-emoji> <a href="https://github.com/rchac/LibreQoS/wiki/LibreQoS-v0.9-Installation-&amp;-Usage-Guide----Proxmox-and-Ubuntu-21.10">LibreQoS v0.9 Installation &amp; Usage Guide Proxmox and Ubuntu 21.10</a></p>
<p dir="auto">OK Performance, IPv4 and IPv6:</p>
<p dir="auto"><g-emoji alias="page_facing_up" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4c4.png">📄</g-emoji> <a href="https://github.com/rchac/LibreQoS/wiki/LibreQoS-v0.8-Installation-&amp;-Usage-Guide----Proxmox-and-Ubuntu-20.04">LibreQoS 0.8 Installation and Usage Guide - Proxmox and Ubuntu 20.04 LTS</a></p>
<h2 dir="auto"><a id="user-content-donate" aria-hidden="true" href="#donate"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Donate</h2>
<p dir="auto">LibreQoS itself is Open-Source/GPL software: there is no cost to use it.</p>
<p dir="auto">LibreQoS makes great use of fq_codel - an open source project led by Dave Täht, and contributed to by dozens of others. Without Dave&#39;s work, there would be no LibreQoS, Preseem, or Saisei.</p>
<p dir="auto">If LibreQoS helps your network, please consider <a href="https://www.patreon.com/dtaht" rel="nofollow">donating to Dave&#39;s Patreon account.</a> Donating just $0.2/sub/month ($100/month for 500 subs) comes out to be 60% less than any proprietary solution, and you get to ensure continued development of fq_codel and its successor, CAKE.</p>
<a href="https://www.patreon.com/dtaht" rel="nofollow">
  <img src="https://raw.githubusercontent.com/rchac/LibreQoS/main/docs/donate.png" alt="Donate" width="289"/>
</a>
<h2 dir="auto"><a id="user-content-special-thanks" aria-hidden="true" href="#special-thanks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Special Thanks</h2>
<p dir="auto">Special thanks to Dave Täht, Jesper Dangaard Brouer, Toke Høiland-Jørgensen, Kumar Kartikeya Dwivedi, Maxim Mikityanskiy, Yossi Kuperman, and Rony Efraim for their many contributions to the Linux networking stack. Thank you Phil Sutter, Bert Hubert, Gregory Maxwell, Remco van Mook, Martijn van Oosterhout, Paul B Schroeder, and Jasper Spaans for contributing to the guides and documentation listed below. Thanks to Leo Manuel Magpayo for his help improving documentation and for testing. Thanks to everyone on the <a href="https://lists.bufferbloat.net/listinfo/" rel="nofollow">Bufferbloat mailing list</a> for your help and contibutions.</p>

<ul dir="auto">
<li><a href="https://tldp.org/HOWTO/Adv-Routing-HOWTO/lartc.adv-filter.hashing.html" rel="nofollow">https://tldp.org/HOWTO/Adv-Routing-HOWTO/lartc.adv-filter.hashing.html</a></li>
<li><a href="http://linux-ip.net/gl/tc-filters/tc-filters.html" rel="nofollow">http://linux-ip.net/gl/tc-filters/tc-filters.html</a></li>
<li><a href="http://linux-tc-notes.sourceforge.net/tc/doc/cls_u32.txt" rel="nofollow">http://linux-tc-notes.sourceforge.net/tc/doc/cls_u32.txt</a></li>
<li><a href="https://netdevconf.info/0x14/pub/papers/44/0x14-paper44-talk-paper.pdf" rel="nofollow">https://netdevconf.info/0x14/pub/papers/44/0x14-paper44-talk-paper.pdf</a></li>
</ul>

<p dir="auto">Copyright (C) 2020-2021 Robert Chacón</p>
<p dir="auto">LibreQoS is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 2 of the License, or
(at your option) any later version.</p>
<p dir="auto">LibreQoS is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.</p>
<p dir="auto">You should have received a copy of the GNU General Public License
along with LibreQoS.  If not, see <a href="http://www.gnu.org/licenses/" rel="nofollow">http://www.gnu.org/licenses/</a>.</p>
</article>
        </div></div>
  </body>
</html>
