<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/hishamk/statetrooper">Original</a>
    <h1>Show HN: State Trooper â€“ Tiny, no frills state machine for Go</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><div data-snippet-clipboard-copy-content="   ______       __        ______                          
  / __/ /____ _/ /____   /_  __/______  ___  ___  ___ ____
 _\ \/ __/ _ `/ __/ -_)   / / / __/ _ \/ _ \/ _ \/ -_) __/
/___/\__/\_,_/\__/\__/   /_/ /_/  \___/\___/ .__/\__/_/   
                                          /_/              "><pre><code>   ______       __        ______                          
  / __/ /____ _/ /____   /_  __/______  ___  ___  ___ ____
 _\ \/ __/ _ `/ __/ -_)   / / / __/ _ \/ _ \/ _ \/ -_) __/
/___/\__/\_,_/\__/\__/   /_/ /_/  \___/\___/ .__/\__/_/   
                                          /_/              
</code></pre></div>
<p dir="auto"><em>Tiny, no frills finite state machine for Go</em></p>
<p dir="auto"><a href="https://pkg.go.dev/github.com/hishamk/statetrooper?tab=doc" rel="nofollow"><img src="https://camo.githubusercontent.com/4d5cef96605f3df0d89e4e6cd67e9efce6735a861338876acf7015b710d7192b/68747470733a2f2f676f646f632e6f72672f6769746875622e636f6d2f68697368616d6b2f737461746574726f6f7065723f7374617475732e706e67" alt="GoDoc" data-canonical-src="https://godoc.org/github.com/hishamk/statetrooper?status.png"/></a>
<a href="https://raw.githack.com/wiki/hishamk/statetrooper/coverage.html" rel="nofollow"><img src="https://github.com/hishamk/statetrooper/wiki/coverage.svg" alt="Go Coverage"/></a>
<a href="https://goreportcard.com/report/github.com/hishamk/statetrooper" rel="nofollow"><img src="https://camo.githubusercontent.com/e5d8b49524b9031cb4b2ad30783113259afd4750ffbb18f507b5c5a0832365ef/68747470733a2f2f676f7265706f7274636172642e636f6d2f62616467652f6769746875622e636f6d2f68697368616d6b2f737461746574726f6f706572" alt="Go Report Card" data-canonical-src="https://goreportcard.com/badge/github.com/hishamk/statetrooper"/></a>
<a href="https://img.shields.io/github/license/hishamk/statetrooper" rel="nofollow"><img src="https://camo.githubusercontent.com/58ec01772b99032846b85b39e2e4d19137953e8ea863a798ac4c592bb5b5d3ea/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f68697368616d6b2f737461746574726f6f706572" alt="MIT" data-canonical-src="https://img.shields.io/github/license/hishamk/statetrooper"/></a> <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/7908dc0b54ee701dace303002b4d7cb658b3f9009fda7fe1a2bc3a62f337b8ae/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c616e6775616765732f636f64652d73697a652f68697368616d6b2f737461746574726f6f706572"><img src="https://camo.githubusercontent.com/7908dc0b54ee701dace303002b4d7cb658b3f9009fda7fe1a2bc3a62f337b8ae/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c616e6775616765732f636f64652d73697a652f68697368616d6b2f737461746574726f6f706572" alt="Code size" data-canonical-src="https://img.shields.io/github/languages/code-size/hishamk/statetrooper"/></a></p>
<p dir="auto">StateTrooper is a Go package that provides a finite state machine (FSM) for managing states. It allows you to define and enforce state transitions based on predefined rules.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Features</h2>
<ul dir="auto">
<li>Generic support for different comparable types</li>
<li>Transition history with metadata</li>
<li>Thread safe</li>
<li>Super minimal - no triggers/events or actions/callbacks. For my use case I just needed a structured, serializable way to constrain and track state transitions.</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<p dir="auto">To install StateTrooper, use the following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="go get github.com/hishamk/statetrooper"><pre>go get github.com/hishamk/statetrooper</pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage</h2>
<p dir="auto">Import the <code>statetrooper</code> package into your Go code:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import &#34;github.com/hishamk/statetrooper&#34;"><pre><span>import</span> <span>&#34;github.com/hishamk/statetrooper&#34;</span></pre></div>
<p dir="auto">Create an instance of the FSM with the desired state enum type and initial state:</p>
<div dir="auto" data-snippet-clipboard-copy-content="fsm := statetrooper.NewFSM[CustomStateEnum](CustomStateEnumA)"><pre><span>fsm</span> <span>:=</span> <span>statetrooper</span>.<span>NewFSM</span>[<span>CustomStateEnum</span>](<span>CustomStateEnumA</span>)</pre></div>
<p dir="auto">Add valid transitions between states:</p>
<div dir="auto" data-snippet-clipboard-copy-content="fsm.AddRule(CustomStateEnumA, CustomStateEnumB)
fsm.AddRule(CustomStateEnumB, CustomStateEnumC)"><pre><span>fsm</span>.<span>AddRule</span>(<span>CustomStateEnumA</span>, <span>CustomStateEnumB</span>)
<span>fsm</span>.<span>AddRule</span>(<span>CustomStateEnumB</span>, <span>CustomStateEnumC</span>)</pre></div>
<p dir="auto">Check if a transition from the current state to the target state is valid:</p>
<div dir="auto" data-snippet-clipboard-copy-content="canTransition := fsm.CanTransition(targetState)"><pre><span>canTransition</span> <span>:=</span> <span>fsm</span>.<span>CanTransition</span>(<span>targetState</span>)</pre></div>
<p dir="auto">Transition the entity from the current state to the target state with no metadata:</p>
<div dir="auto" data-snippet-clipboard-copy-content="newState, err := fsm.Transition(targetState, nil)
if err != nil {
    // Handle the error
}"><pre><span>newState</span>, <span>err</span> <span>:=</span> <span>fsm</span>.<span>Transition</span>(<span>targetState</span>, <span>nil</span>)
<span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
    <span>// Handle the error</span>
}</pre></div>
<p dir="auto">Transition the entity from the current state to the target state with metadata:</p>
<div dir="auto" data-snippet-clipboard-copy-content=" newState, err := fsm.Transition(
 	CustomStateEnumB,
 	map[string]string{
 		&#34;requested_by&#34;:  &#34;Mahmoud&#34;,
 		&#34;logic_version&#34;: &#34;1.0&#34;,
 	})"><pre> <span>newState</span>, <span>err</span> <span>:=</span> <span>fsm</span>.<span>Transition</span>(
 	<span>CustomStateEnumB</span>,
 	<span>map</span>[<span>string</span>]<span>string</span>{
 		<span>&#34;requested_by&#34;</span>:  <span>&#34;Mahmoud&#34;</span>,
 		<span>&#34;logic_version&#34;</span>: <span>&#34;1.0&#34;</span>,
 	})</pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-benchmark" aria-hidden="true" href="#benchmark"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Benchmark</h2>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>Iterations</th>
<th>Time per Iteration</th>
<th>Memory Allocation per Iteration</th>
<th>Allocations per Iteration</th>
</tr>
</thead>
<tbody>
<tr>
<td>Benchmark_transition-8</td>
<td>363,970</td>
<td>2,975 ns/op</td>
<td>2,187 B/op</td>
<td>12 allocs/op</td>
</tr>
</tbody>
</table>
<h2 tabindex="-1" dir="auto"><a id="user-content-example" aria-hidden="true" href="#example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Example</h2>
<p dir="auto">Here&#39;s an example usage with a custom entity struct and state enum:</p>
<div dir="auto" data-snippet-clipboard-copy-content="type OrderStatusEnum string

// Enum values for the custom entity
const (
	StatusPacked    OrderStatusEnum = &#34;packed&#34;
	StatusShipped   OrderStatusEnum = &#34;shipped&#34;
	StatusDelivered OrderStatusEnum = &#34;delivered&#34;
)

// Order represents a custom entity with its current state
type Order struct {
	State *statetrooper.FSM[OrderStatusEnum]
}

func main() {
	entity := &amp;Order{State: statetrooper.NewFSM[OrderStatusEnum](StatusPacked)}
	entity.State.AddRule(StatusPacked, StatusShipped)
	entity.State.AddRule(StatusShipped, StatusDelivered)

	// Check if a transition is valid
	canTransition := entity.State.CanTransition(StatusShipped)
	fmt.Printf(&#34;Can transition to %s: %t\n&#34;, StatusShipped, canTransition)

	// Transition to a new state
	_, err := entity.State.Transition(StatusShipped, nil)

	if err != nil {
		fmt.Println(&#34;Transition error:&#34;, err)
	} else {
		fmt.Println(&#34;Transition successful. Current state:&#34;, *entity.State.CurrentState)
	}
}"><pre><span>type</span> <span>OrderStatusEnum</span> <span>string</span>

<span>// Enum values for the custom entity</span>
<span>const</span> (
	<span>StatusPacked</span>    <span>OrderStatusEnum</span> <span>=</span> <span>&#34;packed&#34;</span>
	<span>StatusShipped</span>   <span>OrderStatusEnum</span> <span>=</span> <span>&#34;shipped&#34;</span>
	<span>StatusDelivered</span> <span>OrderStatusEnum</span> <span>=</span> <span>&#34;delivered&#34;</span>
)

<span>// Order represents a custom entity with its current state</span>
<span>type</span> <span>Order</span> <span>struct</span> {
	<span>State</span> <span>*</span>statetrooper.<span>FSM</span>[<span>OrderStatusEnum</span>]<span></span>
}

<span>func</span> <span>main</span>() {
	<span>entity</span> <span>:=</span> <span>&amp;</span><span>Order</span>{<span>State</span>: <span>statetrooper</span>.<span>NewFSM</span>[<span>OrderStatusEnum</span>](<span>StatusPacked</span>)}
	<span>entity</span>.<span>State</span>.<span>AddRule</span>(<span>StatusPacked</span>, <span>StatusShipped</span>)
	<span>entity</span>.<span>State</span>.<span>AddRule</span>(<span>StatusShipped</span>, <span>StatusDelivered</span>)

	<span>// Check if a transition is valid</span>
	<span>canTransition</span> <span>:=</span> <span>entity</span>.<span>State</span>.<span>CanTransition</span>(<span>StatusShipped</span>)
	<span>fmt</span>.<span>Printf</span>(<span>&#34;Can transition to %s: %t<span>\n</span>&#34;</span>, <span>StatusShipped</span>, <span>canTransition</span>)

	<span>// Transition to a new state</span>
	<span>_</span>, <span>err</span> <span>:=</span> <span>entity</span>.<span>State</span>.<span>Transition</span>(<span>StatusShipped</span>, <span>nil</span>)

	<span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
		<span>fmt</span>.<span>Println</span>(<span>&#34;Transition error:&#34;</span>, <span>err</span>)
	} <span>else</span> {
		<span>fmt</span>.<span>Println</span>(<span>&#34;Transition successful. Current state:&#34;</span>, <span>*</span><span>entity</span>.<span>State</span>.<span>CurrentState</span>)
	}
}</pre></div>
<p dir="auto">Note that states can be defined using any comparable type, such as strings, int, etc e.g.:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// CustomStateEnum represents the state enum for the custom entity
type CustomStateEnum int

// Enum values for the custom entity
const (
	CustomStateEnumA CustomStateEnum = iota
	CustomStateEnumB
	CustomStateEnumC
)
"><pre><span>// CustomStateEnum represents the state enum for the custom entity</span>
<span>type</span> <span>CustomStateEnum</span> <span>int</span>

<span>// Enum values for the custom entity</span>
<span>const</span> (
	<span>CustomStateEnumA</span> <span>CustomStateEnum</span> <span>=</span> <span>iota</span>
	<span>CustomStateEnumB</span>
	<span>CustomStateEnumC</span>
)</pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>License</h2>
<p dir="auto">This package is licensed under the MIT License. See the <a href="https://github.com/hishamk/statetrooper/blob/main/LICENSE.md">LICENSE</a> file for details.</p>
</article>
          </div></div>
  </body>
</html>
