<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://doubleagent.net/2023/05/21/a-car-battery-monitor-tracking-your-location">Original</a>
    <h1>Discovering that a Bluetooth car battery monitor is siphoning location data</h1>
    
    <div id="readability-page-1" class="page"><section itemprop="text">
        
          
        
        
<ul>
  <li>A Bluetooth enabled battery monitor that records car battery voltages. The hardware requires a smartphone for pairing</li>
  <li>The product collects GPS co-ordinates, cell phone tower data and nearby Wifi beacons</li>
  <li>Location data is sent over the Internet to servers in Hong Kong and mainland China</li>
  <li>App store misleads consumers by stating that no personal data is collected or shared. Since the Android app requires location permissions to use the hardware device, users are effectively forced to continuously broadcast their physical location to 3rd parties in order to use the product.</li>
</ul>

<p><strong>There are no legitimate reason for a car battery monitor application to track it’s user’s location. With over 100,000 downloads on Android alone, this raises significant privacy concerns</strong></p>
<hr/>

<p>In this three part series:</p>
<ul>
  <li><a href="https://doubleagent.net/2023/05/21/a-car-battery-monitor-tracking-your-location.html">Part 1</a> - This page</li>
  <li><a href="https://doubleagent.net/2023/05/22/a-car-battery-monitor-tracking-your-location-part2.html">Part 2</a> - Reverse engineering the AMap SDK location tracking features</li>
  <li><a href="https://doubleagent.net/hardware/ble/bluetooth/2023/05/23/a-car-battery-monitor-tracking-your-location-part3.html">Part 3</a> - Reimplementing BLE functionality and obtaining the firmware</li>
</ul>
<hr/>

<p>Within this series of posts, we explore the discovery of an Bluetooth enabled battery voltage product, acquired from a popular electronics retailer in Australia. What started as an initial hunch lead me down rabbit a rabbit hole to discover that the app covertly tracks the users physical location. It collects GPS co-ordinates, neighbouring cell phone tower location data and Wifi access points, sending this data to cloud servers in Hong Kong and mainland China.</p>

<p>At the time of writing, location data is sent to:
<code>dualstack-cgicol.amap.com</code>/ <code>106.11.130.194</code> (Alibaba Cloud, Beijing) and 
<code>bm2.quicklynks.com</code> /  <code>47.244.125.231</code> (Alibaba Cloud, Hong Kong)</p>

<p>Partly responsible for the extensive data collection is an embedded library used, called <a href="https://amap.com">AMap</a>, which is a “leading provider of digital map in China”.</p>

<p><a href="https://www.alibabacloud.com/customers/autonavi">Acquired</a> by Alibaba, it is stated that “In 2018, Amap became the first Chinese maps service to navigate a path to 100 million daily users”. In <a href="https://doubleagent.net/2023/05/22/a-car-battery-monitor-tracking-your-location-part2.html">part 2</a> we look under the hood at how AMap is not only collecting the GPS co-ordinates, but also every other possible location data the phone can collect - surveying Wifi and telecommunication cell phone tower data.</p>

<p>The Android application which connects to the battery monitor device, <a href="https://play.google.com/store/apps/details?id=com.dc.battery.monitor2">BM2</a> 100K+ downloads, with 1.55K reviews.</p>

<p>The iPhone iOS version <a href="https://apps.apple.com/au/app/battery-monitory-bm2/id1115492033">can be found here</a>. While I have not peformed any static analysis on the iOS decompilations to date, inspection of the network traffic from the phone reveals that that the Apple iPhone version is also sending location data to remote servers.</p>

<p>Feel free to reach out to me <a href="https://twitter.com/haxrob">on twitter</a> for partially reverse engineered decompilation of the sources referenced. The subsequent posts should provide enough detail for others to independently verify what is being reported.</p>

<figure>
   <img src="https://doubleagent.net/assets/images/bm/wireshark2.png"/>
   <figcaption>A wireshark trace of mobile traffic</figcaption>
</figure>


<p>I acquired the  vehicle battery monitoring Bluetooth device sold under the brand PowerTech from a popular Australian electronics retailer, <a href="https://www.jaycar.com.au/">Jaycar Electronics</a>.</p>

<p><a href="https://www.jaycar.com.au/12v-battery-monitor-with-bluetooth-technology/p/QP2265" target="_blank"><img src="https://doubleagent.net/assets/images/bm/jaycar1.png"/></a></p>

<p>This appears to be a re-branded <a href="https://www.leagend.com/pro_show.php?id=159">Bluetooth 4.0 Battery Monitor</a> by a company called <a href="https://www.leagend.com/">Leagend</a> which is available on <a href="https://www.amazon.com/Antigravity-Batteries-Bluetooth-Wireless-Compatible/dp/B09W4R2L8P/ref=sr_1_8?keywords=Battery+Monitor+BM2&amp;sr=8-8">Amazon</a> for purchase.</p>

<p>It’s resold under local brands, for example another popular auto retailer, Repco, <a href="https://www.repco.com.au/globes-batteries-electrical/battery-chargers-power-accessories/battery-accessories/century-battery-monitor-for-smartphone-191020/p/A5492004">sells it under the Century brand</a>.</p>

<p>Other device names are “ZX-1689” and “Li Battery Monitor” which the application looks for in the device name of the advertising BLE beacon which are indentified in <a href="https://doubleagent.net/hardware/ble/bluetooth/2023/05/23/a-car-battery-monitor-tracking-your-location-part3.html">part3</a>.</p>

<p>The device is quite simple - you connect it to the terminals of a battery and pair it with your phone. It shows the battery voltage/percentage and allows you to run some crank tests. That’s what’s advertised.</p>

<figure>
   <a href="https://doubleagent.net/assets/images/bm/powertech.png"><img src="https://doubleagent.net/assets/images/bm/powertech.png"/></a>
   <a href="https://doubleagent.net/assets/images/bm/repco_bm.png"><img src="https://doubleagent.net/assets/images/bm/repco_bm.png"/></a>
   <figcaption>Jaycar (Powertech) and Repco (Century) branded BM devices</figcaption>
</figure>
<p>Additionally, the required application runs in the background, effectively turning a smart phone into location scanning device. Having your phone become a continuous Wifi scanner drains the battery - and this isn’t something legitimate application developers want. People do complain about issues caused. Patrick’s review of the BM2 app would agree:</p>

<p><img src="https://doubleagent.net/assets/images/bm/review1.png"/></p>

<p>While we can’t explain the legitimate reason a battery voltage monitor would need to know your GPS location, a charitable explanation of the AMap SDK collecting GPS, Wifi and cell tower data is they are attempting to do what Google and Apple already do - build a relational database, mapping phone cell towers and wifi access points to GPS co-ordinates. When a phone has bad GPS signal, knowing the adjacent Wifi access points or phone towers within reception can help increase accuracy.</p>

<div>
<p><strong>Some terminology</strong></p>

<p>AMap collects the telecomunication provider’s adjacent cell phone tower location data - Specifically the <a href="https://en.wikipedia.org/wiki/Cell_Global_Identity">cell global identity</a>. This is an ID that uniquely identifies a cell, unique across the whole world.</p>

<p>The CGI is made up of:</p>

<p>In 4G, technically <code>TAC</code> (tracking area code) is used.
<img src="https://doubleagent.net/assets/images/bm/cgi.png"/></p>

<p>Wifi data collection includes:</p>

<p><code>BSSID</code> MAC address of Wifi access points.</p>

</div>

<p>The AMap developers go to lengths to conceal the behaviour, encrypting any data before it touches disk or sent over the Internet. Location data is encrypted with ephemeral AES keys which is then encrypted with a public RSA key. This removes the dependency for certificate pinning and ensures man-in-the-middle inspection of the network traffic is not possible without modifications to the application or obtaining the corresponding private RSA key.</p>

<h2 id="data-privacy">Data privacy</h2>

<p><strong>Note:</strong> As of 27th of June 2023, the BM2 app developer have updated the privacy statements on both the Google Play and Apple App stores - now mentioning that precise location data is being collected.</p>

<p>The following is stated on the BM2 app <a href="https://play.google.com/store/apps/details?id=com.dc.battery.monitor2">Android Play store</a>: 
<a href="https://doubleagent.net/assets/images/bm/android-data.png"><img src="https://doubleagent.net/assets/images/bm/android-data.png"/></a></p>

<p>One by one, let’s review the statements claimed:</p>

<p><strong>1. No data shared with third parties</strong></p>

<ul>
  <li>In addition to your battery statistics (e.g. voltage), the latitude and longitude co-ordinates of your location is sent to the <code>BM2</code> application cloud servers, <code>quicklynks.com</code></li>
  <li>Crash analytics are sent to a 3rd party Chinese company, <code>umeng.com</code></li>
  <li>Wifi, cell phone tower and GPS co-ordinates are sent to a Chinese company, <a href="https://amap.com">AMap</a></li>
</ul>

<p><strong>2. No data collected</strong></p>

<ul>
  <li>Self explanatory</li>
</ul>

<p><strong>3. Data is encrypted in transit</strong></p>
<ul>
  <li>Data sent to the <code>BM2</code> cloud servers is <em>unencrypted</em></li>
</ul>

<p>How about on the Apple store? <a href="https://apps.apple.com/au/app/battery-monitory-bm2/id1115492033">take a look</a></p>

<p>The <a href="http://doc.quicklynks.com/bm2/privacy-policy/index.html">privacy policy fine print</a> does mention “Hong Kong” and “location information”. We all read the fine print right?</p>

<p><a href="https://doubleagent.net/assets/images/bm/privacy-policy.png"><img src="https://doubleagent.net/assets/images/bm/privacy-policy.png"/></a></p>

<h2 id="location-and-android-permissions">Location and Android permissions</h2>

<p>For the application to work, you must give the Android application permissions that let it obtain location information otherwise it won’t work: For Bluetooth scanning, Android requires this permission. At least with the iOS version, you can hit “deny” when it asks for location permissions and the battery monitor device will still work.</p>

<p>To expand on the reason cited, it’s best explained from Android’s developer <a href="https://developer.android.com/about/versions/marshmallow/android-6.0-changes#behavior-hardware-id">documentation</a>:</p>

<blockquote>
  <p>To provide users with greater data protection, starting in this release, Android removes programmatic access to the device’s local hardware identifier for apps using the Wi-Fi and Bluetooth APIs. 
To access the hardware identifiers of nearby external devices via Bluetooth and Wi-Fi scans, your app must now have the <code>[ACCESS_FINE_LOCATION]</code> or <code>[ACCESS_COARSE_LOCATION]</code> permissions.</p>
</blockquote>

<p>I would argue that such a broad permission that covers both Bluetooth, GPS and Cell data offers lower data protections - as it opens up app developers to abuse this permission as we see with the <code>BM2</code> application that really just requires BLE scanning. BLE scanning can be achieved with just <a href="https://developer.android.com/reference/android/Manifest.permission?hl=en#BLUETOOTH_SCAN">BLUETOOTH_SCAN</a>, available on Android 12+.</p>

<p><strong>Update 2023-06-27</strong> Google provide further guidance <a href="https://developer.android.com/guide/topics/connectivity/bluetooth/permissions">here</a>. It is possible to specify <code>ACCESS_FINE_LOCATION</code> with <code>android:usesPermissionFlags</code> set to <code>neverForLocation</code>. This is only for when Bluetooth scan results are used to derive physical location. That does not seem to be the case here though.</p>


<p>Our interest lies mostly in the phone applications that interface with the hardware, although it’s customary to at least take a peek inside and explore what the possibilities are for pulling off the firmware.</p>

<p>Not much too it; some voltage regulators and a single SoC - a Texas Instruments <a href="https://www.ti.com/product/CC2541"><code>CC2541</code></a>) all in one Bluetooth Low Energy MCU. Datasheet <a href="https://www.ti.com/lit/gpn/cc2541">here</a>. Some possible debug ports are spotted:</p>
<figure>
   <a href="https://doubleagent.net/assets/images/bm/CC2541.png"><img src="https://doubleagent.net/assets/images/bm/CC2541.png"/></a>
   <a href="https://doubleagent.net/assets/images/bm/caseoff.png"><img src="https://doubleagent.net/assets/images/bm/caseoff.png"/></a>
   <figcaption>Click to enlarge</figcaption>
</figure>
<p>The CPU is based on an 8 bit <a href="https://en.wikipedia.org/wiki/Intel_8051">Intel 8051</a>. Later revisions of the CC series use ARM cortex architecture.</p>

<p>According to the specifications, the <code>CC</code> series SoCs support on chip debugging via a proprietary interface - No JTAG or SWD to be seen here. This means we will need the <a href="https://www.ti.com/lit/ug/swru197h/swru197h.pdf?ts=1682031089150&amp;ref_url=https%253A%252F%252Fwww.ti.com%252Ftool%252FCC-DEBUGGER">CC Debugger</a> or try some custom <a href="https://github.com/wavesoft/CCLib">Arduino implementation</a>, although this specific IC is not supported. As the device supports over-the-air updates, there is a REST endpoint which will return the firmware over HTTP, documented in <a href="https://doubleagent.net/hardware/ble/bluetooth/2023/05/23/a-car-battery-monitor-tracking-your-location-part3.html">part 3</a></p>

<p>It appears there is no <a href="https://en.wikipedia.org/wiki/Current_sensing">shunt</a> or other current sensing circuity. Hardware wise, this really is as simple as it gets.</p>

<h2 id="the-test-setup">The test setup</h2>
<p>For testing I’m using a small led acid 12v battery with the <code>BM2</code> battery monitor and a rooted Android handset which will be used for dynamic instrumentation.</p>

<p>Notably, the setup sat on my desk. As we discover in <a href="https://doubleagent.net/2023/05/22/a-car-battery-monitor-tracking-your-location-part2.html">part 2</a> of this blog post series, the AMap location data is only written to it’s database from memory when it detects you are physically moving. To overcome this and other hurdles, <a href="https://frida.re/docs/android/">Frida</a> and <a href="https://github.com/sensepost/objection">Objection</a> used extensively to instrument the running software in run time.</p>

<figure>
   <img src="https://doubleagent.net/assets/images/bm/testsetup.png"/>
</figure>


<h2 id="intercepting-network-traffic">Intercepting network traffic</h2>
<p><a href="https://mitmproxy.org/">Mitmproxy</a> is a defacto “in the middle” proxy software and it now supports a new mode using  <a href="https://mitmproxy.org/posts/wireguard-mode/">wireguard</a>. What this means is it’s extremely trivial (and quick) to peek inside mobile application traffic with minimal configuration. Once the <a href="https://www.wireguard.com/">Wireguard</a> application is installed on the handset, simply <code>mitmweb --mode=wireguard</code> and take a scan the QR code on screen by taking an image from the handset. Immediately all traffic from the handset will be sent over a Wireguard tunnel to mitmproxy. Browsing to http://mitm.it then allows you to download a certificate to add to the trust store. With iOS the process is trivial. Android has now made it harder to do, and in this case I had to use a rooted handset.</p>

<p><strong>Note</strong>: Since the <code>BM2</code> does not use HTTPS, there is no need to even install a certificate. What this means is that anyone can independently identify that their latitude and longitude co-ordinates are being sent on either iOS or Android with no modifications to their phone.</p>

<p>After the application connects to the battery monitor device,  we see a <code>POST</code> request is sent to <code>http://bm2.quicklynks.com:8080/api/bm2/userDevice/upload?</code>.</p>

<p>Latitude and longitude fields are highlighted in green.</p>

<figure>
   <img src="https://doubleagent.net/assets/images/bm/port8080.png"/>
</figure>

<p>At the time of writing, this server resolves to a host in Alibaba cloud, HK:</p>
<div><div><pre><code><span>$ </span>host bm2.quicklynks.com
bm2.quicklynks.com has address 47.244.125.231
</code></pre></div></div>
<div><div><pre><code><span>$</span><span> </span><span>curl</span><span> </span><span>https://ipinfo.io/</span><span>47.244</span><span>.</span><span>125.231</span><span>
</span><span>{</span><span>
  </span><span>&#34;ip&#34;</span><span>:</span><span> </span><span>&#34;47.244.125.231&#34;</span><span>,</span><span>
  </span><span>&#34;city&#34;</span><span>:</span><span> </span><span>&#34;Sham Shui Po&#34;</span><span>,</span><span>
  </span><span>&#34;region&#34;</span><span>:</span><span> </span><span>&#34;Sham Shui Po&#34;</span><span>,</span><span>
  </span><span>&#34;country&#34;</span><span>:</span><span> </span><span>&#34;HK&#34;</span><span>,</span><span>
  </span><span>&#34;loc&#34;</span><span>:</span><span> </span><span>&#34;22.3302,114.1595&#34;</span><span>,</span><span>
  </span><span>&#34;org&#34;</span><span>:</span><span> </span><span>&#34;AS45102 Alibaba (US) Technology Co., Ltd.&#34;</span><span>,</span><span>
  </span><span>&#34;timezone&#34;</span><span>:</span><span> </span><span>&#34;Asia/Hong_Kong&#34;</span><span>,</span><span>

</span><span>}</span><span>
</span></code></pre></div></div>
<p>In this specific request we also see a sample of the battery voltages, the hardware MAC address of the device (<code>nickname</code> and <code>serialNo</code>).</p>

<div>
<p><strong>Spoofing GPS co-ordinates</strong></p>

<p>GPS co-ordinates can be spoofed by using the following <a href="https://frida.re/">Frida</a> to dynamically hook into <code>android.location.Location.{getLatitude|getLongitude}</code> methods. Frida will be used extensively in our testing. More on this later.</p>

<p><code>location.js</code></p>
<div><div><pre><code><span>const</span> <span>lat</span> <span>=</span> <span>39.1090</span><span>;</span>
<span>const</span> <span>lng</span> <span>=</span> <span>-</span><span>76.7700</span><span>;</span>

<span>Java</span><span>.</span><span>perform</span><span>(</span><span>function </span><span>()</span> <span>{</span>
   <span>var</span> <span>hookedClass</span> <span>=</span> <span>&#34;</span><span>android.location.Location</span><span>&#34;</span>
	<span>var</span> <span>Location</span> <span>=</span> <span>Java</span><span>.</span><span>use</span><span>(</span><span>hookedClass</span><span>);</span>
	<span>Location</span><span>.</span><span>getLatitude</span><span>.</span><span>implementation</span> <span>=</span> <span>function</span><span>()</span> <span>{</span>
      <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;</span><span>[+] </span><span>&#34;</span> <span>+</span> <span>hookedClass</span> <span>+</span> <span>&#34;</span><span>new lat:</span><span>&#34;</span> <span>+</span> <span>lat</span><span>);</span>
		<span>return</span> <span>lat</span><span>;</span>
	<span>}</span>
	<span>Location</span><span>.</span><span>getLongitude</span><span>.</span><span>implementation</span> <span>=</span> <span>function</span><span>()</span> <span>{</span>
      <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;</span><span>[+] </span><span>&#34;</span> <span>+</span> <span>hookedClass</span> <span>+</span> <span>&#34;</span><span>new lng:</span><span>&#34;</span> <span>+</span> <span>lng</span><span>);</span>
		<span>return</span> <span>lng</span><span>;</span>
	<span>}</span>
<span>})</span>
</code></pre></div></div>
<p>To invoke:
<code>$ frida -U -l location.js -f com.dc.battery.monitor2</code></p>
</div>

<h2 id="memory-analysis">Memory analysis</h2>

<p>As stated earlier, GPS, Wifi and cell data is gathered by the embedded AMap library. The code is obsfucated to make reverse engineering more time consuming. Anything that touches disk or the network is encrypted serialized binary blobs. This calls for some quick wins with dynamic instrumentation as the code runs on a handset while paired to the hardware battery monitor.</p>

<p>For example, we can peek inside the application’s heap memory. For this we will use a plugin for <a href="https://github.com/sensepost/objection">Objection</a> called <a href="https://github.com/hluwa/Wallbreaker">Wallbreaker</a>. After some quick analysis of the AMap library we know what class names to find instances in memory (click pictures to expand):</p>

<p>GPS data:
<a href="https://doubleagent.net/assets/images/bm/obj3.png"><img src="https://doubleagent.net/assets/images/bm/obj3.png"/></a></p>

<p>Telecommuncation provider cell data:
<a href="https://doubleagent.net/assets/images/bm/obj1.png"><img src="https://doubleagent.net/assets/images/bm/obj1.png"/></a></p>

<p>Wifi data (toString() enumerated):
<a href="https://doubleagent.net/assets/images/bm/obj2.png"><img src="https://doubleagent.net/assets/images/bm/obj2.png"/></a></p>


<h2 id="decompilation">Decompilation</h2>
<p>First let’s grab the APK straight off the handset. We could of course get a copy from APK pure too from <a href="https://m.apkpure.com/bm2/com.dc.battery.monitor2">here</a></p>

<p>First identify the application name identifier which is <code>com.dc.battery.monitor2</code>:</p>

<p><img src="https://doubleagent.net/assets/images/bm/adb1.png"/></p>

<p>Obtain the path of the APK and pull it from the device with <code>adb shell pm path</code> then pull it off the phone.</p>

<p><img src="https://doubleagent.net/assets/images/bm/adb2.png"/></p>

<p><a href="https://github.com/skylot/jadx">JADX</a> is our choice for the de-compiler, and it’s just great. Opening the <code>.apk</code> and it handles everything in one shot, from decompression to de-compiling the java bytecode into Java.</p>

<p>The very first thing is to check the permissions in <code>AndroidManifest.xml</code> after opening the APK in APK in <code>jadx-gui</code></p>

<p>The hightlights in green raises a few questions. We have explained why <code>FINE_LOCATION</code> is required, but why would a battery monitor application needs <code>CAMERA</code>, <code>IMAGE_CAPTURE</code>, <code>ACTION_VIDEO_CAPTURE</code>, <code>MODIFY_AUDIO_SETTINGS</code> and <code>RECORD_AUDIO</code> ?</p>

<p><img src="https://doubleagent.net/assets/images/bm/JADX1.png"/></p>

<p>At this point it’s possible that this functionality is unused. More investigation is needed here.</p>

<p>Very quickly we see that the decompilation of the java bytecode directly from the APK is going to be problematic. The entrypoint is <code>com.stub.StubApp</code> which has methods names obsfucated with xor encryption which indicates there is more work to do.</p>

<div><div><pre><code>&lt;application android:theme=&#34;@style/AppTheme&#34; android:label=&#34;@string/apk_release_name&#34; android:icon=&#34;@mipmap/ic_launcher&#34; android:name=&#34;com.stub.StubApp&#34;
</code></pre></div></div>

<p><img src="https://doubleagent.net/assets/images/bm/JADX2.png"/></p>

<p>Fortunantly it’s obvious that a commercial software packer called <code>qihoo.util</code> has been used. Zimperium has a <a href="https://www.zimperium.com/blog/dissecting-mobile-native-code-packers-case-study/">good writeup</a> on this packer as it’s often found employeed in Chinese based mobile malware. It’s somewhat advanced in the sense that the unpacked software is encrypted and packed into native, compiled library. People have written unpacking tools that claim to handle this packer such as <a href="https://github.com/strazzere/android-unpacker">android-unpacker</a>. Given that developers often update and change their packing techniques, the unpacker tools in the public domain can quickly become outdated.</p>

<p>As such we will take much easier approach - by using <a href="https://github.com/hluwa/frida-dexdump">frida-dexdump</a> it’s possible to dump the original (unpacked) mobile application Dalvik executable bytecode from memory after opening the application on the handset.</p>

<p>Qihoo 360 is not without their own <a href="https://en.wikipedia.org/wiki/Qihoo_360">contraversy</a>, being “placed on the <a href="https://en.wikipedia.org/wiki/Bureau_of_Industry_and_Security" title="Bureau of Industry and Security">Bureau of Industry and Security</a>’s <a href="https://en.wikipedia.org/wiki/Entity_List" title="Entity List">Entity List</a> due to U.S. national security concerns”.</p>

<p>After installing dexdump (e.g. <code>pip3 install frida-dexdump</code>), run it after opening the application:</p>
<div><div><pre><code>frida-dexdump -U -f com.dc.battery.monitor2 -d
</code></pre></div></div>

<p>Use <a href="https://github.com/pxb1988/dex2jar">dex2jar</a> to covert <code>classes.dex</code> to java bytecode:</p>
<div><div><pre><code>./d2j-dex2jar.sh ./com.sec.android.app.samsungapps/classes.dex
</code></pre></div></div>

<p>We can the use jadx to then decompile into readable java and now have the original application code, method names, variable names for <code>com.dc.battery.monitor2</code>, as no further obfuscation was done outside of the initial packing/encrypting.</p>

<p>The exception here is the <code>amap</code> location services SDK library which was originally obsfucated which will make our time a little harder to reverse these parts. Fortunately class names are recoverable for the AMap related classes by selecting <code>tools -&gt; deobsfucation</code> in JADX.</p>

<p>While the variable or method names are random(ish) strings, the recovered class names are descriptive enough that with some effort the function of the classes and methods is identified with method and variables renamed appropriately by hand.</p>

<p>Next up, in <a href="https://doubleagent.net/2023/05/22/a-car-battery-monitor-tracking-your-location-part2.html">part 2</a> we will investigate how the embedded AMap SDK is not only sending the GPS co-ordinates, but Wifi and telecommunication cell tower data.</p>

        
      </section></div>
  </body>
</html>
