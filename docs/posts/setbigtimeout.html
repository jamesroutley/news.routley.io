<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://evanhahn.com/set-big-timeout/">Original</a>
    <h1>setBigTimeout</h1>
    
    <div id="readability-page-1" class="page"><div><p><em>In short: JavaScript’s <code>setTimeout</code> breaks after ~25 days. I made <code>setBigTimeout</code>, a silly module to get around this problem. See <a href="https://www.npmjs.com/package/setbigtimeout">the package on npm</a> or <a href="https://git.sr.ht/~evanhahn/setBigTimeout">the source code</a>.</em></p><p><code>setTimeout</code> is JavaScript’s way of delaying code. You provide a timeout, in milliseconds, and a function to call after that time has elapsed.<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup></p><div><pre tabindex="0"><code data-lang="javascript"><span><span>setTimeout(() =&gt; {
</span></span><span><span>  console.log(<span>&#34;This runs after 2 seconds&#34;</span>);
</span></span><span><span>}, <span>2000</span>);
</span></span></code></pre></div><p>So far, so good.</p><p>In most JavaScript runtimes, this duration is represented as a 32-bit signed integer. That means the maximum timeout is about 2.1 billion milliseconds, or about 24.9 days. <em>That’s plenty of time for most people, but not for freaks like me.</em> If you try to set a bigger timeout, weird things happen.</p><p>For example, if you try setting a timeout to 40 days, the function runs immediately.</p><div><pre tabindex="0"><code data-lang="javascript"><span><span><span>const</span> FORTY_DAYS_IN_MILLISECONDS = <span>3.456</span>e9;
</span></span><span><span>setTimeout(() =&gt; {
</span></span><span><span>  console.log(<span>&#34;This executes immediately!?&#34;</span>);
</span></span><span><span>}, FORTY_DAYS_IN_MILLISECONDS);
</span></span></code></pre></div><p>This feels like a bug to me. Shouldn’t this wait 40 days?</p><p>Enter <code>setBigTimeout</code>, a cursed module I made to address this.</p><p><code>setBigTimeout</code> works just like <code>setTimeout</code><sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup> but it can take very big delays.</p><div><pre tabindex="0"><code data-lang="javascript"><span><span><span>import</span> { setBigTimeout } from <span>&#34;setbigtimeout&#34;</span>;
</span></span><span><span>
</span></span><span><span><span>const</span> EIGHTY_FOUR_YEARS_IN_MILLISECONDS = <span>2.65</span>e12;
</span></span><span><span>setBigTimeout(() =&gt; {
</span></span><span><span>  console.log(<span>&#34;It&#39;s been 84 years...&#34;</span>);
</span></span><span><span>}, EIGHTY_FOUR_YEARS_IN_MILLISECONDS);
</span></span></code></pre></div><p>You can also pass <code>bigint</code> delays to delay things for an extremely long time:</p><div><pre tabindex="0"><code data-lang="javascript"><span><span><span>const</span> ONE_MILLION_YEARS = <span>31536000000000000</span>n;
</span></span><span><span>setBigTimeout(() =&gt; {
</span></span><span><span>  console.log(<span>&#34;JAVASCRIPT WILL NEVER DIE&#34;</span>);
</span></span><span><span>}, ONE_MILLION_YEARS);
</span></span></code></pre></div><p>It does this by chaining multiple shorter timeouts together—timeouts that fit under the limit. A pretty simple solution, but it works.</p><p>…or at least I think it does. I wrote automated tests that mock the clock, but I didn’t wait 84 years to see if it worked.</p><p>Give it a try by installing <code>setbigtimeout</code> from <a href="https://www.npmjs.com/package/setbigtimeout">npm</a> or checking out the <a href="https://git.sr.ht/~evanhahn/setBigTimeout">source code</a>.</p></div></div>
  </body>
</html>
