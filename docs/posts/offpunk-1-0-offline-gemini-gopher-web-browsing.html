<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tildegit.org/ploum/AV-98-offline">Original</a>
    <h1>Offpunk 1.0: Offline Gemini/Gopher/Web Browsing</h1>
    
    <div id="readability-page-1" class="page"><p><span id="count_prompt">You can not select more than 25 topics</span>
			<span id="format_prompt">Topics must start with a letter or number, can include dashes (&#39;-&#39;) and can be up to 35 characters long.</span>
		</p><div>
	
	<div>
		
	


		<div>
			
				
<p>A command-line and offline-first smolnet browser/feed reader for Gemini, Gopher, Spartan and Web by <a href="https://ploum.net" rel="nofollow">Ploum</a>.</p>
<p>The goal of Offpunk is to be able to synchronise your content once (a day, a week, a month) and then browse/organise it while staying disconnected.</p>
<p><a href="https://tildegit.org/ploum/AV-98-offline/media/branch/master/screenshot_offpunk1.png" target="_blank" rel="nofollow noopener"><img src="https://tildegit.org/ploum/AV-98-offline/media/branch/master/screenshot_offpunk1.png" alt="Screenshot HTML page with picture"/></a>
<a href="https://tildegit.org/ploum/AV-98-offline/media/branch/master/screenshot_offpunk2.png" target="_blank" rel="nofollow noopener"><img src="https://tildegit.org/ploum/AV-98-offline/media/branch/master/screenshot_offpunk2.png" alt="Screenshot Gemini page"/></a></p>
<p>Offpunk is a fork of the original <a href="https://tildegit.org/solderpunk/AV-98" rel="nofollow">AV-98</a> by Solderpunk and was originally called AV-98-offline as an experimental branch.</p>
<h2 id="user-content-how-to-use">How to use</h2>
<p>Offpunk is a single python file. Installation is optional, you can simply download and run &#34;./offpunk.py&#34; or &#34;python3 offpunk.py&#34; in a terminal.</p>
<p>You use the <code>go</code> command to visit a URL, e.g. <code>go gemini.circumlunar.space</code>. (gemini:// is assumed is no protocol is specified. Supported protocols are gemini, gopher, http, https, mailto, spartan and file).</p>
<p>Links in pages are assigned numerical indices.  Just type an index to follow that link. If page is too long to fit on your screen, the content is displayed in the less pager (by default). Type <code>q</code> to quit and go back to Offpunk prompt. Type <code>view</code> or <code>v</code> to display it again. (<code>view full</code> or <code>v full</code> allows to see the full html page instead of the article view. <code>v feed</code> try to display the linked RSS feed and <code>v feeds</code> displays a list of available feeds. This only applies to html pages)</p>
<p>Use <code>add</code> to add a capsule to your bookmarks and <code>bookmarks</code> or <code>bm</code> to show your bookmarks (you can create multiple bookmarks lists, edit and remove them. See the <code>list</code> manual with <code>help list</code>).</p>
<p>Use <code>offline</code> to only browse cached content and <code>online</code> to go back online. While offline, the <code>reload</code> command will force a re-fetch during the next synchronisation.</p>
<p>Use the <code>help</code> command to learn about additional commands. Some abreviations are available. See <code>abbrevs</code>.</p>
<p>When launched with the &#34;--sync&#34; option, offpunk will run non-interactively and fetch content from your bookmarks, lists and ressources tentatively accessed while offline. New content found in your subscriptions (see <code>help subscribe</code>) will be automatically added to your tour (use <code>tour ls</code> to see your current tour, <code>tour</code> without argument to access the next item and <code>tour X</code> where X is a link number to add the content of a link to your tour).</p>
<p>With &#34;--sync&#34;, one could specify a &#34;--cache validity&#34; in seconds. This option will not refresh content if a cache exists and is less than the specified amount of seconds old.</p>
<p>For example, running</p>
<p><code>offpunk --sync --cache-validity 43200</code></p>
<p>will refresh your bookmarks if those are at least 12h old. If cache-validity is not set or set to 0, any cache is considered good and only content never cached before will be fetched. <code>--assume-yes</code> will automatically accept SSL certificates with errors instead of refusing them.</p>
<p>Offpunk can also be configured as a browser by other tool. If you want to use offpunk directly with a given URL, simply type:</p>
<p><code>offpunk URL</code></p>
<p>To have offpunk fetch the URL at next sync and close immediately, run:</p>
<p><code>offpunk --fetch-later URL</code></p>
<h2 id="user-content-roadmap-post-1-0">Roadmap post 1.0</h2>
<p>Known issues in the code:</p>
<ul>
<li>NOT_FIXABLE : consider root file is always index.gmi or index.html</li>
</ul>
<p>I would happily mentor anyone willing to implement those:</p>
<ul>
<li>TODO0: Hard - Make a manual within the git repository and have it automatically deployed as a website.</li>
<li>TODO1: Easy - Update blackbox to reflect cache hits.</li>
<li>TODO2: Medium - Rendering themes to allow customizing of colors ? (if any interest in the feature)</li>
<li>TODO3: Hard - &#34;search&#34; - Offline search engine to search in the cache (hard, no idea on how to do that)</li>
</ul>
<h2 id="user-content-more">More</h2>
<p>See how I browse Web/Gemini offline =&gt; gemini://rawtext.club/~ploum/2021-12-17-offline-gemini.gmi</p>
<p>Announces about Offpunk will be made on Ploumâ€™s Gemlog  =&gt; gemini://rawtext.club/~ploum/</p>
<p><code>go gemini://rawtext.club/~ploum/</code>
<code>subscribe</code></p>
<h2 id="user-content-dependencies">Dependencies</h2>
<p>Offpunk has no &#34;strict dependencies&#34;, i.e. it should run and work without anything
else beyond the Python standard library and the &#34;less&#34; pager.  However, it will &#34;opportunistically
import&#34; a few other libraries if they are available to offer an improved
experience or some other features. Python libraries requests, bs4 and readability are required for http/html support. Images are displayed if python-ansiwrap and chafa are presents (python-pil is needed for chafa version before 1.10).</p>
<p>To avoid using unstable or too recent libraries, the rule of thumb is that a library should be packaged in Debian/Ubuntu. Keep in mind that Offpunk is mainly tested will all libraries installed. If you encounter a crash without one optional dependencies, please report it.</p>
<p>Run command <code>version</code> in offpunk to see if you are missing some dependencies.</p>
<ul>
<li><a href="https://www.freedesktop.org/wiki/Software/xdg-utils/" rel="nofollow">xdg-utils</a> provides xdg-open which is highly recommended to open files without a renderer or a handler. It is also used for mailto: command.</li>
<li><a href="http://python-requests.org" rel="nofollow">Python-requests</a> is needed to handle http/https requests natively (apt-get install python3-requests). Without it, http links will be opened in an external browser</li>
<li><a href="https://www.crummy.com/software/BeautifulSoup" rel="nofollow">BeautifulSoup4</a> and <a href="https://github.com/buriy/python-readability" rel="nofollow">Readability</a> are both needed to render HTML. Without them, HTML will not be rendered or be sent to an external parser like Lynx. (apt-get install python3-bs4 python3-readability or pip3 install readability-lxml)</li>
<li><a href="https://github.com/kurtmckee/feedparser" rel="nofollow">Python-feedparser</a> will allow parsing of RSS/Atom feeds and thus subscriptions to them. (apt-get install python3-feedparser)</li>
<li>The <a href="https://pypi.org/project/ansiwrap/" rel="nofollow">ansiwrap library</a> may result in
neater display of text which makes use of ANSI escape codes to control colour. Ansiwrap is also required to display pictures in HTML pages (together with Chafa and python-pil) (not in Debian?).</li>
<li>The <a href="https://pypi.org/project/cryptography/" rel="nofollow">cryptography library</a> will
provide a better and slightly more secure experience when using the default
TOFU certificate validation mode and is highly recommended (apt-get install python3-cryptography).</li>
<li><a href="https://github.com/ahupp/python-magic/" rel="nofollow">Python magic</a> is useful to determine the MIME type of cached object. If not present, the file extension will be used but some capsules provide wrong extension or no extension at all. Python-magic is highly recommended. (apt-get install python3-magic)</li>
<li><a href="https://github.com/fmoo/python-editor" rel="nofollow">Python editor</a> is used to edit your lists with &#34;list edit&#34;. (apt-get install python3-editor)</li>
<li><a href="http://www.vergenet.net/~conrad/software/xsel/" rel="nofollow">Xsel</a> allows to <code>go</code> to the URL copied in the clipboard without having to paste it (both X and traditional clipboards are supported). Also needed to use the <code>copy</code> command. (apt-get install xsel)</li>
<li><a href="https://hpjansson.org/chafa/" rel="nofollow">Chafa</a> allows to display pictures in your console. Install it and browse to an HTML page with picture to see the magic.</li>
<li><a href="http://python-pillow.github.io/" rel="nofollow">Python-pil</a> is required to only display the first frame of animated gif with chafa if chafa version is lower than 1.10.</li>
<li><a href="https://github.com/dvarrazzo/py-setproctitle" rel="nofollow">Python-setproctitle</a> will change the process name from &#34;python&#34; to &#34;offpunk&#34;. Useful to kill it without killing every python service.</li>
</ul>
<h2 id="user-content-features">Features</h2>
<ul>
<li>Browse https/gemini/gopher/spartan without leaving your keyboard and without distractions</li>
<li>Built-in documentation: type <code>help</code> to get the list of command or a specific help about a command.</li>
<li>Offline mode to browse cached content without a connection. Requested elements are automatically fetched during the next synchronization and are added to your tour.</li>
<li>HTML pages are prettified to focus on content. Read without being disturbed or see the full page with <code>view full</code>.</li>
<li>RSS/Atom feeds are automatically discovered by <code>subscribe</code> and rendered as gemlogs. They can be explored with <code>view feed</code> and <code>view feeds</code>.</li>
<li>Support &#34;subscriptions&#34; to a page. New content seen in subscribed pages are automatically added to your next tour.</li>
<li>Complex bookmarks management through multiple lists, built-in edition, subscribing/freezing lists and archiving content.</li>
<li>Advanced navigation tools like <code>tour</code> and <code>mark</code> (as per VF-1). Unlike AV-98, tour is saved on disk accross sessions.</li>
<li>Ability to specify external handler programs for different MIME types (use <code>handler</code>)</li>
<li>Non-interactive cache-building with configurable depth through the --sync command. The cache can easily be used by other software.</li>
<li>IPv6 support</li>
<li>Supports any character encoding recognised by Python</li>
<li>Cryptography : TOFU or CA server certificate validation</li>
<li>Cryptography : Extensive client certificate support if an <code>openssl</code> binary is available</li>
</ul>
<h2 id="user-content-rc-files">RC files</h2>
<p>You can use an RC file to automatically run any sequence of valid Offpunk
commands upon start up.  This can be used to make settings controlled with the
<code>set</code> or <code>handler</code> commanders persistent.  You can also put a <code>go</code> command in
your RC file to visit a &#34;homepage&#34; automatically on startup, or to pre-prepare
a <code>tour</code> of your favourite Gemini sites or <code>offline</code> to go offline by default.</p>
<p>The RC file should be called <code>offpunkrc</code> and goes in $XDG_CONFIG_DIR/offpunk (or .config/offpunk or .offpunk if xdg not available)</p>
<h2 id="user-content-cache-design">Cache design</h2>
<p>The offline content is stored in ~/.cache/offpunk/ as plain .gmi/.html files. The structure of the Gemini-space is tentatively recreated. One key element of the design is to avoid any database. The cache can thus be modified by hand, content can be removed, used or added by software other than offpunk.</p>
<p>Thereâ€™s no feature to automatically trim the cache. It is believed that gemini content being lightweight, one would have to seriously browse a lot before cache size is an issue. If cache becomes too big, simply rm -rf the folders of the capsules taking too much space.</p>

			
		</div>
	</div>
</div></div>
  </body>
</html>
