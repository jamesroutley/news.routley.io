<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tech.marksblogg.com/building-footprints-gba.html">Original</a>
    <h1>The World&#39;s 2.75B Buildings</h1>
    
    <div id="readability-page-1" class="page"><div id="article_text">
            <p>The United Nations (UN) believes there are 4B buildings on Earth. This week, a dataset called &#34;GlobalBuildingAtlas&#34; (GBA) was <a href="https://mediatum.ub.tum.de/1782307">published</a> by researchers at the Technical University of Munich (TUM) that attempts to estimate this number at being closer to 2.75B.</p>
<p>GBA is broken up into two datasets. The first is a 1.1 TB, level-of-detail 1 (LoD1) dataset made up of 922 uncompressed GeoJSON files. I spent the last few days downloading these and converting them into 210 GB of Parquet. These are now being hosted on AWS S3 thanks to the kind generosity of <a href="https://source.coop/">Source Cooperative</a> and <a href="https://tgengine.org/">Taylor Geospatial Engine</a>.</p>
<p>Below is a heatmap of this dataset.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_6Y0A3doBbl.jpg">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_6Y0A3doBbl.jpg"/>
</a></p><p>The above basemap is mostly made up of vector data from Natural Earth and Overture.</p>
<p>The second &#34;Height&#34; dataset is made up of 35 TB of raster height maps. Given the LoD1 files already contain building heights and downloading 35 TB off of TUM&#39;s servers will likely take months, I&#39;ll just show an individual raster in this post rather than run any dataset-wide operations on this dataset.</p>
<p>Parts of these datasets were developed by running <a href="https://github.com/zhu-xlab/GlobalBuildingAtlas">open source</a> (code, not imagery or weights) deep learning models on Planet Labs&#39; satellite imagery. Planet Labs operate several constellations totalling hundreds of satellites in low earth orbit. They capture images of the entire Earth&#39;s landmasses every day.</p>
<p>In this post, I&#39;ll walk through loading the LoD1 data from S3 into QGIS, describe the ETL process I ran to build the Parquet version of this dataset and discuss some observations of the footprints themselves.</p>
<div id="my-workstation">
<h2>My Workstation</h2>
<p>I&#39;m using a 5.7 GHz AMD Ryzen 9 9950X CPU. It has 16 cores and 32 threads and 1.2 MB of L1, 16 MB of L2 and 64 MB of L3 cache. It has a liquid cooler attached and is housed in a spacious, full-sized Cooler Master HAF 700 computer case.</p>
<p>The system has 96 GB of DDR5 RAM clocked at 4,800 MT/s and a 5th-generation, Crucial T700 4 TB NVMe M.2 SSD which can read at speeds up to 12,400 MB/s. There is a heatsink on the SSD to help keep its temperature down. This is my system&#39;s C drive.</p>
<p>The system is powered by a 1,200-watt, fully modular Corsair Power Supply and is sat on an ASRock X870E Nova 90 Motherboard.</p>
<p>I&#39;m running Ubuntu 24 LTS via Microsoft&#39;s Ubuntu for Windows on Windows 11 Pro. In case you&#39;re wondering why I don&#39;t run a Linux-based desktop as my primary work environment, I&#39;m still using an Nvidia GTX 1080 GPU which has better driver support on Windows and ArcGIS Pro only supports Windows natively.</p>
</div>
<div id="installing-prerequisites">
<h2>Installing Prerequisites</h2>
<p>I&#39;ll use Python 3.12.3 and a few other tools to help analyse the data in this post.</p>
<div><pre><span></span>$<span> </span>sudo<span> </span>add-apt-repository<span> </span>ppa:deadsnakes/ppa
$<span> </span>sudo<span> </span>add-apt-repository<span> </span>ppa:ubuntugis/ubuntugis-unstable
$<span> </span>sudo<span> </span>apt<span> </span>update
$<span> </span>sudo<span> </span>apt<span> </span>install<span> </span><span>\</span>
<span>    </span>exiftool<span> </span><span>\</span>
<span>    </span>jq<span> </span><span>\</span>
<span>    </span>python3-pip<span> </span><span>\</span>
<span>    </span>python3.12-venv
</pre></div>
<p>I&#39;ll be using <a href="https://github.com/kellyjonbrazil/jc?tab=readme-ov-file">JSON Convert</a> (jc) to convert the output of various CLI tools into JSON.</p>
<div><pre><span></span>$<span> </span>wget<span> </span>https://github.com/kellyjonbrazil/jc/releases/download/v1.25.2/jc_1.25.2-1_amd64.deb
$<span> </span>sudo<span> </span>dpkg<span> </span>-i<span> </span>jc_1.25.2-1_amd64.deb
</pre></div>
<p>I&#39;ll use a <a href="https://github.com/marklit/pqview">Parquet debugging tool</a> I&#39;ve been working on to see how much space each column takes up in one of the Parquet files.</p>
<div><pre><span></span>$<span> </span>git<span> </span>clone<span> </span>https://github.com/marklit/pqview<span> </span><span>\</span>
<span>    </span>~/pqview

$<span> </span>python3<span> </span>-m<span> </span>venv<span> </span>~/.pqview
$<span> </span><span>source</span><span> </span>~/.pqview/bin/activate
$<span> </span>python3<span> </span>-m<span> </span>pip<span> </span>install<span> </span><span>\</span>
<span>          </span>-r<span> </span>~/pqview/requirements.txt
</pre></div>
<p>I&#39;ll use DuckDB, along with its <a href="https://github.com/isaacbrodsky/h3-duckdb">H3</a>, <a href="https://duckdb.org/docs/extensions/json">JSON</a>, <a href="https://community-extensions.duckdb.org/extensions/lindel.html">Lindel</a>, <a href="https://duckdb.org/docs/data/parquet/overview">Parquet</a> and <a href="https://duckdb.org/docs/extensions/spatial.html">Spatial</a> extensions, in this post.</p>
<div><pre><span></span>$<span> </span><span>cd</span><span> </span>~
$<span> </span>wget<span> </span>-c<span> </span>https://github.com/duckdb/duckdb/releases/download/v1.3.2/duckdb_cli-linux-amd64.zip
$<span> </span>unzip<span> </span>-j<span> </span>duckdb_cli-linux-amd64.zip
$<span> </span>chmod<span> </span>+x<span> </span>duckdb
$<span> </span>~/duckdb
</pre></div>
<div><pre><span></span><span>INSTALL</span><span> </span><span>h3</span><span> </span><span>FROM</span><span> </span><span>community</span><span>;</span>
<span>INSTALL</span><span> </span><span>lindel</span><span> </span><span>FROM</span><span> </span><span>community</span><span>;</span>
<span>INSTALL</span><span> </span><span>json</span><span>;</span>
<span>INSTALL</span><span> </span><span>parquet</span><span>;</span>
<span>INSTALL</span><span> </span><span>spatial</span><span>;</span>
</pre></div>
<p>I&#39;ll set up DuckDB to load every installed extension each time it launches.</p>

<div><pre><span></span>.timer on
.width 180
LOAD h3;
LOAD lindel;
LOAD json;
LOAD parquet;
LOAD spatial;
</pre></div>
<p>The maps in this post were rendered with <a href="https://www.qgis.org/en/site/forusers/download.html">QGIS</a> version 3.44. QGIS is a desktop application that runs on Windows, macOS and Linux. The application has grown in popularity in recent years and has ~15M application launches from users all around the world each month.</p>
</div>
<div id="downloading-the-buildings">
<h2>Downloading the Buildings</h2>
<p>In QGIS, click the &#34;Plugins&#34; Menu and then the &#34;Manage and Install Plugins&#34; item. Click the &#34;All&#34; filter in the top left of the dialog and then search for &#34;QuickMapServices&#34;. Click to install or upgrade the plugin in the bottom right of the dialog.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_dT7SkPsfsj.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_dT7SkPsfsj.png"/>
</a></p><p>Click the &#34;Web&#34; Menu, then &#34;QuickMapServices&#34; and then the &#34;Settings&#34; item. Click the &#34;More Services&#34; tab at the top of the dialog. Click the &#34;Get contributed pack&#34; button.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_SNRNpckhQR.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_SNRNpckhQR.png"/>
</a></p><p>In the &#34;Web&#34; menu under &#34;QuickMapServices&#34; you should now see the list of several basemap providers.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_hlG3SeUhQJ.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_hlG3SeUhQJ.png"/>
</a></p><p>Select &#34;OSM&#34; and then &#34;OSM Standard&#34; to add a world map to your scene.</p>
<p>Under the &#34;Plugins&#34; menu, select &#34;Python Console&#34;. Paste in the following line of Python. It&#39;ll ensure you&#39;ve got the latest version of DuckDB installed in QGIS&#39; Python Environment.</p>
<div><pre><span></span><span>import</span> <span>pip</span><span>;</span> <span>pip</span><span>.</span><span>main</span><span>([</span><span>&#39;install&#39;</span><span>,</span> <span>&#39;--upgrade&#39;</span><span>,</span> <span>&#39;duckdb&#39;</span><span>])</span>
</pre></div>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_q69QJGxH7Q.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_q69QJGxH7Q.png"/>
</a></p><p>In QGIS, click the &#34;Plugins&#34; Menu and then the &#34;Manage and Install Plugins&#34; item. Click the &#34;All&#34; filter in the top left of the dialog and then search for &#34;GeoParquet Downloader&#34;. Click to install or upgrade the plugin in the bottom right of the dialog.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_nTVuksy89Q.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_nTVuksy89Q.png"/>
</a></p><p>Zoom into a city of interest somewhere in the world. It&#39;s important to make sure you&#39;re not looking at an area larger than a major city as the viewport will set the boundaries for how much data will be downloaded.</p>
<p>If you can see the whole earth, GeoParquet Downloader will end up downloading 210 GB of data. Downloading only a city&#39;s worth of data will likely only need a few MB of data.</p>
<p>In your toolbar, click on the GeoParquet Downloader icon. It&#39;s the one with blue, rotated rectangles.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_z651S0z98R.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_z651S0z98R.png"/>
</a></p><p>Click the &#34;Custom URL&#34; option and paste the following URL in.</p>
<div><pre><span></span>s3://us-west-2.opendata.source.coop/tge-labs/globalbuildingatlas-lod1/*.parquet
</pre></div>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_LgLsRHMuRD.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_LgLsRHMuRD.png"/>
</a></p><p>Hit &#34;OK&#34;. You&#39;ll be prompted to save a Parquet file onto your computer. Once you&#39;ve done so, the GBA data for the area in your map should appear shortly afterword.</p>
<p>Once the buildings have loaded, select the layer styling for the downloaded buildings layer. The combo box at the top of the styling panel should be switched from &#34;Single Symbol&#34; to &#34;2.5D&#34;.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_pIOHHdPzTW.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_pIOHHdPzTW.png"/>
</a></p><p>In the &#34;Height&#34; field, change it to the following expression:</p>

<p>You should now see a 2.5D representation of the buildings you downloaded.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_ZNgr07Dg4z.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_ZNgr07Dg4z.png"/>
</a></p><p>There is an &#34;Identify Features&#34; icon in the toolbar.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_wdztYTCydl.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_wdztYTCydl.png"/>
</a></p><p>This tool lets you select any building and bring up its metadata.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_HStWcJnG51.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_HStWcJnG51.png"/>
</a></p><p>The Parquet file you saved can also be read via DuckDB and even dropped into Esri&#39;s <a href="https://tech.marksblogg.com/arcgis-pro-35.html">ArcGIS Pro 3.5</a> or newer if you have it installed on your machine.</p>
</div>
<div id="the-lod1-urls">
<h2>The LoD1 URLs</h2>
<p>Below I&#39;ll discuss how I turned the 1.1 TB of GeoJSON into Parquet. These steps don&#39;t need to be repeated as the resulting files are now on S3.</p>
<p>I first set up a working folder on a partition that had at least 600 GB of free space.</p>
<div><pre><span></span>$<span> </span>mkdir<span> </span>-p<span> </span>~/tum/stats
$<span> </span><span>cd</span><span> </span>~/tum
</pre></div>
<p>I built a 922-line list of URLs for the LoD1 dataset. They&#39;re available from <a href="https://gist.github.com/marklit/237bec7b8a82e1290e2f481c8adda611">this gist</a> and I have them saved as <tt>manifest.lod.txt</tt>. Below are a few lines from this file.</p>
<div><pre><span></span>$<span> </span>head<span> </span>-n5<span> </span>manifest.lod.txt
</pre></div>
<div><pre><span></span>https://dataserv.ub.tum.de/s/m1782307/download?path=%2FLoD1%2Fafrica&amp;files=e000_n10_e005_n05.geojson
https://dataserv.ub.tum.de/s/m1782307/download?path=%2FLoD1%2Fafrica&amp;files=e000_n15_e005_n10.geojson
https://dataserv.ub.tum.de/s/m1782307/download?path=%2FLoD1%2Fafrica&amp;files=e000_n20_e005_n15.geojson
https://dataserv.ub.tum.de/s/m1782307/download?path=%2FLoD1%2Fafrica&amp;files=e000_n25_e005_n20.geojson
https://dataserv.ub.tum.de/s/m1782307/download?path=%2FLoD1%2Fafrica&amp;files=e000_n30_e005_n25.geojson
</pre></div>
<p>I collected file size data for these URLs from TUM&#39;s server.</p>
<div><pre><span></span>$<span> </span>touch<span> </span>lods1.json<span> </span><span>&amp;&amp;</span><span> </span>rm<span> </span>lods1.json

$<span> </span><span>for</span><span> </span>URL<span> </span><span>in</span><span> </span><span>`</span>cat<span> </span>manifest.txt<span>`</span><span>;</span><span> </span><span>do</span>
<span>    </span><span>echo</span><span> </span><span>$URL</span>
<span>    </span>curl<span> </span>-sI<span> </span><span>&#34;</span><span>$URL</span><span>&#34;</span><span> </span><span>|</span><span> </span>jc<span> </span>--kv<span> </span>&gt;&gt;<span> </span>lods1.json
<span>  </span><span>done</span>
</pre></div>
<p>I then used Python to clean up some of the output and make it easier to analyse.</p>

<div><pre><span></span><span>import</span> <span>json</span>
<span>from</span>   <span>urllib.parse</span> <span>import</span> <span>unquote</span>


<span>urls</span>  <span>=</span> <span>[</span><span>x</span><span>.</span><span>strip</span><span>()</span>     <span>for</span> <span>x</span> <span>in</span> <span>open</span><span>(</span><span>&#39;manifest.lod.txt&#39;</span><span>,</span> <span>&#39;r&#39;</span><span>)</span><span>.</span><span>readlines</span><span>()]</span>
<span>resps</span> <span>=</span> <span>[</span><span>json</span><span>.</span><span>loads</span><span>(</span><span>x</span><span>)</span> <span>for</span> <span>x</span> <span>in</span> <span>open</span><span>(</span><span>&#39;lods1.json&#39;</span><span>,</span> <span>&#39;r&#39;</span><span>)</span><span>.</span><span>readlines</span><span>()]</span>

<span>for</span> <span>num</span><span>,</span> <span>resp</span> <span>in</span> <span>enumerate</span><span>(</span><span>resps</span><span>):</span>
    <span>resp</span><span>[</span><span>&#39;content_length&#39;</span><span>]</span> <span>=</span> <span>int</span><span>(</span><span>resp</span><span>[</span><span>&#39;content-length&#39;</span><span>])</span>
    <span>resp</span><span>[</span><span>&#39;http_code&#39;</span><span>]</span>      <span>=</span> <span>[</span><span>int</span><span>(</span><span>x</span><span>.</span><span>split</span><span>(</span><span>&#39; &#39;</span><span>)[</span><span>-</span><span>1</span><span>])</span>
                              <span>for</span> <span>x</span> <span>in</span> <span>resp</span><span>.</span><span>keys</span><span>()</span>
                              <span>if</span> <span>x</span><span>.</span><span>startswith</span><span>(</span><span>&#39;HTTP/2&#39;</span><span>)][</span><span>0</span><span>]</span>

    <span>resp</span><span>[</span><span>&#39;filename&#39;</span><span>]</span> <span>=</span> <span>resp</span><span>[</span><span>&#39;content-disposition&#39;</span><span>]</span>\
                            <span>.</span><span>split</span><span>(</span><span>&#39;filename=&#39;</span><span>)[</span><span>-</span><span>1</span><span>]</span>\
                            <span>.</span><span>strip</span><span>(</span><span>&#39;&#34;&#39;</span><span>)</span>
    <span>resp</span><span>[</span><span>&#39;url&#39;</span><span>]</span>      <span>=</span> <span>[</span><span>x</span> <span>for</span> <span>x</span> <span>in</span> <span>urls</span> <span>if</span> <span>resp</span><span>[</span><span>&#39;filename&#39;</span><span>]</span> <span>in</span> <span>x</span><span>][</span><span>0</span><span>]</span>
    <span>resp</span><span>[</span><span>&#39;folder&#39;</span><span>]</span>   <span>=</span> <span>unquote</span><span>(</span><span>resp</span><span>[</span><span>&#39;url&#39;</span><span>]</span>
                                <span>.</span><span>split</span><span>(</span><span>&#39;path=&#39;</span><span>)[</span><span>-</span><span>1</span><span>]</span>
                                <span>.</span><span>split</span><span>(</span><span>&#39;&amp;&#39;</span><span>)[</span><span>0</span><span>])</span>

    <span>resps</span><span>[</span><span>num</span><span>]</span> <span>=</span> <span>resp</span>

<span>open</span><span>(</span><span>&#39;lods1.enriched.json&#39;</span><span>,</span> <span>&#39;w&#39;</span><span>)</span>\
    <span>.</span><span>write</span><span>(</span><span>&#39;</span><span>\n</span><span>&#39;</span><span>.</span><span>join</span><span>(</span><span>json</span><span>.</span><span>dumps</span><span>(</span><span>x</span><span>)</span> <span>for</span> <span>x</span> <span>in</span> <span>resps</span><span>))</span>
</pre></div>
<p>There were 922 HTTP 200 responses from the above crawl. One for every URL in the manifest.</p>

<div><pre><span></span><span>SELECT</span><span>   </span><span>http_code</span><span>,</span>
<span>         </span><span>COUNT</span><span>(</span><span>*</span><span>)</span>
<span>FROM</span><span>     </span><span>&#39;lods1.enriched.json&#39;</span>
<span>GROUP</span><span> </span><span>BY</span><span> </span><span>1</span><span>;</span>
</pre></div>
<div><pre><span></span>┌───────────┬──────────────┐
│ http_code │ count_star() │
│   int64   │    int64     │
├───────────┼──────────────┤
│    200    │     922      │
└───────────┴──────────────┘
</pre></div>
<p>This is the number of GB each region of the world contains on TUM&#39;s servers. Note, this is all uncompressed GeoJSON.</p>
<div><pre><span></span><span>SELECT</span><span>   </span><span>folder</span><span>,</span>
<span>         </span><span>(</span><span>SUM</span><span>(</span><span>content_length</span><span>)</span><span> </span><span>/</span><span> </span><span>1024</span><span> </span><span>**</span><span> </span><span>3</span><span>)::</span><span>INT</span><span> </span><span>AS</span><span> </span><span>GB</span>
<span>FROM</span><span>     </span><span>&#39;lods1.enriched.json&#39;</span>
<span>GROUP</span><span> </span><span>BY</span><span> </span><span>1</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>2</span><span> </span><span>DESC</span><span>;</span>
</pre></div>
<div><pre><span></span>┌────────────────────┬───────┐
│       folder       │  GB   │
│      varchar       │ int32 │
├────────────────────┼───────┤
│ /LoD1/asiawest     │   388 │
│ /LoD1/africa       │   294 │
│ /LoD1/europe       │   202 │
│ /LoD1/northamerica │   147 │
│ /LoD1/southamerica │   140 │
│ /LoD1/asiaeast     │   108 │
│ /LoD1/oceania      │    67 │
└────────────────────┴───────┘
</pre></div>
<p>These are the number of GeoJSON files that make up each region of the world.</p>
<div><pre><span></span><span>SELECT</span><span>   </span><span>folder</span><span>,</span>
<span>         </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>num_urls</span>
<span>FROM</span><span>     </span><span>&#39;lods1.enriched.json&#39;</span>
<span>GROUP</span><span> </span><span>BY</span><span> </span><span>1</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>2</span><span> </span><span>DESC</span><span>;</span>
</pre></div>
<div><pre><span></span>┌────────────────────┬──────────┐
│       folder       │ num_urls │
│      varchar       │  int64   │
├────────────────────┼──────────┤
│ /LoD1/northamerica │      179 │
│ /LoD1/africa       │      176 │
│ /LoD1/asiawest     │      130 │
│ /LoD1/asiaeast     │      128 │
│ /LoD1/oceania      │      114 │
│ /LoD1/southamerica │      101 │
│ /LoD1/europe       │       94 │
└────────────────────┴──────────┘
</pre></div>
<p>These are the smallest and largest files in the LoD1 dataset.</p>
<div><pre><span></span><span>SELECT</span><span>   </span><span>content_length</span><span>,</span>
<span>         </span><span>folder</span><span>,</span>
<span>         </span><span>filename</span>
<span>FROM</span><span>     </span><span>&#39;lods1.enriched.json&#39;</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>content_length</span><span>;</span>
</pre></div>
<div><pre><span></span>┌────────────────┬────────────────────┬───────────────────────────┐
│ content_length │       folder       │         filename          │
│     int64      │      varchar       │          varchar          │
├────────────────┼────────────────────┼───────────────────────────┤
│            674 │ /LoD1/asiaeast     │ e135_n25_e140_n20.geojson │
│            677 │ /LoD1/asiaeast     │ e170_n75_e175_n70.geojson │
│           2137 │ /LoD1/northamerica │ w050_n60_w045_n55.geojson │
│           3437 │ /LoD1/asiawest     │ e095_n70_e100_n65.geojson │
│           5746 │ /LoD1/northamerica │ w105_n65_w100_n60.geojson │
│           6913 │ /LoD1/northamerica │ w145_n60_w140_n55.geojson │
│          11094 │ /LoD1/southamerica │ w030_s20_w025_s25.geojson │
│          12586 │ /LoD1/northamerica │ w125_n75_w120_n70.geojson │
│          14778 │ /LoD1/northamerica │ w075_n60_w070_n55.geojson │
│          15223 │ /LoD1/oceania      │ e165_n05_e170_n00.geojson │
│          18611 │ /LoD1/asiaeast     │ e150_n75_e155_n70.geojson │
│          20510 │ /LoD1/oceania      │ e115_s15_e120_s20.geojson │
│          23356 │ /LoD1/asiaeast     │ e115_n75_e120_n70.geojson │
│          27109 │ /LoD1/northamerica │ w150_n60_w145_n55.geojson │
│          29734 │ /LoD1/asiawest     │ e085_n75_e090_n70.geojson │
│          31258 │ /LoD1/oceania      │ e065_s45_e070_s50.geojson │
│          32752 │ /LoD1/asiaeast     │ e160_n55_e165_n50.geojson │
│          32891 │ /LoD1/northamerica │ w170_n20_w165_n15.geojson │
│          33177 │ /LoD1/europe       │ e055_n75_e060_n70.geojson │
│          34303 │ /LoD1/northamerica │ w065_n65_w060_n60.geojson │
│            ·   │      ·             │             ·             │
│            ·   │      ·             │             ·             │
│            ·   │      ·             │             ·             │
│    12115126130 │ /LoD1/europe       │ e005_n50_e010_n45.geojson │
│    12663234796 │ /LoD1/asiawest     │ e090_n25_e095_n20.geojson │
│    12907517141 │ /LoD1/africa       │ e030_n05_e035_n00.geojson │
│    13682576090 │ /LoD1/northamerica │ w100_n20_w095_n15.geojson │
│    13778082922 │ /LoD1/asiawest     │ e075_n20_e080_n15.geojson │
│    13858487472 │ /LoD1/asiawest     │ e070_n30_e075_n25.geojson │
│    14316795070 │ /LoD1/asiawest     │ e075_n25_e080_n20.geojson │
│    14440822865 │ /LoD1/asiawest     │ e105_n15_e110_n10.geojson │
│    14459258848 │ /LoD1/southamerica │ w050_s20_w045_s25.geojson │
│    14558343630 │ /LoD1/asiawest     │ e080_n25_e085_n20.geojson │
│    15756826807 │ /LoD1/europe       │ e005_n55_e010_n50.geojson │
│    15986484228 │ /LoD1/oceania      │ e105_s05_e110_s10.geojson │
│    16830813690 │ /LoD1/asiawest     │ e070_n25_e075_n20.geojson │
│    18731290715 │ /LoD1/oceania      │ e110_s05_e115_s10.geojson │
│    22094633389 │ /LoD1/asiawest     │ e085_n30_e090_n25.geojson │
│    24040590951 │ /LoD1/asiawest     │ e070_n35_e075_n30.geojson │
│    24784041081 │ /LoD1/asiawest     │ e075_n15_e080_n10.geojson │
│    27418761453 │ /LoD1/asiawest     │ e085_n25_e090_n20.geojson │
│    31113223192 │ /LoD1/asiawest     │ e080_n30_e085_n25.geojson │
│    31830016696 │ /LoD1/asiawest     │ e075_n30_e080_n25.geojson │
├────────────────┴────────────────────┴───────────────────────────┤
│ 922 rows (40 shown)                                   3 columns │
└─────────────────────────────────────────────────────────────────┘
</pre></div>
</div>
<div id="downloading-geojson">
<h2>Downloading GeoJSON</h2>
<p>One day after I started downloading the GeoJSON files, the URLs were changed on TUM&#39;s server. I had to run the following script to produce a new list of URLs to download.</p>
<div><pre><span></span>$<span> </span><span>echo</span><span> </span><span>&#34;SELECT &#39;https://dataserv.ub.tum.de/public.php/dav/files/m1782307/LoD1/&#39;</span>
<span>                    || REPLACE(folder, &#39;/LoD1/&#39;, &#39;&#39;)</span>
<span>                    || &#39;/&#39;</span>
<span>                    || filename AS url</span>
<span>         FROM   &#39;lods1.enriched.json&#39;&#34;</span><span> </span><span>\</span>
<span>    </span><span>|</span><span> </span>~/duckdb<span> </span>-csv<span> </span>-noheader<span> </span><span>\</span>
<span>    </span>&gt;<span> </span>manifest.lod.dav.txt
</pre></div>
<p>Below is the download script I used. Once a file was downloaded, it was compressed to preserve space on my machine. The files are downloaded in a random order and after each pass of the 922 URLs, any missing files not downloaded will be retried. I experienced several outages of TUMs server during this process so the retries came in handy.</p>
<div><pre><span></span>$<span> </span><span>while</span><span> </span>:
<span>  </span><span>do</span>
<span>      </span><span>for</span><span> </span>LINE<span> </span><span>in</span><span> </span><span>`</span>sort<span> </span>-R<span> </span>manifest.lod.dav.txt<span>`</span><span>;</span><span> </span><span>do</span>
<span>          </span><span>GEOJSON</span><span>=</span><span>`</span><span>echo</span><span> </span><span>&#34;</span><span>$LINE</span><span>&#34;</span><span> </span><span>|</span><span> </span>cut<span> </span>-d/<span> </span>-f10<span>`</span>
<span>          </span><span>ZIPFILE</span><span>=</span><span>&#34;</span><span>$GEOJSON</span><span>.zip&#34;</span>

<span>          </span><span>if</span><span> </span><span>[</span><span> </span>!<span> </span>-f<span> </span><span>$ZIPFILE</span><span> </span><span>]</span><span>;</span><span> </span><span>then</span>
<span>              </span><span>echo</span><span> </span><span>$LINE</span>
<span>              </span>wget<span> </span>-c<span> </span>-O<span> </span><span>$GEOJSON</span><span> </span><span>&#34;</span><span>$LINE</span><span>&#34;</span>

<span>              </span><span>LINE_COUNT</span><span>=</span><span>$(</span>wc<span> </span>-l<span> </span>&lt;<span> </span><span>$GEOJSON</span><span>)</span>

<span>              </span><span>if</span><span> </span><span>[</span><span> </span><span>&#34;</span><span>$LINE_COUNT</span><span>&#34;</span><span> </span>-eq<span> </span><span>0</span><span> </span><span>]</span><span>;</span><span> </span><span>then</span>
<span>                  </span>rm<span> </span><span>&#34;</span><span>$GEOJSON</span><span>&#34;</span>
<span>                  </span><span>echo</span><span> </span><span>&#34;</span><span>$GEOJSON</span><span> has zero lines. Sleeping for 3 minutes..&#34;</span>
<span>                  </span>sleep<span> </span><span>180</span>
<span>              </span><span>else</span>
<span>                  </span>zip<span> </span>-9v<span> </span><span>&#34;</span><span>$ZIPFILE</span><span>&#34;</span><span> </span><span>&#34;</span><span>$GEOJSON</span><span>&#34;</span>
<span>                  </span>rm<span> </span><span>&#34;</span><span>$GEOJSON</span><span>&#34;</span>
<span>              </span><span>fi</span>
<span>          </span><span>else</span>
<span>              </span><span>echo</span><span> </span><span>&#34;</span><span>$ZIPFILE</span><span> already exists, skipping..&#34;</span>
<span>          </span><span>fi</span>
<span>      </span><span>done</span>

<span>      </span><span>echo</span><span> </span><span>&#34;Finished a pass of the manifest file. Sleeping for 5 minutes..&#34;</span>
<span>      </span>sleep<span> </span><span>300</span>
<span>  </span><span>done</span>
</pre></div>
<p>The above took the better part of a week to complete. The 1.1 TB of uncompressed GeoJSON was compressed into 357 GB worth of ZIP files.</p>
</div>
<div id="geojson-to-parquet">
<h2>GeoJSON to Parquet</h2>
<p>The following GeoJSON to Parquet script ran concurrently to the above download script. It extracts the GeoJSON file inside of any unprocessed ZIP file, converts its projection from EPSG:3857 to EPSG:4326, creates a bounding box and spatially sorts the dataset into a ZStandard-compressed Parquet file.</p>
<p>This script runs on a loop and looks for new files process during each run. The GeoJSON to Parquet process is pretty quick on my machine so this script spent a lot of time waiting for new ZIPs.</p>
<div><pre><span></span>$<span> </span><span>while</span><span> </span>:
<span>  </span><span>do</span>
<span>      </span><span>for</span><span> </span>ZIPFILE<span> </span><span>in</span><span> </span>*.geojson.zip<span>;</span><span> </span><span>do</span>
<span>          </span><span>BASENAME</span><span>=</span><span>`</span><span>echo</span><span> </span><span>&#34;</span><span>$ZIPFILE</span><span>&#34;</span><span> </span><span>|</span><span> </span>cut<span> </span>-f1<span> </span>-d.<span>`</span>
<span>          </span><span>PQ_FILE</span><span>=</span><span>&#34;</span><span>$BASENAME</span><span>.parquet&#34;</span>

<span>          </span><span>if</span><span> </span><span>[</span><span> </span>!<span> </span>-f<span> </span><span>$PQ_FILE</span><span> </span><span>]</span><span>;</span><span> </span><span>then</span>
<span>              </span><span>echo</span><span> </span><span>$BASENAME</span>

<span>              </span>mkdir<span> </span>-p<span> </span>working
<span>              </span>rm<span> </span>working/*<span> </span><span>||</span><span> </span><span>true</span><span> </span><span>2</span>&gt;/dev/null
<span>              </span>unzip<span> </span><span>$ZIPFILE</span><span> </span>-d<span> </span>working/
<span>              </span><span>FIRST</span><span>=</span><span>`</span>ls<span> </span>working/*.geojson<span> </span><span>|</span><span> </span>head<span> </span>-n1<span>`</span>

<span>              </span><span>echo</span><span> </span><span>&#34;COPY (</span>
<span>                        SELECT   * EXCLUDE (geom),</span>
<span>                                 ST_FLIPCOORDINATES(</span>
<span>                                      ST_TRANSFORM(geom,</span>
<span>                                                   &#39;EPSG:3857&#39;,</span>
<span>                                                   &#39;EPSG:4326&#39;)) geometry,</span>
<span>                                 {&#39;xmin&#39;: ST_XMIN(ST_EXTENT(ST_FLIPCOORDINATES(</span>
<span>                                              ST_TRANSFORM(geom,</span>
<span>                                                           &#39;EPSG:3857&#39;,</span>
<span>                                                           &#39;EPSG:4326&#39;)))),</span>
<span>                                  &#39;ymin&#39;: ST_YMIN(ST_EXTENT(ST_FLIPCOORDINATES(</span>
<span>                                              ST_TRANSFORM(geom,</span>
<span>                                                           &#39;EPSG:3857&#39;,</span>
<span>                                                           &#39;EPSG:4326&#39;)))),</span>
<span>                                  &#39;xmax&#39;: ST_XMAX(ST_EXTENT(ST_FLIPCOORDINATES(</span>
<span>                                              ST_TRANSFORM(geom,</span>
<span>                                                           &#39;EPSG:3857&#39;,</span>
<span>                                                           &#39;EPSG:4326&#39;)))),</span>
<span>                                  &#39;ymax&#39;: ST_YMAX(ST_EXTENT(ST_FLIPCOORDINATES(</span>
<span>                                              ST_TRANSFORM(geom,</span>
<span>                                                           &#39;EPSG:3857&#39;,</span>
<span>                                                           &#39;EPSG:4326&#39;))))} AS bbox</span>
<span>                        FROM     ST_READ(&#39;</span><span>$FIRST</span><span>&#39;)</span>
<span>                        ORDER BY HILBERT_ENCODE([</span>
<span>                              ST_Y(ST_CENTROID(ST_FLIPCOORDINATES(</span>
<span>                                      ST_TRANSFORM(geom,</span>
<span>                                                   &#39;EPSG:3857&#39;,</span>
<span>                                                   &#39;EPSG:4326&#39;)))),</span>
<span>                              ST_X(ST_CENTROID(ST_FLIPCOORDINATES(</span>
<span>                                      ST_TRANSFORM(geom,</span>
<span>                                                   &#39;EPSG:3857&#39;,</span>
<span>                                                   &#39;EPSG:4326&#39;))))]::double[2])</span>
<span>                    ) TO &#39;</span><span>$BASENAME</span><span>.parquet&#39; (</span>
<span>                        FORMAT            &#39;PARQUET&#39;,</span>
<span>                        CODEC             &#39;ZSTD&#39;,</span>
<span>                        COMPRESSION_LEVEL 22,</span>
<span>                        ROW_GROUP_SIZE    15000);&#34;</span><span> </span><span>|</span><span> </span>~/duckdb
<span>          </span><span>else</span>
<span>              </span><span>echo</span><span> </span><span>&#34;</span><span>$PQ_FILE</span><span> already exists, skipping..&#34;</span>
<span>          </span><span>fi</span>
<span>      </span><span>done</span>

<span>      </span><span>echo</span><span> </span><span>&#34;Sleeping for 5 minutes..&#34;</span>
<span>      </span>sleep<span> </span><span>300</span>
<span>  </span><span>done</span>
</pre></div>
<p>The above turned the 357 GB worth of ZIPs into 210 GB of Parquet.</p>
<p>The base filenames of the Parquet files match their GeoJSON counterparts. These GeoJSON files used a <tt>e115_n45_e120_n40.geojson</tt> convention where the filename indicated where the contents were located.</p>
<p>Below I&#39;ve rendered the footprints with their filenames formatted for clarity. This was run while the download script was still going so there are footprints missing in this screen shot. The basemap used is CARTO Dark.</p>

<div><pre><span></span><span>COPY</span><span> </span><span>(</span>
<span>    </span><span>WITH</span><span> </span><span>a</span><span> </span><span>AS</span><span> </span><span>(</span>
<span>        </span><span>SELECT</span><span> </span><span>ST_XMIN</span><span>(</span><span>ST_EXTENT</span><span>(</span><span>geometry</span><span>))</span><span> </span><span>AS</span><span> </span><span>xmin</span><span>,</span>
<span>               </span><span>ST_YMIN</span><span>(</span><span>ST_EXTENT</span><span>(</span><span>geometry</span><span>))</span><span> </span><span>AS</span><span> </span><span>ymin</span><span>,</span>
<span>               </span><span>ST_XMAX</span><span>(</span><span>ST_EXTENT</span><span>(</span><span>geometry</span><span>))</span><span> </span><span>AS</span><span> </span><span>xmax</span><span>,</span>
<span>               </span><span>ST_YMAX</span><span>(</span><span>ST_EXTENT</span><span>(</span><span>geometry</span><span>))</span><span> </span><span>AS</span><span> </span><span>ymax</span><span>,</span>
<span>               </span><span>filename</span>
<span>        </span><span>FROM</span><span>   </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>,</span><span> </span><span>filename</span><span>=</span><span>true</span><span>)</span>
<span>    </span><span>)</span>
<span>    </span><span>SELECT</span><span>   </span><span>filename</span><span>,</span>
<span>             </span><span>ST_ASWKB</span><span>(</span><span>{</span><span>&#39;min_x&#39;</span><span>:</span><span> </span><span>MIN</span><span>(</span><span>xmin</span><span>),</span>
<span>                       </span><span>&#39;min_y&#39;</span><span>:</span><span> </span><span>MIN</span><span>(</span><span>ymin</span><span>),</span>
<span>                       </span><span>&#39;max_x&#39;</span><span>:</span><span> </span><span>MAX</span><span>(</span><span>xmax</span><span>),</span>
<span>                       </span><span>&#39;max_y&#39;</span><span>:</span><span> </span><span>MAX</span><span>(</span><span>ymax</span><span>)</span><span>}</span><span>::</span><span>BOX_2D</span><span>::</span><span>GEOMETRY</span><span>)</span><span> </span><span>AS</span><span> </span><span>geometry</span><span>,</span>
<span>             </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>num_buildings</span>
<span>    </span><span>FROM</span><span>     </span><span>a</span>
<span>    </span><span>GROUP</span><span> </span><span>BY</span><span> </span><span>filename</span>
<span>    </span><span>ORDER</span><span> </span><span>BY</span><span> </span><span>filename</span>
<span>)</span><span> </span><span>TO</span><span> </span><span>&#39;stats/bbox.parquet&#39;</span><span> </span><span>(</span>
<span>        </span><span>FORMAT</span><span>            </span><span>&#39;PARQUET&#39;</span><span>,</span>
<span>        </span><span>CODEC</span><span>             </span><span>&#39;ZSTD&#39;</span><span>,</span>
<span>        </span><span>COMPRESSION_LEVEL</span><span> </span><span>22</span><span>,</span>
<span>        </span><span>ROW_GROUP_SIZE</span><span>    </span><span>15000</span><span>);</span>
</pre></div>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_NSZX3KWPBO.jpg">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_NSZX3KWPBO.jpg"/>
</a>
</p></div>
<div id="lod1-records">
<h2>LoD1 Records</h2>
<p>There are 2,747,186,815 records in this dataset with each record representing one building.</p>

<div><pre><span></span><span>SELECT</span><span> </span><span>COUNT</span><span>(</span><span>*</span><span>)</span>
<span>FROM</span><span>   </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>);</span>
</pre></div>

<p>For comparison, Overture&#39;s August release contains 2,539,170,484 buildings (~208M fewer).</p>

<div><pre><span></span><span>SELECT</span><span> </span><span>COUNT</span><span>(</span><span>*</span><span>)</span>
<span>FROM</span><span>   </span><span>READ_PARQUET</span><span>(</span><span>&#39;s3://overturemaps-us-west-2/release/2025-08-20.0/theme=buildings/type=building/*.parquet&#39;</span><span>,</span>
<span>                    </span><span>hive_partitioning</span><span>=</span><span>1</span><span>);</span>
</pre></div>

<p>Below is an example LoD1 record.</p>
<div><pre><span></span>$<span> </span><span>echo</span><span> </span><span>&#34;SELECT * EXCLUDE(bbox),</span>
<span>               bbox::JSON AS bbox</span>
<span>        FROM  READ_PARQUET(&#39;e000_n10_e005_n05.parquet&#39;)</span>
<span>        LIMIT 1&#34;</span><span> </span><span>\</span>
<span>    </span><span>|</span><span> </span>~/duckdb<span> </span>-json<span> </span><span>\</span>
<span>    </span><span>|</span><span> </span>jq<span> </span>-S<span> </span>.
</pre></div>
<div><pre><span></span><span>[</span>
<span>  </span><span>{</span>
<span>    </span><span>&#34;bbox&#34;</span><span>:</span><span> </span><span>{</span>
<span>      </span><span>&#34;xmax&#34;</span><span>:</span><span> </span><span>0.00008150001546320158</span><span>,</span>
<span>      </span><span>&#34;xmin&#34;</span><span>:</span><span> </span><span>0.0</span><span>,</span>
<span>      </span><span>&#34;ymax&#34;</span><span>:</span><span> </span><span>7.993254849391249</span><span>,</span>
<span>      </span><span>&#34;ymin&#34;</span><span>:</span><span> </span><span>7.993157996915336</span>
<span>    </span><span>},</span>
<span>    </span><span>&#34;geometry&#34;</span><span>:</span><span> </span><span>&#34;POLYGON ((0.000052522233915 7.993254849391249, 0.000081500015463 7.993157996915336, 0 7.993181313497494, 0.000052522233915 7.993254849391249))&#34;</span><span>,</span>
<span>    </span><span>&#34;height&#34;</span><span>:</span><span> </span><span>6.524652481079102</span><span>,</span>
<span>    </span><span>&#34;id&#34;</span><span>:</span><span> </span><span>&#34;4538&#34;</span><span>,</span>
<span>    </span><span>&#34;region&#34;</span><span>:</span><span> </span><span>&#34;GHA&#34;</span><span>,</span>
<span>    </span><span>&#34;source&#34;</span><span>:</span><span> </span><span>&#34;ours2&#34;</span><span>,</span>
<span>    </span><span>&#34;var&#34;</span><span>:</span><span> </span><span>0.7772102355957031</span>
<span>  </span><span>}</span>
<span>]</span>
</pre></div>
<p>Below I&#39;ll generate a heatmap of the records and render them in QGIS.</p>
<div><pre><span></span>$<span> </span>~/duckdb<span> </span>stats/stats.duckdb
</pre></div>
<div><pre><span></span><span>CREATE</span><span> </span><span>OR</span><span> </span><span>REPLACE</span><span> </span><span>TABLE</span><span> </span><span>h3_4_stats</span><span> </span><span>AS</span>
<span>    </span><span>SELECT</span><span>   </span><span>H3_LATLNG_TO_CELL</span><span>(</span>
<span>                </span><span>bbox</span><span>.</span><span>ymin</span><span>,</span>
<span>                </span><span>bbox</span><span>.</span><span>xmin</span><span>,</span><span> </span><span>4</span><span>)</span><span> </span><span>AS</span><span> </span><span>h3_4</span><span>,</span>
<span>             </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>num_buildings</span>
<span>    </span><span>FROM</span><span>     </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>)</span>
<span>    </span><span>WHERE</span><span>    </span><span>bbox</span><span>.</span><span>xmin</span><span> </span><span>BETWEEN</span><span> </span><span>-</span><span>178</span><span>.</span><span>5</span><span> </span><span>AND</span><span> </span><span>178</span><span>.</span><span>5</span>
<span>    </span><span>GROUP</span><span> </span><span>BY</span><span> </span><span>1</span><span>;</span>

<span>COPY</span><span> </span><span>(</span>
<span>    </span><span>SELECT</span><span> </span><span>ST_ASWKB</span><span>(</span><span>H3_CELL_TO_BOUNDARY_WKT</span><span>(</span><span>h3_4</span><span>)::</span><span>geometry</span><span>)</span><span> </span><span>geometry</span><span>,</span>
<span>           </span><span>num_buildings</span>
<span>    </span><span>FROM</span><span>   </span><span>h3_4_stats</span>
<span>)</span><span> </span><span>TO</span><span> </span><span>&#39;stats/h3_4_stats.parquet&#39;</span><span> </span><span>(</span>
<span>        </span><span>FORMAT</span><span> </span><span>&#39;PARQUET&#39;</span><span>,</span>
<span>        </span><span>CODEC</span><span>  </span><span>&#39;ZSTD&#39;</span><span>,</span>
<span>        </span><span>COMPRESSION_LEVEL</span><span> </span><span>22</span><span>,</span>
<span>        </span><span>ROW_GROUP_SIZE</span><span> </span><span>15000</span><span>);</span>
</pre></div>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_6Y0A3doBbl.jpg">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_6Y0A3doBbl.jpg"/>
</a>
</p></div>
<div id="bounding-boxes">
<h2>Bounding Boxes</h2>
<p>In the above rendering I&#39;ve used the bounding box values instead of the underlying geometry. This produces results quicker. This is due to the values taking up less space and not needing as many transformations as the underlying geometry would.</p>
<p>Below is a pie chart showing how much space each column takes up in one of the Parquet files. The <tt>bbox.xmin</tt> and <tt>bbox.ymin</tt> fields are much smaller than the <tt>geometry</tt> field.</p>
<div><pre><span></span>$<span> </span>python3<span> </span>~/pqview/main.py<span> </span><span>\</span>
<span>    </span>types<span> </span>--html<span> </span><span>\</span>
<span>    </span>e000_n10_e005_n05.parquet<span> </span><span>\</span>
<span>    </span>&gt;<span> </span>stats/e000_n10_e005_n05.html
</pre></div>
<p><a href="https://tech.marksblogg.com/theme/images/gba/brave_qOY0WXJtki.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/brave_qOY0WXJtki.png"/>
</a></p><p>The GeoParquet Downloader Plugin for QGIS also uses these bounding boxes to download data quicker than it would if it had used the <tt>geometry</tt> field alone.</p>
</div>
<div id="data-sources">
<h2>Data Sources</h2>
<p>Below are the sources of data in GBA.</p>

<div><pre><span></span><span>SELECT</span><span>   </span><span>COUNT</span><span>(</span><span>*</span><span>),</span>
<span>         </span><span>source</span>
<span>FROM</span><span>     </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>)</span>
<span>GROUP</span><span> </span><span>BY</span><span> </span><span>2</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>1</span><span> </span><span>DESC</span><span>;</span>
</pre></div>
<div><pre><span></span>┌──────────────┬──────────┐
│ count_star() │  source  │
│    int64     │ varchar  │
├──────────────┼──────────┤
│   1619713039 │ google   │
│    490593924 │ osm      │
│    432475081 │ ms       │
│    135815381 │ ours2    │
│     68589390 │ 3dglobfp │
└──────────────┴──────────┘
</pre></div>
<p>Google&#39;s 2023 Open Buildings data is the most used. The OSM data is from 2025 but I&#39;m not sure which month and day. Microsoft Building Footprints is from 2024. The 135M &#34;ours2&#34; source is their Planet Labs&#39;, deep learning-derived dataset. The &#34;3dglobfp&#34; is from a <a href="https://arxiv.org/abs/2404.13911">paper</a> published last year that shares three authors with the GBA paper published this year.</p>
<p>Adding &#34;ours2&#34; and 3dglobfp together makes ~204M which isn&#39;t far off from the 208M more buildings they have compared to Overture&#39;s release from last month.</p>
</div>
<div id="buildings-in-beijing">
<h2>Buildings in Beijing</h2>
<p>Last year, I wrote a <a href="https://tech.marksblogg.com/asian-building-footprints-from-google-maps.html">blog post</a> about a team of researchers that built an AI-detected building dataset from Google Map&#39;s Satellite Imagery. The dataset uses the acronym CLSM. It did a lot to fill in the many missing areas of China that aren&#39;t mapped on OpenStreetMap (OSM). This dataset ended up being the bulk of Overture&#39;s building dataset for China earlier this year.</p>
<p>In some areas, CLSM did a great job of accurately identifying building footprints but there were other areas where the model wasn&#39;t as accurate.</p>
<p>Below in yellow is CLSM&#39;s data for a neighbourhood in Beijing. In purple is GBA&#39;s. As you can see, there has been a serious improvement in accuracy.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_s5EyWwkIGt.jpg">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_s5EyWwkIGt.jpg"/>
</a></p><p>Still, GBA isn&#39;t without its faults. This is another neighbourhood in Beijing.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_n26FthkG5U.jpg">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_n26FthkG5U.jpg"/>
</a></p><p>Below is the area around Beijing&#39;s Capital International Airport (PEK). Red is OSM, yellow is CLSM (via Overture) and purple is the AI-generated GBA building footprints that I believe were built exclusively from deep learning on Planet Labs&#39; imagery.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_OFC8LUH7To.jpg">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_OFC8LUH7To.jpg"/>
</a></p><p>Ultimately, map makers are left needing to do a pick-and-mix approach to cleaning up this data. That said, where GBA can&#39;t be the final deliverable, it can at least help speed up the process.</p>
</div>
<div id="lack-of-timestamps">
<h2>Lack of Timestamps</h2>
<p>China is currently building the world&#39;s <a href="https://youtu.be/l4gQjg97xL0?si=Yky39AlTreZHuudy">largest</a> military command centre. It&#39;s located at <a href="https://www.openstreetmap.org/#map=13/39.81821/116.06753">116.06753 East, 39.81821 North</a>.</p>
<p>As of this writing, the satellite map images from Bing and Yandex show the village that used to be here a few years ago before construction began. Below is a rendering of GBA&#39;s building footprints for this area on top of a satellite image from Yandex.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_ZVGNMqahFo.jpg">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_ZVGNMqahFo.jpg"/>
</a></p><p>The buildings shown aren&#39;t from GBA&#39;s &#34;ours2&#34; dataset but rather old OSM data. This is what OSM currently looks like.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/brave_bTkEFPvSdi.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/brave_bTkEFPvSdi.png"/>
</a></p><p>Esri has a relatively recent image of this area. Below you can see GBA&#39;s data on top of it.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_fJHQczxGWA.jpg">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_fJHQczxGWA.jpg"/>
</a></p><p>As GBA has now been published and there hasn&#39;t been any announcement of upcoming updates, any priority on conflicting footprints should go in favour of the latest OSM building footprints.</p>
<p>For specific areas with a lot of construction, it might be worth excluding any OSM-sourced buildings in GBA&#39;s dataset entirely and use <a href="https://tech.marksblogg.com/overture-dec-2024-update.html">Overture&#39;s</a> latest feed instead. Overture prioritise OSM data that will be, at most, weeks old when available.</p>
</div>

<div id="countries">
<h2>Countries</h2>
<p>Border towns can often get marked as being in another country in datasets I come across. I&#39;m pleased to say I haven&#39;t found this issue in this dataset.</p>
<p>Below is Narva, Estonia&#39;s buildings in blue and Ivangorod, Russia&#39;s in red. All of the buildings appear to be correctly marked with the country they&#39;re located in.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_jKrPTHuB7a.jpg">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_jKrPTHuB7a.jpg"/>
</a></p><p>Below are the building counts, rounded to the nearest million for the top 40 most prominent countries in this dataset.</p>

<div><pre><span></span><span>SELECT</span><span>   </span><span>ROUND</span><span>(</span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>/</span><span> </span><span>1</span><span>_000_000</span><span>)::</span><span>INT</span><span> </span><span>AS</span><span> </span><span>num_buildings</span><span>,</span>
<span>         </span><span>region</span>
<span>FROM</span><span>     </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>)</span>
<span>GROUP</span><span> </span><span>BY</span><span> </span><span>2</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>1</span><span> </span><span>DESC</span>
<span>LIMIT</span><span>    </span><span>40</span><span>;</span>
</pre></div>
<div><pre><span></span>┌───────────────┬─────────┐
│ num_buildings │ region  │
│     int32     │ varchar │
├───────────────┼─────────┤
│           467 │ IND     │
│           165 │ CHN     │
│           151 │ USA     │
│           139 │ BRA     │
│           115 │ IDN     │
│            84 │ MEX     │
│            74 │ RUS     │
│            67 │ NGA     │
│            62 │ PAK     │
│            60 │ VNM     │
│            53 │ FRA     │
│            51 │ JPN     │
│            48 │ THA     │
│            43 │ DEU     │
│            43 │ ZAF     │
│            40 │ BGD     │
│            38 │ ETH     │
│            35 │ PHL     │
│            33 │ ARG     │
│            30 │ TZA     │
│            28 │ KEN     │
│            28 │ UKR     │
│            27 │ SDN     │
│            26 │ COD     │
│            25 │ EGY     │
│            23 │ GBR     │
│            22 │ POL     │
│            22 │ UGA     │
│            21 │ TUR     │
│            21 │ ITA     │
│            21 │ PER     │
│            18 │ COL     │
│            18 │ MOZ     │
│            16 │ BFA     │
│            16 │ DZA     │
│            14 │ VEN     │
│            14 │ CHL     │
│            13 │ IRN     │
│            13 │ GHA     │
│            13 │ ROU     │
├───────────────┴─────────┤
│ 40 rows       2 columns │
└─────────────────────────┘
</pre></div>
<p>The 151M Buildings for the US is a bit of a surprise for me. The <a href="https://tech.marksblogg.com/ornl-fema-buildings.html">ORNL dataset</a> for last year had this number at 131M which included building usage and addresses.</p>
</div>
<div id="the-height-dataset">
<h2>The Height Dataset</h2>
<p>35 of the 36 TB of data TUM published is made up of GeoTIFF height maps stored in ZIP files. Each ZIP file contains 100s of GeoTIFFs.</p>
<div><pre><span></span>$<span> </span>wget<span> </span>-c<span> </span><span>&#34;https://dataserv.ub.tum.de/public.php/dav/files/m1782307/Height/africa/e000_n10_e005_n05.zip&#34;</span>
</pre></div>
<p>The above 96 GB ZIP file contains a total of 114.5 GB worth of GeoTIFFs.</p>
<div><pre><span></span>$<span> </span>unzip<span> </span>-l<span> </span>e000_n10_e005_n05.zip
</pre></div>
<div><pre><span></span>Archive:  e000_n10_e005_n05.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
266161026  2024-04-19 18:16   0.0_9.2_0.2_9.0_sr_ss.tif
264664332  2024-04-19 22:05   1.2_7.4_1.4_7.2_sr_ss.tif
...
262812174  2024-04-20 04:38   3.6_8.4_3.8_8.2_sr_ss.tif
264402340  2024-04-20 07:33   4.8_9.0_5.0_8.8_sr_ss.tif
---------                     -------
114525128728                     434 files
</pre></div>
<p>Below is one of the height maps rendered in QGIS.</p>
<p><a href="https://tech.marksblogg.com/theme/images/gba/qgis-bin_ntUQp4RVgq.png">
<img alt="GlobalBuildingAtlas" src="https://tech.marksblogg.com/theme/images/gba/qgis-bin_ntUQp4RVgq.png"/>
</a></p><p>Below is the metadata on the above 254 MB GeoTIFF.</p>
<div><pre><span></span>$<span> </span>exiftool<span> </span><span>0</span>.2_8.8_0.4_8.6_sr_ss.tif<span> </span><span>\</span>
<span>    </span><span>|</span><span> </span>jc<span> </span>--kv<span> </span><span>\</span>
<span>    </span><span>|</span><span> </span>jq<span> </span>-S<span> </span>.
</pre></div>
<div><pre><span></span><span>{</span>
<span>  </span><span>&#34;Bits Per Sample&#34;</span><span>:</span><span> </span><span>&#34;32&#34;</span><span>,</span>
<span>  </span><span>&#34;Compression&#34;</span><span>:</span><span> </span><span>&#34;Uncompressed&#34;</span><span>,</span>
<span>  </span><span>&#34;Directory&#34;</span><span>:</span><span> </span><span>&#34;.&#34;</span><span>,</span>
<span>  </span><span>&#34;Exif Byte Order&#34;</span><span>:</span><span> </span><span>&#34;Little-endian (Intel, II)&#34;</span><span>,</span>
<span>  </span><span>&#34;ExifTool Version Number&#34;</span><span>:</span><span> </span><span>&#34;12.76&#34;</span><span>,</span>
<span>  </span><span>&#34;File Access Date/Time&#34;</span><span>:</span><span> </span><span>&#34;2025:09:02 19:17:14+03:00&#34;</span><span>,</span>
<span>  </span><span>&#34;File Inode Change Date/Time&#34;</span><span>:</span><span> </span><span>&#34;2025:09:02 18:16:24+03:00&#34;</span><span>,</span>
<span>  </span><span>&#34;File Modification Date/Time&#34;</span><span>:</span><span> </span><span>&#34;2024:04:19 18:52:54+03:00&#34;</span><span>,</span>
<span>  </span><span>&#34;File Name&#34;</span><span>:</span><span> </span><span>&#34;0.2_8.8_0.4_8.6_sr_ss.tif&#34;</span><span>,</span>
<span>  </span><span>&#34;File Permissions&#34;</span><span>:</span><span> </span><span>&#34;-rwxrwxrwx&#34;</span><span>,</span>
<span>  </span><span>&#34;File Size&#34;</span><span>:</span><span> </span><span>&#34;266 MB&#34;</span><span>,</span>
<span>  </span><span>&#34;File Type&#34;</span><span>:</span><span> </span><span>&#34;TIFF&#34;</span><span>,</span>
<span>  </span><span>&#34;File Type Extension&#34;</span><span>:</span><span> </span><span>&#34;tif&#34;</span><span>,</span>
<span>  </span><span>&#34;GDAL No Data&#34;</span><span>:</span><span> </span><span>&#34;-1&#34;</span><span>,</span>
<span>  </span><span>&#34;GT Citation&#34;</span><span>:</span><span> </span><span>&#34;WGS 84 / UTM zone 31N&#34;</span><span>,</span>
<span>  </span><span>&#34;GT Model Type&#34;</span><span>:</span><span> </span><span>&#34;Projected&#34;</span><span>,</span>
<span>  </span><span>&#34;GT Raster Type&#34;</span><span>:</span><span> </span><span>&#34;Pixel Is Area&#34;</span><span>,</span>
<span>  </span><span>&#34;Geo Tiff Version&#34;</span><span>:</span><span> </span><span>&#34;1.1.0&#34;</span><span>,</span>
<span>  </span><span>&#34;Geog Angular Units&#34;</span><span>:</span><span> </span><span>&#34;Angular Degree&#34;</span><span>,</span>
<span>  </span><span>&#34;Geog Citation&#34;</span><span>:</span><span> </span><span>&#34;WGS 84&#34;</span><span>,</span>
<span>  </span><span>&#34;Image Height&#34;</span><span>:</span><span> </span><span>&#34;8172&#34;</span><span>,</span>
<span>  </span><span>&#34;Image Size&#34;</span><span>:</span><span> </span><span>&#34;8133x8172&#34;</span><span>,</span>
<span>  </span><span>&#34;Image Width&#34;</span><span>:</span><span> </span><span>&#34;8133&#34;</span><span>,</span>
<span>  </span><span>&#34;MIME Type&#34;</span><span>:</span><span> </span><span>&#34;image/tiff&#34;</span><span>,</span>
<span>  </span><span>&#34;Megapixels&#34;</span><span>:</span><span> </span><span>&#34;66.5&#34;</span><span>,</span>
<span>  </span><span>&#34;Model Tie Point&#34;</span><span>:</span><span> </span><span>&#34;0 0 0 190683 975006 0&#34;</span><span>,</span>
<span>  </span><span>&#34;Photometric Interpretation&#34;</span><span>:</span><span> </span><span>&#34;BlackIsZero&#34;</span><span>,</span>
<span>  </span><span>&#34;Pixel Scale&#34;</span><span>:</span><span> </span><span>&#34;3 3 0&#34;</span><span>,</span>
<span>  </span><span>&#34;Planar Configuration&#34;</span><span>:</span><span> </span><span>&#34;Chunky&#34;</span><span>,</span>
<span>  </span><span>&#34;Proj Linear Units&#34;</span><span>:</span><span> </span><span>&#34;Linear Meter&#34;</span><span>,</span>
<span>  </span><span>&#34;Projected CS Type&#34;</span><span>:</span><span> </span><span>&#34;WGS84 UTM zone 31N&#34;</span><span>,</span>
<span>  </span><span>&#34;Rows Per Strip&#34;</span><span>:</span><span> </span><span>&#34;1&#34;</span><span>,</span>
<span>  </span><span>&#34;Sample Format&#34;</span><span>:</span><span> </span><span>&#34;Float&#34;</span><span>,</span>
<span>  </span><span>&#34;Samples Per Pixel&#34;</span><span>:</span><span> </span><span>&#34;1&#34;</span><span>,</span>
<span>  </span><span>&#34;Strip Byte Counts&#34;</span><span>:</span><span> </span><span>&#34;(Binary data 49031 bytes, use -b option to extract)&#34;</span><span>,</span>
<span>  </span><span>&#34;Strip Offsets&#34;</span><span>:</span><span> </span><span>&#34;(Binary data 78308 bytes, use -b option to extract)&#34;</span>
<span>}</span>
</pre></div>
</div>

        </div><p>
            Thank you for taking the time to read this post. I offer both consulting and hands-on development services to clients in North America and Europe. If you&#39;d like to discuss how my offerings can help your business please contact me via <a href="https://uk.linkedin.com/in/marklitwintschik/">LinkedIn</a>.
        </p></div>
  </body>
</html>
