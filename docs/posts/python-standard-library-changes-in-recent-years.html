<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://antonz.org/python-stdlib-changes/">Original</a>
    <h1>Python Standard Library changes in recent years</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>
<article>
<div>
<div>
<header>

</header>
<p>With each major Python release, all the attention goes to the new language features: the walrus operator, dictionary merging, pattern matching. There is also a lot of writing about <code>asyncio</code> and <code>typing</code> modules — they are developing rapidly and are obviously important for the core team.</p>
<p>The rest of the standard library modules receive undeservedly little attention. I want to fix this and tell you about the novelties introduced in versions 3.8–3.10.</p>
<blockquote>
<p>This is not an exhaustive list, of course. I write only about those changes that interested me personally. But since I am not too much different from the “average” Python backend developer, it is likely that you will also be interested. Let me know if I missed something.</p>
</blockquote>
<p>The modules are in alphabetical order, so if you get bored with the first (little-known) ones, do not be discouraged — it gets more exciting further.</p>
<p><a href="#array">array</a> • <a href="#base64">base64</a> • <a href="#bisect">bisect</a> • <a href="#builtins">builtins</a> • <a href="#dataclasses">dataclasses</a> • <a href="#datetime">datetime</a> • <a href="#fractions">fractions</a> • <a href="#functools">functools</a> • <a href="#glob">glob</a> • <a href="#graphlib">graphlib</a> • <a href="#itertools">itertools</a> • <a href="#math">math</a> • <a href="#random">random</a> • <a href="#shlex">shlex</a> • <a href="#shutil">shutil</a> • <a href="#statistics">statistics</a> • <a href="#zoneinfo">zoneinfo</a></p>
<p>All new features and improvements in the article are accompanied by examples. You can try them in the playground or run locally. If you have an older local Python, run it using Docker:</p>
<pre tabindex="0"><code>$ docker run -it --rm python:3.10-alpine
</code></pre><h2 id="array">array</h2>
<p><a href="https://docs.python.org/3/library/array"><code>array</code></a> module provides compact typed numeric arrays. It is used much less frequently than the famous <code>list</code> counterpart.</p>
<p><a href="https://docs.python.org/3/library/array#array.array.index"><code>array.index()</code></a> methods finds the value in the array and returns the index of the found element. Now it supports optional <code>start</code> and <code>stop</code> parameters, which define the search interval (3.10+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>array</span> <span>import</span> <span>array</span>
<span>arr</span> <span>=</span> <span>array</span>(<span>&#34;i&#34;</span>, [<span>7</span>, <span>11</span>, <span>19</span>, <span>42</span>])

<span>idx</span> <span>=</span> <span>arr</span><span>.</span><span>index</span>(<span>11</span>)
<span># idx == 1</span>

<span>idx</span> <span>=</span> <span>arr</span><span>.</span><span>index</span>(<span>11</span>, <span>2</span>)
<span># ValueError: array.index(x): x not in array</span>
</code></pre></div><p><a href="https://stepik.org/lesson/717024/step/2">playground</a></p>
<p>Contributed by: <a href="https://github.com/Phaqui">Anders Lorentsen</a> • <a href="https://github.com/ZackerySpytz">Zackery Spytz</a></p>
<h2 id="base64">base64</h2>
<p><a href="https://docs.python.org/3/library/base64"><code>base64</code></a> module encodes binary data into ASCII strings using Base16, Base32, and Base64 algorithms.</p>
<p>It received a couple of new functions: <a href="https://docs.python.org/3/library/base64#base64.b32hexencode"><code>b32hexencode()</code></a> and <a href="https://docs.python.org/3/library/base64#base64.b32hexdecode"><code>b32hexdecode()</code></a>, which use an extended 32-character alphabet according to <a href="https://datatracker.ietf.org/doc/html/rfc4648.html#section-7">RFC 4648</a> (3.10+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>base64</span>
<span>bytes</span> <span>=</span> <span>b</span><span>&#34;python is awesome&#34;</span>

<span>base64</span><span>.</span><span>b32encode</span>(<span>bytes</span>)
<span># b&#39;OB4XI2DPNYQGS4ZAMF3WK43PNVSQ====&#39;</span>

<span>base64</span><span>.</span><span>b32hexencode</span>(<span>bytes</span>)
<span># b&#39;E1SN8Q3FDOG6ISP0C5RMASRFDLIG====&#39;</span>
</code></pre></div><p><a href="https://stepik.org/lesson/717024/step/3">playground</a></p>
<p>Contributed by: <a href="https://github.com/FFY00">Filipe Laíns</a></p>
<h2 id="bisect">bisect</h2>
<p><a href="https://docs.python.org/3/library/bisect"><code>bisect</code></a> module works with sorted lists using binary search method. Main functions are:</p>
<ul>
<li><a href="https://docs.python.org/3/library/bisect#bisect.bisect"><code>bisect()</code></a> finds an item in the list;</li>
<li><a href="https://docs.python.org/3/library/bisect#bisect.insort"><code>insort()</code></a> adds an item while retaining the order.</li>
</ul>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>bisect</span>

<span>lst</span> <span>=</span> [<span>7</span>, <span>11</span>, <span>19</span>, <span>42</span>]
<span>idx</span> <span>=</span> <span>bisect</span><span>.</span><span>bisect</span>(<span>lst</span>, <span>12</span>)
<span># idx == 2</span>

<span>bisect</span><span>.</span><span>insort</span>(<span>lst</span>, <span>12</span>)
<span># [7, 11, 12, 19, 42]</span>
</code></pre></div><p>Since version 3.10, all module functions support the optional <code>key</code> parameter. It is a function that returns the value of a list item. It is convenient to use if the elements cannot be compared directly:</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>bisect</span>
<span>import</span> <span>operator</span>

<span>p1</span> <span>=</span> {<span>&#34;id&#34;</span>: <span>11</span>, <span>&#34;name&#34;</span>: <span>&#34;Diane&#34;</span>}
<span>p2</span> <span>=</span> {<span>&#34;id&#34;</span>: <span>12</span>, <span>&#34;name&#34;</span>: <span>&#34;Bob&#34;</span>}
<span>p3</span> <span>=</span> {<span>&#34;id&#34;</span>: <span>13</span>, <span>&#34;name&#34;</span>: <span>&#34;Emma&#34;</span>}

<span>key</span> <span>=</span> <span>operator</span><span>.</span><span>itemgetter</span>(<span>&#34;name&#34;</span>)
<span>people</span> <span>=</span> <span>sorted</span>([<span>p1</span>, <span>p2</span>, <span>p3</span>], <span>key</span><span>=</span><span>key</span>)
<span># Bob, Diane, Emma</span>

<span>idx</span> <span>=</span> <span>bisect</span><span>.</span><span>bisect</span>(<span>people</span>, <span>&#34;Dan&#34;</span>)
<span># TypeError: &#39;&lt;&#39; not supported between instances of &#39;str&#39; and &#39;dict&#39;</span>

<span>idx</span> <span>=</span> <span>bisect</span><span>.</span><span>bisect</span>(<span>people</span>, <span>&#34;Dan&#34;</span>, <span>key</span><span>=</span><span>key</span>)
<span># idx == 1</span>
</code></pre></div><p><a href="https://stepik.org/lesson/717024/step/4">playground</a></p>
<p>Contributed by: <a href="https://github.com/rhettinger">Raymond Hettinger</a></p>
<h2 id="builtins">builtins</h2>
<p><a href="https://docs.python.org/3/library/builtins"><code>builtins</code></a> module contains all the built-in functions and classes that programmers use without imports: <code>int</code>, <code>list</code>, <code>len()</code>, <code>open()</code> and the like.</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>builtins</span>

<span>list</span> <span>is</span> <span>builtins</span><span>.</span><span>list</span>
<span># True</span>

<span>len</span> <span>is</span> <span>builtins</span><span>.</span><span>len</span>
<span># True</span>
</code></pre></div><p>The <strong>string</strong> received <a href="https://docs.python.org/3/library/stdtypes#str.removeprefix"><code>str.removeprefix()</code></a> and <a href="https://docs.python.org/3/library/stdtypes#str.removesuffix"><code>str.removesuffix()</code></a> methods, which cut off the string head and tail respectively (3.9+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>s</span> <span>=</span> <span>&#34;Python is awesome&#34;</span>

<span>s</span><span>.</span><span>removeprefix</span>(<span>&#34;Python is &#34;</span>)
<span># &#39;awesome&#39;</span>

<span>s</span><span>.</span><span>removesuffix</span>(<span>&#34; is awesome&#34;</span>)
<span># &#39;Python&#39;</span>
</code></pre></div><p>The <strong>integer</strong> received the <a href="https://docs.python.org/3/library/stdtypes#int.bit_count"><code>int.bit_count()</code></a> method, which returns the number of ones in the binary representation of the integer (3.10+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>n</span> <span>=</span> <span>42</span>

<span>bin</span>(<span>n</span>)
<span># &#39;0b101010&#39;</span>

<span>n</span><span>.</span><span>bit_count</span>()
<span># 3</span>
</code></pre></div><p>The <strong>dictionary</strong> methods <code>dict.key()</code>, <code>dict.values()</code> and <code>dict.items()</code> return view objects that reference dictionary data. Previously, it was impossible to get a reverse link to the dictionary from these objects, but now it can be done — through the <code>.mapping</code> attribute (3.10+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>people</span> <span>=</span> {
    <span>&#34;Diane&#34;</span>: <span>70</span>,
    <span>&#34;Bob&#34;</span>: <span>78</span>,
    <span>&#34;Emma&#34;</span>: <span>84</span>
}

<span>keys</span> <span>=</span> <span>people</span><span>.</span><span>keys</span>()
<span># dict_keys([&#39;Diane&#39;, &#39;Bob&#39;, &#39;Emma&#39;])</span>

<span>keys</span><span>.</span><span>mapping</span>[<span>&#34;Bob&#34;</span>]
<span># 78</span>
</code></pre></div><p><strong>Collection merging</strong> <a href="https://docs.python.org/3/library/functions#zip"><code>zip()</code></a> function received the <code>strict</code> parameter. It ensures that the sequences are of the same length (3.10+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>keys</span> <span>=</span> [<span>&#34;Diane&#34;</span>, <span>&#34;Bob&#34;</span>, <span>&#34;Emma&#34;</span>]
<span>vals</span> <span>=</span> [<span>70</span>, <span>78</span>, <span>84</span>, <span>42</span>]

<span>pairs</span> <span>=</span> <span>zip</span>(<span>keys</span>, <span>vals</span>)
<span>list</span>(<span>pairs</span>)
<span># [(&#39;Diane&#39;, 70), (&#39;Bob&#39;, 78), (&#39;Emma&#39;, 84)]</span>

<span>pairs</span> <span>=</span> <span>zip</span>(<span>keys</span>, <span>vals</span>, <span>strict</span><span>=</span><span>True</span>)
<span>list</span>(<span>pairs</span>)
<span># ValueError: zip() argument 2 is longer than argument 1</span>
</code></pre></div><p><a href="https://stepik.org/lesson/717024/step/5">playground</a></p>
<p>Contributed by: <a href="https://github.com/sweeneyde">Dennis Sweeney</a> • <a href="https://github.com/niklasf">Niklas Fiekas</a> • <a href="https://github.com/brandtbucher">Brandt Bucher</a></p>
<h2 id="dataclasses">dataclasses</h2>
<p><a href="https://docs.python.org/3/library/dataclasses"><code>dataclasses</code></a> module generates classes according to the specification.</p>
<p>Dataclasses can now use <a href="https://docs.python.org/3/reference/datamodel.html#slots"><code>slots</code></a>, which are great for creating <a href="https://antonz.org/compact-objects/">compact data objects</a> with a fixed set of properties (3.10+).</p>
<p>Regular dataclass:</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>dataclasses</span> <span>import</span> <span>dataclass</span>

<span>@dataclass</span>
<span>class</span> <span>Person</span>:
    <span>id</span>: <span>int</span>
    <span>name</span>: <span>str</span>

<span>diane</span> <span>=</span> <span>Person</span>(<span>id</span><span>=</span><span>11</span>, <span>name</span><span>=</span><span>&#34;Diane&#34;</span>)
<span>diane</span><span>.</span><span>__dict__</span>
<span># {&#39;id&#39;: 11, &#39;name&#39;: &#39;Diane&#39;}</span>
<span>diane</span><span>.</span><span>salary</span> <span>=</span> <span>70</span>
<span># ok</span>
</code></pre></div><p>Dataclass with slots:</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>dataclasses</span> <span>import</span> <span>dataclass</span>

<span>@dataclass</span>(<span>slots</span><span>=</span><span>True</span>)
<span>class</span> <span>SlotPerson</span>:
    <span>id</span>: <span>int</span>
    <span>name</span>: <span>str</span>

<span>bob</span> <span>=</span> <span>SlotPerson</span>(<span>id</span><span>=</span><span>12</span>, <span>name</span><span>=</span><span>&#34;Bob&#34;</span>)
<span>bob</span><span>.</span><span>__dict__</span>
<span># AttributeError: &#39;SlotPerson&#39; object has no attribute &#39;__dict__&#39;</span>
<span>bob</span><span>.</span><span>__slots__</span>
<span># (&#39;id&#39;, &#39;name&#39;)</span>
<span>bob</span><span>.</span><span>salary</span> <span>=</span> <span>78</span>
<span># AttributeError: &#39;SlotPerson&#39; object has no attribute &#39;salary&#39;</span>
</code></pre></div><p>Besides, the dataclass can now be forced to accept keyword-only parameters when creating an object (3.10+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>dataclasses</span> <span>import</span> <span>dataclass</span>

<span>@dataclass</span>(<span>kw_only</span><span>=</span><span>True</span>)
<span>class</span> <span>KeywordPerson</span>:
    <span>id</span>: <span>int</span>
    <span>name</span>: <span>str</span>

<span>diane</span> <span>=</span> <span>KeywordPerson</span>(<span>id</span><span>=</span><span>11</span>, <span>name</span><span>=</span><span>&#34;Diane&#34;</span>)
<span># ok</span>
<span>diane</span> <span>=</span> <span>KeywordPerson</span>(<span>11</span>, <span>&#34;Diane&#34;</span>)
<span># TypeError: KeywordPerson.__init__() takes 1 positional argument but 3 were given</span>
</code></pre></div><p><a href="https://stepik.org/lesson/717024/step/6">playground</a></p>
<p>Contributed by: <a href="https://github.com/uriyyo">Yurii Karabas</a> • <a href="https://github.com/ericvsmith">Eric V. Smith</a></p>
<h2 id="datetime">datetime</h2>
<p><a href="https://docs.python.org/3/library/datetime"><code>datetime</code></a> module (unsurprisingly) deals with date and time.</p>
<p>It received new <a href="https://docs.python.org/3/library/datetime#datetime.date.fromisocalendar"><code>date.fromisocalendar()</code></a> and <a href="https://docs.python.org/3/library/datetime#datetime.datetime.fromisocalendar"><code>datetime.fromisocalendar()</code></a> constructors, which create a date from the <code>(year, week, week_day)</code> trio (3.8+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>datetime</span> <span>as</span> <span>dt</span>

<span>day</span> <span>=</span> <span>dt</span><span>.</span><span>date</span>(<span>2022</span>, <span>9</span>, <span>13</span>)
<span>day</span><span>.</span><span>isocalendar</span>()
<span># datetime.IsoCalendarDate(year=2022, week=37, weekday=2)</span>

<span>year</span>, <span>week</span>, <span>day</span> <span>=</span> <span>day</span><span>.</span><span>isocalendar</span>()
<span>next_day</span> <span>=</span> <span>dt</span><span>.</span><span>date</span><span>.</span><span>fromisocalendar</span>(<span>year</span>, <span>week</span>, <span>day</span><span>+</span><span>1</span>)
<span># datetime.date(2022, 9, 14)</span>
</code></pre></div><p>Besides, the <code>.isocalendar()</code> method now returns a named <code>IsoCalendarDate</code> instead of the regular tuple (3.9+). You can see it in the example above.</p>
<p><a href="https://stepik.org/lesson/717024/step/7">playground</a></p>
<p>Contributed by: <a href="https://github.com/pganssle">Paul Ganssle</a> • <a href="https://github.com/corona10">Dong-hee Na</a></p>
<h2 id="fractions">fractions</h2>
<p><a href="https://docs.python.org/3/library/fractions"><code>fractions</code></a> module works with rational numbers.</p>
<p>It received the <a href="https://docs.python.org/3/library/fractions#fractions.Fraction.as_integer_ratio"><code>Fraction.as_integer_ratio()</code></a> method to return a fraction as a <code>(numerator, denominator)</code> pair, thereby fixing the age-old shame of the usual <code>float</code> (3.8+):</p>
<div><pre tabindex="0"><code data-lang="python">(<span>0.25</span>)<span>.</span><span>as_integer_ratio</span>()
<span># (1, 4)</span>

(<span>0.5</span>)<span>.</span><span>as_integer_ratio</span>()
<span># (1, 2)</span>

(<span>0.2</span>)<span>.</span><span>as_integer_ratio</span>()
<span># (3602879701896397, 18014398509481984)</span>
<span># oopsie</span>
</code></pre></div><div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>fractions</span> <span>import</span> <span>Fraction</span>

<span>Fraction</span>(<span>&#34;0.2&#34;</span>)<span>.</span><span>as_integer_ratio</span>()
<span># (1, 5)</span>
<span># so much better</span>
</code></pre></div><p>To be fair, <code>decimal.Decimal</code> learned to do this back in 3.6. But it’s still nice.</p>
<p><a href="https://stepik.org/lesson/717024/step/8">playground</a></p>
<p>Contributed by: <a href="https://github.com/lisroach">Lisa Roach</a> • <a href="https://github.com/rhettinger">Raymond Hettinger</a></p>

<p><a href="https://docs.python.org/3/library/functools"><code>functools</code></a> module is a collection of higher-order auxiliary functions. One of them is <a href="https://docs.python.org/3/library/functools#functools.lru_cache"><code>lru_cache()</code></a>, which caches expensive calculations:</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>functools</span>
<span>import</span> <span>time</span>

<span>@functools</span><span>.</span><span>lru_cache</span>(<span>maxsize</span><span>=</span><span>256</span>)
<span>def</span> <span>find_user</span>(<span>name</span>):
    <span># imitating slow search</span>
    <span>time</span><span>.</span><span>sleep</span>(<span>1</span>)
    <span>user</span> <span>=</span> {<span>&#34;id&#34;</span>: <span>11</span>, <span>&#34;name&#34;</span>: <span>&#34;Diane&#34;</span>}
    <span>return</span> <span>user</span>

<span>find_user</span>(<span>&#34;Diane&#34;</span>)
<span># kinda slow</span>

<span>find_user</span>(<span>&#34;Diane&#34;</span>)
<span># blazingly fast</span>
</code></pre></div><p>Previously, it required to explicitly set the cache size. And now you can specify <code>@lru_cache</code> without arguments, using the default size of <code>128</code> (3.8+).</p>
<p>Besides, you can get the cache parameters (3.9+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>find_user</span><span>.</span><span>cache_parameters</span>()
<span># {&#39;maxsize&#39;: 256, &#39;typed&#39;: False}</span>
</code></pre></div><p>If you don’t mind the memory usage, you can use the unlimited <a href="https://docs.python.org/3/library/functools#functools.cache"><code>@cache</code></a> instead of <code>@lru_cache</code> (3.9+).</p>
<p>New <a href="https://docs.python.org/3/library/functools#functools.cached_property"><code>@cached_property</code></a> decorator caches the calculated object property (3.8+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>functools</span>
<span>import</span> <span>statistics</span>

<span>class</span> <span>Dataset</span>:
    <span>def</span> <span>__init__</span>(<span>self</span>, <span>seq</span>):
        <span>self</span><span>.</span><span>_data</span> <span>=</span> <span>tuple</span>(<span>seq</span>)

    <span>@functools</span><span>.</span><span>cached_property</span>
    <span>def</span> <span>stdev</span>(<span>self</span>):
        <span>return</span> <span>statistics</span><span>.</span><span>stdev</span>(<span>self</span><span>.</span><span>_data</span>)

<span>dataset</span> <span>=</span> <span>Dataset</span>(<span>range</span>(<span>1_000_000</span>))

<span>dataset</span><span>.</span><span>stdev</span>
<span># kinda slow</span>

<span>dataset</span><span>.</span><span>stdev</span>
<span># blazingly fast</span>
</code></pre></div><p>And <a href="https://docs.python.org/3/library/functools#functools.singledispatchmethod"><code>@singledispatchmethod</code></a> overloads the method depending on the parameter type (3.8+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>functools</span>

<span>class</span> <span>Divider</span>:
    <span>@functools</span><span>.</span><span>singledispatchmethod</span>
    <span>def</span> <span>divide</span>(<span>self</span>, <span>dividend</span>, <span>divisor</span>):
        <span>raise</span> <span>NotImplementedError</span>(<span>&#34;Do not know how to divide those&#34;</span>)

    <span>@divide</span><span>.</span><span>register</span>
    <span>def</span> <span>_</span>(<span>self</span>, <span>dividend</span>: <span>int</span>, <span>divisor</span>: <span>int</span>):
        <span>return</span> <span>dividend</span> <span>//</span> <span>divisor</span>

    <span>@divide</span><span>.</span><span>register</span>
    <span>def</span> <span>_</span>(<span>self</span>, <span>dividend</span>: <span>str</span>, <span>divisor</span>: <span>int</span>):
        <span># this is really stupid, I know</span>
        <span>newlen</span> <span>=</span> <span>len</span>(<span>dividend</span>) <span>//</span> <span>divisor</span>
        <span>return</span> <span>dividend</span>[:<span>newlen</span>]

<span>divider</span> <span>=</span> <span>Divider</span>()
<span>divider</span><span>.</span><span>divide</span>(<span>10</span>, <span>2</span>)
<span># 5</span>

<span>divider</span><span>.</span><span>divide</span>(<span>&#34;hello world&#34;</span>, <span>2</span>)
<span># &#39;hello&#39;</span>
</code></pre></div><p>Smells like Java to me.</p>
<p><a href="https://stepik.org/lesson/717024/step/9">playground</a></p>
<p>Contributed by: <a href="https://github.com/rhettinger">Raymond Hettinger</a> • <a href="https://github.com/carljm">Carl Meyer</a> • <a href="https://github.com/ethanhs">Ethan Smith</a></p>
<h2 id="glob">glob</h2>
<p><a href="https://docs.python.org/3/library/glob"><code>glob</code></a> module searches for files and directories that match the template.</p>
<p>Now thanks to the <code>root_dir</code> parameter in <a href="https://docs.python.org/3/library/glob#glob.glob"><code>glob()</code></a> and <a href="https://docs.python.org/3/library/glob#glob.iglob"><code>iglob()</code></a> functions you can specify the root directory of the search (3.10+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>glob</span>
<span>import</span> <span>os</span>

<span>os</span><span>.</span><span>getcwd</span>()
<span># &#39;/&#39;</span>

<span>glob</span><span>.</span><span>glob</span>(<span>&#34;*&#34;</span>, <span>root_dir</span><span>=</span><span>&#34;/usr&#34;</span>)
<span># [&#39;local&#39;, &#39;share&#39;, &#39;bin&#39;, &#39;lib&#39;, &#39;sbin&#39;, &#39;src&#39;]</span>
</code></pre></div><p>It’s a small thing, but it’s nice.</p>
<p><a href="https://stepik.org/lesson/717024/step/10">playground</a></p>
<p>Contributed by: <a href="https://github.com/serhiy-storchaka">Serhiy Storchaka</a></p>
<h2 id="graphlib">graphlib</h2>
<p><a href="https://docs.python.org/3/library/graphlib"><code>graphlib</code></a> module works with graphs. And you know what? This is a brand-new module! (3.9+)</p>
<p>So far, it has only one feature — topological graph sorting (an ordering of vertices such that for any <code>u → v</code>, the vertex <code>u</code> comes before <code>v</code>):</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>graphlib</span> <span>import</span> <span>TopologicalSorter</span>

<span>graph</span> <span>=</span> {<span>&#34;Diane&#34;</span>: {<span>&#34;Bob&#34;</span>, <span>&#34;Cindy&#34;</span>}, <span>&#34;Cindy&#34;</span>: {<span>&#34;Alice&#34;</span>}, <span>&#34;Bob&#34;</span>: {<span>&#34;Alice&#34;</span>}}
<span># Alice → Bob → Diane</span>
<span>#     ↳ Cindy ↗</span>

<span>sorter</span> <span>=</span> <span>TopologicalSorter</span>(<span>graph</span>)
<span>list</span>(<span>sorter</span><span>.</span><span>static_order</span>())
<span># [&#39;Alice&#39;, &#39;Cindy&#39;, &#39;Bob&#39;, &#39;Diane&#39;]</span>
</code></pre></div><p><a href="https://stepik.org/lesson/717025/step/2">playground</a></p>
<p>Contributed by: <a href="https://github.com/pablogsal">Pablo Galindo</a> • <a href="https://github.com/tim-one">Tim Peters</a> • <a href="https://github.com/larryhastings">Larry Hastings</a></p>

<p><a href="https://docs.python.org/3/library/itertools"><code>itertools</code></a> module provides a variety of iterators for memory-efficient collection processing.</p>
<p>One of them is the <a href="https://docs.python.org/3/library/itertools#itertools.accumulate"><code>accumulate()</code></a> function, which calculates the rolling aggregate. Now it allows the <code>initial</code> parameter, which sets the initial value (3.8+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>itertools</span>

<span>seq</span> <span>=</span> [<span>7</span>, <span>11</span>, <span>19</span>, <span>42</span>]

<span>accumulator</span> <span>=</span> <span>itertools</span><span>.</span><span>accumulate</span>(<span>seq</span>)
<span>list</span>(<span>accumulator</span>)
<span># [7, 18, 37, 79]</span>

<span>accumulator</span> <span>=</span> <span>itertools</span><span>.</span><span>accumulate</span>(<span>seq</span>, <span>initial</span><span>=</span><span>100</span>)
<span>list</span>(<span>accumulator</span>)
<span># [100, 107, 118, 137, 179]</span>
</code></pre></div><p>And the shiny new <a href="https://docs.python.org/3/library/itertools#itertools.pairwise"><code>pairwise()</code></a> function traverses the collection and yields pairs of consecutive elements (3.10+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>itertools</span>

<span>seq</span> <span>=</span> [<span>7</span>, <span>11</span>, <span>19</span>, <span>42</span>]
<span>pairer</span> <span>=</span> <span>itertools</span><span>.</span><span>pairwise</span>(<span>seq</span>)

<span>list</span>(<span>pairer</span>)
<span># [(7, 11), (11, 19), (19, 42)]</span>
</code></pre></div><p><a href="https://stepik.org/lesson/717025/step/3">playground</a></p>
<p>Contributed by: <a href="https://github.com/lisroach">Lisa Roach</a> • <a href="https://github.com/rhettinger">Raymond Hettinger</a></p>
<h2 id="math">math</h2>
<p><a href="https://docs.python.org/3/library/math"><code>math</code></a> module includes an abundance of mathematical functions.</p>
<p>There are a lot of news here:</p>
<ul>
<li><a href="https://docs.python.org/3/library/math#math.dist"><code>dist()</code></a> calculates the Euclidean distance between points (3.8+);</li>
<li><a href="https://docs.python.org/3/library/math#math.perm"><code>perm()</code></a> and <a href="https://docs.python.org/3/library/math#math.comb"><code>comb()</code></a> count the number of permutations and combinations (3.8+);</li>
<li><a href="https://docs.python.org/3/library/math#math.lcm"><code>lcm()</code></a> computes the least common multiple (3.9+);</li>
<li><a href="https://docs.python.org/3/library/math#math.gcd"><code>gcd()</code></a> now computes the greatest common divisor for an arbitrary number of arguments (3.9+).</li>
</ul>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>math</span>

<span>math</span><span>.</span><span>dist</span>((<span>1</span>,<span>1</span>), (<span>4</span>, <span>5</span>))
<span># 5.0</span>

<span>math</span><span>.</span><span>perm</span>(<span>5</span>, <span>2</span>)
<span># 20</span>

<span>math</span><span>.</span><span>comb</span>(<span>5</span>, <span>2</span>)
<span># 10</span>

<span>math</span><span>.</span><span>lcm</span>(<span>9</span>, <span>27</span>, <span>60</span>)
<span># 540</span>

<span>math</span><span>.</span><span>gcd</span>(<span>9</span>, <span>27</span>, <span>60</span>)
<span># 3</span>
</code></pre></div><p>And <a href="https://docs.python.org/3/library/math#math.prod"><code>prod()</code></a> multiplies the sequence elements (3.8+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>math</span>

<span>seq</span> <span>=</span> <span>range</span>(<span>3</span>, <span>9</span>)
<span>math</span><span>.</span><span>prod</span>(<span>seq</span>)
<span># 20160</span>
</code></pre></div><p><a href="https://stepik.org/lesson/717025/step/4">playground</a></p>
<p>Contributed by: <a href="https://github.com/rhettinger">Raymond Hettinger</a> • <a href="https://github.com/FR4NKESTI3N">Yash Aggarwal</a> • <a href="https://github.com/KellerFuchs">Keller Fuchs</a> • <a href="https://github.com/serhiy-storchaka">Serhiy Storchaka</a> • <a href="https://github.com/mdickinson">Mark Dickinson</a> • <a href="https://github.com/ananthan-123">Ananthakrishnan</a> • <a href="https://github.com/pablogsal">Pablo Galindo</a></p>
<h2 id="random">random</h2>
<p><a href="https://docs.python.org/3/library/random"><code>random</code></a> module handles random numbers.</p>
<p>New <a href="https://docs.python.org/3/library/random#random.randbytes"><code>randbytes()</code></a> method generates a random byte string (3.9+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>random</span>

<span>random</span><span>.</span><span>randbytes</span>(<span>4</span>)
<span># b&#39;\x8b\xd4\x8f\xc9&#39;</span>
</code></pre></div><p><a href="https://stepik.org/lesson/717025/step/5">playground</a></p>
<p>Contributed by: <a href="https://github.com/vstinner">Victor Stinner</a></p>
<h2 id="shlex">shlex</h2>
<p><a href="https://docs.python.org/3/library/shlex"><code>shlex</code></a> module splits the string into tokens according to the Unix command line rules.</p>
<p>And now it also joins the tokens back into the string — thanks to the <a href="https://docs.python.org/3/library/shlex#shlex.join"><code>join()</code></a> function (3.8+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>shlex</span>

<span>tokens</span> <span>=</span> [<span>&#34;echo&#34;</span>, <span>&#34;-n&#34;</span>, <span>&#34;Python is awesome&#34;</span>]
<span>shlex</span><span>.</span><span>join</span>(<span>tokens</span>)
<span># &#34;echo -n &#39;Python is awesome&#39;&#34;</span>
</code></pre></div><p><a href="https://stepik.org/lesson/717025/step/6">playground</a></p>
<p>Contributed by: <a href="https://github.com/bbayles">Bo Bayles</a></p>
<h2 id="shutil">shutil</h2>
<p><a href="https://docs.python.org/3/library/shutil"><code>shutil</code></a> module works with files and directories: copies, moves and deletes them.</p>
<p>Copying directories has now become a little more convenient — kudos to the <code>dirs_exist_ok</code> parameter in the <a href="https://docs.python.org/3/library/shutil#shutil.copytree"><code>copytree()</code></a> function (3.8+). If it is on, the function allows the target directory to exist:</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>pathlib</span> <span>import</span> <span>Path</span>
<span>import</span> <span>shutil</span>

<span>tmp</span> <span>=</span> <span>Path</span>(<span>&#34;/tmp&#34;</span>)

<span>src</span> <span>=</span> <span>tmp</span><span>.</span><span>joinpath</span>(<span>&#34;src&#34;</span>)
<span>src</span><span>.</span><span>mkdir</span>()
<span>src</span><span>.</span><span>joinpath</span>(<span>&#34;src.txt&#34;</span>)<span>.</span><span>touch</span>()
<span># /tmp/src</span>
<span># /tmp/src/src.txt</span>

<span>dst</span> <span>=</span> <span>tmp</span><span>.</span><span>joinpath</span>(<span>&#34;dst&#34;</span>)
<span>dst</span><span>.</span><span>mkdir</span>()
<span># /tmp/dst</span>

<span>shutil</span><span>.</span><span>copytree</span>(<span>src</span>, <span>dst</span>)
<span># FileExistsError: [Errno 17] File exists: &#39;/tmp/dst&#39;</span>
<span>shutil</span><span>.</span><span>copytree</span>(<span>src</span>, <span>dst</span>, <span>dirs_exist_ok</span><span>=</span><span>True</span>)
<span># PosixPath(&#39;/tmp/dst&#39;)</span>
</code></pre></div><p><a href="https://stepik.org/lesson/717025/step/7">playground</a></p>
<p>Contributed by: <a href="https://github.com/jab">Josh Bronson</a></p>
<h2 id="statistics">statistics</h2>
<p><a href="https://docs.python.org/3/library/statistics"><code>statistics</code></a> module handles mathematical statistics. Like <code>math</code>, it has greatly improved in recent releases. Not <code>scipy</code> yet, but it’s not the kindergarten version Python had in 3.4.</p>
<p>See for yourself:</p>
<ul>
<li><a href="https://docs.python.org/3/library/statistics#statistics.fmean"><code>fmean()</code></a> computes the arithmetic mean (like <code>mean()</code>, only faster) (3.8+);</li>
<li><a href="https://docs.python.org/3/library/statistics#statistics.geometric_mean"><code>geometric_mean()</code></a> computes the geometric mean (3.8+);</li>
<li><a href="https://docs.python.org/3/library/statistics#statistics.multimode"><code>multimode()</code></a> returns the modes (the most frequent values in the dataset), even if there are multiple ones (in contrast to <code>mode()</code>) (3.8+);</li>
<li><a href="https://docs.python.org/3/library/statistics#statistics.quantiles"><code>quantiles()</code></a> splits the dataset into quantiles and returns the cut points (3.8+).</li>
</ul>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>statistics</span>

<span>seq</span> <span>=</span> <span>list</span>(<span>range</span>(<span>1</span>, <span>10</span>))

<span>statistics</span><span>.</span><span>fmean</span>(<span>seq</span>)
<span># 5.0</span>

<span>statistics</span><span>.</span><span>geometric_mean</span>(<span>seq</span>)
<span># 4.147166274396913</span>

<span>statistics</span><span>.</span><span>multimode</span>(<span>seq</span>)
<span># [1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
<span>statistics</span><span>.</span><span>multimode</span>(<span>&#34;python is awesome&#34;</span>)
<span># [&#39;o&#39;, &#39; &#39;, &#39;s&#39;, &#39;e&#39;]</span>

<span>statistics</span><span>.</span><span>quantiles</span>(<span>seq</span>)
<span># [2.5, 5.0, 7.5]</span>
</code></pre></div><p><a href="https://docs.python.org/3/library/statistics#statistics.NormalDist"><code>NormalDist</code></a> describes the normal distribution of a random variable (3.8+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>statistics</span> <span>import</span> <span>NormalDist</span>

<span>birth_weights</span> <span>=</span> <span>NormalDist</span><span>.</span><span>from_samples</span>([<span>2.5</span>, <span>3.1</span>, <span>2.1</span>, <span>2.4</span>, <span>2.7</span>, <span>3.5</span>])
<span>drug_effects</span> <span>=</span> <span>NormalDist</span>(<span>0.4</span>, <span>0.15</span>)
<span>combined</span> <span>=</span> <span>birth_weights</span> <span>+</span> <span>drug_effects</span>

<span>round</span>(<span>combined</span><span>.</span><span>mean</span>, <span>1</span>)
<span># 3.1</span>

<span>round</span>(<span>combined</span><span>.</span><span>stdev</span>, <span>1</span>)
<span># 0.5</span>
</code></pre></div><p>The module received Pearson <a href="https://docs.python.org/3/library/statistics#statistics.correlation"><code>correlation()</code></a> and <a href="https://docs.python.org/3/library/statistics#statistics.covariance"><code>covariance()</code></a> functions (3.10+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>statistics</span>

<span>x</span> <span>=</span> [<span>1</span>, <span>2</span>, <span>3</span>, <span>4</span>, <span>5</span>, <span>6</span>, <span>7</span>, <span>8</span>, <span>9</span>]
<span>y</span> <span>=</span> [<span>9</span>, <span>8</span>, <span>7</span>, <span>6</span>, <span>5</span>, <span>4</span>, <span>3</span>, <span>2</span>, <span>1</span>]

<span>statistics</span><span>.</span><span>correlation</span>(<span>x</span>, <span>x</span>)
<span># 1.0</span>

<span>statistics</span><span>.</span><span>correlation</span>(<span>x</span>, <span>y</span>)
<span># -1.0</span>

<span>statistics</span><span>.</span><span>covariance</span>(<span>x</span>, <span>x</span>)
<span># 7.5</span>

<span>statistics</span><span>.</span><span>covariance</span>(<span>x</span>, <span>y</span>)
<span># -7.5</span>
</code></pre></div><p>And even the <a href="https://docs.python.org/3/library/statistics#statistics.linear_regression"><code>linear_regression()</code></a> calculator (3.10+):</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>statistics</span>

<span>movies_by_year</span> <span>=</span> {
    <span>2000</span>: <span>371</span>,
    <span>2003</span>: <span>507</span>,
    <span>2006</span>: <span>608</span>,
    <span>2009</span>: <span>520</span>,
    <span>2012</span>: <span>669</span>,
    <span>2015</span>: <span>708</span>,
    <span>2018</span>: <span>873</span>,
    <span>2021</span>: <span>403</span>,
}

<span>x</span> <span>=</span> <span>movies_by_year</span><span>.</span><span>keys</span>()
<span>y</span> <span>=</span> <span>movies_by_year</span><span>.</span><span>values</span>()
<span>slope</span>, <span>intercept</span> <span>=</span> <span>statistics</span><span>.</span><span>linear_regression</span>(<span>x</span>, <span>y</span>)

<span>year_2022</span> <span>=</span> <span>round</span>(<span>slope</span> <span>*</span> <span>2022</span> <span>+</span> <span>intercept</span>)
<span># 697</span>
</code></pre></div><p>By the way, the <code>statistics</code> module is also famous for its excellent documentation. Check it out.</p>
<p><a href="https://stepik.org/lesson/717025/step/8">playground</a></p>
<p>Contributed by: <a href="https://github.com/rhettinger">Raymond Hettinger</a> • <a href="https://github.com/stevendaprano">Steven D’Aprano</a> • <a href="https://github.com/twolodzko">Timothy Wolodzko</a></p>
<h2 id="zoneinfo">zoneinfo</h2>
<p><a href="https://docs.python.org/3/library/zoneinfo"><code>zoneinfo</code></a> module provides information about time zones around the world. Another new module! (3.9+)</p>
<p>Before the <code>zoneinfo</code> appearance, Python had a single ascetic <code>timezone.utc</code> time zone. Well, not anymore:</p>
<div><pre tabindex="0"><code data-lang="python"><span>import</span> <span>datetime</span> <span>as</span> <span>dt</span>
<span>from</span> <span>zoneinfo</span> <span>import</span> <span>ZoneInfo</span>

<span>utc</span> <span>=</span> <span>dt</span><span>.</span><span>datetime</span>(<span>2022</span>, <span>9</span>, <span>13</span>, <span>hour</span><span>=</span><span>21</span>, <span>tzinfo</span><span>=</span><span>dt</span><span>.</span><span>timezone</span><span>.</span><span>utc</span>)
<span># 2022-09-13 21:00:00+00:00</span>

<span>paris</span> <span>=</span> <span>utc</span><span>.</span><span>astimezone</span>(<span>ZoneInfo</span>(<span>&#34;Europe/Paris&#34;</span>))
<span># 2022-09-13 23:00:00+02:00</span>

<span>tokyo</span> <span>=</span> <span>utc</span><span>.</span><span>astimezone</span>(<span>ZoneInfo</span>(<span>&#34;Asia/Tokyo&#34;</span>))
<span># 2022-09-14 06:00:00+09:00</span>

<span>sydney</span> <span>=</span> <span>utc</span><span>.</span><span>astimezone</span>(<span>ZoneInfo</span>(<span>&#34;Australia/Sydney&#34;</span>))
<span># 2022-09-14 07:00:00+10:00</span>
</code></pre></div><p><a href="https://stepik.org/lesson/717025/step/9">playground</a></p>
<p>Contributed by: <a href="https://github.com/pganssle">Paul Ganssle</a></p>
<h2 id="summary">Summary</h2>
<p>We have reviewed as many as 17 modules contributed by 27 devs — and this is without taking into account <code>asyncio</code>, <code>typing</code> and many other lower-level ones. As you can see, the standard library is actively developing. And the new features are quite reasonable. I hope you will find the described novelties useful!</p>
<p>I would also like to specifically thank the contributors for their amazing work:</p>
<ul>
<li><a href="https://twitter.com/carljm">Carl Meyer</a> for the <code>functools.cached_property()</code> decorator;</li>
<li><a href="https://github.com/sweeneyde">Dennis Sweeney</a> for the <code>str.removeprefix()</code> and <code>str.removesuffix()</code> methods;</li>
<li><a href="https://twitter.com/ethanhs">Ethan Smith</a> for the <code>functools.singledispatchmethod()</code> decorator;</li>
<li><a href="https://twitter.com/missingclara">Filipe Laíns</a> for the <code>base64.b32hexencode()</code> and <code>base64.b32hexdecode()</code> functions;</li>
<li><a href="https://twitter.com/lisroach">Lisa Roach</a> for the <code>Fraction.as_integer_ratio()</code> method and <code>itertools.accumulate()</code> improvements;</li>
<li><a href="https://twitter.com/niklasfiekas">Niklas Fiekas</a> for the <code>int.bit_count()</code> method;</li>
<li><a href="https://twitter.com/pyblogsal">Pablo Galindo</a> for the whole <code>graphlib</code> module and <code>math.prod()</code> function;</li>
<li><a href="https://twitter.com/pganssle">Paul Ganssle</a> for the whole <code>zoneinfo</code> module;</li>
<li><a href="https://twitter.com/raymondh">Raymond Hettinger</a> for lots of functions in the <code>statistics</code> module, <code>itertools.pairwise()</code> function, <code>key</code> parameter in the <code>bisect</code> module and his community work;</li>
<li><a href="https://twitter.com/serhiystorchaka">Serhiy Storchaka</a> and <a href="https://github.com/FR4NKESTI3N">Yash Aggarwal</a> for the combinatorics in the <code>math</code> module;</li>
<li><a href="https://twitter.com/tymwol">Timothy Wolodzko</a> for the <code>covariance()</code>, <code>correlation()</code>, and <code>linear_regression()</code> functions in the <code>statistics</code> module;</li>
<li><a href="https://twitter.com/victorstinner">Victor Stinner</a> for the <code>random.randbytes()</code> method.</li>
</ul>
<p><em>Follow <a href="https://twitter.com/ohmypy"><strong>@ohmypy</strong></a> on Twitter and <a href="http://digest.antonz.org/"><strong>subscribe by email</strong></a> to keep up with new posts</em> 🚀</p>
</div>
</div></article>

</div>
</div></div>
  </body>
</html>
