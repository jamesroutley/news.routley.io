<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://www.os2museum.com/wp/unlocking-netware-2-0a/">Original</a>
    <h1>Unlocking NetWare 2.0a</h1>
    
    <div id="readability-page-1" class="page"><div>
						
<p>A few months ago, the OS/2 Museum obtained a seemingly complete and error-free set of floppies with Advanced NetWare 286 2.0a SFT II. And just recently, a disk set of Advanced Netware 86 2.0a turned up, though sadly incomplete.</p>



<p>Both releases are from 1986 and share one rather unpleasant feature: The NetWare OS won’t run without a hardware key card:</p>


<div>
<figure><a href="http://www.os2museum.com/wp/wp-content/uploads/2024/02/nw20a-86-nokey.png"><img decoding="async" width="640" height="356" src="http://www.os2museum.com/wp/wp-content/uploads/2024/02/nw20a-86-nokey-640x356.png" alt="" srcset="http://www.os2museum.com/wp/wp-content/uploads/2024/02/nw20a-86-nokey-640x356.png 640w, http://www.os2museum.com/wp/wp-content/uploads/2024/02/nw20a-86-nokey-300x167.png 300w, http://www.os2museum.com/wp/wp-content/uploads/2024/02/nw20a-86-nokey.png 720w" sizes="(max-width: 640px) 100vw, 640px"/></a><figcaption>No NetWare for you, pirate!</figcaption></figure></div>


<p>All or most old NetWare versions sold before circa 1988 needed a custom hardware key which had to match the serial number that was burned into the NetWare disks. I’m not sure what the exact history was, but it is known that the NetWare serial number could be provided by Novell’s DCB, or Disk Coprocessor Board:</p>


<div>
<figure><a href="http://www.os2museum.com/wp/wp-content/uploads/2024/02/image-1.jpeg"><img decoding="async" width="640" height="480" src="http://www.os2museum.com/wp/wp-content/uploads/2024/02/image-1-640x480.jpeg" alt="" srcset="http://www.os2museum.com/wp/wp-content/uploads/2024/02/image-1-640x480.jpeg 640w, http://www.os2museum.com/wp/wp-content/uploads/2024/02/image-1-300x225.jpeg 300w, http://www.os2museum.com/wp/wp-content/uploads/2024/02/image-1-768x576.jpeg 768w, http://www.os2museum.com/wp/wp-content/uploads/2024/02/image-1.jpeg 1280w" sizes="(max-width: 640px) 100vw, 640px"/></a><figcaption>Novell DCB, an early SCSI HBA</figcaption></figure></div>


<p>I don’t quite understand what was the point of selling a custom disk controller <em>and</em> requiring a serial number match. But NetWare 2.0a could also run on off the shelf hardware using standard AT disk controllers and drives. For those machines, Novell provided a simple key card:</p>


<div>
<figure><a href="http://www.os2museum.com/wp/wp-content/uploads/2024/02/image.jpeg"><img loading="lazy" decoding="async" width="640" height="480" src="http://www.os2museum.com/wp/wp-content/uploads/2024/02/image-640x480.jpeg" alt="" srcset="http://www.os2museum.com/wp/wp-content/uploads/2024/02/image-640x480.jpeg 640w, http://www.os2museum.com/wp/wp-content/uploads/2024/02/image-300x225.jpeg 300w, http://www.os2museum.com/wp/wp-content/uploads/2024/02/image-768x576.jpeg 768w, http://www.os2museum.com/wp/wp-content/uploads/2024/02/image.jpeg 1280w" sizes="(max-width: 640px) 100vw, 640px"/></a><figcaption>A NetWare key card. There’s not much to it!</figcaption></figure></div>


<p>I’m not entirely sure if Novell was more worried about piracy by end users or by unscrupulous resellers. In any case, in 1986, during the era of Advanced NetWare 2.0a, a hardware key was required by NetWare.</p>



<p>Needless to say, if you are incredibly lucky and find a complete NetWare 2.0a disk set, and the disks are actually readable, the chances of also having the matching hardware key are close to nil. And even if you did have one, that does not at all help when trying to run NetWare 2.0a in an emulator. So, what do we do?</p>



<p>There are two obvious approaches. Either emulating the key card hardware, or patching the software to not need a key card.</p>



<h3>Emulating a NetWare Key Card</h3>



<p>First let’s examine the overall logic. NetWare 2.0a uses a 6-byte serial number which is different on every disk. It’s written into an object file NET$OS.OBJ, from where it propagates into the final NetWare executable, NET$OS.EXE.</p>



<p>The first four bytes are the serial number proper, stored in BCD format (eight digits). The first two digits tend to be zeros and may be left out on serial number stickers and such. The last two bytes are an “Application Number” which possibly controls NetWare capabilities such as the number of users supported.</p>



<p>When NetWare starts up, it reads six bytes of data from the key card. These six bytes have to match the serial and application number stored in NET$OS.OBJ.</p>



<p>The key card hardware is quite simple. It responds to I/O port reads in a fixed range from 23Ah to 23Fh. For reasons that may be lost to history, the serial number is stored in a strange format–possibly obfuscated,  possibly somewhat scrambled for technical reasons.</p>



<p>Ports 23Ch to 23Fh return the serial number proper, while ports 23Ah and 23Bh provide the application number. Looking at the key card photo, it is possible that Novell had prototype boards where part of the serial number and/or application number could be set using jumpers.</p>



<p>This is how the serial number nibbles are returned by the key card. Note that all values must be bit-flipped after they are read from the card:</p>



<pre>port 23Ch: [ S2L : S1L ]
port 23Dh: [ S0H : S3L ]
port 23Eh: [ S0L : S3H ]
port 23Fh: [ S1H : S2H ]

port 23Ah: [ S5H : S4H ]
port 23Bh: [ S5L : S4L ]

S0 to S5: Six bytes of serial number
H = high nibble, L = low nibble
All values bitwise complemented</pre>



<p>There is really not much to it, and emulating such hardware is trivial. But it is still almost as annoying as the real key card: You must actually have the emulation, and it can unlock only a single copy of NetWare. That is quite annoying when experimenting, such as trying to figure out whether NetWare 86 2.0a 86 and NetWare 286 2.0a SFT II understand the same on-disk format (they don’t).</p>



<p>The only real advantage an emulated key card has is that it can run unmodified NetWare.</p>



<h3>Fixing the Software</h3>



<p>The other approach is to forget about the key card hardware entirely and patching out the hardware key checks instead.</p>



<p>I decided to go with a somewhat complicated but safe approach. Rather than patching out the serial number checks, I replaced the routine which reads the serial number from the key card. The replacement copies the serial number to the same location where the original routine placed it. That way, if NetWare in any way depended on the contents of the bytes holding the hardware serial number, it would still work fine (though I suspect it doesn’t care).</p>



<p>As it turns out, it’s not hard to find the serial number burned into NET$OS.OBJ / NET$OS.EXE, because it’s prefixed by a convenient ‘S/N=’ string. The existing serial number is read and copied to the end of the replacement routine, which moves it exactly where the routine reading the key card is expected to place it. Fortunately the replacement code is much smaller than the original, because it doesn’t have to bother bit-flipping and swapping all the nibbles around.</p>



<p>The patching logic is implemented in a <a href="http://www.os2museum.com/files/patchnwkey.py">Python script</a>. This script requires Python 3. Everything is in there, including comments.</p>



<p>The patcher can be run against the NET$OS.EXE file. But not only that. There is a high likelihood that it can patch NET$OS.OBJ as well—as long as the original serial number and key card reading routines are each stored in a single LEDATA record, which is somewhere between highly likely and guaranteed.</p>



<p>Obviously if NET$OS.OBJ is patched, then a newly generated NET$OS.EXE won’t need any further treatment. The patching logic even makes sure that the checksum of the modified LEDATA record still matches, although the Novell linker does not appear to be at all concerned if it does not.</p>



<p>Rather conveniently, the patcher can also be used directly on raw floppy images containing NET$OS.OBJ or NET$OS.EXE. There is a slight chance that the patching might fail if the files were fragmented (i.e. if the crucial byte sequences were stored in non-consecutive sectors). This is extremely unlikely to happen with the original NetWare disks.</p>



<p>Applying the patch to the GENOS-3 disk of NetWare 286 2.0a SFT II, which holds the generated NET$OS.EXE, we end up with the following:</p>


<div>
<figure><img loading="lazy" decoding="async" width="640" height="356" src="http://www.os2museum.com/wp/wp-content/uploads/2024/02/nw20a-sft-running-640x356.png" alt="" srcset="http://www.os2museum.com/wp/wp-content/uploads/2024/02/nw20a-sft-running-640x356.png 640w, http://www.os2museum.com/wp/wp-content/uploads/2024/02/nw20a-sft-running-300x167.png 300w, http://www.os2museum.com/wp/wp-content/uploads/2024/02/nw20a-sft-running.png 720w" sizes="(max-width: 640px) 100vw, 640px"/><figcaption>NetWare 286 2.0a SFT II, who needs a key card?</figcaption></figure></div>


<p>From 1986 to 2024, NetWare 2.0a lives!</p>



<p>The patching script has obviously not received a lot of testing because there just aren’t that many copies of NetWare 2.0a available.</p>



<h3>Reinventing the Wheel</h3>



<p>Needless to say, this has been done before. And not only has it been done—in the mid-1980s, a company called NetWork Business Systems out of Houston, Texas was <a href="http://textfiles.com/hacking/netcrack.txt">proudly selling</a> a tool called KeyCard Eliminator for $99. That was not cheap, but it was a <em>lot</em> cheaper than NetWare licenses, which cost more than a thousand dollars.</p>



<p>But finding these old cracking tools isn’t any easier than finding NetWare 2.0a… so I wrote my own. Problem solved.</p>
											</div></div>
  </body>
</html>
