<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/losfair/blueboat">Original</a>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text">
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/losfair/blueboat/actions/workflows/ci.yml/badge.svg"><img src="https://github.com/losfair/blueboat/actions/workflows/ci.yml/badge.svg" alt="CI"/></a></p>
<p dir="auto">Blueboat is an open-source alternative to Cloudflare Workers.</p>
<p dir="auto">Blueboat aims to be a developer-friendly, multi-tenant platform for serverless web applications. A <em>monolithic</em> approach is followed: we try to implement features of commonly used libraries (in the web application context) natively in Rust to replace native Node addons, improve performance and reduce duplicated code. Blueboat&#39;s <a href="#architecture">architecture</a> ensures the security of the platform, prevents code duplication and keeps the overhead low.</p>
<p dir="auto"><em>If you think a JavaScript library should be natively re-implemented in Blueboat, feel free to open an issue or a pull request!</em></p>
<p dir="auto">A simple Blueboat application looks like:</p>
<div data-snippet-clipboard-copy-content="Router.get(&#34;/&#34;, req =&gt; new Response(&#34;hello world&#34;));

Router.get(&#34;/example&#34;, req =&gt; {
  return fetch(&#34;https://example.com&#34;);
});

Router.get(&#34;/yaml&#34;, req =&gt; {
  const res = TextUtil.Yaml.stringify({
    hello: &#34;world&#34;,
  });
  return new Response(res);
});
"><pre><span>Router</span><span>.</span><span>get</span><span>(</span><span>&#34;/&#34;</span><span>,</span> <span>req</span> <span>=&gt;</span> <span>new</span> <span>Response</span><span>(</span><span>&#34;hello world&#34;</span><span>)</span><span>)</span><span>;</span>

<span>Router</span><span>.</span><span>get</span><span>(</span><span>&#34;/example&#34;</span><span>,</span> <span>req</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span>fetch</span><span>(</span><span>&#34;https://example.com&#34;</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

<span>Router</span><span>.</span><span>get</span><span>(</span><span>&#34;/yaml&#34;</span><span>,</span> <span>req</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>res</span> <span>=</span> <span>TextUtil</span><span>.</span><span>Yaml</span><span>.</span><span>stringify</span><span>(</span><span>{</span>
    <span>hello</span>: <span>&#34;world&#34;</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
  <span>return</span> <span>new</span> <span>Response</span><span>(</span><span>res</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></pre></div>
<h2 dir="auto"><a id="user-content-quick-start-using-the-hosted-service" aria-hidden="true" href="#quick-start-using-the-hosted-service"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Quick start using the hosted service</h2>
<p dir="auto"><strong>Warning: The hosted service is in Alpha stage and should only be used for testing purpose. There is absolutely no guarantee on uptime or data security for now.</strong></p>
<ol dir="auto">
<li>Install <code>bbcli</code></li>
</ol>
<p dir="auto">For Linux:</p>
<div data-snippet-clipboard-copy-content="curl -sSL -o /tmp/bbcli.tar.gz https://github.com/losfair/bbcli/releases/download/v0.1.0-alpha.1/bbcli_linux.tar.gz
tar -xzvf /tmp/bbcli.tar.gz -C ~
chmod +x ~/bbcli &amp;&amp; rm /tmp/bbcli.tar.gz
"><pre>curl -sSL -o /tmp/bbcli.tar.gz https://github.com/losfair/bbcli/releases/download/v0.1.0-alpha.1/bbcli_linux.tar.gz
tar -xzvf /tmp/bbcli.tar.gz -C <span>~</span>
chmod +x <span>~</span>/bbcli <span>&amp;&amp;</span> rm /tmp/bbcli.tar.gz</pre></div>
<p dir="auto">For macOS:</p>
<div data-snippet-clipboard-copy-content="curl -sSL -o /tmp/bbcli.tar.gz https://github.com/losfair/bbcli/releases/download/v0.1.0-alpha.1/bbcli_macos.tar.gz
tar -xzvf /tmp/bbcli.tar.gz -C ~
chmod +x ~/bbcli &amp;&amp; rm /tmp/bbcli.tar.gz
"><pre>curl -sSL -o /tmp/bbcli.tar.gz https://github.com/losfair/bbcli/releases/download/v0.1.0-alpha.1/bbcli_macos.tar.gz
tar -xzvf /tmp/bbcli.tar.gz -C <span>~</span>
chmod +x <span>~</span>/bbcli <span>&amp;&amp;</span> rm /tmp/bbcli.tar.gz</pre></div>
<ol start="2" dir="auto">
<li>Clone the example project</li>
</ol>
<div data-snippet-clipboard-copy-content="git clone https://github.com/losfair/blueboat-examples
"><pre>git clone https://github.com/losfair/blueboat-examples</pre></div>
<ol start="3" dir="auto">
<li>Deploy the project</li>
</ol>
<div data-snippet-clipboard-copy-content="cd blueboat-examples/hello-world
npm i
~/bbcli deploy --vars ./hosted.vars.yaml
"><pre><span>cd</span> blueboat-examples/hello-world
npm i
<span>~</span>/bbcli deploy --vars ./hosted.vars.yaml</pre></div>
<p dir="auto">On the first <code>bbcli deploy</code> it should print out a link for logging in using your GitHub account.</p>
<p dir="auto">Note the last line of the output. It should look like:</p>
<div data-snippet-clipboard-copy-content="Key: managed/gh_XXXXXXX/com.example.blueboat.hello-world/metadata.json
"><pre><code>Key: managed/gh_XXXXXXX/com.example.blueboat.hello-world/metadata.json
</code></pre></div>
<p dir="auto">The project is now available at <code>XXXXXXX-com--example--blueboat--hello-world.alpha.workers.rs</code>.</p>
<h2 dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h2>
<p dir="auto">Supported and planned features:</p>
<ul dir="auto">
<li>Standard JavaScript features supported by V8</li>
<li>A subset of the Web platform API
<ul>
<li> <code>fetch()</code>, <code>Request</code> and <code>Response</code> objects</li>
<li> <code>TextEncoder</code>, <code>TextDecoder</code></li>
<li> Timers
<ul>
<li> <code>setTimeout</code>, <code>clearTimeout</code></li>
<li> <code>setInterval</code>, <code>clearInterval</code></li>
</ul>
</li>
<li> <code>URL</code>, <code>URLSearchParams</code></li>
<li> <code>crypto.getRandomValues</code></li>
<li> <code>crypto.subtle</code></li>
<li> <code>console</code>
<ul>
<li> <code>console.log()</code></li>
<li> <code>console.warn()</code></li>
<li> <code>console.error()</code></li>
</ul>
</li>
</ul>
</li>
<li>Request router
<ul>
<li> The <code>Router</code> object</li>
</ul>
</li>
<li>Cryptography extensions
<ul>
<li> Ed25519 and X25519: <code>NativeCrypto.Ed25519</code>, <code>NativeCrypto.X25519</code></li>
<li> JWT signing and verification: <code>NativeCrypto.JWT</code></li>
<li> Hashing: <code>NativeCrypto.digest</code></li>
</ul>
</li>
<li>Graphics API
<ul>
<li> Canvas (<code>Graphics.Canvas</code>)</li>
<li> Layout constraint solver based on Z3 (<code>Graphics.Layout</code>)</li>
</ul>
</li>
<li>Template API
<ul>
<li> <a href="https://github.com/Keats/tera">Tera</a> template rendering: <code>Template.render()</code></li>
</ul>
</li>
<li>Encoding and decoding
<ul>
<li> <code>Codec.hexencode()</code>, <code>Codec.hexdecode()</code></li>
<li> <code>Codec.b64encode()</code>, <code>Codec.b64decode()</code></li>
</ul>
</li>
<li>Embedded datasets
<ul>
<li> MIME type guessing: <code>Dataset.Mime.guessByExt()</code></li>
</ul>
</li>
<li>Background tasks
<ul>
<li> <code>Background.atMostOnce()</code></li>
<li> <code>Background.atLeastOnce()</code></li>
</ul>
</li>
<li>Data validation
<ul>
<li> JSON Type Definition validation: <code>Validation.JTD</code></li>
</ul>
</li>
<li>Text utilities
<ul>
<li> YAML serialization and deserialization: <code>TextUtil.Yaml.parse()</code>, <code>TextUtil.Yaml.stringify()</code></li>
<li> Markdown rendering: <code>TextUtil.Markdown.renderToHtml()</code></li>
</ul>
</li>
<li>Native API to external services
<ul>
<li> MySQL client</li>
<li> Apple Push Notification Service (APNS) client</li>
</ul>
</li>
</ul>
<p dir="auto">The entire API definition is published as the <a href="https://www.npmjs.com/package/blueboat-types" rel="nofollow">blueboat-types</a> package.</p>
<h2 dir="auto"><a id="user-content-deploy-your-own-blueboat-instance" aria-hidden="true" href="#deploy-your-own-blueboat-instance"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Deploy your own Blueboat instance</h2>
<h3 dir="auto"><a id="user-content-prerequisites" aria-hidden="true" href="#prerequisites"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Prerequisites</h3>
<ul dir="auto">
<li><a href="https://www.docker.com/" rel="nofollow">Docker</a></li>
<li>An S3-compatible bucket for storing application configuration and code</li>
<li>A MySQL service for storing <a href="https://github.com/losfair/bbcp">bbcp</a> metadata</li>
<li>(Optional) A Kafka service for streaming logs</li>
</ul>
<h3 dir="auto"><a id="user-content-deploy" aria-hidden="true" href="#deploy"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Deploy</h3>
<p dir="auto">Example docker-compose file:</p>
<div data-snippet-clipboard-copy-content="version: &#34;3&#34;
services:
  blueboat:
    image: ghcr.io/losfair/blueboat:latest
    user: daemon
    ports:
    - &#34;127.0.0.1:3000:3000&#34;
    entrypoint:
    - /usr/bin/blueboat_server
    - -l
    - 0.0.0.0:3000
    - --s3-bucket
    - my-bucket.example.com
    - --s3-region
    - us-east-1
    # Uncomment this if you use a non-AWS S3-compatible service.
    # - --s3-endpoint
    # - https://minio.example.com
    # Uncomment this to enable logging to Kafka.
    # - --log-kafka
    # - net.univalent.blueboat-log.default:0@kafka:9092
    # Uncomment this to enable geoip information in the `x-blueboat-client-country`,
    # `x-blueboat-client-city`, `x-blueboat-client-subdivision-1` and
    # `x-blueboat-client-subdivision-2` request headers.
    # - --mmdb-city
    # - /opt/blueboat/mmdb/GeoLite2-City.mmdb
    # Uncomment this to enable automatic Wikipedia IP blocklist query in the
    # `x-blueboat-client-wpbl` request header.
    # The database is generated with https://github.com/losfair/wpblsync.
    # - --wpbl-db
    # - /opt/blueboat/wpbl/wpbl.db
    environment:
      RUST_LOG: info
      AWS_ACCESS_KEY_ID: your_s3_access_key_id
      AWS_SECRET_ACCESS_KEY: your_s3_secret_access_key
      # Uncomment this to enable text rendering in canvas.
      # SMRAPP_BLUEBOAT_FONT_DIR: /opt/blueboat/fonts
"><pre><span>version</span>: <span><span>&#34;</span>3<span>&#34;</span></span>
<span>services</span>:
  <span>blueboat</span>:
    <span>image</span>: <span>ghcr.io/losfair/blueboat:latest</span>
    <span>user</span>: <span>daemon</span>
    <span>ports</span>:
    - <span><span>&#34;</span>127.0.0.1:3000:3000<span>&#34;</span></span>
    <span>entrypoint</span>:
    - <span>/usr/bin/blueboat_server</span>
    - <span>-l</span>
    - <span>0.0.0.0:3000</span>
    - <span>--s3-bucket</span>
    - <span>my-bucket.example.com</span>
    - <span>--s3-region</span>
    - <span>us-east-1</span>
    <span><span>#</span> Uncomment this if you use a non-AWS S3-compatible service.</span>
    <span><span>#</span> - --s3-endpoint</span>
    <span><span>#</span> - https://minio.example.com</span>
    <span><span>#</span> Uncomment this to enable logging to Kafka.</span>
    <span><span>#</span> - --log-kafka</span>
    <span><span>#</span> - net.univalent.blueboat-log.default:0@kafka:9092</span>
    <span><span>#</span> Uncomment this to enable geoip information in the `x-blueboat-client-country`,</span>
    <span><span>#</span> `x-blueboat-client-city`, `x-blueboat-client-subdivision-1` and</span>
    <span><span>#</span> `x-blueboat-client-subdivision-2` request headers.</span>
    <span><span>#</span> - --mmdb-city</span>
    <span><span>#</span> - /opt/blueboat/mmdb/GeoLite2-City.mmdb</span>
    <span><span>#</span> Uncomment this to enable automatic Wikipedia IP blocklist query in the</span>
    <span><span>#</span> `x-blueboat-client-wpbl` request header.</span>
    <span><span>#</span> The database is generated with https://github.com/losfair/wpblsync.</span>
    <span><span>#</span> - --wpbl-db</span>
    <span><span>#</span> - /opt/blueboat/wpbl/wpbl.db</span>
    <span>environment</span>:
      <span>RUST_LOG</span>: <span>info</span>
      <span>AWS_ACCESS_KEY_ID</span>: <span>your_s3_access_key_id</span>
      <span>AWS_SECRET_ACCESS_KEY</span>: <span>your_s3_secret_access_key</span>
      <span><span>#</span> Uncomment this to enable text rendering in canvas.</span>
      <span><span>#</span> SMRAPP_BLUEBOAT_FONT_DIR: /opt/blueboat/fonts</span></pre></div>
<h3 dir="auto"><a id="user-content-set-up-a-reverse-proxy" aria-hidden="true" href="#set-up-a-reverse-proxy"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Set up a reverse proxy</h3>
<p dir="auto">Blueboat loads the application&#39;s metadata from the S3 key specified in the <code>X-Blueboat-Metadata</code> header. This information should be provided by a reverse proxy such as Nginx or Caddy.</p>
<p dir="auto">I run my Blueboat instances behind <a href="https://caddyserver.com/" rel="nofollow">Caddy</a>. An example config looks like:</p>
<div data-snippet-clipboard-copy-content="hello.blueboat.example.com {
  reverse_proxy blueboat:3000 {
    # S3 path to application metadata
    header_up X-Blueboat-Metadata &#34;test/metadata.json&#34;
    header_up X-Blueboat-Client-Ip &#34;{remote_host}&#34;

    # Prevent faked request id
    header_up -X-Blueboat-Request-Id
  }
}
"><pre><code>hello.blueboat.example.com {
  reverse_proxy blueboat:3000 {
    # S3 path to application metadata
    header_up X-Blueboat-Metadata &#34;test/metadata.json&#34;
    header_up X-Blueboat-Client-Ip &#34;{remote_host}&#34;

    # Prevent faked request id
    header_up -X-Blueboat-Request-Id
  }
}
</code></pre></div>
<h3 dir="auto"><a id="user-content-deploy-bbcp" aria-hidden="true" href="#deploy-bbcp"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Deploy bbcp</h3>
<p dir="auto"><a href="https://github.com/losfair/bbcp">bbcp</a> is the service that manages application deployment on Blueboat, and is itself a Blueboat application. We need to manually bootstrap it:</p>
<ol dir="auto">
<li>
<p dir="auto">Install <a href="https://github.com/s3tools/s3cmd">s3cmd</a> and <a href="https://github.com/google/zx">zx</a>.</p>
</li>
<li>
<p dir="auto">Set up configuration:</p>
</li>
</ol>
<div data-snippet-clipboard-copy-content="git clone https://github.com/losfair/bbcp
mkdir bbcp-config
cd bbcp-config
cat &gt; env.json &lt;&lt; EOF
{
  &#34;s3AccessKeyId&#34;: &#34;your_s3_access_key_id&#34;,
  &#34;s3SecretAccessKey&#34;: &#34;your_s3_secret_access_key&#34;,
  &#34;s3Region&#34;: &#34;us-east-1&#34;,
  &#34;s3Bucket&#34;: &#34;your-bucket.example.com&#34;,
  &#34;s3Prefix&#34;: &#34;managed/&#34;,
  &#34;ghClientId&#34;: &#34;your-github-client-id&#34;,
  &#34;ghClientSecret&#34;: &#34;your-github-client-secret&#34;
}
EOF
cat &gt; mysql.json &lt;&lt; EOF
{
  &#34;db&#34;: {
    &#34;url&#34;: &#34;mysql://user:password@mysql-server/database&#34;
  }
}
EOF
cat &gt; s3.config &lt;&lt; EOF
access_key = your_s3_access_key_id
secret_key = your_s3_secret_access_key
use_https = True
check_ssl_certificate = True
EOF
cat &gt; run_deploy.sh &lt;&lt; EOF
#!/bin/bash

set -euo pipefail
cd &#34;$(dirname $0)&#34;
cd ../bbcp/

CONFIG_PATH=../bbcp-config S3_BUCKET=your-bucket.example.com ./deploy.sh
EOF
chmod +x run_deploy.sh
./run_deploy.sh
"><pre>git clone https://github.com/losfair/bbcp
mkdir bbcp-config
<span>cd</span> bbcp-config
cat <span>&gt;</span> env.json <span><span>&lt;&lt;</span> <span>EOF</span></span>
<span>{</span>
<span>  &#34;s3AccessKeyId&#34;: &#34;your_s3_access_key_id&#34;,</span>
<span>  &#34;s3SecretAccessKey&#34;: &#34;your_s3_secret_access_key&#34;,</span>
<span>  &#34;s3Region&#34;: &#34;us-east-1&#34;,</span>
<span>  &#34;s3Bucket&#34;: &#34;your-bucket.example.com&#34;,</span>
<span>  &#34;s3Prefix&#34;: &#34;managed/&#34;,</span>
<span>  &#34;ghClientId&#34;: &#34;your-github-client-id&#34;,</span>
<span>  &#34;ghClientSecret&#34;: &#34;your-github-client-secret&#34;</span>
<span>}</span>
<span><span>EOF</span></span>
cat <span>&gt;</span> mysql.json <span><span>&lt;&lt;</span> <span>EOF</span></span>
<span>{</span>
<span>  &#34;db&#34;: {</span>
<span>    &#34;url&#34;: &#34;mysql://user:password@mysql-server/database&#34;</span>
<span>  }</span>
<span>}</span>
<span><span>EOF</span></span>
cat <span>&gt;</span> s3.config <span><span>&lt;&lt;</span> <span>EOF</span></span>
<span>access_key = your_s3_access_key_id</span>
<span>secret_key = your_s3_secret_access_key</span>
<span>use_https = True</span>
<span>check_ssl_certificate = True</span>
<span><span>EOF</span></span>
cat <span>&gt;</span> run_deploy.sh <span><span>&lt;&lt;</span> <span>EOF</span></span>
<span>#!/bin/bash</span>
<span></span>
<span>set -euo pipefail</span>
<span>cd &#34;$(dirname $0)&#34;</span>
<span>cd ../bbcp/</span>
<span></span>
<span>CONFIG_PATH=../bbcp-config S3_BUCKET=your-bucket.example.com ./deploy.sh</span>
<span><span>EOF</span></span>
chmod +x run_deploy.sh
./run_deploy.sh</pre></div>
<p dir="auto">Next, follow the <a href="#set-up-a-reverse-proxy">set up a reverse proxy</a> section to set up a public endpoint for your bbcp application. And done! You can now use <code>bbcli</code> to deploy to your Blueboat instance.</p>
<h2 dir="auto"><a id="user-content-architecture" aria-hidden="true" href="#architecture"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Architecture</h2>
<p dir="auto">Blueboat before the rewrite (<a href="https://github.com/losfair/blueboat/commit/eba320fd8c4806fc39b764a5a2368a0c6c34d976">commit</a>) used the same execution model as Cloudflare Workers where multiple applications run in different isolates in a single process. This of course has the benefit of reduced execution overhead, but poses several problems:</p>
<ul dir="auto">
<li>Security</li>
</ul>
<p dir="auto">With isolates sharing the same process, if there is a single exploitable memory safety bug in any dependency of the engine, all other tenants&#39; apps running in the same process is compromised.</p>
<p dir="auto">This requires the engine developers to be extremely conservative when introducing new features and dependencies. Blueboat has built-in support for MySQL, Canvas, APNS push notification and constraint solving with Z3 (all added because I found them useful) and I&#39;m not very confident that there is not a single memory safety vulnerability in all these complex dependencies.</p>
<ul dir="auto">
<li>Operational cost</li>
</ul>
<p dir="auto">Cloudflare has their team that operates the Workers platform, while most users who want to self-host their infrastructure don&#39;t. So this leaves a long <a href="https://developers.cloudflare.com/workers/learning/security-model#v8-bugs-and-the-patch-gap" rel="nofollow">patch gap</a> after a vulnerability is discovered, during which the engine is vulnerable.</p>
<p dir="auto">For all these reasons I decided to reconsider the execution model. Blueboat after the rewrite uses a tightly-coupled multi-process architecture based on <a href="https://github.com/losfair/smr">smr</a> where each application runs in its own set of forked processes and isolated with <a href="https://man7.org/linux/man-pages/man2/seccomp.2.html" rel="nofollow">seccomp</a>. The cold-start overhead is higher than isolates in a shared process (in the tens of milliseconds range), but still far lower than a full container running node.</p>
<p dir="auto">The APIs as described in <a href="#features">features</a> are mostly implemented in Blueboat&#39;s native code which is shared between forked processes, so there isn&#39;t N copies for N application instances - there is only one copy of the native code. This allows Blueboat to follow a monolithic approach without incurring significant overhead, where a lot of features are directly bundled into the engine instead of requiring the user to pull in their own dependencies.</p>
<h2 dir="auto"><a id="user-content-web-apps-built-on-blueboat" aria-hidden="true" href="#web-apps-built-on-blueboat"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Web apps built on Blueboat</h2>
<p dir="auto">Blueboat currently powers several services running on <code>.univalent.net</code>, <code>.invariant.cn</code> and <code>.palette.cat</code>. Public ones include:</p>
<ul dir="auto">
<li><a href="https://id.invariant.cn" rel="nofollow">https://id.invariant.cn</a></li>
<li><a href="https://lambda.app.invariant.cn" rel="nofollow">https://lambda.app.invariant.cn</a></li>
</ul>
</article>
        </div></div>
  </body>
</html>
