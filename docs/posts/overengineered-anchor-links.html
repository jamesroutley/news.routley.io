<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://thirty-five.com/overengineered-anchoring">Original</a>
    <h1>Overengineered Anchor Links</h1>
    
    <div id="readability-page-1" class="page"><div id="text-wrapper">  <p>Anchor links are deceptively simple at first glance: click a button, scroll to the heading, and done. But if you ever had to implement them, you might have encountered the <astro-island uid="5UCTL" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0,&#34;red&#34;],&#34;id&#34;:[0,&#34;component-tile-hmaephzt7pw&#34;],&#34;text&#34;:[0,&#34;“active anchor problem”&#34;],&#34;type&#34;:[0,&#34;component&#34;],&#34;forceAspectRatio&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""><astro-island uid="1JX5wf" component-url="/_astro/AnchorProblem.GGiwfq1Z.js" component-export="default" renderer-url="/_astro/client.BBblIl08.js" props="{}" ssr="" client="only" opts="{&#34;name&#34;:&#34;AnchorProblem&#34;,&#34;value&#34;:&#34;vue&#34;}"></astro-island></template><!--astro:end--></astro-island>.
The issue being that, headings towards the bottom of the page can be too far down to scroll them to the desired position. The example component above shows how the ‘conclusion’ heading can never be reached.
Surely this will be detrimental to the user experience. We need to come up with a solution. In this blog post, I’ll show some of the solutions I’ve come up with — from a hotfix all the way to unhinged. But before we do that, let’s create a more <astro-island uid="dLVjb" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0,&#34;green&#34;],&#34;id&#34;:[0,&#34;component-tile-93lgthgglta&#34;],&#34;text&#34;:[0,&#34;abstract visualization&#34;],&#34;type&#34;:[0,&#34;component&#34;],&#34;forceAspectRatio&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""><astro-island uid="Z2ucBWu" component-url="/_astro/PageViewportVisualization.Cjt7_c79.js" component-export="default" renderer-url="/_astro/client.BBblIl08.js" props="{&#34;version&#34;:[0,&#34;default&#34;]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;PageViewportVisualization&#34;,&#34;value&#34;:&#34;vue&#34;}"></astro-island></template><!--astro:end--></astro-island>. Here, we see a viewport moving down the page, with the trigger line being set at 25vh from the top of the viewport. This is what we’ll use to visualize the different solutions.</p>

<p>The most simple solution is to add <astro-island uid="Z1G3gad" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0,&#34;green&#34;],&#34;id&#34;:[0,&#34;component-tile-f29uxarxj0p&#34;],&#34;text&#34;:[0,&#34;extra\npadding.&#34;],&#34;type&#34;:[0,&#34;component&#34;],&#34;forceAspectRatio&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""><astro-island uid="12OCzC" component-url="/_astro/PageViewportVisualization.Cjt7_c79.js" component-export="default" renderer-url="/_astro/client.BBblIl08.js" props="{&#34;version&#34;:[0,&#34;extra-padding&#34;]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;PageViewportVisualization&#34;,&#34;value&#34;:&#34;vue&#34;}"></astro-island></template><!--astro:end--></astro-island> We calculate the height of the padding by taking the delta between the last
heading and the lowest point the anchor trigger can reach. Perfect, right? Well, sometimes the
design team is not so fond of random extra padding, so lets keep searching.</p>
<h2 id="practical-shift-the-trigger-line">Practical: shift the trigger line</h2>
<p>Maybe instead of adding extra padding, <astro-island uid="HUJlO" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0,&#34;green&#34;],&#34;id&#34;:[0,&#34;component-tile-f7gsi42873s&#34;],&#34;text&#34;:[0,&#34;shift the\ntrigger line.&#34;],&#34;type&#34;:[0,&#34;component&#34;],&#34;forceAspectRatio&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""><astro-island uid="Gvykj" component-url="/_astro/PageViewportVisualization.Cjt7_c79.js" component-export="default" renderer-url="/_astro/client.BBblIl08.js" props="{&#34;version&#34;:[0,&#34;shift-triggers&#34;]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;PageViewportVisualization&#34;,&#34;value&#34;:&#34;vue&#34;}"></astro-island></template><!--astro:end--></astro-island> This is also quite simple to do, we just need to calculate how far
from the bottom the last heading is, and put the trigger line there as well. But, this would mean
that when the users clicks an anchor tag, the heading could be put all the way at the bottom of the
viewport. This is of course not great, since most people put the text they read on the top half of
the screen. We need to keep looking.</p>
<h2 id="good-translate-the-trigger-points">Good: translate the trigger points</h2>
<p>Instead of shifting the trigger line, we could <astro-island uid="1GTNDk" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0,&#34;green&#34;],&#34;id&#34;:[0,&#34;component-tile-ppswt7woo5n&#34;],&#34;text&#34;:[0,&#34;translate&#34;],&#34;type&#34;:[0,&#34;component&#34;],&#34;forceAspectRatio&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""><astro-island uid="dqbkI" component-url="/_astro/PageViewportVisualization.Cjt7_c79.js" component-export="default" renderer-url="/_astro/client.BBblIl08.js" props="{&#34;version&#34;:[0,&#34;translate-points&#34;]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;PageViewportVisualization&#34;,&#34;value&#34;:&#34;vue&#34;}"></astro-island></template><!--astro:end--></astro-island> the headings upwards. Instead of using the actual location of the headings as the ones causing the triggers, we create <strong>virtual headings</strong> and translate them upwards. A virtual heading is not actually visible in the article, its just the position we use to dictate the active state.
One might argue that this is pretty much the same as shifting the trigger line, and they’d be right conceptually. However, thinking about translating the trigger points gives us more mental flexibility, as it allows us to consider applying <em>different</em> adjustments based on each heading’s position, which will be crucial later.</p>
<p><em><strong>The example visualizations now show the location of these ‘virtual headings’. So, while the heading is still at the same place in the article, we visualize where its trigger point is.</strong></em></p>
<p>In the example, we see one problem arising: the first heading is now too far up. The nice part of this new approach is that we can fix this quite elegantly, since we can shift the individual virtual headings with ease. But what would be a good way to do this?</p>
<h2 id="great-translate-trigger-points-fractionally">Great: translate trigger points fractionally</h2>
<p>If we think about it, we don’t need to translate all the trigger points. There’s only a few conditions
that need to be met:</p>
<ol>
<li>The headings need to be reachable.</li>
<li>The headings need to stay in order.</li>
</ol>
<p>We can meet these conditions by translating the trigger points <astro-island uid="XIPCp" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0,&#34;green&#34;],&#34;id&#34;:[0,&#34;component-tile-zythi3qsp9n&#34;],&#34;text&#34;:[0,&#34;fractionally.&#34;],&#34;type&#34;:[0,&#34;component&#34;],&#34;forceAspectRatio&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""><astro-island uid="mlTOP" component-url="/_astro/PageViewportVisualization.Cjt7_c79.js" component-export="default" renderer-url="/_astro/client.BBblIl08.js" props="{&#34;version&#34;:[0,&#34;translate-points-fractionally&#34;]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;PageViewportVisualization&#34;,&#34;value&#34;:&#34;vue&#34;}"></astro-island></template><!--astro:end--></astro-island> Here,
the first heading doesn’t move, and the last heading moves up by the full amount necessary to become reachable. The other headings move up by a proportional amount based on their position between the first and last heading. Now we are getting somewhere! This is a solid solution. You might want to stop here before your product manager starts giving you puzzled looks, wondering how “fixing anchor links” has suddenly turned into a three-week epic.</p>
<h2 id="awesome-create-a-custom-mapping-function">Awesome: create a custom mapping function</h2>
<p>While the fractional solution works, in the sense that our conditions are met, it does have some
flaws. We have chosen a trigger line that’s 25% down from the top of the viewport. It would be nice
if we can actually minimize the deviation from this ideal line across all headings. The closer the triggers happen to this (mind you — semi-arbitrarily chosen) line, the better the user experience <em>should</em> be. Minimizing deviation feels like a good heuristic. This for sure will make the users happier and result in increased shareholder value.</p>
<p>Let’s minimize the <astro-island uid="UUllV" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0,&#34;green&#34;],&#34;id&#34;:[0,&#34;component-tile-eo1goer6yi&#34;],&#34;text&#34;:[0,&#34;mean squared error&#34;],&#34;type&#34;:[0,&#34;component&#34;],&#34;forceAspectRatio&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""><astro-island uid="1XpdHr" component-url="/_astro/PageViewportVisualization.Cjt7_c79.js" component-export="default" renderer-url="/_astro/client.BBblIl08.js" props="{&#34;version&#34;:[0,&#34;minimize-mse&#34;]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;PageViewportVisualization&#34;,&#34;value&#34;:&#34;vue&#34;}"></astro-island></template><!--astro:end--></astro-island> (MSE) of the delta between the headings’ original positions and their virtual positions. We use MSE because it heavily penalizes large deviations, pushing the system towards a state where most virtual headings are close to their original spots, while still satisfying our reachability constraints. Of course, the constraint that headings must stay in order still applies.
This results in all points that are reachable staying at their original position. Seems that we have an issue. headings are bunched up at the bottom. This makes sense, since minimization of the mean squared error only cares about proximity to the original position; it has no ‘force’ that opposes this bunching. We need to define something that encourages the virtual trigger points to maintain a certain distance from each other, ideally related to their original spacing. Considering the user experience, we might assume that it’s nice to have the scroll <em>distance</em> needed to activate the next section’s anchor be somewhat proportional to the actual content length of that section. This ‘sections wanting to preserve their relative scroll length’-force is what we’ll use.</p>
<h3 id="side-quest-minimization-functions">Side quest: minimization functions</h3>
<p>To explore this idea we need to bust out… Python. Here, we (read: Claude and I) implemented a <astro-island uid="QnLpb" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;text&#34;:[0,&#34;SLSQP&#34;],&#34;color&#34;:[0,&#34;yellow&#34;],&#34;id&#34;:[0,&#34;text-tile-nwiqp294sfd&#34;],&#34;type&#34;:[0,&#34;information&#34;],&#34;forceAspectRatio&#34;:[0,true]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""> <div> <p> SLSQP (Sequential Least Squares Programming) is an optimization algorithm used to solve constrained nonlinear problems. It works by iteratively improving a solution while satisfying equality and inequality constraints. At each step, it approximates the problem using simpler quadratic models and linear constraints, making it efficient for problems where smooth gradients are available. SLSQP is commonly used in engineering, machine learning, and operations research when both the objective and the constraints are differentiable. </p> </div> </template><!--astro:end--></astro-island> solver, which is a type of numerical optimization algorithm designed for constrained problems like ours.
The core of the optimization lies in a loss function with two competing terms:</p>
<ul>
<li><strong>Anchor penalty:</strong> How far a virtual heading is moved from its original location. Minimizing this keeps virtual headings close to their original position. (<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mrow><mi>a</mi><mi>n</mi><mi>c</mi><mi>h</mi><mi>o</mi><mi>r</mi></mrow></msub><mo>=</mo><mo>∑</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mrow><mi>v</mi><mi>i</mi><mi>r</mi><mi>t</mi><mi>u</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mi>o</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">L_{anchor} = \sum (y_{virtual} - y_{original})^2</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>L</span><span><span><span><span><span><span></span><span><span><span>an</span><span>c</span><span>h</span><span>or</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>∑</span><span>(</span><span><span>y</span><span><span><span><span><span><span></span><span><span><span>v</span><span>i</span><span>r</span><span>t</span><span>u</span><span>a</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span><span>y</span><span><span><span><span><span><span></span><span><span><span>or</span><span>i</span><span>g</span><span>ina</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span>)</li>
<li><strong>Section penalty:</strong> How much the size of each virtual section (the space between two virtual headings) differs from the original section size. Minimizing this ensures that sections don’t become disproportionately short or long in terms of scroll distance. (<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>=</mo><mo>∑</mo><mo stretchy="false">(</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>v</mi><mi>i</mi><mi>r</mi><mi>t</mi><mi>u</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>v</mi><mi>i</mi><mi>r</mi><mi>t</mi><mi>u</mi><mi>a</mi><mi>l</mi></mrow></msub><mo stretchy="false">)</mo><mo>−</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>o</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>o</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">L_{section} = \sum ((y_{i+1, virtual} - y_{i, virtual}) - (y_{i+1, original} - y_{i, original}))^2</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>L</span><span><span><span><span><span><span></span><span><span><span>sec</span><span>t</span><span>i</span><span>o</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>∑</span><span>((</span><span><span>y</span><span><span><span><span><span><span></span><span><span><span>i</span><span>+</span><span>1</span><span>,</span><span>v</span><span>i</span><span>r</span><span>t</span><span>u</span><span>a</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span><span>y</span><span><span><span><span><span><span></span><span><span><span>i</span><span>,</span><span>v</span><span>i</span><span>r</span><span>t</span><span>u</span><span>a</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>−</span><span></span></span><span><span></span><span>(</span><span><span>y</span><span><span><span><span><span><span></span><span><span><span>i</span><span>+</span><span>1</span><span>,</span><span>or</span><span>i</span><span>g</span><span>ina</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span><span>y</span><span><span><span><span><span><span></span><span><span><span>i</span><span>,</span><span>or</span><span>i</span><span>g</span><span>ina</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span><span>)</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span>)</li>
</ul>
<p>We combine these into a total loss <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><msub><mi>w</mi><mrow><mi>a</mi><mi>n</mi><mi>c</mi><mi>h</mi><mi>o</mi><mi>r</mi></mrow></msub><msub><mi>L</mi><mrow><mi>a</mi><mi>n</mi><mi>c</mi><mi>h</mi><mi>o</mi><mi>r</mi></mrow></msub><mo>+</mo><msub><mi>w</mi><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><msub><mi>L</mi><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L = w_{anchor} L_{anchor} + w_{section} L_{section}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>L</span><span></span><span>=</span><span></span></span><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>an</span><span>c</span><span>h</span><span>or</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>L</span><span><span><span><span><span><span></span><span><span><span>an</span><span>c</span><span>h</span><span>or</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>sec</span><span>t</span><span>i</span><span>o</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>L</span><span><span><span><span><span><span></span><span><span><span>sec</span><span>t</span><span>i</span><span>o</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span>, where the weights <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>a</mi><mi>n</mi><mi>c</mi><mi>h</mi><mi>o</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{anchor}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>an</span><span>c</span><span>h</span><span>or</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{section}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>sec</span><span>t</span><span>i</span><span>o</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span> control the trade-off (<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>a</mi><mi>n</mi><mi>c</mi><mi>h</mi><mi>o</mi><mi>r</mi></mrow></msub><mo>+</mo><msub><mi>w</mi><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">w_{anchor} + w_{section} = 1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>an</span><span>c</span><span>h</span><span>or</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>sec</span><span>t</span><span>i</span><span>o</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>1</span></span></span></span>).</p>
<p>We define constraints to:</p>
<ul>
<li>Keep virtual headings inside the page boundaries.</li>
<li>Ensure the first heading doesn’t float upward (its virtual position must be &gt;= its original position).</li>
<li>Keep virtual headings in order (<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>v</mi><mi>i</mi><mi>r</mi><mi>t</mi><mi>u</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>≥</mo><msub><mi>y</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>v</mi><mi>i</mi><mi>r</mi><mi>t</mi><mi>u</mi><mi>a</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">y_{i+1, virtual} \ge y_{i, virtual}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>y</span><span><span><span><span><span><span></span><span><span><span>i</span><span>+</span><span>1</span><span>,</span><span>v</span><span>i</span><span>r</span><span>t</span><span>u</span><span>a</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≥</span><span></span></span><span><span></span><span><span>y</span><span><span><span><span><span><span></span><span><span><span>i</span><span>,</span><span>v</span><span>i</span><span>r</span><span>t</span><span>u</span><span>a</span><span>l</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span>).</li>
</ul>
<p>From this, we generate a plot showing how the virtual headings’ locations change as we vary the weights (specifically, as <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{section}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>sec</span><span>t</span><span>i</span><span>o</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span> increases from 0 to 1).</p>
<p>Running that code gives us <astro-island uid="2htSq6" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0],&#34;id&#34;:[0,&#34;image-tile-xfqbk99yic&#34;],&#34;text&#34;:[0,&#34;this graph&#34;],&#34;type&#34;:[0,&#34;image&#34;],&#34;forceAspectRatio&#34;:[0,true]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""> <p><img src="https://thirty-five.com/content-collection-media/articles/anchoring/chart_two.png" alt="visualization of this graph"/> </p> </template><!--astro:end--></astro-island>. The circles on the left (at <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">w_{section} = 0</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>sec</span><span>t</span><span>i</span><span>o</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span>) represent the original heading locations. The lines show how each virtual heading’s location (Y-axis) changes as the section penalty weight <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{section}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>sec</span><span>t</span><span>i</span><span>o</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span> (X-axis) increases. On the left side, the priority is keeping headings near their original spots (high <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>a</mi><mi>n</mi><mi>c</mi><mi>h</mi><mi>o</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{anchor}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>an</span><span>c</span><span>h</span><span>or</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span>). On the right side, the priority shifts to preserving the original spacing between headings (high <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{section}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>sec</span><span>t</span><span>i</span><span>o</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span>).
I am curious to see how this compares to the simple fractional translation we tried earlier. And wouldn’t <astro-island uid="1l5K5p" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0],&#34;id&#34;:[0,&#34;image-tile-h7pyb8tn05n&#34;],&#34;text&#34;:[0,&#34;you know it&#34;],&#34;type&#34;:[0,&#34;image&#34;],&#34;forceAspectRatio&#34;:[0,true]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""> <p><img src="https://thirty-five.com/content-collection-media/articles/anchoring/chart_one.png" alt="visualization of you know it"/> </p> </template><!--astro:end--></astro-island>, the fractional translation is exactly what the optimizer settles on when the section penalty is dominant (<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">w_{section} = 1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>sec</span><span>t</span><span>i</span><span>o</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>1</span></span></span></span>)!</p>
<h3 id="realizations">Realizations</h3>
<p>Staring at that optimization graph sparked a thought. Okay, maybe two thoughts. First, that need to preserve section spacing really kicks in towards the <em>end</em> of the page, where headings get forcibly shoved upwards to stay reachable, squashing the final sections together. Second, let’s consider the behavior of the ‘fractional translation’ method on an edge case.</p>
<p>Imagine, if you will, taking the entire Bible, from the “In the beginning” of Genesis to the final “Amen” of Revelation, and rendering it as one continuous, scrollable webpage. (For the tech bros among us: you could alternatively imagine gluing all of Paul Graham’s essays back-to-back). Now, suppose the very last heading, maybe “Revelation Chapter 22”, is just 200 pixels too low to hit our trigger line when scrolled to.</p>
<p>Does our previous ‘fractional translation’ make sense here? It means taking those 200 pixels of required uplift and meticulously spreading that adjustment across <em>every single heading</em> all the way back to the start. The Ten Commandments get a tiny bump, the Psalms slightly more, all culminating in Revelation 22 getting the full 200px boost.</p>
<p>Actually, if you think about it, with a fractional translation, the error (the distance between the virtual and original headings) grows with the page length. So if the page tends to infinity, so does the error! This would of course be sloppy, and something users could immediately notice as feeling off. So how are we going to fix this?</p>
<h3 id="the-final-version">The final version</h3>
<p>This leads to our desired behavior for a smarter mapping function:</p>
<ul>
<li>For headings near the end of the page, apply more adjustment (act like high <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{section}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>sec</span><span>t</span><span>i</span><span>o</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span>).</li>
<li>For headings near the beginning of the page, apply less (or ideally no) adjustment (act like high <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>a</mi><mi>n</mi><mi>c</mi><mi>h</mi><mi>o</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{anchor}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>w</span><span><span><span><span><span><span></span><span><span><span>an</span><span>c</span><span>h</span><span>or</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span>).</li>
<li>The transition between these states should be smooth.</li>
</ul>
<p>We need a function that maps a heading’s normalized position <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">x \in [0, 1]</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>∈</span><span></span></span><span><span></span><span>[</span><span>0</span><span>,</span><span></span><span>1</span><span>]</span></span></span></span> (where <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x=0</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span> is the first heading, <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x=1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>=</span><span></span></span><span><span></span><span>1</span></span></span></span> is the last) to an ‘adjustment factor’ <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">y \in [0, 1]</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>y</span><span></span><span>∈</span><span></span></span><span><span></span><span>[</span><span>0</span><span>,</span><span></span><span>1</span><span>]</span></span></span></span>. This factor determines <em>how much</em> of the maximum required uplift gets applied to the heading at position <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span>.</p>
<p>We need this mapping function <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y = f(x)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>y</span><span></span><span>=</span><span></span></span><span><span></span><span>f</span><span>(</span><span>x</span><span>)</span></span></span></span> to have specific properties:</p>
<ol>
<li>It must start at zero: <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">f(0) = 0</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>f</span><span>(</span><span>0</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span>.</li>
<li>It must end at one: <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">f(1) = 1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>f</span><span>(</span><span>1</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>1</span></span></span></span>.</li>
<li>The transition should start gently: <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">f&#39;(0) = 0</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>f</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>(</span><span>0</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span>.</li>
<li>The transition should end gently: <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">f&#39;(1) = 0</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>f</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>(</span><span>1</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span>.</li>
</ol>
<p>It turns out that we can borrow a function from the field of computer graphics to solve this problem. The <astro-island uid="Z1sRHLa" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0,&#34;yellow&#34;],&#34;id&#34;:[0,&#34;component-tile-frunfbbit4n&#34;],&#34;text&#34;:[0,&#34;smoothstep&#34;],&#34;type&#34;:[0,&#34;component&#34;],&#34;forceAspectRatio&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""><astro-island uid="ZzlAmW" component-url="/_astro/AdjustableSmoothstepGraph.DgNMoqNP.js" component-export="default" renderer-url="/_astro/client.BBblIl08.js" props="{&#34;showControls&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;AdjustableSmoothstepGraph&#34;,&#34;value&#34;:&#34;vue&#34;}"></astro-island></template><!--astro:end--></astro-island> function is a cubic polynomial that smoothly transitions from 0 to 1 over the range <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">x \in [0, 1]</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>∈</span><span></span></span><span><span></span><span>[</span><span>0</span><span>,</span><span></span><span>1</span><span>]</span></span></span></span>.</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mn>3</mn><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>2</mn><msup><mi>x</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">S(x) = 3x^2 - 2x^3</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>S</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>3</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span></span></span></span></span></p><p>This function provides a smooth transition over the entire range <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">x \in [0, 1]</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>∈</span><span></span></span><span><span></span><span>[</span><span>0</span><span>,</span><span></span><span>1</span><span>]</span></span></span></span>. But what if we don’t want the transition to start right away? What if we want the adjustment factor <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>y</span></span></span></span> to remain 0 until <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span> reaches a certain point, say <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span>, and <em>then</em> smoothly transition to 1 by the time <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span> reaches 1?</p>
<p>We can achieve this by preprocessing our input <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span> before feeding it into the smoothstep function. Let’s define an intermediate variable <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span> that represents the progress <em>within</em> the transition phase, which occurs between <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">x=a</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>=</span><span></span></span><span><span></span><span>a</span></span></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x=1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>=</span><span></span></span><span><span></span><span>1</span></span></span></span>. We want <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span> to go from 0 to 1 as <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span> goes from <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span> to 1. The formula for this linear mapping is:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>t</mi><mrow><mi>r</mi><mi>a</mi><mi>w</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi>x</mi><mo>−</mo><mi>a</mi></mrow><mrow><mn>1</mn><mo>−</mo><mi>a</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">t_{raw} = \frac{x - a}{1 - a}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>r</span><span>a</span><span>w</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span></span><span>−</span><span></span><span>a</span></span></span><span><span></span><span></span></span><span><span></span><span><span>x</span><span></span><span>−</span><span></span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span></span></p><p>Now, we need to handle the cases where <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span> is outside the <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>a</mi><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[a, 1]</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>[</span><span>a</span><span>,</span><span></span><span>1</span><span>]</span></span></span></span> range.</p>
<ul>
<li>If <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&lt;</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">x &lt; a</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>&lt;</span><span></span></span><span><span></span><span>a</span></span></span></span>, then <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mrow><mi>r</mi><mi>a</mi><mi>w</mi></mrow></msub></mrow><annotation encoding="application/x-tex">t_{raw}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>r</span><span>a</span><span>w</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span> is negative. We want <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span> to be 0 in this case.</li>
<li>If <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x &gt; 1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>&gt;</span><span></span></span><span><span></span><span>1</span></span></span></span>, then <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mrow><mi>r</mi><mi>a</mi><mi>w</mi></mrow></msub></mrow><annotation encoding="application/x-tex">t_{raw}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>r</span><span>a</span><span>w</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span> is greater than 1. We want <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span> to be 1 in this case. (Although <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span> is defined on <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>[</span><span>0</span><span>,</span><span></span><span>1</span><span>]</span></span></span></span>, clamping ensures robustness).</li>
</ul>
<p>We can achieve this clamping using <code>min</code> and <code>max</code> functions:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>t</mi><mo>=</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>t</mi><mrow><mi>r</mi><mi>a</mi><mi>w</mi></mrow></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">t = \min(\max(t_{raw}, 0), 1)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>t</span><span></span><span>=</span><span></span></span><span><span></span><span>min</span><span>(</span><span>max</span><span>(</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>r</span><span>a</span><span>w</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>0</span><span>)</span><span>,</span><span></span><span>1</span><span>)</span></span></span></span></span>
<span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>t</mi><mo>=</mo><mi>min</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mi>max</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mfrac><mrow><mi>x</mi><mo>−</mo><mi>a</mi></mrow><mrow><mn>1</mn><mo>−</mo><mi>a</mi></mrow></mfrac><mo separator="true">,</mo><mn>0</mn><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mn>1</mn><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">t = \min\left(\max\left(\frac{x - a}{1 - a}, 0\right), 1\right)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>t</span><span></span><span>=</span><span></span></span><span><span></span><span>min</span><span></span><span><span><span>(</span></span><span>max</span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span></span><span>−</span><span></span><span>a</span></span></span><span><span></span><span></span></span><span><span></span><span><span>x</span><span></span><span>−</span><span></span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>,</span><span></span><span>0</span><span><span>)</span></span></span><span></span><span>,</span><span></span><span>1</span><span><span>)</span></span></span></span></span></span></span></p><p>This <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span> value now behaves exactly as we need: it’s 0 for <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>≤</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">x \le a</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>≤</span><span></span></span><span><span></span><span>a</span></span></span></span>, linearly increases from 0 to 1 for <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>≤</mo><mi>x</mi><mo>≤</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a \le x \le 1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span>≤</span><span></span></span><span><span></span><span>x</span><span></span><span>≤</span><span></span></span><span><span></span><span>1</span></span></span></span>, and is 1 for <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>≥</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x \ge 1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>≥</span><span></span></span><span><span></span><span>1</span></span></span></span>.</p>
<p>Finally, we apply the smoothstep function to this clamped and scaled input <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span> to get our final adjustment factor <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>y</span></span></span></span>:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>y</mi><mo>=</mo><mi>S</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mn>3</mn><msup><mi>t</mi><mn>2</mn></msup><mo>−</mo><mn>2</mn><msup><mi>t</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">y = S(t) = 3t^2 - 2t^3</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>y</span><span></span><span>=</span><span></span></span><span><span></span><span>S</span><span>(</span><span>t</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>3</span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span>2</span><span><span>t</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span></span></span></span></span></p><p>This allows us to use a parameter <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span> (where <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>a</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 \le a &lt; 1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0</span><span></span><span>≤</span><span></span></span><span><span></span><span>a</span><span></span><span>&lt;</span><span></span></span><span><span></span><span>1</span></span></span></span>) to <astro-island uid="2jU0QO" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0,&#34;yellow&#34;],&#34;id&#34;:[0,&#34;component-tile-e4kevfdpc99&#34;],&#34;text&#34;:[0,&#34;control&#34;],&#34;type&#34;:[0,&#34;component&#34;],&#34;forceAspectRatio&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""><astro-island uid="Z2j974W" component-url="/_astro/AdjustableSmoothstepGraph.DgNMoqNP.js" component-export="default" renderer-url="/_astro/client.BBblIl08.js" props="{&#34;showControls&#34;:[0,true]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;AdjustableSmoothstepGraph&#34;,&#34;value&#34;:&#34;vue&#34;}"></astro-island></template><!--astro:end--></astro-island> the normalized position where the smooth upward adjustment of headings begins. Setting <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a=0</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span> gives the original smoothstep over the whole range, while setting <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">a=0.5</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span>=</span><span></span></span><span><span></span><span>0.5</span></span></span></span>, for example, means headings in the first half of the page don’t move at all, and the adjustment smoothly ramps up only in the second half, effectively localizing the change.</p>
<p>Let’s pick <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>0.4</mn></mrow><annotation encoding="application/x-tex">a=0.4</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span>=</span><span></span></span><span><span></span><span>0.4</span></span></span></span> and see what this <astro-island uid="Z1qwpkf" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0,&#34;green&#34;],&#34;id&#34;:[0,&#34;component-tile-qu11ekye01a&#34;],&#34;text&#34;:[0,&#34;adjusted smoothstep&#34;],&#34;type&#34;:[0,&#34;component&#34;],&#34;forceAspectRatio&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""><astro-island uid="1h4dwz" component-url="/_astro/PageViewportVisualization.Cjt7_c79.js" component-export="default" renderer-url="/_astro/client.BBblIl08.js" props="{&#34;version&#34;:[0,&#34;smoothstep&#34;]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;PageViewportVisualization&#34;,&#34;value&#34;:&#34;vue&#34;}"></astro-island></template><!--astro:end--></astro-island> does. (if you are curious about how I found the 0.4, that might become the topic for a part 2.. Which may or may not involve blind ELO ranking. For updates its easiest to follow me <a href="https://x.com/mats_zip">here</a>.)</p>
<p>It’s… <astro-island uid="1tCaTg" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0,&#34;red&#34;],&#34;id&#34;:[0,&#34;component-tile-s8yk4t38wz8&#34;],&#34;text&#34;:[0,&#34;beautiful&#34;],&#34;type&#34;:[0,&#34;component&#34;],&#34;forceAspectRatio&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""><astro-island uid="1ag5dF" component-url="/_astro/AnchorProblem.GGiwfq1Z.js" component-export="default" renderer-url="/_astro/client.BBblIl08.js" props="{&#34;compensationMode&#34;:[0,&#34;smoothstep&#34;]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;AnchorProblem&#34;,&#34;value&#34;:&#34;vue&#34;}"></astro-island></template><!--astro:end--></astro-island>.</p>
<h2 id="validation">Validation</h2>
<p>So, we are finally done. We’ve gone to depths that no man has ever gone before to fix anchor links. A truly Carmack-esque feat that will be remembered for generations to come. Let’s ask the lead designer what <astro-island uid="ZGktz" component-url="/_astro/tile-creator.CDert_z5.js" component-export="default" renderer-url="/_astro/client.DwCUistV.js" props="{&#34;slot&#34;:[0,&#34;tile-slot&#34;],&#34;color&#34;:[0,&#34;blue&#34;],&#34;id&#34;:[0,&#34;image-tile-s3sjazefhx&#34;],&#34;text&#34;:[0,&#34;he thinks&#34;],&#34;type&#34;:[0,&#34;image&#34;],&#34;forceAspectRatio&#34;:[0,true]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;TileCreator&#34;,&#34;value&#34;:&#34;react&#34;}" await-children=""><template data-astro-template=""> <p><img src="https://thirty-five.com/social-network.jpg" alt="visualization of he thinks"/> </p> </template><!--astro:end--></astro-island>.</p>
<p>… Oh well, at least we got a blog post out of it.</p>
<p>Want overengineered anchor links for your project? Get in touch!</p>   </div></div>
  </body>
</html>
