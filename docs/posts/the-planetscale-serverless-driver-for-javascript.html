<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://planetscale.com/blog/introducing-the-planetscale-serverless-driver-for-javascript">Original</a>
    <h1>The PlanetScale serverless driver for JavaScript</h1>
    
    <div id="readability-page-1" class="page"><div><div><p>Today we are introducing the PlanetScale serverless driver for JavaScript, a Fetch API-compatible database driver.</p>
<p><strong>This new driver and infrastructure update brings you</strong>:</p>
<ul>
<li>The ability to store and query data in PlanetScale from environments such as Cloudflare Workers, Vercel Edge Functions, and Netlify Edge Functions.</li>
<li>Infrastructure improvements that enable global routing and improve connection reliability and performance.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> We put together a <a href="https://f1.planetscale.com/">demo application</a> and <a href="https://github.com/planetscale/f1-championship-stats">GitHub repository</a> that demonstrates how to implement this with Cloudflare Workers, Vercel Edge Functions, and Netlify Edge Functions.</p>
</blockquote>
<p>Until today, you could not use PlanetScale in these environments because they require external connections to be made over HTTP and not other networking protocols. Connections with other MySQL drivers speak the MySQL binary protocol over a raw TCP socket. Our new driver uses secure HTTP, which allows you to use PlanetScale in these constrained environments. The driver works in any environment that uses the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a>.</p>
<p>In addition to <a href="https://developers.cloudflare.com/workers/">Cloudflare Workers</a>, <a href="https://vercel.com/docs/concepts/functions/edge-functions">Vercel Edge Functions</a>, and <a href="https://docs.netlify.com/netlify-labs/experimental-features/edge-functions/">Netlify Edge Functions</a>, other serverless environments from these and other providers like AWS typically need databases to support hundreds, thousands, or even tens of thousands of database connections. PlanetScale has always handled these high concurrent connections effortlessly, but our underlying infrastructure change provides a much faster connection path.</p>
<h2 id="the-next-generation-of-planetscale-infrastructure"><a href="#the-next-generation-of-planetscale-infrastructure">The next generation of PlanetScale infrastructure<span aria-label="Permalink to this section">#</span></a></h2>
<p>Backing our new driver is a new HTTP API and global routing infrastructure to support it. Note: The HTTP API is currently not documented, but we plan on documenting it when we’re ready to officially release it.</p>
<p>Outside of restrictive environments, an HTTP interface for our database connectivity gives us other benefits in serverless environments, such as a modern TLS stack for faster connections with TLS 1.3, connection multiplexing with HTTP/2, protocol compression with gzip, brotli, or snappy, all of which lead to a better experience for serverless environments.</p>
<p>Our new infrastructure and APIs also enable global routing. Similar to a CDN, global routing reduces latency drastically in situations where a client is connecting from a geographically distant location, which is common within serverless and edge compute environments. A client connects to the closest geographic edge in our network, then backhauls over long-held connection pools over our internal network to reach the actual destination. Within the US, connections from US West to a database in US East reduce latency by 100ms or more in some cases, even more as the distance increases.</p>
<h2 id="how-to-use-the-planetscale-serverless-driver-for-javascript"><a href="#how-to-use-the-planetscale-serverless-driver-for-javascript">How to use the PlanetScale serverless driver for JavaScript<span aria-label="Permalink to this section">#</span></a></h2>
<p>First, in your database’s <strong>Settings</strong> &gt; <strong>Beta features</strong> section, make sure to enroll your database into the <strong>PlanetScale serverless driver for JavaScript</strong> beta.</p>
<p>Once this is done, your database is ready to use the new driver. Next, install the package in your environment:</p>
<div><div><pre><code><span><span>npm</span><span> </span><span>install</span><span> @planetscale/database</span></span></code></pre></div></div>
<p>You can see the <a href="https://github.com/planetscale/database-js">driver&#39;s code and documentation here</a>.</p>
<p>The driver will first have you connect with a PlanetScale-provided <code>host</code>, <code>username</code>, and <code>password</code>. In your database <strong>Overview</strong> page, click the <strong>Connect</strong> button and select “@planetscale/database” from the “Connect with” dropdown. You can copy and paste the <code>host</code>, <code>user</code>, and <code>password</code> into your code. When deploying your code, we recommend creating environment variables in the serverless platform of your choice to store these variables.</p>
<div><div><pre><code><span><span>import</span><span> </span><span>{</span><span> connect </span><span>}</span><span> </span><span>from</span><span> </span><span>&#39;@planetscale/database&#39;</span><span>
</span></span><span>
</span><span><span></span><span>const</span><span> config </span><span>=</span><span> </span><span>{</span><span>
</span></span><span><span>  </span><span>host</span><span>:</span><span> </span><span>&#39;&lt;host&gt;&#39;</span><span>,</span><span>
</span></span><span><span>  </span><span>username</span><span>:</span><span> </span><span>&#39;&lt;user&gt;&#39;</span><span>,</span><span>
</span></span><span><span>  </span><span>password</span><span>:</span><span> </span><span>&#39;&lt;password&gt;&#39;</span><span>
</span></span><span><span></span><span>}</span></span></code></pre></div></div>
<p>Then, once your connection configuration is set, you will connect to and execute a SQL command on PlanetScale.</p>
<div><div><pre><code><span><span>const</span><span> conn </span><span>=</span><span> </span><span>connect</span><span>(</span><span>config</span><span>)</span><span>
</span></span><span><span></span><span>const</span><span> results </span><span>=</span><span> </span><span>await</span><span> conn</span><span>.</span><span>execute</span><span>(</span><span>&#39;SHOW TABLES&#39;</span><span>)</span><span>
</span></span><span><span></span><span>console</span><span>.</span><span>log</span><span>(</span><span>results</span><span>)</span></span></code></pre></div></div>
<p>The driver also handles your SQL sanitization to help prevent security issues like SQL injection. For example, this is useful in queries like the following with a parameter:</p>
<div><div><pre><code><span><span>conn</span><span>.</span><span>execute</span><span>(</span><span>&#39;SELECT * FROM users WHERE email=?&#39;</span><span>,</span><span> </span><span>[</span><span>&#39;foo@example.com&#39;</span><span>]</span><span>)</span></span></code></pre></div></div>
<p>You can read more about the driver and its features in the <a href="http://planetscale.com/docs/tutorials/planetscale-serverless-driver">PlanetScale serverless driver for JavaScript documentation</a>.</p>
<h2 id="want-to-see-it-in-action?"><a href="#want-to-see-it-in-action?">Want to see it in action?<span aria-label="Permalink to this section">#</span></a></h2>
<p>We have created an example of using this season’s F1 racing data. In the <a href="https://f1.planetscale.com/">example application</a>, you can choose to have the data pulled from a PlanetScale database using <strong>Cloudflare Workers</strong>, <strong>Vercel Edge Functions</strong>, or <strong>Netlify Edge Functions</strong>.</p>
<p><span><img alt="Screenshot of our demo application that shows a graph of Formula 1 championship standings data with an edge function selector option." src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></p>
<p>We have separated how each of these functions works. You can see the <a href="https://github.com/planetscale/f1-championship-stats/tree/main/examples/cloudflare">Cloudflare Workers</a>, <a href="https://github.com/planetscale/f1-championship-stats/tree/main/examples/vercel">Vercel Edge Functions</a>, and <a href="https://github.com/planetscale/f1-championship-stats/tree/main/examples/netlify">Netlify Edge Functions</a> examples in their own subdirectory.</p>
<p>Stay tuned for more examples, including a <a href="https://www.twitch.tv/planetscale"><strong>Twitch stream next Tuesday at 11am CT / 9am PT</strong></a> where we&#39;ll cover how to use it in an AWS Lambda function.</p>
<h2 id="try-it-out-yourself"><a href="#try-it-out-yourself">Try it out yourself<span aria-label="Permalink to this section">#</span></a></h2>
<p>Ready to try out the driver in your serverless and edge compute platform of choice? Get started in the <a href="http://planetscale.com/docs/tutorials/planetscale-serverless-driver">PlanetScale documentation</a>.</p>
<p>Tweet at us <a href="https://twitter.com/planetscaledata">@planetscaledata</a> or post in our <a href="https://github.com/planetscale/discussion/discussions">GitHub Discussion group</a> to share your experience with the new driver.</p>
</div></div></div>
  </body>
</html>
