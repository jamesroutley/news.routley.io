<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/">Original</a>
    <h1>Multics and AS400：DPS8M on IBM PASE for I (OS/400)</h1>
    
    <div id="readability-page-1" class="page"><div>
        
  <article>
    
    <section>
      <!-- SPDX-License-Identifier: CC-BY-SA-4.0 -->
<!-- Copyright (c) 2016-2024 Jeffrey H. Johnson <trnsz@pobox.com> -->
<p>Finally, you can run dozens of multiprocessing <strong>Multics</strong> instances along side your mission-critical <strong>IBM AIX</strong> (PASE) and <strong>IBM i</strong> (OS/400) workloads on <strong>IBM Power Systems</strong> hardware!</p>



  <div>
    <figure>
      <a href="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/SHOW_VERSION.png">
        <picture>
            <source srcset="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/SHOW_VERSION_hue0911ffb42f4015dbda746fe1d24b831_58276_600x0_resize_box_3.png"/>
          <img loading="lazy" src="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/SHOW_VERSION_hue0911ffb42f4015dbda746fe1d24b831_58276_1800x0_resize_box_3.png" alt="&#34;DPS8M/400&#34;"/>
        </picture>
      </a>
          <figcaption>
            &#34;DPS8M/400&#34;
          </figcaption>
    </figure>
  </div>

<p>This is <em>the</em> virtualization solution your IT department has been waiting for… well, <em>perhaps</em> it isn’t — but supporting this platform is a great demonstration of both the capabilities of the <a href="https://www.ibm.com/docs/en/i/7.5?topic=programming-pase-i">IBM PASE for i</a> (<em>Portable Application Solutions Environment</em>) runtime for enabling <a href="https://ibm.biz/ibmioss">OSS on IBM i</a>, and the excellent compatibility and portability of the <a href="https://dps8m.gitlab.io"><strong>DPS8M</strong></a> simulator software.</p>

<p>A short introduction is in order for anyone who may have stumbled here without any idea at all about what any of this is about.</p>
<p>When you hear “<em>AS400</em>” today, it’s most likely a reference to the <a href="https://www.ibm.com/products/ibm-i">IBM i</a> operating system and associated software running on <a href="https://www.ibm.com/power">IBM Power Systems</a> hardware.  The current generation of IBM server hardware is both highly performing and extremely reliable, with the many of deployments achieving actual availability near seven-nines - 99.99999% - rivaled only by mainframe platforms like <a href="https://www.stratus.com/">Stratus</a> and <a href="https://www.ibm.com/z">IBM Z</a>.</p>

<p>The story of the AS400 <em>really</em> begins with the <a href="https://en.wikipedia.org/wiki/IBM_1401">IBM 1401</a> (<small>more <a href="https://www.ibm.com/history/1401">1401 History</a> and <a href="https://ibm-1401.info/">1401 Information</a></small>) in 1959, the first widely popular computer.  By the mid-1960’s, the majority of computers in existence were IBM 1401’s.  In 1964, IBM introduced the famous <a href="https://en.wikipedia.org/wiki/IBM_System/360">System/360</a> <em>family</em> of computers, a series of compatible machines covering all possibles use cases, an extremely radical concept at the time.  Unfortunately (for IBM), even the low-end 360 systems were too expensive for many 1401 customers (with the 1401 itself remaining available until 1971).  What IBM needed was a <a href="https://en.wikipedia.org/wiki/Minicomputer">minicomputer</a> — a <em>midrange</em> system, in IBM lingo — less costly than an entry 360, and competitive against the stubbornly popular <a href="https://en.wikipedia.org/wiki/Honeywell_200">Honeywell 200</a>, also released in 1964.</p>

<p>The first IBM midrange system was the <a href="https://en.wikipedia.org/wiki/IBM_System/3">System/3</a> business computer released in 1969, which was made available for less than half the cost of the lowest-end <a href="https://en.wikipedia.org/wiki/IBM_System/360_Model_20">S/360‑M20</a> mainframe.  The System/3 was followed by the <a href="https://en.wikipedia.org/wiki/IBM_System/32">System/32</a> in 1975. This was the system that introduced the iconic <a href="https://en.wikipedia.org/wiki/IBM_5250">IBM 5250 terminal</a>, an improvement on the previous 2260 and 3270 models, and pioneered the fully integrated system software concept.  In 1977, the <a href="https://en.wikipedia.org/wiki/IBM_System/34">System/34</a> was launched as a multi-user and multi-tasking System/32 successor, and was quickly followed by the medium-scale <a href="https://en.wikipedia.org/wiki/IBM_System/36">System/38</a> in 1978 and the small-scale <a href="https://en.wikipedia.org/wiki/IBM_System/36">System/36</a> in 1983.</p>

<p>The <a href="https://en.wikipedia.org/wiki/IBM_AS/400"><strong>AS/400</strong></a> hardware (and OS/400 software) was created in 1988 as combination of the System/36 and System/38 product lines.  The AS/400 used a unique layered system architecture based on the “Technology Independent Machine Interface”, or TIMI, which isolates the software from the underlying hardware implementation, presenting a virtual 128-bit instruction set as the abstraction.  At the actual physical hardware level, the system was built on top of a custom 48-bit CISC architecture.</p>



  <div>
    <figure>
      <a href="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/AS400.jpg">
        <picture>
            <source srcset="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/AS400_huccef89aad62d2e757fbce50606d792c0_122232_600x0_resize_q75_box.jpg"/>
          <img loading="lazy" src="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/AS400_huccef89aad62d2e757fbce50606d792c0_122232_1800x0_resize_q75_box.jpg" alt="IBM AS/400 (B60) in 1988"/>
        </picture>
      </a>
          <figcaption>
            IBM AS/400 (B60) in 1988
          </figcaption>
    </figure>
  </div>

<p>The AS/400 platform evolved into the <strong>iSeries</strong>, which replaced the 48-bit CISC processor with a 64-bit PowerPC-based CPU, the <a href="https://en.wikipedia.org/wiki/IBM_RS64">RS64</a>, a superset of the <a href="https://en.wikipedia.org/wiki/PowerPC">PowerPC</a> incorporating many <a href="https://en.wikipedia.org/wiki/IBM_POWER_architecture">POWER ISA</a> features.  Because of the unique software design, most user applications kept working without modification or even recompilation to take advantage of the new 64-bit hardware.</p>

<p>In 2001, the <a href="https://en.wikipedia.org/wiki/POWER4">POWER4</a> CPU was released, merging the RS64 and POWER lines.</p>
<p>The <a href="https://en.wikipedia.org/wiki/POWER5">POWER5</a> CPU came in 2005, and along with it, a rebranding of the OS/400 software to <strong>i5/OS</strong>, associating it with the new processor. In 2006, the hardware platform was renamed to <strong>System i</strong>. In 2007, the System i machines, by now <strong>IBM Power Systems</strong> servers with specific firmware, were upgraded with <a href="https://en.wikipedia.org/wiki/POWER6">POWER6</a> processors. Finally, in 2008, i5/OS was renamed to just “<strong>IBM i</strong>”.</p>
<p>Whew!  Of course, not everyone is a fan of the latest branding, and many, but certainly <em><a href="https://www.nicklitten.com/i-remember-the-ibm-as-400/">not all</a></em> (<small><a href="https://archive.is/req9O">archive.today</a>, <a href="https://web.archive.org/web/20231001183230/https://www.nicklitten.com/i-remember-the-ibm-as-400/">wayback</a></small>) users today, when referring to the platform, still affectionately call it <strong>AS400</strong> — most often (<em>but not always</em>) <a href="https://www.integrativesystems.com/journey-of-the-brawny-ibm-as400/">without the slash</a> (<small><a href="https://archive.is/5m0t3">archive.today</a>, <a href="https://web.archive.org/web/20230607044755/https://www.integrativesystems.com/journey-of-the-brawny-ibm-as400/">wayback</a></small>) — and still refer to the operating system as <strong>OS/400</strong>.</p>
<p>I don’t have enough space or knowledge to write a more in-depth history of the AS400 platform, so if you’re interested in learning more I recommend browsing IBM’s <a href="https://www.ibm.com/history/as-400">AS/400 History</a> site, and reading <a href="https://ctors.net/">Tom Van Looy’s</a> excellent paper <a href="https://treasures.scss.tcd.ie/hardware/TCD-SCSS-T.20121208.068/IBM-AS400-technical-introduction.pdf">IBM AS/400: A Technical Introduction</a> (<small><a href="https://web.archive.org/web/20231016214012/https://treasures.scss.tcd.ie/hardware/TCD-SCSS-T.20121208.068/IBM-AS400-technical-introduction.pdf">wayback</a></small>).</p>

<p>It’s now the year 2024, 55 years after the 1969 release of the System/3, and the IBM midrange platform is still going strong, even as some disparage the system as a “dinosaur” and describe it’s modern-day adherents as <a href="https://www.infoworld.com/article/2631698/true-believers--the-biggest-cults-in-tech.html?page=7">cultists</a> (<small><a href="https://archive.is/zqR93">archive.today</a>, <a href="https://web.archive.org/web/20230531234051/https://www.infoworld.com/article/2631698/true-believers--the-biggest-cults-in-tech.html?page=7">wayback</a></small>).</p>



  <div>
    <figure>
      <a href="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/POWER10.jpg">
        <picture>
            <source srcset="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/POWER10_hu940c1204f041751575f414cb20f18296_517900_600x0_resize_q75_box.jpg"/>
          <img loading="lazy" src="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/POWER10_hu940c1204f041751575f414cb20f18296_517900_1800x0_resize_q75_box.jpg" alt="IBM &#34;AS400&#34; (POWER10) in 2024"/>
        </picture>
      </a>
          <figcaption>
            IBM &#34;AS400&#34; (POWER10) in 2024
          </figcaption>
    </figure>
  </div>

<p>Of course, none of that should deter our audience of GE/Honeywell/Bull and Multics fanatics; after all, our beloved 600/6000-series computers originated with the <a href="https://en.wikipedia.org/wiki/MISTRAM#M-236_computer">GE M-235</a> system designed for the MISTRAM project — in 1955!</p>
<p>The AS400, while not sharing any direct heritage with Multics, does implement features that Multics users can appreciate, such as <a href="https://en.wikipedia.org/wiki/Single-level_store#System/38_and_IBM_i_design">single-level storage</a>, an MRDS-like integrated relational database management system, and the goal of providing an always-on high availability computing utility.</p>

<p><strong>DPS8M</strong> was ported using <a href="https://www.ibm.com/docs/en/i/7.5?topic=programming-pase-i"><strong>PASE for i</strong></a>, a runtime environment that supports the application binary interface (ABI) of the <a href="https://www.ibm.com/products/aix">IBM AIX</a> operating system, enabling many AIX binaries to run on IBM i.</p>



  <div>
    <figure>
      <a href="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/QP2SHELL.png">
        <picture>
            <source srcset="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/QP2SHELL_hueb16c907f8a6dfb4a4ea27023b56f710_44693_600x0_resize_box_3.png"/>
          <img loading="lazy" src="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/QP2SHELL_hueb16c907f8a6dfb4a4ea27023b56f710_44693_1800x0_resize_box_3.png" alt="QP2SHELL：IBM PASE for i, the AIX-like environment"/>
        </picture>
      </a>
          <figcaption>
            QP2SHELL：IBM PASE for i, the AIX-like environment
          </figcaption>
    </figure>
  </div>

<p>AIX binaries running on PASE for i support the direct execution of POWER instructions on the hardware itself, bypassing the usual user abstraction layer.  This provides near-native performance for CPU-heavy workloads like the <strong>DPS8M</strong> simulator, at the expense of future-proof portability on the platform.</p>

<p>I should mention that the feasibility of an Integrated Language Environment (ILE) port utilizing <a href="https://www.ibm.com/docs/en/i/7.5?topic=languages-c-c">ILE C/C++</a> and the <a href="https://www.ibm.com/support/pages/ascii-runtime-ibm-i">ASCII Runtime for IBM i</a> was explored, but the idea was abandoned.</p>
<p>Surprisingly, this was not because of any major inadequacies of the ILE compilers and environment (at least not for our use), which provide a (<em>large</em>, <em>nearly complete</em>) subset of C99 and C++0x and some POSIX compatibility as well, but because the ease of working with PASE and the close compatibility with AIX simply outweighed any potential benefit of the longer ILE porting process.</p>
<p>It’s also hard to argue with the near-native performance, and future maintenance efforts are expected to be minimal.</p>

<p>Since <strong>DPS8M</strong> officially supports AIX (<strong>since R3.0.0</strong>), utilizing PASE meant that most of the porting work was already done. Indeed, adapting our source code and build procedures to support the PASE for i environment was <em>mostly</em> straightforward.  That being said, AIX isn’t PASE and PASE isn’t AIX, but for the subset of AIX interfaces and libraries supported, the runtime behavior of PASE seems to be at least 90% identical.  The most noticeable differences are in lower-level OS functionality, like thread and process priority manipulation, filesystem semantics, shared library locations, and memory management.</p>
<p>These differences are substantial enough to require <strong>DPS8M</strong> be built specifically for IBM i (at least at this time), rather than being able to offer a single binary package that would work on both AIX and IBM i systems.</p>
<p>As a prerequisite to porting <strong>DPS8M</strong> itself, we needed to be sure that our major third-party dependencies were supported and functioning.</p>
<ol>
<li>
<p><a href="https://libuv.org/"><strong>libuv</strong></a>, a portable high‑performance platform support library, with a focus on asynchronous‑I/O based on event loops, originally developed to support the Node.js® runtime, and,</p>
</li>
<li>
<p><a href="https://github.com/aremmell/libsir"><strong>libsir</strong></a>, the “Standard Incident Reporter” library, a lightweight, cross-platform library for information distribution (which will be used in the next major version of the simulator).</p>
</li>
<li>
<p><a href="https://speleotrove.com/decimal/#decNumber"><strong>decNumber</strong></a>, an implementation the <a href="https://speleotrove.com/decimal/">General Decimal Arithmetic Specification</a>.</p>
</li>
<li>
<p>We also have an optional dependency, <a href="https://github.com/ianlancetaylor/libbacktrace"><strong>libbacktrace</strong></a>, which does support AIX, but is non-functional in the PASE environment.  This may or may not be able to be overcome, but it isn’t a showstopper.</p>
</li>
</ol>



  <div>
    <figure>
      <a href="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/SHOW_BUILD.png">
        <picture>
            <source srcset="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/SHOW_BUILD_hub1e3e6231dfba8ee4fe7a77f7add22cd_20284_600x0_resize_box_3.png"/>
          <img loading="lazy" src="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/SHOW_BUILD_hub1e3e6231dfba8ee4fe7a77f7add22cd_20284_1800x0_resize_box_3.png" alt=""/>
        </picture>
      </a>
    </figure>
  </div>

<p><em>libuv</em> is readily available <a href="http://ibm.biz/ibmi-rpms">from IBM</a>, having been ported as a prerequisite of Node.js, which IBM supports on i.  The RPM package can be installed with <code>dnf</code> or <code>yum</code> from PASE and has been used to successfully build the simulator.  It can also be extracted and used to facilitate cross-compilation from Linux or AIX systems.  Our built-in libuv-builder targets (<code>gmake libuvrel</code>, <code>gmake libuvdev</code>) can be be used when compiling on PASE using GCC 10.3.0 (or later) or IBM XL C/C++ V16.1 (or later) from within the PASE environment.  I’ve not yet tested using IBM Open XL C/C++, the new LLVM-based toolchain, but it would likely work as well.</p>
<p><em>decNumber</em> is highly portable and entirely independent of most OS specifics.  It doesn’t even need stdio.  While <strong>DPS8M</strong> includes an optimized subset of this library (implementing only required functionality) that required no modifications, the base PASE for i environment conveniently includes this library and associated header files as well.</p>
<p><em>libsir</em> required more significant modifications which are available in the current git <code>master</code> branch, and will be part of the the upcoming v2.2.5 release.</p>




  <div>
    <figure>
      <a href="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/DPS8M.png">
        <picture>
            <source srcset="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/DPS8M_hu6d0ff8e824ad09d74af9590ddd89efe9_132779_600x0_resize_box_3.png"/>
          <img loading="lazy" src="https://dps8m.gitlab.io/blog/posts/20240207_DPS8M_AS400/images/DPS8M_hu6d0ff8e824ad09d74af9590ddd89efe9_132779_1800x0_resize_box_3.png" alt="Multics MR12.8 on DPS8M on PASE for IBM i 7.5 (OS/400)"/>
        </picture>
      </a>
          <figcaption>
            Multics MR12.8 on DPS8M on PASE for IBM i 7.5 (OS/400)
          </figcaption>
    </figure>
  </div>

<p>I was impressed with the overall development and debugging experience on IBM i.  Anyone who is comfortable with IBM AIX should feel at home in PASE.  Just imagine a slightly “weirder” (or perhaps “quirky”) subset of AIX.  The PASE environment provides the AIX version of the <code>dbx</code> debugger, which I have a strong preference for, and the <code>gdb</code> debugger is also available and seems to work well, although I only tested it in conjunction with <code>gcc</code>.  If you prefer a GUI, there is the (<em>Java-based</em>) <a href="https://www.ibm.com/docs/en/i/7.5?topic=tools-i-debugger">IBM i Debugger</a> which provides specific support for the PASE environment as well as the ILE.</p>

<p>For the “classic” side of i (accessed via the 5250 interface), there are debugging tools available that proved <em>very</em> helpful for this project. These include screens where you can easily watch real-time stack traces, see thread details, and monitor job status.  I even used the <code>EDTF</code> editing facility - very strong <code>XEDIT</code> vibes - and although it is very basic, it was more than sufficient for quick modifications and is, of course, instantly responsive, even when the IBM i host is lagging (or highly loaded), due to the use the block/screen-oriented 5250 protocol.  This came in handy a few times when my connection quality was less than ideal.  PASE programs can also call ILE (and vice versa) so porting with PASE is a good way to ease into working with ILE and IBM i in general.</p>

<p>Don’t let the green screen scare you away from the platform!</p>
<p>There is <a href="https://www.ibm.com/products/rational-developer-for-i">IBM Rational Developer for i</a> (for Eclipse fans) and <a href="https://marketplace.visualstudio.com/items?itemName=HalcyonTechLtd.code-for-ibmi">Code for IBM i</a> (for VSCode fans). You can work with the integrated database with <a href="https://ibmi-oss-docs.readthedocs.io/en/latest/odbc/">IBM i Access ODBC</a> from Linux, Windows, and macOS desktops, and use <a href="https://www.ibm.com/support/pages/ibm-i-access-client-solutions">IBM i ACS</a> to access IBM i completely from a web browser (<small>yuck</small>).</p>
<p>The unexpected thing is that I absolutely didn’t hate this system.  In fact, I liked it.  I liked it a lot.  Probably more than I should have.  I’m going to continue to learn more about the IBM i platform (outside of the PASE environment) and look forward to putting some i skills on the resume.</p>
<p>Modern IBM i powers many multibillion dollar businesses today (like Costco, with $245B in annual revenue).  Now they can run Multics as well! <strong><code>:-)</code></strong></p>

<p>While I’m not going to promise IBM i builds in CI just yet, the changes necessary to build on IBM PASE for i should land in the <code>master</code> git repo in the next few days, and will be buildable under IBM PASE for i (that is, on OS/400) using GCC 10.3.0 (or later) or IBM XL C/C++ 16.1 (or later), and requires a minimum libuv version of 1.42.0.  We’ve only tested IBM i 7.5, but everything should work on IBM i 7.4 as well.  Cross-compilation is possible and will be documented in the near future.</p>
<p>NOTE: IBM i 7.3 and 7.2 <em>might</em> work, but are unsupported by us, so your mileage may vary. IBM i 7.1 and below will almost certainly <em>never</em> work. <strong>DPS8M</strong> has always targeted AIX 7 and the PASE environment on 7.1 only offers parity with AIX 6.1.</p>
<p>These binaries are compiled for POWER9, the minimum supported processor level for IBM i 7.5.  The <code>prt2pdf</code> and <code>punutil</code> utilities are included.  The <code>punutil</code> utility requires the <code>popt</code> package to be installed via RPM.</p>

<ul>
<li><a href="https://gitlab.com/dps8m/dps8m/-/wikis/uploads/43e0b97d4aad46a3e11522c664b28376/dps8m-os400-75-p9-20240207.tar.gz"><strong>dps8m-os400-75-p9-20240207.tar.gz</strong></a>
<ul>
<li>sha256sum: <code>799c9ab49fdaab3b5d7112263cbbdf4e12a881a5ed394a8d546828bb34fc3c54</code></li>
</ul>
</li>
</ul>
<p><small>This software provided is experimental, and is distributed “<strong>AS IS</strong>”, <strong>WITHOUT WARRANTY OF ANY KIND</strong>, under the terms of the <strong>ICU License</strong>.</small></p>

<p><strong>A big thank you is due to <a href="https://www.rzkh-gmbh.de/">Holger Scherer of POWERbunker, RZKH GmBh</a> for donating the resources that helped make this development possible.</strong></p>
<p><strong>If you need commercial IBM i hosting, don’t hesitate to get in touch with them.  You can also try out their <a href="https://pub400.com/">PUB400</a> service for limited free public access to IBM i for non-commercial use.</strong></p>
<p>— <a href="mailto:trnsz@pobox.com"><em>Jeffrey H. Johnson</em></a></p>

    </section>
  </article>

      </div></div>
  </body>
</html>
