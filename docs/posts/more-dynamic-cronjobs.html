<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://george.mand.is/2025/09/more-dynamic-cronjobs/">Original</a>
    <h1>More dynamic cronjobs</h1>
    
    <div id="readability-page-1" class="page"><div><article><section><header><p><time datetime="2025-09-21">September 21st, 2025</time> • ~600 words • 3 minute read</p></header><p>I remember learning about cronjobs in the early 2000s. I could tell the computer to go <em>do</em> something, on a recurring basis, forever, even when I wasn&#39;t there. They felt like magic!</p><p>We didn&#39;t have <a href="https://crontab.guru">Crontab.guru</a> or AI to ask for figuring out some of the more complex specifications. Just the <a href="https://man.openbsd.org/crontab.5">man pages</a> and good old-fashioned trial and error—mostly error in my case.</p><p>But while you could do fun, complex specifications of recurring intervals, you couldn&#39;t quite specify something quite as dynamic as &#34;run this script every Tuesday at 7am <em>unless it&#39;s the last Tuesday</em> of the month...&#34;</p><p>Or at least, you couldn&#39;t strictly through the crontab specification syntax. But I had a recent, mildly embarrassing epiphany that it&#39;s not hard at all to add arbitrary checks to your crontab to account for more complex and dynamic scenarios.</p><p>Want to run a script every Tuesday of the month at 7am <em>except</em> for the last Tuesday? That&#39;s easy—set up your crontab to run every Tuesday at 7am, but add a little check to make sure the <em>next</em> week is still part of the same month:</p><pre><code>0 7 * * Tue [ &#34;$(date -v+7d &#39;+%m&#39;)&#34; = &#34;$(date &#39;+%m&#39;)&#34; ] &amp;&amp; /path/to/your_command
</code></pre><p>If it&#39;s not part of the same month, that means we&#39;re on the <em>last</em> Tuesday for the month and the script won&#39;t run.</p><p><strong>Note:</strong> <em>The <code>-v</code> flag is for the macOS/BSD flavors of <code>date</code>. On Linux you&#39;d want to use <code>-d +7 days</code> instead.</em></p><p>This really has nothing to do with cronjobs at all and everything to do with the <a href="https://www.unix.com/man_page/posix/1p/test/">POSIX &#34;test&#34; command</a> which is the thing we&#39;re using with those square brackets. I&#39;m used to seeing and utilizing them in shell scripts, but for whatever reason I never thought to reach for that tool here in the crontab.</p><p>You could just as easily rewrite it like this, skipping the bracket shorthand, which is probably easier to read:</p><pre><code>0 7 * * Tue test &#34;$(date -v+7d &#39;+%m&#39;)&#34; = &#34;$(date &#39;+%m&#39;)&#34; &amp;&amp; /path/to/your_command
</code></pre><p>It never crossed my mind until recently to add slightly more complex checks at the crontab level.</p><h3>Other clever cronjob things you can do:</h3><h4>Holiday-only cronjobs</h4><p>Maybe fetch a list of all the US Holidays for a given year and store them in a handy <code>HOLIDAYS.txt</code> file somewhere:</p><pre><code>curl -s https://date.nager.at/api/v3/PublicHolidays/2025/US | jq -r &#39;.[].date&#39; &gt; HOLIDAYS.txt
</code></pre><p>Now you can update your cronjob to run every Tuesday at 7am <em>except</em> on Holidays:</p><pre><code>0 7 * * Tue ! grep -qx &#34;$(date +%F)&#34; HOLIDAYS.txt &amp;&amp; /path/to/your_command
</code></pre><p>Or inversely, maybe run a holiday-only script that checks once a day</p><pre><code>@daily grep -qx &#34;$(date +%F)&#34; HOLIDAYS.txt &amp;&amp; /path/to/your_special_holiday_command
</code></pre><h4>Only run on sunny days</h4><p>The <a href="https://weather.gov">National Weather Service</a> makes all kinds of fun data available (if you can find it...). How about a script that runs every hour, but only when the weather is clear?</p><pre><code>@hourly curl -s &#34;https://api.weather.gov/gridpoints/TOP/32,81/forecast/hourly&#34; | jq -r &#39;.properties.periods[0].shortForecast&#39; | grep -qi clear &amp;&amp; /path/to/your_command
</code></pre><p>Or maybe when the weather is cloudy?</p><pre><code>@hourly curl -s &#34;https://api.weather.gov/gridpoints/TOP/32,81/forecast/hourly&#34; | jq -r &#39;.properties.periods[0].shortForecast&#39; | grep -qi cloudy &amp;&amp; /path/to/your_command
</code></pre><h4>Only run when there&#39;s something newsworthy</h4><p>Or maybe we get in line with every-other-startup I&#39;m aware of and throw AI at the problem, only running our script when the LLM gods have decided there is something newsworthy:</p><pre><code>@hourly curl -s &#34;https://news.google.com/rss?hl=en-US&amp;gl=US&amp;ceid=US:en&#34; | llm --system &#34;Reply strictly &#39;yes&#39; or &#39;no&#39;. Does anything in the news today suggest it is a good reason to run a script that I only want to send when the world is on fire and crazy and terrible things are happening?&#34;  | tr -d &#39;[:space:]&#39; | tr &#39;[:upper:]&#39; &#39;[:lower:]&#39; | grep -qx yes &amp;&amp; /path/to/oh_no
</code></pre>--<p><em>Published on Sunday, September 21st 2025. Read this post as <a href="https://george.mand.is/2025/09/more-dynamic-cronjobs.md" rel="alternate" type="text/markdown">Markdown</a> or <a href="https://george.mand.is/2025/09/more-dynamic-cronjobs.txt" rel="alternate" type="text/plain">plain-text</a>.</em></p><p><em>If you enjoyed reading this consider <a href="https://buttondown.com/georgemandis">signing-up for my newsletter</a>, <a href="https://news.ycombinator.com/submitlink?u=https://george.mand.is/2025/09/more-dynamic-cronjobs/&amp;t=More dynamic cronjobs">sharing it on Hacker News</a> or <a href="https://george.mand.is/hire">hiring me</a>.</em></p></section></article></div></div>
  </body>
</html>
