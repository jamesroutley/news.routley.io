<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://blog.dusktreader.dev/2025/03/29/self-contained-python-scripts-with-uv/">Original</a>
    <h1>Self-contained Python scripts with uv</h1>
    
    <div id="readability-page-1" class="page"><div data-md-component="container">
      
      
        
          
        
      
      <main data-md-component="main">
        <div>
          
            
              
                
              
              
            
            
              
                
              
              
            
          
          
  <div data-md-component="content">
    
    <article>
      
        
  


  <nav>
    
      
      
      
        <span>Python</span>
      
    
      
      
      
        <span>uv</span>
      
    
  </nav>


  
  



<div>
<p>TLDR</p>
<p>You can add uv into the shebang line for a Python script to make it a self-contained executable.</p>
</div>
<p>I am working on a Go project to better learn the language. It&#39;s a simple API backed by a postgres database.</p>
<p>When I need to test out an endpoint, I prefer to use the <a href="https://www.python-httpx.org/">httpx</a> python package inside an
<a href="https://ipython.org/">ipython</a> REPL over making curl requests. It&#39;s nice to be able to introspect responses and easily
package payloads with dicts instead of writing out JSON.</p>
<p>Anyway, I decided to write a script to upsert some user data so that I can beat on my <code>/users</code> endpoint.</p>
<!-- more -->

<p>My <code>jam_users.py</code> script looks like this:</p>
<div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span>import</span><span> </span><span>httpx</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span>import</span><span> </span><span>IPython</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span>from</span><span> </span><span>loguru</span><span> </span><span>import</span> <span>logger</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span>users</span> <span>=</span> <span>[</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span>dict</span><span>(</span><span>name</span><span>=</span><span>&#34;The Dude&#34;</span><span>,</span> <span>email</span><span>=</span><span>&#34;the.dude@abides.com&#34;</span><span>,</span> <span>password</span><span>=</span><span>&#34;thedudeabides&#34;</span><span>),</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span>dict</span><span>(</span><span>name</span><span>=</span><span>&#34;Walter Sobchak&#34;</span><span>,</span> <span>email</span><span>=</span><span>&#34;walter@sobchak-security.com&#34;</span><span>,</span> <span>password</span><span>=</span><span>&#34;vietnamvet&#34;</span><span>),</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span>dict</span><span>(</span><span>name</span><span>=</span><span>&#34;Donnie&#34;</span><span>,</span> <span>email</span><span>=</span><span>&#34;donniesurfs@yahoo.com&#34;</span><span>,</span> <span>password</span><span>=</span><span>&#34;iamthewalrus&#34;</span><span>),</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span>dict</span><span>(</span><span>name</span><span>=</span><span>&#34;Maude&#34;</span><span>,</span> <span>email</span><span>=</span><span>&#34;mauddie@avant-guard.com&#34;</span><span>,</span> <span>password</span><span>=</span><span>&#34;goodmanandthorough&#34;</span><span>),</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span>]</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span>r</span> <span>=</span> <span>httpx</span><span>.</span><span>get</span><span>(</span><span>&#34;http://localhost:4000/v1/users&#34;</span><span>)</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span>r</span><span>.</span><span>raise_for_status</span><span>()</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span>for</span> <span>user</span> <span>in</span> <span>r</span><span>.</span><span>json</span><span>()[</span><span>&#34;users&#34;</span><span>]:</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span>logger</span><span>.</span><span>info</span><span>(</span><span>f</span><span>&#34;Deleting: </span><span>{</span><span>user</span><span>[</span><span>&#39;name&#39;</span><span>]</span><span>}</span><span>&#34;</span><span>)</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span>r</span> <span>=</span> <span>httpx</span><span>.</span><span>delete</span><span>(</span><span>f</span><span>&#34;http://localhost:4000/v1/users/</span><span>{</span><span>user</span><span>[</span><span>&#39;id&#39;</span><span>]</span><span>}</span><span>&#34;</span><span>)</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span>r</span><span>.</span><span>raise_for_status</span><span>()</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span>for</span> <span>user</span> <span>in</span> <span>users</span><span>:</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span>r</span> <span>=</span> <span>httpx</span><span>.</span><span>post</span><span>(</span><span>&#34;http://localhost:4000/v1/users&#34;</span><span>,</span> <span>json</span><span>=</span><span>user</span><span>)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span>r</span><span>.</span><span>raise_for_status</span><span>()</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span>logger</span><span>.</span><span>info</span><span>(</span><span>f</span><span>&#34;Created: </span><span>{</span><span>r</span><span>.</span><span>json</span><span>()</span><span>}</span><span>&#34;</span><span>)</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span>IPython</span><span>.</span><span>embed</span><span>()</span>
</span></code></pre></div>
<p>This is really straight-forward. It will clear out any existing users and then insert these test users. Right after
that, I get dropped into an <code>ipython</code> repl to do what I need for testing. All I have to do is run:</p>

<p>However, if I want to run the script as-is, I will need to choose one of these approaches:</p>
<ul>
<li>Install the dependencies <code>httpx</code>, <code>IPython</code>, and <code>loguru</code> globally in my system python</li>
<li>Create a virtual environment, activate it, install deps, and run my script while the venv is activated</li>
</ul>
<p>These are both not great options in my opinion. These approaches also rely on having a system python installed that is
compatible with these packages. This isn&#39;t as big of a problem, but something to consider anyway.</p>
<p>I&#39;ve been using <a href="https://github.com/astral-sh/uv">uv</a> a lot lately, and I&#39;m becoming quite enamoured with its usefulness
as a package manager, efficiency as a pip replacement, and abilities for isolated python executables. One thing that I
haven&#39;t used much yet are the special <code># /// script</code> tags in a python script.</p>
<p>When I first read about this functionality, I was pretty skeptical. I&#39;m not particularly keen on embedding syntax into
comments. However, this seemed like the perfect application. So, updated my script to include the deps in the script
header like so:</p>
<div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span># /// script</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span># dependencies = [&#34;ipython&#34;, &#34;httpx&#34;, &#34;loguru&#34;]</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span># ///</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span>import</span><span> </span><span>httpx</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span>import</span><span> </span><span>IPython</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span>from</span><span> </span><span>loguru</span><span> </span><span>import</span> <span>logger</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span>...</span>
</span></code></pre></div>
<p>With this added, now I can run the script really easily with <code>uv</code>:</p>

<p>Great! Now, <code>uv</code> will create an isolated virtual environment for the script, download the dependencies and install them,
and then run my script in the context of that venv! I don&#39;t have to manage the virtual environment myself nor worry
about cluttering my system python with packages that I will invariably forget to remove later.</p>
<p>One nice thing about a regular Python script, though, is that you can make it executable with a shebang line:</p>
<div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span>#!/usr/bin/env python</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span>...</span>
</span></code></pre></div>
<p>Now, if I make the script executable (<code>chmod +x jam_users.py</code>), I can invoke it directly as an executable script!
However, this won&#39;t take advantage of the <code>uv</code> script header because Python itself will just ignore the comment.</p>
<p>So, I did some digging and found out that you can actually embed the invocation of the uv command right in the shebang
line like so:</p>
<div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span>#!/usr/bin/env -S uv run --script</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span># /// script</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span># dependencies = [&#34;ipython&#34;, &#34;httpx&#34;, &#34;loguru&#34;]</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span># ///</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span>import</span><span> </span><span>httpx</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span>import</span><span> </span><span>IPython</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span>from</span><span> </span><span>loguru</span><span> </span><span>import</span> <span>logger</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span>...</span>
</span></code></pre></div>
<p>This works because the <code>-S</code> flag tells the system to split everything after it into separate arguments before passing it
to the system&#39;s <code>env</code>.</p>
<p>Now (after <code>chmod +x jam_users.py</code>, of course), I can execute my script directly:</p>

<p>That&#39;s it! What&#39;s even better is that I can run this script on any (Unix) system that has <code>uv</code> installed without needing
to do ANY dependency or virtual environment management.</p>
<p>Now, this script itself is really trivial and not much more than a toy example. However, in my past I have written
rather complex scripts that I needed to hand off to other users to run. Of course, this always came with a long
explanation of how to <em>prepare</em> their system just to run the script. This approach solves that problem instantly and
painlessly (as long as they have <code>uv</code> installed).</p>
<p>Take it for a spin, and let me know your thoughts.</p>
<p>Thanks for reading!</p>







  
  




  



  

  

  

      
    </article>
  </div>

          

        </div>
        
      </main>
      
        
      
    </div></div>
  </body>
</html>
