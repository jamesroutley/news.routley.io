<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://planetscale.com/blog/introducing-planetscale-portals-read-only-regions">Original</a>
    <h1>PlanetScale Portals: Read-only regions</h1>
    
    <div id="readability-page-1" class="page"><div><div><p>If you deploy your applications in regions around the globe and need to keep database read latency low, you will want to physically have a database nearby. With PlanetScale Portals, you can now create read-only regions to support your globally distributed applications and better serve your users worldwide.</p><h2 id="put-your-data-where-your-users-and-applications-are"><a href="#put-your-data-where-your-users-and-applications-are">Put your data where your users and applications are<span aria-label="Permalink to this section">#</span></a></h2><p>Portals allow you to read data from regions closest to where you globally deploy your applications. Whether your application is deployed near Northern Virginia, Frankfurt, São Paulo, or <a href="https://docs.planetscale.com/concepts/regions#available-regions">any of our other PlanetScale regions</a>, Portals can now provide lower read latency for your applications!</p><p>Today, each database in PlanetScale reads and writes from a single region. But with Portals, you can add as many distributed read-only regions as you want. </p><p>Without PlanetScale, it can be a hassle to set up a globally deployed database on your own. You might have to do capacity planning, deal with complicated pricing structures, and worry about your replication strategy or performance. Instead, with a couple of clicks, allow PlanetScale to operate your additional read-only regions for you.</p><h2 id="an-example-of-the-power-of-portals"><a href="#an-example-of-the-power-of-portals">An example of the power of Portals<span aria-label="Permalink to this section">#</span></a></h2><p>To make this more concrete, let’s look at the read latency between different regions:</p><p>For an application deployed to Frankfurt, talking to a Northern Virginia database can add nearly an extra ~90ms PER query. By adding a read-only region in Frankfurt, we can reduce that to ~3ms per query. (Data based on <code>select * from books limit 10</code>.) </p><h2 id="connecting-to-your-new-read-only-regions"><a href="#connecting-to-your-new-read-only-regions">Connecting to your new read-only regions<span aria-label="Permalink to this section">#</span></a></h2><p>You connect to your new read-only regions with a connection string, just like connecting to any other PlanetScale database branch or other MySQL databases. This connection string is specific to both your read-only region and production branch. </p><p>Let’s break down how this might look like in a Ruby on Rails application deployed in both São Paolo and Frankfurt.</p><h3>Code example</h3><blockquote><p>Note: While the following example uses Ruby on Rails, depending on your application framework and how you deploy your application, there are often similar solutions for other technology stacks. For example, read the <a href="https://fly.io/docs/app-guides/planetscale/">Fly.io and PlanetScale guide</a> on using Fly&#39;s Global Application Platform alongside PlanetScale&#39;s read-only regions to deploy database regions close to your applications.  </p></blockquote><p>In a Rails application, you can <a href="https://guides.rubyonrails.org/active_record_multiple_databases.html">set up a connection to your read-only region</a>. </p><p>First, modify your <code>database.yml</code> to include both a primary and read-only region connection.</p><pre></pre><p>This will allow you to send queries to your read-only region or take advantage of Rails <a href="https://guides.rubyonrails.org/active_record_multiple_databases.html#activating-automatic-role-switching">&#34;automatic role switching&#34;</a> to route queries for you.</p><pre></pre><p>You can set up your production application to connect to your nearest PlanetScale region for reads. This will result in your app having low-latency reads.</p><p>In this example, we have our connection details stored in <a href="https://edgeguides.rubyonrails.org/security.html#custom-credentials">Rails credentials</a>.</p><pre></pre><p>Once this is in place, we can now have our globally deployed app read data from our globally deployed database. This will result in much faster <code>GET</code> requests for anyone in that region. Any writes will still go to the primary.</p><h4>Automatic role switching and reading your own writes</h4><p>We can take this one step further by having all our read queries hit the read-only region without specifying it in our code. We can also tell Rails to read from our primary if the user recently wrote to the database. This protects our users from ever reading stale data due to replication lag.</p><p>To do this, we need to set reading/writing roles for our models:</p><pre></pre><p>Then we can enable <a href="https://guides.rubyonrails.org/active_record_multiple_databases.html#activating-automatic-role-switching">automatic role switching</a> by adding the following to our production config.</p><pre></pre><p>This tells Rails to send all reads to our read-only region and writes to our primary. After each write, it will set a cookie that will send all reads to the primary for 2 seconds, allowing users to read their own writes.</p><p><em>(Also, thank you to PlanetScale software engineer, Mike Coutermarsh, for help with the Ruby on Rails code in this section.)</em></p><h2 id="pricing"><a href="#pricing">Pricing<span aria-label="Permalink to this section">#</span></a></h2><p>Any database on a <a href="https://planetscale.com/pricing">Scaler, Teams, or Enterprise plan</a> can create read-only database regions. The pricing for Portals is based on <strong>storage costs</strong> and <strong>row reads</strong>.</p><h3>Storage costs</h3><p>Your storage costs will increase linearly with the number of read-only regions you purchase. For example, if your production branch is 10GB, each read-only region added will increase your total storage cost by 10GB. Portals’ storage costs are prorated by month. If you added a read-only region to your 10GB branch on the 15th, you’ll get billed for 5GB of usage.</p><p>Adding new read-only regions will always be billed as standalone storage and will not count toward your included storage.</p><h3>Row reads</h3><p>Queries issued to your read-only region will contribute to your total billable row reads per month. To make it easier to track the cost, your invoice details will show a new line for rows read from any read-only region.</p><h2 id="try-it-out-today"><a href="#try-it-out-today">Try it out today<span aria-label="Permalink to this section">#</span></a></h2><p>PlanetScale Portals is available in beta today. You can create a new read-only region in any PlanetScale database on a Scaler, Teams, or Enterprise plan.</p><p><a href="https://auth.planetscale.com/sign-in">Sign up or log into your PlanetScale account</a> and go to your database’s production branch page to add a region. Read more in the <a href="https://docs.planetscale.com/concepts/read-only-regions">Portals docs</a>. </p><p>If you have feedback, tweet at us <a href="https://twitter.com/planetscaledata">@planetscaledata</a> or post in our <a href="https://github.com/planetscale/discussion/discussions">GitHub Discussion group</a>.</p></div></div></div>
  </body>
</html>
