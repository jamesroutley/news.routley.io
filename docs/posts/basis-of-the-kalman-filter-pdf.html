<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/tpn/pdfs/blob/master/Understanding%20the%20Basis%20of%20the%20Kalman%20Filter%20Via%20a%20Simple%20and%20Intuitive%20Derivation%20%282012%29.pdf">Original</a>
    <h1>Basis of the Kalman Filter [pdf]</h1>
    
    <div id="readability-page-1" class="page"><div><p><i><a href="https://blog.jacobvosmaer.nl/">Jacob Vosmaer&#39;s blog</a></i></p>

<p>2025-02-11</p>

<p>I have figured out where the sample end point is stored in Dynacord ADS audio files.</p>

<h2>Previously</h2>

<p><img src="https://blog.jacobvosmaer.nl/0039-ads-lengths/assets/brochure.png" alt="Snippet from a 1989 Dynacord brochure"/>
<i>Source: <a href="https://www.deepsonic.ch/">deep!sonic</a></i></p>

<p>The <a href="https://www.muzines.co.uk/articles/dynacord-ads-sampler/5752">Dynacord ADS</a> was a <a href="https://en.wikipedia.org/wiki/Sampler_(musical_instrument)">sampler</a> from 1989. I&#39;ve come across a collection of floppy disk images for this machine that contain audio recordings and I&#39;ve been reverse-engineering the <a href="https://blog.jacobvosmaer.nl/0032-adsimg/">filesystem</a> and <a href="https://blog.jacobvosmaer.nl/0035-music-updates/">file format</a> to extract the audio. This is made more challenging by the fact that I don&#39;t have access to the original machine. The tools I have been writing for this are on <a href="https://github.com/jacobvosmaer/adsimg">GitHub</a>.</p>

<h2>How long are the audio files?</h2>

<p>The floppies use a sector size of 512 bytes. As I wrote in my <a href="https://blog.jacobvosmaer.nl/0032-adsimg/">first post</a>, each file stored in the mystery filesystem of the ADS has a length that is a multiple of 512 bytes. I couldn&#39;t quite tell where the audio ended in each file so I truncated it just before the last sector.</p>

<p>This never felt right to me. Samplers typically set the sample length as a number of samples. This machine uses 16 bit samples so 512 bytes contain 32 samples, so if my initial solution was right each audio recording had a length that was a multiple of 32 samples. That seems unlikely.</p>

<p>Eventually I started noticing that a lot of the audio files that my tool was extracting did not end on a zero crossing. Combined with the knowledge that each audio file has a parameter which indicates the length expressed in samples I started looking again at the header data. This length has to be stored somewhere.</p>

<p>After staring at hexdumps for a while again, I figured out that the length in samples is stored as a 24-bit number in the audio file header. The 0-indexed offsets of the 3 bytes that make up the 24 bits are 20 (MSB), 18 and 19 (LSB). The code below calculates the length in 16-bit samples and then multiplies the result by 2 to get the size in bytes.</p>

<pre><code>
      s-&gt;len = 2 * (((int)chunkstart[20] &lt;&lt; 16) + ((int)chunkstart[18] &lt;&lt; 8) +
                    ((int)chunkstart[19] &lt;&lt; 0));
</code></pre>

<p>This means that my original audio extractor was indeed truncating each file.</p>

<p><img src="https://blog.jacobvosmaer.nl/0039-ads-lengths/assets/audio-data.png" alt="Waveform visualization of raw data from audio file"/>
<i>You can see that the audio data in this file ends abruptly after 40909 samples (marked by the yellow dotted line). The first version of my audio extractor would have truncated the audio at 40704 samples (the closest multiple of 512 bytes).</i></p>

<p>Here is the header of that audio file.</p>

<pre><code>
00065600  d3 4c 41 50 45 44 20 47  20 20 3f 3f 1f bf b0 03  |.LAPED G  ??....|
00065610  a1 a9 9f cd 00 03 a1 a9  41 75                    |........Au|
0006561a
</code></pre>

<p>The length bytes are on the second line: <code>9f cd 00</code>. This should be interpreted as <code>0x009fcd</code> which is (... drumroll ...) 40909. Just like we saw in the audio editor!</p>

<p>You can see the code change that added the end point handling <a href="https://github.com/jacobvosmaer/adsimg/commit/d40611277bf8b11ca049c821a0181185c913476b">here</a>.</p>

<h2>What&#39;s next</h2>

<p>I know that these audio files also contain loop points but I haven&#39;t been able to figure out yet where they are stored.  Going by the manual of the related <a href="https://www.deepsonic.ch/deep/docs_manuals/dynacord_add-two_manual.pdf">ADD-two</a> sampler, there are <em>three</em> sample offsets stored in the audio file: &#34;start&#34;, &#34;loop&#34; and &#34;end&#34;. I have just found &#34;end&#34; but where are the other two?</p>

<p>To be continued, I hope.</p>
<p>Tags:  <a href="https://blog.jacobvosmaer.nl/music.html">music</a> <a href="https://blog.jacobvosmaer.nl/dynacord-ads.html">dynacord-ads</a></p>
<p><a href="https://blog.jacobvosmaer.nl/">Back</a></p></div></div>
  </body>
</html>
