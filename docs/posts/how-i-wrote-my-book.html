<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.kevinwmcconnell.com/writing/how-i-wrote-my-book">Original</a>
    <h1>How I Wrote My Book</h1>
    
    <div id="readability-page-1" class="page"><div><p>Earlier this month I released <a target="__blank" href="http://kevinmcconnell.gumroad.com/l/lambda-go-book/launch">a book about AWS Lambda and Go</a>.</p><p>I thoroughly enjoyed working on it, and I learned a lot throughout the process.
If you‚Äôve ever thought about writing a book, I would definitely recommend giving it a shot!</p><p>When I started the project, though, I had a lot of questions about <em>how</em> to put a book together.</p><p>In this post I‚Äôll share how I ended up doing it, and some of the things I learned in the process.</p><p>At the end I‚Äôve also included a link to a repo containing a skeleton book project.
You can use that to get started quickly on a writing project of your own, with all the same settings and customisations that I used.</p><h3>Where to start</h3><p>The biggest questions I had at first were about which tools I should use to write the book.</p><p>There seemed to be several ways to approach it, from lightweight markup languages like Markdown, to dedicated book-writing apps like Scrivener.
Some people prefer to do the whole thing in Word or Pages.</p><p>And once you‚Äôve picked a tool to write with, there are more questions about how to make it do everything your book needs.
You‚Äôll probably want to generate e-book formats like EPUB, build a table of contents and index, add a cover image, and so on.
If it‚Äôs a book about programming you‚Äôll want to include nicely formatted snippets of code, and you might also need diagrams and photos.</p><p>With all the choices it can be hard to decide the best way to get started.</p><h3>Goals</h3><p>The bulk of my working time is spent writing code, and I wanted the book-writing process to feel similar to that workflow.
I also wanted to have some control over how the book looked, but without having to design everything from scratch.</p><p>My goals were that the project should:</p><ul><li><strong>‚Ä¶happen in my usual text editor.</strong>
For me, these days, that‚Äôs Visual Studio Code with a Vim extension.
Writing in the same editor that I use for coding means I can take advantage of all the muscle memory that I‚Äôve built up over the years, and it saves me from having to learn a new application.</li><li><strong>‚Ä¶be easy to track in version control.</strong>
Like most folks, I keep everything in Git repositories.
For this to work well with the book, it essentially means I want to write in a plaintext markup language, rather than using something like Word or Pages, so that I have readable diffs.</li><li><strong>‚Ä¶support all the book elements I needed.</strong>
Books have lots of parts, and some of them can be complicated to format and lay out.
Things like sidebars, footnotes, and tables of contents needed to be easy to do.
If they were hard work, it would end up being a distraction from the work of writing.</li><li><strong>‚Ä¶generate EPUB and PDF versions of the book.</strong>
I wanted an EPUB for reading in things like Apple Books.
But source code examples don‚Äôt always format the best in EPUB, so it‚Äôs important to have a PDF as well, where you have a bit more control over the result.</li><li><strong>‚Ä¶look ‚Äúnice‚Äù.</strong>
This one is quite subjective, but I wanted to have some control over the fonts, spacing, and so on, so that I could make the book look the way I liked.
I‚Äôm certainly no designer, but I find this part of the process enjoyable so I wanted to give it a shot.</li></ul><p>Ultimately this meant finding a markup language to write in, with a toolchain that could handle all the book formatting, and which had some ability to customise the output.</p><h3>Writing in AsciiDoc</h3><p>I initially thought I would write the book in Markdown.
It‚Äôs simple, and I‚Äôm used to using it in lots of other places, so it means not having to learn a new markup language.</p><p>But when writing a book, pretty soon you run into things that Markdown doesn‚Äôt natively know how to do, and so you have to either look for extra tooling to fill in the gaps, or build support for those things yourself.
There are open source projects that address some of this, but I didn‚Äôt see anything that would do everything I needed.</p><p>At the end of the day, Markdown‚Äôs biggest strength ‚Äî simplicity ‚Äî is also its limitation.</p><p>To be honest, building a Markdown-based book processor with support for all the things I‚Äôd need sounded like <em>a really fun project</em> and I considered going that route.
But I had to admit it was also a bit of a distraction from writing the book itself üòàüòá</p><p>The other markup language I looked at was AsciiDoc.
AsciiDoc is more fully-featured than Markdown, and, coupled with the excellent <a target="__blank" href="https://asciidoctor.org">Asciidoctor toolchain</a>, has pretty much everything you need to produce a book. (More on that below.)</p><p>The AsciiDoc format natively knows about all the common styles and elements, including sidebars, section types like chapters and parts, cross references, and so on.
And the Asciidoctor toolchain gives you a lot of control over how the book is assembled ‚Äî you can import files into each other, control chapter numbering, generate an index, and generally do all the work of turning a series of content blocks into a complete book.</p><h3>Setting up a project with Asciidoctor</h3><p>AsciiDoctor has some great documentation.
But even with that, figuring out how to specify the book settings I needed, and how to structure a project around it, was the part that took me longest.</p><p>The file structure of my project ended up looking something like this:</p><pre><div><div><p><span>Gemfile</span></p><p><span>Gemfile.lock</span></p><p><span>main.adoc</span></p><p><span>chapters/</span></p><p><span>  introduction.adoc</span></p><p><span>  getting-started.adoc</span></p><p><span>  another-chapter.adoc</span></p><p><span>  ...</span></p><p><span>images/</span></p><p><span>  cover.svg</span></p><p><span>  ...</span></p><p><span>theme/</span></p><p><span>  custom-theme.yml</span></p><p><span>  ...</span></p></div></div></pre><p>A few notes on this structure:</p><ul><li><p>Asciidoctor is Ruby-based, so I used <a target="__blank" href="https://bundler.io">Bundler</a> to install it.
That‚Äôs where the <code>Gemfile</code> and <code>Gemfile.lock</code> come from.
Using Bundler, rather than installing it globally, means it‚Äôs easy to install and upgrade the dependencies and I don‚Äôt have to worry about multiple book projects trampling on each other‚Äôs versions.</p><p>In addition to Asciidoctor itself, the dependences include <code>asciidoctor-epub3</code> and <code>asciidoctor-pdf</code> to make it easier to generate EPUBs and (wait for it) PDFs, as well as <code>rouge</code> for syntax highlighting.</p></li><li><p><code>main.adoc</code> is the starting point for the book.
It has the document metadata (title, author and so on) and the main directives used to set up the format of the book.
It also has <code>include</code> statements that pull in the rest of the book content from the files in the <code>chapters</code> folder.</p></li><li><p>The <code>images</code> folder has the book‚Äôs cover image, as well as the images used throughout the rest of the book, like illustrations.</p></li><li><p>And <code>theme</code> has my custom theme files.
There‚Äôs a YAML file with the theme settings, as well as additional assets like fonts.</p></li></ul><p>The end result isn‚Äôt that complicated, but there are a few things that can trip you up.</p><p>For example, you‚Äôll need to define some settings in the <em>document header</em> at the start of your main document.
This document header can‚Äôt contain blank lines, because the first blank line is what marks the end of the header.
If you forget that (as I did a couple of times) it‚Äôs easy to do a bit of well-meaning tidying that ends up breaking your book build in a confusing way.</p><p>Similarly, when including one file into another, the toolchain injects the content without adding any separating line breaks.
This means it‚Äôs easy to accidentally smoosh together the end of one file with the start of another, in a way that breaks its syntax.
A simple solution is to leave a blank line between each include statement.
Which is easy to do, but, again, also easy to forget.</p><p>The other thing that took a while was learning which directives to use to achieve a particular result.</p><p>For example, you might want to have numbered chapters throughout the book, but also a few non-numbered chapters at the start, like an introduction or dedication.
I expected the way to do that would be through some sort of ‚Äúno numbering‚Äù attribute I would attach to each of those initial chapters.</p><p>But it turns out the way to do it is to use directives to turn the numbering on and off.
So you can turn numbering off, <code>include</code> your initial chapters, then turning numbering back on and <code>include</code> the rest.
It works great, it just wasn‚Äôt what I was expecting.</p><h3>Writing one sentence per line</h3><p>This is the one non-technical tip, but I found it really helpful.</p><p>Since markup languages like AsciiDoc don‚Äôt care where you put your line breaks, you‚Äôre free to put them wherever you want.
What I‚Äôve started doing, and would recommend, is writing each sentence as its own line, with a line break between each.</p><p>In other words, you lay out your text like this:</p><pre><div><div><p><span>This is the first sentence in the paragraph.</span></p><p><span>This is the next.</span></p><p><span>And this is the last.</span></p><p><span>And now here we go with another paragraph...</span></p></div></div></pre><p>By writing each sentence as its own line, you get a few nice benefits.
For one thing, commits and PRs tend to be easier to read.</p><p>If you wrap your text on sentence boundaries, then only the sentences you actually change will be part of the diff.
Whereas, if you wrap your text in some other way, you‚Äôll often find that edits make neighbouring sentences move around.
When your diffs include those neighbouring sentences, it makes the content changes harder to see.</p><p>Writing one sentence per line can also make some editing a bit quicker.
I often found myself rewriting sentences after reading back what I‚Äôd written, and replacing a line is a nice quick operation.
(I use Vim mode, so I can just hit <code>cc</code> on a line and then type its replacement.)</p><p>Lastly, I found it helpful to be able to see at a glance how long the sentences were.
I have a tendency to write overly long sentences, and then when editing I have to chop them up to make them more readable.
Having one sentence on each line means that long sentences are a bit easier to spot, so I can catch myself when I‚Äôm getting too long-winded üò¥</p><h3>Using a Makefile (or similar) to automate the build</h3><p>I found myself building the book files quite often while working on it.
Just like with a software project, you‚Äôll find yourself in a feedback loop where you make changes for a while and then want to build the project to see the results.</p><p>So, as with a software project, building it should be a single command so that it‚Äôs quick and easy to do.</p><p>I used a <code>Makefile</code> to build the EPUB &amp; PDF files, so I could just type <code>make</code> to see the changes.
But of course you could use Rake, or a shell script, or whatever your preferred tool is.</p><h3>Editor plugins and settings</h3><p>I used Visual Studio Code to work on the book (having given up the Vim Configuration Fight a couple of years ago), and I found a few plugins and settings that were helpful:</p><ul><li><p>The <a target="__blank" href="https://marketplace.visualstudio.com/items?itemName=asciidoctor.asciidoctor-vscode">AsciiDoc</a> plugin adds syntax highlighting, and a live preview (although I never really used the preview).</p></li><li><p><a target="__blank" href="https://marketplace.visualstudio.com/items?itemName=asciidoctor.asciidoctor-vscode">Spell Right</a> worked quite well for spell checking while I was writing.
Adding a workspace dictionary file is also a good way to add terms that come up in the book that you might not always want in your global dictionary.</p></li><li><p>I often used <a target="__blank" href="https://code.visualstudio.com/docs/getstarted/tips-and-tricks#_zen-mode">Zen mode</a> while writing, to minimise distractions.</p></li><li><p>I also discovered I enjoyed writing in a large, proportional font, rather than the small fixed width font I used for writing code (although I‚Äôm not sure why).
I also wanted long lines of text to wrap while I was writing them.
So I made these changes just for <code>.adoc</code> files in my workspace settings:</p><pre><div><p>json</p><div><p><span>&#34;[asciidoc]&#34;</span><span>:</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>&#34;editor.fontSize&#34;</span><span>:</span><span> </span><span>18</span><span>,</span><span></span></p><p><span>  </span><span>&#34;editor.fontFamily&#34;</span><span>:</span><span> </span><span>&#34;Avenir Next&#34;</span><span>,</span><span></span></p><p><span>  </span><span>&#34;editor.wordWrap&#34;</span><span>:</span><span> </span><span>&#34;on&#34;</span><span></span></p><p><span></span><span>}</span></p></div></div></pre></li></ul><h3>Creating a custom theme</h3><p>The easiest way to customise the look of the book is to create a custom Asciidoctor theme which extends the <code>default</code> theme.
That allows you to change specific settings, but fall back to the defaults everywhere else.
Asciidoctor‚Äôs default theme is already quite nice, so there wasn‚Äôt a lot that I needed to change.</p><p>I used a custom theme primarily to set fonts, and to adjust spacing around some elements (like giving the chapter headings a lot more empty space, and increasing the line height for readability).</p><p>It‚Äôs easy to take TTF fonts from something like Google Fonts, and use them in your custom theme.
However there are a couple of things to bear in mind when doing so.</p><p>You‚Äôll need to make sure any fonts you use contain all the required glyphs.
One common missing one is the narrow space glyph that is used either side of a dash; if your font doesn‚Äôt have this, you‚Äôll get ugly missing glyph markers where the spaces should be.</p><p>You can solve this by editing the font yourself and creating the missing glyphs; or just try using another font that already contains them.</p><p>The second thing I‚Äôd suggest when using custom fonts is to try them out early on in your project.
You‚Äôre going to spend a lot of time looking at the book while you work on it, and this is a good chance for you to see how well the font works for you over time.</p><p>I initially used <a target="__blank" href="https://fonts.google.com/specimen/Racing+Sans+One#standard-styles">Racing Sans One</a> for my headings, because I thought it looked a bit retro and fun.
But after a few days I really tired of seeing at it, and I figured that anyone reading the book would probably feel the same way.</p><p>Whenever you put a book out into the world, you‚Äôre essentially asking your readers to spend hours looking at this thing you‚Äôve made.
So it seems only decent to do whatever you can to make that experience as pleasant as possible.
A lot of that comes down the writing itself, of course, but I think the aesthetics also play a big part.</p><h3>Syntax highlighting</h3><p>Asciidoctor supports a few different syntax highlighters.
I used <a target="__blank" href="https://github.com/rouge-ruby/rouge">Rouge</a>, which worked pretty well.</p><p>If you want to customise the theme, you can define the colours in a Ruby class, which you then import and select when building the book.
If you just want to tweak an existing theme a bit you can copy its class from the Rouge source and make your changes to that.
That‚Äôs what I ended up doing with <a target="__blank" href="https://github.com/kevinmcconnell/book-skeleton/blob/main/theme/custom-highlight.rb">mine</a>.</p><p>I opted to use a dark theme for the code snippets in the PDF version of the book.
Since most people I know use a dark theme when writing code (myself included), it seemed like a good idea to have a similar look in the book.</p><p>However a dark theme doesn‚Äôt work well for the EPUB version.
With EPUB you don‚Äôt have very much control over the colours on the page, since the reader app will respect each user‚Äôs preferences (just as it should).
As a result of this, complicated themes tend to render differently, or not at all, since many of the colours in the theme will be ignored.</p><p>For the EPUB I had much better luck with a simple, light theme (I went with the <code>github</code> theme).
So I ended up setting that light theme in the book settings, but overriding it with the dark theme when building the PDF.</p><p>One handy feature when including code samples in the book is the ability to mark particular lines of interest so they stand out from the others.
(It‚Äôs somewhat confusingly named: ‚Äúhighlight‚Äù in this sense means emphasising specific lines; as opposed to ‚Äúsyntax highlighting‚Äù, adding colours to code elements according to their types).</p><p>You can highlight lines by adding a <code>highlight</code> attribute on the source block.
For example, to highlight the 4th line in this snippet of TypeScript code, you could add a <code>highlight=4</code>:</p><pre><div><p>asciidoc</p><div><p><span>[source,typescript,highlight=4]</span></p><p><span>----</span></p><p><span>const api = new apigw.HttpApi(this, &#39;API&#39;, {</span></p><p><span>        corsPreflight: {</span></p><p><span>                allowOrigins: [&#39;https://example.com&#39;],</span></p><p><span>                allowMethods: [apigw.CorsHttpMethod.ANY],</span></p><p><span>        },</span></p><p><span>});</span></p><p><span>----</span></p></div></div></pre><p>By default, highlighted lines have a yellow background.
That colour doesn‚Äôt come from your syntax highlighting theme, but rather from Asciidoctor itself.
If you want to change the highlighted background colour you can specify it in your Asciidoctor custom theme:</p><pre><div><p>yaml</p><div><p><span>code</span><span>:</span><span></span></p><p><span>  </span><span>highlight-background-color</span><span>:</span><span> </span></p></div></div></pre><p>With the theme I used, the end result looks like this:</p><p><img src="https://www.kevinwmcconnell.com/images/how-i-wrote-my-book/highlight.png" alt="Source code with a highlighted line"/></p><h3>Summary</h3><p>Overall, Asciidoctor turned out to be a straightforward way of putting together a book, and I‚Äôm quite happy with the end result.
I‚Äôm planning to use the same setup for my next project.</p><p>I did go through a lot of tweaking and experimenting at the start of the project to figure out how to make it do what I wanted.
But once I got over that hump it‚Äôs been quite easy to use, and generally stayed out of my way while I focused on creating the content.</p><p>I‚Äôve put together a small repo with all the files you‚Äôd need to start a book project in this way, including the theme and settings that I used for my book.
If you‚Äôd like to get started on a writing project of your own, feel free to take that repo as a starting point, or just pick out the parts you find useful.</p><p>You can get the repo at <a target="__blank" href="https://github.com/kevinmcconnell/book-skeleton">https://github.com/kevinmcconnell/book-skeleton</a>.</p><p>Lastly, if you found this post interesting, you can <a target="__blank" href="https://twitter.com/kevinmcconnell">follow me on Twitter</a> where I‚Äôll be posting some more on the topic!</p><p>Posted <!-- -->November 30, 2021<!-- -->. </p></div></div>
  </body>
</html>
