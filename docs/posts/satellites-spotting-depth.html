<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tech.marksblogg.com/depth-anything-v2-maxar-ai-detection.html">Original</a>
    <h1>Satellites Spotting Depth</h1>
    
    <div id="readability-page-1" class="page"><div id="article_text">
            <p><a href="https://depth-anything-v2.github.io/">Depth Anything V2</a> is a depth estimation model that was released last year. It was developed by a team from TikTok and the University of Hong Kong (HKU). Almost ~600K synthetic, labelled images and over 62M real, unlabelled images were used in its training.</p>
<p>In this post, I&#39;ll run Depth Anything V2&#39;s largest model against Maxar&#39;s satellite imagery 2025 of Bangkok, Thailand.</p>
<div id="my-workstation">
<h2>My Workstation</h2>
<p>I&#39;m using a 5.7 GHz AMD Ryzen 9 9950X CPU. It has 16 cores and 32 threads and 1.2 MB of L1, 16 MB of L2 and 64 MB of L3 cache. It has a liquid cooler attached and is housed in a spacious, full-sized Cooler Master HAF 700 computer case.</p>
<p>The system has 96 GB of DDR5 RAM clocked at 4,800 MT/s and a 5th-generation, Crucial T700 4 TB NVMe M.2 SSD which can read at speeds up to 12,400 MB/s. There is a heatsink on the SSD to help keep its temperature down. This is my system&#39;s C drive.</p>
<p>The system is powered by a 1,200-watt, fully modular Corsair Power Supply and is sat on an ASRock X870E Nova 90 Motherboard.</p>
<p>I&#39;m running Ubuntu 24 LTS via Microsoft&#39;s Ubuntu for Windows on Windows 11 Pro. In case you&#39;re wondering why I don&#39;t run a Linux-based desktop as my primary work environment, I&#39;m still using an Nvidia GTX 1080 GPU which has better driver support on Windows and I use ArcGIS Pro from time to time which only supports Windows natively.</p>
</div>
<div id="installing-prerequisites">
<h2>Installing Prerequisites</h2>
<p>I&#39;m running Esri&#39;s <a href="https://www.esri.com/en-us/arcgis/products/arcgis-pro/overview">ArcGIS Pro 3.5</a>. This version is their latest and was released last week.</p>
<p>I&#39;ll also use Python 3.12.3 in this post.</p>
<div><pre><span></span>$<span> </span>sudo<span> </span>add-apt-repository<span> </span>ppa:deadsnakes/ppa
$<span> </span>sudo<span> </span>apt<span> </span>update
$<span> </span>sudo<span> </span>apt<span> </span>install<span> </span><span>\</span>
<span>    </span>python3-pip<span> </span><span>\</span>
<span>    </span>python3.12-venv
</pre></div>
<p>I&#39;ll clone DepthAnything&#39;s v2 repo.</p>
<div><pre><span></span>$<span> </span>git<span> </span>clone<span> </span>https://github.com/DepthAnything/Depth-Anything-V2<span> </span><span>\</span>
<span>    </span>~/Depth-Anything-V2
</pre></div>
<p>I&#39;ll set up a Python Virtual Environment and install Depth Anything&#39;s dependencies.</p>
<div><pre><span></span>$<span> </span>python3<span> </span>-m<span> </span>venv<span> </span>~/.depth_anything_v2
$<span> </span><span>source</span><span> </span>~/.depth_anything_v2/bin/activate
$<span> </span>python3<span> </span>-m<span> </span>pip<span> </span>install<span> </span><span>\</span>
<span>    </span>-r<span> </span>~/Depth-Anything-V2/requirements.txt
</pre></div>
<p>DepthAnything v2 has three different pre-trained models available. I&#39;ll download their largest 335.3M-parameter model that has a footprint of ~1.3 GB.</p>
<div><pre><span></span>$<span> </span>mkdir<span> </span>-p<span> </span>~/Depth-Anything-V2/checkpoints
$<span> </span><span>cd</span><span> </span>~/Depth-Anything-V2/checkpoints
$<span> </span>wget<span> </span><span>&#39;https://huggingface.co/depth-anything/Depth-Anything-V2-Large/resolve/main/depth_anything_v2_vitl.pth?download=true&#39;</span>
</pre></div>
</div>
<div id="maxar-s-bangkok-satellite-imagery">
<h2>Maxar&#39;s Bangkok Satellite Imagery</h2>
<p>Maxar have an <a href="https://tech.marksblogg.com/maxar-open-data-free-satellite-imagery.html">open data programme</a> that I wrote a post on a few years ago. I later <a href="https://tech.marksblogg.com/geodeep-maxar-ai-detection.html">revisited</a> this feed last month after the earthquake struck Myanmar and Thailand.</p>
<p>I&#39;ll be using two images from this feed in this post. The first image covers part of the Chatuchak district and includes Ratchadaphisek Road which has several tall towers along it.</p>
<p>The image is a GeoTIFF pyramid containing a 17408x17408-pixel JPEG covering an area ~5.2 x 4.2 KM. The image was captured on February 14th by Maxar&#39;s WorldView 3 satellite at a resolution of 38cm.</p>
<div><pre><span></span>$<span> </span>wget<span> </span>https://maxar-opendata.s3.amazonaws.com/events/Earthquake-Myanmar-March-2025/ard/47/122022102203/2025-02-14/10400100A4C67F00-visual.tif
</pre></div>
<p>This is the image below in relation to its surrounding area in Bangkok.</p>
<p><a href="https://tech.marksblogg.com/theme/images/depth_anything_v2/ArcGISPro_WYS3jqxGbv.jpg">
<img alt="DepthAnything v2 Bangkok" src="https://tech.marksblogg.com/theme/images/depth_anything_v2/ArcGISPro_WYS3jqxGbv.jpg"/>
</a></p><p>Below I&#39;ve zoomed into Ratchadaphisek Road where you can see the tall towers.</p>
<p><a href="https://tech.marksblogg.com/theme/images/depth_anything_v2/ArcGISPro_o1AHVpVHzm.jpg">
<img alt="DepthAnything v2 Bangkok" src="https://tech.marksblogg.com/theme/images/depth_anything_v2/ArcGISPro_o1AHVpVHzm.jpg"/>
</a></p><p>This is the metadata for the above image.</p>
<div><pre><span></span><span>{</span>
<span>  </span><span>&#34;geometry&#34;</span><span>:</span><span> </span><span>{</span>
<span>    </span><span>&#34;coordinates&#34;</span><span>:</span><span> </span><span>[</span>
<span>      </span><span>[</span>
<span>        </span><span>[</span>
<span>          </span><span>100.574350016387555</span><span>,</span>
<span>          </span><span>13.833249903918164</span>
<span>        </span><span>],</span>
<span>        </span><span>[</span>
<span>          </span><span>100.525209298594646</span><span>,</span>
<span>          </span><span>13.833560533960037</span>
<span>        </span><span>],</span>
<span>        </span><span>[</span>
<span>          </span><span>100.525429970258031</span><span>,</span>
<span>          </span><span>13.86737334</span>
<span>        </span><span>],</span>
<span>        </span><span>[</span>
<span>          </span><span>100.574579936582708</span><span>,</span>
<span>          </span><span>13.86737334</span>
<span>        </span><span>],</span>
<span>        </span><span>[</span>
<span>          </span><span>100.574350016387555</span><span>,</span>
<span>          </span><span>13.833249903918164</span>
<span>        </span><span>]</span>
<span>      </span><span>]</span>
<span>    </span><span>],</span>
<span>    </span><span>&#34;type&#34;</span><span>:</span><span> </span><span>&#34;Polygon&#34;</span>
<span>  </span><span>},</span>
<span>  </span><span>&#34;properties&#34;</span><span>:</span><span> </span><span>{</span>
<span>    </span><span>&#34;ard_metadata_version&#34;</span><span>:</span><span> </span><span>&#34;0.0.1&#34;</span><span>,</span>
<span>    </span><span>&#34;catalog_id&#34;</span><span>:</span><span> </span><span>&#34;10400100A4C67F00&#34;</span><span>,</span>
<span>    </span><span>&#34;data-mask&#34;</span><span>:</span><span> </span><span>&#34;https://maxar-opendata.s3.amazonaws.com/events/Earthquake-Myanmar-March-2025/ard/47/122022102203/2025-02-14/10400100A4C67F00-data-mask.gpkg&#34;</span><span>,</span>
<span>    </span><span>&#34;datetime&#34;</span><span>:</span><span> </span><span>&#34;2025-02-14T04:02:15Z&#34;</span><span>,</span>
<span>    </span><span>&#34;grid:code&#34;</span><span>:</span><span> </span><span>&#34;MXRA-Z47-122022102203&#34;</span><span>,</span>
<span>    </span><span>&#34;gsd&#34;</span><span>:</span><span> </span><span>0.38</span><span>,</span>
<span>    </span><span>&#34;ms_analytic&#34;</span><span>:</span><span> </span><span>&#34;https://maxar-opendata.s3.amazonaws.com/events/Earthquake-Myanmar-March-2025/ard/47/122022102203/2025-02-14/10400100A4C67F00-ms.tif&#34;</span><span>,</span>
<span>    </span><span>&#34;pan_analytic&#34;</span><span>:</span><span> </span><span>&#34;https://maxar-opendata.s3.amazonaws.com/events/Earthquake-Myanmar-March-2025/ard/47/122022102203/2025-02-14/10400100A4C67F00-pan.tif&#34;</span><span>,</span>
<span>    </span><span>&#34;platform&#34;</span><span>:</span><span> </span><span>&#34;WV03&#34;</span><span>,</span>
<span>    </span><span>&#34;proj:bbox&#34;</span><span>:</span><span> </span><span>&#34;664843.75,1529843.75,670156.25,1533619.8386004784&#34;</span><span>,</span>
<span>    </span><span>&#34;proj:code&#34;</span><span>:</span><span> </span><span>&#34;EPSG:32647&#34;</span><span>,</span>
<span>    </span><span>&#34;proj:geometry&#34;</span><span>:</span><span> </span><span>{</span>
<span>      </span><span>&#34;coordinates&#34;</span><span>:</span><span> </span><span>[</span>
<span>        </span><span>[</span>
<span>          </span><span>[</span>
<span>            </span><span>670156.25</span><span>,</span>
<span>            </span><span>1529843.75</span>
<span>          </span><span>],</span>
<span>          </span><span>[</span>
<span>            </span><span>664843.75</span><span>,</span>
<span>            </span><span>1529843.75</span>
<span>          </span><span>],</span>
<span>          </span><span>[</span>
<span>            </span><span>664843.75</span><span>,</span>
<span>            </span><span>1533585.6070091636</span>
<span>          </span><span>],</span>
<span>          </span><span>[</span>
<span>            </span><span>670156.25</span><span>,</span>
<span>            </span><span>1533619.8386004784</span>
<span>          </span><span>],</span>
<span>          </span><span>[</span>
<span>            </span><span>670156.25</span><span>,</span>
<span>            </span><span>1529843.75</span>
<span>          </span><span>]</span>
<span>        </span><span>]</span>
<span>      </span><span>],</span>
<span>      </span><span>&#34;type&#34;</span><span>:</span><span> </span><span>&#34;Polygon&#34;</span>
<span>    </span><span>},</span>
<span>    </span><span>&#34;quadkey&#34;</span><span>:</span><span> </span><span>&#34;122022102203&#34;</span><span>,</span>
<span>    </span><span>&#34;tile:clouds_area&#34;</span><span>:</span><span> </span><span>0.0</span><span>,</span>
<span>    </span><span>&#34;tile:clouds_percent&#34;</span><span>:</span><span> </span><span>0</span><span>,</span>
<span>    </span><span>&#34;tile:data_area&#34;</span><span>:</span><span> </span><span>19.9</span><span>,</span>
<span>    </span><span>&#34;utm_zone&#34;</span><span>:</span><span> </span><span>47</span><span>,</span>
<span>    </span><span>&#34;view:azimuth&#34;</span><span>:</span><span> </span><span>243.9</span><span>,</span>
<span>    </span><span>&#34;view:incidence_angle&#34;</span><span>:</span><span> </span><span>59.9</span><span>,</span>
<span>    </span><span>&#34;view:off_nadir&#34;</span><span>:</span><span> </span><span>27.2</span><span>,</span>
<span>    </span><span>&#34;view:sun_azimuth&#34;</span><span>:</span><span> </span><span>139.3</span><span>,</span>
<span>    </span><span>&#34;view:sun_elevation&#34;</span><span>:</span><span> </span><span>55.3</span><span>,</span>
<span>    </span><span>&#34;visual&#34;</span><span>:</span><span> </span><span>&#34;https://maxar-opendata.s3.amazonaws.com/events/Earthquake-Myanmar-March-2025/ard/47/122022102203/2025-02-14/10400100A4C67F00-visual.tif&#34;</span>
<span>  </span><span>},</span>
<span>  </span><span>&#34;type&#34;</span><span>:</span><span> </span><span>&#34;Feature&#34;</span>
<span>}</span>
</pre></div>
<p>The second image has been cropped out of Maxar&#39;s original source imagery and is focused on the intersection between Rattanathibet Road and Tiwanon Road in the  Bang Kraso distinct of Northern Bangkok.</p>
<p><a href="https://tech.marksblogg.com/theme/images/depth_anything_v2/Photos_epK2mkc7uS.jpg">
<img alt="DepthAnything v2 Bangkok" src="https://tech.marksblogg.com/theme/images/depth_anything_v2/Photos_epK2mkc7uS.jpg"/>
</a></p><p>The above image is much smaller that the other one for reasons I&#39;ll get to later on in this post. It&#39;s a 3829x1936-pixel JPEG screen shot captured at 100% from its source imagery.</p>
</div>
<div id="first-inference-attempt">
<h2>First Inference Attempt</h2>
<p>I&#39;ll create an output folder and run the larger image through DepthAnything&#39;s largest model.</p>
<div><pre><span></span>$<span> </span><span>cd</span><span> </span>~/Depth-Anything-V2/
$<span> </span>mkdir<span> </span>-p<span> </span>out

$<span> </span>python<span> </span>run.py<span> </span><span>\</span>
<span>      </span>--encoder<span> </span>vitl<span> </span><span>\</span>
<span>      </span>--pred-only<span> </span><span>\</span>
<span>      </span>--grayscale<span> </span><span>\</span>
<span>      </span>--img-path<span> </span>10400100A4C67F00-visual.tif<span> </span><span>\</span>
<span>      </span>--outdir<span> </span>out/
</pre></div>
<p>The resulting depth map didn&#39;t highlight any of the buildings in the image.</p>
<p><a href="https://tech.marksblogg.com/theme/images/depth_anything_v2/Photos_RNUal3HK4h.png">
<img alt="DepthAnything v2 Bangkok" src="https://tech.marksblogg.com/theme/images/depth_anything_v2/Photos_RNUal3HK4h.png"/>
</a></p><p>This is likely due to part of the source image is completely black. This threw off the model which treated the empty area as the peak of the image.</p>
</div>
<div id="second-inference-attempt">
<h2>Second Inference Attempt</h2>
<p>I&#39;ll run the smaller image on through DepthAnything&#39;s largest model.</p>
<div><pre><span></span>$<span> </span>python<span> </span>run.py<span> </span><span>\</span>
<span>      </span>--encoder<span> </span>vitl<span> </span><span>\</span>
<span>      </span>--pred-only<span> </span><span>\</span>
<span>      </span>--grayscale<span> </span><span>\</span>
<span>      </span>--img-path<span> </span>Photos_epK2mkc7uS.jpg<span> </span><span>\</span>
<span>      </span>--outdir<span> </span>out/
</pre></div>
<p>This result was much better. The location data is missing from the screen shot so I georefernced the depth map back into position.</p>
<p><a href="https://tech.marksblogg.com/theme/images/depth_anything_v2/ArcGISPro_weEPXgL0Nd.png">
<img alt="DepthAnything v2 Bangkok" src="https://tech.marksblogg.com/theme/images/depth_anything_v2/ArcGISPro_weEPXgL0Nd.png"/>
</a></p><p>Below is the depth map in relation to the original source image from Maxar.</p>
<p><a href="https://tech.marksblogg.com/theme/images/depth_anything_v2/aMPP3tcoqd.jpg">
<img alt="DepthAnything v2 Bangkok" src="https://tech.marksblogg.com/theme/images/depth_anything_v2/aMPP3tcoqd.jpg"/>
</a></p><p>The depth information itself is relative so work would be needed to figure out the height of the tallest building in the image and adjust the scale accordingly.</p>
<p>It&#39;s conceivable to put together a workflow where images are tiled and Overture&#39;s building dataset could be sourced to find the tallest building within any one tile. Then the height scale could be set based on that.</p>
</div>
<div id="areal-imagery">
<h2>Areal Imagery</h2>
<p>The model also does a good job with images taken at height, such as from tall buildings. Below is an example taken of Tallinn&#39;s Old Town from the top of the Viru Hotel.</p>
<p><a href="https://tech.marksblogg.com/theme/images/depth_anything_v2/GpJNKFMWMAEi_T_.jpg">
<img alt="DepthAnything v2 Bangkok" src="https://tech.marksblogg.com/theme/images/depth_anything_v2/GpJNKFMWMAEi_T_.jpg"/>
</a>
<a href="https://tech.marksblogg.com/theme/images/depth_anything_v2/tallinn_depth.jpg">
<img alt="DepthAnything v2 Bangkok" src="https://tech.marksblogg.com/theme/images/depth_anything_v2/tallinn_depth.jpg"/>
</a>
</p></div>

        </div><p>
            Thank you for taking the time to read this post. I offer both consulting and hands-on development services to clients in North America and Europe. If you&#39;d like to discuss how my offerings can help your business please contact me via <a href="https://uk.linkedin.com/in/marklitwintschik/">LinkedIn</a>.
        </p></div>
  </body>
</html>
