<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://torstencurdt.com/tech/posts/modulo-of-negative-numbers/">Original</a>
    <h1>Modulo of negative numbers (2011)</h1>
    
    <div id="readability-page-1" class="page"><article>
<section>


<p>The modulo operator returns the remainder of a division. But things get a little more tricky when you throw negative numbers into the mix.
</p>
</section>
<p>The modulo or often referred to as “mod” represents the remainder of a division. In 1801 Gauss published a book covering modular arithmetics. Later a widely accepted mathematical definition was given by <a href="https://en.wikipedia.org/wiki/Donald_Knuth">Donald Knuth</a>
</p><pre><code>mod(a, n) = a - n * floor(a / n)
</code></pre>
<p>Doing an integer division and then multiplying it again means finding the biggest number smaller than <code>a</code> that is dividable by <code>n</code> without a remainder. Subtracting this from <code>a</code> yields the remainder of the division and by that the modulo.
</p><p>But what does the modulu operation do? What can it be used for when coding?
</p><h2>Restricting Bounds</h2>
<p>In programming, the modulo operator (<code>%</code> or sometimes <code>mod</code>) often is used to restrict an index to the bounds of an array or length limited data structure.
</p><pre><code>values = [ 3, 4, 5 ]
index = 5
value_at_index = values[ index % values.length ]
</code></pre>
<p>For the above example this means <code>5 mod 3 = 2</code> following the definition is <code>5 - floor(5/3)*3 = 2</code>. This means that no matter the value <code>index</code> has, the array bounds are met.
</p><p><strong>But is that really the case?</strong>
</p><p>What happens if the dividend or the divisor is signed and holds a negative value?
Turns out the rules of modulo on negative numbers indeed depend on the language you are using.
</p><p>How does modulus work in java?</p><p>While the code looks pretty much the same in most languages, printing the result shows languages in mostly two different camps.
</p><p>Only two languages take a different stance: Dart and in particular Zig, which
<a href="https://github.com/ziglang/zig/issues/217">distinguishes both cases</a> as <code>@rem(a,b)</code> and <code>@mod(a,b)</code> and errors out on a negative divisor.
</p><table>
<thead>
<tr>
<th>Language
</th><th>13 mod 3
</th><th>-13 mod 3
</th><th>13 mod -3
</th><th>-13 mod -3


</th></tr></thead><tbody>
<tr>
<td>C
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>C#
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>C++
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>Elixir
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>Erlang
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>Go
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>Java
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>Javascript
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>Kotlin
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>Nim
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>PHP
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>Rust
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>Scala
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>Swift
</td><td>1
</td><td>-1
</td><td>1
</td><td>-1

</td></tr><tr>
<td>Crystal
</td><td>1
</td><td>2
</td><td>-2
</td><td>-1

</td></tr><tr>
<td>Haskell
</td><td>1
</td><td>2
</td><td>-2
</td><td>-1

</td></tr><tr>
<td>Lua
</td><td>1
</td><td>2
</td><td>-2
</td><td>-1

</td></tr><tr>
<td>Python
</td><td>1
</td><td>2
</td><td>-2
</td><td>-1

</td></tr><tr>
<td>Ruby
</td><td>1
</td><td>2
</td><td>-2
</td><td>-1

</td></tr><tr>
<td>Dart
</td><td>1
</td><td>2
</td><td>1
</td><td>2

</td></tr><tr>
<td>Zig @rem
</td><td>1
</td><td>-1
</td><td>error
</td><td>error

</td></tr><tr>
<td>Zig @mod
</td><td>1
</td><td>2
</td><td>error
</td><td>error


</td></tr></tbody></table>
<p>So if you use the modulo operator to ensure correct bounds for accessing a collection, beware that some languages need a little more diligence. A simple and efficient way is to check the sign.
</p><pre><code>int mod(a, b) {
  c = a % b
  return (c &lt; 0) ? c + b : c
}
</code></pre>
<p>As another option, you could also apply the modulo twice.
</p><pre><code>int mod(a, b) {
  (((a % b) + b) % b)
}
</code></pre>
<h2>Even or Odd</h2>
<p>Another pitfall to watch out for is when testing whether a number is odd or even using the modulo operator. Based on the above findings you should always compare against <code>0</code>.
</p><pre><code>bool is_odd(int n) {
    return n % 2 != 0; // could be 1 or -1
}
</code></pre>
<p>But anyone that has ever looked a layer below C will point out that using the modulo isn’t necessarily the best implementation for <code>is_odd</code> anyway. Multiplication and especially divisions are some of the most expensive instructions on a CPU. If you are dealing with 2-based numbers there is often a faster way.
</p><pre><code>x % 2n == x &amp; (2n - 1) // for n&gt;0
</code></pre>
<p>At least for a positive divisor, the modulo operation can be replaced with a simple bitwise <code>and</code> operation.
</p><pre><code>x % 2 == x &amp; 1
x % 4 == x &amp; 3
x % 8 == x &amp; 7
...
</code></pre>
<p>Which allows for a much faster implementation of <code>is_odd</code>.
</p><pre><code>bool is_odd(int n) {
    return n &amp; 1 != 0;
}
</code></pre>
<h2>In Summary</h2>
<p>The modulo operator can be incredibly useful but developers need also to be aware of the above edge cases and when to use or not use it.
</p><p>For a more detailed discussion see the <a href="https://en.wikipedia.org/wiki/Modulo_operation">wikipedia article</a>.
</p></article><section>
<form action="https://4caixa93mg.execute-api.eu-central-1.amazonaws.com">
<p>
Join the other 1000 subscribers.

</p><p>
Get notified about new articles.</p>

<div>
<p>
<label for="email">Email Address</label>
</p>
<p>
No funny business. You can unsubscribe at any time.</p></div>
<p>
Thanks! Please check your inbox.

</p>
<p>
Sorry, but something went wrong.

</p>
</form>
<p>
<a href="https://torstencurdt.com/tech/feed.xml">Or subscribe to the RSS feed</a>

</p></section></div>
  </body>
</html>
