<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.hezmatt.org/~mpalmer/blog/2020/05/17/private-key-redaction-ur-doin-it-rong.html">Original</a>
    <h1>Private key redaction: Ur doin it rong (2020)</h1>
    
    <div id="readability-page-1" class="page"><div id="body">
			
			<div id="content">

				
				<p>
					Posted: Sun, 17 May 2020
					| <a href="https://www.hezmatt.org/~mpalmer/blog/2020/05/17/private-key-redaction-ur-doin-it-rong.html">permalink</a>
					| <a href="https://www.hezmatt.org/~mpalmer/blog/2020/05/17/private-key-redaction-ur-doin-it-rong.html#comments">
						
							No comments
						
					</a>
				</p>
<p>Because <a href="https://www.hezmatt.org/~mpalmer/blog/2018/12/17/pwnedkeys-who-has-the-keys-to-your-kingdom.html">posting private keys on the Internet is a bad idea</a>, some
people like to “redact” their private keys, so that it looks kinda-sorta like a private key,
but it isn’t actually giving away anything secret.  Unfortunately, due to the way that
private keys are represented, it is easy to “redact” a key in such a way that it
doesn’t <em>actually</em> redact anything at all.  RSA private keys are particularly bad at this,
but the problem can (potentially) apply to other keys as well.</p>

<p>I’ll show you a bit of “Inside Baseball” with key formats, and then demonstrate the practical
implications.  Finally, we’ll go through a practical worked example from an <em>actual</em> not-really-redacted
key I recently stumbled across in my travels.</p>



<p>Here is what a typical private key looks like, when you come across it:</p>

<pre>-----BEGIN RSA PRIVATE KEY-----
MGICAQACEQCxjdTmecltJEz2PLMpS4BXAgMBAAECEDKtuwD17gpagnASq1zQTYEC
CQDVTYVsjjF7IQIJANUYZsIjRsR3AgkAkahDUXL0RSECCB78r2SnsJC9AghaOK3F
sKoELg==
-----END RSA PRIVATE KEY-----
</pre>

<p>Obviously, there’s some hidden meaning in there – computers don’t encrypt
things by shouting “BEGIN RSA PRIVATE KEY!”, after all.  What is between the
<code>BEGIN</code>/<code>END</code> lines above is, in fact, a
<a href="https://en.wikipedia.org/wiki/Base64">base64</a>-encoded
<a href="https://letsencrypt.org/docs/a-warm-welcome-to-asn1-and-der/">DER</a> format
ASN.1 structure representing a <a href="https://tls.mbed.org/kb/cryptography/asn1-key-structures-in-der-and-pem">PKCS#1 private
key</a>.</p>

<p>In simple terms, it’s a list of numbers – very important numbers.  The list
of numbers is, in order:</p>

<ul>
  <li>A version number (0);</li>
  <li>The “public modulus”, commonly referred to as “<code>n</code>”;</li>
  <li>The “public exponent”, or “<code>e</code>” (which is almost always 65,537, for various unimportant reasons);</li>
  <li>The “private exponent”, or “<code>d</code>”;</li>
  <li>The two “private primes”, or “<code>p</code>” and “<code>q</code>”;</li>
  <li>Two exponents, which are known as “<code>dmp1</code>” and “<code>dmq1</code>”; and</li>
  <li>A coefficient, known as “<code>iqmp</code>”.</li>
</ul>



<p>The thing is, only three of those numbers are actually <em>required</em> in a private
key.  The rest, whilst useful to allow the RSA encryption and decryption to be
more efficient, aren’t necessary.  The three absolutely required values are
<code>e</code>, <code>p</code>, and <code>q</code>.</p>

<p>Of the other numbers, most of them are <em>at least</em> about the same size as each
of <code>p</code> and <code>q</code>.  So of the total data in an RSA key, less than a quarter of the
data is required.  Let me show you with the above “toy” key, by breaking it
down piece by piece<sup id="fnref:1"><a href="#fn:1">1</a></sup>:</p>

<ul>
  <li><code>MGI</code> – DER for “this is a sequence”</li>
  <li><code>CAQ</code> – version (0)</li>
  <li><code>CxjdTmecltJEz2PLMpS4BX</code> – <code>n</code></li>
  <li><code>AgMBAA</code> – <code>e</code></li>
  <li><code>ECEDKtuwD17gpagnASq1zQTY</code> – <code>d</code></li>
  <li><code>ECCQDVTYVsjjF7IQ</code> – <code>p</code></li>
  <li><code>IJANUYZsIjRsR3</code> – <code>q</code></li>
  <li><code>AgkAkahDUXL0RS</code> – <code>dmp1</code></li>
  <li><code>ECCB78r2SnsJC9</code> – <code>dmq1</code></li>
  <li><code>AghaOK3FsKoELg==</code> – <code>iqmp</code></li>
</ul>

<p>Remember that in order to reconstruct <em>all</em> of these values, all I need are
<code>e</code>, <code>p</code>, and <code>q</code> – and <code>e</code> is pretty much always 65,537.  So I could “redact”
almost all of this key, and still give all the important, private bits of this
key.  Let me show you:</p>

<pre>-----BEGIN RSA PRIVATE KEY-----
..............................................................EC
CQDVTYVsjjF7IQIJANUYZsIjRsR3....................................
........
-----END RSA PRIVATE KEY-----
</pre>

<p>Now, I doubt that anyone is going to redact a key <em>precisely</em> like
this… but then again, this isn’t a “typical” RSA key.  They usually
look a lot more like this:</p>

<pre>-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEAu6Inch7+mWtKn+leB9uCG3MaJIxRyvC/5KTz2fR+h+GOhqj4
SZJobiVB4FrE5FgC7AnlH6qeRi9MI0s6dt5UWZ5oNIeWSaOOeNO+EJDUkSVf67wj
SNGXlSjGAkPZ0nRJiDjhuPvQmdW53hOaBLk5udxPEQbenpXAzbLJ7wH5ouLQ3nQw
HwpwDNQhF6zRO8WoscpDVThOAM+s4PS7EiK8ZR4hu2toon8Ynadlm95V45wR0VlW
zywgbkZCKa1IMrDCscB6CglQ10M3Xzya3iTzDtQxYMVqhDrA7uBYRxA0y1sER+Rb
yhEh03xz3AWemJVLCQuU06r+FABXJuY/QuAVvQIDAQABAoIBAFqwWVhzWqNUlFEO
PoCVvCEAVRZtK+tmyZj9kU87ORz8DCNR8A+/T/JM17ZUqO2lDGSBs9jGYpGRsr8s
USm69BIM2ljpX95fyzDjRu5C0jsFUYNi/7rmctmJR4s4uENcKV5J/++k5oI0Jw4L
c1ntHNWUgjK8m0UTJIlHbQq0bbAoFEcfdZxd3W+SzRG3jND3gifqKxBG04YDwloy
tu+bPV2jEih6p8tykew5OJwtJ3XsSZnqJMwcvDciVbwYNiJ6pUvGq6Z9kumOavm9
XU26m4cWipuK0URWbHWQA7SjbktqEpxsFrn5bYhJ9qXgLUh/I1+WhB2GEf3hQF5A
pDTN4oECgYEA7Kp6lE7ugFBDC09sKAhoQWrVSiFpZG4Z1gsL9z5YmZU/vZf0Su0n
9J2/k5B1GghvSwkTqpDZLXgNz8eIX0WCsS1xpzOuORSNvS1DWuzyATIG2cExuRiB
jYWIJUeCpa5p2PdlZmBrnD/hJ4oNk4oAVpf+HisfDSN7HBpN+TJfcAUCgYEAyvY7
Y4hQfHIdcfF3A9eeCGazIYbwVyfoGu70S/BZb2NoNEPymqsz7NOfwZQkL4O7R3Wl
Rm0vrWT8T5ykEUgT+2ruZVXYSQCKUOl18acbAy0eZ81wGBljZc9VWBrP1rHviVWd
OVDRZNjz6nd6ZMrJvxRa24TvxZbJMmO1cgSW1FkCgYAoWBd1WM9HiGclcnCZknVT
UYbykCeLO0mkN1Xe2/32kH7BLzox26PIC2wxF5seyPlP7Ugw92hOW/zewsD4nLze
v0R0oFa+3EYdTa4BvgqzMXgBfvGfABJ1saG32SzoWYcpuWLLxPwTMsCLIPmXgRr1
qAtl0SwF7Vp7O/C23mNukQKBgB89DOEB7xloWv3Zo27U9f7nB7UmVsGjY8cZdkJl
6O4LB9PbjXCe3ywZWmJqEbO6e83A3sJbNdZjT65VNq9uP50X1T+FmfeKfL99X2jl
RnQTsrVZWmJrLfBSnBkmb0zlMDAcHEnhFYmHFuvEnfL7f1fIoz9cU6c+0RLPY/L7
n9dpAoGAXih17mcmtnV+Ce+lBWzGWw9P4kVDSIxzGxd8gprrGKLa3Q9VuOrLdt58
++UzNUaBN6VYAe4jgxGfZfh+IaSlMouwOjDgE/qzgY8QsjBubzmABR/KWCYiRqkj
qpWCgo1FC1Gn94gh/+dW2Q8+NjYtXWNqQcjRP4AKTBnPktEvdMA=
-----END RSA PRIVATE KEY-----
</pre>

<p>People typically redact keys by deleting whole lines, and usually replacing them
with <code>[...]</code> and the like.  But only about 345 of those 1588 characters
(excluding the header and footer) are required to construct the entire key.
You can redact about 4/5ths of that giant blob of stuff, and your private parts
(or at least, those of your key) are still left uncomfortably exposed.</p>



<p>Remember how I said that everything in the key other than <code>e</code>, <code>p</code>,
and <code>q</code> could be derived from those three numbers?  Let’s talk about one
of those numbers: <code>n</code>.</p>

<p>This is known as the “public modulus” (because, along with <code>e</code>, it is also
present in the public key).  It is very easy to calculate: <code>n = p * q</code>.  It
is also very early in the key (the second number, in fact).</p>

<p>Since <code>n = p * q</code>, it follows that <code>q = n / p</code>.  Thus, as long
as the key is intact up to <code>p</code>, you can derive <code>q</code> by simple division.</p>



<p>At this point, I’d like to introduce an acquaintance of mine: Mr. Johan Finn.
He is the proud owner of the GitHub repo <a href="https://github.com/johanfinn/scripts"><code>johanfinn/scripts</code></a>.
For a while, his repo contained a script that contained a poorly-redacted private
key.  He since deleted it, by making a new commit, but of course because
git never <em>really</em> deletes anything, it’s
<a href="https://github.com/johanfinn/scripts/blob/cfeab55fab47210b39c7303294ae1285f47a130e/Create%20sudo%20user%20johan%20with%20private%20key%20(For%20Johans%20Desktop)">still available</a>.</p>

<p>Of course, Mr. Finn may delete the repo, or force-push a new history without
that commit, so here is the redacted private key, with a bit of the surrounding
shell script, for our illustrative pleasure:</p>

<pre>#Add private key to .ssh folder
cd /home/johan/.ssh/
echo  &#34;-----BEGIN RSA PRIVATE KEY-----
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN
KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
ÄÄÄÄÄÄÄÄÄÄÄÄÄÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅ
MIIJKgIBAAKCAgEAxEVih1JGb8gu/Fm4AZh+ZwJw/pjzzliWrg4mICFt1g7SmIE2
TCQMKABdwd11wOFKCPc/UzRH/fHuQcvWrpbOSdqev/zKff9iedKw/YygkMeIRaXB
fYELqvUAOJ8PPfDm70st9GJRhjGgo5+L3cJB2gfgeiDNHzaFvapRSU0oMGQX+kI9
ezsjDAn+0Pp+r3h/u1QpLSH4moRFGF4omNydI+3iTGB98/EzuNhRBHRNq4oBV5SG
Pq/A1bem2ninnoEaQ+OPESxYzDz3Jy9jV0W/6LvtJ844m+XX69H5fqq5dy55z6DW
sGKn78ULPVZPsYH5Y7C+CM6GAn4nYCpau0t52sqsY5epXdeYx4Dc+Wm0CjXrUDEe
Egl4loPKDxJkQqQ/MQiz6Le/UK9vEmnWn1TRXK3ekzNV4NgDfJANBQobOpwt8WVB
rbsC0ON7n680RQnl7PltK9P1AQW5vHsahkoixk/BhcwhkrkZGyDIl9g8Q/Euyoq3
eivKPLz7/rhDE7C1BzFy7v8AjC3w7i9QeHcWOZFAXo5hiDasIAkljDOsdfD4tP5/
wSO6E6pjL3kJ+RH2FCHd7ciQb+IcuXbku64ln8gab4p8jLa/mcMI+V3eWYnZ82Yu
axsa85hAe4wb60cp/rCJo7ihhDTTvGooqtTisOv2nSvCYpcW9qbL6cGjAXECAwEA
AQKCAgEAjz6wnWDP5Y9ts2FrqUZ5ooamnzpUXlpLhrbu3m5ncl4ZF5LfH+QDN0Kl
KvONmHsUhJynC/vROybSJBU4Fu4bms1DJY3C39h/L7g00qhLG7901pgWMpn3QQtU
4P49qpBii20MGhuTsmQQALtV4kB/vTgYfinoawpo67cdYmk8lqzGzzB/HKxZdNTq
s+zOfxRr7PWMo9LyVRuKLjGyYXZJ/coFaobWBi8Y96Rw5NZZRYQQXLIalC/Dhndm
AHckpstEtx2i8f6yxEUOgPvV/gD7Akn92RpqOGW0g/kYpXjGqZQy9PVHGy61sInY
HSkcOspIkJiS6WyJY9JcvJPM6ns4b84GE9qoUlWVF3RWJk1dqYCw5hz4U8LFyxsF
R6WhYiImvjxBLpab55rSqbGkzjI2z+ucDZyl1gqIv9U6qceVsgRyuqdfVN4deU22
LzO5IEDhnGdFqg9KQY7u8zm686Ejs64T1sh0y4GOmGsSg+P6nsqkdlXH8C+Cf03F
lqPFg8WQC7ojl/S8dPmkT5tcJh3BPwIWuvbtVjFOGQc8x0lb+NwK8h2Nsn6LNazS
0H90adh/IyYX4sBMokrpxAi+gMAWiyJHIHLeH2itNKtAQd3qQowbrWNswJSgJzsT
JuJ7uqRKAFkE6nCeAkuj/6KHHMPsfCAffVdyGaWqhoxmPOrnVgECggEBAOrCCwiC
XxwUgjOfOKx68siFJLfHf4vPo42LZOkAQq5aUmcWHbJVXmoxLYSczyAROopY0wd6
Dx8rqnpO7OtZsdJMeBSHbMVKoBZ77hiCQlrljcj12moFaEAButLCdZFsZW4zF/sx
kWIAaPH9vc4MvHHyvyNoB3yQRdevu57X7xGf9UxWuPil/jvdbt9toaraUT6rUBWU
GYPNKaLFsQzKsFWAzp5RGpASkhuiBJ0Qx3cfLyirjrKqTipe3o3gh/5RSHQ6VAhz
gdUG7WszNWk8FDCL6RTWzPOrbUyJo/wz1kblsL3vhV7ldEKFHeEjsDGroW2VUFlS
asAHNvM4/uYcOSECggEBANYH0427qZtLVuL97htXW9kCAT75xbMwgRskAH4nJDlZ
IggDErmzBhtrHgR+9X09iL47jr7dUcrVNPHzK/WXALFSKzXhkG/yAgmt3r14WgJ6
5y7010LlPFrzaNEyO/S4ISuBLt4cinjJsrFpoo0WI8jXeM5ddG6ncxdurKXMymY7
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::.::
:::::::::::::::::::::::::::.::::::::::::::::::::::::::::::::::::
LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLlL
ÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖÖ
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
ÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅ
YYYYYYYYYYYYYYYYYYYYYyYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY
gff0GJCOMZ65pMSy3A3cSAtjlKnb4fWzuHD5CFbusN4WhCT/tNxGNSpzvxd8GIDs
nY7exs9L230oCCpedVgcbayHCbkChEfoPzL1e1jXjgCwCTgt8GjeEFqc1gXNEaUn
O8AJ4VlR8fRszHm6yR0ZUBdY7UJddxQiYOzt0S1RLlECggEAbdcs4mZdqf3OjejJ
06oTPs9NRtAJVZlppSi7pmmAyaNpOuKWMoLPElDAQ3Q7VX26LlExLCZoPOVpdqDH
KbdmBEfTR4e11Pn9vYdu9/i6o10U4hpmf4TYKlqk10g1Sj21l8JATj/7Diey8scO
sAI1iftSg3aBSj8W7rxCxSezrENzuqw5D95a/he1cMUTB6XuravqZK5O4eR0vrxR
AvMzXk5OXrUEALUvt84u6m6XZZ0pq5XZxq74s8p/x1JvTwcpJ3jDKNEixlHfdHEZ
ZIu/xpcwD5gRfVGQamdcWvzGHZYLBFO1y5kAtL8kI9tW7WaouWVLmv99AyxdAaCB
Y5mBAQKCAQEAzU7AnorPzYndlOzkxRFtp6MGsvRBsvvqPLCyUFEXrHNV872O7tdO
GmsMZl+q+TJXw7O54FjJJvqSSS1sk68AGRirHop7VQce8U36BmI2ZX6j2SVAgIkI
9m3btCCt5rfiCatn2+Qg6HECmrCsHw6H0RbwaXS4RZUXD/k4X+sslBitOb7K+Y+N
Bacq6QxxjlIqQdKKPs4P2PNHEAey+kEJJGEQ7bTkNxCZ21kgi1Sc5L8U/IGy0BMC
PvJxssLdaWILyp3Ws8Q4RAoC5c0ZP0W2j+5NSbi3jsDFi0Y6/2GRdY1HAZX4twem
Q0NCedq1JNatP1gsb6bcnVHFDEGsj/35oQKCAQEAgmWMuSrojR/fjJzvke6Wvbox
FRnPk+6YRzuYhAP/YPxSRYyB5at++5Q1qr7QWn7NFozFIVFFT8CBU36ktWQ39MGm
cJ5SGyN9nAbbuWA6e+/u059R7QL+6f64xHRAGyLT3gOb1G0N6h7VqFT25q5Tq0rc
Lf/CvLKoudjv+sQ5GKBPT18+zxmwJ8YUWAsXUyrqoFWY/Tvo5yLxaC0W2gh3+Ppi
EDqe4RRJ3VKuKfZxHn5VLxgtBFN96Gy0+Htm5tiMKOZMYAkHiL+vrVZAX0hIEuRZ
JJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJ
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
-----END RSA PRIVATE KEY-----&#34; &gt;&gt; id_rsa
</pre>

<p>Now, if you try to reconstruct this key by removing the “obvious” garbage
lines (the ones that are all repeated characters, some of which aren’t even valid
base64 characters), it still isn’t a key – at least, <code>openssl pkey</code>
doesn’t want anything to do with it.  The key is very much still in there,
though, as we shall soon see.</p>

<p>Using <a href="https://github.com/mpalmer/derparse">a gem I wrote</a> and a quick bit of
Ruby, we can extract a complete private key.  The <code>irb</code> session looks something
like this:</p>

<pre>&gt;&gt; require &#34;derparse&#34;
&gt;&gt; b64 = &lt;&lt;EOF
MIIJKgIBAAKCAgEAxEVih1JGb8gu/Fm4AZh+ZwJw/pjzzliWrg4mICFt1g7SmIE2
TCQMKABdwd11wOFKCPc/UzRH/fHuQcvWrpbOSdqev/zKff9iedKw/YygkMeIRaXB
fYELqvUAOJ8PPfDm70st9GJRhjGgo5+L3cJB2gfgeiDNHzaFvapRSU0oMGQX+kI9
ezsjDAn+0Pp+r3h/u1QpLSH4moRFGF4omNydI+3iTGB98/EzuNhRBHRNq4oBV5SG
Pq/A1bem2ninnoEaQ+OPESxYzDz3Jy9jV0W/6LvtJ844m+XX69H5fqq5dy55z6DW
sGKn78ULPVZPsYH5Y7C+CM6GAn4nYCpau0t52sqsY5epXdeYx4Dc+Wm0CjXrUDEe
Egl4loPKDxJkQqQ/MQiz6Le/UK9vEmnWn1TRXK3ekzNV4NgDfJANBQobOpwt8WVB
rbsC0ON7n680RQnl7PltK9P1AQW5vHsahkoixk/BhcwhkrkZGyDIl9g8Q/Euyoq3
eivKPLz7/rhDE7C1BzFy7v8AjC3w7i9QeHcWOZFAXo5hiDasIAkljDOsdfD4tP5/
wSO6E6pjL3kJ+RH2FCHd7ciQb+IcuXbku64ln8gab4p8jLa/mcMI+V3eWYnZ82Yu
axsa85hAe4wb60cp/rCJo7ihhDTTvGooqtTisOv2nSvCYpcW9qbL6cGjAXECAwEA
AQKCAgEAjz6wnWDP5Y9ts2FrqUZ5ooamnzpUXlpLhrbu3m5ncl4ZF5LfH+QDN0Kl
KvONmHsUhJynC/vROybSJBU4Fu4bms1DJY3C39h/L7g00qhLG7901pgWMpn3QQtU
4P49qpBii20MGhuTsmQQALtV4kB/vTgYfinoawpo67cdYmk8lqzGzzB/HKxZdNTq
s+zOfxRr7PWMo9LyVRuKLjGyYXZJ/coFaobWBi8Y96Rw5NZZRYQQXLIalC/Dhndm
AHckpstEtx2i8f6yxEUOgPvV/gD7Akn92RpqOGW0g/kYpXjGqZQy9PVHGy61sInY
HSkcOspIkJiS6WyJY9JcvJPM6ns4b84GE9qoUlWVF3RWJk1dqYCw5hz4U8LFyxsF
R6WhYiImvjxBLpab55rSqbGkzjI2z+ucDZyl1gqIv9U6qceVsgRyuqdfVN4deU22
LzO5IEDhnGdFqg9KQY7u8zm686Ejs64T1sh0y4GOmGsSg+P6nsqkdlXH8C+Cf03F
lqPFg8WQC7ojl/S8dPmkT5tcJh3BPwIWuvbtVjFOGQc8x0lb+NwK8h2Nsn6LNazS
0H90adh/IyYX4sBMokrpxAi+gMAWiyJHIHLeH2itNKtAQd3qQowbrWNswJSgJzsT
JuJ7uqRKAFkE6nCeAkuj/6KHHMPsfCAffVdyGaWqhoxmPOrnVgECggEBAOrCCwiC
XxwUgjOfOKx68siFJLfHf4vPo42LZOkAQq5aUmcWHbJVXmoxLYSczyAROopY0wd6
Dx8rqnpO7OtZsdJMeBSHbMVKoBZ77hiCQlrljcj12moFaEAButLCdZFsZW4zF/sx
kWIAaPH9vc4MvHHyvyNoB3yQRdevu57X7xGf9UxWuPil/jvdbt9toaraUT6rUBWU
GYPNKaLFsQzKsFWAzp5RGpASkhuiBJ0Qx3cfLyirjrKqTipe3o3gh/5RSHQ6VAhz
gdUG7WszNWk8FDCL6RTWzPOrbUyJo/wz1kblsL3vhV7ldEKFHeEjsDGroW2VUFlS
asAHNvM4/uYcOSECggEBANYH0427qZtLVuL97htXW9kCAT75xbMwgRskAH4nJDlZ
IggDErmzBhtrHgR+9X09iL47jr7dUcrVNPHzK/WXALFSKzXhkG/yAgmt3r14WgJ6
5y7010LlPFrzaNEyO/S4ISuBLt4cinjJsrFpoo0WI8jXeM5ddG6ncxdurKXMymY7
EOF
&gt;&gt; b64 += &lt;&lt;EOF
gff0GJCOMZ65pMSy3A3cSAtjlKnb4fWzuHD5CFbusN4WhCT/tNxGNSpzvxd8GIDs
nY7exs9L230oCCpedVgcbayHCbkChEfoPzL1e1jXjgCwCTgt8GjeEFqc1gXNEaUn
O8AJ4VlR8fRszHm6yR0ZUBdY7UJddxQiYOzt0S1RLlECggEAbdcs4mZdqf3OjejJ
06oTPs9NRtAJVZlppSi7pmmAyaNpOuKWMoLPElDAQ3Q7VX26LlExLCZoPOVpdqDH
KbdmBEfTR4e11Pn9vYdu9/i6o10U4hpmf4TYKlqk10g1Sj21l8JATj/7Diey8scO
sAI1iftSg3aBSj8W7rxCxSezrENzuqw5D95a/he1cMUTB6XuravqZK5O4eR0vrxR
AvMzXk5OXrUEALUvt84u6m6XZZ0pq5XZxq74s8p/x1JvTwcpJ3jDKNEixlHfdHEZ
ZIu/xpcwD5gRfVGQamdcWvzGHZYLBFO1y5kAtL8kI9tW7WaouWVLmv99AyxdAaCB
Y5mBAQKCAQEAzU7AnorPzYndlOzkxRFtp6MGsvRBsvvqPLCyUFEXrHNV872O7tdO
GmsMZl+q+TJXw7O54FjJJvqSSS1sk68AGRirHop7VQce8U36BmI2ZX6j2SVAgIkI
9m3btCCt5rfiCatn2+Qg6HECmrCsHw6H0RbwaXS4RZUXD/k4X+sslBitOb7K+Y+N
Bacq6QxxjlIqQdKKPs4P2PNHEAey+kEJJGEQ7bTkNxCZ21kgi1Sc5L8U/IGy0BMC
PvJxssLdaWILyp3Ws8Q4RAoC5c0ZP0W2j+5NSbi3jsDFi0Y6/2GRdY1HAZX4twem
Q0NCedq1JNatP1gsb6bcnVHFDEGsj/35oQKCAQEAgmWMuSrojR/fjJzvke6Wvbox
FRnPk+6YRzuYhAP/YPxSRYyB5at++5Q1qr7QWn7NFozFIVFFT8CBU36ktWQ39MGm
cJ5SGyN9nAbbuWA6e+/u059R7QL+6f64xHRAGyLT3gOb1G0N6h7VqFT25q5Tq0rc
Lf/CvLKoudjv+sQ5GKBPT18+zxmwJ8YUWAsXUyrqoFWY/Tvo5yLxaC0W2gh3+Ppi
EDqe4RRJ3VKuKfZxHn5VLxgtBFN96Gy0+Htm5tiMKOZMYAkHiL+vrVZAX0hIEuRZ
EOF
&gt;&gt; der = b64.unpack(&#34;m&#34;).first
&gt;&gt; c = DerParse.new(der).first_node.first_child
&gt;&gt; version = c.value
=&gt; 0
&gt;&gt; c = c.next_node
&gt;&gt; n = c.value
=&gt; 80071596234464993385068908004931... # (etc)
&gt;&gt; c = c.next_node
&gt;&gt; e = c.value
=&gt; 65537
&gt;&gt; c = c.next_node
&gt;&gt; d = c.value
=&gt; 58438813486895877116761996105770... # (etc)
&gt;&gt; c = c.next_node
&gt;&gt; p = c.value
=&gt; 29635449580247160226960937109864... # (etc)
&gt;&gt; c = c.next_node
&gt;&gt; q = c.value
=&gt; 27018856595256414771163410576410... # (etc)
</pre>

<p>What I’ve done, in case you don’t speak Ruby, is take the two “chunks” of
plausible-looking base64 data, chuck them together into a variable named <code>b64</code>,
unbase64 it into a variable named <code>der</code>, pass that into a new <code>DerParse</code>
instance, and then walk the DER value tree until I got all the values I need.</p>

<p>Interestingly, the <code>q</code> value actually traverses the “split” in the two chunks,
which means that there’s always the possibility that there are lines missing
from the key.  However, since <code>p</code> and <code>q</code> are supposed to be prime, we can
“sanity check” them to see if corruption is likely to have occurred:</p>

<pre>&gt;&gt; require &#34;openssl&#34;
&gt;&gt; OpenSSL::BN.new(p).prime?
=&gt; true
&gt;&gt; OpenSSL::BN.new(q).prime?
=&gt; true
</pre>

<p>Excellent!  The chances of a corrupted file producing valid-but-incorrect prime
numbers isn’t huge, so we can be fairly confident that we’ve got the “real” <code>p</code>
and <code>q</code>.  Now, with the help of <a href="https://github.com/pwnedkeys/openssl-additions">another one of my
creations</a> we can use <code>e</code>, <code>p</code>,
and <code>q</code> to create a fully-operational battle key:</p>

<pre>&gt;&gt; require &#34;openssl/pkey/rsa&#34;
&gt;&gt; k = OpenSSL::PKey::RSA.from_factors(p, q, e)
=&gt; #&lt;OpenSSL::PKey::RSA:0x0000559d5903cd38&gt;
&gt;&gt; k.valid?
=&gt; true
&gt;&gt; k.verify(OpenSSL::Digest::SHA256.new, k.sign(OpenSSL::Digest::SHA256.new, &#34;bob&#34;), &#34;bob&#34;)
=&gt; true
</pre>

<p>… and there you have it.  One fairly redacted-looking private key brought back
to life by maths and far too much free time.</p>

<p>Sorry Mr. Finn, I hope you’re not still using that key on anything
Internet-facing.</p>



<p>EC keys are very different beasts, but they have much the same problems as RSA
keys.  A typical EC key contains both private and public data, and the public
portion is twice the size – so only about 1/3 of the data in the key is
private material.  It is quite plausible that you can “redact” an EC key and
leave all the <em>actually</em> private bits exposed.</p>



<p>In short: don’t ever try and redact real private keys.  For documentation purposes,
just put “KEY GOES HERE” in the appropriate spot, or something like that.  Store your
secrets somewhere that <em>isn’t</em> a public (or even private!) git repo.</p>

<p>Generating a “dummy” private key and sticking it in there isn’t a great idea,
for different reasons: people have this odd habit of <a href="https://groups.google.com/forum/#!topic/mozilla.dev.security.policy/PGDt6hunpZQ">reusing “demo” keys in
real
life</a>.
There’s no need to encourage that sort of thing.</p>

<hr/>



<hr/>
			
			

			</div>
		</div></div>
  </body>
</html>
