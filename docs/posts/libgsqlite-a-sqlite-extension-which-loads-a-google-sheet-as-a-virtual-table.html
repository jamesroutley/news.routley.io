<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/0x6b/libgsqlite">Original</a>
    <h1>Libgsqlite: A SQLite extension which loads a Google Sheet as a virtual table</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">A <a href="https://www.sqlite.org" rel="nofollow">SQLite</a> extension which loads a <a href="https://www.google.com/sheets/about/" rel="nofollow">Google Sheet</a> as a virtual table.</p>
<video src="https://user-images.githubusercontent.com/679719/182612984-3e1156c5-cc95-4450-bb20-2fd76f51aa3d.mp4" data-canonical-src="https://user-images.githubusercontent.com/679719/182612984-3e1156c5-cc95-4450-bb20-2fd76f51aa3d.mp4" controls="controls" muted="muted">

  </video>
<h2 tabindex="-1" dir="auto"><a id="user-content-tested-platform" aria-hidden="true" href="#tested-platform"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Tested Platform</h2>
<ul dir="auto">
<li><a href="https://www.sqlite.org" rel="nofollow">SQLite</a> 3.39.2</li>
<li><a href="https://www.rust-lang.org" rel="nofollow">Rust</a> 1.62.1-aarch64-apple-darwin</li>
<li>macOS 12.5 (Monterey) on Apple M1 MAX</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-getting-started" aria-hidden="true" href="#getting-started"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Getting Started</h2>
<h3 tabindex="-1" dir="auto"><a id="user-content-setup-google-cloud" aria-hidden="true" href="#setup-google-cloud"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Setup Google Cloud</h3>
<h4 tabindex="-1" dir="auto"><a id="user-content-create-a-project" aria-hidden="true" href="#create-a-project"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Create a Project</h4>
<ol dir="auto">
<li>Log in to the <a href="https://console.cloud.google.com/" rel="nofollow">Google Cloud console</a>.</li>
<li>Go to the <a href="https://console.cloud.google.com/cloud-resource-manager" rel="nofollow"><strong>Manage resources</strong></a> page.</li>
<li>On the <strong>Select organization</strong> drop-down list at the top of the page, select the organization resource in which you want to create a project.</li>
<li>Click <strong>Create Project</strong>.</li>
<li>In the <strong>New Project</strong> window that appears, enter a project name, say <code>libgsqlite</code>, and select a billing account as applicable.</li>
<li>Enter the parent organization or folder resource in the <strong>Location</strong> box.</li>
<li>When you&#39;re finished entering new project details, click <strong>Create</strong>.</li>
</ol>
<h4 tabindex="-1" dir="auto"><a id="user-content-enable-google-sheets-api-for-the-project" aria-hidden="true" href="#enable-google-sheets-api-for-the-project"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Enable Google Sheets API for the Project</h4>
<ol dir="auto">
<li>Go to the <a href="https://console.cloud.google.com/apis/library?project=_" rel="nofollow"><strong>API Library</strong></a> page.</li>
<li>From the projects list, select the project you just created.</li>
<li>In the API Library, select <strong>Google Sheets API</strong>.</li>
<li>On the API page, click <strong>Enable</strong>.</li>
</ol>
<h4 tabindex="-1" dir="auto"><a id="user-content-setup-google-oauth-consent-screen" aria-hidden="true" href="#setup-google-oauth-consent-screen"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Setup Google OAuth Consent Screen</h4>
<ol dir="auto">
<li>Go to the <a href="https://console.cloud.google.com/apis/credentials/consent" rel="nofollow"><strong>OAuth consent screen</strong></a> page.</li>
<li>Select <strong>Internal</strong> as User Type, then click <strong>Create</strong></li>
<li>Add required information like an app name (<code>libgsqlite</code>) and support email address.</li>
<li>Click <strong>Save and Continue</strong>.</li>
<li>Click <strong>Add or Remove Scopes</strong>.</li>
<li>On the dialog that appears, select the scope <code>.../auth/spreadsheets.readonly</code> (See all your Google Sheets spreadsheets) and click <strong>Update</strong>.</li>
<li>Click <strong>Save and Continue</strong>.</li>
<li>Click <strong>Back to Dashboard</strong>.</li>
</ol>
<h4 tabindex="-1" dir="auto"><a id="user-content-create-a-credential" aria-hidden="true" href="#create-a-credential"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Create a Credential</h4>
<ol dir="auto">
<li>Go to the <a href="https://console.cloud.google.com/apis/credentials" rel="nofollow"><strong>Credentials</strong></a> page.</li>
<li>Click <strong>Create Credentials</strong> → <strong>OAuth Client ID</strong>.</li>
<li>Select <strong>Desktop app</strong> as Application Type.</li>
<li>Type <code>libgsqlite</code> as Name.</li>
<li>Click <strong>Download JSON</strong> to save your <strong>Client ID</strong> and <strong>Client Secret</strong> locally.</li>
</ol>
<h3 tabindex="-1" dir="auto"><a id="user-content-create-a-sample-spreadsheet" aria-hidden="true" href="#create-a-sample-spreadsheet"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Create a Sample Spreadsheet</h3>
<ol dir="auto">
<li>Go to <a href="https://sheet.new" rel="nofollow">sheet.new</a> to create a new spreadsheet, then copy and paste following data.</li>
</ol>
<table>
<thead>
<tr>
<th>Employee Number</th>
<th>First Name</th>
<th>Last Name</th>
<th>Department</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Christine</td>
<td>Haas</td>
<td>A00</td>
</tr>
<tr>
<td>2</td>
<td>Michael</td>
<td>Thompson</td>
<td>B01</td>
</tr>
<tr>
<td>3</td>
<td>Sally</td>
<td>Kwan</td>
<td>C01</td>
</tr>
<tr>
<td>4</td>
<td>John</td>
<td>Beyer</td>
<td>E01</td>
</tr>
<tr>
<td>5</td>
<td>Irving</td>
<td>Stern</td>
<td>D11</td>
</tr>
<tr>
<td>6</td>
<td>Eva</td>
<td>Pulaski</td>
<td>E01</td>
</tr>
</tbody>
</table>
<ol start="2" dir="auto">
<li>Copy the URL of the spreadsheet.</li>
</ol>
<h3 tabindex="-1" dir="auto"><a id="user-content-query-the-spreadsheet-with-sqlite" aria-hidden="true" href="#query-the-spreadsheet-with-sqlite"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Query the Spreadsheet with SQLite</h3>
<ol dir="auto">
<li>Setup required environment variables with the credential:
<div dir="auto" data-snippet-clipboard-copy-content="$ export LIBGSQLITE_GOOGLE_CLIENT_ID=... # client_id property in the downloaded JSON
$ export LIBGSQLITE_GOOGLE_CLIENT_SECRET=... # client_secret property"><pre>$ <span>export</span> LIBGSQLITE_GOOGLE_CLIENT_ID=... <span><span>#</span> client_id property in the downloaded JSON</span>
$ <span>export</span> LIBGSQLITE_GOOGLE_CLIENT_SECRET=... <span><span>#</span> client_secret property</span></pre></div>
</li>
<li>Launch SQLite:

</li>
<li>Load the extension:
<div dir="auto" data-snippet-clipboard-copy-content=".load libgsqlite # or &#34;gsqlite&#34; on Windows"><pre>.load libgsqlite <span><span>#</span> or &#34;gsqlite&#34; on Windows</span></pre></div>
If you get <code>Error: unknown command or invalid arguments: &#34;load&#34;. Enter &#34;.help&#34; for help </code>, your SQLite is not capable for loading an extension. For macOS, install it with <code>brew install sqlite3</code>, and use it.</li>
<li>Create a virtual table for your spreadsheet by providing <code>ID</code> (url of the spreadsheet), <code>SHEET</code> (sheet name), and <code>RANGE</code> for module arguments. All three arguments are mandatory. You&#39;ll be navigated to Google OAuth consent screen to get a secret to access the spreadsheet. You can create multiple virtual tables from different spreadsheets.
<div dir="auto" data-snippet-clipboard-copy-content="CREATE VIRTUAL TABLE employees USING gsqlite(
    ID &#39;https://docs.google.com/spreadsheets/d/...&#39;, -- your spreadsheet URL
    SHEET &#39;Sheet1&#39;, -- name of the sheet
    RANGE &#39;A2:D7&#39; -- range to fetch
);"><pre>CREATE VIRTUAL TABLE employees USING gsqlite(
    ID <span><span>&#39;</span>https://docs.google.com/spreadsheets/d/...<span>&#39;</span></span>, <span><span>--</span> your spreadsheet URL</span>
    SHEET <span><span>&#39;</span>Sheet1<span>&#39;</span></span>, <span><span>--</span> name of the sheet</span>
    RANGE <span><span>&#39;</span>A2:D7<span>&#39;</span></span> <span><span>--</span> range to fetch</span>
);</pre></div>
</li>
<li>Go back to your terminal, and run a query as usual:
<div dir="auto" data-snippet-clipboard-copy-content=".mode column
.headers on
SELECT * FROM employees;
SELECT * FROM employees WHERE D LIKE &#39;E%&#39;;"><pre>.mode column
.headers <span>on</span>
<span>SELECT</span> <span>*</span> <span>FROM</span> employees;
<span>SELECT</span> <span>*</span> <span>FROM</span> employees <span>WHERE</span> D <span>LIKE</span> <span><span>&#39;</span>E%<span>&#39;</span></span>;</pre></div>
</li>
</ol>

<p dir="auto">Please read <a href="https://payments.posthaven.com/0x6b/libgsqlite/blob/master/CONTRIBUTING.md">CONTRIBUTING</a> for more detail.</p>

<p dir="auto">An article, <a href="https://sergey.khabibullin.com/sqlite-extensions-in-rust/" rel="nofollow">Extending SQLite with Rust to support Excel files as virtual tables | Sergey Khabibullin</a>, and its companion repository <a href="https://github.com/x2bool/xlite">x2bool/xlite</a>, for great write up and inspiration.</p>

<ul dir="auto">
<li>The extension will load the spreadsheet only once while creating a virtual table. If you want to pick up recent changes, drop the table and create it again.</li>
<li><code>INSERT</code>, <code>UPDATE</code> and <code>DELETE</code> statements won&#39;t be implemented. Welcome PRs.</li>
</ul>

<p dir="auto">The extension is intended for use in personal, not-shared, environment. The Google Cloud secret will be cached for 59 minutes under the temporary directory (See <a href="https://doc.rust-lang.org/std/env/fn.temp_dir.html" rel="nofollow"><code>std::env::temp_dir</code></a>) with fixed name <code>access_token.json</code> for your convenience. Note that, as described at the doc, creating a file or directory with a fixed or predictable name may result in “insecure temporary file” security vulnerability.</p>

<p dir="auto">The extension never send your data to any server.</p>

<p dir="auto">This extension is released under the MIT License. See <a href="https://payments.posthaven.com/0x6b/libgsqlite/blob/master/LICENSE">LICENSE</a> for details.</p>

<ul dir="auto">
<li><a href="https://cloud.google.com/resource-manager/docs/manage-google-cloud-resources#create_a_project_resource" rel="nofollow">Quickstart: Manage your Google Cloud resources</a></li>
<li><a href="https://cloud.google.com/apis/docs/getting-started" rel="nofollow">Getting started | Cloud APIs</a></li>
<li><a href="https://support.google.com/cloud/answer/6158849?hl=en&amp;ref_topic=3473162" rel="nofollow">Setting up OAuth 2.0</a></li>
</ul>
</article>
          </div></div>
  </body>
</html>
