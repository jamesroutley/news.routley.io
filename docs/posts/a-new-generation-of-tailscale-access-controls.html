<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tailscale.com/blog/grants-ga">Original</a>
    <h1>A new generation of Tailscale access controls</h1>
    
    <div id="readability-page-1" class="page"><p><span>Grants are generally available as an easier option to write and read than ACL syntax. Anything you can write as an ACL can be expressed as a grant, coexisting in perfect harmony.</span></p><div><div><p>Today, we’re announcing the general availability of grants, Tailscale’s next generation of access controls that combine network and application capabilities into a single syntax.</p><p>Grants are a superset of our original ACLs — anything you can write as an ACL can be expressed as a grant. In most scenarios, grants are easier to write and read than the ACL syntax. Let’s take a look:</p><p>Grants are designed to be easy to write and easy to read, for both humans and computers. We combined ports and protocols into a single <code>ip</code> field, and removed the redundant <code>action</code> field. This simplifies our original ACL syntax, where these fields were needed in every rule.</p><h2 id="the-new-stuff"><a href="#the-new-stuff">The new stuff<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2><p>Grants go beyond simplifying the ACL syntax, they also add new tools that you can use for more powerful access controls.</p><h3 id="application-capability-extensions"><a href="#application-capability-extensions">Application capability extensions<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3><p>Tailscale’s access controls have always been able to define network-level permissions at <a target="" rel="noreferrer" href="https://tailscale.com/kb/1456/osi">Layer 3</a>, but this is only half the story — you still need to handle authentication and authorization for users once their packets reach your applications.</p><p>For private services inside your tailnet, like internal tools, implementing auth on every app is overkill. That’s why we developed <code>tsnet</code>, a Go library that embeds Tailscale directly in your applications. This lets you see and react to the identity of every user who makes a request to your app. So, authentication is handled…what about authorization?</p><p>That’s where grants come in. You define application capabilities in a grant, and they’re passed to your application. There, you can read them alongside the identity of the user. Together, grants and <code>tsnet</code> let you build private services that rely on Tailscale&#39;s <a target="" rel="noreferrer" href="https://tailscale.com/blog/rbac-like-it-was-meant-to-be">RBAC policy expansion</a> for authentication and authorization.</p><p>Application capabilities are namespaced, freeform JSON objects. You can define permissions that should be granted to the entities in the <code>src</code> field of your grant. Tailscale has defined a schema in some of our own apps, but you’re not limited to that. The magic of application capabilities is that you can easily define your own capabilities to use in your apps.</p><p>Let’s look at <a target="" rel="noreferrer" href="https://github.com/tailscale/golink">Golink</a>, a tiny internal shortlink service we use every day at Tailscale. Users in Golink are authenticated with their Tailscale identity, and there are normal users and admin users. We can use grants to not only determine who is allowed to access the Golink service, but also to assign the admin role to specific groups of users:</p><p>Instead of managing network access to Golink in Tailscale and implementing user role management inside the Golink app, we can centralize both policies in Tailscale. Every request made to Golink includes the Tailscale identity of the requestor and the permissions to grant to that user. This makes it easy to read those properties in the app, making authentication and authorization decisions without maintaining yet another user database.</p><p>Here’s what that looks like on the Golink side, using our <a target="" rel="noreferrer" href="https://tailscale.com/kb/1244/tsnet">tsnet library</a>:</p><p>Golink isn’t the only application that already takes advantage of application capabilities in grants. We’ve open sourced several other tools that demonstrate how using grants to unify network and application permissions simplifies access management:</p><ul><li><a target="" rel="noreferrer" href="https://github.com/tailscale/tailsql">TailSQL</a>: a private SQL playground inside your tailnet</li><li><a target="" rel="noreferrer" href="https://tailscale.com/community/community-projects/setec">Setec</a>: a secrets management service that uses app capabilities for access control</li><li><a target="" rel="noreferrer" href="https://tailscale.com/kb/1437/kubernetes-operator-api-server-proxy">Kubernetes API server proxy</a>: a Tailscale operator tool to expose and access the Kubernetes control plane</li></ul><p><a target="" rel="noreferrer" href="https://tailscale.com/kb/1537/grants-app-capabilities">Read more about application capabilities</a></p><h3 id="routing-awareness-with-via"><a href="#routing-awareness-with-via">Routing awareness with <code>via</code><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3><p>Grants also add a new field, <code>via</code>, to let you define the <a target="" rel="noreferrer" href="https://tailscale.com/kb/1103/exit-nodes">exit nodes</a>, <a target="" rel="noreferrer" href="https://tailscale.com/kb/1019/subnets">subnet routers</a>, or <a target="" rel="noreferrer" href="https://tailscale.com/kb/1281/app-connectors">app connectors</a> that your devices must use when accessing particular resources.</p><p>For example, you can use the <code>via</code> field to direct your users’ internet traffic through different exit nodes depending on their office location:</p><p>You can use the <code>via</code> field to route traffic through tagged sets of exit nodes, app connectors, or subnet routers. It also supports regional routing and failover when using tagged subnet routers in a <a target="" rel="noreferrer" href="https://tailscale.com/kb/1115/high-availability">high availability</a> configuration.</p><p><a target="" rel="noreferrer" href="https://tailscale.com/kb/1378/via">Read more about via</a></p><h2 id="but-what-about-my-existing-policies"><a href="#but-what-about-my-existing-policies">But what about my existing policies?<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2><p>If you’re an existing Tailscale user, you probably have lots of access controls written in our older ACL syntax. I can feel your anxiety through the screen. <em>When do I have to update all those policies to use the new syntax? </em>In our industry, these kinds of announcements usually have a small paragraph tacked on to the end with words like “deprecated”, “migration plan”, and “deadline.”</p><p>I have great news: You never have to update your existing rules to use the new grants syntax. We will support our original ACL syntax <strong>forever.</strong> You can even use ACLs and grants side-by-side in the same policy. When we say that <a target="" rel="noreferrer" href="https://tailscale.com/blog/community-projects#tailscale-is-a-stable-platform">Tailscale is a stable platform</a>, we aren’t kidding around.</p><p>You only need to rewrite your existing ACL policies if you want to take advantage of the newer features we add to the grants syntax. You can do this incrementally, one rule at a time, because grants and ACLs coexist in perfect harmony.</p><p><a target="" rel="noreferrer" href="https://tailscale.com/kb/1542/grants-migration">Read the migration guide</a></p></div></div></div>
  </body>
</html>
