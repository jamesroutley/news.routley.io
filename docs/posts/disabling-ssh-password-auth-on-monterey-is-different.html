<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rachelbythebay.com/w/2021/10/27/macssh/">Original</a>
    <h1>Disabling ssh password auth on Monterey is different</h1>
    
    
<p>
If you&#39;re riding the bleeding edge of Mac software updates, you might 
have just installed Monterey, or you will soon.  If you&#39;re also running 
sshd so you can log in remotely, you should be aware that the typical 
&#34;revert your config&#34; shenanigans have happened, so you are
<a href="https://rachelbythebay.com/w/2021/03/10/sealed/">once again</a>
accepting password authentication, and thus are subject to a brute-force 
attack.
</p>
<p>
My post from March talks about editing the sshd_config to make it go 
away, and, well, that doesn&#39;t apply any more.  They&#39;ve changed the way 
the config works to add a &#34;.d&#34; directory scheme which sets some 
defaults.  There is now /etc/ssh/sshd_config.d, and in it, 
100-macos.conf.
</p>
<p>
Editing that file would likely get reverted upon the next patch 
(12.0.2?), so that&#39;s right out.  You can&#39;t go past it with a higher 
number, since as the sshd_config points out, the *first* instance of a 
setting is kept, and subsequent instances of the same setting are 
ignored.
</p>
<p>
Instead, you have to get in front of them, and use a LOWER number.  Try 
something like &#34;000-yourname.conf&#34; and then just drop this in:
</p>
<pre class="terminal">UsePAM no
PasswordAuthentication no
</pre>
<p>
If we&#39;re lucky, they won&#39;t wipe that entire directory on updates, and so 
maybe this will stick around for longer than usual.
</p>
<p>
Finally, after you make this change, make sure it actually worked by 
forcing a password/interactive-only login attempt to the machine.  Make 
sure it fails and doesn&#39;t ask you for a password.  If you don&#39;t know how 
to do this, the
<a href="https://rachelbythebay.com/w/2021/03/10/sealed/">previous post</a>
contains info on that, including a terrible scanner script that belongs 
in the bottom of a cat box.
</p>
<p>
Enjoy.
</p>

  </body>
</html>
