<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://dustri.org/b/the-quest-for-a-family-friendly-password-manager.html">Original</a>
    <h1>The quest for a family-friendly password manager</h1>
    
    <div id="readability-page-1" class="page"><div>
      <p>With LastPass <a href="https://en.wikipedia.org/wiki/LastPass#Security_incidents">making a habit of getting
pwned</a>, I started to
look for a proper™ cloud-based password manager that I could recommend to
friends and family.</p>
<h2>Requirements</h2>
<ol>
<li>A non-lame security level, by a entity that won&#39;t crash and
   burn in 3 months, and whose sole interest is keeping their customer&#39;s
   passwords safe: managing passwords can&#39;t be a side-hustle.</li>
<li>Compromised passwords monitoring: I don&#39;t trust people to have used
   proper passwords before, and would like to make sure that they stop doing
   this.</li>
<li>Usable in a web browser, as well as on a smartphone: anything more complex
   than &#34;Or I can just put <code>azerty1234</code> in the password field and call it a
   day&#34; won&#39;t do.</li>
<li>Data should be exportable.</li>
</ol>
<p>Being open-source doesn&#39;t really matter, since supply-chain attacks are way
more likely than source-level backdooring. I don&#39;t know much about web browser
extension security, so those are off the scope this article.</p>
<h2>Cryptographic aparté</h2>
<p>To my disappointment (and mild horror), almost all password managers are using
<a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a>, which is known to be
completely suboptimal to store passwords, and has been for the last 15 years,
but it&#39;s apparently the only one without abysmal performance in Javascript.
<a href="https://soatok.com/">Soatok Dreamseeker</a> wrote <a href="https://soatok.blog/2022/12/29/what-we-do-in-the-etc-shadow-cryptography-with-passwords/">a great blogpost</a>
on the current state of the art with regard to &#34;cryptography with passwords&#34; if
you want to know more about what all the cool kids are using nowadays.</p>
<p>Anyway, using PBKDF2 is <em>lame</em> and has been for more than a decade, but with
the proper difficulty parameters, it might still be considered ok-ish.</p>
<p>Here is what the <a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html#pbkdf2">OWASP</a> recommends:</p>
<blockquote>
<ul>
<li>PBKDF2-HMAC-SHA512: 120,000 iterations</li>
<li>PBKDF2-HMAC-SHA256: 310,000 iterations</li>
<li>PBKDF2-HMAC-SHA1: 720,000 iterations</li>
</ul>
</blockquote>
<p><a href="https://twitter.com/Sc00bzT">Sc00bz</a>, who knows a thing or two about cracking
passwords (and about <a href="https://infosec.exchange/@sc00bz/109599415792124027">LastPass</a> too),
<a href="https://tobtu.com/minimum-password-settings/">recommends</a> as of
today around two times the OWASP&#39;s values:</p>
<blockquote>
<ul>
<li>PBKDF2-HMAC-SHA512: 210,000 iterations</li>
<li>PBKDF2-HMAC-SHA256: 600,000 iterations</li>
<li>PBKDF2-HMAC-SHA1: 1,300,000 iterations</li>
</ul>
</blockquote>
<p>But those values are for &#34;Password storage&#34;. For &#34;Password-based key derivation&#34;, aka what we want here,
<a href="https://soatok.blog/2022/12/29/what-we-do-in-the-etc-shadow-cryptography-with-passwords/">Soatok</a> has the following numbers:</p>
<blockquote>
<ul>
<li>PBKDF2-HMAC-SHA512: 2,100,000 iterations</li>
<li>PBKDF2-HMAC-SHA256: 6,000,000 iterations</li>
<li>PBKDF2-HMAC-SHA1: 13,000,000 iterations</li>
</ul>
</blockquote>
<p>But this obviously won&#39;t fly for smartphones, sigh.</p>
<h2>Candidates</h2>
<h3>Bitwarden</h3>
<p>This was my first choice, since it&#39;s <a href="https://github.com/bitwarden">open-source</a>
and even has an <a href="https://github.com/dani-garcia/vaultwarden">alternative server implementation</a>.
It <a href="https://bitwarden.com/help/what-encryption-is-used/">uses PBKDF2</a> with <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Cipher_block_chaining_(CBC)">AES-CBC</a>:</p>
<blockquote>
<p>The default iteration count used with PBKDF2 is 100,001 iterations on the
client (client-side iteration count is configurable from your account
settings), and then an additional 100,000 iterations when stored on our servers
(for a total of 200,001 iterations by default).</p>
</blockquote>
<p>This means that someone with read-access to the server before the second
iterations pass only has to bruteforce 100k iterations.
There is an <a href="https://github.com/bitwarden/server/issues/37">issue open</a>
(continued <a href="https://community.bitwarden.com/t/encryption-suggestions-including-argon2/350">here</a>)
since 2017 about moving from PBKDF2 to Argon2. Moreover, AES-CBC doesn&#39;t provide
integrity, which isn&#39;t critical here, but is still a worrying practise.</p>
<p>It has <a href="https://bitwarden.com/download/">various clients</a>, but all are written
in Typescript and running in Electron, meaning that they&#39;re equivalent to using
the web app, but absolutely worse. There is also a <a href="https://contributing.bitwarden.com/getting-started/clients/cli">command-line
interface</a>,
weighting 80MB, also in TypeScript, also in Electron. Amazing.</p>
<p>There is a bug bounty, but most reports <a href="https://hackerone.com/bitwarden/hacktivity">aren&#39;t public</a>
and there are no payouts. Their
<a href="https://bitwarden.com/help/is-bitwarden-audited/">audits</a> are either
compliance-related (GDPR, HIPAA, CCPA, …) or &#34;Network Security Assessment&#34;, aka
&#34;Run <a href="https://en.wikipedia.org/wiki/Nessus_(software)">Nessus</a> and generate a
report&#34;. So nobody was ever paid to audit the codebase and make the
vulnerabilities public beside some people at Bitwarden Inc.</p>
<p>[edit] They <a href="https://bitwarden.com/images/resources/2021-bitwarden-security-assessment-report.pdf">had an audit</a> in 2021,
but its scope is unclear: it seems that only the web interface of the server
was audited?</p>
<h3>1Password</h3>
<p>I think that it&#39;s LastPass&#39; direct competitor. According to their
<a href="https://1passwordstatic.com/files/security/1password-white-paper.pdf">whitepaper</a>,
they&#39;re using AES-256-GCM and PBKDF2-HMAC-SHA256 with 100,000 iterations.
Interestingly, to protect against weak passwords, there is also a
device-stored <a href="https://support.1password.com/secret-key-security/">secret key</a>
mixed with the password. This is a neat trick excusing the low number of
iterations. This adds complexity and I don&#39;t trust
people to not lose it; but odds are that everyone has a phone and a computer,
so this could act as a <em>backup</em>.</p>
<p>They&#39;re <a href="https://support.1password.com/secure-remote-password/">using</a> <a href="https://en.wikipedia.org/wiki/Secure_Remote_Password_protocol">SRP</a>
for authentication, which is not only <a href="https://blog.cryptographyengineering.com/should-you-use-srp/">known to be &#34;meh&#34; since 2008</a>
and <a href="https://tobtu.com/blog/2021/10/srp-is-now-deprecated/">deprecated since 2021</a>,
but also kinda useless except if the TLS connection to 1password.com is
compromised. In this case, odds are that you&#39;ve already lost, but why not.</p>
<p>They have a <a href="https://bugcrowd.com/agilebits">substantial bug bounty</a> up to
USD 1,000,000, but the reports <a href="https://bugcrowd.com/agilebits/crowdstream?filter=all">aren&#39;t public</a>.
They&#39;re also doing <a href="https://support.1password.com/security-assessments/">regular pentests</a>
of their various components by reputable firms.</p>
<h3>Dashlane</h3>
<p>Dash is the only one <a href="https://www.dashlane.com/download/whitepaper-en.pdf">using</a>
<a href="https://github.com/P-H-C/phc-winner-argon2/blob/master/README.md">Argon2d</a>,
the winner of the <a href="https://www.password-hashing.net">Password Hashing
Competition</a> held in 2015.</p>
<p>Unfortunately, their <a href="https://www.dashlane.com/resources/dashlane-zero-knowledge-security">choice of parameters</a> is 
on the low side:</p>
<blockquote>
<p>We use Argon2d, by default, with the following parameters: iterations = 3,
memory = 32Mo, parallelization = 2  We also support PBKDF2-SHA2 with 200,000
iterations. Then, the data is (en|de)crypted using AES CBC-HMAC mode.</p>
</blockquote>
<p>AES CBC-HMAC isn&#39;t a thing, what they&#39;re doing is AES-256-CBC then HMAC-SHA256
(and not <a href="https://en.wikipedia.org/wiki/CBC-MAC">CBC-MAC</a>), which is perfectly acceptable,
albeit using the same key for AES and HMAC feels shaky: an authenticated mode
should be used like
<a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">AES-GCM</a>, or another key
derivation to produce two subkeys, instead of using the same key for two
different purposes.</p>
<p>The intern who wrote their <a href="https://www.dashlane.com/resources/dashlane-zero-knowledge-security">whitepaper</a> had a confused
understanding of how https works: <a href="https://en.wikipedia.org/wiki/Online_Certificate_Status_Protocol">OCSP</a>
doesn&#39;t replace trust stores, key exchanges are more complex than &#34;the client encrypts a random number with the server’s public key and sends it to
the server, the server decrypts this number, and both sides use this number to generate a
symmetric key, used to encrypt and decrypt data.&#34;, …</p>
<p>Worryingly, their &#34;<a href="https://www.dashlane.com/resources/dashlane-zero-knowledge-security">benchmark of attempts to decrypt AES files</a>&#34;
is done on a &#34;4 cores Xeon 1.87GHz&#34;, which doesn&#39;t make sense: cracking a password doesn&#39;t mean going
through the whole keyspace of alphanumeric characters of a fixed length,
and nobody uses CPU to crack passwords, let alone a 4 cores one. I would expect
a firm in the business of protecting passwords to be up to date with the
current state of the art of password cracking.</p>
<p>They have a bug bounty with <a href="https://hackerone.com/dashlane?view_policy=true">payouts</a> up to USD 5,000
and <a href="https://hackerone.com/dashlane/hacktivity">no public reports</a>. The gpg key
that should be used to contact them is an RSA one of 1024 bits (worryingly
small in 2023), and belongs to someone called &#34;anish&#34;.</p>
<h3>NordPass</h3>
<p>Being from the spammy NordVPN people, I wouldn&#39;t put much trust in it.
Their handwavy <a href="https://nordpass.com/nordpass-business-whitepaper.pdf">whitepaper</a>
says that they&#39;re using:</p>
<ul>
<li>Argon2id, but without specifying the parameters, not why they chose this
    particular variant over another variant like Argon2d.</li>
<li><a href="https://en.wikipedia.org/wiki/ChaCha20-Poly1305#XChaCha20-Poly1305_%E2%80%93_extended_nonce_variant">XChaCha20-Poly1305</a>
    for encryption instead of AES because &#34;the performance of the latter heavily
    relies on the hardware features (such as the AES instruction set for
    x86 processors), which are rarely available on mobile devices&#34;.
    The whitepaper says they&#39;re using <a href="https://nacl.cr.yp.to">NaCl</a>,
    but it <a href="https://nacl.cr.yp.to/valid.html">doesn&#39;t provide XChaCha20</a>,
    and <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-xchacha">XChaCha20-Poly1305-IETF</a>
    is a draft which expired two years ago. So I thought that maybe they meant XSalsa20-Poly1305,
    which is implemented in NaCl, but apparently they&#39;re using xChaCha20
    <strong>and</strong> xSalsa20.</li>
</ul>
<p>There is also a bunch of public-key cryptography going on for sharing
material that surely isn&#39;t susceptible to any kind of MITM, and
metadata are stored in clear-text. Sounds like someone wanted the <em>very
bestest</em> cryptography but didn&#39;t really understand why.</p>
<p>They have a <a href="https://hackerone.com/nordsecurity">bug bounty</a> with payouts up to
USD 50,000 and <a href="https://hackerone.com/nordsecurity/hacktivity">some reports</a> are public.</p>
<h3>Keeper</h3>
<p>Their <a href="https://docs.keeper.io/enterprise-guide/keeper-encryption-model">website</a>
says AES-256-GCM and PBKDF2-SHA-256 (or maybe PBKDF2-SHA-512, it&#39;s unclear) with 100,000 rounds.</p>
<blockquote>
<p>All encrypted payloads sent to the Keeper servers are additionally wrapped by
a 256-bit AES transmission key in addition to TLS, to protect against MITM
attacks. The transmission key is generated on the client device and transferred
to the server using ECIES encryption via the server&#39;s public EC key.</p>
<p>A Master Password Key is derived from the Master Password using PBKDF2 and
used to unwrap the Data Key, which is then used to unwrap the Record Keys and
Folder Keys.  Record Keys are then used to decrypt the stored record
information in the vault.</p>
<p>A second PBKDF2 key is generated locally and then hashed with HMAC_SHA256 to derive an authentication token.</p>
<p>The vault data stored offline is AES-GCM encrypted with a 256-bit “Client
Key” that is generated randomly and protected by PBKDF2-HMAC-SHA512 with up to
100,000 iterations and a random salt.</p>
<p>KSI deploys TLS certificates signed by Digicert using the SHA2 algorithm, the
most secure signature algorithm currently offered by commercial certificate
authorities. SHA2 is significantly more secure than the more widely used SHA1,
which could be exploited due to mathematical weakness identified in the
algorithm. SHA2 helps protect against the issuance of counterfeit certificates
that could be used by an attacker to impersonate a website.</p>
<p>On the Keeper end-user client device, when BreachWatch is activated, a
HMAC_SHA512 hash is generated based on each stored password and sent to the
server.  On the server, a second hash is created using HMAC_SHA512 via the
Hardware Security Module (HSM) using a non-exportable key.  These
Hashes-of-Hashes are compared to determine if a password has been breached.</p>
</blockquote>
<p>This all sounds like bullshit/poor design resulting from a confusing threat model and terminology.</p>
<p>Apparently &#34;Keeper works with NCC Group and Cybertest to perform ongoing
vulnerability testing of the browser extension platform, which includes source
code level analysis.&#34;, but the reports aren&#39;t available.
They have a <a href="https://bugcrowd.com/keepersecurity">bug bounty</a>
with payouts up to USD 10,000, but there as well, <a href="https://bugcrowd.com/keepersecurity/crowdstream?filter=disclosures">reports aren&#39;t public</a>.</p>
<h3>Roboform</h3>
<p>According to their <a href="https://www.roboform.com/pdf/RoboForm_Security_White_Paper.pdf">whitepaper</a>
from 2018:</p>
<blockquote>
<p>Generation of AES encryption keys uses PBKDF2 (Password-Based Key Derivation
Function 2) algorithm with SHA-256 hash function and long random salt
(32-byte). PBKDF2 is an iterative algorithm with a sufficiently large number of
iterations (4,000 by default). A higher number of iterations provides greater protection against brute force
and dictionary attacks by not only slowing them down, but also by making
RoboForm Clients proportionally slower, especially on slow devices (Android,
iOS) or applications (RoboForm Online web site). Intentionally making a slow
algorithm is an accepted practice targeted at preventing dictionary attacks
against compromised authentication stores. This technique is called “key
strengthening” or “key stretching”.</p>
<p>We recommend increasing the length of the
Master Password instead of increasing the number of iterations as, according to
some researchers, the addition of two characters to the length of the password
is roughly equivalent to multiplying the number of iterations by 1,000 yet it
does not slow down the algorithm. A combination of 10,000 iterations and a
7-letter password is already insecure and it can be brute-forced relatively
quickly, as demonstrated some time ago on one of RoboForm’s competitor
products. Only the password hash derived from Master Password is shared with
the RoboForm Server. It is computationally infeasible to recover the user’s
Master Password or the AES-256 key from that password hash due to the one-way
nature of the algorithm used to generate it.</p>
<p>By nature, “Read” permission is only different from “Use” permission for the
Login RoboForm Data Objects. Without the “Read” permission, the Limited User
cannot view the contents of the Login type RoboForm Data Object. Combined
with the fact that most applications and websites mask the contents of the
password field, this option provides an additional control to conceal passwords
from the users. </p>
</blockquote>
<p>This is complete nonsensical keyword-oriented garbage. There is also MITM-by-design on the
between-users-data-sharing protocol. I haven&#39;t found how one should report
security issues to them.</p>
<h2>Enpass</h2>
<p>According to <a href="https://www.enpass.io/security/">their website</a>, they&#39;re using 100,000 rounds of PBKDF2-HMAC-SHA512
and <a href="https://www.zetetic.net/sqlcipher/design/">SQLCipher</a>, which uses AES-CBC
and HMAC-SHA512 under the hood, with different derived subkeys. Albeit Enpass&#39;
<a href="https://support.enpass.io/docs/security-whitepaper-enpass/vault.html">documentation</a>
mentions HMAC-SHA1 instead of HMAC-SHA512. Their threat model is a bit weird,
with <a href="https://support.enpass.io/docs/security-whitepaper-enpass/browser_extensions.html"><em>funky</em> security things</a> for their browser extensions
like:</p>
<blockquote>
<p>When a browser extension tries to connect to main Enpass App, we verify the
origin of the connection, it must be the unique identifier of our browser
extension and browser will not allow installation of any two extensions with
the same ID.</p>
</blockquote>
<p>I fail to see against what this is defending.</p>
<p>They also have a &#34;time-based verification code&#34; to prevent MITM for their
<a href="https://support.enpass.io/docs/security-whitepaper-enpass/Wi-Fi_Sync_Server.html">Wi-Fi Sync Server</a>,
which doesn&#39;t say much nor inspire confidence.</p>
<p>They had <a href="https://www.enpass.io/security-audit-report/">some security audits</a>
last year for their Windows App and backend,
in which we discover that their server is written in cpp but with calls to
<code>malloc</code>,
with files like <code>httpserver.cpp</code> and functions like <code>file_upload_cb</code>,
meaning that they implemented their own http stack. Interestingly, they don&#39;t
provide synchronisation: it&#39;s up to the user to use either iCloud, Dropbox,
Google Drive, OneDrive, or WebDAV, even <a href="https://support.enpass.io/business/kb/microsoft_365_integration_with_enpass_business.htm">for businesses</a>.</p>
<p>Despite the report mentioning that their CSP policy might benefit from some
tightening, it&#39;s still useless:</p>
<div><pre><span></span><code><span>curl</span><span> </span><span>-s</span><span> </span><span>-I</span><span> </span><span>https</span><span>://</span><span>console</span><span>.</span><span>enpass</span><span>.</span><span>io</span><span> </span><span>|</span><span> </span><span>grep</span><span> </span><span>-i</span><span> </span><span>content-security-policy</span><span>:</span>
<span>content-security-policy</span><span>:</span><span> </span><span>default-src</span><span> </span><span>&#39;self&#39;</span><span>;</span><span> </span><span>font-src</span><span> </span><span>&#39;self&#39;</span><span> </span><span>fonts</span><span>.</span><span>gstatic</span><span>.</span><span>com</span><span>;</span><span> </span><span>img-src</span><span> </span><span>&#39;self&#39;</span><span> </span><span>d1f8f9xcsvx3ha</span><span>.</span><span>cloudfront</span><span>.</span><span>net</span><span> </span><span>enpass</span><span>.</span><span>onfastspring</span><span>.</span><span>com</span><span> </span><span>license-enpass-io</span><span>.</span><span>s3</span><span>.</span><span>amazonaws</span><span>.</span><span>com</span><span> </span><span>https</span><span>://</span><span>i</span><span>.</span><span>ytimg</span><span>.</span><span>com</span><span>/</span><span>vi_webp</span><span>/</span><span>96FY_bKQGrU</span><span>/</span><span>mqdefault</span><span>.</span><span>webp</span><span> </span><span>data</span><span>:</span><span> </span><span>w3</span><span>.</span><span>org</span><span>/</span><span>svg</span><span>/</span><span>2000</span><span>;</span><span> </span><span>script-src</span><span> </span><span>&#39;self&#39;</span><span> </span><span>&#39;unsafe-inline&#39;</span><span> </span><span>d1f8f9xcsvx3ha</span><span>.</span><span>cloudfront</span><span>.</span><span>net</span><span>;</span><span>connect-src</span><span> </span><span>license</span><span>.</span><span>enpass</span><span>.</span><span>io</span><span> </span><span>enpass</span><span>.</span><span>onfastspring</span><span>.</span><span>com</span><span> </span><span>d1f8f9xcsvx3ha</span><span>.</span><span>cloudfront</span><span>.</span><span>net</span><span>;</span><span>style-src</span><span> </span><span>&#39;self&#39;</span><span> </span><span>&#39;unsafe-inline&#39;</span><span> </span><span>fonts</span><span>.</span><span>googleapis</span><span>.</span><span>com</span><span>;</span><span> </span><span>frame-src</span><span> </span><span>&#39;self&#39;</span><span> </span><span>enpass</span><span>.</span><span>onfastspring</span><span>.</span><span>com</span><span> </span><span>youtube</span><span>.</span><span>com</span><span> </span><span>www</span><span>.</span><span>youtube</span><span>.</span><span>com</span><span>;</span><span>frame-ancestors</span><span> </span><span>&#39;self&#39;</span>
</code></pre></div>

<p>They don&#39;t seem to have a bug bounty.</p>
<h2>Conclusion</h2>
<ul>
<li><a href="https://1password.com">1Password</a> if your friends and family are smart enough to not permanently lose their
  &#34;secret key&#34;, and/or have multiple devices. They seems to be known what
  they&#39;re doing crypto-wise with their trick to mitigate their low amount of
  derivation rounds, are spending money doing regular technical audits
  and have a significant bug bounty cash prize. I think it&#39;s the right choice
  if you want a ton of features and security.</li>
<li><a href="https://bitwarden.com/">Bitwarden</a> if you prefer open-source, a small
  company, and simple things. Just make sure to <a href="https://vault.bitwarden.com/#/settings/security/security-keys">bump the number of
  iterations</a>.</li>
<li><a href="https://www.dashlane.com">Dashlane</a> if you don&#39;t like 1Password.</li>
</ul>
<p>Everything else is either looking shaky, lacking features that I want, or
simply absolutely horrible.</p>
    </div></div>
  </body>
</html>
