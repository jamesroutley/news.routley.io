<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.mux.com/blog/how-content-moderation-rescued-750k-in-unpaid-invoices-from-soccer-pirates">Original</a>
    <h1>We glued together content moderation to stop soccer pirates</h1>
    
    <div id="readability-page-1" class="page"><div><p>If you had asked me two years ago which sport a video startup needs to be most worried about, I would have said American football or basketball. My US-centric mind would never have considered that soccer would be the darling sport of stream pirates. It wasn’t until I joined Mux that I found out how much people love soccer…and how much they love to watch soccer for free. Streaming video on Mux is easy — which is a good thing! Unfortunately, that means we are a popular target for soccer pirates.</p><p>Enter the abuse detection system: our homegrown solution to identify and take down soccer pirates who try to stream copyrighted content via Mux&#39;s infrastructure without permission from the rights holder.</p><h2 id="log-storage-and-selection"><a href="#log-storage-and-selection"><span></span><span><svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" fill="none" viewBox="0 0 42 42"><path d="m18.172 15.343 3.535-3.535a5 5 0 0 1 7.071 0l1.414 1.414a5 5 0 0 1 0 7.07l-3.535 3.536M23.828 26.657l-3.535 3.535a5 5 0 0 1-7.071 0l-1.414-1.414a5 5 0 0 1 0-7.07l3.535-3.536" vector-effect="non-scaling-stroke"></path><path stroke-linecap="round" d="m25.243 16.757-8.486 8.486" vector-effect="non-scaling-stroke"></path></svg><span>Link42Icon</span></span>Log storage and selection<!-- --> <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" fill="none" viewBox="0 0 42 42"><path d="m18.172 15.343 3.535-3.535a5 5 0 0 1 7.071 0l1.414 1.414a5 5 0 0 1 0 7.07l-3.535 3.536M23.828 26.657l-3.535 3.535a5 5 0 0 1-7.071 0l-1.414-1.414a5 5 0 0 1 0-7.07l3.535-3.536" vector-effect="non-scaling-stroke"></path><path stroke-linecap="round" d="m25.243 16.757-8.486 8.486" vector-effect="non-scaling-stroke"></path></svg><span>Link42Icon</span></a></h2><p>Our journey starts at the edge. We deliver all our videos through two CDNs (Fastly and Cloudflare). For each request we send, the CDNs provide us a record of that request. Each of these records gets enriched with more data in our CDN logs pipeline. At the end of that system, the records are inserted into a <a href="https://clickhouse.com/clickhouse">ClickHouse</a> cluster. Originally, the ClickHouse cluster was used only for debugging purposes. With minimal changes, we were able to use the same data and ClickHouse cluster for abuse detection as well.</p><p>The logs include a lot of useful information, but the abuse detection system only cares about three things: which asset the log corresponds to, when the asset was viewed, and how the system can access the asset.</p><p>Next, we have a small Go program that is designed to query the CDN log data stored in ClickHouse every 10 minutes. These queries generate a list of assets and environments that had high viewership in the last 20 minutes. The program then runs follow-up queries to identify any <a href="https://brian.abelson.live/blog/introducing-custom-domains">custom domains</a> associated with the environment, and also checks to see if the asset is public or <a href="https://brian.abelson.live/blog/securing-video-content-with-signed-urls">signed</a>. This information will determine how the video is accessed later in the system.</p><p>For each video in the list, we then do a lookup of the customer. The Go program uses customer data to assign each video a risk score. Some of the obvious risk factors include:</p><ul><li>How old is the customer account (older is better)?</li><li>Do they pay their bills on time?</li><li>Is the email address suspicious looking? </li></ul><p>These factors, plus several others, go into assigning a risk score before n8n takes over for filtering and notification.</p><h2 id="abuse-detection-and-alerting"><a href="#abuse-detection-and-alerting"><span></span><span><svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" fill="none" viewBox="0 0 42 42"><path d="m18.172 15.343 3.535-3.535a5 5 0 0 1 7.071 0l1.414 1.414a5 5 0 0 1 0 7.07l-3.535 3.536M23.828 26.657l-3.535 3.535a5 5 0 0 1-7.071 0l-1.414-1.414a5 5 0 0 1 0-7.07l3.535-3.536" vector-effect="non-scaling-stroke"></path><path stroke-linecap="round" d="m25.243 16.757-8.486 8.486" vector-effect="non-scaling-stroke"></path></svg><span>Link42Icon</span></span>Abuse detection and alerting<!-- --> <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" fill="none" viewBox="0 0 42 42"><path d="m18.172 15.343 3.535-3.535a5 5 0 0 1 7.071 0l1.414 1.414a5 5 0 0 1 0 7.07l-3.535 3.536M23.828 26.657l-3.535 3.535a5 5 0 0 1-7.071 0l-1.414-1.414a5 5 0 0 1 0-7.07l3.535-3.536" vector-effect="non-scaling-stroke"></path><path stroke-linecap="round" d="m25.243 16.757-8.486 8.486" vector-effect="non-scaling-stroke"></path></svg><span>Link42Icon</span></a></h2><p><a href="https://n8n.io/">N8n</a> is a node-based workflow automation tool. Workflows are made up of one or more building blocks — or nodes — each of which performs a specific function. N8n has a catalog of <a href="https://docs.n8n.io/integrations/builtin/">prebuilt nodes</a> as well as support for creating your own custom nodes. We picked n8n because of the quick development time and its easy-to-debug nature. We could have built this part of the system in Go or a different language, but by using n8n’s premade <a href="https://docs.n8n.io/workflows/components/nodes/">nodes</a>, we were able to build our workflows at an incredible speed. N8n also lets us visualize our workflows in a way a program built from scratch would not. We even have a workflow that gets triggered on errors and posts a link in Slack to the node that errored. By leveraging n8n, we have been able to create a set of abuse detection workflows.</p><p>We have two major workflows in n8n.</p><p>First is our soccer detection workflow. For each video sent to this workflow, we generate four thumbnails taken from somewhat random points in the video. The thumbnails are then sent to <a href="https://cloud.google.com/vision">Google Vision</a>, which produces a list of labels describing the thumbnails. Those labels are then compared to the following list of words.</p><div><figure><pre><code><span></span><span>&#34;sports uniform&#34;</span>,
<span></span><span>&#34;soccer&#34;</span>,
<span></span><span>&#34;football&#34;</span>,
<span></span><span>&#34;jersey&#34;</span>,
<span></span><span>&#34;player&#34;</span>,
<span></span><span>&#34;ball&#34;</span>,
<span></span><span>&#34;field house&#34;</span>,
<span></span><span>&#34;ball game&#34;</span></code></pre></figure></div><p>If a word in our list matches a word in the list Google Vision sends us, then we have a potential soccer stream that needs to be further reviewed. The word list we use is intentionally broad. This can lead to the system flagging assets that are clearly not soccer as soccer. But we would rather generate false positives than potentially miss a real soccer pirate.</p><p>Once n8n has identified a stream that may be showing a soccer game, it creates a Slack message and an alert in Opsgenie.</p><p>Our second major n8n workflow is our high traffic workflow. This is not specific to soccer content. Instead, it is designed to identify and show us videos that have a higher than average viewership count. The asset’s risk score, viewership count, and viewership behavior are checked in the n8n workflow. If each meets a certain threshold, then a Slack message is created. If the asset is VoD, then the Slack message will include a storyboard link. If the asset is a live stream, the message will instead have 4 thumbnails.</p><h2 id="taking-action"><a href="#taking-action"><span></span><span><svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" fill="none" viewBox="0 0 42 42"><path d="m18.172 15.343 3.535-3.535a5 5 0 0 1 7.071 0l1.414 1.414a5 5 0 0 1 0 7.07l-3.535 3.536M23.828 26.657l-3.535 3.535a5 5 0 0 1-7.071 0l-1.414-1.414a5 5 0 0 1 0-7.07l3.535-3.536" vector-effect="non-scaling-stroke"></path><path stroke-linecap="round" d="m25.243 16.757-8.486 8.486" vector-effect="non-scaling-stroke"></path></svg><span>Link42Icon</span></span>Taking action<!-- --> <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" fill="none" viewBox="0 0 42 42"><path d="m18.172 15.343 3.535-3.535a5 5 0 0 1 7.071 0l1.414 1.414a5 5 0 0 1 0 7.07l-3.535 3.536M23.828 26.657l-3.535 3.535a5 5 0 0 1-7.071 0l-1.414-1.414a5 5 0 0 1 0-7.07l3.535-3.536" vector-effect="non-scaling-stroke"></path><path stroke-linecap="round" d="m25.243 16.757-8.486 8.486" vector-effect="non-scaling-stroke"></path></svg><span>Link42Icon</span></a></h2><p>Once an alert is generated from either the high traffic or soccer detection workflow, a Slack message is created. These Slack messages are sent to a channel monitored by a team of contractors. The Slack message contains all the info we can provide to help determine if the video appears to violate our Terms of Service. The most useful data is the storyboard and the top referrers. The storyboard lets us see the content of the video without watching it. And the referrers can be powerful clues to help us determine whether a steam is legit. If the top referrers look like this</p><p>then there is a good chance it&#39;s a soccer pirate.</p><p>The contractor can escalate or silence the alert using the buttons on the Slack message. If it is a false positive, they will press “Silence,” which activates another n8n workflow that adds the asset to an allowlist, so it won’t alert again. The workflow also closes the Opsgenie alert. If the contractor believes the video may be in violation of our TOS or needs help making a determination, they will press “Escalate.” After pressing escalate or taking no action for five minutes, an alert is sent to a full-time Mux employee.</p><p>From there, the Mux employee has a couple options open to them. First, the employee will look at the Slack alert and evaluate the information for themselves. Much of the time, the Mux employee will have enough context about the customer to be able to make a determination by just looking at it. The employee can also reach out to a trusted customer to confirm that they have the rights to show the video. If the customer does have the rights to stream the video, then we can add the video to an allowlist so it does not alert again. If the customer can&#39;t provide confirmation that they have rights to the content, we can work with them to stop the stream. Finally, if the customer is a repeat offender that is uncooperative, we have policies around disabling their account.</p><p>By leveraging our abuse detection system, we have been able to cut down on the number of takedown requests we receive. Before the system was created, it was not uncommon for us to receive quite a few takedown requests in a month. Now we&#39;re pretty surprised when we receive a single request. On top of that, the system has saved us quite a bit of money. This may come as a shock, but soccer pirates tend to not pay their bills. That, combined with the fact that these streams usually have large viewership, means we incur a not insignificant cost and have no one to bill. In 2021 alone, Mux had over $750,000 in unpaid invoices due to suspected pirated streams. For an infrastructure company like Mux, this comes with hard costs. Transcoding, storing, and delivering video is not cheap. If pirated streams were not held in check, they could quickly spiral out of control and have a significant negative impact on our business. By doing our best to identify and shut down these streams, we are able to reduce our costs. The abuse detection system also provides other less tangible benefits, such as preserving our reputation. Mux doesn’t want to be known as a safe platform for soccer pirates, and our customers don&#39;t want to be associated with soccer piracy either. By investing in this system, we show customers that we take content moderation seriously.</p></div><div><p><h3>Subscribe to the Mux newsletter</h3></p></div></div>
  </body>
</html>
