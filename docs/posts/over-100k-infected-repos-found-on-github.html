<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://apiiro.com/blog/malicious-code-campaign-github-repo-confusion-attack/">Original</a>
    <h1>Over 100k Infected Repos Found on GitHub</h1>
    
    <div id="readability-page-1" class="page"><div>
                    
<p>Our security research and data science teams detected a resurgence of a malicious repo confusion campaign that began mid-last year, this time on a much larger scale. The attack impacts more than 100,000 GitHub repositories (and presumably millions) when unsuspecting developers use repositories that resemble known and trusted ones but are, in fact, infected with malicious code.¬†</p>



<h2 id="h-how-do-repo-confusion-attacks-happen-nbsp">How do repo confusion attacks happen?¬†</h2>



<p>Similar to dependency confusion attacks, malicious actors get their target to download their malicious version instead of the real one. But dependency confusion attacks take advantage of how package managers work, while repo confusion attacks simply rely on humans to mistakenly pick the malicious version over the real one, sometimes employing social engineering techniques as well.¬†</p>



<p>In this case, in order to maximize the chances of infection, the malicious actor is flooding GitHub with malicious repos, following these steps:</p>



<ol>
<li>Cloning existing repos (for example: TwitterFollowBot, WhatsappBOT, discord-boost-tool, Twitch-Follow-Bot, and hundreds more).</li>



<li>Infecting them with malware loaders.</li>



<li>Uploading them back to GitHub with identical names.¬†</li>



<li>Automatically forking each thousands of times.¬†</li>



<li>Covertly promoting them across the web via forums, discord, etc.</li>
</ol>



<h2 id="h-what-happens-when-the-malicious-repos-are-in-use">What happens when the malicious repos are in use?</h2>



<p>Once unsuspecting developers use any of the malicious repos, the hidden payload unpacks seven layers of obfuscation, which also involves pulling malicious Python code and later a binary executable. The malicious code (largely a modified version of <a href="https://github.com/Inplex-sys/BlackCap-Grabber-NoDualHook?tab=readme-ov-file#-%E3%80%A2-features">BlackCap-Grabber</a>) would then collect login credentials from different apps, browser passwords and cookies, and other confidential data. It then sends it back to the malicious actors‚Äô C&amp;C (command-and-control) server and performs a long series of additional malicious activities.</p>



<figure><img decoding="async" src="https://apiiro.com/wp-content/uploads/2024/02/banana4.gif" alt=""/></figure>



<h2 id="The-automation-effects-on-GitHub">The automation effects on GitHub</h2>



<p>Most of the forked repos are quickly removed by GitHub, which identifies the automation. However, the automation detection seems to miss many repos, and the ones that were uploaded manually survive. Because the whole attack chain seems to be mostly automated on a large scale, the 1% that survive still amount to thousands of malicious repos. You can check out a small portion of the current wave yourself by simply searching the following in GitHub: <a href="https://github.com/search?q=%F0%9F%94%A5+2024+language%3Apython&amp;type=repositories&amp;s=updated&amp;o=desc"><em>üî• 2024 language:python</em></a>.</p>



<figure><img fetchpriority="high" decoding="async" width="1024" height="277" src="https://apiiro.com/wp-content/uploads/2024/02/image-12-1024x277.png" alt="" srcset="https://apiiro.com/wp-content/uploads/2024/02/image-12-1024x277.png 1024w, https://apiiro.com/wp-content/uploads/2024/02/image-12-300x81.png 300w, https://apiiro.com/wp-content/uploads/2024/02/image-12-768x208.png 768w, https://apiiro.com/wp-content/uploads/2024/02/image-12-1536x415.png 1536w, https://apiiro.com/wp-content/uploads/2024/02/image-12.png 2028w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Counting the removed ones, the number of repos reaches millions. Usually the removal happens a few hours after the upload, so it‚Äôs challenging to document them. We know the removal is automated because many of the original ones still exist, and it mainly targets the fork bombs. For example, <a href="https://github.com/Mattia69?tab=repositories">here</a> you can see thousands of forks appear in the summary but <a href="https://github.com/Mattia69/discord-vanity-sniper/forks">none in the details</a>.</p>



<figure><img decoding="async" src="https://apiiro.com/wp-content/uploads/2024/02/fork-bombs.gif" alt=""/></figure>



<p>Because of the operation‚Äôs large scope, this campaign has a sort of 2nd-order social engineering network effect when, every now and then, naive users fork the malicious repos without realizing they are spreading malware. Kind of ironic to see it spreading by humans after such heavy reliance on automation.</p>



<h2 id="h-when-did-the-campaign-start">When did the campaign start?</h2>



<p>Here is a brief history of this malicious campaign:</p>



<p><strong>May 2023: </strong>As <a href="https://blog.phylum.io/respawning-malware-persists-on-pypi/">originally reported by Phylum</a>, several malicious packages were uploaded to PyPI containing early parts of the current payload. These packages were spread by ‚Äò<em>os.system(‚Äúpip install package‚Äù)</em>‚Äô calls planted in forks of popular GitHub repos, such as ‚Äòchatgpt-api‚Äô.¬†</p>



<p><strong>July ‚Äì August 2023: </strong>Several malicious repos were uploaded to GitHub, this time delivering the payload directly instead of through importing PyPI packages. This came after PyPI removed the malicious packages, and the security community increased its focus there. Aliakbar Zahravi and Peter Girnus from Trend Micro published <a href="https://www.trendmicro.com/en_be/research/23/j/infection-techniques-across-supply-chains-and-codebases.html">a great technical analysis of it</a>.</p>



<p><strong>November 2023 ‚Äì Now: </strong>We have detected more than 100,000 repos containing similar malicious payloads, and the number keeps growing. <strong>This attack approach has several advantages:</strong></p>



<ul>
<li>GitHub is huge, therefore despite the large number of instances, their relative portion is still insignificant and thus hard to detect.</li>



<li>Package managers are not involved as before, therefore explicit malicious package names are not mentioned, so that‚Äôs one less indicator.</li>



<li>The targeted repos are in a small niche and have low popularity, making it easier for unsuspecting developers to make the mistake and clone their malicious impersonators.</li>
</ul>



<figure><img decoding="async" width="873" height="455" src="https://apiiro.com/wp-content/uploads/2024/02/Malicious-Package-Timeline.png" alt="" srcset="https://apiiro.com/wp-content/uploads/2024/02/Malicious-Package-Timeline.png 873w, https://apiiro.com/wp-content/uploads/2024/02/Malicious-Package-Timeline-300x156.png 300w, https://apiiro.com/wp-content/uploads/2024/02/Malicious-Package-Timeline-768x400.png 768w" sizes="(max-width: 873px) 100vw, 873px"/></figure>



<h2 id="h-the-transition-of-malware-from-package-managers-to-scms">The transition of malware from package managers to SCMs</h2>



<p>Judging by the many incidents we have observed in package managers and SCM platforms, the transition of this campaign from malicious packages in PyPI to malicious GitHub repos seems to reflect a general trend. It seems that nowadays, the security community puts extra focus on package managers, so that was to be expected.</p>



<p>The ease of automatic generation of accounts and repos on GitHub and alike, using comfortable APIs and soft rate limits that are easy to bypass, combined with the huge number of repos to hide among, make it <strong>a perfect target for covertly infecting the software supply chain.</strong></p>



<p>This campaign, along with dependency confusion campaigns plaguing package registries and generally malicious code being spread through source control managers, demonstrates how fragile software supply chain security is, despite the abundance of tools and available security mechanisms.</p>



<h2 id="h-how-to-protect-yourself-against-repo-confusions">How to protect yourself against repo confusions</h2>



<p>GitHub was notified, and most of the malicious repos were deleted, but the campaign continues, and attacks that attempt to inject malicious code into the supply chain are becoming increasingly prevalent. There are countless solutions for catching malware at the system and network levels, but the supply chain remains a massive and lucrative attack surface for malicious actors.</p>



<p>At Apiiro, we‚Äôve built a malicious code detection system that monitors any connected codebases. We then detect attacks by using deep code analysis using multiple advanced techniques: <a href="https://apiiro.com/blog/llm-code-pattern-malicious-package-detection/">LLM-based code analysis</a>, deconstruction of the code into a complete execution flow graph, an elaborate heuristics engine, dynamic decoding, decryption, and deobfuscation, and more, so it‚Äôs very hard to fool it.</p>



<p>Without monitoring your code for injected malicious payloads, the security of your whole organization is determined by things like the ability of your developers to not choose the wrong repo, which is almost identical, not having a single CI/CD misconfiguration, having 100% secure 3rd party code, and other impossible conditions. That‚Äôs where Apiiro‚Äôs <a href="https://apiiro.com/product/aspm/">deep application security posture management (ASPM)</a> platform comes in, going beyond typical vulnerability detection and ingestion to surface the next generation of software supply chain and application risks.</p>
                </div></div>
  </body>
</html>
