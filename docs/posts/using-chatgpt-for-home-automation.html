<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.atomic14.com/2023/05/14/is-this-the-future-of-home-automation.html">Original</a>
    <h1>Using ChatGPT for home automation</h1>
    
    <div id="readability-page-1" class="page"><div role="main">
      <article>
        
        <div>
          <p>
            Article Image
          </p>
          <p>
            Article Image
          </p>
          
        </div>
        
        <section>
          
          <p><span></span> read
          </p>
          <a name="topofpage"></a>
          <div>
            <p><a href="https://www.youtube.com/c/atomic14" title="Watch my videos!" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://www.patreon.com/atomic14" title="Help support me on Patreon!" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://twitter.com/mrbananas" title="Follow me on twitter" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://www.facebook.com/atomic14Videos" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://github.com/atomic14" title="Fork me on github" "="">
          <i></i>
        </a>
          ·  
    
  
  <a href="https://www.atomic14.com/index.html">Posts</a>  ·  
  <a href="https://www.atomic14.com/videos/index.html">Videos</a>  ·  
  <a href="https://www.atomic14.com/support/index.html">Support</a>
</p>
          </div>
          
          <div>
            <p><small>
                HELP <a href="https://www.atomic14.com/support/index.html">SUPPORT</a> MY WORK: If you&#39;re feeling flush then please stop by <a href="https://www.patreon.com/atomic14">Patreon</a> Or you can make a one off donation via <a href="https://ko-fi.com/atomic14">ko-fi</a>
              </small>
            </p>
            <p>I’ve been creating ChatGPT plugins and started thinking - wouldn’t it be fun to connect this to a Raspberry Pi and control some hardware? Turns out, it’s very easy to do.</p>

<p>You can watch a video of this article here:</p>

<lite-youtube videoid="BeJVv0pL5kY" playlabel="Adding Memory To ChatGPT"></lite-youtube>

<p>ChatGPT plugins are surprisingly simple. They are just standard Web APIs - no different from any other API you might write or call. My particular plugin is really basic. It has just two endpoints.</p>

<p>One returns a list of lights. The other toggles a light on and off.</p>

<p>I’ve set up my little demo with 5 lights:</p>

<ul>
  <li>Kitchen</li>
  <li>Bedroom</li>
  <li>Dining table lamp</li>
  <li>Bathroom</li>
  <li>Lounge</li>
</ul>

<p>It’s worth watching the video as it’s pretty cool. We just say to ChatGPT, “let there be light,” and it switches on all the lights connected to my Raspberry Pi.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-14/all-lights-on.webp" alt="All the lights turn on"/></p>

<p>What’s really impressive is that the only thing ChatGPT has to work with are a few hints describing the plugin in free text and the OpenAPI yaml file. From that, it figures out that it needs to first get the list of lights, and then it needs to loop through the lights and toggle them on.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-14/sequence-diagram.webp" alt="ChatGPT Sequence Diagram"/></p>

<p>Now, I say “figured out” but I’m not going to claim that it’s thinking or reasoning about the world - that would be a big stretch. But I am going to claim that it’s pretty incredible.</p>

<p>We can even run through a really simple home automation scenario.</p>

<ul>
  <li>I’ve just woken up - it turns on the bedroom light</li>
  <li>Time to shower - it turns on the bathroom light and turns off the bedroom light</li>
  <li>Time for breakfast - it turns on the kitchen light and turns off the bathroom light</li>
  <li>I’m off to work - it turns off all the lights</li>
  <li>I’m back from work with takeout - it turns on the dining table light</li>
  <li>Time to relax - it turns on the lounge light</li>
  <li>Time for bed - it turns on the bedroom light</li>
</ul>

<p>I then tried something a bit different. I pretended to be another device in the bedroom that could detect sounds and told ChatGPT that I could hear snoring. It then turned off the bedroom light and wished me goodnight.</p>

<p>Now obviously, this is a really straightforward demonstration, but to me, the possibilities are quite mind-boggling.</p>

<p>I could see large language models being an interesting way to connect a whole bunch of different systems and services together. There are a ton of poorly designed APIs out there, and integrating them is a nightmare.</p>

<p>Wouldn’t it be funny if we ended up with computers talking to each other using human language instead of APIs?</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-14/brave-new-world.webp" alt="Brave New World"/></p>

<p>One of the things that I really enjoyed about this project (apart from the fact that it worked!) was that I didn’t have to write much code at all - I was able to get ChatGPT to generate all the code.</p>

<p>This is the prompt I used:</p>

<div><div><pre><code>Write me a Python Flask API to run on a Raspberry Pi and control some lights attached to GPIO pins.

I have the following lights:

Kitchen: pin 6
Bedroom: pin 13
Dining table: pin 19
Bathroom: pin 26
Lounge: pin 5

I want the following endpoints:

get lights - returns the list of lights along with their current state
post toggle_light - switches a light on or off
</code></pre></div></div>

<p>I asked it to make a Flask API - I used this as I’m most familiar with it so I could check what ChatGPT outputs. As always with these Large Language Models, it’s definitely a case of “Trust, but verify”.</p>

<p>I told it that it was running on a Raspberry Pi and that there were lights connected to GPIO pins.</p>

<p>And I gave it the list of lights along with the pin numbers.</p>

<p>I then gave it a very vague spec for the endpoints I wanted.</p>

<p>With that basic spec, I was able to get ChatGPT to generate the code for me. I added on a bunch of bells and whistles afterwards, but the core of the API was generated by ChatGPT.</p>

<div><div><pre><code><span>from</span> <span>flask</span> <span>import</span> <span>Flask</span><span>,</span> <span>request</span><span>,</span> <span>jsonify</span>
<span>import</span> <span>RPi.GPIO</span> <span>as</span> <span>GPIO</span>

<span>app</span> <span>=</span> <span>Flask</span><span>(</span><span>__name__</span><span>)</span>

<span># GPIO setup
</span><span>GPIO</span><span>.</span><span>setmode</span><span>(</span><span>GPIO</span><span>.</span><span>BCM</span><span>)</span>
<span>GPIO</span><span>.</span><span>setwarnings</span><span>(</span><span>False</span><span>)</span>

<span># Define your lights
</span><span>lights</span> <span>=</span> <span>{</span>
    <span>&#34;Kitchen&#34;</span><span>:</span> <span>{</span><span>&#34;pin&#34;</span><span>:</span> <span>6</span><span>,</span> <span>&#34;state&#34;</span><span>:</span> <span>GPIO</span><span>.</span><span>LOW</span><span>},</span>
    <span>&#34;Bedroom&#34;</span><span>:</span> <span>{</span><span>&#34;pin&#34;</span><span>:</span> <span>13</span><span>,</span> <span>&#34;state&#34;</span><span>:</span> <span>GPIO</span><span>.</span><span>LOW</span><span>},</span>
    <span>&#34;Dining table&#34;</span><span>:</span> <span>{</span><span>&#34;pin&#34;</span><span>:</span> <span>19</span><span>,</span> <span>&#34;state&#34;</span><span>:</span> <span>GPIO</span><span>.</span><span>LOW</span><span>},</span>
    <span>&#34;Bathroom&#34;</span><span>:</span> <span>{</span><span>&#34;pin&#34;</span><span>:</span> <span>26</span><span>,</span> <span>&#34;state&#34;</span><span>:</span> <span>GPIO</span><span>.</span><span>LOW</span><span>},</span>
    <span>&#34;Lounge&#34;</span><span>:</span> <span>{</span><span>&#34;pin&#34;</span><span>:</span> <span>5</span><span>,</span> <span>&#34;state&#34;</span><span>:</span> <span>GPIO</span><span>.</span><span>LOW</span><span>},</span>
<span>}</span>

<span># Setup pins
</span><span>for</span> <span>light</span> <span>in</span> <span>lights</span><span>.</span><span>values</span><span>():</span>
    <span>GPIO</span><span>.</span><span>setup</span><span>(</span><span>light</span><span>[</span><span>&#39;pin&#39;</span><span>],</span> <span>GPIO</span><span>.</span><span>OUT</span><span>)</span>
    <span>GPIO</span><span>.</span><span>output</span><span>(</span><span>light</span><span>[</span><span>&#39;pin&#39;</span><span>],</span> <span>GPIO</span><span>.</span><span>LOW</span><span>)</span>


<span>@</span><span>app</span><span>.</span><span>route</span><span>(</span><span>&#39;/lights&#39;</span><span>,</span> <span>methods</span><span>=</span><span>[</span><span>&#39;GET&#39;</span><span>])</span>
<span>def</span> <span>get_lights</span><span>():</span>
    <span>return</span> <span>jsonify</span><span>(</span><span>lights</span><span>)</span>


<span>@</span><span>app</span><span>.</span><span>route</span><span>(</span><span>&#39;/toggle_light&#39;</span><span>,</span> <span>methods</span><span>=</span><span>[</span><span>&#39;POST&#39;</span><span>])</span>
<span>def</span> <span>toggle_light</span><span>():</span>
    <span>data</span> <span>=</span> <span>request</span><span>.</span><span>get_json</span><span>()</span>
    <span>light</span> <span>=</span> <span>data</span><span>.</span><span>get</span><span>(</span><span>&#39;light&#39;</span><span>)</span>
    
    <span>if</span> <span>light</span> <span>not</span> <span>in</span> <span>lights</span><span>:</span>
        <span>return</span> <span>{</span><span>&#34;error&#34;</span><span>:</span> <span>&#34;Light not found&#34;</span><span>},</span> <span>404</span>

    <span># Toggle light
</span>    <span>lights</span><span>[</span><span>light</span><span>][</span><span>&#39;state&#39;</span><span>]</span> <span>=</span> <span>GPIO</span><span>.</span><span>HIGH</span> <span>if</span> <span>lights</span><span>[</span><span>light</span><span>][</span><span>&#39;state&#39;</span><span>]</span> <span>==</span> <span>GPIO</span><span>.</span><span>LOW</span> <span>else</span> <span>GPIO</span><span>.</span><span>LOW</span>
    <span>GPIO</span><span>.</span><span>output</span><span>(</span><span>lights</span><span>[</span><span>light</span><span>][</span><span>&#39;pin&#39;</span><span>],</span> <span>lights</span><span>[</span><span>light</span><span>][</span><span>&#39;state&#39;</span><span>])</span>

    <span>return</span> <span>{</span><span>&#34;success&#34;</span><span>:</span> <span>f</span><span>&#34;</span><span>{</span><span>light</span><span>}</span><span> toggled&#34;</span><span>},</span> <span>200</span>


<span>if</span> <span>__name__</span> <span>==</span> <span>&#34;__main__&#34;</span><span>:</span>
    <span>app</span><span>.</span><span>run</span><span>(</span><span>host</span><span>=</span><span>&#39;0.0.0.0&#39;</span><span>,</span> <span>port</span><span>=</span><span>5000</span><span>)</span>
</code></pre></div></div>

<p>The other thing that is needed for a ChatGPT plugin is an OpenAPI or Swagger file - these are tedious to write - and it has been pointed out to me that if I’d used FastAPI, I wouldn’t have needed to write one at all. But one of the really nice things you can do with ChatGPT is paste in your Flask code, and it will generate an OpenAPI file for you.</p>

<p>I’m just running this plugin locally, I don’t have any plans to publish it as that would require a lot more plumbing. For developing local plugins, you need to have a server running on localhost. Fortunately, we can use the excellent VSCode support for remote development. I’m connecting through to the Pi from my desktop machine, and when I launch the server, VSCode tunnels through to the Raspberry Pi and exposes the server on my local machine.</p>

<p>ChatGPT looks at the <code>/.well-known/ai-plugin.json</code> and uses that to get the name, description, logo, and OpenAPI file. That’s all it has to work with to figure out what to do with the API.</p>

<p>We can get some insight into how it works under the hood. We can just ask ChatGPT to show us its thinking. If we paste in the OpenAPI yaml file and ask it to explain how to turn lights on and off, we get this:</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-14/chat-gpt-explains.webp" alt="ChatGPT Explain"/></p>

<p>We can even get it to generate a sequence diagram for us:</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-14/chat-gpt-sequence-diagram.webp" alt="ChatGPT Sequence Diagram"/></p>

<p>It’s pretty amazing. Now go and watch the video:</p>

<lite-youtube videoid="BeJVv0pL5kY" playlabel="Adding Memory To ChatGPT"></lite-youtube>

            <p><small>
                HELP <a href="https://www.atomic14.com/support/index.html">SUPPORT</a> MY WORK: If you&#39;re feeling flush then please stop by <a href="https://www.patreon.com/atomic14">Patreon</a> Or you can make a one off donation via <a href="https://ko-fi.com/atomic14">ko-fi</a>
              </small>
            </p>
          </div>
          <div>
            <p><a href="https://www.youtube.com/c/atomic14" title="Watch my videos!" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://www.patreon.com/atomic14" title="Help support me on Patreon!" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://twitter.com/mrbananas" title="Follow me on twitter" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://www.facebook.com/atomic14Videos" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://github.com/atomic14" title="Fork me on github" "="">
          <i></i>
        </a>
          ·  
    
  
  <a href="https://www.atomic14.com/index.html">Posts</a>  ·  
  <a href="https://www.atomic14.com/videos/index.html">Videos</a>  ·  
  <a href="https://www.atomic14.com/support/index.html">Support</a>
</p>
          </div>
        </section>
        
        <div>
          <div>
            <h5><span>Written by</span></h5>
            <section>
              
              <h4>Chris Greening</h4>
              
              <hr/>
              <p>Published <time datetime="2023-05-14 00:00">14 May 2023</time></p>
            </section>
          </div>
          
          
        </div>
      </article>
    </div></div>
  </body>
</html>
