<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://timothyfraser.com/sigma/statistical-process-control-in-python.html">Original</a>
    <h1>Statistical Process Control in Python</h1>
    
    <div id="readability-page-1" class="page"><div>
        

        <div tabindex="-1" role="main">
          <div>

            <section id="section-">
<div id="statistical-process-control-in-python" number="16">

<div><p><span id="fig:unnamed-chunk-1"></span>
<img src="http://tinylogger.com/max/images/9_chart.png" alt="Statistical Process Control!" width="100%"/></p><p>
Figure 2.1: Statistical Process Control!
</p>
</div>
<p>In this workshop, we will learn how to perform statistical process control in Python, using statistical tools and <code>plotnine</code> visualizations! Statistical Process Control refers to using statistics to (1) measure variation in product quality over time and (2) identify benchmarks to know when intervention is needed. Let’s get started!</p>
<hr/>
<div id="getting-started-14">
<h2>Getting Started<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#getting-started-14" aria-label="Anchor link to header"></a></h2>
<div id="packages-7">
<h3>Packages<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#packages-7" aria-label="Anchor link to header"></a></h3>
<div id="cb847"><pre><code><span id="cb847-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb847-1" tabindex="-1"></a><span># Remember to install these packages using a terminal, if you haven&#39;t already!</span></span>
<span id="cb847-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb847-2" tabindex="-1"></a><span>!</span>pip install pandas plotnine scipy</span></code></pre></div>
<p>We’ll be using <code>pandas</code> for data manipulation, <code>plotnine</code> for visualization, and <code>scipy</code> for statistical functions.</p>
<div id="cb848"><pre><code><span id="cb848-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb848-1" tabindex="-1"></a><span>import</span> pandas <span>as</span> pd</span>
<span id="cb848-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb848-2" tabindex="-1"></a><span>from</span> plotnine <span>import</span> <span>*</span></span></code></pre></div>
</div>
<div id="custom-functions-1">
<h3>Custom Functions<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#custom-functions-1" aria-label="Anchor link to header"></a></h3>
<p>This workshop uses custom functions from the <code>functions/</code> directory. You may need both:
- <code>functions_distributions.py</code> - for reliability and distribution functions
- <code>functions_process_control.py</code> - for statistical process control functions</p>
<p>To use these functions, you need to acquire them from the repository at <a href="https://github.com/timothyfraser/sigma/tree/main/functions">github.com/timothyfraser/sigma/tree/main/functions</a>.</p>
<p><strong>Add the functions directory to your Python path</strong></p>
<div id="cb849"><pre><code><span id="cb849-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb849-1" tabindex="-1"></a><span>import</span> sys</span>
<span id="cb849-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb849-2" tabindex="-1"></a><span>import</span> os</span>
<span id="cb849-3"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb849-3" tabindex="-1"></a><span># Add the functions directory to Python path</span></span>
<span id="cb849-4"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb849-4" tabindex="-1"></a>sys.path.append(<span>&#39;functions&#39;</span>)  <span># or path to wherever you placed the functions folder</span></span></code></pre></div>
<p>Once you have the functions available, you can import them:</p>
<div id="cb850"><pre><code><span id="cb850-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb850-1" tabindex="-1"></a><span>from</span> functions_distributions <span>import</span> density, tidy_density, approxfun</span>
<span id="cb850-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb850-2" tabindex="-1"></a><span># from functions_process_control import ggprocess, ggsubgroup, ggmoving, ggcapability  # if needed</span></span></code></pre></div>
</div>
<div id="our-case-1">
<h3>Our Case<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#our-case-1" aria-label="Anchor link to header"></a></h3>
<div><p><span id="fig:unnamed-chunk-2"></span>
<img src="https://static.wixstatic.com/media/e8dc42_9cf1b5c0e5664ebd96581ffa8891eae2~mv2_d_1960_1200_s_2.jpg/v1/fill/w_1225,h_819,al_c,q_85,usm_0.66_1.00_0.01,enc_auto/DSC00255-1-3_JPG.jpg" alt="Obanazawa City, Yamagata Prefecture - A Hot Springs Economy. [**Photo credit and more here.**](https://www.thehiddenjapan.com/ginzanonsen)" width="100%"/></p><p>
Figure 12.1: Obanazawa City, Yamagata Prefecture - A Hot Springs Economy. <a href="https://www.thehiddenjapan.com/ginzanonsen"><strong>Photo credit and more here.</strong></a>
</p>
</div>
<p>For today’s workshop, we’re going to think about why quality control matters in a local economy, by examining the case of the Japanese Hot Springs bath economy! Hot springs, or <em>onsen</em>, are <a href="https://asiatimes.com/2020/07/japanese-hot-spring-tourism-at-a-crossroads/">a major source of tourism and recreation for families in Japan</a>, bringing residents from across the country every year to often rural communities where the right geological conditions have brought on naturally occurring hot springs. Restaurants, taxi and bus companies, and many service sector firms rely on their local onsen to bring in a steady stream (pun intended) of tourists to the local economy. So, it’s often in the best interest of <em>onsen</em> operators to keep an eye on the temperature, minerals, or other aspects of their hot springs baths to ensure quality control, to keep up their firm (and town’s!) reputation for quality rest and relaxation!</p>
<p><em>Onsen</em>-goers often seek out <em>specific</em> types of hot springs, so it’s important for an <em>onsen</em> to actually provide what it advertises! <a href="http://dx.doi.org/10.1016/j.healthplace.2012.06.020">Serbulea and Payyappallimana (2012)</a> describe some of these benchmarks.</p>
<ul>
<li><p><strong>Temperature</strong>: Onsen are divided into “Extra Hot Springs” (<code>&gt;42°C</code>), “Hot Springs” (<code>41~34°C</code>), and “Warm Springs” (<code>33~25°C</code>).</p></li>
<li><p><strong>pH</strong>: Onsen are classified into “Acidic” (<code>pH &lt; 3</code>), “Mildly Acidic” (<code>pH 3~6</code>), “Neutral” (<code>pH 6~7.5</code>), “Mildly alkaline” (<code>pH 7.5~8.5</code>), and “Alkaline” (<code>pH &gt; 8.5</code>).</p></li>
<li><p><strong>Sulfur</strong>: Sulfur <em>onsen</em> typically have about 2mg of sulfur per 1kg of hot spring water; sulfur levels <em>must</em> exceed 1 mg to count as a Sulfur <em>onsen.</em> (It smells like rotten eggs!)</p></li>
</ul>
<p>These are decent examples of quality control metrics that <em>onsen</em> operators might want to keep tabs on!</p>
<div><p><span id="fig:unnamed-chunk-3"></span>
<img src="http://tinylogger.com/max/images/9_monkeys.png" alt="Monkeys are even fans of onsen! Read [**more here!**](https://www.nytimes.com/2018/04/03/science/japan-monkeys-hot-springs-stress.html)" width="100%"/></p><p>
Figure 4.1: Monkeys are even fans of onsen! Read <a href="https://www.nytimes.com/2018/04/03/science/japan-monkeys-hot-springs-stress.html"><strong>more here!</strong></a>
</p>
</div>
</div>
<div id="our-data-3">
<h3>Our Data<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#our-data-3" aria-label="Anchor link to header"></a></h3>
<p>You’ve been hired to evaluate quality control at a local <em>onsen</em> in sunny Kagoshima prefecture! Every month, for 15 months, you systematically took 20 random samples of hot spring water and recorded its <strong>temperature</strong>, <strong>pH</strong>, and <strong>sulfur</strong> levels. How might you determine if this <em>onsen</em> is at risk of slipping out of one sector of the market (eg. Extra Hot!) and into another (just normal Hot Springs?).</p>
<p>Let’s read in our data from <code>workshops/onsen.csv</code>!</p>
<div id="cb851"><pre><code><span id="cb851-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb851-1" tabindex="-1"></a><span># Add functions directory to path if not already there</span></span>
<span id="cb851-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb851-2" tabindex="-1"></a><span>import</span> sys</span>
<span id="cb851-3"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb851-3" tabindex="-1"></a><span>if</span> <span>&#39;functions&#39;</span> <span>not</span> <span>in</span> sys.path:</span>
<span id="cb851-4"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb851-4" tabindex="-1"></a>    sys.path.append(<span>&#39;functions&#39;</span>)</span>
<span id="cb851-5"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb851-5" tabindex="-1"></a></span>
<span id="cb851-6"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb851-6" tabindex="-1"></a><span>from</span> functions_distributions <span>import</span> density, tidy_density, approxfun</span>
<span id="cb851-7"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb851-7" tabindex="-1"></a></span>
<span id="cb851-8"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb851-8" tabindex="-1"></a>water <span>=</span> pd.read_csv(<span>&#39;workshops/onsen.csv&#39;</span>)</span>
<span id="cb851-9"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb851-9" tabindex="-1"></a>water.head(<span>3</span>)</span></code></pre></div>
<pre><code>##    id  time  temp   ph  sulfur
## 0   1     1  43.2  5.1     0.0
## 1   2     1  45.3  4.8     0.4
## 2   3     1  45.5  6.2     0.9</code></pre>
</div>
</div>
<div id="process-descriptive-statistics-1" number="16.1">
<h2> Process Descriptive Statistics<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#process-descriptive-statistics-1" aria-label="Anchor link to header"></a></h2>
<p>First, let’s get a sense of our process by calculating some basic descriptive statistics. We’ll create a simple function to calculate the mean and standard deviation, which are fundamental to evaluating process variation.</p>
<div id="cb853"><pre><code><span id="cb853-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-1" tabindex="-1"></a><span>from</span> pandas <span>import</span> Series</span>
<span id="cb853-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-2" tabindex="-1"></a><span>def</span> describe(x: Series):</span>
<span id="cb853-3"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-3" tabindex="-1"></a>  x <span>=</span> Series(x)</span>
<span id="cb853-4"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-4" tabindex="-1"></a>  out <span>=</span> pd.DataFrame({</span>
<span id="cb853-5"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-5" tabindex="-1"></a>    <span>&#39;mean&#39;</span>: [x.mean()],</span>
<span id="cb853-6"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-6" tabindex="-1"></a>    <span>&#39;sd&#39;</span>: [x.std()],</span>
<span id="cb853-7"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-7" tabindex="-1"></a>  })</span>
<span id="cb853-8"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-8" tabindex="-1"></a>  out[<span>&#39;caption&#39;</span>] <span>=</span> (<span>&#34;Process Mean: &#34;</span> <span>+</span> out[<span>&#39;mean&#39;</span>].<span>round</span>(<span>2</span>).astype(<span>str</span>) <span>+</span></span>
<span id="cb853-9"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-9" tabindex="-1"></a>                    <span>&#34; | SD: &#34;</span> <span>+</span> out[<span>&#39;sd&#39;</span>].<span>round</span>(<span>2</span>).astype(<span>str</span>))</span>
<span id="cb853-10"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-10" tabindex="-1"></a>  <span>return</span> out</span>
<span id="cb853-11"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-11" tabindex="-1"></a></span>
<span id="cb853-12"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-12" tabindex="-1"></a>tab <span>=</span> describe(water[<span>&#39;temp&#39;</span>])</span>
<span id="cb853-13"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb853-13" tabindex="-1"></a>tab</span></code></pre></div>
<pre><code>##     mean        sd                         caption
## 0  44.85  1.989501  Process Mean: 44.85 | SD: 1.99</code></pre>
<p>Now let’s apply this to our temperature data to see the overall process mean and variation.</p>
</div>
<div id="process-overview-visual-1" number="16.2">
<h2> Process Overview Visual<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#process-overview-visual-1" aria-label="Anchor link to header"></a></h2>
<p>The process overview chart is one of the most important tools in SPC. It shows us how our process behaves over time, helping us identify patterns, trends, and potential issues. We’ll create a visualization that shows individual measurements, subgroup means, and the overall process average.</p>
<div id="cb855"><pre><code><span id="cb855-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb855-1" tabindex="-1"></a>g1 <span>=</span> (ggplot(water, aes(x<span>=</span><span>&#39;time&#39;</span>, y<span>=</span><span>&#39;temp&#39;</span>, group<span>=</span><span>&#39;time&#39;</span>)) <span>+</span></span>
<span id="cb855-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb855-2" tabindex="-1"></a>  geom_hline(aes(yintercept<span>=</span>water[<span>&#39;temp&#39;</span>].mean()), color<span>=</span><span>&#39;lightgrey&#39;</span>, size<span>=</span><span>3</span>) <span>+</span></span>
<span id="cb855-3"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb855-3" tabindex="-1"></a>  geom_jitter(height<span>=</span><span>0</span>, width<span>=</span><span>0.25</span>) <span>+</span></span>
<span id="cb855-4"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb855-4" tabindex="-1"></a>  geom_boxplot() <span>+</span></span>
<span id="cb855-5"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb855-5" tabindex="-1"></a>  labs(x<span>=</span><span>&#39;Time (Subgroup)&#39;</span>, y<span>=</span><span>&#39;Temperature (Celsius)&#39;</span>, subtitle<span>=</span><span>&#39;Process Overview&#39;</span>, caption<span>=</span>tab[<span>&#39;caption&#39;</span>][<span>0</span>]))</span>
<span id="cb855-6"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb855-6" tabindex="-1"></a></span>
<span id="cb855-7"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb855-7" tabindex="-1"></a><span># Save the plot</span></span>
<span id="cb855-8"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb855-8" tabindex="-1"></a>g1.save(<span>&#39;images/05_process_overview.png&#39;</span>, width<span>=</span><span>8</span>, height<span>=</span><span>6</span>, dpi<span>=</span><span>100</span>)</span></code></pre></div>
<p><img src="http://tinylogger.com/max/images/05_process_overview.png" width="100%"/></p>
<div id="cb856"><pre><code><span id="cb856-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb856-1" tabindex="-1"></a>g2 <span>=</span> (ggplot(water, aes(x<span>=</span><span>&#39;temp&#39;</span>)) <span>+</span> geom_histogram(bins<span>=</span><span>15</span>, color<span>=</span><span>&#39;white&#39;</span>, fill<span>=</span><span>&#39;grey&#39;</span>) <span>+</span> theme_void() <span>+</span> coord_flip())</span>
<span id="cb856-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb856-2" tabindex="-1"></a></span>
<span id="cb856-3"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb856-3" tabindex="-1"></a><span># Save the plot</span></span>
<span id="cb856-4"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb856-4" tabindex="-1"></a>g2.save(<span>&#39;images/05_process_histogram.png&#39;</span>, width<span>=</span><span>8</span>, height<span>=</span><span>6</span>, dpi<span>=</span><span>100</span>)</span></code></pre></div>
<p><img src="http://tinylogger.com/max/images/05_process_histogram.png" width="100%"/></p>
<p>The histogram shows us the distribution of all temperature measurements, giving us insight into the overall process variation. This helps us understand if our process is centered and how much variation we’re seeing.</p>
</div>
<div id="subgroup-within-group-statistics-1" number="16.3">
<h2> Subgroup (Within-Group) Statistics<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#subgroup-within-group-statistics-1" aria-label="Anchor link to header"></a></h2>
<p>In SPC, we often work with <em>subgroups</em> - small samples taken at regular intervals. This allows us to distinguish between common cause variation (inherent to the process) and special cause variation (due to specific events). Let’s calculate statistics for each subgroup to see how the process behaves over time.</p>
<div id="cb857"><pre><code><span id="cb857-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb857-1" tabindex="-1"></a>stat_s <span>=</span> (water.groupby(<span>&#39;time&#39;</span>).<span>apply</span>(<span>lambda</span> d: pd.Series({</span>
<span id="cb857-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb857-2" tabindex="-1"></a>  <span>&#39;xbar&#39;</span>: d[<span>&#39;temp&#39;</span>].mean(),</span>
<span id="cb857-3"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb857-3" tabindex="-1"></a>  <span>&#39;r&#39;</span>: d[<span>&#39;temp&#39;</span>].<span>max</span>() <span>-</span> d[<span>&#39;temp&#39;</span>].<span>min</span>(),</span>
<span id="cb857-4"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb857-4" tabindex="-1"></a>  <span>&#39;sd&#39;</span>: d[<span>&#39;temp&#39;</span>].std(),</span>
<span id="cb857-5"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb857-5" tabindex="-1"></a>  <span>&#39;nw&#39;</span>: <span>len</span>(d)</span>
<span id="cb857-6"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb857-6" tabindex="-1"></a>})).reset_index())</span>
<span id="cb857-7"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb857-7" tabindex="-1"></a>stat_s[<span>&#39;df&#39;</span>] <span>=</span> stat_s[<span>&#39;nw&#39;</span>] <span>-</span> <span>1</span></span>
<span id="cb857-8"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb857-8" tabindex="-1"></a>stat_s[<span>&#39;sigma_s&#39;</span>] <span>=</span> ( (stat_s[<span>&#39;df&#39;</span>] <span>*</span> (stat_s[<span>&#39;sd&#39;</span>]<span>**</span><span>2</span>)).<span>sum</span>() <span>/</span> stat_s[<span>&#39;df&#39;</span>].<span>sum</span>() )<span>**</span><span>0.5</span></span>
<span id="cb857-9"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb857-9" tabindex="-1"></a>stat_s[<span>&#39;se&#39;</span>] <span>=</span> stat_s[<span>&#39;sigma_s&#39;</span>] <span>/</span> (stat_s[<span>&#39;nw&#39;</span>]<span>**</span><span>0.5</span>)</span>
<span id="cb857-10"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb857-10" tabindex="-1"></a>stat_s[<span>&#39;upper&#39;</span>] <span>=</span> stat_s[<span>&#39;xbar&#39;</span>].mean() <span>+</span> <span>3</span><span>*</span>stat_s[<span>&#39;se&#39;</span>]</span>
<span id="cb857-11"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb857-11" tabindex="-1"></a>stat_s[<span>&#39;lower&#39;</span>] <span>=</span> stat_s[<span>&#39;xbar&#39;</span>].mean() <span>-</span> <span>3</span><span>*</span>stat_s[<span>&#39;se&#39;</span>]</span>
<span id="cb857-12"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb857-12" tabindex="-1"></a>stat_s.head(<span>3</span>)</span></code></pre></div>
<pre><code>##    time    xbar    r        sd    nw    df   sigma_s        se      upper      lower
## 0     1  44.635  4.2  1.342533  20.0  19.0  1.986174  0.444122  46.182366  43.517634
## 1     3  45.305  7.9  2.001440  20.0  19.0  1.986174  0.444122  46.182366  43.517634
## 2     5  44.765  5.9  1.628133  20.0  19.0  1.986174  0.444122  46.182366  43.517634</code></pre>
<p>Here we’ve calculated key statistics for each subgroup:</p>
<ul>
<li><strong>xbar</strong>: The mean of each subgroup</li>
<li><strong>r</strong>: The range (max - min) within each subgroup<br/>
</li>
<li><strong>sd</strong>: The standard deviation within each subgroup</li>
<li><strong>sigma_s</strong>: The pooled within-subgroup standard deviation</li>
<li><strong>se</strong>: The standard error for each subgroup mean</li>
</ul>
<div id="total-statistics-between-groups-1" number="16.3.1">
<h3> Total Statistics (Between Groups)<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#total-statistics-between-groups-1" aria-label="Anchor link to header"></a></h3>
<p>Now let’s calculate the overall process statistics that summarize the behavior across all subgroups:</p>
<div id="cb859"><pre><code><span id="cb859-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb859-1" tabindex="-1"></a>stat_t <span>=</span> pd.DataFrame({</span>
<span id="cb859-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb859-2" tabindex="-1"></a>  <span>&#39;xbbar&#39;</span>: [stat_s[<span>&#39;xbar&#39;</span>].mean()],</span>
<span id="cb859-3"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb859-3" tabindex="-1"></a>  <span>&#39;rbar&#39;</span>: [stat_s[<span>&#39;r&#39;</span>].mean()],</span>
<span id="cb859-4"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb859-4" tabindex="-1"></a>  <span>&#39;sdbar&#39;</span>: [stat_s[<span>&#39;sd&#39;</span>].mean()],</span>
<span id="cb859-5"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb859-5" tabindex="-1"></a>  <span>&#39;sigma_s&#39;</span>: [(stat_s[<span>&#39;sd&#39;</span>]<span>**</span><span>2</span>).mean()<span>**</span><span>0.5</span>],</span>
<span id="cb859-6"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb859-6" tabindex="-1"></a>  <span>&#39;sigma_t&#39;</span>: [water[<span>&#39;temp&#39;</span>].std()]</span>
<span id="cb859-7"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb859-7" tabindex="-1"></a>})</span>
<span id="cb859-8"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb859-8" tabindex="-1"></a>stat_t</span></code></pre></div>
<pre><code>##    xbbar    rbar    sdbar   sigma_s   sigma_t
## 0  44.85  7.2625  1.93619  1.986174  1.989501</code></pre>
<p>These statistics give us:</p>
<ul>
<li><strong>xbbar</strong>: The grand mean (average of all subgroup means)</li>
<li><strong>rbar</strong>: The average range across subgroups</li>
<li><strong>sdbar</strong>: The average standard deviation across subgroups</li>
<li><strong>sigma_s</strong>: The pooled within-subgroup standard deviation</li>
<li><strong>sigma_t</strong>: The total process standard deviation</li>
</ul>
</div>
<div id="average-and-standard-deviation-charts-1" number="16.3.2">
<h3> Average and Standard Deviation Charts<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#average-and-standard-deviation-charts-1" aria-label="Anchor link to header"></a></h3>
<p>Control charts are the heart of SPC. They help us monitor process stability over time and detect when the process is out of control. We’ll create charts for both the subgroup means (X-bar chart) and standard deviations (S chart).</p>
<div id="cb861"><pre><code><span id="cb861-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-1" tabindex="-1"></a>labels <span>=</span> pd.DataFrame({</span>
<span id="cb861-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-2" tabindex="-1"></a>  <span>&#39;time&#39;</span>: [stat_s[<span>&#39;time&#39;</span>].<span>max</span>()]<span>*</span><span>3</span>,</span>
<span id="cb861-3"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-3" tabindex="-1"></a>  <span>&#39;type&#39;</span>: [<span>&#39;xbbar&#39;</span>,<span>&#39;upper&#39;</span>,<span>&#39;lower&#39;</span>],</span>
<span id="cb861-4"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-4" tabindex="-1"></a>  <span>&#39;name&#39;</span>: [<span>&#39;mean&#39;</span>,<span>&#39;+3 s&#39;</span>,<span>&#39;-3 s&#39;</span>],</span>
<span id="cb861-5"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-5" tabindex="-1"></a>  <span>&#39;value&#39;</span>: [stat_s[<span>&#39;xbar&#39;</span>].mean(), stat_s[<span>&#39;upper&#39;</span>].iloc[<span>0</span>], stat_s[<span>&#39;lower&#39;</span>].iloc[<span>0</span>]]</span>
<span id="cb861-6"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-6" tabindex="-1"></a>})</span>
<span id="cb861-7"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-7" tabindex="-1"></a></span>
<span id="cb861-8"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-8" tabindex="-1"></a>control_chart <span>=</span> (ggplot(stat_s, aes(x<span>=</span><span>&#39;time&#39;</span>, y<span>=</span><span>&#39;xbar&#39;</span>)) <span>+</span></span>
<span id="cb861-9"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-9" tabindex="-1"></a>  geom_hline(aes(yintercept<span>=</span>stat_s[<span>&#39;xbar&#39;</span>].mean()), color<span>=</span><span>&#39;lightgrey&#39;</span>, size<span>=</span><span>3</span>) <span>+</span></span>
<span id="cb861-10"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-10" tabindex="-1"></a>  geom_ribbon(aes(ymin<span>=</span><span>&#39;lower&#39;</span>, ymax<span>=</span><span>&#39;upper&#39;</span>), fill<span>=</span><span>&#39;steelblue&#39;</span>, alpha<span>=</span><span>0.2</span>) <span>+</span></span>
<span id="cb861-11"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-11" tabindex="-1"></a>  geom_line(size<span>=</span><span>1</span>) <span>+</span> geom_point(size<span>=</span><span>5</span>) <span>+</span></span>
<span id="cb861-12"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-12" tabindex="-1"></a>  geom_label(data<span>=</span>labels, mapping<span>=</span>aes(x<span>=</span><span>&#39;time&#39;</span>, y<span>=</span><span>&#39;value&#39;</span>, label<span>=</span><span>&#39;name&#39;</span>), ha<span>=</span><span>&#39;right&#39;</span>) <span>+</span></span>
<span id="cb861-13"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-13" tabindex="-1"></a>  labs(x<span>=</span><span>&#39;Time (Subgroups)&#39;</span>, y<span>=</span><span>&#39;Average&#39;</span>, subtitle<span>=</span><span>&#39;Average and Standard Deviation Chart&#39;</span>))</span>
<span id="cb861-14"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-14" tabindex="-1"></a></span>
<span id="cb861-15"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-15" tabindex="-1"></a><span># Save the plot</span></span>
<span id="cb861-16"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb861-16" tabindex="-1"></a>control_chart.save(<span>&#39;images/05_control_chart.png&#39;</span>, width<span>=</span><span>8</span>, height<span>=</span><span>6</span>, dpi<span>=</span><span>100</span>)</span></code></pre></div>
<p><img src="http://tinylogger.com/max/images/05_control_chart.png" width="100%"/></p>
<p>This control chart shows:</p>
<ul>
<li><strong>Center line</strong>: The grand mean (xbbar)</li>
<li><strong>Control limits</strong>: Upper and lower 3-sigma limits based on the standard error</li>
<li><strong>Individual points</strong>: Each subgroup mean plotted over time</li>
<li><strong>Shaded area</strong>: The control limits region</li>
</ul>
<p>Points outside the control limits or showing non-random patterns indicate the process may be out of control and requires investigation.</p>
<hr/>
</div>
</div>
<div id="learning-check-1-11">
<h2>Learning Check 1<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#learning-check-1-11" aria-label="Anchor link to header"></a></h2>
<p><strong>Question</strong></p>
<p>Produce the same process overview chart for <code>pH</code>.</p>
<details>
<summary>
<strong>[View Answer!]</strong>
</summary>
<div id="cb862"><pre><code><span id="cb862-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-1" tabindex="-1"></a><span>def</span> ggprocess(x, y, xlab<span>=</span><span>&#39;Subgroup&#39;</span>, ylab<span>=</span><span>&#39;Metric&#39;</span>):</span>
<span id="cb862-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-2" tabindex="-1"></a>  <span>import</span> pandas <span>as</span> pd</span>
<span id="cb862-3"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-3" tabindex="-1"></a>  <span>from</span> plotnine <span>import</span> ggplot, aes, geom_hline, geom_jitter, geom_boxplot, labs</span>
<span id="cb862-4"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-4" tabindex="-1"></a>  d <span>=</span> pd.DataFrame({<span>&#39;x&#39;</span>: x, <span>&#39;y&#39;</span>: y})</span>
<span id="cb862-5"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-5" tabindex="-1"></a>  g <span>=</span> (ggplot(d, aes(x<span>=</span><span>&#39;x&#39;</span>, y<span>=</span><span>&#39;y&#39;</span>, group<span>=</span><span>&#39;x&#39;</span>)) <span>+</span></span>
<span id="cb862-6"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-6" tabindex="-1"></a>       geom_hline(aes(yintercept<span>=</span>d[<span>&#39;y&#39;</span>].mean()), color<span>=</span><span>&#39;lightgrey&#39;</span>, size<span>=</span><span>3</span>) <span>+</span></span>
<span id="cb862-7"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-7" tabindex="-1"></a>       geom_jitter(height<span>=</span><span>0</span>, width<span>=</span><span>0.25</span>) <span>+</span></span>
<span id="cb862-8"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-8" tabindex="-1"></a>       geom_boxplot() <span>+</span></span>
<span id="cb862-9"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-9" tabindex="-1"></a>       labs(x<span>=</span>xlab, y<span>=</span>ylab, subtitle<span>=</span><span>&#39;Process Overview&#39;</span>))</span>
<span id="cb862-10"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-10" tabindex="-1"></a>  <span>return</span> g</span>
<span id="cb862-11"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-11" tabindex="-1"></a></span>
<span id="cb862-12"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-12" tabindex="-1"></a>ph_chart <span>=</span> ggprocess(water[<span>&#39;time&#39;</span>], water[<span>&#39;ph&#39;</span>])</span>
<span id="cb862-13"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-13" tabindex="-1"></a></span>
<span id="cb862-14"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-14" tabindex="-1"></a><span># Save the plot</span></span>
<span id="cb862-15"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb862-15" tabindex="-1"></a>ph_chart.save(<span>&#39;images/05_ph_chart.png&#39;</span>, width<span>=</span><span>8</span>, height<span>=</span><span>6</span>, dpi<span>=</span><span>100</span>)</span></code></pre></div>
<p><img src="http://tinylogger.com/max/images/05_ph_chart.png" width="100%"/></p>
</details>
<hr/>
</div>
<div id="moving-range-charts-n1" number="16.4">
<h2> Moving Range Charts (n=1)<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#moving-range-charts-n1" aria-label="Anchor link to header"></a></h2>
<p>When we have individual measurements rather than subgroups, we use moving range charts. The moving range is the absolute difference between consecutive measurements, which helps us estimate process variation when we can’t calculate within-subgroup statistics.</p>
<div id="cb863"><pre><code><span id="cb863-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb863-1" tabindex="-1"></a>indiv <span>=</span> water.iloc[[<span>0</span>,<span>20</span>,<span>40</span>,<span>60</span>,<span>80</span>,<span>100</span>,<span>120</span>,<span>140</span>]]</span>
<span id="cb863-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb863-2" tabindex="-1"></a>mr <span>=</span> (indiv[<span>&#39;temp&#39;</span>].diff().<span>abs</span>().dropna())</span>
<span id="cb863-3"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb863-3" tabindex="-1"></a>mrbar <span>=</span> mr.mean()</span>
<span id="cb863-4"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb863-4" tabindex="-1"></a><span>import</span> numpy <span>as</span> np</span>
<span id="cb863-5"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb863-5" tabindex="-1"></a>d2 <span>=</span> np.mean(np.<span>abs</span>(np.diff(np.random.normal(<span>0</span>,<span>1</span>,<span>10000</span>))))</span>
<span id="cb863-6"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb863-6" tabindex="-1"></a>sigma_s <span>=</span> mrbar <span>/</span> d2</span>
<span id="cb863-7"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb863-7" tabindex="-1"></a>se <span>=</span> sigma_s <span>/</span> (<span>1</span><span>**</span><span>0.5</span>)</span>
<span id="cb863-8"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb863-8" tabindex="-1"></a>upper <span>=</span> mrbar <span>+</span> <span>3</span><span>*</span>se</span>
<span id="cb863-9"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb863-9" tabindex="-1"></a>lower <span>=</span> <span>0</span></span></code></pre></div>
<div id="cb864"><pre><code><span id="cb864-1"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb864-1" tabindex="-1"></a>istat <span>=</span> pd.DataFrame({<span>&#39;time&#39;</span>: indiv[<span>&#39;time&#39;</span>].iloc[<span>1</span>:], <span>&#39;mr&#39;</span>: mr, <span>&#39;mrbar&#39;</span>: mrbar, <span>&#39;upper&#39;</span>: upper, <span>&#39;lower&#39;</span>: lower})</span>
<span id="cb864-2"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb864-2" tabindex="-1"></a>mr_chart <span>=</span> (ggplot(istat, aes(x<span>=</span><span>&#39;time&#39;</span>, y<span>=</span><span>&#39;mr&#39;</span>)) <span>+</span></span>
<span id="cb864-3"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb864-3" tabindex="-1"></a>  geom_ribbon(aes(ymin<span>=</span><span>&#39;lower&#39;</span>, ymax<span>=</span><span>&#39;upper&#39;</span>), fill<span>=</span><span>&#39;steelblue&#39;</span>, alpha<span>=</span><span>0.25</span>) <span>+</span></span>
<span id="cb864-4"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb864-4" tabindex="-1"></a>  geom_hline(aes(yintercept<span>=</span>mr.mean()), size<span>=</span><span>3</span>, color<span>=</span><span>&#39;darkgrey&#39;</span>) <span>+</span></span>
<span id="cb864-5"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb864-5" tabindex="-1"></a>  geom_line(size<span>=</span><span>1</span>) <span>+</span> geom_point(size<span>=</span><span>5</span>) <span>+</span></span>
<span id="cb864-6"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb864-6" tabindex="-1"></a>  labs(x<span>=</span><span>&#39;Time (Subgroup)&#39;</span>, y<span>=</span><span>&#39;Moving Range&#39;</span>, subtitle<span>=</span><span>&#39;Moving Range Chart&#39;</span>))</span>
<span id="cb864-7"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb864-7" tabindex="-1"></a></span>
<span id="cb864-8"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb864-8" tabindex="-1"></a><span># Save the plot</span></span>
<span id="cb864-9"><a href="http://tinylogger.com/max/statistical-process-control-in-python.html#cb864-9" tabindex="-1"></a>mr_chart.save(<span>&#39;images/05_moving_range_chart.png&#39;</span>, width<span>=</span><span>8</span>, height<span>=</span><span>6</span>, dpi<span>=</span><span>100</span>)</span></code></pre></div>
<p><img src="http://tinylogger.com/max/images/05_moving_range_chart.png" width="100%"/></p>
<p>The moving range chart shows:</p>
<ul>
<li><strong>Center line</strong>: The average moving range (mrbar)</li>
<li><strong>Upper control limit</strong>: Based on the estimated process standard deviation</li>
<li><strong>Lower control limit</strong>: Set to 0 (moving ranges can’t be negative)</li>
<li><strong>Individual points</strong>: Each moving range value</li>
</ul>
<p>This chart helps us monitor process variation when we have individual measurements rather than subgroups.</p>
</div>
<div id="conclusion-12">
<h2>Conclusion<a href="http://tinylogger.com/max/statistical-process-control-in-python.html#conclusion-12" aria-label="Anchor link to header"></a></h2>
<p>You’ve successfully produced SPC visuals and statistics in Python: process overviews, subgroup statistics, and moving range logic. These tools help us understand process behavior, identify when processes are in or out of control, and make data-driven decisions about process improvement.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div></div>
  </body>
</html>
