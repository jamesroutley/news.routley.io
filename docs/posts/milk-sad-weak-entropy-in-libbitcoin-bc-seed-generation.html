<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://milksad.info/">Original</a>
    <h1>Milk Sad: Weak Entropy in libbitcoin (bc) seed generation</h1>
    
    <div id="readability-page-1" class="page"><div>
      <p><img src="https://milksad.info/assets/base/milksad_transparent.svg" width="30%"/></p>



<p>A practical explanation of how weak entropy can ruin your day - and your savings.</p>

<h2 id="vulnerability-cve-2023-39910">Vulnerability <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-39910">CVE-2023-39910</a></h2>

<ul>
  <li>We discovered a cryptographic weakness in the widely utilized <code>Libbitcoin Explorer</code> (<code>bx</code>) cryptocurrency wallet tool while following up on mysterious wallet thefts.</li>
  <li>The <code>bx seed</code> subcommand for generation of new wallet private key entropy is flawed and produces insecure output.</li>
  <li>On <code>Libbitcoin Explorer</code> <code>3.x</code> versions, <code>bx seed</code> uses the <a href="https://en.wikipedia.org/wiki/Mersenne_Twister#Disadvantages">Mersenne Twister</a> pseudorandom number generator (PRNG) <a href="https://github.com/libbitcoin/libbitcoin-system/blob/a1b777fc51d9c04e0c7a1dec5cc746b82a6afe64/src/crypto/pseudo_random.cpp#L77">initialized</a> with 32 bits of system time.</li>
  <li>Bad actors have discovered this flaw and are actively exploiting it to steal funds from affected wallets on multiple blockchains.</li>
  <li>We have reasons to believe some <code>Libbitcoin Explorer</code> versions before <code>3.0.0</code> also produce weak <code>bx seed</code> output in some system environments.</li>
  <li>Think of this as securing your online bank account with a password manager that creates a long random password, but it often creates the same passwords for every user. Malicious people have figured this out and drained funds on any account they can find.</li>
</ul>

<h2 id="how">How?</h2>
<div>
    <p><img width="100%" src="https://milksad.info/assets/base/bx-mastering-bitcoin.png"/></p><p>
        Mastering Bitcoin - Second Edition by Andreas M. Antonopoulos LLC is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.
    </p>
</div>
<ul>
  <li>Popular documentation like “<a href="https://bitcoinbook.info">Mastering Bitcoin</a>” suggests the usage of <code>bx seed</code> for wallet generation.</li>
  <li>Secure cryptography requires a source of large, non-guessable numbers. If the random number generator is weak, the resulting cryptographic usage is almost always compromised.</li>
  <li>For technical people: in this case, practical wallet security is reduced from 128 bit, 192 bit or 256 bit to a mere 32 bit of unknown key information.</li>
  <li>A 32 bit key space is 2^32, or 4,294,967,296 different unique combinations of derived <a href="(https://en.bitcoin.it/wiki/BIP_0039)">BIP39</a> mnemonic phrases or other key formats (<a href="https://en.bitcoin.it/wiki/BIP_0032">BIP32</a>). Spoiler: That’s not as many combinations as it sounds.</li>
  <li>With enough optimizations, a decent gaming PC can do a brute-force search through 2^32 wallet combinations in less than a day.</li>
  <li>Since <code>bx</code> has a configurable output length and can be used in several ways, there are a few variations the attacker needs to test for each case. This slows down practical attacks to a few days.</li>
  <li>Once an attacker finds a match of a wallet candidate with an actual wallet used on a blockchain, they are in full possession of the private keys and can steal remaining funds, trace all previous wallet history and sign messages.</li>
  <li>The attack works independent of the owner’s current copy of the wallet secrets. In other words, even if you keep your paper wallet in a bank safe, your funds can still be stolen remotely. Crazy, right?</li>
  <li>Attackers are actively exploiting this and have been draining funds of wallets where the mnemonic was generated using this tool.</li>
  <li>Why the silly “Milk Sad” name? Running <code>bx seed</code> on <code>3.x</code> versions with a system time of 0.0 always generates the following secret:
    <blockquote>
      <p>milk sad wage cup reward umbrella raven visa give list decorate bulb gold raise twenty fly manual stand float super gentle climb fold park</p>
    </blockquote>
  </li>
</ul>

<h2 id="when">When?</h2>
<p>The main theft occurred around 12 July 2023, although initial exploitation likely began at a smaller scale in May 2023.</p>

<p>A separate but similar vulnerability in another wallet software was detected in November 2022 and actively exploited shortly after, which may be the prequel to this story.</p>

<h2 id="who">Who?</h2>
<p>We did not identify who is behind the ongoing thefts from vulnerable wallets.</p>

<h2 id="type">Type</h2>

<p><a href="https://cwe.mitre.org/data/definitions/338.html">CWE-338: Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a></p>

<h2 id="vendor">Vendor</h2>

<p><a href="https://github.com/libbitcoin">Libbitcoin</a></p>

<h2 id="further-reading">Further Reading</h2>

<p>See our <a href="https://milksad.info/disclosure.html">technical writeup</a> and <a href="https://milksad.info/faq.html">FAQ</a>.</p>

<p><a href="https://nvd.nist.gov/vuln/detail/CVE-2023-31290">CVE-2023-31290</a> was a similar vulnerability in <a href="https://community.trustwallet.com/t/browser-extension-wasm-vulnerability-postmortem/750787">Trust Wallet</a>, see <a href="https://blog.ledger.com/Funds-of-every-wallet-created-with-the-Trust-Wallet-browser-extension-could-have-been-stolen/">Ledger Donjon’s technical writeup</a>.</p>



<ul>
  <li>General requests and comments: email <a href="mailto:team@milksad.info">team@milksad.info</a></li>
  <li>Press: email <a href="mailto:press@milksad.info">press@milksad.info</a></li>
</ul>

<h2 id="team--credits">Team &amp; Credits</h2>

<ul>
  <li>Core Team
    <ul>
      <li>Distrust
        <ul>
          <li>Anton Livaja - <a href="mailto:anton@distrust.co">anton@distrust.co</a></li>
          <li>Lance R. Vick - <a href="mailto:lance@distrust.co">lance@distrust.co</a>, <a href="https://lance.dev">https://lance.dev</a></li>
          <li>Ryan Heywood - <a href="mailto:ryan@distrust.co">ryan@distrust.co</a>, <a href="https://ryansquared.pub">https://ryansquared.pub</a></li>
          <li>Shane Engelman - <a href="mailto:shane@distrust.co">shane@distrust.co</a></li>
        </ul>
      </li>
      <li>Independent
        <ul>
          <li>Christian Reitter - <a href="https://inhq.net">https://inhq.net</a></li>
          <li>Daniel Grove - <a href="mailto:danny@dannygrove.com">danny@dannygrove.com</a></li>
          <li>Dustin Johnson - <a href="mailto:_@di0.io">_@di0.io</a></li>
          <li>Heiko Schaefer - <a href="mailto:heiko@schaefer.name">heiko@schaefer.name</a></li>
          <li>James Callahan - <a href="mailto:james@wavesquid.com">james@wavesquid.com</a></li>
          <li>Jochen Hoenicke - <a href="https://jhoenicke.de">https://jhoenicke.de</a></li>
          <li>John Naulty - <a href="mailto:jnaulty@dendritictech.com">jnaulty@dendritictech.com</a></li>
          <li>Matthew Brooks - <a href="mailto:*@logicwax.com">*@logicwax.com</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Special Thanks
    <ul>
      <li>Jack Kearney - <a href="https://turnkey.com">Turnkey</a></li>
      <li>Several trusted advisors that wish to remain uncredited. You know who you are.</li>
    </ul>
  </li>
</ul>


  <br/> 
    </div></div>
  </body>
</html>
