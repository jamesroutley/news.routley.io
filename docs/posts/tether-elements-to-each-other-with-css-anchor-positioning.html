<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://developer.chrome.com/blog/tether-elements-to-each-other-with-css-anchor-positioning/">Original</a>
    <h1>Tether elements to each other with CSS anchor positioning</h1>
    
    <div id="readability-page-1" class="page"><div><p>How do you currently tether one element to another? You might try tracking their positions, or use some form of wrapper element.</p><pre><code></code></pre><pre><code></code></pre><p>These solutions often aren&#39;t ideal. They need JavaScript or introduce extra markup. The CSS anchor positioning API aims to solve this by providing a CSS API for tethering elements. It provides a means to position and size one element based on the position and size of other elements.</p><p><img src="https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format" width="664" height="582" loading="lazy" sizes="(min-width:664px) 664px,calc(100vw - 48px)" srcset="https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=200 200w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=228 228w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=260 260w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=296 296w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=338 338w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=385 385w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=439 439w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=500 500w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=571 571w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=650 650w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=741 741w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=845 845w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=964 964w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=1098 1098w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=1252 1252w,https://wd.imgix.net/image/Dyx9FwYgMyNqy1kMGx8Orz6q0qC3/ZrBRrAMuhnkvS0EOqx4j.png?auto=format&amp;w=1328 1328w" alt="Image shows a mockup browser window detailing the anatomy of a tooltip." decoding="async"/></p><h2 id="browser-support" tabindex="-1"><a href="#browser-support" aria-hidden="true">#</a> Browser support</h2><p>You can try out the CSS anchor positioning API in Chrome Canary behind the &#34;Experimental Web Platform Features&#34; flag. To enable that flag, open Chrome Canary and visit <code>chrome://flags</code>. Then enable the &#34;Experimental web platform features&#34; flag.</p><p>There is also a <a href="https://github.com/oddbird/css-anchor-positioning">polyfill in development</a> by the team at Oddbird. Be sure to check the repo at <a href="https://github.com/oddbird/css-anchor-positioning">github.com/oddbird/css-anchor-positioning</a>.</p><p>You can check for anchoring support with:</p><pre><code><span><span>@supports</span><span>(</span><span>anchor-name</span><span>:</span> --foo<span>)</span></span> <span>{</span></code></pre><p>Note that this API is still in an experimental stage and could change. This article covers the important parts at a high level. The current implementation also isn&#39;t completely in sync with the <a href="https://drafts.csswg.org/css-anchor-position-1">CSS Working Group spec</a>.</p><h2 id="the-problem" tabindex="-1"><a href="#the-problem" aria-hidden="true">#</a> The problem</h2><p>Why would you need to do this? A prominent use case would be creating tooltips or tooltip-like experiences. In that case, you often want to tether the tooltip to the content that it references. There is often a need for some way to tether an element to another. You also expect that interacting with the page doesn&#39;t break that tether—for example, if a user scrolls or resizes the UI.</p><p>Another part of the problem is if you want to make sure the tethered element remains in view—for example, if you open a tooltip and it becomes clipped by the viewport bounds. This might not be a great experience for users. You&#39;d like the tooltip to adapt.</p><h2 id="current-solutions" tabindex="-1"><a href="#current-solutions" aria-hidden="true">#</a> Current solutions</h2><p>Currently, there are some different ways you could approach the issue.</p><p>First up is the rudimentary &#34;Wrap the anchor&#34; approach. You take both elements and wrap them in a container. Then you can use <code>position</code> to position the tooltip relative to the anchor.</p><pre><code><span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>containing-block<span>&#34;</span></span><span>&gt;</span></span></code></pre><pre><code><span>.containing-block</span> <span>{</span></code></pre><p>You can move the container and everything will stay where you want it for the most part.</p><p>Another approach might be if you know the position of your anchor or you can somehow track it. You could pass it to your tooltip with custom properties.</p><pre><code><span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>tooltip<span>&#34;</span></span><span>&gt;</span></span>Anchor me!<span><span><span>&lt;/</span>div</span><span>&gt;</span></span></code></pre><pre><code><span>:root</span> <span>{</span></code></pre><p>But, what if you don&#39;t know the position of your anchor? You likely need to intervene with JavaScript. You could do something like the following code does, but now this means your styles are starting to leak out of CSS and into JavaScript.</p><pre><code><span>const</span> <span>setAnchorPosition</span> <span>=</span> <span>(</span><span>anchored<span>,</span> anchor</span><span>)</span> <span>=&gt;</span> <span>{</span></code></pre><p>This starts to pose some questions:</p><ul><li>When do I calculate the styles?</li><li>How do I calculate the styles?</li><li>How often do I calculate the styles?</li></ul><p>Does that solve it? It might for your use case, but there&#39;s one issue: our solution doesn&#39;t adapt. It isn&#39;t responsive. What if my anchored element gets cut off by the viewport?</p><p>Now you need to decide whether to react to this and how. The number of questions and decisions you need to make is starting to grow. All you want to do is anchor one element to another. And in an ideal world, your solution will adjust and react to its surroundings.</p><p>The decisions you make will have to take CSS behavior into account too, such as how containing blocks behave. This is something the <a href="https://developer.chrome.com/blog/pop-ups-theyre-making-a-resurgence/">Popover API</a> and <a href="https://developer.chrome.com/blog/what-is-the-top-layer/">top layer</a> access will help with.</p><p>To ease some of that pain, you might reach for a JavaScript solution to help you out. That will incur the cost of adding a dependency to your project, and it could introduce performance issues depending on how you use them. For example, some packages use <a href="https://developer.mozilla.org/docs/Web/API/window/requestAnimationFrame"><code>requestAnimationFrame</code></a> to keep the position correct. This means you and your team need to get familiar with the package and its configuration options. As a result, your questions and decisions may not get reduced, but changed instead. This is part of the &#34;why&#34; for CSS anchor positioning. It will abstract you away from thinking about performance issues when calculating position.</p><p>Here&#39;s what the code could look like for using &#34;<a href="https://floating-ui.com/">floating-ui</a>&#34;, a popular package for this problem:</p><pre><code><span>import</span> <span>{</span>computePosition<span>,</span> flip<span>,</span> offset<span>,</span> autoUpdate<span>}</span> <span>from</span> <span>&#39;https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1/+esm&#39;</span><span>;</span></code></pre><p>Try re-positioning the anchor in this demo that uses that code.</p><p>The &#34;tooltip&#34; might not behave how you expect. It reacts to going outside of the viewport on the y-axis but not the x-axis. Dig into the <a href="https://floating-ui.com/docs/flip">documentation</a>, and you’ll likely find a solution that works for you.</p><p>But, finding a package that works for your project can take a lot of time. It&#39;s extra decisions and can be frustrating if it doesn&#39;t quite work how you want.</p><h2 id="using-anchor-positioning" tabindex="-1"><a href="#using-anchor-positioning" aria-hidden="true">#</a> Using anchor positioning</h2><p>Enter the CSS anchor positioning API. The idea is to keep your styles in your CSS and reduce the number of decisions you need to make. You&#39;re hoping to achieve the same result, but the goal is to make the developer experience better.</p><ul><li>No JavaScript required.</li><li>Let the browser work out the best position from your guidance.</li><li>No more third party dependencies</li><li>No wrapper elements.</li><li>Works with elements that are in the top layer.</li></ul><p>Let&#39;s recreate and tackle the problem we were trying to solve above. But, instead, use the analogy of a boat with an anchor. These represent the anchored element and anchor. The water represents the containing block.</p><p>First, you need to choose how to define the anchor. You can do this within your CSS by setting the <code>anchor-name</code> property on the anchor element. It accepts a <a href="https://drafts.csswg.org/css-values-4/#typedef-dashed-ident">dashed-ident</a> value.</p><pre><code><span>.anchor</span> <span>{</span></code></pre><p>Alternatively, you will be able to define an anchor in your HTML with the <code>anchor</code> attribute. The attribute value is the ID of the anchor element. This creates an implicit anchor.</p><pre><code><span><span><span>&lt;</span>a</span> <span>id</span><span><span>=</span><span>&#34;</span>my-anchor<span>&#34;</span></span> <span>class</span><span><span>=</span><span>&#34;</span>anchor<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>a</span><span>&gt;</span></span></code></pre><p>Once you&#39;ve defined an anchor, you can use the <code>anchor</code> function. The <code>anchor</code> function takes 3 arguments:</p><ul><li><strong>Anchor element:</strong> The <code>anchor-name</code> of the anchor to use—or, you can omit the value to use an <code>implicit</code> anchor. It can be defined via the HTML relationship, or with an <code>anchor-default</code> property with an <code>anchor-name</code> value.</li><li><strong>Anchor side:</strong> A keyword of the position you want to use. This could be <code>top</code>, <code>right</code>, <code>bottom</code>, <code>left</code>, <code>center</code>, etc. Or, you can pass a percentage. For example, 50% would be equal to <code>center</code>.</li><li><strong>Fallback:</strong> This is an optional fallback value that accepts a length or percentage.</li></ul><p>You use the <code>anchor</code> function as a value for the <a href="https://developer.mozilla.org/docs/Web/CSS/inset">inset properties</a> (<code>top</code>, <code>right</code>, <code>bottom</code>, <code>left</code>, or their logical equivalents) of the anchored element. You can also use the <code>anchor</code> function in <a href="https://developer.mozilla.org/docs/Web/CSS/calc"><code>calc</code></a>:</p><pre><code><span>.boat</span> <span>{</span></code></pre><p>There is no <code>center</code> inset property so one option is to use <code>calc</code> if you know the size of your anchored element. Why not use <code>translate</code>? You could use this:</p><pre><code><span>.boat</span> <span>{</span></code></pre><p>But, the browser doesn&#39;t take into consideration transformed positions for anchored elements. It&#39;ll become clear why this is important when considering position fallbacks and auto positioning.</p><p>At the time of writing, defining <code>anchor-name</code> with the <code>anchor</code> attribute isn’t implemented for non-Popover elements. Here’s <a href="https://codepen.io/web-dot-dev/pen/PodqgQx">a demo</a> that should work soon.</p><p>You may have noticed the use of the custom property <code>--boat-size</code> above. But, if you want to base the anchored element size on that of the anchor, you can also access that size. Instead of calculating it yourself, you can use the <code>anchor-size</code> function. For example, to make our boat four times the width of our anchor:</p><pre><code><span>.boat</span> <span>{</span></code></pre><p>You also have access to the height too with <code>anchor-size(--my-anchor height)</code>. And you can use it to set the size of either axis or both.</p><p>What if you want to anchor to an element with <code>absolute</code> positioning? The rule is that the elements can&#39;t be siblings. In that case, you can wrap the anchor with a container that has <code>relative</code> positioning. Then you can anchor to it.</p><pre><code><span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>anchor-wrapper<span>&#34;</span></span><span>&gt;</span></span></code></pre><p>Check out this demo where you can drag the anchor around and the boat will follow.</p><p>In some cases, your anchor element might be within a scrolling container. At the same time, your anchored element might be outside that container. Because scrolling happens on a different thread from layout, you need a way to track it. The <code>anchor-scroll</code> property can do this. You set it on the anchored element and give it the value of the anchor you want to track.</p><pre><code><span>.boat</span> <span>{</span> <span>anchor-scroll</span><span>:</span> --my-anchor<span>;</span> <span>}</span></code></pre><p>Try this demo where you can switch <code>anchor-scroll</code> on and off with the checkbox in the corner.</p><p>The analogy falls a little flat here though, as in an ideal world, your boat and anchor are both in the water. Also, features such as the Popover API promote being able to keep related elements close. Anchor positioning will work with elements that are in the top layer though. This is one of the major benefits behind the API: being able to tether elements in different flows.</p><p>Consider this demo that has a scrolling container with anchors that have tooltips. The tooltip elements that are popovers might not be co-located with the anchors:</p><p>But, you&#39;ll notice how the popovers track their respective anchor links. You can resize that scrolling container and the positions will update for you.</p><p>An anchored element can&#39;t detect when a tracked anchor goes outside the scroll window. But, it will still track the anchor position. There is no current way to clip the anchored element when the anchor element goes out of view.</p><div><p>Features such as <code>anchor-size</code> and <code>anchor-scroll</code> are still in development. They could change based on your input from trying out the API.</p></div><h2 id="position-fallback-and-auto-positioning" tabindex="-1"><a href="#position-fallback-and-auto-positioning" aria-hidden="true">#</a> Position fallback and auto positioning</h2><p>This is where anchor positioning power goes up a level. A <code>position-fallback</code> can position your anchored element based on a set of fallbacks you provide. You guide the browser with your styles and let it work out the position for you.</p><p>The common use case here is a tooltip that should flip between getting shown above or below an anchor. And this behavior is based on whether the tooltip would get clipped by its container. That container is usually the viewport.</p><p>If you dug into the code of the last demo, you&#39;d have seen there was a <code>position-fallback</code> property in use. If you scrolled the container you may have noticed those anchored popovers jumped. This happened when their respective anchors neared the viewport boundary. At that moment, the popovers are trying to adjust to stay in the viewport.</p><p>Before creating an explicit <code>position-fallback</code>, anchor positioning will also offer <a href="https://drafts.csswg.org/css-anchor-position-1/#automatic-anchor-positioning">automatic positioning</a>. You can get that flip for free by using a value of <code>auto</code> in both the anchor function and the opposite inset property. For example, if you use <code>anchor</code> for <code>bottom</code>, set <code>top</code> to <code>auto</code>.</p><pre><code><span>.tooltip</span> <span>{</span></code></pre><p>This <a href="https://codepen.io/web-dot-dev/pen/RwYRLXe">demo</a> uses auto positioning syntax. At the time of writing this isn’t implemented. Be sure to check out <a href="https://drafts.csswg.org/css-anchor-position-1/#automatic-anchor-positioning">the spec</a> for the rules around <a href="https://drafts.csswg.org/css-anchor-position-1/#automatic-anchor-positioning">automatic positioning</a>.</p><p>The alternative to auto positioning is to use an explicit <code>position-fallback</code>. This requires you to define a position fallback set. The browser will go through these until it finds one it can use and then apply that positioning. If it can&#39;t find one that works, it defaults to the first one defined.</p><p>A <code>position-fallback</code> that tries to display the tooltips above then below could look like this:</p><pre><code><span><span>@position-fallback</span> --top-to-bottom</span> <span>{</span></code></pre><p>Applying that to the tooltips looks like this:</p><pre><code><span>.tooltip</span> <span>{</span></code></pre><p>The use of <code>anchor-default</code> means you can reuse the <code>position-fallback</code> for other elements. You could also use a scoped custom property to set <code>anchor-default</code>.</p><p>Be mindful that some user agent styles may set inset properties for you. In these cases, you may want to unset these before defining a <code>position-fallback</code>. One example is elements using the <code>popover</code> attribute. Applying <code>inset: unset;</code> will work.</p><p>Consider this demo using the boat again. There is a <code>position-fallback</code> set. As you change the position of the anchor, the boat will adjust to remain within the container. Try changing the padding value too which adjusts the body padding. Notice how the browser corrects positioning. The positions are being changed by changing the grid alignment of the container.</p><p>The <code>position-fallback</code> is more verbose this time trying positions in a clockwise direction.</p><pre><code><span>.boat</span> <span>{</span></code></pre><hr/><h2 id="examples" tabindex="-1"><a href="#examples" aria-hidden="true">#</a> Examples</h2><p>Now you have an idea of the main features for anchor positioning, let&#39;s take a look at some interesting examples beyond tooltips. These examples aim to get your ideas flowing for ways in which you could use anchor positioning. The best way to take the spec further is with input from real users like you.</p><p>Let&#39;s start with a context menu using the Popover API. The idea is that clicking the button with the chevron will reveal a context menu. And that menu will have its own menu to expand.</p><p>The markup isn&#39;t the important part here. But, you have three buttons each using <code>popovertarget</code>. Then you have three elements using the <code>popover</code> attribute. That gives you the ability to open the context menus without any JavaScript. That could look like this:</p><pre><code><span><span><span>&lt;</span>button</span> <span>popovertarget</span><span><span>=</span><span>&#34;</span>context<span>&#34;</span></span><span>&gt;</span></span></code></pre><p>The nested context menus won&#39;t close the parent one because they&#39;re <a href="https://developer.chrome.com/blog/pop-ups-theyre-making-a-resurgence/#types-of-popover">ancestral popovers</a>.</p><p>Now, you can define a <code>position-fallback</code> and share it between the context menus. We make sure to unset any <code>inset</code> styles for the popovers too.</p><pre><code><span>[popovertarget=&#34;share&#34;]</span> <span>{</span></code></pre><p>This gives you <a href="https://twitter.com/jh3yy/status/1625550575482900493">an adaptive nested context menu UI</a>. Try changing the content position with the select. The option you choose updates grid alignment. And that affects how anchor positioning positions the popovers.</p><h3 id="focus-and-follow" tabindex="-1"><a href="#focus-and-follow" aria-hidden="true">#</a> Focus and follow</h3><p>This demo combines CSS primitives by bringing in <a href="https://developer.chrome.com/blog/has-m105/">:has()</a>. The idea is to <a href="https://twitter.com/jh3yy/status/1590100728873615361?s=20">transition a visual indicator</a> for the <code>input</code> that has focus.</p><p>Do this by setting a new anchor at runtime. For this demo, a scoped custom property gets updated on input focus.</p><pre><code><span>#email</span> <span>{</span></code></pre><p>But, how might you take this further? You could use it for some form of instructional overlay. A tooltip could move between points of interest and update its content. You could crossfade the content. Discrete animations allowing you to <a href="https://github.com/w3c/csswg-drafts/issues/6429#issuecomment-1332439874">animate <code>display</code></a> or <a href="https://developer.chrome.com/docs/web-platform/view-transitions/">View Transitions</a> could work here.</p><h3 id="bar-chart-calc" tabindex="-1"><a href="#bar-chart-calc" aria-hidden="true">#</a> Bar chart calc</h3><p>Another fun thing you can do with anchor positioning is combine it with <code>calc</code>. Imagine a chart where you have some popovers that annotate the chart.</p><p>You could track the highest and lowest values using CSS <a href="https://developer.mozilla.org/docs/Web/CSS/min"><code>min</code></a> and <a href="https://developer.mozilla.org/docs/Web/CSS/max"><code>max</code></a>. The CSS for that could look something like this:</p><pre><code><span>.chart__tooltip--max</span> <span>{</span></code></pre><p>There is some JavaScript at play to update the chart values and some CSS to style the chart. But anchor positioning takes care of the layout updates for us.</p><h3 id="resize-handles" tabindex="-1"><a href="#resize-handles" aria-hidden="true">#</a> Resize Handles</h3><p>You don&#39;t have to only anchor to one element. You could use many anchors for an element. You might have noticed that in the bar chart example. The tooltips were anchored to the chart and then the appropriate bar. If you took that concept a little further you could use it to resize elements.</p><p>You could treat the anchor points like custom resize handles and lean into an <code>inset</code> value.</p><pre><code><span>.container</span> <span>{</span></code></pre><p>In this demo, GreenSock Draggable makes the handles Draggable. But, the <code>&lt;img&gt;</code> element resizes to fill the container that adjusts to fill the gap between the handles.</p><p>This last one&#39;s a bit of a tease for what&#39;s to come. But, you can create a focusable popover and now you have anchor positioning. You could create the foundations of a styleable <code>&lt;select&gt;</code> element.</p><pre><code><span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>select-menu<span>&#34;</span></span><span>&gt;</span></span></code></pre><p>An implicit <code>anchor</code> will make this easier. But, the CSS for a rudimentary starting point could look like this:</p><pre><code><span>[popovertarget]</span> <span>{</span></code></pre><p>Combine the features of the Popover API with CSS Anchor positioning and you’re close.</p><p>It’s neat when you start introducing things like <code>:has()</code>. You could rotate the marker on open:</p><pre><code><span>.select-menu:has(:open) svg</span> <span>{</span></code></pre><p>Where could you take it next? What else do we need to make that a functioning <code>select</code>? We&#39;ll save that for the next article. But don’t worry, styleable select elements are coming. Stay tuned!</p><hr/><h3 id="thats-it" tabindex="-1"><a href="#thats-it" aria-hidden="true">#</a> That’s it!</h3><p>The web platform is evolving. CSS anchor positioning is a crucial part to improving how you develop UI controls. It will abstract you away from some of those tricky decisions. But it will also allow you to do things you&#39;ve never been able to do before. Such as styling a <code>&lt;select&gt;</code> element! Let us know what you think.</p><p><em>Photo by <a href="https://unsplash.com/@chuttersnap">CHUTTERSNAP</a> on <a href="https://unsplash.com/photos/f2LYxnmnKxI">Unsplash</a></em></p></div></div>
  </body>
</html>
