<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://unix.stackexchange.com/questions/230472/can-i-exec-an-entirely-new-process-without-an-executable-file">Original</a>
    <h1>Can I exec a new process without an executable file? (2015)</h1>
    
    <div id="readability-page-1" class="page"><div>
            








        <div id="content">

            

<div itemprop="mainEntity" itemscope="" itemtype="https://schema.org/Question">
    

    <div>

        

            
            <div>
                    <p><span>Asked</span>
                        <time itemprop="dateCreated" datetime="2015-09-18T05:33:01">7 years, 1 month ago</time>
                    </p>
                    
                    <p><span>Viewed</span>
                        8k times
                    </p>
            </div>
            <div id="mainbar" role="main" aria-label="question and answers">

                
<div data-questionid="230472" data-position-on-page="0" data-score="13" id="question">
    


    <div>
        

        

<div>
    
    <div itemprop="text">
                
<p>Suppose my non-root 32-bit app runs on a 64-bit system, all filesystems of which are mounted as read-only. The app creates an image of a 64-bit ELF in memory. But due to read-only filesystems it can&#39;t dump this image to a file to do an <code>execve</code> on. Is there still a supported way to launch a process from this image?</p>

<p>Note: the main problem here is to switch from 32-bit mode to 64-bit, not doing any <a href="https://stackoverflow.com/a/32384358/673852">potentially unreliable hacks</a>. If this is solved, then the whole issue becomes trivial â€” just make a custom loader.</p>
    </div>

        

    <div>
        <div>
            

                <div>
<div>
    
    <div>
        <a href="https://words.filippo.io/users/-1/community"><p><img src="https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=64&amp;d=identicon&amp;r=PG" alt="Community&#39;s user avatar" width="32" height="32"/></p></a>
    </div>
    
</div>
                </div>
            <div>
                <div>
    <p>
        asked <span title="2015-09-18 05:33:01Z">Sep 18, 2015 at 5:33</span>
    </p>
    <div>
        <a href="https://words.filippo.io/users/27672/ruslan"><p><img src="https://i.stack.imgur.com/S5IZ5.png?s=64&amp;g=1" alt="Ruslan&#39;s user avatar" width="32" height="32"/></p></a>
    </div>
    <div itemprop="author" itemscope="" itemtype="http://schema.org/Person">
        <p><a href="https://words.filippo.io/users/27672/ruslan">Ruslan</a><span itemprop="name">Ruslan</span></p><p><span title="reputation score " dir="ltr">3,119</span><span title="2 gold badges" aria-hidden="true"><span></span><span>2</span></span><span>2 gold badges</span><span title="25 silver badges" aria-hidden="true"><span></span><span>25</span></span><span>25 silver badges</span><span title="45 bronze badges" aria-hidden="true"><span></span><span>45</span></span><span>45 bronze badges</span>
        </p>
    </div>
</div>


            </div>
        </div>
    </div>
    
</div>




            <p><span itemprop="commentCount">3</span></p>
    </div>

</div>



                <div id="answers">
                    


                                        
<div id="answer-466637" data-answerid="466637" data-parentid="230472" data-score="18" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="acceptedAnswer" itemscope="" itemtype="https://schema.org/Answer">
    <div>
        

        

<div>
    
    <div itemprop="text">
<p>Yes, via <a href="http://man7.org/linux/man-pages/man2/memfd_create.2.html" rel="noreferrer"><code>memfd_create</code></a> and <a href="http://man7.org/linux/man-pages/man3/fexecve.3.html" rel="noreferrer"><code>fexecve</code></a>:</p>

<pre><code>int fd = memfd_create(&#34;foo&#34;, MFD_CLOEXEC);
// write your image to fd however you want
fexecve(fd, argv, envp);
</code></pre>
    </div>
    <div>
        <div>
            


            <div>
                <div>
    <p>
        answered <span title="2018-09-03 19:50:35Z">Sep 3, 2018 at 19:50</span>
    </p>
    <div>
        <a href="https://words.filippo.io/users/217726/joseph-sible-reinstate-monica"><p><img src="https://i.stack.imgur.com/RZLo7.png?s=64&amp;g=1" alt="Joseph Sible-Reinstate Monica&#39;s user avatar" width="32" height="32"/></p></a>
    </div>
    
</div>


            </div>
        </div>
        
    
    </div>
    
</div>




            <p><span itemprop="commentCount">2</span></p>
    </div>
</div>


                                        
<div id="answer-230597" data-answerid="230597" data-parentid="230472" data-score="2" data-position-on-page="2" data-highest-scored="0" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer">
    <div>
        

        

<div>
    
    <p>You&#39;re looking for something like &#34;userland exec&#34;. <a href="http://stratigery.com/userlandexec.html" rel="nofollow">Implementation here</a>. Basically, this involves loading some position-independent code that has no external references into memory, and marking it executable. This position independent code removes the previously-running executable, and reloads. Sounds like you might have to modify the userland exec I wrote at least a little.</p>
    <div>
        <div>
            


            <div>
                <div>
    <p>
        answered <span title="2015-09-18 17:01:47Z">Sep 18, 2015 at 17:01</span>
    </p>
    
    
</div>


            </div>
        </div>
        
    
    </div>
    
</div>




            <p><span itemprop="commentCount">3</span></p>
    </div>
</div>

                                        
<div id="answer-723513" data-answerid="723513" data-parentid="230472" data-score="0" data-position-on-page="3" data-highest-scored="0" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer">
    <div>
        

        

<div>
    
    <div itemprop="text">
<p>The comment by user732 and the link is outdated. But the gist is right; you need a &#34;userland exec&#34; implementation of which there are several.  One that is useful in scenario&#39;s where you can&#39;t write anywhere but can execute Python scripts can be found at <a href="https://github.com/anvilsecure/ulexecve/" rel="nofollow noreferrer">https://github.com/anvilsecure/ulexecve/</a>. I wrote this one and you might want some more context via the overview blogpost introducing it to the world: <a href="https://www.anvilsecure.com/blog/userland-execution-of-binaries-directly-from-python.html" rel="nofollow noreferrer">https://www.anvilsecure.com/blog/userland-execution-of-binaries-directly-from-python.html</a></p>
<p>It should be rather trivial to change the code of <code>ulexecve</code> above such that it switches as well from 32-bit to 64-bit mode or vice versa. That&#39;s an interesting use case I didn&#39;t think about nor implement. But the approach sketched by @Ruslan should work.</p>
<p>Rapid7&#39;s Mettle also has a utility named <code>noexec</code> that basically does the same thing: <a href="https://github.com/rapid7/mettle" rel="nofollow noreferrer">https://github.com/rapid7/mettle</a>. This is a lower-level utility written in C so you would end up with another ELF binary that would then allow you to do a userland execution.</p>
    </div>
    <div>
        <div>
            


            <div>
                <div>
    <p>
        answered <span title="2022-11-03 09:54:12Z">24 mins ago</span>
    </p>
    <div>
        <a href="https://words.filippo.io/users/547720/gvb"><p><img src="https://www.gravatar.com/avatar/23a446cb9ee368dc5b3d3d906dc0aec3?s=64&amp;d=identicon&amp;r=PG" alt="gvb&#39;s user avatar" width="32" height="32"/></p></a>
    </div>
    
</div>

    <div>
        <p><span><svg aria-hidden="true" width="18" height="18" viewBox="0 0 18 18"><path d="M10.7 17c-2.3 0-3.9-2.05-5.07-3.54l-.49-.6c-.67-.8-1.59-1.63-2.4-2.36A10.91 10.91 0 0 1 1.1 8.87a.79.79 0 0 1-.09-.56c.04-.19.14-.34.27-.4.14-.07.29-.1.45-.1.35 0 .67.18.87.34l3.5 2.75c.04.03.1.03.13 0a.09.09 0 0 0 .02-.13l-.02-.02c-.57-.8-3.42-4.77-3.71-5.15-.21-.27-.3-.58-.24-.84.05-.2.2-.37.4-.48.18-.09.35-.13.52-.13.44 0 .76.28.96.51l3.6 4.42c.04.04.07.06.14.02.05-.02.06-.07.03-.12L4.41 2.96a.94.94 0 0 1-.1-.73.92.92 0 0 1 .47-.57 1.06 1.06 0 0 1 1.4.39l3.8 6.14c.03.04.07.07.14.04.04-.03.06-.07.04-.13A153.8 153.8 0 0 0 8.1 2.54c-.31-.68-.2-1.14.36-1.42.52-.27 1.14-.07 1.47.48l3.69 8.3c.02.04.05.05.1.06a.1.1 0 0 0 .09-.07l.66-2.28c.1-.3.31-.56.62-.72.3-.15.65-.18.98-.1.7.2 1.09.87.89 1.52-.1.37-.46 1.73-.99 3.43l-.1.33c-.58 1.86-1.03 3.33-3.11 4.4-.7.35-1.38.53-2.05.53Z" fill="#FFC166"></path><path d="M14 .37a.5.5 0 0 0-.88.45l1.96 3.9a.5.5 0 0 0 .9-.45L14 .37Zm-1.17 2.17a.5.5 0 0 0-.91.42l.84 1.87a.5.5 0 1 0 .91-.41l-.84-1.88Zm-10.6 9.74a.5.5 0 0 1 .7-.02l1.7 1.6a.5.5 0 0 1-.7.72l-1.68-1.6a.5.5 0 0 1-.02-.7Zm-1.39.98a.5.5 0 1 0-.68.73l3.03 2.84a.5.5 0 0 0 .68-.73L.84 13.26Z" opacity=".4"></path></svg> New contributor</span>
        </p>
        <div>
            
            <p><a href="https://words.filippo.io/users/547720/gvb">gvb</a> is a new contributor to this site. Take care in asking for clarification, commenting, and answering.
Check out our <a href="https://words.filippo.io/conduct">Code of Conduct</a>.        </p></div>
    </div>

            </div>
        </div>
        
    
    </div>
    
</div>




            
    </div>
</div>


                        


                            <h2 data-loc="1">
                                
                            </h2>
                </div>
            </div>

                


    </div>

</div>


        </div>
    </div></div>
  </body>
</html>
