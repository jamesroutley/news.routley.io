<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://micahflee.com/despite-misleading-marketing-israeli-company-telemessage-used-by-trump-officials-can-access-plaintext-chat-logs/">Original</a>
    <h1>TeleMessage, used by Trump officials, can access plaintext chat logs</h1>
    
    <div id="readability-page-1" class="page"><div>
    <div>
            <article>
                    <header>
                        
                            <figure>
        <img srcset="/content/images/size/w300/2025/05/TM-SGNL-diagram-1.png 300w,
                    /content/images/size/w720/2025/05/TM-SGNL-diagram-1.png 720w,
                    /content/images/size/w960/2025/05/TM-SGNL-diagram-1.png 960w,
                    /content/images/size/w1200/2025/05/TM-SGNL-diagram-1.png 1200w,
                    /content/images/size/w2000/2025/05/TM-SGNL-diagram-1.png 2000w,
                    /content/images/2025/05/TM-SGNL-diagram-1.png" sizes="(max-width: 1200px) 100vw, 1200px" src="https://micahflee.com/content/images/size/w1200/2025/05/TM-SGNL-diagram-1.png" alt="Despite misleading marketing, Israeli company TeleMessage, used by Trump officials, can access plaintext chat logs"/>
            <figcaption><span>Diagram of how TeleMessage archives Signal messages, based on my analysis of the source code</span></figcaption>
    </figure>
                    </header>

                <section>
                    <p>Despite their misleading marketing, TeleMessage, the company that makes a modified version of Signal used by senior Trump officials, can access plaintext chat logs from its customers.</p><p>In this post I give a high level overview of how the TeleMessage fake Signal app, called TM SGNL, works and why it&#39;s so insecure. Then I give a thorough analysis of the source code for TM SGNL&#39;s Android app, and what led me to conclude that TeleMessage can access plaintext chat logs. Finally, I back up my analysis with as-of-yet unpublished details about the <a href="https://micahflee.com/the-signal-clone-the-trump-admin-uses-was-hacked/" rel="noreferrer">hack</a> of TeleMessage.</p><p>But first, here&#39;s a quick timeline of events.</p><ul><li>On Thursday, 404 Media <a href="https://www.404media.co/mike-waltz-accidentally-reveals-obscure-app-the-government-is-using-to-archive-signal-messages/" rel="noreferrer">reported</a> that in the Reuters <a href="https://www.reutersconnect.com/item/us-national-security-advisor-mike-waltz-attends-a-cabinet-meeting-held-by-president-trump-at-the-white-house-in-washington/dGFnOnJldXRlcnMuY29tLDIwMjU6bmV3c21sX1JDMkg4RUFEOEtGRw%3D%3D?ref=404media.co" rel="noreferrer">photo</a> showing former National Security Advisor and <a href="https://zeteo.com/p/signal-chat-war-crimes-revealed-yemen-trump-admin" rel="noreferrer">war criminal</a> Mike Waltz checking his Signal messages under the table, he was actually using an obscure modified Signal app called TM SGNL, and not the real and actually secure Signal app.</li><li>On Friday, I wrote <a href="https://micahflee.com/tm-sgnl-the-obscure-unofficial-signal-app-mike-waltz-uses-to-text-with-trump-officials/" rel="noreferrer">an analysis</a> of everything I could find out about TM SGNL using OSINT, including the fact that it&#39;s nearly impossible to install without a device enrolled in an MDM service that&#39;s tied to an Apple Business Manager or a Google Enterprise account.</li><li>On Saturday, after <a href="https://todon.eu/@ljrk/114444796069542288" rel="noreferrer">discovering</a> that TeleMessage <a href="https://web.archive.org/web/20250503004419/https://www.telemessage.com/developer/api-libraries/" rel="noreferrer">published</a> the source code for the TM SGNL apps for Android and iPhone themselves, I <a href="https://micahflee.com/heres-the-source-code-for-the-unofficial-signal-app-used-by-trump-officials/" rel="noreferrer">re-published them</a> on GitHub with the goal of making them easier to research. (It looks like the iOS source code is actually just unmodified Signal, so maybe they actually only published their Android code.)</li><li>On Saturday night, an anonymous source told me they hacked TeleMessage.</li><li>On Sunday, I, along with Joseph Cox, <a href="https://www.404media.co/the-signal-clone-the-trump-admin-uses-was-hacked/" rel="noreferrer">published an article</a> about the hack to 404 Media (and to <a href="https://micahflee.com/the-signal-clone-the-trump-admin-uses-was-hacked/" rel="noreferrer">my blog</a>).</li><li>On Monday, NBC News <a href="https://www.nbcnews.com/tech/security/telemessage-suspends-services-hackers-say-breached-app-rcna204925" rel="noreferrer">reported</a> that TeleMessage suspended its service after a <em>second hacker</em> breached TeleMessage and &#34;downloaded a large cache of files.&#34;</li><li>Today, Senator Ron Wyden <a href="https://www.wyden.senate.gov/imo/media/doc/doj_letter_telemessage.pdf" rel="noreferrer">published</a> a letter, which cites the 404 Media article and my analysis of TM SGNL, to Attorney General Pam Bondi, requesting that the Justice Department investigate the &#34;serious threat to U.S. national security posed by TeleMessage, a federal contractor that sold dangerously insecure communications software to the White House and other federal agencies.&#34;</li></ul><p>The devastating hacks confirm the analysis that I&#39;m sharing in this post: that TeleMessage&#39;s server â€“  hosted on the public AWS cloud, run by an <a href="https://www.dropsitenews.com/p/mikewaltz-tech-israel-nationalsecurity-signal" rel="noreferrer">Israeli company</a> that&#39;s lead by a former IDF spook â€“ has plaintext access to the Signal chat logs they&#39;re archiving (along with chat logs for Telegram, WeChat, and WhatsApp).</p><p><em>If you find this interesting, </em><a href="https://micahflee.com/tm-sgnl-the-obscure-unofficial-signal-app-mike-waltz-uses-to-text-with-trump-officials/#/portal/signup" rel="noreferrer"><em>subscribe</em></a><em> to get these posts emailed directly to your inbox. If you want to support my work, considering becoming a paid supporter.</em></p><p><strong>Table of Contents</strong></p><ul><li><a href="#overview" rel="noreferrer">Overview</a><ul><li><a href="#the-tm-sgnl-app" rel="noreferrer">The TM SGNL app</a></li><li><a href="#telemessages-archive-server" rel="noreferrer">TeleMessage&#39;s archive server</a></li><li><a href="#microsoft-365" rel="noreferrer">Microsoft 365</a></li><li><a href="#why-this-is-so-terribly-insecure" rel="noreferrer">Why this is so terribly insecure</a></li></ul></li><li><a href="#analysis-of-the-tm-sgnl-android-source-code" rel="noreferrer">Analysis of the TM SGNL Android source code</a><ul><li><a href="https://micahflee.com/the-signal-clone-the-trump-admin-uses-was-hacked/" rel="noreferrer">Decompiling shared libraries</a></li><li><a href="#important-components" rel="noreferrer">Important components</a></li><li><a href="#signaldatabase" rel="noreferrer">SignalDatabase</a></li><li><a href="#datagrabber" rel="noreferrer">DataGrabber</a></li><li><a href="#archivemessagesprocessor" rel="noreferrer">ArchiveMessagesProcessor</a></li><li><a href="#syncadapter" rel="noreferrer">SyncAdapter</a></li><li><a href="#networkmanager" rel="noreferrer">NetworkManager</a></li><li><a href="#tying-it-all-together" rel="noreferrer">Tying it all together</a></li><li><a href="#conclusion" rel="noreferrer">Conclusion</a></li></ul></li><li><a href="#corroborative-evidence-from-the-hack" rel="noreferrer">Corroborative evidence from the hack</a><ul><li><a href="#a-plaintext-signal-message" rel="noreferrer">A plaintext Signal message</a></li><li><a href="#a-plaintext-telegram-message" rel="noreferrer">A plaintext Telegram message</a></li><li><a href="#a-plaintext-whatsapp-message" rel="noreferrer">A plaintext WhatsApp message</a></li><li><a href="#an-encrypted-whatsapp-message" rel="noreferrer">An encrypted WhatsApp message</a></li><li><a href="#private-key-material" rel="noreferrer">Private key material</a></li></ul></li></ul><h2 id="overview">Overview</h2><p>TeleMessage makes modified versions of popular messaging apps, including Signal, WhatsApp, Telegram, and WeChat. The modified Signal app is almost entirely identical to the authentic version of Signal, except it also archives copies of every message to a destination determined by the TeleMessage customer. (Presumably, WhatsApp, Telegram, and WeChat work in the same way, but I have only analyzed the TM SGNL for Android source code.)</p><h3 id="the-tm-sgnl-app">The TM SGNL app</h3><p>TM SGNL is interoperable with Signal. When a TM SGNL user registers a new account, they&#39;re registering it with the official Signal server. TM SGNL users can send messages to Signal users and visa versa. If you&#39;re a Signal user, you have no way of knowing when you&#39;re talking to a TM SGNL user, because the apps are nearly identical and use the same infrastructure.</p><p>This is how Mike Waltz could accidentally add The Atlantic editor-in-chief Jeffrey Goldberg to a group chat where they discussed <a href="https://zeteo.com/p/signal-chat-war-crimes-revealed-yemen-trump-admin" rel="noreferrer">bombing an apartment building full of civilians</a>: Waltz was presumably using TM SGNL, and Goldberg was presumably using Signal.</p><p>Note that we don&#39;t know how long Trump officials have been using TM SGNL. It&#39;s possible they&#39;ve been using it since around Trump&#39;s inauguration on January 20. If this is the case, the chat logs for the Signal group where Waltz invited Goldberg will have been collected by TeleMessage. But it&#39;s also possible that they only started using TM SGNL <em>after</em> Signalgate, maybe as a way to attempt to start complying with record keeping laws. So far, we don&#39;t know the timeline. This would be good to get to the bottom of to understand what laws they have already broken.</p><p>Anyway, on Mike Waltz&#39;s phone â€“ and quite likely, the phones of Pete Hegseth, Marco Rubio, Tulsi Gabbard, JD Vance, and many others, possibly even including Donald Trump â€“ the TM SGNL app basically works like this:</p><ul><li>Every message the TM SGNL app sees gets stored in a SQLite database with a <code>status</code> column set to <code>WaitingToBeDelivered</code>.</li><li>TM SGNL registers with the phone&#39;s background syncing service. On a regular basis, the app runs some sync code that selects messages that are <code>WaitingToBeDelivered</code>. If there are any, it delivers them to TeleMessage&#39;s archive server at <code>https://archive.telemessage.com</code>, and updates their status to <code>Sent</code>.</li></ul><h3 id="telemessages-archive-server">TeleMessage&#39;s archive server</h3><p>As I discussed in <a href="https://micahflee.com/tm-sgnl-the-obscure-unofficial-signal-app-mike-waltz-uses-to-text-with-trump-officials/" rel="noreferrer">my initial OSINT analysis</a>, according to this documentation <a href="https://micahflee.com/content/files/2025/05/Capture-Mobile--TeleMessage-_Signal-Capture_20250502.pdf" rel="noreferrer">PDF</a>, the admins for organizations that use TeleMessage set up archive plans and assign users to them.</p><figure><img src="https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-02-13-09-10-1.png" alt="" loading="lazy" width="1795" height="771" srcset="https://micahflee.com/content/images/size/w600/2025/05/Screenshot-From-2025-05-02-13-09-10-1.png 600w, https://micahflee.com/content/images/size/w1000/2025/05/Screenshot-From-2025-05-02-13-09-10-1.png 1000w, https://micahflee.com/content/images/size/w1600/2025/05/Screenshot-From-2025-05-02-13-09-10-1.png 1600w, https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-02-13-09-10-1.png 1795w" sizes="(min-width: 1200px) 1200px"/><figcaption><span>How TM SNGL archive plans work, on page 22 of the documentation PDF</span></figcaption></figure><p>Each archive plan has a source messaging app (like TM SGNL) and a destination, which is controlled by the TeleMessage customer. Destinations can include Microsoft 365, email servers (SMTP), or file servers (SFTP). The admin assigns TeleMessage users â€“ like Mike Waltz â€“  to an archive plan, which determines where their chat logs will get archived.</p><p>Once the TM SGNL app sends chat logs to the archive server, the archive server is supposed to do something like this: It looks up the user that sent the chat log, then looks up that user&#39;s archive plan, then forwards the messages to destination defined in the archive plan (via SMTP or SFTP), and presumably (but who really knows for sure) deletes the chat logs from the archive server.</p><p>Here&#39;s a diagram of how the whole system appears to work:</p><figure><img src="https://micahflee.com/content/images/2025/05/TM-SGNL-diagram-2.png" alt="" loading="lazy" width="1200" height="825" srcset="https://micahflee.com/content/images/size/w600/2025/05/TM-SGNL-diagram-2.png 600w, https://micahflee.com/content/images/size/w1000/2025/05/TM-SGNL-diagram-2.png 1000w, https://micahflee.com/content/images/2025/05/TM-SGNL-diagram-2.png 1200w" sizes="(min-width: 720px) 720px"/><figcaption><span>Diagram of how TeleMessage archives Signal messages, based on my analysis of the source code</span></figcaption></figure><h3 id="microsoft-365">Microsoft 365</h3><p>The archive server appears to connect directly to SMTP and SFTP destinations to push chat logs. However, according to <a href="https://learn.microsoft.com/en-us/purview/archive-signal-archiver-data" rel="noreferrer">Microsoft&#39;s documentation</a>, Microsoft 365 works the opposite way: Microsoft 365 logs into the archive server and pulls the chat logs once a day. Their docs state:</p><blockquote>The Signal Archiver connector that you create in the Microsoft Purview portal connects to the TeleMessage site every day and transfers the email messages from the previous 24 hours to a secure Azure Storage area in the Microsoft Cloud.</blockquote><p>They even published their own diagram explaining how it works:</p><figure><img src="https://micahflee.com/content/images/2025/05/signalconnectorworkflow.png" alt="" loading="lazy" width="748" height="457" srcset="https://micahflee.com/content/images/size/w600/2025/05/signalconnectorworkflow.png 600w, https://micahflee.com/content/images/2025/05/signalconnectorworkflow.png 748w" sizes="(min-width: 720px) 720px"/><figcaption><span>Using a connector to archive Signal communication data in Microsoft 365, from Microsoft&#39;s documentation</span></figcaption></figure><h3 id="why-this-is-so-terribly-insecure">Why this is so terribly insecure</h3><p>Signal is the gold standard of end-to-end encrypted messaging apps.</p><p>Messages are encrypted between endpoints â€“ whether that&#39;s a phone running Signal, a computer running Signal Desktop, or even a phone running TM SGNL. The Signal server, and any internet eavesdroppers, cannot access the chat logs.</p><p>However, once they&#39;re at an endpoint, they are in plaintext (if they weren&#39;t, you wouldn&#39;t be able to read your texts). At this point, they&#39;re protected by various forms of disk encryption depending on the device. This is how Signal messages sometimes end up as evidence in court records: someone&#39;s phone or laptop with Signal installed was searched, after the messages were already decrypted.</p><p><strong>TM SGNL <em>completely breaks this security</em>. The communication between the TM SGNL app and the final archive destination <em>is not end-to-end encrypted</em>.</strong></p><p>TeleMessage lies about this in their marketing material, claiming that TM SGNL supports &#34;End-to-End encryption from the mobile phone through to the corporate archive.&#34;</p><p>Here&#39;s a screenshot from an <a href="https://web.archive.org/web/20250501200805/https://www.telemessage.com/mobile-archiver/signal-archiver/" rel="noreferrer">archived version</a> of their site (since they&#39;ve taken down all of the content):</p><figure><img src="https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-05-20-22-08.png" alt="" loading="lazy" width="1637" height="1239" srcset="https://micahflee.com/content/images/size/w600/2025/05/Screenshot-From-2025-05-05-20-22-08.png 600w, https://micahflee.com/content/images/size/w1000/2025/05/Screenshot-From-2025-05-05-20-22-08.png 1000w, https://micahflee.com/content/images/size/w1600/2025/05/Screenshot-From-2025-05-05-20-22-08.png 1600w, https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-05-20-22-08.png 1637w" sizes="(min-width: 720px) 720px"/><figcaption><span>TeleMessage falsely claims that TM SGNL supports &#34;End-to-End encryption from the mobile phone through to the corporate archive&#34;</span></figcaption></figure><p>Instead, TM SGNL sends the plaintext, already decrypted versions of chat logs to the archive server. (There might be some encryption involved some of the time, which I go over the &#34;Corroborative evidence from the hack&#34; section at the bottom.)</p><p>The archive server then forwards these to the destination.</p><p>Anyway, after TM SGNL decrypts messages, it sends the plaintext chat logs to TeleMessage&#39;s archive server. <strong>At this point, a lot of people might have access to the chat logs.</strong></p><p>The archive server was hosted in the public AWS cloud in their data center in Northern Virginia. This is not an approved place to store classified information, and potentially rogue AWS employees could have had access. This server was open to the public â€“ anyone in the world could send HTTP requests to it to try to get chat logs back in a response. On Saturday, <a href="https://micahflee.com/the-signal-clone-the-trump-admin-uses-was-hacked/" rel="noreferrer">one of those people did</a>.</p><p>I&#39;m saying the server &#34;was&#34; hosted in AWS because TeleMessage <a href="https://www.nbcnews.com/tech/security/telemessage-suspends-services-hackers-say-breached-app-rcna204925" rel="noreferrer">took down</a> their archive server shortly after we published the story about the hack. As of this writing, their archive server is offline.</p><p>TeleMessage also might be sharing chat logs with Israeli intelligence.</p><p>TeleMessage is an Israeli company. It was founded in 1999 by Guy Levit, the same year he left his job in the Israel Defense Force where he &#34;served as the head of the planning and development of one of the IDFâ€™s Intelligence elite technical units,&#34; according to his bio on the TeleMessage website (they have since taken all the content off their website).</p><p>Levit, and others at his firm, have access to the archive server and all of the chat logs it contains. I don&#39;t know what Israel&#39;s version of the Patriot Act is like, but I do know that it would be trivial for TeleMessage to add a bit of code that forwards a copy of everything to Israeli intelligence â€“ far simpler than it was to add code to Signal to forward a copy to themselves.</p><p>To be clear, there&#39;s no evidence yet that TeleMessage is sharing chat logs with the Israeli government. <strong>But the fact that they designed their archiving system to <em>not be end-to-end encrypted</em>, and that they lie about it, is quite a big red flag.</strong></p><p>This is the app that Mike Waltz uses. While we don&#39;t really know the timeline, it&#39;s possible that everyone in the 19-person Signalgate group, where they discussed bombing Yemen, were also using this app same app. These include JD Vance, John Ratcliffe, Marco Rubio, Pete Hegseth, Stephen Miller, Tulsi Gabbard, and others. It&#39;s plausible that Israeli intelligence has been reading the internal chat logs of the most powerful members of Trump&#39;s authoritarian government.</p><h2 id="analysis-of-the-tm-sgnl-android-source-code">Analysis of the TM SGNL Android source code</h2><p>I&#39;ve only analyzed the the <a href="https://github.com/micahflee/TM-SGNL-Android" rel="noreferrer">TM SGNL Android source code</a>, not the <a href="https://github.com/micahflee/TM-SGNL-iOS" rel="noreferrer">iPhone source code</a>. I&#39;m assuming that the iPhone app works in the same way as the Android app, and anything that I learn from analyzing the Android app is applicable to the iPhone app as well.</p><p>I&#39;ve focused on Android because it&#39;s much easier to reverse engineer Android apps than iPhone apps. There are excellent tools available for analyzing Android apps, like <a href="https://apktool.org/" rel="noreferrer">apktool</a>, <a href="https://github.com/EFForg/apkeep" rel="noreferrer">apkeep</a>, and even the official <a href="https://developer.android.com/studio" rel="noreferrer">Android Studio</a>. Furthermore, Android apps are programmed in Java and Kotlin (which both compile to Java bytecode), and it&#39;s easy to decompile Java bytecode, turning it back into human readable source code, and making it so much easier to work with.</p><p>Also, while TeleMessage <a href="https://web.archive.org/web/20250503004419/https://www.telemessage.com/developer/api-libraries/" rel="noreferrer">posted links</a> to ZIP files claiming to be contain the Android and iOS source code on their website, the iOS version <a href="https://github.com/micahflee/TM-SGNL-iOS/issues/1" rel="noreferrer">appears</a> to actually be the source code for Signal for iOS itself, without any extra TeleMessage code added.</p><div><p>ðŸ’¡</p><p>As you can see in the <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/LICENSE" rel="noreferrer">LICENSE</a> file included with the source code, TM SGNL is licensed under GNU Affero General Public License v3.0. This gives me, and everyone else, the unlimited right to access, analyze, reverse engineer, and pretty much do anything else we wish to with the code, so long as we release any derivative works under the same license.</p></div><p>I&#39;ve only had a few days to look at this code so far â€“ and I paused work on analyzing it so I could break the story about TeleMessage getting hacked â€“ so there&#39;s a lot that I still don&#39;t fully understand. It&#39;s also possible I have gotten things wrong â€“ please <a href="https://micahflee.com/contact/" rel="noreferrer">let me know</a> if that&#39;s the case. In any case, I&#39;m showing all of my work here so that others can reproduce it and build on it.</p><p>The TM SGNL source code is mostly the same as the <a href="https://github.com/signalapp/Signal-Android" rel="noreferrer">Signal for Android source code</a>, but there are some differences. Most of the new code can be found in these three places:</p><p>The <a href="https://github.com/micahflee/TM-SGNL-Android/tree/libs/app/src/tm/java/org" rel="noreferrer">app/src/tm/java/org/</a> folder contains TeleMessage code.</p><figure><img src="https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-05-12-21-32.png" alt="" loading="lazy" width="1583" height="827" srcset="https://micahflee.com/content/images/size/w600/2025/05/Screenshot-From-2025-05-05-12-21-32.png 600w, https://micahflee.com/content/images/size/w1000/2025/05/Screenshot-From-2025-05-05-12-21-32.png 1000w, https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-05-12-21-32.png 1583w" sizes="(min-width: 720px) 720px"/><figcaption><span>TeleMessage code in app/src/tm/java/org/</span></figcaption></figure><p>The <a href="https://github.com/micahflee/TM-SGNL-Android/tree/libs/app/src/main/java/org/tm/archive" rel="noreferrer">app/src/main/java/org/tm/archive/</a> folder also contains TeleMessage code:</p><figure><img src="https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-05-17-02-15.png" alt="" loading="lazy" width="1763" height="1188" srcset="https://micahflee.com/content/images/size/w600/2025/05/Screenshot-From-2025-05-05-17-02-15.png 600w, https://micahflee.com/content/images/size/w1000/2025/05/Screenshot-From-2025-05-05-17-02-15.png 1000w, https://micahflee.com/content/images/size/w1600/2025/05/Screenshot-From-2025-05-05-17-02-15.png 1600w, https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-05-17-02-15.png 1763w" sizes="(min-width: 720px) 720px"/><figcaption><span>More TeleMessage code in app/src/main/java/org/tm/archive/</span></figcaption></figure><p>And finally, the <a href="https://github.com/micahflee/TM-SGNL-Android/tree/master/app/libs" rel="noreferrer">app/libs/</a> folder contains TeleMessage&#39;s shared libraries in Android archive (<code>.aar</code>) format. These include <code>androidcopysdk-signal</code>, <code>authenticatorsdk-signal</code>, and <code>common</code>. Shared libraries are re-usable pieces of code that can be imported into different projects. These libraries appear to contain code that might also be shared in TeleMessage&#39;s other Android apps for WhatsApp, WeChat, and Telegram. The Android archive files are compressed Java bytecode.</p><figure><img src="https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-05-12-25-26.png" alt="" loading="lazy" width="1583" height="954" srcset="https://micahflee.com/content/images/size/w600/2025/05/Screenshot-From-2025-05-05-12-25-26.png 600w, https://micahflee.com/content/images/size/w1000/2025/05/Screenshot-From-2025-05-05-12-25-26.png 1000w, https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-05-12-25-26.png 1583w" sizes="(min-width: 720px) 720px"/><figcaption><span>Shared libraries in app/libs/</span></figcaption></figure><p>The first step to reverse engineering this is to turn these shared libraries into actual human-readable (or at least, human nerd-readable) Java code.</p><p>There are various local tools that can do this, but I&#39;ve found using online services to decompile Android apps is the simplest approach. I ran the release versions of the shared libraries through this <a href="https://appscms.com/aar" rel="noreferrer">Android archive decompiler</a>, and it gave me zip files with the decompiled source code.</p><p>To make things easier for others to follow along, I have made a new git branch in my TM-SGNL-Android repository called <code>libs</code> and I committed the decompiled shared library code there. I&#39;ve made the <code>libs</code> branch the default branch, too. You can now access all of the shared library code in the <a href="https://github.com/micahflee/TM-SGNL-Android/tree/libs/app/libs" rel="noreferrer">apps/libs/</a> folder of the <code>libs</code> branch:</p><figure><img src="https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-05-12-30-12.png" alt="" loading="lazy" width="1583" height="1040" srcset="https://micahflee.com/content/images/size/w600/2025/05/Screenshot-From-2025-05-05-12-30-12.png 600w, https://micahflee.com/content/images/size/w1000/2025/05/Screenshot-From-2025-05-05-12-30-12.png 1000w, https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-05-12-30-12.png 1583w" sizes="(min-width: 720px) 720px"/><figcaption><span>The app/libs/ folder, with folders full of human-readable Java source code</span></figcaption></figure><p>Now that we all have access to the same source code, I will try to give a brief tour of what I&#39;ve found to be the relevant pieces of code to bring me to my conclusion.</p><h3 id="important-components">Important components</h3><p>Here are some important components in the codebase:</p><ul><li><a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/src/main/java/org/tm/archive/database/SignalDatabase.kt" rel="noreferrer"><code>SignalDatabase</code></a>: This class represents the SQLite database that stores all of the Signal data (messages, attachments, media, threads, identities, drafts, groups, recipients, stickers, reactions, and so on), for delivering to the archive server.</li><li><a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/DataGrabber.java" rel="noreferrer"><code>DataGrabber</code></a>: This class (in the <code>androidcopysdk</code> shared library) seems to do a few things.<ul><li>Many of its 2,577 lines of code are devoted to capturing the phone&#39;s SMS and MMS messages, as well as call logs â€“ though I don&#39;t think this code is used in the SGNL app.</li><li>It also has a <code>setMessage</code> method, which the SGNL app does use. In this method, it uses a <a href="https://dev.to/vishwajithshettigar/understanding-contentprovider-and-contentresolver-in-android-with-kotlin-17eg" rel="noreferrer"><code>ContentResolver</code></a> to store messages in a separate SQLite database, staging messages before they get sent to the archive server. I&#39;ll call this the <em>staging database</em>.</li></ul></li><li><a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/src/tm/java/org/archiver/di/TeleMessageApplicationDependencyProvider.kt" rel="noreferrer"><code>TeleMessageApplicationDependencyProvider</code></a>: This class provides access to the SDK module (an object with pointers to various singleton components like the <code>DataGrabber</code> and <code>SignalDatabase</code> objects).<ul><li>It also provides access to the <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/device/DefaultMessageStoreObserver.java" rel="noreferrer"><code>messageStoreObserver</code></a>. This object can have processors, which are basically hooks that get executed when message statuses change.</li><li><a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/device/ArchiveMessagesProcessor.java" rel="noreferrer"><code>ArchiveMessagesProcessor</code></a>: This is a <code>messageStoreObserver</code> processor. When messages in <code>SignalDatabase</code> get created (or edited or deleted), this runs <code>DataGrabber.setMessage</code> to store the message in the staging database.</li></ul></li><li><a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/SyncAdapter.java" rel="noreferrer"><code>SyncAdapter</code></a>: This class (also in the <code>androidcopysdk</code> shared library) is an Android <a href="https://developer.android.com/training/sync-adapters/creating-sync-adapter" rel="noreferrer">sync adapter</a>. It defines a background service that, every time the <code>onPerformSync</code> method is called, uses the <code>ContentResolver</code> to select <code>WaitingToBeDelivered</code> data from the staging database, and then submits it to the TeleMessage&#39;s archive server.</li></ul><p>Now I&#39;m going to go into a bit more detail about these components, and how they tie together.</p><h3 id="signaldatabase">SignalDatabase</h3><p>Here&#39;s the beginning of the <code>SignalDatabase</code> <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/src/main/java/org/tm/archive/database/SignalDatabase.kt#L30" rel="noreferrer">class definition</a>. As you can see, it defines the tables that will be used to store different types of Signal data:</p><pre><code>open class SignalDatabase(private val context: Application, databaseSecret: DatabaseSecret, attachmentSecret: AttachmentSecret) :
  SQLiteOpenHelper(
    context,
    DATABASE_NAME,
    databaseSecret.asString(),
    null,
    SignalDatabaseMigrations.DATABASE_VERSION,
    0,
    SqlCipherErrorHandler(DATABASE_NAME),
    SqlCipherDatabaseHook(),
    true
  ),
  SignalDatabaseOpenHelper, IDatabase&lt;Long&gt; { // TM_SA implement IDatabase

  val messageTable: MessageTable = TeleMessageTable(context, this)  // TM_SA TeleMessageTable
  val attachmentTable: AttachmentTable = TeleAttachmentTable(context, this, attachmentSecret) // TM_SA TeleAttachmentTable
  val mediaTable: MediaTable = MediaTable(context, this)
  val threadTable: ThreadTable = ThreadTable(context, this)
  val identityTable: IdentityTable = IdentityTable(context, this)
  val draftTable: DraftTable = DraftTable(context, this)
  val groupTable: GroupTable = GroupTable(context, this)
  val recipientTable: RecipientTable = RecipientTable(context, this)
  val groupReceiptTable: GroupReceiptTable = GroupReceiptTable(context, this)
  val preKeyDatabase: OneTimePreKeyTable = OneTimePreKeyTable(context, this)
  val signedPreKeyTable: SignedPreKeyTable = SignedPreKeyTable(context, this)
  val sessionTable: SessionTable = SessionTable(context, this)
  val senderKeyTable: SenderKeyTable = SenderKeyTable(context, this)
  val senderKeySharedTable: SenderKeySharedTable = SenderKeySharedTable(context, this)
  val pendingRetryReceiptTable: PendingRetryReceiptTable = PendingRetryReceiptTable(context, this)
  val searchTable: SearchTable = SearchTable(context, this)
  val stickerTable: StickerTable = StickerTable(context, this, attachmentSecret)
  val storageIdDatabase: UnknownStorageIdTable = UnknownStorageIdTable(context, this)
  val remappedRecordTables: RemappedRecordTables = RemappedRecordTables(context, this)
  val mentionTable: MentionTable = MentionTable(context, this)
  val paymentTable: PaymentTable = PaymentTable(context, this)
  val chatColorsTable: ChatColorsTable = ChatColorsTable(context, this)
  val emojiSearchTable: EmojiSearchTable = EmojiSearchTable(context, this)
  val messageSendLogTables: MessageSendLogTables = MessageSendLogTables(context, this)
  val avatarPickerDatabase: AvatarPickerDatabase = AvatarPickerDatabase(context, this)
  val reactionTable: ReactionTable = ReactionTable(context, this)
  val notificationProfileDatabase: NotificationProfileDatabase = NotificationProfileDatabase(context, this)
  val donationReceiptTable: DonationReceiptTable = DonationReceiptTable(context, this)
  val distributionListTables: DistributionListTables = DistributionListTables(context, this)
  val storySendTable: StorySendTable = StorySendTable(context, this)
  val cdsTable: CdsTable = CdsTable(context, this)
  val remoteMegaphoneTable: RemoteMegaphoneTable = RemoteMegaphoneTable(context, this)
  val pendingPniSignatureMessageTable: PendingPniSignatureMessageTable = PendingPniSignatureMessageTable(context, this)
  val callTable: CallTable = CallTable(context, this)
  val kyberPreKeyTable: KyberPreKeyTable = KyberPreKeyTable(context, this)
  val callLinkTable: CallLinkTable = CallLinkTable(context, this)</code></pre><p>The <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/src/main/java/org/tm/archive/database/SignalDatabase.kt#L85-L160" rel="noreferrer"><code>onCreate</code></a> method creates the tables if they don&#39;t exist.</p><p>I&#39;ll need to dig into the code further to see the exact places where it happens, but I believe whenever the TM SGNL app receives or sends Signal messages, they get inserted into this database.</p><h3 id="datagrabber">DataGrabber</h3><p>Here is the <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/DataGrabber.java#L2035-L2047" rel="noreferrer"><code>setMessage</code></a> method in the <code>DataGrabber</code> class:</p><pre><code>public synchronized void setMessage(MessageDetailsArchive messageDetailsArchive) {
    Log.d(&#34;info&#34;, &#34;setTextMessage start&#34;);
    String lasttime = getLastMessageByType(this.mContext, MessageType.SMS);
    Long.valueOf(lasttime).longValue();
    ContentValues contentValues = prepareValues(messageDetailsArchive.getProtocol(), messageDetailsArchive.getToPhonesArray(), messageDetailsArchive.getFromPhoneNumber(), messageDetailsArchive.getBody(), messageDetailsArchive.getId(), messageDetailsArchive.getDate(), messageDetailsArchive.getSubject(), messageDetailsArchive.getMyNumber(), messageDetailsArchive.getChatMode(), messageDetailsArchive.getChatName(), messageDetailsArchive.getChatId(), messageDetailsArchive.getFromName(), messageDetailsArchive.getFromValue(), messageDetailsArchive.getToNameArray(), messageDetailsArchive.getToPhoneNumberArrayValue(), messageDetailsArchive.getMessageType());
    contentValues.put(&#34;type&#34;, MessageType.SMS.name());
    Uri path = this.mContext.getContentResolver().insert(MessageContentProvider.CONTENT_URI, contentValues);
    Log.d(&#34;grabber&#34;, &#34;insert message and id and time , id: &#34; + path.getPath() + &#34; &#34; + messageDetailsArchive.getDate() + &#34; &#34; + messageDetailsArchive.getId() + &#34;  sub = &#34; + messageDetailsArchive.getSubject());
    SharedPreferences.Editor editor = PreferenceManager.getDefaultSharedPreferences(this.mContext).edit();
    editor.putString(MessageType.SMS.name() + DATE_OF_MESSAGE, messageDetailsArchive.getDate()).apply();
    Log.d(&#34;info&#34;, &#34;setTextMessage end&#34;);
    CommonUtils.startBackupService(this.mContext);
}</code></pre><p>Notice that even though we&#39;re storing Signal messages, this line explicitly sets the message type to SMS, which will be important later:</p><pre><code>contentValues.put(&#34;type&#34;, MessageType.SMS.name());</code></pre><p>This line of code inserts the message into the staging database:</p><pre><code>Uri path = this.mContext.getContentResolver().insert(MessageContentProvider.CONTENT_URI, contentValues);</code></pre><p>And this line of code triggers the <code>SyncAdapter</code> to run:</p><pre><code>CommonUtils.startBackupService(this.mContext);</code></pre><h3 id="archivemessagesprocessor">ArchiveMessagesProcessor</h3><p>This is a processor in the <code>messageStoreObserver</code>. Whenever a message in <code>SignalDatabase</code> is created/modified, the <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/device/ArchiveMessagesProcessor.java#L116-L147" rel="noreferrer"><code>processAfterMessageStateChanged</code></a> method gets called:</p><pre><code>@Override // com.tm.androidcopysdk.device.MessageStoreProcessor
protected void processAfterMessageStateChanged(@NotNull ArchiveMessage message, @Nullable ArchiveMessage existing) {
    Intrinsics.checkNotNullParameter(message, &#34;message&#34;);
    String cleanAccountPhoneNumber = message.getCleanAccountPhoneNumber();
    if (cleanAccountPhoneNumber == null || cleanAccountPhoneNumber.length() == 0) {
        Log.d(getTag(), &#34;ignoring archive message &#34; + message.getArchiveId() + &#34;, account phone number is missing.&#34;);
        return;
    }
    boolean isNewEdit = message.isNewEdit(existing);
    if (!isArchivingSupported(message, isNewEdit) || message.getTimestamp().getValue() &lt;= 0) {
        Log.d(getTag(), &#34;ignoring unsupported message &#34; + message.getArchiveId() + &#34; of type &#34; + message.getType() + &#34; created at &#34; + message.getTimestamp().getValue() + &#39;.&#39;);
    } else if (message.hasDeletions()) {
        archiveDeletedMessage(message, existing);
    } else if (isNewEdit) {
        archiveEditMessage(message, existing);
    } else {
        ArchiveMessageType type = message.getType();
        switch (type == null ? -1 : WhenMappings.$EnumSwitchMapping$0[type.ordinal()]) {
            case 1:
                archiveMessage(message, existing);
                return;
            case 2:
                archiveMmsMessage(message, existing);
                return;
            case 3:
                archiveCallMessage(message, existing);
                return;
            default:
                Log.w(getTag(), &#34;not sure how to handle &#34; + message + &#39; &#39; + existing + &#39; &#39; + this.detailsConverter.convert(message, existing));
                return;
        }
    }
}</code></pre><p>As you can see, this code will archive messages when they get deleted (<code>archiveDeletedMessage</code>), when they get edited (<code>archiveEditMessage</code>), as well as when they get created (<code>archiveMessage</code>).</p><p>Here&#39;s the code in <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/device/ArchiveMessagesProcessor.java#L175-L185" rel="noreferrer"><code>archiveMessage</code></a>:</p><pre><code>private final void archiveMessage(ArchiveMessage message, ArchiveMessage existing) {
    if (existing != null) {
        Log.d(getTag(), &#34;message &#34; + message.getArchiveId() + &#34; was already archived, skipping.&#34;);
    } else if (message.getStatus() == MessageStatus.Sending &amp;&amp; !message.getChat().isSecret()) {
        Log.d(getTag(), &#34;message &#34; + message.getArchiveId() + &#34; is still in &#39;Sending&#39; state, skipping.&#34;);
    } else {
        MessageDetailsArchive details = this.detailsConverter.convert(message, existing);
        Log.d(getTag(), &#34;archiveMessage &#34; + message + &#39; &#39; + details);
        this.module.getDataGrabber().setMessage(details);
    }
}</code></pre><p>When a message is archived, it runs <code>setMessage</code> on <code>DataGrabber</code>, which, as described above, inserts the message into the staging database and triggers the sync adapter.</p><h3 id="syncadapter">SyncAdapter</h3><p>The <code>SyncAdapter</code>&#39;s <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/SyncAdapter.java#L96-L409" rel="noreferrer"><code>onPerformSync</code></a> method is too long to quote in full here, so I will just quote pieces of it at a time. This is the method that Android will call in the background at regular intervals, or that the app itself can trigger, such as when a new message comes in.</p><p>Near the beginning of the method, <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/SyncAdapter.java#L122-L127" rel="noreferrer">this code</a> creates a <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/network/NetworkManager.java" rel="noreferrer"><code>NetworkManager</code></a> object, which is the class used to communicate with TeleMessage&#39;s archive server.</p><pre><code>String baseurl = bundle.getString(&#34;baseurl&#34;);
String keeperUrl = PreferenceManager.getDefaultSharedPreferences(this.mContext).getString(&#34;keeperUrl&#34;, null);
if (!TextUtils.isEmpty(keeperUrl)) {
    baseurl = keeperUrl;
}
NetworkManager nm = new NetworkManager(this.mContext, baseurl);
String myNumber = FlavorSettings.getInstance().getMSISDN(PreferenceManager.getDefaultSharedPreferences(getContext()).getString(&#34;phonenumber&#34;, &#34;999999999&#34;));</code></pre><p>When it creates the <code>NetworkManager</code> object, it passes in the base URL. How it determines this URL is a bit confusing. But ultimately, if <code>keeperUrl</code> is not empty, then it uses that value as the base URL. As I will describe below, the <code>keeperUrl</code> value comes from <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/src/tm/java/org/archiver/ArchiveConstants.kt#L24" rel="noreferrer"><code>ArchiveConstants</code></a>:</p><pre><code>const val prodKeeper = &#34;https://archive.telemessage.com&#34;</code></pre><p>It also sets <code>myNumber</code> to be the current user&#39;s phone number.</p><p>Next in <code>SyncAdapter</code>&#39;s <code>onPerformSync</code> method, <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/SyncAdapter.java#L131-L138" rel="noreferrer">this code</a> makes a SQL query to the staging database, selecting all messages that are waiting to be delivered (for the sake of easier reading, I&#39;ve added some newlines to the code displayed here, but I haven&#39;t modified any of it):</p><pre><code>long installation_date = PrefManager.getLongPref(
    this.mContext.getApplicationContext(), 
    PrefManagerConstants.SHARED_PREFERENCE_INSTALLATION_DATE_KEY, 
    PreferenceManager.getDefaultSharedPreferences(this.mContext).getLong(PrefManagerConstants.SHARED_PREFERENCE_INSTALLATION_DATE_KEY, 0L)
);
Log.d(TAG, &#34;installation_date: &#34; + installation_date);
Log.d(TAG, &#34;baseurl: &#34; + baseurl);
String[] condition = {
    String.valueOf(installation_date), 
    MessageContentProvider.MessageDeliveryStatus.WaitingToBeDelivered.name()
};
Cursor cur = this.mContentResolver.query(
    MessageContentProvider.CONTENT_URI, 
    null, 
    &#34;date &gt;= ? AND status = ? &#34;, 
    condition, 
    &#34;date DESC&#34;
);
Log.d(TAG, &#34;count: &#34; + cur.getCount());
boolean z = 0 != (this.mContext.getApplicationInfo().flags &amp; 2);
cur.moveToFirst();</code></pre><p>First, it pulls <code>installation_date</code> from the app preferences â€“  this was the timestamp that TM SGNL was installed.</p><p>Then it defines <code>condition</code> to be an array with the first item a string version of the <code>installation_date</code> timestamp, and the second item the message delivery status <code>WaitingToBeDelivered</code>.</p><p>Then, using the <code>ContentResolver</code>, it queries the staging database to select all messages where the date is greater than or equal to <code>installation_date</code>, and the status is <code>WaitingToBeDelivered</code>, with the results sorted by date in descending order.</p><p>Next in <code>onPerformSync</code>, <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/SyncAdapter.java#L147-L154" rel="noreferrer">this code</a> starts looping through every message found in the SQL results, submitting them to the archive server:</p><pre><code>do {
    String typestr = cur.getString(cur.getColumnIndex(&#34;type&#34;));
    if (MessageType.valueOf(typestr) == MessageType.SMS) {
        BodyBase sr = Packager.packENATextMessage(cur, myNumber);
        DBKeepAliveQueryHelper.updateSendToServerTime(this.mContext, ((TelemessageArchiverMessage) sr).getNativeId(), String.valueOf(System.currentTimeMillis()));
        Log.d(&#34;network&#34;, &#34;send message:&#34; + ((TelemessageArchiverMessage) sr).getNativeId());
        Response&lt;Void&gt; res = nm.start(sr, this, getContext().getApplicationContext(), false);
        Log.d(&#34;network&#34;, &#34;after sent object&#34;);</code></pre><p>The code checks if the message type is <code>MessageType.SMS</code> here, but as I described in the <code>DataGrabber</code> section above, Signal messages are treated as SMS messages.</p><p>It then creates a variable <code>sr</code> which contains the current message row from the SQL query, along with the user&#39;s phone number. In the following two lines, notice that it typecasts <code>sr</code> to <code>TelemessageArchiverMessage</code>, meaning that <code>sr</code> is of type <code>TelemessageArchiverMessage</code>.</p><p>Finally, it runs <code>nm.start</code> in the <code>NetworkManager</code> object, passing in the <code>sr</code> variable with the message data. This is the where the actual HTTP request to the base URL (the TeleMessage archive server) happens.</p><h3 id="networkmanager">NetworkManager</h3><p>Let&#39;s take a quick peak over in <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/network/NetworkManager.java#L65-L166" rel="noreferrer"><code>NetworkManager.start</code></a>:</p><pre><code>public &lt;T&gt; retrofit2.Response&lt;T&gt; start(BodyBase message, HandleResponseListener listener, Context context, boolean log) {
    this.mListener = listener;
    Log.d(&#34;network&#34;, &#34;started api call&#34;);
    INetworkProvider networkProvider = context.getApplicationContext().networkProvider();
    TMCredentialsStore credentialsStore = TMCredentialsStore.getInstance(context);
    networkProvider.headersInterceptor().setAuthentication(credentialsStore.userName(context), credentialsStore.password(context));
    AndroidCopyServerAPI TMAndroidCopyAPI = (AndroidCopyServerAPI) networkProvider.service(this.mBaseUrl, AndroidCopyServerAPI.class);
    Call caller = null;
    if (message instanceof TeleMessageMMSArchive) {
        if (!CommonUtils.isUserArchive(context)) {
            caller = TMAndroidCopyAPI.postTelemessageMMSMessage(NetworkManagerAPIUtil.getPostMessageURLByAPIVersion(context), new EnaMmsRequestBody(context, (TeleMessageMMSArchive) message));
        }
    } else if (message instanceof TelemessageArchiverMessage) {
        if (!CommonUtils.isUserArchive(context)) {
            networkProvider.headersInterceptor().setMessageId(message.getMessageId());
            caller = TMAndroidCopyAPI.postSMSMessage(NetworkManagerAPIUtil.getPostMessageURLByAPIVersion(context), (TelemessageArchiverMessage) message);
        }
    } else if (message instanceof SMSMessageRecord) {</code></pre><p>This is the code that makes an API call. There&#39;s a big if/else block that checks for different types of messages. If the message type is <code>TelemessageArchiverMessage</code> (which it is for these Signal messages), it runs <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/network/NetworkManager.java#L80" rel="noreferrer">this</a> line of code:</p><pre><code>caller = TMAndroidCopyAPI.postSMSMessage(NetworkManagerAPIUtil.getPostMessageURLByAPIVersion(context), (TelemessageArchiverMessage) message);</code></pre><p>If you look at <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/libs/androidcopysdk-signal/sources/com/tm/androidcopysdk/network/AndroidCopyServerAPI.java#L26-L27" rel="noreferrer"><code>AndroidCopyServerAPI.postSMSMessage</code></a>, you&#39;ll see that it makes a POST request to <code>https://archive.telemessage.com/api/rest/archive/telemessageincomingmessage/</code>, with the message content in the body:</p><pre><code>@POST(&#34;api/rest/archive/telemessageincomingmessage&#34;)
Call&lt;Void&gt; postSMSMessage(@Body SMSMessageRecord sMSMessageRecord);</code></pre><p><strong>To be clear, this is where TM SGNL sends the plaintext, already decrypted Signal message to TeleMessage&#39;s archive server.</strong></p><h3 id="tying-it-all-together"><strong>Tying it all together</strong></h3><p>That was a lot. Now I&#39;m going to tie it all together from the beginning, the <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/src/tm/java/org/tm/archive/TeleMessageSignalApplication.kt" rel="noreferrer"><code>TeleMessageSignalApplication</code></a> object, which is created when the app is created.</p><p>Here&#39;s the <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/src/tm/java/org/tm/archive/TeleMessageSignalApplication.kt#L37-L44" rel="noreferrer"><code>onCreate</code></a> method, which is called when the app starts:</p><pre><code>override fun onCreate() {
  super.onCreate()
  Log.createInstance(applicationContext)
  ArchiveLogger.sendArchiveLog(&#34;TeleMessage logger created&#34;)

  initializeSdk()
  initArchiveUrlsAndStartArchive()
}</code></pre><p>This runs <code>initializeSdk</code>, followed by <code>initArchiveUrlsAndStartArchive</code>. Here&#39;s <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/src/tm/java/org/tm/archive/TeleMessageSignalApplication.kt#L67-L73" rel="noreferrer"><code>initializeSdk</code></a>:</p><pre><code>private fun initializeSdk() {
  val module = getSdkModule(requireNotNull(SignalDatabase.instance))
  val messageObserver = TeleMessageApplicationDependencyProvider.messageStoreObserver
  messageObserver.addProcessor(ArchiveMessagesProcessor(module))
  messageObserver.addProcessor(SendSignatureProcessor(module))
  messageObserver.initialize(module)
}</code></pre><p>This initializes the SDK module, passing in the <code>SignalDatabase</code> instance, which initializes that too.</p><p>Then it creates the message observer, and adds the <code>ArchiveMessagesProcessor</code> as a processor, passing in the SDK module (and hence, the <code>SignalDatabase</code>).</p><p>Now whenever messages get added to <code>SignalDatabase</code>, the following will happen:</p><ul><li><code>ArchiveMessageProcessor.processAfterMessageStateChanged</code> will run, calling <code>DataGrabber.setMessage</code>.</li><li><code>DataGrabber.setMessage</code> will save the message in the staging database and trigger the sync adapter to run.</li><li><code>SyncAdapter.onPerformSync</code> will select the message from the staging database and pass it into <code>NetworkManager.start</code>.</li><li><code>NetworkManager.start</code> will send the message to TeleMessage&#39;s archive server at <code>https://archive.telemessage.com</code>.</li></ul><p>Next, the <code>TeleMessageSignalApplication</code>&#39;s <code>onCreate</code> method calls <code>initArchiveUrlsAndStartArchive</code>. You can read the code for <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/src/tm/java/org/tm/archive/TeleMessageSignalApplication.kt#L75-L104" rel="noreferrer">that method here</a>, but the important part is where it it sets the URLs:</p><pre><code>CommonUtils.setUrl(context, ArchiveConstants.charlieProduction, ArchiveConstants.prodKeeper)</code></pre><p>These values are <a href="https://github.com/micahflee/TM-SGNL-Android/blob/libs/app/src/tm/java/org/archiver/ArchiveConstants.kt#L23-L24" rel="noreferrer">defined in</a> <code>ArchiveConstants</code>:</p><pre><code>const val charlieProduction = &#34;https://rest.telemessage.com&#34;
const val prodKeeper = &#34;https://archive.telemessage.com&#34;</code></pre><p>So basically, I stated above, <code>prodKeeper</code> is set to <code>https://archive.telemessage.com</code>, and this is ultimately where chat logs get sent. And finally, this method starts the sync adapter:</p><pre><code>CommonUtils.startBackupService(context)</code></pre><p>And then the app starts, with Signal messages getting synced to the archive server in the background.</p><h3 id="conclusion">Conclusion</h3><p>There&#39;s still a lot of this codebase that I haven&#39;t fully wrapped my mind around.</p><p>But after all of this analysis, it sure looked to me like TM SGNL is simply submitting plaintext chat logs to the TeleMessage archive server, completely breaking Signal&#39;s E2EE.</p><p>Still, I&#39;ve only manually analyzed the source code. I haven&#39;t tried running it, much less setting up a dummy archive server to see what data the app tries to send (something that is worth trying, but that I haven&#39;t had nearly enough time to implement).</p><p>But on Saturday night, a hacker exploited a vulnerability in the archive server and exfiltrated plaintext messages from it, including Signal messages, as I <a href="https://micahflee.com/the-signal-clone-the-trump-admin-uses-was-hacked/" rel="noreferrer">reported</a> in 404 Media. This confirms my findings that communication between the TM SGNL app and the archive destination is not end-to-end encrypted, and that the archive server has access to plaintext chat logs.</p><h2 id="corroborative-evidence-from-the-hack">Corroborative evidence from the hack</h2><p>As Joseph Cox and I reported, a hacker was able to obtain &#34;snapshots of data passing through TeleMessageâ€™s servers at a point in time.&#34; The snapshots contained fragments of data, including chat logs in JSON format, that was in the archive server&#39;s memory at the moment it was exploited.</p><p>To prove that the archive server has plaintext access to chat logs, I&#39;m sharing redacted samples of some of that data here. Below is a plaintext Signal message, a plaintext Telegram message, and a plaintext WhatsApp message.</p><p>I&#39;m also sharing an encrypted WhatsApp message. As I hinted at earlier in this post, some of the chat logs have encrypted content, and I have not yet uncovered how that works.</p><p>The snapshots of data from my source contained fragments of WeChat messages, but no complete WeChat messages, so I don&#39;t have an example of those to show.</p><p>Finally, I&#39;m also sharing a redacted screenshot of a private key I found in the snapshots of data from the archive server.</p><h3 id="a-plaintext-signal-message">A plaintext Signal message</h3><p>We mentioned a Signal message that was present in one of those snapshots:</p><blockquote>A message sent to a group chat called â€œUpstanding Citizens Brigadeâ€ included in the hacked data says its â€œsource typeâ€ is â€œSignal,â€ indicating it came from TeleMessageâ€™s modified version of the messaging app. The message itself was a link to this tweet posted on Sunday which is a clip of an NBC Meet the Press interview with President Trump about his memecoin. The hacked data includes phone numbers that were part of the group chat.</blockquote><p>Here&#39;s the JSON object version of that Signal message. I have redacted the phone numbers in this JSON object by replacing them with <code>==redacted==</code>.</p><pre><code>{
    &#34;typ&#34;: &#34;RawMessage&#34;,
    &#34;gatewayReceivedDate&#34;: 1746387273449,
    &#34;partner&#34;: &#34;NONE&#34;,
    &#34;securityContent&#34;: null,
    &#34;sourceService&#34;: null,
    &#34;internalSecurityData&#34;: {
        &#34;version&#34;: &#34;0.0.2&#34;,
        &#34;internalDecryptionData&#34;: {
            &#34;typ&#34;: &#34;nothing&#34;,
            &#34;encryptionType&#34;: &#34;DO_NOTHING&#34;,
            &#34;params&#34;: {}
        }
    },
    &#34;networkType&#34;: &#34;SIGNAL&#34;,
    &#34;sourceType&#34;: &#34;SIGNAL&#34;,
    &#34;ownerExtClassId&#34;: null,
    &#34;body&#34;: {
        &#34;owner&#34;: {
            &#34;value&#34;: &#34;==redacted==&#34;,
            &#34;type&#34;: &#34;PHONE&#34;
        },
        &#34;messageId&#34;: &#34;==redacted==&#34;,
        &#34;messageType&#34;: &#34;APP_MESSAGE&#34;,
        &#34;messageTime&#34;: 1746387273000,
        &#34;sender&#34;: {
            &#34;value&#34;: &#34;==redacted==&#34;,
            &#34;type&#34;: &#34;PHONE&#34;
        },
        &#34;recipients&#34;: [
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            }
        ],
        &#34;direction&#34;: &#34;IN&#34;,
        &#34;subject&#34;: &#34;Signal message from ==redacted== to chat group Upstanding Citizens Brigade&#34;,
        &#34;textField&#34;: {
            &#34;extractor&#34;: {
                &#34;typ&#34;: &#34;WrapperExt&#34;,
                &#34;data&#34;: &#34;https://x.com/degeneratenews/status/1919109508120371209?s=46&#34;
            },
            &#34;length&#34;: 60
        },
        &#34;attachment&#34;: [
            {
                &#34;name&#34;: &#34;C2-C233F59B-FEC7-4A78-90E0-F29342B15C23.jpg&#34;,
                &#34;contentType&#34;: &#34;image/jpeg&#34;,
                &#34;digest&#34;: null,
                &#34;content&#34;: &#34;&lt;Kafkafied&gt;:/shared/cloud/apigateway/attachments/2025_05_04_19_tm_tmp/str6706918773573153616.txt&#34;,
                &#34;attachmentSize&#34;: {
                    &#34;attachmentSizeType&#34;: &#34;BASE64&#34;,
                    &#34;sizeInBytes&#34;: 72936
                },
                &#34;attachmentDate&#34;: null
            }
        ],
        &#34;messageStatus&#34;: &#34;NA&#34;,
        &#34;callInfo&#34;: null,
        &#34;partner&#34;: null,
        &#34;groupData&#34;: {
            &#34;name&#34;: &#34;Upstanding Citizens Brigade&#34;,
            &#34;id&#34;: &#34;&#34;,
            &#34;type&#34;: &#34;BROADCAST&#34;
        },
        &#34;threadID&#34;: &#34;tm-1441784229&#34;,
        &#34;threadName&#34;: null,
        &#34;subUserId&#34;: 0,
        &#34;participantEnrichments&#34;: {},
        &#34;originalMessageData&#34;: null,
        &#34;ban&#34;: null,
        &#34;acceptedPayloadIdentifier&#34;: &#34;8b6ab08e-edef-4d44-a0fe-2be24f66f907&#34;,
        &#34;groupName&#34;: &#34;Upstanding Citizens Brigade&#34;,
        &#34;groupId&#34;: &#34;&#34;,
        &#34;groupMessage&#34;: false,
        &#34;text&#34;: &#34;https://x.com/degeneratenews/status/1919109508120371209?s=46&#34;
    },
    &#34;kafkafied&#34;: true
}
</code></pre><p>This plaintext chat log contains the following information, extracted from the archive server:</p><ul><li><code>networkType</code> and <code>sourceType</code> are both <code>SIGNAL</code></li><li><code>messageTime</code> is <code>1746387273000</code>, a Unix timestamp that corresponds to Sunday, May 4th, 2025, at 3:34pm Eastern time</li><li>It includes a phone number for the <code>owner</code> and <code>sender</code>, along with the 5 <code>recipients</code> in the Signal group</li><li>The email <code>subject</code> line, <code>Signal message from ==redacted== to chat group Upstanding Citizens Brigade</code></li><li><code>groupName</code> of <code>Upstanding Citizens Brigade</code></li><li><code>text</code> of <code>https://x.com/degeneratenews/status/1919109508120371209?s=46</code></li></ul><p>Clearly, TeleMessage&#39;s archive server has plaintext access to Signal messages.</p><h3 id="a-plaintext-telegram-message">A plaintext Telegram message</h3><p>In our reporting, we mentioned that some of the data exfiltrated from the archive server appears to belong to Coinbase. Here&#39;s an example of a redacted plaintext Telegram message, apparently from a Coinbase employee.</p><pre><code>{
    &#34;typ&#34;: &#34;RawMessage&#34;,
    &#34;gatewayReceivedDate&#34;: 1746322842371,
    &#34;partner&#34;: &#34;NONE&#34;,
    &#34;securityContent&#34;: null,
    &#34;sourceService&#34;: null,
    &#34;internalSecurityData&#34;: {
        &#34;version&#34;: &#34;0.0.2&#34;,
        &#34;internalDecryptionData&#34;: {
            &#34;typ&#34;: &#34;nothing&#34;,
            &#34;encryptionType&#34;: &#34;DO_NOTHING&#34;,
            &#34;params&#34;: {}
        }
    },
    &#34;networkType&#34;: &#34;TELEGRAM&#34;,
    &#34;sourceType&#34;: &#34;TELEGRAM&#34;,
    &#34;ownerExtClassId&#34;: null,
    &#34;body&#34;: {
        &#34;owner&#34;: {
            &#34;value&#34;: &#34;==redacted==&#34;,
            &#34;type&#34;: &#34;PHONE&#34;
        },
        &#34;messageId&#34;: &#34;EDIT-1746100232_7221627375_0-1&#34;,
        &#34;messageType&#34;: &#34;APP_MESSAGE&#34;,
        &#34;messageTime&#34;: 1746114419000,
        &#34;sender&#34;: {
            &#34;value&#34;: &#34;UNKNOWN&#34;,
            &#34;type&#34;: &#34;ALPHANUMERIC&#34;
        },
        &#34;recipients&#34;: [
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            }
        ],
        &#34;direction&#34;: &#34;IN&#34;,
        &#34;subject&#34;: &#34;Telegram message from [Intl Ex] Elk (Falcon Capital) - Coinbase to channel [Intl Ex] Elk (Falcon Capital) - Coinbase&#34;,
        &#34;textField&#34;: {
            &#34;extractor&#34;: {
                &#34;typ&#34;: &#34;WrapperExt&#34;,
                &#34;data&#34;: &#34;Hi @==redacted== please find the latest report: https://coinbase.sendsafely.com/receive/?==redacted==&#34;
            },
            &#34;length&#34;: 211
        },
        &#34;attachment&#34;: null,
        &#34;messageStatus&#34;: &#34;NA&#34;,
        &#34;callInfo&#34;: null,
        &#34;partner&#34;: null,
        &#34;groupData&#34;: {
            &#34;name&#34;: &#34;&#34;,
            &#34;id&#34;: &#34;&#34;,
            &#34;type&#34;: &#34;CHAT&#34;
        },
        &#34;threadID&#34;: &#34;815213310&#34;,
        &#34;threadName&#34;: null,
        &#34;subUserId&#34;: 0,
        &#34;participantEnrichments&#34;: {
            &#34;{\&#34;value\&#34;:\&#34;UNKNOWN\&#34;,\&#34;type\&#34;:\&#34;ALPHANUMERIC\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            }
        },
        &#34;originalMessageData&#34;: null,
        &#34;ban&#34;: null,
        &#34;acceptedPayloadIdentifier&#34;: &#34;f298b776-d5d4-42da-89b3-95d2d4dd5345&#34;,
        &#34;groupName&#34;: &#34;&#34;,
        &#34;groupId&#34;: &#34;&#34;,
        &#34;groupMessage&#34;: false,
        &#34;text&#34;: &#34;Hi @==redacted== please find the latest report: https://coinbase.sendsafely.com/receive/?==redacted==&#34;
    },
    &#34;kafkafied&#34;: true
}
</code></pre><p>This plaintext chat log contains the following information, extracted from the archive server:</p><ul><li><code>networkType</code> and <code>sourceType</code> are both <code>TELEGRAM</code></li><li><code>messageTime</code> is <code>1746114419000</code>, a Unix timestamp that corresponds to May 1, 2025 at 11:46 AM Eastern time (I&#39;m honestly not sure why a message from May 1 was in the archive server&#39;s memory at this moment)</li><li>It includes the phone number of the sender under <code>owner</code></li><li>The email <code>subject</code> line, <code>Telegram message from [Intl Ex] Elk (Falcon Capital) - Coinbase to channel [Intl Ex] Elk (Falcon Capital) - Coinbase</code></li><li><code>text</code> of <code>Hi @==redacted== please find the latest report: https://coinbase.sendsafely.com/receive/?==redacted==</code> (this message included the link to a shared document on Coinbases&#39;s SendSafely account, which I have redacted)</li></ul><h3 id="a-plaintext-whatsapp-message">A plaintext WhatsApp message</h3><p>I don&#39;t know much about this WhatsApp message, or the group it was sent to. But here&#39;s a redacted sample:</p><pre><code>{
    &#34;typ&#34;: &#34;RawMessage&#34;,
    &#34;gatewayReceivedDate&#34;: 1746319698418,
    &#34;partner&#34;: &#34;NONE&#34;,
    &#34;securityContent&#34;: null,
    &#34;sourceService&#34;: null,
    &#34;internalSecurityData&#34;: {
        &#34;version&#34;: &#34;0.0.2&#34;,
        &#34;internalDecryptionData&#34;: {
            &#34;typ&#34;: &#34;nothing&#34;,
            &#34;encryptionType&#34;: &#34;DO_NOTHING&#34;,
            &#34;params&#34;: {}
        }
    },
    &#34;networkType&#34;: &#34;WHATSAPP_CLOUD_ARCHIVER&#34;,
    &#34;sourceType&#34;: &#34;WHATSAPP_CLOUD_ARCHIVER&#34;,
    &#34;ownerExtClassId&#34;: null,
    &#34;body&#34;: {
        &#34;owner&#34;: {
            &#34;value&#34;: &#34;==redacted==&#34;,
            &#34;type&#34;: &#34;PHONE&#34;
        },
        &#34;messageId&#34;: &#34;544323f6830025dd76a3&#34;,
        &#34;messageType&#34;: &#34;APP_MESSAGE&#34;,
        &#34;messageTime&#34;: 1746319698000,
        &#34;sender&#34;: {
            &#34;value&#34;: &#34;==redacted==&#34;,
            &#34;type&#34;: &#34;PHONE&#34;
        },
        &#34;recipients&#34;: [
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            },
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            }
        ],
        &#34;direction&#34;: &#34;IN&#34;,
        &#34;subject&#34;: &#34;WhatsApp message from ==redacted== to Yenta AF chat group&#34;,
        &#34;textField&#34;: {
            &#34;extractor&#34;: {
                &#34;typ&#34;: &#34;WrapperExt&#34;,
                &#34;data&#34;: &#34;And u look so pretty Dani&#34;
            },
            &#34;length&#34;: 25
        },
        &#34;attachment&#34;: null,
        &#34;messageStatus&#34;: &#34;NA&#34;,
        &#34;callInfo&#34;: null,
        &#34;partner&#34;: null,
        &#34;groupData&#34;: {
            &#34;name&#34;: &#34;Yenta AF&#34;,
            &#34;id&#34;: &#34;17862479908-1457977547@g.us&#34;,
            &#34;type&#34;: &#34;CHAT&#34;
        },
        &#34;threadID&#34;: &#34;tm-643721925&#34;,
        &#34;threadName&#34;: &#34;Yenta AF&#34;,
        &#34;subUserId&#34;: 0,
        &#34;participantEnrichments&#34;: {
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            }
        },
        &#34;originalMessageData&#34;: null,
        &#34;ban&#34;: null,
        &#34;acceptedPayloadIdentifier&#34;: &#34;62db9b07-89c7-46a0-853b-550a9f6c0bb8&#34;,
        &#34;groupName&#34;: &#34;Yenta AF&#34;,
        &#34;groupId&#34;: &#34;17862479908-1457977547@g.us&#34;,
        &#34;groupMessage&#34;: true,
        &#34;text&#34;: &#34;And u look so pretty Dani&#34;
    },
    &#34;kafkafied&#34;: true
}
</code></pre><p>This plaintext chat log contains the following information extracted from the archive server:</p><ul><li><code>networkType</code> and <code>sourceType</code> are both <code>WHATSAPP_CLOUD_ARCHIVER</code></li><li><code>messageTime</code> is <code>1746319698000</code>, which is a Unix timestamp that corresponds to May 3, 2025 at 8:48 PM Eastern time</li><li><code>sender</code>&#39;s phone number</li><li>Phone numbers and first and last names for all 12 members of the WhatsApp group</li><li>The email <code>subject</code> line, <code>WhatsApp message from ==redacted== to Yenta AF chat group</code></li><li><code>groupName</code> is <code>Yenta AF</code></li><li><code>text</code> of <code>And u look so pretty Dani</code></li></ul><p>TeleMessage&#39;s archive server has plaintext access to at least some WhatsApp messages.</p><h3 id="an-encrypted-whatsapp-message">An encrypted WhatsApp message</h3><p>Some of the data passing through TeleMessage&#39;s archive server is encrypted, and I haven&#39;t yet uncovered exactly why. Here&#39;s an example of an encrypted WhatsApp message.</p><p>I&#39;ve redacted the plaintext metadata in this sample. I haven&#39;t redacted the encrypted session key or the ciphertext of the message.</p><pre><code>{
    &#34;typ&#34;: &#34;RawMessage&#34;,
    &#34;gatewayReceivedDate&#34;: 1746322853699,
    &#34;partner&#34;: &#34;DEFAULT&#34;,
    &#34;securityContent&#34;: {
        &#34;encryptionData&#34;: {
            &#34;keyId&#34;: &#34;08a7fe36a6ddd8bca98ef407e254ecc230ef80b0b39ce1753371c1a8f7427cb1&#34;,
            &#34;encSessionKey&#34;: &#34;y7BbPA1mpNLkFGjcVRZWTRNbf22lWvjEtqfhzTYlq4V32Jg94jUWzu+krLkJ34ff2AVqJ5gTUhEsh/suPn5ZRjDCzRw3z/XXeW+LftJL0GpHkI4mICzHzTYzMfeEHPmdJRZV8chuAWVL04XfGxEkFjg4ExQKDykhL9KnXxzPre7smyMwEsY3VQ+yx5pVONvCoWLBfKZ6jxDDHAyiw9DhMu97X0WmL5Xb0vkvKxXk6hyyH8oY23pCSiVID4/4waRi5iv7bbbMNhiaJWEyl9lqQ1BmnjqvwO75xYtMCemL/eCd/VEfsA8oxxEnHns6PEga3U/c2JLNGFDQEeU92mXQg8zCPV9qfkYCNYPmGgBcxtnaJxisfkfnVioe50wYxiQ8Ml88xptHa1ZHtajR1Si1puTc8UmueZ2Zem2dUTijXeK07upG+ou+XzhN/uonnpVlPKNd7b8KN/cP5MPwTHTMzpSh5bxQA3zuzqGUgYziUuxQp+VFB1Y3/v7/ba0zlYawmvCC3RN7md9/4bkGfpktii/sm+MsarwVPL2dD7wbzJYvZMo67HQEXW1zhG1hslro9HNJU+e7cgyNTHHdbWd09i5xe9WfMQGi+ty5yrehRDYizC++s7H78WhmMUcQVAjnNaOhJSYqxsLVKVNzdO4NuO70uWTL5x8re/sPKJo8SJO1e64CZlozqyopyycFgaEl&#34;
        },
        &#34;integrityHeaderContent&#34;: &#34;7C967D5A3BD5C59284EAB8D2CE56A79DA6012EE6B8BC2037AEE1CD5042C15E01&#34;
    },
    &#34;sourceService&#34;: null,
    &#34;internalSecurityData&#34;: {
        &#34;version&#34;: &#34;0.0.2&#34;,
        &#34;internalDecryptionData&#34;: {
            &#34;typ&#34;: &#34;hybrid&#34;,
            &#34;params&#34;: {
                &#34;ENC_SESSION_KEY&#34;: {
                    &#34;typ&#34;: &#34;encskey&#34;,
                    &#34;value&#34;: &#34;y7BbPA1mpNLkFGjcVRZWTRNbf22lWvjEtqfhzTYlq4V32Jg94jUWzu+krLkJ34ff2AVqJ5gTUhEsh/suPn5ZRjDCzRw3z/XXeW+LftJL0GpHkI4mICzHzTYzMfeEHPmdJRZV8chuAWVL04XfGxEkFjg4ExQKDykhL9KnXxzPre7smyMwEsY3VQ+yx5pVONvCoWLBfKZ6jxDDHAyiw9DhMu97X0WmL5Xb0vkvKxXk6hyyH8oY23pCSiVID4/4waRi5iv7bbbMNhiaJWEyl9lqQ1BmnjqvwO75xYtMCemL/eCd/VEfsA8oxxEnHns6PEga3U/c2JLNGFDQEeU92mXQg8zCPV9qfkYCNYPmGgBcxtnaJxisfkfnVioe50wYxiQ8Ml88xptHa1ZHtajR1Si1puTc8UmueZ2Zem2dUTijXeK07upG+ou+XzhN/uonnpVlPKNd7b8KN/cP5MPwTHTMzpSh5bxQA3zuzqGUgYziUuxQp+VFB1Y3/v7/ba0zlYawmvCC3RN7md9/4bkGfpktii/sm+MsarwVPL2dD7wbzJYvZMo67HQEXW1zhG1hslro9HNJU+e7cgyNTHHdbWd09i5xe9WfMQGi+ty5yrehRDYizC++s7H78WhmMUcQVAjnNaOhJSYqxsLVKVNzdO4NuO70uWTL5x8re/sPKJo8SJO1e64CZlozqyopyycFgaEl&#34;,
                    &#34;type&#34;: &#34;ENC_SESSION_KEY&#34;
                },
                &#34;PUBLIC_KEY_ID&#34;: {
                    &#34;typ&#34;: &#34;pubkey&#34;,
                    &#34;value&#34;: &#34;08a7fe36a6ddd8bca98ef407e254ecc230ef80b0b39ce1753371c1a8f7427cb1&#34;,
                    &#34;type&#34;: &#34;PUBLIC_KEY_ID&#34;
                }
            },
            &#34;encryptionType&#34;: &#34;HYBRID&#34;
        }
    },
    &#34;networkType&#34;: &#34;WHATSAPP_ARCHIVER&#34;,
    &#34;sourceType&#34;: &#34;WHATSAPP_ARCHIVER&#34;,
    &#34;ownerExtClassId&#34;: null,
    &#34;body&#34;: {
        &#34;owner&#34;: {
            &#34;value&#34;: &#34;==redacted==&#34;,
            &#34;type&#34;: &#34;PHONE&#34;
        },
        &#34;messageId&#34;: &#34;b849fa65750cbed6cf5be5cb9a69d943&#34;,
        &#34;messageType&#34;: &#34;APP_MESSAGE&#34;,
        &#34;messageTime&#34;: 1746322850000,
        &#34;sender&#34;: {
            &#34;value&#34;: &#34;==redacted==&#34;,
            &#34;type&#34;: &#34;PHONE&#34;
        },
        &#34;recipients&#34;: [
            {
                &#34;value&#34;: &#34;==redacted==&#34;,
                &#34;type&#34;: &#34;PHONE&#34;
            }
        ],
        &#34;direction&#34;: &#34;IN&#34;,
        &#34;subject&#34;: &#34;STATUS - WhatsApp message from ==redacted== to ==redacted==&#34;,
        &#34;textField&#34;: {
            &#34;extractor&#34;: {
                &#34;typ&#34;: &#34;WrapperExt&#34;,
                &#34;data&#34;: &#34;CrlDZrXBN1jL+V7Yht6lDpx4oFHQ05M6kVM7HjecbWY1smMWZkK0yzGxV96TiKlReLanCHtYkxJkF0PR74ePIQ==&#34;
            },
            &#34;length&#34;: 88
        },
        &#34;attachment&#34;: [
            {
                &#34;name&#34;: &#34;eee44412-b56f-47ff-9548-f00fc3ed1cd3.jpg&#34;,
                &#34;contentType&#34;: &#34;image/jpeg&#34;,
                &#34;digest&#34;: null,
                &#34;content&#34;: &#34;&lt;Kafkafied&gt;:/shared/cloud/apigateway/attachments/2025_05_04_01_tm_tmp/str13594102991037415607.txt&#34;,
                &#34;attachmentSize&#34;: {
                    &#34;attachmentSizeType&#34;: &#34;BASE64&#34;,
                    &#34;sizeInBytes&#34;: 44352
                },
                &#34;attachmentDate&#34;: null
            }
        ],
        &#34;messageStatus&#34;: &#34;NA&#34;,
        &#34;callInfo&#34;: null,
        &#34;partner&#34;: null,
        &#34;groupData&#34;: {
            &#34;name&#34;: &#34;&#34;,
            &#34;id&#34;: &#34;status@broadcast&#34;,
            &#34;type&#34;: &#34;CHAT&#34;
        },
        &#34;threadID&#34;: &#34;1790853601&#34;,
        &#34;threadName&#34;: null,
        &#34;subUserId&#34;: 0,
        &#34;participantEnrichments&#34;: {
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            },
            &#34;{\&#34;value\&#34;:\&#34;==redacted==\&#34;,\&#34;type\&#34;:\&#34;PHONE\&#34;}&#34;: {
                &#34;firstName&#34;: &#34;==redacted==&#34;,
                &#34;lastName&#34;: &#34;==redacted==&#34;
            }
        },
        &#34;originalMessageData&#34;: null,
        &#34;ban&#34;: null,
        &#34;acceptedPayloadIdentifier&#34;: &#34;b7b88772-f3b7-4e20-8bc8-074ab7cb75f7&#34;,
        &#34;groupName&#34;: &#34;&#34;,
        &#34;groupId&#34;: &#34;status@broadcast&#34;,
        &#34;groupMessage&#34;: true,
        &#34;text&#34;: &#34;CrlDZrXBN1jL+V7Yht6lDpx4oFHQ05M6kVM7HjecbWY1smMWZkK0yzGxV96TiKlReLanCHtYkxJkF0PR74ePIQ==&#34;
    },
    &#34;kafkafied&#34;: true
}
</code></pre><p>This encrypted WhatsApp chat log is different than the plaintext one in a few ways:</p><ul><li>The <code>networkType</code> and <code>sourceType</code> are both <code>WHATSAPP_ARCHIVER</code>, while in the plaintext WhatsApp message they were <code>WHATSAPP_CLOUD_ARCHIVER</code></li><li>The encrypted message contains encryption information in <code>securityContent</code> and <code>internalSecurityData</code>, while in the plaintext WhatsApp message they didn&#39;t</li><li><code>text</code> is a Base64 block of encrypted text instead of plaintext message content</li></ul><p>Even with encryption, this chat log contains the following plaintext information:</p><ul><li>The <code>sender</code> and <code>recipients</code> phone numbers and full names</li><li>The email <code>subject</code> line, <code>STATUS - WhatsApp message from ==redacted== to ==redacted==</code></li><li><code>messageTime</code> is <code>1746322850000</code>, a Unix timestamp that corresponds to May 3, 2025 at 9:40 PM Eastern time</li></ul><h3 id="private-key-material">Private key material</h3><p>As Joseph and I mentioned in our reporting in 404 Media, the snapshots of data from the archive server contained more than just chat logs. There were usernames and plaintext passwords â€“ the hacker used these to login to archive site, gaining access to a list of apparently 747 Customs and Border Protection employees.</p><p>But also, I found private key material in the snapshots, though I have not yet uncovered what the keys are for. Here&#39;s one of the private keys I found, redacted, of course:</p><figure><img src="https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-05-22-50-10.png" alt="" loading="lazy" width="1338" height="894" srcset="https://micahflee.com/content/images/size/w600/2025/05/Screenshot-From-2025-05-05-22-50-10.png 600w, https://micahflee.com/content/images/size/w1000/2025/05/Screenshot-From-2025-05-05-22-50-10.png 1000w, https://micahflee.com/content/images/2025/05/Screenshot-From-2025-05-05-22-50-10.png 1338w" sizes="(min-width: 1200px) 1200px"/><figcaption><span>A redacted private key</span></figcaption></figure><p><em>If you found this interesting, </em><a href="https://micahflee.com/tm-sgnl-the-obscure-unofficial-signal-app-mike-waltz-uses-to-text-with-trump-officials/#/portal/signup" rel="noreferrer"><em>subscribe</em></a><em> to get these posts emailed directly to your inbox. If you want to support my work, considering becoming a paid supporter.</em></p>
                    
                </section>

                    

                
            </article>
    </div>
</div></div>
  </body>
</html>
