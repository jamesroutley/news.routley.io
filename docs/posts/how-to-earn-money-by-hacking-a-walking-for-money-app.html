<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.deadf00d.com/post/how-to-earn-money-by-hacking-a-walking-for-money-app.html">Original</a>
    <h1>How to earn money by hacking a “walking for money” app</h1>
    
    <div id="readability-page-1" class="page"><div> <p><strong>Disclaimer: The article you&#39;re about to read, talks about the abuse of a private API, with an humor that probably as not been received has intended. My goal has never been to cause trouble to WeWard, but only to demonstrate skills applied to a funny goal &#34;for fun and profit&#34;, fun here for sure, but profit absolutely not. No intrusion on the backend has been attempted, and this article does not contain any &#34;vulnerability&#34; or &#34;0days&#34;. No money has been stolen using this method, as every attempts to cashout has been denied by human verification. Every tokens and API keys has been redacted in place of the original ones. WeWard has been notified about this article. I&#39;m still waiting for their answer.</strong></p> <p><strong>Disclaimer: The article you&#39;re about to read, talks about the abuse of a private API, with an humor that probably as not been received has intended. My goal has never been to cause trouble to WeWard, but only to demonstrate skills applied to a funny goal &#34;for fun and profit&#34;, fun here for sure, but profit absolutely not. No intrusion on the backend has been attempted, and this article does not contain any &#34;vulnerability&#34; or &#34;0days&#34;. No money has been stolen using this method, as every attempts to cashout has been denied by human verification. Every tokens and API keys has been redacted in place of the original ones. WeWard has been notified about this article. I&#39;m still waiting for their answer.</strong></p> <p>It work basically by monitoring the amount of <strong>steps</strong> your doing over your day, then it credit your account with <strong>points</strong>, <strong>points</strong> that you can trade with <strong>rewards</strong>. Most of the time it&#39;s a <strong>discount code</strong> from their partners, but sometime it&#39;s a <strong>brand new phone</strong>, <strong>money</strong> or <strong>travels</strong>. The success of these apps are directly correlated to the <strong>reward</strong> they offer, or more accurate the <strong>promise of reward you will get</strong>.</p> <p>The leader of this concept in France, is an app called <strong>WeWard</strong>. Which is our target for this article.</p> <p><img src="https://admin.deadf00d.com/uploads/weward_68921cbaef.png" alt="https://admin.deadf00d.com/uploads/weward_68921cbaef.png"/></p> <p>I&#39;m not sure this app is really worthy for users (probably a scam ah ?), but there&#39;s one thing I&#39;m sure:</p> <blockquote> <p>I don&#39;t like to walk.</p> </blockquote> <p>In our digging, will find how to reverse engineer <strong>React Native</strong> android apps, <strong>firebase</strong> based <strong>APIs</strong> and bad <strong>authentications</strong>, in the only goal of making the much money we can. For fun and profit... No, just for profit this time. s</p> <h2>First tour</h2> <p>So first <strong>step</strong> is to <em>obviously</em> download the <strong>app</strong>, and install it. After creating my account I can see that it only ask for an <strong>email</strong>, and ask also to pair a <strong>Google account</strong> to access <strong>watch data</strong>, etc.</p> <p>Once you&#39;re authenticated, you can directly access <strong>reward</strong>, and your <strong>step</strong> count. Originality of this application is the fact that you need to validate your <strong>steps</strong> every day to get your points, here called <strong>wards</strong>.</p> <h2>How to earn wards ?</h2> <p><strong>Wards</strong> are can be earned by few ways, the first one <em>obviously</em> is to walk. For every <strong>steps</strong> level, you validate and then you get a <strong>wards</strong> amount, with a maximum of 15 wards per day.</p> <p>You can also earn <strong>wards</strong> by visiting place of interest then validate your position and earn according <strong>wards</strong>. But theses are very rare, as most of theses places in fact, are stores, and <strong>WeWard</strong> force you to buy into them, as you need to provide a cashier ticket in order to claim your <strong>wards</strong>.</p> <p>Also, you an earn <strong>1 ward</strong> per hour by watching an <strong>ad</strong>.</p> <h2>Let&#39;s take it appart</h2> <p>First thing is to decompress the <strong>apk</strong> file. You can do it with <strong>unzip</strong> utility as <strong>apk</strong> files are literally renamed <strong>zip</strong> files.</p> <p><img src="https://admin.deadf00d.com/uploads/Screenshot_20220203_012617_41b5d6032c.png" alt="Screenshot_20220203_012617.png"/></p> <p>First things we can see is the file named <strong>index.android.bundle</strong> which is code for the front of a React Native apps.</p> <p>It&#39;s pretty great for me, as I&#39;m way more comfortable with obfuscated <strong>Javascript</strong> analysis than some compiled <strong>Dart</strong> or obfuscated <strong>Kotlin</strong>. I&#39;ll extract it and clean indentation for more readability.</p> <p>I&#39;m going to use a really handy tool called <strong>apktool</strong> to uncompress the <strong>AndroidManifest.xml</strong> to give me more information about permissions, APIs, etc. I know that <strong>apktool</strong> can also de-compile <strong>dex</strong> files, but it only does as <strong>smali bytecode</strong>, which is pretty difficult to read. So I prefer to <strong>de-compile</strong> it sideways to get <strong>Java</strong> / <strong>Kotlin</strong> instead. Next <strong>steps</strong> is to de-compile <strong>dex</strong> files that contain our <strong>backend</strong> (if I can say so) code.</p> <p><strong>AndroidManifest.xml</strong> didn&#39;t told us more than the usage of <strong>Location</strong> or <strong>GPS</strong> in the <strong>app</strong> (which was obvious anyway).</p> <p>So let&#39;s dig <strong>.dex</strong> and <strong>Javascript</strong>.</p> <h2>Dex files</h2> <p>I used <strong>JADX</strong> for this <strong>decompilation</strong>. I can&#39;t post everything here as there&#39;s a lot of data. Among all this data there&#39;s only one that interest us, the <strong>com.weward</strong> package under the <strong>classes4.dex</strong> file.</p> <p><img src="https://admin.deadf00d.com/uploads/Screenshot_20220203_014254_4ca14b1128.png" alt="Screenshot_20220203_014254.png"/></p> <p>Most of these are just <strong>Java wrappers</strong> with the <strong>React Native</strong> frontend to receive intent get GPS data, etc. Their are not even obfuscated.</p> <p>Here is for example the code of <strong>WewardPedometer.java</strong>. Also if you think <strong>WewardRequest.java</strong> is interesting, that&#39;s what I tough too, and it&#39;s not. It&#39;s just a utility <strong>class</strong> for storing and retrieve the <strong>firebase_id</strong>.</p>  <p>Now we understand that the real subject is this famous <strong>index.android.bundle</strong>.</p> <h2>Javascript love React</h2> <p>First thing I do when I&#39;m in front of new <strong>Javascript obfusated</strong> file, is to search every occurence for <strong>API</strong> or <strong>backend</strong>. And this time again it worked perfectly.</p> <p>From this I discovered the <strong>apiGet</strong>, <strong>apiPost</strong>, <strong>sendStepsData</strong> and <strong>sendGeoData</strong> implementations as well as a <strong>settings object</strong>.</p>  <p>From this we get the <strong>API backend</strong> which is <code>https://backend.prod.weward.fr/api/v1.0</code>, how much a <strong>ward</strong> is worth in euro (.007€ at 15 wards per day, do your math), a <strong>slack webhook</strong> and finally a <strong>Google API Key</strong>, etc.</p> <blockquote> <p>Please do not store that kind of info in a app.</p> </blockquote> <p>I could literally ruin the company by reusing the <strong>Google API Key</strong>, or overflow their <strong>Slack channels</strong>, or even try to hack it with the <strong>Slack webhooks phishing attack</strong>. These kinds of operation should be done on the backend API side. (Please don&#39;t do it, that&#39;s gonna be way less fun for me)</p>  <p>Here:</p> <ul> <li><code>x(t, n, o, u, c)</code> validate the response of the <strong>API</strong> and is called after each <strong>API request</strong>.</li> <li><code>v(t)</code> construct the complete <strong>URL</strong> from the <code>BACK_END</code> string of <strong>settings object</strong> and the endpoint.</li> <li><code>w(t)</code> append a lot of <strong>HTTP header</strong> for authentication and statistics.</li> <li><code>sendGeoData</code> &amp; <code>sendStepsData</code> are just <code>apiPost</code> wrappers.</li> </ul> <p>That&#39;s all we need to start interacting with the <strong>API</strong> and try to abuse the data sent to it. With more <strong>regex trick</strong> we can then find all the calls to <code>apiGet</code> &amp; <code>apiPost</code>, and with context it&#39;s easy to understand the effects and the requirements of <strong>each endpoints</strong>. After analyzing the <code>w(t)</code>, I&#39;m now able to call endpoint with <strong>cURL</strong> and in the future with <strong>Python requests</strong>.</p> <p>Here is example with the <code>request_signin_with_email</code>:</p> <pre><code>curl &#34;https://backend.prod.weward.fr/api/v1.0/customer/request_signin_with_email&#34; --data &#39;{ &#34;email&#34;: &#34;mm.didelot@deadf00d.com&#34; }&#39; -H &#34;User-Agent: Mozilla/5.0 (Linux; Android 5.1.1; Nexus 5 Build/LMY48B; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/43.0.2357.65 Mobile Safari/537.36&#34; -H&#34;Content-Type: application/json&#34;
</code></pre> <h2>All your firebase are belong to us</h2> <p>WeWard has a <strong>firebase</strong> based authentication. It works with a <code>firebase_id</code> that has to be specified for each authenticated request along with the <code>weward_token</code>. Theses two tokens are given by the call of <code>signin_with_id_token</code>.</p> <p>Also, a bunch of other metrics are sent within each request as described in this part of the <code>w(t)</code> function.</p>  <p>Here is the corresponding <strong>curl request</strong>:</p> <pre><code>curl &#34;https://backend.prod.weward.fr/api/v1.0/endpoint&#34;
-H&#34;ww_app_version: 6.1.1&#34;
-H&#34;ww_os: android&#34;
-H&#34;ww_os_version: 28&#34;
-H&#34;ww_build_version: 152&#34;
-H&#34;ww_codepush_version: base&#34;
-H&#34;Ww-Unique-Device-id: 3fe16fb02c6baea7&#34;
-H&#34;ww_device_ts: 1622293912536&#34;
-H&#34;ww_device_timezone: Europe/Paris&#34;
-H&#34;ww_local_datetime: Sat May 29 2021 15:11:52 GMT+0200 (CEST)&#34;
-H&#34;ww_device_country: FR&#34; -H&#34;firebase-id: 1823308&#34;
-H&#34;Authorization: YwWZXH8lC8WuxpUL31lnpLf47IXd254_jaPtP_X-lck&#34;
-H&#34;User-Agent: Mozilla/5.0 (Linux; Android 5.1.1; Nexus 5 Build/LMY48B; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/43.0.2357.65 Mobile Safari/537.36&#34;
-H&#34;Content-Type: application/json&#34; -vv
</code></pre> <p>In order to get theses two tokens you need to provide a <code>firebase custom_token</code> to the endpoint <code>signin_with_id_token</code>. This <strong>firebase custom token</strong> is provided in a the mail activation link that is sent after calling the <code>request_signin_with_email</code> provided with an email.</p> <p>This is easily handled in python with the Firebase package:</p>  <h2>Our first ward</h2> <p>Now that we can call authenticated endpoints, we should be able to get our first ward. Here is a quick list of theses endpoints:</p>  <p>Every of theses endpoints have very few arguments, but the one that interest us is <code>/ads_reward_v2</code>.</p> <blockquote> <p>But why this one ?</p> </blockquote> <p>Cause it has <strong>no arguments</strong>.</p> <blockquote> <p>No arguments ?</p> </blockquote> <p>Yes. You heard me right, this endpoint is used to credit wards after the view of an ad and has no validation token, no challenge, nothing. Here is code for it:</p>  <p>It is literally called right after the event of finished ad is called. And it directly gives you <strong>ward</strong> right after.</p> <p>At this point I hoped a lot that it could be called infinity without timeout. But It&#39;s not. Once claimed it block you for an hour.</p> <p><strong>But hey ! We got our first ward.</strong></p> <h2>Yummy wards</h2> <h3>About phone side data</h3> <p>Because of the nature of the <strong>step count</strong>, which is a data produced by the phone, and therefore, cannot be validated by the <strong>backend</strong>. In this context it is possible to <strong>report a false data</strong>, and make the <strong>API</strong> trust it. These data can be <strong>GPS</strong> position, <strong>steps</strong> count, etc. The only way to reduce (but not eliminate) this is to make several validation per minutes or hours of the data and to validate only coherent data.</p> <h3>Abuse GPS data</h3> <p>The next thing I&#39;ve been focusing on is the possibility to earn <strong>wards</strong> by going to a special spot and then validate my <strong>GPS</strong> position. This will credit me a small amount of <strong>wards</strong> (between 10-30) but hey ! It&#39;s still better than having to walk.</p> <p>As said earlier because of the data is produced by the phone, and validation mechanism can exist, it&#39;s easily manipulable. One way, could be to use an emulator and to manually set the <strong>GPS</strong> position. But again, I&#39;m lazy so I want to work a lot more to get something really fast and that I can use thousands of times, to only use it once.</p> <p>Anyway theses spot can be found on an interactive map, as an optimization, they only display the spot around the point you&#39;re looking at on a certain zoom level.</p> <p>In order to do this, the app call the <strong>API</strong> endpoint <code>location_campaign</code> with the available <code>GET</code> arguments:</p> <ul> <li><code>latitude</code></li> <li><code>longitude</code></li> <li><code>recenter</code></li> <li><code>per_page</code></li> </ul> <p>By providing setting the coordinates of the center of France, and then providing a big number to <code>per_page</code>, I&#39;m able to list every spot directly. Here is a typical response:</p> <p><img src="https://admin.deadf00d.com/uploads/Screenshot_20220225_191443_f885c8ca10.png" alt="https://admin.deadf00d.com/uploads/Screenshot_20220225_191443_f885c8ca10.png"/></p> <p>Among all these locations only few are free, to detect them we just need to test for the presence of the <code>receipt_campaign_id</code> key in each spot object. If it&#39;s not there, then it&#39;s free.</p> <p>To validate your <strong>GPS</strong> coordinate the app call the <code>reward_visit_campaign</code> provided with the correct <code>latitude</code>, <code>longitude</code> as well with the <code>campaign_id</code>, which is stored under the <code>id</code> key in our spot object.</p> <p>So after that I developed a quick script that loop over the free spots and validate each of them on my account. I run it, wait a bit, and then:</p> <p><img src="https://admin.deadf00d.com//uploads/weward_home_b5e467f2e5.png" alt="https://admin.deadf00d.com/uploads/weward_home_b5e467f2e5.png"/></p> <h3>Abuse steps data</h3> <p>Less interesting than the spots, but still can represent 25 <strong>wards</strong> per day, <strong>steps</strong> are also very easy to abuse. <strong>Steps amount</strong> is reported to the <code>push_step_record</code> <strong>API</strong> endpoint with theses <code>json POST</code> arguments:</p> <ul> <li><code>weward_steps</code></li> <li><code>googlefit_steps</code></li> <li><code>steps_source</code> (=wewardpedometer)</li> <li><code>uptime_score</code></li> <li><code>device_uptime_ms</code></li> <li><code>data_sources</code></li> <li><code>amount</code></li> <li><code>android_amount</code></li> </ul> <p>The validation and conversion of the <strong>steps</strong> into <strong>wards</strong> is done by calling the <code>valid_step</code> endpoint without any argument. You can only validate a maximum of 20k <strong>steps</strong> per day which will give you 25 <strong>wards</strong>.</p> <h2>Cashout</h2> <p>By exploiting every techniques you can get about <strong>20k wards in few minutes</strong>, the equivalent of about 138€.</p> <p><img src="https://admin.deadf00d.com/uploads/weward2_0a87a2f0e9.png" alt="https://admin.deadf00d.com/uploads/weward2_0a87a2f0e9.png"/></p> <p>And if you&#39;re willing to wait, you&#39;re about <strong>30k wards</strong> away from the <strong>Rome holidays</strong> reward.</p> <h2>So what did we learn ?</h2> <p>In order to build more secured application, it&#39;s important to perform the more actions you can on the <strong>backend</strong> side. It seems like a simple tip, and pretty obvious, but even today there&#39;s still a lot of application out there that don&#39;t follow it.</p> <p>The worst thing in this <strong>WeWard app</strong>, is the <strong>amount of secret and confidential data packed in the app</strong> like this slack <code>webhook</code> that could allow total takeover of their slack or this <strong>Google secret key</strong> that can be reused and potentially ruin the company.</p> <p>Fortunately I&#39;m not a <strong>malicious attacker</strong>, just someone snooping around, but that can happen, especially in high concurrence markets.</p> <p>If you need advising on such subject, I&#39;m available as a consultant, and would be happy to do so.</p> <p><em>Thanks for reading.</em></p> </div></div>
  </body>
</html>
