<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://determinate.systems/posts/introducing-riff">Original</a>
    <h1>Riff, automatically provide external dependencies for Rust projects</h1>
    
    <div id="readability-page-1" class="page"><div data-block-type="2" id="block-29b2c4a89f1cf0b4e9d3"><div><p>Package managers like <a href="https://doc.rust-lang.org/cargo/">Cargo</a>, <a href="https://pypi.org/project/pip/">pip</a>, and <a href="https://npmjs.org">npm</a> are indispensable tools in software development because they quietly handle language-specific dependencies for you. But unfortunately they’re not so great at installing dependencies written in other languages (we call these <em>external</em> dependencies). One of the classic examples is <a href="https://nokogiri.org">Nokogiri</a>, a widely used XML and HTML parser for <a href="https://ruby-lang.org">Ruby</a>, whose dependency on a C library called <a href="https://github.com/GNOME/libxml2" target="_blank">libxml2</a> has caused great consternation for Ruby devs over the years. More recently, external dependencies like <a href="https://openssl.org/" target="_blank">OpenSSL</a> and <a href="https://www.gnu.org/software/libiconv/" target="_blank">libiconv</a> have proven troublesome for <a href="https://rust-lang.org">Rust</a> developers.</p><p>One half-solution to this problem is to list these external dependencies in the project’s documentation so that developers can install them on their own. Sometimes, projects go a bit beyond that, providing detailed installation instructions for developers in different situations. And occasionally, external dependencies aren’t even mentioned and developers are on their own to provide them, which usually means Googling and StackOverflowing—and wasted time.</p><p>Like many of you, we’ve grown weary of half-solutions. We want to be able to clone a project, <code>cd</code> in, and have external dependencies quietly taken care of, and so we built a tool called <a href="https://github.com/DeterminateSystems/riff" target="_blank">Riff</a> that addresses this problem head on. Today, we at <a href="https://determinate.systems/" target="_blank">Determinate Systems</a> are thrilled to announce its initial release.</p><h3>Introducing Riff</h3><p>Riff is a tool that we built to help developers write software without having to wrangle dependencies or complicated configuration. It’s built to enable you to clone a project and get to work in seconds. It’s currently <a href="https://github.com/determinateSystems/riff#installation">available</a> for macOS and standard Linux systems. Upon this initial release, Riff supports <a href="https://rust-lang.org">Rust</a> projects built with <a href="https://www.notion.so/Introducing-Riff-13046dd993b24189a5c73abac98a260d">Cargo</a> but we have plans to provide support for other languages, such as <a href="https://go.dev">Go</a> and the <a href="https://javascript.com">JavaScript</a> ecosystem, in the future.</p><p>Riff is powered by <a href="https://nixos.org/nix">Nix</a>, the purely functional language and package manager behind <a href="https://nixos.org/">NixOS</a>, <a href="https://github.com/NixOS/nixpkgs">Nixpkgs</a>, and many other projects. But don’t worry: we built Riff to solve your problems without requiring you to use, understand, or even care about Nix at all. Riff is <em>powered by</em> Nix but not another Nix tool.</p><p>So let’s take a look at Riff in action. <a href="https://github.com/tokio-rs/prost">Prost</a> is a popular Rust crate that provides a <a href="https://developers.google.com/protocol-buffers">Protocol Buffers</a> implementation for Rust. But on most systems, the build is doomed to fail due to missing external dependencies:</p>


</div></div><div data-block-type="2" id="block-yui_3_17_2_1_1661868666622_4002"><p>On Linux you get a <code>linker cc not found</code> error, while on macOS you get <code>library not found for -liconv</code> errors. Annoying! Even worse, any project that depends on <code>prost</code> produces the same error. Now let’s try it with <a href="https://github.com/DeterminateSystems/riff">Riff</a>:</p></div><div data-block-type="2" id="block-yui_3_17_2_1_1661868666622_5059"><div><p>And it works! So what has happened here? Riff has:</p><ul data-rte-list="default"><li><p>read your project’s <code>Cargo.toml</code>,</p></li><li><p>determined which external dependencies are necessary based on your crate dependency graph,</p></li><li><p>used Nix, with zero user input, to install external dependencies in <code>/nix/store</code>, and finally</p></li><li><p>assembled a shell environment that doesn’t interfere with anything else on your system.</p></li></ul><p>The <code>cargo build</code> command here runs inside that Nix-built shell environment. In fact, you can enter that environment at any time and run arbitrary commands:</p>


</div></div><div data-block-type="2" id="block-yui_3_17_2_1_1661868666622_5974"><div><p>For more on Riff, including instructions for <a href="https://github.com/determinateSystems/riff#how-to-declare-package-inputs">explicitly specifying</a> external dependencies in your <code>Cargo.toml</code> or using Riff with <a href="https://direnv.net">direnv</a>, see the project <a href="https://github.com/determinateSystems/riff">README</a>.</p><p>The first time we showed Riff to a user, they were quite surprised and even confused: how could it have been so straightforward? What on Earth quietly happened in the background? That&#39;s the energy we&#39;re going for with Riff: development environments that just work and require, at most, a teensy bit of configuration.</p><p>We’re confident that Riff will provide lasting benefits to the Rust ecosystem (and other ecosystems later). Rust is a fantastic language with incredible tools but it has its limits. External dependency problems introduce breakage points into the dependency graphs of <em>many</em> Rust projects. With Riff we hope to cover this “last mile” problem in Rust development and make the entire developer experience more robust.</p><h3>Future horizons</h3><p>We’ve kept our ambitions moderate in this initial release, but we still think that Riff will prove to be an indispensable tool for Rust developers—and others in the future. But Nix offers much more power that Riff could potentially tap into, including the ability to generate <a href="https://opencontainers.org">OCI</a> images, <a href="https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer">AWS Lambda layers</a>, or even packages for Nix and other package managers. We’re anxious to continue solving thorny, un-fun problems for developers, so stay tuned for more magic from Riff, including support for Go and JavaScript in the near future.</p><h3>Discussion</h3><p>If you’d like to discuss Riff with other users, you can join the <a href="https://discord.gg/urAzkgf7YM">Discord</a> for Riff.</p>


</div></div></div>
  </body>
</html>
