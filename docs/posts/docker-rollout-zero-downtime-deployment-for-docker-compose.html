<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Wowu/docker-rollout">Original</a>
    <h1>Show HN: Docker rollout ‚Äì Zero Downtime Deployment for Docker-compose</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">Docker CLI plugin that updates Docker Compose services without downtime.</p>
<p dir="auto">Simply replace <code>docker compose up -d &lt;service&gt;</code> with <code>docker rollout &lt;service&gt;</code> in your deployment scripts. This command will scale the service to 2 instances, wait for the new container to be ready, and then remove the old container.</p>
<ul dir="auto">
<li><a href="#features">Features</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a>
<ul dir="auto">
<li><a href="#%EF%B8%8F-caveats"><g-emoji alias="warning" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png">‚ö†Ô∏è</g-emoji> Caveats</a></li>
<li><a href="#sample-deployment-script">Sample deployment script</a></li>
</ul>
</li>
<li><a href="#why">Why?</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2 dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h2>
<ul dir="auto">
<li><g-emoji alias="hourglass_flowing_sand" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/23f3.png">‚è≥</g-emoji> Zero downtime deployment for Docker Compose services</li>
<li><g-emoji alias="whale" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f433.png">üê≥</g-emoji> Works with Docker Compose and docker-compose</li>
<li><g-emoji alias="heart" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png">‚ù§Ô∏è</g-emoji> Supports Docker healthchecks out of the box</li>
</ul>
<h2 dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installation</h2>
<div dir="auto" data-snippet-clipboard-copy-content="# Create directory for Docker cli plugins
mkdir -p ~/.docker/cli-plugins

# Download docker-rollout script to Docker cli plugins directory
curl https://raw.githubusercontent.com/wowu/docker-rollout/master/docker-rollout -o ~/.docker/cli-plugins/docker-rollout

# Make the script executable
chmod +x ~/.docker/cli-plugins/docker-rollout"><pre><span><span>#</span> Create directory for Docker cli plugins</span>
mkdir -p <span>~</span>/.docker/cli-plugins

<span><span>#</span> Download docker-rollout script to Docker cli plugins directory</span>
curl https://raw.githubusercontent.com/wowu/docker-rollout/master/docker-rollout -o <span>~</span>/.docker/cli-plugins/docker-rollout

<span><span>#</span> Make the script executable</span>
chmod +x <span>~</span>/.docker/cli-plugins/docker-rollout</pre></div>
<h2 dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Usage</h2>
<p dir="auto">Run <code>docker rollout &lt;name&gt;</code> instead of <code>docker compose up -d &lt;name&gt;</code> to update a service without downtime.</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ docker rollout -f docker-compose.yml &lt;service-name&gt;"><pre>$ docker rollout -f docker-compose.yml <span>&lt;</span>service-name<span>&gt;</span></pre></div>
<p dir="auto">Options:</p>
<ul dir="auto">
<li><code>-f | --file FILE</code> - (not required) - Path to compose file, can be specified multiple times, as in <code>docker-compose</code>.</li>
<li><code>-t | --timeout SECONDS</code> - (not required) - Timeout in seconds to wait for new container to become healthy, if the container has healthcheck defined in <code>Dockerfile</code> or <code>docker-compose.yml</code>. Default: 60</li>
<li><code>-w | --wait SECONDS</code> - (not required) - Time to wait for new container to be ready if healthcheck is not defined. Default: 10</li>
</ul>
<p dir="auto">See examples in <a href="https://github.com/Wowu/docker-rollout/blob/main/examples">examples</a> directory for sample <code>docker-compose.yml</code> files.</p>
<h3 dir="auto"><a id="user-content-Ô∏è-caveats" aria-hidden="true" href="#Ô∏è-caveats"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><g-emoji alias="warning" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png">‚ö†Ô∏è</g-emoji> Caveats</h3>
<ul dir="auto">
<li>Currently only services with scale 1 are supported.</li>
<li>Your service cannot have <code>container_name</code> and <code>ports</code> defined in <code>docker-compose.yml</code>, as it&#39;s not possible to run multiple containers with the same name or port mapping. Use a proxy as described below.</li>
<li>Proxy like <a href="https://github.com/traefik/traefik">Traefik</a> or <a href="https://github.com/nginx-proxy/nginx-proxy">nginx-proxy</a> is required to route traffic.</li>
<li>Each deployment will increment the index in container name (e.g. <code>project-web-1</code> -&gt; <code>project-web-2</code>).</li>
</ul>
<h3 dir="auto"><a id="user-content-sample-deployment-script" aria-hidden="true" href="#sample-deployment-script"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Sample deployment script</h3>
<p dir="auto">Sample deployment script for <code>web</code> service:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Download latest code
git pull
# Build new app image
docker compose build web
# Run database migrations
docker compose run web rake db:migrate
# Deploy new version
docker rollout web"><pre><span><span>#</span> Download latest code</span>
git pull
<span><span>#</span> Build new app image</span>
docker compose build web
<span><span>#</span> Run database migrations</span>
docker compose run web rake db:migrate
<span><span>#</span> Deploy new version</span>
docker rollout web</pre></div>
<h2 dir="auto"><a id="user-content-why" aria-hidden="true" href="#why"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Why?</h2>
<p dir="auto">Using <code>docker compose up</code> to deploy a new version of a service causes downtime because the app container is stopped before the new container is created.
If your application takes a while to boot, this may be noticeable to users.</p>
<p dir="auto">Using container orchestration tools like <a href="https://kubernetes.io/" rel="nofollow">Kubernetes</a> or <a href="https://www.nomadproject.io/" rel="nofollow">Nomad</a> is usually an overkill for projects that will do fine with a single-server Docker Compose setup. <a href="https://github.com/dokku/dokku">Dokku</a> comes with zero-downtime deployment and more useful features, but it&#39;s not as flexible as Docker Compose.</p>
<p dir="auto">If you have a proxy like <a href="https://github.com/traefik/traefik">Traefik</a> or <a href="https://github.com/nginx-proxy/nginx-proxy">nginx-proxy</a>, a zero downtime deployment can be achieved by writing a script that scales the service to 2 instances, waits for the new container to be ready, and then removes the old container.
<code>docker rollout</code> does exactly that, but with a single command that you can use in your deployment scripts.
If you&#39;re using Docker healthchecks, Traefik will make sure that traffic is only routed to the new container when it&#39;s ready.</p>
<h2 dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>License</h2>
<p dir="auto"><a href="https://github.com/Wowu/docker-rollout/blob/main/LICENSE">MIT License</a> ¬© Karol Musur</p>
</article>
          </div></div>
  </body>
</html>
