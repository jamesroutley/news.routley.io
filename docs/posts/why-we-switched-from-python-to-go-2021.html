<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://softwareengineeringdaily.com/2021/03/03/why-we-switched-from-python-to-go/">Original</a>
    <h1>Why We Switched from Python to Go (2021)</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>Switching to a new language is always a big step, especially when only one of your team members has prior experience with that language. Early this year, we switched <a href="https://getstream.io/" target="_blank" rel="noopener">Stream’s</a> primary programming language from Python to Go. This post will explain some of the reasons why we decided to leave Python behind and make the switch to Go. Thanks to <a href="https://twitter.com/frascoapp" target="_blank" rel="noopener">Ren Sakamoto</a> for translating <a href="https://frasco.io/why-we-switched-from-python-to-go-19581e27de7c" target="_blank" rel="noopener">Why we switched from Python to Go into Japanese, なぜ私達は Python から Go に移行したのか</a>.</p>
<h2 id="reason-performance">Reason 1 – Performance</h2>
<p>Go is fast! Go is extremely fast. The performance is similar to that of Java or C++. For our use case, Go is typically 40 times faster than Python. Here’s a small benchmark game comparing <a href="https://benchmarksgame-team.pages.debian.net/benchmarksgame/fastest/go-python3.html" target="_blank" rel="noopener">Go vs Python</a>.</p>
<h2 id="reason-language-performance-matters">Reason 2 – Language Performance Matters</h2>
<p>For many applications, the programming language is simply the glue between the app and the database. The performance of the language itself usually doesn’t matter much. Stream, however, is an <a href="https://getstream.io/#bp" target="_blank" rel="noopener">API provider</a> powering a <a href="https://getstream.io/activity-feeds/" target="_blank" rel="noopener">feeds</a> and <a href="https://getstream.io/chat/" target="_blank" rel="noopener">chat platform</a> for 700 companies and more than 500 million end users. We’ve been optimizing Cassandra, PostgreSQL, Redis, etc. for years, but eventually, you reach the limits of the language you’re using. Python is a great language but its performance is pretty sluggish for use cases such as serialization/deserialization, ranking and aggregation. We frequently ran into performance issues where Cassandra would take 1ms to retrieve the data and Python would spend the next 10ms turning it into objects.</p>
<h2 id="reason-developer-productivity-not-getting-too-creative">Reason 3 – Developer Productivity &amp; Not Getting Too Creative</h2>
<p>Have a look at this little snippet of Go code from the <a href="http://howistart.org/posts/go/1/" target="_blank" rel="noopener">How I Start Go tutorial</a>. (This is a great tutorial and a good starting point to pick up a bit of Go.)</p>
<div>
<div id="gist105392890">
<div>

<p><a href="http://https://gist.github.com/nparsons08/3d8df4a4706e131b36afa57e46497934/raw/7db57ca9fcf6adfd32c309a62eb73be1188a0308/1.go"><img data-attachment-id="10539" data-permalink="https://softwareengineeringdaily.com/2021/03/03/why-we-switched-from-python-to-go/1go/" data-orig-file="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/1go.png?fit=1516%2C922&amp;ssl=1" data-orig-size="1516,922" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="1go" data-image-description="" data-image-caption="" data-medium-file="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/1go.png?fit=300%2C182&amp;ssl=1" data-large-file="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/1go.png?fit=1024%2C623&amp;ssl=1" loading="lazy" src="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/1go.png?resize=500%2C304" alt="" width="500" height="304" srcset="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/1go.png?resize=300%2C182&amp;ssl=1 300w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/1go.png?resize=1024%2C623&amp;ssl=1 1024w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/1go.png?resize=768%2C467&amp;ssl=1 768w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/1go.png?w=1516&amp;ssl=1 1516w" sizes="(max-width: 500px) 100vw, 500px" data-recalc-dims="1"/></a></p>
</div>
</div>
</div>
<p>If you’re new to Go, there’s not much that will surprise you when reading that little code snippet. It showcases multiple assignments, data structures, pointers, formatting and a built-in HTTP library. When I first started programming I always loved using Python’s more advanced features. Python allows you to get pretty creative with the code you’re writing. For instance, you can:</p>
<ul>
<li>Use MetaClasses to self-register classes upon code initialization</li>
<li>Swap out True and False</li>
<li>Add functions to the list of built-in functions</li>
<li>Overload operators via magic methods</li>
<li>Use functions as properties via the @property decorator</li>
</ul>
<p>These features are fun to play around with but, as most programmers will agree, they often make the code harder to understand when reading someone else’s work. Go forces you to stick to the basics. This makes it very easy to read anyone’s code and immediately understand what’s going on. <em>Note: How “easy” it is really depends on your use case, of course. If you want to create a basic CRUD API I’d still recommend Django +</em> <a href="http://www.django-rest-framework.org/" target="_blank" rel="noopener"><em>DRF</em></a><em>, or Rails.</em></p>
<h2 id="reason-concurrency-channels">Reason 4 – Concurrency &amp; Channels</h2>
<p>As a language, Go tries to keep things simple. It doesn’t introduce many new concepts. The focus is on creating a simple language that is incredibly fast and easy to work with. The only area where it does get innovative is goroutines and channels. (To be 100% correct the concept of <a href="https://en.wikipedia.org/wiki/Communicating_sequential_processes" target="_blank" rel="noopener">CSP</a> started in 1977, so this innovation is more of a new approach to an old idea.) Goroutines are Go’s lightweight approach to threading, and channels are the preferred way to communicate between goroutines. Goroutines are very cheap to create and only take a few KBs of additional memory. Because Goroutines are so light, it is possible to have hundreds or even thousands of them running at the same time. You can communicate between goroutines using channels. The Go runtime handles all the complexity. The goroutines and channel-based approach to concurrency makes it very easy to use all available CPU cores and handle concurrent IO – all without complicating development. Compared to Python/Java, running a function on a goroutine requires minimal boilerplate code. You simply prepend the function call with the keyword “go”:</p>
<div>
<div id="gist105392900">
<div>
<p><a href="http://https://gist.github.com/nparsons08/6233539067ea11d75febb8978099040e/raw/96eb6098c9ddce0070db130a6fb345e66ab0b334/2.go"><img data-attachment-id="10538" data-permalink="https://softwareengineeringdaily.com/2021/03/03/why-we-switched-from-python-to-go/2go/" data-orig-file="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/2go.png?fit=1516%2C758&amp;ssl=1" data-orig-size="1516,758" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="2go" data-image-description="" data-image-caption="" data-medium-file="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/2go.png?fit=300%2C150&amp;ssl=1" data-large-file="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/2go.png?fit=1024%2C512&amp;ssl=1" loading="lazy" src="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/2go.png?resize=500%2C250" alt="" width="500" height="250" srcset="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/2go.png?resize=300%2C150&amp;ssl=1 300w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/2go.png?resize=1024%2C512&amp;ssl=1 1024w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/2go.png?resize=768%2C384&amp;ssl=1 768w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/2go.png?resize=260%2C129&amp;ssl=1 260w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/2go.png?w=1516&amp;ssl=1 1516w" sizes="(max-width: 500px) 100vw, 500px" data-recalc-dims="1"/></a></p>
</div>
</div>
</div>
<p><a href="https://tour.golang.org/concurrency/1" target="_blank" rel="noopener">https://tour.golang.org/concurrency/1</a> Go’s approach to concurrency is very easy to work with. It’s an interesting approach compared to Node where the developer has to pay close attention to how asynchronous code is handled. Another great aspect of concurrency in Go is the <a href="https://blog.golang.org/race-detector" target="_blank" rel="noopener">race detector</a>. This makes it easy to figure out if there are any race conditions within your asynchronous code.</p>
<blockquote><p>Knock knock Race condition Who’s there?</p>
<p>— I Am Devloper (@iamdevloper) <a href="https://twitter.com/iamdevloper/status/399991896862638081?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">November 11, 2013</a></p></blockquote>
<p>Here are a few good resources to get started with Go and channels:</p>
<ul>
<li><a href="https://gobyexample.com/channels" target="_blank" rel="noopener">https://gobyexample.com/channels</a></li>
<li><a href="https://tour.golang.org/concurrency/2" target="_blank" rel="noopener">https://tour.golang.org/concurrency/2</a></li>
<li><a href="http://guzalexander.com/2013/12/06/golang-channels-tutorial.html" target="_blank" rel="noopener">http://guzalexander.com/2013/12/06/golang-channels-tutorial.html</a></li>
<li><a href="https://www.golang-book.com/books/intro/10" target="_blank" rel="noopener">https://www.golang-book.com/books/intro/10</a></li>
<li><a href="https://www.goinggo.net/2014/02/the-nature-of-channels-in-go.html" target="_blank" rel="noopener">https://www.goinggo.net/2014/02/the-nature-of-channels-in-go.html</a></li>
<li><a href="https://softwareengineering.stackexchange.com/questions/222642/are-go-langs-goroutine-pools-just-green-threads" target="_blank" rel="noopener">Goroutines vs Green threads</a></li>
</ul>
<h2 id="reason-concurrency-channels">Reason 5 – Fast Compile Time</h2>
<p>Our largest micro service written in Go currently takes 4 seconds to compile. Go’s fast compile times are a major productivity win compared to languages like Java and C++ which are famous for sluggish compilation speed. I like sword fighting, but it’s even nicer to get things done while I still remember what the code is supposed to do:</p>
<p><img data-attachment-id="10542" data-permalink="https://softwareengineeringdaily.com/2021/03/03/why-we-switched-from-python-to-go/compilingcode/" data-orig-file="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/CompilingCode.png?fit=1536%2C1339&amp;ssl=1" data-orig-size="1536,1339" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="CompilingCode" data-image-description="" data-image-caption="" data-medium-file="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/CompilingCode.png?fit=300%2C262&amp;ssl=1" data-large-file="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/CompilingCode.png?fit=1024%2C893&amp;ssl=1" loading="lazy" src="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/CompilingCode.png?resize=500%2C436" alt="" width="500" height="436" srcset="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/CompilingCode.png?resize=300%2C262&amp;ssl=1 300w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/CompilingCode.png?resize=1024%2C893&amp;ssl=1 1024w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/CompilingCode.png?resize=768%2C670&amp;ssl=1 768w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/CompilingCode.png?w=1536&amp;ssl=1 1536w" sizes="(max-width: 500px) 100vw, 500px" data-recalc-dims="1"/></p>
<h2 id="reason-the-ability-to-build-a-team">Reason 6 – The Ability to Build a Team</h2>
<p>First of all, let’s start with the obvious: there are not as many Go developers compared to older languages like C++ and Java. According to <a href="https://insights.stackoverflow.com/survey/2017" target="_blank" rel="noopener">StackOverflow</a>, <strong>38%</strong> of developers know Java, <strong>19.3%</strong> know C++ and only <strong>4.6%</strong> know Go. <a href="https://madnight.github.io/githut/" target="_blank" rel="noopener">GitHub data</a> shows a <a href="http://githut.info/" target="_blank" rel="noopener">similar trend</a>: Go is more widely used than languages such as Erlang, Scala and Elixir, but less popular than Java and C++. Fortunately, Go is a very simple and easy to learn language. It provides the basic features you need and nothing else. The new concepts it introduces are the “<a href="https://blog.golang.org/defer-panic-and-recover" target="_blank" rel="noopener">defer</a>” statement and built-in management of concurrency with “go routines” and channels. (For the purists: Go isn’t the first language to implement these concepts, just the first to make them popular.) Any Python, Elixir, C++, Scala or Java dev that joins a team can be effective at Go within a month because of its simplicity. We’ve found it easier to build a team of Go developers compared to many other languages. If you’re hiring people in competitive ecosystems like <a href="https://getstream.io/team/" target="_blank" rel="noopener">Boulder and Amsterdam</a> this is an important benefit.</p>
<h2 id="reason-strong-ecosystem">Reason 7 – Strong Ecosystem</h2>
<p>For a team of our size (~20 people) the ecosystem matters. You simply can’t create value for your customers if you have to reinvent every little piece of functionality. Go has great support for the tools we use. Solid libraries were already available for Redis, RabbitMQ, PostgreSQL, Template parsing, Task scheduling, Expression parsing and RocksDB. Go’s ecosystem is a major win compared to other newer languages like Rust or Elixir. It’s of course not as good as languages like Java, Python or Node, but it’s solid and for many basic needs you’ll find high-quality packages already available.</p>
<h2 id="reason-gofmt-enforced-code-formatting">Reason 8 – Gofmt, Enforced Code Formatting</h2>
<p>Let’s start with what is Gofmt? And no, it’s not a swear word. Gofmt is an awesome command line utility, built into the Go compiler for formatting your code. In terms of functionality it’s very similar to Python’s autopep8. While the show Silicon Valley portrays otherwise, most of us don’t really like to argue about tabs vs spaces. It’s important that formatting is consistent, but the actual formatting standard doesn’t really matter all that much. Gofmt avoids all of this discussion by having one official way to format your code.</p>
<h2 id="reason-grpc-and-protocol-buffers">Reason 9 – gRPC and Protocol Buffers</h2>
<p>Go has first-class support for protocol buffers and gRPC. These two tools work very well together for building microservices which need to communicate via RPC. You only need to write a manifest where you define the RPC calls that can be made and what arguments they take. Both server and client code are then automatically generated from this manifest. This resulting code is both fast, has a very small network footprint and is easy to use. From the same manifest, you can generate client code for many different languages even, such as C++, Java, Python and Ruby. So, no more ambiguous REST endpoints for internal traffic, that you have to write almost the same client and server code for every time. .</p>
<h2 id="reason-fast-compile-time">Disadvantage 1 – Lack of Frameworks</h2>
<p>Go doesn’t have a single dominant framework like Rails for Ruby, Django for Python or Laravel for PHP. This is a topic of heated debate within the Go community, as many people advocate that you shouldn’t use a framework to begin with. I totally agree that this is true for some use cases. However, if someone wants to build a simple CRUD API they will have a much easier time with Django/DJRF, Rails Laravel or <a href="http://phoenixframework.org/" target="_blank" rel="noopener">Phoenix</a>. <em>Update:</em> as the comments pointed out there are several projects that provide a framework for Go. <a href="https://github.com/revel/revel" target="_blank" rel="noopener">Revel</a>, <a href="https://iris-go.com/" target="_blank" rel="noopener">Iris</a>, <a href="https://github.com/labstack/echo" target="_blank" rel="noopener">Echo</a>, <a href="https://github.com/go-macaron/macaron" target="_blank" rel="noopener">Macaron</a> and <a href="https://github.com/gobuffalo/buffalo" target="_blank" rel="noopener">Buffalo</a> seem to be the leading contenders. For Stream’s use case we prefer to not use a framework. However for many new projects that are looking to provide a simple CRUD API the lack of a dominant framework will be a serious disadvantage.</p>
<h2 id="disadvantage-error-handling">Disadvantage 2 – Error Handling</h2>
<p>Go handles errors by simply returning an error from a function and expecting your calling code to handle the error (or to return it up the calling stack). While this approach works, it’s easy to lose scope of what went wrong to ensure you can provide a meaningful error to your users. The <a href="https://github.com/pkg/errors" target="_blank" rel="noopener">errors package</a> solves this problem by allowing you to add context and a stack trace to your errors. Another issue is that it’s easy to forget to handle an error by accident. Static analysis tools like errcheck and megacheck are handy to avoid making these mistakes. While these workarounds work well it doesn’t feel quite right. You’d expect proper error handling to be supported by the language.</p>
<h2 id="reason-the-ability-to-build-a-team">Disadvantage 3 – Package Management</h2>
<p><em>Update: Go’s package management has come a long way since this post was written. <a href="https://blog.golang.org/using-go-modules" target="_blank" rel="noopener">Go modules</a> are an effective solution, the only issue I’ve seen with them is that they break some static analysis tools like errcheck. Here’s a tutorial for learning to use <a href="https://getstream.io/blog/go-1-11-rocket-tutorial/" target="_blank" rel="noopener">Go using Go modules</a>.  </em> Go’s package management is by no means perfect. By default, it doesn’t have a way to specify a specific version of a dependency and there’s no way to create reproducible builds. Python, Node and Ruby all have better systems for package management. However, with the right tools, Go’s package management works quite well. You can use <a href="https://insights.stackoverflow.com/survey/2017" target="_blank" rel="noopener">Dep</a> to manage your dependencies to allow specifying and pinning versions. Apart from that, we’ve contributed an open-source tool called <a href="https://github.com/getstream/vg" target="_blank" rel="noopener">VirtualGo</a> which makes it easier to work on multiple projects written in Go.</p>
<p><img data-attachment-id="10541" data-permalink="https://softwareengineeringdaily.com/2021/03/03/why-we-switched-from-python-to-go/virtualstream/" data-orig-file="https://i0.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/VirtualStream.png?fit=1536%2C1567&amp;ssl=1" data-orig-size="1536,1567" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="VirtualStream" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/VirtualStream.png?fit=294%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/VirtualStream.png?fit=1004%2C1024&amp;ssl=1" loading="lazy" src="https://i0.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/VirtualStream.png?resize=500%2C510" alt="" width="500" height="510" srcset="https://i0.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/VirtualStream.png?resize=294%2C300&amp;ssl=1 294w, https://i0.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/VirtualStream.png?resize=1004%2C1024&amp;ssl=1 1004w, https://i0.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/VirtualStream.png?resize=768%2C784&amp;ssl=1 768w, https://i0.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/VirtualStream.png?resize=1506%2C1536&amp;ssl=1 1506w, https://i0.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/VirtualStream.png?w=1536&amp;ssl=1 1536w" sizes="(max-width: 500px) 100vw, 500px" data-recalc-dims="1"/></p>
<h2 id="reason-strong-ecosystem">Python vs Go</h2>
<p><em>Update: The performance difference between Python and Go increased since this post was written. (Go became faster and Python didn’t)</em> One interesting experiment we conducted was taking our <a href="https://getstream.io/docs/#custom_ranking" target="_blank" rel="noopener">ranked feed</a> functionality in Python and rewriting it in Go. Have a look at this example of a ranking method:</p>
<div>
<div id="gist105392909">
<div>

<p><a href="http://https://gist.github.com/nparsons08/1c2fa6c29ce0d3e61fface0a30c831fe/raw/6489f90a1bf1ae82e51864849a29f1f538375f78/3.json"><img data-attachment-id="10537" data-permalink="https://softwareengineeringdaily.com/2021/03/03/why-we-switched-from-python-to-go/3json/" data-orig-file="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/3json.png?fit=1524%2C978&amp;ssl=1" data-orig-size="1524,978" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="3json" data-image-description="" data-image-caption="" data-medium-file="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/3json.png?fit=300%2C193&amp;ssl=1" data-large-file="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/3json.png?fit=1024%2C657&amp;ssl=1" loading="lazy" src="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/3json.png?resize=500%2C321" alt="" width="500" height="321" srcset="https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/3json.png?resize=300%2C193&amp;ssl=1 300w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/3json.png?resize=1024%2C657&amp;ssl=1 1024w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/3json.png?resize=768%2C493&amp;ssl=1 768w, https://i2.wp.com/softwareengineeringdaily.com/wp-content/uploads/2021/02/3json.png?w=1524&amp;ssl=1 1524w" sizes="(max-width: 500px) 100vw, 500px" data-recalc-dims="1"/></a></p>
</div>
</div>
</div>
<p>Both the Python and Go code need to do the following to support this ranking method:</p>
<ol>
<li>Parse the expression for the score. In this case, we want to turn this string “simple_gauss(time)*popularity” into a function that takes an activity as input and returns a score as output.</li>
<li>Create partial functions based on the JSON config. For example, we want “simple_gauss” to call “decay_gauss” with a scale of 5 days, offset of 1 day and a decay factor of 0.3.</li>
<li>Parse the “defaults” configuration so you have a fallback if a certain field is not defined on an activity.</li>
<li>Use the function from step 1 to score all activities in the feed.</li>
</ol>
<p>Developing the Python version of the ranking code took roughly 3 days. That includes writing the code, unit tests and documentation. Next, we’ve spent approximately 2 weeks optimizing the code. One of the optimizations was translating the score expression (simple_gauss(time)*popularity) into an <a href="https://docs.python.org/3/library/ast.html" target="_blank" rel="noopener">abstract syntax tree</a>. We also implemented caching logic which pre-computed the score for certain times in the future. In contrast, developing the Go version of this code took roughly 4 days. The performance didn’t require any further optimization. So while the initial bit of development was faster in Python, the Go based version ultimately required substantially less work from our team. As an added benefit, the Go code performed roughly 40 times faster than our highly-optimized Python code. Now, this is just a single example of the performance gains we’ve experienced by switching to Go. It is, of course, comparing apples to oranges:</p>
<ul>
<li>The ranking code was my first project in Go</li>
<li>The Go code was built after the Python code, so the use case was better understood</li>
<li>The Go library for expression parsing was of exceptional quality</li>
</ul>
<p>Your mileage will vary. Some other components of our system took substantially more time to build in Go compared to Python. As a general trend, we see that <em>developing</em> Go code takes slightly more effort. However, we spend much less time <em>optimizing</em> the code for performance.</p>
<h2 id="reason-gofmt-enforced-code-formatting">Elixir vs Go – The Runner Up</h2>
<p>Another language we evaluated is <a href="https://elixir-lang.org/" target="_blank" rel="noopener">Elixir</a>. Elixir is built on top of the Erlang virtual machine. It’s a fascinating language and we considered it since one of our team members has a ton of experience with Erlang. For our use cases, we noticed that Go’s raw performance is much better. Both Go and Elixir will do a great job serving thousands of concurrent requests. However, if you look at individual request performance, Go is substantially faster for our use case. Another reason why we chose Go over Elixir was the ecosystem. For the components we required, Go had more mature libraries whereas, in many cases, the Elixir libraries weren’t ready for production usage. It’s also harder to train/find developers to work with Elixir. These reasons tipped the balance in favor of Go. The Phoenix framework for Elixir looks awesome though and is definitely worth a look.</p>
<h2 id="reason-grpc-and-protocol-buffers">Conclusion</h2>
<p>Go is a very performant language with great support for concurrency. It is almost as fast as languages like C++ and Java. While it does take a bit more time to build things using Go compared to Python or Ruby, you’ll save a ton of time spent on optimizing the code. We have a small development team at <a href="https://getstream.io/team/" target="_blank" rel="noopener">Stream</a> powering feeds and <a href="https://getstream.io/chat/" target="_blank" rel="noopener">chat</a> for over 500 million end users. Go’s combination of a <strong>great ecosystem</strong>, <strong>easy onboarding</strong> for new developers, <strong>fast performance</strong>, <strong>solid support</strong> for concurrency and a <strong>productive programming environment</strong> make it a great choice. Stream still leverages Python for our dashboard, site and machine learning for <a href="https://getstream.io/personalization" target="_blank" rel="noopener">personalized feeds</a>. We won’t be saying goodbye to Python anytime soon, but going forward all performance-intensive code will be written in Go. Our new <a href="https://getstream.io/chat/#chatmessaging" target="_blank" rel="noopener">Chat API</a> is also written entirely in Go. If you want to learn more about Go check out the blog posts listed below. To learn more about Stream, <a href="https://getstream.io/get_started/" target="_blank" rel="noopener">this interactive tutorial</a> is a great starting point.</p>
<h2 id="disadvantage-lack-of-frameworks">More Reading about Switching to Golang</h2>
<ul>
<li><a href="https://movio.co/en/blog/migrate-Scala-to-Go/" target="_blank" rel="noopener">https://movio.co/en/blog/migrate-Scala-to-Go/</a></li>
<li><a href="https://hackernoon.com/why-i-love-golang-90085898b4f7" target="_blank" rel="noopener">https://hackernoon.com/why-i-love-golang-90085898b4f7</a></li>
<li><a href="https://sendgrid.com/blog/convince-company-go-golang/" target="_blank" rel="noopener">https://sendgrid.com/blog/convince-company-go-golang/</a></li>
<li><a href="https://dave.cheney.net/2017/03/20/why-go" target="_blank" rel="noopener">https://dave.cheney.net/2017/03/20/why-go</a></li>
</ul>
<h2 id="disadvantage-error-handling">Learning Go</h2>
<ul>
<li><a href="https://learnxinyminutes.com/docs/go/" target="_blank" rel="noopener">https://learnxinyminutes.com/docs/go/</a></li>
<li><a href="https://tour.golang.org/" target="_blank" rel="noopener">https://tour.golang.org/</a></li>
<li><a href="http://howistart.org/posts/go/1/" target="_blank" rel="noopener">http://howistart.org/posts/go/1/</a></li>
<li><a href="https://getstream.io/blog/building-a-performant-api-using-go-and-cassandra/" target="_blank" rel="noopener">https://getstream.io/blog/building-a-performant-api-using-go-and-cassandra/</a></li>
<li><a href="https://www.amazon.com/gp/product/0134190440" target="_blank" rel="noopener">https://www.amazon.com/gp/product/0134190440</a></li>
<li><a href="https://getstream.io/blog/go-1-11-rocket-tutorial/" target="_blank" rel="noopener">Go Rocket Tutorial</a></li>
</ul>
</div></div>
  </body>
</html>
