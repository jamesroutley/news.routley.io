<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://dmitri.shuralyov.com/idiomatic-go">Original</a>
    <h1>Idiomatic Go (2016)</h1>
    
    <div id="readability-page-1" class="page"><div><div>

<p>When reviewing Go code, if I run into a situation where I see an unnecessary deviation from
idiomatic Go style or best practice, I add an entry here complete with some rationale, and
link to it.</p>

<p>I can do this for the smallest and most subtle of details, since I care about Go a lot. I can
reuse this each time the same issue comes up, instead of having to re-write the rationale
multiple times, or skip explaining why I make a given suggestion.</p>

<p>You can view this as my supplement to <a href="https://go.dev/s/style" rel="nofollow">https://go.dev/s/style</a>.</p>

<p>This page is generated from the entries with label &#34;Accepted&#34; <a href="https://dmitri.shuralyov.com/idiomatic-go/entries" rel="nofollow">here</a>.
If you&#39;d like to add a new suggestion, please provide convincing rationale and references
(e.g., links to places in Go project that support your suggestion), and open a new issue.
It&#39;ll show up here when I add an &#34;Accepted&#34; label.</p>
<ul><li><a href="#use-consistent-spelling-of-certain-words">Use consistent spelling of certain words</a></li><li><a href="#single-spaces-between-sentences">Single spaces between sentences</a></li><li><a href="#error-variable-naming">Error variable naming</a></li><li><a href="#for-brands-or-words-with-more-than-1-capital-letter-lowercase-all-letters">For brands or words with more than 1 capital letter, lowercase all letters</a></li><li><a href="#comments-for-humans-always-have-a-single-space-after-the-slashes">Comments for humans always have a single space after the slashes</a></li><li><a href="#use-singular-form-for-collection-repo-folder-name">Use singular form for collection repo/folder name</a></li><li><a href="#avoid-unused-method-receiver-names">Avoid unused method receiver names</a></li><li><a href="#empty-string-check">Empty string check</a></li><li><a href="#mutex-hat">Mutex hat</a></li><li><a href="#don-t-os-exit-2-inside-flag-usage">Don&#39;t os.Exit(2) inside flag.Usage</a></li></ul></div><div><h3><a name="use-consistent-spelling-of-certain-words" href="#use-consistent-spelling-of-certain-words" rel="nofollow" aria-hidden="true"><span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" style="fill: currentColor; vertical-align: top;"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Use consistent spelling of certain words</h3></div><div><p>Do this:</p>

<pre><code>// marshaling
// unmarshaling
// canceling
// canceled
// cancellation
</code></pre>

<p>Don&#39;t do this:</p>

<pre><code>// marshalling
// unmarshalling
// cancelling
// cancelled
// cancelation
</code></pre>

<p>For consistency with the Go project. These words have multiple valid spellings. The Go project picks one. See <a href="https://go.dev/wiki/Spelling" rel="nofollow">go.dev/wiki/Spelling</a>.</p>
</div><div><h3><a name="single-spaces-between-sentences" href="#single-spaces-between-sentences" rel="nofollow" aria-hidden="true"><span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" style="fill: currentColor; vertical-align: top;"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Single spaces between sentences</h3></div><div><p>Do this:</p>

<pre><code>// Sentence one. Sentence two.
</code></pre>

<p>Don&#39;t do this:</p>

<pre><code>// Sentence one.  Sentence two.
</code></pre>

<p>For consistency with Go style. See <a href="https://go.dev/cl/20022" rel="nofollow">CL 20022</a>.</p>
</div><div><p>Do this:</p>

<div><pre><span>// Package level exported error.</span>
<span>var</span> <span>ErrSomething</span> <span>=</span> <span>errors</span><span>.</span><span>New</span><span>(</span><span>&#34;something went wrong&#34;</span><span>)</span>

<span>func</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
	<span>// Normally you call it just &#34;err&#34;,</span>
	<span>result</span><span>,</span> <span>err</span> <span>:=</span> <span>doSomething</span><span>(</span><span>)</span>
	<span>// and use err right away.</span>

	<span>// But if you want to give it a longer name, use &#34;somethingError&#34;.</span>
	<span>var</span> <span>specificError</span> <span>error</span>
	<span>result</span><span>,</span> <span>specificError</span> <span>=</span> <span>doSpecificThing</span><span>(</span><span>)</span>

	<span>// ... use specificError later.</span>
<span>}</span>
</pre></div>

<p>Don&#39;t do this:</p>

<div><pre><span>var</span> <span>ErrorSomething</span> <span>=</span> <span>errors</span><span>.</span><span>New</span><span>(</span><span>&#34;something went wrong&#34;</span><span>)</span>
<span>var</span> <span>SomethingErr</span> <span>=</span> <span>errors</span><span>.</span><span>New</span><span>(</span><span>&#34;something went wrong&#34;</span><span>)</span>
<span>var</span> <span>SomethingError</span> <span>=</span> <span>errors</span><span>.</span><span>New</span><span>(</span><span>&#34;something went wrong&#34;</span><span>)</span>

<span>func</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
	<span>var</span> <span>specificErr</span> <span>error</span>
	<span>result</span><span>,</span> <span>specificErr</span> <span>=</span> <span>doSpecificThing</span><span>(</span><span>)</span>

	<span>var</span> <span>errSpecific</span> <span>error</span>
	<span>result</span><span>,</span> <span>errSpecific</span> <span>=</span> <span>doSpecificThing</span><span>(</span><span>)</span>

	<span>var</span> <span>errorSpecific</span> <span>error</span>
	<span>result</span><span>,</span> <span>errorSpecific</span> <span>=</span> <span>doSpecificThing</span><span>(</span><span>)</span>
<span>}</span>
</pre></div>

<p>For consistency. See <a href="https://go.dev/talks/2014/names.slide#14" rel="nofollow">https://go.dev/talks/2014/names.slide#14</a>.</p>
</div><div><h3><a name="for-brands-or-words-with-more-than-1-capital-letter-lowercase-all-letters" href="#for-brands-or-words-with-more-than-1-capital-letter-lowercase-all-letters" rel="nofollow" aria-hidden="true"><span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" style="fill: currentColor; vertical-align: top;"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>For brands or words with more than 1 capital letter, lowercase all letters</h3></div><div><p>Do this:</p>

<div><pre><span>// Exported.</span>
<span>var</span> <span>OAuthEnabled</span> <span>bool</span>
<span>var</span> <span>GitHubToken</span> <span>string</span>

<span>// Unexported.</span>
<span>var</span> <span>oauthEnabled</span> <span>bool</span>
<span>var</span> <span>githubToken</span> <span>string</span>
</pre></div>

<p>Don&#39;t do this:</p>

<div><pre><span>// Unexported.</span>
<span>var</span> <span>oAuthEnabled</span> <span>bool</span>
<span>var</span> <span>gitHubToken</span> <span>string</span>
</pre></div>

<p>Lowercase all letters, not only the first letter, of the first word when you want to make an unexported version.</p>

<p>For consistency with what the Go project does, and because it looks nicer. <code>oAuth</code> is not pretty.</p>
</div><div><h3><a name="comments-for-humans-always-have-a-single-space-after-the-slashes" href="#comments-for-humans-always-have-a-single-space-after-the-slashes" rel="nofollow" aria-hidden="true"><span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" style="fill: currentColor; vertical-align: top;"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Comments for humans always have a single space after the slashes</h3></div><div><p>Do this:</p>

<pre><code>// This is a comment
// for humans.
</code></pre>

<p>Don&#39;t do this:</p>

<pre><code>//This is a comment
//for humans.
</code></pre>

<p>For consistency, and because the no space style is reserved for comment pragmas, for example:</p>

<pre><code>//go:generate go run gen.go
</code></pre>

<p>Temporarily commented out code should also have no spaces, but it&#39;s not meant to be committed.</p>

<p>See <a href="https://go.dev/cmd/compile/#hdr-Compiler_Directives" rel="nofollow">https://go.dev/cmd/compile/#hdr-Compiler_Directives</a>.</p>
</div><div><h3><a name="use-singular-form-for-collection-repo-folder-name" href="#use-singular-form-for-collection-repo-folder-name" rel="nofollow" aria-hidden="true"><span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" style="fill: currentColor; vertical-align: top;"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Use singular form for collection repo/folder name</h3></div><div><p>Do this:</p>

<pre><code>github.com/golang/example/hello
github.com/golang/example/outyet
golang.org/x/mobile/example/basic
golang.org/x/mobile/example/flappy
golang.org/x/image/...
github.com/shurcooL/tictactoe/player/bad
github.com/shurcooL/tictactoe/player/random
</code></pre>

<p>Don&#39;t do this:</p>

<pre><code>github.com/golang/examples/hello
github.com/golang/examples/outyet
golang.org/x/mobile/examples/basic
golang.org/x/mobile/examples/flappy
golang.org/x/images/...
github.com/shurcooL/tictactoe/players/bad
github.com/shurcooL/tictactoe/players/random
</code></pre>

<p>Notice how &#34;example&#34;, &#34;image&#34;, &#34;player&#34; folder names simply contain many related packages, yet they use singular form.</p>

<p>Because it&#39;s consistent with the style the Go project uses.</p>
</div><div><h3><a name="avoid-unused-method-receiver-names" href="#avoid-unused-method-receiver-names" rel="nofollow" aria-hidden="true"><span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" style="fill: currentColor; vertical-align: top;"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Avoid unused method receiver names</h3></div><div><p>Do this:</p>

<div><pre><span>func</span> <span>(</span><span>foo</span><span>)</span> <span>method</span><span>(</span><span>)</span> <span>{</span>
	<span>...</span>
<span>}</span>
</pre></div>

<p>Don&#39;t do this:</p>

<div><pre><span>func</span> <span>(</span><span>f</span> <span>foo</span><span>)</span> <span>method</span><span>(</span><span>)</span> <span>{</span>
	<span>...</span>
<span>}</span>
</pre></div>

<p>If <code>f</code> is unused. It&#39;s more readable because it&#39;s clear that fields or methods of <code>foo</code> are not used in <code>method</code>.</p>
</div><div><p>Do this:</p>



<p>Don&#39;t do this:</p>



<p>If you&#39;re checking if <code>s</code> is the empty string. Using <code>len(s)</code> is fine for other uses.</p>

<p>The first form is more readable because it&#39;s more obvious <code>s</code> is a string and not a slice.</p>

<p>See Russ Cox&#39;s <a href="https://groups.google.com/g/golang-nuts/c/7Ks1iq2s7FA/m/GOujoyeYsOcJ" rel="nofollow">comment in a golang-nuts thread</a>:</p>

<blockquote>
<p>if I care about &#34;is it this specific string&#34; I tend to write s == &#34;&#34;.</p>
</blockquote>
</div><div><div><pre><span>struct</span> <span>{</span>
	<span>...</span>

	<span>rateMu</span>     <span>sync</span><span>.</span><span>Mutex</span>
	<span>rateLimits</span> <span>[</span><span>categories</span><span>]</span><span>Rate</span>
	<span>mostRecent</span> <span>rateLimitCategory</span>
<span>}</span>
</pre></div>

<p>Here, <code>rateMu</code> is a mutex hat. It sits, like a hat, on top of the variables that it protects.</p>

<p>So, without needing to write the comment, the above is implicitly understood to be equivalent to:</p>

<div><pre><span>struct</span> <span>{</span>
	<span>...</span>

	<span>// rateMu protects rateLimits and mostRecent.</span>
	<span>rateMu</span>     <span>sync</span><span>.</span><span>Mutex</span>
	<span>rateLimits</span> <span>[</span><span>categories</span><span>]</span><span>Rate</span>
	<span>mostRecent</span> <span>rateLimitCategory</span>
<span>}</span>
</pre></div>

<p>When adding a new, unrelated field that isn&#39;t protected by <code>rateMu</code>, do this:</p>

<div><pre> struct {
 	...
<span>
</span> 	rateMu     sync.Mutex
 	rateLimits [categories]Rate
 	mostRecent rateLimitCategory
<span><span><span></span>+
+	common service
</span></span> }
</pre></div>

<p>Don&#39;t do this:</p>

<div><pre> struct {
 	...
<span>
</span> 	rateMu     sync.Mutex
 	rateLimits [categories]Rate
 	mostRecent rateLimitCategory
<span><span><span></span>+	common     service
</span></span> }
</pre></div>

<p>See <a href="https://go.dev/talks/2014/readability.slide#21" rel="nofollow">https://go.dev/talks/2014/readability.slide#21</a>.</p>
</div><div><h3><a name="don-t-os-exit-2-inside-flag-usage" href="#don-t-os-exit-2-inside-flag-usage" rel="nofollow" aria-hidden="true"><span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" style="fill: currentColor; vertical-align: top;"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Don&#39;t os.Exit(2) inside flag.Usage</h3></div><div><p>Do this:</p>

<div><pre><span>flag</span><span>.</span><span>Usage</span> <span>=</span> <span>func</span><span>(</span><span>)</span> <span>{</span>
	<span>fmt</span><span>.</span><span>Fprintf</span><span>(</span><span>os</span><span>.</span><span>Stderr</span><span>,</span> <span>&#34;Usage of %s:\n&#34;</span><span>,</span> <span>os</span><span>.</span><span>Args</span><span>[</span><span>0</span><span>]</span><span>)</span>
	<span>flag</span><span>.</span><span>PrintDefaults</span><span>(</span><span>)</span>
<span>}</span>
</pre></div>

<p>Don&#39;t do this:</p>

<div><pre><span>flag</span><span>.</span><span>Usage</span> <span>=</span> <span>func</span><span>(</span><span>)</span> <span>{</span>
	<span>fmt</span><span>.</span><span>Fprintf</span><span>(</span><span>os</span><span>.</span><span>Stderr</span><span>,</span> <span>&#34;Usage of %s:\n&#34;</span><span>,</span> <span>os</span><span>.</span><span>Args</span><span>[</span><span>0</span><span>]</span><span>)</span>
	<span>flag</span><span>.</span><span>PrintDefaults</span><span>(</span><span>)</span>
	<span>os</span><span>.</span><span>Exit</span><span>(</span><span>2</span><span>)</span>
<span>}</span>
</pre></div>

<p>The <code>os.Exit</code> call is unnecessary because <code>flag</code> package is already responsible for doing it. See <a href="https://github.com/mdempsky/unconvert/commit/3b9aa41c71a855a5f5fee96dc751979ce6e8cbbe" rel="nofollow">here</a> and <a href="https://github.com/campoy/embedmd/pull/12" rel="nofollow">here</a> for examples.</p>
</div></div></div>
  </body>
</html>
