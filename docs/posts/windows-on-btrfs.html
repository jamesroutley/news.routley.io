<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.lilysthings.org/blog/windows-on-btrfs/">Original</a>
    <h1>Windows on Btrfs</h1>
    
    <div id="readability-page-1" class="page"><div id="content">
			<p>Hello and Welcome back to The Cool Blog here on The Cool Site.</p>
			<p>So for the past year and a half or so I&#39;ve been using the fantastic <a href="https://github.com/maharmstone/btrfs">Windows btrfs driver</a> for easily sharing files between my Windows and Linux dualboot. The driver works great and basically fully supports everything that both operating systems could ever want (and let me tell you transparent compression and copy on write on Windows is so fucking nice). If you dualboot Windows and Linux I highly recommend using this for external drives instead of using NTFS with Linux.</p>
			<p>Anyway <a href="https://github.com/maharmstone">maharmstone</a>, the creator of the driver, has also been working on another project called <a href="https://github.com/maharmstone/quibble">Quibble</a>. Quibble is an open source reimplentation of the Windows bootloader that has the incredibly awesome feature of allowing one to boot Windows off of other filesystems. It can boot it off of anything that it has an EFI driver for and that Windows can read. Theoretically nothing is stopping you from booting Windows 11 off of FAT32 (Although I&#39;m sure that Windows would have some issues with that as XP was the last version that let you boot off of FAT32)</p>
			<p>Quibble has been something that I had previously messed with in the past but could never get to work. The last release had been from 2021 and I never cared enough to actually compile the much newer source sode. A few weeks ago though there was a new release so I though fuck it and decided to try it. I downloaded the latest release of Quibble, stuck it in my EFI partition, used their <a href="https://github.com/maharmstone/ntfs2btrfs"> ntfs2btrfs</a> tool to convert my existing Windows partition to btrfs, edited the Quibble config file to point to the right partition and rebooted... and immediately forgot this laptop&#39;s dumbass UEFI doesn&#39;t let me pick an EFI file to boot from. After 10 minutes of me trying to remember how to use efibootmgr I was able to add it to the boot options and actually reboot.</p>
			<center>
				<a href="https://www.lilysthings.org/blog/windows-on-btrfs/images/bootmenu.jpg"><img id="blog_image" src="https://www.lilysthings.org/blog/windows-on-btrfs/images/bootmenu.jpg"/></a>
				<center>The Quibble boot menu</center>
			</center>	
			<p>The boot menu of Quibble looks like if you took grub, made it HiDPI aware, and added nicer fonts. Considering my failed attempts in the past where it would never find the partition I wasn&#39;t expecting much when I selected Windows.</p>
			<center>
				<div>
					<p><a href="https://www.lilysthings.org/blog/windows-on-btrfs/images/booting.jpg"><img id="blog_image" src="https://www.lilysthings.org/blog/windows-on-btrfs/images/booting.jpg"/></a>
					</p>
					<p><a href="https://www.lilysthings.org/blog/windows-on-btrfs/images/booting2.jpg"><img id="blog_image" src="https://www.lilysthings.org/blog/windows-on-btrfs/images/booting2.jpg"/></a>
					</p>
				</div>
				<a href="https://www.lilysthings.org/blog/windows-on-btrfs/images/logonui.jpg"><img id="blog_image" src="https://www.lilysthings.org/blog/windows-on-btrfs/images/logonui.jpg"/></a>
			</center>
			<p>Holy shit it actually fucking worked.</p>
			<center>
				<a href="https://www.lilysthings.org/blog/windows-on-btrfs/images/diskproperties.JPG"><img id="blog_image" src="https://www.lilysthings.org/blog/windows-on-btrfs/images/diskproperties.JPG"/></a>
			</center>
			<p>I really wasn&#39;t expecting it to work. Well since we&#39;re at the login screen I signed in and was immediately hearing error sounds even before the desktop loaded. I forgot to take screenshots but it was the AMD stuff from the Microsoft Store failing to launch. This takes us into the one downside (or feature depending on how you see it). &#34;Windows 10 apps&#34;, basically things you would get from the Microsoft Store don&#39;t work. Your first thought might be &#34;who cares nobody gets anything from the Microsoft Store&#34; but this means that Windows Terminal doesn&#39;t work and you&#39;re stuck with the shitty default powershell and command prompt apps and I can&#39;t play Minecraft Bedrock.</p>
			<p>Oh well...</p>
			<p>Anyway with it seemingly working perfectly I rebooted into Arch Linux so I could do transparent compression on this. This was when I realized that the ntfs2btrfs program didn&#39;t do things perfectly. Immediately when I tried to write anything to it dmesg was filled with errors and the filesystem remounted as read only. As I am an idiot I didn&#39;t really know how I could fix this at the moment. Btrfs check said everything was fine.</p>
			<p>I decided to make a new btrfs partition and just copy over all the files and see if that would boot. I was shocked to see that it did and now that I had a clean and uncorrupted filesystem it was time for the incredibly dumb idea I had.</p>
			<p>There are no directories in the Windows and Linux roots that share the same name so you should be able to boot them both from the same partition without any file conflicts. After a reboot into Linux, installing Arch with pacstrap, and fucking with grub.</p>
			<center>
				<p><a href="https://www.lilysthings.org/blog/windows-on-btrfs/images/rootlinux.jpg"><img id="blog_image" src="https://www.lilysthings.org/blog/windows-on-btrfs/images/rootlinux.jpg"/></a>
				</p>
				<p><a href="https://www.lilysthings.org/blog/windows-on-btrfs/images/windowsroot.JPG"><img id="blog_image" src="https://www.lilysthings.org/blog/windows-on-btrfs/images/windowsroot.JPG"/></a>
				</p>
				<center>I see absolutely no way that this could go wrong /s</center>
			</center>
			<p>This kinda just works. The btrfs driver for Windows is incredibly solid so once you get past the bootloader there really isn&#39;t anything weird. It just does its thing. One final thought of mine is that since Quibble supports booting Windows from a btrfs subvolume if you wanted to not have to worry about splitting up your SSD for a dual boot you could have Windows and Linux on one partition on separate subvolumes. Honestly that sounds like something I might do (Assuming Windows Update doesn&#39;t break this).</p>
			<p>Anyway that&#39;s all I have this time. This was just a dumb thing I ended up doing tonight and I really needed something to write about.</p>
			<p>I don&#39;t know how to end things.</p>
			<a href="https://mastodon.lilysthings.org/@i_lost_my_bagel"><p>Follow me on Mastodon</p></a>
			<p><a href="https://www.lilysthings.org/blog/">Back</a>
		</p></div></div>
  </body>
</html>
