<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/nepx/halfix">Original</a>
    <h1>Halfix â€“ A portable x86 emulator written in C99</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">Halfix is a portable x86 emulator written in C99. It allows you to run legacy operating systems on modern platforms.</p>
<h2 dir="auto"><a id="user-content-why" aria-hidden="true" href="#why"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Why?</h2>
<p dir="auto">I made this mostly for fun, and because it was a great way to learn about the x86 PC architecture. On a more practical level, it can be used for:</p>
<ul dir="auto">
<li>Testing out or developing operating systems</li>
<li>Running old programs or operating systems that no longer work on modern computers or you wouldn&#39;t want to risk running on your personal computer.</li>
<li>Simulating other x86-based systems (the CPU component can be isolated relatively easily and used in other projects)</li>
<li>Testing web browser performance</li>
</ul>
<h2 dir="auto"><a id="user-content-building-and-running" aria-hidden="true" href="#building-and-running"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building and Running</h2>
<p dir="auto">You will need <code>node.js</code>, a C99-compatible compiler, <code>zlib</code>, and Emscripten (only if you&#39;re targeting the browser). Make sure that the required libraries are in a place where the compiler can find them. No pre-build configuration is required.</p>
<p dir="auto">The display driver uses <code>libsdl</code>, but if you&#39;re on Windows, there&#39;s a native port that uses the Win32 API and doesn&#39;t require SDL.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Debug, native
node makefile.js
# Debug, Emscripten, asm.js
node makefile.js emscripten
# Debug, Emscripten, WebAssembly
node makefile.js emscripten --enable-wasm

# Release, native
node makefile.js release
# Release, Emscripten, asm.js
node makefile.js emscripten release
# Release, Emscripten, WebAssembly
node makefile.js emscripten --enable-wasm release

# Win32 API build (no SDL required)
node makefile.js win32
# Win32 API build, release
node makefile.js win32 release

# For more options and fine tuning
node makefile.js --help

# Chunk an image 
node tools/imgsplit.js os.img

# Run in browser
http-server"><pre><span><span>#</span> Debug, native</span>
node makefile.js
<span><span>#</span> Debug, Emscripten, asm.js</span>
node makefile.js emscripten
<span><span>#</span> Debug, Emscripten, WebAssembly</span>
node makefile.js emscripten --enable-wasm

<span><span>#</span> Release, native</span>
node makefile.js release
<span><span>#</span> Release, Emscripten, asm.js</span>
node makefile.js emscripten release
<span><span>#</span> Release, Emscripten, WebAssembly</span>
node makefile.js emscripten --enable-wasm release

<span><span>#</span> Win32 API build (no SDL required)</span>
node makefile.js win32
<span><span>#</span> Win32 API build, release</span>
node makefile.js win32 release

<span><span>#</span> For more options and fine tuning</span>
node makefile.js --help

<span><span>#</span> Chunk an image </span>
node tools/imgsplit.js os.img

<span><span>#</span> Run in browser</span>
http-server</pre></div>
<p dir="auto">Check the <a href="https://github.com/nepx/halfix/wiki">project wiki</a> for more details.</p>
<h2 dir="auto"><a id="user-content-system-specifications" aria-hidden="true" href="#system-specifications"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>System Specifications</h2>
<ul dir="auto">
<li><a href="https://github.com/nepx/halfix/tree/master/src/cpu">CPU</a>: x86-32 (FPU, MMX, SSE, SSE2, some SSE3, PAE)</li>
<li>RAM: Configurable - anywhere from 1 MB to 3584 MB</li>
<li>Devices:
<ul dir="auto">
<li>Intel 8259 <a href="https://github.com/nepx/halfix/blob/master/src/hardware/pic.c">Programmable Interrupt Controller</a></li>
<li>Intel 8254 <a href="https://github.com/nepx/halfix/blob/master/src/hardware/pit.c">Programmable Interval Timer</a></li>
<li>Intel 8237 <a href="https://github.com/nepx/halfix/blob/master/src/hardware/dma.c">Direct Memory Access Controller</a></li>
<li>Intel 8042 <a href="https://github.com/nepx/halfix/blob/master/src/hardware/kbd.c">&#34;PS/2&#34; Controller</a> with attached keyboard and mouse</li>
<li><a href="https://github.com/nepx/halfix/blob/master/src/hardware/pci.c">i440FX chipset</a> (this doesn&#39;t work quite so well yet)
<ul dir="auto">
<li>82441FX PMC</li>
<li>82371SB ISA-to-PCI bus</li>
<li>82371SB IDE controller</li>
<li><a href="https://github.com/nepx/halfix/blob/master/src/hardware/acpi.c">ACPI</a> interface</li>
</ul>
</li>
<li>Intel 82093AA <a href="https://github.com/nepx/halfix/blob/master/src/hardware/ioapic.c">I/O APIC</a></li>
</ul>
</li>
<li>Display: Generic <a href="https://github.com/nepx/halfix/blob/master/src/hardware/vga.c">VGA graphics card</a> (ET4000-compatible) with Bochs VBE extensions, optionally PCI-enabled</li>
<li>Mass Storage:
<ul dir="auto">
<li>Generic <a href="https://github.com/nepx/halfix/blob/master/src/hardware/ide.c">IDE controller</a> (hard drive and CD-ROM)</li>
<li>Intel 82077AA <a href="https://github.com/nepx/halfix/blob/master/src/hardware/fdc.c">Floppy drive controller</a> (incomplete, but works in most cases)</li>
</ul>
</li>
<li>Dummy PC speaker (no sound)</li>
</ul>
<h2 dir="auto"><a id="user-content-compatibility" aria-hidden="true" href="#compatibility"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Compatibility</h2>
<p dir="auto">It boots a wide range of operating system software, including all versions of DOS, most versions of Windows (excluding Windows 8), newer versions of OS/2 Warp (3 and 4.5), ReactOS, some varieties of Linux (ISO Linux, Damn Small Linux, Red Star OS 2, Buildroot, Ubuntu), 9Front, NeXTSTEP, several hobby OSes, and probably more.</p>
<p dir="auto">See <a href="https://github.com/nepx/halfix/blob/master/compatibility.md">Compatibility</a> for more details.</p>
<h2 dir="auto"><a id="user-content-self-virtualization" aria-hidden="true" href="#self-virtualization"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Self-Virtualization</h2>
<p dir="auto">Can you run the emulator inside the emulator?</p>
<p dir="auto">Yes, but not very quickly.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nepx/halfix/blob/master/docs/pics/halfix-in-halfix.png"><img src="https://github.com/nepx/halfix/raw/master/docs/pics/halfix-in-halfix.png" alt="Halfix in Halfix"/></a></p>
<h2 dir="auto"><a id="user-content-screenshots" aria-hidden="true" href="#screenshots"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Screenshots</h2>
<p dir="auto">MS-DOS</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nepx/halfix/blob/master/docs/pics/dos.png"><img src="https://github.com/nepx/halfix/raw/master/docs/pics/dos.png" alt="DOS"/></a></p>
<p dir="auto">OS/2 Warp 4.5</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nepx/halfix/blob/master/docs/pics/os2-warp4.png"><img src="https://github.com/nepx/halfix/raw/master/docs/pics/os2-warp4.png" alt="OS/2 Warp"/></a></p>
<p dir="auto">Windows Vista</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nepx/halfix/blob/master/docs/pics/vista.png"><img src="https://github.com/nepx/halfix/raw/master/docs/pics/vista.png" alt="Vista"/></a></p>
<p dir="auto">Windows 7</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nepx/halfix/blob/master/docs/pics/win7.png"><img src="https://github.com/nepx/halfix/raw/master/docs/pics/win7.png" alt="Windows 7"/></a></p>
<p dir="auto">The same Windows 98 disk image as in the <a href="https://github.com/nepx/halfix/blob/master/docs/pics/halfix-in-halfix.png">Halfix in Halfix screenshot</a> running in Firefox</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nepx/halfix/blob/master/docs/pics/win98.png"><img src="https://github.com/nepx/halfix/raw/master/docs/pics/win98.png" alt="Win98"/></a></p>
<p dir="auto">CPU-Z on Windows XP</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nepx/halfix/blob/master/docs/pics/cpu-z.png"><img src="https://github.com/nepx/halfix/raw/master/docs/pics/cpu-z.png" alt="CPU-Z"/></a></p>
<p dir="auto">Windows 10</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nepx/halfix/blob/master/docs/pics/win10.png"><img src="https://github.com/nepx/halfix/raw/master/docs/pics/win10.png" alt="Win10"/></a></p>
<p dir="auto">Ubuntu</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nepx/halfix/blob/master/docs/pics/ubuntu.png"><img src="https://github.com/nepx/halfix/raw/master/docs/pics/ubuntu.png" alt="Ubuntu"/></a></p>
<h2 dir="auto"><a id="user-content-transferring-files" aria-hidden="true" href="#transferring-files"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Transferring Files</h2>
<p dir="auto">Create a directory with all the files you want to transfer and create an ISO image.</p>
<div data-snippet-clipboard-copy-content="mkisofs -o programs.iso -max-iso9660-filenames -iso-level 4 programs/"><pre><code>mkisofs -o programs.iso -max-iso9660-filenames -iso-level 4 programs/
</code></pre></div>
<p dir="auto">Now update the configuration file as follows:</p>
<div data-snippet-clipboard-copy-content="# Note: it does not hae to be ata0-slave. 
# I have not tested it with anything but ata0-slave.
[ata0-slave]
inserted=1
type=cd
file=/tmp/programs.iso
driver=sync"><pre><code># Note: it does not hae to be ata0-slave. 
# I have not tested it with anything but ata0-slave.
[ata0-slave]
inserted=1
type=cd
file=/tmp/programs.iso
driver=sync
</code></pre></div>
<p dir="auto">Now boot up your operating system and copy the files from the CD-ROM to the hard drive.</p>
<h2 dir="auto"><a id="user-content-known-issues" aria-hidden="true" href="#known-issues"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Known Issues</h2>
<ul dir="auto">
<li>SSE3 is not fully supported</li>
<li>Performance isn&#39;t terrible, but it isn&#39;t fantastic either (70-100 MIPS native, 10-30 MIPS browser)</li>
<li>Timing is completely off</li>
<li>Windows 8 doesn&#39;t boot (see <a href="https://github.com/nepx/halfix/issues/1" data-hovercard-type="issue" data-hovercard-url="/nepx/halfix/issues/1/hovercard">this issue</a>)</li>
<li>FPU exceptions are probably very incorrect</li>
<li>Most devices aren&#39;t complete, but enough is implemented to boot modern OSes.</li>
<li>The configuration file parser isn&#39;t very good</li>
</ul>
<h2 dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>License</h2>
<p dir="auto">GNU General Public License version 3</p>
<h2 dir="auto"><a id="user-content-similar-projects" aria-hidden="true" href="#similar-projects"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Similar Projects</h2>
<ul dir="auto">
<li><a href="https://www.github.com/copy/v86">v86</a></li>
<li><a href="http://bellard.org/jslinux/" rel="nofollow">JSLinux</a></li>
<li><a href="http://www.github.com/asmblah/jemul8">jemul8</a></li>
</ul>
<h2 dir="auto"><a id="user-content-credits" aria-hidden="true" href="#credits"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Credits</h2>
<p dir="auto">The FPU emulator uses an modified version of <a href="https://github.com/nepx/halfix/blob/master/jhauser.us/arithmetic/SoftFloat.html">Berkeley SoftFloat</a> from the <a href="https://github.com/nepx/halfix/blob/master/bochs.sourceforge.net">Bochs</a> emulator.</p>
</article>
          </div></div>
  </body>
</html>
