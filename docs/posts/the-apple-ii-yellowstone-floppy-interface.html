<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nicole.express/2022/my-yellowstone-vacation.html">Original</a>
    <h1>The Apple II Yellowstone Floppy Interface</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>When I got my <a href="https://nicole.express/2017/nicole-buys-stuff-apple-ii-plus.html">Apple ][<sub>plus</sub></a> back in 2017, it came with two all-important cards: the Microsoft 64kiB expansion card, and an Apple 5.25” Floppy Interface card. Since then, we’ve added some more: the Microsoft <a href="https://nicole.express/2020/nicole-gets-a-real-computer.html">Z80 SoftCard</a> and a <a href="https://nicole.express/2021/stop-mocking-me.html">Mockingboard</a> sound card. And now I replace one of the original cards. The Apple’s floppy disk controller is a feat of engineering history: why would I replace it? Let’s find out!</p>

<h2 id="the-disk-">The Disk ][</h2>

<p><img src="https://nicole.express/assets/img/yellow/logo-ii.JPEG" title="If that badge wasn&#39;t peeling up slightly, this would be a cool shot" alt="The Apple II logo"/></p>

<p>The Apple ][ is the master work of engineer Steve Wozniak. But just as important as the Apple ][ was its disk drive system: the Disk ][. The genius of the Disk ][ comes from its decision to break with industry standards. At the time, most floppy disk drives were their own computer, and communicated with the PC over a standard bus like the parallel IEEE-488. But Wozniak reasoned that the Apple ][ had a perfectly good CPU right there, and if it controlled the floppy drive directly, it wouldn’t need to transfer the data over at all.</p>

<p>The resulting Disk ][ was renowned for its affordability, engineering simplicity, and its performance. When Commodore’s low-cost VIC-20 came out with the slow bit-banged serial 1540 floppy drive, Wozniak’s decision was even more validated. And pretty much all 5.25” controllers for the Apple ][ followed Woz’s model.</p>

<p><img src="https://nicole.express/assets/img/yellow/control.JPEG" title="asserting direct control" alt="The Apple 5.25 Drive Controller Card, two rows of small black ICs and a rainbow cable"/></p>

<p>This is an Apple 5.25” Drive Controller Card. Despite the 1986-7 copyright silkscreen, it’s almost exactly like the 1978 copyright Disk ][ Interface Card, featuring just one notable difference: the use of a single DB-19 port rather than dual 20-pin connectors. (Apple even had a <a href="https://archive.org/details/Disk_II-Connect_it_to_a_Unidisk/mode/1up">tech info</a> document noting that the older drives could easily be modified to support the new style port) And this card still supports two drives, just via daisy-chaining instead. It’s still just a few PROMs containing a small program to read and boot sector 0 of a disk, and some discrete logic to control the drive directly, using the computer’s 12V to power the drive motors.</p>

<p><img src="https://nicole.express/assets/img/yellow/drive.JPEG" title="The drive says 2 on it, but it&#39;s actually Drive 1, because this blog is all lies" alt="An Apple II disk drive on top of the computer"/></p>

<p>The Apple ][ drive story is often written to end there. You can get a long way with just a Disk ][, almost all commercial Apple 8-bit software was on 5.25” disks, so even a modern drive emulator like the <a href="https://bigmessowires.com/floppy-emu">Floppy Emu</a> can go a long way hooked up to a card like this.</p>

<p>But what if I told you, that wasn’t actually the end of the story?</p>

<h3 id="35-and-beyond">3.5” and beyond</h3>

<p>The Disk ][ was a masterwork. But there was a problem: the Apple had a slow 1.0MHz CPU, with a variable clock due to the video circuit (also a masterwork of engineering limitations made by Steve Wozniak). This was fine to control the 5.25” floppy, but what about faster drives with higher storage capacity? Say, the 3.5” disk Apple themselves were popularizing with the Macintosh?</p>

<p>Apple’s solution to <em>that</em> was the UniDisk 3.5”. Which I don’t have, so enjoy this highly-dithered picture from the <a href="https://archive.org/details/Apple_II_UniDisk_3.5_Owners_Manual_1984_Apple/mode/2up">Owner’s Manual</a>. Well, the dithering might be from the scanner.</p>

<p><img src="https://nicole.express/assets/img/yellow/wellow.png" title="The dithering is aesthetic though" alt="A picture of the Apple II UniDisk 3.5"/></p>

<p>The UniDisk 3.5” didn’t follow the Disk ][ model. No longer did the Apple’s 6502 CPU run the show– instead, it sent commands to an intelligent computer on the drive. That’s right– just like the Commodore, Atari, and most other 8-bit PC drives. Apple’s term for this was “SmartPort”.</p>



<p>SmartPort had the benefit that it could control more types of disk drives, not only faster disk drives but also hard drives, without having to know the details. The downside was… it was slow. Not as slow as a Commodore 1541, which had its own problems, but slower than direct CPU control on a faster CPU could do. And that’s why the Macintosh used the Disk ][ approach (using an “Integrated Woz Machine” circuit, essentially a Disk ][ interface on a chip) throughout its entire life as a floppy-based machine, though it also had SmartPort support. The Apple IIgs and Apple IIc Plus also used faster directly-controlled 3.5” drives, the IIgs with its faster 65C816 and the IIc Plus.</p>



<figure><img src="https://nicole.express/assets/img/yellow/apply.jpg" title="65C02? This thing might be more advanced than my poor II plus" alt="The 3.5 Floppy Controller Card. Note the onbopard 65C02 CPU"/>

<figcaption>Image from <a href="https://commons.wikimedia.org/wiki/File:The_stylish_duo_(cropped).jpg">Wikimedia Commons</a>, taken by Blake Patterson. Used under the <a href="https://creativecommons.org/licenses/by/2.0/deed.en">Creative Commons Attribution 2.0 Generic</a> license.</figcaption></figure>

<p>The SmartPort experiment came to an end in 1993, when the Apple 3.5” Disk Controller Card was released; essentially, the drive controller from the UniDisk, complete with its own 65C02 CPU, to allow people to use a 3.5” floppy drive on the Apple II without requiring the extra hardware in a UniDisk 3.5” drive. It wasn’t long-lived; the Apple IIe, the last computer that had both a reason to use it and slots to put the card in, was discontinued the same year.</p>



<p>Okay, that’s enough background, and definitely enough asides. Let’s jump back to 2022.</p>

<h2 id="just-get-to-the-point">Just get to the point</h2>

<p>I got a bit carried away with all that. Who knew floppy controllers could be so interesting? Well, one person who might is Steve from <a href="https://www.bigmessowires.com/">Big Mess O’ Wires</a>. That’s right, this is actually a look at a product being sold at the time of this writing, the <a href="https://www.bigmessowires.com/yellowstone/">Yellowstone controller card</a>:</p>

<p><img src="https://nicole.express/assets/img/yellow/stone.JPEG" title="Blue PCBs look smart" alt="An apple II interface card in blue"/></p>

<p><em>This post was not sponsored. All items were paid for in full without any communication with Big Mess O’ Wires about this card, and all opinions are my own.</em></p>

<p>The Yellowstone’s development is aggressively detailed in Steve’s <a href="https://www.bigmessowires.com/2018/01/31/yellowstone-cloning-the-apple-ii-liron/">blog</a>, and I recommend reading literally everything in the Yellowstone category, it’s all a good read. The Yellowstone is an improved and expanded clone of the Laser Universal Disk Controller, so it supports not only SmartPort, but pretty much every drive. It’s powered by a Lattice FPGA. In fact, according to BMOW’s posts, most of the chips only serve to translate between the Apple II’s 5V logic and the FPGA’s 3.3V.</p>

<p><img src="https://nicole.express/assets/img/yellow/fpga.JPEG" title="the advent of affordable FPGAs has been a wonder for the retro community" alt="A Lattice FPGA, the above board zoomed in"/></p>

<p>Along with the card, I got some adapters. The 20-pin connector on the Yellowstone card is identical to the original Disk ][ (with the benefit of being boxed in and keyed, so it can’t be inserted wrong as was a constant problem with the original), but my Apple and clone devices use <a href="https://www.bigmessowires.com/2016/06/04/db-19-resurrecting-an-obsolete-connector/">DB-19</a> pins. This is actually a pretty hard part to find these days, as 19-pin isn’t part of the standard.</p>

<p><img src="https://nicole.express/assets/img/yellow/adapter.JPEG" title="adapt. improvise. overcome." alt="An adapter from 19-pin DB shell to 20-pin"/></p>



<p>I’m a bit curious about using this on my particular Apple. See, much of the enthusiast Apple II software these days is coded for the 128kiB “Enhanced” Apple IIe, which had become the standard configuration by around 1985 or so. That means:</p>

<ul>
  <li>Double the RAM at 128kiB</li>
  <li>Double-high resolution graphics modes (and double-lores, if you’re into that)</li>
  <li>80-columns text mode</li>
  <li>The updated CMOS 65C02 rather than the NMOS 6502</li>
  <li>Lowercase letters (unimaginable luxury!)</li>
</ul>

<p>For me on my lowly 1979-spec ][<sub><i>plus</i></sub>, a lot of Apple II software boots right up to a disappointing screen like this:</p>

<p><img src="https://nicole.express/assets/img/yellow/noiie.png" title="by 1993, the nmos apple ii wasn&#39;t even worth worrying about getting error messages right" alt="A heavily garbled screen noting REQUIRES ENHANCED APPLE IIE OR LATER"/></p>

<p>The Yellowstone promises support for my model, though, so let’s give it a whirl!</p>



<h3 id="standard-disks">Standard disks</h3>

<p>The first NMOS hiccup comes when I boot the Apple II using the Yellowstone in place of my 5.25” controller card, with the standard 5.25” drive attached.</p>

<p><img src="https://nicole.express/assets/img/yellow/prompt.jpg" title="me, gushing to my friend &#39;isn&#39;t the apple ii prompt so beautiful???&#39; and this is why i have no friends" alt="The text APPLE ][, with a prompt below"/></p>

<p>This is the standard Applesoft BASIC prompt. But along with Applesoft, the Apple ][<sub><i>plus</i></sub> is supposed to feature the “Autostart” ROM. If a disk controller card is present, it will try to boot from the disk, and only drops to BASIC as a last resort. Unfortunately, the early logic here can’t detect the Yellowstone as a disk controller; I’m told this feature <em>does</em> work fine on the Enhanced Apple IIe.</p>

<p>The board does feature a compatibility mode, controlled by a dip switch or a keyboard combination, which should be detectable by the Autostart ROM. But at that point, it disables all the other features of the card and doesn’t actually do anything that my older card can’t do. It’s necessary to support some particularly tricky disks, though.</p>

<p>That being said, autostart is just a convenience feature, and wasn’t even available on the original Integer BASIC ROMs. We can activate the card with the BASIC command <code>PR#6</code>
; the 6 is the slot in which we installed the card. In fact, surprise! The shot of the garbled ProDOS error screen above was taken with this very card. Then I went and played the Sierra game <em>Mission: Asteroid</em>, which worked fine.</p>

<p><img src="https://nicole.express/assets/img/yellow/mission.jpg" title="slight step down in graphics quality from the cave post" alt="A secretary sits at a desk. The game is a text adventure with a prompt at the bottom of the screen."/></p>

<p>So, as a 5.25” drive card, the Yellowstone so far ranks as slightly less convenient than the Apple 5.25” Drive Controller Card, but both work. But that’s not what I got this for.</p>

<h3 id="smartport-hard-drive">Smartport Hard Drive</h3>

<p>It may seem laughable today, but using a hard drive on the 8-bit Apple II was not very common; hard drives were very expensive and failure prone, and most software was based around disks as a result. This is a big reason why multiple disk drive support, either using the DuoDisk or daisy chaining, was so important– one disk would be taken up by your software and another one to save your data. Even multi-disk games like Sierra’s six-disk <a href="https://en.wikipedia.org/wiki/Time_Zone_(video_game)"><em>Time Zone</em></a> expected users to constantly switch between them while playing.</p>

<p>But in 2022, we want hard drives, and we want more space. This is in fact the biggest reason I wanted the Yellowstone: combined with the Floppy Emu I already have, it could act as a Smartport controller. 3.5” drive support is nice too, but use of those is super-rare in original Apple II or II<sub><i>plus</i></sub> world anyways.</p>

<p>In 2019, Apple II hacker idol 4am released a hard drive image worth craving; <a href="https://archive.org/details/TotalReplay">Total Replay</a>, a 32MiB ProDOS image designed specifically focusing on the 8-bit Apple ][, which combines hundreds of games, integrated menus, a screensaver mode, and many other features. And it includes support for 64kiB NMOS Apple IIs like mine; I really want to try it out. Now I can!</p>

<p>Booting as a Smartport device on the Floppy Emu is a little less intuitive than booting a disk. If you select Smartport mode, you won’t get a file browser; you’ll need to make sure your disk image is named something like “smart0.po” (the number can increase to allow switching between up to 4 images) in the root directory of your microSD card. But with that all set, it’s <code>PR#6</code> time!</p>

<p><img src="https://nicole.express/assets/img/yellow/totalslow.jpg" title="totally" alt="TOTAL REPLAY 64K V5.0-BETA.2 MOCKINGBOARD IN SLOT 4"/></p>

<p>Sweet, it even recognized my Mockingboard. I guess I just need to wait to let it boot up a bit?</p>

<p><img src="https://nicole.express/assets/img/yellow/totalslow.jpg" title="...totally?" alt="TOTAL REPLAY 64K V5.0-BETA.2 MOCKINGBOARD IN SLOT 4, the same image as above"/></p>

<p>Yeah, um, this isn’t proceeding. I did manage to get it to crash by jiggling cables, though. So that’s nice.</p>

<p><img src="https://nicole.express/assets/img/yellow/crash.png" title="secret unlocked: the version of total replay for toads" alt="The screen above, but covered in garbage"/></p>

<h3 id="nmos-woes-and-firmware-updates">NMOS woes and Firmware updates</h3>

<p>I bought the Yellowstone at the beginning of the month, but proceeded to do nothing with it until the end. As usual, my laziness has caused me to prosper. Because <a href="https://www.bigmessowires.com/2022/10/23/nmos-6502-phantom-reads-odd-yellowstone-bugs/">Big Mess o’ Wires</a> already found and <a href="https://www.bigmessowires.com/2022/10/25/yellowstone-firmware-221024-total-replay-and-reset/">fixed</a> the bug. It’s an interesting read, turning out to be caused by an edge case that gets hit by the seemingly minor differences between the NMOS and CMOS 6502s. With its slower timing on the <code>STA (indirect), Y</code> operation, the NMOS 6502 does a spurious read from a card address that happens to be a special control port.</p>

<p>But the part that’s relevant for the post is that it’s fixed, with a firmware update. But how do you update the firmware? I don’t see any USB port! And yet, the Apple II is still a computer, after all. The firmware update is a disk or disk image you can boot from the Yellowstone itself, that runs a program on the Apple II’s 6502 to update the firmware.</p>



<p><img src="https://nicole.express/assets/img/yellow/update1.jpg" title="kind of surprised the apple ii used such a thin font, as unlike the trs-80 it was always designed to be used on a color tv screen" alt="LOADING DATA"/></p>

<p>The loading data takes a little while. But that makes sense when you think about it; once it starts updating the firmware, it’ll lose access to the ability to load any more from disk. So I’m quite happy that this firmware and its update program are small enough to fit in the 64kiB RAM of my Apple ][.</p>

<p>Once that’s done, you just need to note the card slot where the Yellowstone is present.</p>

<p><img src="https://nicole.express/assets/img/yellow/update2.jpg" title="I guess it could try to detect, but what if you had multiple yellowstones you wanted to update in a single apple ii? probably the sort of problem only the developer of the card would have, but hey" alt="the firmware tool going through its steps"/></p>

<p>And that’s literally all that was required to boot up Total Replay and learn the screen I got stuck on was actually only supposed to be momentary. In any case, see you all, suckers, I’ve got games to play!</p>

<p><img src="https://nicole.express/assets/img/yellow/update3.jpg" title="look at those repeated dot patterns. not so artifacty NOW, are you" alt="Total Replay boot screen in monochrome"/></p>

  </div>

  
</article>

      </div>
    </div></div>
  </body>
</html>
