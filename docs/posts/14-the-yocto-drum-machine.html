<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.jacobvosmaer.nl/0014-yocto/">Original</a>
    <h1>14. The Yocto drum machine</h1>
    
    <div id="readability-page-1" class="page"><div><p><i><a href="https://blog.jacobvosmaer.nl/">Jacob Vosmaer&#39;s blog</a></i></p>

<p>2023-12-09</p>

<p>In 2016 I built a Yocto drum machine from a DIY kit for myself. This was my first electronics DIY project and it also became my first embedded development project when I wrote my <a href="https://gitlab.com/jacobvosmaer/yocto-firmware">own firmware</a> for the machine. In this post I will talk about what the Yocto is, my experiences and what I learned from working on it.</p>

<p><img src="https://blog.jacobvosmaer.nl/assets/img/yocto.jpg" alt="Yocto"/></p>

<h2>A TR-808 clone</h2>

<p>The <a href="http://www.e-licktronic.com/forum/viewforum.php?f=33">Yocto</a> is a DIY clone of the <a href="https://en.wikipedia.org/wiki/Roland_TR-808">Roland TR-808</a> made by the small company <a href="http://www.e-licktronic.com/">e-licktronic</a>. This is what the original 808 looks like:</p>

<p><img src="https://blog.jacobvosmaer.nl/assets/img/Roland_TR-808_drum_machine.jpg" alt="TR-808 image (wikipedia)" "=""/></p>

<p><i>Source: <a href="https://commons.wikimedia.org/w/index.php?curid=38020306">Wikipedia</a></i></p>

<p>The Roland TR-808 Rythm Composer was a drum machine (or &#34;drum computer&#34;) from 1980 that had evolved from earlier preset rythm machines made by Roland. These music gadgets were meant to be used by organ players to provide a drum track so that a lone organ player could act as a one-mand band. In this <a href="https://youtu.be/KOLnuS80O-U?t=59">video</a> you can see Don Lewis, who was a design consultant for the TR-808, demonstrating what that would look like.</p>

<p>The 808 was a commercial failure but it ended up becoming popular in underground music genres like hiphop. When those genres became mainstream the 808 became a sought-after instrument after all, well after it was discontinued by the manufacturer. It is a running joke in the synthesizer community that Roland refuses to put its incredibly popular old models back in production and this also applies to the 808. This is why DIY clones such as the Yocto exist.</p>

<h2>What does it mean to build a DIY kit?</h2>

<p>Most DIY projects I&#39;ve worked on as a builder consisted of the following:</p>

<ul>
<li>A set of 1 or more circuit boards that form the heart of the project</li>
<li>A &#34;Bill of Materials&#34; (BOM): a shopping list for all the parts that go on the circuit boards</li>
<li>A kit of rare parts that are hard to get by, if any</li>
<li>A build guide with instructions for assembly, calibration and testing</li>
<li>Schematics of the circuit boards</li>
<li>An online forum or discussion board where builders can ask questions and help each other</li>
<li>An enclosure for the finished project</li>
</ul>

<p>All items above except the circuit boards are optional and depend on the project. The circuit boards + bill of materials are probably the minimum.</p>

<p>To build something like this, I end up doing the following:</p>

<ol>
<li>Read through all the existing discussion on the project forum. This is a lot of work but it teaches you what to look out for, and whether people who built the kit before you are happy with it or not.</li>
<li>Hours of tedious online shopping at sites like Mouser or Digikey to buy all the parts that make up the bill of materials. Some parts will be hard to find.</li>
<li>Soldering all the parts (about 2000 in the case of the Yocto?) onto the circuit boards.</li>
<li>Find out that the thing is not working or only half-working.</li>
<li>Become an electronics repair person and fix your own build. Spend hours reading the <a href="https://blog.jacobvosmaer.nl/assets/808-svc-man.pdf">service manual</a> of the device, trying to understand how it is supposed to work.</li>
<li>Finish the build and enjoy the fruits of your labour (e.g. make music with it).</li>
</ol>

<p><b>All in all this is very time consuming and you should only do it if you enjoy the work itself.</b> If you have to pay someone else to build a DIY kit for you it is usually cheaper to build a non-DIY version of the product instead, because the amount of labour required is so high.</p>

<h2>The Yocto as a DIY electronics project</h2>

<p>I think the Yocto was a very well-supported project considering its complexity and that it appeared to have a 1-person company behind it. It was very popular at the time so there was an active community of online builders who were helping each other.</p>

<p>For me it was a great adventure because it was my first big DIY electronics project (I had done one project before it of less than 100 parts). I had very little idea what I was doing and it was very rewarding to make it through to the end. I had to fix quite a few mistakes in my build but that was also fun for me.</p>

<h2>Firmware</h2>

<p>The TR-808 used analog synthesis (12 different sounding circuits) to produce its sounds. The sounds were triggered by a microprocessor. The Yocto recreates the analog synthesis circuits but uses a modern MPU: an <a href="https://www.microchip.com/en-us/product/ATmega1284p">ATmega1284P</a>. It combines the original analog synthesis with a new digital brain.</p>

<p>The source code for the MPU of the Yocto was available on GitHub as an <a href="https://www.arduino.cc/">Arduino</a> project. Because it had some bugs, and because I am a programmer, I started tinkering with this firmware. Eventually I replaced it with <a href="https://gitlab.com/jacobvosmaer/yocto-firmware">my own</a>.</p>

<p>This was the first  I worked with the Arduino platform. Arduino is a software platform that lets you write code for microcontrollers using abstractions that decouple your code from the actual device it runs on. These abstractions were a headache for me because I had to learn both what a microcontroller is and how it works, <em>and</em> how Arduino renames and abstracts everything.</p>

<p>The source of truth for what the microcontroller can do is the <a href="https://ww1.microchip.com/downloads/aemDocuments/documents/MCU08/ProductDocuments/DataSheets/ATmega164A_PA-324A_PA-644A_PA-1284_P_Data-Sheet-40002070B.pdf">datasheet</a> provided by the manufacturer. This describes the capabilities of the hardware and how to use these capabilities in your software.
Annoyingly, Arduino renames all the terms used in the datasheet. To make things worse, real code (like that of the original Yocto firmware) mixes the names of the Arduino world and of the manufacturer.</p>

<p>It was an immense relief for me to discover <a href="https://www.nongnu.org/avr-libc/">avr-libc</a>, which is the software layer that Arduino is built on and tries to hide. The terms used by avr-libc match those of the manufacturer! As an added bonus, you can use the avr-libc toolchain from your editor of choice instead of being stuck inside the Arduino IDE.</p>

<p>Before I discovered avr-libc I even went through the trouble of creating Docker images to compile Arduino projects in CI. Because it is all supposed to be used from a graphical IDE, this was not straightforward. In contrast with avr-libc I only need to install some commonly available Debian packages and I can compile the whole thing using a Makefile.</p>

<h2>Conclusion</h2>

<p>My goal at the start of building my Yocto was to be able to use the sounds of the TR-808 in my own music. I had no idea that I would end up reading so many circuit diagrams and programming a microcontroller. It was a very positive and affirming experience to find out that I can apply my problem solving skills in a domain I know so little about (electronics) and that I could learn to write programs in a very different environment (embedded devices) from what I&#39;m used to. Finally, I have grown a lot more appreciative of open source toolchains (in this case avr-gcc) as an escape hatch from inscrutable vendor software (the Arduino ecosystem).</p>
<p>Tags:
<a href="https://blog.jacobvosmaer.nl/music.html">music</a>
<a href="https://blog.jacobvosmaer.nl/diy.html">diy</a>
</p><details><summary>Edit history</summary><table>
<tbody><tr><td>2023-12-10</td><td></td><td>Use css to set img width</td></tr>
<tr><td>2023-12-09</td><td></td><td>Add 0014 yocto</td></tr>
</tbody></table></details><p><a href="https://blog.jacobvosmaer.nl/">Back</a></p>
</div></div>
  </body>
</html>
