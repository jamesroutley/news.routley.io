<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://obrhubr.org/adsb-weather-model">Original</a>
    <h1>Weather Model based on ADS-B</h1>
    
    <div id="readability-page-1" class="page"><div>
	<p>I recently bought an <a href="https://kagi.com/search?q=rtl%20sdr">RTL-SDR</a> dongle and an antenna to receive <a href="https://en.wikipedia.org/wiki/Automatic_Dependent_Surveillance%E2%80%93Broadcast">ADS-B</a> messages. These are short packets of data, broadcast by every plane in the sky, to inform others of their position, heading, speed and other flight data. The transmission of these messages is mandatory for aircraft, as it prevents mid-air accidents.</p>

<p><img src="https://obrhubr.org/assets/adsb-weather-model/e6b2f00e433f8f4645ff81252684f7c7.webp" alt="RTL-SDR dongle and antenna for receiving ADS-B messages." srcset="/assets/adsb-weather-model/e6b2f00e433f8f4645ff81252684f7c7.webp 1613w, /assets/adsb-weather-model/e6b2f00e433f8f4645ff81252684f7c7-800.webp 800w, /assets/adsb-weather-model/e6b2f00e433f8f4645ff81252684f7c7-720.webp 720w, /assets/adsb-weather-model/e6b2f00e433f8f4645ff81252684f7c7-640.webp 640w, /assets/adsb-weather-model/e6b2f00e433f8f4645ff81252684f7c7-480.webp 480w, /assets/adsb-weather-model/e6b2f00e433f8f4645ff81252684f7c7-320.webp 320w" sizes="(max-width: 800px) 100vw, (min-width: 801px) 800px" width="1613" height="1210"/></p>

<p>They are also unencrypted, which means anyone can listen to them. All you need is an antenna and a dongle to ingest the data on your PC (pictured above), which can be bought for less than 100$. The incoming data can then be processed by software like <a href="https://github.com/wiedehopf/readsb">readsb</a> which decodes the messages.</p>

<p>You can choose to broadcast your own data to central servers like the <a href="https://globe.adsbexchange.com/">ADS-B Exchange</a>, like many hobbyists do. Thanks to them, we can visualise just about every aircraft currently in the sky. They also provide access to historic data.</p>

<p><img src="https://obrhubr.org/assets/adsb-weather-model/e022c10e7061ed48c64ffe8ce56ee1e8.webp" alt="Screenshot from the ADS-B Exchange showing airborne planes on the US east coast." srcset="/assets/adsb-weather-model/e022c10e7061ed48c64ffe8ce56ee1e8.webp 970w, /assets/adsb-weather-model/e022c10e7061ed48c64ffe8ce56ee1e8-800.webp 800w, /assets/adsb-weather-model/e022c10e7061ed48c64ffe8ce56ee1e8-720.webp 720w, /assets/adsb-weather-model/e022c10e7061ed48c64ffe8ce56ee1e8-640.webp 640w, /assets/adsb-weather-model/e022c10e7061ed48c64ffe8ce56ee1e8-480.webp 480w, /assets/adsb-weather-model/e022c10e7061ed48c64ffe8ce56ee1e8-320.webp 320w" sizes="(max-width: 800px) 100vw, (min-width: 801px) 800px" width="970" height="903"/></p>

<p>One way these massive amounts of data can be used is to make cool visualisation, like <a href="https://github.com/ClickHouse/adsb.exposed">Clickhouse did</a>. We’re going to do something a bit different.</p>

<h2 id="how-does-ads-b-work">How does ADS-B Work</h2>

<p>ADS-B messages are (usually) <a href="https://aviation.stackexchange.com/questions/89700/whats-the-relation-between-ads-b-and-mode-s">transmitted by a mode S transponder</a> on the frequency 1090 MHz. Pulse position modulation is used to encode these messages as they transmit digital data (If you want to read about analog signal transmission, you can read my recent post on <a href="https://obrhubr.org/fm-radio">FM radio</a>).</p>

<p>The excellent book <a href="https://mode-s.org/1090mhz/">“The 1090 Megahertz Riddle”</a> by <a href="https://junzis.com/">Junzi Sun</a> goes into a lot of detail about ADS-B and how it works.</p>

<h2 id="collecting-data">Collecting Data</h2>

<p>By aggregating and processing the messages about position and heading, we can build a very crude meteorological model! All the work in this blog post is based on this <a href="https://journals.plos.org/plosone/article/file?id=10.1371%2Fjournal.pone.0205029&amp;type=printable">paper</a> (code available at <a href="https://github.com/junzis/meteo-particle-model">github.com/junzis/meteo-particle-model</a>).</p>

<p>ADS-B messages contain information about both ground speed (measured using a GPS) and airspeed (which is the plane’s speed relative to the surrounding air, measured by on-board sensors).</p>

<p><img src="https://obrhubr.org/assets/adsb-weather-model/a5e4dc769821c50e7e8d41397f1ac318.webp" alt="Diagram showing how the wind speed and angle can be calculated from the air speed, ground speed, heading and track." srcset="/assets/adsb-weather-model/a5e4dc769821c50e7e8d41397f1ac318.webp 912w, /assets/adsb-weather-model/a5e4dc769821c50e7e8d41397f1ac318-800.webp 800w, /assets/adsb-weather-model/a5e4dc769821c50e7e8d41397f1ac318-720.webp 720w, /assets/adsb-weather-model/a5e4dc769821c50e7e8d41397f1ac318-640.webp 640w, /assets/adsb-weather-model/a5e4dc769821c50e7e8d41397f1ac318-480.webp 480w, /assets/adsb-weather-model/a5e4dc769821c50e7e8d41397f1ac318-320.webp 320w" sizes="(max-width: 800px) 100vw, (min-width: 801px) 800px" width="912" height="602"/></p>

<p>The ADS-B messages also contain the current heading and the track angle of the plane. The heading of the plane is direction the nose points in, while the track is the direction it moves in. These can diverge due to the wind shifting the plane from it’s actual course.</p>

<p>The difference between the vectors formed by (air speed, heading) and (ground speed, track) is the wind vector. By calculating this difference, we can infer wind speed at every point.</p>

<p>By combining this data from thousands of aircraft all over the sky we can build a little wind model that quite accurately simulates real wind conditions.</p>

<p>The paper by Junzi Sun also describes how to extract temperature and pressure from the data sent by the aircraft. By combining this with traditional meteorological models, <a href="https://www.flightradar24.com/blog/b2b/flightradar24-and-met-office/">weather agencies can improve their forecasts</a>.</p>

<h2 id="building-a-model">Building a Model</h2>

<p>In order to test out the model, I first had to gather some data. After a quite measly run using my own antenna, I switched to <a href="https://www.adsbexchange.com/products/historical-data/">ADS-B Exchange’s historical data</a>. I pulled a total of 1.84 GB covering the 30th of April 2024.</p>

<p>Again, all credit goes to the authors of the paper, I only wrote some plumbing code to wrangle the data into a usable format and added some features to the visualisation for this blog post.</p>

<p>The model places the aircraft on a big grid. For each one, it spawns 300 particles scatter around it, which are initialised with the wind vector calculated for the aircraft. At each step, the particles are updated by a random walk.</p>

<p><img src="https://obrhubr.org/assets/adsb-weather-model/a5e0d93e17b4acdf36abe84083aceb8f.webp" alt="Annotated diagram from Junzi Sun’s paper showing the particles spawned in and subsequent sampling." srcset="/assets/adsb-weather-model/a5e0d93e17b4acdf36abe84083aceb8f.webp 1229w, /assets/adsb-weather-model/a5e0d93e17b4acdf36abe84083aceb8f-800.webp 800w, /assets/adsb-weather-model/a5e0d93e17b4acdf36abe84083aceb8f-720.webp 720w, /assets/adsb-weather-model/a5e0d93e17b4acdf36abe84083aceb8f-640.webp 640w, /assets/adsb-weather-model/a5e0d93e17b4acdf36abe84083aceb8f-480.webp 480w, /assets/adsb-weather-model/a5e0d93e17b4acdf36abe84083aceb8f-320.webp 320w" sizes="(max-width: 800px) 100vw, (min-width: 801px) 800px" width="1229" height="845"/></p>

<p>To visualise the wind vectors, we need to measure the speed for each square of the map’s grid. To do this, we sample the particles for each square and take their average velocity vector. The more particles in a square, the higher the accuracy.</p>

<p>After letting the model run for a while, I got the following GIF - notice the outline of Europe in the background.</p>

<p><img src="https://obrhubr.org/assets/adsb-weather-model/d38df532c7598f2589001c686b2c6742.gif" alt="GIF showing the wind over Europe over the span of about 5 hours."/></p>

<p>Each frame contains data from about 650 aircraft. The step size of the simulation was set to 15 minutes - which is quite a lot. The density plot visualises the accuracy - more aircraft, higher accuracy. As this is during the night, there is less activity, which results in less data for the model.</p>

<h2 id="how-accurate-is-the-model">How Accurate is the Model?</h2>

<p>While the wind vectors certainly do look interesting and somewhat realistic, are they really accurate? To compare the output of the simulation with real wind conditions, I found <a href="https://nullschool.net/">Cameron Beccario</a>’s earth-wide wind visualisation.</p>

<p><img src="https://obrhubr.org/assets/adsb-weather-model/176acdba386f449c4e6f9b31f35fd2c7.webp" alt="Comparison between my model and " srcset="/assets/adsb-weather-model/176acdba386f449c4e6f9b31f35fd2c7.webp 1470w, /assets/adsb-weather-model/176acdba386f449c4e6f9b31f35fd2c7-800.webp 800w, /assets/adsb-weather-model/176acdba386f449c4e6f9b31f35fd2c7-720.webp 720w, /assets/adsb-weather-model/176acdba386f449c4e6f9b31f35fd2c7-640.webp 640w, /assets/adsb-weather-model/176acdba386f449c4e6f9b31f35fd2c7-480.webp 480w, /assets/adsb-weather-model/176acdba386f449c4e6f9b31f35fd2c7-320.webp 320w" sizes="(max-width: 800px) 100vw, (min-width: 801px) 800px" width="1470" height="698"/></p>

<p>Comparison between my model and <a href="https://earth.nullschool.net/#2024/04/30/1500Z/wind/isobaric/250hPa/orthographic=-346.96,47.37,1791/loc=6.666,30.896">the reference model</a> powered by GFS.</p>

<p>The comparison is not exact, but it’s pretty close. I tried to match up the same countries in both images and the height of the aircraft in my model is about 11km while the data on the right is for 250 hPa (<a href="https://earth.nullschool.net/about.html">nullschool.net</a> says 250 hPa corresponds to about 10,500m).</p>

<p>You can recognise the same high-speed winds over the Mediterranean (from Greece to Turkey), where the speed even matches up quite closely - our model predicting 50 m/s and the reference showing 152 km/h.</p>

<p>I’d say that’s a success!</p>

<p>I tried my best to replicate the style of the reference model to make a final visualisation.</p>

<p><img src="https://obrhubr.org/assets/adsb-weather-model/8d14febeec1386cffa94602688a18a2b.gif" alt="My data visualised in the style of "/></p>

<p>My data visualised in the style of <a href="http://earth.nullschool.net/">earth.nullschool.net</a>.</p>

</div></div>
  </body>
</html>
