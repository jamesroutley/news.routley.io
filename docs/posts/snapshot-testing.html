<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://avi.im/blag/2024/snapshot-testing/">Original</a>
    <h1>Snapshot Testing</h1>
    
    <div id="readability-page-1" class="page"><div><article><p>Snapshot testing makes it easy to compare large outputs from a function. Instead of asserting against the raw output directly:</p><div><pre tabindex="0"><code data-lang="rust"><span><span>assert_eq!(my_really_large_6mb_string, my_func());
</span></span></code></pre></div><p>you save the expected output in a file and compare against that. But manually saving, loading, and comparing snapshot files is a lot of work! Snapshot testing frameworks make this process easy. In Rust, I have used <a href="https://crates.io/crates/insta">insta</a>:</p><div><pre tabindex="0"><code data-lang="rust"><span><span>assert_debug_snapshot!(my_func());
</span></span></code></pre></div><p>I don’t need to explicitly save or load snapshot files. The framework handles it automatically!</p><p>The workflow is:</p><ol><li>Write a test and include the assert macro.</li><li>Since this is the first run, there is no snapshot file yet. The framework generates one.</li><li>[Optional] Modify the snapshot file as needed.</li><li>Run the tests again - now the framework will compare against the saved snapshot and the test will pass.</li><li>If there is a regression or intentional change to the output, running the tests will generate a new snapshot file. The old one is preserved so you can review the change.</li></ol><p>Here is a small gif from <a href="https://insta.rs/docs/quickstart/">insta’s doc</a> showing the interactive review:</p><p><img src="https://github.com/avinassh/blag/assets/640792/32ebfd08-9b79-4fcd-a320-268e591388d1" alt="insta review"/></p><p>You may check my <a href="https://github.com/tursodatabase/libsql/pull/1117">pull request</a> on libsql-server which adds a bunch of snapshot tests.</p><p>Jane Street has a nice blog post on the same - <a href="https://blog.janestreet.com/the-joy-of-expect-tests/">What if writing tests was a joyful experience?</a>.</p></article></div></div>
  </body>
</html>
