<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/darwindarak/rallyup">Original</a>
    <h1>Show HN: rallyup â€“ Lightweight Wake-on-LAN Scheduler</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><code>rallyup</code> is a lightweight Wake-On-LAN (WOL) scheduler and dependency manager designed for small businesses and homelabs. It ensures that infrastructure services like firewalls, storage, and hypervisors are brought online in the correct order, particularly after events like power outages.</p>
<p dir="auto">A typical setup involves configuring most of the infrastructure for WOL but not for Wake-On-Power, and setting <code>rallyup</code> to run on startup on a low-power device like a Raspberry Pi. When you need to bring the entire environment online, simply power on the device running <code>rallyup</code>, and the rest of the infrastructure will automatically follow in the correct order.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/darwindarak/rallyup/actions/workflows/tests.yml/badge.svg"><img src="https://github.com/darwindarak/rallyup/actions/workflows/tests.yml/badge.svg" alt="Tests"/></a>
<a href="https://crates.io/crates/rallyup" rel="nofollow"><img src="https://camo.githubusercontent.com/d06930b3b5f4b41abbd2ec7ab3bc8e39ba0efc33a314dd6961304cfc0d37d75c/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f72616c6c7975702e737667" alt="Crates.io" data-canonical-src="https://img.shields.io/crates/v/rallyup.svg"/></a></p>

<ul>
<li> <em>VLAN Support</em>: Send WOL packets to devices across different VLANs.</li>
<li> <em>YAML Configuration</em>: Easily define server boot sequences, dependencies, and status checks.</li>
<li> <em>Service Status Checks</em>: Verify that a service is up using built-in status checks (HTTP health checks, NFS, SMB, custom shell commands).
<ul>
<li> HTTP</li>
<li> Open port</li>
<li> Shell</li>
<li> NFS (might just use open port check)</li>
<li> SMB (might just use open port check)</li>
</ul>
</li>
<li> <em>Plugin-Friendly</em>: Users can write their own custom status check plugins.</li>
</ul>



<p dir="auto">The dependencies between servers, along with the methods for validating that they are online, are defined in a YAML configuration file.</p>

<p dir="auto"><strong>Fields</strong>:</p>
<ul dir="auto">
<li><strong>name</strong>: The name of the server, used for identification when defining dependencies between servers</li>
<li><strong>mac</strong>: The MAC address of the server we want to wake up</li>
<li><strong>interface</strong>: The network interface to use when sending the WOL packet</li>
<li><strong>vlan</strong>: The VLAN ID (optional) that the server is on</li>
<li><strong>depends</strong>: A list of other server names that this server depends on</li>
<li><strong>check</strong>: A list of health checks that must pass before this server is considered fully online</li>
</ul>
<p dir="auto"><strong>Example</strong>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="- name: &#34;firewall&#34;
  mac: &#34;00:11:22:33:44:55&#34;
  interface: &#34;eth0&#34;
  vlan: 100
  depends:
    - &#34;storage&#34;
  check: [... see below]"><pre>- <span>name</span>: <span><span>&#34;</span>firewall<span>&#34;</span></span>
  <span>mac</span>: <span><span>&#34;</span>00:11:22:33:44:55<span>&#34;</span></span>
  <span>interface</span>: <span><span>&#34;</span>eth0<span>&#34;</span></span>
  <span>vlan</span>: <span>100</span>
  <span>depends</span>:
    - <span><span>&#34;</span>storage<span>&#34;</span></span>
  <span>check</span>: <span>[... see below]</span></pre></div>
<ul dir="auto">
<li></li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">Health Check Configurations</h2><a id="user-content-health-check-configurations" aria-label="Permalink: Health Check Configurations" href="#health-check-configurations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Each server can have multiple health checks to ensure the server is fully online before the next device starts up.</p>

<ul dir="auto">
<li><strong>retry</strong>: The interval, defined in human readable string (e.g. 1s, 1 minute, etc.) to wait between retrying this health check</li>
<li><strong>timeout</strong>: The timeout interval after which the check, and subsequently the entire boot sequence, will fail</li>
</ul>


<p dir="auto">The HTTP health check verifies whether a specified endpoint responds as expected.</p>
<p dir="auto"><strong>Fields</strong></p>
<ul dir="auto">
<li><strong>type</strong>: should be <code>http</code> for an HTTP health check.</li>
<li><strong>url</strong>:  The URL to perform the HTTP health check against</li>
<li><strong>status</strong>: Expected HTTP status code</li>
<li><strong>regex</strong>: Regex to match in the response body</li>
</ul>
<blockquote>
<p dir="auto">Note: You must provide either <code>status</code> or <code>regex</code>, or both.</p>
</blockquote>
<p dir="auto"><strong>Example</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="- type: http
  url: &#34;http://192.168.1.1/health&#34;
  status: 200
  retry: 5s
  timeout: 30s"><pre>- <span>type</span>: <span>http</span>
  <span>url</span>: <span><span>&#34;</span>http://192.168.1.1/health<span>&#34;</span></span>
  <span>status</span>: <span>200</span>
  <span>retry</span>: <span>5s</span>
  <span>timeout</span>: <span>30s</span></pre></div>

<p dir="auto">The port health check verifies whether a specified TCP port on a server is open and accessible.
This is really a stand-in for verifying NFS and SMB ports until I can figure out how to check if those services are online.</p>
<p dir="auto"><strong>Fields</strong></p>
<ul dir="auto">
<li><strong>type</strong>: should be <code>port</code> for a port health check</li>
<li><strong>ip</strong>: the IP address to check</li>
<li><strong>port</strong>: the port number to check</li>
</ul>
<p dir="auto"><strong>Example</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="- type: port
  ip: &#34;192.168.1.1&#34;
  port: 22
  retry: &#34;10s&#34;
  timeout: &#34;1m&#34;"><pre>- <span>type</span>: <span>port</span>
  <span>ip</span>: <span><span>&#34;</span>192.168.1.1<span>&#34;</span></span>
  <span>port</span>: <span>22</span>
  <span>retry</span>: <span><span>&#34;</span>10s<span>&#34;</span></span>
  <span>timeout</span>: <span><span>&#34;</span>1m<span>&#34;</span></span></pre></div>

<p dir="auto">The shell health check executes a shell command checks the result.
This is to provide the option of user-defined health checks.</p>
<p dir="auto"><strong>Fields</strong></p>
<ul dir="auto">
<li><strong>type</strong>: should be <code>shell</code> for a shell health check.</li>
<li><strong>command</strong>:  he shell command to execute</li>
<li><strong>status</strong>: Expected exit code</li>
<li><strong>regex</strong>: Regex to match in the standard output</li>
</ul>
<blockquote>
<p dir="auto">Note: You must provide either <code>status</code> or <code>regex</code>, or both.</p>
</blockquote>
<p dir="auto"><strong>Example</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="- type: shell
  command: ping -c 1 192.168.1.1
  status: 0
  retry: 5s
  timeout: 20s"><pre>- <span>type</span>: <span>shell</span>
  <span>command</span>: <span>ping -c 1 192.168.1.1</span>
  <span>status</span>: <span>0</span>
  <span>retry</span>: <span>5s</span>
  <span>timeout</span>: <span>20s</span></pre></div>

<blockquote>
<p dir="auto">TODO:</p>
<ul>
<li> Need to test in the lab and post the actual sample</li>
</ul>
</blockquote>
<div dir="auto" data-snippet-clipboard-copy-content="- name: &#34;Firewall&#34;
  mac: &#34;00:1A:2B:3C:4D:5E&#34;
  interface: eth0
  vlan: 10
  depends: []
  check:
    - type: http
      url: &#34;http://192.168.1.1/health&#34;
      status: 200
      regex: &#39;ok&#39;

- name: &#34;Storage Server 1&#34;
  mac: &#34;00:1A:2B:3C:4D:5F&#34;
  interface: eth0
  vlan: 100
  depends:
    - &#34;Firewall&#34;
  check:
    - type: port
      ip: 192.168.100.101
      port: 2049
      timeout: 5 minutes

- name: &#34;Storage Server 2&#34;
  mac: &#34;00:1A:2B:3C:4D:5G&#34;
  vlan: 100
  depends:
    - &#34;Firewall&#34;
  check:
    - type: port
      ip: 192.168.100.102
      port: 445
      retry: 5s

- name: &#34;VM Host&#34;
  mac: &#34;00:1A:2B:3C:4D:60&#34;
  vlan: 200
  depends:
    - &#34;Storage Server 1&#34;
    - &#34;Storage Server 2&#34;
  check:
    - type: command
      command: &#34;ping -c 192.168.200.10&#34;
      status: 0"><pre>- <span>name</span>: <span><span>&#34;</span>Firewall<span>&#34;</span></span>
  <span>mac</span>: <span><span>&#34;</span>00:1A:2B:3C:4D:5E<span>&#34;</span></span>
  <span>interface</span>: <span>eth0</span>
  <span>vlan</span>: <span>10</span>
  <span>depends</span>: <span>[]</span>
  <span>check</span>:
    - <span>type</span>: <span>http</span>
      <span>url</span>: <span><span>&#34;</span>http://192.168.1.1/health<span>&#34;</span></span>
      <span>status</span>: <span>200</span>
      <span>regex</span>: <span><span>&#39;</span>ok<span>&#39;</span></span>

- <span>name</span>: <span><span>&#34;</span>Storage Server 1<span>&#34;</span></span>
  <span>mac</span>: <span><span>&#34;</span>00:1A:2B:3C:4D:5F<span>&#34;</span></span>
  <span>interface</span>: <span>eth0</span>
  <span>vlan</span>: <span>100</span>
  <span>depends</span>:
    - <span><span>&#34;</span>Firewall<span>&#34;</span></span>
  <span>check</span>:
    - <span>type</span>: <span>port</span>
      <span>ip</span>: <span>192.168.100.101</span>
      <span>port</span>: <span>2049</span>
      <span>timeout</span>: <span>5 minutes</span>

- <span>name</span>: <span><span>&#34;</span>Storage Server 2<span>&#34;</span></span>
  <span>mac</span>: <span><span>&#34;</span>00:1A:2B:3C:4D:5G<span>&#34;</span></span>
  <span>vlan</span>: <span>100</span>
  <span>depends</span>:
    - <span><span>&#34;</span>Firewall<span>&#34;</span></span>
  <span>check</span>:
    - <span>type</span>: <span>port</span>
      <span>ip</span>: <span>192.168.100.102</span>
      <span>port</span>: <span>445</span>
      <span>retry</span>: <span>5s</span>

- <span>name</span>: <span><span>&#34;</span>VM Host<span>&#34;</span></span>
  <span>mac</span>: <span><span>&#34;</span>00:1A:2B:3C:4D:60<span>&#34;</span></span>
  <span>vlan</span>: <span>200</span>
  <span>depends</span>:
    - <span><span>&#34;</span>Storage Server 1<span>&#34;</span></span>
    - <span><span>&#34;</span>Storage Server 2<span>&#34;</span></span>
  <span>check</span>:
    - <span>type</span>: <span>command</span>
      <span>command</span>: <span><span>&#34;</span>ping -c 192.168.200.10<span>&#34;</span></span>
      <span>status</span>: <span>0</span></pre></div>

<p dir="auto">This project is licensed under either of the following licenses, at your option:</p>
<ul dir="auto">
<li><a href="https://cceckman.com/darwindarak/rallyup/blob/master/LICENSE-MIT">MIT License</a></li>
<li><a href="https://cceckman.com/darwindarak/rallyup/blob/master/LICENSE-APACHE">Apache License 2.0</a></li>
</ul>
<p dir="auto">You may choose to use this project under the terms of either license.</p>
</article></div></div>
  </body>
</html>
