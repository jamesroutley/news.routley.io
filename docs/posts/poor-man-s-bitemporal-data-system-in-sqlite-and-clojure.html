<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.evalapply.org/posts/poor-mans-time-oriented-data-system/index.html">Original</a>
    <h1>Poor man&#39;s bitemporal data system in SQLite and Clojure</h1>
    
    <div id="readability-page-1" class="page"><div id="the-very-top">
        
  <main id="main">
    <article id="blog-post">
  <header>
      <p>Poor man&#39;s bitemporal data system in SQLite and Clojure</p>

      <p>
        <span>[ ↓ <a href="#blog-post-toc" rel="bookmark" target="_self">toc</a> ]</span>
        <span>Published: 2025-07-14</span>
        <span>Updated: 2025-07-15</span>
        <span>By: Aditya Athalye</span>
      </p>

      <p>
        On trying to mash up SQLite with ideas stolen from Accountants, Clojure, Datomic, XTDB, Rama, and Local-first-ers, to satisfy Henderson&#39;s Tenth Law. Viz., to make a sufficiently complicated data system containing an ad-hoc, informally-specified, bug-ridden, slow implementation of half of a bitemporal database. Because? Because laying about on a hammock, contemplating hopelessly complected objects like Current Databases isn&#39;t just for the Rich man.
      </p>
     
     
  </header>
  <hr/>
  <section>
      
<hr/>
  
<figure>
<img src="https://www.oregonlive.com/silicon-forest/2025/07/poor-mans-bitemporal-sqlite-db-scheme.png"/>
<figcaption>The <em>&#34;Poor Man&#39;s Bitemporal Database&#34;</em>, in the safety of my local box. No servers were harmed. Yet.</figcaption>
</figure>
<p>Especially fellow Clojurians trying to realise their Indie B2B SaaS dreams (translation: income <em>and</em> time-poor). Please use a proper professional time-oriented data system. The following are (pithy descriptions mine); <em>and</em> they are available <em>gratis</em> for fledgling commercial use.</p>
<ul>
<li><a href="https://www.datomic.com/">Datomic</a>… <em>&#34;the DB as a value&#34;</em> over an immutable log of all facts.</li>
<li><a href="https://xtdb.com/">XTDB</a>… <em>&#34;the DB as a value&#34;</em> over an immutable log of all <em>bitemporal</em> facts.</li>
<li><a href="https://redplanetlabs.com/">Rama</a>… <em>&#34;<strong>any</strong> DB as dirt-cheap view&#34;</em> over an immutable log of all events.</li>
</ul>

<p><em><strong>Solitary over-caffeinated temporal database rumination</strong></em> went out of hand. Even <em>The Voices</em> are fed up and want someone to stop us. Furthermore;</p>
<ol>
<li>Sage friends already gently shook their heads after hearing <em>The Voices</em>.</li>
<li>Their hard-won advice—<em>&#34;Just Use Postgres.&#34;</em>, and <em>&#34;Please, for everyone&#39;s sake, stick with the relational models.&#34;</em>—fell on deaf ears. <a href="#fn1" target="_self" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li>Obviously, I am also incapable of following <a href="#dont-try-this-at-work" target="_self">my own advice</a>.</li>
</ol>
<p>Hence this post.</p>
<p><em><strong>Take what is useful, discard the rest…</strong></em></p>
<p>The key take-away is: <em><strong>the accountants were right all along</strong></em>. Software engineers will do well, to cleverly copy the accountants <a href="#fn2" target="_self" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Now you may…</p>
<ul>
<li><a href="https://duckduckgo.com/?q=cat+pictures">View cat pictures</a> instead.</li>
<li><a href="#readings-and-references" target="_self">Skip to the reference material</a>. <em>Definitely</em> worth your time; pinky promise.</li>
<li><a href="#architecture-decisions-code" target="_self">Skip to Architecture + Code</a>; where the raw rubber tire of one&#39;s thinky-thought-ing meets the rough road of relentless Reality.</li>
</ul>
<p>Or, grab a big beverage to help ingest the <em>ten thousand</em> tokens to follow… Unless you are a Large Language Model. You can&#39;t drink. Sucks to be you.</p>
<p><em><strong>But beware. Once you see, you cannot un-see the fact that…</strong></em></p>
<blockquote>
<p>Any sufficiently complicated data system contains an ad-hoc, informally-specified, bug-ridden, slow implementation of half of a bitemporal database.</p>
<p>— <a href="https://github.com/jarohen">Henderson</a>&#39;s Tenth Law.</p>
</blockquote>

<figure>
<img src="https://www.oregonlive.com/silicon-forest/2025/07/dr-who-shapshot-in-time.jpg"/>
<figcaption>Recommended reading (ages 10 to 1,000) for the aspiring temporal data engineer.</figcaption>
</figure>
<h2 id="accountants-are-our-exemplary-archetype">Accountants are our exemplary archetype</h2>
<p>The cashier at Temporal Convenience Store K9, just handed us our bill. Oi; where is that 10% discount applicable to our bulk purchase of provisions as loyal customers (it&#39;s going to be a <em>long</em> trip)?!</p>
<p>Now we <em>think</em> that, but we <em>ask</em> politely, because we know there are many civil ways to sort this snafu without shoplifting or violence. Two universally accepted <a href="#fn3" target="_self" id="fnref3" role="doc-noteref"><sup>3</sup></a> remedies are:</p>
<ul>
<li>The cashier has direct authority to fix it, and they may gladly oblige.</li>
<li>The cashier&#39;s hands are sadly tied. For ERP reasons, accounts alone has authority to issue refunds for bills over a certain value. But we asked nicely so the cashier kindly nods us to accounts, in the backroom.</li>
</ul>
<p>Odds are that the store people <a href="#fn4" target="_self" id="fnref4" role="doc-noteref"><sup>4</sup></a> will fix it by issuing <em>two <strong>new</strong> transactions</em>.</p>
<ul>
<li>One transaction to cancel the last bill and reverse the related charge to our spacecard.</li>
<li>Another transaction issuing the corrected bill, including the discounted amount, with a fresh charge made to our spacecard.</li>
</ul>
<p>Meanwhile, Temporal Convenience Store K9&#39;s various ledgers have received corresponding debits and credits too, of course. But enough. A programmer, though Poor, is no Fool. One does not simply trespass The Field of Accountants. There be dragons.</p>
<p>So… Back to the DB.</p>
<p>One way or another, the store&#39;s accounting database must tell these facts:</p>
<ul>
<li>At TxTime-7543, Cashier-Adric at Store-K9 ISSUED bill ID-13579 having value 100 spacecoin, and charged it to SpaceCard-1337.</li>
<li>At TxTime-7587, Cashier-Adric at Store-K9 REVERSED bill ID-13579 having value 100 spacecoin, and refunded it to SpaceCard-1337.
<ul>
<li>Maaaybe a note about why it was reversed. <a href="#fn5" target="_self" id="fnref5" role="doc-noteref"><sup>5</sup></a></li>
</ul></li>
<li>At TxTime-7715, Accounts-Nyssa at Store-K9 ISSUED bill ID-13579-v2 for 90 spacecoin, with a total value of 100 spacecoin minus 10 spacecoin going to discount, and charged 90 spacecoin to SpaceCard-1337.</li>
</ul>
<p>We call this a <em>temporal data system</em> because it incorporates the passage of time.</p>
<ul>
<li>No information is ever modified in-place or deleted.</li>
<li>New information is always appended.</li>
<li>To grok the latest state of the accounts, one must read the sequence of all facts recorded in the database.</li>
<li>Reading a fact updates a separate, current view of the accounts… our &#34;as of now&#34; understanding of the world.</li>
<li>The &#34;current view&#34; can be rebuilt from scratch, up to any point in time, whether it is &#34;as of now&#34;, or &#34;as of last week&#34;, or &#34;as of next quarter&#34; (which will be useful only if we add synthetic projected-future events into the database).</li>
</ul>
<p>So… What to think about in order to design a general-purpose temporal data system that does this for us?</p>
<h2 id="all-databases-record-state-of-entities">All databases record <strong>state</strong> of <strong>entities</strong></h2>
<p>People, things, processes etc. State is the discrete <strong>value</strong> of some <strong>attribute</strong> of an <strong>entity</strong> <em>at a specific point in time</em>.</p>
<ul>
<li><strong>Values</strong> are timeless and context free <code>(17)</code>.</li>
<li><strong>Attributes</strong> provide context <code>(&#39;age&#39;)</code>, which we use to suggest and interpret the meaning of a value <code>(= age 17)</code>.</li>
<li><strong>Entities</strong> are real or imaginary objects ( <code>Adric</code>) having attributes (<code>age</code>).</li>
</ul>
<p>Thus, the <em>State</em> of <em>Adric</em> can be stated as: <em><strong>Adric&#39;s age is 17 as of now</strong></em>.</p>
<p>In a current database—which is just a fancy way of saying <em>database</em>—the <em>as of now</em> is implicit. So is the concept of <em>&#34;<code>age</code> is an attribute of the entity <code>Adric</code>&#34;</em>. We just call it <em>Schema</em>, in the abstract.</p>
<table>
<thead>
<tr>
<th>entity</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>Adric</td>
<td>17</td>
</tr>
</tbody>
</table>
<p>Let&#39;s re-state our traditional table as <strong><em>Entity-Attribute-Value (EAV)</em></strong> triplets. Let&#39;s also add a column for time (as we often do) to answer questions like &#34;when was Adric&#39;s age last updated in our database?&#34;.</p>
<table>
<thead>
<tr>
<th>entity</th>
<th>attribute</th>
<th>value</th>
<th>time</th>
</tr>
</thead>
<tbody>
<tr>
<td>Adric</td>
<td>age</td>
<td>17</td>
<td>as-of-date-time</td>
</tr>
</tbody>
</table>
<p>From this kernel shall spring forth our world, wrought of facts and time itself. But first, one must acknowledge that…</p>
<blockquote>
<p>All the world’s a stage,</p>
<p>— William Shakespeare, As You Like It, Act-II, Scene-VII, Lines 139-143</p>
</blockquote>
<p>As my theater gentlefriends like to say…</p>
<h2 id="everything-is-process">Everything is Process</h2>
<p>We understand the world in terms of processes. All of Reality is a live process which we want to participate in—control, influence, react, adapt. Ergo, all information is part of some process. Yes, even universal constants like <code>c</code> and <code>π</code>, which we can confidently assume to be constant only in our observable universe. Because even these came to be <em>after</em> the moment of the big bang, and will remain only until the eventual heat death of the universe (assuming our universe is ever-expanding, and not a bouncing singularity).</p>
<p>It follows that, to understand the world, we must observe and respond to data; information about various attributes of various meaningful aspects of reality, as we perceive it. Said another way, we understand the world by observing and modifying the state of entities over time—the past, the now, and the later. A person&#39;s address, a valve&#39;s current position, the remaining free volume of a container, the trajectory of a comet, one&#39;s fast-emptying savings account.</p>
<table>
<thead>
<tr>
<th>entity</th>
<th>attribute</th>
<th>value</th>
<th>time</th>
</tr>
</thead>
<tbody>
<tr>
<td>Adric</td>
<td>age</td>
<td>17</td>
<td>as-of-date-time</td>
</tr>
<tr>
<td>Adric</td>
<td>address</td>
<td>Foo</td>
<td>as-of-date-time</td>
</tr>
<tr>
<td>Adric</td>
<td>bitemporal belief</td>
<td>1</td>
<td>as-of-date-time</td>
</tr>
</tbody>
</table>
<p>The more sophisticated a being is, the more context about entities and entity-relationships it is able to keep alive and/or use simultaneously <a href="#fn6" target="_self" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<h2 id="the-identity-of-an-entity-is-the-complete-life-it-lives">The <strong>identity</strong> of an entity is the complete life it lives</h2>
<p>Never-ending <em>process</em> is the beating heart, the whistling wind, the pulsing quasar, the furious procreation, the tectonic Subduction, the whispered good-bye, the thermodynamic survival instinct of all things. Process is the <em>why</em> of <em>being</em>. One could even say that an entity without <em>id</em> can have no identity.</p>
<p>This is why, to properly identify an entity, we must egolessly maintain an up-to-date mental-model about it. For that, we must continually observe, record, and aggregate a succession of states of the entity in question.</p>
<p>Consequently, knowledge of entity-attributes alone is not sufficient (Adric has age, address, belief). Knowledge of attribute-values is required too (age is x, address is y, belief is z). And without a sense of time, we simply cannot complete the picture.</p>
<p>To make it concrete:</p>
<ul>
<li>Every person&#39;s life revolves around their address and we can guess different things about them based on how their address changes.</li>
<li>You know which Adric is being spoken about because you know
<ul>
<li>Adric&#39;s age was 17 last year. Adric&#39;s age is 18 as of now. Adric&#39;s age will be 319 on &lt;specific date&gt;.</li>
<li>Adric&#39;s address was Foo last year. Adric&#39;s address is Baz as of now. Adric&#39;s address will be Bar after December 2025.</li>
<li>Adric&#39;s belief in bitemporality was 1% last year. Adric&#39;s belief in bitemporality is 99% as of now.</li>
<li>Adric&#39;s temporal innocence level was 99% last year. Adric&#39;s temporal innocence level is 1% as of now.</li>
</ul></li>
<li>A reader of this set of facts can confidently determine: <em><strong>As-of-now, Adric is an eighteen year old entity that lives at</strong></em> <em><strong>&#39;Baz&#39;, believes strongly in bitemporality, and has nearly no temporal innocence.</strong></em></li>
</ul>
<table>
<thead>
<tr>
<th>E</th>
<th>A</th>
<th>V</th>
<th>as-of-time</th>
</tr>
</thead>
<tbody>
<tr>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>date-last-year</td>
</tr>
<tr>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>18</td>
<td>date-now</td>
</tr>
<tr>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>319</td>
<td>date-future</td>
</tr>
<tr>
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Foo</td>
<td>date-last-year</td>
</tr>
<tr>
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Baz</td>
<td>date-now</td>
</tr>
<tr>
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Bar</td>
<td>date-future</td>
</tr>
<tr>
<td>Adric</td>
<td>{:belief [:bitemporality :%]}</td>
<td>1</td>
<td>date-last-year</td>
</tr>
<tr>
<td>Adric</td>
<td>{:belief [:bitemporality :%]}</td>
<td>99</td>
<td>date-now</td>
</tr>
<tr>
<td>Adric</td>
<td>{:innocence [:temporal :%]}</td>
<td>99</td>
<td>date-last-year</td>
</tr>
<tr>
<td>Adric</td>
<td>{:innocence [:temporal :%]}</td>
<td>1</td>
<td>date-now</td>
</tr>
</tbody>
</table>
<p><code>KEY: E(ntity), A(ttribute), V(alue)</code></p>
<hr/>
<p>Having gained this factual understanding, a dear reader may be tempted to further theorise; <em>Adric lost his temporal innocence and eventually</em> <em>ended up living at &#39;Bar&#39;, where he always is these days.</em> Of course, to <em>prove</em> such an allegation, the dear reader would have to piece together many more facts about Adric, <em>and show causation</em>, not mere correlation.</p>
<p>The dear reader may happily play temporal sleuth. However, the temporal database and temporal data engineer are not here to judge. Our role is simply to record the facts as presented, without ego, without prejudice, with integrity, so that the temporal data sleuth may use it productively to figure out <em><strong>what happened, when, and why</strong></em>.</p>
<p>For there is more to facts than meets the eye.</p>
<blockquote>
<p>&#34;I&#39;m not in the judgment business, Mr. Orr. I&#39;m after facts. And the events of the mind, believe me, to me are facts. When you <em><strong>see</strong></em> another man&#39;s dream as he dreams it recorded in black and white on the electroencephalograph, as I&#39;ve done ten thousand times, you don&#39;t speak of dreams as &#39;unreal.&#39; They exist; they are events; they leave a mark behind them.&#34;</p>
<p>— Dr. William Haber</p>
<p><code>The Lathe of Heaven, Ursula K. Le Guin.</code></p>
</blockquote>
<h2 id="a-fact-can-be-true-or-false">A <strong>fact</strong> can be true or false</h2>
<p>The temporal sleuth knows that one must resolve the reality of a fact by asserting whether it is true or false.</p>
<p>Our facts table can be expressed as something like the table below. Aspiring temporal data engineers will do well to avoid speculating <em>why</em> a fact might have been asserted true or false. Our ilk must simply realise that we can <em>assert</em> facts this way; <code>&lt;statement of fact&gt; is &lt;true/false?&gt; as of &lt;time&gt;</code>.</p>
<p>Each state of the Adric entity can thus be re-written as an <em><strong>assertion</strong></em> of a fact.</p>
<ul>
<li><em>&#34;Adric&#39;s age is 17&#34;</em> is a <em>true</em> fact <em>as of</em> date-last-year.</li>
<li><em>&#34;Adric&#39;s age is 17&#34;</em> is a <em>false</em> fact <em>as of</em> date-now.</li>
</ul>
<table>
<thead>
<tr>
<th>E</th>
<th>A</th>
<th>V</th>
<th>assert</th>
<th>as-of-time</th>
</tr>
</thead>
<tbody>
<tr>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>true</td>
<td>date-last-year</td>
</tr>
<tr>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>false</td>
<td>date-now</td>
</tr>
</tbody>
</table>
<p><code>KEY: E(ntity), A(ttribute), V(alue)</code></p>
<hr/>
<p>With just this information, the temporal sleuth can infer that Adric&#39;s age <em>definitely changed at least once</em> sometime between date-last-year and date-now. But how many times, and to what value, is anybody&#39;s guess. For that, we need more temporal observations. Which thickens the plot. For now, we might receive conflicting observations.</p>
<h2 id="what-happens-when-fact-and-fact-collide">What happens when fact and fact collide?</h2>
<p>You Won&#39;t Believe This One Trick Accountants Use To Deal With Changing Facts. They never delete old entries from their ledgers, they simply make <em>new</em> &#34;correcting entries&#34; (We established this in our motivating example.).</p>
<p>Earlier, we were told to record that the Adric entity&#39;s age is 17 as of date-last-year. Presently, we are told to make a note that Adric is NOT 17 any more. We have no idea about Adric&#39;s <del>birth date</del> creation date, by the way. We just make a note of assertions of facts about Adric&#39;s age, as we are told.</p>
<table>
<thead>
<tr>
<th>E</th>
<th>A</th>
<th>V</th>
<th>assert</th>
<th>as-of-time</th>
</tr>
</thead>
<tbody>
<tr>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>true</td>
<td>date-last-year</td>
</tr>
<tr>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>false</td>
<td>date-now</td>
</tr>
</tbody>
</table>
<p><code>KEY: E(ntity), A(ttribute), V(alue)</code></p>
<hr/>
<p><em><strong>At this point, if anyone asks for Adric&#39;s age &#34;as of now&#34;, the only truth we can tell is &#34;we don&#39;t know&#34;.</strong></em> Think about this for a moment. How should we interrogate this temporal data store, to make sense of the information it contains? It&#39;s subtle. Hopefully all the thinky thoughting to come will build a clearer intuition. But we are out of time right now…</p>
<p>Sixty seconds later, we are interrupted and told that Adric is in fact 18, and oh by the way, he was already 18 as of date-now. And does it bother us that <em>we wrote the earlier thing down already</em>? No it doesn&#39;t. We just assert the new fact.</p>
<p>And just like that…</p>
<p><em>Now</em> if anyone asks for Adric&#39;s age &#34;as of now&#34;, we can truthfully answer <code>18</code>. Because now our table looks like…</p>
<table>
<thead>
<tr>
<th>E</th>
<th>A</th>
<th>V</th>
<th>assert</th>
<th>as-of-time</th>
</tr>
</thead>
<tbody>
<tr>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>true</td>
<td>date-last-year</td>
</tr>
<tr>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>false</td>
<td>date-now</td>
</tr>
<tr>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>18</td>
<td>true</td>
<td>date-now</td>
</tr>
</tbody>
</table>
<p><code>KEY: E(ntity), A(ttribute), V(alue)</code></p>
<hr/>
<p>Similarly, we make note of other facts about Adric as of various dates on the timeline. But let&#39;s add one more key detail… the time at which we made note of the information.</p>
<h2 id="finally-the-two-questions-that-put-the-bi-in-the-bitemporal">Finally, the Two Questions that put the &#39;bi&#39; in the &#39;bitemporal&#39;</h2>
<p>Events always occur <em>before they can be recorded</em>. It&#39;s just how nature works. Therefore, we can only ever make a note of a fact, after the fact. And so it comes to pass, that any self-respecting temporal sleuth naturally begins their temporal interrogation with two questions:</p>
<h3 id="when-did-it-actually-happen">When did it actually happen?</h3>
<p>Only a fact-sender may lay claim to the time an event occurred. <em>And</em> this timestamp must <em>always</em> travel with the fact. Whether the claimed timestamp is acceptable or not is between the fact-sender and the temporal sleuth. The temporal data store and engineer just make sure it is written down exactly as given.</p>
<h3 id="when-did-we-officially-record-it">When did we officially record it?</h3>
<p>Only the temporal data <em>store</em>—not even the temporal data engineer—may lay claim to when this happened. For the temporal data engineer is just a fallible puny human who can screw up in so many ways. Making typos. Misreading the clock. Lazily avoiding recording facts until the auditor comes a-calling. Or even forgetting the fact entirely, upon discovery of which fact, the temporal sleuth gets called in to piece together what might have happened.</p>
<p>So, let&#39;s update our temporal data table with the &#34;transaction&#34; time, at which the data store guarantees that it has immutably inscribed a fact.</p>
<p>To ease table-reading life of our fellow our puny humans, we also rearrange the time columns a bit. Now, we can manually read records as follows:</p>
<ul>
<li>At Transaction Time <code>t02</code>, the table recorded the following fact:
<ul>
<li><em>As of <code>dt-now</code>, <code>Adric</code>&#39;s <code>:age</code> being <code>17</code> stands REDACTED.</em></li>
</ul></li>
<li>At Transaction Time <code>t03</code>, the table recorded the following fact:
<ul>
<li><em>As of <code>dt-now</code>, <code>Adric</code>&#39;s <code>:age</code> being <code>18</code> stands ASSERTED.</em></li>
</ul></li>
</ul>
<table>
<thead>
<tr>
<th>tx-time</th>
<th>as-of-time</th>
<th>E</th>
<th>A</th>
<th>V</th>
<th>assert</th>
</tr>
</thead>
<tbody>
<tr>
<td>t01</td>
<td>dt-last-yr</td>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>true</td>
</tr>
<tr>
<td><em><strong>t02</strong></em></td>
<td><em><strong>dt-now</strong></em></td>
<td><em><strong>Adric</strong></em></td>
<td><em><strong>{:age [:time :years]}</strong></em></td>
<td><em><strong>17</strong></em></td>
<td><em><strong>false</strong></em></td>
</tr>
<tr>
<td><em><strong>t03</strong></em></td>
<td><em><strong>dt-now</strong></em></td>
<td><em><strong>Adric</strong></em></td>
<td><em><strong>{:age [:time :years]}</strong></em></td>
<td><em><strong>18</strong></em></td>
<td><em><strong>true</strong></em></td>
</tr>
<tr>
<td>t04</td>
<td>dt-future</td>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>319</td>
<td>true</td>
</tr>
<tr>
<td>t05</td>
<td>dt-last-yr</td>
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Foo</td>
<td>true</td>
</tr>
<tr>
<td>t06</td>
<td>dt-now</td>
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Bar</td>
<td>false</td>
</tr>
<tr>
<td>t07</td>
<td>dt-now</td>
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Baz</td>
<td>true</td>
</tr>
<tr>
<td>t08</td>
<td>dt-future</td>
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Bar</td>
<td>true</td>
</tr>
<tr>
<td>t09</td>
<td>dt-last-yr</td>
<td>Adric</td>
<td>{:belief [:bitemporality :%]}</td>
<td>1</td>
<td>true</td>
</tr>
<tr>
<td>t10</td>
<td>dt-now</td>
<td>Adric</td>
<td>{:belief [:bitemporality :%]}</td>
<td>99</td>
<td>true</td>
</tr>
<tr>
<td>t11</td>
<td>dt-future</td>
<td>Adric</td>
<td>{:belief [:bitemporality :%]}</td>
<td>0</td>
<td>false</td>
</tr>
<tr>
<td>t12</td>
<td>dt-last-yr</td>
<td>Adric</td>
<td>{:innocence [:temporal :%]}</td>
<td>99</td>
<td>true</td>
</tr>
<tr>
<td>t13</td>
<td>dt-now</td>
<td>Adric</td>
<td>{:innocence [:temporal :%]}</td>
<td>1</td>
<td>true</td>
</tr>
<tr>
<td>t14</td>
<td>dt-future</td>
<td>Adric</td>
<td>{:innocence [:temporal :%]}</td>
<td>33</td>
<td>false</td>
</tr>
</tbody>
</table>
<p><code>KEY: E(ntity), A(ttribute), V(alue)</code></p>
<hr/>
<p>This brings us to the absurdity of time travel… For things to get better, they have to get <em>weird</em> first.</p>

<figure>
<img src="https://www.oregonlive.com/silicon-forest/2025/07/time-travel-timelines-informationisbeautiful-net.jpg"/>
<figcaption>&#34;TIMELINES&#34; - Time Travel in popular film and TV. (Source: <a href="https://informationisbeautiful.net/visualizations/timelines-time-travel-in-popular-film-and-tv/">informationisbeautiful.net</a>)</figcaption>
</figure>
<blockquote>
<p>&#34;Why do you think your mother didn&#39;t notice that reality had changed since last night?&#34; <code>[Dr. Haber]</code></p>
<p>&#34;Well, she didn&#39;t dream it. I mean, the dream really did change reality. It made a different reality, retroactively, which she&#39;d been part of all along. Being in it, she had no memory of any other. I did, I remembered both, because I was… there… at the moment of the change. This is the only way I can explain it, I know it doesn&#39;t make sense. But I have got to have some explanation or else face the fact that I&#39;m insane.&#34; <code>[Mr. Orr]</code></p>
<p><code>The Lathe of Heaven, Ursula K. Le Guin.</code></p>
</blockquote>
<p><em>Actual</em> Time Travel is different each time, because the very act of it interacts with and perturbs Reality. Not being higher dimensional beings, we have evolved to get by, by perceiving very little of very little. To us, convenient fictions are good enough Reality.</p>
<h2 id="no-temporal-database-can-contain-reality-itself">No temporal database can contain Reality itself</h2>
<p><em>&#34;The Song&#34;</em> is a convenient fiction.</p>
<p>We love to loop a favourite hit single. Yet…</p>
<ul>
<li><em><strong>A record is not &#34;The Song&#34;.</strong></em> All recordings are lossy <a href="#fn7" target="_self" id="fnref7" role="doc-noteref"><sup>7</sup></a> because all acts of measurement are lossy. That&#39;s just physics.</li>
<li><em><strong>A replay is not &#34;The Song&#34;.</strong></em> Every replay is the same information yet it is <em>new</em>, because Reality is ever-moving, ever-changing. (Ignoring for a moment the fact that every replay degrades the storage medium—vinyl, compact disk, copper plate, SSD—causing further information loss.)</li>
<li><em><strong>Nor are live performances &#34;The Song&#34;.</strong></em> Each rendition is different.</li>
</ul>
<p>Similarly, temporal databases can only mimic Time Travel.</p>
<ul>
<li>The experience of Reality can only ever be captured as finite, discrete observations (samples and measurements).</li>
<li>Therefore, a temporal recording or database can only ever contain approximate observations of Reality.</li>
<li>Each time we retrieve the observations, we cannot help but <em>reinterpret</em> them because we ourselves have changed in the interval.</li>
</ul>
<p>We can only ever sing songs about what we believed happened.</p>
<h2 id="reality-transpires-in-dedekind-cuts">Reality transpires in Dedekind cuts</h2>
<p><em>&#34;This Instant&#34;</em> is a convenient fiction.</p>
<p>Every observation of reality exists <em>somewhere inside of an interval</em>, because our means of measurement can only ever <em>approximate</em> the moment of occurrence of an event. The idea of the <em>Dedekind Cut</em> frames this neatly.</p>

<p>Why split such philosophical hairs? Why?</p>
<p>Because, we must record temporal facts with proper temporal resolution. For example, an infinitesimal such as a Femtosecond (10<sup>-15s</sup>) can be…</p>
<ul>
<li>Just Right… for that &#34;Femto Laser&#34; Cataract removal or LASIK surgery.</li>
<li><em>Waaay</em> over the top… for orchestral arrangements where sub-millisecond (&lt; 10<sup>-3s</sup>) coordination is more than enough.</li>
<li>Or <em>too coarse(!)</em>… for Quantum dynamics studies, where incredible things happen in attoseconds (10<sup>-18s</sup>). <a href="#fn8" target="_self" id="fnref8" role="doc-noteref"><sup>8</sup></a></li>
</ul>
<p>More subtly, because all Temporal Data Processing queries are <em>Interval</em> queries, served by collating facts that happened starting Time X to Time Y.</p>
<p>For example, <em>&#34;Calculate the state of the world <code>as-of</code> some <code>Instant</code>.&#34;</em></p>
<p>To serve this query, we must collate all facts starting from the earliest available ones, right up to whatever <code>as-of</code> time Instant. It could be <code>as-of</code> &lt;some past moment&gt;, or <code>as-of</code> some projected future, or…. <code>as-of</code> <em>this very instant</em>, a.k.a. a <code>now</code> query.</p>
<p>The <code>now</code> query is a special-case <code>as-of</code> query, because <code>now</code> is an <em>expanding</em> query window… ever-increasing &#34;wall-clock time&#34;. It means <em>our computer&#39;s temporal resolution</em>, which the temporal database relies on, must suit that of incoming facts. My cheap wristwatch will botch your Formula One lap times.</p>
<p>Fun fact: The <code>now</code> query returns <em>a</em> Current Database.</p>
<h2 id="facts-contain-observations.-observations-are-not-reality.">Facts contain observations. Observations are not Reality.</h2>
<p><em>&#34;Facts&#34;</em> are a convenient fiction.</p>
<p>To fact-find, we must observe. Observation requires measurement. Measurements are inherently lossy. Consequently, no collection of facts, no matter how fine-grained can ever capture Reality as it <em>actually</em> happened.</p>
<p>Besides, facts depend on who&#39;s observing. Having experienced the world a bit, we have doubtless realised that, <em>routinely</em>…</p>
<ul>
<li>The same party told us &#34;use this fact&#34;, at different times, with no regard to whatever happened in-between.</li>
<li>OR, it&#39;s possible that the same party sent us two different facts at the same time, but they were recorded in the table at different times. Maybe the temporal database recorded one fact, but before it could record the other fact, it got waylaid by a VACUUM emergency. It happens.</li>
<li>OOOORRRR, it is possible that <em>two different parties</em> with <em>different</em> vantage points of a shared reality sent their observations independently, without being aware that other party even exists. Our temporal database just says &#34;okay then&#34;, and records <em>both</em> claims of facts about observed reality.</li>
</ul>
<p>As we established in the <code>Adric</code> scenario, multiple facts <em>for the same <code>E-A-V</code> triple</em>, can <em>claim</em> to have occurred at the same time (<code>Adric is NOT 17 as-of-now</code>, and <code>Adric IS 18 as-of-now</code>).</p>
<p>Consequently, though our bitemporal database notes down distinct facts at different times, we <em>cannot presume</em> that the sequence of recording follows Reality.</p>
<p>In other words…</p>
<p><em>Facts are <strong>mutually independent parallel <em>claims</em></strong> that assert or redact some aspect of <strong>concurrent real-world events</strong>.</em></p>
<p>In fact, facts are <em>always</em> so. <em>Variables</em> are mutually dependent or independent; correlated or uncorrelated, because variables subsume Real identities, all of which live in the contiguous fabric of the same shared Universe.</p>
<p>What the Fact?!</p>
<h2 id="materialised-reality-depends-on-whos-asking.">Materialised &#34;Reality&#34; depends on who&#39;s asking.</h2>
<p><em>&#34;Reality&#34;</em> is a convenient fiction.</p>
<p>We simulate alternate reality all the time. Worrying about the future. Worrying about what someone must be thinking about us just now. Questioning past life choices and wondering &#34;what if&#34;. Much like financial analysts, weather modelers, chess pros, special ops teams running scenarios and doing retrospectives. Except those other people get paid to imagine worst case scenarios.</p>
<ol>
<li>If each fact lives <em>on its own conceptual timeline</em>, then we must necessarily <em>reconstruct reality</em> by threading a point of view through a sequence of recorded facts.</li>
<li>Only the temporal sleuth—not the temporal database, nor engineer—get to choose which timeline or timelines (sequence(s) of facts) ought to construct a prospective Reality.</li>
<li>Only the temporal sleuth gets to choose the <code>as-of</code> point in time wherefrom to do so—now, past, future; separately or simultaneously. And gets paid to imagine alternate realities.</li>
</ol>

<figure>
<img src="https://www.oregonlive.com/silicon-forest/2025/07/pallet-rack-architecture.jpg"/>
<figcaption>Pallet Rack <em>&#34;<a href="https://www.jaaga.in/living-building">Living Building</a>&#34;</em> nerdspace &amp; art installation - Freeman Murray et. al., Kochi, Kerala, 2012.</figcaption>
</figure>
<p><code>nb.</code> All code snippets are Clojure. All SQL is written specifically for SQLite, using the <a href="https://cljdoc.org/d/com.github.seancorfield/honeysql/2.7.1310/doc/readme">Honey SQL</a> library (SQL as Clojure data structures).</p>
<h2 id="the-bet">The Bet</h2>
<p><em>All</em> data systems are, in reality, temporal data systems. Most just don&#39;t know it until it&#39;s too late. <em>Things</em>—as life teaches inevitably—have a habit of getting real, real fast. Suddenly, one fine day, life <em>will</em> deliver us a forehead-slapping moment because even that tiny-SaaS indie B2B app has manifested <em>&#34;a sufficiently complicated data system&#34;</em>. Because <a href="https://www.oregonlive.com/silicon-forest/2025/software-debt/index.html#main">complexity is inevitable</a>.</p>
<h2 id="the-architecture-a-vertically-integrated-saas-machine">The Architecture: A Vertically Integrated SaaS Machine</h2>
<p>Runaway incidental complexity <em>of software</em> is why computers got slower while hardware and networks got faster. This bothers me no end. I want to profit from the glut of compute <em>without</em> taking on systemic complexity. <a href="#fn9" target="_self" id="fnref9" role="doc-noteref"><sup>9</sup></a></p>
<p>One way is to build software applications as unified vertically integrated computer systems, as a fruit-named company famously does. And, as is true for contemplating complected objects on hammocks, profiting from full-systems vertical integration isn&#39;t just for the absurdly rich global conglomerate.</p>
<p><code>nb.</code> <em><strong>&#34;Vertical Integration&#34; does NOT mean &#34;Being Rigid&#34;.</strong></em> Quite the opposite; it means cultivate total adaptability, situational awareness, and mastery over self and environment. <a href="#fn10" target="_self" id="fnref10" role="doc-noteref"><sup>10</sup></a></p>
<h3 id="the-trade-off-hard-to-design-easy-to-build-own-operate-teach">The Trade-Off: Hard to design, Easy to Build-Own-Operate-Teach</h3>
<p>The main thing to understand is that changing any single detail of a vertically-integrated system could mandate ripple-effect changes through the whole system… and <em>that is okay</em>.</p>
<p>The indie vertically-integrating systems builder should choose an extreme position:</p>
<ul>
<li>Either <em>go all-in</em> on a <em>single</em> all-encompassing web SaaS stack (application framework, server runtime, tool chain).</li>
<li>Or make a <a href="https://github.com/adityaathalye/clojure-multiproject-example">custom system of composable parts</a>. Entirely avoid building on top of pre-designed monolithic frameworks (most Clojure pros).</li>
</ul>
<p>Either way is fine. <a href="https://www.oregonlive.com/silicon-forest/2025/clojure-web-app-from-scratch/index.html">Either way demands significant investment</a> from the committed indie SaaS builder. The only real choice one has, is <em>to own it</em>—learn to fit self to it, or make it fit to self. <a href="#fn11" target="_self" id="fnref11" role="doc-noteref"><sup>11</sup></a></p>
<h3 id="above-all-aggressively-minimise-system-wide-complexity">Above All: <strong>Aggressively</strong> Minimise System-Wide Complexity</h3>
<p>The absurdly not-rich local indie SaaS maker must accept the complexity-management limits of their own smol brain. And that is okay. One poor brain can do a <em>lot</em>, if it asks <em>&#34;So, like, how do I build a unified, coherent system specialised to me—my goals, needs, and indeed, to my way of thinking?&#34;</em>, which is…</p>
<ul>
<li>no cloud services lock-in (no VC funding. no funding at all, actually.)</li>
<li>no framework lock-in (a-la-carte pieces)</li>
<li>no tool-bench / process lock-in (design own tools shaped for own brain)</li>
<li>no devops clones (dead-simple deployments, observability, failover etc.)</li>
<li>no (future) customer data lock-in (must be local-first compatible)</li>
</ul>
<p>Well, I am a <a href="https://grugbrain.dev/">grug-brained developer</a> <a href="#fn12" target="_self" id="fnref12" role="doc-noteref"><sup>12</sup></a> therefore &#34;the system&#34; <em>must</em> be small conceptually, and literally. It is mission-critical to build the system piecemeal, where we intimately know the parts and can fully control interfaces between parts and abstraction boundaries.</p>
<p>In the context of a SaaS web application it means:</p>
<ul>
<li>Single-server installation
<ul>
<li>App, db, cache, queue, document store, server, proxy; everything on one box</li>
<li>To scale, beef up server</li>
</ul></li>
<li>Unified Application + Database architecture
<ul>
<li>In-process databases only</li>
<li>Universal, static, zero-migration storage schema</li>
<li>All application-specific materialised views as application code i.e. the application is <em>not</em> &#34;just a DB wrapper&#34;.</li>
<li>Optionally, single tenancy. One DB per tenant, for regional compliance, and horizontal scaling as a nice side-benefit.</li>
<li>No write concurrency. All database operations are one-way loops.</li>
<li>No &#34;Distributed Local-first&#34;. Local-first mode is unauthenticated single-user. Server-mode is bog standard synchronous SaaS.</li>
</ul></li>
<li>Immutability by default
<ul>
<li>idempotence where immutability gets too involved to implement correctly
<ul>
<li>in-place mutation only as a rare, purposeful, escape hatch when both immutability and idempotence get too complex or too resource-hungry</li>
</ul></li>
</ul></li>
<li>One DB Engine to rule them all
<ul>
<li>Primary store</li>
<li>K/V store</li>
<li>Sessions store</li>
<li>Cache</li>
<li>Document store</li>
</ul></li>
</ul>
<h3 id="two-wee-vms-please.-one-to-serve-one-for-failover.">Two Wee VMs, please. One to serve, one for failover.</h3>
<p>Seriously.</p>
<p>Computers today—even the cheap shared VMs—are stupid-fast. A properly built web app can use the <em>smallest</em> VM below, to support a healthy SaaS business, <em>with room to grow</em>. Add one more box on hot standby for failover.</p>
<table>
<caption>Hetzner Cloud Shared vCPU (Intel®) Pricing - DE, FI datacenters.</caption>
<thead>
<tr>
<th>Name</th>
<th>VCPU</th>
<th>RAM</th>
<th>NVMe SSD</th>
<th>Traffic incl. IPv4</th>
<th>Hourly</th>
<th>Monthly</th>
</tr>
</thead>
<tbody>
<tr>
<td>CX22</td>
<td>2</td>
<td>4 GB</td>
<td>40 GB</td>
<td>20 TB</td>
<td>€ 0.006</td>
<td>€ 3.79 max.</td>
</tr>
<tr>
<td>CX32</td>
<td>4</td>
<td>8 GB</td>
<td>80 GB</td>
<td>20 TB</td>
<td>€ 0.0113</td>
<td>€ 6.80 max.</td>
</tr>
<tr>
<td>CX42</td>
<td>8</td>
<td>16 GB</td>
<td>160 GB</td>
<td>20 TB</td>
<td>€ 0.0273</td>
<td>€ 16.40 max.</td>
</tr>
<tr>
<td>CX52</td>
<td>16</td>
<td>32 GB</td>
<td>320 GB</td>
<td>20 TB</td>
<td>€ 0.054</td>
<td>€ 32.40 max.</td>
</tr>
</tbody>
</table>
<p><code>Source: hetzner.com, as-of 2025-07-12. No affiliation.</code></p>
<hr/>
<p>Wherever it&#39;s up to me, I will just keep beefing up that single-box installation, for as long as I can get away with. Max out normie VMs with taxing DB queries of a hacked-up temporal database, used by a bog-standard JVM web app.</p>
<p>Like, <em>if <u><strong>I</strong></u> were</em> a web app, that CCX63 would feel absolutely <em>palatial</em>.</p>
<p>Gimme it! <a href="#fn13" target="_self" id="fnref13" role="doc-noteref"><sup>13</sup></a></p>
<table>
<caption>Hetzner Cloud Dedicated vCPU (AMD EPYC) Pricing - DE, FI datacenters.</caption>
<thead>
<tr>
<th>Name</th>
<th>VCPU</th>
<th>RAM</th>
<th>NVMe SSD</th>
<th>Traffic incl. IPv4</th>
<th>Hourly</th>
<th>Monthly</th>
</tr>
</thead>
<tbody>
<tr>
<td>CCX13</td>
<td>2</td>
<td>8 GB</td>
<td>80 GB</td>
<td>20 TB</td>
<td>€ 0.02</td>
<td>€ 12.49 max.</td>
</tr>
<tr>
<td>CCX23</td>
<td>4</td>
<td>16 GB</td>
<td>160 GB</td>
<td>20 TB</td>
<td>€ 0.0392</td>
<td>€ 24.49 max.</td>
</tr>
<tr>
<td>CCX33</td>
<td>8</td>
<td>32 GB</td>
<td>240 GB</td>
<td>30 TB</td>
<td>€ 0.0777</td>
<td>€ 48.49 max.</td>
</tr>
<tr>
<td>CCX43</td>
<td>16</td>
<td>64 GB</td>
<td>360 GB</td>
<td>40 TB</td>
<td>€ 0.1546</td>
<td>€ 96.49 max.</td>
</tr>
<tr>
<td>CCX53</td>
<td>32</td>
<td>128 GB</td>
<td>600 GB</td>
<td>50 TB</td>
<td>€ 0.3085</td>
<td>€ 192.49 max.</td>
</tr>
<tr>
<td>CCX63</td>
<td>48</td>
<td>192 GB</td>
<td>960 GB</td>
<td>60 TB</td>
<td>€ 0.4623</td>
<td>€ 288.49 max.</td>
</tr>
</tbody>
</table>
<p><code>Source: hetzner.com, as-of 2025-07-12. No affiliation.</code></p>
<hr/>
<h3 id="feed-cheap-disks-to-storage-hungry-temporal-databases">Feed cheap disks to storage-hungry Temporal Databases</h3>
<p>Current Databases terrify the temporal database engineer. A current database is a giant mass of global mutable state. It has no innate sense of time. And current database engineers inevitably have to manage concurrency. Some even have to delve into the dark arts of Multi Version Concurrency Control. <a href="#fn14" target="_self" id="fnref14" role="doc-noteref"><sup>14</sup></a></p>
<p>This mortal fear causes temporal database designers to copy accountants, who have been doing temporal data engineering for centuries. Why not tackle the far simpler problem of making everything append-only? Make a DB engine which will guarantee that <em>at such-and-such time</em> <em>it faithfully recorded &lt;this set of claimed facts&gt;, as-given, nondestructively</em>.</p>
<p>However, copying accountants isn&#39;t free.</p>
<ul>
<li>For one, temporal databases hoard data; chomping Terabytes for breakfast. The stuff of DB-tuning nightmares of current data engineers.</li>
<li>For another, without the right tools, we risk being Disk-wise but Query-foolish. We mitigate this by copying architects (of software).</li>
</ul>
<p>Here are some worth copying.</p>
<h2 id="clojure-namespaces-and-immutability-are-honking-great-ideas">Clojure: Namespaces and Immutability are honking great ideas</h2>
<p>We want to constrain all entities to well-known, guaranteed globally-qualified namespaces. So…</p>
<ul>
<li><code>world</code> is the only global namespace we permit, and is also the only single-segmented namespace</li>
<li>all other namespaces <strong>must</strong> be <strong>minimum</strong> two-segmented, such as <code>com.acmecorp</code> or <code>com.acmecorp.foo-client</code>.</li>
<li><code>ns_name</code> must only ever be the namespace part (such as <code>com.acmecorp</code> or <code>world</code>) of a fully qualified entity name (of <code>com.acmecorp/user</code> or <code>world/administrator</code>).</li>
</ul>
<p>All SQL is written for SQLite, using <a href="https://cljdoc.org/d/com.github.seancorfield/honeysql/2.7.1310/doc/readme">Honey SQL</a> by Sean Corfield.</p>
<blockquote>
<p>SQL as Clojure data structures. Build queries programmatically – even at runtime – without having to bash strings together.</p>
</blockquote>
<h3 id="honeysql-constrain-world-namespaces">HoneySQL: Constrain World Namespaces</h3>
<figure>
<img src="https://www.oregonlive.com/silicon-forest/2025/07/poor-mans-bitemporal-sqlite-db-world-namespaces.png"/>
<figcaption>&#34;World Namespaces&#34;.</figcaption>
</figure>
<div id="cb2"><pre><code><span id="cb2-1"><a href="#cb2-1" target="_self" aria-hidden="true" tabindex="-1"></a>{<span>:create-table</span> [<span>:world</span>_namespaces <span>:if-not-exists</span>]</span>
<span id="cb2-2"><a href="#cb2-2" target="_self" aria-hidden="true" tabindex="-1"></a> <span>:with-columns</span></span>
<span id="cb2-3"><a href="#cb2-3" target="_self" aria-hidden="true" tabindex="-1"></a> [[<span>:rowid</span> <span>:integer</span> <span>:primary-key</span>]</span>
<span id="cb2-4"><a href="#cb2-4" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:ns</span>_name</span>
<span id="cb2-5"><a href="#cb2-5" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:text</span> [<span>:not</span> <span>nil</span>] [<span>:unique</span>]</span>
<span id="cb2-6"><a href="#cb2-6" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span>:check</span> [<span>:and</span></span>
<span id="cb2-7"><a href="#cb2-7" target="_self" aria-hidden="true" tabindex="-1"></a>            [:= <span>:ns</span>_name [<span>:trim</span> <span>:ns</span>_name]]</span>
<span id="cb2-8"><a href="#cb2-8" target="_self" aria-hidden="true" tabindex="-1"></a>            [:= [<span>:text</span>_split <span>:ns</span>_name <span>&#34;/&#34;</span> <span>2</span>] <span>&#34;&#34;</span>]</span>
<span id="cb2-9"><a href="#cb2-9" target="_self" aria-hidden="true" tabindex="-1"></a>            [<span>:or</span></span>
<span id="cb2-10"><a href="#cb2-10" target="_self" aria-hidden="true" tabindex="-1"></a>             [:= <span>:ns</span>_name <span>&#34;world&#34;</span>]</span>
<span id="cb2-11"><a href="#cb2-11" target="_self" aria-hidden="true" tabindex="-1"></a>             [:&lt;&gt; [<span>:text</span>_split <span>:ns</span>_name <span>&#34;.&#34;</span> <span>2</span>] <span>&#34;&#34;</span>]]]]</span>
<span id="cb2-12"><a href="#cb2-12" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; somehow we must enforce these names are globally unique</span></span>
<span id="cb2-13"><a href="#cb2-13" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb2-14"><a href="#cb2-14" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:is</span>_active <span>:boolean</span> [<span>:not</span> <span>nil</span>] [<span>:default</span> <span>false</span>]</span>
<span id="cb2-15"><a href="#cb2-15" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; sometimes a namespace may be deactivated but kept around</span></span>
<span id="cb2-16"><a href="#cb2-16" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb2-17"><a href="#cb2-17" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:is</span>_deleted <span>:boolean</span> [<span>:not</span> <span>nil</span>] [<span>:default</span> <span>false</span>]</span>
<span id="cb2-18"><a href="#cb2-18" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; true IFF the namespace *and every bit of its data*</span></span>
<span id="cb2-19"><a href="#cb2-19" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; was permanently erased</span></span>
<span id="cb2-20"><a href="#cb2-20" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb2-21"><a href="#cb2-21" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:ns</span>_meta <span>:text</span></span>
<span id="cb2-22"><a href="#cb2-22" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; semi-regular information about the namespace / org.</span></span>
<span id="cb2-23"><a href="#cb2-23" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; {:org-name &#34;ACME Corp.&#34;</span></span>
<span id="cb2-24"><a href="#cb2-24" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;;  :address {:street &#34;001&#34;</span></span>
<span id="cb2-25"><a href="#cb2-25" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;;            :city &#34;Eta Omega&#34; ... }}</span></span>
<span id="cb2-26"><a href="#cb2-26" target="_self" aria-hidden="true" tabindex="-1"></a>   ]]}</span>
<span id="cb2-27"><a href="#cb2-27" target="_self" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<h3 id="honeysql-constrain-world-users">HoneySQL: Constrain World Users</h3>
<figure>
<img src="https://www.oregonlive.com/silicon-forest/2025/07/poor-mans-bitemporal-sqlite-db-world-users.png"/>
<figcaption>&#34;World Users&#34;.</figcaption>
</figure>
<p>All users must ID as fully-qualified name like <code>com.acmecorp/adi</code>, following the constraint of standard global namespacing (<code>some.name.space/the-name</code>).</p>
<div id="cb3"><pre><code><span id="cb3-1"><a href="#cb3-1" target="_self" aria-hidden="true" tabindex="-1"></a>{<span>:create-table</span> [<span>:world</span>_users <span>:if-not-exists</span>]</span>
<span id="cb3-2"><a href="#cb3-2" target="_self" aria-hidden="true" tabindex="-1"></a> <span>:with-columns</span></span>
<span id="cb3-3"><a href="#cb3-3" target="_self" aria-hidden="true" tabindex="-1"></a> [[<span>:rowid</span> <span>:integer</span> <span>:primary-key</span>]</span>
<span id="cb3-4"><a href="#cb3-4" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:ns</span>_user_id</span>
<span id="cb3-5"><a href="#cb3-5" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:text</span> [<span>:not</span> <span>nil</span>] [<span>:unique</span>]</span>
<span id="cb3-6"><a href="#cb3-6" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span>:check</span> [:= <span>:ns</span>_user_id [<span>:trim</span> <span>:ns</span>_user_id]]]]</span>
<span id="cb3-7"><a href="#cb3-7" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:ns</span>_name</span>
<span id="cb3-8"><a href="#cb3-8" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:text</span> [<span>:not</span> <span>nil</span>]</span>
<span id="cb3-9"><a href="#cb3-9" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:generated-always</span> <span>:as</span> [[<span>:text</span>_split <span>:ns</span>_user_id <span>&#34;/&#34;</span> <span>1</span>]]</span>
<span id="cb3-10"><a href="#cb3-10" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:stored</span>]</span>
<span id="cb3-11"><a href="#cb3-11" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:user</span>_name</span>
<span id="cb3-12"><a href="#cb3-12" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:text</span> [<span>:not</span> <span>nil</span>]</span>
<span id="cb3-13"><a href="#cb3-13" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:generated-always</span> <span>:as</span> [[<span>:text</span>_split <span>:ns</span>_user_id <span>&#34;/&#34;</span> <span>2</span>]]</span>
<span id="cb3-14"><a href="#cb3-14" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:stored</span>]</span>
<span id="cb3-15"><a href="#cb3-15" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:user</span>_type <span>:text</span> [<span>:not</span> <span>nil</span>] [<span>:default</span> <span>&#34;UNSPECIFIED&#34;</span>]</span>
<span id="cb3-16"><a href="#cb3-16" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; call it &#34;user_type&#34;, symmetric with &#34;entity_type&#34;,</span></span>
<span id="cb3-17"><a href="#cb3-17" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; because users are special case entities</span></span>
<span id="cb3-18"><a href="#cb3-18" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; :system/owner, :system/admin, :system/member, :system/bot</span></span>
<span id="cb3-19"><a href="#cb3-19" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; :org/owner, :org/admin, :org/member :org/bot</span></span>
<span id="cb3-20"><a href="#cb3-20" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb3-21"><a href="#cb3-21" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:is</span>_active <span>:boolean</span> [<span>:not</span> <span>nil</span>] [<span>:default</span> <span>false</span>]</span>
<span id="cb3-22"><a href="#cb3-22" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; sometimes, a user may be deactivated</span></span>
<span id="cb3-23"><a href="#cb3-23" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; but kept around for &lt;reasons&gt;</span></span>
<span id="cb3-24"><a href="#cb3-24" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb3-25"><a href="#cb3-25" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:is</span>_deleted <span>:boolean</span> [<span>:not</span> <span>nil</span>] [<span>:default</span> <span>false</span>]</span>
<span id="cb3-26"><a href="#cb3-26" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; signal that user and /every bit of user data/</span></span>
<span id="cb3-27"><a href="#cb3-27" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; was permanently erased</span></span>
<span id="cb3-28"><a href="#cb3-28" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb3-29"><a href="#cb3-29" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:ns</span>_user_meta <span>:text</span></span>
<span id="cb3-30"><a href="#cb3-30" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; semi-regular information about the user</span></span>
<span id="cb3-31"><a href="#cb3-31" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; {:first_name &#34;Foo&#34; :last_name &#34;Bar&#34;</span></span>
<span id="cb3-32"><a href="#cb3-32" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;;  :address {:flat &#34;001&#34; :city &#34;Lambda&#34; ... }}</span></span>
<span id="cb3-33"><a href="#cb3-33" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb3-34"><a href="#cb3-34" target="_self" aria-hidden="true" tabindex="-1"></a>  [[<span>:foreign-key</span> <span>:ns</span>_name]</span>
<span id="cb3-35"><a href="#cb3-35" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span>:references</span> <span>:world</span>_namespaces <span>:ns</span>_name]</span>
<span id="cb3-36"><a href="#cb3-36" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; We would like to strictly permit</span></span>
<span id="cb3-37"><a href="#cb3-37" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; only pre-registered global namespaces.</span></span>
<span id="cb3-38"><a href="#cb3-38" target="_self" aria-hidden="true" tabindex="-1"></a>   ]]}</span></code></pre></div>
<h3 id="honeysql-constrain-world-entities">HoneySQL: Constrain World Entities</h3>
<figure>
<img src="https://www.oregonlive.com/silicon-forest/2025/07/poor-mans-bitemporal-sqlite-db-world-entities.png"/>
<figcaption>&#34;World Entities&#34;.</figcaption>
</figure>
<p>Entity namespacing is according to the global standard—<code>some.name.space/the-entity-name</code>—constrained by our namespaces schema. So entity IDs could be: <code>com.acme/adi,
com.acme/file, com.acme/category, com.acme/tag, com.acme/user-role</code>.</p>
<div id="cb4"><pre><code><span id="cb4-1"><a href="#cb4-1" target="_self" aria-hidden="true" tabindex="-1"></a>{<span>:create-table</span> [<span>:world</span>_entities <span>:if-not-exists</span>]</span>
<span id="cb4-2"><a href="#cb4-2" target="_self" aria-hidden="true" tabindex="-1"></a> <span>:with-columns</span></span>
<span id="cb4-3"><a href="#cb4-3" target="_self" aria-hidden="true" tabindex="-1"></a> [[<span>:rowid</span> <span>:integer</span> <span>:primary-key</span>]</span>
<span id="cb4-4"><a href="#cb4-4" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:ns</span>_entity_id</span>
<span id="cb4-5"><a href="#cb4-5" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:text</span> [<span>:not</span> <span>nil</span>] [<span>:unique</span>]</span>
<span id="cb4-6"><a href="#cb4-6" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span>:check</span> [:= <span>:ns</span>_entity_id [<span>:trim</span> <span>:ns</span>_entity_id]]]</span>
<span id="cb4-7"><a href="#cb4-7" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; com.acme/adi, com.acme/file, com.acme/category</span></span>
<span id="cb4-8"><a href="#cb4-8" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; com.acme/tag, com.acme/user-role</span></span>
<span id="cb4-9"><a href="#cb4-9" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb4-10"><a href="#cb4-10" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:ns</span>_name <span>:text</span> [<span>:not</span> <span>nil</span>]</span>
<span id="cb4-11"><a href="#cb4-11" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:generated-always</span> <span>:as</span> [[<span>:text</span>_split <span>:ns</span>_entity_id <span>&#34;/&#34;</span> <span>1</span>]]</span>
<span id="cb4-12"><a href="#cb4-12" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:stored</span></span>
<span id="cb4-13"><a href="#cb4-13" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; com.acme</span></span>
<span id="cb4-14"><a href="#cb4-14" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb4-15"><a href="#cb4-15" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:entity</span>_name</span>
<span id="cb4-16"><a href="#cb4-16" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:text</span> [<span>:not</span> <span>nil</span>]</span>
<span id="cb4-17"><a href="#cb4-17" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:generated-always</span> <span>:as</span> [[<span>:text</span>_split <span>:ns</span>_entity_id <span>&#34;/&#34;</span> <span>2</span>]]</span>
<span id="cb4-18"><a href="#cb4-18" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:stored</span></span>
<span id="cb4-19"><a href="#cb4-19" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; adi, file, category, tag, user-role</span></span>
<span id="cb4-20"><a href="#cb4-20" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb4-21"><a href="#cb4-21" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:entity</span>_type</span>
<span id="cb4-22"><a href="#cb4-22" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:text</span> [<span>:not</span> <span>nil</span>]</span>
<span id="cb4-23"><a href="#cb4-23" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span>:default</span> <span>&#34;UNSPECIFIED&#34;</span>]</span>
<span id="cb4-24"><a href="#cb4-24" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; &#34;:user/actor&#34; &#34;:user/role&#34; &#34;:content/file&#34;</span></span>
<span id="cb4-25"><a href="#cb4-25" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; &#34;:content/category&#34; &#34;:content/tag&#34;</span></span>
<span id="cb4-26"><a href="#cb4-26" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb4-27"><a href="#cb4-27" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:is</span>_active</span>
<span id="cb4-28"><a href="#cb4-28" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:boolean</span> [<span>:not</span> <span>nil</span>]</span>
<span id="cb4-29"><a href="#cb4-29" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span>:default</span> <span>false</span>]</span>
<span id="cb4-30"><a href="#cb4-30" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; sometimes a entity may be deactivated but kept around</span></span>
<span id="cb4-31"><a href="#cb4-31" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb4-32"><a href="#cb4-32" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:is</span>_deleted</span>
<span id="cb4-33"><a href="#cb4-33" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:boolean</span></span>
<span id="cb4-34"><a href="#cb4-34" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span>:not</span> <span>nil</span>] [<span>:default</span> <span>false</span>]</span>
<span id="cb4-35"><a href="#cb4-35" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; signals that entity and all entity data may be garbage-collected</span></span>
<span id="cb4-36"><a href="#cb4-36" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb4-37"><a href="#cb4-37" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:ns</span>_entity_meta <span>:text</span>]</span>
<span id="cb4-38"><a href="#cb4-38" target="_self" aria-hidden="true" tabindex="-1"></a>  [[<span>:foreign-key</span> <span>:ns</span>_name]</span>
<span id="cb4-39"><a href="#cb4-39" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span>:references</span> <span>:world</span>_namespaces <span>:ns</span>_name]]]}</span></code></pre></div>
<h2 id="datomic-single-thread-writes-concurrent-reads">Datomic: Single-thread writes, concurrent reads</h2>
<p>SQLite in WAL mode is the poor man&#39;s single-computer Datomic—one sequential writer, many concurrent readers, mutually non-blocking, with globally atomic transactions. To be clear, Datomic itself can be the poor man&#39;s single-computer Datomic. Ditto for XTDB and Rama. Clojure programmers will do well to study the Clojure <code>agent</code> primitive, to build a good mental model about SQLite in WAL mode.</p>
<h3 id="code-saasy-sqlite-configuration">Code: SaaSy SQLite Configuration</h3>
<p>Some recommended <code>PRAGMA</code> settings to use SQLite as a web backend.</p>
<div id="cb5"><pre><code><span id="cb5-1"><a href="#cb5-1" target="_self" aria-hidden="true" tabindex="-1"></a>{<span>:dbtype</span> <span>&#34;sqlite&#34;</span></span>
<span id="cb5-2"><a href="#cb5-2" target="_self" aria-hidden="true" tabindex="-1"></a> <span>;; INCREMENTAL = 2. Set manually. Not supported by xerial.</span></span>
<span id="cb5-3"><a href="#cb5-3" target="_self" aria-hidden="true" tabindex="-1"></a> <span>:auto</span>_vacuum <span>&#34;INCREMENTAL&#34;</span></span>
<span id="cb5-4"><a href="#cb5-4" target="_self" aria-hidden="true" tabindex="-1"></a> <span>:connectionTestQuery</span> <span>&#34;PRAGMA journal_mode;&#34;</span> <span>; used by HikariCP</span></span>
<span id="cb5-5"><a href="#cb5-5" target="_self" aria-hidden="true" tabindex="-1"></a> <span>:preferredTestQuery</span> <span>&#34;PRAGMA journal_mode;&#34;</span> <span>; used by C3P0</span></span>
<span id="cb5-6"><a href="#cb5-6" target="_self" aria-hidden="true" tabindex="-1"></a> <span>;; :maximumPoolSize max-concurrency ; not supported by Xerial</span></span>
<span id="cb5-7"><a href="#cb5-7" target="_self" aria-hidden="true" tabindex="-1"></a> <span>:dataSourceProperties</span></span>
<span id="cb5-8"><a href="#cb5-8" target="_self" aria-hidden="true" tabindex="-1"></a> {<span>:limit</span>_worker_threads <span>4</span></span>
<span id="cb5-9"><a href="#cb5-9" target="_self" aria-hidden="true" tabindex="-1"></a>  <span>:enable</span>_load_extension <span>true</span> <span>; disabled by default for security</span></span>
<span id="cb5-10"><a href="#cb5-10" target="_self" aria-hidden="true" tabindex="-1"></a>  <span>:busy</span>_timeout <span>5000</span> <span>; ms, set per connection</span></span>
<span id="cb5-11"><a href="#cb5-11" target="_self" aria-hidden="true" tabindex="-1"></a>  <span>:foreign</span>_keys <span>&#34;ON&#34;</span> <span>; ON = boolean 1, set per connection</span></span>
<span id="cb5-12"><a href="#cb5-12" target="_self" aria-hidden="true" tabindex="-1"></a>  <span>:cache</span>_size -<span>50000</span> <span>; KiB = 50 MiB, set per connection</span></span>
<span id="cb5-13"><a href="#cb5-13" target="_self" aria-hidden="true" tabindex="-1"></a>  <span>:journal</span>_mode <span>&#34;WAL&#34;</span> <span>; supported by xerial JDBC driver</span></span>
<span id="cb5-14"><a href="#cb5-14" target="_self" aria-hidden="true" tabindex="-1"></a>  <span>;; NORMAL = 1, set per connection</span></span>
<span id="cb5-15"><a href="#cb5-15" target="_self" aria-hidden="true" tabindex="-1"></a>  <span>:synchronous</span> <span>&#34;NORMAL&#34;</span>}}</span></code></pre></div>
<p><code>* nb.</code> Some <code>PRAGMAS</code> are set at the DB level, and others are set on a per-connection basis. I&#39;m using HikariCP connection pooling library to help me do this cleanly (paired with xerial&#39;s JDBC driver for SQLite).</p>
<p>However, I <em>might</em> be able to drop HikariCP… the spirit of &#34;fewer dependencies, better life&#34; is hard to ignore. Just look at <a href="https://andersmurphy.com/">Anders Murphy</a>&#39;s <em>neato</em> work on <a href="https://github.com/andersmurphy/hyperlith">hyperlith</a> (&#34;the hypermedia based monolith&#34;, using Datastar and Clojure), and <a href="https://github.com/andersmurphy/sqlite4clj">sqlite4clj</a>. See the hyperlith examples, particularly OneBillionCells: <a href="https://github.com/andersmurphy/hyperlith/tree/master/examples/billion_cells">code</a>, <a href="https://cells.andersmurphy.com/">demo</a>. Rad!</p>
<h2 id="xtdb-all-facts-are-bitemporal-by-design">XTDB: All facts are bitemporal by design</h2>
<p>The full, faithfully recorded, append-only log of world facts, as claimed by any of the pre-registered users, about any of the pre-registered entities, belonging to pre-registered namespaces.</p>
<h3 id="honeysql-our-central-append-only-world-facts-table">HoneySQL: Our central append-only &#34;World Facts&#34; table</h3>
<figure>
<img src="https://www.oregonlive.com/silicon-forest/2025/07/poor-mans-bitemporal-sqlite-db-world-facts.png"/>
<figcaption>&#34;World Facts&#34;.</figcaption>
</figure>
<div id="cb6"><pre><code><span id="cb6-1"><a href="#cb6-1" target="_self" aria-hidden="true" tabindex="-1"></a>{<span>:create-table</span> [<span>:world</span>_facts <span>:if-not-exists</span>]</span>
<span id="cb6-2"><a href="#cb6-2" target="_self" aria-hidden="true" tabindex="-1"></a> <span>:with-columns</span></span>
<span id="cb6-3"><a href="#cb6-3" target="_self" aria-hidden="true" tabindex="-1"></a> [[<span>:rowid</span> <span>:integer</span> <span>:primary-key</span>]</span>
<span id="cb6-4"><a href="#cb6-4" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:txn</span>_id <span>:numeric</span> [<span>:not</span> <span>nil</span>]</span>
<span id="cb6-5"><a href="#cb6-5" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; MUST be a uuidv7</span></span>
<span id="cb6-6"><a href="#cb6-6" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb6-7"><a href="#cb6-7" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:valid</span>_id</span>
<span id="cb6-8"><a href="#cb6-8" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:numeric</span> [<span>:not</span> <span>nil</span>]</span>
<span id="cb6-9"><a href="#cb6-9" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:unique</span> [<span>:default</span> [[<span>:uuid7</span>]]]</span>
<span id="cb6-10"><a href="#cb6-10" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb6-11"><a href="#cb6-11" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:txn</span>_time</span>
<span id="cb6-12"><a href="#cb6-12" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:numeric</span> [<span>:not</span> <span>nil</span>]</span>
<span id="cb6-13"><a href="#cb6-13" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:generated-always</span> <span>:as</span> [[<span>:uuid7</span>_timestamp_ms <span>:txn</span>_id]]</span>
<span id="cb6-14"><a href="#cb6-14" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:stored</span>]</span>
<span id="cb6-15"><a href="#cb6-15" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:valid</span>_time</span>
<span id="cb6-16"><a href="#cb6-16" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:numeric</span> [<span>:not</span> <span>nil</span>]</span>
<span id="cb6-17"><a href="#cb6-17" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:generated-always</span> <span>:as</span> [[<span>:uuid7</span>_timestamp_ms <span>:valid</span>_id]]</span>
<span id="cb6-18"><a href="#cb6-18" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:stored</span>]</span>
<span id="cb6-19"><a href="#cb6-19" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:valid</span>_preferred</span>
<span id="cb6-20"><a href="#cb6-20" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>:boolean</span> [<span>:not</span> <span>nil</span>]</span>
<span id="cb6-21"><a href="#cb6-21" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span>:default</span> <span>false</span>]</span>
<span id="cb6-22"><a href="#cb6-22" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; use this /mutably/ to resolve conflicting valid timelines</span></span>
<span id="cb6-23"><a href="#cb6-23" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb6-24"><a href="#cb6-24" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:e</span> <span>:text</span> [<span>:not</span> <span>nil</span>]] <span>; Entity</span></span>
<span id="cb6-25"><a href="#cb6-25" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:a</span> <span>:text</span> [<span>:not</span> <span>nil</span>]] <span>; Attribute</span></span>
<span id="cb6-26"><a href="#cb6-26" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:v</span> <span>:numeric</span>]         <span>; Value</span></span>
<span id="cb6-27"><a href="#cb6-27" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:assert</span> <span>:boolean</span> [<span>:not</span> <span>nil</span>]]</span>
<span id="cb6-28"><a href="#cb6-28" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:ns</span>_user_ref <span>:numeric</span> [<span>:not</span> <span>nil</span>]]</span>
<span id="cb6-29"><a href="#cb6-29" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span>:fact</span>_meta <span>:numeric</span></span>
<span id="cb6-30"><a href="#cb6-30" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; Use this to /mutably/ attach auditor notes to history data.</span></span>
<span id="cb6-31"><a href="#cb6-31" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; Maybe track addition of the auditor note as a new fact.</span></span>
<span id="cb6-32"><a href="#cb6-32" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb6-33"><a href="#cb6-33" target="_self" aria-hidden="true" tabindex="-1"></a>  [[<span>:foreign-key</span> <span>:ns</span>_user_ref]</span>
<span id="cb6-34"><a href="#cb6-34" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span>:references</span> <span>:world</span>_users <span>:ns</span>_user_id]</span>
<span id="cb6-35"><a href="#cb6-35" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; Permit facts only from known, pre-registered users.</span></span>
<span id="cb6-36"><a href="#cb6-36" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span>:foreign-key</span> <span>:e</span>]</span>
<span id="cb6-37"><a href="#cb6-37" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span>:references</span> <span>:world</span>_entities <span>:ns</span>_entity_id]</span>
<span id="cb6-38"><a href="#cb6-38" target="_self" aria-hidden="true" tabindex="-1"></a>   <span>;; Permit facts only about known, pre-registered entities.</span></span>
<span id="cb6-39"><a href="#cb6-39" target="_self" aria-hidden="true" tabindex="-1"></a>   ]]}</span></code></pre></div>
<h2 id="realities-are-arrows.-time-marks-flight.-uuidv7-is-time.">Realities are arrows. Time marks flight. UUIDv7 is Time.</h2>
<p>Processes are happening. Facts are being recorded. Events occur along a <em>virtual timeline</em>, not a physical one.</p>
<p>Instead of compositing a physical time and a virtual ID into one identifier, why not use a virtual time-is-a-vector style identifier and derive physical time from it for use in our normal day to day SQL queries, <em>in addition to</em> also having an identifier that is a standard requiring no coordination to create, is globally conflict-free, <em>and</em> is SQL DB indexing-friendly as well as query-friendly? In a world where disks are cheap, and data generation is unlimited, we can afford to waste computer resources on giant IDs instead of compact little Integers that overflow.</p>
<p>UUIDv7 helps us express this concept. This is <em>crucial</em> for conflict management.</p>
<p>Our system relies on the <em>guarantee</em> that <code>valid_id</code> is <em>globally unique</em>, even when the UNIX time component of <code>valid-id</code> for multiple colliding facts is the same.</p>
<p>The default decision heuristic is &#34;latest asserted fact wins&#34;. The &#34;last write wins&#34; principle is popularly used by the local-first community too (e.g. in CRDTs).</p>
<p>Of course, this thumb rule is not always acceptable. Humans will disagree about the facts for un-computable reasons.</p>
<p>For example, different editors at the publisher <em>Target</em> may lay different claims to the same titular character name: claim conflicting values, and/or different asserted states. Now they have to duke it out and decide which assertion or redaction should apply for that EA pair at a given physical time.</p>
<table>
<thead>
<tr>
<th><code>valid_ID</code></th>
<th>e</th>
<th>a</th>
<th>v</th>
<th><code>owner_ref</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>01978840-4816-787c-8aab-d39bd088754b</td>
<td>character-id-42</td>
<td>character/name</td>
<td>The Tenth Doctor</td>
<td>com.target/editor-alpha</td>
</tr>
<tr>
<td>01978840-4816-787c-8efg-r8235asdf3rb</td>
<td>character-id-42</td>
<td>character/name</td>
<td>Dr. Who</td>
<td>com.target/editor-bravo</td>
</tr>
<tr>
<td>01978840-4816-787c-098a-757o8ujygasf</td>
<td>character-id-42</td>
<td>character/name</td>
<td>The Doctor</td>
<td>com.target/editor-charlie</td>
</tr>
</tbody>
</table>
<hr/>
<p>The tie-break may be <em>&#34;We compromise on this particular version of facts&#34;</em>&#34;</p>
<div id="cb7" data-org-language="sqlite"><pre><code><span id="cb7-1"><a href="#cb7-1" target="_self" aria-hidden="true" tabindex="-1"></a><span>select</span> <span>*</span> <span>from</span> world_facts</span>
<span id="cb7-2"><a href="#cb7-2" target="_self" aria-hidden="true" tabindex="-1"></a><span>where</span> valid_id <span>=</span> <span>&#39;01978840-4816-787c-8aab-d39bd088754b&#39;</span>;<span>&#34;</span></span></code></pre></div>
<p>We break the tie in our <code>world_facts</code> table, using a boolean column, <code>valid_preferred</code>. We allow in-place updates to this field because that makes life simpler. Alternative tie-break choices:</p>
<ul>
<li><em>&#34;We hereby decree that such-and-such is the preferred version of the facts to use for all as-of queries.&#34;</em></li>
</ul>
<div id="cb8" data-org-language="sqlite"><pre><code><span id="cb8-1"><a href="#cb8-1" target="_self" aria-hidden="true" tabindex="-1"></a><span>update</span> world_facts <span>set</span> valid_preferred <span>=</span> <span>1</span></span>
<span id="cb8-2"><a href="#cb8-2" target="_self" aria-hidden="true" tabindex="-1"></a><span>where</span> valid_id <span>=</span> <span>&#39;01978840-4816-787c-8aab-d39bd088754b&#39;</span>;</span></code></pre></div>
<ul>
<li><em>&#34;First dibs wins&#34;</em>, based on the transaction ID of the E/A pair.</li>
</ul>
<div id="cb9" data-org-language="sqlite"><pre><code><span id="cb9-1"><a href="#cb9-1" target="_self" aria-hidden="true" tabindex="-1"></a><span>update</span> world_facts <span>set</span> valid_preferred <span>=</span> <span>1</span></span>
<span id="cb9-2"><a href="#cb9-2" target="_self" aria-hidden="true" tabindex="-1"></a><span>where</span> e <span>=</span> <span>&#39;character-id-42&#39;</span> <span>and</span></span>
<span id="cb9-3"><a href="#cb9-3" target="_self" aria-hidden="true" tabindex="-1"></a>      a <span>=</span><span>&#39;character/name&#39;</span> <span>and</span></span>
<span id="cb9-4"><a href="#cb9-4" target="_self" aria-hidden="true" tabindex="-1"></a>      txn_id <span>=</span> <span>&#39;01978840-4816-787c-8aab-d39bd088754b&#39;</span>;</span></code></pre></div>
<ul>
<li><em>&#34;Only use Charlie&#39;s choice names for the character; henceforth and retroactively.&#34;</em></li>
</ul>
<div id="cb10" data-org-language="sqlite"><pre><code><span id="cb10-1"><a href="#cb10-1" target="_self" aria-hidden="true" tabindex="-1"></a><span>update</span> world_facts <span>set</span> valid_preferred <span>=</span> <span>1</span></span>
<span id="cb10-2"><a href="#cb10-2" target="_self" aria-hidden="true" tabindex="-1"></a><span>where</span> e <span>=</span> <span>&#39;character-id-42&#39;</span> <span>and</span></span>
<span id="cb10-3"><a href="#cb10-3" target="_self" aria-hidden="true" tabindex="-1"></a>      a <span>=</span><span>&#39;character/name&#39;</span> <span>and</span></span>
<span id="cb10-4"><a href="#cb10-4" target="_self" aria-hidden="true" tabindex="-1"></a>      owner_ref <span>=</span> <span>&#39;com.target/editor-charlie&#39;</span>;</span></code></pre></div>
<p><code>nb.</code> A proper setter query must ensure <code>valid_preferred</code> is set to <code>true</code> for <em>exactly one</em> <code>world_fact</code>, in a set of disputed colliding facts. <em>And</em> it should <em>append a new <code>world_fact</code></em>, stating for the record, that such-and-such <code>valid_id</code> was set to <code>valid_preferred =
true</code> at such-and-such time, by such-and-such user.</p>
<h3 id="honeysql-current-db-is-just-a-view-of-valid-world-facts-as-of-now">HoneySQL: Current DB is just a VIEW of valid World Facts as-of-now</h3>
<figure>
<img src="https://www.oregonlive.com/silicon-forest/2025/07/poor-mans-bitemporal-sqlite-db-world-facts-as-of-now.png"/>
<figcaption>The Current Database: &#34;World Facts As Of Now&#34;.</figcaption>
</figure>
<p>SQLite&#39;s window queries are handy!</p>
<div id="cb11"><pre><code><span id="cb11-1"><a href="#cb11-1" target="_self" aria-hidden="true" tabindex="-1"></a>{<span>:create-view</span> [<span>:world</span>_facts_as_of_now <span>:if-not-exists</span>]</span>
<span id="cb11-2"><a href="#cb11-2" target="_self" aria-hidden="true" tabindex="-1"></a> <span>:select</span> [<span>:rowid</span></span>
<span id="cb11-3"><a href="#cb11-3" target="_self" aria-hidden="true" tabindex="-1"></a>          <span>:txn</span>_time <span>:valid</span>_time</span>
<span id="cb11-4"><a href="#cb11-4" target="_self" aria-hidden="true" tabindex="-1"></a>          <span>:e</span> <span>:a</span> <span>:v</span></span>
<span id="cb11-5"><a href="#cb11-5" target="_self" aria-hidden="true" tabindex="-1"></a>          <span>:ns</span>_user_ref <span>:fact</span>_meta]</span>
<span id="cb11-6"><a href="#cb11-6" target="_self" aria-hidden="true" tabindex="-1"></a> <span>:from</span> {<span>:select</span> [:*</span>
<span id="cb11-7"><a href="#cb11-7" target="_self" aria-hidden="true" tabindex="-1"></a>                 [[<span>:over</span></span>
<span id="cb11-8"><a href="#cb11-8" target="_self" aria-hidden="true" tabindex="-1"></a>                   [[<span>:row</span>_number]</span>
<span id="cb11-9"><a href="#cb11-9" target="_self" aria-hidden="true" tabindex="-1"></a>                    {<span>:partition-by</span> [<span>:e</span> <span>:a</span>],</span>
<span id="cb11-10"><a href="#cb11-10" target="_self" aria-hidden="true" tabindex="-1"></a>                     <span>:order-by</span> [[<span>:valid</span>_preferred <span>:desc</span>]</span>
<span id="cb11-11"><a href="#cb11-11" target="_self" aria-hidden="true" tabindex="-1"></a>                                [<span>:txn</span>_id <span>:desc</span>]]}</span>
<span id="cb11-12"><a href="#cb11-12" target="_self" aria-hidden="true" tabindex="-1"></a>                    <span>:row</span>_num]]]]</span>
<span id="cb11-13"><a href="#cb11-13" target="_self" aria-hidden="true" tabindex="-1"></a>        <span>:from</span> <span>:world</span>_facts}</span>
<span id="cb11-14"><a href="#cb11-14" target="_self" aria-hidden="true" tabindex="-1"></a> <span>:where</span> [<span>:and</span> [:= <span>:row</span>_num <span>1</span>] [:= <span>:assert</span> <span>1</span>]]</span>
<span id="cb11-15"><a href="#cb11-15" target="_self" aria-hidden="true" tabindex="-1"></a> <span>:order-by</span> [[<span>:rowid</span> <span>:asc</span>]]}</span>
<span id="cb11-16"><a href="#cb11-16" target="_self" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<h3 id="honeysql-current-db-indices-and-full-text-search-for-great-good">HoneySQL: Current DB: Indices and Full Text Search for great good</h3>
<p>The DDLs are elided because they are boring.</p>
<p><strong>Indices:</strong> Basically, we may create reverse indices of Facts, to support query patterns, as needed. Some possible indices for day-to-day &#34;online&#34; use, to be created on the &#34;current world facts&#34; view.</p>
<ul>
<li>EAV: Entity, Attribute, Value</li>
<li>EAVTx: EAV, TransactionTime</li>
<li>AEVTx</li>
<li>AVETx</li>
<li>VxAETx: ValidTime, AETx</li>
</ul>
<p>Normally, we wouldn&#39;t want to touch our lynchpin &#34;World Facts&#34; table. Indices consume disk space and that table will grow fast. The same indices might be required for retroactive &#34;audit&#34; use cases. Ideally I would do this sort of querying &#34;offline&#34;, against a snapshot of the primary DB.</p>
<p><strong>For Full Text Search</strong>, I intend to use SQLite&#39;s built-in &#39;FTS5&#39; extension. It requires a bit of SQL writin&#39;—make a Virtual Table, and then write a bunch of Triggers to keep it up-to date. Again, very boring SQL, well documented at the <a href="https://sqlite.org/fts5.html">extension&#39;s page</a>. It just needs writing, is all.</p>
<p>Something like this…</p>
<div id="cb12"><pre><code><span id="cb12-1"><a href="#cb12-1" target="_self" aria-hidden="true" tabindex="-1"></a>(<span>defn</span><span> search-world-facts-as-of-now</span></span>
<span id="cb12-2"><a href="#cb12-2" target="_self" aria-hidden="true" tabindex="-1"></a>  <span>&#34;Run the given search query against the FTS table and</span></span>
<span id="cb12-3"><a href="#cb12-3" target="_self" aria-hidden="true" tabindex="-1"></a><span>   return a match from the original world_facts table.&#34;</span></span>
<span id="cb12-4"><a href="#cb12-4" target="_self" aria-hidden="true" tabindex="-1"></a>  ([where-search-clause-raw-sql]</span>
<span id="cb12-5"><a href="#cb12-5" target="_self" aria-hidden="true" tabindex="-1"></a>   (search-world-facts-as-of-now</span>
<span id="cb12-6"><a href="#cb12-6" target="_self" aria-hidden="true" tabindex="-1"></a>    (<span>partial</span> <span>format</span> <span>&#34;fts_world_facts_as_of_now MATCH %s&#34;</span>)</span>
<span id="cb12-7"><a href="#cb12-7" target="_self" aria-hidden="true" tabindex="-1"></a>    where-search-clause-raw-sql))</span>
<span id="cb12-8"><a href="#cb12-8" target="_self" aria-hidden="true" tabindex="-1"></a>  ([search-term-formatter where-search-clause-raw-sql]</span>
<span id="cb12-9"><a href="#cb12-9" target="_self" aria-hidden="true" tabindex="-1"></a>   (hsql/format</span>
<span id="cb12-10"><a href="#cb12-10" target="_self" aria-hidden="true" tabindex="-1"></a>    {<span>:select</span> [<span>:world</span>_facts.<span>*</span>]</span>
<span id="cb12-11"><a href="#cb12-11" target="_self" aria-hidden="true" tabindex="-1"></a>     <span>:from</span> [<span>:fts</span>_world_facts_as_of_now]</span>
<span id="cb12-12"><a href="#cb12-12" target="_self" aria-hidden="true" tabindex="-1"></a>     <span>:join</span> [<span>:world</span>_facts</span>
<span id="cb12-13"><a href="#cb12-13" target="_self" aria-hidden="true" tabindex="-1"></a>            [:=</span>
<span id="cb12-14"><a href="#cb12-14" target="_self" aria-hidden="true" tabindex="-1"></a>             <span>:fts</span>_world_facts_as_of_now.rowid</span>
<span id="cb12-15"><a href="#cb12-15" target="_self" aria-hidden="true" tabindex="-1"></a>             <span>:world</span>_facts.rowid]]</span>
<span id="cb12-16"><a href="#cb12-16" target="_self" aria-hidden="true" tabindex="-1"></a>     <span>:where</span> [<span>:raw</span> (search-term-formatter</span>
<span id="cb12-17"><a href="#cb12-17" target="_self" aria-hidden="true" tabindex="-1"></a>                   where-search-clause-raw-sql)]</span>
<span id="cb12-18"><a href="#cb12-18" target="_self" aria-hidden="true" tabindex="-1"></a>     <span>:order-by</span> [<span>:rank</span>]}</span>
<span id="cb12-19"><a href="#cb12-19" target="_self" aria-hidden="true" tabindex="-1"></a>    {<span>:inline</span> <span>true</span>})))</span></code></pre></div>
<h2 id="rama-views-are-just-data.-materialize-in-clojure.-not-in-sql.">Rama: Views are just data. Materialize in Clojure. Not in SQL.</h2>
<p>The temporal database does not discriminate when storing facts. Consequently, any given temporal database could contain any of…</p>
<ul>
<li>At least a partial snapshot of at least one Reality,</li>
<li>OR several partial snapshots of one Reality,</li>
<li>OR several partial snapshots of several, possibly alternate and parallel, Realities.</li>
</ul>
<p>The great power (and great responsibility) to decide the <em>concretely materialised reality of the world</em> resides solely in the hands of the party interrogating the temporal database.</p>
<p>Therefore, the temporal database designer must create interrogation tools (query languages, data storage and access formats etc.) so the temporal data engineer can sift through a veritable multiverse, to figure out what &#34;the world&#34; looked like <em>as of <strong>whatever</strong> time</em> interests them.</p>
<p>I have been warned that attempting temporal queries with SQL will cause obnoxious joins, strange indexing schemes, finicky triggers, stored procedures from hell, and non-standard shenanigans specific to the database engine in question. <a href="#fn15" target="_self" id="fnref15" role="doc-noteref"><sup>15</sup></a>.</p>
<p>See James Henderson&#39;s <em>&#34;Building a Bitemporal Index&#34;</em> series—parts <a href="https://xtdb.com/blog/building-a-bitemp-index-1-taxonomy">one</a>, <a href="https://xtdb.com/blog/building-a-bitemp-index-2-resolution">two</a>, and <a href="https://xtdb.com/blog/building-a-bitemp-index-3-storage">three</a>—to get a flavour of temporal query patterns that challenge current databases as well as current data engineers. Haunting questions like <em>Why do you need to use a database with bitemporality baked in anyway?</em></p>
<p>Fortunately, <em>if we play our cards right</em>, this all-you-can-eat pedantic fact-recording can help us create truly general-purpose data systems. For example, <a href="https://github.com/redplanetlabs/specter">Specter</a> is a <a href="https://blog.redplanetlabs.com/2024/04/30/rama-is-a-testament-to-the-power-of-clojure/">critical piece of Rama&#39;s query infrastructure</a>, allowing the system to cheaply query materialised views.</p>
<blockquote>
<p>A lot of Rama programming revolves around materializing views (PStates), which are literally just data structures interacted with using the exact same Specter API as used to interact with in-memory data structures. This stands in stark contrast with databases, which have fixed data models and special APIs for interacting with them. Any database can be replicated in a PState in both expressivity and performance, since a data model is just a specific combination of data structures (e.g. key/value is a map, column-oriented is a map of sorted maps, document is a map of maps, etc.).</p>
</blockquote>
<p>We will <em>embed all on-demand views in code</em>, using plain ol&#39; Clojure transducers and/or Specter&#39;s capabilities.</p>
<p>This endows our vertically integrated tiny-SaaS system with the Poor Man&#39;s cheap copy of <a href="https://redplanetlabs.com/docs/~/tutorial3.html#task-model">Rama&#39;s task model</a> of distributed programming.</p>
<ul>
<li>Views always travel with the web application.</li>
<li>The database is always in-process.</li>
<li>The data file itself is always machine-local.</li>
<li>Each tenant gets their own dedicated SQLite database.</li>
</ul>
<p>Further, it means that <em>migrations occur NOT by futzing with database schemas, but by rolling out a new version of application code</em>.</p>
<p>So, <em>if</em> the database architecture and schema never changes, and I don&#39;t screw up writing to it, then I should never ever need to run a schema migration. In the off-chance that I do need to physically migrate schema, I will be forced to do it in an append-only way, because that&#39;s how SQLite data migrations work the best and safest. Which is a good corner to box oneself into, because it forces us to do <em>nondestructive</em> migrations, be they of schema or of data. This makes gradual roll-outs and complete roll-backs fairly safe.</p>
<p>SQLite has one more compelling feature.</p>
<h2 id="sqlite-flexible-typing-for-the-win">SQLite: Flexible typing for the win</h2>
<p>Without this, the Facts table would be rather ungainly. With flexible typing, our &#39;numeric&#39; values are stored as efficiently as they can be stored. Numbers are stored as numbers. Text is stored as text. Booleans are stored as booleans. In the very same column.</p>
<p>However, it does not protect us the way Datomic, XTDB, and Rama do. We have to make our own guardrails to safely use SQLite as if it were a temporal database.</p>
<ul>
<li>Work against a strictly constrained world (namespaces, users, entities)</li>
<li>Emulate immutability for the most part (append-only facts).</li>
<li>Use Idempotence (upsert entities -&gt; facts)</li>
<li>Facts must include all actions happening within the world, including addition, removal, updates to namespaces, users, entities, fact meta-data, and set-preferred-fact choices.</li>
</ul>
<p>Something like this…</p>
<h3 id="transact-facts-append-only">Transact Facts: Append-only</h3>
<div id="cb13"><pre><code><span id="cb13-1"><a href="#cb13-1" target="_self" aria-hidden="true" tabindex="-1"></a>(<span>defn</span><span> append-facts!</span></span>
<span id="cb13-2"><a href="#cb13-2" target="_self" aria-hidden="true" tabindex="-1"></a>  ([tx facts]</span>
<span id="cb13-3"><a href="#cb13-3" target="_self" aria-hidden="true" tabindex="-1"></a>   (append-facts! tx facts <span>nil</span>))</span>
<span id="cb13-4"><a href="#cb13-4" target="_self" aria-hidden="true" tabindex="-1"></a>  ([tx facts owned-by-ns-user-id]</span>
<span id="cb13-5"><a href="#cb13-5" target="_self" aria-hidden="true" tabindex="-1"></a>   (jdbc/execute! tx</span>
<span id="cb13-6"><a href="#cb13-6" target="_self" aria-hidden="true" tabindex="-1"></a>                  (<span>-&gt;</span> facts</span>
<span id="cb13-7"><a href="#cb13-7" target="_self" aria-hidden="true" tabindex="-1"></a>                      (insert-world-facts-hsql</span>
<span id="cb13-8"><a href="#cb13-8" target="_self" aria-hidden="true" tabindex="-1"></a>                       owned-by-ns-user-id)</span>
<span id="cb13-9"><a href="#cb13-9" target="_self" aria-hidden="true" tabindex="-1"></a>                      hsql/format))))</span></code></pre></div>
<h3 id="transact-entities-namespaces-users-idempotently">Transact Entities, Namespaces, Users Idempotently</h3>
<p><em>And</em> append corresponding facts in the world-facts table too. Yes, it doubles up as an audit log for things that were <em>done to the World</em> itself, in addition to things happened inside the World.</p>
<div id="cb14"><pre><code><span id="cb14-1"><a href="#cb14-1" target="_self" aria-hidden="true" tabindex="-1"></a>(<span>defn</span><span> transact-entities-&gt;facts</span></span>
<span id="cb14-2"><a href="#cb14-2" target="_self" aria-hidden="true" tabindex="-1"></a>  [tx entity-records fact-data]</span>
<span id="cb14-3"><a href="#cb14-3" target="_self" aria-hidden="true" tabindex="-1"></a>  (<span>and</span> (<span>seq</span> (upsert-entities! tx entity-records))</span>
<span id="cb14-4"><a href="#cb14-4" target="_self" aria-hidden="true" tabindex="-1"></a>       (append-facts! tx</span>
<span id="cb14-5"><a href="#cb14-5" target="_self" aria-hidden="true" tabindex="-1"></a>                      (transduce</span>
<span id="cb14-6"><a href="#cb14-6" target="_self" aria-hidden="true" tabindex="-1"></a>                       (record-&gt;fact-xf <span>&#34;world_entities&#34;</span></span>
<span id="cb14-7"><a href="#cb14-7" target="_self" aria-hidden="true" tabindex="-1"></a>                                        <span>:ns</span>_entity_id</span>
<span id="cb14-8"><a href="#cb14-8" target="_self" aria-hidden="true" tabindex="-1"></a>                                        fact-data)</span>
<span id="cb14-9"><a href="#cb14-9" target="_self" aria-hidden="true" tabindex="-1"></a>                       <span>conj</span> []</span>
<span id="cb14-10"><a href="#cb14-10" target="_self" aria-hidden="true" tabindex="-1"></a>                       entity-records))))</span>
<span id="cb14-11"><a href="#cb14-11" target="_self" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" target="_self" aria-hidden="true" tabindex="-1"></a>(<span>defn</span><span> transact-namespaces-&gt;entities-&gt;facts</span></span>
<span id="cb14-13"><a href="#cb14-13" target="_self" aria-hidden="true" tabindex="-1"></a>  [tx ns-records fact-data]</span>
<span id="cb14-14"><a href="#cb14-14" target="_self" aria-hidden="true" tabindex="-1"></a>  (<span>and</span> (<span>seq</span> (upsert-namespaces! tx ns-records))</span>
<span id="cb14-15"><a href="#cb14-15" target="_self" aria-hidden="true" tabindex="-1"></a>       (append-facts! tx</span>
<span id="cb14-16"><a href="#cb14-16" target="_self" aria-hidden="true" tabindex="-1"></a>                      (transduce</span>
<span id="cb14-17"><a href="#cb14-17" target="_self" aria-hidden="true" tabindex="-1"></a>                       (record-&gt;fact-xf <span>&#34;world_namespaces&#34;</span></span>
<span id="cb14-18"><a href="#cb14-18" target="_self" aria-hidden="true" tabindex="-1"></a>                                        <span>:ns</span>_name</span>
<span id="cb14-19"><a href="#cb14-19" target="_self" aria-hidden="true" tabindex="-1"></a>                                        fact-data)</span>
<span id="cb14-20"><a href="#cb14-20" target="_self" aria-hidden="true" tabindex="-1"></a>                       <span>conj</span> []</span>
<span id="cb14-21"><a href="#cb14-21" target="_self" aria-hidden="true" tabindex="-1"></a>                       ns-records))</span>
<span id="cb14-22"><a href="#cb14-22" target="_self" aria-hidden="true" tabindex="-1"></a>       (transact-entities-&gt;facts tx</span>
<span id="cb14-23"><a href="#cb14-23" target="_self" aria-hidden="true" tabindex="-1"></a>                                 (ns-records-&gt;entity-records</span>
<span id="cb14-24"><a href="#cb14-24" target="_self" aria-hidden="true" tabindex="-1"></a>                                  ns-records)</span>
<span id="cb14-25"><a href="#cb14-25" target="_self" aria-hidden="true" tabindex="-1"></a>                                 fact-data)))</span>
<span id="cb14-26"><a href="#cb14-26" target="_self" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" target="_self" aria-hidden="true" tabindex="-1"></a>(<span>defn</span><span> transact-users-&gt;entities-&gt;facts</span></span>
<span id="cb14-28"><a href="#cb14-28" target="_self" aria-hidden="true" tabindex="-1"></a>  [tx user-records fact-data]</span>
<span id="cb14-29"><a href="#cb14-29" target="_self" aria-hidden="true" tabindex="-1"></a>  (<span>and</span> (<span>seq</span> (upsert-users! tx user-records))</span>
<span id="cb14-30"><a href="#cb14-30" target="_self" aria-hidden="true" tabindex="-1"></a>       (append-facts! tx</span>
<span id="cb14-31"><a href="#cb14-31" target="_self" aria-hidden="true" tabindex="-1"></a>                      (transduce</span>
<span id="cb14-32"><a href="#cb14-32" target="_self" aria-hidden="true" tabindex="-1"></a>                       (record-&gt;fact-xf <span>&#34;world_users&#34;</span></span>
<span id="cb14-33"><a href="#cb14-33" target="_self" aria-hidden="true" tabindex="-1"></a>                                        <span>:ns</span>_user_id</span>
<span id="cb14-34"><a href="#cb14-34" target="_self" aria-hidden="true" tabindex="-1"></a>                                        fact-data)</span>
<span id="cb14-35"><a href="#cb14-35" target="_self" aria-hidden="true" tabindex="-1"></a>                                    <span>conj</span> []</span>
<span id="cb14-36"><a href="#cb14-36" target="_self" aria-hidden="true" tabindex="-1"></a>                                    user-records))</span>
<span id="cb14-37"><a href="#cb14-37" target="_self" aria-hidden="true" tabindex="-1"></a>       (transact-entities-&gt;facts tx</span>
<span id="cb14-38"><a href="#cb14-38" target="_self" aria-hidden="true" tabindex="-1"></a>                                 (user-records-&gt;entity-records</span>
<span id="cb14-39"><a href="#cb14-39" target="_self" aria-hidden="true" tabindex="-1"></a>                                  user-records)</span>
<span id="cb14-40"><a href="#cb14-40" target="_self" aria-hidden="true" tabindex="-1"></a>                                 fact-data)))</span></code></pre></div>
<p>One more cool thing about SQLite is that it can totally be used as our &#34;Everything DB Engine&#34; (see: <a href="https://github.com/oldmoe/litestack">oldmoe/litestack</a>), with purpose-specific database files (queue, cache, sessions, documents, key-value store). SQLite&#39;s ability to do cross-database joins will doubtless come handy too.</p>
<h2 id="git-and-local-first-somehow-make-all-facts-merge">Git and Local-First: Somehow make all facts merge</h2>
<p>A fact is a snapshot of an event in time. If we are careful to send facts around so that they are trivial to merge in a facts table, then we can separate out conflict management. Git shows the way. When we fetch changes, the objects are synced to our computer. If a conflict occurs, then what happens to the objects? They remain cached on disk. Git simply refuses to transact the conflict into the live state of the codebase, until someone a) fixes the conflict manually and b) <em>tells git</em> that the conflict is resolved. Git does not know or care about the conflict resolution mechanism. This is because conflicts occur due to essential tacit and implicit context that <em>never</em> travels with the objects. Disambiguation thus requires converging on shared agreement, which is a squishy non-deterministic process at best, chaotic and interminable at worst. Have you heard of laws and lawmakers?</p>
<h2 id="todo-production-engineering-things-one-ought-to-do">TODO: Production engineering things one ought to do</h2>
<p>Things like…</p>
<ul>
<li>Tests for write integrity
<ul>
<li>See if we can use spec / malli to generatively test this</li>
</ul></li>
<li>Model an example domain of sufficient complexity
<ul>
<li>A single example customer (presuming a tenant per DB)</li>
<li>All their users</li>
<li>All their workflows</li>
<li>All their data</li>
</ul></li>
<li>Offload complex joins to the app (specter)
<ul>
<li>But only a pre-filtered subset lifted from the database</li>
</ul></li>
<li>The <code>world_facts</code> table is going to grow very fast. Measure latency at various orders of magnitude, for the same example domain complexity, for the same line-of-business read/write pattern (SaaS-y 80% read, 20% write, for example).
<ul>
<li>1 M facts</li>
<li>10 M facts</li>
<li>100 M facts</li>
<li>1000 M facts</li>
</ul></li>
<li>etc…</li>
</ul>
<p>Basically, try to find out all the ways this will fail to satisfy the &#34;can I get away with it&#34; criterion.</p>

<p>A gaggle of reasons <a href="#fn16" id="fnref16" role="doc-noteref"><sup>16</sup></a> diverted me onto this long road to a small mangy database <a href="#fn17" target="_self" id="fnref17" role="doc-noteref"><sup>17</sup></a>.</p>
<ul>
<li>wannabe be an Independent Software Vendor,</li>
<li>specialised in building niche SaaS products,</li>
<li>operating on dirt-cheap server infrastructure,</li>
<li>with super-duper low maintenance overhead,</li>
<li>while being able to extend the SaaS to local-first usage <a href="#fn18" target="_self" id="fnref18" role="doc-noteref"><sup>18</sup></a></li>
</ul>
<p>As a consequence:</p>
<ul>
<li>Most crucially, I must design and build a system that I can hold in my head <em>and explain to anyone</em>. It is a form of buyer investment protection. If any business buys my software, they must have assurance that not just their data, but the whole application will be <em>accessible</em> to any other competent party they wish to transfer operations and upkeep to. It&#39;s one thing to transfer software and data custody, but a whole other ballgame to transfer <em>ownership</em>.</li>
<li>All SaaS building blocks must be compact, stable, and composable.</li>
<li>Rework must be <em>designed out</em>.</li>
</ul>
<p>The following have been sloshing about my skull, in no particular order:</p>
<ul>
<li>SQLite for web backends</li>
<li>Local First software and private data sovereignty</li>
<li>Entity-Attribute-Value modeling</li>
<li>Bitemporal data systems</li>
<li>The meaning of time</li>
<li>A healthy avoidance of schema migrations</li>
<li>Immutability</li>
<li>Idempotence (often the next-best thing to immutability, and sometimes even better)</li>
<li>Concurrency (especially concurrent read/write independence)</li>
</ul>
<p>At the end of the road, the specific choice of trying this in SQLite boils down to:</p>
<ul>
<li>Necessary Frugality</li>
<li>Necessary Archival</li>
<li>Unnecessarily Having a Smol Grug Brain</li>
<li>Unnecessarily Caring Too Much</li>
<li>Unnecessarily Poor Impulse Control</li>
</ul>
<p>The end customers, in this particular case, survive largely on love and fresh air and the mercurial generosity of arts-supporting sponsors. But that fact is valid for any indie web app I make too. So the SaaS-es must be <em>dirt-cheap</em> to run. And I should be able to <em>trivially</em> power them up and down and up again.</p>
<p>Complete database exports must be made available, on-demand, in a universally query-able, archive-grade format. The database itself must be archive-grade. Only SQLite publicly guarantees availability till 2050. And they are one of a few formats approved by the US Library of Congress for data archival.</p>
<p>Because though We are one, and We are little, and We live like an artist, We care about sovereign data ownership a bit too much, especially when the Sovereign is the poor NPC at the bottom of the B2B food chain.</p>
<p>It must be <em>trivial</em> to store each customer&#39;s data in the appropriate geography. <em>And</em> to offer it for download on demand. And to forget it completely, when asked. And to be able to prove that we&#39;ve done so.</p>
<p>No, we can&#39;t use automagic managed services, because that means deep vendor lock-in.</p>
<p>Last but not least, The Whole Thing <strong>Must</strong> be Single Operator Friendly Especially If Said Operator Will Necessarily Have To Operate Internationally, Meaning They Can Easily Run Afoul Of Data Residency and Privacy Laws That They Cannot Humanly Know Or Keep Abreast Of. Like Ever . <a href="#fn19" target="_self" id="fnref19" role="doc-noteref"><sup>19</sup></a></p>

<h2 id="research-references">Research references</h2>
<ul>
<li>Data and Reality, 2nd Edition (PDF via <a href="https://web.archive.org/web/20250608204041/https://buttondown.com/hillelwayne/archive/data-and-reality-2nd-edition/">Hillel Wayne&#39;s endorsement</a>).</li>
<li><a href="https://people.cs.aau.dk/~csj/Thesis/">Temporal Database Management</a> (April 2000), dr.techn. thesis by Christian S. Jensen.</li>
<li><a href="https://www2.cs.arizona.edu/~rts/tdbbook.pdf">Developing Time-Oriented Database Applications in SQL</a> (year 2000), Richard T. Snodgrass.</li>
</ul>
<h2 id="temporal-data-system-friendly-products">Temporal Data System Friendly Products</h2>
<p>Consult their official documentation, blog, talks.</p>
<ul>
<li><a href="https://clojure.org/">Clojure</a> by Rich Hickey, especially:
<ul>
<li><a href="https://www.youtube.com/watch?v=-6BsiVyC1kM">The Value of Values</a> - Rich Hickey (InfoQ, JaxConf 2012)</li>
<li><a href="https://www.youtube.com/watch?v=Cym4TZwTCNU">Deconstructing the Database</a> - Rich Hickey (InfoQ, JaxConf 2012)</li>
</ul></li>
<li><a href="https://www.datomic.com/">Datomic</a> by Cognitect, especially:
<ul>
<li><a href="https://www.infoq.com/presentations/The-Design-of-Datomic/">The Design of Datomic</a> - Rich Hickey (InfoQ, Clojure/West 2019)</li>
</ul></li>
<li><a href="https://xtdb.com/">XTDB</a> by JUXT, especially:
<ul>
<li><a href="https://www.youtube.com/watch?v=3Stja6YUB94">The Crux of Bitemporality</a> - Jon Pither (Clojure/North 2019)</li>
</ul></li>
<li><a href="https://redplanetlabs.com/">Rama</a> by RedPlanetLabs, especially:
<ul>
<li><a href="https://www.youtube.com/watch?v=25lJNRibYv8">Simple ideas with huge impact from Clojure and Rama</a>, Nathan Marz (reClojure 2025).</li>
</ul></li>
</ul>
<h2 id="affiliations-disclosures">Affiliations / Disclosures</h2>
<ul>
<li>I use Clojure for work and hobby software, and participate in the community.</li>
<li><code>as-of</code> (see what I did there?) publication date, I have no commercial affiliations with any of the products or book publishers listed.</li>
</ul>

<p>A friendly generous wise needlessly self-effacing gentleman and scholar of infinite patience—you know who you are 🍻—who&#39;s simple requirement (really it&#39;s a day&#39;s worth of vibe-coding) precipitated this months long (and ongoing) detour across temporal data rabbit holes.</p>
<p><a href="https://github.com/jarohen">James Henderson</a> and <a href="https://github.com/refset">Jeremy Taylor</a> of the <a href="https://xtdb.com/team">XTDB team</a> generously gave much-needed feedback and encouragement in the Clojurians Slack (see <a href="https://clojurians.slack.com/archives/C1Q164V29/p1746178509141159">thread</a>). Also members of the selfsame Clojurians Slack who are only too happy to have thinky-thoughts together. I visit for Clojure, but stay for <code>#off-topic</code>.</p>


  </section>
  
</article>
  </main>
      
    </div></div>
  </body>
</html>
