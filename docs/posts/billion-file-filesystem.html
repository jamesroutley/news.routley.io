<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.liw.fi/posts/2024/billion/">Original</a>
    <h1>Billion File Filesystem</h1>
    
    <div id="readability-page-1" class="page"><article class="page">
    

    

    <div id="pagebody">
      <section>
	<p>For a lark I made an <code>ext4</code> file system with a billion empty files. <a href="https://gitlab.com/larswirzenius/create-empty-files">https://gitlab.com/larswirzenius/create-empty-files</a> has the program I wrote for this. I’ve done this <a href="https://blog.liw.fi/posts/2020/10/01/a_billion_files/">before</a>, but this time I made it a little simpler for me to do it again: everything in one Rust program rather than clunky scripts.</p>
<p>The disk image starts out as a terabyte-size sparse file, taking no space, and a file system is put in that. Thus, the image is all zeroes except for what actually gets written to it by the file system. With a billion empty files, the image uses 276 GiB disk space. On my desktop machine it took about 26 hours to create.</p>
<p>Compressing makes it smaller:</p>
<table>
<thead>
<tr>
<th>command</th>
<th>size in GiB</th>
<th>size in bytes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gzip -1</code></td>
<td>20</td>
<td>20546385531</td>
</tr>
<tr>
<td><code>gzip -9</code></td>
<td>15</td>
<td>15948883594</td>
</tr>
<tr>
<td><code>xz -T0 -1</code></td>
<td>11</td>
<td>11389236780</td>
</tr>
<tr>
<td><code>xz -T0 -M 60GiB -9</code></td>
<td>10</td>
<td>10465717256</td>
</tr>
</tbody>
</table>
<p>(I did not measure compression times, sorry. If that interests you, you’ll have to do the work yourself.)</p>
<p>If you have a use for such a filesystem, please get in touch. However, if you can spend a day, you can easily create one yourself and save me a bit of bandwidth.</p>
<p>If you’d like a different filesystem, it should be easy enough to adjust the program I wrote to use another filesystem type.</p>
<p>Of what use is a filesystem with many empty files? You could use it to benchmark things that do things to all the files in a directory tree. For example, what is the fastest way to list all those files? Delete them? Back them up? Create an archive file with all of them? (These might be an interesting project for someone in university or college, maybe?)</p>

      </section>
    </div>

  </article></div>
  </body>
</html>
