<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://vectara.com/avoiding-hallucinations-in-llm-powered-applications/">Original</a>
    <h1>LLM Hallucinations: why they occur and how to avoid them</h1>
    
    <div id="readability-page-1" class="page"><div>
			<p><img width="1000" height="571" src="https://vectara.com/wp-content/uploads/2023/04/LLM-Hallucinations-Do-Androids-Dream-1000x571-1.jpg" alt="Android dreaming of sheep in LLM Hallucination" decoding="async" loading="lazy" srcset="https://vectara.com/wp-content/uploads/2023/04/LLM-Hallucinations-Do-Androids-Dream-1000x571-1.jpg 1000w, https://vectara.com/wp-content/uploads/2023/04/LLM-Hallucinations-Do-Androids-Dream-1000x571-1-300x171.jpg 300w, https://vectara.com/wp-content/uploads/2023/04/LLM-Hallucinations-Do-Androids-Dream-1000x571-1-768x439.jpg 768w" sizes="(max-width: 1000px) 100vw, 1000px"/></p>
			<p>grounded generation</p>
			
			<p>LLM hallucinations and how to avoid them with Grounded Generation</p>
			<p>May 2, 2023 by Ofer Mendelevitch</p>
			
<h3 id="h-introduction"><strong>Introduction</strong></h3>



<p>Do Androids dream of electric sheep? </p>



<p>I don’t know, but I do know that large language models like GPT-4, LLama or BARD often do hallucinate.</p>



<p>The launch of ChatGPT and GPT-4 has demonstrated the capabilities of large language models (LLMs) to provide incredible value as a personal assistant, or chatbot, responding to user questions with truly amazing responses. As venture capital continues to pour money into the generative AI space, and hundreds of startups pop up to take advantage of this innovation, the tendency for LLMs to hallucinate (or make up answers) remains a <a href="https://thestack.technology/the-big-hallucination-large-language-models-consciousness/" target="_blank" rel="noreferrer noopener">significant concern</a>.</p>



<h3 id="h-what-is-an-llm-hallucination"><strong>What is an LLM hallucination?</strong></h3>



<p><a href="https://arxiv.org/pdf/2202.03629.pdf" target="_blank" rel="noreferrer noopener">A research paper</a> from the Center for Artificial Intelligence Research (CAiRE) defines a hallucination from an LLM as “when the generated content is nonsensical or unfaithful to the provided source content”. With this simple but inclusive definition, let’s look at a few examples.</p>



<p>When asked “Who owns Silicon Valley Bank?” GPT-4 responds with:</p>



<p><strong>GPT-4:</strong> <em>“Silicon Valley Bank (SVB) is not owned by a single individual or entity. It is a subsidiary of SVB Financial Group, a publicly traded company (NASDAQ: SIVB). The ownership of SVB Financial Group is distributed among individual and institutional shareholders who own its stocks. As a publicly traded company, its ownership can change frequently as shares are bought and sold on the stock market.”</em></p>



<p>Clearly GPT-4 does not know about the recent events involving <a href="https://www.cnn.com/2023/03/11/business/svb-bank-collapse-explainer-timeline/index.html" target="_blank" rel="noreferrer noopener">SVB’s collapse</a>, as its training dataset does not contain any information later than Sep 2021. Because of this, GPT-4 provides an answer that is incorrect, but with a level of confidence that might make a reader believe it is true.</p>



<p>Let’s try another example. </p>



<p>On April 12th 2023, <a href="https://www.databricks.com/blog/2023/04/12/dolly-first-open-commercially-viable-instruction-tuned-llm">Databricks</a><a href="https://www.databricks.com/blog/2023/04/12/dolly-first-open-commercially-viable-instruction-tuned-llm" target="_blank" rel="noreferrer noopener"> </a><a href="https://www.databricks.com/blog/2023/04/12/dolly-first-open-commercially-viable-instruction-tuned-llm">announced</a> their “Dolly 2.0”, a 12B parameter language model that was fine-tuned on a human generated instruction-following dataset, and is completely open source. </p>



<p>When I asked GPT-3.5 “Does Databricks Dolly provide value to the open source community?” the response started with:</p>



<p><strong>GPT 3.5:</strong> <em>Databricks Dolly is a tool developed by Databricks, which is designed to help users migrate their data from one platform to another, particularly from on-premise data centers to cloud-based platforms such as AWS or Azure. While Databricks Dolly is not an open source tool, it can still provide value to the open source community in a few ways.</em></p>



<p><em>…</em></p>



<p><em>[removing the rest of the response to save space]</em></p>



<p>Except for “Databricks Dolly is a tool developed by DataBricks” this is completely incorrect. Dolly is not a tool to migrate data and it is open source, contrary to the response we see.</p>



<p>While these are examples of hallucinations using OpenAI GPT, it’s important to note that this phenomenon applies to many other similar LLMs like Bard or LLama. </p>



<p>So why do hallucinations happen? To explain this, let me first describe in a bit more detail how LLMs work internally and then provide some intuition about why hallucinations occur.</p>



<h3 id="h-llms-as-next-token-prediction-machines"><strong>LLMs as next-token-prediction machines</strong></h3>



<p>To understand the reasons for hallucinations, let’s first remind ourselves how LLMs work, focusing on autoregressive LLMs (like GPT-3 or GPT-4).</p>



<p>At a basic level, LLMs represent any piece of text as a sequence of tokens. These tokens can be words, or sub-words, or even characters. Regardless of which tokenization strategy a specific LLM uses, autoregressive LLMs are trained to accurately predict the <em>next token</em> in a sequence of tokens.</p>



<p>In mathematical terms – given a sequence of tokens T<sub>1</sub>, T<sub>2</sub>, …, T<sub>N</sub>, , the LLM learns the probability distribution of the next token T<sub>N+1</sub> conditioned on the previous tokens:</p>



<p><img decoding="async" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20180%2019%22%3E%3C/svg%3E" data-src="https://vectara.com/wp-content/ql-cache/quicklatex.com-525cd6e69ed7894c9033b0d18ff774ab_l3.png" alt="P(T_{N+1}|T_{1},T_{2},…,T_{N})" title="Rendered by QuickLaTeX.com" height="19" width="180"/></p>



<p>For example, consider the following sequence of tokens (in this case let’s assume tokens are words):</p>



<figure><img decoding="async" width="550" height="153" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20550%20153%22%3E%3C/svg%3E" data-src="https://vectara.com/wp-content/uploads/2023/04/hallucinations-figure1-e1682443275747.png" alt="" data-srcset="https://vectara.com/wp-content/uploads/2023/04/hallucinations-figure1-e1682443275747.png 550w, https://vectara.com/wp-content/uploads/2023/04/hallucinations-figure1-e1682443275747-300x83.png 300w" data-sizes="(max-width: 550px) 100vw, 550px"/><figcaption><strong>Figure 1:</strong> The input to an LLM is a sequence of tokens</figcaption></figure>



<p>Clearly, after the token “went” there are many options for the next token, for example both “home” or “eating” are valid options, as well as many others. In fact, the LLM learns a probability distribution over the set of all possible next tokens:</p>



<figure><img decoding="async" width="660" height="309" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20660%20309%22%3E%3C/svg%3E" data-src="https://vectara.com/wp-content/uploads/2023/04/Hallucinations-figure2-e1682443491773.png" alt="" data-srcset="https://vectara.com/wp-content/uploads/2023/04/Hallucinations-figure2-e1682443491773.png 660w, https://vectara.com/wp-content/uploads/2023/04/Hallucinations-figure2-e1682443491773-300x140.png 300w" data-sizes="(max-width: 660px) 100vw, 660px"/><figcaption><strong>Figure 2:</strong> An LLM estimates the likelihood of each possible next token</figcaption></figure>



<p>This probability distribution assigns a probability to each token, and the LLM samples from this distribution when choosing the next token. </p>



<p>For example the token “home” is the most likely to be chosen by the LLM (with probability 0.12), followed by “eating” (with probability 0.08), then “hiking” and so on. The token “mouse” is very unlikely to follow the previous tokens, and is thus assigned a very low probability (0.00001).</p>



<p>After choosing the next token (let’s say the token “eating” was chosen), it’s appended to the existing sequence of words, and the process is repeated until a full sentence or response is created.</p>



<figure><img decoding="async" width="606" height="133" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20606%20133%22%3E%3C/svg%3E" data-src="https://vectara.com/wp-content/uploads/2023/04/Hallucinations-figure3-e1682443599738.png" alt="" data-srcset="https://vectara.com/wp-content/uploads/2023/04/Hallucinations-figure3-e1682443599738.png 606w, https://vectara.com/wp-content/uploads/2023/04/Hallucinations-figure3-e1682443599738-300x66.png 300w" data-sizes="(max-width: 606px) 100vw, 606px"/><figcaption><strong>Figure 3:</strong> An LLM adds the newly generated token to the current sequence and generates another token. </figcaption></figure>



<p>So here’s the bottom line: large language models are essentially big neural networks that are trained to predict the likelihood of the next token, conditioned on all previous tokens. </p>



<p>When the language model’s predictions contradict our expectations, experiences or prior knowledge, or when we find counter-factual evidence to that response (sequence of predicted tokens) – that’s when we find hallucinations.</p>



<h3 id="h-why-does-an-llm-hallucinate"><strong>Why does an LLM hallucinate?</strong></h3>



<p>One of the main reasons for hallucinations is this: an LLM’s knowledge is defined by its training dataset. When an LLM is trained on a dataset that doesn’t have the knowledge required to answer the question, it may hallucinate a response. But that’s not the only reason. Hallucinations are further complicated by the following factors:</p>



<ul>
<li>An LLM does not have a good way to check the factual accuracy of its responses. It just outputs a response, and it may be completely incorrect yet sound very convincing.</li>



<li>The training dataset used to train the LLM may include fictional content, as well as content that is subjective like opinions and beliefs. </li>



<li>LLMs are not generally optimized to say “I don’t know” when they don’t have enough information.  Therefore, when the LLM has no answer, it generates whatever is the most probable response. But note that “most probable” does not necessarily mean “true”, and when this misalignment happens a hallucination is the end result.</li>
</ul>



<p>Referring back to our example above about Silicon Valley Bank, the model has no knowledge of the recent events that led to SVB’s collapse, and responds (quite confidently, and using the limited information it does have) with an inaccurate response.</p>



<p>Interestingly, what is known as “prompt engineering” is sometimes used to try and “influence” the LLM to believe it’s imitating a specific “persona” with a certain perspective, which influences the way it responds to questions. </p>



<p>For example, it’s popular to ask GPT to explain concepts as if the person is 5-year-old (aka “ELI5”), where essentially you “summon” GPT as the persona of a (patient) parent or teacher in order to explain a complex concept to a young child:</p>



<p><strong>Prompt:</strong> explain like I’m 5 years old, what is the big bang?</p>



<p><strong>GPT-4:</strong> “<em>The Big Bang is the name we give to how the whole universe started a very, very long time ago. It was like a huge explosion that made everything we see in the sky today. Imagine a balloon that starts very small, then someone blows it up and it gets bigger and bigger until it’s really huge. The Big Bang was like that, except instead of a balloon, it was the whole universe that got bigger and bigger.</em>”</p>



<p>When you use prompt engineering to convince the LLM to mimic a certain persona, the types of hallucinations it may produce may change.</p>







<h3 id="h-eliminating-hallucinations-from-llms"><strong>Eliminating hallucinations from LLMs</strong></h3>



<p>Initial efforts to prevent hallucinations focused on collecting human feedback on common queries and integrating that into the language model as a post-processing step. </p>



<p>For example OpenAI used <a href="https://arxiv.org/pdf/1706.03741.pdf" target="_blank" rel="noreferrer noopener">reinforcement learning</a> with human feedback (RHLF), based on the InstructGPT approach, whereas Stanford Alpaca and Databricks Dolly 2.0 use the <a href="https://arxiv.org/pdf/2212.10560.pdf" target="_blank" rel="noreferrer noopener">Self-Instruct</a> supervised fine-tuning approach.</p>



<h3 id="h-how-vectara-eliminates-hallucinations-grounded-generation"><strong>How Vectara eliminates hallucinations – Grounded Generation</strong></h3>



<p>Vectara’s approach goes a step further in addressing hallucinations by using an approach we call <em>Grounded  Generation</em>. </p>



<p>With Grounded Generation (GG), a form of retrieval augmented generation, the LLM provides answers to user queries based not only on the knowledge captured in the dataset the LLM was trained on, but augmented with knowledge coming from searching additional data sources: </p>



<figure><img decoding="async" width="1024" height="315" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%201024%20315%22%3E%3C/svg%3E" data-src="https://vectara.com/wp-content/uploads/2023/04/Hallucinations-figure4-e1682443787508-1024x315.png" alt="" data-srcset="https://vectara.com/wp-content/uploads/2023/04/Hallucinations-figure4-e1682443787508-1024x315.png 1024w, https://vectara.com/wp-content/uploads/2023/04/Hallucinations-figure4-e1682443787508-300x92.png 300w, https://vectara.com/wp-content/uploads/2023/04/Hallucinations-figure4-e1682443787508-768x236.png 768w, https://vectara.com/wp-content/uploads/2023/04/Hallucinations-figure4-e1682443787508.png 1040w" data-sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption><strong>Figure 4:</strong> Grounded Generation: with Vectara, the query is augmented with additional sources of information before the response from the LLM is provided. We call this “ChatGPT with your data”.</figcaption></figure>



<p>For example, in our previous query “who owns silicon valley bank”, we could provide the LLM additional knowledge by providing more up-to-date information from new sources like the New York Times, the Wall Street Journal, or the San Francisco Chronicle.</p>



<p>By properly instructing the LLM to integrate these additional sources, it will provide much better results. Let’s see an example of how this could work. Here are two separate queries for GPT-4:</p>



<p><strong>Query 1: </strong>“Who owns silicon valley bank?”</p>



<p><strong>GPT-4:</strong> <em>“Silicon Valley Bank (SVB) is a subsidiary of SVB Financial Group, a publicly traded company on the NASDAQ stock exchange under the ticker symbol SIVB. As a public company, ownership of SVB Financial Group is distributed among individual and institutional shareholders who own its shares. The largest shareholders can include mutual funds, pension funds, and other investment firms, as well as individual investors. The specific shareholders and their ownership stakes can vary over time as shares are bought and sold on the stock market.”</em></p>



<p><strong>Query 2:</strong> “who owns silicon valley bank? use the below information to provide the most accurate answer: On March 12, 2023, a joint statement was issued by Secretary of the Treasury Janet Yellen, Federal Reserve Chairman Jerome Powell, and FDIC Chairman Martin Gruenberg, stating that all depositors at SVB would be fully protected and would have access to both insured and uninsured deposits starting the following Monday, March 13. The FDIC then established a bridge bank successor, Silicon Valley Bridge Bank, N.A., which quickly assumed ongoing business. On March 27, 2023, First Citizens Bank &amp; Trust Company, a subsidiary of First Citizens BancShares, assumed all customer deposits and acquired all loans of Silicon Valley Bridge Bank from the FDIC and began operating all SVB branches.”</p>



<p><strong>GPT-4</strong>: <em>“Based on the information provided, as of March 27, 2023, Silicon Valley Bank’s deposits and loans were assumed by First Citizens Bank &amp; Trust Company, a subsidiary of First Citizens BancShares. This indicates that First Citizens Bank &amp; Trust Company essentially owns and operates the former Silicon Valley Bank branches, making First Citizens BancShares the ultimate parent company.”</em></p>



<p>As you can see, Grounded Generation provides a much more accurate answer as the LLM is able to take advantage of the additional information provided. </p>



<h3 id="h-the-bottom-line">The bottom line</h3>



<p>LLMs hallucinate when their training dataset has limited, outdated or conflicting information about the question asked of them. </p>



<p>Vectara’s Grounded Generation can all but eliminate hallucinations by augmenting the information available to the LLM with external sources, allowing the response to be based on the most up-to-date and relevant information. </p>



<p>The result is more trust from users in the responses they get from conversational enterprise solutions, resulting in safe and accelerated deployment of LLM technology across a large number of use-cases. This allows developers to focus on the most critical and valuable applications for their business.</p>
		</div></div>
  </body>
</html>
