<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://grossack.site/2025/04/08/analytic-combinatorics-example.html">Original</a>
    <h1>Analytic Combinatorics – A Worked Example</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div>
  
  <h3>
  08 Apr 2025 
  
  
  - Tags: 
    
    
    <a href="https://ntietz.com/tags/sage">sage</a>  
    
    
  
  </h3>

  <p>Another day, another blog post that starts with 
“I was on mse the other day…”. This time, someone asked 
<a href="https://math.stackexchange.com/q/5050941/655547">an interesting question</a> amounting to “how many <em>unordered</em> rooted 
ternary trees with  
nodes are there, up to isomorphism?”. I’m a sucker for these kinds of 
combinatorial problems, and after finding a generating function solution 
I wanted to push myself to get an asymptotic approximation using 
Flajolet–Sedgewick style analytic combinatorics! I’ve never actually 
done this before, so I learned a lot, and I want to share some of the things 
I learned – especially how to do this stuff in <a href="https://sagemath.org">sage</a>!</p>

<p>Now, you might be thinking – didn’t you write a very similar blog post 
<a href="https://ntietz.com/2022/01/20/automatic-asymptotics">three years ago</a>? Yes. Yes I did. Did I also <em>completely</em> forget what 
was in that post? Yes. Yes I did, haha. For some reason I was getting it mixed 
up with this <a href="https://ntietz.com/2021/06/17/iteration-asymptotics">other post</a> from even more years ago, which isn’t nearly 
as relevant. Thankfully it didn’t matter much, 
since I’m fairly sure what I wanted to do wouldn’t work in the framework of 
that post anyways, and now I have a better idea of what this machinery is 
<em>actually doing</em> which is really exciting (since I’ve been 
<em>wanting</em> to understand this stuff for years).</p>

<hr/>

<p>Let’s start with a warmup problem! How might we count the number of 
rooted <em>ordered</em> ternary trees with  nodes?</p>

<p>These are the kinds of “ternary trees” that you might remember from a 
first class on algorithms and data structures. Such a tree is either 
a leaf or an internal node with 1,2, or 3 children. Crucially these 
children come with an <em>order</em>, because the datatype keeps track of which 
child is on the left/right (in the case of 2 children) or on the 
left/middle/right (in the case of 3 children). After all, from a CS 
perspective, we need to remember this in order to traverse the tree!</p>

<p>This means that the following two trees are distinct for our purposes, even 
though they’re isomorphic as graphs:</p>

<p>
<img src="https://ntietz.com/assets/images/analytic-combinatorics-example/two-trees.png" width="50%"/>
</p>

<p>In a functional programming language, you might describe this datatype by</p>

<div><div><pre><code>T z = Leaf z
    | Unary z (T z)
    | Binary z (T z) (T z) 
    | Ternary z (T z) (T z) (T z)
</code></pre></div></div>

<p>and this translates immediately to give a functional equation for the 
<a href="https://en.wikipedia.org/wiki/Generating_function">generating function</a> of , which counts the number of rooted ordered 
ternary trees with  nodes:</p>



<p>We can rearrange this as</p>



<p>so that we can compute the power series expansion of  by 
<a href="https://en.wikipedia.org/wiki/Lagrange_inversion_theorem">lagrange inversion</a>:</p>



<p>Incredibly, this agrees with <a href="https://oeis.org/A036765">A036765</a>, which is the 
“number of ordered rooted trees with n non-root nodes and all outdegrees 
&lt;= three”, as we hoped!</p>

<p>You might reasonably ask if there’s a closed form for these numbers, and 
this is too much to ask for (indeed, it’s already too much to ask for a 
closed form for fibonacci numbers, and this is <em>more</em> complicated). But like 
the fibonacci numbers, we can come up with an excellent approximation:</p>



<p>where  is a constant.</p>

<p>Indeed, this gives <em>fantastic</em> results! Let’s plot the ratio of this 
approximation to the true value so we can see <em>just</em> how good this approximation 
gets as  gets large. Note that it respects the promised big-oh error bound 
too!</p>



<p>This is extremely cool, but <em>where the hell did this approximation come from</em>?</p>

<p>The answer is called <span>Singularity Analysis</span>, and 
can be found in Chapter 2 Section 3 of Melczer’s excellent 
<a href="https://melczer.ca/files/Melczer-SubmittedManuscript.pdf"><em>An Invitation to Analytic Combinatorics</em></a>, or Chapters VI and VII 
of Flajolet and Sedgewick’s <a href="https://algo.inria.fr/flajolet/Publications/book.pdf">tome</a>. See especially Theorem 
VII.3 on pg 468.</p>

<p>Like seemingly every theorem in complex analysis, 
this is basically an application of the <a href="https://en.wikipedia.org/wiki/Residue_theorem">Residue Theorem</a>. I won’t say 
too much about why it works, but I’ll at least gesture at a proof. You 
can read the above references if you want something more precise.</p>

<p>First, we <a href="https://en.wikipedia.org/wiki/Cauchy%27s_integral_formula">recall</a></p>



<p>where  is any contour containing the origin inside a region where  
is holomorphic.</p>

<p>Then we draw the most important picture in complex analysis:</p>

<p>
<img src="https://ntietz.com/assets/images/analytic-combinatorics-example/contour.png" width="50%"/>
</p>

<p>Here the obvious marked point is our singularity , and we’ve 
chosen a <a href="https://en.wikipedia.org/wiki/Branch_point#Branch_cuts">branch cut</a> for  (shown in blue<sup id="fnref:4"><a href="#fn:4" rel="footnote" role="doc-noteref">1</a></sup>) so that  is 
holomorphic in the region where the pink curve lives. We’ll estimate 
the value of this integral by estimating the contribution from the big 
circle, the little circle, and the two horizontal pieces<sup id="fnref:5"><a href="#fn:5" rel="footnote" role="doc-noteref">2</a></sup>.</p>

<p>It turns out that the two horizontal pieces basically contribute  
amount to our integral, so we ignore them. Since the big circle is compact,
 will attain a maximal value on it, say . Then the integral along 
the big circle (of radius , say) is bounded by 
</p>

<p>To estimate the integral around the little circle, it would be really 
helpful to have a series expansion at  since we’re staying 
really close to it… <em>Unfortunately</em>,  is a singular point so we 
don’t have a taylor series, but <em>fortunately</em> there’s another tool 
for exactly this job: a <a href="https://en.wikipedia.org/wiki/Puiseux_series">Puiseux Series</a>!</p>

<p>I won’t say much about what these are, especially since 
Richard Borcherds already put out such a <a href="https://www.youtube.com/watch?v=paenRVq0vnc">great video</a> on the topic.
What matters is is that Sage can compute them for us<sup id="fnref:7"><a href="#fn:7" rel="footnote" role="doc-noteref">3</a></sup>, so we can actually 
get our hands on the approximation!</p>

<p>We compute the integral around the little circle to be roughly:</p>



<p>In step  we approximate  by the first term of its puiseux series,
in step  we apply the <a href="https://en.wikipedia.org/wiki/Binomial_theorem#Newton&#39;s_generalized_binomial_theorem">generalized binomial theorem</a>, so that in step 
 we can apply the residue theorem to realize this integral as the 
coefficient of  in our laurent expansion.</p>

<p>This gives us something which grows like ,
dominating the contribution  from the big circle,
so that asymptotically this is the only term that matters. If we were
more careful to keep track of the big-oh error for the puiseux series for  
we could easily sharpen this bound<sup id="fnref:9"><a href="#fn:9" rel="footnote" role="doc-noteref">4</a></sup> to see</p>



<p>This looks a bit weird with the , but remember that  
also alternates sign. Indeed, asymptotics for  are 
<a href="https://en.wikipedia.org/wiki/Binomial_coefficient#Generalized_binomial_coefficients">well known</a> so that we can rewrite this as</p>



<p>Which finally shows us where our magic numbers came from! 
Sage happily tells us that the dominant singularity for  is at 
 and that a puiseux expansion for  at  
is</p>



<p>so that for us , and .</p>

<p>Finally, since  and 
 we see</p>



<p>as promised!</p>

<p>Indeed, here’s how you could actually get sage to do all this for you!</p>



<div>
  <p>As a fun exercise, you might modify this code (using <code>s.add_term()</code>) to 
compute a longer puiseux series and get asymptotics valid up to a 
multiplicative error of  
for the number of rooted ternary trees.</p>

  <p>Try modifying the previous code block to see that our current approximation 
is <em>not</em> accurate to , and then 
check that your approximation <em>is</em>!</p>
</div>

<hr/>

<p>Ok, now that we understand the warmup, let’s get to the actual problem!</p>

<p>How many <em>unordered</em> rooted ternary trees are there, up to isomorphism?</p>

<p>Now we’re counting up to graph isomorphism, so that our two trees</p>

<p>
<img src="https://ntietz.com/assets/images/analytic-combinatorics-example/two-trees.png" width="50%"/>
</p>

<p><em>are</em> now considered isomorphic. It’s actually much less obvious how one 
might pin down a generating function for something like this, but the 
answer, serendipitously, comes from Pólya-Redfield counting! If this is 
new to you, you might be interested in my recent <a href="https://ntietz.com/2025/01/16/undergrad-divisibility-problems">blog post</a> where 
I talk a bit about one of its corollaries. Today, though, we’ll be using 
it in a much more sophisticated way.</p>

<p>Say you have a structure  acted on by a group  and a collection  
of “colors”. How can we count the number of ways to give each  
a color from , up to the action of ?</p>

<p>We start by building the <a href="https://en.wikipedia.org/wiki/Cycle_index">cycle index polynomial</a> of the action 
, which we call . Then we can 
plug all sorts of things into the variables  in order to solve various 
counting problems. For example, if  is literally just a finite set of colors, 
we can plug in  to recover the expression 
from my recent blog post. But we can also do much more!</p>

<p>Say that  is a possibly infinite family of allowable “colors”, each 
of a fixed “weight”. (For us, our “colors” will be trees, and the “weight” 
will be the number of nodes). Then we can arrange them into a generating 
function , where  counts the number of colors 
of weight <sup id="fnref:11"><a href="#fn:11" rel="footnote" role="doc-noteref">5</a></sup>. Then an easy argument (given in full on the 
<a href="https://en.wikipedia.org/wiki/P%C3%B3lya_enumeration_theorem">wikipedia page</a>) shows that 
is a generating function counting the number of ways to color  
by colors from , counted up to the  action, and sorted by 
their total weight<sup id="fnref:12"><a href="#fn:12" rel="footnote" role="doc-noteref">6</a></sup>. Check out the wikipedia page for a bunch of 
great examples!</p>

<p>
<img src="https://ntietz.com/assets/images/analytic-combinatorics-example/michelle-rodriguez.gif" width="50%"/>
</p>

<p>For us, we realize an unordered rooted ternary tree is either empty, 
or a root with 3 recursive children<sup id="fnref:13"><a href="#fn:13" rel="footnote" role="doc-noteref">7</a></sup>. In the recursive case we 
also want to count up to the obvious  action permuting 
the children, so by the previous discussion we learn that</p>



<p>where 

is the cycle index polynomial for the symmetric group on three letters. 
Plugging this in we see</p>



<p>Now, how might we get asymptotics for  using this functional equation?</p>

<p>First let’s think about how our solution to the warmup worked. We 
wrote  for a polynomial , used the implicit function 
theorem to get a taylor series for  at the origin, then got a 
puiseux series near the dominant singularity  which let us accurately 
estimate the taylor coefficients <sup id="fnref:14"><a href="#fn:14" rel="footnote" role="doc-noteref">8</a></sup>.</p>

<p>We’re going to play the same game here, except we’ll assume that  is 
merely <em>holomorphic</em> rather than a polynomial. Because we’re no longer 
working with a polynomial, this really seems to require an infinite amount 
of data, so I’m not sure how one might get an exact solution for the relevant
constants… But following Section VII.5 in Flajolet and Sedgewick we can get 
as precise a numerical solution as we like!</p>

<p>We’ll assume that the functions  and  are already known 
analytic functions, so that we can write
.
This is an analytic function satisfying .</p>

<p>Now for a touch of magic. Say we can find a pair  with both
 and …
Then  is singular in the  direction at  so this is a branch
point for . Since both  and  
vanish at  the taylor series for  at  starts</p>



<p>Since we know  vanishes, we estimate up to smaller order terms</p>



<p>so that a puiseux series for  at  begins</p>



<p>If we write  and are 
slightly more careful with our error terms, the same technique from the 
warmup shows</p>



<p>See Flajolet and Sedgewick Theorem VII.3 on page 468 for a more careful 
proof of this theorem.</p>

<p>Now how do we <em>use</em> this? We can approximate  by its taylor series 
at the origin, then numerically solve for the unique<sup id="fnref:10"><a href="#fn:10" rel="footnote" role="doc-noteref">9</a></sup> positive real solution
to the system  using this approximation:</p>



<p>If we run this code locally with , we get the approximation</p>



<p>so that we expect</p>



<p>and indeed this seems to work really well!
Our taylor expansion for  agrees with <a href="https://oeis.org/A000598">A000598</a>, as we expected, 
and comparing our approximation to our taylor expansion gives:</p>



<p>I’m pretty proud of this approximation, so I think this is a good 
place to stop ^_^.</p>

<div>
  <p>As a fun exercise, can you write a program that outputs the number 
of <em>cyclic</em> rooted ternary trees on  vertices? For these we consider 
two trees the same if they’re related by cyclicly permuting their children. 
Compare your solution to <a href="https://oeis.org/A000625">A000625</a></p>

  <p>For bonus points, can you check that the number of such trees is, 
asymptotically,</p>



</div>

<hr/>

<p>Wow! It’s been super nice to be writing up so many posts lately! Like 
I said in one of my other recent posts, I’ve had a lot of time to think 
about more bite sized problems and mse stuff while waiting for my DOI 
generating code to run, so I’ve had more things that felt quick to write up 
on my mind.</p>

<p>My research is actually going quite well too! I have a few interesting 
directions to explore, and at least one project that might be wrapping 
up soon. Of course when that happens I’ll be sure to talk about it here, 
and I’m still planning out a series on fukaya categories, hall algebras, 
skein algebras, and more! That’s a pretty long one, though, so it’s easy 
for me to deprioritize, haha.</p>

<p>It’s already heating up in Riverside, consistently in the 80s (Fahrenheit), 
so I can really feel the summer coming. I’m enjoying the sunny days, though,
and it’s been nice to spend time working outside and under trees.</p>

<p>Thanks for hanging out, all! Take care of each other, and I can’t wait 
to chat soon ^_^.</p>

<hr/>



</div>



    </div></div>
  </body>
</html>
