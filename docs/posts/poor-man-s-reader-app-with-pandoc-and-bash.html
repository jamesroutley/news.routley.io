<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.evalapply.org/posts/reader-app-pandoc-bash/">Original</a>
    <h1>Poor man&#39;s Reader App with Pandoc and Bash</h1>
    
    <div id="readability-page-1" class="page"><div><div>
<p>Throwback, June 27, 2020.</p>
<p>Every so often, I want to avoid opening a website in a browser, for … reasons.</p>
<p>Curl alone presents too much html. I want to try and read stuff.</p>
<p>Today, I was playing with Igor Chubin’s <strong>awesome</strong> terminal services (wttr.in,
cht.sh etc.), and it hit me:</p>
<p>“WAIT, there’s pandoc, what if I just … &#34;</p>
<hr/>
<p>…
…
… and an hour later… a terrible idea manifested itself.</p>
<div><pre tabindex="0"><code data-lang="shell">www_to_md<span>()</span> <span>{</span>
    pandoc --wrap<span>=</span>none -f html -t markdown <span>&#34;</span><span>${</span>1<span>}</span><span>&#34;</span>
<span>}</span>

drop_noise<span>()</span> <span>{</span>
    <span># remove pesky divs</span>
    grep -v -E <span>&#34;(&lt;div|&lt;/div).*[&gt;]?|*.&gt;&#34;</span> |
        <span># squeeze multiple blank lines into one</span>
        cat -s
<span>}</span>

cache_site<span>()</span> <span>{</span>
    local sitecache<span>=</span><span>&#34;</span><span>${</span>1:?<span>&#39;Fail. Path to create cache.&#39;</span><span>}</span><span>&#34;</span>
    local mdfilename<span>=</span><span>&#34;</span><span>${</span>2<span>:-</span><span>&#39;this.md&#39;</span><span>}</span><span>&#34;</span>
    local evict_cache_qmark<span>=</span><span>&#34;</span><span>${</span>3<span>:-</span>no<span>}</span><span>&#34;</span>

    mkdir -p <span>&#34;</span><span>${</span>sitecache<span>}</span><span>&#34;</span>

    <span>if</span> <span>[[</span> -f <span>&#34;</span><span>${</span>sitecache<span>}</span><span>/</span><span>${</span>mdfilename<span>}</span><span>&#34;</span> <span>&amp;&amp;</span> <span>&#34;</span><span>${</span>evict_cache_qmark<span>}</span><span>&#34;</span> <span>==</span> <span>&#34;no&#34;</span> <span>]]</span>
    <span>then</span> tee
    <span>else</span> tee <span>&#34;</span><span>${</span>sitecache<span>}</span><span>/</span><span>${</span>mdfilename<span>}</span><span>&#34;</span>
    <span>fi</span>
<span>}</span>

panwww<span>()</span> <span>{</span>
    local siteurl<span>=</span><span>&#34;</span><span>${</span>1<span>}</span><span>&#34;</span>
    local evict_cache_qmark<span>=</span><span>&#34;</span><span>${</span>2<span>:-</span>no<span>}</span><span>&#34;</span>
    local sitename<span>=</span><span>&#34;</span><span>${</span>siteurl/http*:<span>\/\/</span>/www.<span>}</span><span>&#34;</span>
    local sitecache<span>=</span><span>&#34;/tmp/panwwwcache/</span><span>${</span>sitename<span>}</span><span>&#34;</span>
    local mdfilename<span>=</span><span>&#34;this.md&#34;</span>

    <span>if</span> <span>[[</span> -f <span>&#34;</span><span>${</span>sitecache<span>}</span><span>/</span><span>${</span>mdfilename<span>}</span><span>&#34;</span> <span>&amp;&amp;</span> <span>&#34;</span><span>${</span>evict_cache_qmark<span>}</span><span>&#34;</span> <span>==</span> <span>&#34;no&#34;</span> <span>]]</span>
    <span>then</span> local cmd<span>=</span><span>&#34;cat </span><span>${</span>sitecache<span>}</span><span>/</span><span>${</span>mdfilename<span>}</span><span>&#34;</span>
    <span>else</span> local cmd<span>=</span><span>&#34;www_to_md </span><span>${</span>siteurl<span>}</span><span>&#34;</span>
    <span>fi</span>

    $cmd | drop_noise | cache_site <span>&#34;</span><span>${</span>sitecache<span>}</span><span>&#34;</span> <span>&#34;</span><span>${</span>mdfilename<span>}</span><span>&#34;</span> <span>&#34;</span><span>${</span>evict_cache_qmark<span>}</span><span>&#34;</span>
<span>}</span>
</code></pre></div><p>so that …</p>
<div><pre tabindex="0"><code data-lang="shell">panwww <span>&#34;https://www.recurse.com/&#34;</span> | less <span># fetches site the first time</span>
panwww <span>&#34;https://www.recurse.com/&#34;</span> | less <span># looks up &#34;cache&#34;</span>
panwww <span>&#34;https://www.recurse.com/&#34;</span> <span>&#34;refetch&#34;</span> | less
</code></pre></div>
</div></div></div>
  </body>
</html>
