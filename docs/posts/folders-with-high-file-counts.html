<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bombich.com/blog/2023/01/18/folders-high-file-counts">Original</a>
    <h1>Folders with high file counts</h1>
    
    <div id="readability-page-1" class="page"><div>
    <section id="block-system-main">

      
  <div id="node-1841" about="/blog/2023/01/18/folders-high-file-counts" typeof="sioc:Item foaf:Document">

            <h4>
            <a href="https://bombich.com/blog/categories/trending-topics" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Trending Topics</a>,             <a href="https://bombich.com/blog/categories/performance" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Performance</a>        </h4>

    
    <div>
         <p><img typeof="foaf:Image" src="https://bombich.com/sites/default/files/styles/square_thumbnail/public/pictures/picture-24-1402859365.jpg?itok=OqEJsje3" width="100" height="100" alt="Mike&#39;s picture" title="Mike&#39;s picture"/>  </p>
       <p><span property="dc:date dc:created" content="2023-01-18T12:20:24-05:00" datatype="xsd:dateTime" rel="sioc:has_creator">by <span xml:lang="" about="/staff/mike" typeof="sioc:UserAccount" property="foaf:name" datatype="">Mike</span> | January 18, 2023</span>    </p></div>
  
  <div>
    <div><div><div property="content:encoded"><p>We field a lot of support requests, and similar to a doctor&#39;s office, we see some extreme cases. One of those interesting extreme cases are folders with high file counts. Any time a folder has more than a few thousand items in it, the filesystem is going to be a lot slower when working with that folder. Adding a new file, for example, requires that the filesystem compare the new item name to the name of every other file in the folder to check for conflicts, so trivial tasks like that will take progressively longer as the file count increases. Gathering the enormous file list will also take progressively longer as the list gets larger. The performance hit is even more noticeable on rotational disks and network volumes, so we often see these sticking out in backup tasks.</p>

<h3>Sometimes high folder counts can bring a backup task to a halt</h3>

<p><img alt="Task encountering a folder with a high file count" src="https://bombich.com/images/blog/high-folder-count.jpg" width="846"/></p>

<p>Last week, one of our users found the task as shown above. Upon closer analysis, we determined that the &#34;media&#34; folder had 181,274 files in it. In other words, more than 10% of the files on the whole startup disk were in that &#34;media&#34; folder. In extreme cases like this, the delay to retrieve a file list can be so long (i.e. longer than 10 minutes) that the task aborts with an error, e.g.:</p>

<p><cite>The task was aborted because a subtask did not complete in a reasonable amount of time.</cite> Or,</p>

<p><cite>The task was aborted because the destination filesystem is not responding.</cite></p>

<p>These are typically pretty wild cases that benefit from some human intervention. For example, I recall seeing an AddressBook application support folder that had more than 2.5 <strong>million</strong> image thumbnails in it. Nobody has that many contacts! That wasn&#39;t an isolated incident, either, we&#39;ve seen that same AddressBook folder implicated at least a half dozen times. Cases like that usually point out a software failure in the application that is creating the files – a failure to sanity-check its data store, or to put a sane limit on how many log files it creates. Sometimes, like in the Telegram example above, it&#39;s just short-sighted design.</p>

<p>For a contrasting example, consider how Mail organizes a potentially astronomic list of files. If you navigate to the hidden Library folder in your home folder, then to Mail &gt; V10 &gt; {any UUID} &gt; {any mailbox} &gt; {another UUID} &gt; Data, you&#39;ll see folders named by number, four layers deep, until you finally get to a Messages folder with actual files in it. While this nested hierarchy makes it annoying for a human to find a specific email file, that organization limits any individual folder&#39;s file count and optimizes Mail&#39;s ability to quickly collect those resources from the filesystem.</p>

<h3>Some data stores with potentially-high file counts</h3>

<p>Here&#39;s a list of some common culprits we&#39;ve seen over the last couple of years. If you want to look for these on your own Mac, note that you can hold down the Option key and choose <strong>Library</strong> from the Finder&#39;s <strong>Go</strong> menu to get to that hidden Library folder in your home folder.</p>

<ul>
	<li>/Users/yourname/Library/Application Support/AddressBook</li>
	<li>/Users/yourname/Library/Application Support/Slack/Cache/Cache_Data</li>
	<li>/Users/yourname/Library/Calendars/Calendar Sync Changes</li>
	<li>/Users/yourname/Library/Group Containers/6N38VWS5BX.ru.keepcoder.Telegram/appstore/account-{youracct#}/postbox/media</li>
	<li>/Library/Application Support/Fitbit Connect/Minidumps</li>
	<li>/Library/FileMaker Server/Data/Backups</li>
</ul>

<p>Some of these can safely be deleted if you find crazy-high file counts. In some cases, though, you might want to reach out to the software developer to see if they can make a change to how their data is stored to make filesystem access faster. Keep in mind, the performance implications of these high folder counts aren&#39;t limited to the backup task, they could also make the application performance slower, so it&#39;s often to the benefit of the developer to make an adjustment.</p>
</div></div></div>  </div>

  
  
</div>

</section>
  </div></div>
  </body>
</html>
