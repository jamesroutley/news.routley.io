<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/">Original</a>
    <h1>MI300X vs. H100 vs. H200 Benchmark Part 1: Training – CUDA Moat Still Alive</h1>
    
    <div id="readability-page-1" class="page"><div>
<h2 id="intro">Intro</h2>



<p>SemiAnalysis has been on a five-month long quest to settle the reality of MI300X. In theory, the MI300X should be at a huge advantage over Nvidia’s H100 and H200 in terms of specifications and Total Cost of Ownership (TCO). However, the reality is that the on paper specs as given below are not representative of performance that can be expected in a real-world environment. If AMD could deliver the below marketed performance with this memory, it would be a very strong competitor in the market. </p>



<figure><img data-recalc-dims="1" decoding="async" width="2184" height="1088" data-attachment-id="150418455" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/screenshot-3/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/10-H100-vs-H200-vs-MI300X-Basic-Specs-initial-1.jpg?fit=2184%2C1088&amp;ssl=1" data-orig-size="2184,1088" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;Screenshot&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;Screenshot&#34;,&#34;orientation&#34;:&#34;1&#34;}" data-image-title="Screenshot" data-image-description="" data-image-caption="&lt;p&gt;Screenshot&lt;/p&gt;
" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/10-H100-vs-H200-vs-MI300X-Basic-Specs-initial-1.jpg?fit=300%2C149&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/10-H100-vs-H200-vs-MI300X-Basic-Specs-initial-1.jpg?fit=1024%2C510&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/10-H100-vs-H200-vs-MI300X-Basic-Specs-initial-1.jpg?resize=2184%2C1088&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/10-H100-vs-H200-vs-MI300X-Basic-Specs-initial-1.jpg?w=2184&amp;ssl=1 2184w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/10-H100-vs-H200-vs-MI300X-Basic-Specs-initial-1.jpg?resize=300%2C149&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/10-H100-vs-H200-vs-MI300X-Basic-Specs-initial-1.jpg?resize=1024%2C510&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/10-H100-vs-H200-vs-MI300X-Basic-Specs-initial-1.jpg?resize=768%2C383&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/10-H100-vs-H200-vs-MI300X-Basic-Specs-initial-1.jpg?resize=1536%2C765&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/10-H100-vs-H200-vs-MI300X-Basic-Specs-initial-1.jpg?resize=2048%2C1020&amp;ssl=1 2048w" sizes="(max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis, Nvidia, AMD</figcaption></figure>



<p>Today we are going to talk through our five-month journey conducting independent analysis and training-focused benchmarking of the MI300X, the H100 and the H200, engaging with both NVIDIA and AMD. We will do a detailed overview of the numerous low-level benchmarks that we ran, see the table of contents for summary. Furthermore, we will compare the total cost of ownership of Nvidia and AMD GPUs and factor in performance. Ultimately much of what we are doing is openly giving a comprehensive public recommendation to AMD on what they need to do to be competitive and fix their software issues after five months of submitting and squashing bugs. It’s not just that it’s immature software, they need to change how they do development. </p>



<p>In short, when comparing Nvidia’s GPUs to AMD’s MI300X, we found that the potential on paper advantage of the MI300X was not realized due to a lack within AMD public release software stack and the lack of testing from AMD.</p>



<p>AMD’s software experience is riddled with bugs rendering out of the box training with AMD is impossible. We were hopeful that AMD could emerge as a strong competitor to NVIDIA in training workloads, but, as of today, this is unfortunately not the case. The CUDA moat has yet to be crossed by AMD due to AMD’s weaker-than-expected software Quality Assurance (QA) culture and its challenging out of the box experience. <strong>As fast as AMD tries to fill in the CUDA moat, NVIDIA engineers are working overtime to deepen said moat with new features, libraries, and performance updates.</strong></p>



<p>We shared benchmark source code and intermediate test results for GEMM benchmark and Single Node Training with both Nvidia and AMD and held calls and discussions to solicit feedback and implement improvements to the benchmarks, and we worked with AMD to implement bug fixes for the software stacks. </p>



<p>Our goal with this highly iterative interaction was to ensure that our tests are an unbiased evaluation of what real-world users would experience. </p>



<p>We initially planned to publish this article a few months ago but wanted to take the extra time to engage with the AMD team and explore possible fixes or development work. We spent a considerable time identifying and fixing AMD software bugs so that we could give AMD every chance to show MI300X unhindered by AMD software stack bugs as opposed to only showing problematic performance out of the box. To give a fair impression, we also explain the considerable amount of work on tuning and bug-squashing that it took to get there. We think this approach provides users with the best possible level of transparency.  </p>



<p><strong>We wanted to contribute in any way we could to try to improve the AMD ecosystem.</strong> <strong>Though</strong> <strong>AMD software is much better now due to our bug reports and tire-kicking, its public software stack still falls short</strong>. We have open-sourced many of the benchmarks and created simple one-liner commands to reproduce them.</p>



<p>If Lisa Su and the AMD Leadership redouble their investment with a focus on their software and testing stack, they have a chance to be competitive with Nvidia on training. We think the engineers at AMD are extremely capable and are doing their best to advance the AMD ecosystem – and indeed support from these engineers in the form of bug fixes, configuration help and custom images improved the results we were able to get from the MI300X. </p>



<p>To bring our benchmarking process to a coda, on November 15<sup>th</sup>, 2024 we sent Nvidia and AMD a draft of most of our major GEMM and single node benchmarking code and results for comments, verification, and fine-tuning. We asked that any final comments, fixes, feedback and any performance improvements be submitted by November 25<sup>th</sup>. We set this time frame to crystallize test results to allow time to write an in-depth analysis and commentary and carry out multiple rounds of internal and external reviews, all steps that can take a variable and often unknowable amount of time, typically from 2-4 weeks. </p>



<p>A few days ago, after we informed both that we had confirmed an article publication date of December 20<sup>th</sup>, AMD requested that we delay publication to include results based on a beta WIP development build on an AMD developer’s branch. All of our benchmarking on Nvidia was conducted on publicly available stable release builds. In the spirit of transparency and fairness, we include these results as well as updated testing harness results on as the original November 25<sup>th</sup> deadline image and the latest publicly available software. However, we believe that the correct way to interpret the results is to look at the performance of the public stable release of AMD/Nvidia software. </p>



<p><strong>Below are the list of software builds that we have used for benchmarking:</strong></p>



<ul>
<li>H100 Public Stable Release – Out of Box experience for Nvidia H100.</li>



<li>H200 Public Stable Release – Out of Box experience for Nvidia H200.</li>



<li>MI300X Nov 25<sup>th</sup> Custom Build – This is a custom VIP docker image hand-crafted that builds all dependencies from source code written by AMD principal engineers.</li>



<li>MI300X Stable Public Release PyTorch 2.5.1 – Out of Box experience for AMD MI300X.</li>



<li>MI300X Public Nightly Dec 19<sup>th </sup>– This can indicate where AMD performance can be by January 2025, when PyTorch 2.6 is released, over 1 year after launch.</li>



<li>MI300X Dec 21<sup>st</sup> WIP dev build – This is the image that AMD submitted to us after we agreed to delay publication of the article. It is an experimental development build that has not yet been merged into AMD’s internal main branch, and it does not use the native PyTorch flash attention API. Performance with this image can indicate where AMD public stable release performance will be in 1-2 quarters from now.</li>
</ul>



<p>We are very thankful for the technical support provided by AMD and Nvidia throughout this process, but we maintain our independence in the results we publish. We want to shout out to and thank our AMD counterparties, Anush Elangovan (AMD VP of AI), Hui Liu and many dozens of amazing AMD Principal/Senior engineers, AMD VPs of Engineering, AMD Engineering Fellows, AMD CVPs of Engineering and AMD Directors of Engineering, AMD Software Library Leads, for triaging and fixing our various bug reports. On the Nvidia side, we are grateful to Kedar Potdar, Ian Buck, Sylvain Jeaugey and the NCCL team from NVIDIA for their amazing support. </p>



<p>Thank you to <a href="https://crusoe.ai/cloud">Crusoe</a>, <a href="https://tensorwave.com/">TensorWave</a> (<em>AMD Ventures Portco</em>), <a href="https://nebius.com/">Nebius</a>, <a href="https://lambdalabs.com/">Lambda</a>, <a href="https://hotaisle.xyz/">Hot Aisle</a> <a>and </a><a href="https://smc.co/">Sustainable Metal Cloud (SMC)</a> / <a href="https://firmus.co/">Firmus</a> for the compute and for being supporters of open-source benchmarking. Crusoe, Nebius, SMC / Firmus and Lambda support managed SLURM and shared home directories out of the box. TensorWave currently has managed SLURM in beta and this feature will come to general availability (GA) at the start of next year. Sustainable Metal Cloud is one of the few neoclouds that has <a href="https://mlcommons.org/benchmarks/training/">official MLPerf GPT-3 175B Training results</a>.</p>



<p><strong>We will be releasing a follow up article on inferencing for the H100, H200 and MI300X. We may also release a follow-up article in a few months to follow up on AMD training performance to see if out of box experience has improved and test other models such as LlaVa &amp; Mamba.</strong></p>



<figure><img data-recalc-dims="1" decoding="async" width="2354" height="1244" data-attachment-id="150418456" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/12-thank-you-for-compute-firmus-2/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/12-thank-you-for-compute-FIRMUS-1.png?fit=2354%2C1244&amp;ssl=1" data-orig-size="2354,1244" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="12 thank you for compute FIRMUS" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/12-thank-you-for-compute-FIRMUS-1.png?fit=300%2C159&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/12-thank-you-for-compute-FIRMUS-1.png?fit=1024%2C541&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/12-thank-you-for-compute-FIRMUS-1.png?resize=2354%2C1244&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/12-thank-you-for-compute-FIRMUS-1.png?w=2354&amp;ssl=1 2354w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/12-thank-you-for-compute-FIRMUS-1.png?resize=300%2C159&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/12-thank-you-for-compute-FIRMUS-1.png?resize=1024%2C541&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/12-thank-you-for-compute-FIRMUS-1.png?resize=768%2C406&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/12-thank-you-for-compute-FIRMUS-1.png?resize=1536%2C812&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/12-thank-you-for-compute-FIRMUS-1.png?resize=2048%2C1082&amp;ssl=1 2048w" sizes="(max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<h2 id="key-findings">Key Findings</h2>



<ol>
<li>Comparing on paper FLOP/s and HBM Bandwidth/Capacity is akin to comparing cameras by merely examining megapixel count. The only way to tell the actual performance is to run benchmarking.</li>



<li>Nvidia’s Out of the Box Performance &amp; Experience is amazing, and we did not run into any Nvidia specific bugs during our benchmarks. Nvidia tasked a single engineer to us for technical support, but we didn’t run into any Nvidia software bugs as such we didn’t need much support.</li>



<li>AMD’s Out of the Box Experience is very difficult to work with and can require considerable patience and elbow grease to move towards a usable state. <strong>On most of our benchmarks, Public AMD stable releases of AMD PyTorch is still broken and we needed workarounds</strong>.</li>



<li>If we weren’t supported by multiple teams of AMD engineers triaging and fixing bugs in AMD software that we ran into, AMD’s results would have been much lower than Nvidia’s.</li>



<li>We ran unofficial MLPerf Training GPT-3 175B on 256 H100 in collaboration with Sustainable Metal Cloud to test the effects of different VBoost setting</li>



<li>For AMD, Real World Performance on public stable released software is nowhere close to its on paper marketed TFLOP/s. Nvidia’s real world performance also undershoots its marketing TFLOP/s, but not by nearly as much.</li>



<li>The MI300X has a lower total cost of ownership (TCO) compared to the H100/H200, but training performance per TCO is worse on the MI300X on public stable releases of AMD software. This changes if one uses custom development builds of AMD software. </li>



<li>Training performance is weaker, as demonstrated by the MI300X ‘s matrix multiplication micro-benchmarks, and AMD public release software on single-node training throughput still lags that of Nvidia’s H100 and H200.</li>



<li><strong>MI300X performance is held back by AMD software</strong>. <strong>AMD MI300X software on BF16 development branches have better performance</strong> but has not yet merged into the main branch of AMD’s internal repos. By the time it gets merged into the main branch and into the PyTorch stable release, Nvidia Blackwell will have already been available to everyone.</li>



<li>AMD’s training performance is also held back as the MI300X does not deliver strong scale out performance. This is due to its weaker ROCm Compute Communication Library (RCCL) and AMD’s lower degree of vertical integration with networking and switching hardware compared to Nvidia’s strong integration of its Nvidia Collective Communications Library (NCCL), InfiniBand/Spectrum-X network fabric and switches.</li>



<li>Many of AMD AI Libraries are forks of NVIDIA AI Libraries, leading to suboptimal outcomes and compatibility issues.</li>



<li>AMD customers tend to use hand crafted kernels only for inference, which means their performance outside of very narrow well defined use cases is poor, and their flexibility to rapidly shifting workloads is non-existent.</li>
</ol>



<h2 id="executive-recommendation-to-amd">Executive Recommendation to AMD</h2>



<p><strong>We genuinely want to see another effective competitor to Nvidia and want to help AMD get to that spot</strong>, but, unfortunately, there is still much work to be done on that front. At the bottom of this article, we have a detailed list of feedback for the Lisa Su and the AMD Leadership Team, but provide a summary here:</p>



<ol>
<li>Give AMD Engineers more compute and engineering resources to fix and improve the AMD ecosystem, they have very few internal gpu boxes relative to what Nvidia provides to their engineers. Tensorwave, the largest AMD GPU Cloud has given GPU time for free to a team at AMD to fix software issues, which is insane given they paid for the GPUs.</li>



<li>AMD needs to hook up thousands more of MI300X, MI325X to PyTorch CI/CD for automated testing to ensure there is no AMD performance regressions &amp; functional AMD bugs. Nvidia has given thousands of GPUs for PyTorch CI/CD to ensure an amazing out of box experience</li>



<li>The AMD Executive Team should personally and intensively internally test (i.e., “dogfood”) products that are being shipped to the public rather than focus on testing internal builds. Preferably dogfood during livestream (twitch.tv) to show the authentic out of box experience. This is like how geohotz livestreams</li>



<li>AMD should collaborate with Meta to get production LLM training workloads working as soon as possible on PyTorch ROCm, AMD’s answer to CUDA, as commonly, PyTorch code paths that Meta isn’t using have numerous bugs.</li>



<li>Move away from over-reliance on properly setting numerous environment flags (up to dozens) to make an AMD deployment usable. Instead, bake these settings into the default configuration. Make the out of the box experience usable!</li>



<li>Focus on making out of box experience good instead of over-reliance on custom VIP images that build all dependencies from source code main@specificcommit and take 5 hours to build.</li>



<li>Stop expecting end users to use PYTORCH_TUNABLE_OPS which is a prototype buggy feature and is not respectful of the end users time as it takes ~1 hour for the end user to tune every time an end user wants to make any changes to their code. </li>



<li>AMD should submit MLPerf Training GPT-3 175B results. MLPerf is an apples-to-apples benchmarking methodology that uses time to convergence as the north star.</li>



<li>We want AMD to be competitive and are open to meet with more detailed feedback on how to fix the AMD Datacenter GPU Ecosystem for the better.</li>
</ol>



<h2 id="a-summary-of-the-amd-vs-nvidia-narrative">A Summary of the AMD vs Nvidia Narrative</h2>



<p>Before we dive into various facets of AMD’s software stack that hold AMD back, we will discuss the MI300X’s basic specifications, its comparative total cost of ownership, and how most analysts and investors have evaluated its competitiveness.</p>



<p>The MI300X launched in late 2023 with an exciting set of on paper specifications—featuring 1,307 TFLOP/s of FP16 compute (stronger than the H100’s 989 TFLOP/s), 5.3 TB/s of memory bandwidth, and 192GB of HBM3, 3.35 TB/s of memory bandwidth, and 80GB of HBM3. These specs outstrip those of the H200, which itself is, effectively, a memory-spec bumped version of the H100, delivering 4.8TB/s of memory bandwidth and 141GB of HBM3e. </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="2184" height="1088" data-attachment-id="150418457" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/screenshot-4/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/20-H100-vs-H200-vs-MI300X-Basic-Specs-second-appearance-1.jpg?fit=2184%2C1088&amp;ssl=1" data-orig-size="2184,1088" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;Screenshot&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;Screenshot&#34;,&#34;orientation&#34;:&#34;1&#34;}" data-image-title="Screenshot" data-image-description="" data-image-caption="&lt;p&gt;Screenshot&lt;/p&gt;
" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/20-H100-vs-H200-vs-MI300X-Basic-Specs-second-appearance-1.jpg?fit=300%2C149&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/20-H100-vs-H200-vs-MI300X-Basic-Specs-second-appearance-1.jpg?fit=1024%2C510&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/20-H100-vs-H200-vs-MI300X-Basic-Specs-second-appearance-1.jpg?resize=2184%2C1088&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/20-H100-vs-H200-vs-MI300X-Basic-Specs-second-appearance-1.jpg?w=2184&amp;ssl=1 2184w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/20-H100-vs-H200-vs-MI300X-Basic-Specs-second-appearance-1.jpg?resize=300%2C149&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/20-H100-vs-H200-vs-MI300X-Basic-Specs-second-appearance-1.jpg?resize=1024%2C510&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/20-H100-vs-H200-vs-MI300X-Basic-Specs-second-appearance-1.jpg?resize=768%2C383&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/20-H100-vs-H200-vs-MI300X-Basic-Specs-second-appearance-1.jpg?resize=1536%2C765&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/20-H100-vs-H200-vs-MI300X-Basic-Specs-second-appearance-1.jpg?resize=2048%2C1020&amp;ssl=1 2048w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis, Nvidia, AMD</figcaption></figure>



<p>On paper total cost of ownership for an MI300X deployment is extremely compelling, not only due to the lower ASP of the MI300X, but also because it is typically deployed using cheaper Ethernet networking. Comparing a cluster of 16k H200s vs a 16k MI300X ethernet cluster leads to nearly 40% of the cost savings coming from networking alone, with the remainder of the savings from a lower accelerator cost. The use of Whitebox Ethernet switches is a substantial cost savings compared to using Nvidia’s Quantum-2 switches, but the real difference is cheaper transceivers, as Nvidia branded transceivers cost as much as 2-3x over what a typical transceiver OEM charges.</p>



<p>At face value, the MI300X seems the best of both worlds: higher performance and lower total cost of ownership. At the time of its launch, it was logical to expect share gains to the underdog AMD from this compelling combination. The table below shows total upfront cluster capex – we present a more detailed breakdown of cluster capex components as well as a detailed networking BoM analysis in the sections at near the bottom of the article.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1819" height="619" data-attachment-id="150418458" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/30-h100-vs-h200-vs-mi300x-capex-2/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/30-H100-vs-H200-vs-MI300X-Capex-1.jpg?fit=1819%2C619&amp;ssl=1" data-orig-size="1819,619" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="30 H100 vs H200 vs MI300X Capex" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/30-H100-vs-H200-vs-MI300X-Capex-1.jpg?fit=300%2C102&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/30-H100-vs-H200-vs-MI300X-Capex-1.jpg?fit=1024%2C348&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/30-H100-vs-H200-vs-MI300X-Capex-1.jpg?resize=1819%2C619&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/30-H100-vs-H200-vs-MI300X-Capex-1.jpg?w=1819&amp;ssl=1 1819w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/30-H100-vs-H200-vs-MI300X-Capex-1.jpg?resize=300%2C102&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/30-H100-vs-H200-vs-MI300X-Capex-1.jpg?resize=1024%2C348&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/30-H100-vs-H200-vs-MI300X-Capex-1.jpg?resize=768%2C261&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/30-H100-vs-H200-vs-MI300X-Capex-1.jpg?resize=1536%2C523&amp;ssl=1 1536w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: <a href="https://www.semianalysis.com/p/ai-cloud-tco-model">SemiAnalysis AI TCO Model</a></figcaption></figure>



<p>As orders solidified, excitement built up for potential of the MI300X, helped along by bullish commentary and guidance from AMD. With a compelling spec advantage, it was easy to argue for further upside to AMD’s guidance, which most investors assumed management was sandbagging. AMD had a strong hand, in theory. After all they have mid-single digit market share in datacenter GPUs for 2024 and, logically, a glide path towards even 10-12% market share by 2027 could be conservative while offering considerable earnings upside for AMD.</p>







<p>The earlier bullish line of reasoning was like purchasing a certain car model from a magazine without a test drive or soliciting feedback from owners of that model or reading any reviews. But fear not – SemiAnalysis has put the MI300X, H100, and H200 through their paces at scale and can show why AMD’s current software stack issues decisively disprove this line of reasoning. </p>



<h2 id="general-matrix-multiply-gemm-performance">General Matrix Multiply (GEMM) Performance</h2>



<p>Most FLOPS in a transformer-based architecture (i.e. ChatGPT, Llama, etc.) go towards matrix multiplication, also known as GEMMs. For this reason, <strong>GEMM performance is a good proxy for how well frontier transformers, such as ChatGPT, Llama, Claude, Grok, etc. will train on the hardware</strong>. </p>



<p>GEMMs take two input matrices, Matrix A and Matrix B, with Matrix A having the shape of (M, K), M rows and K columns, and Matrix B having the shape of (K,N) to produce an output matrix of shape (M,N). </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1499" height="1404" data-attachment-id="150418459" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/60-matmul-k-n-overviewgimp-2/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/60-matmul-K-N-overviewGIMP-1.png?fit=1499%2C1404&amp;ssl=1" data-orig-size="1499,1404" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="60 matmul K N overviewGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/60-matmul-K-N-overviewGIMP-1.png?fit=300%2C281&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/60-matmul-K-N-overviewGIMP-1.png?fit=1024%2C959&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/60-matmul-K-N-overviewGIMP-1.png?resize=1499%2C1404&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/60-matmul-K-N-overviewGIMP-1.png?w=1499&amp;ssl=1 1499w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/60-matmul-K-N-overviewGIMP-1.png?resize=300%2C281&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/60-matmul-K-N-overviewGIMP-1.png?resize=1024%2C959&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/60-matmul-K-N-overviewGIMP-1.png?resize=768%2C719&amp;ssl=1 768w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: Nvidia</figcaption></figure>



<p>Conceptually, each element of the resulting matrix is a sum of element-wise multiplications along the “K” dimension of the inputs. For this matter, the K dimension is also known as the reduction dimension.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1875" height="684" data-attachment-id="150418460" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/61-matmul-overview-2/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/61-matmul-overview-1.png?fit=1875%2C684&amp;ssl=1" data-orig-size="1875,684" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="61 matmul overview" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/61-matmul-overview-1.png?fit=300%2C109&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/61-matmul-overview-1.png?fit=1024%2C374&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/61-matmul-overview-1.png?resize=1875%2C684&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/61-matmul-overview-1.png?w=1875&amp;ssl=1 1875w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/61-matmul-overview-1.png?resize=300%2C109&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/61-matmul-overview-1.png?resize=1024%2C374&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/61-matmul-overview-1.png?resize=768%2C280&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/61-matmul-overview-1.png?resize=1536%2C560&amp;ssl=1 1536w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>Below, we have tested the following real-world shapes, given in the form (M,N,K)—which is short for multiplying a matrix of dimensions (M,K) and (K,N) together. </p>



<p>These following matrix shapes were actually used in <a href="https://github.com/pytorch-labs/float8_experimental/blob/fe6e08c867abf56b1acd0f34473c69cde624f0a3/benchmarks/bench_matmul.py#L57">Meta’s Llama 70B</a> production training:</p>



<ul>
<li>(16384, 8192, 1280) – Fused QKV Projection GEMM shape</li>



<li>(16384, 1024, 8192) – Attention Output Projection shape</li>



<li>(16384, 8192, 7168) – FFN GEMM shape</li>



<li>(16384, 3584, 8192) – FFN GEMM shape</li>



<li>(8192, 8192, 8192) – Standard GEMM shape for benchmarking</li>
</ul>



<p>We used OpenAI’s do_bench function for the benchmark setup, an industry standard method of benchmarking PyTorch. The do_bench function provides cache clearing between runs as a default and provides ways to warmup and execute the benchmark multiple times, taking the median result as the given accuracy.  We used warmup=30 and rep=200 for these tests. Both input tensor A and B were randomly initialized with a normal distribution with mean 0 and variance 1. This is because a normal distribution comes the closest to matching the actual distribution of weights and activations in modern neural networks. The distribution of the input tensors will affect the results of the TFLOP/s performance benchmark. We will discuss the reasons why the input distribution effects TFLOP/s performance later in the article.</p>



<p>For BF16, we can see that the H100 and H200 achieves roughly 720 TFLOP/s against their marketed 989.5 TFLOP/s, while the MI300X reaches a mere ~620 TFLOP/s compared with their marketed 1,307 TFLOP/s. </p>



<p>This means that, despite a much higher marketed BF16 TFLOP/s, the MI300X is 14% slower than the H100 and H200. This AMD result used a custom docker image that was hand crafted by an AMD principal engineer yet still achieved slower performance than Nvidia’s GPUs. For our out of the box testing of the MI300X, the TFLOP/s throughput even slower than this! In addition to a custom image, AMD also requires the user to set numerous environment flags that aren’t set by default to reach these performance results. </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1489" height="1084" data-attachment-id="150418461" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/71-bf16-gemm-perf-for-real-world-shapes-w-amd-images/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/71-bf16-gemm-perf-for-real-world-shapes-w-amd-images.png?fit=1489%2C1084&amp;ssl=1" data-orig-size="1489,1084" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="71 bf16 gemm perf for real world shapes w amd images" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/71-bf16-gemm-perf-for-real-world-shapes-w-amd-images.png?fit=300%2C218&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/71-bf16-gemm-perf-for-real-world-shapes-w-amd-images.png?fit=1024%2C745&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/71-bf16-gemm-perf-for-real-world-shapes-w-amd-images.png?resize=1489%2C1084&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/71-bf16-gemm-perf-for-real-world-shapes-w-amd-images.png?w=1489&amp;ssl=1 1489w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/71-bf16-gemm-perf-for-real-world-shapes-w-amd-images.png?resize=300%2C218&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/71-bf16-gemm-perf-for-real-world-shapes-w-amd-images.png?resize=1024%2C745&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/71-bf16-gemm-perf-for-real-world-shapes-w-amd-images.png?resize=768%2C559&amp;ssl=1 768w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>Unfortunately, the story is worse for FP8. The H100/H200 achieves ~1,280 TFLOP/s out of the marketed 1979 TFLOP/s. The MI300X, in comparison, only reaches ~990 TFLOP/s. Thus, for FP8, the MI300X is 22% slower than H100. This is for both inputs being of the e4m3 FP8 (<a href="https://semianalysis.com/2024/01/11/neural-network-quantization-and-number/">i.e. 4 exponent bits and 3 mantissa bits</a>) datatype. </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1514" height="1152" data-attachment-id="150418462" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/81-fp8-gemm-tflops-real-world-shapes-3/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/81-fp8-gemm-tflops-real-world-shapes-2.png?fit=1514%2C1152&amp;ssl=1" data-orig-size="1514,1152" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="81 fp8 gemm tflops real world shapes" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/81-fp8-gemm-tflops-real-world-shapes-2.png?fit=300%2C228&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/81-fp8-gemm-tflops-real-world-shapes-2.png?fit=1024%2C779&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/81-fp8-gemm-tflops-real-world-shapes-2.png?resize=1514%2C1152&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/81-fp8-gemm-tflops-real-world-shapes-2.png?w=1514&amp;ssl=1 1514w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/81-fp8-gemm-tflops-real-world-shapes-2.png?resize=300%2C228&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/81-fp8-gemm-tflops-real-world-shapes-2.png?resize=1024%2C779&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/81-fp8-gemm-tflops-real-world-shapes-2.png?resize=768%2C584&amp;ssl=1 768w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>It is important to note that calling GEMM is a simple task, and we shouldn’t expect to run into AMD software bugs. Unfortunately, a <strong>major bug</strong> that we encountered is that the torch.matmul and F.Linear APIs have been delivering different performances on AMD for a couple of months during the summer. One would expect the torch.matmul and F.Linear APIs to have the same performance, but, surprisingly, F.Linear is much slower!</p>



<p>This is a strange bug as torch.matmul and F.Linear are both wrappers around the hardware vendor GEMM libraries, so they should achieve the same level of performance. F.Linear, in particular, is important, as this is the way most end users in PyTorch launch the GEMM kernels. </p>



<p>When we started testing AMD five months ago, the public AMD PyTorch still had this bug. The root cause was that AMD in fact has two different underlying GEMM libraries, rocBLAS and hipBLASLt, with HipBLASLt being more optimized for the MI300X. The bug was that torch.matmul uses the optimized hipBLASLt, but AMD had not changed F.Linear by default, leaving it to use the unoptimized rocBLAS library. </p>



<p>This major bug was ultimately fixed by AMD a few months ago after our bug reports, and we hope it doesn’t reappear due to a lack of proper regression testing. AMD’s usability could improve considerably if it boosted its testing efforts instead of waiting for users to discover these critical issues.</p>



<p>We have open sourced the GEMM benchmark used in our tests into a simple three liner that anyone can easily run:</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="821" height="571" data-attachment-id="150418463" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/90-amd-vs-nvidia-matmulgimp-v2/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/90-amd-vs-nvidia-matmulGIMP-v2.png?fit=821%2C571&amp;ssl=1" data-orig-size="821,571" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="90 amd vs nvidia matmulGIMP v2" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/90-amd-vs-nvidia-matmulGIMP-v2.png?fit=300%2C209&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/90-amd-vs-nvidia-matmulGIMP-v2.png?fit=821%2C571&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/90-amd-vs-nvidia-matmulGIMP-v2.png?resize=821%2C571&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/90-amd-vs-nvidia-matmulGIMP-v2.png?w=821&amp;ssl=1 821w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/90-amd-vs-nvidia-matmulGIMP-v2.png?resize=300%2C209&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/90-amd-vs-nvidia-matmulGIMP-v2.png?resize=768%2C534&amp;ssl=1 768w" sizes="auto, (max-width: 821px) 100vw, 821px"/><figcaption>Source: <a href="https://www.ray.so/#theme=prisma&amp;darkMode=false&amp;code=IyBBTUQgVklQIGltYWdlCmFsaWFzIGRydW49InN1ZG8gZG9ja2VyIHJ1biAtLXByaXZpbGVnZWQgLS1uZXR3b3JrPWhvc3QgLS1kZXZpY2U9L2Rldi9rZmQgLS1kZXZpY2U9L2Rldi9kcmkgLS1ncm91cC1hZGQgdmlkZW8gLS1jYXAtYWRkPVNZU19QVFJBQ0UgLS1zZWN1cml0eS1vcHQgc2VjY29tcD11bmNvbmZpbmVkIC0taXBjPWhvc3QgLS1zaG0tc2l6ZT0xOTI2IC0tcm0gLWl0IgpkcnVuIHNlbWlhbmFseXNpc3dvcmsvYW1kLW1hdG11bDpsYXRlc3QKRElTQUJMRV9BREROX0hJUF9MVD0wIFBZVE9SQ0hfVFVOQUJMRV9PUF9FTkFCTEVEPTEgcHl0aG9uIG1hdG11bC5weQoKI0FNRCBweXBpIG5pZ2h0bHkKZHJ1biBhbWQtbGF0ZXN0LXB5cGktbmlnaHRseS1tYXRtdWwKUFlUT1JDSF9UVU5BQkxFX09QX0VOQUJMRUQ9MSBweXRob24gbWF0bXVsLnB5CgojIEFNRCBweXBpIHN0YWJsZSBQeVRvcmNoIDIuNS4xCmRydW4gc2VtaWFuYWx5c2lzd29yay9hbWQtbGF0ZXN0LXB5cGktc3RhYmxlLW1hdG11bApQWVRPUkNIX1RVTkFCTEVfT1BfRU5BQkxFRD0xIHB5dGhvbiBtYXRtdWwucHkKCiMgTnZpZGlhIHN0YWJsZSAyNC4wOQphbGlhcyBkcnVuPSJkb2NrZXIgcnVuIC0tcm0gLWl0IC0tZ3B1cyBhbGwgLS1pcGM9aG9zdCAtLW5ldD1ob3N0IC0tc2htLXNpemU9MTkyNiIKZHJ1biBzZW1pYW5hbHlzaXN3b3JrL252aWRpYS1tYXRtdWw6bGF0ZXN0CnB5dGhvbiBtYXRtdWwucHkKCg&amp;language=shell">SemiAnalysis</a></figcaption></figure>



<h2 id="popular-gemm-benchmark-isnt-accurate">Popular GEMM Benchmark Isn’t Accurate</h2>



<p>Recently, a benchmark has been floating around the internet that claims that, on GEMMs, AMD MI300X’s performance is close to that of the H100. </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="548" data-attachment-id="150418464" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/100-mamf-comparison-tablegimp-2/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/100-mamf-comparison-tableGIMP-1.png?fit=2343%2C1254&amp;ssl=1" data-orig-size="2343,1254" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="100 mamf comparison tableGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/100-mamf-comparison-tableGIMP-1.png?fit=300%2C161&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/100-mamf-comparison-tableGIMP-1.png?fit=1024%2C548&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/100-mamf-comparison-tableGIMP-1.png?resize=1024%2C548&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/100-mamf-comparison-tableGIMP-1.png?resize=1024%2C548&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/100-mamf-comparison-tableGIMP-1.png?resize=300%2C161&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/100-mamf-comparison-tableGIMP-1.png?resize=768%2C411&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/100-mamf-comparison-tableGIMP-1.png?resize=1536%2C822&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/100-mamf-comparison-tableGIMP-1.png?resize=2048%2C1096&amp;ssl=1 2048w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: Github</figcaption></figure>



<p>There are two main issues with the benchmark: it isn’t properly carrying out L2 Cache clearing and also is simply taking the max performance, instead of the median/mean TFLOP/s over the course of the iterations for a specific shape. Without L2 Cache clearing between iterations, the benchmark does not accurately reflect real-world GEMM performance. Furthermore, since the TFLOP/s change based on which iteration it is on, you need to use a mean/median over at least 100 iterations as the basis for an accurate GEMM benchmark. OpenAI’s do_bench provides L2 cache and mean/median out of the box by default, so we recommend that engineers use it for micro-benchmarking. Below, we have simplified the benchmark into pseudocode and have commented on the issues mentioned above.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1470" height="880" data-attachment-id="150418550" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/110-replacement-for-bm-test/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/110-replacement-for-bm-test.png?fit=1470%2C880&amp;ssl=1" data-orig-size="1470,880" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="110 replacement for bm test" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/110-replacement-for-bm-test.png?fit=300%2C180&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/110-replacement-for-bm-test.png?fit=1024%2C613&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/110-replacement-for-bm-test.png?resize=1470%2C880&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/110-replacement-for-bm-test.png?w=1470&amp;ssl=1 1470w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/110-replacement-for-bm-test.png?resize=300%2C180&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/110-replacement-for-bm-test.png?resize=1024%2C613&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/110-replacement-for-bm-test.png?resize=768%2C460&amp;ssl=1 768w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<h2 id="hbm-memory-bandwidth-performance">HBM Memory Bandwidth Performance</h2>



<p>It is widely known that AMD MI300X has better memory bandwidth than the Nvidia H100 and H200, offering 5.3 TB/s of bandwidth vs 4.8 TB/s for the H200 and 3.35 TB/s for the H100. Improved HBM memory bandwidth is very useful in inferencing and is sometimes useful in training. In training, users can set a larger batch size if they have more HBM memory capacity and memory bandwidth. Although if a larger global batch size is used, after a certain size, the model will take longer to convergence. It is easy to run fast with big global batch size but at a high level, it will hurt time to convergence.</p>



<p>From our HBM memory bandwidth benchmarking, we see that that MI300X indeed has way better memory bandwidth than both the H200 and the H100. We tested memory bandwidth in Pytorch with Tensor.copy_ &amp; used the industry standard OpenAI do_bench to ensure accuracy.</p>



<p><strong>As you will see in our upcoming H100 vs H200 vs MI300X inference article, memory bandwidth is very important for inferencing.</strong></p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1485" height="1047" data-attachment-id="150418466" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/115-hbm-copy-bandwidth-chart/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/115-HBM-Copy-Bandwidth-Chart.png?fit=1485%2C1047&amp;ssl=1" data-orig-size="1485,1047" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="115 HBM Copy Bandwidth Chart" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/115-HBM-Copy-Bandwidth-Chart.png?fit=300%2C212&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/115-HBM-Copy-Bandwidth-Chart.png?fit=1024%2C722&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/115-HBM-Copy-Bandwidth-Chart.png?resize=1485%2C1047&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/115-HBM-Copy-Bandwidth-Chart.png?w=1485&amp;ssl=1 1485w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/115-HBM-Copy-Bandwidth-Chart.png?resize=300%2C212&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/115-HBM-Copy-Bandwidth-Chart.png?resize=1024%2C722&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/115-HBM-Copy-Bandwidth-Chart.png?resize=768%2C541&amp;ssl=1 768w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="829" height="665" data-attachment-id="150418467" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/117-code-for-bw-test/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/117-code-for-BW-test.png?fit=829%2C665&amp;ssl=1" data-orig-size="829,665" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="117 code for BW test" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/117-code-for-BW-test.png?fit=300%2C241&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/117-code-for-BW-test.png?fit=829%2C665&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/117-code-for-BW-test.png?resize=829%2C665&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/117-code-for-BW-test.png?w=829&amp;ssl=1 829w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/117-code-for-BW-test.png?resize=300%2C241&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/117-code-for-BW-test.png?resize=768%2C616&amp;ssl=1 768w" sizes="auto, (max-width: 829px) 100vw, 829px"/><figcaption>Source: <a href="https://ray.so/#code=aW1wb3J0IHRvcmNoCmltcG9ydCB0cml0b24KCiMgVGVuc29yIHNpemUgKDE2R0IpCnRlbnNvcl9zaXplID0gMTYgKiAxMDI0KiozICAjIDE2IEdCIGluIGJ5dGVzCmR0eXBlID0gdG9yY2guZmxvYXQzMiAgIyBBc3N1bWluZyBmbG9hdDMyICg0IGJ5dGVzIHBlciBlbGVtZW50KQpudW1fZWxlbWVudHMgPSB0ZW5zb3Jfc2l6ZSAvLyA0ICAjIENhbGN1bGF0ZSBudW1iZXIgb2YgZWxlbWVudHMKCiMgQWxsb2NhdGUgdGVuc29ycyBvbiB0aGUgZGV2aWNlCmEgPSB0b3JjaC5yYW5kbihudW1fZWxlbWVudHMsIGRldmljZT0iY3VkYSIsIGR0eXBlPWR0eXBlKQpiID0gdG9yY2guZW1wdHlfbGlrZShhKQoKIyBGdW5jdGlvbiB0byBiZW5jaG1hcmsKZGVmIGNvcHlfdGVuc29yKCk6CiAgICBiLmNvcHlfKGEpCgojIEJlbmNobWFyayB1c2luZyBUcml0b24KdGltZV9tcyA9IHRyaXRvbi50ZXN0aW5nLmRvX2JlbmNoKGNvcHlfdGVuc29yKQoKIyBDYWxjdWxhdGUgYmFuZHdpZHRoCmJhbmR3aWR0aF9nYnBzID0gKHRlbnNvcl9zaXplICogMikgLyAodGltZV9tcyAqIDFlLTMpIC8gMWU5ICAjIE11bHRpcGx5IGJ5IDIgZm9yIHJlYWQgKyB3cml0ZQoKIyBQcmludCByZXN1bHRzCnByaW50KGYiQ29weSBCYW5kd2lkdGg6IHtiYW5kd2lkdGhfZ2JwczouMmZ9IEdCL3MgKHRpbWU6IHt0aW1lX21zOi4yZn0gbXMpIikK&amp;darkMode=false">SemiAnalysis</a></figcaption></figure>



<h2 id="amd-hand-crafted-vip-custom-builds-and-wip-development-builds">AMD Hand-Crafted VIP Custom Builds and WIP Development Builds</h2>



<p>The only reason we have been able to get AMD performance within 75% of H100/H200 performance is because we have been supported by multiple teams at AMD in fixing numerous AMD software bugs. To get AMD to a usable state with somewhat reasonable performance, a giant ~60 command Dockerfile that builds dependencies from source, hand crafted by an AMD principal engineer, was specifically provided for us, since the Pytorch Nightly and public PyTorch AMD images functioned poorly and had version differences. This docker image requires ~5 hours to build from source and installs dependencies and sub-dependencies (hipBLASLt, Triton, PyTorch, TransformerEngine), a huge difference compared to Nvidia, which offers a pre-built, out of the box experience and takes but a single line of code. <strong>Most users do not build Pytorch, hipBLASLt from source code but instead use the stable release.</strong></p>



<p>When using public PyTorch, users have the choice of working with the latest stable images or a nightly PyTorch upload. <strong>So, although a nightly PyTorch upload may have the latest commits that could potentially lead to better performance or could fix some bugs, but users must accept that the upload may not be fully tested and could contain new bugs</strong> from Meta/AMD/Nvidia or other PyTorch contributors that have not been discovered yet. <strong>Note that most end users are using the stable release of PyTorch.</strong></p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="3680" height="7420" data-attachment-id="150418469" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/160-amd-pytorchgimp2/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/160-amd-pytorchGIMP2.png?fit=3680%2C7420&amp;ssl=1" data-orig-size="3680,7420" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="160 amd pytorchGIMP2" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/160-amd-pytorchGIMP2.png?fit=149%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/160-amd-pytorchGIMP2.png?fit=508%2C1024&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/160-amd-pytorchGIMP2.png?resize=3680%2C7420&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/160-amd-pytorchGIMP2.png?w=3680&amp;ssl=1 3680w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/160-amd-pytorchGIMP2.png?resize=149%2C300&amp;ssl=1 149w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/160-amd-pytorchGIMP2.png?resize=508%2C1024&amp;ssl=1 508w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/160-amd-pytorchGIMP2.png?resize=768%2C1549&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/160-amd-pytorchGIMP2.png?resize=762%2C1536&amp;ssl=1 762w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/160-amd-pytorchGIMP2.png?resize=1016%2C2048&amp;ssl=1 1016w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/160-amd-pytorchGIMP2.png?w=2000&amp;ssl=1 2000w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/160-amd-pytorchGIMP2.png?w=3000&amp;ssl=1 3000w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis, AMD</figcaption></figure>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="453" data-attachment-id="150418470" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/170-nvidia-pytorchgimp/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/170-nvidia-pytorchGIMP.png?fit=2124%2C940&amp;ssl=1" data-orig-size="2124,940" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="170 nvidia pytorchGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/170-nvidia-pytorchGIMP.png?fit=300%2C133&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/170-nvidia-pytorchGIMP.png?fit=1024%2C453&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/170-nvidia-pytorchGIMP.png?resize=1024%2C453&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/170-nvidia-pytorchGIMP.png?resize=1024%2C453&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/170-nvidia-pytorchGIMP.png?resize=300%2C133&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/170-nvidia-pytorchGIMP.png?resize=768%2C340&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/170-nvidia-pytorchGIMP.png?resize=1536%2C680&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/170-nvidia-pytorchGIMP.png?resize=2048%2C906&amp;ssl=1 2048w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: Nvidia</figcaption></figure>



<p>Delightfully, Nvidia’s Docker images contain the complete set of developer tools needed for profiling and debugging, like Nsight Compute and Nsight Systems. AMD, in contrast, does not include their OmniTrace developer tool out of the box. </p>



<p>Until a couple weeks ago, the AMD docker images only supported PyTorch 2.3, which released 8 months ago. Mainline PyTorch 2.4 and PyTorch 2.5 have also since released and PyTorch 2.6 is about to come out in Q1 2025. We recommended to an AMD Principal Engineer and to AMD’s VP of AI that AMD should have the latest AMD PyTorch version – AMD has since started publishing containers for some of these AMD PyTorch versions. Docker image for AMD PyTorch 2.5 is still missing.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="2057" height="1098" data-attachment-id="150418471" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/180-contents-of-the-pytorch-containergimp/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/180-contents-of-the-pytorch-containerGIMP.png?fit=2057%2C1098&amp;ssl=1" data-orig-size="2057,1098" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="180 contents of the pytorch containerGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/180-contents-of-the-pytorch-containerGIMP.png?fit=300%2C160&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/180-contents-of-the-pytorch-containerGIMP.png?fit=1024%2C547&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/180-contents-of-the-pytorch-containerGIMP.png?resize=2057%2C1098&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/180-contents-of-the-pytorch-containerGIMP.png?w=2057&amp;ssl=1 2057w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/180-contents-of-the-pytorch-containerGIMP.png?resize=300%2C160&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/180-contents-of-the-pytorch-containerGIMP.png?resize=1024%2C547&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/180-contents-of-the-pytorch-containerGIMP.png?resize=768%2C410&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/180-contents-of-the-pytorch-containerGIMP.png?resize=1536%2C820&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/180-contents-of-the-pytorch-containerGIMP.png?resize=2048%2C1093&amp;ssl=1 2048w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: Nvidia</figcaption></figure>



<h2 id="dec-21st-amd-development-builds">Dec 21st AMD Development Builds</h2>



<p>Below is AMD’s December 21st development build docker image. As you can see, it uses a number of non stable devlopment branches for dependencies such as hipBLASLt, AOTriton, ROCm Attention and installs everything including PyTorch from source code, taking upwards of 5 hours to build. These versions of the dependencies haven’t even been merged into AMD’s own main branch yet.  <strong>99.9% of users will not be installing PyTorch from source code and all of its dependencies from source code on development branches but will instead use the public stable PyPi PyTorch.</strong></p>



<p>Furthermore, instead of using Flash Attention through the PyTorch native user friendly <a href="https://pytorch.org/docs/stable/generated/torch.nn.attention.sdpa_kernel.html">torch. scaled_dot_product_attention</a> API, this AMD Development build imports another library (development branch as well) attention implementation. We have seen more users use Flash Attention through PyTorch native <a href="https://pytorch.org/docs/stable/generated/torch.nn.attention.sdpa_kernel.html">torch. scaled_dot_product_attention</a> API since it is more user friendly and bundled into out of box PyTorch. <a href="https://rocm.blogs.amd.com/artificial-intelligence/flash-attention/README.html#benchmarking-attention">Even AMD’s own public documentation recommends using Flash Attention through torch.scaled_dot_product_attention API</a>. We hope that these kernels get merged into PyTorch flash attention instead of making the end user install a separate library taking hours of their time to build. This is not a user-friendly experience. Furthermore, AMD must support FlexAttention as it has quickly become the go to in the industry. </p>



<p>AMD’s December 21<sup>st</sup> Dev build is on a hanging development branch. That means it is a branch that has not been fully QA’ed and is at use only at a risk branch. There are many concerns about the validity of the results from using a development build and branches and building from source code, as most users are not doing this in real life. Most users will be installing AMD/Nvidia PyTorch from PyPI stable release mostly so we recommend readers keep this in mend when analyzing these results.</p>



<p>That being said, we are including these development build results as it is an indication of where AMD public stable release software will be 1-2 quarters from now. However, at the same time, when it comes to compete, 1-2 quarters from now, Nvidia Blackwell will already be widely deployed, while AMD MI355X will not commence shipments until H2 2025. </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="3680" height="5640" data-attachment-id="150418472" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/190-amd-dec-21th-development-build/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/190-AMD-Dec-21th-Development-Build.png?fit=3680%2C5640&amp;ssl=1" data-orig-size="3680,5640" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="190 AMD Dec 21th Development Build" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/190-AMD-Dec-21th-Development-Build.png?fit=196%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/190-AMD-Dec-21th-Development-Build.png?fit=668%2C1024&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/190-AMD-Dec-21th-Development-Build.png?resize=3680%2C5640&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/190-AMD-Dec-21th-Development-Build.png?w=3680&amp;ssl=1 3680w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/190-AMD-Dec-21th-Development-Build.png?resize=196%2C300&amp;ssl=1 196w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/190-AMD-Dec-21th-Development-Build.png?resize=668%2C1024&amp;ssl=1 668w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/190-AMD-Dec-21th-Development-Build.png?resize=768%2C1177&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/190-AMD-Dec-21th-Development-Build.png?resize=1002%2C1536&amp;ssl=1 1002w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/190-AMD-Dec-21th-Development-Build.png?resize=1336%2C2048&amp;ssl=1 1336w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/190-AMD-Dec-21th-Development-Build.png?w=2000&amp;ssl=1 2000w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/190-AMD-Dec-21th-Development-Build.png?w=3000&amp;ssl=1 3000w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis, AMD</figcaption></figure>



<h2 id="training-testing-methodology-gpt1-5b-llama-8b-llama-70b-mistral">Training Testing Methodology (GPT1.5B, Llama 8B, Llama 70B, Mistral)</h2>



<p>There are many ways to test training performance. The most accurate way is to take a medium-sized AI startup model’s internal codebases and run them on a 512-1024 GPU cluster. This way, the test run has all the optimizations that a typical user would have. Everything else is just a proxy for the performance of these training runs. Training performance takes into account HBM bandwidth, HBM capacity, TFLOP/s, networking, and system architecture. <strong>Comparing on paper HBM bandwidth/capacity is just like comparing on paper camera megapixels.</strong></p>



<p>MLPerf GPT3 175B Training is also a good proxy to measure the time it takes to train to a specific convergence. MLPerf benchmark considers global batch sizes and whether a mixed precision implementation incurs a convergence penalty. Unfortunately, MLPerf is quite difficult to run due to a lack of user-friendly documentation and instructions, and the performance is often min-maxed via a custom tuned configuration specifically concocted for MLPerf that an average user would not adopt. Note that Nvidia has submitted MLPerf Training results with over 11k H100s, while AMD runs MLPerf Training internally. AMD’s results are likely weak, so they have never submitted any MLPerf Training, let alone the MLPerf GPT3 175B benchmark.</p>



<p>When designing our SemiAnalysis benchmark, we wanted to reflect the average user’s model implementation, and so opted for <a href="https://pytorch.org/docs/stable/generated/torch.nn.attention.sdpa_kernel.html">torch. scaled_dot_product_attention</a> API (which uses flash attention backend), PyTorch Distributed Data Parallel (DDP) and/or Fully Sharded Data Parallel (FSDP) with <a href="https://pytorch.org/tutorials/intermediate/torch_compile_tutorial.html">torch.compile</a>. <a href="https://rocm.blogs.amd.com/artificial-intelligence/flash-attention/README.html#benchmarking-attention">Also note that AMD recommends users use torch.scaled_dot_product_attention in their own documentation</a>. We believe this is the most representative of a typical user workload. Further, we used a generic PyTorch native implementation of these models to keep it close to a typical ML Scientist user and make it easy to run with a single line of code. In contrast to MLPerf, the goal of our benchmark is to be as simple to run as possible, while still being a good proxy for performance. Note, since we don’t take into account time to convergence, this benchmark has a slight bias towards AMD as we set the micro batch size higher on AMD vs on Nvidia. When taking time to convergence into account, AMD results will be worse than what is stated.</p>



<p>As an aside, many AI practitioners have said they are not using Megatron or NeMo or 3D Parallelism due to the high level of complexity and lack of flexibility associated with those libraries, whose rigidity and complexity make their usage for ML Research effectively impossible. Note that in terms of 3D Parallelism, both Nvidia and AMD will get higher performance, assuming their software stack works, which is a big assumption for AMD. AMD Megatron is a fork of Nvidia Megatron and has less than 10 stars which means that it is probably not dogfooded well. Submitting bug reports would take <strong>extra months</strong> to get AMD Megatron working for simple models. </p>



<p>For our SemiAnalysis model training benchmark, we will test four models, with the first being a simple GPT 1.5B DDP, as we believe this is representative of what small-scale experiments/ablations would look like before scale-out to bigger model sizes. DDP is a much simpler and less network-intensive form of parallelism. Next, we tested the standard Llama3 8B and Llama3 70B 4 Layer Proxy as a baseline for a popular model’s performance. Third, we tested Mistral 7B v0.1, which evaluates if hardware will perform well when adding a bit of complexity, as Mistral uses sliding window attention instead of the standard causal attention. Modern models such as ChatGPT, Claude, Genimi, o1, o3 do not use standard causal attention &amp; use a complex attention mechanism.</p>



<p>A Modern GPT/Llama/Transformer model is built by stacking the same transformer layer over &amp; over again. As such, measuring the performance of just 4 layers is a great proxy for the overall performance of the model.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="502" height="1141" data-attachment-id="150418473" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/195-modern-gpt-transformer-next-token-probabilities/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/195-Modern-GPT-transformer-Next-Token-Probabilities.png?fit=502%2C1141&amp;ssl=1" data-orig-size="502,1141" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="195 Modern GPT transformer Next Token Probabilities" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/195-Modern-GPT-transformer-Next-Token-Probabilities.png?fit=132%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/195-Modern-GPT-transformer-Next-Token-Probabilities.png?fit=451%2C1024&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/195-Modern-GPT-transformer-Next-Token-Probabilities.png?resize=502%2C1141&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/195-Modern-GPT-transformer-Next-Token-Probabilities.png?w=502&amp;ssl=1 502w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/195-Modern-GPT-transformer-Next-Token-Probabilities.png?resize=132%2C300&amp;ssl=1 132w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/195-Modern-GPT-transformer-Next-Token-Probabilities.png?resize=451%2C1024&amp;ssl=1 451w" sizes="auto, (max-width: 502px) 100vw, 502px"/><figcaption>Source: Imgur</figcaption></figure>



<p>Furthermore, in modern LLM training for all frontier LLM models, pipeline parallelism is used which means that a couple of transformer layers are placed in each GPU server. Never in modern pretraining is a whole model placed on a single node.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="2150" height="735" data-attachment-id="150418474" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/196-node1-node2-node3-node-m/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/196-Node1-Node2-Node3-Node-M.png?fit=2150%2C735&amp;ssl=1" data-orig-size="2150,735" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="196 Node1 Node2 Node3 Node M" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/196-Node1-Node2-Node3-Node-M.png?fit=300%2C103&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/196-Node1-Node2-Node3-Node-M.png?fit=1024%2C350&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/196-Node1-Node2-Node3-Node-M.png?resize=2150%2C735&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/196-Node1-Node2-Node3-Node-M.png?w=2150&amp;ssl=1 2150w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/196-Node1-Node2-Node3-Node-M.png?resize=300%2C103&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/196-Node1-Node2-Node3-Node-M.png?resize=1024%2C350&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/196-Node1-Node2-Node3-Node-M.png?resize=768%2C263&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/196-Node1-Node2-Node3-Node-M.png?resize=1536%2C525&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/196-Node1-Node2-Node3-Node-M.png?resize=2048%2C700&amp;ssl=1 2048w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>The model FLOP for each token trained is defined by the following formula:</p>



<p>6 * non_input_embedding_params + 12 * num_layers * num_heads * head_dim * max_seq_len * density</p>



<p>With density being how sparse the attention is relative to a full mask. Causal attention has, for example, a 50% sparsity, while sliding window attention has even lower sparsity.</p>



<p>Note that originally our testing harness used 6 * params instead of 6 * non_input_embedding_params which is the wrong way of calculating model FLOP per token. Furthermore, there was another bug in regard to the way we used FSDP. <strong>We have since updated our testing harness and retroactively retested as well as updated all of benchmark results across all versions of software for both H100, H200, MI300X, public stable, public nightly, VIP images and AMD development builds. All results listed below are with the updated testing harness.</strong></p>



<h2 id="single-node-training-performance">Single Node Training Performance</h2>



<p>Note that the H100/H200 performance we present in this report reflects an out of the box performance without any hand-crafted tuning from Nvidia engineers, while the results for the MI300X comes after many months of tuning and bug fixes from AMD’s engineers. We did not run into any Nvidia-specific bugs compared to AMD training, which was comparatively bug-filled. Five months ago, many models couldn’t run at more than 150 TFLOP/s on the AMD MI300X due to an AMD software bug in attention backwards and torch compile, which forced the user to manually mark a region of the model as non-compliable instead of having a full graph compile.</p>



<p>We see that, for all models, the H100/H200 wins relative to MI300X public releases/public nightly releases/Nov 25<sup>th</sup>build from source VIP image. It is interesting that the MI300X does not perform well on smaller models such as GPT 1.5B or on any model that uses a non-causal attention layer, like Mistral 7B v0.1. This is due to FlexAttention not being fully operational at the time of the deadline, while, on Nvidia GPUs, it has been working since August 2024. As such, the H100/H200 beats MI300X by more than 2.5x in terms of TFLOP/s for MI300X public release/public nightly release/Nov25th VIP build.</p>



<p>For the Dec 21<sup>st</sup> MI300X internal WIP development branches build, we still see it perform worse than H100/H200 on GPT 1.5B. Furthermore, it performs slightly worse than H100 on Mistral 7B. For Llama3 8B and Llama3 70B Proxy, the Dec 21<sup>st</sup> MI300X WIP development build performs better than H100/H200, but note that this is due to MI300X WIP development using an AMD engineer’s development branch that has not even been merged to the AMD main branch. </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1491" height="1180" data-attachment-id="150418475" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/121-bf16-single-node-8gpu-training-perf-with-new-amd-images/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/121-bf16-single-node-8gpu-training-perf-with-new-AMD-images.png?fit=1491%2C1180&amp;ssl=1" data-orig-size="1491,1180" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="121 bf16 single node 8gpu training perf – with new AMD images" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/121-bf16-single-node-8gpu-training-perf-with-new-AMD-images.png?fit=300%2C237&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/121-bf16-single-node-8gpu-training-perf-with-new-AMD-images.png?fit=1024%2C810&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/121-bf16-single-node-8gpu-training-perf-with-new-AMD-images.png?resize=1491%2C1180&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/121-bf16-single-node-8gpu-training-perf-with-new-AMD-images.png?w=1491&amp;ssl=1 1491w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/121-bf16-single-node-8gpu-training-perf-with-new-AMD-images.png?resize=300%2C237&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/121-bf16-single-node-8gpu-training-perf-with-new-AMD-images.png?resize=1024%2C810&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/121-bf16-single-node-8gpu-training-perf-with-new-AMD-images.png?resize=768%2C608&amp;ssl=1 768w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>Three months ago, attempting to do FP8 Training on AMD led to segfaults and hard errors. On the off chance it did work, it was, in fact, slower than the same run using BF16. We worked with AMD’s FP8 team to fix this issue, as well as the AMD hipBLASLt team, which created <a href="https://github.com/ROCm/hipBLASLt/pull/1378">tuning</a> for fixing MI300X FP8 performance. FP8 Training is important as it speeds up training compared to BF16 &amp; most frontier labs use FP8 Training.</p>



<p>After many fixes, we can see that the MI300X’s Nov 25th throughput for Llama3 8B and GPT 1.5B is somewhat competitive with H100’s. As usual, H200 wins in this category. However, for Llama3 70B 4 Layer Proxy, AMD Nov 25th’s results are sorely beaten.</p>



<p>For Mistral 7B which has a non-causal attention layer, AMD Nov 25th performance is close to half that of an H100. This shows that, for anything that isn’t a simple model, even after months of tuning, AMD is still not competitive due to a slight tweak in the model structure. Many frontier models and AI training startups are using complex attention layers for long context spans and efficient attention, but, AMD is still far behind on those.</p>



<p>Unfortunately, FP8 training on AMD only works on custom images such as our November 25<sup>th</sup> VIP image and December 21<sup>st</sup> WIP development branch image. When we first started trying AMD FP8 Training, it was slower than AMD BF16 Training on public releases.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1491" height="1181" data-attachment-id="150418476" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/131-fp8-single-node-8gpu-training-perf-with-new-amd-image-v2/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/131-fp8-single-node-8gpu-training-perf-with-new-amd-Image-v2.png?fit=1491%2C1181&amp;ssl=1" data-orig-size="1491,1181" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="131 fp8 single node 8gpu training perf – with new amd Image v2" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/131-fp8-single-node-8gpu-training-perf-with-new-amd-Image-v2.png?fit=300%2C238&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/131-fp8-single-node-8gpu-training-perf-with-new-amd-Image-v2.png?fit=1024%2C811&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/131-fp8-single-node-8gpu-training-perf-with-new-amd-Image-v2.png?resize=1491%2C1181&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/131-fp8-single-node-8gpu-training-perf-with-new-amd-Image-v2.png?w=1491&amp;ssl=1 1491w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/131-fp8-single-node-8gpu-training-perf-with-new-amd-Image-v2.png?resize=300%2C238&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/131-fp8-single-node-8gpu-training-perf-with-new-amd-Image-v2.png?resize=1024%2C811&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/131-fp8-single-node-8gpu-training-perf-with-new-amd-Image-v2.png?resize=768%2C608&amp;ssl=1 768w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>For AMD’s WIP development builds, we see that on Llama3 8B, it wins against H100 but is still slower than H200’s public stable software release. H200 performance completely beats MI300X even on their Dec 21<sup>st</sup> WIP development branches.</p>



<p>It is interesting that the MI300X does not perform well on non-causal attention layer, like Mistral 7B v0.1 even for their internal builds. Mistral using sliding window attention which some of the frontier models uses. It seems that if you want to train a model that doesn’t use causal attention, AMD MI300X will automatically lose.</p>



<p>While a lot of people putting out performance comparisons between hardware, most do not open source their testing code and they do not make easily reproducible. We took an open source approach, and we have open-sourced our single node training benchmark and made it easy to run with only a couple of lines:</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="836" height="941" data-attachment-id="150418477" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/140-run-single-node-nv-vs-amdgimp-v2/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/140-run-single-node-nv-vs-amdGIMP-v2.png?fit=836%2C941&amp;ssl=1" data-orig-size="836,941" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="140 run single node nv vs amdGIMP v2" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/140-run-single-node-nv-vs-amdGIMP-v2.png?fit=267%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/140-run-single-node-nv-vs-amdGIMP-v2.png?fit=836%2C941&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/140-run-single-node-nv-vs-amdGIMP-v2.png?resize=836%2C941&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/140-run-single-node-nv-vs-amdGIMP-v2.png?w=836&amp;ssl=1 836w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/140-run-single-node-nv-vs-amdGIMP-v2.png?resize=267%2C300&amp;ssl=1 267w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/140-run-single-node-nv-vs-amdGIMP-v2.png?resize=768%2C864&amp;ssl=1 768w" sizes="auto, (max-width: 836px) 100vw, 836px"/><figcaption>Source: <a href="https://ray.so/#darkMode=false&amp;code=IyBBbGwgb2YgdGhlIEluc3RydWN0aW9ucyBiZWxvdyBoYXZlIHRoZSB1cGRhdGVkIHRlc3QgaGFybmVzcwojIFJ1biBTaW5nbGUgTm9kZQoKIyBOdmlkaWEKYWxpYXMgZHJ1bj0iZG9ja2VyIHJ1biAtLXJtIC1pdCAtLWdwdXMgYWxsIC0taXBjPWhvc3QgLS1uZXQ9aG9zdCAtLXNobS1zaXp">SemiAnalysis</a></figcaption></figure>



<h2 id="multi-node-training-performance">Multi-Node Training Performance</h2>



<p>For multi-node, we benchmarked two nodes of H100 and two nodes of MI300X. Unfortunately, we didn’t get access to a multi-node H200 deployment in time for the article.</p>



<p>H100 wins again by a big margin in this benchmark compared to MI300X, with the H100 ranging from 10-25% faster. This gap widens as you add more nodes working together into a single training workload. This is a known problem, which AMD is attempting to fix next year by deploying their new in house 400G AI focused NIC.</p>



<h2 id="amd-pytorch_tunable_ops-flag-is-a-bad-user-experience">AMD PYTORCH_TUNABLE_OPS FLAG is a Bad User Experience</h2>



<p>In order to get AMD training working decently, users need to use PYTORCH_TUNABLE_OPS which is an AMD specific prototype flag for the end user to tune GEMMs. Since this is a prototype feature (i.e. not stable), in the past a lot of bugs with this feature cropped up including but not limited to <a href="https://github.com/pytorch/pytorch/issues/139116">seg faults</a>, HBM memory leaks, and a <a href="https://github.com/pytorch/pytorch/pull/139137">whole</a> <a href="https://github.com/pytorch/pytorch/pull/143507">host</a> of <a href="https://github.com/pytorch/pytorch/pull/140673">other</a>issues such as many <a href="https://www.torch-ci.com/failure?failureCaptures=%5B%22test_linalg.py%3A%3ATestLinalgCUDA%3A%3Atest_matmul_small_brute_force_tunableop_cuda_float16%22%5D">unit tests being disabled</a>. These known tunable ops bugs have been fixed now but there are likely a many more unknown AMD software bugs. </p>



<p>Furthermore, even if users do not encounter any bugs and thus the runway is clear for this prototype AMD flag to work, it still takes users anywhere from 1-2 hours to tune any modern LLM model. Although these GEMMs can be cached by the end user, any minor changes to the end user’s code results in the need for the user to spend another 1-2 hours tuning. As you can imagine, this will slow down an ML Scientist’s iteration cycle speed when trying to conduct model R&amp;D and ablations experiments. </p>



<p>On Nvidia, this flag isn’t needed as their GEMM library (cuBLASLt) comes tuned out of the box and cuBLASLt’s heuristic model out of the box picks the correct algorithm for most shapes on H100/H200. In contrast, AMD hipBLASLt/rocBLAS’s heuristic model picks the wrong algorithm for most shapes out of the box, which is why so much time-consuming tuning is required by the end user.</p>



<p>We recommend that AMD to fix their GEMM libraries’ heuristic model such that it picks the correct algorithm out of the box instead of wasting the end user’s time doing tuning on their end. Users often iterate quickly when doing research and therefore rerunning tunable ops will slow down research velocity significantly.<br/></p>



<h2 id="scale-up-nvlinkxgmitopology">Scale Up NVLink/xGMI  Topology</h2>



<p>Scale up fabric is extremely important for GPU Clusters, as it provides an extremely fast path for tensor and expert parallelism used in frontier model training. For this reason, we have conducted benchmarks to measure scale up fabric performance.</p>



<p>The scale up fabric on H100 and H200 is called NVLink and provides 450GByte/s of bandwidth per GPU and connects 8 GPUs together. On the MI300X, the scale up fabric is called xGMI and, on paper, it connects 8 GPUs, providing 448GByte/s of bandwidth per GPU. On the surface, MI300X’s scale up network is extremely similar and close in performance to that of the H100/H200, providing just 0.5% less on paper bandwidth. Unfortunately, the reality of the situation differs sharply.</p>



<p>First, MI300X’s xGMI is a point-to-point fabric, which means that it isn’t <em>actually</em> providing 448GByte/s of bandwidth between GPUs pairs. Instead, each GPU can only talk to one another at 64GByte/s. A GPU can only reach the stated 448GByte/s if one GPU addresses all 7 other GPUs simultaneously. That means that, for Tensor Parallelism TP=2, the maximum bandwidth is 64GByte/s and 189GByte/s for TP=4.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1455" height="1147" data-attachment-id="150418478" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/201-amd-mi300x-xgmi-topology/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/201-amd-mi300x-xgmi-topology.png?fit=1455%2C1147&amp;ssl=1" data-orig-size="1455,1147" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="201 amd mi300x xgmi topology" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/201-amd-mi300x-xgmi-topology.png?fit=300%2C236&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/201-amd-mi300x-xgmi-topology.png?fit=1024%2C807&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/201-amd-mi300x-xgmi-topology.png?resize=1455%2C1147&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/201-amd-mi300x-xgmi-topology.png?w=1455&amp;ssl=1 1455w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/201-amd-mi300x-xgmi-topology.png?resize=300%2C236&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/201-amd-mi300x-xgmi-topology.png?resize=1024%2C807&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/201-amd-mi300x-xgmi-topology.png?resize=768%2C605&amp;ssl=1 768w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>In contrast, since Nvidia’s NVLink uses a switched topography, one GPU can talk to another GPU at the full 450GByte/s. Furthermore, the four NVSwitches in H100/H200 support in-network reduction (referred to as NVLink SHARP (NVLS), enabled by default), a technique to reduce data movements by carrying out collectives/reductions inside the switch itself.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="2172" height="743" data-attachment-id="150418479" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/202-h100_200-nvlink-topology/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/202-h100_200-nvlink-topology.png?fit=2172%2C743&amp;ssl=1" data-orig-size="2172,743" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="202 h100_200 nvlink topology" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/202-h100_200-nvlink-topology.png?fit=300%2C103&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/202-h100_200-nvlink-topology.png?fit=1024%2C350&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/202-h100_200-nvlink-topology.png?resize=2172%2C743&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/202-h100_200-nvlink-topology.png?w=2172&amp;ssl=1 2172w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/202-h100_200-nvlink-topology.png?resize=300%2C103&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/202-h100_200-nvlink-topology.png?resize=1024%2C350&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/202-h100_200-nvlink-topology.png?resize=768%2C263&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/202-h100_200-nvlink-topology.png?resize=1536%2C525&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/202-h100_200-nvlink-topology.png?resize=2048%2C701&amp;ssl=1 2048w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<h2 id="all-reduceall-to-allreduce-scatterall-gather-collectives-overview">All Reduce/All to All/Reduce Scatter/All Gather Collectives Overview</h2>



<p>We will showcase benchmarks across scale-up and scale-out networks for both the Nvidia H100/H200 and AMD’s MI300. The collectives that we will be testing are the main set of collectives used in frontier LLM training: all_reduce, all_gather, reduce_scatter, and all to all. All reduce is for data parallelism and tensor parallelism, all gather is used for ZeRO/FSDP parallelism (as well as for tensor parallelism), and Reduce Scatter is used for ZeRO/FSDP parallelism. </p>



<p>Due to the way that compute-communication overlapping works, real-world message sizes range from 16MiB to 256MiB, with the default PyTorch DDP size being 25MiB (NVIDIA’s MLPerf 11,000 H100 GPT-3 175B run used a <a href="https://github.com/mlcommons/training_results_v4.1/blob/b87b9e396f771345d4ef122ba33456304f15228d/NVIDIA/benchmarks/gpt3/implementations/eos-dfw_n1452_ngc24.04_nemo/config_common.sh#L69">message size of max 200MiB</a>). We also test 8GiB and 16GiB just to see what the peak bus bandwidth is, though these message sizes are not used in the real world. All these collectives discussed above are used during 3D Parallelism and FSDP/ZeRO Parallelism, which are common techniques for training frontier models.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="2259" height="1357" data-attachment-id="150418480" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/210-3d-parallelismgimp/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/210-3d-parallelismGIMP.png?fit=2259%2C1357&amp;ssl=1" data-orig-size="2259,1357" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="210 3d-parallelismGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/210-3d-parallelismGIMP.png?fit=300%2C180&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/210-3d-parallelismGIMP.png?fit=1024%2C615&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/210-3d-parallelismGIMP.png?resize=2259%2C1357&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/210-3d-parallelismGIMP.png?w=2259&amp;ssl=1 2259w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/210-3d-parallelismGIMP.png?resize=300%2C180&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/210-3d-parallelismGIMP.png?resize=1024%2C615&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/210-3d-parallelismGIMP.png?resize=768%2C461&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/210-3d-parallelismGIMP.png?resize=1536%2C923&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/210-3d-parallelismGIMP.png?resize=2048%2C1230&amp;ssl=1 2048w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: DeepSpeed</figcaption></figure>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="2206" height="1165" data-attachment-id="150418481" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/220-fully-sharded-data-parallel-traininggimp/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/220-fully-sharded-data-parallel-trainingGIMP.png?fit=2206%2C1165&amp;ssl=1" data-orig-size="2206,1165" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="220 fully sharded data parallel trainingGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/220-fully-sharded-data-parallel-trainingGIMP.png?fit=300%2C158&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/220-fully-sharded-data-parallel-trainingGIMP.png?fit=1024%2C541&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/220-fully-sharded-data-parallel-trainingGIMP.png?resize=2206%2C1165&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/220-fully-sharded-data-parallel-trainingGIMP.png?w=2206&amp;ssl=1 2206w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/220-fully-sharded-data-parallel-trainingGIMP.png?resize=300%2C158&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/220-fully-sharded-data-parallel-trainingGIMP.png?resize=1024%2C541&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/220-fully-sharded-data-parallel-trainingGIMP.png?resize=768%2C406&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/220-fully-sharded-data-parallel-trainingGIMP.png?resize=1536%2C811&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/220-fully-sharded-data-parallel-trainingGIMP.png?resize=2048%2C1082&amp;ssl=1 2048w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: Meta</figcaption></figure>



<h2 id="single-node-nccl-collective">Single Node NCCL Collective</h2>



<p>We see that Nvidia does much better than AMD across all the real-world messages for every single collective. This is not surprising due to the H100/H200’s superior 450GByte/s NVLink switched topology with in-network reduction (NVLS), compared to MI300X’s 7x64GByte/s xGMI point-to-point topology.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1725" height="1216" data-attachment-id="150418482" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/240-single-node-8-gpu-allreduce-busbw/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/240-single-node-8-gpu-allreduce-BusBW.png?fit=1725%2C1216&amp;ssl=1" data-orig-size="1725,1216" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="240 single node 8 gpu allreduce BusBW" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/240-single-node-8-gpu-allreduce-BusBW.png?fit=300%2C211&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/240-single-node-8-gpu-allreduce-BusBW.png?fit=1024%2C722&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/240-single-node-8-gpu-allreduce-BusBW.png?resize=1725%2C1216&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/240-single-node-8-gpu-allreduce-BusBW.png?w=1725&amp;ssl=1 1725w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/240-single-node-8-gpu-allreduce-BusBW.png?resize=300%2C211&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/240-single-node-8-gpu-allreduce-BusBW.png?resize=1024%2C722&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/240-single-node-8-gpu-allreduce-BusBW.png?resize=768%2C541&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/240-single-node-8-gpu-allreduce-BusBW.png?resize=1536%2C1083&amp;ssl=1 1536w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1592" height="1147" data-attachment-id="150418483" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/250-single-node-8-gpu-all-to-all/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/250-single-node-8-gpu-all-to-all.png?fit=1592%2C1147&amp;ssl=1" data-orig-size="1592,1147" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="250 single node 8 gpu all to all" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/250-single-node-8-gpu-all-to-all.png?fit=300%2C216&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/250-single-node-8-gpu-all-to-all.png?fit=1024%2C738&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/250-single-node-8-gpu-all-to-all.png?resize=1592%2C1147&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/250-single-node-8-gpu-all-to-all.png?w=1592&amp;ssl=1 1592w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/250-single-node-8-gpu-all-to-all.png?resize=300%2C216&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/250-single-node-8-gpu-all-to-all.png?resize=1024%2C738&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/250-single-node-8-gpu-all-to-all.png?resize=768%2C553&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/250-single-node-8-gpu-all-to-all.png?resize=1536%2C1107&amp;ssl=1 1536w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1593" height="1134" data-attachment-id="150418484" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/260-single-node-8gpu-all-gather/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/260-single-node-8gpu-all-gather.png?fit=1593%2C1134&amp;ssl=1" data-orig-size="1593,1134" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="260 single node 8gpu all gather" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/260-single-node-8gpu-all-gather.png?fit=300%2C214&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/260-single-node-8gpu-all-gather.png?fit=1024%2C729&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/260-single-node-8gpu-all-gather.png?resize=1593%2C1134&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/260-single-node-8gpu-all-gather.png?w=1593&amp;ssl=1 1593w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/260-single-node-8gpu-all-gather.png?resize=300%2C214&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/260-single-node-8gpu-all-gather.png?resize=1024%2C729&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/260-single-node-8gpu-all-gather.png?resize=768%2C547&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/260-single-node-8gpu-all-gather.png?resize=1536%2C1093&amp;ssl=1 1536w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1594" height="1168" data-attachment-id="150418485" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/270-single-node-8gpu-reduce-scatter/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/270-single-node-8gpu-reduce-scatter.png?fit=1594%2C1168&amp;ssl=1" data-orig-size="1594,1168" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="270 single node 8gpu reduce scatter" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/270-single-node-8gpu-reduce-scatter.png?fit=300%2C220&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/270-single-node-8gpu-reduce-scatter.png?fit=1024%2C750&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/270-single-node-8gpu-reduce-scatter.png?resize=1594%2C1168&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/270-single-node-8gpu-reduce-scatter.png?w=1594&amp;ssl=1 1594w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/270-single-node-8gpu-reduce-scatter.png?resize=300%2C220&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/270-single-node-8gpu-reduce-scatter.png?resize=1024%2C750&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/270-single-node-8gpu-reduce-scatter.png?resize=768%2C563&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/270-single-node-8gpu-reduce-scatter.png?resize=1536%2C1126&amp;ssl=1 1536w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>To reproduce this test, you can use our open source ClusterMax-NCCL/RCCL benchmark, which we developed to be easily run with one line of Bash. ClusterMax is our upcoming evaluation quantitative performance and qualitative user experience for ranking H100/B200/GB200/MI300X Neocloud clusters. Look forward to our upcoming <em>“ClusterMax Neocloud Evaluation | How to Rent GPUs”</em> article. </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="3496" height="1568" data-attachment-id="150418486" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/280-nv-vs-amd-docker-rungimp/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/280-nv-vs-amd-docker-runGIMP.png?fit=3496%2C1568&amp;ssl=1" data-orig-size="3496,1568" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="280 nv vs amd docker runGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/280-nv-vs-amd-docker-runGIMP.png?fit=300%2C135&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/280-nv-vs-amd-docker-runGIMP.png?fit=1024%2C459&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/280-nv-vs-amd-docker-runGIMP.png?resize=3496%2C1568&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/280-nv-vs-amd-docker-runGIMP.png?w=3496&amp;ssl=1 3496w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/280-nv-vs-amd-docker-runGIMP.png?resize=300%2C135&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/280-nv-vs-amd-docker-runGIMP.png?resize=1024%2C459&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/280-nv-vs-amd-docker-runGIMP.png?resize=768%2C344&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/280-nv-vs-amd-docker-runGIMP.png?resize=1536%2C689&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/280-nv-vs-amd-docker-runGIMP.png?resize=2048%2C919&amp;ssl=1 2048w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/280-nv-vs-amd-docker-runGIMP.png?w=3000&amp;ssl=1 3000w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<h2 id="multi-node-rcclnccl-collectives-and-scale-out-network-benchmarks">Multi Node RCCL/NCCL Collectives and Scale Out Network Benchmarks</h2>



<p>On both Nvidia’s H100/H200 and the MI300X, each GPU is connected to other nodes over the scale out network using a 400G Network Interface Card (NIC), connected directly every GPU. The H100/H200 reference design typically uses ConnectX-7 NICs for InfiniBand NDR or BlueField-3 for Spectrum-X Ethernet. Spectrum-X is NVIDIA’s custom Ethernet solution purpose-built for AI workloads. On the MI300X, the reference design recommends using RoCEv2 Ethernet with Broadcom Thor-2 NIC. </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1100" height="624" data-attachment-id="150418487" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/290-trees-on-dgx-h100gimp/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/290-trees-on-dgx-h100GIMP.png?fit=1100%2C624&amp;ssl=1" data-orig-size="1100,624" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="290 trees on dgx h100GIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/290-trees-on-dgx-h100GIMP.png?fit=300%2C170&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/290-trees-on-dgx-h100GIMP.png?fit=1024%2C581&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/290-trees-on-dgx-h100GIMP.png?resize=1100%2C624&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/290-trees-on-dgx-h100GIMP.png?w=1100&amp;ssl=1 1100w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/290-trees-on-dgx-h100GIMP.png?resize=300%2C170&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/290-trees-on-dgx-h100GIMP.png?resize=1024%2C581&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/290-trees-on-dgx-h100GIMP.png?resize=768%2C436&amp;ssl=1 768w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: Nvidia</figcaption></figure>



<p>A typical GPU cluster almost always requires more layers than a single tier network, as a single-tier network can only support 128 GPUs (in the case of Broadcom Ethernet or Nvidia Spectrum X Ethernet) and 64 GPUs (for H100/H200 InfiniBand). In such a multi-tier network, deployments typically use an 8-rail optimized fat tree, where each one of the 8 GPU is connected to a separate switch (such a connection is called a “rail”). <a href="https://semianalysis.com/2024/10/03/ai-neocloud-playbook-and-anatomy/#cluster-level-networking-bill-of-materials">In our AI Neocloud Playbook and Anatomy article, we explained in detail how a rail optimized network works</a>.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1614" height="781" data-attachment-id="150418488" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/300-1024-h100-compute-fabric-topology/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/300-1024-H100-compute-fabric-topology.png?fit=1614%2C781&amp;ssl=1" data-orig-size="1614,781" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="300 1024 H100 compute fabric topology" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/300-1024-H100-compute-fabric-topology.png?fit=300%2C145&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/300-1024-H100-compute-fabric-topology.png?fit=1024%2C496&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/300-1024-H100-compute-fabric-topology.png?resize=1614%2C781&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/300-1024-H100-compute-fabric-topology.png?w=1614&amp;ssl=1 1614w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/300-1024-H100-compute-fabric-topology.png?resize=300%2C145&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/300-1024-H100-compute-fabric-topology.png?resize=1024%2C496&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/300-1024-H100-compute-fabric-topology.png?resize=768%2C372&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/300-1024-H100-compute-fabric-topology.png?resize=1536%2C743&amp;ssl=1 1536w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>Just as Nvidia’s NVLink offers NVLS for its scale-up network, Nvidia’s H100/H200 InfiniBand scale out network also offers InfiniBand SHARP In-network Reduction which is, again, exclusive to Nvidia. AMD does not have an analogous product for the MI300X. InfiniBand SHARP works similarly to NVLink SHARP In-network Reduction as they both provide a way to reduce the amount of traffic going through the network, with the reductions carried out inside of Quantum-2 InfiniBand switches in the case of InfiniBand SHARP. </p>



<p>Unfortunately, unlike NVLink SHARP, which is enabled by default, InfiniBand SHARP is not enabled by default in the UFM/IB subnet manager. We have spoken to many Neoclouds, H100 cluster operators, and AI frontier labs, and most have said that they have not enabled SHARP due to increased NCCL_TIMEOUT rates and difficulties installing and configuring the network. We asked NVIDIA which AI customers use InfiniBand SHARP, but they declined to answer in specifics. One could speculate that if InfiniBand SHARP was useful in AI production workloads, NVIDIA marketing would shout at the top of their lungs to promote its successful deployment. Given the apparently limited adoption of InfiniBand SHARP for now, we show here collective performance for Nvidia both when SHARP is and is not enabled.</p>



<p>For some of the benchmarks, we have also collected Nvidia Spectrum-X Ethernet data on an Nvidia internal cluster called Israel-1. Nvidia Spectrum-X is used in xAI’s 200k H100/H200 cluster and can support clusters up to 100k GPUs in the Spectrum-X reference architecture version 1.2, but could potentially support up to 512k GPUs with a non-reference custom design.</p>



<p>We are also in the process of testing Google Cloud (GCP) H100’s in-house ethernet, as well as AWS’ H100 and H200s that are deployed on AWS’s in-house Ethernet (called EFAv2/EFAv3). We will be sharing the results in our upcoming “Collective Deep Dive” article, which will provide visualizations of  the different types of collectives, explain the different NCCL protocols (SIMPLE, LL, LL128), different NCCL algorithms (NVLS, NVLSTREE, RING, TREE, COLNETDIRECT, COLNETCHAIN, PAT), and how collectives run on GCP H100 Ethernet, AWS H100/H200 EFA, InfiniBand H100, Spectrum-X, etc.</p>



<p>Below we show a 32 GPU all reduce collective test. You can see that MI300X RoCEv2 is in last place compared to normal InfiniBand H100 and InfiniBand H100 with SHARP enabled. Simply put, poor all reduce performance leads to poor scale-out training.  </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1594" height="1203" data-attachment-id="150418489" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/311-32gpu-non-blokcing-all-reduce/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/311-32gpu-non-blokcing-all-reduce.png?fit=1594%2C1203&amp;ssl=1" data-orig-size="1594,1203" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="311 32gpu non blokcing all reduce" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/311-32gpu-non-blokcing-all-reduce.png?fit=300%2C226&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/311-32gpu-non-blokcing-all-reduce.png?fit=1024%2C773&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/311-32gpu-non-blokcing-all-reduce.png?resize=1594%2C1203&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/311-32gpu-non-blokcing-all-reduce.png?w=1594&amp;ssl=1 1594w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/311-32gpu-non-blokcing-all-reduce.png?resize=300%2C226&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/311-32gpu-non-blokcing-all-reduce.png?resize=1024%2C773&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/311-32gpu-non-blokcing-all-reduce.png?resize=768%2C580&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/311-32gpu-non-blokcing-all-reduce.png?resize=1536%2C1159&amp;ssl=1 1536w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>The MI300X’s performance decreases if you scale out (i.e. increase) the number of GPUs participating in a collective. As you can imagine, modern frontier training is carried out on clusters of at least 100,000 GPUs. MI300X RoCEv2 runs at half the speed for all the real-world message sizes of 16MiB to 256MiB when compared to the baseline of InfiniBand Non-SHARP. As per the chart below, Nvidia Spectrum-X Ethernet performance is quite close to InfiniBand Non-SHARP’s performance, due to Spectrum-X’s vertical integration with the NCCL collective library as well as its use of good congestion control and adaptive routing. AMD is attempting to vertically integrate next year with their upcoming Pollara 400G NIC, which supports Ultra Ethernet, hopefully making AMD competitive with Nvidia. As always, Nvidia is not standing still and by late next year, it will be ready to go into production with its 800G ConnectX-8 NICs, which provide a line rate twice as fast as AMD’s Pollara NIC. </p>



<p>AMD RCCL is a fork of Nvidia NCCL. AMD’s RCCL Team and many other teams at AMD are resource limited and don’t have enough of either compute or headcount to improve the AMD ecosystem. AMD’s RCCL Team currently has stable access to less than <em>32 MI300Xs for R&amp;D</em>, which is ironic, as improving collective operations is all about having access to many GPUs. This is frankly silly, AMD should spend more on their software teams having access to more GPUs.</p>



<p>This contrasts with Nvidia’s NCCL team, which has access to R&amp;D resources on Nvidia’s 11,000 H100 internal EOS cluster. Furthermore, Nvidia has Sylvain Jeaugey, who is the subject matter expert on collective communication. There are a lot of other world class collective experts working at Nvidia as well, and, unfortunately, AMD has largely failed to attract collective library talent due to less attractive compensation and resources – as opposed to engineers at Nvidia, where it is not uncommon to see engineers make greater than a million dollars per year thanks to appreciation in the value of RSUs. </p>



<p>To help alleviate these issues, TensorWave and SemiAnalysis are currently working with the AMD RCCL Team to improve collective performance. TensorWave has generously sponsored AMD a medium-sized cluster in order help the RCCL Team have greater resources to do their jobs. The fact that Tensorwave after buying many GPUs has to give AMD GPUs for them to fix their software is insane.</p>



<p>Another trend to notice is that for non-SHARP networks, all reduce collective’s speed will reduce logarithmically as you double the number of GPUs. In contrast, with SHARP, the speed/completion time stays the same. We have results for up to 1,024 H100s showing that IB SHARP all reduce is constant time across any number of GPUs in a collective. We will publish this in our upcoming <em>“Collective Deep Dive” </em>article.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1473" height="1153" data-attachment-id="150418490" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/331-128gpu-with-400g-non-blocking-allreduce/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/331-128gpu-with-400g-non-blocking-allreduce.png?fit=1473%2C1153&amp;ssl=1" data-orig-size="1473,1153" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="331 128gpu with 400g non blocking allreduce" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/331-128gpu-with-400g-non-blocking-allreduce.png?fit=300%2C235&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/331-128gpu-with-400g-non-blocking-allreduce.png?fit=1024%2C802&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/331-128gpu-with-400g-non-blocking-allreduce.png?resize=1473%2C1153&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/331-128gpu-with-400g-non-blocking-allreduce.png?w=1473&amp;ssl=1 1473w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/331-128gpu-with-400g-non-blocking-allreduce.png?resize=300%2C235&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/331-128gpu-with-400g-non-blocking-allreduce.png?resize=1024%2C802&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/331-128gpu-with-400g-non-blocking-allreduce.png?resize=768%2C601&amp;ssl=1 768w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>For all gather, all to all, and reduce scatter collectives, MI300X is anywhere from 2-4 times slower than InfiniBand. Unfortunately, we did not have access to Spectrum-X or InfiniBand SHARP benchmark data for all gather or reduce scatter. </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1670" height="1250" data-attachment-id="150418545" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/screenshot-9/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/340-128gpu-400g-non-blocking-allgather.jpg?fit=1670%2C1250&amp;ssl=1" data-orig-size="1670,1250" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;Screenshot&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;Screenshot&#34;,&#34;orientation&#34;:&#34;1&#34;}" data-image-title="Screenshot" data-image-description="" data-image-caption="&lt;p&gt;Screenshot&lt;/p&gt;
" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/340-128gpu-400g-non-blocking-allgather.jpg?fit=300%2C225&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/340-128gpu-400g-non-blocking-allgather.jpg?fit=1024%2C766&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/340-128gpu-400g-non-blocking-allgather.jpg?resize=1670%2C1250&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/340-128gpu-400g-non-blocking-allgather.jpg?w=1670&amp;ssl=1 1670w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/340-128gpu-400g-non-blocking-allgather.jpg?resize=300%2C225&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/340-128gpu-400g-non-blocking-allgather.jpg?resize=1024%2C766&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/340-128gpu-400g-non-blocking-allgather.jpg?resize=768%2C575&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/340-128gpu-400g-non-blocking-allgather.jpg?resize=1536%2C1150&amp;ssl=1 1536w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1720" height="1221" data-attachment-id="150418492" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/350-128gpu-reduce-scatter/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/350-128gpu-reduce-scatter.png?fit=1720%2C1221&amp;ssl=1" data-orig-size="1720,1221" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="350 128gpu reduce scatter" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/350-128gpu-reduce-scatter.png?fit=300%2C213&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/350-128gpu-reduce-scatter.png?fit=1024%2C727&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/350-128gpu-reduce-scatter.png?resize=1720%2C1221&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/350-128gpu-reduce-scatter.png?w=1720&amp;ssl=1 1720w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/350-128gpu-reduce-scatter.png?resize=300%2C213&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/350-128gpu-reduce-scatter.png?resize=1024%2C727&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/350-128gpu-reduce-scatter.png?resize=768%2C545&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/350-128gpu-reduce-scatter.png?resize=1536%2C1090&amp;ssl=1 1536w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1723" height="1219" data-attachment-id="150418493" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/360-128gpu-all-to-all/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/360-128gpu-all-to-all.png?fit=1723%2C1219&amp;ssl=1" data-orig-size="1723,1219" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="360 128gpu all to all" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/360-128gpu-all-to-all.png?fit=300%2C212&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/360-128gpu-all-to-all.png?fit=1024%2C724&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/360-128gpu-all-to-all.png?resize=1723%2C1219&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/360-128gpu-all-to-all.png?w=1723&amp;ssl=1 1723w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/360-128gpu-all-to-all.png?resize=300%2C212&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/360-128gpu-all-to-all.png?resize=1024%2C724&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/360-128gpu-all-to-all.png?resize=768%2C543&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/360-128gpu-all-to-all.png?resize=1536%2C1087&amp;ssl=1 1536w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>Below, we provide our nccl/rccl benchmarking script. Unfortunately, due to the nature of cluster-specific setups, it is not as simple as a one-liner. It does require you to follow the README.md of nccl/rccl and nccl-tests/rccl-tests to run properly. On AWS and Google Cloud, there may also be custom nccl adapters that you will need to install.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="814" height="747" data-attachment-id="150418494" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/370-installing-ccl-testsgimpo-v2/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/370-installing-ccl-testsGIMPO-v2.png?fit=814%2C747&amp;ssl=1" data-orig-size="814,747" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="370 installing ccl testsGIMPO v2" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/370-installing-ccl-testsGIMPO-v2.png?fit=300%2C275&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/370-installing-ccl-testsGIMPO-v2.png?fit=814%2C747&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/370-installing-ccl-testsGIMPO-v2.png?resize=814%2C747&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/370-installing-ccl-testsGIMPO-v2.png?w=814&amp;ssl=1 814w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/370-installing-ccl-testsGIMPO-v2.png?resize=300%2C275&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/370-installing-ccl-testsGIMPO-v2.png?resize=768%2C705&amp;ssl=1 768w" sizes="auto, (max-width: 814px) 100vw, 814px"/><figcaption>Source: <a href="https://ray.so/#code=CiMhL2Jpbi9iYXNoCiNTQkFUQ0ggLS1qb2ItbmFtZT1jb2xsZWN0aXZlX3BlcmYKI1NCQVRDSCAtLW5vZGVzPTE2CiNTQkFUQ0ggLS1udGFza3MtcGVyLW5vZGU9OAojU0JBVENIIC0tZ3Jlcz1ncHU6OAojU0JBVENIIC0tY3B1cy1wZXItdGFzaz0yMgojU0JBVENIIC0tdGltZT0wODowMDowMAoKIyBJbnN0YW">SemiAnalysis</a></figcaption></figure>



<h2 id="amds-user-experience-is-suboptimal-and-the-mi300x-is-not-usable-out-of-the-box">AMD’s User Experience is Suboptimal and the MI300X is Not Usable Out of the Box</h2>



<p>Due to poor internal testing (i.e. “dogfooding”) and a lack of automated testing on AMD’s part, the MI300 is not usable out of the box and requires considerable amounts of work and tuning. <a href="https://www.youtube.com/live/vJ8aEO6ggOs?si=ViPmlckQNmDYCayJ&amp;t=3416">In November 2024 at AMD’s “Advancing AI”, AMD’s SVP of AI</a> stated that are over 200k tests running every evening internally at AMD. However, this seems to have done little to ameliorate the many AMD software bugs we ran into, and we doubt AMD is doing proper CI/CD tests include proper performance regression, or functional and convergence/numerics testing. We will outline a few examples here for readers to understand the nature of the AMD software bugs we have encountered and why we feel they have been very obstructive to a good user experience on AMD. </p>



<p><a href="https://rocm.blogs.amd.com/artificial-intelligence/flash-attention/README.html#benchmarking-attention">Although AMD’s own documentation recommends using PyTorch native Flash Attention</a>, for a couple months this summer, AMD’s PyTorch native Flash Attention kernel ran at less than 20 TFLOP/s, meaning that a modern CPU would have calculated the attention backwards layer <em>faster than an MI300X GPU</em>. For a time, basically all Transformer/GPT model training using PyTorch on the MI300X ran at a turtle’s pace. Nobody at AMD noticed this until a bug report was filed following deep PyTorch/Perfetto profiling showing the backwards pass (purple/brown kernels) took up far more time than the forward pass (dark green section). Normally, the backwards section should take up just ~2x as much time as the forward pass (slightly more if using activation checkpointing). </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1481" height="209" data-attachment-id="150418495" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/380-github-picture-lolgimp/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/380-github-picture-lolGIMP.png?fit=1481%2C209&amp;ssl=1" data-orig-size="1481,209" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="380 github picture lolGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/380-github-picture-lolGIMP.png?fit=300%2C42&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/380-github-picture-lolGIMP.png?fit=1024%2C145&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/380-github-picture-lolGIMP.png?resize=1481%2C209&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/380-github-picture-lolGIMP.png?w=1481&amp;ssl=1 1481w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/380-github-picture-lolGIMP.png?resize=300%2C42&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/380-github-picture-lolGIMP.png?resize=1024%2C145&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/380-github-picture-lolGIMP.png?resize=768%2C108&amp;ssl=1 768w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>Another issue we encountered was that the AMD PyTorch attention layer led to a hard error when used with <a href="https://pytorch.org/tutorials/intermediate/torch_compile_tutorial.html">torch.compile</a> due to the rank of the longsumexp Tensor being incorrect. What was frustrating is that this had already been fixed in internal builds of AMD PyTorch on May 30<sup>th</sup>, but did not reach any AMD PyTorch distributions or even any PyTorch nightly builds until October when it was pointed out to them that there was a bug. This demonstrates a lack of testing and dogfooding on the packages AMD puts out to the public. Another core reason for this problem is that the lead maintainer of PyTorch (Meta) does not currently use MI300X internally for production LLM training, leading to code paths not used internally at Meta being buggy and not dogfooded properly. We believe AMD should partner with Meta to get their internal LLM training working on MI300X.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="890" height="453" data-attachment-id="150418496" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/390-rocm-internal-testinggimp/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/390-rocm-internal-testingGIMP.png?fit=890%2C453&amp;ssl=1" data-orig-size="890,453" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="390 rocm internal testingGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/390-rocm-internal-testingGIMP.png?fit=300%2C153&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/390-rocm-internal-testingGIMP.png?fit=890%2C453&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/390-rocm-internal-testingGIMP.png?resize=890%2C453&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/390-rocm-internal-testingGIMP.png?w=890&amp;ssl=1 890w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/390-rocm-internal-testingGIMP.png?resize=300%2C153&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/390-rocm-internal-testingGIMP.png?resize=768%2C391&amp;ssl=1 768w" sizes="auto, (max-width: 890px) 100vw, 890px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<p>On August 8<sup>th</sup>, Horace He and the Meta PyTorch Team released <a href="https://pytorch.org/blog/flexattention/">FlexAttention</a>, a critical API for creating non-causal attention layers without losing speed. To previously use attention variants like document masking, sliding window attention, softcap, and Alibi, a user would need to spend weeks handcrafting their own kernel in CUDA/HIP language, and subsequently pybinding it to PyTorch. However, with FlexAttention, a user can quickly generate all the attention variants using the API. FlexAttention achieves great performance by using block sparsity by only calculating the blocks of the mask where needed, ignoring the rest.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="437" height="357" data-attachment-id="150418497" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/400-block-maskgimp/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/400-block-maskGIMP.png?fit=437%2C357&amp;ssl=1" data-orig-size="437,357" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="400 block maskGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/400-block-maskGIMP.png?fit=300%2C245&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/400-block-maskGIMP.png?fit=437%2C357&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/400-block-maskGIMP.png?resize=437%2C357&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/400-block-maskGIMP.png?w=437&amp;ssl=1 437w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/400-block-maskGIMP.png?resize=300%2C245&amp;ssl=1 300w" sizes="auto, (max-width: 437px) 100vw, 437px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1600" height="1459" data-attachment-id="150418498" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/410-attention-variant-supportgimp/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/410-attention-variant-supportGIMP.jpg?fit=1600%2C1459&amp;ssl=1" data-orig-size="1600,1459" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;1&#34;}" data-image-title="410 attention variant supportGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/410-attention-variant-supportGIMP.jpg?fit=300%2C274&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/410-attention-variant-supportGIMP.jpg?fit=1024%2C934&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/410-attention-variant-supportGIMP.jpg?resize=1600%2C1459&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/410-attention-variant-supportGIMP.jpg?w=1600&amp;ssl=1 1600w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/410-attention-variant-supportGIMP.jpg?resize=300%2C274&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/410-attention-variant-supportGIMP.jpg?resize=1024%2C934&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/410-attention-variant-supportGIMP.jpg?resize=768%2C700&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/410-attention-variant-supportGIMP.jpg?resize=1536%2C1401&amp;ssl=1 1536w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: Meta</figcaption></figure>



<p>With sliding window attention, FlexAttention can improve performance by 10-20x! This is amazing for the end user, but unfortunately, MI300X FlexAttention was in a poor state and suffers from numerous AMD software bugs (including convergence issues) until but a couple days ago. While the latest PyTorch nightly now fixes for convergence issues, this contrasts starkly with FlexAttention on Nvidia, which has been available since August. That means a ~6 month gap exists between the availability of these fantastic Pytorch features on Nvidia and AMD’s platforms. For frontier AI labs, six months is a lifetime, with OpenAI, Anthropic, and Google having released numerous models in such a span. </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1475" height="1009" data-attachment-id="150418499" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/415-sliding-window-attention-both/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/415-sliding-window-attention-both.png?fit=1475%2C1009&amp;ssl=1" data-orig-size="1475,1009" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="415 sliding window attention – both" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/415-sliding-window-attention-both.png?fit=300%2C205&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/415-sliding-window-attention-both.png?fit=1024%2C700&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/415-sliding-window-attention-both.png?resize=1475%2C1009&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/415-sliding-window-attention-both.png?w=1475&amp;ssl=1 1475w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/415-sliding-window-attention-both.png?resize=300%2C205&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/415-sliding-window-attention-both.png?resize=1024%2C700&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/415-sliding-window-attention-both.png?resize=768%2C525&amp;ssl=1 768w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<h2 id="exploring-ideas-for-better-performance-on-amd">Exploring Ideas for Better Performance on AMD</h2>



<p>AMD recommended we try PYTORCH_ TUNABLE_OPS to improve GEMM performance by sweeping through GEMM algorithms at runtime. However, as we mentioned earlier, this API works poorly because GEMMs should be tuned when compiling the hipBLASLt/RoCBLAS/cuBLASLt and not during the users’ runtime. Users of Nvidia H100s do not need to use PYTORCH_ TUNABLE_OPS for most shapes because cuBLAS heuristic model will pick the correct algorithmn. This contrasts with AMD’s heuristic model, which never seems to pick the correct algorithm for most shapes. We recommend that AMD stop suggesting that users try tunable ops and instead focus on properly tuning their GEMM libraries internally. </p>



<p>When we tried PYTORCH_ TUNABLE_OPS on AMD, it led to an HBM memory leak of over 25 GByte out of the total MI300X capacity of 192GBytes, essentially wiping out the MI300’s HBM capacity advantage over the H100. The fix for this is to set a default hipBLASLt and rocBLAS workspace to prevent memory leaks.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="540" data-attachment-id="150418500" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/430-cublas-and-cudagimp/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/430-cublas-and-cudaGIMP.png?fit=1038%2C547&amp;ssl=1" data-orig-size="1038,547" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="430 cublas and cudaGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/430-cublas-and-cudaGIMP.png?fit=300%2C158&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/430-cublas-and-cudaGIMP.png?fit=1024%2C540&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/430-cublas-and-cudaGIMP.png?resize=1024%2C540&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/430-cublas-and-cudaGIMP.png?resize=1024%2C540&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/430-cublas-and-cudaGIMP.png?resize=300%2C158&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/430-cublas-and-cudaGIMP.png?resize=768%2C405&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/430-cublas-and-cudaGIMP.png?w=1038&amp;ssl=1 1038w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: PyTorch/AMD</figcaption></figure>



<p>As we mentioned earlier in this article, another issue we ran into was that there was a plethora of environment flags needed on MI300X to make it actually usable. We recommend to AMD that they stop putting users in the position of having to set these environment flags themselves and, instead, set default flags that lead to a usable environment. It is not simply their number, but also the complex interactions between the flags, making troubleshooting difficult. Getting reasonable training performance out of AMD MI300X is an NP-Hard problem. </p>



<p>Another issue is that certain AMD ROCm libraries could not be installed inside Docker due to AMD software CMake bugs leading to hard errors. This has since been fixed. On AMD GPUs, you need to pass in a convoluted set of flags to get the GPUs to be able to work inside a container, whereas with docker, getting GPUs to work is as simple as passing in “—gpus=all”. We recommend to AMD that they partner with Docker and ensure that Docker can autodetect GPUs for AMD as well, making the workflow as streamlined as when working with Nvidia GPUs.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="3496" height="1300" data-attachment-id="150418501" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/440-nv-vs-amd-rocker-run-gpus-allgimp/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/440-nv-vs-amd-rocker-run-gpus-allGIMP.png?fit=3496%2C1300&amp;ssl=1" data-orig-size="3496,1300" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="440 nv vs amd rocker run gpus allGIMP" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/440-nv-vs-amd-rocker-run-gpus-allGIMP.png?fit=300%2C112&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/440-nv-vs-amd-rocker-run-gpus-allGIMP.png?fit=1024%2C381&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/440-nv-vs-amd-rocker-run-gpus-allGIMP.png?resize=3496%2C1300&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/440-nv-vs-amd-rocker-run-gpus-allGIMP.png?w=3496&amp;ssl=1 3496w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/440-nv-vs-amd-rocker-run-gpus-allGIMP.png?resize=300%2C112&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/440-nv-vs-amd-rocker-run-gpus-allGIMP.png?resize=1024%2C381&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/440-nv-vs-amd-rocker-run-gpus-allGIMP.png?resize=768%2C286&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/440-nv-vs-amd-rocker-run-gpus-allGIMP.png?resize=1536%2C571&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/440-nv-vs-amd-rocker-run-gpus-allGIMP.png?resize=2048%2C762&amp;ssl=1 2048w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/440-nv-vs-amd-rocker-run-gpus-allGIMP.png?w=3000&amp;ssl=1 3000w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<h2 id="amd%e2%80%99s-forked-libraries">AMD’s Forked Libraries</h2>



<p>Many of AMD’s libraries are forked off Nvidia’s open-source or ecosystem libraries. AMD uses a tool called Hipify to carry out source-to-source translation of Nvidia CUDA to AMD HIP. While the motivation is understandable, <strong>they arenevertheless building on top of their competitor’s platform</strong> and cannot expect to match or surpass Nvidia’s user experience with this software development strategy. They need to contribute their software to the AMD ecosystem. For example, instead of supporting FP8 training by forking Nvidia/TransformerEngine and source-to-source translation, they should attempt PyTorch native FP8 training to work well on their own hardware. Currently, AMD PyTorch native FP8 training recipes don’t work on AMD and the unit tests don’t even pass yet, there is no CI/CD for AMD PyTorch native FP8 training.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="330" data-attachment-id="150418502" data-permalink="https://semianalysis.com/2024/12/22/mi300x-vs-h100-vs-h200-benchmark-part-1-training/450-amd-forks-of-nv-libraries/" data-orig-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/450-amd-forks-of-NV-libraries.png?fit=2211%2C712&amp;ssl=1" data-orig-size="2211,712" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="450 amd forks of NV libraries" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/450-amd-forks-of-NV-libraries.png?fit=300%2C97&amp;ssl=1" data-large-file="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/450-amd-forks-of-NV-libraries.png?fit=1024%2C330&amp;ssl=1" src="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/450-amd-forks-of-NV-libraries.png?resize=1024%2C330&amp;ssl=1" alt="" srcset="https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/450-amd-forks-of-NV-libraries.png?resize=1024%2C330&amp;ssl=1 1024w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/450-amd-forks-of-NV-libraries.png?resize=300%2C97&amp;ssl=1 300w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/450-amd-forks-of-NV-libraries.png?resize=768%2C247&amp;ssl=1 768w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/450-amd-forks-of-NV-libraries.png?resize=1536%2C495&amp;ssl=1 1536w, https://i0.wp.com/semianalysis.com/wp-content/uploads/2024/12/450-amd-forks-of-NV-libraries.png?resize=2048%2C660&amp;ssl=1 2048w" sizes="auto, (max-width: 1000px) 100vw, 1000px"/><figcaption>Source: SemiAnalysis</figcaption></figure>



<h2 id="detailed-recommendations-to-amd-on-how-to-fix-their-software">Detailed Recommendations to AMD on How to Fix Their Software</h2>



<p>First, AMD needs to focus on attracting more software engineering resources and improving compensation for current engineers. The current compensation gap between AMD and Nvidia means that top talent is lured to Nvidia over AMD. This top talent is also attracted to Nvidia as it has far more compute/resources for engineers. AMD should procure more GPUs for their in-house development work and submit an MLPerf GPT3 175B result as soon as possible. Even if the result is not competitive with Nvidia right now, submitting such a benchmark will kick off the process for iterative improvement. </p>



<p>We also notice that AMD frequently gives their customers custom images, and, in fact, AMD developers themselves often work on top of such bespoke images. This is not best practice, as this means that AMD engineers have a different experience vs. images available to the public. AMD should instead lift the standard of public images by using these images internally and with its customers, and the AMD executive team should personally internally test (i.e. “dogfood”) what is getting shipped publicly.</p>



<p>We recommend that AMD create a public dashboard that runs every night, showing the performance of their hardware on benchmarks such as MLPerf or TorchBench. This dashboard should also include H100/H200 performance as a baseline.</p>



<p>Finally, AMD needs to completely transform its approach to environmental flags. Instead of setting a myriad of flags to get running out of the box, it should set them to recommended defaults so users can get started quickly. </p>



<p>AMD should collaborate with Meta to get production training workloads working on ROCm, as it is well-known amongst PyTorch users that PyTorch code paths tend to have tons of bugs unless Meta uses it internally. Meta currently hand writes HIP Kernels for their production MI300X inferencing but does not use MI300X for real training. It would be a fantastic improvement for the AMD ecosystem, and a marketing victory, if a smaller version of the next Llama is trained on AMD. Not to mention that this would open the door to AMD progressively moving towards larger models/clusters with Meta. Meta using AMD GPUs for actual model training would be a win-win for both companies as Meta is also looking for alternative training chips to Nvidia.</p>



<p>Currently Nvidia offers well over 1,000 GPUs for Continuous improvement and development of Pytorch externally and many more internally. AMD doesn’t. AMD needs to work with an AMD focused GPU Neocloud to have ~10,000 GPUs of each generation for internal development purposes and Pytorch. This will still be 1/8<sup>th</sup> that of Nvidia with their coming huge Blackwell clusters, but it’s a start. These can be dedicated to internal development and CICD for Pytorch.</p>



<p><strong>Lisa, we are open to a meeting on how to fix AMD’s Datacenter GPU User Experience for the better!</strong></p>



<h2 id="h100h200mi300x-networking-bom-analysis-and-performance-per-tco">H100/H200/MI300X Networking BoM Analysis and Performance per TCO</h2>



<p>In addition to our benchmarking of collectives and GEMM throughput, we have conducted several experiments exploring insightful topics for conducting further benchmarks and running real-world workloads on clusters. These experiments cover benchmarking warmup and repeat effects, VBoost Power Shifting, MLPerf Training GPT-3, BF16 vs FP16 throughput, throughput by GEMM input distribution, power per FLOP, and throughput for the PyTorch PyPi distribution vs Nvidia NGC Stable PyTorch images. </p>



<p>We also present a detailed networking bill of materials (BoM) analysis for the 1k GPU Ethernet, 1k GPU InfiniBand, 16k GPU Ethernet, and 16k GPU InfiniBand clusters. We also discuss the impact of using 51.2T Radix vs. 25.6T Radix switches for back-end networking.</p>



<p>Lastly – we present a performance per TCO analysis that shows how the H100/H200/MI300X stacks up in terms of $/hr per effective training petaflop. These items are available below to all SemiAnalysis subscribers and will be of great interest to datacenter operators, ML scientists, and investors.</p>



<div>


<div>
<div id="semianalysis-blocks-login-to-view-content">
<h5 id="subscribe-for-full-access-to-this-article">Subscribe for full access to this article</h5>



<p>With a SemiAnalysis subscription you get full access to all articles, Data Explorer graphs, article discussions, and further insight into deep dives.</p>







<div><div>







<p>Please verify your email address to proceed.</p>



</div></div>



<p>By subscribing, you agree to the <a href="https://semianalysis.com/privacy-policy/">Privacy Policy</a> and <a href="https://semianalysis.com/terms-of-service/">Terms and Conditions</a>.</p>
</div>
</div>


</div>




</div></div>
  </body>
</html>
