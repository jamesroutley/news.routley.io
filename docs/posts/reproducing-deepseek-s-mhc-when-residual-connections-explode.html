<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://taylorkolasinski.com/notes/mhc-reproduction/">Original</a>
    <h1>Reproducing DeepSeek&#39;s MHC: When Residual Connections Explode</h1>
    
    <div id="readability-page-1" class="page"><div>  <article>  <p>January 11, 2026</p> <p><strong>Every transformer you’ve ever used has the same residual connection design from 2016.</strong></p>
<p>GPT-5, Claude, Llama, Gemini. Under the hood, they all do the same thing: <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>+</mo><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x + F(x)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>F</span><span>(</span><span>x</span><span>)</span></span></span></span>. One stream of information flowing through the network, with each layer adding to it.</p>
<p>DeepSeek asked: what if it was wider?</p>
<figure data-astro-cid-bj3fsypb=""> <img src="https://rgoswami.me/figures/v5_publication_summary.png" alt="mHC reproduction results" data-astro-cid-bj3fsypb=""/>  </figure> 

<h2 id="the-setup">The Setup</h2>
<p><strong>Standard residual connections</strong> are the backbone of every modern transformer. The idea is simple:</p>
<span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mrow><mi>l</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>x</mi><mi>l</mi></msub><mo>+</mo><mi>F</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>l</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x_{l+1} = x_l + F(x_l)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span><span>l</span><span>+</span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>l</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>F</span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>l</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>
<p>The input flows through unchanged, plus the layer’s output. One stream of information. What goes in comes out, plus a learned update. This is why transformers can be hundreds of layers deep: the gradient has a clean path backward. Simple. Stable. Unchanged since 2016.</p>
<p><strong>Hyper-Connections</strong> take a different approach. Instead of one stream, expand to <strong>n parallel streams</strong> with learnable mixing matrices:</p>
<span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mrow><mi>l</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msubsup><mi>H</mi><mi>l</mi><mrow><mi>r</mi><mi>e</mi><mi>s</mi></mrow></msubsup><msub><mi>x</mi><mi>l</mi></msub><mo>+</mo><msubsup><mi>H</mi><mi>l</mi><mrow><mi>p</mi><mi>o</mi><mi>s</mi><mi>t</mi><mo separator="true">,</mo><mi>T</mi></mrow></msubsup><mi>F</mi><mo stretchy="false">(</mo><msubsup><mi>H</mi><mi>l</mi><mrow><mi>p</mi><mi>r</mi><mi>e</mi></mrow></msubsup><msub><mi>x</mi><mi>l</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>l</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x_{l+1} = H^{res}_l x_l + H^{post,T}_l F(H^{pre}_l x_l, W_l)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span><span>l</span><span>+</span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>H</span><span><span><span><span><span><span></span><span><span>l</span></span></span><span><span></span><span><span><span>res</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>l</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>H</span><span><span><span><span><span><span></span><span><span>l</span></span></span><span><span></span><span><span><span>p</span><span>os</span><span>t</span><span>,</span><span>T</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>F</span><span>(</span><span><span>H</span><span><span><span><span><span><span></span><span><span>l</span></span></span><span><span></span><span><span><span>p</span><span>re</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>l</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>W</span><span><span><span><span><span><span></span><span><span>l</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>
<p>Compared to standard residual:</p>
<div data-astro-cid-y5xpyeus=""> <p id="hc-flow" data-astro-cid-y5xpyeus=""> <svg viewBox="0 0 700 200" xmlns="http://www.w3.org/2000/svg" data-astro-cid-y5xpyeus=""> <defs data-astro-cid-y5xpyeus=""> <!-- Glow filters --> <filter id="glow-gray" x="-50%" y="-50%" width="200%" height="200%" data-astro-cid-y5xpyeus=""> <feGaussianBlur stdDeviation="2" result="blur" data-astro-cid-y5xpyeus=""></feGaussianBlur> <feMerge data-astro-cid-y5xpyeus=""> <feMergeNode in="blur" data-astro-cid-y5xpyeus=""></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-y5xpyeus=""></feMergeNode> </feMerge> </filter> <filter id="glow-red" x="-50%" y="-50%" width="200%" height="200%" data-astro-cid-y5xpyeus=""> <feGaussianBlur stdDeviation="3" result="blur" data-astro-cid-y5xpyeus=""></feGaussianBlur> <feMerge data-astro-cid-y5xpyeus=""> <feMergeNode in="blur" data-astro-cid-y5xpyeus=""></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-y5xpyeus=""></feMergeNode> </feMerge> </filter> <filter id="glow-teal" x="-50%" y="-50%" width="200%" height="200%" data-astro-cid-y5xpyeus=""> <feGaussianBlur stdDeviation="2" result="blur" data-astro-cid-y5xpyeus=""></feGaussianBlur> <feMerge data-astro-cid-y5xpyeus=""> <feMergeNode in="blur" data-astro-cid-y5xpyeus=""></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-y5xpyeus=""></feMergeNode> </feMerge> </filter> </defs> <!-- LEFT SIDE: Standard Residual --> <g data-astro-cid-y5xpyeus=""> <!-- Title --> <text x="150" y="20" text-anchor="middle" fill="var(--color-residual)" data-astro-cid-y5xpyeus="">Standard Residual</text> <!-- Main stream line --> <line x1="30" y1="110" x2="270" y2="110" stroke="var(--color-residual)" stroke-width="2" opacity="0.4" data-astro-cid-y5xpyeus=""></line> <!-- Branch up to F --> <path d="M 100 110 L 100 70" stroke="var(--color-residual)" stroke-width="2" opacity="0.4" fill="none" data-astro-cid-y5xpyeus=""></path> <!-- F box --> <rect x="80" y="45" width="40" height="30" rx="4" fill="var(--color-bg)" stroke="var(--color-residual)" stroke-width="2" data-astro-cid-y5xpyeus=""></rect> <text x="100" y="65" text-anchor="middle" fill="var(--color-residual)" data-astro-cid-y5xpyeus="">F</text> <!-- Branch down from F --> <path d="M 120 60 L 180 60 L 180 110" stroke="var(--color-residual)" stroke-width="2" opacity="0.4" fill="none" data-astro-cid-y5xpyeus=""></path> <!-- Plus symbol --> <circle cx="180" cy="110" r="10" fill="var(--color-bg)" stroke="var(--color-residual)" stroke-width="2" data-astro-cid-y5xpyeus=""></circle> <line x1="175" y1="110" x2="185" y2="110" stroke="var(--color-residual)" stroke-width="2" data-astro-cid-y5xpyeus=""></line> <line x1="180" y1="105" x2="180" y2="115" stroke="var(--color-residual)" stroke-width="2" data-astro-cid-y5xpyeus=""></line> <!-- Animated dot on main path --> <circle cx="30" cy="110" r="4" fill="var(--color-residual)" filter="url(#glow-gray)" data-astro-cid-y5xpyeus=""></circle> <!-- Animated dot on F path --> <circle cx="100" cy="110" r="3" fill="var(--color-residual)" filter="url(#glow-gray)" opacity="0" data-astro-cid-y5xpyeus=""></circle> <circle cx="120" cy="60" r="3" fill="var(--color-residual)" filter="url(#glow-gray)" opacity="0" data-astro-cid-y5xpyeus=""></circle> <circle cx="180" cy="60" r="3" fill="var(--color-residual)" filter="url(#glow-gray)" opacity="0" data-astro-cid-y5xpyeus=""></circle> </g> <!-- RIGHT SIDE: Hyper-Connection --> <g transform="translate(350, 0)" data-astro-cid-y5xpyeus=""> <!-- Title --> <text x="160" y="20" text-anchor="middle" fill="var(--color-text)" data-astro-cid-y5xpyeus="">Hyper-Connection</text> <!-- Stream lines --> <line x1="30" y1="55" x2="310" y2="55" stroke="var(--color-text)" stroke-width="2" opacity="0.3" data-astro-cid-y5xpyeus=""></line> <line x1="30" y1="85" x2="310" y2="85" stroke="var(--color-text)" stroke-width="2" opacity="0.3" data-astro-cid-y5xpyeus=""></line> <line x1="30" y1="115" x2="310" y2="115" stroke="var(--color-text)" stroke-width="2" opacity="0.3" data-astro-cid-y5xpyeus=""></line> <line x1="30" y1="145" x2="310" y2="145" stroke="var(--color-text)" stroke-width="2" opacity="0.3" data-astro-cid-y5xpyeus=""></line> <!-- H_res mixing zone background --> <rect x="70" y="45" width="50" height="110" fill="var(--color-hc)" opacity="0" rx="4" data-astro-cid-y5xpyeus=""></rect> <!-- H_res crossing lines (faint) --> <g opacity="0.15" data-astro-cid-y5xpyeus=""> <line x1="75" y1="55" x2="115" y2="85" stroke="var(--color-hc)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="75" y1="55" x2="115" y2="115" stroke="var(--color-hc)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="75" y1="85" x2="115" y2="55" stroke="var(--color-hc)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="75" y1="85" x2="115" y2="145" stroke="var(--color-hc)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="75" y1="115" x2="115" y2="85" stroke="var(--color-hc)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="75" y1="115" x2="115" y2="145" stroke="var(--color-hc)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="75" y1="145" x2="115" y2="115" stroke="var(--color-hc)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="75" y1="145" x2="115" y2="55" stroke="var(--color-hc)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> </g> <!-- Labels --> <text x="95" y="170" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-y5xpyeus="">H_res</text> <text x="155" y="42" text-anchor="middle" fill="var(--color-muted)" data-astro-cid-y5xpyeus="">H_pre</text> <text x="215" y="42" text-anchor="middle" fill="var(--color-muted)" data-astro-cid-y5xpyeus="">H_post</text> <!-- H_pre aggregation lines --> <g opacity="0.2" data-astro-cid-y5xpyeus=""> <line x1="140" y1="55" x2="165" y2="85" stroke="var(--color-text)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="140" y1="85" x2="165" y2="85" stroke="var(--color-text)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="140" y1="115" x2="165" y2="115" stroke="var(--color-text)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="140" y1="145" x2="165" y2="115" stroke="var(--color-text)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> </g> <!-- F box --> <rect x="165" y="75" width="40" height="50" rx="4" fill="var(--color-bg)" stroke="var(--color-text)" stroke-width="2" data-astro-cid-y5xpyeus=""></rect> <text x="185" y="105" text-anchor="middle" fill="var(--color-text)" data-astro-cid-y5xpyeus="">F</text> <!-- H_post distribution lines --> <g opacity="0.2" data-astro-cid-y5xpyeus=""> <line x1="205" y1="85" x2="230" y2="55" stroke="var(--color-text)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="205" y1="85" x2="230" y2="85" stroke="var(--color-text)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="205" y1="115" x2="230" y2="115" stroke="var(--color-text)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> <line x1="205" y1="115" x2="230" y2="145" stroke="var(--color-text)" stroke-width="1" data-astro-cid-y5xpyeus=""></line> </g> <!-- Stream dots --> <circle cx="30" cy="55" r="4" fill="var(--color-text)" filter="url(#glow-teal)" data-astro-cid-y5xpyeus=""></circle> <circle cx="30" cy="85" r="4" fill="var(--color-text)" filter="url(#glow-teal)" data-astro-cid-y5xpyeus=""></circle> <circle cx="30" cy="115" r="4" fill="var(--color-text)" filter="url(#glow-teal)" data-astro-cid-y5xpyeus=""></circle> <circle cx="30" cy="145" r="4" fill="var(--color-text)" filter="url(#glow-teal)" data-astro-cid-y5xpyeus=""></circle> <!-- Mixing flash dots (hidden by default) --> <circle cx="95" cy="70" r="6" fill="var(--color-hc)" filter="url(#glow-red)" opacity="0" data-astro-cid-y5xpyeus=""></circle> <circle cx="95" cy="100" r="6" fill="var(--color-hc)" filter="url(#glow-red)" opacity="0" data-astro-cid-y5xpyeus=""></circle> <circle cx="95" cy="130" r="6" fill="var(--color-hc)" filter="url(#glow-red)" opacity="0" data-astro-cid-y5xpyeus=""></circle> </g> </svg> </p> </div>  
<p>Three matrices control how information flows:</p>
<ul>
<li><strong>H_res</strong>: How streams mix in the residual path (the red crossings)</li>
<li><strong>H_pre</strong>: How streams combine before entering the layer</li>
<li><strong>H_post</strong>: How the layer’s output distributes back to streams</li>
</ul>
<p>More expressive. More parameters with negligible computational overhead. Better performance, in theory.</p>
<p>The problem? Those mixing matrices are <strong>unconstrained</strong>. They can amplify signals, not just route them.</p>
<hr/>
<h2 id="the-explosion">The Explosion</h2>
<p>Under aggressive learning rates, Hyper-Connection (HC) signal amplification in my reproduction hit 7x before eventually collapsing. Amax (the maximum of row and column absolute sums) measures how much a matrix can amplify signals.</p>
<p data-astro-cid-2v76jlwr=""> <svg viewBox="0 0 600 180" xmlns="http://www.w3.org/2000/svg" data-astro-cid-2v76jlwr=""> <!-- TOP ROW: Unconstrained (HC) --> <g transform="translate(0, 0)" data-astro-cid-2v76jlwr=""> <!-- Label --> <text x="10" y="20" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">Unconstrained (HC)</text> <!-- Layer boxes with multipliers --> <g transform="translate(20, 35)" data-astro-cid-2v76jlwr=""> <!-- Layer 1 --> <circle cx="30" cy="20" r="18" fill="none" stroke="var(--color-hc)" stroke-width="2" data-astro-cid-2v76jlwr=""></circle> <text x="30" y="25" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">1.1x</text> <text x="30" y="55" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">1.1</text> <!-- Arrow --> <line x1="52" y1="20" x2="78" y2="20" stroke="var(--color-hc)" stroke-width="1.5" data-astro-cid-2v76jlwr=""></line> <polygon points="80,20 74,17 74,23" fill="var(--color-hc)" data-astro-cid-2v76jlwr=""></polygon> <!-- Layer 2 --> <circle cx="110" cy="20" r="18" fill="none" stroke="var(--color-hc)" stroke-width="2" data-astro-cid-2v76jlwr=""></circle> <text x="110" y="25" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">1.2x</text> <text x="110" y="55" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">1.32</text> <!-- Arrow --> <line x1="132" y1="20" x2="158" y2="20" stroke="var(--color-hc)" stroke-width="1.5" data-astro-cid-2v76jlwr=""></line> <polygon points="160,20 154,17 154,23" fill="var(--color-hc)" data-astro-cid-2v76jlwr=""></polygon> <!-- Layer 3 --> <circle cx="190" cy="20" r="18" fill="none" stroke="var(--color-hc)" stroke-width="2" data-astro-cid-2v76jlwr=""></circle> <text x="190" y="25" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">1.15x</text> <text x="190" y="55" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">1.52</text> <!-- Arrow --> <line x1="212" y1="20" x2="238" y2="20" stroke="var(--color-hc)" stroke-width="1.5" data-astro-cid-2v76jlwr=""></line> <polygon points="240,20 234,17 234,23" fill="var(--color-hc)" data-astro-cid-2v76jlwr=""></polygon> <!-- Layer 4 --> <circle cx="270" cy="20" r="18" fill="none" stroke="var(--color-hc)" stroke-width="2" data-astro-cid-2v76jlwr=""></circle> <text x="270" y="25" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">1.1x</text> <text x="270" y="55" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">1.67</text> <!-- Arrow --> <line x1="292" y1="20" x2="318" y2="20" stroke="var(--color-hc)" stroke-width="1.5" data-astro-cid-2v76jlwr=""></line> <polygon points="320,20 314,17 314,23" fill="var(--color-hc)" data-astro-cid-2v76jlwr=""></polygon> <!-- Layer 5 --> <circle cx="350" cy="20" r="18" fill="none" stroke="var(--color-hc)" stroke-width="2" data-astro-cid-2v76jlwr=""></circle> <text x="350" y="25" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">1.2x</text> <text x="350" y="55" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">2.0</text> <!-- Ellipsis --> <text x="400" y="25" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">...</text> </g> <!-- Final annotation --> <text x="480" y="55" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">After 60 layers:</text> <text x="480" y="75" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-2v76jlwr="">304x</text> </g> <!-- BOTTOM ROW: Constrained (mHC) --> <g transform="translate(0, 90)" data-astro-cid-2v76jlwr=""> <!-- Label --> <text x="10" y="20" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">Constrained (mHC)</text> <!-- Layer boxes with multipliers --> <g transform="translate(20, 35)" data-astro-cid-2v76jlwr=""> <!-- Layer 1 --> <circle cx="30" cy="20" r="18" fill="none" stroke="var(--color-mhc)" stroke-width="2" data-astro-cid-2v76jlwr=""></circle> <text x="30" y="25" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">1.0x</text> <text x="30" y="55" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">1.0</text> <!-- Arrow --> <line x1="52" y1="20" x2="78" y2="20" stroke="var(--color-mhc)" stroke-width="1.5" data-astro-cid-2v76jlwr=""></line> <polygon points="80,20 74,17 74,23" fill="var(--color-mhc)" data-astro-cid-2v76jlwr=""></polygon> <!-- Layer 2 --> <circle cx="110" cy="20" r="18" fill="none" stroke="var(--color-mhc)" stroke-width="2" data-astro-cid-2v76jlwr=""></circle> <text x="110" y="25" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">1.0x</text> <text x="110" y="55" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">1.0</text> <!-- Arrow --> <line x1="132" y1="20" x2="158" y2="20" stroke="var(--color-mhc)" stroke-width="1.5" data-astro-cid-2v76jlwr=""></line> <polygon points="160,20 154,17 154,23" fill="var(--color-mhc)" data-astro-cid-2v76jlwr=""></polygon> <!-- Layer 3 --> <circle cx="190" cy="20" r="18" fill="none" stroke="var(--color-mhc)" stroke-width="2" data-astro-cid-2v76jlwr=""></circle> <text x="190" y="25" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">1.0x</text> <text x="190" y="55" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">1.0</text> <!-- Arrow --> <line x1="212" y1="20" x2="238" y2="20" stroke="var(--color-mhc)" stroke-width="1.5" data-astro-cid-2v76jlwr=""></line> <polygon points="240,20 234,17 234,23" fill="var(--color-mhc)" data-astro-cid-2v76jlwr=""></polygon> <!-- Layer 4 --> <circle cx="270" cy="20" r="18" fill="none" stroke="var(--color-mhc)" stroke-width="2" data-astro-cid-2v76jlwr=""></circle> <text x="270" y="25" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">1.0x</text> <text x="270" y="55" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">1.0</text> <!-- Arrow --> <line x1="292" y1="20" x2="318" y2="20" stroke="var(--color-mhc)" stroke-width="1.5" data-astro-cid-2v76jlwr=""></line> <polygon points="320,20 314,17 314,23" fill="var(--color-mhc)" data-astro-cid-2v76jlwr=""></polygon> <!-- Layer 5 --> <circle cx="350" cy="20" r="18" fill="none" stroke="var(--color-mhc)" stroke-width="2" data-astro-cid-2v76jlwr=""></circle> <text x="350" y="25" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">1.0x</text> <text x="350" y="55" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">1.0</text> <!-- Ellipsis --> <text x="400" y="25" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">...</text> </g> <!-- Final annotation --> <text x="480" y="55" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">After 60 layers:</text> <text x="480" y="75" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-2v76jlwr="">1.0x</text> </g> </svg> </p> 
<p>At my 10M parameter scale, this is survivable. But DeepSeek saw this at 27B:</p>
<blockquote data-astro-cid-7q4cr32f=""> <p>“The Amax Gain Magnitude yields extreme values with peaks of 3000”</p> </blockquote> 
<p>That’s not a typo. Three thousand times amplification. At 27B parameters, unconstrained HC didn’t just drift. It exploded. My 10M reproduction hitting 9.2x is the early warning sign of this exponential failure.</p>
<p>This is why unconstrained mixing matrices break at scale. Small amplifications compound exponentially.</p>
<figure data-astro-cid-bj3fsypb=""> <img src="https://rgoswami.me/figures/v5_stress_lr.png" alt="Stress test under aggressive learning rate" data-astro-cid-bj3fsypb=""/> <figcaption data-astro-cid-bj3fsypb="">Under aggressive learning rates, HC signal amplification hit 7x before collapsing. mHC stayed flat at 1.0.</figcaption> </figure> 
<hr/>
<h2 id="the-fix-constrain-the-manifold">The Fix: Constrain the Manifold</h2>
<p>DeepSeek’s fix is clean: constrain the mixing matrices to be <em>doubly stochastic</em>.</p>
<p>A doubly stochastic matrix has:</p>
<ul>
<li>All non-negative entries</li>
<li>Rows sum to 1</li>
<li>Columns sum to 1</li>
</ul>
<p data-astro-cid-mmd5ea5f=""> <svg viewBox="0 0 520 245" xmlns="http://www.w3.org/2000/svg" data-astro-cid-mmd5ea5f=""> <!-- LEFT: Unconstrained Matrix --> <g transform="translate(10, 30)" data-astro-cid-mmd5ea5f=""> <!-- Title --> <text x="80" y="-10" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-mmd5ea5f="">Unconstrained</text> <!-- Grid border --> <rect x="0" y="0" width="160" height="160" fill="none" stroke="var(--color-hc)" stroke-width="2" data-astro-cid-mmd5ea5f=""></rect> <!-- Grid lines --> <line x1="40" y1="0" x2="40" y2="160" stroke="var(--color-hc)" stroke-width="1" opacity="0.3" data-astro-cid-mmd5ea5f=""></line> <line x1="80" y1="0" x2="80" y2="160" stroke="var(--color-hc)" stroke-width="1" opacity="0.3" data-astro-cid-mmd5ea5f=""></line> <line x1="120" y1="0" x2="120" y2="160" stroke="var(--color-hc)" stroke-width="1" opacity="0.3" data-astro-cid-mmd5ea5f=""></line> <line x1="0" y1="40" x2="160" y2="40" stroke="var(--color-hc)" stroke-width="1" opacity="0.3" data-astro-cid-mmd5ea5f=""></line> <line x1="0" y1="80" x2="160" y2="80" stroke="var(--color-hc)" stroke-width="1" opacity="0.3" data-astro-cid-mmd5ea5f=""></line> <line x1="0" y1="120" x2="160" y2="120" stroke="var(--color-hc)" stroke-width="1" opacity="0.3" data-astro-cid-mmd5ea5f=""></line> <!-- Cell backgrounds (color by value) --> <rect x="0" y="0" width="40" height="40" fill="var(--color-hc)" opacity="0.4" data-astro-cid-mmd5ea5f=""></rect> <rect x="40" y="0" width="40" height="40" fill="#4a90d9" opacity="0.2" data-astro-cid-mmd5ea5f=""></rect> <rect x="80" y="0" width="40" height="40" fill="var(--color-hc)" opacity="0.25" data-astro-cid-mmd5ea5f=""></rect> <rect x="120" y="0" width="40" height="40" fill="var(--color-hc)" opacity="0.15" data-astro-cid-mmd5ea5f=""></rect> <rect x="0" y="40" width="40" height="40" fill="var(--color-hc)" opacity="0.05" data-astro-cid-mmd5ea5f=""></rect> <rect x="40" y="40" width="40" height="40" fill="var(--color-hc)" opacity="0.28" data-astro-cid-mmd5ea5f=""></rect> <rect x="80" y="40" width="40" height="40" fill="#4a90d9" opacity="0.2" data-astro-cid-mmd5ea5f=""></rect> <rect x="120" y="40" width="40" height="40" fill="var(--color-hc)" opacity="0.05" data-astro-cid-mmd5ea5f=""></rect> <rect x="0" y="80" width="40" height="40" fill="var(--color-hc)" opacity="0.18" data-astro-cid-mmd5ea5f=""></rect> <rect x="40" y="80" width="40" height="40" fill="var(--color-hc)" opacity="0.12" data-astro-cid-mmd5ea5f=""></rect> <rect x="80" y="80" width="40" height="40" fill="var(--color-hc)" opacity="0.22" data-astro-cid-mmd5ea5f=""></rect> <rect x="120" y="80" width="40" height="40" fill="var(--color-hc)" opacity="0.06" data-astro-cid-mmd5ea5f=""></rect> <rect x="0" y="120" width="40" height="40" fill="#4a90d9" opacity="0.15" data-astro-cid-mmd5ea5f=""></rect> <rect x="40" y="120" width="40" height="40" fill="var(--color-hc)" opacity="0.06" data-astro-cid-mmd5ea5f=""></rect> <rect x="80" y="120" width="40" height="40" fill="var(--color-hc)" opacity="0.05" data-astro-cid-mmd5ea5f=""></rect> <rect x="120" y="120" width="40" height="40" fill="var(--color-hc)" opacity="0.05" data-astro-cid-mmd5ea5f=""></rect> <!-- Row 1 values --> <text x="20" y="25" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">1.3</text> <text x="60" y="25" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">-0.2</text> <text x="100" y="25" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.8</text> <text x="140" y="25" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.5</text> <!-- Row 2 values --> <text x="20" y="65" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.1</text> <text x="60" y="65" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.9</text> <text x="100" y="65" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">-0.3</text> <text x="140" y="65" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.1</text> <!-- Row 3 values --> <text x="20" y="105" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.6</text> <text x="60" y="105" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.4</text> <text x="100" y="105" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.7</text> <text x="140" y="105" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.2</text> <!-- Row 4 values --> <text x="20" y="145" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">-0.1</text> <text x="60" y="145" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.2</text> <text x="100" y="145" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.1</text> <text x="140" y="145" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.1</text> <!-- Row sums --> <text x="175" y="25" text-anchor="start" fill="var(--color-hc)" data-astro-cid-mmd5ea5f="">2.4</text> <text x="175" y="65" text-anchor="start" fill="var(--color-hc)" data-astro-cid-mmd5ea5f="">0.8</text> <text x="175" y="105" text-anchor="start" fill="var(--color-hc)" data-astro-cid-mmd5ea5f="">1.9</text> <text x="175" y="145" text-anchor="start" fill="var(--color-hc)" data-astro-cid-mmd5ea5f="">0.3</text> <!-- Column sums --> <text x="20" y="178" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-mmd5ea5f="">1.9</text> <text x="60" y="178" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-mmd5ea5f="">1.3</text> <text x="100" y="178" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-mmd5ea5f="">1.3</text> <text x="140" y="178" text-anchor="middle" fill="var(--color-hc)" data-astro-cid-mmd5ea5f="">0.9</text> </g> <!-- RIGHT: Doubly Stochastic Matrix --> <g transform="translate(270, 30)" data-astro-cid-mmd5ea5f=""> <!-- Title --> <text x="80" y="-10" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-mmd5ea5f="">Doubly Stochastic</text> <!-- Grid border --> <rect x="0" y="0" width="160" height="160" fill="none" stroke="var(--color-mhc)" stroke-width="2" data-astro-cid-mmd5ea5f=""></rect> <!-- Grid lines --> <line x1="40" y1="0" x2="40" y2="160" stroke="var(--color-mhc)" stroke-width="1" opacity="0.3" data-astro-cid-mmd5ea5f=""></line> <line x1="80" y1="0" x2="80" y2="160" stroke="var(--color-mhc)" stroke-width="1" opacity="0.3" data-astro-cid-mmd5ea5f=""></line> <line x1="120" y1="0" x2="120" y2="160" stroke="var(--color-mhc)" stroke-width="1" opacity="0.3" data-astro-cid-mmd5ea5f=""></line> <line x1="0" y1="40" x2="160" y2="40" stroke="var(--color-mhc)" stroke-width="1" opacity="0.3" data-astro-cid-mmd5ea5f=""></line> <line x1="0" y1="80" x2="160" y2="80" stroke="var(--color-mhc)" stroke-width="1" opacity="0.3" data-astro-cid-mmd5ea5f=""></line> <line x1="0" y1="120" x2="160" y2="120" stroke="var(--color-mhc)" stroke-width="1" opacity="0.3" data-astro-cid-mmd5ea5f=""></line> <!-- Cell backgrounds (intensity by value) --> <rect x="0" y="0" width="40" height="40" fill="var(--color-mhc)" opacity="0.4" data-astro-cid-mmd5ea5f=""></rect> <rect x="40" y="0" width="40" height="40" fill="var(--color-mhc)" opacity="0.2" data-astro-cid-mmd5ea5f=""></rect> <rect x="80" y="0" width="40" height="40" fill="var(--color-mhc)" opacity="0.3" data-astro-cid-mmd5ea5f=""></rect> <rect x="120" y="0" width="40" height="40" fill="var(--color-mhc)" opacity="0.1" data-astro-cid-mmd5ea5f=""></rect> <rect x="0" y="40" width="40" height="40" fill="var(--color-mhc)" opacity="0.2" data-astro-cid-mmd5ea5f=""></rect> <rect x="40" y="40" width="40" height="40" fill="var(--color-mhc)" opacity="0.3" data-astro-cid-mmd5ea5f=""></rect> <rect x="80" y="40" width="40" height="40" fill="var(--color-mhc)" opacity="0.2" data-astro-cid-mmd5ea5f=""></rect> <rect x="120" y="40" width="40" height="40" fill="var(--color-mhc)" opacity="0.3" data-astro-cid-mmd5ea5f=""></rect> <rect x="0" y="80" width="40" height="40" fill="var(--color-mhc)" opacity="0.3" data-astro-cid-mmd5ea5f=""></rect> <rect x="40" y="80" width="40" height="40" fill="var(--color-mhc)" opacity="0.2" data-astro-cid-mmd5ea5f=""></rect> <rect x="80" y="80" width="40" height="40" fill="var(--color-mhc)" opacity="0.4" data-astro-cid-mmd5ea5f=""></rect> <rect x="120" y="80" width="40" height="40" fill="var(--color-mhc)" opacity="0.1" data-astro-cid-mmd5ea5f=""></rect> <rect x="0" y="120" width="40" height="40" fill="var(--color-mhc)" opacity="0.1" data-astro-cid-mmd5ea5f=""></rect> <rect x="40" y="120" width="40" height="40" fill="var(--color-mhc)" opacity="0.3" data-astro-cid-mmd5ea5f=""></rect> <rect x="80" y="120" width="40" height="40" fill="var(--color-mhc)" opacity="0.1" data-astro-cid-mmd5ea5f=""></rect> <rect x="120" y="120" width="40" height="40" fill="var(--color-mhc)" opacity="0.5" data-astro-cid-mmd5ea5f=""></rect> <!-- Row 1 values --> <text x="20" y="25" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.4</text> <text x="60" y="25" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.2</text> <text x="100" y="25" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.3</text> <text x="140" y="25" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.1</text> <!-- Row 2 values --> <text x="20" y="65" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.2</text> <text x="60" y="65" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.3</text> <text x="100" y="65" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.2</text> <text x="140" y="65" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.3</text> <!-- Row 3 values --> <text x="20" y="105" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.3</text> <text x="60" y="105" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.2</text> <text x="100" y="105" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.4</text> <text x="140" y="105" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.1</text> <!-- Row 4 values --> <text x="20" y="145" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.1</text> <text x="60" y="145" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.3</text> <text x="100" y="145" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.1</text> <text x="140" y="145" text-anchor="middle" fill="var(--color-text)" data-astro-cid-mmd5ea5f="">0.5</text> <!-- Row sums --> <text x="175" y="25" text-anchor="start" fill="var(--color-mhc)" data-astro-cid-mmd5ea5f="">1.0</text> <text x="175" y="65" text-anchor="start" fill="var(--color-mhc)" data-astro-cid-mmd5ea5f="">1.0</text> <text x="175" y="105" text-anchor="start" fill="var(--color-mhc)" data-astro-cid-mmd5ea5f="">1.0</text> <text x="175" y="145" text-anchor="start" fill="var(--color-mhc)" data-astro-cid-mmd5ea5f="">1.0</text> <!-- Column sums --> <text x="20" y="178" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-mmd5ea5f="">1.0</text> <text x="60" y="178" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-mmd5ea5f="">1.0</text> <text x="100" y="178" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-mmd5ea5f="">1.0</text> <text x="140" y="178" text-anchor="middle" fill="var(--color-mhc)" data-astro-cid-mmd5ea5f="">1.0</text> </g> <!-- Bottom annotation --> <text x="230" y="238" text-anchor="middle" fill="var(--color-muted)" data-astro-cid-mmd5ea5f="">Rows sum to 1, columns sum to 1</text> </svg> </p> 
<p>This means the mixing operation can only take <em>weighted averages</em> of streams. It can route information, shuffle it, blend it. But it cannot amplify.</p>
<p><strong>How?</strong> The Sinkhorn-Knopp algorithm.</p>
<div data-astro-cid-tgptfnc5=""> <div id="sinkhorn" data-astro-cid-tgptfnc5=""> <svg viewBox="0 0 280 240" xmlns="http://www.w3.org/2000/svg" data-astro-cid-tgptfnc5=""> <!-- Matrix border --> <rect x="40" y="30" width="160" height="160" fill="none" stroke-width="2" data-astro-cid-tgptfnc5=""></rect> <!-- Grid lines --> <g data-astro-cid-tgptfnc5=""> <line x1="80" y1="30" x2="80" y2="190" stroke-width="1" opacity="0.3" data-astro-cid-tgptfnc5=""></line> <line x1="120" y1="30" x2="120" y2="190" stroke-width="1" opacity="0.3" data-astro-cid-tgptfnc5=""></line> <line x1="160" y1="30" x2="160" y2="190" stroke-width="1" opacity="0.3" data-astro-cid-tgptfnc5=""></line> <line x1="40" y1="70" x2="200" y2="70" stroke-width="1" opacity="0.3" data-astro-cid-tgptfnc5=""></line> <line x1="40" y1="110" x2="200" y2="110" stroke-width="1" opacity="0.3" data-astro-cid-tgptfnc5=""></line> <line x1="40" y1="150" x2="200" y2="150" stroke-width="1" opacity="0.3" data-astro-cid-tgptfnc5=""></line> </g> <!-- Cell backgrounds --> <g data-astro-cid-tgptfnc5=""> <rect data-row="0" data-col="0" x="40" y="30" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="0" data-col="1" x="80" y="30" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="0" data-col="2" x="120" y="30" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="0" data-col="3" x="160" y="30" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="1" data-col="0" x="40" y="70" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="1" data-col="1" x="80" y="70" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="1" data-col="2" x="120" y="70" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="1" data-col="3" x="160" y="70" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="2" data-col="0" x="40" y="110" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="2" data-col="1" x="80" y="110" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="2" data-col="2" x="120" y="110" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="2" data-col="3" x="160" y="110" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="3" data-col="0" x="40" y="150" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="3" data-col="1" x="80" y="150" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="3" data-col="2" x="120" y="150" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> <rect data-row="3" data-col="3" x="160" y="150" width="40" height="40" data-astro-cid-tgptfnc5=""></rect> </g> <!-- Cell values --> <g data-astro-cid-tgptfnc5=""> <text data-row="0" data-col="0" x="60" y="55" text-anchor="middle" data-astro-cid-tgptfnc5="">0.40</text> <text data-row="0" data-col="1" x="100" y="55" text-anchor="middle" data-astro-cid-tgptfnc5="">0.20</text> <text data-row="0" data-col="2" x="140" y="55" text-anchor="middle" data-astro-cid-tgptfnc5="">0.30</text> <text data-row="0" data-col="3" x="180" y="55" text-anchor="middle" data-astro-cid-tgptfnc5="">0.10</text> <text data-row="1" data-col="0" x="60" y="95" text-anchor="middle" data-astro-cid-tgptfnc5="">0.20</text> <text data-row="1" data-col="1" x="100" y="95" text-anchor="middle" data-astro-cid-tgptfnc5="">0.30</text> <text data-row="1" data-col="2" x="140" y="95" text-anchor="middle" data-astro-cid-tgptfnc5="">0.20</text> <text data-row="1" data-col="3" x="180" y="95" text-anchor="middle" data-astro-cid-tgptfnc5="">0.30</text> <text data-row="2" data-col="0" x="60" y="135" text-anchor="middle" data-astro-cid-tgptfnc5="">0.30</text> <text data-row="2" data-col="1" x="100" y="135" text-anchor="middle" data-astro-cid-tgptfnc5="">0.20</text> <text data-row="2" data-col="2" x="140" y="135" text-anchor="middle" data-astro-cid-tgptfnc5="">0.40</text> <text data-row="2" data-col="3" x="180" y="135" text-anchor="middle" data-astro-cid-tgptfnc5="">0.10</text> <text data-row="3" data-col="0" x="60" y="175" text-anchor="middle" data-astro-cid-tgptfnc5="">0.10</text> <text data-row="3" data-col="1" x="100" y="175" text-anchor="middle" data-astro-cid-tgptfnc5="">0.30</text> <text data-row="3" data-col="2" x="140" y="175" text-anchor="middle" data-astro-cid-tgptfnc5="">0.10</text> <text data-row="3" data-col="3" x="180" y="175" text-anchor="middle" data-astro-cid-tgptfnc5="">0.50</text> </g> <!-- Row sums --> <g data-astro-cid-tgptfnc5=""> <text data-row="0" x="215" y="55" text-anchor="start" data-astro-cid-tgptfnc5="">1.0</text> <text data-row="1" x="215" y="95" text-anchor="start" data-astro-cid-tgptfnc5="">1.0</text> <text data-row="2" x="215" y="135" text-anchor="start" data-astro-cid-tgptfnc5="">1.0</text> <text data-row="3" x="215" y="175" text-anchor="start" data-astro-cid-tgptfnc5="">1.0</text> </g> <!-- Column sums --> <g data-astro-cid-tgptfnc5=""> <text data-col="0" x="60" y="208" text-anchor="middle" data-astro-cid-tgptfnc5="">1.0</text> <text data-col="1" x="100" y="208" text-anchor="middle" data-astro-cid-tgptfnc5="">1.0</text> <text data-col="2" x="140" y="208" text-anchor="middle" data-astro-cid-tgptfnc5="">1.0</text> <text data-col="3" x="180" y="208" text-anchor="middle" data-astro-cid-tgptfnc5="">1.0</text> </g> <!-- Sum labels --> <text x="215" y="15" text-anchor="start" fill="var(--color-muted)" data-astro-cid-tgptfnc5="">row</text> <text x="20" y="208" text-anchor="end" fill="var(--color-muted)" data-astro-cid-tgptfnc5="">col</text> </svg>  </div> </div>  
<p>The algorithm is dead simple:</p>
<ol>
<li><strong>Start with any matrix</strong> (the raw learned weights)</li>
<li><strong>Exponentiate</strong> to make all entries positive: <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>=</mo><msup><mi>e</mi><mi>H</mi></msup></mrow><annotation encoding="application/x-tex">P = e^H</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>P</span><span></span><span>=</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>H</span></span></span></span></span></span></span></span></span></span></span></li>
<li><strong>Normalize rows</strong> so each row sums to 1</li>
<li><strong>Normalize columns</strong> so each column sums to 1</li>
<li><strong>Repeat steps 3-4</strong> until convergence</li>
</ol>
<p>That’s it. Alternate row and column normalization. Twenty iterations is enough.</p>
<p>This procedure is <em>differentiable</em>. Gradients flow back through all twenty iterations. The network learns the raw weights <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>H</span></span></span></span>, and Sinkhorn ensures the actual mixing matrix is always doubly stochastic.</p>
<span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>P</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mtext>ColNorm</mtext><mo stretchy="false">(</mo><mtext>RowNorm</mtext><mo stretchy="false">(</mo><msup><mi>P</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P^{(t+1)} = \text{ColNorm}(\text{RowNorm}(P^{(t)}))</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>P</span><span><span><span><span><span><span></span><span><span><span>(</span><span>t</span><span>+</span><span>1</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>ColNorm</span></span><span>(</span><span><span>RowNorm</span></span><span>(</span><span><span>P</span><span><span><span><span><span><span></span><span><span><span>(</span><span>t</span><span>)</span></span></span></span></span></span></span></span></span><span>))</span></span></span></span></span>
<p>When I first saw this, it felt like cheating. You’re not learning stability. You’re forcing it. But some properties shouldn’t be learned; they should be guaranteed.</p>
<p>Technical note: Strictly speaking, only the recursive matrix H_res needs the full Sinkhorn doubly-stochastic treatment. It’s the one compounding errors layer-over-layer. The input/output mixers (H_pre, H_post) are just bounded via sigmoid. The Sinkhorn compute cost is paid only where it matters most.</p>
<hr/>
<h2 id="the-results">The Results</h2>
<figure data-astro-cid-bj3fsypb=""> <img src="https://rgoswami.me/figures/v5_seed_variation.png" alt="Seed variation showing HC instability vs mHC stability" data-astro-cid-bj3fsypb=""/> <figcaption data-astro-cid-bj3fsypb="">Across 3 seeds at depth 24: HC (red) varies wildly, mHC (teal) is perfectly consistent.</figcaption> </figure> 
<h3 id="seed-variation-results-depth-24-3-seeds">Seed Variation Results (Depth 24, 3 seeds)</h3>




















<table><thead><tr><th>Model</th><th>Val Loss (mean ± std)</th><th>Max Amax (mean ± std)</th></tr></thead><tbody><tr><td>HC</td><td>0.884 ± 0.033</td><td>6.77 ± 0.60</td></tr><tr><td>mHC</td><td>1.116 ± 0.012</td><td>1.00 ± 0.00</td></tr></tbody></table>
<p>HC wins on raw performance: 0.88 vs 1.12 validation loss. At 10M parameters, the mHC constraint acts like a stability tax; you pay in expressivity. But at 27B parameters, that tax is the only thing preventing your model from exploding to NaN.</p>
<p>But look at the variance. HC’s loss varies 3x more across seeds (±0.033 vs ±0.012). And Amax? HC swings from 6.1 to 7.6 depending on the seed. mHC is 1.00. Every seed. Every run. Zero variance.</p>
<p>At 10M parameters, the instability is survivable. HC still wins. But at 27B parameters, that 6-7x amplification becomes 3000x. You can’t gamble at that scale.</p>
<h3 id="depth-scaling">Depth Scaling</h3>
<figure data-astro-cid-bj3fsypb=""> <img src="https://rgoswami.me/figures/v5_depth_sweep.png" alt="How HC behaves across depths" data-astro-cid-bj3fsypb=""/> <figcaption data-astro-cid-bj3fsypb="">Deeper models learn better but amplify more erratically.</figcaption> </figure> 
<p>I also swept depths from 6 to 24 layers (constant ~11M parameter budget):</p>
<ul>
<li><strong>Loss improves with depth</strong>, until it doesn’t. Depth 20 hit the sweet spot (0.85 val loss). Depth 24 regressed slightly (0.93) due to the width bottleneck from shrinking dim to 192.</li>
<li><strong>Amax is unpredictable.</strong> Depth 20 spiked to 9.2x. Depth 12 hit 6.6x. Depth 8 stayed at 4.3x. There’s no clean relationship; HC is chaotic.</li>
</ul>
<h3 id="experiment-details">Experiment Details</h3>
<p><strong>Dataset:</strong> TinyShakespeare (~1M chars, character-level)
<strong>Model:</strong> GPT-2 architecture, ~10M parameters
<strong>Training:</strong> 5000 steps, AdamW (β1=0.9, β2=0.95), weight decay 0.1, cosine LR decay
<strong>Hardware:</strong> Apple M-series (MPS)</p>
<p><strong>Depth sweep:</strong> 8 configurations (6-24 layers), width adjusted to maintain ~11M params
<strong>Seed variation:</strong> 3 seeds (42, 123, 456) at depth 24</p>
<hr/>
<h2 id="why-this-matters">Why This Matters</h2>
<p>Residual connections are more than a trick to help gradients flow. They’re a conservation law.</p>
<p>In physics, conservation laws constrain what’s possible but enable prediction. You can’t build a perpetual motion machine, but you can calculate exactly where a ball will land.</p>
<p>The identity mapping in residual connections is similar. It constrains the network by preventing arbitrary transformations, but it guarantees stability. Signal magnitude is preserved.</p>
<p>HC breaks conservation; mHC restores it, not by returning to identity, but by finding a richer manifold that still conserves signal.</p>
<p>In 2016, He et al. introduced ResNets to solve the vanishing gradient problem, ensuring signals didn’t die. Ten years later, the opposite problem emerged: exploding signals from hyper-connectivity. The identity mapping solved the first by being passive. mHC solves the second by enforcing conservation.</p>
<blockquote data-astro-cid-7q4cr32f=""> <p>Every residual connection is a conservation law. mHC enforces it.</p> </blockquote> 
<p>Not a hack, not a trick. A principled constraint that makes the architecture work at scale.</p>
<hr/>
<h2 id="takeaways">Takeaways</h2>
<ol>
<li>
<p><strong>The stream persistence bug humbled me.</strong> My first implementation looked right. The equations matched the paper. The code ran. But I was projecting the output back to a single stream and re-expanding it at each layer, killing the parallel architecture. The “hyper” part of Hyper-Connections wasn’t actually doing anything. Three separate audits said “looks correct.” The bug was architectural, not mathematical. I only caught it by asking: “Wait, what shape is actually flowing between layers?”</p>
</li>
<li>
<p><strong>Constraints aren’t limitations; they’re guarantees.</strong> The doubly stochastic projection forces stability. You’re not learning good behavior. You’re making bad behavior impossible. My first reaction: “That’s not elegant. That’s a straitjacket.” Then I saw HC hit 7x amplification. Oh. That’s the point.</p>
</li>
<li>
<p><strong>The boring choice scales.</strong> Standard residual connections have survived since 2016 not because they’re optimal, but because they’re stable. HC is more expressive but fragile. mHC finds a middle ground: more expressive than standard residuals, with stability guarantees.</p>
</li>
</ol>
<hr/>
<h2 id="whats-next">What’s Next</h2>
<p>This is <strong>Part 1</strong> of a two-part series.</p>
<p><strong>Part 1 (this post):</strong> Reproduce mHC at small scale to understand the mechanics.</p>
<ul>
<li>10M parameters, TinyShakespeare dataset</li>
<li>Constant parameter budget across depths</li>
<li>Goal: Validate the core claim: HC explodes, mHC doesn’t</li>
</ul>
<p><strong>Part 2 (Thursday):</strong> Scale up to see real instability.</p>
<ul>
<li>1B parameters on A100s</li>
<li>C4 dataset, fixed width (no bottleneck)</li>
<li>Goal: Push toward the 3000x Amax regime</li>
</ul>
<p>At 10M params, HC peaked at 9.2x amplification, chaotic but survivable. The paper saw 3000x at 27B. Part 2 will show where things break.</p>
<hr/>
<h2 id="resources">Resources</h2>
<p><strong>Paper:</strong> <a href="https://arxiv.org/abs/2512.24880">Manifold-Constrained Hyper-Connections</a> (arXiv 2512.24880)</p>
<p><strong>Related:</strong> <a href="https://arxiv.org/abs/1512.03385">Deep Residual Learning</a> (He et al., 2016)</p>
<p><strong>Code:</strong> Coming with Part 2.</p>
<hr/>
<p><em>Part 2 comes Thursday. Follow <a href="https://x.com/TayKolasinski">@TayKolasinski</a> to catch it.</em></p> </article>  </div></div>
  </body>
</html>
