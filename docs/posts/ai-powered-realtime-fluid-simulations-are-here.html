<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://echoesofsomewhere.com/2023/04/06/ai-fluid-simulations/">Original</a>
    <h1>AI powered realtime fluid simulations are here</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>I took an upcoming AI powered fluid simulation tool for a test dive to see if it would allow me to add realistic, interactive smoke to the game.</p>



<figure><p>
<iframe title="Maglev FluidSim" width="500" height="281" src="https://www.youtube.com/embed/ccToyF2A-hU?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
</p><figcaption>The final realtime fluid simulations in the game build.</figcaption></figure>



<h2>Deciding to add fluid simulations to the game</h2>



<p>As my game has a a stationary camera, it would be easy for me to add pre-rendered full screen fluid simulations on top of the image and it should match perfectly. I decided to use the Maglev train sequence as a prototype scenario.</p>



<p>I was going to use a software called EmberGen. It is realtime, but in order to get the fluid simulations to your game engine, you need to export them as pre rendered flip-book animations. Flip-book animations are simply an image with all of the animation frames in it. </p>



<figure><img data-lazyloaded="1" data-placeholder-resp="1024x1024" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%221024%22%20height%3D%221024%22%20viewBox%3D%220%200%201024%201024%22%3E%3Cfilter%20id%3D%22b%22%3E%3CfeGaussianBlur%20stdDeviation%3D%2212%22%20%2F%3E%3C%2Ffilter%3E%3Cpath%20fill%3D%22%23181818%22%20d%3D%22M0%200h1024v1024H0z%22%2F%3E%3Cg%20filter%3D%22url(%23b)%22%20transform%3D%22matrix(4%200%200%204%202%202)%22%20fill-opacity%3D%22.5%22%3E%3Cellipse%20rx%3D%221%22%20ry%3D%221%22%20transform%3D%22matrix(-234.49276%2030.23345%20-5.55347%20-43.07312%20122.3%20255)%22%2F%3E%3Cellipse%20cx%3D%2250%22%20rx%3D%2283%22%20ry%3D%2238%22%2F%3E%3Cellipse%20fill%3D%22%23282828%22%20rx%3D%221%22%20ry%3D%221%22%20transform%3D%22rotate(156.4%2069.2%2067.3)%20scale(219.45766%2088.97593)%22%2F%3E%3Cellipse%20rx%3D%221%22%20ry%3D%221%22%20transform%3D%22matrix(3.92042%2040.71514%20-214.74874%2020.67795%20157%20250.3)%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E" decoding="async" width="1024" height="1024" data-src="https://echoesofsomewhere.com/wp-content/uploads/2023/04/Maglev_Enterstation_RGBA-1024x1024.png" alt="" data-srcset="https://echoesofsomewhere.com/wp-content/uploads/2023/04/Maglev_Enterstation_RGBA-1024x1024.png 1024w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/Maglev_Enterstation_RGBA-300x300.png 300w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/Maglev_Enterstation_RGBA-150x150.png 150w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/Maglev_Enterstation_RGBA-768x768.png 768w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/Maglev_Enterstation_RGBA-1536x1536.png 1536w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/Maglev_Enterstation_RGBA-2048x2048.png 2048w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/Maglev_Enterstation_RGBA-500x500.png 500w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/Maglev_Enterstation_RGBA-800x800.png 800w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/Maglev_Enterstation_RGBA-1280x1280.png 1280w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/Maglev_Enterstation_RGBA-1920x1920.png 1920w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/Maglev_Enterstation_RGBA-1320x1320.png 1320w" data-sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>EmberGen generated flip-book of the train smoke when it arrives at the station</figcaption></figure>



<p>For this fluid simulation to work, my first step would be to get the train animation to EmberGen. This is very easy with the Unity FBX exporter. It can be easily installed from the package manager.</p>



<p>The FBX exporter worked great and the animations loaded up in EmberGen without a hitch! Setting up the fluid sim to emit from the train was easy and it looked great! I rendered the simulation and jumped over to Unity. Next I needed to make the velocity blending capable flip book renderer…</p>



<h2>Pivoting to real-time 3D fluid simulation</h2>



<p>But at this point I remembered that I had seen a realtime, AI powered smoke and fire simulation plugin for Unity <a rel="noreferrer noopener" href="https://zibra.ai/zibra-smoke-fire" target="_blank">https://zibra.ai/zibra-smoke-fire</a>. For sure the fluid simulations would be better rendered in realtime, not baked to choppy flip-books with very limited duration! Maybe the realtime tool was worth a try? It being an AI tool it would also be a great fit for this project!</p>



<p>Also, when the fluid sim is actually in 3D space, the moving characters will blend with it better and it will also automatically composite correctly with scene elements in depth.</p>



<figure><p>
<iframe title="Zibra Smoke &amp; Fire. Real-time smoke and fire simulation tool for Unity 3D" width="500" height="281" src="https://www.youtube.com/embed/Crx_DFazEIQ?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
</p><figcaption>Zebra AI Smoke &amp; Fire promotional video</figcaption></figure>



<p>My only concern was performance. I had experimented with Niagara fluids in Unreal 5 and they eat up quite a bit of performance. To the point of being unusable for now. </p>



<p>Luckily, I had direct connection to the Zibra guys and they showed me some demos of it running on the iPhone. It ran amazingly well! The quality was great, the frame rate butter smooth. It is amazing what you can do with AI! I have never seen 3D fluid simulations as complex as this on a phone. Ever.</p>



<p>I quickly gave up on using EmberGen and committed fully to Zibra Smoke &amp; Fire!</p>



<figure><img data-lazyloaded="1" data-placeholder-resp="1024x365" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%221024%22%20height%3D%22365%22%20viewBox%3D%220%200%201024%20365%22%3E%3Cfilter%20id%3D%22c%22%3E%3CfeGaussianBlur%20stdDeviation%3D%2255%22%20%2F%3E%3C%2Ffilter%3E%3Cpath%20fill%3D%22%23393939%22%20d%3D%22M0%200h1024v364H0z%22%2F%3E%3Cg%20filter%3D%27url(%23c)%27%20fill-opacity%3D%27.5%27%3E%3Cellipse%20fill-opacity%3D%22.5%22%20rx%3D%221%22%20ry%3D%221%22%20transform%3D%22rotate(-108.4%20482.8%20-296.6)%20scale(222.13882%20124.88144)%22%2F%3E%3Cellipse%20fill%3D%22%237c7c7c%22%20fill-opacity%3D%22.5%22%20rx%3D%221%22%20ry%3D%221%22%20transform%3D%22matrix(75.68057%2096.1298%20-196.00278%20154.30806%20569.7%20362)%22%2F%3E%3Cellipse%20fill%3D%22%23090909%22%20fill-opacity%3D%22.5%22%20rx%3D%221%22%20ry%3D%221%22%20transform%3D%22matrix(102.82766%2040.10672%20-66.19725%20169.71992%20502.6%2021.7)%22%2F%3E%3Cellipse%20fill-opacity%3D%22.5%22%20rx%3D%221%22%20ry%3D%221%22%20transform%3D%22matrix(-81.1007%2046.99562%20-76.54694%20-132.09765%20966.5%2054.3)%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E" decoding="async" width="1024" height="365" data-src="https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-1-1024x365.png" alt="" data-srcset="https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-1-1024x365.png 1024w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-1-300x107.png 300w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-1-768x274.png 768w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-1-1536x548.png 1536w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-1-2048x731.png 2048w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-1-500x178.png 500w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-1-800x286.png 800w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-1-1280x457.png 1280w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-1-1920x685.png 1920w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-1-1320x471.png 1320w" data-sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>The Smoke &amp; Fire example scene</figcaption></figure>



<p>When I loaded up Zibra for the first time (after enabling it in the URP renderer) I am greeted with a simple demo scene that has some fire and a teapot. The fire in this scene looks amazing and runs blazing fast. I asked Zibra what evil AI magic they are doing to make this so fast, how was the AI used to run their simulations?</p>



<blockquote>
<p>We use it’s as a acceleration component.</p>
<cite>Alex from Zibra</cite></blockquote>



<p>SDFs are indeed amazing. I use them on Pax Dei for a crazy number of things. Such a handy concept!</p>



<h2>Setting up the smoke simulations</h2>



<figure><img data-lazyloaded="1" data-placeholder-resp="1024x343" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%221024%22%20height%3D%22343%22%20viewBox%3D%220%200%201024%20343%22%3E%3Cfilter%20id%3D%22b%22%3E%3CfeGaussianBlur%20stdDeviation%3D%2212%22%20%2F%3E%3C%2Ffilter%3E%3Cpath%20fill%3D%22%23464646%22%20d%3D%22M0%200h1024v340H0z%22%2F%3E%3Cg%20filter%3D%22url(%23b)%22%20transform%3D%22matrix(4%200%200%204%202%202)%22%20fill-opacity%3D%22.5%22%3E%3Cellipse%20fill%3D%22%23787878%22%20cx%3D%2292%22%20rx%3D%2229%22%20ry%3D%2293%22%2F%3E%3Cellipse%20fill%3D%22%233a3a3a%22%20cx%3D%22207%22%20cy%3D%2284%22%20rx%3D%2299%22%20ry%3D%2299%22%2F%3E%3Cellipse%20fill%3D%22%233a3a3a%22%20cx%3D%2227%22%20cy%3D%2261%22%20rx%3D%2241%22%20ry%3D%2280%22%2F%3E%3Cpath%20fill%3D%22%23757575%22%20d%3D%22M72%2071l21%2029-21-10z%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E" decoding="async" width="1024" height="343" data-src="https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-2-1024x343.png" alt="" data-srcset="https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-2-1024x343.png 1024w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-2-300x100.png 300w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-2-768x257.png 768w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-2-1536x514.png 1536w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-2-2048x685.png 2048w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-2-500x167.png 500w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-2-800x268.png 800w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-2-1280x428.png 1280w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-2-1920x643.png 1920w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-2-1320x442.png 1320w" data-sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>The smoke emitter in the Unity scene</figcaption></figure>



<p>Setting up the fluid sim in the maglev scene was very simple. I used Zibra’s components to add a cylinder emitter to the train. It is important to enable the “Use Object Velocity” feature as the train is moving and this will add very nice motion to the smoke.</p>



<figure><img data-lazyloaded="1" data-placeholder-resp="1024x530" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%221024%22%20height%3D%22530%22%20viewBox%3D%220%200%201024%20530%22%3E%3Cfilter%20id%3D%22b%22%3E%3CfeGaussianBlur%20stdDeviation%3D%2212%22%20%2F%3E%3C%2Ffilter%3E%3Cpath%20fill%3D%22%23444%22%20d%3D%22M0%200h1024v528H0z%22%2F%3E%3Cg%20filter%3D%22url(%23b)%22%20transform%3D%22matrix(4%200%200%204%202%202)%22%20fill-opacity%3D%22.5%22%3E%3Cellipse%20fill%3D%22%237b7b7b%22%20cx%3D%2215%22%20cy%3D%2245%22%20rx%3D%2233%22%20ry%3D%2252%22%2F%3E%3Cellipse%20fill%3D%22%233c3c3c%22%20rx%3D%221%22%20ry%3D%221%22%20transform%3D%22matrix(-154.6972%20202.716%20-85.22267%20-65.03536%20134.6%20129.1)%22%2F%3E%3Cellipse%20fill%3D%22%23616161%22%20rx%3D%221%22%20ry%3D%221%22%20transform%3D%22rotate(-135.5%2026.5%2032.6)%20scale(16.99712%2034.37204)%22%2F%3E%3Cellipse%20fill%3D%22%233d3d3d%22%20cx%3D%2273%22%20cy%3D%226%22%20rx%3D%2234%22%20ry%3D%2234%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E" decoding="async" width="1024" height="530" data-src="https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-3-1024x530.png" alt="" data-srcset="https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-3-1024x530.png 1024w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-3-300x155.png 300w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-3-768x398.png 768w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-3-1536x796.png 1536w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-3-500x259.png 500w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-3-800x414.png 800w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-3-1280x663.png 1280w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-3-1920x995.png 1920w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-3-1320x684.png 1320w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-3.png 1942w" data-sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>Smoke &amp; Fire cover component with the Manipulators set up</figcaption></figure>



<p>This element is then linked to the solver component. I also created a ground collision shape and a force field that adds random forces &amp; twirls to the smoke to make it look more interesting and natural.</p>



<figure><img data-lazyloaded="1" data-placeholder-resp="1024x492" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%221024%22%20height%3D%22492%22%20viewBox%3D%220%200%201024%20492%22%3E%3Cfilter%20id%3D%22c%22%3E%3CfeGaussianBlur%20stdDeviation%3D%2255%22%20%2F%3E%3C%2Ffilter%3E%3Cpath%20fill%3D%22%234d4d4d%22%20d%3D%22M0%200h1024v491H0z%22%2F%3E%3Cg%20filter%3D%27url(%23c)%27%20fill-opacity%3D%27.5%27%3E%3Cellipse%20fill%3D%22%23acacac%22%20fill-opacity%3D%22.5%22%20rx%3D%221%22%20ry%3D%221%22%20transform%3D%22rotate(44.5%20-180.8%20186.4)%20scale(132.99284%20307.10947)%22%2F%3E%3Cellipse%20fill%3D%22%232e2e2e%22%20fill-opacity%3D%22.5%22%20rx%3D%221%22%20ry%3D%221%22%20transform%3D%22matrix(-570.40788%20586.5633%20-305.7826%20-297.36058%20774.4%20416.1)%22%2F%3E%3Cpath%20fill%3D%22%23737373%22%20fill-opacity%3D%22.5%22%20d%3D%22M426%20190L-62%20546%20382-62z%22%2F%3E%3Cellipse%20fill%3D%22%23080808%22%20fill-opacity%3D%22.5%22%20rx%3D%221%22%20ry%3D%221%22%20transform%3D%22matrix(-72.81993%20-22.51987%2024.62863%20-79.63876%20663.8%202)%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E" decoding="async" width="1024" height="492" data-src="https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-4-1024x492.png" alt="" data-srcset="https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-4-1024x492.png 1024w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-4-300x144.png 300w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-4-768x369.png 768w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-4-1536x739.png 1536w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-4-2048x985.png 2048w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-4-500x240.png 500w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-4-800x385.png 800w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-4-1280x616.png 1280w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-4-1920x923.png 1920w, https://echoesofsomewhere.com/wp-content/uploads/2023/04/image-4-1320x635.png 1320w" data-sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>The smoke’s lighting settings</figcaption></figure>



<p>It really did not take me all that long to set this up and have it going in the scene. Most of the time was actually spent on matching the smoke color to the scene. It was pretty straightforward with the tools provided. Zibra Smoke &amp; Fire has a couple of dozen sliders for controlling the look of the smoke, and I did not get to thoroughly study all of them yet in this quick test.</p>



<p>As I do not really have any lighting in the game, I lit the fluids with one directional light that has its contribution to any 3D objects set to off. As zebra is not lit conventionally, the directional light was still visible on the smoke. Then it was just a matter of finding a light direction that made most sense for the scene and tweaking the absorption, scattering and shadow colours to match the location image as well as possible.</p>



<p>I found matching the smoke lights with the scenes pretty intuitive.</p>







<p>In conclusion, I am absolutely amazed how well this system works! the smoke rendering added about 2 ms to my frame times based on the  unity stats inspector. That is absolutely amazing. This is a full screen fluid simulation with complex scene interactions!</p>







<p>If the plugin proves to be stable and reliable even when left running for hours, I might end up adding some fluid sim smokes and dusts to all of my scenes. It just looks so good!</p>
</div></div>
  </body>
</html>
