<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/linux/SystemdTransactionSourceWish">Original</a>
    
    <div id="readability-page-1" class="page"><div><h2>I wish systemd logged information about the source of &#34;transactions&#34;</h2>

	<p><small>November 23, 2021</small></p>
</div><div><p><a href="https://twitter.com/thatcks/status/1463189767835762692">I tweeted</a>:</p>

<blockquote><p>It would be nice if systemd would log a line when it starts a
transaction to say what the transaction was and what asked it to do
the transaction. Brought to you by the currently burning question of
&#39;what asked systemd to reboot this system?&#39;</p>
</blockquote>

<p>Back long ago, the only thing that would reboot Linux machines in
an orderly way was the system administrator logging in and running
&#39;<code>reboot</code>&#39; (or an equivalent). If a machine rebooted on you and the
logs said it was an orderly reboot (instead of an abrupt crash),
this meant you could see at least who was logged in or had just
logged in, and figure out the source of the reboot. (Sometimes this
might be someone typing a command on the wrong machine.)</p>

<p>Modern Linux doesn&#39;t work this way, especially with systemd involved.
Systemd has a D-Bus interface that people can use, there&#39;s hardware
events that may trigger a reboot, there are various programs that
may decide to ask systemd to reboot the system, and under some
circumstances systemd itself can decide that a particular, harmless
looking process failure or &#39;<code>systemctl</code>&#39; transaction actually will
trigger a reboot through some weird chain of dependencies and systemd
unit settings. These days, it&#39;s entirely possible to have a system
go through an orderly shutdown and reboot with no clues in the logs
as to what actually did it or why it happened.</p>

<p>However, systemd also has all of the information it needs to log a
summary of this. Every time systemd starts a &#34;transaction&#34; (a set
of changes to units), it knows what the starting request is and
generally who asked for it (and how). It could routinely log this,
which would make it much easier to trace back mysterious events
later.</p>

<p>(Systemd has a LogLevel, but it&#39;s generally already as verbose as
it can be (it defaults to &#39;info&#39;) without going all the way to
copious debugging messages.)</p>

<p>PS: If there already is a way to get systemd to report this
information, I&#39;d be happy to know. Systemd has a lot of documentation
and sometimes valuable information lurks in the corners.</p>

<p>(For obvious reasons this information should be recoverable after
a reboot, not just available dynamically. Although for my purposes,
I would be happy if we had something that ran during shutdowns to
log the cause, since surprise shutdowns are what we&#39;re most interested
in.)</p>
</div></div>
  </body>
</html>
