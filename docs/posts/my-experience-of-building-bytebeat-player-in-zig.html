<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.karanjanthe.me/posts/zig-beat/">Original</a>
    <h1>My Experience of building Bytebeat player in Zig</h1>
    
    <div id="readability-page-1" class="page"><div><article><p>I left my job at startup last month to have break and enjoy some time being bored, on the weekend i decided to write a bytebeat player for fun, which i was thinking from long time.</p><p>This was my first time with Zig, and I actually enjoyed writing the code, writing Zig feels like C with friendly defaults.</p><p>It is a joy to write, I am not fighting borrow checker or fighting with syntax.</p><p>You can call this a passion project, there is no goal or agenda behind building this, I built it because I wanted.</p><video controls="" width="100%"><source type="video/mp4" src="https://hc-cdn.hel1.your-objectstorage.com/s/v3/82670f2257039ca67c7d58d84a8bf92cc34c67a1_screen_recording_2025-11-04_at_1.24.52___pm.mp4"/>Your browser does not support the video tag.</video><p>Try here: <a href="https://kmj-007.github.io/zigbeat/">https://kmj-007.github.io/zigbeat/</a></p><p>For many people who don&#39;t know what is bytebeat, let me explain:</p><p>Bytebeat is music generated from short programs. These programs generate PCM audio as a function of time, see one below which is called <code>42 melody</code></p><pre><code>t*(42&amp;t&gt;&gt;10)
</code></pre><p>another way to explain, Bytebeat is a form of algorithmic music that uses bitwise operations, to generate sound, with only one variable t representing time. The expression is evaluated for each sample of the 8bits audio output.</p><p>in 2011 <a href="https://www.blogger.com/profile/06927455242083569579">viznut</a> discovered this by accident, he blogged about it <a href="http://viznut.fi/texts-en/bytebeat_deep_analysis.html">here</a></p><h2 id="why%2Fhow-does-it-work%3F">Why/How does it work? <a href="#why%2Fhow-does-it-work%3F">#</a></h2><p>Audio on computers is stored as a list of numbers called samples. Each number represents the amplitude (volume level) at a specific moment in time.</p><p>Standard audio uses:</p><ul><li>16-bit samples at 44.1kHz (CD quality)</li><li>Each sample is a number between -32768 and 32767</li><li>Each sample lasts ~22 microseconds</li></ul><p>Bytebeat uses a simpler format:</p><ul><li>8-bit samples at 8kHz</li><li>Each sample is a number between 0 and 255</li><li>Each sample lasts 125 microseconds</li></ul><p>This simpler format was chosen because it was the default for early PC sound cards on Linux. The lo-fi quality is part of bytebeat&#39;s charm.</p><p>for visual learners:</p><h2 id="experience%3A">Experience: <a href="#experience%3A">#</a></h2><p>First in my mind it was like, bytebeat is very simple, we enter some expression and it plays some sound, it doesn&#39;t sound any rocket science.</p><p>It is actually very simple if you make it in javascript, cause it provides <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval">eval</a>, which does all the 90% of the work.</p><p>I setup my project using old example repo of <a href="https://github.com/ryupold/examples-raylib.zig">raylib-Zig</a> examples, but it was outdated, cause i was using <code>0.15.1</code>,</p><p>And i also wanted to support native as well as browser which was reason for picking up raylib in the first place, for which i needed to <a href="https://github.com/KMJ-007/Zigbeat/blob/main/build.Zig">setup</a> emscripten to compile it to wasm,</p><p>I created everything from scratch from editor, to blinking cursor, select, which felt good but made me realize, how much on the abstraction we are standing!</p><p>After writing good amount of code in other languages where string was data type in default, I was little surprised that, Zig doesn&#39;t support strings, which lead me to some rabbit holes of understanding how string and struct works in Zig and how they are allocated at byte level,it was refresh for my memory to understand underlying things.</p><p><a href="https://www.openmymind.net/Switching-On-Strings-In-Zig/">you can&#39;t switch on string in Zig</a> btw!</p><p>good blog if you want to understand about struct and memory in Zig, <a href="https://www.openmymind.net/Everything-Is-A-u8-array">Everything is a []u8<br/></a></p><p>good thing for this project was, lot of LLM tools sucked at writing the Zig, specifically new syntax which is not that much popular on the internet, such as recently <code>Arraylist</code> initialization syntax has been changed, it no longer takes allocator, so i didn&#39;t use any LLM for this project.</p><h3 id="arena-allocator%3A">Arena Allocator: <a href="#arena-allocator%3A">#</a></h3><p>I ended up implementing Pratt Parser for parsing the expression, after my implementation i was getting different sound of native app and different on browser, and i was scratching my head like what was happening.</p><p>After debugging i found that in browser my second and third audio callback had lot of delay, then it clicked me that, on every sample i was creating new AST, allocating memory because of which my program was really slow in evulating the vaules to feed the PCM audio!</p><p>then after researching a bit, i was doing wrong memory management, in my case when user types expression and it doesn&#39;t changes, the memory it requires for AST is constant, it is not going to change, so for this use case i learned about <code>Arena Allocator</code>, which is a memory allocator that allocates memory in large chunks and then divides it into smaller chunks for individual allocations.</p><p>After your work is done, you just free the memory at once.</p><p>good talk if you want to learn more about <a href="https://youtu.be/TZ5a3gCCZYo?si=Nese1pLEnMWemWL2">Arena Allocator</a> and <a href="https://youtu.be/vHWiDx_l4V0?si=yahdMmXH1P6lq7YK">memory management in Zig</a></p><h2 id="todo%3A">todo: <a href="#todo%3A">#</a></h2><p>While i wanted to make the Zigbeat with the looks of retro 8bitsynth, similar to following image, replacing the piano keys with visualizer</p><p><picture><source type="image/avif" sizes="(max-width: 608px) 100vw, 608px" srcset="/img/remote/mbN3j-1920w.avif 1920w, /img/remote/mbN3j-1280w.avif 1280w, /img/remote/mbN3j-640w.avif 640w, /img/remote/mbN3j-320w.avif 320w"/><source type="image/webp" sizes="(max-width: 608px) 100vw, 608px" srcset="/img/remote/mbN3j-1920w.webp 1920w, /img/remote/mbN3j-1280w.webp 1280w, /img/remote/mbN3j-640w.webp 640w, /img/remote/mbN3j-320w.webp 320w"/><source type="image/png" sizes="(max-width: 608px) 100vw, 608px" srcset="/img/remote/mbN3j-1920w.png 1920w, /img/remote/mbN3j-1280w.png 1280w, /img/remote/mbN3j-640w.png 640w, /img/remote/mbN3j-320w.png 320w"/><img alt="Retro 8-bit synthesizer interface with piano keys and vintage aesthetic design inspiration for ZigBeat" decoding="async" height="917" loading="lazy" src="https://blog.karanjanthe.me/img/remote/mbN3j-1920w.png" width="1600"/></picture></p><p>I tried implementing but drawing everything with primitive gradients and draw api from raylib, it was getting nightmare, I joked with my friend about <code>how were they able to do this kind of things in old times they didnâ€™t even have React!, we both laughed</code>,</p><p>Then I figured out in games they use something called sprites, which is nothing images, so i picked myself to become designer, here i am trying to draw keys in photoshop:</p><p><picture><source type="image/avif" sizes="(max-width: 608px) 100vw, 608px" srcset="/img/remote/Z6zeex-1920w.avif 1920w, /img/remote/Z6zeex-1280w.avif 1280w, /img/remote/Z6zeex-640w.avif 640w, /img/remote/Z6zeex-320w.avif 320w"/><source type="image/webp" sizes="(max-width: 608px) 100vw, 608px" srcset="/img/remote/Z6zeex-1920w.webp 1920w, /img/remote/Z6zeex-1280w.webp 1280w, /img/remote/Z6zeex-640w.webp 640w, /img/remote/Z6zeex-320w.webp 320w"/><source type="image/png" sizes="(max-width: 608px) 100vw, 608px" srcset="/img/remote/Z6zeex-1920w.png 1920w, /img/remote/Z6zeex-1280w.png 1280w, /img/remote/Z6zeex-640w.png 640w, /img/remote/Z6zeex-320w.png 320w"/><img alt="Work-in-progress screenshot of designing piano key sprites in Photoshop for the ZigBeat interface" decoding="async" height="736" loading="lazy" src="https://blog.karanjanthe.me/img/remote/Z6zeex-1920w.png" width="1280"/></picture></p><p>and i tried to integrate slowly, here is some screens which looks very bad:</p><p>but it was taking lot of time, only reason me being bad design, but i guess i will finish this on some another weekend.</p><h2 id="conclusion%3A">Conclusion: <a href="#conclusion%3A">#</a></h2><p>It was actually really good decision to build with Zig and not javascript, cause i ended up learning lot about parsing and evaluation, from <a href="https://matklad.github.io/2020/04/13/simple-but-powerful-pratt-parsing.html">pratt</a><a href="https://journal.stuffwithstuff.com/2011/03/19/pratt-parsers-expression-parsing-made-easy/">parsing</a> to <a href="https://www.oilshell.org/blog/2017/12/17.html">lexer mods</a>, which i don&#39;t regret!</p><p>if you are more curious about bytebeat, here is a <a href="https://dollchan.net/bytebeat/index.html#v3b641ZTNCsMgEITfRRCipGa1MQmF9EWiB/t3KhGCt9J3b5pDe93DFu1FZPhwDjPOg53j5coOLIxdCwC1m08jKG3sepvc7NJ2uFRVSXbKcmPtUZtByAGErPTuLbc8iCaI+kv2ao8kB9WTv6k1EgRiLp8x9YOlc7+poiF3zxZMNmP8h6Z3xuaH70TePtJPY750shUXXwtqZ3ws+PqUP7jFL1T5S/b/nJ9u9xiXTW4C71rhV/2jrhjXnj1f">Rick Roll in bytebeat</a></p><p>Star on GitHub: <a href="https://github.com/KMJ-007/Zigbeat">https://github.com/KMJ-007/Zigbeat</a></p><p>Happy Hacking!</p><share-widget></share-widget><p>Published <time datetime="2025-11-01">01 Nov 2025</time></p><p><a href="https://karanjanthe.kit.com/" rel="noopener" target="_blank">Subscribe for future blogs</a></p></article></div></div>
  </body>
</html>
