<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://motherduck.com/blog/pg_duckdb-postgresql-extension-for-duckdb-motherduck/">Original</a>
    <h1>pg_duckdb: Splicing Duck and Elephant DNA</h1>
    
    <div id="readability-page-1" class="page"><div><div><section><h2 id="introducing-the-duckdb-postgres-extension">Introducing the DuckDB + Postgres Extension</h2><p><strong>You can have your analytics and transact them too</strong></p><p>We&#39;re excited to announce <a href="https://github.com/duckdb/pg_duckdb">pg_duckdb</a>, an open-source Postgres extension that embeds DuckDB&#39;s analytics engine into Postgres for fast analytical queries in your favorite transactional database.</p><p>Postgres is generating a lot of excitement, having been named <a href="https://db-engines.com/en/blog_post/106">2023 DBMS of the Year</a> by DB-Engines and recognized as the most popular database in the <a href="https://survey.stackoverflow.co/2024/technology#1-databases">2024 Stack Overflow Developer Survey</a> twice in a row. It is popular for good reasons; it is a robust way to be able to create, update, and store data about your application.</p><p>Postgres is great at a lot of things, but if you try to use it for analytics, you hit a wall pretty quickly. That is, it is great at creating, finding and locating individual rows, but if you want to understand what is going on in a data set, it can be painfully slow. For example, you might want to know how revenue is growing in the Netherlands, or how many of your customers have names that rhyme with “Duck.” These are analytical queries and often require separate ways of storing and processing the data to operate efficiently.</p><p>People have tried to add Band-Aids to improve Postgres analytical performance. but they haven’t been particularly successful because being good at analytics requires different techniques for running your queries, like being able to operate over batches of rows at once, and avoiding decompressing data until it is absolutely needed. And typically, that takes a purpose-built analytical engine, which takes a ton of effort.</p><p>This is where DuckDB comes in. DuckDB is an in-process OLAP database and uses a vectorized query engine to process chunks (vectors) of data at a time. This makes it valuable for answering analytical questions about what is going on in the data. DuckDB’s popularity has been soaring due to its speed, ease of use, and versatility.</p><p>Postgres has a rich extension model that lets you do things like search over vector embeddings and handle geospatial data.  DuckDB is an embedded database so you can build it into other software. What happens if you put those two together? Can you make a terrific transactional database that can also do awesome analytics?</p><p>Today, we’re announcing our collaboration on <code>pg_duckdb</code>, a Postgres extension that combines Postgres and DuckDB. It is fully open source, with a permissive MIT license. What’s more, the IP is owned by the DuckDB foundation, which will ensure that it stays open source. It is hosted in the official DuckDB GitHub <a href="https://github.com/duckdb/pg_duckdb">repository</a>.</p></section>
<section><h2 id="the-challenges-ahead">The challenges ahead</h2><p>In order to really make a DuckDB Postgres extension that looks and feels just like Postgres, it is going to take a lot of work to get right. It is going to need significant DuckDB experience, since it will need improvements to DuckDB. In addition, it will also require a lot of Postgres knowledge to figure out how to weave DuckDB seamlessly into how Postgres executes queries.</p><p>In order to gather the right experts, we helped put together a consortium of companies, each of whom can provide unique skills to make the project successful:</p><ul>
<li><strong>DuckDB Labs</strong> are the creators and stewards of DuckDB. They are signed up to make DuckDB changes needed to make DuckDB execution look just like Postgres.</li>
<li><strong>MotherDuck</strong> has a lot of experience running DuckDB, and so we are helping make DuckDB run well inside Postgres.</li>
<li><strong>Hydra</strong> originally kicked off the effort and has lent their know-how building Postgres extensions and storage. They are key drivers and contributors to the project.</li>
<li><strong>Neon</strong> has been building serverless managed Postgres and is lending experience about what will run well in production and how to make DuckDB work with Postgres Storage</li>
<li><strong>Microsoft</strong> has a ton of Postgres know-how including several Postgres committers and are also participating in the project.</li>
</ul><blockquote>
<p>“A lot of developers use Postgres as a general purpose database and analytics is a major use case that Postgres didn&#39;t address well until now. This will be a big win for our users and generally for the Postgres ecosystem to support columnstore data and run analytics well. We are excited to add this extension to our platform and also contribute to this project.&#34; -- Nikita Shamgunov, CEO and founder of Neon DB</p>
</blockquote><p>We recognize that we aren’t the first people with this idea; in fact, there have been several other folks who have built DuckDB as a Postgres extension. Crunchy Data has a commercial version. ParadeDB built <code>pg_analytics</code> which has similar functionality, but has a somewhat more restrictive license. But we realized that those projects, on their own, are going to struggle to be successful without commitment to do the internal engine work in DuckDB. By building in the open and making sure that DuckDB can operate seamlessly in a Postgres environment, we believe that we will be helping these projects as well.</p></section>
<section><h2 id="why-you-might-ask-does-motherduck-care-about-postgres">Why, you might ask, does MotherDuck care about Postgres?</h2><p><strong>After all, isn’t MotherDuck a cloud hosted DuckDB?</strong></p><p>First, we are committed to a thriving DuckDB ecosystem. If DuckDB becomes ubiquitous, then that is good for everyone. We want to see DuckDB in as many different places and applications as possible. And Postgres has millions of users; if a healthy proportion of those people starts becoming familiar with DuckDB, that is a win for duck fans everywhere.</p><p>Second, our motto at MotherDuck is, “If you can Duck, you can MotherDuck.” Our aim is to ensure that anywhere you can run DuckDB, running MotherDuck is as simple as opening a database with the <code>md:</code> prefix. MotherDuck allows any DuckDB user to scale into the cloud, collaborate with colleagues, and reliably manage their data.</p><p>The <code>pg_duckdb</code> extension will be fully capable of querying against data stored in the cloud in MotherDuck as if it were local. MotherDuck’s “dual execution” capabilities let us join local Postgres data against MotherDuck data seamlessly, and we will figure out the best place to run the query. As a user, you don’t really need to care where the computation runs, we’ll just figure out how to make it run fast.</p><p>Moreover, it is common in analytics to want to offload your data from your transactional database into an analytical store. The <code>pg_duckdb</code> extension along with MotherDuck can help; you can just run a query in Postgres that pulls recent data from your Postgres database and write it to MotherDuck. You don’t need to export and reimport data, or set up CDC.</p><p>Finally, there are some downsides to running analytics on the same database that runs your application. Analytics can be resource hungry in terms of the amount of memory and CPU needed to make it run well. Above a certain size, folks may not want to run this on their production transactional database. MotherDuck will help offload this to the cloud, in a way that people don’t even have to change the queries that they’re running; they just get faster.</p></section>
<section><h2 id="building-in-the-open">Building in the Open</h2><p>We’re announcing early, with the intention of building in the open with a public roadmap. The <code>pg_duckdb</code> extension is fully usable to query over data in a data lake, to run analytical queries over Postgres, and to store data in a local DuckDB database.</p><p>Today at <a href="https://duckdb.org/2024/08/15/duckcon5.html">DuckCon 5</a>, Joe Sciarrino from <a href="https://hydra.so/">Hydra</a> showed off the extension and some of its capabilities, and Frances Perry from MotherDuck demonstrated <code>pg_duckdb</code> running queries combining Postgres and MotherDuck. If you didn’t make it to that event, you’ll be able to check out the videos once they’re posted.</p><p>Key features in the roadmap include:</p><ul>
<li>Seamless MotherDuck support to be able to access your MotherDuck data in the cloud and your Postgres data at the same time.</li>
<li>Postgres native storage that will write data into Postgres storage pages and write-ahead log, which will let <code>pg_duckdb</code> to integrate with existing backup and replication.</li>
<li>Full type compatibility with Postgres. Postgres already supports a lot of data types, our goal is to support them all.</li>
<li>Full function compatibility with Postgres; any Postgres function that you run should also work in DuckDB.</li>
<li>Seamless semantic compatibility. There are subtle differences between how any two database engines compute results, even ones that support the same SQL operations. Things like how to handle rounding or decimals of certain precision, or how to deal with semi-structured JSON object can vary between engines. So to ensure compatibility, we will need to make sure DuckDB can work just like Postgres.</li>
<li>High quality, seamless lakehouse integration. DuckDB is already pretty good at querying from data lakes and has Iceberg and Delta lake support, but you should expect this functionality to get much better over time.</li>
</ul><p>Check out the <a href="https://github.com/duckdb/pg_duckdb">repository</a> today. We are excited to build this in the open and embrace contributions, feedback, and suggestions from everybody. As they say, “if you want to go far, go together.” We recognize that there are a lot of technical challenges ahead, and we welcome help and guidance on the project.</p><p>Also, please share your feedback with us on the MotherDuck <a href="https://slack.motherduck.com/">Slack</a>! If you’d like to discuss your use case in more detail, please connect with us - we’d love to learn more about what you’re building.</p></section></div></div><div><div><p>Subscribe to MotherDuck Blog</p><form><div><div><p><label for="subscribe_md_emails">Also subscribe to other MotherDuck updates</label></p></div></div></form></div></div></div>
  </body>
</html>
