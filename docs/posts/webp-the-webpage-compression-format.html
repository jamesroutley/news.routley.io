<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://purplesyringa.moe/blog/webp-the-webpage-compression-format/">Original</a>
    <h1>WebP: The WebPage Compression Format</h1>
    
    <div id="readability-page-1" class="page"><section><div><h2>WebP: The WebPage compression format</h2><p><time>September 7, 2024</time><a href="https://www.reddit.com/r/programming/comments/1fb5pzh/webp_the_webpage_compression_format/"> Discuss on Reddit</a></p><p>I want to provide a smooth experience to my site visitors, so I work on accessibility and ensure it works without JavaScript enabled. I care about page load time because some pages contain large illustrations, so I minify my HTML.</p><p>But one <em>thing</em> makes turning my blog light as a feather a pain in the ass.</p><p>See, a major win in traffic reduction (and thus latency savings on mobile!) comes not from minification but from compression. HTTP supports gzip and Brotli via the <code>Content-Encoding</code> header. This is opt-in because compression takes resources, so transferring uncompressed data might be faster.</p><p>Typically, Brotli is better than gzip, and gzip is better than nothing. gzip is so cheap everyone enables it by default, but Brotli is way slower.</p><p>Annoyingly, I host my blog on GitHub pages, which doesn’t support Brotli. So <a href="https://ntietz.com/blog/recovering-garbled-bitcoin-addresses/">Recovering garbled Bitcoin addresses</a>, the longest post on my site, takes <code>92 KiB</code> instead of <code>37 KiB</code>. This amounts to an unnecessary <code>2.5x</code> increase in load time.</p><p>There’s no <em>reason</em> why GitHub can’t support Brotli. Even if compressing files in-flight is slow, GitHub could still allow repo owners to upload pre-compressed data and use that.</p><p>GitHub doesn’t do that for us, but we can still take advantage of precompressed data. We’ll just have to manually decompress it in JavaScript on the client side.</p><p>Like a good developer, the first thing I do upon finding a problem is search for a solution on Google. <a href="https://www.npmjs.com/package/brotli-dec-wasm">brotli-dec-wasm</a> turned up after a quick search, providing a <code>200 KB</code> Brotli decompressor in WASM. <a href="https://www.npmjs.com/package/tiny-brotli-dec-wasm">tiny-brotli-dec-wasm</a> is even smaller, at <code>71 KiB</code>.</p><p>Alright, so we’re dealing with <code>92 KiB</code> for gzip vs <code>37 + 71 KiB</code> for Brotli. Umm…</p></div></section></div>
  </body>
</html>
