<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/osbuild/bootc-image-builder">Original</a>
    <h1>bootc-image-builder: Build your entire OS from a Containerfile</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">A container to create disk images from <a href="https://github.com/containers/bootc">bootc</a> container inputs,
especially oriented towards <a href="https://docs.fedoraproject.org/en-US/bootc/" rel="nofollow">Fedora/CentOS bootc</a> or
derivatives.</p>

<p dir="auto">Have <a href="https://podman.io/" rel="nofollow">podman</a> installed on your system. Either through your systems package manager if you&#39;re on
Linux or through <a href="https://podman.io/" rel="nofollow">Podman Desktop</a> if you are on macOS or Windows. If you want to run the resulting
virtual machine(s) or installer media you can use <a href="https://www.qemu.org/" rel="nofollow">qemu</a>.</p>
<p dir="auto">A very nice GUI extension for Podman Desktop is also
<a href="https://github.com/containers/podman-desktop-extension-bootc">available</a>.
The command line examples below can be all handled by
Podman Desktop.</p>
<p dir="auto">On macOS, the podman machine must be running in rootful mode:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ podman machine stop   # if already running
Waiting for VM to exit...
Machine &#34;podman-machine-default&#34; stopped successfully
$ podman machine set --rootful
$ podman machine start"><pre>$ podman machine stop   <span><span>#</span> if already running</span>
Waiting <span>for</span> VM to exit...
Machine <span><span>&#34;</span>podman-machine-default<span>&#34;</span></span> stopped successfully
$ podman machine <span>set</span> --rootful
$ podman machine start</pre></div>

<p dir="auto">If you are on a system with SELinux enforced: The package <code>osbuild-selinux</code> or equivalent osbuild SELinux policies must be installed in the system running
<code>bootc-image-builder</code>.</p>

<p dir="auto">The following example builds a <code>centos-bootc:stream9</code> bootable container into a QCOW2 image for the architecture you&#39;re running
the command on.  However, be sure to see the <a href="https://docs.fedoraproject.org/en-US/bootc/" rel="nofollow">upstream documentation</a>
for more general information!  Note that outside of initial experimentation, it&#39;s recommended to build a <em>derived</em> container image
(or reuse a derived image built via someone else) and then use this project to make a disk image from your custom image.</p>
<p dir="auto">The generic base images do not include a default user. This example injects a <a href="#-build-config">user configuration file</a>
by adding a volume-mount for the local file to the bootc-image-builder container.</p>
<p dir="auto">The following command will create a QCOW2 disk image. First, create <code>./config.toml</code> as described above to configure user access.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Ensure the image is fetched
sudo podman pull quay.io/centos-bootc/centos-bootc:stream9
mkdir output
sudo podman run \
    --rm \
    -it \
    --privileged \
    --pull=newer \
    --security-opt label=type:unconfined_t \
    -v ./config.toml:/config.toml:ro \
    -v ./output:/output \
    -v /var/lib/containers/storage:/var/lib/containers/storage \
    quay.io/centos-bootc/bootc-image-builder:latest \
    --type qcow2 \
	--use-librepo=True \
    quay.io/centos-bootc/centos-bootc:stream9"><pre><span><span>#</span> Ensure the image is fetched</span>
sudo podman pull quay.io/centos-bootc/centos-bootc:stream9
mkdir output
sudo podman run \
    --rm \
    -it \
    --privileged \
    --pull=newer \
    --security-opt label=type:unconfined_t \
    -v ./config.toml:/config.toml:ro \
    -v ./output:/output \
    -v /var/lib/containers/storage:/var/lib/containers/storage \
    quay.io/centos-bootc/bootc-image-builder:latest \
    --type qcow2 \
	--use-librepo=True \
    quay.io/centos-bootc/centos-bootc:stream9</pre></div>
<p dir="auto">Note that some images (like fedora) do not have a default root
filesystem type. In this case adds the switch <code>--rootfs &lt;type&gt;</code>,
e.g. <code>--rootfs btrfs</code>.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Running the resulting QCOW2 file on Linux (x86_64)</h3><a id="user-content-running-the-resulting-qcow2-file-on-linux-x86_64" aria-label="Permalink: Running the resulting QCOW2 file on Linux (x86_64)" href="#running-the-resulting-qcow2-file-on-linux-x86_64"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">A virtual machine can be launched using <code>qemu-system-x86_64</code> or with <code>virt-install</code> as shown below;
however there is more information about virtualization and other
choices in the <a href="https://docs.fedoraproject.org/en-US/bootc/" rel="nofollow">Fedora/CentOS bootc documentation</a>.</p>

<div dir="auto" data-snippet-clipboard-copy-content="qemu-system-x86_64 \
    -M accel=kvm \
    -cpu host \
    -smp 2 \
    -m 4096 \
    -bios /usr/share/OVMF/OVMF_CODE.fd \
    -serial stdio \
    -snapshot output/qcow2/disk.qcow2"><pre>qemu-system-x86_64 \
    -M accel=kvm \
    -cpu host \
    -smp 2 \
    -m 4096 \
    -bios /usr/share/OVMF/OVMF_CODE.fd \
    -serial stdio \
    -snapshot output/qcow2/disk.qcow2</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="sudo virt-install \
    --name fedora-bootc \
    --cpu host \
    --vcpus 4 \
    --memory 4096 \
    --import --disk ./output/qcow2/disk.qcow2,format=qcow2 \
    --os-variant fedora-eln"><pre>sudo virt-install \
    --name fedora-bootc \
    --cpu host \
    --vcpus 4 \
    --memory 4096 \
    --import --disk ./output/qcow2/disk.qcow2,format=qcow2 \
    --os-variant fedora-eln</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Running the resulting QCOW2 file on macOS (aarch64)</h3><a id="user-content-running-the-resulting-qcow2-file-on-macos-aarch64" aria-label="Permalink: Running the resulting QCOW2 file on macOS (aarch64)" href="#running-the-resulting-qcow2-file-on-macos-aarch64"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This assumes qemu was installed through <a href="https://brew.sh/" rel="nofollow">homebrew</a>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="qemu-system-aarch64 \
    -M accel=hvf \
    -cpu host \
    -smp 2 \
    -m 4096 \
    -bios /opt/homebrew/Cellar/qemu/8.1.3_2/share/qemu/edk2-aarch64-code.fd \
    -serial stdio \
    -machine virt \
    -snapshot output/qcow2/disk.qcow2"><pre>qemu-system-aarch64 \
    -M accel=hvf \
    -cpu host \
    -smp 2 \
    -m 4096 \
    -bios /opt/homebrew/Cellar/qemu/8.1.3_2/share/qemu/edk2-aarch64-code.fd \
    -serial stdio \
    -machine virt \
    -snapshot output/qcow2/disk.qcow2</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="Usage:
  sudo podman run \
    --rm \
    -it \
    --privileged \
    --pull=newer \
    --security-opt label=type:unconfined_t \
    -v ./output:/output \
    -v /var/lib/containers/storage:/var/lib/containers/storage \
    quay.io/centos-bootc/bootc-image-builder:latest \
    &lt;imgref&gt;

Flags:
      --chown string          chown the ouput directory to match the specified UID:GID
      --output string         artifact output directory (default &#34;.&#34;)
      --progress string       type of progress bar to use (e.g. verbose,term) (default &#34;auto&#34;)
      --rootfs string         Root filesystem type. If not given, the default configured in the source container image is used.
      --target-arch string    build for the given target architecture (experimental)
      --type stringArray      image types to build [ami, anaconda-iso, gce, iso, qcow2, raw, vhd, vmdk] (default [qcow2])
      --version               version for bootc-image-builder

Global Flags:
      --log-level string   logging level (debug, info, error); default error
  -v, --verbose            Switch to verbose mode"><pre>Usage:
  sudo podman run \
    --rm \
    -it \
    --privileged \
    --pull=newer \
    --security-opt label=type:unconfined_t \
    -v ./output:/output \
    -v /var/lib/containers/storage:/var/lib/containers/storage \
    quay.io/centos-bootc/bootc-image-builder:latest \
    <span>&lt;</span>imgref<span>&gt;</span>

Flags:
      --chown string          chown the ouput directory to match the specified UID:GID
      --output string         artifact output directory (default <span><span>&#34;</span>.<span>&#34;</span></span>)
      --progress string       <span>type</span> of progress bar to use (e.g. verbose,term) (default <span><span>&#34;</span>auto<span>&#34;</span></span>)
      --rootfs string         Root filesystem type. If not given, the default configured <span>in</span> the <span>source</span> container image is used.
      --target-arch string    build <span>for</span> the given target architecture (experimental)
      --type stringArray      image types to build [ami, anaconda-iso, gce, iso, qcow2, raw, vhd, vmdk] (default [qcow2])
      --version               version <span>for</span> bootc-image-builder

Global Flags:
      --log-level string   logging level (debug, info, error)<span>;</span> default error
  -v, --verbose            Switch to verbose mode</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Detailed description of optional flags</h3><a id="user-content-detailed-description-of-optional-flags" aria-label="Permalink: Detailed description of optional flags" href="#detailed-description-of-optional-flags"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>--chown</td>
<td>chown the output directory to match the specified UID:GID</td>
<td>❌</td>
</tr>
<tr>
<td>--output</td>
<td>output the artifact into the given output directory</td>
<td><code>.</code></td>
</tr>
<tr>
<td>--progress</td>
<td>Show progress in the given format, supported: verbose,term,debug. If empty it is auto-detected</td>
<td><code>auto</code></td>
</tr>
<tr>
<td><strong>--rootfs</strong></td>
<td>Root filesystem type. Overrides the default from the source container. Supported values: ext4, xfs, btrfs</td>
<td>❌</td>
</tr>
<tr>
<td><strong>--type</strong></td>
<td><a href="#-image-types">Image type</a> to build (can be passed multiple times)</td>
<td><code>qcow2</code></td>
</tr>
<tr>
<td>--target-arch</td>
<td><a href="#-target-architecture">Target arch</a> to build</td>
<td>❌</td>
</tr>
<tr>
<td>--log-level</td>
<td>Change log level (debug, info, error)</td>
<td><code>error</code></td>
</tr>
<tr>
<td>-v,--verbose</td>
<td>Switch output/progress to verbose mode (implies --log-level=info)</td>
<td><code>false</code></td>
</tr>
<tr>
<td>--use-librepo</td>
<td>Download rpms using librepo (faster and more robust)</td>
<td><code>false</code></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">The <code>--type</code> parameter can be given multiple times and multiple
outputs will be produced. Note that comma or space separating the
<code>image-types</code>will not work, but this example will: <code>--type qcow2 --type ami</code>.</p>
<p dir="auto"><em>💡 Tip: Flags in <strong>bold</strong> are the most important ones.</em></p>

<p dir="auto">The following image types are currently available via the <code>--type</code> argument:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Image type</th>
<th>Target environment</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ami</code></td>
<td><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html" rel="nofollow">Amazon Machine Image</a></td>
</tr>
<tr>
<td><code>qcow2</code> <strong>(default)</strong></td>
<td><a href="https://www.qemu.org/" rel="nofollow">QEMU</a></td>
</tr>
<tr>
<td><code>vmdk</code></td>
<td><a href="https://en.wikipedia.org/wiki/VMDK" rel="nofollow">VMDK</a> usable in vSphere, among others</td>
</tr>
<tr>
<td><code>anaconda-iso</code></td>
<td>An unattended Anaconda installer that installs to the first disk found.</td>
</tr>
<tr>
<td><code>raw</code></td>
<td>Unformatted <a href="https://en.wikipedia.org/wiki/Rawdisk" rel="nofollow">raw disk</a>.</td>
</tr>
<tr>
<td><code>vhd</code></td>
<td><a href="https://en.wikipedia.org/wiki/VHD_(file_format)" rel="nofollow">vhd</a> usable in Virtual PC, among others</td>
</tr>
<tr>
<td><code>gce</code></td>
<td><a href="https://cloud.google.com/compute/docs/images#custom_images" rel="nofollow">GCE</a></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<p dir="auto">Specify the target architecture of the system on which the disk image will be installed on. By default,
<code>bootc-image-builder</code> will build for the native host architecture. The target architecture
must match an available architecture of the <code>bootc-image-builder</code> image you are using to build the disk image.
Navigate to the <a href="https://quay.io/repository/centos-bootc/bootc-image-builder?tab=tags" rel="nofollow">centos-image-builder repository tags page</a>
and hover over the Tux icons to see the supported target architectures.
The architecture of the bootc OCI image and the bootc-image-builder image must match. For example, when building
a non-native architecture bootc OCI image, say, building for x86_64 from an arm-based Mac, it is possible to run
<code>podman build</code> with the <code>--platform linux/amd64</code> flag. In this case, to then build a disk image from the same arm-based Mac,
you should provide <code>--target-arch amd64</code> when running the <code>bootc-image-builder</code> command.</p>

<p dir="auto">The following progress types are supported:</p>
<ul dir="auto">
<li>verbose: No spinners or progress bar, just information and full osbuild output</li>
<li>term: Terminal based output, spinner, progressbar and most details of osbuild are hidden</li>
<li>debug: Details how the progress is called, mostly useful for bugreports</li>
</ul>
<p dir="auto">Note that when no value is given the progress is auto-detected baed on the environment. When <code>stdin</code> is a terminal the &#34;term&#34; progress is used, otherwise &#34;verbose&#34;. The output of <code>verbose</code> is exactaly the same as it was before progress reporting was implemented.</p>

<div dir="auto"><h3 tabindex="-1" dir="auto">Amazon Machine Images (AMIs)</h3><a id="user-content-amazon-machine-images-amis" aria-label="Permalink: Amazon Machine Images (AMIs)" href="#amazon-machine-images-amis"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>

<p dir="auto">In order to successfully import an AMI into your AWS account, you need to have the <a href="https://docs.aws.amazon.com/vm-import/latest/userguide/required-permissions.html" rel="nofollow">vmimport service role</a> configured on your account with the following additional permissions:</p>
<div data-snippet-clipboard-copy-content="{
    &#34;Effect&#34;: &#34;Allow&#34;,
    &#34;Action&#34;: [
        &#34;s3:ListAllMyBuckets&#34;,
        &#34;s3:GetBucketAcl&#34;,
        &#34;s3:DeleteObject&#34;
    ],
    &#34;Resource&#34;: [
        &#34;arn:aws:s3:::amzn-s3-demo-import-bucket&#34;,
        &#34;arn:aws:s3:::amzn-s3-demo-import-bucket/*&#34;,
        &#34;arn:aws:s3:::amzn-s3-demo-export-bucket&#34;,
        &#34;arn:aws:s3:::amzn-s3-demo-export-bucket/*&#34;
    ]
},"><pre><code>{
    &#34;Effect&#34;: &#34;Allow&#34;,
    &#34;Action&#34;: [
        &#34;s3:ListAllMyBuckets&#34;,
        &#34;s3:GetBucketAcl&#34;,
        &#34;s3:DeleteObject&#34;
    ],
    &#34;Resource&#34;: [
        &#34;arn:aws:s3:::amzn-s3-demo-import-bucket&#34;,
        &#34;arn:aws:s3:::amzn-s3-demo-import-bucket/*&#34;,
        &#34;arn:aws:s3:::amzn-s3-demo-export-bucket&#34;,
        &#34;arn:aws:s3:::amzn-s3-demo-export-bucket/*&#34;
    ]
},
</code></pre></div>
<p dir="auto">Replace <code>amzn-s3-demo-import-bucket</code> in the ARN with the bucket name.</p>

<p dir="auto">AMIs can be automatically uploaded to AWS by specifying the following flags:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>--aws-ami-name</td>
<td>Name for the AMI in AWS</td>
</tr>
<tr>
<td>--aws-bucket</td>
<td>Target S3 bucket name for intermediate storage when creating AMI</td>
</tr>
<tr>
<td>--aws-region</td>
<td>Target region for AWS uploads</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><em>Notes:</em></p>
<ul dir="auto">
<li><em>These flags must all be specified together. If none are specified, the AMI is exported to the output directory.</em></li>
<li><em>The bucket must already exist in the selected region, bootc-image-builder will not create it if it is missing.</em></li>
<li><em>The output volume is not needed in this case. The image is uploaded to AWS and not exported.</em></li>
</ul>

<p dir="auto">If you already have a credentials file (usually in <code>$HOME/.aws/credentials</code>) you need to forward the
directory to the container</p>
<p dir="auto">For example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ sudo podman run \
  --rm \
  -it \
  --privileged \
  --pull=newer \
  --security-opt label=type:unconfined_t \
  -v $HOME/.aws:/root/.aws:ro \
  -v /var/lib/containers/storage:/var/lib/containers/storage \
  --env AWS_PROFILE=default \
  quay.io/centos-bootc/bootc-image-builder:latest \
  --type ami \
  --aws-ami-name centos-bootc-ami \
  --aws-bucket fedora-bootc-bucket \
  --aws-region us-east-1 \
  quay.io/centos-bootc/centos-bootc:stream9"><pre>$ sudo podman run \
  --rm \
  -it \
  --privileged \
  --pull=newer \
  --security-opt label=type:unconfined_t \
  -v <span>$HOME</span>/.aws:/root/.aws:ro \
  -v /var/lib/containers/storage:/var/lib/containers/storage \
  --env AWS_PROFILE=default \
  quay.io/centos-bootc/bootc-image-builder:latest \
  --type ami \
  --aws-ami-name centos-bootc-ami \
  --aws-bucket fedora-bootc-bucket \
  --aws-region us-east-1 \
  quay.io/centos-bootc/centos-bootc:stream9</pre></div>
<p dir="auto">Notes:</p>
<ul dir="auto">
<li><em>you can also inject <strong>ALL</strong> your AWS configuration parameters with <code>--env AWS_*</code></em></li>
</ul>
<p dir="auto">see the <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html" rel="nofollow">AWS CLI documentation</a> for more information about other environment variables</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">AWS credentials via environment</h4><a id="user-content-aws-credentials-via-environment" aria-label="Permalink: AWS credentials via environment" href="#aws-credentials-via-environment"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">AWS credentials can be specified through two environment variables:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>AWS_ACCESS_KEY_ID</td>
<td>AWS access key associated with an IAM account.</td>
</tr>
<tr>
<td>AWS_SECRET_ACCESS_KEY</td>
<td>Specifies the secret key associated with the access key. This is essentially the &#34;password&#34; for the access key.</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">Those <strong>should not</strong> be specified with <code>--env</code> as plain value, but you can silently hand them over with <code>--env AWS_*</code> or
save these variables in a file and pass them using the <code>--env-file</code> flag for <code>podman run</code>.</p>
<p dir="auto">For example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ cat aws.secrets
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

$ sudo podman run \
  --rm \
  -it \
  --privileged \
  --pull=newer \
  --security-opt label=type:unconfined_t \
  -v /var/lib/containers/storage:/var/lib/containers/storage \
  --env-file=aws.secrets \
  quay.io/centos-bootc/bootc-image-builder:latest \
  --type ami \
  --aws-ami-name centos-bootc-ami \
  --aws-bucket centos-bootc-bucket \
  --aws-region us-east-1 \
  quay.io/centos-bootc/centos-bootc:stream9"><pre>$ cat aws.secrets
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

$ sudo podman run \
  --rm \
  -it \
  --privileged \
  --pull=newer \
  --security-opt label=type:unconfined_t \
  -v /var/lib/containers/storage:/var/lib/containers/storage \
  --env-file=aws.secrets \
  quay.io/centos-bootc/bootc-image-builder:latest \
  --type ami \
  --aws-ami-name centos-bootc-ami \
  --aws-bucket centos-bootc-bucket \
  --aws-region us-east-1 \
  quay.io/centos-bootc/centos-bootc:stream9</pre></div>

<p dir="auto">The following volumes can be mounted inside the container:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Volume</th>
<th>Purpose</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/output</code></td>
<td>Used for storing the resulting artifacts</td>
<td>✅</td>
</tr>
<tr>
<td><code>/store</code></td>
<td>Used for the <a href="https://www.osbuild.org/" rel="nofollow">osbuild store</a></td>
<td>No</td>
</tr>
<tr>
<td><code>/rpmmd</code></td>
<td>Used for the DNF cache</td>
<td>No</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<p dir="auto">A build config is a Toml (or JSON) file with customizations for the resulting image. The config file is mapped into the container directory to <code>/config.toml</code>. The customizations are specified under a <code>customizations</code> object.</p>
<p dir="auto">As an example, let&#39;s show how you can add a user to the image:</p>
<p dir="auto">Firstly create a file <code>./config.toml</code> and put the following content into it:</p>
<div dir="auto" data-snippet-clipboard-copy-content="[[customizations.user]]
name = &#34;alice&#34;
password = &#34;bob&#34;
key = &#34;ssh-rsa AAA ... user@email.com&#34;
groups = [&#34;wheel&#34;]"><pre>[[<span>customizations</span>.<span>user</span>]]
<span>name</span> = <span><span>&#34;</span>alice<span>&#34;</span></span>
<span>password</span> = <span><span>&#34;</span>bob<span>&#34;</span></span>
<span>key</span> = <span><span>&#34;</span>ssh-rsa AAA ... user@email.com<span>&#34;</span></span>
<span>groups</span> = [<span><span>&#34;</span>wheel<span>&#34;</span></span>]</pre></div>
<p dir="auto">Then, run <code>bootc-image-builder</code> with the following arguments:</p>
<div dir="auto" data-snippet-clipboard-copy-content="sudo podman run \
    --rm \
    -it \
    --privileged \
    --pull=newer \
    --security-opt label=type:unconfined_t \
    -v ./config.toml:/config.toml:ro \
    -v ./output:/output \
    -v /var/lib/containers/storage:/var/lib/containers/storage \
    quay.io/centos-bootc/bootc-image-builder:latest \
    --type qcow2 \
    quay.io/centos-bootc/centos-bootc:stream9"><pre>sudo podman run \
    --rm \
    -it \
    --privileged \
    --pull=newer \
    --security-opt label=type:unconfined_t \
    -v ./config.toml:/config.toml:ro \
    -v ./output:/output \
    -v /var/lib/containers/storage:/var/lib/containers/storage \
    quay.io/centos-bootc/bootc-image-builder:latest \
    --type qcow2 \
    quay.io/centos-bootc/centos-bootc:stream9</pre></div>
<p dir="auto">The configuration can also be passed in via stdin when <code>--config -</code>
is used. Only JSON configuration is supported in this mode.</p>
<p dir="auto">Additionally, images can embed a build config file, either as
<code>config.json</code> or <code>config.toml</code> in the <code>/usr/lib/bootc-image-builder</code>
directory. If this exist, and contains filesystem or disk
customizations, then these are used by default if no such
customization are specified in the regular build config.</p>

<p dir="auto">Possible fields:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Field</th>
<th>Use</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>Name of the user</td>
<td>✅</td>
</tr>
<tr>
<td><code>password</code></td>
<td>Unencrypted password</td>
<td>No</td>
</tr>
<tr>
<td><code>key</code></td>
<td>Public SSH key contents</td>
<td>No</td>
</tr>
<tr>
<td><code>groups</code></td>
<td>An array of secondary to put the user into</td>
<td>No</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">Example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;customizations&#34;: {
    &#34;user&#34;: [
      {
        &#34;name&#34;: &#34;alice&#34;,
        &#34;password&#34;: &#34;bob&#34;,
        &#34;key&#34;: &#34;ssh-rsa AAA ... user@email.com&#34;,
        &#34;groups&#34;: [
          &#34;wheel&#34;,
          &#34;admins&#34;
        ]
      }
    ]
  }
}"><pre>{
  <span>&#34;customizations&#34;</span>: {
    <span>&#34;user&#34;</span>: [
      {
        <span>&#34;name&#34;</span>: <span><span>&#34;</span>alice<span>&#34;</span></span>,
        <span>&#34;password&#34;</span>: <span><span>&#34;</span>bob<span>&#34;</span></span>,
        <span>&#34;key&#34;</span>: <span><span>&#34;</span>ssh-rsa AAA ... user@email.com<span>&#34;</span></span>,
        <span>&#34;groups&#34;</span>: [
          <span><span>&#34;</span>wheel<span>&#34;</span></span>,
          <span><span>&#34;</span>admins<span>&#34;</span></span>
        ]
      }
    ]
  }
}</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Kernel Arguments (<code>kernel</code>, mapping)</h3><a id="user-content-kernel-arguments-kernel-mapping" aria-label="Permalink: Kernel Arguments (kernel, mapping)" href="#kernel-arguments-kernel-mapping"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;customizations&#34;: {
    &#34;kernel&#34;: {
      &#34;append&#34;: &#34;mitigations=auto,nosmt&#34;
    }
  }
}
"><pre>{
  <span>&#34;customizations&#34;</span>: {
    <span>&#34;kernel&#34;</span>: {
      <span>&#34;append&#34;</span>: <span><span>&#34;</span>mitigations=auto,nosmt<span>&#34;</span></span>
    }
  }
}
</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Filesystems (<code>filesystem</code>, array)</h3><a id="user-content-filesystems-filesystem-array" aria-label="Permalink: Filesystems (filesystem, array)" href="#filesystems-filesystem-array"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The filesystem section of the customizations can be used to set the minimum size of the base partitions (<code>/</code> and <code>/boot</code>) as well as to create extra partitions with mountpoints under <code>/var</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="[[customizations.filesystem]]
mountpoint = &#34;/&#34;
minsize = &#34;10 GiB&#34;

[[customizations.filesystem]]
mountpoint = &#34;/var/data&#34;
minsize = &#34;20 GiB&#34;"><pre>[[<span>customizations</span>.<span>filesystem</span>]]
<span>mountpoint</span> = <span><span>&#34;</span>/<span>&#34;</span></span>
<span>minsize</span> = <span><span>&#34;</span>10 GiB<span>&#34;</span></span>

[[<span>customizations</span>.<span>filesystem</span>]]
<span>mountpoint</span> = <span><span>&#34;</span>/var/data<span>&#34;</span></span>
<span>minsize</span> = <span><span>&#34;</span>20 GiB<span>&#34;</span></span></pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;customizations&#34;: {
    &#34;filesystem&#34;: [
      {
        &#34;mountpoint&#34;: &#34;/&#34;,
        &#34;minsize&#34;: &#34;10 GiB&#34;
      },
      {
        &#34;mountpoint&#34;: &#34;/var/data&#34;,
        &#34;minsize&#34;: &#34;20 GiB&#34;
      }
    ]
  }
}"><pre>{
  <span>&#34;customizations&#34;</span>: {
    <span>&#34;filesystem&#34;</span>: [
      {
        <span>&#34;mountpoint&#34;</span>: <span><span>&#34;</span>/<span>&#34;</span></span>,
        <span>&#34;minsize&#34;</span>: <span><span>&#34;</span>10 GiB<span>&#34;</span></span>
      },
      {
        <span>&#34;mountpoint&#34;</span>: <span><span>&#34;</span>/var/data<span>&#34;</span></span>,
        <span>&#34;minsize&#34;</span>: <span><span>&#34;</span>20 GiB<span>&#34;</span></span>
      }
    ]
  }
}</pre></div>


<p dir="auto">The <code>--rootfs</code> option also sets the filesystem types for all additional mountpoints, where appropriate. See the see <a href="#detailed-description-of-optional-flags">Detailed description of optional flags</a>.</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">Allowed mountpoints and sizes</h4><a id="user-content-allowed-mountpoints-and-sizes" aria-label="Permalink: Allowed mountpoints and sizes" href="#allowed-mountpoints-and-sizes"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The following restrictions and rules apply, unless the rootfs is <code>btrfs</code>:</p>
<ul dir="auto">
<li><code>/</code> can be specified to set the desired (minimum) size of the root filesystem. The final size of the filesystem, mounted at <code>/sysroot</code> on a booted system, is the value specified in this configuration or 2x the size of the base container, whichever is largest.</li>
<li><code>/boot</code>can be specified to set the desired size of the boot partition.</li>
<li>Subdirectories of <code>/var</code> are supported, but symlinks in <code>/var</code> are not. For example, <code>/var/home</code> and <code>/var/run</code> are symlinks and cannot be filesystems on their own.</li>
<li><code>/var</code> itself cannot be a mountpoint.</li>
</ul>
<p dir="auto">The <code>rootfs</code> option (or source container config, see <a href="#detailed-description-of-optional-flags">Detailed description of optional flags</a> section) defines the filesystem type for the root filesystem. Currently, creation of btrfs subvolumes at build time is not supported. Therefore, if the <code>rootfs</code> is <code>btrfs</code>, no custom mountpoints are supported under <code>/var</code>.  Only <code>/</code> and <code>/boot</code> can be configured.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Anaconda ISO (installer) options (<code>installer</code>, mapping)</h3><a id="user-content-anaconda-iso-installer-options-installer-mapping" aria-label="Permalink: Anaconda ISO (installer) options (installer, mapping)" href="#anaconda-iso-installer-options-installer-mapping"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Users can include kickstart file content that will be added to an ISO build to configure the installation process. When using custom kickstart scripts the customization needs to be done via the custom kickstart script. For example using a <code>[customizations.user]</code> block alongside a <code>[customizations.installer.kickstart]</code> block is not supported. See this issue [<a data-error-text="Failed to load title" data-id="2392125131" data-permission-text="Title is private" data-url="https://github.com/osbuild/bootc-image-builder/issues/528" data-hovercard-type="issue" data-hovercard-url="/osbuild/bootc-image-builder/issues/528/hovercard" href="https://github.com/osbuild/bootc-image-builder/issues/528">#528</a>] for additional detail.</p>
<p dir="auto">Since multi-line strings are difficult to write and read in json, it&#39;s easier to use the toml format when adding kickstart contents:</p>
<div dir="auto" data-snippet-clipboard-copy-content="[customizations.installer.kickstart]
contents = &#34;&#34;&#34;
text --non-interactive
zerombr
clearpart --all --initlabel --disklabel=gpt
autopart --noswap --type=lvm
network --bootproto=dhcp --device=link --activate --onboot=on
&#34;&#34;&#34;"><pre>[<span>customizations</span>.<span>installer</span>.<span>kickstart</span>]
<span>contents</span> = <span><span>&#34;&#34;&#34;</span></span>
<span>text --non-interactive</span>
<span>zerombr</span>
<span>clearpart --all --initlabel --disklabel=gpt</span>
<span>autopart --noswap --type=lvm</span>
<span>network --bootproto=dhcp --device=link --activate --onboot=on</span>
<span><span>&#34;&#34;&#34;</span></span></pre></div>
<p dir="auto">The equivalent in json would be:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;customizations&#34;: {
    &#34;installer&#34;: {
      &#34;kickstart&#34;: {
        &#34;contents&#34;: &#34;text --non-interactive\nzerombr\nclearpart --all --initlabel --disklabel=gpt\nautopart --noswap --type=lvm\nnetwork --bootproto=dhcp --device=link --activate --onboot=on&#34;
      }
    }
  }
}"><pre>{
  <span>&#34;customizations&#34;</span>: {
    <span>&#34;installer&#34;</span>: {
      <span>&#34;kickstart&#34;</span>: {
        <span>&#34;contents&#34;</span>: <span><span>&#34;</span>text --non-interactive<span>\n</span>zerombr<span>\n</span>clearpart --all --initlabel --disklabel=gpt<span>\n</span>autopart --noswap --type=lvm<span>\n</span>network --bootproto=dhcp --device=link --activate --onboot=on<span>&#34;</span></span>
      }
    }
  }
}</pre></div>
<p dir="auto">Note that bootc-image-builder will automatically add the command that installs the container image (<code>ostreecontainer ...</code>), so this line or any line that conflicts with it should not be included. See the relevant <a href="https://pykickstart.readthedocs.io/en/latest/kickstart-docs.html#ostreecontainer" rel="nofollow">Kickstart documentation</a> for more information.
No other kickstart commands are added by bootc-image-builder in this case, so it is the responsibility of the user to provide all other commands (for example, for partitioning, network, language, etc).</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">Anaconda ISO (installer) Modules</h4><a id="user-content-anaconda-iso-installer-modules" aria-label="Permalink: Anaconda ISO (installer) Modules" href="#anaconda-iso-installer-modules"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The Anaconda installer can be configured by enabling or disabling its dbus modules.</p>
<div dir="auto" data-snippet-clipboard-copy-content="[customizations.installer.modules]
enable = [
  &#34;org.fedoraproject.Anaconda.Modules.Localization&#34;
]
disable = [
  &#34;org.fedoraproject.Anaconda.Modules.Users&#34;
]"><pre>[<span>customizations</span>.<span>installer</span>.<span>modules</span>]
<span>enable</span> = [
  <span><span>&#34;</span>org.fedoraproject.Anaconda.Modules.Localization<span>&#34;</span></span>
]
<span>disable</span> = [
  <span><span>&#34;</span>org.fedoraproject.Anaconda.Modules.Users<span>&#34;</span></span>
]</pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;customizations&#34;: {
    &#34;installer&#34;: {
      &#34;modules&#34;: {
        &#34;enable&#34;: [
          &#34;org.fedoraproject.Anaconda.Modules.Localization&#34;
        ],
        &#34;disable&#34;: [
          &#34;org.fedoraproject.Anaconda.Modules.Users&#34;
        ]
      }
    }
  }
}"><pre>{
  <span>&#34;customizations&#34;</span>: {
    <span>&#34;installer&#34;</span>: {
      <span>&#34;modules&#34;</span>: {
        <span>&#34;enable&#34;</span>: [
          <span><span>&#34;</span>org.fedoraproject.Anaconda.Modules.Localization<span>&#34;</span></span>
        ],
        <span>&#34;disable&#34;</span>: [
          <span><span>&#34;</span>org.fedoraproject.Anaconda.Modules.Users<span>&#34;</span></span>
        ]
      }
    }
  }
}</pre></div>
<p dir="auto">The following module names are known and supported:</p>
<ul dir="auto">
<li><code>org.fedoraproject.Anaconda.Modules.Localization</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Network</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Payloads</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Runtime</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Security</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Services</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Storage</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Subscription</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Timezone</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Users</code></li>
</ul>
<p dir="auto"><em>Note: The values are not validated. Any name listed under <code>enable</code> will be added to the Anaconda configuration. This way, new or unknown modules can be enabled. However, it also means that mistyped or incorrect values may cause Anaconda to fail to start.</em></p>
<p dir="auto">By default, the following modules are enabled for all Anaconda ISOs:</p>
<ul dir="auto">
<li><code>org.fedoraproject.Anaconda.Modules.Network</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Payloads</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Security</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Services</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Storage</code></li>
<li><code>org.fedoraproject.Anaconda.Modules.Users</code></li>
</ul>
<div dir="auto"><h5 tabindex="-1" dir="auto">Enable vs Disable priority</h5><a id="user-content-enable-vs-disable-priority" aria-label="Permalink: Enable vs Disable priority" href="#enable-vs-disable-priority"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>disable</code> list is processed after the <code>enable</code> list and therefore takes priority. In other words, adding the same module in both <code>enable</code> and <code>disable</code> will result in the module being <strong>disabled</strong>.
Furthermore, adding a module that is enabled by default to <code>disable</code> will result in the module being <strong>disabled</strong>.</p>

<p dir="auto">To build the container locally you can run</p>
<div dir="auto" data-snippet-clipboard-copy-content="sudo podman build --tag bootc-image-builder ."><pre>sudo podman build --tag bootc-image-builder <span>.</span></pre></div>
<p dir="auto">NOTE: running already the <code>podman build</code> as root avoids problems later as we need to run the building
of the image as root anyway</p>

<p dir="auto">With a virtual machine launched with the above <a href="#virt-install">virt-install</a> example, access the system with</p>
<div dir="auto" data-snippet-clipboard-copy-content="ssh -i /path/to/private/ssh-key alice@ip-address"><pre>ssh -i /path/to/private/ssh-key alice@ip-address</pre></div>
<p dir="auto">Note that if you do not provide a password for the provided user, <code>sudo</code> will not work unless passwordless sudo
is configured. The base image <code>quay.io/centos-bootc/centos-bootc:stream9</code> does not configure passwordless sudo.
This can be configured in a derived bootc container by including the following in a Containerfile.</p>
<div dir="auto" data-snippet-clipboard-copy-content="FROM quay.io/centos-bootc/centos-bootc:stream9
ADD wheel-passwordless-sudo /etc/sudoers.d/wheel-passwordless-sudo"><pre><span>FROM</span> quay.io/centos-bootc/centos-bootc:stream9
<span>ADD</span> wheel-passwordless-sudo /etc/sudoers.d/wheel-passwordless-sudo</pre></div>
<p dir="auto">The contents of the file <code>wheel-passwordless-sudo</code> should be</p>
<div data-snippet-clipboard-copy-content="%wheel ALL=(ALL) NOPASSWD: ALL"><pre lang="text"><code>%wheel ALL=(ALL) NOPASSWD: ALL
</code></pre></div>

<p dir="auto">Please report bugs to the <a href="https://github.com/osbuild/bootc-image-builder/issues">Bug Tracker</a> and include instructions to reproduce and the output of:</p>
<div data-snippet-clipboard-copy-content="$ sudo podman run --rm -it quay.io/centos-bootc/bootc-image-builder:latest version"><pre><code>$ sudo podman run --rm -it quay.io/centos-bootc/bootc-image-builder:latest version
</code></pre></div>

<p dir="auto">Please refer to the <a href="https://www.osbuild.org/docs/developer-guide/index" rel="nofollow">developer guide</a> to learn about our
workflow, code style and more.</p>

<ul dir="auto">
<li><strong>web</strong>:   <a href="https://github.com/osbuild/bootc-image-builder">https://github.com/osbuild/bootc-image-builder</a></li>
<li><strong>https</strong>: <code>https://github.com/osbuild/bootc-image-builder.git</code></li>
<li><strong>ssh</strong>:   <code>git@github.com:osbuild/bootc-image-builder.git</code></li>
</ul>

<ul dir="auto">
<li><strong>Website</strong>: <a href="https://www.osbuild.org" rel="nofollow">https://www.osbuild.org</a></li>
<li><strong>Bug Tracker</strong>: <a href="https://github.com/osbuild/bootc-image-builder/issues">https://github.com/osbuild/bootc-image-builder/issues</a></li>
<li><strong>Discussions</strong>: <a href="https://github.com/orgs/osbuild/discussions">https://github.com/orgs/osbuild/discussions</a></li>
<li><strong>Matrix</strong>: <a href="https://matrix.to/#/#image-builder:fedoraproject.org" rel="nofollow">#image-builder on fedoraproject.org</a></li>
</ul>

<ul dir="auto">
<li><strong>Apache-2.0</strong></li>
<li>See LICENSE file for details.</li>
</ul>
</article></div></div>
  </body>
</html>
