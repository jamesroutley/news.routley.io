<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://wiki.mikrotik.com/wiki/CALEA">Original</a>
    <h1>RouterOS – Communications Assistance for Law Enforcement Act (2012)</h1>
    
    <div id="readability-page-1" class="page"><div id="mw-content-text" lang="en" dir="ltr"><div><p><b>Communications Assistance for Law Enforcement Act</b> requires the routers in USA to have ability to intercept and log network traffic. RouterOS now provides this facility by means of firewall rules. RouterOS can also function as a data retention server if the additional <b>calea</b> package is installed.
</p>


<h2><span id="CALEA_features_included_in_RouterOS">CALEA features included in RouterOS</span></h2>
<p>Multiple subject/multiple destination packet interception and streaming in 
following formats:
</p>
<ul><li>Call Content Connection (CCC) Interface according to PKT-SP-ES-DCI-I01-060914 (PacketCable 2.0 PacketCable Electronic Surveillance Delivery Function to Collection Function Interface Specification)</li>
<li>Call Content Connection (CCC) Interface according to ANSI/SCTE 24-13 2006 (IPCalblecom Electronic Surveillance Standard) that is approved method for Communication Content delivery to LEA according to ATIS-1000013.2007 (Lawfully Authorized Electronic Surveillance For Internet Access and Services)</li>
<li>TZSP format - for reception with &#39;Ethereal/Wireshark&#39;, tcpdump</li></ul>
<h2><span id="CALEA-server_package">CALEA-server package</span></h2>
<ul><li>accepts multiple CCC streams (identified by destination port/source address/case id)</li>
<li>stores communication content according to &#34;IP Network Access Intercept Requirements and Method&#34;(FBI-WISPA draft) specified &#34;full content&#34; intercept requirements (without out-of-band events)</li>
<li>stores communication content of multiple subjects/cases</li>
<li>stores communication content in libpcap format</li>
<li>new libpcap file based on different conditions (interval/size/packet count)</li>
<li>generates hash for each pcap file (md5/sha1/sha256)</li></ul>
<h2><span id="Calea_user">Calea user</span></h2>
<p>Calea provided options are available only for specific RouterOS user, as Calea server configuration as &#34;tap&#34; configuration. Specific user should have &#39;sniff&#39; policy enabled at RouterOS user configuration,
</p>
<pre>/ user group set 0 policy=sniff
</pre>
<p>sniff policy is enabled by default for &#34;full&#34; and &#34;write&#34; user groups.
</p>
<h2><span id="Intercepting_Packet_Flow">Intercepting Packet Flow</span></h2>
<p>The IP Firewall and Interface Bridge now have one additional section, 
</p>
<ul><li>firewall section to intercept packets that are going trough firewall</li></ul>
<pre>/ ip firewall calea
</pre>
<ul><li>bridge section to intercept packets that are going trough bridge</li></ul>
<pre>/ interface bridge calea
</pre>
<p>Firewall and Bridge Calea menus contain same actions and matchers as &#34;ip firewall filter&#34; and &#34;interface bridge filter&#34;, new avalailble actions:
</p>
<ul><li><b>sniff</b> - generates a tzsp stream that can be directed to any Wireshark (Ethereal) server</li>
<li><b>sniff-pc</b> - generates a Packet Cable stream that can be directed to a MikroTik RouterOS system with the calea package installed</li></ul>
<p>By selecting either action, the following options will be available:
</p>
<ul><li><b>sniff-id</b> (Packet Cable protocol only) - packet stream case ID, that can be used to differentiate between separate traffic sets (e.g., between different users; or between client traffic and server traffic)</li>
<li><b>sniff-target</b> - IP address of the data retention server</li>
<li><b>sniff-target-port</b> - UDP port that the data retention server is listening on</li></ul>
<h2><span id="Data_Retention_Server">Data Retention Server</span></h2>
<p>The <b>calea</b> package provides an additional tool menu - <b>/tool calea</b>, that allows to save certain incoming data streams to a file. The server will create separate files for each packet stream (one data file and one hash file, if configured). The files will not grow indefinitely, but rather util a certain limit, after which a new set of files will be created for that stream. The limit is specified in size and extent of time, whichever is reached first.
</p><p>Add a rule with the following properties:
</p>
<ul><li><b>case-id</b> - case ID set by the intercepting router</li>
<li><b>case-name</b> - case name is set on server to specify the folder, where intercepted data is stored</li>
<li><b>intercept-ip</b> - IP address of the intercepting router (IP address to receive the stream <b>from</b>)</li>
<li><b>intercept-port</b> - UDP port to listen on (port to receive the stream <b>on</b>)</li>
<li><b>action</b> - storage format (only <b>pcap</b> for now)</li>
<li><b>pcap-file-stop-interval</b> - maximal interval between creating new fileset, if size limit is not reached earlier</li>
<li><b>pcap-file-stop-size</b> - maximal filesize, in KiB</li>
<li><b>pcap-file-stop-count</b> - maximal packet count</li>
<li><b>pcap-file-hash-method</b> - hashing algorithm (<b>md5</b>, <b>sha1</b> or <b>sha256</b>) for the data file (saved once the data file is completed and closed); no file is created if set to <b>none</b></li></ul>
<h2><span id="Calea_Server.2FClient_Configuration_Example"></span><span id="Calea_Server/Client_Configuration_Example">Calea Server/Client Configuration Example</span></h2>
<p>Let&#39;s assume the particular network configuration, we need to intercept data from 192.168.0.10 Wireless Client and send it to the Calea Server located on Local Network:
</p><p><a href="https://wiki.mikrotik.com/wiki/File:Calea123.png"><img alt="Calea123.png" src="https://wiki.mikrotik.com/images/1/1a/Calea123.png" decoding="async" width="430" height="463"/></a>
</p>
<h3><span id="Client_Configuration_for_the_Intercept">Client Configuration for the Intercept</span></h3>
<p>Wireless Client is connected to Access Point, data interception has to be performed on Access Point for the particular network design.
</p>
<ul><li>We have requirement to capture all data from the user Wireless Client with IP address of 192.168.0.10 We have to add two rules to make the interception,</li></ul>
<pre>/ ip firewall calea add action=sniff-pc chain=forward sniff-id=100 sniff-target=10.9.1.250 sniff-target-port=5555 \</pre>
<p>All traffic going trough the router for specified src/dst addresses is intercepted and sent to Calea Server (sniff-target) with sniff-id=100
</p>
<ul><li>Calea package is not required for intercepting host.</li></ul>
<h3><span id="Calea_Server_Configuration">Calea Server Configuration</span></h3>
<ul><li>Calea package is required for server.</li>
<li>One rule is required to accept the data from the Access Point to receive all intercepted traffic from the Access Point,</li></ul>
<pre>/ tool calea add action=pcap intercept-port=5555 case-id=100 intercept-ip=192.168.0.254
</pre>
<p><b>Intercept-port</b> and <b>case-id</b> should be equal on server and client side, intercept-ip is IP address of the intercepting router (Access Point).
</p>
<ul><li>Calea server received information is available under &#39;file&#39; menu.</li></ul>
<!-- 
NewPP limit report
Cached time: 20220520103833
Cache expiry: 86400
Reduced expiry: false
Complications: []
CPU time usage: 0.034 seconds
Real time usage: 0.036 seconds
Preprocessor visited node count: 25/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->

<!-- Saved in parser cache with key wiki:pcache:idhash:2091-0!canonical and timestamp 20220520103833 and revision id 23692. Serialized with JSON.
 -->
</div>
</div></div>
  </body>
</html>
