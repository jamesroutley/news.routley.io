<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://yuanchuan.dev/time-based-css-animations">Original</a>
    <h1>Time-Based CSS Animations</h1>
    
    <div id="readability-page-1" class="page"><div>
  
  <div>
    <article>
  <p>
    In my earlier post <a href="https://yuanchuan.dev/time-uniform-for-css-animation">Time Uniform For CSS Animation</a>,
    I took a note about a way to do CSS animations with <em>time ticks</em> instead of <em>keyframes</em>.
    It was limited applicable because CSS lacked the ability of doing complex Math calculations.
  </p>
  <p>
    After years of wait, CSS now has enough Math functions supported,
    particularly <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/mod">mod()</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/round">round()</a>,
    and <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Functions#trigonometric_functions">trigonometric functions</a>.
    It&#39;s time to revisit the time-based way of animation, hope it&#39;ll be more useful this time.
  </p>

  <!--more-->

  <p>
    You may need to enable the <em>Experimental feature flags</em> to view demos in this page.
  </p>

  <h2>The basic idea</h2>

  <p>
    Using <em>time</em> for animation is very common in shader programs and various other places.
    CSS can not start a timer like JavaScript does,
    but nowadays it&#39;s possible to define a custom variable
    with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/CSS_Properties_and_Values_API/guide">CSS Houdini API</a> to track <em>time</em> in milliseconds.
  </p>

<figure><pre><code data-lang="css"><span>@property</span> <span>--t</span> <span>{</span>
  <span>syntax</span><span>:</span> <span>&#34;&lt;integer&gt;&#34;</span><span>;</span>
  <span>initial-value</span><span>:</span> <span>0</span><span>;</span>
  <span>inherits</span><span>:</span> <span>true</span>
<span>}</span>
<span>@keyframes</span> <span>tick</span> <span>{</span>
  <span>from</span> <span>{</span> <span>--t</span><span>:</span> <span>0</span> <span>}</span>
  <span>to</span>   <span>{</span> <span>--t</span><span>:</span> <span>86400000</span> <span>}</span>
<span>}</span>
<span>:root</span> <span>{</span>
  <span>animation</span><span>:</span> <span>tick</span> <span>86400000ms</span> <span>linear</span> <span>infinite</span>
<span>}</span></code></pre></figure>
  <p>
    For each millisecond, the variable <code>--t</code> increments by <code>1</code>, which is <code>1000</code> in one second.
    There&#39;s a trick to show the variable with <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/counter">counter()</a> function.
  </p>

<figure><pre><code data-lang="css"><span>::after</span> <span>{</span>
  <span>counter-reset</span><span>:</span> <span>t</span> <span>var</span><span>(</span><span>--t</span><span>);</span>
  <span>content</span><span>:</span> <span>counter</span><span>(</span><span>t</span><span>);</span>
<span>}</span></code></pre></figure>

  

  <p>
    Other values which are based on <code>--t</code> will change along with it.
    That&#39;s how we get the <strong>animation</strong> effect.
  </p>

<figure><pre><code data-lang="css"><span>div</span> <span>{</span>
  <span>/* 1 turn per second */</span>
  <span>rotate</span><span>:</span> <span>calc</span><span>(</span><span>var</span><span>(</span><span>--t</span><span>)</span> <span>*</span> <span>.001turn</span><span>);</span>
<span>}</span></code></pre></figure>
  

  <h2>Controlling frame rate</h2>

  <p>
    Maintaining the update frequencey at 60 frames per second (FPS) is sufficient for a smooth animation.
    Browsers often have optimizations for rendering so there wouldn&#39;t be any problem if the frequencey is higher than 60 FPS.
    But one can manually control the frame rate using <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/animation-timing-function#stepsn_jumpterm">step()</a>
    function if needed.
  </p>
<figure><pre><code data-lang="css"><span>/* ... */</span>

<span>:root</span> <span>{</span>
  <span>animation</span><span>:</span> <span>tick</span><span>;</span>
  <span>animation-duration</span><span>:</span> <span>86400000ms</span><span>;</span>
  <span>animation-iteration-count</span><span>:</span> <span>infinite</span><span>;</span>

  <span>/* 8 fps */</span>
  <span>animation-timing-function</span><span>:</span> <span>step</span><span>(</span><span>calc</span><span>(</span><span>86400000</span><span>/(</span><span>1000</span><span>/</span><span>8</span><span>)));</span>

  <span>/* 24 fps */</span>
  <span>animation-timing-function</span><span>:</span> <span>step</span><span>(</span><span>calc</span><span>(</span><span>86400000</span><span>/(</span><span>1000</span><span>/</span><span>24</span><span>)));</span>

  <span>/* 60 fps */</span>
  <span>animation-timing-function</span><span>:</span> <span>step</span><span>(</span><span>calc</span><span>(</span><span>86400000</span><span>/(</span><span>1000</span><span>/</span><span>60</span><span>)));</span>
<span>}</span></code></pre></figure>

  

  <h2>Transform time</h2>

  <p>
    The value of <code>--t</code> grows constantly in one direction.
    It&#39;s all right for the <code>angle</code> value that is bigger than <code>360deg</code>,
    however, not all CSS properties treat their values as cyclical.
  </p>
  <p>
    Let&#39;s say I want to animate a box from left to right,
    if the translate offset is associated to the <code>--t</code>
    it will increase constantly without stop.
  </p>

<figure><pre><code data-lang="css"><span>translate</span><span>:</span> <span>calc</span><span>(</span><span>var</span><span>(</span><span>--t</span><span>)</span> <span>*</span> <span>.</span><span>001</span><span>px</span><span>);</span></code></pre></figure>

  <h3>min()</h3>
  <p>
    One expected result is that when the offset reaches at a specific value, it stops immediately.
    This is how <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/min">min()</a> function can be useful.
  </p>
<figure><pre><code data-lang="css"><span>translate</span><span>:</span> <span>min</span><span>(</span><span>270</span><span>px</span><span>,</span> <span>calc</span><span>(</span><span>var</span><span>(</span><span>--t</span><span>)</span> <span>*</span> <span>.</span><span>5</span><span>px</span><span>));</span></code></pre></figure>

  

  <p>
    To precisely control the animation duration we can restrict the value of <code>--t</code> instead.
  </p>
<figure><pre><code data-lang="css"><span>/* 270px in 3s */</span>
<span>translate</span><span>:</span> <span>calc</span><span>(</span><span>min</span><span>(</span><span>3000</span><span>,</span> <span>var</span><span>(</span><span>--t</span><span>))</span> <span>*</span> <span>(</span><span>270</span><span>px</span> <span>/</span> <span>3000</span><span>));</span></code></pre></figure>

  

  <h3>mod()</h3>

  <p>
    After the box has moved to the right, another option is to restart the offset from beginning.
    Now we have <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/mod">mod()</a> function to achieve this.
  </p>

<figure><pre><code data-lang="css"><span>translate</span><span>:</span> <span>calc</span><span>(</span><span>mod</span><span>(</span><span>var</span><span>(</span><span>--t</span><span>)/</span><span>4</span><span>,</span> <span>270</span><span>)</span> <span>*</span> <span>1</span><span>px</span><span>);</span></code></pre></figure>

  

  <h3>sin()</h3>

  <p>
    Or to make the movement back and forth.
  </p>

<figure><pre><code data-lang="css"><span>translate</span><span>:</span> <span>calc</span><span>(</span><span>sin</span><span>(</span><span>mod</span><span>(</span><span>var</span><span>(</span><span>--t</span><span>)/</span><span>135</span><span>,</span> <span>270</span><span>))</span> <span>*</span> <span>135</span><span>px</span><span>);</span></code></pre></figure>

  

  <h2>
    Custom easing function
  </h2>

  <p>
    We can create custom easing functions using Math functions and the <code>--t</code> variable,
    which might not be achievable with <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/easing-function#cubic_b%C3%A9zier_easing_function">cubic-bezier()</a>.
  </p>

  <h3>ease-out-cubic</h3>

  <p>
    The initial step is to bound the value <code>--t</code> between <em>0</em> and <em>1</em>.
  </p>

<figure><pre><code data-lang="css"><span>/* from 0 to 1 in 1s */</span>
<span>--t01</span><span>:</span> <span>calc</span><span>(</span><span>min</span><span>(</span><span>1000</span><span>,</span> <span>var</span><span>(</span><span>--t</span><span>))</span> <span>/</span> <span>1000</span><span>);</span>

<span>/* 1 - pow(1 - t, 3) */</span>
<span>--ease-out-cubic</span><span>:</span> <span>calc</span><span>(</span>
  <span>1</span> <span>-</span> <span>pow</span><span>(</span><span>1</span> <span>-</span> <span>var</span><span>(</span><span>--t01</span><span>),</span> <span>3</span><span>)</span>
<span>);</span>

<span>translate</span><span>:</span> <span>calc</span><span>(</span><span>var</span><span>(</span><span>--ease-out-cubic</span><span>)</span> <span>*</span> <span>270</span><span>px</span><span>);</span></code></pre></figure>

  

  <h3>ease-out-elastic</h3>

<figure><pre><code data-lang="css"><span>/* from 0 to 1 in 1s */</span>
<span>--t01</span><span>:</span> <span>calc</span><span>(</span><span>min</span><span>(</span><span>1000</span><span>,</span> <span>var</span><span>(</span><span>--t</span><span>))</span> <span>/</span> <span>1000</span><span>);</span>

<span>/* pow(2, -10t) * sin((10t - .75) * 2/3 * PI) + 1 */</span>
<span>--ease-out-elastic</span><span>:</span> <span>calc</span><span>(</span>
  <span>pow</span><span>(</span><span>2</span><span>,</span> <span>-10</span> <span>*</span> <span>var</span><span>(</span><span>--t01</span><span>))</span> <span>*</span>
  <span>sin</span><span>((</span><span>var</span><span>(</span><span>--t01</span><span>)</span> <span>*</span> <span>10</span> <span>-</span> <span>.</span><span>75</span><span>)</span> <span>*</span> <span>2</span><span>/</span><span>3</span> <span>*</span> <span>PI</span><span>)</span> <span>+</span> <span>1</span>
<span>);</span>

<span>translate</span><span>:</span> <span>calc</span><span>(</span><span>var</span><span>(</span><span>--ease-out-elastic</span><span>)</span> <span>*</span> <span>270</span><span>px</span><span>);</span></code></pre></figure>

  

  <h2>Experiment with CSS Doodle</h2>

  <p>
    As the expressions get complex, <code>var()</code> and <code>calc()</code> tend to make
    the code less readable. So I&#39;ve added the <code>@t</code> function for representing variable <code>--t</code>.
    The latest version of <a href="https://css-doodle.com">css-doodle</a> also accepts simple Math expressions directly inside arguments.
  </p>

<figure><pre><code data-lang="css"><span>/* rotate: calc(mod(var(--t) / 1000, 10) * 5deg); */</span>
<span>rotate</span><span>:</span> <span>@t</span><span>(/</span><span>1000</span><span>,</span> <span>%</span><span>10</span><span>,</span> <span>*</span><span>5deg</span><span>);</span></code></pre></figure>

  <p>
    Code is short without writing <em>keyframes</em>.
  </p>

<figure><pre><code data-lang="css"><span>@grid</span><span>:</span> <span>20</span><span>x1</span> <span>/</span> <span>280</span><span>x</span> <span>60px</span><span>;</span>
<span>@gap</span><span>:</span> <span>1px</span><span>;</span>
<span>@size</span><span>:</span> <span>100%</span> <span>20%</span><span>;</span>
<span>background</span><span>:</span> <span>#000</span><span>;</span>
<span>margin</span><span>:</span> <span>auto</span><span>;</span>
<span>translate</span><span>:</span> <span>0</span> <span>calc</span><span>(</span><span>20</span><span>px</span> <span>*</span> <span>sin</span><span>(</span><span>4</span><span>*</span><span>@t</span><span>(/</span><span>20</span><span>,</span> <span>+@</span><span>i</span><span>(</span><span>*</span><span>6</span><span>),</span> <span>%</span><span>360deg</span><span>)));</span></code></pre></figure>

  <div>
    <css-doodle>
      <template>
        @grid: 20x1 / 280px 60px;
        @gap: 1px;
        @size: 100% 20%;
        background: #000;
        margin: auto;
        translate: 0 calc(20px * sin(4*@t(/20, +@i(*6), %360deg)));
      </template>
    </css-doodle>
    </div>

  <p>
    And it&#39;s quick to experiment new parameters too.
  </p>

<figure><pre><code data-lang="css"><span>translate</span><span>:</span> <span>0</span> <span>calc</span><span>(</span><span>20</span><span>px</span> <span>*</span> <span>sin</span><span>(</span><span>3</span><span>*</span><span>@t</span><span>(/</span><span>50</span><span>,</span> <span>*@</span><span>i</span><span>(</span><span>*</span><span>2</span><span>),</span> <span>%</span><span>360deg</span><span>)));</span></code></pre></figure>

  <div>
    <css-doodle>
      <template>
        @grid: 20x1 / 280px 60px;
        @gap: 1px;
        @size: 100% 20%;
        background: #000;
        margin: auto;
        translate: 0 calc(20px * sin(3*@t(/50, *@i(*2), %360deg)));
      </template>
    </css-doodle>
    </div>

  <h3>Function @T and @TS</h3>
  <p>
    In addition to the <code>@t</code> function,
    the uppercase function <code>@T</code> represents another <em>time ticks</em> from beginning of the day.
    Function <code>@TS</code> is a shorthand for <code>@t(/1000)</code>, which tracks <code>time</code> in second.
  </p>

  <p>
    Here is a clock implemented in css-doodle. (<a href="https://codepen.io/yuanchuan/pen/RwOXrwM">CodePen link</a>)
  </p>

<figure><pre><code data-lang="css"><span>/* ... */</span>

<span>/* second */</span>
<span>rotate</span><span>:</span> <span>@TS</span><span>(</span><span>*</span><span>6</span><span>,</span> <span>%</span><span>360deg</span><span>);</span>

<span>/* minute */</span>
<span>rotate</span><span>:</span> <span>@TS</span><span>(/</span><span>60</span><span>,</span> <span>*</span><span>6</span><span>,</span> <span>%</span><span>360deg</span><span>);</span>

<span>/* hour */</span>
<span>rotate</span><span>:</span> <span>@TS</span><span>(/</span><span>60</span><span>,</span> <span>/</span><span>12</span><span>,</span> <span>*</span><span>6</span><span>,</span> <span>%</span><span>360deg</span><span>);</span></code></pre></figure>

  <p>
    <css-doodle><template>
			@grid: 4x1 / 240px +.9;
			:container {
				border-radius: 50%;
				border: 4px solid #000;
				outline: 10px solid;
				outline-offset: 2px;
				background:
					@doodle(
						@grid: 12x1;
						@content: @I(- @i(-1));
						@place: @plot(r: .8; dir: -90; rotate: -90;);
						font-size: 30px;
						font-family: sans-serif;
						font-weight: bold;
					),
					@doodle(
						@grid: 60x1;
						background: #000;
						@size: @pn(16px, @m4(8px)) @pn(2px, @m4(1px));
						@place: @plot(r: 1;);
					);
			}
			@place: center;
			clip-path: polygon(50% -50%, 100% 65%, 0 65%);
			background: #000;
			@nth(3) {
				@size: 4px 90%;
				background: red;
				rotate: @TS(*6, %360deg);
			}
			@nth(2) {
				@size: 6px  70%;
				rotate: @TS(/60, *6, %360deg);
			}
			@nth(1) {
				@size: 10px 45%;
				rotate: @TS(/60, /12, *6, %360deg);
			}
			@nth(4) {
				@size: 12px;
				border-radius: 50%;
				clip-path: none;
				background: red;
			}
    </template></css-doodle>
  </p>

  <h3>round()</h3>
  <p>
    How can we make a jumping motion for the second hand?
    Of course, the direct approach is to use <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/round">round()</a> function,
    where the third parameter specifies the rounding interval.
		In the context of a clock, each step equals <code>360 / 60 = 6deg</code>.
  </p>
<figure><pre><code data-lang="css"><span>rotate</span><span>:</span> <span>round</span><span>(</span><span>down</span><span>,</span> <span>@TS</span><span>(</span><span>*</span><span>6</span><span>,</span> <span>%</span><span>360deg</span><span>),</span> <span>6deg</span><span>);</span></code></pre></figure>

  <p>
 	  <css-doodle><template>
			@grid: 4x1 / 240px +.9;
			:container {
				border-radius: 50%;
				border: 4px solid #000;
				outline: 10px solid;
				outline-offset: 2px;
				background:
					@doodle(
						@grid: 12x1;
						@content: @I(- @i(-1));
						@place: @plot(r: .8; dir: -90; rotate: -90;);
						font-size: 30px;
						font-family: sans-serif;
						font-weight: bold;
					),
					@doodle(
						@grid: 60x1;
						background: #000;
						@size: @pn(16px, @m4(8px)) @pn(2px, @m4(1px));
						@place: @plot(r: 1;);
					);
			}
			@place: center;
			clip-path: polygon(50% -50%, 100% 65%, 0 65%);
			background: #000;
			@nth(3) {
				@size: 4px 90%;
				background: red;
				rotate: round(down, @TS(*6, %360deg), 6deg);
			}
			@nth(2) {
				@size: 6px  70%;
				rotate: @TS(/60, *6, %360deg);
			}
			@nth(1) {
				@size: 10px 45%;
				rotate: @TS(/60, /12, *6, %360deg);
			}
			@nth(4) {
				@size: 12px;
				border-radius: 50%;
				clip-path: none;
				background: red;
			}
		</template></css-doodle>
  </p>

  <h3>One more example</h3>
  <p>
    Animate colors and positions together.
    (<a href="https://codepen.io/yuanchuan/full/LYvwGjQ">CodePen link</a>).
  </p>

<figure><pre><code data-lang="css"><span>@grid</span><span>:</span> <span>100</span><span>x1</span> <span>/</span> <span>100%</span> <span>auto</span> <span>(</span><span>4</span><span>/</span><span>3</span><span>)</span> <span>/</span> <span>#10153e</span><span>;</span>
<span>@size</span><span>:</span> <span>@</span><span>rn</span><span>(</span><span>1vmin</span><span>,</span> <span>5vmin</span><span>,</span> <span>10</span><span>);</span>
<span>margin</span><span>:</span> <span>auto</span><span>;</span>
<span>border-radius</span><span>:</span> <span>50</span><span>%;</span>

<span>background</span><span>:</span> <span>@p</span><span>(</span>
  <span>hsl</span><span>(</span><span>@</span><span>t</span><span>(/</span><span>10</span><span>,</span> <span>+@</span><span>i</span><span>(</span><span>*</span><span>2</span><span>),</span> <span>%</span><span>360</span><span>),</span> <span>90%</span><span>,</span> <span>80%</span><span>)</span>
<span>);</span>
<span>box-shadow</span><span>:</span> <span>@m5</span><span>(</span>
  <span>@</span><span>r</span><span>(</span><span>±</span><span>23vmin</span><span>)</span> <span>@</span><span>r</span><span>(</span><span>±</span><span>23vmin</span><span>)</span> <span>@</span><span>r</span><span>(</span><span>2vmin</span><span>)</span> <span>@</span><span>r</span><span>(</span><span>-40px</span><span>)</span> <span>@</span><span>p</span>
<span>);</span>
<span>translate</span><span>:</span> <span>@M2</span><span>(</span>
  <span>calc</span><span>(</span><span>100px</span> <span>*</span> <span>tan</span><span>(</span><span>6</span><span>*</span><span>cos</span><span>(</span><span>@</span><span>t</span><span>(/</span><span>10</span><span>,</span> <span>+@</span><span>i</span><span>(</span><span>*</span><span>10</span><span>),</span> <span>/</span><span>6</span><span>,</span> <span>%</span><span>360deg</span><span>))))</span>
<span>);</span></code></pre></figure>

  <p>
    <css-doodle>
      <template>
        @grid: 100x1 / 100% auto (4/3) / #10153e;
        @size: @rn(1vmin, 5vmin, 10);
        background: @p(hsl(@t(/10, +@i(*2), %360), 90%, 80%));
        box-shadow: @m5(@r(±23vmin) @r(±23vmin) @r(2vmin) @r(-40px) @p);
        translate: @M2(
          calc(100px * tan(6*cos(@t(/10, +@i(*10), /6, %360deg))))
        );
        margin: auto;
        border-radius: 50%;
      </template>
    </css-doodle>
 </p>

	<h2>Conclusion</h2>

	<p>
    I&#39;m excited about this approach.
    Although using <em>keyframes</em> seems much straightforward,
    for a demo scene full of math calculations and input variables,
    using <em>time</em> as a variable is more likely to get diverse results.
  </p>

</article>








  </div>
</div></div>
  </body>
</html>
