<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://push.cx/google-ad-injection">Original</a>
    <h1>Google Ad Injection</h1>
    
    <div id="readability-page-1" class="page"><article id="content" role="main" aria-label="Content">
        <section>
  

  <p>
    
    <span>
      <time datetime="2024-11-24T20:01:00-06:00" itemprop="datePublished">Published:
          
            <a href="https://push.cx/streaming-weekly">←</a>
          
          2024-11-24
          
      </time></span>
  </p>

  <p><em>This post is getting updates - I’m trying to collect ad samples and investigate with a site owner so I can give away js that site owners can use to detect and block the ads. Please help!</em></p>

<p>On November 19, Google <a href="https://support.google.com/websearch/thread/308719098/page-annotation-in-google-app-browser-for-ios?hl=en">announced</a> the Google App for iOS is injecting unlabeled ads into pages.
They look like the author created them, as seen in Google’s own screenshot:</p>

<p><img src="https://push.cx/uploads/2024/11/google-screenshot.png" alt="Google&#39;s own screenshot of their ad injected onto the description of a historic monument. It looks a link on the words &#34;Osaka Castle&#34;, with no warning that google placed it and no disclosure of being an ad."/></p>

<p>Google claims they are injecting ads live now, so I’d like to quickly turnaround a js snippet that sites can use to detect the tampering.
I’m strongly reminded of how a motivation for the big lift to HTTPS was slimy ISPs injecting ads into pages.</p>

<p>This system is nearly identical to Microsoft Smart Tags, a 2001 Internet Explorer feature that <a href="https://www.theregister.com/2001/06/13/have_you_been_smart_tagged/">injected links to Microsoft sites into pages</a>, but without the ability for site owners to disable them with a <code>meta</code> tag.
(Recognized by <a href="https://news.ycombinator.com/item?id=42242129">esprehn</a>.)</p>

<p>It’s also similar to <a href="https://www.theregister.com/2005/03/03/google_autolink/">Google AutoLink</a>, a 2005 Google Toolbar feature a user could click to inject links into pages.</p>

<p>Google has published no information on how it targets the ads.
It may target sites based on Googlebot crawls or may send the url or text of pages that require a login to Google.
(Thanks <a href="https://ruby.social/@tasket@infosec.exchange/113547455327604023">@tasket@infosec.exchange</a>.)</p>

<p>Initial reporting by <a href="https://www.seroundtable.com/google-ios-app-page-annotation-38451.html">SERoundtable</a> and <a href="https://9to5google.com/2024/11/25/google-ios-app-link-annotations-search/">9to5google</a>.</p>

<h3 id="do-you-have-the-ios-google-app-installed-can-you-find-an-inserted-ad-that-looks-and-acts-like-the-screenshot-above">Do you have the iOS Google App installed? Can you find an inserted ad that looks and acts like the screenshot above?</h3>

<p>If you have the app and own a site, please check your site.
Maybe start with high-ad-value terms like tourist destinations, insurance, loans, attorneys/lawyers, donations, hosting, trading, consumer electronics, or rehab.
I would especially appreciate <a href="https://push.cx/contact">hearing from you</a> so we could iterate on a couple possibilities for detecting this via the DOM.</p>

<p>(I found the <a href="https://japanobjects.com/features/japanese-castles">victim in their screenshot</a> and have collected 3 negative reports from people unable to reproduce the ad, so it may have been a one-off demo for the announcement.)</p>

<h3 id="this-isnt-ads">“This isn’t ads”</h3>

<p>Oddly, a common response has been that the world’s largest advertising company adding links to keywords directed at their own sites isn’t advertising.
Sometimes with the caveat that it’s because they’re currently only house ads and not yet for sale to third parties.</p>

<p>A bit of useful history might be Google’s own press release, “<a href="https://www.google.com/about/honestresults/">Why we sell advertising, not search results</a>”.
This was written when AdWords were placed to the side of search results with a blue background to be unambiguously ads.
Despite saying that results wouldn’t be for sale, Google <a href="https://searchengineland.com/search-ad-labeling-history-google-bing-254332">slowly iterated the design</a> to make the ads nearly indistinguishable from results.</p>

<p>Today, these injected links <em>start</em> nearly indistinguishable from the author’s own links, with no “Ad” label or icon, and only a faint pastel background similar to the 2010 AdWords treatment.
Like AdWords, every experiment Google runs of engagement will show “improvement” as the ads become harder to distinguish,</p>

<p>If you found that an advertising company was adding links to your site without your knowledge or consent, would you consider it a useful service?</p>

<p>Do you think it acceptable that, to disable the injected links, you have to agree to the ad company’s continually-updated terms of service and ask to individually opt-out each of your sites?</p>

<h3 id="ongoing">Ongoing</h3>

<p><em>There may be more on <a href="https://bsky.app/profile/push.cx/post/3lbsze4iqp222">Bluesky</a> or <a href="https://ruby.social/@pushcx/113546957556429539">Mastodon</a> where I’ve tried to find help.</em></p>

<p>Here’s the first rough draft of a js snippet that a site owner who sees an ad could add to a page to see some more info.
It needs text from the link inserted.
There’s some assumptions noted for how the injection might appear in the DOM.</p>

<div><div><pre><code><span>(</span><span>function</span><span>()</span> <span>{</span>
  <span>const</span> <span>logDiv</span> <span>=</span> <span>document</span><span>.</span><span>createElement</span><span>(</span><span>&#39;</span><span>div</span><span>&#39;</span><span>);</span>
  <span>div</span><span>.</span><span>style</span><span>.</span><span>cssText</span> <span>=</span> <span>&#39;</span><span>position: fixed; top: 0; left: 0; right: 0;</span><span>&#39;</span> <span>+</span>
                      <span>&#39;</span><span>background: #fee; color: #000; font-family: monospace; </span><span>&#39;</span> <span>+</span>
                      <span>&#39;</span><span>z-index: 999; padding: 10px; max-height: 50vh; overflow: auto;</span><span>&#39;</span><span>;</span>
  <span>document</span><span>.</span><span>body</span><span>.</span><span>prepend</span><span>(</span><span>div</span><span>);</span>

  <span>function</span> <span>log</span><span>(</span><span>msg</span><span>)</span> <span>{</span>
    <span>const</span> <span>entry</span> <span>=</span> <span>document</span><span>.</span><span>createElement</span><span>(</span><span>&#39;</span><span>div</span><span>&#39;</span><span>);</span>
    <span>entry</span><span>.</span><span>textContent</span> <span>=</span> <span>msg</span><span>;</span>
    <span>logDiv</span><span>.</span><span>appendChild</span><span>(</span><span>entry</span><span>);</span>
  <span>}</span>

  <span>try</span> <span>{</span>
    <span>/* edit &#39;castle&#39; to include the text of an ad link */</span>
    <span>const</span> <span>text</span> <span>=</span> <span>&#39;</span><span>osaka castle</span><span>&#39;</span><span>;</span>

    <span>/* if it&#39;s not an &#39;a&#39;, try &#39;span&#39; and then &#39;div&#39; */</span>
    <span>for </span><span>(</span><span>const</span> <span>ad</span> <span>of</span> <span>document</span><span>.</span><span>querySelectorAll</span><span>(</span><span>&#39;</span><span>a</span><span>&#39;</span><span>);)</span> <span>{</span>
      <span>if </span><span>(</span><span>a</span><span>.</span><span>textContent</span><span>.</span><span>toLowerCase</span><span>().</span><span>includes</span><span>(</span><span>text</span><span>))</span> <span>{</span>
        <span>log</span><span>(</span><span>ad</span><span>.</span><span>outerHTML</span><span>);</span>
      <span>}</span>
    <span>}</span>
  <span>}</span> <span>catch</span><span>(</span><span>e</span><span>)</span> <span>{</span>
    <span>if </span><span>(</span><span>logDiv</span><span>)</span> <span>{</span>
      <span>log</span><span>(</span><span>`Error: </span><span>${</span><span>e</span><span>.</span><span>message</span><span>}</span><span>`</span><span>);</span>
    <span>}</span>
  <span>}</span>
<span>})();</span>
</code></pre></div></div>


</section>



    </article></div>
  </body>
</html>
