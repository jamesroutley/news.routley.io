<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://netmeister.org/blog/https-rrs.html">Original</a>
    <h1>Use of HTTPS Resource Records</h1>
    
    <div id="readability-page-1" class="page"><div>
    <tbody><tr>
      <td>
<p><small>November 13th, 2023</small></p>

<p>Good news, everybody -- we have new <a href="https://riskmusings.substack.com/p/dns-rrs.html">DNS resource records</a>!  Well,
not <em>new</em> new, but, you know, new<em>ish</em>.
You&#39;ve probably heard of them, or even seen them
actively in use, even though they moved from internet
draft to formal <a href="https://www.rfc-editor.org/rfc/rfc9460.html">RFC9460
adoption</a> literally while I was working on this
blog post during the last few weeks: the <a href="https://riskmusings.substack.com/p/dns-rrs.html#svcb"><code>SVCB</code></a> and <a href="https://riskmusings.substack.com/p/dns-rrs.html#https"><code>HTTPS</code></a> resource records.  </p>

<p>There are a few interesting things to note about
these records: they allow you to speed up your
time-to-first-packet (by basically stuffing the <a href="https://www.rfc-editor.org/rfc/rfc7838#section-3">Alt-Svc</a>
HTTP header / <a href="https://datatracker.ietf.org/doc/html/rfc7301">ALPN
TLS extension</a> into the DNS); let you do
redirection on the zone apex without <a href="https://riskmusings.substack.com/p/naked-domains.html#cnames">using CNAMEs</a>;
allow for simple DNS load distribution and failover;
obviate <a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HSTS</a>
and the cumbersome <a href="https://hstspreload.org/">preloading</a>
process; and enable stronger privacy protections via
<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-esni-17">Encrypted
Client Hello</a> aka ECH (previously ESNI).  Pretty
neat, all that.</p>

<p>The record&#39;s main drawback is
basically the name: trying to search the web for
information about &#34;https&#34; is a lot like asking in your
local library whether they have any books with
words.</p>

<p>You can find great explanations of these records
elsewhere (for example, <a href="https://www.isc.org/docs/2022-webinar-dns-scvb.pdf">here</a>,
<a href="https://www.domaintools.com/resources/blog/the-use-cases-and-benefits-of-svcb-and-https-dns-record-types/">here</a>,
or <a href="https://www.sobyte.net/post/2022-01/dns-svcb-https/">here</a>),
but let&#39;s give a quick example:</p>

<div><pre>$ dig +short https https.test.netmeister.org
1 www.netmeister.org. alpn=&#34;h2,http/1.1&#34; ipv4hint=166.84.7.99 ipv6hint=2001:470:30:84:e276:63ff:fe72:3900
$ host https.test.netmeister.org
$ </pre></div>

<p>With no <code>A</code> or <code>AAAA</code> records, but the above <code>HTTPS</code> record in place, you should
still be able to connect directly to <code>https.test.netmeister.org</code><sup><a href="#1">1</a></sup>.  On the wire, that looks like
so (click the image to see the full size):</p>

<p><a href="https://riskmusings.substack.com/p/images/https-lookup.png"><img src="https://riskmusings.substack.com/p/images/https-lookup-800.png" alt="Screenshot of Wireshark showing packet capture of
an HTTPS lookup followed by immediate TCP handshake"/></a></p>

<p>You&#39;ll find our <code>HTTPS</code>
record lookup in packet <span>#624</span>, followed by an <code>A</code> record lookup in <span>#625</span>, and the
<code>HTTPS</code> result in <span>#626</span>.  Notice that we then make a TCP
connection immediately in packet <span>#627</span> and begin
our TLS handshake in <span>#630</span>, without waiting
for the (empty) <code>A</code> record
result, which finally arrives in packet <span>#651</span>, showing
the use of the <code>ipv4hint</code> from
the <code>HTTPS</code> result.</p>

<h3 id="current-use">HTTPS records in the wild</h3>

<p>Despite just emerging from draft status, we&#39;re
already seeing some notable adoption across the
industry: Firefox has been making <code>HTTPS</code> lookups (albeit only over DoH)
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1623126">since
May 2020</a>, Apple&#39;s iOS and Safari / macOS <a href="https://mailarchive.ietf.org/arch/msg/quic/sFgifP9vOY9xsmogVqiq-qtxPiQ/">since
September 2020</a>, Chrome has had partial support <a href="https://groups.google.com/a/chromium.org/g/blink-dev/c/brZTXr6-2PU">since
December 2020</a>, and just recently
<a href="https://groups.google.com/a/chromium.org/g/blink-dev/c/CmlXjQeNWDI/m/hx-_4lNBAQAJ">enabled ECH</a> by default.  Various <a href="https://ns1.com/blog/ns1-announces-support-for-svcb-and-https-records">DNS</a>
<a href="https://community.akamai.com/customers/s/article/NetworkOperatorCommunityNewSVCBHTTPSResourceRecordsinthewild20201128135350?language=en_US">service
providers</a> also offer support for <code>HTTPS</code> and <code>SVCB</code>
records already.</p>

<p>So with all that, I was curious to see just what
the actual adoption of these records is in the wild.
I ignored the more generic <code>SVCB</code>
record (since it requires knowledge of the scheme
and possibly port) and focused only on the <code>HTTPS</code> record, for which I then
performed DNS lookups for approximately 227 million
second-level domain names (e.g., <code>example.com</code>).  I then repeated the
lookups, prefixing each name with <code>www</code>.  Finally, I repeated the same
exercise for the <a href="https://tranco-list.eu/">Tranco Top1M</a>
domains<sup><a href="#2">2</a></sup>.</p>


<p>I then analyzed the data collected for the
different features the record provides.  Let&#39;s take a
look at how these are used!</p>

<h4 id="presence">Presence of HTTPS records</h4>

<p>Not surprisingly, overall adoption of these records is
still low.  However, it is not <em>negligible</em>.
As of October 2023, I found almost 10 million domains
using an <code>HTTPS</code> record for their
<code>www</code> service names (i.e., ~4.4%),
and around 9.1 million domains (~ 4.0%) using the
record on their bare second-level domain name; for the
Top1M domains, there were around 22.5K (25.5%) for the
<code>www</code> service names, and almost
24K (25.6%) bare domains using <code>HTTPS</code> records:</p>




<h4 id="priority">SvcPriority</h4>

<p>The <code>HTTPS</code> record has the
following format:</p>

<div><pre>SvcPriority TargetName SvcParams
</pre></div>

<p>The <code>SvcPriority</code> field
indicates the <em>mode</em> of the <code>HTTPS</code> record: <code>0</code> indicates <em>AliasMode</em>
(generally intended to allow aliasing at the zone
apex), any other value indicates
<em>ServiceMode</em>.</p>

<p>As such, you might expect a <code>SvcPriority</code> of <code>0</code> to be more frequently encountered
on the bare domain names, with <em>ServiceMode</em>
being indicated for the <code>www.</code>
subdomains.  However, I found that virtually
<em>all</em> existing <code>HTTPS</code>
records are in <em>ServiceMode</em>:</p>

<table>
  <tbody><tr>
    <td><b>All bare domains</b></td>
    <td><b>All <code>www.</code></b></td>
    <td><b>Top1M bare domains</b></td>
    <td><b>Top1M <code>www.</code></b></td>
  </tr>
  <tr>
    <td colspan="4"><hr/></td>
  </tr>
  <tr>
    <td>
      <table>
        <tbody><tr>
          <td>Priority</td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td><code>1</code></td>
          <td> </td>
          <td>9,902,756</td>
        </tr>
        <tr>
          <td><code>0</code></td>
          <td> </td>
          <td>4,905</td>
        </tr>
        <tr>
          <td><code>5</code></td>
          <td> </td>
          <td>78</td>
        </tr>
        <tr>
          <td><code>2</code></td>
          <td> </td>
          <td>76</td>
        </tr>
        <tr>
          <td><em>28 others</em></td>
          <td> </td>
          <td>560</td>
        </tr>
      </tbody></table>
    </td>
    <td>
      <table>
        <tbody><tr>
          <td>Priority</td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td><code>1</code></td>
          <td> </td>
          <td>10,069,638</td>
        </tr>
        <tr>
          <td><code>0</code></td>
          <td> </td>
          <td>5,173</td>
        </tr>
        <tr>
          <td><code>2</code></td>
          <td> </td>
          <td>3,285</td>
        </tr>
        <tr>
          <td><code>10</code></td>
          <td> </td>
          <td>132</td>
        </tr>
        <tr>
          <td><em>18 others</em></td>
          <td> </td>
          <td>1,010</td>
        </tr>
      </tbody></table>
    </td>
    <td>
      <table>
        <tbody><tr>
          <td>Priority</td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td><code>1</code></td>
          <td> </td>
          <td>255,940</td>
        </tr>
        <tr>
          <td><code>0</code></td>
          <td> </td>
          <td>45</td>
        </tr>
        <tr>
          <td><code>10</code></td>
          <td> </td>
          <td>10</td>
        </tr>
        <tr>
          <td><code>9</code></td>
          <td> </td>
          <td>7</td>
        </tr>
        <tr>
          <td><em>11 others</em></td>
          <td> </td>
          <td>68</td>
        </tr>
      </tbody></table>
    </td>
    <td>
      <table>
        <tbody><tr>
          <td>Priority</td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td><code>1</code></td>
          <td> </td>
          <td>254,605</td>
        </tr>
        <tr>
          <td><code>2</code></td>
          <td> </td>
          <td>68</td>
        </tr>
        <tr>
          <td><code>0</code></td>
          <td> </td>
          <td>13</td>
        </tr>
        <tr>
          <td><code>9</code></td>
          <td> </td>
          <td>4</td>
        </tr>
        <tr>
          <td><em>8 others</em></td>
          <td> </td>
          <td>28</td>
        </tr>
      </tbody></table>
    </td>
  </tr>
  <tr>
    <td colspan="4"><hr/></td>
  </tr>
</tbody></table>

<p>There are a handful of other priorities set, as
well as a number of records that have <em>no</em>
priority set (i.e., erroneous records, likely
mistyped), but clearly <em>ServiceMode</em> is the
primary use case right now.  I expect this to change
as support for <code>HTTPS</code> records
increases and organizations begin to adopt them to
resolve the &#34;no CNAMEs at the apex&#34; problem.  On the
other hand, <em>AliasMode</em> currently does not
permit <em>SvcParams</em> to be set, so perhaps those
will ultiately cause <em>ServiceMode</em> to remain
the dominant use.</p>

<h4 id="target">TargetName</h4>

<blockquote>
In ServiceMode, the TargetName and SvcParams within
each RR associate an alternative endpoint for the
service with its connection parameters.</blockquote>

<p>The <code>TargetName</code> field also
shows that early adopters of these records do not use
them to redirect traffic: virtually all records have
the <code>TargetName</code> set to <code>.</code>, meaning the record owner&#39;s name
is used:</p>

<table>
  <tbody><tr>
    <td><b>All bare domains</b></td>
    <td><b>All <code>www.</code> subdomains</b></td>
  </tr>
  <tr>
    <td colspan="2"><hr/></td>
  </tr>
  <tr>
    <td>
      <table>
        <tbody><tr>
          <td>TargetName</td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td>.</td>
          <td> </td>
          <td>9,899,763</td>
        </tr>
        <tr>
          <td>star.fallback.c10r.facebook.com.</td>
          <td> </td>
          <td>3,159</td>
        </tr>
        <tr>
          <td>geo-routing.nexuspipe.com.</td>
          <td> </td>
          <td>1,272</td>
        </tr>
        <tr>
          <td><em>5,681 others</em></td>
          <td> </td>
          <td>6,197</td>
        </tr>
      </tbody></table>
    </td>
    <td>
      <table>
        <tbody><tr>
          <td>TargetName</td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td>.</td>
          <td> </td>
          <td>9,142,658</td>
        </tr>
        <tr>
          <td>geo-routing.nexuspipe.com.</td>
          <td> </td>
          <td>768</td>
        </tr>
        <tr>
          <td>hmkb.mydefense.info.</td>
          <td> </td>
          <td>128</td>
        </tr>
        <tr>
          <td><em>4,845 others</em></td>
          <td> </td>
          <td>7,504</td>
        </tr>
      </tbody></table>
    </td>
  </tr>
  <tr>
    <td colspan="2"> </td>
  </tr>
  <tr>
    <td><b>Top1M bare domains</b></td>
    <td><b>Top1M <code>www.</code> subdomains</b></td>
  </tr>
  <tr>
    <td>
      <table>
        <tbody><tr>
          <td>TargetName</td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td>.</td>
          <td> </td>
          <td>254,600</td>
        </tr>
        <tr>
          <td>star.fallback.c10r.facebook.com.</td>
          <td> </td>
          <td>65</td>
        </tr>
        <tr>
          <td>geo-routing.nexuspipe.com.</td>
          <td> </td>
          <td>36</td>
        </tr>
        <tr>
          <td><em>16 others</em></td>
          <td> </td>
          <td>17</td>
        </tr>
      </tbody></table>
    </td>
    <td>
      <table>
        <tbody><tr>
          <td>TargetName</td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td>.</td>
          <td> </td>
          <td>255,926</td>
        </tr>
        <tr>
          <td>geo-routing.nexuspipe.com.</td>
          <td> </td>
          <td>84</td>
        </tr>
        <tr>
          <td>www</td>
          <td> </td>
          <td>2</td>
        </tr>
        <tr>
          <td><em>54 others</em></td>
          <td> </td>
          <td>56</td>
        </tr>
      </tbody></table>
    </td>
  </tr>
  <tr>
    <td colspan="2"><hr/></td>
  </tr>
</tbody></table>

<p>The two other records besides <code>.</code> that stand out here are <code>star.fallback.c10r.facebook.com.</code> and
<code>geo-routing.nexuspipe.com.</code>.

</p><p>Facebook / Meta does not currently set <code>HTTPS</code> records on their primary
domain names but uses the <code>star.fallback</code> name as a <code>CNAME</code> redirect for mistyped domains,
which explains why this shows up a number of times for
all of their various typo-squatting and
brand-protection names:</p>

<div><pre>$ dig +nocomments +nostats https www.instagra.com

; &lt;&lt;&gt;&gt; DiG 9.18.19 &lt;&lt;&gt;&gt;+nocomments +nostats https www.instagra.com
;; global options: +cmd
;www.instagra.com.              IN      HTTPS
www.instagra.com.       7140    IN      CNAME star.c10r.facebook.com.
star.c10r.facebook.com. 7140    IN      HTTPS   1 . alpn=&#34;h2,h3&#34;
star.c10r.facebook.com. 7140    IN      HTTPS   2 star.fallback.c10r.facebook.com. alpn=&#34;h2,h3&#34;
</pre></div>

<p>The other name (<code>geo-routing.nexuspipe.com.</code>) appears
to be used by the &#34;NexusPipe&#34; CyberSecurity company&#39;s
DNS services to load-balance or otherwise distribute
traffic across different ports, one of the very few
uses of the <code>HTTPS</code> record using
different priorities and ports for this purpose:</p>

<div><pre>dig +nostat +nocomment https www.fluxteam.net
; &lt;&lt;&gt;&gt; DiG 9.18.19 &lt;&lt;&gt;&gt; +nostat +nocomment https www.fluxteam.net
;; global options: +cmd
;www.fluxteam.net.		IN	HTTPS
www.fluxteam.net.	10	IN	CNAME	geo-routing.nexuspipe.com.
geo-routing.nexuspipe.com. 3472	IN	HTTPS	10 geo-routing.nexuspipe.com. alpn=&#34;h2&#34; port=8080
geo-routing.nexuspipe.com. 3472	IN	HTTPS	6 geo-routing.nexuspipe.com. alpn=&#34;h2&#34; port=2086
geo-routing.nexuspipe.com. 3472	IN	HTTPS	2 geo-routing.nexuspipe.com. alpn=&#34;h2&#34; port=2052
geo-routing.nexuspipe.com. 3472	IN	HTTPS	1 geo-routing.nexuspipe.com. alpn=&#34;h2&#34; port=443
geo-routing.nexuspipe.com. 3472	IN	HTTPS	4 geo-routing.nexuspipe.com. alpn=&#34;h2&#34; port=2082
geo-routing.nexuspipe.com. 3472	IN	HTTPS	3 geo-routing.nexuspipe.com. alpn=&#34;h2&#34; port=2053
geo-routing.nexuspipe.com. 3472	IN	HTTPS	5 geo-routing.nexuspipe.com. alpn=&#34;h2&#34; port=2083
geo-routing.nexuspipe.com. 3472	IN	HTTPS	11 geo-routing.nexuspipe.com. alpn=&#34;h2&#34; port=8880
geo-routing.nexuspipe.com. 3472	IN	HTTPS	7 geo-routing.nexuspipe.com. alpn=&#34;h2&#34; port=2087
geo-routing.nexuspipe.com. 3472	IN	HTTPS	9 geo-routing.nexuspipe.com. alpn=&#34;h2&#34; port=2098
geo-routing.nexuspipe.com. 3472	IN	HTTPS	12 geo-routing.nexuspipe.com. alpn=&#34;h2&#34; port=8443
geo-routing.nexuspipe.com. 3472	IN	HTTPS	8 geo-routing.nexuspipe.com. alpn=&#34;h2&#34; port=2095
</pre></div>

<h4 id="svcparams">SvcParams</h4>

<p>RFC9460 defines the <code>alpn</code>, <code>no-default-alpn</code>, <code>port</code>, <code>ipv4hint</code>
and <code>ipv6hint</code>, and <code>mandatory</code> <em>SvcParamKeys</em>.  In
addition, <a href="https://datatracker.ietf.org/doc/draft-ietf-tls-svcb-ech/">this
Internet Draft</a> defines the <code>ech</code> SvcParamKey for <a href="https://datatracker.ietf.org/doc/draft-ietf-tls-esni/">Encrypted
Client Hello</a>.</p>

<h5 id="mandatory"><code>mandatory</code> and <code>no-default-alpn</code></h5>

<p>These two <em>SvcParamKeys</em> are exceedingly
rare. The only domains observed using them are:</p>

<ul>
<li><code>lonios.com.</code> (<code>mandatory=ipv4hint,ipv6hint</code>)</li>
<li><code>www.0834-3658888.com.</code> (<code>no-default-alpn=</code>)</li>
<li><code>www.014.se.</code> (<code>no-default-alpn=</code>)</li>
<li><code>014.se.</code> (<code>no-default-alpn=</code>)</li>
</ul>

<p>That&#39;s right: 4 out of ~10 million <code>HTTPS</code> records.  That&#39;s it! Well, ok
then, let&#39;s look at the others.</p>

<h5 id="alpn"><code>alpn</code></h5>

<p>The <code>alpn</code> <em>SvcParamKey</em>
is widely used: 99.9% of all <code>HTTPS</code> records observed do set this
parameter key; only around 7.6K do not have it set .
The breakdown by frequency is:</p>

<table>
  <tbody><tr>
    <td><b>All bare domains</b></td>
    <td><b>All <code>www.</code> subdomains</b></td>
    <td><b>Top1M bare domains</b></td>
    <td><b>Top1M <code>www.</code> subdomains</b></td>
  </tr>
  <tr>
    <td colspan="4"><hr/></td>
  </tr>
  <tr>
    <td>
      <table>
        <tbody><tr>
          <td><code>alpn</code></td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td><code>h3,h2</code></td>
          <td> </td>
          <td>8,888,454</td>
        </tr>
        <tr>
          <td><code>h2</code></td>
          <td> </td>
          <td>252,445</td>
        </tr>
        <tr>
          <td><code>h2,h3</code></td>
          <td> </td>
          <td>685</td>
        </tr>
        <tr>
          <td><code>h3</code></td>
          <td> </td>
          <td>537</td>
        </tr>
        <tr>
          <td><em>15 others</em></td>
          <td> </td>
          <td>65</td>
        </tr>
      </tbody></table>
    </td>
    <td>
      <table>
        <tbody><tr>
          <td><code>alpn</code></td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td><code>h3,h2</code></td>
          <td> </td>
          <td>8,987,592</td>
        </tr>
        <tr>
          <td><code>h2</code></td>
          <td> </td>
          <td>888,675</td>
        </tr>
        <tr>
          <td><code>h2,h3</code></td>
          <td> </td>
          <td>7,669</td>
        </tr>
        <tr>
          <td><code>h3</code></td>
          <td> </td>
          <td>1,689</td>
        </tr>
        <tr>
          <td><em>12 others</em></td>
          <td> </td>
          <td>60</td>
        </tr>
      </tbody></table>
    </td>
    <td>
      <table>
        <tbody><tr>
          <td><code>alpn</code></td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td><code>h3,h2</code></td>
          <td> </td>
          <td>217,709</td>
        </tr>
        <tr>
          <td><code>h2</code></td>
          <td> </td>
          <td>37,585</td>
        </tr>
        <tr>
          <td><code>h2,h3</code></td>
          <td> </td>
          <td>145</td>
        </tr>
        <tr>
          <td><code>h3</code></td>
          <td> </td>
          <td>99</td>
        </tr>
        <tr>
          <td><em>2 others</em></td>
          <td> </td>
          <td>2</td>
        </tr>
      </tbody></table>
    </td>
    <td>
      <table>
        <tbody><tr>
          <td><code>alpn</code></td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td><code>h3,h2</code></td>
          <td> </td>
          <td>209,767</td>
        </tr>
        <tr>
          <td><code>h2</code></td>
          <td> </td>
          <td>4,4066</td>
        </tr>
        <tr>
          <td><code>h2,h3</code></td>
          <td> </td>
          <td>157</td>
        </tr>
        <tr>
          <td><code>h3</code></td>
          <td> </td>
          <td>98</td>
        </tr>
        <tr>
          <td><em>5 others</em></td>
          <td> </td>
          <td>9</td>
        </tr>
      </tbody></table>
    </td>
  </tr>
  <tr>
    <td colspan="4"><hr/></td>
  </tr>
</tbody></table>

<p>This also speaks to the increasing adoption of <a href="https://datatracker.ietf.org/doc/html/rfc9114">HTTP/3</a>.</p>

<h5 id="ech"><code>ech</code></h5>

<p>The <code>ech</code> <em>SvcParamKey</em>
is virtually unused -- right now.  When I first ran my
data collection, Cloudflare had just <a href="https://blog.cloudflare.com/announcing-encrypted-client-hello/">announced</a>
that they had enabled ECH for all customers, and
indeed millions of domains showed <code>ech</code> parameters in their <code>HTTPS</code> records using around 207
unique ECH values.  However, soon after (and with
decidedly less fanfare or any specific reasons given),
Cloudflare then <a href="https://community.cloudflare.com/t/early-hints-and-encrypted-client-hello-ech-are-currently-disabled-globally/567730">disabled
ECH</a> again, promising to re-enable it in &#34;early
2024&#34;.</p>

<p>As such, as of late October 2023, only three of the
Top1M and 16 of all domains 
in total have <code>ech</code> parameters set:

</p><table>
  <tbody><tr>
    <td>
      <ul>
        <li><code>tls-ech.dev.</code></li>
        <li><code>17-mai.com.</code></li>
        <li><code>cloudflare-ech.com.</code></li>
        <li><code>cloudflare-esni.com.</code></li>
        <li><code>cloudflare-http1.com.</code></li>
        <li><code>cloudflare-http2.com.</code></li>
        <li><code>cloudflare-http3.com.</code></li>
        <li><code>cloudflare-quic.com.</code></li>
      </ul>
    </td>
    <td>
      <ul>
        <li><code>cloudflareresearch.com.</code></li>
        <li><code>dramateket.com.</code></li>
        <li><code>encryptedsni.com</code></li>
        <li><code>epochbelt.com.</code></li>
        <li><code>join21.com.</code></li>
        <li><code>parachaexperiments.com.</code></li>
        <li><code>myechtest.site.</code></li>
        <li><code>protocols.team.</code></li>
      </ul>
    </td>
  </tr>
</tbody></table>

<h5 id="port"><code>port</code></h5>

<p>The <code>port</code> <em>SvcParamKey</em>
is, not surprisingly, hardly used at all: for <code>HTTPS</code> records, port 443 is the
default.</p>

<table>
  <tbody><tr>
    <td><b>All bare domains</b></td>
    <td><b>All <code>www.</code> subdomains</b></td>
    <td><b>Top1M bare domains</b></td>
    <td><b>Top1M <code>www.</code> subdomains</b></td>
  </tr>
  <tr>
    <td colspan="4"><hr/></td>
  </tr>
  <tr>
    <td>
      <table>
        <tbody><tr>
          <td><code>port</code></td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td><code>443</code></td>
          <td> </td>
          <td>78</td>
        </tr>
        <tr>
          <td><code>8443</code></td>
          <td> </td>
          <td>63</td>
        </tr>
        <tr>
          <td><code>8880</code></td>
          <td> </td>
          <td>62</td>
        </tr>
        <tr>
          <td><em>13 others</em></td>
          <td> </td>
          <td>566</td>
        </tr>
      </tbody></table>
    </td>
    <td>
      <table>
        <tbody><tr>
          <td><code>port</code></td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td><code>443</code></td>
          <td> </td>
          <td>23</td>
        </tr>
        <tr>
          <td><code>8443</code></td>
          <td> </td>
          <td>11</td>
        </tr>
        <tr>
          <td><code>8880</code></td>
          <td> </td>
          <td>10</td>
        </tr>
        <tr>
          <td><em>16 others</em></td>
          <td> </td>
          <td>106</td>
        </tr>
      </tbody></table>
    </td>
    <td>
      <table>
        <tbody><tr>
          <td><code>port</code></td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td><code>8880</code></td>
          <td> </td>
          <td>7</td>
        </tr>
        <tr>
          <td><code>8443</code></td>
          <td> </td>
          <td>7</td>
        </tr>
        <tr>
          <td><code>8080</code></td>
          <td> </td>
          <td>7</td>
        </tr>
        <tr>
          <td><em>8 others</em></td>
          <td> </td>
          <td>63</td>
        </tr>
      </tbody></table>
    </td>
    <td>
      <table>
        <tbody><tr>
          <td><code>port</code></td>
          <td> </td>
          <td>Count</td>
        </tr>
        <tr>
          <td colspan="3"><hr/></td>
        </tr>
        <tr>
          <td><code>8880</code></td>
          <td> </td>
          <td>3</td>
        </tr>
        <tr>
          <td><code>8443</code></td>
          <td> </td>
          <td>3</td>
        </tr>
        <tr>
          <td><code>8080</code></td>
          <td> </td>
          <td>3</td>
        </tr>
        <tr>
          <td><em>8 others</em></td>
          <td> </td>
          <td>27</td>
        </tr>
      </tbody></table>
    </td>
  </tr>
  <tr>
    <td colspan="4"><hr/></td>
  </tr>
</tbody></table>

<h5 id="iphints"><code>ipv4hint</code> and <code>ipv6hint</code></h5>

<p>IP hints are ubiquitous.  Over 99.8% of <code>HTTPS</code> records have <code>ipv4hint</code>s set, over 92.5% have <code>ipv6hint</code>s set.  There are 12 domains
that only use <code>ipv6hint</code>s and
around 420K that only use <code>ipv4hint</code>s.</p>

<table>
  <tbody><tr>
    <td> </td>
    <td><b>bare domains</b></td>
    <td><b><code>www.</code> subdomains</b></td>
    <td><b>Top1M bare</b></td>
    <td><b>Top1M <code>www.</code></b></td>
  </tr>
  <tr>
    <td colspan="5"><hr/></td>
  </tr>
  <tr>
    <td><b># of unique IPv4</b></td>
    <td>107,131</td>
    <td>131,271</td>
    <td>91,446</td>
    <td>41,623</td>
  </tr>
  <tr>
    <td><b>most frequent IPv4</b></td>
    <td>104.16.16.194</td>
    <td>104.16.16.194</td>
    <td>141.193.213.10</td>
    <td>141.193.213.21</td>
  </tr>
  <tr>
    <td><b># of unique IPv6</b></td>
    <td>102,582</td>
    <td>105,297</td>
    <td>79,842</td>
    <td>83,093</td>
  </tr>
  <tr>
    <td><b>most frequent IPv6</b></td>
    <td>2606:4700:4400::ac4</td>
    <td>2606:4700:4400::ac4</td>
    <td>2606:4700:3037::681</td>
    <td>2606:4700:3037::681</td>
  </tr>
  <tr>
    <td colspan="5"><hr/></td>
  </tr>
</tbody></table>

<p>Now usually when I&#39;ve done this sort of analysis,
I&#39;ve then also reported on the distribution of IP
addresses across Autonomous Systems (AS), but this
time there is hardly any use in doing so, as almost all
IPs map only into Cloudflare&#39;s networks:</p>

<table>
  <tbody><tr>
    <td><b>AS Number</b></td>
    <td> </td>
    <td><b>Owner / Name</b></td>
    <td><b>Count</b></td>
  </tr>
  <tr>
    <td colspan="4"><hr/></td>
  </tr>
  <tr>
    <td>13335</td>
    <td> </td>
    <td>CLOUDFLARENET, US</td>
    <td>9,592,729</td>
  </tr>
  <tr>
    <td>209242</td>
    <td> </td>
    <td>CLOUDFLARESPECTRUM</td>
    <td>228,058</td>
  </tr>
  <tr>
    <td>273584</td>
    <td> </td>
    <td>LINKED STORE BRASIL [...]</td>
    <td>24,646</td>
  </tr>
  <tr>
    <td>397273</td>
    <td> </td>
    <td>RENDER, US</td>
    <td>12,497</td>
  </tr>
  <tr>
    <td>12996</td>
    <td> </td>
    <td>DOMENESHOP Oslo, Norway, NO</td>
    <td>11,209</td>
  </tr>
  <tr>
    <td>16509</td>
    <td> </td>
    <td>AMAZON-02, US</td>
    <td>2,199</td>
  </tr>
  <tr>
    <td>14061</td>
    <td> </td>
    <td>DIGITALOCEAN-ASN, US</td>
    <td>1,828</td>
  </tr>
  <tr>
    <td>24940</td>
    <td> </td>
    <td>HETZNER-AS, DE</td>
    <td>1,262</td>
  </tr>
  <tr>
    <td> </td>
    <td> </td>
    <td><em>1,805 other AS</em></td>
    <td>20,319</td>
  </tr>
  <tr>
    <td colspan="4"><hr/></td>
  </tr>
</tbody></table>

<p>This suggests that the adoption of the <code>HTTPS</code> record is -- at this time,
anyway -- effectively driven by Cloudflare setting the
records by default on all of their domains.  Since
that includes many small, parked domains or domains
with very little traffic, it&#39;s difficult to judge how
many organizations currently <em>actually</em> take
advantage of the record&#39;s capabilities.  I&#39;d guess
that most aren&#39;t aware of them at all, and active use
is far, far less common.</p>

<h3 id="summary">Summary</h3>

<p>As we have seen, despite being a just recently
finalized RFC, the use of <code>HTTPS</code>
DNS records has already grown beyond just sporadic.
If you monitor your organization&#39;s DNS logs, you will
find plenty of lookups, as popular browsers have
already started to at least partially implement
support for them.</p>

<p>On the domain side, however, it seems that very few
organizations explicitly set them.  I&#39;m curious to see
how this adoption will spread, and whether we will see
regular <code>CNAME</code> records (with
time) be replaced by <code>HTTPS</code>
records, or if we will primarily see that use at the
zone apex.</p>

<p>Generally speaking, I expect CDNs to lead the
adoption efforts here, as the benefits most obvious in
their use cases, and as is evident from the above findings
as well.  The adoption of ECH, effectively tied to the
<code>HTTPS</code> record, will hopefully
also increase as we move forward here.  I know I&#39;ll be
keeping an eye on that.</p>


<p><small>November 13th, 2023</small></p>

<hr/>

<p><small>Footnotes:</small></p>

<p id="1"> <small>[1] Safari gets this right.
Firefox only looks up <code>HTTPS</code>
records when using DoH, but then also does the right
thing.  Chrome, as of October 2023 <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1494759">does
not support other target names nor use the IP hints</a> in the
record.</small></p>

<p id="2"> <small>[2] Logically, the Top1M
domains ought to all fall into the comprehensive list
of all second-level domain names, but unfortunately
not all second-level domains make available their
zones, meaning my list of second-level domains does
not include several of the names found in the Top1M
list.  (The missing names generally are those found in
country-code TLDs that don&#39;t publish their zones for
research.</small></p>

<hr/>

<p><small>Links:</small></p>

<ul>
  <li><small><a href="https://mstdn.social/@jschauma/111406404607681960">This blog post as a Mastodon thread</a></small></li>
  <li><small><a href="https://blog.apnic.net/2023/12/18/use-of-https-resource-records/">This blog post on the APNIC blog</a></small></li>
  <li><small><a href="https://news.ycombinator.com/item?id=38845463">HackerNews Comments</a></small></li>
  <li><small><a href="https://lobste.rs/s/z5ogrr/use_https_resource_records">Lobsters Comments</a></small></li>
  <li><small>HTTP/SVCB or ECH specific:</small>
    <ul>
      <li><small><a href="https://arxiv.org/pdf/2309.10344.pdf">A similar analysis</a></small></li>
      <li><small><a href="https://www.rfc-editor.org/rfc/rfc9460.html">RFC9460</a> -- Service Binding and Parameter Specification via the DNS (SVCB and HTTPS Resource Records)</small></li>
      <li><small><a href="https://www.sobyte.net/post/2022-01/dns-svcb-https/">Introduction to DNS SVCB/HTTPS records</a></small></li>
      <li><small><a href="https://www.isc.org/docs/2022-webinar-dns-scvb.pdf">ISC Webinar Slides</a></small></li>
      <li><small><a href="https://tls-ech.dev/">ECH test site</a></small></li>
      <li><small><a href="https://defo.ie/">Another ECH test site</a></small></li>
    </ul>
  </li>
  <li><small>Related research on internet centralization:</small>
    <ul>
      <li><small><a href="https://riskmusings.substack.com/p/naked-domains.html">The gTLDs&#39; New Clothes - A Look at Centralization in Naked Domains</a></small></li>
      <li><small><a href="https://riskmusings.substack.com/p/caa-diversity.html">Whose Cert Is It Anyway?</a></small></li>
      <li><small><a href="https://riskmusings.substack.com/p/mx-diversity.html">Who reads your email?</a></small></li>
      <li><small><a href="https://riskmusings.substack.com/p/nsauth-diversity.html">Who controls the internet?</a></small></li>
    </ul>
  </li><li><small>Other DNS related content on this blog:</small>
    <ul>
      <li><small><a href="https://riskmusings.substack.com/tldstats/">DNS Zone Stats</a></small></li>
      <li><small><a href="https://riskmusings.substack.com/p/dns-rrs.html">(All) DNS Resource Records</a></small></li>
      <li><small><a href="https://riskmusings.substack.com/p/tlds.html">TLDs -- Putting the &#39;.fun&#39; in the top of the DNS</a></small></li>
      <li><small><a href="https://riskmusings.substack.com/p/dns-size.html">DNS Response Size</a></small></li>
    </ul>
  </li>
</ul>


      </td>
    </tr>
  </tbody></div></div>
  </body>
</html>
