<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/faster-cpython/ideas/wiki/Workflow-for-3.12-cycle">Original</a>
    <h1>Faster CPython 3.12 Plan</h1>
    
    <div id="readability-page-1" class="page"><div data-view-component="true">          <div id="wiki-body">
              <div>
                <p>(Graphical version at the end)</p>

<h2>
<a id="user-content-a-per-interpreter-gil" aria-hidden="true" href="#a-per-interpreter-gil"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>A per-interpreter GIL</h2>
<ul>
<li>
<p> Per-interpreter isolation for extension modules</p>
</li>
<li>
<p> A CI check to prevent new globals in CPython code</p>
<ul>
<li>
 Tooling to identify global variables in CPython code</li>
</ul>
</li>
<li>
<p> Interpreter isolation (_PyRuntimeState -&gt; PyInterpreterState)</p>
<ul>
<li>
<p> Consolidate global state to _PyRuntimeState</p>
<ul>
<li>
 Tooling to identify global variables in CPython code <em>(also above)</em>
</li>
</ul>
</li>
<li>
<p> PEP 683 - immortal objects</p>
</li>
<li>
<p> mimalloc</p>
</li>
</ul>
</li>
<li>
<p> Restrictions on interpreter capability (e.g. no threading)</p>
<ul>
<li>
 Per-interpreter config &amp; func to specify restrictions</li>
</ul>
</li>
<li>
<p> PEP 684: A Per-interpreter GIL</p>
</li>
</ul>
<h2>
<a id="user-content-expose-multiple-interpreters-to-python-code" aria-hidden="true" href="#expose-multiple-interpreters-to-python-code"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Expose multiple interpreters to Python code</h2>
<ul>
<li>
<p> Implement PEP 554</p>
<ul>
<li>
 PEP 554 - Multiple Interpreters in the Stdlib</li>
</ul>
</li>
</ul>

<h2>
<a id="user-content-reduced-reference-counting-overhead" aria-hidden="true" href="#reduced-reference-counting-overhead"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Reduced reference counting overhead</h2>
<ul>
<li>
<p> Optimize flow of references in C,
transferring ownership when needed</p>
<ul>
<li>
 Identify flow of references in C</li>
</ul>
</li>
<li>
<p> Static reduction in refcount operations</p>
<ul>
<li>
<p> Bytecode compiler enhancements
<strong>Irit</strong></p>
</li>
<li>
<p> Deferred reference counts</p>
</li>
</ul>
</li>
<li>
<p> Deferred reference counts <em>(also above)</em></p>
</li>
</ul>

<ul>
<li>(Task needs breaking up)</li>
</ul>

<h2>
<a id="user-content-compact-objects-1" aria-hidden="true" href="#compact-objects-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Compact objects</h2>
<ul>
<li>
<p> Merge managed dict and values
pointer into one word</p>
</li>
<li>
<p> One word GC header</p>
<ul>
<li>
 Saturating refcounts</li>
</ul>
</li>
</ul>

<h2>
<a id="user-content-finish-specialization" aria-hidden="true" href="#finish-specialization"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Finish specialization</h2>
<ul>
<li>
<p> Specialize SEND</p>
<ul>
<li>
<p> Specialize FOR_ITER for generator</p>
<ul>
<li>
<p> Specialize FOR_ITER for sequences
<strong>Dennis</strong></p>
</li>
<li>
<p> Shim frames on entry
to PyEval_EvalDefault</p>
<ul>
<li>
 Identify main sources of
calls to PyEval_EvalFrame</li>
</ul>
</li>
</ul>
</li>
<li>
<p> Move PEP 380 logic into compiler <strong>Brandt</strong></p>
</li>
</ul>
</li>
</ul>

<h2>
<a id="user-content-projected-short-trace-opimized-interpreter" aria-hidden="true" href="#projected-short-trace-opimized-interpreter"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Projected (short) trace opimized interpreter</h2>
<ul>
<li>
<p> Optimize traces:
Guard stengthening and elimination</p>
<ul>
<li>
 Trace interpreter <em>(also below)</em>
</li>
</ul>
</li>
<li>
<p> Optimize traces:
Allocation elimination</p>
<ul>
<li>
<p> Trace interpreter</p>
<ul>
<li>
<p> Breakup instruction definitions into &#39;mini-ops&#39; <em>(see below)</em></p>
</li>
<li>
<p> Trace projection:
Create traces from hotspots</p>
<ul>
<li>
<p> Detect hotspots in code</p>
<ul>
<li>
 Only unconditional jumps should go backwards</li>
</ul>
</li>
<li>
<p> Implement optimizer API</p>
</li>
<li>
<p> Generate version of the interpreter better
suited to emscripten and web assembly</p>
</li>
<li>
<p> Breakup instruction definitions into &#39;mini-ops&#39;</p>
<ul>
<li>
<p> Move opcode definitions to their own file
and generate PyEval_EvalDefault <em>(also below)</em></p>
<ul>
<li>
 Move PEP 380 logic into compiler
<strong>Brandt</strong> <em>(also above)</em>
</li>
</ul>
</li>
<li>
<p> Encapasulate GIL code and
move it out of ceval.c #93177</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p> Generate version of the interpreter better
suited to emscripten and web assembly
<em>(goal without dependents?)</em></p>
<ul>
<li>
 Move opcode definitions to their own file
and generate PyEval_EvalDefault <em>(also above)</em>
</li>
</ul>
</li>
</ul>
<section data-identity="a049125a-f6a2-41d0-b548-54eda2cbe7a5" data-host="https://viewscreen.githubusercontent.com" data-src="https://viewscreen.githubusercontent.com/markdown/mermaid" data-content="{&#34;data&#34;:&#34;graph LR\n\n%% High level goals\n\n    CompactObject[[\&#34;Compact objects\&#34;]]\n    \n    ReducedRefcount[[\&#34;Reduced reference counting overhead\&#34;]]\n    \n    SpecDone[[\&#34;Finish specialization\&#34;]]\n    \n    Traces[[\&#34;Projected (short) trace opimitized interpreter\&#34;]]\n\n    InterpretersInPythonCode[[\&#34;Expose multiple interpreters to Python code\&#34;]]\n\n    PerInterpreterGIL[[\&#34;A per-interpreter GIL\&#34;]]\n\n%% Tasks\n\n    Compiler(\&#34;Bytecode compiler enhancements&amp;lt;br/&amp;gt;&amp;lt;b&amp;gt;Irit&amp;lt;/b&amp;gt;\&#34;)\n    \n    StaticRefcntReduction(\&#34;Use static analysis to reduce&amp;lt;br/&amp;gt;reference count operations\&#34;)\n\n    SpecSeq(\&#34;Specialize FOR_ITER for sequences&amp;lt;br/&amp;gt;&amp;lt;b&amp;gt;Dennis&amp;lt;/b&amp;gt;\&#34;)\n\n    SpecGen(\&#34;Specialize FOR_ITER for generator\&#34;)\n    \n    SpecClass(\&#34;Specialize CALL for Python classes\&#34;)\n    \n    CtoPy(\&#34;Identify main sources of&amp;lt;br/&amp;gt;calls to PyEval_EvalFrame\&#34;)\n\n    ShimFrame(\&#34;Shim frames on entry&amp;lt;br/&amp;gt;to PyEval_EvalDefault\&#34;)\n\n    SpecSend(\&#34;Specialize SEND\&#34;)\n    \n    SatRefcnt(\&#34;Saturating refcounts\&#34;)\n\n    380(\&#34;Move PEP 380 logic into compiler&amp;lt;br/&amp;gt;&amp;lt;b&amp;gt;Brandt&amp;lt;/b&amp;gt; \&#34;)\n\n    EncapsulateGIL(\&#34;Encapasulate GIL code and&amp;lt;br/&amp;gt;move it out of ceval.c #93177\&#34;)\n\n    OpcodesOwnFile(\&#34;Move opcode definitions to their own file&amp;lt;br/&amp;gt;and generate PyEval_EvalDefault\&#34;)\n\n    CycleGC(\&#34;Improve cycle GC&amp;lt;br/&amp;gt;(Task needs breaking up)\&#34;)\n\n    MiniOps(\&#34;Breakup instruction definitions into &#39;mini-ops&#39;\&#34;)\n    \n    SmallGCHead(\&#34;One word GC header\&#34;)\n    \n    MergeDictValuePointers(\&#34;Merge managed dict and values&amp;lt;br/&amp;gt;pointer into one word\&#34;)\n \n    TrackRefsInC(\&#34;Identify flow of references in C\&#34;)\n    \n    OptRefsInC(\&#34;Optimize flow of references in C,&amp;lt;br/&amp;gt;transferring ownership when needed\&#34;)\n    \n    GuardOpt(\&#34;Optimize traces:&amp;lt;br/&amp;gt;Guard stengthening and elimination\&#34;)\n    \n    AllocSinking(\&#34;Optimize traces:&amp;lt;br/&amp;gt;Allocation elimination\&#34;)\n    \n    AllBranchesForward(\&#34;Only unconditional jumps should go backwards\&#34;)\n    \n    HotSpotDetection(\&#34;Detect hotspots in code\&#34;)\n    \n    TraceProjection(\&#34;Trace projection:&amp;lt;br/&amp;gt;Create traces from hotspots\&#34;)\n    \n    TraceEval(\&#34;Trace interpreter\&#34;)\n    \n    OptAPI(\&#34;Implement optimizer API\&#34;)\n    \n    Deferred(\&#34;Deferred reference counts\&#34;)\n    \n    StaticRefcntReduction(\&#34;Static reduction in refcount operations\&#34;)\n    \n    WebAssemblyFriendlyInterpreter(\&#34;Generate version of the interpreter better&amp;lt;br/&amp;gt;suited to emscripten and web assembly\&#34;)\n\n    PEP554(\&#34;PEP 554 - Multiple Interpreters in the Stdlib\&#34;)\n\n    PEP554Impl(\&#34;Implement PEP 554\&#34;)\n\n    ExtensionIsolation(\&#34;Per-interpreter isolation for extension modules\&#34;)\n\n    CAnalyzer(\&#34;Tooling to identify global variables in CPython code\&#34;)\n\n    GlobalsCICheck(\&#34;A CI check to prevent new globals in CPython code\&#34;)\n\n    ConsolidateGlobals(\&#34;Consolidate global state to _PyRuntimeState\&#34;)\n\n    ImmortalObjects(\&#34;PEP 683 - immortal objects\&#34;)\n\n    Mimalloc(\&#34;mimalloc\&#34;)\n\n    InterpreterIsolation(\&#34;Interpreter isolation (_PyRuntimeState -&amp;gt; PyInterpreterState)\&#34;)\n\n    InterpretersAPI(\&#34;Per-interpreter config &amp;amp; func to specify restrictions\&#34;)\n\n    InterpreterRestrictions(\&#34;Restrictions on interpreter capability (e.g. no threading)\&#34;)\n\n    PEP684(\&#34;PEP 684 - A Per-Interpreter GIL\&#34;)\n\n%% Dependencies\n\n    380 --&amp;gt; OpcodesOwnFile\n    380 --&amp;gt; SpecSend\n\n    subgraph Trace optimized interpreter\n    AllBranchesForward --&amp;gt; HotSpotDetection\n    HotSpotDetection --&amp;gt; TraceProjection\n    OpcodesOwnFile --&amp;gt; MiniOps\n    EncapsulateGIL --&amp;gt; OpcodesOwnFile\n    OpcodesOwnFile --&amp;gt; WebAssemblyFriendlyInterpreter\n    OptAPI --&amp;gt; TraceProjection\n    MiniOps --&amp;gt; TraceProjection\n    TraceProjection --&amp;gt; TraceEval\n    MiniOps --&amp;gt; TraceEval\n    TraceEval --&amp;gt; GuardOpt\n    TraceEval --&amp;gt; AllocSinking\n    GuardOpt --&amp;gt; Traces\n    AllocSinking --&amp;gt; Traces\n    end\n\n    subgraph Specialization\n    CtoPy --&amp;gt; ShimFrame\n    SpecSeq --&amp;gt; SpecGen\n    ShimFrame --&amp;gt; SpecGen\n    SpecGen --&amp;gt; SpecSend\n    SpecSend --&amp;gt; SpecDone\n    SpecClass --&amp;gt; SpecDone\n    end\n\n    subgraph Compact Objects\n    SatRefcnt --&amp;gt; SmallGCHead\n    MergeDictValuePointers --&amp;gt; CompactObject\n    SmallGCHead --&amp;gt; CompactObject\n    end\n\n    subgraph Reduced Reference Count Overhead\n    TrackRefsInC --&amp;gt; OptRefsInC\n    OptRefsInC --&amp;gt; ReducedRefcount\n    Compiler --&amp;gt; StaticRefcntReduction\n    Deferred --&amp;gt; StaticRefcntReduction\n    Deferred --&amp;gt; ReducedRefcount\n    StaticRefcntReduction --&amp;gt; ReducedRefcount\n    end\n\n    subgraph Multi-core Python\n    ExtensionIsolation --&amp;gt; PerInterpreterGIL\n    CAnalyzer --&amp;gt; ConsolidateGlobals\n    CAnalyzer --&amp;gt; GlobalsCICheck\n    GlobalsCICheck --&amp;gt; PerInterpreterGIL\n    ConsolidateGlobals --&amp;gt; InterpreterIsolation\n    ImmortalObjects --&amp;gt; InterpreterIsolation\n    Mimalloc --&amp;gt; InterpreterIsolation\n    InterpreterIsolation --&amp;gt; PerInterpreterGIL\n    InterpretersAPI --&amp;gt; InterpreterRestrictions\n    InterpreterRestrictions --&amp;gt; PerInterpreterGIL\n    PEP684 --&amp;gt; PerInterpreterGIL\n\n    PEP554 --&amp;gt; PEP554Impl\n    PEP554Impl --&amp;gt; InterpretersInPythonCode\n    end\n\n%% Links and colors\n    click TrackRefsInC \&#34;https://github.com/faster-cpython/ideas/issues/441\&#34;\n    click OptRefsInC \&#34;https://github.com/faster-cpython/ideas/issues/442\&#34;\n    click Deferred \&#34;https://github.com/faster-cpython/ideas/issues/443\&#34;\n    click StaticRefcntReduction \&#34;https://github.com/faster-cpython/ideas/issues/444\&#34;\n\n    click ShimFrame \&#34;https://github.com/faster-cpython/ideas/issues/436\&#34;\n    click SpecSeq \&#34;https://github.com/faster-cpython/ideas/issues/67\&#34;\n    click SpecClass \&#34;https://github.com/python/cpython/pull/31707\&#34;\n\n    click 380 \&#34;https://github.com/python/cpython/pull/31968\&#34;\n\n    click MergeDictValuePointers \&#34;https://github.com/python/cpython/pull/95278\&#34;\n    style MergeDictValuePointers fill:#88f\n\n    click PEP554 \&#34;https://peps.python.org/pep-0554/\&#34;\n    click ImmortalObjects \&#34;https://peps.python.org/pep-0683/\&#34;\n    click PEP684 \&#34;https://peps.python.org/pep-0684/\&#34;\n&#34;}" data-type="mermaid" aria-label="enrichable markdown container">
  
  
  <section aria-label="Raw mermaid code">
    <pre lang="mermaid">graph LR

%% High level goals

    CompactObject[[&#34;Compact objects&#34;]]
    
    ReducedRefcount[[&#34;Reduced reference counting overhead&#34;]]
    
    SpecDone[[&#34;Finish specialization&#34;]]
    
    Traces[[&#34;Projected (short) trace opimitized interpreter&#34;]]

    InterpretersInPythonCode[[&#34;Expose multiple interpreters to Python code&#34;]]

    PerInterpreterGIL[[&#34;A per-interpreter GIL&#34;]]

%% Tasks

    Compiler(&#34;Bytecode compiler enhancements&amp;lt;br/&amp;gt;&amp;lt;b&amp;gt;Irit&amp;lt;/b&amp;gt;&#34;)
    
    StaticRefcntReduction(&#34;Use static analysis to reduce&amp;lt;br/&amp;gt;reference count operations&#34;)

    SpecSeq(&#34;Specialize FOR_ITER for sequences&amp;lt;br/&amp;gt;&amp;lt;b&amp;gt;Dennis&amp;lt;/b&amp;gt;&#34;)

    SpecGen(&#34;Specialize FOR_ITER for generator&#34;)
    
    SpecClass(&#34;Specialize CALL for Python classes&#34;)
    
    CtoPy(&#34;Identify main sources of&amp;lt;br/&amp;gt;calls to PyEval_EvalFrame&#34;)

    ShimFrame(&#34;Shim frames on entry&amp;lt;br/&amp;gt;to PyEval_EvalDefault&#34;)

    SpecSend(&#34;Specialize SEND&#34;)
    
    SatRefcnt(&#34;Saturating refcounts&#34;)

    380(&#34;Move PEP 380 logic into compiler&amp;lt;br/&amp;gt;&amp;lt;b&amp;gt;Brandt&amp;lt;/b&amp;gt; &#34;)

    EncapsulateGIL(&#34;Encapasulate GIL code and&amp;lt;br/&amp;gt;move it out of ceval.c #93177&#34;)

    OpcodesOwnFile(&#34;Move opcode definitions to their own file&amp;lt;br/&amp;gt;and generate PyEval_EvalDefault&#34;)

    CycleGC(&#34;Improve cycle GC&amp;lt;br/&amp;gt;(Task needs breaking up)&#34;)

    MiniOps(&#34;Breakup instruction definitions into &#39;mini-ops&#39;&#34;)
    
    SmallGCHead(&#34;One word GC header&#34;)
    
    MergeDictValuePointers(&#34;Merge managed dict and values&amp;lt;br/&amp;gt;pointer into one word&#34;)
 
    TrackRefsInC(&#34;Identify flow of references in C&#34;)
    
    OptRefsInC(&#34;Optimize flow of references in C,&amp;lt;br/&amp;gt;transferring ownership when needed&#34;)
    
    GuardOpt(&#34;Optimize traces:&amp;lt;br/&amp;gt;Guard stengthening and elimination&#34;)
    
    AllocSinking(&#34;Optimize traces:&amp;lt;br/&amp;gt;Allocation elimination&#34;)
    
    AllBranchesForward(&#34;Only unconditional jumps should go backwards&#34;)
    
    HotSpotDetection(&#34;Detect hotspots in code&#34;)
    
    TraceProjection(&#34;Trace projection:&amp;lt;br/&amp;gt;Create traces from hotspots&#34;)
    
    TraceEval(&#34;Trace interpreter&#34;)
    
    OptAPI(&#34;Implement optimizer API&#34;)
    
    Deferred(&#34;Deferred reference counts&#34;)
    
    StaticRefcntReduction(&#34;Static reduction in refcount operations&#34;)
    
    WebAssemblyFriendlyInterpreter(&#34;Generate version of the interpreter better&amp;lt;br/&amp;gt;suited to emscripten and web assembly&#34;)

    PEP554(&#34;PEP 554 - Multiple Interpreters in the Stdlib&#34;)

    PEP554Impl(&#34;Implement PEP 554&#34;)

    ExtensionIsolation(&#34;Per-interpreter isolation for extension modules&#34;)

    CAnalyzer(&#34;Tooling to identify global variables in CPython code&#34;)

    GlobalsCICheck(&#34;A CI check to prevent new globals in CPython code&#34;)

    ConsolidateGlobals(&#34;Consolidate global state to _PyRuntimeState&#34;)

    ImmortalObjects(&#34;PEP 683 - immortal objects&#34;)

    Mimalloc(&#34;mimalloc&#34;)

    InterpreterIsolation(&#34;Interpreter isolation (_PyRuntimeState -&amp;gt; PyInterpreterState)&#34;)

    InterpretersAPI(&#34;Per-interpreter config &amp;amp; func to specify restrictions&#34;)

    InterpreterRestrictions(&#34;Restrictions on interpreter capability (e.g. no threading)&#34;)

    PEP684(&#34;PEP 684 - A Per-Interpreter GIL&#34;)

%% Dependencies

    380 --&amp;gt; OpcodesOwnFile
    380 --&amp;gt; SpecSend

    subgraph Trace optimized interpreter
    AllBranchesForward --&amp;gt; HotSpotDetection
    HotSpotDetection --&amp;gt; TraceProjection
    OpcodesOwnFile --&amp;gt; MiniOps
    EncapsulateGIL --&amp;gt; OpcodesOwnFile
    OpcodesOwnFile --&amp;gt; WebAssemblyFriendlyInterpreter
    OptAPI --&amp;gt; TraceProjection
    MiniOps --&amp;gt; TraceProjection
    TraceProjection --&amp;gt; TraceEval
    MiniOps --&amp;gt; TraceEval
    TraceEval --&amp;gt; GuardOpt
    TraceEval --&amp;gt; AllocSinking
    GuardOpt --&amp;gt; Traces
    AllocSinking --&amp;gt; Traces
    end

    subgraph Specialization
    CtoPy --&amp;gt; ShimFrame
    SpecSeq --&amp;gt; SpecGen
    ShimFrame --&amp;gt; SpecGen
    SpecGen --&amp;gt; SpecSend
    SpecSend --&amp;gt; SpecDone
    SpecClass --&amp;gt; SpecDone
    end

    subgraph Compact Objects
    SatRefcnt --&amp;gt; SmallGCHead
    MergeDictValuePointers --&amp;gt; CompactObject
    SmallGCHead --&amp;gt; CompactObject
    end

    subgraph Reduced Reference Count Overhead
    TrackRefsInC --&amp;gt; OptRefsInC
    OptRefsInC --&amp;gt; ReducedRefcount
    Compiler --&amp;gt; StaticRefcntReduction
    Deferred --&amp;gt; StaticRefcntReduction
    Deferred --&amp;gt; ReducedRefcount
    StaticRefcntReduction --&amp;gt; ReducedRefcount
    end

    subgraph Multi-core Python
    ExtensionIsolation --&amp;gt; PerInterpreterGIL
    CAnalyzer --&amp;gt; ConsolidateGlobals
    CAnalyzer --&amp;gt; GlobalsCICheck
    GlobalsCICheck --&amp;gt; PerInterpreterGIL
    ConsolidateGlobals --&amp;gt; InterpreterIsolation
    ImmortalObjects --&amp;gt; InterpreterIsolation
    Mimalloc --&amp;gt; InterpreterIsolation
    InterpreterIsolation --&amp;gt; PerInterpreterGIL
    InterpretersAPI --&amp;gt; InterpreterRestrictions
    InterpreterRestrictions --&amp;gt; PerInterpreterGIL
    PEP684 --&amp;gt; PerInterpreterGIL

    PEP554 --&amp;gt; PEP554Impl
    PEP554Impl --&amp;gt; InterpretersInPythonCode
    end

%% Links and colors
    click TrackRefsInC &#34;https://github.com/faster-cpython/ideas/issues/441&#34;
    click OptRefsInC &#34;https://github.com/faster-cpython/ideas/issues/442&#34;
    click Deferred &#34;https://github.com/faster-cpython/ideas/issues/443&#34;
    click StaticRefcntReduction &#34;https://github.com/faster-cpython/ideas/issues/444&#34;

    click ShimFrame &#34;https://github.com/faster-cpython/ideas/issues/436&#34;
    click SpecSeq &#34;https://github.com/faster-cpython/ideas/issues/67&#34;
    click SpecClass &#34;https://github.com/python/cpython/pull/31707&#34;

    click 380 &#34;https://github.com/python/cpython/pull/31968&#34;

    click MergeDictValuePointers &#34;https://github.com/python/cpython/pull/95278&#34;
    style MergeDictValuePointers fill:#88f

    click PEP554 &#34;https://peps.python.org/pep-0554/&#34;
    click ImmortalObjects &#34;https://peps.python.org/pep-0683/&#34;
    click PEP684 &#34;https://peps.python.org/pep-0684/&#34;
</pre>
  </section>
</section>


              </div>

          </div>
</div></div>
  </body>
</html>
