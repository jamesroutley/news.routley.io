<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tech.gerardbentley.com/python/data/intermediate/2022/04/26/holy-duck.html">Original</a>
    <h1>Fast analysis with DuckDB and Pyarrow</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>

<div>

<div>
<pre><span>---------------------------------------------------------------------------</span>
<span>TypeError</span>                                 Traceback (most recent call last)
<span>/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb Cell 38&#39;</span> in <span>&lt;cell line: 1&gt;</span><span>()</span>
<span>----&gt; &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=0&#39;&gt;1&lt;/a&gt;</span> pd.read_csv(
<span>      &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=1&#39;&gt;2&lt;/a&gt;</span>     &#34;uber-raw-data-sep14.csv.gz&#34;,
<span>      &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=2&#39;&gt;3&lt;/a&gt;</span>     # nrows=100000,  # approx. 10% of data
<span>      &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=3&#39;&gt;4&lt;/a&gt;</span>     engine=&#39;pyarrow&#39;,
<span>      &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=4&#39;&gt;5&lt;/a&gt;</span>     # names=[
<span>      &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=5&#39;&gt;6&lt;/a&gt;</span>     #     &#34;date/time&#34;,
<span>      &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=6&#39;&gt;7&lt;/a&gt;</span>     #     &#34;lat&#34;,
<span>      &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=7&#39;&gt;8&lt;/a&gt;</span>     #     &#34;lon&#34;,
<span>      &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=8&#39;&gt;9&lt;/a&gt;</span>     #     &#34;CONST&#34;
<span>     &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=9&#39;&gt;10&lt;/a&gt;</span>     # ],  # specify names directly since they don&#39;t change
<span>     &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=10&#39;&gt;11&lt;/a&gt;</span>     # skiprows=1,  # don&#39;t read header since names specified directly
<span>     &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=11&#39;&gt;12&lt;/a&gt;</span>     usecols=[0,1],  # doesn&#39;t load last column, constant value &#34;B02512&#34;
<span>     &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=12&#39;&gt;13&lt;/a&gt;</span>     # parse_dates=[
<span>     &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=13&#39;&gt;14&lt;/a&gt;</span>     #     &#34;date/time&#34;
<span>     &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=14&#39;&gt;15&lt;/a&gt;</span>     # ],  # set as datetime instead of converting after the fact
<span>     &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=15&#39;&gt;16&lt;/a&gt;</span>     # # infer_datetime_format=True  # Unsupported for pyarrow
<span>     &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=16&#39;&gt;17&lt;/a&gt;</span>     # date_parser=lambda x: pd.to_datetime(x)
<span>     &lt;a href=&#39;vscode-notebook-cell:/Users/gar/projects/demo-uber-nyc-pickups-main/blog.ipynb#ch0000047?line=17&#39;&gt;18&lt;/a&gt;</span> ).info()

File <span>~/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/util/_decorators.py:311</span>, in <span>deprecate_nonkeyword_arguments.&lt;locals&gt;.decorate.&lt;locals&gt;.wrapper</span><span>(*args, **kwargs)</span>
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/util/_decorators.py?line=304&#39;&gt;305&lt;/a&gt;</span> if len(args) &gt; num_allow_args:
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/util/_decorators.py?line=305&#39;&gt;306&lt;/a&gt;</span>     warnings.warn(
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/util/_decorators.py?line=306&#39;&gt;307&lt;/a&gt;</span>         msg.format(arguments=arguments),
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/util/_decorators.py?line=307&#39;&gt;308&lt;/a&gt;</span>         FutureWarning,
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/util/_decorators.py?line=308&#39;&gt;309&lt;/a&gt;</span>         stacklevel=stacklevel,
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/util/_decorators.py?line=309&#39;&gt;310&lt;/a&gt;</span>     )
<span>--&gt; &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/util/_decorators.py?line=310&#39;&gt;311&lt;/a&gt;</span> return func(*args, **kwargs)

File <span>~/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py:680</span>, in <span>read_csv</span><span>(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=664&#39;&gt;665&lt;/a&gt;</span> kwds_defaults = _refine_defaults_read(
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=665&#39;&gt;666&lt;/a&gt;</span>     dialect,
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=666&#39;&gt;667&lt;/a&gt;</span>     delimiter,
<span>   (...)</span>
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=675&#39;&gt;676&lt;/a&gt;</span>     defaults={&#34;delimiter&#34;: &#34;,&#34;},
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=676&#39;&gt;677&lt;/a&gt;</span> )
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=677&#39;&gt;678&lt;/a&gt;</span> kwds.update(kwds_defaults)
<span>--&gt; &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=679&#39;&gt;680&lt;/a&gt;</span> return _read(filepath_or_buffer, kwds)

File <span>~/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py:581</span>, in <span>_read</span><span>(filepath_or_buffer, kwds)</span>
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=577&#39;&gt;578&lt;/a&gt;</span>     return parser
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=579&#39;&gt;580&lt;/a&gt;</span> with parser:
<span>--&gt; &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=580&#39;&gt;581&lt;/a&gt;</span>     return parser.read(nrows)

File <span>~/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py:1243</span>, in <span>TextFileReader.read</span><span>(self, nrows)</span>
<span>   &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=1240&#39;&gt;1241&lt;/a&gt;</span> if self.engine == &#34;pyarrow&#34;:
<span>   &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=1241&#39;&gt;1242&lt;/a&gt;</span>     try:
<span>-&gt; &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=1242&#39;&gt;1243&lt;/a&gt;</span>         df = self._engine.read()
<span>   &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=1243&#39;&gt;1244&lt;/a&gt;</span>     except Exception:
<span>   &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/readers.py?line=1244&#39;&gt;1245&lt;/a&gt;</span>         self.close()

File <span>~/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/arrow_parser_wrapper.py:153</span>, in <span>ArrowParserWrapper.read</span><span>(self)</span>
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/arrow_parser_wrapper.py?line=145&#39;&gt;146&lt;/a&gt;</span> pyarrow_csv = import_optional_dependency(&#34;pyarrow.csv&#34;)
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/arrow_parser_wrapper.py?line=146&#39;&gt;147&lt;/a&gt;</span> self._get_pyarrow_options()
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/arrow_parser_wrapper.py?line=148&#39;&gt;149&lt;/a&gt;</span> table = pyarrow_csv.read_csv(
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/arrow_parser_wrapper.py?line=149&#39;&gt;150&lt;/a&gt;</span>     self.src,
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/arrow_parser_wrapper.py?line=150&#39;&gt;151&lt;/a&gt;</span>     read_options=pyarrow_csv.ReadOptions(**self.read_options),
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/arrow_parser_wrapper.py?line=151&#39;&gt;152&lt;/a&gt;</span>     parse_options=pyarrow_csv.ParseOptions(**self.parse_options),
<span>--&gt; &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/arrow_parser_wrapper.py?line=152&#39;&gt;153&lt;/a&gt;</span>     convert_options=pyarrow_csv.ConvertOptions(**self.convert_options),
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/arrow_parser_wrapper.py?line=153&#39;&gt;154&lt;/a&gt;</span> )
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/arrow_parser_wrapper.py?line=155&#39;&gt;156&lt;/a&gt;</span> frame = table.to_pandas()
<span>    &lt;a href=&#39;file:///Users/gar/miniconda3/envs/py39/lib/python3.9/site-packages/pandas/io/parsers/arrow_parser_wrapper.py?line=156&#39;&gt;157&lt;/a&gt;</span> return self._finalize_output(frame)

File <span>~/miniconda3/envs/py39/lib/python3.9/site-packages/pyarrow/_csv.pyx:580</span>, in <span>pyarrow._csv.ConvertOptions.__init__</span><span>()</span>

File <span>~/miniconda3/envs/py39/lib/python3.9/site-packages/pyarrow/_csv.pyx:734</span>, in <span>pyarrow._csv.ConvertOptions.include_columns.__set__</span><span>()</span>

File <span>stringsource:15</span>, in <span>string.from_py.__pyx_convert_string_from_py_std__in_string</span><span>()</span>

<span>TypeError</span>: expected bytes, int found</pre>
</div>
</div>

</div>
</div></div>
  </body>
</html>
