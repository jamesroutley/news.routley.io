<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://cloud.google.com/blog/topics/threat-intelligence/net-ntlmv1-deprecation-rainbow-tables">Original</a>
    <h1>Releasing rainbow tables to accelerate Net-NTLMv1 protocol deprecation</h1>
    
    <div id="readability-page-1" class="page"><div jsname="tx2NYc"><section></section><section><div jsaction="rcuQ6b:npT2md" jscontroller="M0Q3Qb" data-is-cws-richtext="true"><h3><span>Introduction</span></h3>
<p><span>Mandiant is </span><a href="https://research.google/resources/datasets/?dataset_types=other&amp;search=Net-NTLMv1&amp;" rel="noopener" target="_blank"><span>publicly releasing</span></a><span> a comprehensive dataset of Net-NTLMv1 rainbow tables to underscore the urgency of migrating away from this outdated protocol. Despite Net-NTLMv1 being deprecated and known to be insecure for over two decades—with cryptanalysis dating back to 1999—Mandiant consultants continue to identify its use in active environments. This legacy protocol leaves organizations vulnerable to trivial credential theft, yet it remains prevalent due to inertia and a lack of demonstrated immediate risk.</span></p>
<p><span>By releasing these tables, Mandiant aims to lower the barrier for security professionals to demonstrate the insecurity of Net-NTLMv1. While tools to exploit this protocol have existed for years, they often required uploading sensitive data to third-party services or expensive hardware to brute-force keys. The release of this dataset allows defenders and researchers to recover keys in under 12 hours using consumer hardware costing less than $600 USD. This initiative highlights the amplified impact of combining Mandiant&#39;s frontline expertise with Google Cloud&#39;s resources to eliminate entire classes of attacks.</span></p>
<p><span>This post details the generation of the tables, provides access to the dataset for community use, and outlines critical remediation steps to disable Net-NTLMv1 and prevent authentication coercion attacks.</span></p>
<h3><span>Background</span></h3>
<p><span>Net-NTLMv1 has been widely known to be insecure since at least 2012, following presentations at DEFCON 20, with cryptanalysis of the underlying protocol </span><a href="https://www.schneier.com/academic/archives/1999/09/cryptanalysis_of_mic_1.html" rel="noopener" target="_blank"><span>dating back to at least 1999</span></a><span>. On Aug. 30, 2016, Hashcat </span><a href="https://github.com/hashcat/hashcat/commit/71a8459d851d246945343ea59effa1d46b965bf8" rel="noopener" target="_blank"><span>added support</span></a><span> for cracking Data Encryption Standard (DES) keys using known plaintext, further democratizing the ability to attack this protocol. Rainbow tables are almost as old, with the initial paper on rainbow tables published in </span><a href="https://infoscience.epfl.ch/record/99512/files/Oech03.pdf" rel="noopener" target="_blank"><span>2003 by Philippe Oechslin</span></a><span>, citing an earlier iteration of a time-memory trade-off from </span><a href="http://www-ee.stanford.edu/~hellman/publications/36.pdf" rel="noopener" target="_blank"><span>1980 by Martin Hellman</span></a><span>.</span></p>
<p><span>Essentially, if an attacker can obtain a Net-NTLMv1 hash without Extended Session Security (ESS) for the known plaintext of </span><code>1122334455667788</code><span>, a cryptographic attack, referred to as a known plaintext attack (KPA), can be applied. This guarantees recovery of the key material used. Since the key material is the password hash of the authenticating Active Directory (AD) object—user or computer—the attack results can quickly be used to compromise the object, often leading to privilege escalation.</span></p>
<p><span>A common chain attackers use is authentication coercion from a highly privileged object, such as a domain controller (DC). Recovering the password hash of the DC machine account allows for DCSync privileges to compromise any other account in AD.</span></p>
<h3><span>Dataset Release</span></h3>
<p><span>The unsorted dataset can be downloaded using <code>gsutil -m cp -r gs://net-ntlmv1-tables/tables .</code> or through the </span><a href="https://research.google/resources/datasets/?dataset_types=other&amp;search=Net-NTLMv1&amp;" rel="noopener" target="_blank"><span>Google Cloud Research Dataset portal</span></a><span>. </span></p>
<p><span>The SHA512 hashes of the tables can be checked by first downloading the checksums <code>gsutil -m cp gs://net-ntlmv1-tables/tables.sha512 .</code> then checked by <code>sha512sum -c tables.sha512</code>. </span><span>The password cracking community has already created derivative work and is also hosting the ready to use tables.</span></p>
<h3><span>Use of the Tables</span></h3>
<p><span>Once a Net-NTLMv1 hash has been obtained, the tables can be used with historical or modern reinventions of rainbow table searching software such as </span><a href="https://www.kali.org/tools/rainbowcrack/" rel="noopener" target="_blank"><span>rainbowcrack (rcrack)</span></a><span>, or </span><a href="https://github.com/inAudible-NG/RainbowCrack-NG" rel="noopener" target="_blank"><span>RainbowCrack-NG</span></a><span> on central processing units (CPUs) or a </span><a href="https://github.com/blurbdust/rainbowcrackalack" rel="noopener" target="_blank"><span>fork</span></a><span> of </span><a href="https://github.com/jtesta/rainbowcrackalack" rel="noopener" target="_blank"><span>rainbowcrackalack</span></a><span> on graphics processing units (GPUs). The Net-NTLMv1 hash needs to be preprocessed to the DES components using </span><a href="https://github.com/evilmog/ntlmv1-multi" rel="noopener" target="_blank"><span>ntlmv1-multi</span></a><span> as shown in the next section</span><span>.</span></p>
<h3><span>Obtaining a Net-NTLMv1 Hash</span></h3>
<p><span>Most attackers will use </span><a href="https://github.com/lgandx/Responder" rel="noopener" target="_blank"><span>Responder</span></a><span> with the <code>--lm</code> and <code>--disable-ess</code> flags and set the authentication to a static value of <code>1122334455667788</code> to only allow for connections with Net-NTLMv1 as a possibility. Attackers can then wait for incoming connections or coerce authentication using a tool such as </span><a href="https://github.com/topotam/PetitPotam" rel="noopener" target="_blank"><span>PetitPotam</span></a><span> or </span><a href="https://github.com/Wh04m1001/DFSCoerce" rel="noopener" target="_blank"><span>DFSCoerce</span></a><span> to generate incoming connections from DCs or lower privilege hosts that are useful for objective completion. Responses can be cracked to retrieve password hashes of either users or computer machine accounts. A sample workflow for an attacker is shown below in Figure 1, Figure 2, and Figure 3.</span></p></div></section><section><div><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig1.max-800x800.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig1.max-800x800.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/><section role="dialog" aria-modal="true"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig1.max-800x800.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig1.max-800x800.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/></section></section></figure><div><p>Figure 1: DFSCoerce against a DC</p></div></section></div></section><section><div><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig2.max-600x600.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig2.max-600x600.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/><section role="dialog" aria-modal="true"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig2.max-600x600.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig2.max-600x600.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/></section></section></figure><div><p>Figure 2: Net-NTLMv1 hash obtained for DC machine account</p></div></section></div></section><section><div><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig3.max-800x800.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig3.max-800x800.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/><section role="dialog" aria-modal="true"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig3.max-800x800.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig3.max-800x800.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/></section></section></figure><div><p>Figure 3: Parse Net-NTLMv1 hash to DES parts</p></div></section></div></section><section><p><span>Figure 4 illustrates the processing of the Net-NTLMv1 hash to the DES ciphertexts.</span></p></section><section><div><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig4.max-2100x2100.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig4.max-2100x2100.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/><section role="dialog" aria-modal="true"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig4.max-2100x2100.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig4.max-2100x2100.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/></section></section></figure><div><p>Figure 4: Net-NTLMv1 hash to DES ciphertexts</p></div></section></div></section><section><p><span>An attacker then takes the split-out ciphertexts to crack the keys used based on the known plaintext of <code>1122334455667788</code> with the steps of loading the tables shown in Figure 5 and cracking results in Figure 6 and Figure 7.</span></p></section><section><div><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig5.max-1100x1100.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig5.max-1100x1100.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/><section role="dialog" aria-modal="true"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig5.max-1100x1100.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig5.max-1100x1100.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/></section></section></figure><div><p>Figure 5: Loading DES components for cracking</p></div></section></div></section><section><div><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig6.max-500x500.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig6.max-500x500.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/><section role="dialog" aria-modal="true"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig6.max-500x500.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig6.max-500x500.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/></section></section></figure><div><p>Figure 6: First hash cracked</p></div></section></div></section><section><div><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig7.max-1400x1400.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig7.max-1400x1400.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/><section role="dialog" aria-modal="true"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig7.max-1400x1400.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig7.max-1400x1400.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/></section></section></figure><div><p>Figure 7: Second hash cracked and run statistics</p></div></section></div></section><section><p><span>An attacker can then calculate the last remaining key with ntlmv1-multi once again, or look it up with </span><a href="https://github.com/sensepost/assless-chaps" rel="noopener" target="_blank"><span>twobytes</span></a><span>, to recreate the full NT hash for the DC account with the last key part shown in Figure 8.</span></p></section><section><div><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig8.max-600x600.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig8.max-600x600.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/><section role="dialog" aria-modal="true"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig8.max-600x600.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig8.max-600x600.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/></section></section></figure><div><p>Figure 8: Calculate remaining key</p></div></section></div></section><section><p><span>The result can be checked with hashcat&#39;s </span><a href="https://github.com/hashcat/hashcat/pull/2607" rel="noopener" target="_blank"><span>NT hash shucking mode</span></a><span>, <code>-m 27000</code>, as shown in Figure 9.</span></p></section><section><div><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig9.max-800x800.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig9.max-800x800.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/><section role="dialog" aria-modal="true"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig9.max-800x800.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig9.max-800x800.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/></section></section></figure><div><p>Figure 9: Keys checked with hash shucking</p></div></section></div></section><section><p><span>An attacker can then use the hash to perform a </span><a href="http://attack.mitre.org/techniques/T1003/006/" rel="noopener" target="_blank"><span>DCSync attack</span></a><span> targeting a DC and authenticating as the now compromised machine account. The attack flow uses </span><a href="https://github.com/fortra/impacket/blob/master/examples/secretsdump.py" rel="noopener" target="_blank"><span>secretsdump.py</span></a><span> from the </span><a href="https://github.com/fortra/impacket" rel="noopener" target="_blank"><span>Impacket</span></a><span> toolsuite and is shown in Figure 10.</span></p></section><section><div><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig10.max-1100x1100.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig10.max-1100x1100.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/><section role="dialog" aria-modal="true"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig10.max-1100x1100.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig10.max-1100x1100.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"/></section></section></figure><div><p>Figure 10: DCSync attack performed</p></div></section></div></section><section></section><section><section><span>Posted in</span><ul><li><a href="https://cloud.google.com/blog/topics/threat-intelligence" track-metadata-position="body" track-metadata-eventdetail="cloud.google.com/blog/topics/threat-intelligence" track-metadata-module="tag list" track-metadata-module_headline="posted in">Threat Intelligence</a></li></ul></section></section></div></div>
  </body>
</html>
