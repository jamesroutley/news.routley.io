<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605.html">Original</a>
    <h1>How to Store a Chess Game in 26 Bytes Using Bit-Level Magic (2022)</h1>
    
    <div id="readability-page-1" class="page"><div><p id="e07b95c2-cdaa-48a9-82b2-49506bc9c38e"><em>Author&#39;s note: This post was adapted from a presentation at the </em><a href="https://www.recurse.com"><em>Recurse Center</em></a><em>.</em></p><p id="5980285b-06d2-46e7-89d6-2c4c7dd1fe6f">This excursion started with <a href="https://sr.ht/~ntietz">Nicholas Tietz-Sokolsky</a>â€™s <a href="https://ntietz.com/blog/rc-week-8-recap">blog post</a>.</p><figure id="d286047d-b8c7-4a24-b45d-79dba4f3c030"><a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled.png"><img src="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled.png"/></a></figure><p id="75626a80-7e01-4d8f-b097-e903c7658826">I couldnâ€™t help but wonder - is this really the case?</p><p id="3a49b9c5-4345-46bb-b963-b62c008d4d45">There are 32 pieces on a chess board. Here we line them up side-by-side.</p><figure id="ad853419-3d00-42f1-85e5-be317f70fbf7"><a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%201.png"><img src="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%201.png"/></a></figure><p id="20551ec7-35e3-411b-b79b-9b2af54c32ec">Each piece can occupy one of 64 squares. Letâ€™s denote each piece by a number between 0 and 63 to represent the respective square.</p><figure id="50d9f16d-5480-4c16-90a8-08fdfd1ce6b3"><a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%202.png"><img src="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%202.png"/></a></figure><p id="1424b30a-ca74-493a-b7df-5f680fc83d15">Since each position takes up 6 bits (<span data-token-index="0" contenteditable="false"><span></span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>6</mn></msup><mo>=</mo><mn>64</mn></mrow><annotation encoding="application/x-tex">2^6 = 64</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>2</span><span><span><span><span><span><span></span><span><span>6</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>64</span></span></span></span></span><span>ï»¿</span></span>), multiplying 6 bits by 32 pieces gives us 192 bits / <strong>24 bytes</strong> (1 byte = 8 bits).</p><p id="da13f86c-d33c-41d5-a019-ad021cdb4243">Of course, itâ€™s rarely that simple <a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605.html">[1]</a>.</p><h3 id="5cdc8ec1-6569-49e6-8647-4b27771922b7">Captures</h3><p id="46e4d1db-9ca9-4e4a-bc30-65d4f6d03e67">In addition to positions, we need to keep track of captured pieces as these pieces do not appear on the board.</p><figure id="ab9477c8-2304-4d3f-a7b1-17e619b5ecf7"><a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%203.png"><img src="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%203.png"/></a></figure><h3 id="b061dfe7-6e2e-47ef-8577-d6cb0264347f">Castling availability</h3><p id="a41230c7-2327-4334-adca-7c3bd98fab65">We need to track if <a href="https://en.wikipedia.org/wiki/Castling">castling</a> is available on the kingâ€™s side, on the queenâ€™s side, or both. In particular, castling is not permitted if the king or the rook has previously moved.</p><figure id="31c4644c-7187-48b1-a910-5082d5fba2f5"><a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%204.png"><img src="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%204.png"/></a></figure><h3 id="9a21dd78-c126-49bb-881b-d7892d2a4cbe">En passant target</h3><p id="244e8f1f-efc9-4ca8-a259-b522253fa95e">The <a href="https://en.wikipedia.org/wiki/En_passant">en passant</a> capture is permitted on the turn immediately after the opposing pawn makes the double move. The capturing pawn moves to the square behind the opposing pawn; this square is called the en passant target.</p><figure id="9f97dc95-abbb-45cc-aabb-77a8fc4ad90a"><a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%205.png"><img src="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%205.png"/></a></figure><h3 id="a655043c-0250-465f-80da-33b681452d5a">Promotions</h3><p id="636f7d45-f29c-4b50-a15a-351da4e30fd0">A <a href="https://en.wikipedia.org/wiki/Promotion_(chess)">promotion</a> takes place when a pawn makes it to the final rank, and is then replaced with a knight, bishop, rook or queen.</p><figure id="cdc7c016-b25b-486e-bc2b-d8465310c822"><a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%206.png"><img src="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%206.png"/></a></figure><p id="78f3766e-63e2-4c60-9486-5a2b0cc96863">We can track captures with a bitmap of <strong>32 bits</strong>, each bit representing a piece. We can similarly use bitmaps for castling availability and en passant targets with <strong>4</strong> and <strong>16 bits</strong> respectively (1 bit for each rook and 1 bit for each pawn) <a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605.html">[2]</a>.</p><p id="9e7d4a8d-172c-4a7f-a00f-4a744e88606b">Promotions take a bit more space. For each pawn we need 3 bits: 1 bit for whether or not its been promoted, plus 2 bits for what piece its been promoted to. Thatâ€™s <strong>48 bits</strong> altogether.</p><p id="915827b5-f47d-4924-a233-2c24ee0f8225">In summary:</p><figure id="31deacd2-1cfb-4dc8-8d5f-bf5a27cd2950"><p><span>ðŸ”´</span></p><p>1 bit x 32 (for captures)
+ 1 bit x 4 (for castling)
+ 1 bit x 16 (for en passant)
+ 3 bits x 16 (for promotions)
= 100 bits / <strong>~12 bytes</strong></p></figure><p id="afe3c75d-50f4-4c56-843f-21f94fe2cea0">Can we do better?</p><p id="d1bb2faa-8bb7-4abf-bfbe-9f47beca2446">The first observation is that no two pieces can occupy the same square on the board.</p><p id="51e0eb38-3c4d-4a51-b809-9844fdc5895f">We can apply this to captures by using the opposing kingâ€™s position to represent the capture of that piece.</p><figure id="68458c78-37a6-41e4-83cb-5e18f300c938"><a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%207.png"><img src="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%207.png"/></a></figure><p id="632bb571-fbae-44a6-b428-474719a050b2"><a href="https://github.com/cthulahoops">Adam Kelly</a> noted how we can take this further by using our own kingâ€™s position. For castling, we simply replace the rookâ€™s position. Since castling is available only if the rook has not moved, we know that the rook would be at its original position.</p><figure id="09ba174f-e463-46f2-9d20-4cbfd03aaec5"><a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%208.png"><img src="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%208.png"/></a></figure><p id="2429d053-83d6-4d63-bef1-15534fc1bfb8">For en passant, we know that the pawn that just made the double move is at its home file and at a specific rank (4 for white or 5 for black). We similarly replace the pawnâ€™s position with our own kingâ€™s position.</p><figure id="572eb05c-1624-49d9-8b99-229dc27a9103"><a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%209.png"><img src="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%209.png"/></a></figure><p id="d9891164-8c06-46ab-9e38-3056f300cf02">By using this trick, we can store captures, castling availability and the en passant target for free!</p><figure id="a049dd50-0105-4408-9b1a-606ec82ee3cf"><p><span>ðŸŸ¡</span></p><p><em><mark>free!</mark></em> (for captures)
+ <em><mark>free!</mark></em> (for castling)
+ <em><mark>free!</mark></em> (for en passant)
+ 3 bits x 16 (for promotions)
= 48 bits / <strong>6 bytes</strong></p></figure><p id="fa3657ee-245b-4c9f-8d13-543634faeaca">Letâ€™s take a closer look at promotions.</p><p id="324af255-bbb5-489a-ac93-0fd8afec92cd">The second observation is that the ordering of promoted pawns can be made unique.</p><p id="b5300c9c-7848-4293-8685-47c3e2bb0773">In this illustrative example, one pawn is promoted to a queen and another to a rook. The top line on the right represents white pawn positions, while the bottom lines represent the promotion encoding (3 bits for each white pawn) <a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605.html">[3]</a>.</p><figure id="897bb330-6989-48d5-b6d4-5fdc3ed5b51e"><a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%2010.png"><img src="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%2010.png"/></a></figure><p id="860be3ac-98e4-4d3c-982b-b5f015d64374">Now letâ€™s do the following:</p><ol type="1" id="4f8fbbfe-1142-467c-a064-8fb0440b8572" start="1"><li>Represent non-promoted pawns by <code>0</code> and the promoted pawns by <code>1</code> to <code>4</code>.</li></ol><ol type="1" id="d5c835f1-41d0-44db-8f19-712024a6ab24" start="2"><li>Sort the representation in ascending order and reorder the positions accordingly <a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605.html">[4]</a>.</li></ol><figure id="dc39fee7-38f6-4e8d-9558-3e7c635450e9"><a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%2011.png"><img src="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605/Untitled%2011.png"/></a></figure><p id="dfe5cd79-a941-46cb-8827-c664f9a1791b">This gives us the string <code>00000034</code> to uniquely represent this specific set of promotions, without information loss.</p><p id="999d6161-7eb7-4ec8-8a2a-b50fd54a7e98">How many possible strings are there? Generating this by brute force, we end up with 495 distinct strings <a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605.html">[5]</a>. </p><pre id="701a63b6-224d-4ea3-b2c1-caa487ee14c5"><code>len(
    set(
        [
            tuple(sorted((a, b, c, d, e, f, g, h)))
            for a in [0, 1, 2, 3, 4]
            for b in [0, 1, 2, 3, 4]
            for c in [0, 1, 2, 3, 4]
            for d in [0, 1, 2, 3, 4]
            for e in [0, 1, 2, 3, 4]
            for f in [0, 1, 2, 3, 4]
            for g in [0, 1, 2, 3, 4]
            for h in [0, 1, 2, 3, 4]
        ]
    )
)</code></pre><p id="6415f740-cf42-4bba-a851-ce486f7d7611">This can be stored in <strong>9 bits</strong> for each side <a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Compressing%20chess%20positions%20for%20fun%20and%20profit%20df1fdb5364eb42fdac11eb23b25e9605.html">[6]</a>.</p><figure id="db0e1083-bfb5-4fa0-9abe-aee2c9bb4cb5"><p><span>ðŸŸ¢</span></p><p><em>free!</em> (for captures)
+ <em>free!</em> (for castling)
+ <em>free!</em> (for en passant)
+ <mark>9 bits x 2</mark> (for promotions)
= 18 bits / <strong>~2 bytes</strong></p></figure><p id="1557a776-d6ff-41aa-87fd-3c4c42b95fbc">We add this to the 24 bytes for positions and end up with a total of <strong>~26 bytes</strong>!</p><p id="1f13eb0c-706e-4235-8423-d5b2edb91aeb">Feel free to try this out on Replit <a href="https://replit.com/@savarin/bitpacker?v=1">here</a>! The code can be found on Github <a href="https://github.com/savarin/bitpacker">here</a>.</p><p id="16ff9a8a-4267-4e88-99e3-4c2e38285c7a">Chess encoding (and compression in general!) is a deep and fascinating topic. This <a href="https://lichess.org/blog/Wqa7GiAAAOIpBLoY/developer-update-275-improved-game-compression">post</a> discusses the use of <a href="https://en.wikipedia.org/wiki/Huffman_coding">Huffman coding</a> to efficiently store chess games.</p><p id="d78c008b-0d88-4313-bccf-f78da0f1809d">If this sounds like fun, you should apply to Recurse Center! The <a href="https://www.recurse.com/faq#:~:text=The%20next%20batch%20starts%20on%20Tuesday%2C%20January%203rd%2C%202023">next batch</a> starts on Jan 3 2023, with an <a href="https://www.recurse.com/events/rc-december-info-session">information session</a> on Dec 9 2022.</p><p id="c85cf8f1-8cc2-49e4-8699-516ce17f5d4f">If youâ€™re curious about my take, Iâ€™m reachable <a href="https://airtable.com/shrqMzRrrdIWkv0fg">here</a>. Other RC posts can be found <a href="https://www.ezzeriesa.com/index/Writing%20efa7772a3ae64a8193c7ef981ac619fc/Rewriting%20my%20toy%20blockchain%20in%20Rust%209a130f225666488491ba497004821fbb.html">here</a> and <a href="https://payments.posthaven.com">here</a>.</p><p id="0b4460c8-dbc6-4a54-8950-0151b7f65ae0"><strong>[1]</strong> The <a href="https://en.wikipedia.org/wiki/Forsyth%E2%80%93Edwards_Notation">Forsyth-Edwards Notation</a> stores the positions, active color, castling availability, target square, the half-move clock and full-move number.</p><p id="793a78f7-7a1b-49aa-84c1-5e65206bf354"><strong>[2]</strong> Since at most 1 pawn is available for en passant capture, we can actually make this more compact. We need 1 bit for whether or not itâ€™s available, plus 4 bits to represent 16 pawns, for a total of 5 bits.</p><p id="844401b3-9e80-432a-873f-8d7354f9991f"><strong>[3]</strong> We use <code>n</code>, <code>b</code>, <code>r</code> and <code>q</code> to represent the promotions to knight, bishop, rook and queen respectively. This is purposely chosen, as a contrast to the <code>0</code> - <code>4</code> representation that follows.</p><p id="27411817-cac5-48d6-ac84-0c3d3a7df391"><strong>[4]</strong> For en passant we need the pawn to remain on its home file. Hence we exclude the pawn from this step if it can be captured en passant. Captures can appear on any file.</p><p id="cc3f030f-552c-4c6a-9639-6605f71ef73e"><strong>[5]</strong> <a href="https://github.com/bzinberg">Ben Zinberg</a> uses a balls-and-urns argument to come up with 495.</p><blockquote id="2539d345-a58d-4608-899f-7cc734bdf420">For each string of 0s, 1s and 2s having length 3 in weakly ascending order as you describe, you can imagine writing the string on 5 blank spaces, where there is a â€˜dividerâ€™ space any time the digit changes. For example, the string <code>012</code> would be written <code>0 _ 1 _ 2</code> where theÂ <code>_</code>s are divider spaces. The stringÂ <code>000</code>Â would be written <code>0 0 0 _ _</code> with a string of zero 1s after the first divider and a string of zero 2s after the second divider.

The digits to write on the non-divider spaces are uniquely determined by where you place the dividers. Thus, the strings you describe are in one-to-one correspondence with choices of how to place the 2 dividers, and the number of ways to do that is theÂ <a href="https://en.wikipedia.org/wiki/Binomial_coefficient">binomial coefficient</a>Â <span data-token-index="0" contenteditable="false"><span></span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mn>5</mn><mn>2</mn></mfrac><mo fence="true">)</mo></mrow><mo stretchy="false">(</mo><mn>25</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\binom{5}{2}(25)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>(</span></span><span><span><span><span><span><span></span><span><span><span>2</span></span></span></span><span><span></span><span><span><span>5</span></span></span></span></span><span>â€‹</span></span><span><span><span></span></span></span></span></span><span><span>)</span></span></span><span>(</span><span>25</span><span>)</span></span></span></span></span><span>ï»¿</span></span>.

This argument generalizes to say, the number of weakly-ascending sequences of integers inÂ <span data-token-index="0" contenteditable="false"><span></span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{ 0, \ldots, k - 1 \}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>â€¦</span><span></span><span>,</span><span></span><span>k</span><span></span><span>âˆ’</span><span></span></span><span><span></span><span>1</span><span>}</span></span></span></span></span><span>ï»¿</span></span> having lengthÂ <em><span data-token-index="0" contenteditable="false"><span></span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>n</span></span></span></span></span><span>ï»¿</span></span></em>Â is equal to the number of ways to placeÂ <span data-token-index="0" contenteditable="false"><span></span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k - 1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>k</span><span></span><span>âˆ’</span><span></span></span><span><span></span><span>1</span></span></span></span></span><span>ï»¿</span></span>Â divider spaces amongÂ <span data-token-index="0" contenteditable="false"><span></span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>+</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n + k - 1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>n</span><span></span><span>+</span><span></span></span><span><span></span><span>k</span><span></span><span>âˆ’</span><span></span></span><span><span></span><span>1</span></span></span></span></span><span>ï»¿</span></span>Â blank spaces, which is equal toÂ <span data-token-index="0" contenteditable="false"><span></span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><mi>n</mi><mo>+</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></mfrac><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\binom{n + k - 1}{k - 1}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>(</span></span><span><span><span><span><span><span></span><span><span><span>k</span><span>âˆ’</span><span>1</span></span></span></span><span><span></span><span><span><span>n</span><span>+</span><span>k</span><span>âˆ’</span><span>1</span></span></span></span></span><span>â€‹</span></span><span><span><span></span></span></span></span></span><span><span>)</span></span></span></span></span></span></span><span>ï»¿</span></span>.</blockquote><p id="c197a41b-3bbc-400c-9941-3ff6b0837865"><strong>[6]</strong> With a limit of 8 bits for each side, we can fully track at most 4 promoted pawns. Alternatively we note that promotions always involve a capture; we can potentially reclaim 1 bit by convention of denoting captures either left-most or right-most.</p></div></div>
  </body>
</html>
