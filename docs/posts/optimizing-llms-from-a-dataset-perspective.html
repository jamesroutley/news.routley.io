<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sebastianraschka.com/blog/2023/optimizing-LLMs-dataset-perspective.html">Original</a>
    <h1>Optimizing LLMs from a Dataset Perspective</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div>
        




<div>
  

  <article>
    <p>This article focuses on improving the modeling performance of LLMs by finetuning them using carefully curated datasets. Specifically, this article highlights strategies that involve modifying, utilizing, or manipulating the datasets for instruction-based finetuning rather than altering the model architecture or training algorithms (the latter will be topics of a future article). This article will also explain how you can prepare your own datasets to finetune open-source LLMs.</p>

<p>Note that the <a href="https://llm-efficiency-challenge.github.io">NeurIPS LLM Efficiency Challenge</a> is currently underway, aiming to train a Large Language Model on a single GPU within a 24-hour period, which is super interesting for practitioners and researchers interested in LLM efficiency. The techniques discussed in this article have direct relevance to this competition, and we will delve into how these dataset-centric strategies could potentially be applied within the challenge setting. Additionally, the article will offer suggestions for new experiments you might consider trying.</p>

<p><a href="https://lightning.ai/pages/community/tutorial/optimizing-llms-from-a-dataset-perspective/"><strong>This article is a cross-post that originally appeared here on the Lightning AI Blog</strong></a>.</p>
      
    

<p>What is instruction-finetuning, and why should we care?</p>

<p>Instruction finetuning is a method used to improve the performance of language models like ChatGPT and <a href="https://www.google.com/url?q=https://arxiv.org/abs/2307.09288&amp;sa=D&amp;source=editors&amp;ust=1694778155820217&amp;usg=AOvVaw3DfjwSmu9UDiKXYfwwNURe">Llama-2-chat</a> by having the model generate outputs for a range of example inputs paired with desired outputs. It allows for more controlled and desired behavior of the model in specific applications or tasks. Also, it can enhance the reliability, specificity, and safety of AI systems in real-world use cases.</p>

<p><img src="https://sebastianraschka.com/images/blog/2023/optimizing-llms-dataset-perspective/image1.png" alt="img"/>
<em>Annotated figure from <a href="https://www.google.com/url?q=https://arxiv.org/abs/2203.02155&amp;sa=D&amp;source=editors&amp;ust=1694778155821067&amp;usg=AOvVaw0b9IRsqGEu2lM_iI5nMzZM">InstructGPT paper</a></em></p>

<p>Instruction finetuning uses a dataset consisting of instruction-response pairs to improve an LLM’s instruction-following capabilities. Such a dataset for instruction finetuning typically consists of three components:</p>

<ol>
  <li>Instruction text</li>
  <li>Input text (optional)</li>
  <li>Output text</li>
</ol>

<p>The example below lists two training examples, one without and one with an optional input text:</p>

<p><img src="https://sebastianraschka.com/images/blog/2023/optimizing-llms-dataset-perspective/image3.png" alt="img"/></p>

<p>LLMs are then finetuned on these instruction datasets via next-token prediction (similar to pretraining). The difference from pretraining is that the model sees the whole instruction and input text as a context before it’s tasked to carry out the next-token prediction to generate the output text in an autoregressive fashion, illustrated below.</p>

<p><img src="https://sebastianraschka.com/images/blog/2023/optimizing-llms-dataset-perspective/image2.png" alt="img"/></p>

<p>This above-mentioned process for finetuning an LLM to generate the desired output in an iterative, token-wise fashion is also referred to as supervised finetuning.</p>

<p>In practice, there is an additional optional finetuning stage following supervised finetuning, which uses additional preference data and ranking labels from human annotators who compare responses generated by LLMs. This process is also known as reinforcement learning with human feedback (RLHF), but it is out-of-scope for this article, which focuses on the instruction datasets themselves. (However, I have an optional article on RLHF <a href="https://magazine.sebastianraschka.com/p/llm-training-rlhf-and-its-alternatives">here</a> if you want to learn more.)</p>
      
    

<p>When finetuning LLMs, datasets for instruction finetuning can be sourced in multiple ways:</p>

<p><strong>1. Human-created:</strong> Expert annotators can provide explicit instructions and feedback, creating datasets for instruction finetuning. This is particularly useful for domain-specific tasks or for reducing particular biases or unwanted behaviors.</p>

<p><strong>2. LLM-generated:</strong> We can generate a vast amount of potential input-output pairs using an existing LLM (if the terms of service permit). These can then be refined or rated by humans for quality and then used to finetune a new LLM. This method is usually more efficient than the abovementioned human-created approach because an available LLM, such as GPT-4 (via the API interface), can generate a large number of potential examples in a short time.</p>

<p>The LLM finetuning pipeline using human-created or LLM-generated data is summarized in the recent and excellent <em><a href="https://arxiv.org/abs/2308.10792">Instruction Tuning for Large Language Models</a></em> survey:</p>

<p><img src="https://sebastianraschka.com/images/blog/2023/optimizing-llms-dataset-perspective/image5.png" alt="img"/>
<em>Figure from <a href="https://arxiv.org/abs/2308.10792">Instruction Tuning for Large Language Models</a> paper</em></p>

<p>Additionally, we can also potentially combine both human-created and LLM-generated instruction data to get the best of both worlds.</p>

<p>The upcoming sections will discuss LLM-generated and human-created datasets for instruction finetuning in more detail, including the recent research highlights.</p>
      
    

<p>Dataset labeling has been a bottleneck in machine learning ever since. As a human annotator, simple labeling tasks like categorizing an image as “cat” or “dog” are already considered laborious when it has to be done at scale.</p>

<p>Tasks requiring long-form text annotations can be even more time-consuming and challenging. So, a lot of effort has been devoted towards generating datasets for instruction finetuning automatically using existing LLMs.</p>



<p><strong>Self-Instruct</strong></p>

<p>One of the most prominent and widely used methods for LLM-generated datasets is <a href="https://arxiv.org/abs/2212.10560">Self-Instruct</a>.</p>

<p>So, how does it work? Briefly, it involves four stages:</p>

<ol>
  <li>Seed task pool with a set of human-written instructions (175 in this case) and sample instructions;</li>
  <li>Use a pretrained LLM (like GPT-3) to determine the task category;</li>
  <li>Given the new instruction, let a pretrained LLM generate the response;</li>
  <li>Collect, prune, and filter the responses before adding them to the task pool.</li>
</ol>

<p><img src="https://sebastianraschka.com/images/blog/2023/optimizing-llms-dataset-perspective/image4.jpg" alt="img"/></p>

<p>An early popular application of Self-Instruct was the <a href="https://github.com/gururise/AlpacaDataCleaned">Alpaca dataset</a>, which consists of 52k LLM-generated instruction-response pairs. Alpaca was used to create the first finetuning <a href="https://arxiv.org/abs/2302.13971">Llama v1</a> model earlier this year.</p>



<p><strong>Backtranslation</strong></p>

<p>Another interesting type of approach involves working backward from the responses and generating the corresponding instructions via LLMs.</p>

<p>In other words, rather than gathering datasets for instruction finetuning from human writers, it’s possible to employ an LLM to produce instruction-response pairs (also known as distillation).</p>

<p>In a paper titled <em><a href="https://arxiv.org/abs/2308.06259">Self-Alignment with Instruction Backtranslation</a></em>, researchers refined LLMs via “instruction backtranslation” and found that this method surpasses those trained on distillation datasets like Alpaca.</p>

<p><img src="https://sebastianraschka.com/images/blog/2023/optimizing-llms-dataset-perspective/image7.png" alt="img"/></p>



<p><strong>NeurIPS Efficiency Challenge Rules</strong></p>

<p>Note that the <a href="https://llm-efficiency-challenge.github.io">NeurIPS LLM Efficiency Challenge</a>, which is centered around training 1 LLM for 1 Day on 1 GPU, does not permit LLM-generated datasets.</p>

<p>So, in the next section, <em>High-Quality Datasets</em>, we will focus on human-generated instruction datasets that we can use as an alternative.</p>

<p>If you are interested in participating in the <a href="https://llm-efficiency-challenge.github.io">NeurIPS LLM Efficiency Challenge</a>, I’ve written a <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/neurips_challenge_quickstart.md">quick starter tutorial here</a>.</p>

<p><strong>A Note About LLM-generated Datasets and Imitation Models</strong></p>

<p>Before we jump into the discussion of human-generated datasets for instruction finetuning, I wanted to share a brief word of caution regarding LLM-generated datasets. Yes, generating datasets via LLMs may sound too good to be true, so it is important to evaluate LLMs finetuned on LLM-generated datasets extra carefully.</p>

<p>For instance, in a recent <em><a href="https://arxiv.org/abs/2305.15717">The False Promise of Imitating Proprietary LLMs</a></em> paper, researchers observed that crowd workers gave high ratings to LLMs trained on LLM-generated data. However, these so-called “imitation models” primarily replicated the style of the upstream LLMs they were trained on rather than their factual accuracy.</p>
      
    

<p>In the previous section, we discussed datasets generated by LLMs. Now, let’s switch gears and examine a high-quality, human-generated dataset, which is also allowed in the <a href="https://llm-efficiency-challenge.github.io">NeurIPS LLM Efficiency Challenge</a>.</p>

<p><strong>LIMA</strong></p>

<p><em><a href="https://arxiv.org/abs/2305.11206">The LIMA: Less Is More for Alignment</a></em> paper shows that quality trumps quantity when instruction finetuning datasets.</p>

<p>In this study, researchers carefully selected 1,000 instruction pairs to finetune the 65-billion-parameter Llama-v1 model, known as LIMA, using supervised finetuning.</p>

<p>Notably, other finetuned Llama models, such as Alpaca, were trained on a considerably larger dataset of 52,000 LLM-generated instruction pairs. In selected benchmarks, LIMA outperformed models that employed Reinforcement Learning with Human Feedback (RLHF) methods, including ChatGPT and GPT-3.5.</p>

<p><img src="https://sebastianraschka.com/images/blog/2023/optimizing-llms-dataset-perspective/image6.jpg" alt="img"/>
<em>Annotated figure from the <a href="https://arxiv.org/abs/2305.11206">LIMA paper</a></em></p>

<p>The next section will show you how to get started with open-source LLMs and finetune these models on LIMA.</p>
      
    

<p>This section explains how to finetune open-source LLMs on instruction datasets like LIMA using the <a href="https://github.com/Lightning-AI/lit-gpt">Lit-GPT repository</a>.</p>

<p>(Note that the <a href="https://llm-efficiency-challenge.github.io">NeurIPS LLM Efficiency Challenge</a> organizers cleared LIMA for the competition. The NeurIPS LLM Efficiency Challenge organizers also selected Lit-GPT as the starter kit since the code is relatively easy to use and customize, which is an essential prerequisite for exploring new research directions.)</p>

<p>As of this writing, the currently supported models in Lit-GPT are the following:</p>



<table>
  <thead>
    <tr>
      <th><strong>Model and usage</strong></th>
      <th><strong>Reference</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Meta AI <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/download_llama_2.md">Llama 2</a></td>
      <td><a href="https://arxiv.org/abs/2307.09288">Touvron et al. 2023</a></td>
    </tr>
    <tr>
      <td>Stability AI <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/download_freewilly_2.md">FreeWilly2</a></td>
      <td><a href="https://stability.ai/blog/stable-beluga-large-instruction-fine-tuned-models">Stability AI 2023</a></td>
    </tr>
    <tr>
      <td>Stability AI StableCode</td>
      <td><a href="https://stability.ai/blog/stablecode-llm-generative-ai-coding">Stability AI 2023</a></td>
    </tr>
    <tr>
      <td>TII UAE <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/download_falcon.md">Falcon</a></td>
      <td><a href="https://falconllm.tii.ae/">TII 2023</a></td>
    </tr>
    <tr>
      <td>OpenLM Research <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/download_openllama.md">OpenLLaMA</a></td>
      <td><a href="https://github.com/openlm-research/open_llama">Geng &amp; Liu 2023</a></td>
    </tr>
    <tr>
      <td>LMSYS <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/download_vicuna.md">Vicuna</a></td>
      <td><a href="https://lmsys.org/blog/2023-03-30-vicuna/">Li et al. 2023</a></td>
    </tr>
    <tr>
      <td>LMSYS <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/download_longchat.md">LongChat</a></td>
      <td><a href="https://lmsys.org/blog/2023-06-29-longchat/">LongChat Team 2023</a></td>
    </tr>
    <tr>
      <td>Together <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/download_redpajama_incite.md">RedPajama-INCITE</a></td>
      <td><a href="https://together.ai/blog/redpajama-models-v1">Together 2023</a></td>
    </tr>
    <tr>
      <td>EleutherAI <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/download_pythia.md">Pythia</a></td>
      <td><a href="https://arxiv.org/abs/2304.01373">Biderman et al. 2023</a></td>
    </tr>
    <tr>
      <td>StabilityAI <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/download_stablelm.md">StableLM</a></td>
      <td><a href="https://github.com/Stability-AI/StableLM">Stability AI 2023</a></td>
    </tr>
    <tr>
      <td>Platypus</td>
      <td><a href="https://arxiv.org/abs/2308.07317">Lee, Hunter, and Ruiz 2023</a></td>
    </tr>
    <tr>
      <td>NousResearch Nous-Hermes</td>
      <td><a href="https://huggingface.co/NousResearch">Org page</a></td>
    </tr>
    <tr>
      <td>Meta AI <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/download_code_llama.md">Code Llama</a></td>
      <td><a href="https://arxiv.org/abs/2308.12950">Rozière et al. 2023</a></td>
    </tr>
  </tbody>
</table>



<p>For this brief walkthrough, we will use the 7B parameter <a href="https://github.com/Lightning-AI/lit-gpt">Llama 2 base model</a> and finetune it on LIMA.</p>

<p>Assuming you have cloned the Lit-GPT repository, you can get started via the following three steps:</p>

<p>1) Download and prepare the model:</p>

<div><div><pre><code><span>export </span><span>HF_TOKEN</span><span>=</span>your_token

python scripts/download.py <span>\</span>
 <span>--repo_id</span> meta-llama/Llama-2-7b-hf
</code></pre></div></div>

<div><div><pre><code>python scripts/convert_hf_checkpoint.py <span>\</span>
 <span>--checkpoint_dir</span> meta-llama/Llama-2-7b-hf
</code></pre></div></div>

<p>2) Prepare the dataset:</p>

<div><div><pre><code>python scripts/prepare_lima.py <span>\</span>
 <span>--checkpoint_dir</span> checkpoints/meta-llama/Llama-2-7b-hf
</code></pre></div></div>

<p>3) Finetune the model using low-rank adaptation (LoRA):</p>

<div><div><pre><code>python finetune/lora.py <span>\</span>
 <span>--checkpoint_dir</span> checkpoints/meta-llama/Llama-2-7b-hf <span>\</span>
 <span>--data_dir</span> data/lima
</code></pre></div></div>

<p>Note that the –checkpoint_dir argument is required for preparing the dataset in step 2 because the dataset preparation is model-dependent. Different LLMs may use different tokenizers and special tokens, so it’s important to prepare the dataset accordingly.</p>

<p>I am skipping a detailed explanations of the LoRA finetuning procedure to keep this article focused on the dataset perspective. However, if you are interested in learning more, you can see my article <a href="https://lightning.ai/pages/community/finetuning-falcon-efficiently/">Finetuning Falcon LLMs More Efficiently With LoRA and Adapters</a>.</p>

<p>In addition, you may also find my <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/neurips_challenge_quickstart.md">NeurIPS 2023 LLM Efficiency Challenge Quickstart Guide</a> article helpful, where I walk through the setup, finetuning, and model evaluation step by step.</p>

<hr/>

<p><strong>Tip</strong></p>

<p>According<a href="https://llm-efficiency-challenge.github.io/question"> to the official competition rules</a>, the maximum context length used for the evaluation is 2,048 tokens. Hence, I recommend preparing the dataset with a maximum length of 2,048 tokens:</p>

<div><div><pre><code>python scripts/prepare_lima.py <span>\</span>
  <span>--checkpoint_dir</span> checkpoints/meta-llama/Llama-2-7b-hf <span>\</span>
  <span>--max_seq_length</span> 2048
</code></pre></div></div>

<p>Alternatively you can edit the  <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/finetune/lora.py%23L37">finetune/lora.py</a><a href="https://github.com/Lightning-AI/lit-gpt/blob/main/finetune/lora.py%23L37"> file</a> and change <code>override_max_seq_length = None</code> to <code>override_max_seq_length = 2048</code> to reduce the GPU memory requirements.</p>

<p>In addition, I also suggest modifying the set max_iter setting and change it to <code>max_iter = 1000</code> to finetune for ~1 pass over the LIMA dataset, which consists of 1k training examples.</p>

<p><img src="https://sebastianraschka.com/images/blog/2023/optimizing-llms-dataset-perspective/image9.png" alt="img"/></p><hr/>



<p>For reference, finetuning a 7B parameter model on 52k instruction pairs, such as in Alpaca, takes about 1 hour on an A100 GPU when using LoRA with default settings. Note that LIMA is 50x smaller than Alpaca, so finetuning will only take a few minutes.</p>

<p><img src="https://sebastianraschka.com/images/blog/2023/optimizing-llms-dataset-perspective/image8.png" alt="img"/></p>

<p>Title: Finetuning a 7B model on 52k data points via Finetuning Falcon LLMs More Efficiently With LoRA and Adapters (<a href="https://lightning.ai/pages/community/finetuning-falcon-efficiently/">https://lightning.ai/pages/community/finetuning-falcon-efficiently/</a>)</p>
      
    

<p>As of this writing, there are currently multiple finetuning datasets supported in <a href="https://github.com/Lightning-AI/lit-gpt">Lit-GPT</a>.</p>

<p><img src="https://sebastianraschka.com/images/blog/2023/optimizing-llms-dataset-perspective/image12.png" alt="img"/></p>

<p>The <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/prepare_dataset.md">Dolly</a> and <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/prepare_dataset.md%23lima">LIMA</a> datasets are human-generated and should thus be fine for use in the <a href="https://llm-efficiency-challenge.github.io">NeurIPS LLM Efficiency Challenge</a>.</p>

<p>Additionally, if you are interested in using different datasets to customize LLMs for your projects, the next section will briefly explain how this works.</p>
      
    

<p>In addition to the existing datasets mentioned above, you might be interested in adding new datasets or using your own datasets to finetune custom open-source LLMs.</p>

<p>There are two main ways to prepare a dataset for the LLMs in Lit-GPT:</p>

<ol>
  <li>Using the scripts/prepare_csv.py script to read an instruction dataset from a CSV file.</li>
  <li>Creating a custom scripts/prepare_dataset.py script similar to LIMA, which we used earlier.</li>
</ol>

<p>The easiest way to prepare a new dataset is to read it from a CSV file using the  scripts/prepare_csv.py script in Lit-GPT. All you need is a CSV file that has the three column headers as shown below:</p>

<p><img src="https://sebastianraschka.com/images/blog/2023/optimizing-llms-dataset-perspective/image10.png" alt="img"/></p>

<p>Assuming you exported this dataset as MyDataset.csv, you can then prepare and finetune the model as follows:</p>

<p>1) Prepare the dataset:</p>

<div><div><pre><code>python scripts/prepare_csv.py <span>\</span>
  <span>--csv_dir</span> MyDataset.csv <span>\</span>
  <span>--checkpoint_dir</span> checkpoints/meta-llama/Llama-2-7b-hf
</code></pre></div></div>

<p>2) Finetune the model using low-rank adaptation (LoRA):</p>

<div><div><pre><code>python finetune/lora.py <span>\</span>
  <span>--data_dir</span> /data/csv <span>\</span>
  <span>--checkpoint_dir</span> checkpoints/meta-llama/Llama-2-7b-hf
</code></pre></div></div>

<p>There are additional options for determining the random seed or train/split available that you can access via</p>

<div><div><pre><code>python scripts/prepare_csv.py <span>--help</span>
</code></pre></div></div>

<p>If you are interested in the second option, creating a prepare_dataset.py script similar to LIMA, I added an explanation to the <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/prepare_dataset.md%23preparing-custom-datasets-for-instruction-finetuning">Lit-GPT documentation here</a>.</p>
      
    

<p>The previous section covered how to prepare custom datasets for open-source LLMs in Lit-GPT. If you don’t have your own dataset you want to experiment with but want to experiment with existing datasets (for example, the NeurIPS LLM Efficiency Challenge is restricted to publicly available datasets), here are a few pointers for datasets to explore.</p>

<p>With the <a href="https://llm-efficiency-challenge.github.io">NeurIPS LLM Efficiency Challenge</a> in mind, the list focuses on human-generated English datasets, not LLM-generated datasets.</p>



<p><strong><a href="https://huggingface.co/datasets/OpenAssistant/oasst1">Open Assistant</a></strong> (multi-lingual) is a collection of assistant-like conversations created and annotated by humans. It contains 161,443 messages in 35 languages, enriched with 461,292 quality evaluations, resulting in more than 10,000 comprehensively annotated conversation trees. This dataset results from a global crowdsourcing initiative that engaged over 13,500 volunteers.</p>



<p><strong><a href="https://arxiv.org/abs/2104.08773">Natural Instructions</a></strong> is an English instruction dataset handcrafted with 193K entries, spanning 61 unique NLP tasks.</p>



<p><strong><a href="https://arxiv.org/abs/2110.08207">P3 (Public Pool of Prompts)</a></strong> is an instruction finetuning dataset constructed using 170 English NLP datasets and 2,052 English prompts. Prompts, sometimes named task templates, map a data instance in a conventional NLP task (e.g., question answering, text classification) to a natural language input-output pair.</p>



<p><strong><a href="https://arxiv.org/abs/2301.13688">Flan 2021</a></strong> is an English instruction dataset compilation created by converting 62 popular NLP benchmarks (including SNLI, AG News, and others) into pairs of language inputs and outputs.</p>
      
    

<p>Now that we have covered the why and how related to instruction-finetuning, what interesting research directions can we explore to boost the performance of open-source LLMS?</p>



<p><strong>Merging Datasets</strong></p>

<p>Besides the P3 and Flan 2021 datasets mentioned above, I have not seen attempts to create larger datasets by combining datasets from multiple sources. For instance, it could make sense to experiment with combinations of LIMA and Dolly, and so forth.</p>



<p><strong>Dataset Ordering</strong></p>

<p>Following up on the dataset merging idea mentioned above, it could be interesting to explore the role of visiting different data points in different orders (for example, sorted or shuffled by the type of instruction). Besides the pretraining experiments done in the <a href="https://arxiv.org/abs/2304.01373">Pythia paper</a>, I have not seen any studies on dataset ordering in the context of instruction finetuning.</p>



<p><strong>Multiple-Epoch Training</strong></p>

<p>Due to the large dataset size requirements, LLMs are usually pretrained for less than one epoch, which means that they don’t revisit data points multiple times. While computational costs are one reason for this, another is that LLMs can be prone to overfitting. Nonetheless, with many overfitting-reduction techniques at our disposal, studying multi-epoch training in the context of LLMs would be interesting.</p>

<p>For instance, it’s possible to train LLMs on a small dataset like LIMA in a few minutes. Would it make sense to iterate over the dataset multiple times?</p>



<p><strong>Automatic Quality-filtering</strong></p>

<p>Does it make sense to adopt dataset filtering as a default?</p>

<p>Related to the LIMA study discussed earlier, the <em><a href="https://arxiv.org/abs/2307.08701">AlpaGasus: Training A Better Alpaca with Fewer Data</a></em> paper also emphasizes that a larger dataset isn’t necessarily advantageous for finetuning LLMs. In the <em>AlpaGasus</em> study, the researchers employed ChatGPT to pinpoint low-quality instruction-response pairs in the original 52,000-instance Alpaca dataset. They discovered that reducing this to just 9,000 high-quality pairs actually enhanced performance when training Llama-v1 LLMs with 7 billion and 13 billion parameters.</p>

<p><img src="https://sebastianraschka.com/images/blog/2023/optimizing-llms-dataset-perspective/image11.jpg" alt="img"/>
<em>Annotated figure from the <a href="https://arxiv.org/abs/2307.08701">AlpaGasus paper</a></em></p>

<p>However, as mentioned earlier, the <a href="https://llm-efficiency-challenge.github.io">NeurIPS LLM Efficiency Challenge</a> does not permit LLM-generated datasets. So, this Alpaca-based Alpagasus dataset would not be useful for this competition.</p>

<p>A viable alternative to AlpaGasus might be to use an LLM to filter human-generated (instead of LLM-generated) datasets. However, I’m uncertain if using LLM-based dataset filtering is allowed, so it would be important to confirm with the organizers on their Discord channel before using such datasets in the competition.</p>

<p>The upcoming sections will explain how to use datasets such as LIMA for training the latest open-source LLMs. Additionally, I will also highlight interesting research directions to try in the <a href="https://llm-efficiency-challenge.github.io">NeurIPS LLM Efficiency Challenge</a>.</p>
      
    

<p>This article covered instruction finetuning and explained the advantages of LLM-generated and human-generated datasets. We also went over a quick tutorial explaining how to finetune open-source LLMs with different datasets and how to use our own datasets to create custom LLMs. Compared to proprietary APIs and services, such custom LLMs can help leverage specific datasets at your company, improve LLMs on certain use cases, and give you full privacy control.</p>

<p>If you have any questions, please don’t hesitate to reach out:</p>

<ul>
  <li>
    <p>If you have any suggestions, feedback, or problems with Lit-GPT, please consider filing an <a href="https://github.com/Lightning-AI/lit-gpt/issues">Issue on GitHub</a> if you think it is a bug.</p>
  </li>
  <li>
    <p>Furthermore, <a href="https://github.com/Lightning-AI/lit-gpt/pulls">Lit-GPT pull requests</a> with improvements and implementations of new techniques would be very welcome!</p>
  </li>
</ul>

<p>If you are participating in the <a href="https://llm-efficiency-challenge.github.io">NeurIPS LLM Efficiency Challenge</a>, I hope you find this competition as useful and exciting as I do.</p>

<ul>
  <li>
    <p>I suggest starting with the <a href="https://github.com/Lightning-AI/lit-gpt/blob/main/tutorials/neurips_challenge_quickstart.md">Quick Starter Guide I compiled here</a>.</p>
  </li>
  <li>
    <p>For questions about whether a particular dataset is allowed in the competition, I recommend double-checking with the organizers via their <a href="https://discord.gg/XJwQ5ddMK7">Discord channel</a>.</p>
  </li>
  <li>
    <p>For Lit-GPT-related questions about the challenge, my colleagues at Lightning AI also maintain a <a href="https://discord.gg/MWAEvnC5fU">Discord channel here</a>.</p>
  </li>
</ul>

<p>Happy learning, coding, and experimenting!</p>

    </article>


  <!--<strong>Have feedback on this post? I would love to hear it. Let me know and send me a <a href="https://twitter.com/intent/tweet?text=. @rasbt http://sebastianraschka.com/blog/2023/optimizing-LLMs-dataset-perspective.html">tweet</a> or <a href="http://sebastianraschka.com/email.html">email</a>.</strong>-->

</div>
      </div>
    </div></div>
  </body>
</html>
