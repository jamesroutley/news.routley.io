<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.tomrenner.com/blog/2022-06-09/cull-your-dependencies">Original</a>
    <h1>Cull your dependencies</h1>
    
    <div id="readability-page-1" class="page"><div id="blog-content"><p>Anyone  writing code professionally in December 2021 will remember the <a href="https://www.wired.com/story/log4j-flaw-hacking-internet/">&#34;fun&#34;</a> <a href="https://www.bbc.com/news/technology-59669297">of</a> <a href="https://www.abc.net.au/news/2021-12-15/log4j-cyber-security-flaw-which-has-online-experts-worried/100703290">the</a> <a href="https://www.wsj.com/articles/hackers-exploit-log4j-flaw-at-belgian-defense-ministry-11640020439?mod=article_inline">Log4J</a> <a href="https://www.computerweekly.com/news/252510860/What-is-Log4Shell-and-why-are-we-panicking-about-it">vulnerability</a>. For those that weren&#39;t - this was a critical security error that allowed attackers to run any code they wanted on your servers. The root cause was a logging library, Log4J, that is used by most projects that are writting in Java. </p><p>It&#39;s usually used to write code something like:</p>
<blockquote>
<p><code>log.info(&#34;Process completed successfully&#34;);</code></p></blockquote>
<p>which will then appear in your logs, allowing you to track your application&#39;s behaviour. Pretty innocuous stuff.</p><p>My company was one of the affected by the <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228">vulnerability</a> (among countless others), and in looking into it I noticed something.</p><h2>By the numbers</h2><p>The underlying Log4J library is 168,000 lines of code.</p><p>Now, most commercial applications import tens if not hundreds of such packages, which at a conservative estimate gets us to 1M lines of code in the imported packages. This is roughly the size of an entire <a href="https://en.wikipedia.org/wiki/Source_lines_of_code#Example">operating system</a>.</p><p>In <a href="https://www.oreilly.com/library/view/code-complete-2nd/0735619670/">Code Complete</a> Steve McConnell estimates that commercial software has roughly 15-50 errors per thousand lines of code.</p><p>For our hypotheical application with 1M LoC in its dependences, this suggests we&#39;d have around 15,000 bugs in imported code alone. Code that you will likely never see, read, or often even think about.</p><h2>Assumptions developers make</h2><p>An interesting thing about developers is that we are lazy, and prefer to write as few lines of code as possible, sticking rigidly to the principle of &#34;not reinventing the wheel&#34;.</p><p>This encourages us to import packages to solve common problems, rather than write a utility class or method ourselves. However, this habit often results in the addition of thousands of lines to your dependencies, to save writing 20 lines yourself.</p><p>We also invariably assume that code provided via official means (maven, npm, pip, whatever) will be of higher quality. After all, it&#39;s come from the package manager, it&#39;s got to be good, right?</p><p>In reality, packages are often maintained by a single person or a small team of volunteers, and of course in general there are no quality checks required for packages added to package managers. Log4J has been in production  for nearly 20 years, and practically every version of it has contained the critical issue that kept many of us busy patching it in December.</p><p>Just because it&#39;s been available to lots of people and &#34;battle tested&#34; in production systems  does not mean that it is secure.</p><p>These two assumptions together cause a poisonous mix whereby developers with the best of intentions end up adding in more and more external code of unknown quality to an application, in the naive pursuit of rapid development and efficient code re-use.</p><h2>Process problems</h2><p>Once a package has been added, it becomes part of your &#34;assumed standard&#34; -- people will assume that using it safe, and that to do so is best practice, so it will <a href="https://humanwhocodes.com/blog/2015/05/14/the-bunny-theory-of-code/">proliferate</a>. And as usage proliferates, so the dependency will solidify and calcify, and until very rapidly it will prove impossible to remove without a major engineering effort.</p><p>Minimising dependencies is not something that&#39;s (currently) widely valued in our industry, and putting in the refactoring effort to remove a dependency almost never happens (the only exception I&#39;ve seen is the removal of Log4J, which is relatively easy to replace, and was only done after a truly massive incident).</p><p>And so dependencies will only grow over the lifetime of a piece of software, and vulnerabilities will silently accumulate in the application.</p><p>Additionally, even if you remove a method from being used in code, tooling to remove the package it came from from your project&#39;s imports (via pom.xml, package.json, etc.) is pretty poor. It can be hard to determine whether you need a package any more at all, or whether it provides other functionality still used in another corner of the codebase. As a result, stale packages often hang around as bloat even after they&#39;re not needed, just waiting to be reintroduced by an unsuspecting developer.</p><h2>Proposals</h2>
<ol>
<li>As a rule, do not add dependencies to your codebase.</li>
<li>When a new package is added to the codebase, demand full justifications about why it is required, and record the reason for the addition in a log within the repository. This will both make it easier to remove the dependency later if it is not needed, and also ensure that it continues to be used only for its intended purpose.</li>
<li>Don&#39;t import multiple packages for &#34;utility methods&#34; - use one and explicitly agree on using it as a standard within your team. This decision should again be recorded in a dependencies log within the repository.</li>
</ol>
<p>I will be following these within my team, and in projects I&#39;m involved in.  Do you agree with them? <a href="https://twitter.com/intent/tweet?text=@TRenner_&amp;url=https%3A%2F%2Fwww.tomrenner.com%2Fblog%2F2022-06-09%2Fcull-your-dependencies">Let me know</a> if you do, or if there are other techniques you follow to prevent dependency proliferation in your work.</p></div></div>
  </body>
</html>
