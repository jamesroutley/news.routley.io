<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.tonysm.com/when-objects-are-not-enough/">Original</a>
    <h1>When objects are not enough (2021)</h1>
    
    <div id="readability-page-1" class="page"><div>
        <p>I&#39;ve been looking up resources on the roots of Object-Oriented Programming - a.k.a. OOP. This journey started because there is a trend in the Laravel community of using Actions, and the saying goes as <em>that&#39;s what &#34;Real OOP&#34; is about</em>. I had some doubts about it and instead of asking around, I decided to look for references from the Smalltalk days. That&#39;s when I found the book <a href="https://www.amazon.com/Smalltalk-Objects-Design-Chamond-Liu/dp/1583484906/">Smalltalk, Objects, and Design</a>. I&#39;m having such a good time researching this that I wanted to share some of my findings so far.</p>

<p>This <em>Actions</em> pattern states that logic should be wrapped in <a href="https://stitcher.io/blog/laravel-beyond-crud-03-actions">Action classes</a>. The idea isn&#39;t new as other communities have been advocating for &#34;<a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">Clean Architecture</a>&#34; where each &#34;Use Case&#34; (or <em>Interactor</em>) would be its own class. It&#39;s similar. But is it really what OOP is about?</p>

<p>If you&#39;re interested in a TL;DR version of this article, here it is:</p>

<ul>
<li>Smalltalk was one of the first Object-Oriented Programming Languages out there. It&#39;s where ideas like inheritance and message-passing came from (or at least where they got popular, from what I understand);</li>
<li>According to Alan Kay, who coined the term &#34;Object-Oriented Programming&#34;, objects are not enough. They don&#39;t give us an <em>Architecture</em>. Objects are all about the interactions between them and, for large scale systems, you need to be able to break down your applications in modules in a way that allows you to turn off a module, replace it, and turn it back on without bringing the entire application down. That&#39;s where he mentions the idea of encapsulating &#34;messages&#34; in classes where each instance would be a message in our systems, backing up the idea of having &#34;Action&#34; classes or &#34;Interactors&#34; in the <em>Clean Architecture</em> approach;</li>
</ul>

<p>Continue reading if this sparks your interest.</p>

<h2>What Are Objects?</h2>

<p>An object has state and operations combined. At the time where it was coined, applications were built with data structures and procedures. By combining state and operations in a single &#34;entity&#34; called an &#34;object&#34; you give this entity an anthropomorphic meaning. You can think of objects as &#34;little beings&#34;. They know some information (state) and they can respond to messages sent to them.</p>

<p>Such messages usually take the form of method calls and this is the idea that got propagated in other languages such as Java or C++. Joe Armstrong, one of the co-designers of Erlang, <a href="https://elixirforum.com/t/learning-elixir-frst-impressions-plz-dont-kill-me/16424/52">wrote in the Elixir</a> forum that, in Smalltalk, messages &#34;were not real messages but disguised synchronous function calls&#34;, and this <em>mistake</em> was also repeated in other languages, according to him.</p>

<p>One common misconception seems to be on thinking of objects as types. Types (or <a href="https://citeseerx.ist.psu.edu/viewdoc/download;jsessionid=1BC6456DEBB197D0E99CE43E9ED0AFE9?doi=10.1.1.136.3043&amp;rep=rep1&amp;type=pdf">Abstract Data Types</a>, which are &#34;synonyms&#34; - or close enough - for the purpose of this writing) aren&#39;t objects. As Kay points out in <a href="https://www.youtube.com/watch?v=QjJaFG63Hlo">this seminar</a>, the way objects are used these days is a bit confusing because it&#39;s intertwined with another idea from the &#39;60s: data abstraction (ADTs). They are similar in some ways, particularly in implementation, but its intent is different.</p>

<p>The intent of ADT, according to Kay, was to take a system in Pascal/FORTRAN that&#39;s starting to become difficult to change (where the knowledge has been spread out in procedures) and wrap envelopes around data structures, invoking operations by means of procedures in order to get it to be a bit more representation independent.</p>

<p>This envelope of procedures is then wrapped around the data structure in an effort to protect it. But then this new structure that was created is now treated as a new data structure in the system. The result is that the programs don&#39;t get small. One of the results of OOP is that programs tend to get smaller.</p>

<p>To Kay, Java and C++ are not good examples of &#34;real OOP&#34;. Barbara Liskov <a href="https://www.youtube.com/watch?v=_jTc1BTFdIo">points out</a> that Java was a combination of ADT with the inheritance ideas from Smalltalk. To be honest, I can&#39;t articulate this difference between ADTs and Objects in OOP quite well. Maybe because I first learned OOP in Java.</p>

<p>One more fun fact about the early days: they were not sure if they were going to be able to implement polymorphism in strongly-typed languages (where the idea of ADT came from), since the compiler would link the types explicitly and nobody wanted to rewrite sorting functions for each different type, for example (Liskov mentions this in the already mentioned <a href="https://www.youtube.com/watch?v=_jTc1BTFdIo">talk</a>). As I see it, that&#39;s the problem interfaces/protocols and generics solve. In a way, I think of these things as ways to achieve late-binding in strongly-typed languages (and I also think this is true for some design patterns).</p>

<p>Kay doesn&#39;t seem to appreciate what this mix of ADT and OOP did to the original idea. <a href="https://www.youtube.com/watch?v=fhOHn9TClXY">He seems to agree with Armstrong</a>. To Kay, Object-Oriented is about three things:</p>

<ul>
<li>Messaging (or message-passing);</li>
<li>Local retention and protection and hiding of state-process (or encapsulation); and</li>
<li>Extreme late-binding.</li>
</ul>

<p>These are the traits of OOP, or &#34;Real OOP&#34; - as Kay calls it. The term got &#34;hijacked&#34; and somehow turned into, as Armstrong puts it, &#34;organizing code into classes and methods&#34;. That&#39;s not what &#34;Real OOP&#34; is about.</p>

<p>Objects tend to be larger things than mere data structures. They tend to be entire components. Active machines that fit together with other active machines to make a new kind of structure.</p>

<p>Kay has an exercise of adding a negation to &#34;core beliefs&#34; in our field to try and identify what these things are really about. Take &#34;big data&#34;, for instance. If we add a &#34;not&#34; to it, it says &#34;NOT big data&#34;, so if it&#39;s NOT about big data, what would it be about? Well, &#34;big meaning&#34;, as Kay points out.</p>

<p>If we do that with &#34;Object-Oriented Programming&#34; and add a &#34;not&#34; to it, we get &#34;NOT Object-Oriented Programming&#34;, and if it&#39;s not about object-orientation, what is it about? Well, it seems to be <em>Messages</em>. That seems to be the core idea of OOP. Even though they were promoting inheritance a lot in the <a href="https://www.youtube.com/watch?v=Ao9W93OxQ7U">Smalltalk days</a>. And yes, messaging was a big part of it too, but since it was practically &#34;disguised synchronous function calls&#34;, they didn&#39;t get the main stage when the idea got mainstream.</p>

<p>Let&#39;s use a banking software as an example. We&#39;re going to model an Account. An account needs to keep track of its balance. And it has to be able to handle withdraw, as long as the amount requested is less than the current balance amount. It also has to be able to handle deposits. The image below is a visual representation of what an Account object could be. Well, at least a simplification of that.</p>

<p><img src="https://www.tonysm.com/assets/images/oop/01-objects.png" alt="Object"/></p>

<p>There are some guidelines on how to identify objects and methods in requirements: &#34;nouns&#34; are good candidates for &#34;objects&#34;, while &#34;verbs&#34; are good candidates for &#34;methods&#34;. That&#39;s only a guideline, which means they are &#34;good defaults&#34;, but not hard rules.</p>

<h2>Reification</h2>

<p>OOP is really good at modeling abstract concepts. Things that are not tangible, but we can pretend they exist in the reality we&#39;re trying to build inside our software. They are objects (or &#34;little beings&#34;). The term <a href="https://en.wikipedia.org/wiki/Reification_(computer_science)">Reification</a> means to treat immaterial things as they were material. We use that all the time when we&#39;re writing software, especially in Object-Oriented Software. Our Account model is one example of reification.</p>

<p>It happens to fit the &#34;noun&#34; and &#34;verb&#34; guideline, because that makes sense in our context so far. Here&#39;s a simple example of a deposit:</p>

<pre><code><!-- Syntax highlighted by torchlight.dev --><p><span>class</span><span> </span><span>Account</span><span> </span><span>extends</span><span> </span><span>Model</span></p><p><span>{</span></p><p><span>  </span><span>public</span><span> </span><span>function</span><span> </span><span>deposit</span><span>(</span><span>int</span><span> </span><span>$</span><span>amountInCents</span><span>)</span></p><p><span>  </span><span>{</span></p><p><span>    </span><span>DB</span><span>::</span><span>transaction</span><span>(</span><span>function</span><span> </span><span>()</span><span> </span><span>{</span></p><p><span>      </span><span>$this-&gt;</span><span>increment</span><span>(</span><span>&#39;</span><span>balance_cents</span><span>&#39;</span><span>,</span><span> </span><span>$</span><span>amountInCents</span><span>);</span></p><p><span>    </span><span>});</span></p><p><span>  </span><span>}</span></p><p><span>}</span></p></code></pre>

<details>

<summary><small>Notes on Active Record</small></summary>

<p><small><i>The code examples are done in a Laravel context. I&#39;m lucky enough to happen to own the databases I work with, so I don&#39;t consider that an outer layer of my apps (see <a href="https://martinfowler.com/articles/badri-hexagonal/">this</a>), which allows me to fully use the tools at hand, such as the Eloquent ORM - an Active Record implementation for the non-Laravel folks reading this. That&#39;s why I have database calls in the model. Not all classes in my domain model are Active Record models, though (see <a href="https://www.youtube.com/watch?v=hkmrfjex7jI&amp;list=PL9wALaIpe0Py6E_oHCgTrD6FvFETwJLlx&amp;index=4">this</a>). I recommend experimenting with different approaches so you can make up your own mind about these things. I&#39;m just showing an alternative that I happen to like.</i></small></p>

</details>

<p>But that&#39;s not the end of the story. Sometimes, you need to break these &#34;rules&#34;, depending on your use case. For instance, you might have to keep track of every transaction happening to an Account. You could try to model this around the relevant domain methods, maybe using events and listeners. That could work. However let&#39;s say you have to be able to schedule a transfer or an invoice payment, or even cancel these if they are not due yet. If you listen closely, you can almost hear the system asking for something.</p>

<p>Knowing only its balance isn&#39;t that useful when you think of an Account. You have 100k dollars on it, sure, but how did it get there? These are the kind of things we should be able to know, don&#39;t you think? Also, if you model everything around Account, it tends to grow to a point of becoming <a href="https://en.wikipedia.org/wiki/God_object">God objects</a>.</p>

<p>This is where people turn to other approaches like <a href="https://martinfowler.com/eaaDev/EventSourcing.html">Event Sourcing</a>. And that could be the answer, as the primary example for it is a <em>banking system</em>. But there is an Object-Oriented way to model this problem.</p>

<p>The trick is realizing our context has changed. Now, we need to focus on the transactions happening to the account (only &#34;withdraw&#34; and &#34;deposit&#34; for now). They deserve the main stage in our application. We will promote these operations to objects, calling them <em>transactions</em>. And those objects can have their own state. The public API of the account wouldn&#39;t change, only its internals.</p>

<p>Instead of simply manipulating the balance state, the Account object will create instances of each transaction and also keep track of them internally. But that&#39;s not all. Each transaction has a different effect on the account&#39;s balance. A deposit will increment it, while a withdraw will decrement it. This serves as an example for another important concept of Object-Oriented Programming: Polymorphism.</p>

<h2>Polymorphism</h2>

<p>Polymorphism means: multiple forms. The idea is that I can build different implementations that conform to the same API (interface, protocol, or duck test). This fits exactly our definition of the different transactions. They are all transactions, but with different application on the Account. When modeling this with ActiveRecord models, we could have the following:</p>

<ul>
<li>An Account (AR model) holds a sorted list of all transactions</li>
<li>A Transaction would be an AR model and would have a polymorphic relationship called &#34;transactionable&#34;</li>
<li>Each different transaction would conform to this &#34;transactionable&#34; behavior</li>
</ul>

<p>The trick would be to have the Account model never touching its balance directly. The balance field would almost serve as a cached value of the result of every applied Transaction of that account. The Account would then pass itself down to the Transaction expecting the transaction to update the balance. The Transaction, internally, would then <em>delegate</em> that task to each transactionable and they could update the balance. It sounds more complicated than it actually is, here&#39;s the deposit example:</p>

<pre><code><!-- Syntax highlighted by torchlight.dev --><p><span>use</span><span> </span><span>Illuminate</span><span>\</span><span>Database</span><span>\</span><span>Eloquent</span><span>\</span><span>Model</span><span>;</span></p><p><span>class</span><span> </span><span>Account</span><span> </span><span>extends</span><span> </span><span>Model</span></p><p><span>{</span></p><p><span>  </span><span>public</span><span> </span><span>function</span><span> </span><span>transactions</span><span>()</span></p><p><span>  </span><span>{</span></p><p><span>    </span><span>return</span><span> </span><span>$this-&gt;</span><span>hasMany</span><span>(</span><span>Transaction</span><span>::</span><span>class</span><span>)-&gt;</span><span>latest</span><span>();</span></p><p><span>  </span><span>}</span></p><p><span>  </span><span>public</span><span> </span><span>function</span><span> </span><span>deposit</span><span>(</span><span>int</span><span> </span><span>$</span><span>amountInCents</span><span>)</span></p><p><span>  </span><span>{</span></p><p><span>    </span><span>DB</span><span>::</span><span>transaction</span><span>(</span><span>function</span><span> </span><span>()</span><span> </span><span>use</span><span> </span><span>($</span><span>amountInCents</span><span>)</span><span> </span><span>{</span></p><p><span>      </span><span>$</span><span>transaction </span><span>=</span><span> </span><span>$this-&gt;</span><span>transactions</span><span>()-&gt;</span><span>create</span><span>([</span></p><p><span>        </span><span>&#39;</span><span>transactionable</span><span>&#39;</span><span> </span><span>=&gt;</span><span> </span><span>Deposit</span><span>::</span><span>create</span><span>([</span></p><p><span>          </span><span>&#39;</span><span>amount_cents</span><span>&#39;</span><span> </span><span>=&gt;</span><span> </span><span>$</span><span>amountInCents</span><span>,</span></p><p><span>        </span><span>]),</span></p><p><span>      </span><span>]);</span></p><p><span>      </span><span>$</span><span>transaction</span><span>-&gt;</span><span>apply</span><span>($this);</span></p><p><span>    </span><span>});</span></p><p><span>  </span><span>}</span></p><p><span>}</span></p><p><span>class</span><span> </span><span>Transaction</span><span> </span><span>extends</span><span> </span><span>Model</span></p><p><span>{</span></p><p><span>  </span><span>public</span><span> </span><span>function</span><span> </span><span>transactionable</span><span>()</span></p><p><span>  </span><span>{</span></p><p><span>    </span><span>return</span><span> </span><span>$this-&gt;</span><span>morphTo</span><span>();</span></p><p><span>  </span><span>}</span></p><p><span>  </span><span>public</span><span> </span><span>function</span><span> </span><span>setTransactionableAttribute</span><span>($</span><span>transactionable</span><span>)</span></p><p><span>  </span><span>{</span></p><p><span>    </span><span>$this-&gt;</span><span>transactionable</span><span>()-&gt;</span><span>associate</span><span>($</span><span>transactionable</span><span>);</span></p><p><span>  </span><span>}</span></p><p><span>  </span><span>public</span><span> </span><span>function</span><span> </span><span>apply</span><span>(</span><span>Account</span><span> </span><span>$</span><span>account</span><span>)</span></p><p><span>  </span><span>{</span></p><p><span>    </span><span>$this-&gt;</span><span>transactionable</span><span>-&gt;</span><span>apply</span><span>($</span><span>account</span><span>);</span></p><p><span>  </span><span>}</span></p><p><span>}</span></p><p><span>class</span><span> </span><span>Deposit</span><span> </span><span>extends</span><span> </span><span>Model</span></p><p><span>{</span></p><p><span>  </span><span>public</span><span> </span><span>function</span><span> </span><span>apply</span><span>(</span><span>Account</span><span> </span><span>$</span><span>account</span><span>)</span></p><p><span>  </span><span>{</span></p><p><span>    </span><span>$</span><span>account</span><span>-&gt;</span><span>increment</span><span>(</span><span>&#39;</span><span>balance_cents</span><span>&#39;</span><span>,</span><span> </span><span>$this-&gt;</span><span>amount_cents</span><span>);</span></p><p><span>  </span><span>}</span></p><p><span>}</span></p></code></pre>

<p>As you can see, the public API for the <code>$account-&gt;deposit(100_00)</code> behavior didn&#39;t change.</p>

<p>This same idea can be ported to other domains as well. For instance, if you have a document model in a collaborative text editing context, you cannot rely on having a single <code>content</code> text field holding the current state of the Document&#39;s content. You would need to apply a similar idea and keep track of each <a href="https://www.youtube.com/watch?v=lmjMC2FRF-A">Operation Transformation</a> happening to the document instead.</p>

<p>Another example could be an PaaS app. You have provisioned servers and you can deploy on them. With only this short description one could model it as <code>$server-&gt;deploy(string $commitHash)</code>. But what if the user can cancel a deployment? Or rollback to a previous deployment? That change in requirements should trigger your curiosity to at least experiment promoting the deploy to its own Deployment object or something similar.</p>

<p>I first saw this idea presented by Adam Wathan on his <a href="https://adamwathan.me/2015/09/03/pushing-polymorphism-to-the-database/">Pushing Polymorphism to the Database</a> article and conference talk. And I also found references in the book <a href="https://www.amazon.com/Smalltalk-Objects-Design-Chamond-Liu/dp/1583484906/">Smalltalk, Objects, and Design</a>, as well as on a recent <a href="https://github.com/rails/rails/pull/39341">Rails PR</a> done by DHH introducing <em>delegated types</em>. I find it really powerful and quite versatile, but I don&#39;t see that many people talking about it, so that&#39;s why I found it relevant to mention here.</p>

<p>Before we wrap up this Reification tangent, there&#39;s one more example I wanted to mention. When you have two entities collaborating on a behavior and the logic doesn&#39;t quite fit one or the other. Or the behavior could perfectly fit either of these entities. For instance, let&#39;s say you have a Student and a Course model and you want to keep track of their presence and grade (assuming we only have a single presence valeu that can either be <code>present | absent</code> and single grade value ranging from <code>0</code> to <code>10</code>). Where do we store this data?</p>

<p>It should feel like it doesn&#39;t belong in the Course, nor in the Student records. It <em>almost</em> feels like the solution to this problem could be to give up on OOP entirely and use a function that you could pass both objects to. Or we could maybe store that value as a pivot field in a joint table. Instead, if we reify this problem, we could promote the Student/Course <em>relationship</em> to an Object called <em>StudentCourse</em>. That would make the perfect place to store the grade and presence. These are examples of reification.</p>

<h2>Abstractions as Simplifications</h2>

<p>I&#39;ve <a href="https://madewithlove.com/blog/software-engineering/abstractions-as-simplifications/">talked about this idea before</a>. I have a <em>feeling</em> that some people see abstractions as convoluted architectural decisions and as a synonym for &#34;many layers&#34;, but that&#39;s not what I understand of abstractions. They are really simplifications.</p>

<p>Alan Kay has a <a href="https://www.youtube.com/watch?v=NdSD07U5uBs">good presentation on the subject</a> and he states that we achieve simplicity when we find a more sophisticated building block for our theories. A model that better fits our domain and things &#34;just make sense&#34;.</p>

<p>The example of Kepler and the elliptical orbit theory that Kay uses is really good (read more about it <a href="https://earthobservatory.nasa.gov/features/OrbitsHistory/page2.php">here</a>). At that time, there was a religious belief that planets moved in &#34;perfect circles&#34;, where the Sun was orbiting the Earth while other objects were orbiting the Sun.</p>

<p><img src="https://www.tonysm.com/assets/images/oop/02-orbits-1.png" alt="&#34;Perfect Circle&#34; Orbits"/></p>

<p>

<small>

Source: NASA&#39;s Earth Observatory (<a href="https://earthobservatory.nasa.gov/features/OrbitsHistory/page2.php">link</a>)

</small>

</p>

<p>That didn&#39;t quite make sense because objects seemed to be in different positions depending on the day (among other problems), so they built a different theory where the orbits were still &#34;perfect circles&#34; but the objects were not going round, but instead moving in a way that at a macro level also built another &#34;perfect circle&#34;, something like this:</p>

<p><img src="https://www.tonysm.com/assets/images/oop/03-orbits-2.png" alt="&#34;Perfect Cicles&#34; more complex orbits"/></p>

<p>

<small>

Source: Wikipedia page on &#34;Deferent and epicycle&#34; (<a href="https://en.wikipedia.org/wiki/Deferent_and_epicycle">link</a>)

</small>

</p>

<p><a href="https://en.wikipedia.org/wiki/Kepler%27s_laws_of_planetary_motion">Kepler had this belief too</a>, but after struggling to explain some of the evidences about the movements of objects, he then abandoned the idea of &#34;perfect circle&#34; and suggested that the orbits were actually elliptical and around the Sun - not the Earth, simplifying the model quite a lot (<a href="https://earthobservatory.nasa.gov/features/OrbitsHistory/page2.php">read this</a> to know more about this).</p>

<p><img src="https://www.tonysm.com/assets/images/oop/04-orbits-3.png" alt="Kepler&#39;s elliptical orbits"/></p>

<p>

<small>

Source: Wikipedia page on &#34;Kepler&#39;s laws of planetary motion&#34; (<a href="https://en.wikipedia.org/wiki/Kepler%27s_laws_of_planetary_motion">link</a>)

</small>

</p>

<p>His observation was one of the pillars of Newton&#39;s law of <a href="https://en.wikipedia.org/wiki/Newton%27s_law_of_universal_gravitation">universal gravitation</a>. Which later led to Einstein&#39;s <a href="https://en.wikipedia.org/wiki/Theory_of_relativity">theory of relativity.</a></p>

<p>The point is: the right level of abstraction often simplifies our models. Things &#34;just makes sense&#34; in a way that it&#39;s easier to understand than the alternatives. And it&#39;s an iterative process.</p>

<h2>Objects In The Large</h2>

<p>So far we&#39;ve talked about <em>promoting</em> methods to objects. But that is not quite the same as having Actions or UseCases as classes, right? That&#39;s more about having domain models at the right level of abstraction.</p>

<p>In the seminar, Kay also states that objects are not enough when working on large scale systems. That&#39;s mainly because of the complexity of the systems. We want to be able to shut down, replace, and bring up parts of the system - or &#34;modules&#34;, without affecting the entire system. Or, say, you could benefit from implementing a specific part of your system in another language because of performance reasons or a more accurate floating-point calculation.</p>

<p>The problem here is that we are trying to shield the messages from the outside World (our protocol). Even with all the protections that OOP provides (such as encapsulation), it doesn&#39;t guarantee that you have a good architecture.</p>

<p>Kay even mentions that there were 2 phases when learning Smalltalk and OOP:</p>

<ul>
<li>On the first phase you&#39;re delighted with it. You think it&#39;s the silver bullet you&#39;ve always been looking for;</li>
<li>The second phase is delusional, because you see first hand that Smalltalk doesn&#39;t scale.</li>
</ul>

<p>One way to make OOP work on such large scale systems is to create a class for the &#34;goals&#34; we want to guarantee in the application. It looks like a type in a typed language, but it&#39;s not a data structure. The focus should be on the goal, not on the type. Kay uses an example of a &#34;Print&#34; class, where each instance of this class is a message (instead of method calls in the object). These look like what we see as Actions or Use Cases these days.</p>

<p>See, in Smalltalk, <em>everything is an object</em>. They take this very seriously. Even <em>messages</em> are objects internally. The difference between a message and a function call is that the message contains the receiver. In IBM Smalltalk, for instance, they even have different classes for messages with and without the receiver (look for &#34;Message and DirectedMessage&#34; in the <a href="https://www.ibm.com/support/pages/system/files/support/swg/swgdocs.nsf/0/f443d51d7cc38f5685256ab8004f1a23/$FILE/stpr55.pdf">manual</a>). So when we send a message to the object, we&#39;re essentially telling the <em>runtime</em> to do a method dispatch on the receiver of that message. You can see that as the <em>default</em> goal of a message. What Kay seems to be suggesting is that <strong>we can create our own goals</strong> for our own systems. We&#39;ll explore this in a bit.</p>

<p>Another problem of OOP Kay describes is that we tend to worry too much about the state our objects hold and neglect the control flow (who sends the message to whom). That ends up becoming a mess. An Object sends a message to another Object, which sends a message to a bunch of other Objects, and those send messages to even more objects. Good luck trying to understand this system.</p>

<p><img src="https://www.tonysm.com/assets/images/oop/05-oop-messages-as-methods.png" alt="Messages as methods"/></p>

<p>Kay suggests what resembles a Pub/Sub approach. They were exploring a more <em>declarative</em> approach in Smalltalk. Instead of sending messages directly to each other, Objects would declare to the system which messages they are interested in (subscribing). Messages would then &#34;broadcast&#34; to the system (publishing). If you have done any UI work, this should feel familiar to you, because it looks like <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventListener">event listeners in JavaScript</a>.</p>

<p><img src="https://www.tonysm.com/assets/images/oop/06-oop-message-broadcasting.png" alt="Message Broadcasting"/></p>

<p>This declarative aspect is fascinating, and it&#39;s present in some Functional Programming languages too (if you want to see where the ideas OOP blends with FP, watch this talk by Anjana Vakil called &#34;<a href="https://www.youtube.com/watch?v=qMdxExJCD5s">Oops! OOP&#39;s not what I thought</a>&#34;).</p>

<h3>Messages as Objects</h3>

<p>Let&#39;s explore what Kay suggests in the Seminar for a second: the idea of implementing our own goals in the system.</p>

<p>In our example, we could have a <em>Deposit</em> action in our application. It could be totally independent of the outside World (transport mechanisms - <a href="https://martinfowler.com/articles/badri-hexagonal/">I treat the database as an &#34;inside&#34; part of my apps</a>), something like:</p>

<pre><code><!-- Syntax highlighted by torchlight.dev --><p><span>namespace</span><span> </span><span>App</span><span>\</span><span>Actions</span><span>;</span></p><p><span>use</span><span> </span><span>App</span><span>\</span><span>Models</span><span>\</span><span>Account</span><span>;</span></p><p><span>use</span><span> </span><span>App</span><span>\</span><span>Models</span><span>\</span><span>Transactions</span><span>\</span><span>Deposit</span><span> </span><span>as</span><span> DepositModel</span><span>;</span></p><p><span>use</span><span> </span><span>Illuminate</span><span>\</span><span>Support</span><span>\</span><span>Facades</span><span>\</span><span>DB</span><span>;</span></p><p><span>class</span><span> </span><span>Deposit</span></p><p><span>{</span></p><p><span>  </span><span>public</span><span> </span><span>function</span><span> </span><span>handle</span><span>(</span><span>Account</span><span> </span><span>$</span><span>account</span><span>,</span><span> </span><span>int</span><span> </span><span>$</span><span>amountInCents</span><span>):</span><span> </span><span>void</span></p><p><span>  </span><span>{</span></p><p><span>    </span><span>DB</span><span>::</span><span>transaction</span><span>(</span><span>function</span><span> </span><span>()</span><span> </span><span>use</span><span> </span><span>($</span><span>account</span><span>,</span><span> </span><span>$</span><span>amountInCents</span><span>)</span><span> </span><span>{</span></p><p><span>      </span><span>$</span><span>transaction </span><span>=</span><span> </span><span>$</span><span>account</span><span>-&gt;</span><span>transactions</span><span>()-&gt;</span><span>create</span><span>([</span></p><p><span>        </span><span>&#39;</span><span>transactionable</span><span>&#39;</span><span> </span><span>=&gt;</span><span> </span><span>DepositModel</span><span>::</span><span>create</span><span>([</span></p><p><span>          </span><span>&#39;</span><span>amount_cents</span><span>&#39;</span><span> </span><span>=&gt;</span><span> </span><span>$</span><span>amountInCents</span><span>,</span></p><p><span>        </span><span>]),</span></p><p><span>      </span><span>]);</span></p><p><span>      </span><span>$</span><span>transaction</span><span>-&gt;</span><span>apply</span><span>($</span><span>account</span><span>);</span></p><p><span>    </span><span>});</span></p><p><span>  </span><span>}</span></p><p><span>}</span></p></code></pre>

<p>With this in place, our Account model doesn&#39;t need the deposit method anymore. This is the decision I have mixed feelings about, to be honest. Maybe it&#39;s fine since we promoted the Deposit <em>message</em> to an object as well? However, we could also implement a Facade method in the Account that would delegate to this action:</p>

<pre><code><!-- Syntax highlighted by torchlight.dev --><p><span>use</span><span> </span><span>App</span><span>\</span><span>Actions</span><span>\</span><span>Deposit</span><span> </span><span>as</span><span> DepositAction</span><span>;</span></p><p><span>class</span><span> </span><span>Account</span><span> </span><span>extends</span><span> </span><span>Model</span></p><p><span>{</span></p><p><span>  </span><span>public</span><span> </span><span>function</span><span> </span><span>deposit</span><span>(</span><span>int</span><span> </span><span>$</span><span>amountInCents</span><span>)</span></p><p><span>  </span><span>{</span></p><p><span>    </span><span>(</span><span>new</span><span> </span><span>DepositAction</span><span>())-&gt;</span><span>handle</span><span>($this,</span><span> </span><span>$</span><span>amountInCents</span><span>);</span></p><p><span>  </span><span>}</span></p><p><span>}</span></p></code></pre>

<p>This way we would keep the behavior separate in its own object, and still maintain an easy to consume API on the Account model. That&#39;s what I feel more comfortable with these days.</p>

<p><img src="https://www.tonysm.com/assets/images/oop/07-facade-method.png" alt="Facade Method"/></p>

<p>One &#34;downside&#34; of this approach is that every dependency of the Deposit message would have to be part of the method signature of the Facade method as well. Not a big deal, and most of the time it makes sense. Say you&#39;re modelling a <code>PayInvoice</code> action, you would most certainly need to pass a <em>PaymentProvider</em> dependency to the <code>$invoice-&gt;pay($provider, $amount)</code> facade method (or a factory).</p>

<p>Also, we could use Laravel&#39;s Job abstraction here, as jobs can be both synchronous or asynchronous. This way, we would benefit from that aspect as well (dispatching a background job as a &#34;message&#34; to do the task asynchronously).</p>

<h2>Conclusion</h2>

<p>My intent with this article is mainly to share and hear back from other people what they think of this all. I&#39;m not trying to convince you of anything. I&#39;m making peace with this idea of having actions for behavior (as messages) myself. It sometimes feels like &#34;procedures&#34; where we&#39;re invoking logic by name. I&#39;m not sure if I would use it for every bit of logic in my applications, but I think I like it when combined with Facade methods in the models.</p>

<p>I also found some cool design patterns that I don&#39;t see being referenced a lot. I&#39;ll blog about them soon.</p>

<p>Let me know what you think about this. Either <a href="mailto:tonysm@hey.com">tonysm@hey.com</a> to me, <a href="https://twitter.com/tonysmdev">tweet</a>, or write a response article and share it with me.</p>

<p>P.S.: I only now found this great talk from Anjana Vakil called &#34;<a href="https://www.youtube.com/watch?v=Pg3UeB-5FdA">Programming Across Paradigms</a>&#34; which I highly recommend.</p>

<p>P.S. 2: Some images here were created using <a href="http://excalidraw.com/">Excalidraw</a></p>

<p>P.S. 3: As I was reading the book &#34;Smalltalk Best Practice Patterns&#34; I found out this was a known pattern in the Smalltalk days called <em>Method Object</em>. Kent Beck even states there that he was not going to include the pattern in the book, but it was <em>really</em> helpful once so he added it. He mentions this is useful usually in the &#34;core&#34; of the app when you need to interact with a bunch of objects and have temporary variables around. Another reference that suggests this should not be used for everything.</p>

<h2>Criticism on OOP</h2>

<p>While I was reading the book <a href="https://www.amazon.com/Smalltalk-Objects-Design-Chamond-Liu/dp/1583484906/">Smalltalk, Objects, and Design</a> I found out that Dijkstra doesn&#39;t seem to like OOP (see this <a href="https://www.quora.com/Why-did-Dijkstra-say-that-%E2%80%9CObject-oriented-programming-is-an-exceptionally-bad-idea-which-could-only-have-originated-in-California-%E2%80%9D">quora question and responses</a>). <a href="https://www.cs.utexas.edu/~EWD/transcriptions/EWD10xx/EWD1036.html">He advocated against the use of metaphors and analogies in software</a> (referenced, but I haven&#39;t read it fully myself), and in favor of a more &#34;formal&#34; and mathematical way of building software (in terms of formal thinking), as he coined the term &#34;structured programming&#34;. But the book also mentions there is <a href="https://www.amazon.com/Essay-Psychology-Invention-Mathematical-Field-ebook/dp/B005ZD77EY/ref=sr_1_1?dchild=1&amp;keywords=An+Essay+on+the+Psychology+of+Invention+in+the+Mathematical+Field&amp;qid=1613517885&amp;sr=8-1">research on invention and creativity</a> (referenced, but I haven&#39;t read it myself) that suggests that imagery fuels the creative process, not formal thinking. I found this all very entertaining to research.</p>

<h2>Relevant References</h2>

<ul>
<li>Alan Kay&#39;s Seminar on OOP (<a href="https://www.youtube.com/watch?v=QjJaFG63Hlo">YouTube</a>)</li>
<li>Barbara Liskov TEDxMIT talk: How Data Abstraction changed Computing forever (<a href="https://www.youtube.com/watch?v=_jTc1BTFdIo">YouTube</a>)</li>
<li>Smalltalk, Objects, and Design (<a href="https://www.amazon.com/Smalltalk-Objects-Design-Chamond-Liu/dp/1583484906">Book</a>)</li>
<li>Laravel Beyond CRUD: Actions (<a href="https://stitcher.io/blog/laravel-beyond-crud-03-actions">Blog post</a>)</li>
<li>A Conversation with Badri Janakiraman about Hexagonal Rails (<a href="https://martinfowler.com/articles/badri-hexagonal/">Video</a>)</li>
<li>The Clean Architecture (<a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">Blog post</a>)</li>
<li>Alan Kay&#39;s 2015 talk: Alan Kay, 2015: Power of Simplicity (<a href="https://www.youtube.com/watch?v=NdSD07U5uBs">YouTube</a>)</li>
<li>Joe Armstrong&#39;s (RIP) message in the Elixir Forum (<a href="https://elixirforum.com/t/learning-elixir-frst-impressions-plz-dont-kill-me/16424/52">Link</a>)</li>
<li>Joe Armstrong interviews Alan Kay (<a href="https://www.youtube.com/watch?v=fhOHn9TClXY">YouTube</a>)</li>
<li>Adam Wathan&#39;s &#34;Pushing Polymorphism to the Database&#34; (<a href="https://adamwathan.me/2015/09/03/pushing-polymorphism-to-the-database/">Blog post</a> and <a href="https://adamwathan.me/2015/09/02/chasing-perfect-at-laracon-eu/">Talk</a>)</li>
<li>DHH&#39;s Rails Pull Request Introducing Delegated Types (<a href="https://github.com/rails/rails/pull/39341">Link</a>)</li>
<li>Anjana Vakil talk called &#34;Oops! OOP&#39;s not what I thought&#34; (<a href="https://www.youtube.com/watch?v=qMdxExJCD5s">YouTube</a>)</li>
<li>Anjana Vakil talk called &#34;Programming Across Paradigms&#34; (<a href="https://www.youtube.com/watch?v=Pg3UeB-5FdA">YouTube</a>)</li>
</ul>
    </div></div>
  </body>
</html>
