<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/tdewolff/argp">Original</a>
    <h1>argp: GNU-style command line argument parser for Go</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Command line argument parser following the GNU standard.</p>
<div data-snippet-clipboard-copy-content="./test -vo out.png --size 256 input.txt"><pre><code>./test -vo out.png --size 256 input.txt
</code></pre></div>
<p dir="auto">with the following features:</p>
<ul dir="auto">
<li>build-in help (<code>-h</code> and <code>--help</code>) message</li>
<li>scan arguments into struct fields with configuration in tags</li>
<li>scan into composite field types (arrays, slices, structs)</li>
<li>allow for nested sub commands</li>
</ul>
<p dir="auto">GNU command line argument rules:</p>
<ul dir="auto">
<li>arguments are options when they begin with a hyphen <code>-</code></li>
<li>multiple options can be combined: <code>-abc</code> is the same as <code>-a -b -c</code></li>
<li>long options start with two hyphens: <code>--abc</code> is one option</li>
<li>option names are alphanumeric characters</li>
<li>options can have a value: <code>-a 1</code> means that <code>a</code> has value <code>1</code></li>
<li>option values can be separated by a space, equal sign, or nothing: <code>-a1 -a=1 -a 1</code> are all equal</li>
<li>options and non-options can be interleaved</li>
<li>the argument <code>--</code> terminates all options so that all following arguments are treated as non-options</li>
<li>a single <code>-</code> argument is a non-option usually used to mean standard in or out streams</li>
<li>options may be specified multiple times, only the last one determines its value</li>
<li>options can have multiple values: <code>-a 1 2 3</code> means that <code>a</code> is an array/slice/struct of three numbers of value <code>[1,2,3]</code></li>
</ul>
<p dir="auto"><em>See also <a href="https://github.com/tdewolff/prompt">github.com/tdewolff/prompt</a> for a command line prompter.</em></p>

<p dir="auto">Make sure you have <a href="https://git-scm.com/" rel="nofollow">Git</a> and <a href="https://golang.org/dl/" rel="nofollow">Go</a> (1.22 or higher) installed, run</p>
<div data-snippet-clipboard-copy-content="mkdir Project
cd Project
go mod init
go get -u github.com/tdewolff/argp"><pre><code>mkdir Project
cd Project
go mod init
go get -u github.com/tdewolff/argp
</code></pre></div>
<p dir="auto">Then add the following import</p>
<div dir="auto" data-snippet-clipboard-copy-content="import (
    &#34;github.com/tdewolff/argp&#34;
)"><pre><span>import</span> (
    <span>&#34;github.com/tdewolff/argp&#34;</span>
)</pre></div>


<p dir="auto">A regular command with short and long options.
See <a href="https://renschler.github.io/tdewolff/argp/blob/master/cmd/test/main.go"><code>cmd/test/main.go</code></a>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="package main

import &#34;github.com/tdewolff/argp&#34;

func main() {
    var verbose int
    var input string
    var output string
    var files []string
    size := 512 // default value

    cmd := argp.New(&#34;CLI tool description&#34;)
    cmd.AddOpt(argp.Count{&amp;verbose}, &#34;v&#34;, &#34;verbose&#34;, &#34;Increase verbosity, eg. -vvv&#34;)
    cmd.AddOpt(&amp;output, &#34;o&#34;, &#34;output&#34;, &#34;Output file name&#34;)
    cmd.AddOpt(&amp;size, &#34;&#34;, &#34;size&#34;, &#34;Image size&#34;)
    cmd.AddArg(&amp;input, &#34;input&#34;, &#34;Input file name&#34;)
    cmd.AddRest(&amp;files, &#34;files&#34;, &#34;Additional files&#34;)
    cmd.Parse()

    // ...
}"><pre><span>package</span> main

<span>import</span> <span>&#34;github.com/tdewolff/argp&#34;</span>

<span>func</span> <span>main</span>() {
    <span>var</span> <span>verbose</span> <span>int</span>
    <span>var</span> <span>input</span> <span>string</span>
    <span>var</span> <span>output</span> <span>string</span>
    <span>var</span> <span>files</span> []<span>string</span>
    <span>size</span> <span>:=</span> <span>512</span> <span>// default value</span>

    <span>cmd</span> <span>:=</span> <span>argp</span>.<span>New</span>(<span>&#34;CLI tool description&#34;</span>)
    <span>cmd</span>.<span>AddOpt</span>(argp.<span>Count</span>{<span>&amp;</span><span>verbose</span>}, <span>&#34;v&#34;</span>, <span>&#34;verbose&#34;</span>, <span>&#34;Increase verbosity, eg. -vvv&#34;</span>)
    <span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>output</span>, <span>&#34;o&#34;</span>, <span>&#34;output&#34;</span>, <span>&#34;Output file name&#34;</span>)
    <span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>size</span>, <span>&#34;&#34;</span>, <span>&#34;size&#34;</span>, <span>&#34;Image size&#34;</span>)
    <span>cmd</span>.<span>AddArg</span>(<span>&amp;</span><span>input</span>, <span>&#34;input&#34;</span>, <span>&#34;Input file name&#34;</span>)
    <span>cmd</span>.<span>AddRest</span>(<span>&amp;</span><span>files</span>, <span>&#34;files&#34;</span>, <span>&#34;Additional files&#34;</span>)
    <span>cmd</span>.<span>Parse</span>()

    <span>// ...</span>
}</pre></div>
<p dir="auto">with help output</p>
<div data-snippet-clipboard-copy-content="Usage: test [options] input files...

Options:
  -h, --help          Help
  -o, --output string Output file name
      --size=512 int  Image size
  -v, --verbose int   Increase verbosity, eg. -vvv

Arguments:
  input     Input file name
  files     Additional files"><pre><code>Usage: test [options] input files...

Options:
  -h, --help          Help
  -o, --output string Output file name
      --size=512 int  Image size
  -v, --verbose int   Increase verbosity, eg. -vvv

Arguments:
  input     Input file name
  files     Additional files
</code></pre></div>

<p dir="auto">Example with sub commands using a main command for when no sub command is used, and a sub command named &#34;cmd&#34;. For the main command we can also use <code>New</code> and <code>AddOpt</code> instead and process the command after <code>argp.Parse()</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="package main

import &#34;github.com/tdewolff/argp&#34;

func main() {
    cmd := argp.NewCmd(&amp;Main{}, &#34;CLI tool description&#34;)
    cmd.AddCmd(&amp;Command{}, &#34;cmd&#34;, &#34;Sub command&#34;)
    cmd.Parse()
}

type Main struct {
    Version bool `short:&#34;v&#34;`
}

func (cmd *Main) Run() error {
    // ...
}

type Command struct {
    Verbose bool `short:&#34;v&#34; name:&#34;&#34;`
    Output string `short:&#34;o&#34; desc:&#34;Output file name&#34;`
    Size int `default:&#34;512&#34; desc:&#34;Image size&#34;`
}

func (cmd *Command) Run() error {
    // ...
}"><pre><span>package</span> main

<span>import</span> <span>&#34;github.com/tdewolff/argp&#34;</span>

<span>func</span> <span>main</span>() {
    <span>cmd</span> <span>:=</span> <span>argp</span>.<span>NewCmd</span>(<span>&amp;</span><span>Main</span>{}, <span>&#34;CLI tool description&#34;</span>)
    <span>cmd</span>.<span>AddCmd</span>(<span>&amp;</span><span>Command</span>{}, <span>&#34;cmd&#34;</span>, <span>&#34;Sub command&#34;</span>)
    <span>cmd</span>.<span>Parse</span>()
}

<span>type</span> <span>Main</span> <span>struct</span> {
    <span>Version</span> <span>bool</span> <span>`short:&#34;v&#34;`</span>
}

<span>func</span> (<span>cmd</span> <span>*</span><span>Main</span>) <span>Run</span>() <span>error</span> {
    <span>// ...</span>
}

<span>type</span> <span>Command</span> <span>struct</span> {
    <span>Verbose</span> <span>bool</span> <span>`short:&#34;v&#34; name:&#34;&#34;`</span>
    <span>Output</span> <span>string</span> <span>`short:&#34;o&#34; desc:&#34;Output file name&#34;`</span>
    <span>Size</span> <span>int</span> <span>`default:&#34;512&#34; desc:&#34;Image size&#34;`</span>
}

<span>func</span> (<span>cmd</span> <span>*</span><span>Command</span>) <span>Run</span>() <span>error</span> {
    <span>// ...</span>
}</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="var input string
cmd.AddArg(&amp;input, &#34;input&#34;, &#34;Input file name&#34;)

var files []string
cmd.AddRest(&amp;files, &#34;files&#34;, &#34;Additional input files&#34;)"><pre><span>var</span> <span>input</span> <span>string</span>
<span>cmd</span>.<span>AddArg</span>(<span>&amp;</span><span>input</span>, <span>&#34;input&#34;</span>, <span>&#34;Input file name&#34;</span>)

<span>var</span> <span>files</span> []<span>string</span>
<span>cmd</span>.<span>AddRest</span>(<span>&amp;</span><span>files</span>, <span>&#34;files&#34;</span>, <span>&#34;Additional input files&#34;</span>)</pre></div>

<p dir="auto">Basic types</p>
<div dir="auto" data-snippet-clipboard-copy-content="var v string = &#34;default&#34;
cmd.AddOpt(&amp;v, &#34;v&#34;, &#34;var&#34;, &#34;description&#34;)

var v bool = true
cmd.AddOpt(&amp;v, &#34;v&#34;, &#34;var&#34;, &#34;description&#34;)

var v int = 42 // also: int8, int16, int32, int64
cmd.AddOpt(&amp;v, &#34;v&#34;, &#34;var&#34;, &#34;description&#34;)

var v uint = 42 // also: uint8, uint16, uint32, uint64
cmd.AddOpt(&amp;v, &#34;v&#34;, &#34;var&#34;, &#34;description&#34;)

var v float64 = 4.2 // also: float32
cmd.AddOpt(&amp;v, &#34;v&#34;, &#34;var&#34;, &#34;description&#34;)"><pre><span>var</span> <span>v</span> <span>string</span> <span>=</span> <span>&#34;default&#34;</span>
<span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>v</span>, <span>&#34;v&#34;</span>, <span>&#34;var&#34;</span>, <span>&#34;description&#34;</span>)

<span>var</span> <span>v</span> <span>bool</span> <span>=</span> <span>true</span>
<span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>v</span>, <span>&#34;v&#34;</span>, <span>&#34;var&#34;</span>, <span>&#34;description&#34;</span>)

<span>var</span> <span>v</span> <span>int</span> <span>=</span> <span>42</span> <span>// also: int8, int16, int32, int64</span>
<span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>v</span>, <span>&#34;v&#34;</span>, <span>&#34;var&#34;</span>, <span>&#34;description&#34;</span>)

<span>var</span> <span>v</span> <span>uint</span> <span>=</span> <span>42</span> <span>// also: uint8, uint16, uint32, uint64</span>
<span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>v</span>, <span>&#34;v&#34;</span>, <span>&#34;var&#34;</span>, <span>&#34;description&#34;</span>)

<span>var</span> <span>v</span> <span>float64</span> <span>=</span> <span>4.2</span> <span>// also: float32</span>
<span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>v</span>, <span>&#34;v&#34;</span>, <span>&#34;var&#34;</span>, <span>&#34;description&#34;</span>)</pre></div>
<p dir="auto">Composite types</p>
<div dir="auto" data-snippet-clipboard-copy-content="v := [2]int{4, 2} // element can be any valid basic or composite type
cmd.AddOpt(&amp;v, &#34;v&#34;, &#34;var&#34;, &#34;description&#34;)
// --var [4 2]  =&gt;  [2]int{4, 2}
// or: --var 4,2  =&gt;  [2]int{4, 2}

v := []int{4, 2, 1} // element can be any valid basic or composite type
cmd.AddOpt(&amp;v, &#34;v&#34;, &#34;var&#34;, &#34;description&#34;)
// --var [4 2 1]  =&gt;  []int{4, 2, 1}
// or: --var 4,2,1  =&gt;  []int{4, 2, 1}

v := map[int]string{1:&#34;one&#34;, 2:&#34;two&#34;} // key and value can be any valid basic or composite type
cmd.AddOpt(&amp;v, &#34;v&#34;, &#34;var&#34;, &#34;description&#34;)
// --var {1:one 2:two}  =&gt;  map[int]string{1:&#34;one&#34;, 2:&#34;two&#34;}

v := struct { // fields can be any valid basic or composite type
    S string
    I int
    B [2]bool
}{&#34;string&#34;, 42, [2]bool{0, 1}}
cmd.AddOpt(&amp;v, &#34;v&#34;, &#34;var&#34;, &#34;description&#34;)
// --var {string 42 [0 1]}  =&gt;  struct{S string, I int, B [2]bool}{&#34;string&#34;, 42, false, true}"><pre><span>v</span> <span>:=</span> [<span>2</span>]<span>int</span>{<span>4</span>, <span>2</span>} <span>// element can be any valid basic or composite type</span>
<span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>v</span>, <span>&#34;v&#34;</span>, <span>&#34;var&#34;</span>, <span>&#34;description&#34;</span>)
<span>// --var [4 2]  =&gt;  [2]int{4, 2}</span>
<span>// or: --var 4,2  =&gt;  [2]int{4, 2}</span>

<span>v</span> <span>:=</span> []<span>int</span>{<span>4</span>, <span>2</span>, <span>1</span>} <span>// element can be any valid basic or composite type</span>
<span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>v</span>, <span>&#34;v&#34;</span>, <span>&#34;var&#34;</span>, <span>&#34;description&#34;</span>)
<span>// --var [4 2 1]  =&gt;  []int{4, 2, 1}</span>
<span>// or: --var 4,2,1  =&gt;  []int{4, 2, 1}</span>

<span>v</span> <span>:=</span> <span>map</span>[<span>int</span>]<span>string</span>{<span>1</span>:<span>&#34;one&#34;</span>, <span>2</span>:<span>&#34;two&#34;</span>} <span>// key and value can be any valid basic or composite type</span>
<span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>v</span>, <span>&#34;v&#34;</span>, <span>&#34;var&#34;</span>, <span>&#34;description&#34;</span>)
<span>// --var {1:one 2:two}  =&gt;  map[int]string{1:&#34;one&#34;, 2:&#34;two&#34;}</span>

<span>v</span> <span>:=</span> <span>struct</span> { <span>// fields can be any valid basic or composite type</span>
    <span>S</span> <span>string</span>
    <span>I</span> <span>int</span>
    <span>B</span> [<span>2</span>]<span>bool</span>
}{<span>&#34;string&#34;</span>, <span>42</span>, [<span>2</span>]<span>bool</span>{<span>0</span>, <span>1</span>}}
<span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>v</span>, <span>&#34;v&#34;</span>, <span>&#34;var&#34;</span>, <span>&#34;description&#34;</span>)
<span>// --var {string 42 [0 1]}  =&gt;  struct{S string, I int, B [2]bool}{&#34;string&#34;, 42, false, true}</span></pre></div>

<p dir="auto">Count the number of time a flag has been passed.</p>
<div dir="auto" data-snippet-clipboard-copy-content="var c int
cmd.AddOpt(argp.Count{&amp;c}, &#34;c&#34;, &#34;count&#34;, &#34;Count&#34;)
// Count the number of times flag is present
// -c -c / -cc / --count --count  =&gt;  2
// or: -c 5  =&gt;  5"><pre><span>var</span> <span>c</span> <span>int</span>
<span>cmd</span>.<span>AddOpt</span>(argp.<span>Count</span>{<span>&amp;</span><span>c</span>}, <span>&#34;c&#34;</span>, <span>&#34;count&#34;</span>, <span>&#34;Count&#34;</span>)
<span>// Count the number of times flag is present</span>
<span>// -c -c / -cc / --count --count  =&gt;  2</span>
<span>// or: -c 5  =&gt;  5</span></pre></div>

<p dir="auto">Append each flag to a list.</p>
<div dir="auto" data-snippet-clipboard-copy-content="var v []int
cmd.AddOpt(argp.Append{&amp;v}, &#34;v&#34;, &#34;value&#34;, &#34;Values&#34;)
// Append values for each flag
// -v 1 -v 2  =&gt;  [1 2]"><pre><span>var</span> <span>v</span> []<span>int</span>
<span>cmd</span>.<span>AddOpt</span>(argp.<span>Append</span>{<span>&amp;</span><span>v</span>}, <span>&#34;v&#34;</span>, <span>&#34;value&#34;</span>, <span>&#34;Values&#34;</span>)
<span>// Append values for each flag</span>
<span>// -v 1 -v 2  =&gt;  [1 2]</span></pre></div>

<p dir="auto">Load all arguments from a configuration file. Currently only TOML is supported.</p>
<div dir="auto" data-snippet-clipboard-copy-content="cmd.AddOpt(&amp;argp.Config{cmd, &#34;config.toml&#34;}, &#34;&#34;, &#34;config&#34;, &#34;Configuration file&#34;)"><pre><span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span>argp.<span>Config</span>{<span>cmd</span>, <span>&#34;config.toml&#34;</span>}, <span>&#34;&#34;</span>, <span>&#34;config&#34;</span>, <span>&#34;Configuration file&#34;</span>)</pre></div>

<p dir="auto">Use a list source specified as type:list. Default supported types are: inline.</p>
<ul dir="auto">
<li>Inline takes a []string, e.g. <code>inline:[foo bar]</code></li>
</ul>
<div dir="auto" data-snippet-clipboard-copy-content="list := argp.NewList(il)
defer list.Close()

cmd.AddOpt(&amp;list, &#34;&#34;, &#34;list&#34;, &#34;List&#34;)"><pre><span>list</span> <span>:=</span> <span>argp</span>.<span>NewList</span>(<span>il</span>)
<span>defer</span> <span>list</span>.<span>Close</span>()

<span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>list</span>, <span>&#34;&#34;</span>, <span>&#34;list&#34;</span>, <span>&#34;List&#34;</span>)</pre></div>
<p dir="auto">You can add a MySQL source:</p>
<div data-snippet-clipboard-copy-content="type mysqlList struct {
	Hosts    string
	User     string
	Password string
	Dbname   string
	Query    string
}

func newMySQLList(s []string) (argp.ListSource, error) {
	if len(s) != 1 {
		return nil, fmt.Errorf(&#34;invalid path&#34;)
	}

	t := mysqlList{}
	if err := argp.LoadConfigFile(&amp;t, s[0]); err != nil {
		return nil, err
	}

	uri := fmt.Sprintf(&#34;%s:%s@%s/%s&#34;, t.User, t.Password, t.Hosts, t.Dbname)
	db, err := sqlx.Open(&#34;mysql&#34;, uri)
	if err != nil {
		return nil, err
	}
	db.SetConnMaxLifetime(time.Minute)
	db.SetConnMaxIdleTime(time.Minute)
	db.SetMaxOpenConns(10)
	db.SetMaxIdleConns(10)
	return argp.NewSQLList(db, t.Query, &#34;&#34;)
}

// ...
list.AddSource(&#34;mysql&#34;, newMySQLList)
// ..."><pre><code>type mysqlList struct {
	Hosts    string
	User     string
	Password string
	Dbname   string
	Query    string
}

func newMySQLList(s []string) (argp.ListSource, error) {
	if len(s) != 1 {
		return nil, fmt.Errorf(&#34;invalid path&#34;)
	}

	t := mysqlList{}
	if err := argp.LoadConfigFile(&amp;t, s[0]); err != nil {
		return nil, err
	}

	uri := fmt.Sprintf(&#34;%s:%s@%s/%s&#34;, t.User, t.Password, t.Hosts, t.Dbname)
	db, err := sqlx.Open(&#34;mysql&#34;, uri)
	if err != nil {
		return nil, err
	}
	db.SetConnMaxLifetime(time.Minute)
	db.SetConnMaxIdleTime(time.Minute)
	db.SetMaxOpenConns(10)
	db.SetMaxIdleConns(10)
	return argp.NewSQLList(db, t.Query, &#34;&#34;)
}

// ...
list.AddSource(&#34;mysql&#34;, newMySQLList)
// ...
</code></pre></div>
<p dir="auto">Use as <code>./bin -list mysql:list-config.toml</code>.</p>

<p dir="auto">Use a dict source specified as type:dict. Default supported types are: static and inline.</p>
<ul dir="auto">
<li>Static takes a string and will return that as a value for all keys, e.g. <code>static:foobar</code></li>
<li>Inline takes a map[string]string, e.g. <code>inline:{foo:1 bar:2}</code></li>
</ul>
<div dir="auto" data-snippet-clipboard-copy-content="dict := argp.NewDict([]string{&#34;static:value&#34;})
defer dict.Close()

cmd.AddOpt(&amp;dict, &#34;&#34;, &#34;dict&#34;, &#34;Dict&#34;)"><pre><span>dict</span> <span>:=</span> <span>argp</span>.<span>NewDict</span>([]<span>string</span>{<span>&#34;static:value&#34;</span>})
<span>defer</span> <span>dict</span>.<span>Close</span>()

<span>cmd</span>.<span>AddOpt</span>(<span>&amp;</span><span>dict</span>, <span>&#34;&#34;</span>, <span>&#34;dict&#34;</span>, <span>&#34;Dict&#34;</span>)</pre></div>
<p dir="auto">You can add custom sources must like the mysqlList example above.</p>

<p dir="auto">The following struct will accept the following options and arguments:</p>
<ul dir="auto">
<li><code>-v</code> or <code>--var</code> with a default value of 42</li>
<li>The first argument called <code>first</code> with a default value of 4.2</li>
<li>The other arguments called <code>rest</code></li>
</ul>
<div dir="auto" data-snippet-clipboard-copy-content="type Command struct {
    Var1 int `short:&#34;v&#34; name:&#34;var&#34; default:&#34;42&#34; desc:&#34;Description&#34;`
    Var2 float64 `name:&#34;first&#34; index:&#34;0&#34; default:&#34;4.2&#34;`
    Var3 []string `name:&#34;rest&#34; index:&#34;*&#34;`
}

func (cmd *Command) Run() error {
    // run command
    return nil
}"><pre><span>type</span> <span>Command</span> <span>struct</span> {
    <span>Var1</span> <span>int</span> <span>`short:&#34;v&#34; name:&#34;var&#34; default:&#34;42&#34; desc:&#34;Description&#34;`</span>
    <span>Var2</span> <span>float64</span> <span>`name:&#34;first&#34; index:&#34;0&#34; default:&#34;4.2&#34;`</span>
    <span>Var3</span> []<span>string</span> <span>`name:&#34;rest&#34; index:&#34;*&#34;`</span>
}

<span>func</span> (<span>cmd</span> <span>*</span><span>Command</span>) <span>Run</span>() <span>error</span> {
    <span>// run command</span>
    <span>return</span> <span>nil</span>
}</pre></div>

<p dir="auto">Released under the <a href="https://renschler.github.io/tdewolff/argp/blob/master/LICENSE.md">MIT license</a>.</p>
</article></div></div>
  </body>
</html>
