<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.aloni.org/posts/proper-use-of-git-tags/">Original</a>
    <h1>Proper use of Git tags</h1>
    
    <div id="readability-page-1" class="page"><div role="document">
  <div>
    <div>
      <div>
        <article>
          
          
          <p>In the Linux kernel project, the first Git-managed project in existence, due to
<i>proper</i> use of Git tags, <code>v4.11-rc7-87-g28cf22d0ba28</code> is equivalent to
<code>28cf22d0ba28</code>. This is due to existence of the annotated <code>v4.11-rc7</code>. The
nicer string is the output of <code>git describe</code>. Any command that excepts the
latter behaves the same when the former is passed instead.  When git is
presented with <code>[anystring]-g[hash]</code>, it throws away the <code>[anystring]-g</code>
prefix, and treats <code>[hash]</code> part as the desired commit to resolve.</p>
<p>Git tags let us prettify any Git hash with the software version from which it
is derived. However in many projects Git tags are often not used to their full
potential in the best case, and in the worst case they are being misused.</p>
<p>In this post I provide list of recommendations to assist in achieving the
nicety that is obtainable from Git tags in any project.</p>
<h2 id="tag-push-permissions">Tag push permissions</h2>
<p>A common pitfall is to let any developer push Git tags. The following scenario
happened to me <strong>in more than one company</strong>:</p>
<ul>
<li>Someone pushed a <code>test</code> tag.</li>
<li>Someone else created <code>test</code> subdir in the project&#39;s root.</li>
</ul>
<p>Now, <code>git log test</code> is an ambiguous command that does not know what to do.
Should it show the commits starting from the commit pointed by <code>test</code>, or the
commits from <code>HEAD</code> that modified that <code>test</code> directory? Or maybe the developer
has a local <code>test</code> branch? Headache.</p>
<p>If possible, configure the Git server to accept tag pushes only from release
managers.</p>
<h2 id="tag-naming">Tag naming</h2>
<p>Tags are unique and live forever in the repo.</p>
<p>Pick good tag names that do not cause ambiguity with your branch name
convention.</p>
<p>A nice convention is the following: to mark versions, start with <code>v</code>. That way,
shell completion works nicely upon trying to complete <code>v</code>. If you drop the <code>v</code>
and instead go with the version number immediately .e.g <code>1.</code>, shell completion
will struggle to show completions between tags starting with <code>1</code> and all
commits whose git hashes start with <code>1</code>.</p>

<p>By default <code>git tag</code> creates lightweight tags (non-annotated tags). <strong>Do</strong> pass
the <code>-a</code> switch to create annotated tags. This way, meta-data from the creation
of the tag is registered just like with commits. Also, <code>git describe</code> would
work out of the box and won&#39;t need the <code>--tags</code> flag that is needed to force it
to consider lightweight tags too.</p>

<p>Git tags are just complementary information to Git, they are not the source
itself.  Use both Git tags and a source tree file to tell the version of the
code. This is usually the version string in the package manager manifest of
your ecosystem of choice. But how to do that properly? i.e. which commits
should be tagged? This takes us to the next recommendation â€”</p>
<h2 id="the-commit-that-changed-the-version-in-source-is-the-one-to-be-tagged">The commit that changed the version in source is the one to be tagged</h2>
<p>By convention, the commit that changed the version in the source <strong>is</strong> the one
that should be tagged, not the commit that merged it into the main branch. This
way, <code>git describe</code> shows the correct result.</p>
<h2 id="further-resources">Further resources</h2>
<ul>
<li><span><a rel="noopener" target="_blank" href="https://git-scm.com/book/en/v2/Git-Basics-Tagging">Git Basics - tagging<span></span><svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></span></li>
<li><span><a rel="noopener" target="_blank" href="https://medium.com/@keshshen/lets-start-tagging-88c299b6b331">Let&#39;s start tagging!<span></span><svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></span></li>
</ul>

        </article>
	
      </div>
    </div>
  </div>
</div></div>
  </body>
</html>
