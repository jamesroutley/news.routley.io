<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://magazine.sebastianraschka.com/p/why-the-original-transformer-figure">Original</a>
    <h1>Why the original transformer figure is wrong, and some other tidbits about LLMs</h1>
    
    <div id="readability-page-1" class="page"><div><div><article><div class=""><div><div dir="auto"><p><span>A few months ago, I shared the article, </span><em>Understanding Large Language Models: A Cross-Section of the Most Relevant Literature To Get Up to Speed</em><span>, and the positive feedback was very motivating! So, I also added a few papers here and there to keep the list fresh and relevant.</span></p><div><div><a href="https://magazine.sebastianraschka.com/p/understanding-large-language-models" target="_blank" rel="noreferrer" class=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_140,h_140,c_fill,f_webp,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd9a0766d-2e52-4af0-96c5-3e07a30d6ecb_1868x1130.png"/><img src="https://substackcdn.com/image/fetch/w_140,h_140,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd9a0766d-2e52-4af0-96c5-3e07a30d6ecb_1868x1130.png" sizes="100vw" alt="Understanding Large Language Models" width="140" height="140"/></picture></div></a></div></div><p>At the same time, keeping this list concise is useful and important so that someone can get up to speed in a reasonable time. However, there are also a few key papers that, in hindsight, are very informative and should be included.</p><p><span>This time, I want to share four useful papers to understand transformers from a more historical perspective. While I just added them to the </span><em>Understanding Large Language Models</em><span> article directly, I am also sharing them here in this separate article to make them easier to find for those who have already read through the </span><em>Understanding Large Language Models</em><span> before.</span></p><p><strong>(1)</strong><span> </span><em><strong>On Layer Normalization in the Transformer Architecture</strong></em><strong> (2020)</strong><span> by Xiong, Yang, He, K Zheng, S Zheng, Xing, Zhang, Lan, Wang, and Liu, </span><a href="https://arxiv.org/abs/2002.04745" rel="">https://arxiv.org/abs/2002.04745</a></p><p><span>While the original transformer figure above (from </span><em>Attention Is All You Need</em><span>, </span><a href="https://arxiv.org/abs/1706.03762" rel="">https://arxiv.org/abs/1706.03762</a><span>) is a helpful summary of the original encoder-decoder architecture, there is a slight discrepancy in this figure. For instance, it places the layer normalization between the residual blocks, which doesn&#39;t match the </span><a href="https://github.com/tensorflow/tensor2tensor/commit/f5c9b17e617ea9179b7d84d36b1e8162cb369f25" rel="">official (updated) code implementation</a><span> accompanying the original transformer paper. The variant shown in the </span><em>Attention Is All You Need</em><span> figure is known as Post-LN Transformer.</span></p><p><span>The </span><em>Layer Normalization in the Transformer Architecture</em><span> paper suggests that Pre-LN works better, addressing gradient problems, as shown below. Many architectures adopted this in practice, but it can result in representation collapse.</span></p><p><span>So, while there&#39;s still an ongoing discussion regarding using Post-LN or Pre-LN, there&#39;s also a new paper that proposes taking advantage of both worlds: </span><em>ResiDual: Transformer with Dual Residual Connections</em><span> (</span><a href="https://arxiv.org/abs/2304.14802" rel="">https://arxiv.org/abs/2304.14802</a><span>); whether it will turn out useful in practice remains to be seen.</span></p><p><strong>(2)</strong><span> </span><em><strong>Learning to Control Fast-Weight Memories: An Alternative to Dynamic Recurrent Neural Networks</strong></em><strong> (1991)</strong><span> by Schmidhuber, </span><a href="https://www.semanticscholar.org/paper/Learning-to-Control-Fast-Weight-Memories%3A-An-to-Schmidhuber/bc22e87a26d020215afe91c751e5bdaddd8e4922" rel="">https://www.semanticscholar.org/paper/Learning-to-Control-Fast-Weight-Memories%3A-An-to-Schmidhuber/bc22e87a26d020215afe91c751e5bdaddd8e4922</a></p><p>This paper is recommended for those interested in historical tidbits and early approaches fundamentally similar to modern transformers.</p><p><span>For instance, in 1991, which is about two-and-a-half decades before the original transformer paper above (&#34;Attention Is All You Need&#34;), Juergen Schmidhuber proposed an alternative to recurrent neural networks called </span><em>Fast Weight Programmers</em><span> (FWP). The FWP approach involves a feedforward neural network that slowly learns by gradient descent to program the changes of the fast weights of another neural network.</span></p><p><span>The analogy to modern transformers is explained </span><a href="https://people.idsia.ch//~juergen/fast-weight-programmer-1991-transformer.html#sec2" rel="">in this blog post</a><span> as follows:</span></p><blockquote><p><em>In today&#39;s Transformer terminology, FROM and TO are called key and value, respectively. The INPUT to which the fast net is applied is called the query. Essentially, the query is processed by the fast weight matrix, which is a sum of outer products of keys and values (ignoring normalizations and projections). Since all operations of both networks are differentiable, we obtain end-to-end differentiable active control of fast weight changes through additive outer products or second order tensor products.[FWP0-3a] Hence the slow net can learn by gradient descent to rapidly modify the fast net during sequence processing. This is mathematically equivalent (apart from normalization) to what was later called Transformers with linearized self-attention (or linear Transformers).</em></p></blockquote><p><span>As mentioned in the blog post excerpt above, this approach is now called &#34;linear Transformers&#34; or &#34;Transformers with linearized self-attention&#34; via the more recent 2021 paper </span><a href="https://arxiv.org/abs/2102.11174" rel="">Linear Transformers Are Secretly Fast Weight Programmers</a><span>.</span></p><p><strong>(3)</strong><span> </span><em><strong>Universal Language Model Fine-tuning for Text Classification</strong></em><strong> (2018)</strong><span> by Howard and Ruder, </span><a href="https://arxiv.org/abs/1801.06146" rel="">https://arxiv.org/abs/1801.06146</a></p><p><span>This is another paper that&#39;s very interesting from a historical perspective. While it was written one year after the original </span><em>Attention Is All You Need</em><span> transformer was released, it doesn&#39;t involve transformers but instead focuses on recurrent neural networks. However, it&#39;s still noteworthy since it effectively proposed pretraining language models and transfer learning for downstream tasks.</span></p><p>While transfer learning was already established in computer vision, it wasn&#39;t yet prevalent in natural language processing (NLP). ULMFit was among the first papers to demonstrate that pretraining a language model and finetuning it on a specific task could yield state-of-the-art results in many NLP tasks.</p><p>The three-stage process for finetuning the language models suggested by ULMFit was as follows:</p><ul><li><p>Train a language model on a large corpus of text.</p></li><li><p>Finetune this pretrained language model on task-specific data, allowing it to adapt to the specific style and vocabulary of the text.</p></li><li><p>Finetune a classifier on the task-specific data with gradual unfreezing of layers to avoid catastrophic forgetting.</p></li></ul><p>This recipe -- training a language model on a large corpus and then finetuning it on a downstream task -- is the central approach used in transformer-based models and foundation models like BERT, GPT-2/3/4, RoBERTa, and others.</p><p>However, the gradual unfreezing, a key part of ULMFiT, is usually not routinely done in practice when working with transformer architectures, where all layers are typically finetuned at once.</p><p><strong>(4)</strong><span> </span><em><strong>Scaling Language Models: Methods, Analysis &amp; Insights from Training Gopher</strong></em><span> </span><strong>(2022)</strong><span> by Rae and colleagues (78 co-authors!), </span><a href="https://arxiv.org/abs/2112.11446" rel="">https://arxiv.org/abs/2112.11446</a></p><p><em>Gopher</em><span> is a particularly nice paper including tons of analysis to understand LLM training. Here, the researchers trained a 280 billion parameter model with 80 layers on 300 billions tokens. This includes interesting architecture modifications such as using RMSNorm (Root Mean Square Normalization) instead of LayerNorm (Layer Normalization). Both LayerNorm and RMSNorm are preferred over BatchNorm since they don&#39;t depend on the batch size and doesn&#39;t require synchronization, which is an advantage in distributed settings with smaller batch sizes. However, RMSNorm is generally said to stabilize the training in deeper architectures.</span></p><p>Besides interesting tidbits such the ones above, the main focus of this paper is the analysis of task performance for different scales. The evaluation on 152 diverse tasks reveal that increasing model sizes benefits tasks like comprehension, fact-checking, and the identification of toxic language the most. However, tasks related to logical and mathematical reasoning benefit less from architecture scaling.</p><p><span>Are you interested in more AI-related news, musings, and educational material but don&#39;t want to wait until the next newsletter issue? You can follow my </span><a href="https://substack.com/profile/27393275-sebastian-raschka" rel="">Substack Notes</a><span>or check out </span><a href="https://sebastianraschka.com/books/" rel="">my books</a><span>.</span></p><p><span>Thank you to those who have reached out asking how they can support Ahead of AI. While this newsletter is free and unabbreviated, there is a </span><a href="https://magazine.sebastianraschka.com/subscribe?utm_medium=web&amp;utm_source=magaziney-home-page" rel="">paid subscription option</a><span> on Substack for those who would like to support it. (For those who asked about expensing this letter, I included a </span><a href="https://docs.google.com/document/d/1esZG-ZSc-u_ewe-2YnHi69um4kjv9yQSfO7S3yMQuPw/edit?usp=sharing" rel="">template here</a><span>.)</span></p><p><span>And if you liked this article, I would really appreciate it if you could share it with your colleagues or </span><em>restack</em><span> it here on Substack.</span></p></div></div></div></article></div></div></div>
  </body>
</html>
