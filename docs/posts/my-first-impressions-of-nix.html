<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mtlynch.io/notes/nix-first-impressions/">Original</a>
    <h1>My First Impressions of Nix</h1>
    
    <div id="readability-page-1" class="page"><div><p><a href="https://nix.dev/">Nix</a> is a tool for configuring software environments according to source files. Iâ€™ve been hearing more and more about Nix on Hacker News and Twitter. The idea of it appeals to me, so Iâ€™ve been tinkering with it over the past few weeks.</p><h2 id="my-history-with-infrastructure-as-code">My history with infrastructure as code<a href="#my-history-with-infrastructure-as-code" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>Ten years ago, I discovered <a href="https://github.com/saltstack/salt">Salt</a>, a tool that allows you to define a computer systemâ€™s configuration in source code. I loved the idea of a git repo that defined what services were installed on my computers and VMs. I could blow away the computer, re-run the configuration tool, and get it back to the same state.</p><p>I messed around with Salt for a few years until discovering <a href="https://github.com/ansible/ansible">Ansible</a>, which I felt like executed the same idea better.</p><p>I do all of my development in VMs on <a href="https://mtlynch.io/building-a-vm-homelab/">my homelab server</a>. I have a separate VM for each projects, and I manage them all with Ansible.</p><h2 id="the-problems-with-ansible">The problems with Ansible<a href="#the-problems-with-ansible" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>Ansibleâ€™s biggest problem is that itâ€™s painfully slow. It typically takes 10-15 minutes for Ansible to run against one of my VMs.</p><p>Suppose I want to install a new apt package <code>foo</code>. Do I just run <code>sudo apt install --yes foo</code> and have the package in 5 seconds? Or do I pull up my Ansible role, edit the configuration to add a step to install <code>foo</code>, then run the playbook, then wait 15 minutes? Obviously, I end up doing more of the former, so my environments drift from the Ansible files that are supposed to represent them.</p><p>The other issue is that Ansibleâ€™s changes arenâ€™t backwards-compatible. So, if I update a playbook to take advantage of a new Ansible feature, I have to update <em>all</em> of my playbooks to be compatible. But I never feel inspired to rewrite and retest all of my playbooks, so I get stuck on old versions. Iâ€™m still on Ansible 2.9, which was released three years ago.</p><h2 id="the-appeal-of-nix">The appeal of Nix<a href="#the-appeal-of-nix" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>Iâ€™m seeing more and more people talk about Nix and NixOS. A lot of the developers I find interesting are talking about their experiments with Nix.</p><p>The most impactful endorsement Iâ€™ve seen was from <a href="https://mitchellh.com/">Mitchell Hashimoto</a>, co-founder of Hashicorp, the company responsible for creating a lot of widely-used open-source infrastructure tools like Vagrant, Packer, Consul, and Terraform. He called Nix, â€œthe #1 most positively impactful technology Iâ€™ve learned in recent years.â€</p><p><a href="https://mtlynch.io/notes/nix-first-impressions/hashimoto-tweet.png"><img sizes="(min-width: 768px) 600px, 98vw" srcset="https://d33wubrfki0l68.cloudfront.net/5cc52f9c47a7dfee261d6d2595f291449d269b5c/a5e65/notes/nix-first-impressions/hashimoto-tweet_hu7dc41022f9c8f28405555f44e5ca4450_30671_300x0_resize_lanczos_3.png 300w,
https://d33wubrfki0l68.cloudfront.net/ae57cc51889fbe1643c1a73bbd2f7e83afe3be70/aac5f/notes/nix-first-impressions/hashimoto-tweet.png 598w" src="https://d33wubrfki0l68.cloudfront.net/ae57cc51889fbe1643c1a73bbd2f7e83afe3be70/aac5f/notes/nix-first-impressions/hashimoto-tweet.png" alt="My Nix journey so far. I still stand by that its the #1 most positively impactful technology I&#39;ve learned in recent years." loading="lazy"/></a></p><p>The idea of Nix feels a lot like Ansible. Nix lets you define a configuration in code, and then it brings the system into that state.</p><h2 id="nix-vs-ansible">Nix vs. Ansible<a href="#nix-vs-ansible" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>Nix differs from Ansible in a few important ways that I find interesting.</p><h3 id="nix-is-faster-than-ansible">Nix is faster than Ansible<a href="#nix-is-faster-than-ansible" arialabel="Anchor"> ğŸ”—ï¸</a></h3><p>Ansible has no concept of the â€œstateâ€ of the system itâ€™s configuring. If it takes 15 minutes to run Ansible on one of my VMs, running the same playbook a minute later would take about 10 minutes. You save a little bit of time because thereâ€™s probably no package updates between the two invocations, but itâ€™s still doing almost all the same work.</p><p>Ansible never says, â€œOh, I just configured that machine, so thereâ€™s nothing for me to do now.â€ Ansible has to perform every configuration again because anything could have happened since the last time it ran.</p><p>Nix, on the other hand, does have a concept of state. If you make a one-line change to a 200-line Nix configuration, it doesnâ€™t have to re-do all the work from the other 199 lines. It can evaluate the state of the system against the configuration file and recognize that it just has to apply the one-line change. And that change usually happens in a few seconds.</p><h3 id="nix-optimizes-for-local-configuration">Nix optimizes for local configuration<a href="#nix-optimizes-for-local-configuration" arialabel="Anchor"> ğŸ”—ï¸</a></h3><p>Ansible is designed to configure systems over the network. You can still specify <code>localhost</code> as the target, but thatâ€™s not the scenario that Ansible is optimized for.</p><p>Nix is designed to configure the environment itâ€™s in. With Nix, you define what should be in the environment, and then Nix creates that environment for you in place. With NixOS, you defined the entire operating system, and NixOS gets the operating system into that state. You can change low-level things like the filesystem, the Linux kernel, or the bootloader.</p><p>This solves the problem I had with Ansible where upgrading one Ansible playbook to use a later version of Ansible requires me to upgrade all the playbooks on my system. You can have many Nix systems running different versions of Nix, and they work fine. If I have some Ansible files that require Ansible 2.9, some that require 2.10, and some that require 2.14, then itâ€™s a big pain to juggle them all.</p><h3 id="nix-changes-are-atomic">Nix changes are atomic<a href="#nix-changes-are-atomic" arialabel="Anchor"> ğŸ”—ï¸</a></h3><p>With Ansible, itâ€™s easy to fail halfway through a configuration, leaving the system in an undefined state.</p><p>With Nix, changes are atomic. Nix either gets your system into the desired state or it rolls back to the state before you tried changing the configuration.</p><h2 id="nix-resources-that-have-been-helpful">Nix resources that have been helpful<a href="#nix-resources-that-have-been-helpful" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>One of the biggest complaints I see about Nix is that itâ€™s underdocumented, incorrectly, or poorly documented. My experience is that the documentation feels like itâ€™s aimed at experienced Nix users.</p><p>A lot of Nix documentation Iâ€™ve found says things like, â€œSimply add these lines!â€</p><p>Huh?</p><p>Which file? And where in the file do I add those lines?</p><p>Here are the best resources Iâ€™ve found so far:</p><ul><li><a href="https://zero-to-nix.com/">Zero to Nix</a>: This is the best set of introductory Nix tutorials Iâ€™ve found. Itâ€™s written by <a href="https://determinate.systems">Determinate Systems</a>, who also writes beginner-friendly <a href="https://determinate.systems/#blog">blog posts</a> about using Nix.</li><li><a href="https://borretti.me/article/nixos-for-the-impatient">NixOS for the Impatient</a>: Iâ€™d tried to install NixOS a couple of times before this, but this post finally convinced me it was easier than I thought, and it gave me the final push to push through the process.</li><li><a href="https://jvns.ca/blog/2023/02/28/some-notes-on-using-nix/">â€œSome notes on using nixâ€ by Julia Evans</a>: Juliaâ€™s also a newcomer to Nix, so it was helpful seeing the blockers she ran into and how she worked around them even though thereâ€™s a lot about the ecosystem thatâ€™s still new and unfamiliar to her.</li></ul><h2 id="failed-attempt-1-nixos-in-a-vm">Failed attempt #1: NixOS in a VM<a href="#failed-attempt-1-nixos-in-a-vm" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>I followed the â€œNixOS for the Impatientâ€ tutorial on a Proxmox VM, and everything worked at first. Then, I got to the point in the tutorial where you change the hostname, and then I rebooted for it to take effect. But the VM got into a weird state where it seemed like it could boot but not log in. After I entered the password in the login screen, the screen just froze.</p><figure><div><video controls="">
<source src="vm-boot-hang.mp4" type="video/mp4"/>Your browser does not support the video tag.</video><figcaption><p>NixOS installed successfully on my Proxmox VM server, but it hung after login on the second boot.</p></figcaption></div></figure><h2 id="failed-attempt-2-nixos-on-the-raspberry-pi-4">Failed attempt #2: NixOS on the Raspberry Pi 4<a href="#failed-attempt-2-nixos-on-the-raspberry-pi-4" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>Since a VM didnâ€™t work, I figured bare metal was the next logical choice. I had a spare Raspberry Pi 4 on hand, and I thought the Pi would be fun hardware to experiment on.</p><p>I found two different official-looking tutorials for installing NixOS on the Raspberry Pi 4:</p><ul><li><a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_4">NixOS Wiki: NixOS on ARM/Raspberry Pi 4</a></li><li><a href="https://nix.dev/tutorials/nixos/build-and-deploy/installing-nixos-on-a-raspberry-pi">nix.dev: Installing NixOS on a Raspberry Pi</a></li></ul><p>The problem with both of these tutorials was they assumed that youâ€™re already running a Nix environment. Iâ€™m trying to prepare the microSD from my main computer, which is a Win10 system, so I didnâ€™t have Nix already.</p><p>The <a href="https://nixos.org/download.html#nixos-iso">NixOS download page</a> lists a 64-bit ARM image. The Raspberry Pi 4 supports 64-bit ARM, so I thought Iâ€™d try that.</p><p>I loaded up Balena Etcher, my preferred tool for flashing microSDs. The first red flag was when Etcher basically said, â€œHey, what are you thinking? Thatâ€™s not even a bootable image.â€</p><p><a href="https://mtlynch.io/notes/nix-first-impressions/etcher-warning.webp"><img sizes="(min-width: 768px) 802px, 98vw" srcset="https://d33wubrfki0l68.cloudfront.net/dc4cb7a1d025e88ba4a4058fee1ba7af73a6ba5f/329f1/notes/nix-first-impressions/etcher-warning_hu1e2b24ad24dfee52de1faddc0eddb80f_7674_300x0_resize_q90_h2_lanczos_2.webp 300w,
https://d33wubrfki0l68.cloudfront.net/6ee0957ca108dc9cc692bdb44053caa01eb90ac0/e10f4/notes/nix-first-impressions/etcher-warning_hu1e2b24ad24dfee52de1faddc0eddb80f_7674_600x0_resize_q90_h2_lanczos_2.webp 600w,
https://d33wubrfki0l68.cloudfront.net/ed46592d7304c458cc124fdb58934023e023328a/6d0cc/notes/nix-first-impressions/etcher-warning_hu1e2b24ad24dfee52de1faddc0eddb80f_7674_800x0_resize_q90_h2_lanczos_2.webp 800w,
https://d33wubrfki0l68.cloudfront.net/b2e57524f374737473832e6eb85368f4da8ed5e9/9ad8f/notes/nix-first-impressions/etcher-warning.webp 802w" src="https://d33wubrfki0l68.cloudfront.net/b2e57524f374737473832e6eb85368f4da8ed5e9/9ad8f/notes/nix-first-impressions/etcher-warning.webp" alt="Missing partition table. It looks like this is not a bootable image. The image does not appear to contain a partition table, and might not be recognized or bootable by your device." loading="lazy"/></a></p><p>I continued on anyway! But when I tried booting from the microSD, the Pi agreed that this was not a bootable image, so it just got stuck.</p><p><a href="https://mtlynch.io/notes/nix-first-impressions/pi-noboot.png"><img sizes="(min-width: 768px) 1405px, 98vw" srcset="https://d33wubrfki0l68.cloudfront.net/483ade51a602b54c4586e82c0ca1b63065e492c8/cc565/notes/nix-first-impressions/pi-noboot_hu97faa36e6504063c98f4ee3349c7ea57_86217_300x0_resize_lanczos_3.png 300w,
https://d33wubrfki0l68.cloudfront.net/955ec6be9f458ed176fe7300589204b1afc9b5b4/da3d7/notes/nix-first-impressions/pi-noboot_hu97faa36e6504063c98f4ee3349c7ea57_86217_600x0_resize_lanczos_3.png 600w,
https://d33wubrfki0l68.cloudfront.net/365a4e95d0e2751a30c9767c78f2e9584a1aa89d/012dd/notes/nix-first-impressions/pi-noboot_hu97faa36e6504063c98f4ee3349c7ea57_86217_800x0_resize_lanczos_3.png 800w,
https://d33wubrfki0l68.cloudfront.net/11e7ce07af3812bb46978be536faa2c410710f13/88e98/notes/nix-first-impressions/pi-noboot_hu97faa36e6504063c98f4ee3349c7ea57_86217_1200x0_resize_lanczos_3.png 1200w,
https://d33wubrfki0l68.cloudfront.net/db73c5c0a4640aee58e14ad9fa24807db52f46b3/c262f/notes/nix-first-impressions/pi-noboot.png 1405w" src="https://d33wubrfki0l68.cloudfront.net/db73c5c0a4640aee58e14ad9fa24807db52f46b3/c262f/notes/nix-first-impressions/pi-noboot.png" alt="" loading="lazy"/></a></p><p>I tried flashing the same image using the official Raspberry Pi Imager utility, but I got the same results.</p><h2 id="success-nixos-on-a-dell-mini-computer">Success: NixOS on a Dell Mini computer<a href="#success-nixos-on-a-dell-mini-computer" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>I do most of my testing for work against a Dell Optiplex 7040. It was the only bare-metal machine I had available that I could blow away, so I tried on that.</p><p>Everything worked exactly like in <a href="https://borretti.me/article/nixos-for-the-impatient">â€œNixOS for the Impatient.â€</a> The install took about 10 minutes from start to finish. Seven minutes was just copying files. I skipped encryption since this is just a test device, and I wanted to eliminate a password-entry step on every reboot.</p><figure><div><video controls="">
<source src="nixos-full-install.mp4" type="video/mp4"/>Your browser does not support the video tag.</video><figcaption><p>Installing NixOS on a Dell Optiplex 7040 (I sped up the file copy portion)</p></figcaption></div></figure><p>In the end, I had a full, working NixOS install!</p><h2 id="failed-attempt-3-nixos-on-the-raspberry-pi-4-again">Failed attempt #3: NixOS on the Raspberry Pi 4 (again)<a href="#failed-attempt-3-nixos-on-the-raspberry-pi-4-again" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>Now that I had a working NixOS machine, I wanted to give the Raspberry Pi another shot. The blocker before was not having a Nix environment from which to prepare the microSD image, but now I had one.</p><p>I followed the <a href="https://nix.dev/tutorials/nixos/build-and-deploy/installing-nixos-on-a-raspberry-pi">nix.dev tutorial</a>, which brought me farther than my first attempt, but I still couldnâ€™t boot. The Pi would just reach a stage of showing a multicolored screen and then hang:</p><figure><div><video controls="">
<source src="pi-boot-failure2.mp4" type="video/mp4"/>Your browser does not support the video tag.</video><figcaption><p>When I flashed the NixOS Pi aarch64 microSD image from a NixOS system and booted my Pi from it, it hung on a multicolored screen.</p></figcaption></div></figure><h2 id="task-1-getting-ssh-access">Task 1: Getting SSH access<a href="#task-1-getting-ssh-access" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>Okay, back to my working NixOS install on the Dell Optiplex.</p><p>I needed to SSH in to the NixOS system from my main machine. To do that, Iâ€™d need to get my SSH keys on the system.</p><p>From NixOS, I opened the Console application and then typed <code>sudo nano /etc/nixos/configuration.nix</code>. Then, I went to the <code>environment.systemPackages</code> and added these lines:</p><div><pre tabindex="0"><code data-lang="text"><span><span>  environment.systemPackages = with pkgs; [
</span></span><span><span>    vim
</span></span><span><span>    curl
</span></span><span><span>  ];
</span></span></code></pre></div><p>To realize the changes, I ran:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>sudo nixos-rebuild switch
</span></span></code></pre></div><p>Now, I had <code>vim</code> and <code>curl</code>, available, so I could pull down my SSH public key from Github:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>sudo mkdir -p /etc/nixos/ssh
</span></span><span><span>
</span></span><span><span><span>GITHUB_USERNAME</span>=<span>&#34;mtlynch&#34;</span>
</span></span><span><span>curl <span>&#34;https://github.com/</span><span>${</span><span>GITHUB_USERNAME</span><span>}</span><span>.keys&#34;</span> | <span>\
</span></span></span><span><span><span></span>  sudo tee --append /etc/nixos/ssh/authorized_keys
</span></span></code></pre></div><p>Next, I ran <code>sudo vim /etc/nixos/configuration.nix</code> and added these lines:</p><div><pre tabindex="0"><code data-lang="text"><span><span>  # Enable the OpenSSH daemon.
</span></span><span><span>  services.openssh.enable = true;
</span></span><span><span>  users.users.mike.openssh.authorizedKeys.keyFiles = [
</span></span><span><span>    /etc/nixos/ssh/authorized_keys
</span></span><span><span>  ];
</span></span></code></pre></div><p>Finally, I rebuilt and rebooted. Iâ€™m not sure if the reboot was strictly necessary:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>sudo nixos-rebuild switch &amp;&amp; sudo reboot
</span></span></code></pre></div><p>And it worked! After that, I could ssh into my NixOS system from my main computer.</p><h2 id="task-2-removing-gnome-clutter">Task 2: Removing Gnome clutter<a href="#task-2-removing-gnome-clutter" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>The first thing that struck me about the OS was that there was lots of clutter. It had a bunch of built-in apps I didnâ€™t want, like a contact list and a weather app:</p><p><a href="https://mtlynch.io/notes/nix-first-impressions/TinyPilot-2023-06-17T16_23_23.163Z.jpg"><img sizes="(min-width: 768px) 1920px, 98vw" srcset="https://d33wubrfki0l68.cloudfront.net/2b8267f0ffbb4bba13015584b4a8327044497cf1/b3260/notes/nix-first-impressions/tinypilot-2023-06-17t16_23_23.163z_hufa3864e7abab59057f1462b973245194_107376_300x0_resize_q90_lanczos.jpg 300w,
https://d33wubrfki0l68.cloudfront.net/da1c73f3fd4000a0a7272231023ed07c98336ccc/d46b9/notes/nix-first-impressions/tinypilot-2023-06-17t16_23_23.163z_hufa3864e7abab59057f1462b973245194_107376_600x0_resize_q90_lanczos.jpg 600w,
https://d33wubrfki0l68.cloudfront.net/8d1ec01a15427bf74c9729c5e36c1b1c0172364e/2d4c6/notes/nix-first-impressions/tinypilot-2023-06-17t16_23_23.163z_hufa3864e7abab59057f1462b973245194_107376_800x0_resize_q90_lanczos.jpg 800w,
https://d33wubrfki0l68.cloudfront.net/761dade5911cfc5b54e588c5da805e138440247e/1c366/notes/nix-first-impressions/tinypilot-2023-06-17t16_23_23.163z_hufa3864e7abab59057f1462b973245194_107376_1200x0_resize_q90_lanczos.jpg 1200w,
https://d33wubrfki0l68.cloudfront.net/22b31f1494c6b06f75342b24b663e5147c79d90c/ec7ce/notes/nix-first-impressions/tinypilot-2023-06-17t16_23_23.163z.jpg 1920w" src="https://d33wubrfki0l68.cloudfront.net/22b31f1494c6b06f75342b24b663e5147c79d90c/ec7ce/notes/nix-first-impressions/tinypilot-2023-06-17t16_23_23.163z.jpg" alt="" loading="lazy"/></a></p><p>I searched for how to get rid of them and discovered that <a href="https://discourse.nixos.org/t/howto-disable-most-gnome-default-applications-and-what-they-are/13505">theyâ€™re default applications as part of the Gnome shell</a>. You can disable them by adding this line to your <code>/etc/nixos/configuration.nix</code>:</p><div><pre tabindex="0"><code data-lang="text"><span><span>services.gnome.core-utilities.enable = false;
</span></span></code></pre></div><p>Or you can remove each utility one-by-one:</p><div><pre tabindex="0"><code data-lang="bash"><span><span> environment.gnome.excludePackages = with pkgs.gnome; [
</span></span><span><span>    baobab      <span># disk usage analyzer</span>
</span></span><span><span>    cheese      <span># photo booth</span>
</span></span><span><span>    eog         <span># image viewer</span>
</span></span><span><span>    epiphany    <span># web browser</span>
</span></span><span><span>    gedit       <span># text editor</span>
</span></span><span><span>    simple-scan <span># document scanner</span>
</span></span><span><span>    totem       <span># video player</span>
</span></span><span><span>    yelp        <span># help viewer</span>
</span></span><span><span>    evince      <span># document viewer</span>
</span></span><span><span>    file-roller <span># archive manager</span>
</span></span><span><span>    geary       <span># email client</span>
</span></span><span><span>    seahorse    <span># password manager</span>
</span></span><span><span>
</span></span><span><span>    gnome-calculator
</span></span><span><span>    gnome-calendar
</span></span><span><span>    gnome-characters
</span></span><span><span>    gnome-clocks
</span></span><span><span>    gnome-contacts
</span></span><span><span>    gnome-font-viewer
</span></span><span><span>    gnome-logs
</span></span><span><span>    gnome-maps
</span></span><span><span>    gnome-music
</span></span><span><span>    gnome-screenshot
</span></span><span><span>    gnome-system-monitor
</span></span><span><span>    gnome-weather
</span></span><span><span>    gnome-disk-utility
</span></span><span><span>    pkgs.gnome-connections
</span></span><span><span>  ];
</span></span></code></pre></div><p>I went with the â€œdisable everythingâ€ option and rebuilt:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>sudo nixos-rebuild switch
</span></span></code></pre></div><p>And voila! All of the clutter disappeared:</p><p><a href="https://mtlynch.io/notes/nix-first-impressions/TinyPilot-2023-06-17T16%2027%2037.615Z.jpg"><img sizes="(min-width: 768px) 1920px, 98vw" srcset="/notes/nix-first-impressions/TinyPilot-2023-06-17T16%2027%2037.615Z_hu9997abeda74829ecdcd03e4bd2cce308_75560_300x0_resize_q90_lanczos.jpg 300w,
/notes/nix-first-impressions/TinyPilot-2023-06-17T16%2027%2037.615Z_hu9997abeda74829ecdcd03e4bd2cce308_75560_600x0_resize_q90_lanczos.jpg 600w,
/notes/nix-first-impressions/TinyPilot-2023-06-17T16%2027%2037.615Z_hu9997abeda74829ecdcd03e4bd2cce308_75560_800x0_resize_q90_lanczos.jpg 800w,
/notes/nix-first-impressions/TinyPilot-2023-06-17T16%2027%2037.615Z_hu9997abeda74829ecdcd03e4bd2cce308_75560_1200x0_resize_q90_lanczos.jpg 1200w,
/notes/nix-first-impressions/TinyPilot-2023-06-17T16%2027%2037.615Z.jpg 1920w" src="https://mtlynch.io/notes/nix-first-impressions/TinyPilot-2023-06-17T16%2027%2037.615Z.jpg" alt="" loading="lazy"/></a></p><h2 id="task-3-bringing-back-the-system-monitor-failed">Task 3: Bringing back the System Monitor (failed)<a href="#task-3-bringing-back-the-system-monitor-failed" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>The one Gnome tool I did think was worth keeping was System Monitor. I tried adding it to my list of <code>environment.systemPackages</code>, but then rebuilding failed:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>$ sudo nixos-rebuild switch
</span></span><span><span>building Nix...
</span></span><span><span>building the system configuration...
</span></span><span><span>error: undefined variable <span>&#39;gnome-system-monitor&#39;</span>
</span></span><span><span>
</span></span><span><span>       at /etc/nixos/configuration.nix:130:5:
</span></span><span><span>
</span></span><span><span>          129|     curl
</span></span><span><span>          130|     gnome-system-monitor
</span></span><span><span>             |     ^
</span></span><span><span>          131|   ];
</span></span><span><span>(use <span>&#39;--show-trace&#39;</span> to show detailed location information)
</span></span></code></pre></div><p>I tried other possible names like <code>gnome-shell-system-monitor</code>, but I couldnâ€™t figure out how to install it.</p><h2 id="things-id-like-to-understand-next">Things Iâ€™d like to understand next<a href="#things-id-like-to-understand-next" arialabel="Anchor"> ğŸ”—ï¸</a></h2><p>Iâ€™m happy with my first few days with Nix and NixOS. Itâ€™s about what I expected from what Iâ€™ve heard. It seems like it can be incredibly powerful when used well, but it requires a lot of upfront investment and scavenging for information.</p><p>Iâ€™ve only scratched the surface, so here are the things Iâ€™d like to learn about Nix next.</p><h3 id="using-vs-code-remote-ssh-on-nixos-systems">Using VS Code Remote SSH on NixOS systems<a href="#using-vs-code-remote-ssh-on-nixos-systems" arialabel="Anchor"> ğŸ”—ï¸</a></h3><p>I do all of my development in VS Code over remote SSH. When I try remoting into my NixOS system from VS Code, the install fails. VS Code has to install some type of server on the target system, and VS Code probably doesnâ€™t know how to install on NixOS.</p><p>Thereâ€™s a <a href="https://github.com/nix-community/nixos-vscode-server">nixos-vscode-server</a> git repo, and thatâ€™s probably the solution I need. I havenâ€™t tried it yet.</p><h3 id="how-nixs-major-concepts-fit-together">How Nixâ€™s major concepts fit together<a href="#how-nixs-major-concepts-fit-together" arialabel="Anchor"> ğŸ”—ï¸</a></h3><p>I see words like â€œflakesâ€ and â€œderivations,â€ and I currently donâ€™t know what they mean. I donâ€™t understand Nixâ€™s language syntax, but itâ€™s enough like JavaScript and Python that I can fake my way through at this point. But to use Nix effectively, Iâ€™m obviously going to need to learn the language.</p><h3 id="when-does-the-determinism-happen">When does the determinism happen?<a href="#when-does-the-determinism-happen" arialabel="Anchor"> ğŸ”—ï¸</a></h3><p>When I see discussion of Nix, one of the top features I see mentioned is the fact that Nix is deterministic.</p><p>So far, I donâ€™t get how itâ€™s deterministic. When I specified packages to install, I didnâ€™t specify an integrity hash, let alone a version number. If I ran the same Nix configuration a year from now, I assume Iâ€™d get a different system because it would install different versions of the <code>vim</code> and <code>curl</code> packages I specified.</p><p>I assume there is a way of specifying package versions more precisely, but I havenâ€™t learned it yet.</p><h3 id="who-am-i-trusting">Who am I trusting?<a href="#who-am-i-trusting" arialabel="Anchor"> ğŸ”—ï¸</a></h3><p>When I specified packages, it was a plain list of package names:</p><div><pre tabindex="0"><code data-lang="text"><span><span>  environment.systemPackages = with pkgs; [
</span></span><span><span>    vim
</span></span><span><span>    curl
</span></span><span><span>  ];
</span></span></code></pre></div><p>For me to be able to specify packages like the above, Nix must be pulling packages from a default repository. Are there multiple repositories? How do I pick which repository to use?</p></div></div>
  </body>
</html>
