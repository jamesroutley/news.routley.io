<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://hanlab.mit.edu/blog/streamingllm">Original</a>
    <h1>How Attention Sinks Keep Language Models Stable</h1>
    
    <div id="readability-page-1" class="page"><p>We discovered why language models catastrophically fail on long conversations: when old tokens are removed to save memory, models produce complete gibberish. We found models dump massive attention onto the first few tokens as &#34;attention sinks&#34;—places to park unused attention since softmax requires weights to sum to 1. Our solution, StreamingLLM, simply keeps these first 4 tokens permanently while sliding the window for everything else, enabling stable processing of 4 million+ tokens instead of just thousands. This mechanism is now in HuggingFace, NVIDIA TensorRT-LLM, and OpenAI&#39;s latest models.</p><div><p>‍</p><p>This week, OpenAI made headlines by releasing their first open-source large language models, GPT-OSS-20B and GPT-OSS-120B. Buried in the technical documentation was a fascinating architectural detail: the inclusion of <strong>attention sink mechanisms</strong>.</p><p>Their implementation adds a trainable scalar value to each attention head&#39;s softmax calculation:</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/68953e9f8d1a14e5b43c4a08_Screenshot%202025-08-07%20at%205.02.12%E2%80%AFPM.png" loading="lazy" alt=""/></p></figure><p>‍</p><p>This simple modification—adding just one learnable parameter per attention head—enables the model to &#34;pay no attention to any tokens&#34; when needed, a design choice OpenAI&#39;s model card explicitly attributes to our <a href="https://arxiv.org/abs/2309.17453"><em>StreamingLLM</em></a> work.</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/68953ec17590788f3932d165_01_openai_model_card.png" loading="lazy" alt=""/></p><figcaption><a href="https://cdn.openai.com/pdf/419b6906-9da6-406c-a19d-1bb078ac7637/oai_gpt-oss_model_card.pdf"><em>OpenAI&#39;s model card</em></a><em> for GPT-OSS-20B explains the attention sink mechanism, directly connecting the design to our research.</em></figcaption></figure><p>‍</p><p>Seeing this feature in a major OpenAI release connected directly to research that began during my internship at Meta in the summer of 2023, when I was tasked with solving what seemed like a simple problem: </p><blockquote>How do you make a language model handle conversations longer than what it was trained for?</blockquote><p>This is the story of <strong>attention sinks</strong>: how we discovered this mechanism that every Transformer relies on, why it&#39;s crucial for model stability, and how this research has found its way into production AI systems.</p><h3><strong>The Streaming Challenge</strong></h3><p>In the beginning of the 2023 summer, I was presented with a fundamental question:</p><p><em>How can we make a language model handle conversations longer than what it was trained for?</em></p><p>The challenge affects any real-world AI application. Consider a chatbot engaged in an ongoing conversation—it needs to be aware of the recent context, but it can&#39;t afford to re-process the entire conversation history with every new word it generates. The computational cost would grow quadratically, making long conversations prohibitively expensive.</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/689564b728d02538b942000c_Screenshot%202025-08-07%20at%207.44.34%E2%80%AFPM.png" loading="lazy" alt=""/></p><figcaption>Dense attention has a quadratic time complexity and an increasing cache size. It performance decreases when the text length exceeds the pre-training text length.</figcaption></figure><p>‍</p><p>The obvious solution seemed to be a <strong>sliding window approach</strong>: keep a fixed-size cache of the most recent tokens&#39; internal states (their Key and Value vectors, known as the KV cache) and simply drop the oldest ones as the conversation grows. This approach is efficient and—as we discovered—fails spectacularly.</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/6895651910922ac3793f2ea3_Screenshot%202025-08-07%20at%207.44.46%E2%80%AFPM.png" loading="lazy" alt=""/></p><figcaption>Window Attention caches the most recent tokens’ KV. While efficient in inference, performance declines sharply oncethe starting tokens’ keys and values are evicted.</figcaption></figure><p>Our experiments revealed a stark and unexpected result: the moment we removed the very first few tokens from the cache, the model&#39;s performance collapsed entirely. The perplexity—a distance between the model&#39;s predictions and the ground truths—skyrocketed. Models that had been generating perfectly coherent text suddenly began producing complete nonsense.</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/68953fb16fee2a53dc5974fb_04_perplexity_failure.png" loading="lazy" alt=""/></p><figcaption><em>The model&#39;s perplexity skyrockets the moment the initial tokens are evicted from the cache, indicating catastrophic failure.</em></figcaption></figure><p>This was puzzling. The first few tokens often carried minimal semantic information—sometimes just a start-of-sequence marker or common words like &#34;the&#34; or &#34;a.&#34; Why would removing these seemingly insignificant tokens cause such catastrophic failure?</p><h3><strong>The Discovery: When Attention Gets into Sinks</strong></h3><p>When I began visualizing the attention patterns inside models like Llama-2, a consistent and unexpected pattern emerged. Across most layers, large amounts of attention were being directed toward the very first tokens in the sequence. Regardless of what the current token was trying to predict, it would often &#34;look back&#34; toward the beginning.</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/68953fe0c2a45acce0941c9f_05_attention_visualization.png" loading="lazy" alt=""/></p><figcaption><em>Attention visualization showing a heavy focus on the first tokens across multiple layers in LLaMA-2.</em></figcaption></figure><p>‍</p><p>The behavior reminded me of graph theory from my undergraduate studies. <em>In directed graphs, a </em><strong><em>sink node</em></strong><em> is defined as a vertex with no outgoing connections—it receives flow from other nodes but doesn&#39;t pass it along.</em> These initial tokens were behaving similarly: they were absorbing attention from across the sequence. This analogy led me to term them <strong>attention sinks</strong>.</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/68953ff1a6d5fc18da6d8251_06_graph_sink_diagram.png" loading="lazy" alt=""/></p><figcaption><em>A visual representation of a sink in a directed graph. (Source: mathworld.wolfram.com)</em></figcaption></figure><p>‍</p><h4><strong>The Mathematical Foundation</strong></h4><p>The mathematics behind this behavior reveals a fundamental constraint of the Transformer architecture. In the attention mechanism, we compute attention weights using the softmax function:</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/689540336fee2a53dc59b5ff_Screenshot%202025-08-07%20at%205.09.00%E2%80%AFPM.png" loading="lazy" alt=""/></p></figure><p>The softmax function forces all attention weights to sum to exactly 1.0:</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/68954039d18adaaf6c0ee92f_Screenshot%202025-08-07%20at%205.09.05%E2%80%AFPM.png" loading="lazy" alt=""/></p></figure><p>‍</p><p>This creates what Evan Miller eloquently described as a <a href="https://www.evanmiller.org/attention-is-off-by-one.html">&#34;deafening democracy where abstention is disallowed.&#34;</a> Every attention head <em>must</em> allocate its focus somewhere, even when it has no meaningful information to contribute.</p><p>When a token encounters no particularly relevant context to attend to, where does that mandatory attention &#34;budget&#34; go? In practice, some positions (especially the initial tokens) tend to have slightly higher baseline scores due to their consistent presence across training examples. This small bias gets amplified through training, causing these positions to evolve into specialized repositories for otherwise unused attention—functioning as computational pressure valves.</p><h4><strong>Not a New Phenomenon</strong></h4><p>This phenomenon wasn&#39;t entirely new. <a href="https://arxiv.org/abs/1906.04341">Researchers had observed similar patterns in BERT</a>, where &#34;a surprisingly large amount of attention focuses on the delimiter token [SEP] and periods,&#34; which they argued was used by the model as a sort of no-op. The same summer at Meta, <a href="https://arxiv.org/abs/2309.16588">researchers studying vision transformers found similar behavior,</a> observing that models would repurpose uninformative background patches as computational scratchpads.</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/6895404b06afb0c46baf1118_07_bert_attention_patterns.png" loading="lazy" alt=""/></p></figure><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/6895405806afb0c46baf178e_08_vision_transformer_patterns.png" loading="lazy" alt=""/></p></figure><p><em>Researchers observed similar sink-like behavior in both NLP models like BERT and vision models.</em></p><p>‍</p><h4><strong>The Revelation</strong></h4><p>Our discovery suddenly illuminated why the sliding window approach failed so catastrophically. When we evicted those initial tokens, we weren&#39;t simply removing old context—we were removing a huge proportion of the denominator in the softmax function, dismantling the model&#39;s fundamental mechanism for maintaining attention stability. We had inadvertently removed its pressure valve.</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/6895406c7590788f393425d0_09_sliding_window_failure.png" loading="lazy" alt=""/></p><figcaption><em>Illustration of why sliding window approaches fail when attention sinks are removed.</em></figcaption></figure><p>‍</p><h3><strong>The Simple Fix: Just Don&#39;t Throw Away the Sinks</strong></h3><p>Understanding the problem led us to an almost embarrassingly simple solution: if these already-trained models desperately need attention sinks, why not just never throw them away?</p><p>Our work, <strong>StreamingLLM</strong>, introduced a surprisingly straightforward modification to standard KV cache management. Instead of discarding the first few tokens like any others, we permanently preserve their Key and Value states while maintaining a sliding window for everything else.</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/68953de16fee2a53dc580b4d_10_streaminglLM_diagram.png" loading="lazy" alt=""/></p><figcaption><em>Diagram comparing a standard sliding window to the StreamingLLM approach, where the first few &#34;sink&#34; tokens are always kept in the cache.</em></figcaption></figure><p>‍</p><p>The implementation couldn&#39;t be simpler:</p><pre contenteditable="false"><code><span># StreamingLLM: Always keep the first few tokens as attention sinks</span><span>
</span><span></span><span>def</span><span> </span><span>get_streaming_kv_cache</span><span>(</span><span>full_history, window_size=</span><span>1020</span><span>, sink_size=</span><span>4</span><span>):</span><span>
</span><span>    </span><span># Never discard the first few tokens - they&#39;re our attention sinks</span><span>
</span>    sink_tokens = full_history[:sink_size]
<span>    </span><span># Maintain a sliding window for the actual content</span><span>
</span>    recent_tokens = full_history[-(window_size - sink_size):]
<span>    </span><span># Combine permanent sinks with recent content</span><span>
</span><span>    </span><span>return</span><span> sink_tokens + recent_tokens</span></code></pre><p>The results were remarkable. Models like LLaMA that previously collapsed after a few thousand tokens could now maintain stable perplexity across <strong>4 million tokens</strong>—processing sequences orders of magnitude longer than their original training context. We had unlocked infinite-length generation simply by respecting the model&#39;s existing attention patterns.</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/689540d077afb7e97969b315_11_performance_results.png" loading="lazy" alt=""/></p><figcaption><em>The perplexity of StreamingLLM remaining low and stable across 4 million tokens, while other methods fail.</em></figcaption></figure><p>‍</p><h3><strong>But Why Four Sinks? The Pre-Training Question</strong></h3><p>This success raised an intriguing follow-up question: why did we need to preserve <strong>four</strong> attention sink tokens? Could we get away with just one?</p><p>This curiosity led us to our pre-training experiments. We trained two identical 160-million parameter models from scratch—one with standard training, and another that included a dedicated [SINK] token at the start of every training sample.</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/6895410306afb0c46baf8f29_12_pretraining_convergence.png" loading="lazy" alt=""/></p><figcaption><em>Adding a sink token during pre-training benefits the model&#39;s convergence trend and zero-shot performance across several NLP benchmarks.</em></figcaption></figure><p>‍</p><p>The results revealed something profound: the model trained with a dedicated sink token needed only <strong>one</strong> attention sink during streaming, while the vanilla model required <strong>four</strong> repurposed content tokens to maintain stability. Moreover, the model with the purpose-built sink actually converged slightly better during training.</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/6895419ba1a382b9e1711fe3_13_sink_comparison.png" loading="lazy" alt=""/></p><figcaption><em>Training without dedicated sinks and with SoftMax-off-by-one (Zero Sink) still requires multiple initial tokens to stabilize performance—indicating multiple implicit sinks—whereas a single learnable sink token alone is sufficient.</em></figcaption></figure><p>‍</p><p>This experiment showed that models can learn to use purpose-built attention sinks more efficiently than hijacking existing content tokens—a finding that would influence how attention mechanisms are designed from the ground up.</p><h3><strong>Two Paths to the Same Solution: Our Design vs. OpenAI&#39;s</strong></h3><p>Interestingly, OpenAI&#39;s recent implementation represents a different approach to solving the same problem. Where we use a dedicated sink token k<sub>0</sub> at the sequence start:</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/6895415d77afb7e97969d5e5_Screenshot%202025-08-07%20at%205.14.01%E2%80%AFPM.png" loading="lazy" alt=""/></p></figure><p>‍</p><p>OpenAI simplified this with a universal scalar approach:</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/68954164d18adaaf6c0f3e83_Screenshot%202025-08-07%20at%205.14.05%E2%80%AFPM.png" loading="lazy" alt=""/></p></figure><p>‍</p><p>The key difference lies in flexibility versus simplicity. Our approach learns a full token embedding that can interact differently with each query—some tokens might &#34;need&#34; the sink more than others based on their learned representations. OpenAI&#39;s scalar approach instead adds a single learnable value that acts as a universal escape valve, the same for all tokens regardless of their content.<br/></p><p>OpenAI&#39;s design is more parameter-efficient—just one scalar per attention head rather than full key-value embeddings—and easier to retrofit into existing architectures. Our approach potentially offers more expressiveness but requires modifying the training data to include sink tokens. Both successfully solve the fundamental problem: giving attention somewhere to go when it has nothing meaningful to attend to.</p><h3><strong>The Science Behind the Sink: Recent Discoveries</strong></h3><p>Since our work, researchers have deepened our understanding of why attention sinks emerge and how they function.</p><p><a href="https://arxiv.org/abs/2504.02732">Barbero et al.</a> have shown that attention sinks serve as &#34;pressure valves&#34; preventing what researchers call <strong>&#34;over-mixing&#34;</strong>—a pathological state where deep models processing long sequences blur important distinctions between tokens. The presence of a sink draws attention away from other tokens, limiting the spread of information (and noise) and resulting in more stable embeddings. This effect becomes more pronounced in larger models; LLaMA 3.1 405B shows attention sinks in a remarkable <strong>80% of its attention heads</strong>.</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/689541c9aebe1e5eee795227_14_overmixing_diagram.png" loading="lazy" alt=""/></p><figcaption><em>Research shows sinks slow the mixing of information, making Transformers more robust. A perturbation (red) spreads less with a sink (right) than without (left). (Source: </em><a href="https://arxiv.org/abs/2504.02732"><em>Barbero et al.</em></a><em>)</em></figcaption></figure><p>‍</p><p><a href="https://arxiv.org/abs/2410.10781">Gu et al.</a> has traced sink formation to the fundamental constraint of softmax normalization. As we noted, when attention weights must sum to 1.0, models need a default place to allocate their attention budget. Tellingly, replacing softmax with other attention operations that don&#39;t have this constraint prevents sinks from forming entirely.</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/689541dcaebe1e5eee7957ce_15_kv_biases_table.png" loading="lazy" alt=""/></p><figcaption><em>Table from </em><a href="https://arxiv.org/abs/2410.10781"><em>Gu et al.</em></a><em> showing how KV biases can prevent sink formation.</em></figcaption></figure><p>‍</p><h4><strong>Practical Applications</strong></h4><p>These insights have inspired practical applications. <a href="https://arxiv.org/abs/2502.01563v4">Sun et al.</a> directly introduced learnable key and value parameters (<strong>KV biases</strong>) into the attention mechanism, finding this design could alleviate the massive activations seen during inference—essentially the same approach as our learnable sink experiments. Building on this understanding, <a href="https://arxiv.org/abs/2406.12016"><strong>&#34;CushionCache&#34;</strong> by Son et al.</a> uses deliberately designed attention sink prefixes that improve model quantization by reducing activation outliers.</p><p>‍</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/689541f508148cd59c684d77_16_learnable_kv_biases.png" loading="lazy" alt=""/></p><figcaption><a href="https://arxiv.org/abs/2502.01563v4"><em>Diagram from Sun et al.</em></a><em> showing the architectural addition of learnable KV biases.</em></figcaption></figure><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/689542087590788f39357652_17_cushioncache_results.png" loading="lazy" alt=""/></p><figcaption><a href="https://arxiv.org/abs/2406.12016"><em>Techniques like CushionCache (Son et al.)</em></a><em> use sinks to tame activation spikes, improving quantization.</em></figcaption></figure><p>‍</p><p>Given this connection between attention sinks and quantization stability, it&#39;s intriguing to speculate that OpenAI&#39;s built-in attention sink mechanism may partly enable the <strong>aggressive 4-bit weight quantization</strong> in their open-source models.</p><figure><p><img src="https://cdn.prod.website-files.com/64f4e81394e25710d22d042e/689567a19625daa1804dedc9_Screenshot%202025-08-07%20at%207.56.43%E2%80%AFPM.png" loading="lazy" alt=""/></p><figcaption><a href="https://cdn.openai.com/pdf/419b6906-9da6-406c-a19d-1bb078ac7637/oai_gpt-oss_model_card.pdf">OpenAI&#39;s aggressive 4-bit quantization</a> in their open-source models likely benefits from the built-in attention sink mechanism, which helps prevent the activation outliers that typically plague extreme quantization. </figcaption></figure><h3><strong>From Research to Reality</strong></h3><p>What began as a practical engineering problem during my internship has evolved into a fundamental insight about Transformer architecture. The attention sink mechanism we discovered has since been adopted across the industry, appearing in production systems like OpenAI&#39;s models and inspiring new research directions in quantization and model optimization.</p><p>The adoption happened remarkably quickly. By October 2023, Intel integrated StreamingLLM into their Extension for Transformers, enabling continuous LLM inference on CPUs with just 3 lines of code. December 2023 saw explosive adoption: HuggingFace integrated attention sinks into their main Transformers branch, and just days later, researchers from CMU, UW, and OctoAI demonstrated endless LLM generation running directly on iPhones, noting that &#34;attention sinks are particularly helpful for longer generation with less memory requirement.&#34; The momentum continued into 2024 with NVIDIA incorporating StreamingLLM into TensorRT-LLM in January. Now, in August 2025, OpenAI released their open-source models with built-in attention sink parameters, bringing the mechanism full circle from research discovery to production implementation.</p><p>Sometimes an impactful discovery emerges not from grand theoretical breakthroughs, but from carefully investigating the curious details that others might overlook. In our case, questioning why a few seemingly meaningless tokens were so critical led us to uncover a mechanism that every Transformer model relies on—one that was hiding in plain sight.</p><h2>References</h2><ol start="" role="list"><li><strong>Xiao, G., Tian, Y., Chen, B., Han, S., &amp; Lewis, M.</strong> (2024). <em>Efficient Streaming Language Models with Attention Sinks</em>.</li><li><strong>OpenAI</strong> (2025). <em>GPT-OSS Model Card</em>. <a href="https://cdn.openai.com/pdf/419b6906-9da6-406c-a19d-1bb078ac7637/oai_gpt-oss_model_card.pdf">https://cdn.openai.com/pdf/419b6906-9da6-406c-a19d-1bb078ac7637/oai_gpt-oss_model_card.pdf</a></li><li><strong>Miller, E.</strong> (2021). <em>Attention Is Off By One</em>. <a href="https://www.evanmiller.org/attention-is-off-by-one.html">https://www.evanmiller.org/attention-is-off-by-one.html</a></li><li><strong>Clark, K., Khandelwal, U., Levy, O., &amp; Manning, C. D.</strong> (2019). <em>What Does BERT Look At? An Analysis of BERT&#39;s Attention</em>.</li><li><strong>Darcet, T., Oquab, M., Mairal, J., &amp; Bojanowski, P.</strong> (2024). <em>Vision Transformers Need Registers.</em></li><li><strong>Barbero, F., Arroyo, Á., Gu, X., Perivolaropoulos, C., Bronstein, M., Veličković, P., &amp; Pascanu, R.</strong> (2024). <em>Why do LLMs attend to the first token?</em> </li><li><strong>Gu, X., Pang, T., Du, C., Liu, Q., Zhang, F., Du, C., &amp; Wang, Y.</strong> (2024). <em>When Attention Sink Emerges in Language Models: An Empirical View</em>.</li><li><strong>Sun, M., Chen, X., Kolter, J. Z., &amp; Liu, Z.</strong> (2024). <em>Massive Activations in Large Language Models</em>.</li><li><strong>Son, S., Park, W., Han, W., Kim, K., &amp; Lee, J.</strong> (2024). <em>Prefixing Attention Sinks can Mitigate Activation Outliers for Large Language Model Quantization</em>.</li><li><strong>Wolfram Research</strong> (2024). <em>Digraph Sink</em>. <a href="https://mathworld.wolfram.com/DigraphSink.html">https://mathworld.wolfram.com/DigraphSink.html</a></li></ol></div></div>
  </body>
</html>
