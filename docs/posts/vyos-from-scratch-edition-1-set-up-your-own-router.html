<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.kroy.io/2020/05/04/vyos-from-scratch-edition-1/">Original</a>
    <h1>VyOS From Scratch – Edition 1 (set up your own router)</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="text">
	
<hr/>



<p><em>2023-07-27 </em><strong>Hey Hacker News! </strong>blog suddenly got VERY busy</p>



<p><a href="https://news.ycombinator.com/user?id=k_roy">https://news.ycombinator.com/user?id=k_roy</a></p>



<hr/>



<p>As a VyOS evangelist, maintainer, and more, I’ve been meaning to write a simple series of “how-to” guides for VyOS for a while.  Sure, there are plenty of guides out there, but I think a lot of them fall short in demonstrating WHY you are entering specific commands.  </p>



<p>VyOS is capable, but it’s much more helpful if you can fully understand what it’s doing.  </p>



<p>This initial guide will walk through the basic setup steps in replacing something like pfSense or some other consumer router with a simple and secure system running VyOS.  </p>



<p>This is also going to be a very very long post, so buckle in!</p>



<hr/>





<hr/>



<h2><span id="Who_is_this_For">Who is this For</span></h2>



<p>Anybody that wants to use VyOS of course!  </p>



<p>The nice thing about running VyOS is that if you set up it, and understand <strong><em>WHAT</em></strong> it’s doing, then you’ve actually learned something about networking.  </p>



<p>Does something like pfSense work?  </p>



<p>Sure, but it also doesn’t teach you much about what’s actually going on.  And the knowledge learned in VyOS will easily translate to almost any other vendor like Cisco, Arista, and more.  At that point, the concepts are the same, you are just learning the different dialects. </p>



<hr/>



<h2><span id="Environment">Environment</span></h2>



<p>VyOS really doesn’t take much in resources.  </p>



<p>8GB of storage and 2-4GB of RAM will be overkill for most basic setups.  </p>



<p>CPU-wise, even small Pentium Silver CPUs can handle gigabit and beyond, even over VPN .  Anything like an i3/i5 or a Xeon won’t break a sweat except in all but the most demanding scenarios.</p>



<p>If you virtualize, it can be helpful to set up a test environment.  This could consist of a simple:</p>



<ul>
<li>WAN Network.  For testing this could be your existing LAN network.</li>



<li>A new “LAN” Network. For testing this could just be a separate port group or bridge, and it wouldn’t even need an uplink.</li>



<li>A simple VM with a GUI (or without), to run some testing. </li>
</ul>



<p>If virtualization isn’t an option, VyOS can run on almost any device that is x86_64.  I’ve run it on everything from:</p>



<ul>
<li>NUCs with single NICs and USB/USB-C NICs.</li>



<li><a href="https://blog.kroy.io/2019/12/08/the-wyse-5070-a-perfect-little-vyos-device/" target="_blank" rel="noreferrer noopener">WYSE 5070/3040 Thin Clients</a>.</li>



<li>A variety of Dells, including R710s/R620s/R630s.</li>



<li>Anything Supermicro from 1U to 4U devices.</li>
</ul>



<p>Finally, for this guide, I’ll be working with two NICs.  </p>



<p>One is a WAN, connected to my current LAN.  I’ll be creating a “network inside a network”.  The second will be our new “LAN”.  This is separate from my existing LAN so I can pretend like it’s a second private network.  These interfaces can be anything:</p>



<ul>
<li>Physical NICs.</li>



<li>VLANs.</li>



<li>Virtual NICs from ESXi, Proxmox, etc.</li>
</ul>



<hr/>







<p>The first step is to grab yourself a copy of the installer ISO.  </p>



<p>Most people will want the <a href="https://www.vyos.io/rolling-release/" target="_blank" rel="noreferrer noopener">Rolling Release</a>.  You can also build it yourself, via the <a href="https://docs.vyos.io/en/latest/contributing/build-vyos.html" target="_blank" rel="noreferrer noopener">Docker image</a>, which is helpful if there are some extra packages you want to add.</p>



<p>If you want access to the LTS version, it requires self-building (an easy process), contributing, or a subscription. I <a href="https://blog.vyos.io/vyos-access-subscriptions-for-documentation" target="_blank" rel="noreferrer noopener">highly recommend contributing</a>, as even writing or cleaning up some documentation will get you access to the LTS prebuilt versions.  </p>



<p>You can also support and get access via <a href="https://www.patreon.com/vyos" target="_blank" rel="noreferrer noopener">Patreon</a> or <a href="https://www.buymeacoffee.com/kUa78LT" target="_blank" rel="noreferrer noopener">BuyMeACoffee</a>.</p>



<hr/>



<p>Note that for these guides, I will be using a recent version of rolling.  This is important as some configuration nodes have changed locations and format between 1.3+ and the existing LTS versions (DHCP and IPv6 RAs are two things that come to mind).</p>


<div id=""><p>Rolling Stability</p><div><p>
It’s important to note that the rolling releases are generally completely stable.  I would say 95% of them or more are functional without any major bugs.
</p><p>Every once in a while, some broken functionality is pushed, but it is almost always fixed quickly. A broken upgrade is not a show-stopper and it is trivial to boot back into the working version with the built-in <a href="https://docs.vyos.io/en/latest/image-mgmt.html" target="_blank" rel="noopener noreferrer">Image Management</a>.</p>
<p>I have no issues running rolling releases in many production locations.<br/>
</p></div></div>



<h2><span id="Install_Steps">Install Steps</span></h2>



<p>Installation is trivial:</p>



<ul>
<li>Burn ISO to CD/DVD/USB stick, or boot ISO via remote management (iDrac, iLo, IPMI)</li>



<li>Login with <code><em>vyos</em></code>/<code><em>vyos</em></code></li>



<li>Type <code><em>install image</em></code></li>



<li>Answer the install steps</li>



<li>Reboot and remove installation media</li>
</ul>


<div id=""><p>Installation Gotchas</p><div>
<ul>
<li> The installer ISO is a fully functional VyOS image.  That means if you skip the <em>install image</em> step, you can configure the system, and it will work as intended… until you reboot.  Don’t be me.  Make sure to install if you want a permanent installation.
</li><li> Some systems that lack a serial port get stuck on a black screen on the installer ISO.  The simple fix is to edit the grub boot option line and remove the <em>console=ttyS0,115200</em> option from the kernel boot arguments.  Then just boot with <em>CTRL-X</em> as directed.
</li></ul>
</div></div>



<figure><img decoding="async" width="720" height="404" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-2.png 720w, https://blog.kroy.io/wp-content/uploads/2020/04/image-2-300x168.png 300w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-2.png" data-sizes="(max-width: 720px) 100vw, 720px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<figure><img decoding="async" width="726" height="400" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-1.png 726w, https://blog.kroy.io/wp-content/uploads/2020/04/image-1-300x165.png 300w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-1.png" data-sizes="(max-width: 726px) 100vw, 726px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>







<p>Once installed, you’ll be staring at the login screen.  Login with <code>vyos</code> and the password you set up during install:</p>



<figure><img decoding="async" width="723" height="408" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image.png 723w, https://blog.kroy.io/wp-content/uploads/2020/04/image-300x169.png 300w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image.png" data-sizes="(max-width: 723px) 100vw, 723px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>



<h3><span id="Decision_Time">Decision Time!</span></h3>



<p>Before you go any further, you need to make a decision.  You need to pick out the subnet (or later subnets) where your network will live.  Or, if you are converting over your existing network, just reuse it.</p>



<p>These should be <a href="https://en.wikipedia.org/wiki/Private_network">RFC1918 addresses</a>.  You generally want a /24, which is 254 usable addresses.</p>



<p>So, there are three main groups of these private addresses you can choose from:</p>



<ul>
<li><code>10.X.Y.1-254</code>, where <code>X</code> and <code>Y</code> are any number between 0 and 255.  For the last number, 0 would be your “network” address, and 255 would be your broadcast address.  You could then assign all your hosts to 1-254.</li>



<li><code>172.X.Y.1-254</code>, in this case <code>X</code> would be between 16 and 31, and <code>Y</code> could be 0 to 255. </li>



<li><code>192.168.X.1-254</code>, where <code>X</code> is between 0 and 255.  </li>
</ul>



<div id=""><p>Subnetting Pro-tips</p><div>
<p>Many routers around the world off-the-shelf use a subnet like 10.0.0.0/24 or 192.168.0.0/24.</p>
<p>
While you can use these subnets, future-you will hate yourself if you ever want to access your network remotely or access other networks when both sides are using the same subnet.
</p>
<p>
I would highly recommend:
</p><ul>
 	<li>Choose a subnet away from the norm.  For example, 10.32.47.0/24.</li>
 	<li>If you want to plan ahead and are planning to break things out on VLANs, use a subnet like 10.32.X.0/24.  That way, in the future, X can represent your VLAN number, and you can do a summary route like 10.32.0.0/16.  I’ll be showing some examples of where this can be used later on in this post.</li></ul>

</div></div>



<hr/>



<h3><span id="Configuring_the_LAN_and_Remote_access">Configuring the LAN and Remote access</span></h3>



<p>After the subnet is chosen, the first step is to get the router on the LAN and accessible via SSH.  This makes it much easier to configure, as you are no longer tethered to a keyboard/monitor, VM console, can copy/paste, etc.  </p>



<h4><span id="LAN_IP">LAN IP</span></h4>



<hr/>



<p>Goals:</p>



<ul>
<li>Enter configure mode</li>



<li>Add address to the correct interface</li>



<li>Commit and save</li>
</ul>



<hr/>



<p>The first step is to enter configure mode.  This allows you to make changes to the system configuration.  Type <code>configure</code>.  VyOS also supports shortcuts and tab completion, so typing <code>conf</code> or <code>conf&lt;TAB&gt;</code> will do the same thing.</p>



<figure><img decoding="async" width="336" height="135" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-5.png 336w, https://blog.kroy.io/wp-content/uploads/2020/04/image-5-300x121.png 300w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-5.png" data-sizes="(max-width: 336px) 100vw, 336px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<p>The prompt will change to include <code>#</code>, and the <code>[edit]</code> line will appear to designate that you are in configure mode.</p>



<p>Next, you need to add your LAN IP.  You can check your interfaces by typing <code>run show interfaces</code>.  This tells VyOS to show all the interfaces in operational mode (the mode you were in before you typed <code>conf</code>).</p>



<figure><img decoding="async" alt="" width="580" height="98" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-4.png 600w, https://blog.kroy.io/wp-content/uploads/2020/04/image-4-300x51.png 300w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-4.png" data-sizes="(max-width: 580px) 100vw, 580px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<p>In my case, <code>eth1</code> is attached to my LAN here.  I’m going to use the subnet from above, <code>10.32.0.0/24</code>.  I prefer to use <code>.1</code> for my routers, but you can use any IP in that range.</p>



<p>There are two methods to assign it once in <code>conf</code> mode.  Either with the full path, or by drilling-down.</p>



<p>Full path:</p>



<pre><code>configure
set interfaces ethernet eth1 address 10.32.0.1/24
set interfaces ethernet eth1 description LAN
commit
save</code></pre>



<p>Drill down:</p>



<pre><code>configure
edit interfaces ethernet eth1
set address 10.32.0.1/24
set description LAN
commit
save</code></pre>



<p>Committing makes the configuration active, and saving saves it to disk so it will persist on a reboot.</p>



<figure><img decoding="async" width="1024" height="225" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-18-1024x225.png 1024w, https://blog.kroy.io/wp-content/uploads/2020/04/image-18-300x66.png 300w, https://blog.kroy.io/wp-content/uploads/2020/04/image-18-768x169.png 768w, https://blog.kroy.io/wp-content/uploads/2020/04/image-18-1536x337.png 1536w, https://blog.kroy.io/wp-content/uploads/2020/04/image-18-2048x450.png 2048w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-18-1024x225.png" data-sizes="(max-width: 1024px) 100vw, 1024px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<p>Or:</p>



<figure><img decoding="async" width="1024" height="293" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-19-1024x293.png 1024w, https://blog.kroy.io/wp-content/uploads/2020/04/image-19-300x86.png 300w, https://blog.kroy.io/wp-content/uploads/2020/04/image-19-768x220.png 768w, https://blog.kroy.io/wp-content/uploads/2020/04/image-19-1536x439.png 1536w, https://blog.kroy.io/wp-content/uploads/2020/04/image-19.png 1994w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-19-1024x293.png" data-sizes="(max-width: 1024px) 100vw, 1024px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<p>You can show your work with <code>show interfaces</code> and <code>run show interfaces</code></p>



<figure><img decoding="async" width="1024" height="693" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-20-1024x693.png 1024w, https://blog.kroy.io/wp-content/uploads/2020/04/image-20-300x203.png 300w, https://blog.kroy.io/wp-content/uploads/2020/04/image-20-768x520.png 768w, https://blog.kroy.io/wp-content/uploads/2020/04/image-20.png 1034w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-20-1024x693.png" data-sizes="(max-width: 1024px) 100vw, 1024px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<h4><span id="Set_up_DHCP">Set up DHCP</span></h4>



<p>Now that that router has a LAN IP, it’s time to connect your laptop/desktop/etc up to it.  </p>



<p>You can assign it a static IP in the chosen subnet (<code>10.32.0.10/24</code> for example), but I imagine you are also going to want to assign a DHCP range for automatic configuration of clients.</p>



<hr/>



<p>Goals:</p>



<ul>
<li>Enter configure mode</li>



<li>Set up DHCP ranges</li>



<li>commit and save</li>
</ul>



<hr/>



<p>Let’s talk about the following config.  </p>



<p>We are going to make two DHCP ranges, and leave some holes.  This would allow us to assign the IP addresses between <code>.2</code> and <code>.49</code> for static or other uses, as well as <code>.126-199</code> and <code>.251-254</code>.</p>



<p>While this is a non-standard usage, it demonstrates the capabilities. Many people would just have a single range. </p>



<pre><code>set service dhcp-server shared-network-name LAN subnet 10.32.0.0/24 range 0 start 10.32.0.50
set service dhcp-server shared-network-name LAN subnet 10.32.0.0/24 range 0 stop 10.32.0.125
set service dhcp-server shared-network-name LAN subnet 10.32.0.0/24 range 1 start 10.32.0.200
set service dhcp-server shared-network-name LAN subnet 10.32.0.0/24 range 1 stop 10.32.0.250</code></pre>



<p>Some other important config options follow.   </p>



<p>You want to tell the DHCP server to hand out the router’s IP address as the default gateway and DNS.  This will make it so (eventually), your LAN devices will have DNS and routing to the Internet:</p>



<pre><code>set service dhcp-server shared-network-name LAN subnet 10.32.0.0/24 dns-server 10.32.0.1
set service dhcp-server shared-network-name LAN subnet 10.32.0.0/24 default-router 10.32.0.1</code></pre>


<div id=""><p>DNS Alert</p><p>This would also be the place to insert something like your pi-hole or active directory DNS server.  In the above example, your pi-hole/ADDNS address or addresses would be where the dns-server option is. </p></div>







<figure><img decoding="async" alt="" width="580" height="230" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-8.png 781w, https://blog.kroy.io/wp-content/uploads/2020/04/image-8-300x119.png 300w, https://blog.kroy.io/wp-content/uploads/2020/04/image-8-768x305.png 768w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-8.png" data-sizes="(max-width: 580px) 100vw, 580px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<figure><img decoding="async" width="760" height="208" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-10.png 760w, https://blog.kroy.io/wp-content/uploads/2020/04/image-10-300x82.png 300w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-10.png" data-sizes="(max-width: 760px) 100vw, 760px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>



<h4><span id="SSH">SSH</span></h4>



<p>The final step before we can access the router over SSH is to actually enable SSH:</p>



<pre><code>set service ssh port 22
commit
save</code></pre>



<p>At this point you ought to be able to hook up a LAN client, and verify that you have an IP, gateway, and DNS.  </p>



<p>This is a fairly stock Debian VM I set up.  As you can see, my IP is in one of my DHCP ranges, and my DNS and default route are the router’s IP. </p>



<p>This is on Linux, but the same thing could be confirmed on Windows or MacOS:</p>



<figure><img decoding="async" width="736" height="472" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-16.png 736w, https://blog.kroy.io/wp-content/uploads/2020/04/image-16-300x192.png 300w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-16.png" data-sizes="(max-width: 736px) 100vw, 736px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<p>From there, you should be able to ssh into the router with the username <code>vyos</code> and password you set up during install:<br/></p>



<figure><img decoding="async" width="541" height="191" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-13.png 541w, https://blog.kroy.io/wp-content/uploads/2020/04/image-13-300x106.png 300w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-13.png" data-sizes="(max-width: 541px) 100vw, 541px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<p>And typing <code>show configuration</code> (in op mode), should show you the work done so far.  VyOS also comes with a few defaults, like NTP servers configured.</p>



<figure><img decoding="async" width="414" height="990" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-14.png 414w, https://blog.kroy.io/wp-content/uploads/2020/04/image-14-125x300.png 125w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-14.png" data-sizes="(max-width: 414px) 100vw, 414px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>







<h3><span id="NAT">NAT</span></h3>



<p>The next important duty for a router and firewall is to be able to NAT.  NAT allows all your private LAN devices to access the Internet.  </p>


<div id=""><p>Information Dump</p><div><p>
Back when the Internet started, every device had a unique IP address. 
</p><p>Unfortunately, because of the numbering scheme used, there are only 4.2 billion of these address, at least in IPv4, and the transition to IPv6 is far from complete.</p>
<p>Because of this, every device on your network needs to be able to “pretend” that it is your router to access the Internet.  Your router keeps track of which requests belong to which device.  </p>
<p>Source NAT is what allows you to do this.</p>
<p>This is also where the above mentioned “summary route” can come into play.  Instead of creating three separate NAT rules for 10.32.1.0/24, 10.32.2.0/24, and 10.32.3.0/24, you can create a single rule for 10.32.0.0/16.<br/>
</p></div></div>



<p>For this setup, it’s important to identify which network interface will eventually be your WAN interface, even though it’s not configured yet.</p>



<hr/>



<p>Goals:</p>



<ul>
<li>As before, enter configuration mode.</li>



<li>Set up a source NAT rule to target our LAN or LAN subnets.</li>



<li>Define the outgoing WAN interface on the rule.</li>



<li>Set the translation type of the rule to <code>masquerade</code>. </li>
</ul>



<hr/>



<p>The type of NAT we will be using is called <code>SOURCE NAT</code>.  This type of NAT is going to have three components:</p>



<ul>
<li>Target all traffic from our LAN or LANs…</li>



<li>… when the traffic is going out to the Internet through this outgoing interface…</li>



<li>… Change the IP address from the LAN IP to the WAN IP</li>
</ul>



<p>To do this:</p>



<pre><code>set nat source rule 100 source address &#39;10.32.0.0/24&#39;
set nat source rule 100 outbound-interface &#39;eth0&#39;
set nat source rule 100 translation address masquerade
commit
save</code></pre>



<p>In the above example, the <code>100</code> is an arbitrary number (between 1-9999).  The <code>eth0</code> is my eventual WAN interface.  <code>masquerade</code> translates the internal LAN IP to your public WAN IP.  </p>







<figure><img decoding="async" width="962" height="768" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-21.png 962w, https://blog.kroy.io/wp-content/uploads/2020/04/image-21-300x240.png 300w, https://blog.kroy.io/wp-content/uploads/2020/04/image-21-768x613.png 768w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-21.png" data-sizes="(max-width: 962px) 100vw, 962px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<p>Once we set up our WAN interface, we’ll be able to type <code>show nat source rules</code> in op mode, or <code>run show nat source rules</code> in conf mode to run the op mode command, it will be clear what’s happening.</p>



<hr/>



<h3><span id="DNS">DNS</span></h3>



<p>The next step is to set up our VyOS instance as for DNS.  This will allow you to use local DNS and caching instead of your ISP’s, but also eventually will allow you run custom DNS and hosts. </p>



<hr/>



<p>Goals:</p>



<ul>
<li>Enter config mode</li>



<li>Set the DNS Listen Address</li>



<li>Set the subnets we are allowing from</li>



<li>Set the cache size to 0</li>



<li>commit and save</li>
</ul>



<hr/>



<pre><code>set service dns forwarding listen-address &#39;10.32.0.1&#39;
set service dns forwarding allow-from &#39;10.32.0.0/24&#39;
set service dns forwarding cache-size &#39;0&#39;
commit
save</code></pre>



<p>As mentioned, this accomplishes three things.  </p>



<ul>
<li>It tells VyOS to listen for DNS requests on its LAN IP, <code>10.32.0.1</code>.  </li>



<li>It limits requests from your LAN subnet.  </li>



<li>Finally, it sets the cache size to 0.  This is good to start out with to make sure everything is working, but later you can bump it up to speed up multiple requests for the same sites. </li>
</ul>



<hr/>


<div id=""><p>Opportunity Alert</p><div><p>
This is another opportunity to use the “summary” route that I’ve mentioned a few times.  
</p><p>Instead of allowing “10.32.0.0/24”, you would allow “10.32.0.0/16”.  This would ensure that as you add VLANs and subnets, your DNS will just work without adding a long list of /24s.<br/>
</p></div></div>



<hr/>



<figure><img decoding="async" width="508" height="212" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-22.png 508w, https://blog.kroy.io/wp-content/uploads/2020/04/image-22-300x125.png 300w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-22.png" data-sizes="(max-width: 508px) 100vw, 508px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>



<h4><span id="DNS_Forwarding">DNS Forwarding</span></h4>



<p>There is one more consideration to be made.  As configured, your DNS server will run in “recursor” mode.  This means it will take responsibility for fully resolving DNS on its own.  This may be a bad thing for a number of reasons:</p>



<ul>
<li>It leaks your IP to potential undesirables.  </li>



<li>It’s almost always slower, as you don’t get to benefit from the caches of a large service like CloudFlare or Google.  </li>
</ul>



<p>It’s quite simple to set up in forwarding mode, meaning when you make a DNS request, you end up asking an upstream resolver.  </p>



<p>In the following example, we’ll be using CloudFlare and Google:</p>



<pre><code>set service dns forwarding name-server 1.1.1.1
set service dns forwarding name-server 1.0.0.1
set service dns forwarding name-server 8.8.8.8
set service dns forwarding name-server 8.8.4.4
commit
save</code></pre>



<figure><img decoding="async" width="564" height="399" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-23.png 564w, https://blog.kroy.io/wp-content/uploads/2020/04/image-23-300x212.png 300w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-23.png" data-sizes="(max-width: 564px) 100vw, 564px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>



<h4><span id="System_DNS">System DNS</span></h4>



<p>One final step is to set the DNS for VyOS itself.  Everything we’ve done so far has just set up VyOS to be a DNS server for your clients.</p>



<p>This will be the DNS that is used, for example, when you do a VyOS update, ping or traceroute from VyOS, etc.</p>



<p>The easiest thing to do if you’ve been following this guide, is just to use the DNS server you set up above:</p>



<pre><code>set system name-server 10.32.0.1
commit
save</code></pre>



<p>This is also another spot where if you wanted to use Google, CloudFlare, or AD-DNS, you could plug in that IP:</p>



<figure><img decoding="async" alt="" width="760" height="276" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/05/image-13.png 760w, https://blog.kroy.io/wp-content/uploads/2020/05/image-13-300x109.png 300w" data-src="https://blog.kroy.io/wp-content/uploads/2020/05/image-13.png" data-sizes="(max-width: 760px) 100vw, 760px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<p>Alternatively, you call tell VyOS to use the DNS servers that it received from your WAN DHCP server with:</p>



<pre><code>set system name-servers-dhcp eth0</code></pre>







<hr/>







<p>If you’ve made it this far, congrats!  We are almost there! </p>



<p>This section will cover the creation of a zone-based firewall, which is far superior to the default method of attaching firewalls to interfaces.  </p>



<p>The reason it is superior is simple.  It’s a bit more hassle to set up, but it’s far easier to manage on an ongoing basis, plus, you start thinking about firewalling as flows of information from interface to interface.</p>



<hr/>



<p>Goals:</p>



<ul>
<li>Enter configuration mode</li>



<li>Create a firewall to allow all LAN traffic.</li>



<li>Create firewall to allow all LAN traffic to access VyOS itself.</li>



<li>Create a firewall to protect the router itself from WAN.</li>



<li>Create a firewall to protect LAN devices from WAN.</li>



<li>Commit</li>



<li>Create LOCAL/LAN zones.</li>



<li>Assign appropriate interfaces to zones.</li>



<li>Commit and save</li>
</ul>



<hr/>



<p>For as complex as firewalling seems, it’s actually pretty simple when you break it down.  </p>



<p>A firewall tracks connection “states” to determine what is and is not allowed.  This is where packets are originating and going to, ports involved, types of traffic like TCP/UDP/ICMP, and more.  </p>



<p>We are going to build a very simple firewall that assumes that we want to block everything externally, and allow everything from LAN.</p>



<p>So let’s dig right into it.</p>



<hr/>



<h2><span id="LAN">LAN</span></h2>



<p>First, create a firewall that will allow our LAN to access everything. This is a setup that would mimic what most consumer routers do:</p>



<pre><code>conf
set firewall name LAN-WAN default-action accept
set firewall name LAN-LOCAL default-action accept
commit
save</code></pre>



<p>The <code>LAN-WAN</code> and the <code>LAN-LOCAL</code> can be arbitrarily named anything.  I use this naming scheme because as mentioned above, it’s better to think about firewalls as controlling the flow of information through the router, and these names are self-documenting.</p>



<p><code>LOCAL</code> is a specific VyOS designation that means “this router”.  When you are attaching the firewall in the zones, LOCAL will be what you use to control traffic destined to the firewall itself.  </p>



<p>As should be obvious, we are just allowing everything.  But you can set whatever rules you wanted.  <code>LAN-WAN</code> would generally remain pretty open as it would be uncommon to block your own access to the Internet, but <code>LAN-LOCAL</code> might contain rules to maybe allow only specific devices access to manage the VyOS router.</p>



<p>Also note that we are just creating the firewalls here.  They don’t become active until you attach them to the zones.</p>



<figure><img decoding="async" width="894" height="376" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-24.png 894w, https://blog.kroy.io/wp-content/uploads/2020/04/image-24-300x126.png 300w, https://blog.kroy.io/wp-content/uploads/2020/04/image-24-768x323.png 768w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-24.png" data-sizes="(max-width: 894px) 100vw, 894px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>



<h2><span id="LOCAL">LOCAL</span></h2>



<p>As mentioned, the <code>LOCAL</code> zone is traffic destined for the VyOS router itself.  </p>



<p>In most cases, it will have a similar ruleset to the LAN one above, as most people want their router to have full access to the Internet and their LAN devices:</p>



<pre><code>conf
set firewall name LOCAL-WAN default-action accept
set firewall name LOCAL-LAN default-action accept
commit
save</code></pre>


<div id=""><p>Food for Thought</p><div>
<p>While I might be getting a little ahead of myself here, it’s important to note that you could use the same firewall instead of creating four different firewalls as we’ve done here.  The firewalls are just attached to interfaces or zones by names, so there’s nothing really stopping you from creating a single firewall and attaching it to four different places.</p>
<p>As a bit of a pro-tip though, I would recommend not doing this.  Eventually you’ll want them broken out, and it’s far more of a hassle to do it later than to just do it during initial setup.<br/>
</p></div></div>



<figure><img decoding="async" width="988" height="280" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/04/image-26.png 988w, https://blog.kroy.io/wp-content/uploads/2020/04/image-26-300x85.png 300w, https://blog.kroy.io/wp-content/uploads/2020/04/image-26-768x218.png 768w" data-src="https://blog.kroy.io/wp-content/uploads/2020/04/image-26.png" data-sizes="(max-width: 988px) 100vw, 988px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>



<h2><span id="WAN">WAN</span></h2>



<p>The <code>WAN</code> zone is where we are actually going to do most of our work.  </p>



<p>The basic goal here will be two things.  To block all access to the router itself, and to provide basic setup and template for future things like port forwarding to our LAN.  </p>



<p>When you start moving data to and from the Internet, that’s when you need to start worrying about the state tracking I mentioned before.  </p>



<p>For both LOCAL and LAN traffic, we’ll be setting up what’s known as a “stateful firewall”.  </p>



<p>In stateful firewalling, there are three main states to worry about:</p>



<ul>
<li>New – Traffic in a <code>NEW</code> state is the first packet from a destination to a source.  Allowing or denying this packet ultimately determines whether the traffic will be allowed.</li>



<li>Established – Once traffic from <code>NEW</code> has been allowed, the subsequent packets are marked as <code>ESTABLISHED</code>.  This is essentially traffic that has already been allowed by other rules.  This is another basic requirement for a working stateful firewall.</li>



<li>Related – This means that this is traffic that is somehow related to already allowed traffic.  Also required.</li>
</ul>


<div id=""><p>A note about rule numbers</p><div><p>
As with the NAT rule numbers, the rule numbers you use for firewall are arbitrary.</p></div></div>



<hr/>



<h3><span id="WAN-LOCAL">WAN-LOCAL</span></h3>



<p>As mentioned, the <code>WAN-LOCAL</code> firewall is traffic destined for the VyOS router itself.  In the future, this will be where you allow traffic, say to your WireGuard port for VPN.</p>



<p>The first rule we want to build is to allow all <code>ESTABLISHED</code> and <code>RELATED</code> traffic.  So we’ll:</p>



<ul>
<li>Create the WAN-LOCAL firewall.  </li>



<li>Set the default policy on the firewall to drop everything.  </li>



<li>Create a rule to accept specific traffic for rule.</li>



<li>Set the match for the rule to our established and related states.</li>



<li>Set a description for ease of use later.</li>
</ul>







<pre><code>set firewall name WAN-LOCAL default-action drop
set firewall name WAN-LOCAL rule 5 action accept
set firewall name WAN-LOCAL rule 5 state established enable
set firewall name WAN-LOCAL rule 5 state related enable
set firewall name WAN-LOCAL rule 5 description &#34;Allow EST/Related Traffic&#34;
commit
save</code></pre>



<figure><img decoding="async" width="1024" height="660" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/05/image-1024x660.png 1024w, https://blog.kroy.io/wp-content/uploads/2020/05/image-300x193.png 300w, https://blog.kroy.io/wp-content/uploads/2020/05/image-768x495.png 768w, https://blog.kroy.io/wp-content/uploads/2020/05/image.png 1232w" data-src="https://blog.kroy.io/wp-content/uploads/2020/05/image-1024x660.png" data-sizes="(max-width: 1024px) 100vw, 1024px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>



<p>The next rule we want on is to allow ICMP.  Many people like to block this, but not me.  I’ll defer to <a href="http://shouldiblockicmp.com/">ShouldIBlockICMP.com</a> on this.</p>



<ul>
<li>Create a new rule matching ICMP</li>



<li>Match the state of <code>NEW</code>. This is what actually matches the unknown traffic to allow</li>



<li>Allow the traffic</li>



<li>Commit and save</li>
</ul>



<pre><code>set firewall name WAN-LOCAL rule 20 protocol icmp
set firewall name WAN-LOCAL rule 20 state new enable
set firewall name WAN-LOCAL rule 20 action accept
commit
save</code></pre>



<p>And you can see that the firewall is created (but still not attached to any interfaces), by doing the <code>op mode</code> command <code>show interfaces</code>.</p>



<figure><img decoding="async" width="1024" height="900" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/05/image-1-1024x900.png 1024w, https://blog.kroy.io/wp-content/uploads/2020/05/image-1-300x264.png 300w, https://blog.kroy.io/wp-content/uploads/2020/05/image-1-768x675.png 768w, https://blog.kroy.io/wp-content/uploads/2020/05/image-1.png 1176w" data-src="https://blog.kroy.io/wp-content/uploads/2020/05/image-1-1024x900.png" data-sizes="(max-width: 1024px) 100vw, 1024px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<h3><span id="WAN-LAN">WAN-LAN</span></h3>



<p>For now, the <code>WAN-LAN</code> firewall is identical to the <code>WAN-LOCAL</code>.  In the future, this is where you will allow your port forward rules, or other traffic you want to send to your LAN devices, so it’s helpful to break it out beforehand.</p>



<p>As before, we create the firewall, set it to drop by default, allowed EST/RELATED, and allow ICMP, which won’t do anything now, but could be helpful in the future:</p>



<pre><code>set firewall name WAN-LAN default-action drop
set firewall name WAN-LAN rule 5 action accept
set firewall name WAN-LAN rule 5 state established enable
set firewall name WAN-LAN rule 5 state related enable
set firewall name WAN-LAN rule 5 description &#34;Allow EST/Related Traffic&#34;
set firewall name WAN-LAN rule 20 protocol icmp
set firewall name WAN-LAN rule 20 state new enable
set firewall name WAN-LAN rule 20 action accept</code></pre>



<p>Don’t forget you can dive down into levels as in the following example:</p>



<figure><img decoding="async" width="1002" height="672" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/05/image-2.png 1002w, https://blog.kroy.io/wp-content/uploads/2020/05/image-2-300x201.png 300w, https://blog.kroy.io/wp-content/uploads/2020/05/image-2-768x515.png 768w" data-src="https://blog.kroy.io/wp-content/uploads/2020/05/image-2.png" data-sizes="(max-width: 1002px) 100vw, 1002px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>



<p>Finally!  We have our firewalls set up and ready to deploy.  </p>



<hr/>







<p>If you’ve been paying attention, we still don’t have one <em>VERY</em> important piece to this puzzle. We still don’t have WAN access!</p>



<p>Of course I did this to protect your router during the initial setup phase.  Until you have firewalls ready to deploy, you probably don’t want to be kicking your brand new VyOS install out on the open Internet.  </p>



<hr/>



<h2><span id="Zones">Zones</span></h2>



<p>Zones are easily one of my favorite parts of VyOS, and something that in my opinion, puts it lightyears ahead of other firewall solutions.</p>



<p>Especially as your firewalling needs grow, zones just make it so <em>EASY</em>.  As I sort of touched on, zones are a bit more work initially, but save you <em>MUCH</em> more time in the future.</p>


<div id=""><p>Lockout Alert</p><div><p>
Be careful and pay attention here.  
</p><p>If you mistype something and are still configuring VyOS over SSH, you can potentially lock yourself out.<br/>
</p></div></div>



<p>The naming scheme as I’ve outlined above should be helpful here when creating our firewall zones.  It basically says <code>FROMZONE-&gt;TOZONE</code></p>



<p>So let’s run through the whole thing.  </p>



<p>Goals:</p>



<ul>
<li>Set the default action for the zone.  This should always be drop to cover yourself in case you miss something.</li>



<li>Apply the “For traffic from X zone to current zone, attach Y firewall”</li>



<li>Add the interfaces that are part of this zone</li>



<li>Repeat for all zones</li>



<li>commit</li>



<li>save</li>
</ul>



<hr/>



<p>So what does this look like for the LAN:</p>



<ul>
<li>In this example we are working on the LAN zone</li>



<li>We drop everything by default</li>



<li>We assign the <code>WAN-LAN</code> firewall to traffic from any interface in the below <code>WAN</code> zone</li>



<li>Similarly for the <code>LOCAL-LAN</code>.  This is traffic from the VyOS instance itself to LAN hosts.</li>



<li>We put <code>eth1</code> in our LAN zone.</li>
</ul>



<pre><code>set zone-policy zone LAN default-action drop
set zone-policy zone LAN from WAN firewall name WAN-LAN
set zone-policy zone LAN from LOCAL firewall name LOCAL-LAN
set zone-policy zone LAN interface eth1


</code></pre>



<hr/>



<p>Repeat all steps for the <code>LOCAL</code> zone.  The major difference here is the <code>local-zone</code> designation.  As I’ve mentioned a few times, <code>LOCAL</code> is a special designation that means “this firewall”, so you don’t attach interfaces:</p>



<pre><code>set zone-policy zone LOCAL local-zone
set zone-policy zone LOCAL from LAN firewall name LAN-LOCAL
set zone-policy zone LOCAL from WAN firewall name WAN-LOCAL
set zone-policy zone LOCAL default-action drop
</code></pre>



<hr/>



<p>Finally, the WAN zone is basically the same as the LAN zone. The only major change you should notice is that I just changed the firewall names and interface name:</p>



<pre><code>set zone-policy zone WAN from LAN firewall name LAN-WAN
set zone-policy zone WAN from LOCAL firewall name LOCAL-WAN
set zone-policy zone WAN interface eth0
set zone-policy zone WAN default-action drop</code></pre>



<figure><img decoding="async" width="1024" height="676" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/05/image-4-1024x676.png 1024w, https://blog.kroy.io/wp-content/uploads/2020/05/image-4-300x198.png 300w, https://blog.kroy.io/wp-content/uploads/2020/05/image-4-768x507.png 768w, https://blog.kroy.io/wp-content/uploads/2020/05/image-4.png 1176w" data-src="https://blog.kroy.io/wp-content/uploads/2020/05/image-4-1024x676.png" data-sizes="(max-width: 1024px) 100vw, 1024px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>



<p>If you were like me, you might have tried committing between steps.  Unfortunately, if you don’t set up everything at once, you’ll quickly discover that zones are interdependent on one another.  This happens because I’ve created the LAN zone, but the referenced WAN and LOCAL zones don’t exist yet.</p>



<figure><img decoding="async" width="1024" height="528" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/05/image-3-1024x528.png 1024w, https://blog.kroy.io/wp-content/uploads/2020/05/image-3-300x155.png 300w, https://blog.kroy.io/wp-content/uploads/2020/05/image-3-768x396.png 768w, https://blog.kroy.io/wp-content/uploads/2020/05/image-3.png 1168w" data-src="https://blog.kroy.io/wp-content/uploads/2020/05/image-3-1024x528.png" data-sizes="(max-width: 1024px) 100vw, 1024px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>



<h3><span id="Show_your_work">Show your work</span></h3>



<p>Hopefully, if you’ve done everything correctly, you should see all your zone policies set up under the <code>op mode</code> command <code>run show zone-policy</code>.  This view should make it obvious which traffic is flowing through what firewall:</p>



<figure><img decoding="async" width="838" height="1024" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/05/image-6-838x1024.png 838w, https://blog.kroy.io/wp-content/uploads/2020/05/image-6-245x300.png 245w, https://blog.kroy.io/wp-content/uploads/2020/05/image-6-768x939.png 768w, https://blog.kroy.io/wp-content/uploads/2020/05/image-6.png 872w" data-src="https://blog.kroy.io/wp-content/uploads/2020/05/image-6-838x1024.png" data-sizes="(max-width: 838px) 100vw, 838px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>



<h2><span id="WAN_Setup">WAN Setup</span></h2>



<p>Finally, here we are.  </p>



<p>Setting up your WAN. If you’ve made it this far, congrats.  You are basically 1 or 2 commands away from having a working router and firewall!</p>



<p>There are multiple ways to get a WAN address.  For simplicity’s sake, I’ll just cover two of them here, static and DHCP assignment.  For something like PPPoE, you’ll need a few more steps.</p>



<h3><span id="DHCP_Assignment">DHCP Assignment</span></h3>



<p>DHCP is when your router asks your ISP’s servers for what it should use for its IP address and routing information.  This is accomplished with one simple command (well, four if you add a description to the interface, and commit and save):</p>



<pre><code>set interfaces ethernet eth0 address dhcp
set interfaces ethernet eth0 description WAN
commit
save</code></pre>



<p>You can verify that the setup is complete with the <code>op mode</code> commands <code>run show interfaces</code> and <code>run show ip route</code>.  (I have some debug variables set, so ignore the extra output:</p>



<figure><img decoding="async" width="988" height="1024" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/05/image-8-988x1024.png 988w, https://blog.kroy.io/wp-content/uploads/2020/05/image-8-290x300.png 290w, https://blog.kroy.io/wp-content/uploads/2020/05/image-8-768x796.png 768w, https://blog.kroy.io/wp-content/uploads/2020/05/image-8-1482x1536.png 1482w, https://blog.kroy.io/wp-content/uploads/2020/05/image-8.png 1490w" data-src="https://blog.kroy.io/wp-content/uploads/2020/05/image-8-988x1024.png" data-sizes="(max-width: 988px) 100vw, 988px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<p>In the above output, <code>10.21.21.57</code> is the IP address I was assigned via DHCP.  The <code>show ip route</code> verifies that I have a default route.</p>


<div id=""><p>Information Dump</p><div><p>
Your “gateway” or default route, is the router your devices ask when they encounter an IP address that they don’t know how to get to.
</p><p>In the networking world, this is represented by <em>0.0.0.0/0</em>, which is a shortcut for <strong><em>the entire Internet</em></strong></p>
<p>So in the above example, this VyOS knows how to talk directly to anything in the 10.21.21.0/24 or 10.32.0.0/24 subnets because they are directly connected.  Anything outside of that, it needs to ask 10.21.21.1 for a route to it.<br/>
</p></div></div>



<h3><span id="Static_IP">Static IP</span></h3>



<p>Static IPs just skip the automatic configuration.  It’s up to your ISP how this is configured, but usually it’s an extra step, manually applying your default route.</p>



<p>So to duplicate my above DHCP configuration:</p>



<pre><code>set interfaces ethernet eth0 address 10.21.21.57/24
set protocols static route 0.0.0.0/0 next-hop 10.21.21.1
commit
save</code></pre>



<p>As you can see in the following screenshot, I forgot the exact format, so I hit my <code>&lt;TAB&gt;</code> button to get hints:</p>



<figure><img decoding="async" width="881" height="1024" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/05/image-12-881x1024.png 881w, https://blog.kroy.io/wp-content/uploads/2020/05/image-12-258x300.png 258w, https://blog.kroy.io/wp-content/uploads/2020/05/image-12-768x893.png 768w, https://blog.kroy.io/wp-content/uploads/2020/05/image-12.png 1106w" data-src="https://blog.kroy.io/wp-content/uploads/2020/05/image-12-881x1024.png" data-sizes="(max-width: 881px) 100vw, 881px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<h3><span id="Check_your_work">Check your work</span></h3>



<p>Assuming nothing has gone wrong, you should be able to verify everything with the <code>op mode</code> command <code>ping</code>.  So let’s hit Google with 4 pings:</p>



<p><code>run ping www.google.com count 4</code></p>



<p>If all goes well, you should see a response:</p>



<figure><img decoding="async" width="1024" height="264" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/05/image-9-1024x264.png 1024w, https://blog.kroy.io/wp-content/uploads/2020/05/image-9-300x77.png 300w, https://blog.kroy.io/wp-content/uploads/2020/05/image-9-768x198.png 768w, https://blog.kroy.io/wp-content/uploads/2020/05/image-9.png 1290w" data-src="https://blog.kroy.io/wp-content/uploads/2020/05/image-9-1024x264.png" data-sizes="(max-width: 1024px) 100vw, 1024px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>







<p>So wow, this post turned into a bit of a novel.  Hopefully if you’ve made it this far, your LAN clients now have accessible Internet. From a client, you should be able to ping google:</p>



<figure><img decoding="async" width="1024" height="402" alt="" data-srcset="https://blog.kroy.io/wp-content/uploads/2020/05/image-14-1024x402.png 1024w, https://blog.kroy.io/wp-content/uploads/2020/05/image-14-300x118.png 300w, https://blog.kroy.io/wp-content/uploads/2020/05/image-14-768x302.png 768w, https://blog.kroy.io/wp-content/uploads/2020/05/image-14.png 1416w" data-src="https://blog.kroy.io/wp-content/uploads/2020/05/image-14-1024x402.png" data-sizes="(max-width: 1024px) 100vw, 1024px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></figure>



<hr/>



<p>Obviously there are a lot of basic topics I haven’t covered yet.  But I wanted to lay out and explain the basic setup first.  </p>



<p>Future editions will feature:</p>



<ul>
<li>Port Forwarding.</li>



<li>Hairpin NAT (this goes hand-in-hand with the first).</li>



<li>VPNs, especially WireGuard</li>



<li>How routing works when you have VPNs.</li>



<li>Some potential hardening tactics.</li>



<li>Other advanced topics like BGP/OSPF.</li>
</ul>



<p>Cheers!</p>
<div><p><span>Please follow and like us:</span></p></div></div></div>
  </body>
</html>
