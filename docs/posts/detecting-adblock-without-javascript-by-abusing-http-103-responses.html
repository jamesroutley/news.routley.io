<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Mechazawa/103-early-anti-adblock">Original</a>
    <h1>Show HN: Detecting adblock, without JavaScript, by abusing HTTP 103 responses</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Proof of concept that detects adblockers without Javascript by abusing <code>103 Early Hints</code></p>

<p dir="auto">The application can be run either through a Docker container or directly on your machine using Node.js.</p>

<p dir="auto">Using Docker simplifies the setup and ensures consistency across different environments.
To launch the application in a Docker container, execute the following command:</p>

<p dir="auto">This command wraps the process of building the Docker image and running the container.
It ensures that you don&#39;t need to manually set up the environment on your local machine.</p>

<p dir="auto">If you prefer running the application directly on your local environment, follow these steps:</p>
<p dir="auto">Install the project dependencies using npm.</p>

<p dir="auto">The application requires SSL certificates for HTTP2.</p>

<p dir="auto">Start the application</p>


<p dir="auto">The core idea behind this proof of concept is the use of 103 Early Hints response.
By sending early hints prior to the actual response, the server can determine whether an adblocker is present based on the client&#39;s handling of these hints.
If adblock is detected, the server can then serve an alternative page.
This method is particularly effective because it doesn&#39;t depend on JavaScript, which can be disabled or manipulated by users.</p>
<div data-snippet-clipboard-copy-content="            ┌───────┐                ┌──────┐                  ┌───────┐                ┌──────┐
            │Browser│                │Server│                  │Browser│                │Server│
            └───┬───┘                └──┬───┘                  └───┬───┘                └──┬───┘
               ┌┴┐   GET /index.html   ┌┴┐                        ┌┴┐   GET /index.html   ┌┴┐
               │ │ ───────────────────&gt;│ │                        │ │ ───────────────────&gt;│ │
               │ │                     │ │                        │ │                     │ │
               │ │   103 Early Hints   │ │                        │ │   103 Early Hints   │ │
               │ │ &lt;───────────────────│ │                        │ │ &lt;───────────────────│ │
  ╔═══════════╤╪═╪═════════════════════╪═╪═══╗       ╔═══════════╤╪═╪═════════════════════╪═╪═══╗
  ║ PREFETCH  ││ │                     │ │   ║       ║ PREFETCH  ││ │                     │ │   ║
  ╟───────────┘│ │ GET /adv.css?ABCDEF │┌┴┐  ║       ╟───────────┘│ │ GET /adv.css?ABCDEF │┌┴┐  ║
  ║            │ │ ────────────────────&gt;│ │  ║       ║            │ │ ──────────────────X ││ │  ║
  ║            │ │                     ││ │  ║       ║            │ │                     ││ │  ║
  ║            │ │   204 No Content    ││ │──║───┐   ║            │ │                     ││ │──║───┐
  ║            │ │ &lt;────────────────────│ │  ║   │   ║            │ │                     │└┬┘  ║   │
  ║            │ │                     │└┬┘  ║   │   ╚════════════╪═╪═════════════════════╪═╪═══╝   │
  ╚════════════╪═╪═════════════════════╪═╪═══╝   │                │ │                     │ │ ┌─────┴─────────────┐  
               │ │                     │ │ ┌─────┴─────────────┐  │ │                     │ │ │Prefetch timeout:  │
               │ │       200 OK        │ │ │Resource fetched:  │  │ │       200 OK        │ │ │Adblock detected   │
               │ │&lt;────────────────────│ │ │No adblock detected│  │ │&lt;────────────────────│ │ └───────────────────┘
               └┬┘                     └┬┘ └───────────────────┘  └┬┘                     └┬┘
            ┌───┴───┐                ┌──┴───┐                  ┌───┴───┐                ┌──┴───┐
            │Browser│                │Server│                  │Browser│                │Server│
            └───────┘                └──────┘                  └───────┘                └──────┘
                              "><pre><code>            ┌───────┐                ┌──────┐                  ┌───────┐                ┌──────┐
            │Browser│                │Server│                  │Browser│                │Server│
            └───┬───┘                └──┬───┘                  └───┬───┘                └──┬───┘
               ┌┴┐   GET /index.html   ┌┴┐                        ┌┴┐   GET /index.html   ┌┴┐
               │ │ ───────────────────&gt;│ │                        │ │ ───────────────────&gt;│ │
               │ │                     │ │                        │ │                     │ │
               │ │   103 Early Hints   │ │                        │ │   103 Early Hints   │ │
               │ │ &lt;───────────────────│ │                        │ │ &lt;───────────────────│ │
  ╔═══════════╤╪═╪═════════════════════╪═╪═══╗       ╔═══════════╤╪═╪═════════════════════╪═╪═══╗
  ║ PREFETCH  ││ │                     │ │   ║       ║ PREFETCH  ││ │                     │ │   ║
  ╟───────────┘│ │ GET /adv.css?ABCDEF │┌┴┐  ║       ╟───────────┘│ │ GET /adv.css?ABCDEF │┌┴┐  ║
  ║            │ │ ────────────────────&gt;│ │  ║       ║            │ │ ──────────────────X ││ │  ║
  ║            │ │                     ││ │  ║       ║            │ │                     ││ │  ║
  ║            │ │   204 No Content    ││ │──║───┐   ║            │ │                     ││ │──║───┐
  ║            │ │ &lt;────────────────────│ │  ║   │   ║            │ │                     │└┬┘  ║   │
  ║            │ │                     │└┬┘  ║   │   ╚════════════╪═╪═════════════════════╪═╪═══╝   │
  ╚════════════╪═╪═════════════════════╪═╪═══╝   │                │ │                     │ │ ┌─────┴─────────────┐  
               │ │                     │ │ ┌─────┴─────────────┐  │ │                     │ │ │Prefetch timeout:  │
               │ │       200 OK        │ │ │Resource fetched:  │  │ │       200 OK        │ │ │Adblock detected   │
               │ │&lt;────────────────────│ │ │No adblock detected│  │ │&lt;────────────────────│ │ └───────────────────┘
               └┬┘                     └┬┘ └───────────────────┘  └┬┘                     └┬┘
            ┌───┴───┐                ┌──┴───┐                  ┌───┴───┐                ┌──┴───┐
            │Browser│                │Server│                  │Browser│                │Server│
            └───────┘                └──────┘                  └───────┘                └──────┘
                              
</code></pre></div>

<p dir="auto">At the moment this technique is <strong>only works in Firefox</strong>.
Chrome does not allow adblockers to interact with resources loaded using early hints, nor does it display resources loaded using early hints in the developer console.
Additionally, Safari does not support preload early hints at all.
Browsers that do not fully support early hints can be easily detected by adding a harmless dummy resource to preload that will not be blocked by adblockers.</p>
<p dir="auto">Currently, this unintended side-effect may not be a significant problem due to these factors.
However, as browsers continue to expand their support for early hints, it could become a reliable method for detecting adblockers.</p>
<p dir="auto">I have previously <a href="https://github.com/Mechazawa/pixelAntiAdblock">demonstrated other techniques</a> for detecting adblockers during the server response.
Although those require a more involved implementation, they are more effective and less likely to produce false positives.</p>

<p dir="auto">Some good resource for learning more about <code>103 Early Hints</code> can be found here:</p>
<ul dir="auto">
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/103" rel="nofollow">Mozilla Developer Network</a></li>
<li><a href="https://developer.chrome.com/docs/web-platform/early-hints" rel="nofollow">Faster page loads using server think-time with Early Hints</a></li>
</ul>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/Mechazawa/103-early-anti-adblock/blob/master/img/patrick-star-evil-laugh.gif"><img src="https://github.com/Mechazawa/103-early-anti-adblock/raw/master/img/patrick-star-evil-laugh.gif" alt="For evil" data-animated-image=""/></a></p>
</article></div></div>
  </body>
</html>
