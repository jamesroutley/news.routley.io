<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jank-lang.org/">Original</a>
    <h1>Jank Programming Language</h1>
    
    <div id="readability-page-1" class="page"><div><section><div><div><div><div><p>The jank programming language</p><p>jank is a <strong>general-purpose programming language</strong> which embraces the <strong>interactive, value-oriented</strong> nature of Clojure as well as the desire for <strong>native compilation and minimal runtimes</strong>. jank is <strong>strongly compatible with Clojure</strong> and considers itself a dialect of Clojure. Please note that jank is under heavy development; assume all features are planned or incomplete.</p><p>Where jank differs from Clojure JVM is that its host is C++ on top of an <strong>LLVM-based JIT</strong>. This allows jank to offer the same benefits of <strong>REPL-based development</strong> while being able to <strong>seamlessly reach into the native world</strong> and compete seriously with JVM&#39;s performance.</p><p>Still, jank is a Clojure dialect and thus includes its <strong>code-as-data philosophy and powerful macro system</strong>. jank remains a functional-first language which builds upon Clojure&#39;s rich set of <strong>persistent, immutable data structures</strong>. When mutability is needed, jank offers a software transaction memory and reactive agent system to ensure <strong>clean and correct multi-threaded designs</strong>.</p></div></div></div></div></section><section id="how-it-works"><div><div><div><p><span>01</span></p><h3>Iterate like you would with Clojure</h3><p>Iterate in the REPL and build your program from the ground up without leaving your editor.</p></div><div><div><pre tabindex="0"><code><span><span>(</span><span>defn</span><span> -main </span><span>[</span><span>&amp; args</span><span>]</span></span>
<span><span>  (</span><span>loop</span><span> [</span><span>game-state </span><span>(</span><span>new-game!</span><span>)]</span></span>
<span><span>    (</span><span>when</span><span> (</span><span>done?</span><span> game-state</span><span>)</span></span>
<span><span>      (</span><span>end-game!</span><span> game-state</span><span>)</span></span>
<span><span>      (</span><span>recur</span><span> (</span><span>next-state</span><span> game-state</span><span>)))))</span></span>
<span></span></code></pre></div></div></div><div><div><p><span>02</span></p><h3>Reach into the native world</h3><p>Seamlessly switch to inline C++ within your Clojure source, while still having access to your Clojure code using interpolation.</p></div><div><div><pre tabindex="0"><code><span><span>(</span><span>defn</span><span> create-vertex-shader! </span><span>[]</span></span>
<span><span>  (</span><span>c++/glCreateShader</span><span> c++/GL_VERTEX_SHADER</span><span>))</span></span>
<span></span>
<span><span>(</span><span>defn</span><span> set-shader-source! </span><span>[</span><span>shader source</span><span>]</span></span>
<span><span>  (</span><span>let</span><span> [</span><span>shader </span><span>(</span><span>int</span><span> shader</span><span>)</span></span>
<span><span>        source </span><span>(</span><span>str</span><span> source</span><span>)]</span></span>
<span><span>    (</span><span>c++/glShaderSource</span><span> shader </span><span>1</span><span> source c++/nullptr</span><span>)))</span></span>
<span></span>
<span><span>(</span><span>defn</span><span> compile-shader! </span><span>[</span><span>shader</span><span>]</span></span>
<span><span>  (</span><span>c++/glCompileShader</span><span> (</span><span>int</span><span> shader</span><span>)))</span></span>
<span></span></code></pre></div></div></div><div><div><p><span>03</span></p><h3>Compile to machine code</h3><p>jank is built on an LLVM-based JIT. With AOT enabled, both statically and dynamically linked executables can be generated. The jank compiler itself has very speedy start times and low memory usage.</p></div><div><div><pre tabindex="0"><code><span><span>$</span><span> time</span><span> taskset</span><span> 0x1</span><span> clj</span><span> hello-world.clj</span></span>
<span><span>hello</span><span> world</span></span>
<span></span>
<span><span>real</span><span> 0m1.127s</span></span>
<span><span>user</span><span> 0m0.997s</span></span>
<span><span>sys</span><span> 0m0.111s</span></span>
<span></span></code></pre></div><div><pre tabindex="0"><code><span><span>$</span><span> time</span><span> taskset</span><span> 0x1</span><span> jank</span><span> run</span><span> hello-world.clj</span></span>
<span><span>hello</span><span> world</span></span>
<span></span>
<span><span>real</span><span> 0m0.086s</span></span>
<span><span>user</span><span> 0m0.045s</span></span>
<span><span>sys</span><span> 0m0.040s</span></span>
<span></span></code></pre></div></div></div><div><div><p><span>04</span></p><h3>World-class errors</h3><p>jank stands in its own category among lisps for its error reporting quality. No bloated JVM stack traces, opaque errors, or lack of context.</p></div><div><p><img src="https://jank-lang.org/img/landing/step-4.png" width="100%"/></p></div></div></div></section><section id="features"><div><div><div><div><div><div><h3>Strongly compatible with Clojure</h3></div><p>If it works with Clojure JVM and it works with ClojureScript, it should work with jank. There&#39;s a <code>:jank</code> reader conditional for when you need it.</p></div><div><p>Use your favorite nREPL editor plugin. jank uses an LLVM-based JIT to compile machine code on the fly.</p></div></div><div><div><p>Reach into native libraries or interact directly with your native code base. Seamlessly write both C++ and Clojure in the same file.</p></div><div><p>Leiningen, LSP, nREPL planned from the start. jank&#39;s compiler is also written with tooling in mind, so it can be used for lexing, parsing, and analysis.</p></div></div></div></div></div></section><section id="examples"><div><div><div><h3>Generate a movie index</h3><p>jank has very powerful capabilities for representing and transforming arbitrary data. Here, idiomatic usages of <code>reduce</code>, <code>zipmap</code>, <code>repeat</code>, and <code>merge-with</code> help create an index from genre to movie id with ease. No lenses are required for working with nested data.</p></div><div><div><pre tabindex="0"><code><span><span>(</span><span>def</span><span> movies </span><span>{</span><span>:the-weather-man</span><span> {</span><span>:title</span><span> &#34;The Weather Man&#34;</span></span>
<span><span>                               :genres</span><span> [</span><span>:drama</span><span> :comedy</span><span>]</span></span>
<span><span>                               :tomatometer</span><span> 59</span><span>}</span></span>
<span><span>             :nightcrawler</span><span> {</span><span>:title</span><span> &#34;Nightcrawler&#34;</span></span>
<span><span>                            :genres</span><span> [</span><span>:drama</span><span> :crime</span><span> :thriller</span><span>]</span></span>
<span><span>                            :tomatometer</span><span> 95</span><span>}</span></span>
<span><span>             :the-bourne-identity</span><span> {</span><span>:title</span><span> &#34;The Bourne Identity&#34;</span></span>
<span><span>                                   :genres</span><span> [</span><span>:action</span><span> :thriller</span><span>]</span></span>
<span><span>                                   :tomatometer</span><span> 84</span><span>}})</span></span>
<span></span>
<span><span>(</span><span>def</span><span> genre-&gt;movie </span><span>(</span><span>reduce</span><span> (</span><span>fn</span><span> [</span><span>acc </span><span>[</span><span>id movie</span><span>]]</span></span>
<span><span>                            (</span><span>let</span><span> [{</span><span>:keys</span><span> [</span><span>genres</span><span>]}</span><span> movie</span></span>
<span><span>                                  genre-&gt;this-movie </span><span>(</span><span>zipmap</span><span> genres </span><span>(</span><span>repeat</span><span> [</span><span>id</span><span>]))]</span></span>
<span><span>                              (</span><span>merge-with</span><span> into acc genre-&gt;this-movie</span><span>)))</span></span>
<span><span>                          {}</span></span>
<span><span>                          movies</span><span>))</span></span>
<span></span>
<span><span>; genre-&gt;movie is now a useful index.</span></span>
<span><span>; =&gt;</span></span>
<span><span>{</span><span>:drama</span><span> [</span><span>:the-weather-man</span><span> :nightcrawler</span><span>]</span><span>,</span></span>
<span><span> :comedy</span><span> [</span><span>:the-weather-man</span><span>]</span><span>,</span></span>
<span><span> :crime</span><span> [</span><span>:nightcrawler</span><span>]</span><span>,</span></span>
<span><span> :thriller</span><span> [</span><span>:nightcrawler</span><span> :the-bourne-identity</span><span>]</span><span>,</span></span>
<span><span> :action</span><span> [</span><span>:the-bourne-identity</span><span>]}</span></span>
<span></span>
<span><span>; We can look up all movies by genre.</span></span>
<span><span>(</span><span>-&gt;&gt;</span><span> (</span><span>genre-&gt;movie</span><span> :thriller</span><span>)</span></span>
<span><span>     (</span><span>map</span><span> movies</span><span>)</span></span>
<span><span>     (</span><span>sort-by</span><span> :tomatometer</span><span>))</span></span>
<span><span>; =&gt;</span></span>
<span><span>({</span><span>:title</span><span> &#34;The Bourne Identity&#34;</span><span>,</span></span>
<span><span>  :genres</span><span> [</span><span>:action</span><span> :thriller</span><span>]</span><span>,</span></span>
<span><span>  :tomatometer</span><span> 84</span><span>}</span></span>
<span><span> {</span><span>:title</span><span> &#34;Nightcrawler&#34;</span><span>,</span></span>
<span><span>  :genres</span><span> [</span><span>:drama</span><span> :crime</span><span> :thriller</span><span>]</span><span>,</span></span>
<span><span>  :tomatometer</span><span> 95</span><span>})</span></span>
<span></span></code></pre></div></div></div><div><div><h3>Convert bytes to human readable format</h3><p>Beyond the traditional <code>map</code>, <code>filter</code>, and <code>reduce</code>, jank provides a powerful <code>loop</code> macro for more imperative-style loops while still being purely functional. Each <code>loop</code> has one or more corresponding <code>recur</code> usages which must be in tail position.</p></div><div><div><pre tabindex="0"><code><span><span>(</span><span>defn</span><span> size-&gt;human-readable</span></span>
<span><span>  &#34;Converts a size, in bytes, to a human readable format, such as 0 B, 1.5 kB,</span></span>
<span><span>   10 GB, etc.&#34;</span></span>
<span><span>  [</span><span>size-in-bytes</span><span>]</span></span>
<span><span>  (</span><span>if</span><span> (</span><span>&lt;</span><span> -1000</span><span> size-in-bytes </span><span>1000</span><span>)</span></span>
<span><span>    (</span><span>str</span><span> size-in-bytes </span><span>&#34; B&#34;</span><span>)</span></span>
<span><span>    (</span><span>let</span><span> [</span><span>res </span><span>(</span><span>loop</span><span> [</span><span>acc size-in-bytes</span></span>
<span><span>                     suffixes </span><span>&#34;kMGTPE&#34;</span><span>]</span></span>
<span><span>                (</span><span>if</span><span> (</span><span>&lt;</span><span> -999950</span><span> acc </span><span>999950</span><span>)</span></span>
<span><span>                  {</span><span>:size</span><span> acc</span></span>
<span><span>                   :suffix</span><span> (</span><span>first</span><span> suffixes</span><span>)}</span></span>
<span><span>                  (</span><span>recur</span><span> (</span><span>/</span><span> acc </span><span>1000</span><span>)</span><span> (</span><span>drop</span><span> 1</span><span> suffixes</span><span>))))]</span></span>
<span><span>      (</span><span>format</span><span> &#34;%.1f %cB&#34;</span><span> (</span><span>float</span><span> (</span><span>/</span><span> (</span><span>:size</span><span> res</span><span>)</span><span> 1000</span><span>))</span><span> (</span><span>:suffix</span><span> res</span><span>)))))</span></span>
<span></span>
<span><span>(</span><span>assert</span><span> (</span><span>=</span><span> &#34;0 B&#34;</span><span> (</span><span>size-&gt;human-readable</span><span> 0</span><span>)))</span></span>
<span><span>(</span><span>assert</span><span> (</span><span>=</span><span> &#34;57.0 kB&#34;</span><span> (</span><span>size-&gt;human-readable</span><span> (</span><span>*</span><span> 57</span><span> 1000</span><span>))))</span></span>
<span></span></code></pre></div></div></div><div><div><h3>Truncate a string to a max length</h3><p>jank&#39;s strings, as well as most of its other data structures, are immutable. However, jank provides such powerful tools for working with data that mutability is very rarely a concern.</p></div><div><div><pre tabindex="0"><code><span><span>(</span><span>def</span><span> max-text-length </span><span>256</span><span>)</span></span>
<span><span>(</span><span>defn</span><span> truncate</span></span>
<span><span>  &#34;Truncates the text to be no longer than the max length.&#34;</span></span>
<span><span>  [</span><span>text max-length</span><span>]</span></span>
<span><span>  (</span><span>cond</span></span>
<span><span>    (</span><span>&lt;=</span><span> max-length </span><span>0</span><span>)</span></span>
<span><span>    &#34;&#34;</span></span>
<span></span>
<span><span>    (</span><span>&lt;=</span><span> (</span><span>count</span><span> text</span><span>)</span><span> max-length</span><span>)</span></span>
<span><span>    text</span></span>
<span></span>
<span><span>    :else</span></span>
<span><span>    (</span><span>str</span><span> (</span><span>subs</span><span> text </span><span>0</span><span> (</span><span>dec</span><span> max-length</span><span>))</span><span> &#34;…&#34;</span><span>)))</span></span>
<span></span>
<span><span>(</span><span>assert</span><span> (</span><span>=</span><span> &#34;&#34;</span><span> (</span><span>truncate</span><span> &#34;wowzer&#34;</span><span> 0</span><span>)))</span></span>
<span><span>(</span><span>assert</span><span> (</span><span>=</span><span> &#34;wow…&#34;</span><span> (</span><span>truncate</span><span> &#34;wowzer&#34;</span><span> 4</span><span>)))</span></span>
<span></span></code></pre></div></div></div><div><div><h3>Redefine any var</h3><p>Every <code>def</code> or <code>defn</code> exists within a var, which is a stable, namespace-level container for values. Vars can be redefined to contain different values. <code>with-redefs</code> redefines a var within its body&#39;s scope, which is very useful for removing side effects from test cases or forcing functions to return specific values.</p></div><div><div><pre tabindex="0"><code><span><span>(</span><span>defn</span><span> post! </span><span>[</span><span>_request</span><span>]</span></span>
<span><span>  ; Assuming this performs some network effect.</span></span>
<span><span>  {</span><span>:status</span><span> 200</span></span>
<span><span>   :body</span><span> (</span><span>pr-str</span><span> {</span><span>:order</span><span> 7821</span><span>})})</span></span>
<span></span>
<span><span>(</span><span>defn</span><span> submit-order! </span><span>[]</span></span>
<span><span>  (</span><span>let</span><span> [</span><span>request </span><span>{</span><span>:url</span><span> &#34;/submit-order&#34;</span><span>}</span></span>
<span><span>        order </span><span>(</span><span>post!</span><span> request</span><span>)</span></span>
<span><span>        order-body </span><span>(</span><span>-&gt;</span><span> order </span><span>:body</span><span> read-string</span><span>)]</span></span>
<span><span>    (</span><span>if</span><span> (</span><span>contains?</span><span> order-body </span><span>:error</span><span>)</span></span>
<span><span>      ; This is the code path we want to test.</span></span>
<span><span>      {</span><span>:error</span><span> &#34;failed to submit&#34;</span></span>
<span><span>       :request</span><span> request</span></span>
<span><span>       :response</span><span> order-body</span><span>}</span></span>
<span><span>      (</span><span>:order</span><span> order-body</span><span>))))</span></span>
<span></span>
<span><span>; Later on, in tests, skip the side effect by redefining.</span></span>
<span><span>(</span><span>deftest</span><span> submit-order</span></span>
<span><span>  (</span><span>testing</span><span> &#34;failed post&#34;</span></span>
<span><span>    (</span><span>with-redefs</span><span> [</span><span>post! </span><span>(</span><span>fn</span><span> [</span><span>_</span><span>]</span></span>
<span><span>                          ; Fake error to see how the rest of the code handles it.</span></span>
<span><span>                          {</span><span>:status</span><span> 500</span></span>
<span><span>                           :body</span><span> (</span><span>pr-str</span><span> {</span><span>:error</span><span> &#34;uh oh&#34;</span><span>})})]</span></span>
<span><span>      (</span><span>is</span><span> (</span><span>=</span><span> &#34;failed to submit&#34;</span><span> (</span><span>:error</span><span> (</span><span>submit-order!</span><span>)))))))</span></span>
<span></span></code></pre></div></div></div></div></section></div></div>
  </body>
</html>
