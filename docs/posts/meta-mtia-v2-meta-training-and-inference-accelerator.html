<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ai.meta.com/blog/next-generation-meta-training-inference-accelerator-AI-MTIA/">Original</a>
    <h1>Meta MTIA v2 – Meta Training and Inference Accelerator</h1>
    
    <div id="readability-page-1" class="page"><div><div><div><div><div><div><div><p><img src="https://scontent-iad3-1.xx.fbcdn.net/v/t39.8562-6/341873634_933206851214321_6656088855482877648_n.svg?_nc_cat=104&amp;ccb=1-7&amp;_nc_sid=f537c7&amp;_nc_ohc=mGUHpaVA17EAb6quoKz&amp;_nc_ht=scontent-iad3-1.xx&amp;oh=00_AfCgzHa45wyQk2XTrFsGolygnw_FoEaKvwiny5ytgWBGKw&amp;oe=661C9BF7" height="30" width="109" alt="Featured label"/></p><p>Our next-generation Meta Training and Inference Accelerator</p><p>April 10, 2024 · 8 min read</p></div></div></div></div></div><div><div><div><div><div><p>The next generation of Meta’s large-scale infrastructure is <a href="https://about.fb.com/news/2023/05/metas-infrastructure-for-ai/" data-ms-clickable="true" data-ms="{&#34;creative&#34;:&#34;click_external-link&#34;,&#34;creative_detail&#34;:&#34;blog_newsroom-reimagine&#34;}" target="_blank" rel="noreferrer noopener" data-lnfb-mode="ie" id="u_0_f_Gc">being built with AI in mind</a>, including supporting new generative AI (GenAI) products and services, recommendation systems, and advanced AI research. It’s an investment <a href="https://engineering.fb.com/2024/03/12/data-center-engineering/building-metas-genai-infrastructure/" data-ms-clickable="true" data-ms="{&#34;creative&#34;:&#34;click_external-link&#34;,&#34;creative_detail&#34;:&#34;blog_engineering-building&#34;}" target="_blank" rel="noreferrer noopener" data-lnfb-mode="ie" id="u_0_g_DV">we expect will grow</a> in the years ahead as the compute requirements to support AI models increase alongside the models’ sophistication.</p><p>Last year, we unveiled the <a href="https://ai.meta.com/blog/meta-training-inference-accelerator-AI-MTIA/" data-ms-clickable="true" data-ms="{&#34;creative&#34;:&#34;click_internal-link&#34;,&#34;creative_detail&#34;:&#34;blog_ai-mtiav1-intro&#34;}" target="_blank" rel="noreferrer noopener" data-lnfb-mode="ie" id="u_0_h_7b">Meta Training and Inference Accelerator (MTIA) v1</a>, our first-generation AI inference accelerator that we designed in-house with Meta’s AI workloads in mind – specifically our deep learning recommendation models that are improving a variety of experiences across our products.</p><p>MTIA is a long-term venture to provide the most efficient architecture for Meta’s unique workloads. As AI workloads become increasingly important to our products and services, this efficiency will improve our ability to provide the best experiences for our users around the world. MTIA v1 was an important step in improving the compute efficiency of our infrastructure and better supporting our software developers as they build AI models that will facilitate new and better user experiences.</p><p>Now, we’re sharing details about the next generation of MTIA.</p></div></div><div><p> Next generation MTIA chip model. Drag to rotate.<br/></p></div><p>This inference accelerator is part of our broader full-stack development program for custom, domain-specific silicon that addresses our unique workloads and systems. This new version of MTIA more than doubles the compute and memory bandwidth of our previous solution while maintaining our close tie-in to our workloads. It is designed to efficiently serve the ranking and recommendation models that provide high-quality recommendations to users.</p></div></div></div><div id="u_0_j_68"><p><img src="https://static.xx.fbcdn.net/rsrc.php/v3/y4/r/-PAXP-deijE.gif" alt="Close up photograph of a hand holding a chip" id="u_0_k_8n"/></p><div data-scoped-css="fullscreen-hero-scoped-u_0_0_rc"><p>GET INVOLVED</p><p>Join us on our journey to build infrastructure </p></div></div><div><div><div><div><h2> Under the hood<br/></h2><p>This chip’s architecture is fundamentally focused on providing the right balance of compute, memory bandwidth, and memory capacity for serving ranking and recommendation models. In inference we need to be able to provide relatively high utilization, even when our batch sizes are relatively low. By focusing on providing outsized SRAM capacity, relative to typical GPUs, we can provide high utilization in cases where batch sizes are limited and provide enough compute when we experience larger amounts of potential concurrent work.</p></div><div><p>This accelerator consists of an 8x8 grid of processing elements (PEs). These PEs provide significantly increased dense compute performance (3.5x over MTIA v1) and sparse compute performance (7x improvement). This comes partly from improvements in the architecture associated with pipelining of sparse compute. It also comes from how we feed the PE grid: We have tripled the size of the local PE storage, doubled the on-chip SRAM and increased its bandwidth by 3.5X, and doubled the capacity of LPDDR5.</p></div><div><p>Our new MTIA design also features an improved network on chip (NoC) architecture that doubles the bandwidth and allows us to coordinate between different PEs at low latency. These and other new functions in the PEs form the key technologies that are vital to our long-term roadmap to scale MTIA to a wider variety of more challenging workloads.</p></div></div></div></div><div><div><div><div><h2>The hardware</h2><p>Serving our workloads effectively is not simply a silicon challenge. Co-designing the hardware system and the software stack along with the silicon is essential for the success of the overall inference solution.</p></div><div><p>To support the next-generation silicon we have developed a large, rack-based system that holds up to 72 accelerators. This consists of three chassis, each containing 12 boards that house two accelerators each. We specifically designed the system so that we could clock the chip at 1.35GHz (up from 800 MHz) and run it at 90 watts compared to 25 watts for our first-generation design. Our design ensures we provide denser capabilities with higher compute, memory bandwidth, and memory capacity. This density allows us to more easily accommodate a broad range of model complexities and sizes.</p></div></div></div><div><div><div><div><div><p><img src="https://static.xx.fbcdn.net/rsrc.php/v3/y4/r/-PAXP-deijE.gif" alt="Photograph of a person placing a motherboard into a server"/></p></div></div></div><div><div><div><p><img src="https://static.xx.fbcdn.net/rsrc.php/v3/y4/r/-PAXP-deijE.gif" alt="Photograph of a server rack with wires and chips"/></p></div></div></div></div></div><div><div><div><p>Beyond this, we have upgraded the fabric between the accelerators and between the host and accelerators to PCIe Gen5 to increase the bandwidth and scalability of our system. There is also the option to add an RDMA NIC if we choose to scale out beyond the rack.</p></div></div></div></div><div><div><div><div><h2>The software stack</h2><p>Software has been one of our key areas of focus from the start of our investment in MTIA. <a href="https://ai.meta.com/blog/pytorch-builds-the-future-of-ai-and-machine-learning-at-facebook/" data-ms-clickable="true" data-ms="{&#34;creative&#34;:&#34;click_internal-link&#34;,&#34;creative_detail&#34;:&#34;blog_ai-pytorch-builds&#34;}" target="_blank" rel="noreferrer noopener" data-lnfb-mode="ie" id="u_0_s_OO">As the initial developers of PyTorch</a>, we value programmability and developer efficiency. Our MTIA stack is designed to fully integrate with PyTorch 2.0 and features like TorchDynamo and TorchInductor. Frontend graph-level capturing, analysis, transformation, and extraction mechanisms (such as TorchDynamo, torch.export, etc.) are agnostic to MTIA and are being reused The lower level compiler for MTIA takes the outputs from the frontend and produces highly efficient and device-specific code. This lower level compiler itself consists of a few components that are responsible for generating executable code for models and kernels.</p></div><div><div><div><p><img src="https://scontent-iad3-2.xx.fbcdn.net/v/t39.8562-6/434734036_1552580315589962_4953415076977263638_n.jpg?_nc_cat=103&amp;ccb=1-7&amp;_nc_sid=f537c7&amp;_nc_ohc=_BJ5OdmLZfIAb6Zidru&amp;_nc_ht=scontent-iad3-2.xx&amp;oh=00_AfA9mYnCpwYvvouHJ94bM6xn5JTH0pQP7wi_T0km2asXQw&amp;oe=661C95E6" alt=""/></p></div></div></div><div><div><p>Below this sits the runtime stack responsible for interfacing with the driver/firmware. The MTIA Streaming interface abstraction provides the basic and essential operations that both inference and (in the future) training software require to manage the device memory, as well as run operators and execute compiled graphs on the device. Finally, the runtime interacts with the driver, which sits in user space – a decision we made to enable us to iterate faster on the driver and firmware within our production stack.</p><p>In many ways this new chip system runs the software stack similarly to MTIA v1, which made it much faster for the team to deploy since we had already done much of the necessary integration and development work needed to be able to run our applications on this architecture. The new MTIA is designed to be compatible with code developed for MTIA v1. Since we had already integrated the full software stack to the silicon, we were up and running our traffic with this new chip in a matter of days. This allowed us to land this next-generation MTIA silicon rapidly, going from first silicon to production models running in 16 regions in less than nine months.</p></div><h3> Triton-MTIA<br/></h3><div><p>We’ve further optimized the software stack by creating the Triton-MTIA compiler backend to generate high-performance code for the MTIA hardware. <a href="https://github.com/openai/triton" data-ms-clickable="true" data-ms="{&#34;creative&#34;:&#34;click_external-link&#34;,&#34;creative_detail&#34;:&#34;github_triton&#34;}" target="_blank" rel="noreferrer noopener" data-lnfb-mode="ie" id="u_0_t_cV">Triton</a> is an open source language and compiler for writing highly efficient ML compute kernels. It improves developer productivity for writing GPU code and we have found that the Triton language is sufficiently hardware-agnostic to be applicable to non-GPU hardware architectures like MTIA.</p><p>The Triton-MTIA backend performs optimizations to maximize hardware utilization and support high-performance kernels. It also exposes key knobs to leverage Triton and MTIA auto-tuning infrastructures to explore the kernel configuration and optimization space.</p><p>We have implemented support for the features of the Triton language and integration into PyTorch 2, providing extensive coverage for PyTorch operators. Thanks to TorchInductor, for example, our developers can leverage Triton-MTIA in both ahead-of-time (AOT) and just-in-time (JIT) workflows.</p><p>We observed dramatically improved developer efficiency with Triton-MTIA, which allowed us to scale up compute kernel authoring and significantly expand the support of PyTorch operators.</p></div></div></div></div></div><div><p><img src="https://static.xx.fbcdn.net/rsrc.php/v3/y4/r/-PAXP-deijE.gif" alt="Dark Meta gradient"/></p><div><div><div><h2>Performance Results</h2><p>The results so far show that this MTIA chip can handle both the low complexity (LC) and high complexity (HC) ranking and recommendation models that are components of Meta’s products. Across these models, there can be a ~10x-100x difference in model size and the amount of compute per input sample. Because we control the whole stack, we can achieve greater efficiency compared to commercially available GPUs. Realizing these gains is an ongoing effort and we continue to improve performance per watt as we build up and deploy MTIA chips in our systems.</p><div><div><p>Early results show that this next generation silicon has already improved performance by 3x over our first generation chip across four key models we evaluated. At the platform level, with 2x the number of devices and a powerful 2-socket CPU, we are able to achieve 6x model serving throughput and a 1.5x performance per watt improvement over the first generation MTIA system. To achieve this, we have made significant progress optimizing kernels, compiler, runtime, and host serving stack. The time to optimize models is going down as the developer ecosystem matures, yet there is more headroom to improve efficiency in the future. </p><div><p>3x</p><p>improved performance over our first gen chip</p></div></div></div><p>MTIA has been deployed in the data center and is now serving models in production. We are already seeing the positive results of this program as it&#39;s allowing us to dedicate and invest in more compute power for our more intensive AI workloads. It is proving to be highly complementary to commercially available GPUs in delivering the optimal mix of performance and efficiency on Meta-specific workloads.</p></div></div></div></div><div><div><div><div><h2>Meta’s ongoing investment in custom silicon</h2><div><p>MTIA will be an important piece of our long-term roadmap to build and scale the most powerful and efficient infrastructure possible for Meta’s unique AI workloads.</p><p>We’re designing our custom silicon to work in cooperation with our existing infrastructure as well as with new, more advanced hardware (including next-generation GPUs) that we may leverage in the future. Meeting our ambitions for our custom silicon means investing not only in compute silicon but also in memory bandwidth, networking and capacity as well as other next-generation hardware systems.</p><p>We currently have several programs underway aimed at expanding the scope of MTIA, including support for GenAI workloads.</p><p>We’re only at the beginning of this journey, and we’re inviting people who want to be a part of it to visit <a href="https://www.metacareers.com/innovation" data-ms-clickable="true" data-ms="{&#34;creative&#34;:&#34;click_external-link&#34;,&#34;creative_detail&#34;:&#34;careers_innovation-open-roles&#34;}" target="_blank" rel="noreferrer noopener" data-lnfb-mode="ie" id="u_0_v_7h">Meta Careers</a> to learn about our open positions.</p></div></div></div></div></div><div><div><div><div><h4>Written by:</h4><h4>Eran Tal, Nicolaas Viljoen and Joel Coburn</h4></div></div></div></div></div></div></div>
  </body>
</html>
