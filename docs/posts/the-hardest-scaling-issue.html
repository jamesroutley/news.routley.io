<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.codeberg.org/the-hardest-scaling-issue.html">Original</a>
    <h1>The Hardest Scaling Issue</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody"><p><strong><em>If you want to know more about our current technical scaling issues:
Rest assured that we are working hard on it.
Read on to learn why this is not as fast as you might expect.</em></strong></p>
<p>When people like me talk about scaling,
it is pretty obvious what we are referring to.
It&#39;s about increasing computing power, distributed storage, replicated databases and so on.
There are all kinds of technology available to solve scaling issues.
So why, damn, is Codeberg still having performance issues from time to time?</p>
<p>I recently explained in a chat that we face the &#34;worst&#34; kind of scaling issue in my perception.
That is, if you don&#39;t see it coming
(e.g. because the software gets slower day by day,
or because you see how the storage pool fill up).
Instead, it appears out of the blue.</p>
<p>This happened to Codeberg early January.
It might have been because we didn&#39;t notice the growth,
since the last days of December (where most people are on holidays)
were much calmer than usual
(also in terms of external traffic to Codeberg like CI pulls or release downloads).</p>
<p>We see a lot of traffic during European evenings.
This makes us happy, on the one side.
To our knowledge, counting more than 50.000 users, we are by far the largest public Forgejo/Gitea instance.
And we&#39;re proud to offer so many additional services like Codeberg Pages, Weblate and CI.</p>
<p>But it&#39;s also a problem to make sure the system handles these intense hours gracefully,
while it would mostly idle for the rest of the day.
Such a scaling issue keeps you busy,
and you need careful consideration how much headroom to add in order to handle the spikes,
without wasting precious donations and energy,
it is not the hardest to fix.</p>
<p>In theory, you could just tune some config,
add more computing power, or storage, or apply a patch –
once you have identified the cause.</p>
<h2>A different kind of scaling issue</h2>
<p>In the context of Codeberg, I&#39;m seeing a different kind of scaling issue.
I drafted a text early November, but didn&#39;t share it anywhere,
because my tone was filled with anger and frustration.
But I don&#39;t want to blame someone,
but improve and motivate.
And finally share our experience for the next Forgejo instances to not run into this in the first place.</p>
<p>Speaking personally, I invest a lot of time into the project,
and the last year at Codeberg was intense:
Periods with increased server instability,
overflowing mailboxes and angry social media users being mad about their broken Codeberg Pages.</p>
<p>We are still here, and we manage to dig through the backlog.
But the active team is small, and the work increasing.</p>
<p>The hardest scaling issue is: scaling human power.</p>
<h2>Don&#39;t forget the people</h2>
<p>In order to solve technical scaling issues,
many awesome solutions exist.
But that one bottleneck is hard to overcome.</p>
<p>Take a look at our Ceph Cluster, for example:
It was added to solve a technical scaling issue.
However, it consumes a lot more human power to get things right than traditional file systems.</p>
<p>Consider Forgejo/Gitea, the software Codeberg runs on.
It has a few flaws that go unnoticed in small instances
(for your private server, high disk I/O might not be a critical problem; for Codeberg it is).
It takes awesome developers to investigate these problems and write patches.</p>
<p>Configuration, Investigation, Maintenance, User Support, Communication –
all require some effort, and it&#39;s not easy to automate.
In many cases, automation would consume even more human resources to set up than we have.</p>
<p>At Codeberg, we might have made a mistake recently:
When we migrated to our own hardware in a hurry,
because of the increased demand for code hosting,
we wanted to do &#34;everything right and future-proof&#34;.</p>
<p>We transitioned from a basic stack
(ext4 filesystem, Postfix, not much more)
to one including so many shiny new things:
Starting with the duty of maintaining own hardware
(which is a journey on its own),
we introduced LXC containers, Ansible, BTRFS, ZFS, Ceph and more.</p>
<p>In the past months, I found myself reading a lot of documentation,
mostly for Ceph and HAProxy,
two tools which were tuned a little to mitigate the ongoing performance issues.
I learned a lot about LXC containers and BTRFS.
Still, there was no time left to dig deep into Ansible and ZFS,
and by now both tools have even been mostly dropped,
to reduce the stress on our team members.</p>
<p>Not because they are bad,
but because they would consume more human resources than we can afford.</p>
<h2>A historical problem</h2>
<p>This kind of scaling issue is new to Codeberg, but not to the world.
All projects on earth likely went through this at a certain point
or will experience it in the future.
Availability issues for some platforms even <a href="https://en.wikipedia.org/wiki/Twitter#Outages">had a nickname</a>.
Others had major outages which were hard to fix because <a href="https://engineering.fb.com/2021/10/05/networking-traffic/outage-details/">communication of the teams was interrupted</a>.</p>
<p>However, most websites we use nowadays have their early years long ago.
Their growth pain forgotten, their networks mostly stable and with plenty of headroom.</p>
<p>How can a growing non-profit in 2023 compete with the changed expectations of today?
Our &#34;24/7 monitoring&#34; is based on the free time of our core contributors.
There are no paid night shifts, not even payment at all.
Still, people have become used to the always-available guarantees,
and demand the same from us: Occasional slowness in the evening of the CET timezone? Unbearable!</p>
<p>I do understand the demand. We definitely aim for a better service than we sometimes provide.
However, sometimes, the frustration of angry social-media-guys carries me away, and I&#39;m even tempted to reply:
&#34;If you cannot live without the extreme guarantees of huge proprietary cloud platforms,
you cannot have the freedom Codeberg provides&#34;.</p>
<p>The reason for this is simple:
In order to maximize the availability,
the cost (for hardware, energy, and human time!) increases exponentially.
Big platforms to this because of competition.
For donation-powered non-profits,
this uses donations that could have served better,
and leads to burn-out in the team.</p>
<h2>How can non-profits keep up?</h2>
<p>In the context of Codeberg, there are two primary blockers that prevent scaling human resources.
The first one is: trust.
Because we can&#39;t yet afford hiring employees that work on tasks for a defined amount of time,
work naturally has to be distributed over many volunteers with limited time commitment.
This would also require that more people are granted access to precious user data,
but with the downside that unlike companies
we don&#39;t have employment contracts for everyone at hand that already manage the legal part of this.</p>
<p>And especially with a distributed team,
building trust without meeting in person is a problem.
Currently, only members with elected roles within Codeberg e.V. receive access privileges.</p>
<p>The second problem <em>is</em> a in part technical.
Unlike major players, which have nearly unlimited resources available to meet high demand,
scaling Codeberg&#39;s systems involves:</p>
<ul>
<li>Ordering new hardware. Due to the democratic structure,
  this is discussed in the presidium first
  (for a good reason: Members should know that we think twice before investing about 3000 € in a potential storage upgrade)</li>
<li>Scheduling an operation in the DC with another non-profit which houses our platform.</li>
<li>Actually going there, touching and working on the server.</li>
</ul>
<p>Sounds slow? Yes.
A popular &#34;solution&#34; is outsourcing the actual server hosting,
we also did so too until the end of last year.
It&#39;s easy: Adding more resources means you can scale your cloud deployment within seconds.
You don&#39;t need to worry too much about IOPS or hardware failures.</p>
<p>Still, is it the Internet we are striving for?
No matter which instance you join or if you host yourself,
the data will reside on one of the few big cloud provider&#39;s systems.</p>
<p>I don&#39;t yet have an answer to this.
Maybe extend non-profit cloud hosting?
Or have Codeberg grow large enough so that we can finally afford to pay more team members?
I appreciate all kinds of discussions about this.</p>
<h2>Some positive final words</h2>
<p>A scaling issue is an issue, and it needs to be addressed.
I&#39;m proud to share that while we still have a steep way before us,
we started to do more work in the public than one year ago,
which has greater potential to onboard and involve more people.
Thanks to those helping us diagnose issues in the
<a href="https://matrix.to/#/#contributing-to-codeberg:kle.li">&#34;Contributing to Codeberg&#34; Matrix channel</a> (feel free to join!),
and I&#39;m glad we even started to distribute the boring office work.</p>
<p>I can name a few optimizations that save a lot of human time recently.
But scaling issues that come from growth aren&#39;t solved once
– they return with ongoing growth.
It will be a persistent effort to keep up with the increasing demand,
and I invite everyone to help us stay ahead of this special scaling issue.</p>
<p>Are you happy to host some software yourself?
Feel free to demonstrate and extend your knowledge by
<a href="https://codeberg.org/Codeberg/Community/issues/904">taking over responsibility for a service at Codeberg</a>.
Also consider reading <a href="https://docs.codeberg.org/improving-codeberg/contributing-code/">the Improving Codeberg guide in the docs</a>
and <a href="https://join.codeberg.org">joining the non-profit Codeberg e.V.</a> and actively have your part in running the platform.</p>
<p>If contributions to Codeberg grow similarly like usage of Codeberg grows,
I&#39;m confident that we can <a href="https://blog.codeberg.org/community-maintenance-matters.html">benefit from some efficiency gains</a>
and provide a better service for everyone.</p>
<p>Happy to see you around! And a huge thanks to everyone involved in Codeberg, Forgejo, Gitea and all the other upstreams we rely on,
for making our project possible. Thanks a lot!</p></div></div>
  </body>
</html>
