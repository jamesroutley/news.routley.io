<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.patterns.app/blog/2023/01/18/crunchbot-sql-analyst-gpt/">Original</a>
    <h1>Replacing a SQL analyst with 26 recursive GPT prompts</h1>
    
    <div id="readability-page-1" class="page"><div id="post-content" itemprop="articleBody"><p>When I was at Square and the team was smaller we had a dreaded “analytics on-call” rotation. It was strictly rotated on a weekly basis, and if it was your turn up you knew you would get very little “real” work done that week and spend most of your time fielding ad-hoc questions from the various product and operations teams at the company (SQL monkeying, we called it). There was cutthroat competition for manager roles on the analytics team and I think this was entirely the result of managers being exempted from this rotation -- no status prize could rival the carrot of not doing on-call work.</p><p>So, the idea that something like analytics on-call could be entirely replaced by a next-token optimizer like GPT-3 has been an idea I’ve been excited to try for a long time now. I finally got a chance to sit down and try it out this week.</p><p>We’re about to kick off our fundraising process, so I to test the idea I attempted to build a free-form question answering analytics bot on top of the Crunchbase data set of investors, companies, and fundraising rounds. I call it CrunchBot. </p><p>Read on to get the details, but here is a quick example of it getting a simple thing exactly right:</p><p><img loading="lazy" alt="crunchbot" src="https://www.patterns.app/assets/images/seed-ab4e45fc74ecd2b04a3ae62efc54797c.png" width="881" height="375"/></p><p>And an example of it getting something more complex exactly right:</p><p><img loading="lazy" alt="crunchbot" src="https://www.patterns.app/assets/images/series_a-c5975e5c5453cd49019929626d35f99c.png" width="842" height="444"/></p><p>And an example of it getting something complex terrifically wrong (watch your join conditions davinci-003!):</p><p><img loading="lazy" alt="crunchbot" src="https://www.patterns.app/assets/images/wrong-262e6556babb741437725982dcd784e5.png" width="1684" height="1428"/></p><p>And something of medium complexity mostly right (it’s so close here, needs an <code>ilike</code> instead of <code>like</code>, which it messed up despite a specific prompt telling it to watch out for this mistake):</p><p><img loading="lazy" alt="crunchbot" src="https://www.patterns.app/assets/images/bio-20ab3fa4503c9e39c366beed43823df0.png" width="944" height="1098"/></p><p>Overall I was dumbfounded with the quality of the results. LLMs are a continual source of blown minds, but this is shockingly close to replacing an entire role at companies with only a few hours of effort.</p><h2 id="how-i-built-it">How I built it<a href="#how-i-built-it" title="Direct link to heading">​</a></h2><p>My plan was to build it in <a href="https://www.patterns.app" target="_blank" rel="noopener noreferrer">Patterns Studio</a>. There were mostly four parts</p><ul><li>Build the prompt from<ul><li>user’s question</li><li>schemas and sample data of the available tables</li><li>clear directions</li></ul></li><li>Run it through various GPT models and get 5+ completions of raw SQL</li><li>Execute the SQL against the relevant tables, pick the best result</li><li>Hook it up to a Slack bot</li></ul><p>By the end I had a much more complex pipeline as I kept quickly finding prompt improvements. Specifically the SQL generation and execution part became a loop of:</p><ul><li>Generate a candidate query</li><li>Quality check the SQL with GPT itself, asking it to spot common errors (NULLS LAST, for instance) and produce a correct version of the query</li><li>Run the SQL against the tables</li><li>If there was an error or no result, ask GPT to fix the query to produce a correct result and repeat the loop</li><li>Otherwise, return the result</li></ul><p>This led to completion chains of over 20 calls to GPT for a single user question. There feels like some logarithmic improvement in each GPT call — you can continue to add more context and checks with every completion, exploring different versions and iterating on the result. This is the same process that a junior analyst would use to arrive at the answer, in this case it takes 15 seconds and costs $1 in credits vs $50 and 1 hour for the analyst. You have a LOT of leeway there to use even more crazy prompt pipelines before the ROI gets bad.</p><p>Anyways, here’s the step-by-step of how I built it. You can follow along in this <a href="https://studio.patterns.app/graph/xps3l66o4o1beuugequ9/crunchbase-sql-bot" target="_blank" rel="noopener noreferrer">template app</a> on Patterns that has all the code (no data it in, Crunchbase is a proprietary data set — reach out <a href="mailto:kvh@patterns.app" target="_blank" rel="noopener noreferrer">kvh@patterns.app</a> if you are interested in exploring this specific data set).</p><h3 id="1-get-the-crunchbase-data">1. Get the Crunchbase data<a href="#1-get-the-crunchbase-data" title="Direct link to heading">​</a></h3><p>The full Crunchbase dataset includes 2.4m organizations and 510k funding rounds. We ingest this via the full CSV dump every 24 hours into our postgres instance. For this analysis we restricted it to three tables: organizations, funding_rounds, and investments.</p><h3 id="2-build-the-initial-prompt">2. Build the initial prompt<a href="#2-build-the-initial-prompt" title="Direct link to heading">​</a></h3><p>The initial SQL generation prompt includes three basic elements: a summary of the tables and data available to query, the user’s question, and a prompt asking GPT to write a correct Postgres query. Here’s the exact template we used:</p><div><div><pre tabindex="0"><code><span><span>prompt </span><span>=</span><span> </span><span>f&#34;&#34;&#34;</span><span>{</span><span>tables_summary</span><span>}</span><span></span><br/></span><span><span></span><br/></span><span><span>As a senior analyst, given the above schemas and data, write a detailed and correct Postgres sql query to answer the analytical question:</span><br/></span><span><span></span><br/></span><span><span>&#34;</span><span>{</span><span>question</span><span>}</span><span>&#34;</span><br/></span><span><span></span><br/></span><span><span>Comment the query with your logic.&#34;&#34;&#34;</span><br/></span></code></pre></div></div><p>Which results in this full prompt, for example:</p><div><div><pre tabindex="0"><code><span><span>Schema for table: organizations</span><br/></span><span><span>  uuid Text</span><br/></span><span><span>    name Text</span><br/></span><span><span>    roles Text</span><br/></span><span><span>    country_code Text</span><br/></span><span><span>    region Text</span><br/></span><span><span>    city Text</span><br/></span><span><span>    status Text</span><br/></span><span><span>    short_description Text</span><br/></span><span><span>    category_list Text</span><br/></span><span><span>    num_funding_rounds Float</span><br/></span><span><span>    total_funding_usd Float</span><br/></span><span><span>    founded_on Date</span><br/></span><span><span>    employee_count Text</span><br/></span><span><span>    email Text</span><br/></span><span><span>    primary_role Text</span><br/></span><span><span>    </span><br/></span><span><span>Data for table: organizations:</span><br/></span><span><span>                                   uuid                        name    roles  \</span><br/></span><span><span>0  ac323097-bdd0-4507-9cbc-6186e61c47a5       Bootstrap Enterprises  company   </span><br/></span><span><span>1  717ce629-38b6-494d-9ebf-f0eeb51506f8                  Campanizer  company   </span><br/></span><span><span>2  c8cbaa69-c9db-44e2-9ffa-eb4722a62fe3                       Cambr  company   </span><br/></span><span><span>3  5ab1ae3d-c3a1-4268-a532-b500d3dd6182                  CallMeHelp  company   </span><br/></span><span><span>4  143f840b-551c-4dbd-a92b-0804d654b5cf  California Cannabis Market  company   </span><br/></span><span><span></span><br/></span><span><span>  country_code      region           city     status  \</span><br/></span><span><span>0         &lt;NA&gt;        &lt;NA&gt;           &lt;NA&gt;  operating   </span><br/></span><span><span>1          USA    Colorado        Boulder  operating   </span><br/></span><span><span>2          USA    New York       New York  operating   </span><br/></span><span><span>3          GBR   Stockport      Stockport  operating   </span><br/></span><span><span>4          USA  California  San Francisco     closed   </span><br/></span><span><span></span><br/></span><span><span>                                   short_description  \</span><br/></span><span><span>0  Bootstrap Enterprises is an organic waste mana...   </span><br/></span><span><span>1  Campanizer organizes schedule and coordinates ...   </span><br/></span><span><span>2  Cambr enables companies to build and scale fin...   </span><br/></span><span><span>3  CallMeHelp provides early warning and care ove...   </span><br/></span><span><span>4  California Cannabis Market is an information t...   </span><br/></span><span><span></span><br/></span><span><span>                                     category_list  num_funding_rounds  \</span><br/></span><span><span>0              Consulting,Organic,Waste Management                 NaN   </span><br/></span><span><span>1                Information Technology,Scheduling                 NaN   </span><br/></span><span><span>2                       Banking,Financial Services                 NaN   </span><br/></span><span><span>3                     Fitness,Health Care,Wellness                 NaN   </span><br/></span><span><span>4  B2B,Information Services,Information Technology                 NaN   </span><br/></span><span><span></span><br/></span><span><span>   total_funding_usd founded_on employee_count                 email  \</span><br/></span><span><span>0                NaN        NaT        unknown                  &lt;NA&gt;   </span><br/></span><span><span>1                NaN 2017-01-01           1-10  hello@campanizer.com   </span><br/></span><span><span>2                NaN        NaT        unknown       sales@cambr.com   </span><br/></span><span><span>3                NaN 2017-01-01           1-10                  &lt;NA&gt;   </span><br/></span><span><span>4                NaN 2018-01-01           1-10                  &lt;NA&gt;   </span><br/></span><span><span></span><br/></span><span><span>  primary_role  </span><br/></span><span><span>0      company  </span><br/></span><span><span>1      company  </span><br/></span><span><span>2      company  </span><br/></span><span><span>3      company  </span><br/></span><span><span>4      company  </span><br/></span><span><span>    </span><br/></span><span><span></span><br/></span><span><span>Schema for table: investments</span><br/></span><span><span>  uuid Text</span><br/></span><span><span>    name Text</span><br/></span><span><span>    funding_round_uuid Text</span><br/></span><span><span>    funding_round_name Text</span><br/></span><span><span>    investor_uuid Text</span><br/></span><span><span>    investor_name Text</span><br/></span><span><span>    investor_type Text</span><br/></span><span><span>    is_lead_investor Boolean</span><br/></span><span><span>    </span><br/></span><span><span>Data for table: investments:</span><br/></span><span><span>                                   uuid  \</span><br/></span><span><span>0  524986f0-3049-54a4-fa72-f60897a5e61d   </span><br/></span><span><span>1  6556ab92-6465-25aa-1ffc-7f8b4b09a476   </span><br/></span><span><span>2  0216e06a-61f8-9cf1-19ba-20811229c53e   </span><br/></span><span><span>3  dadd7d86-520d-5e35-3033-fc1d8792ab91   </span><br/></span><span><span>4  581c4b38-9653-7117-9bd4-7ffe5c7eba69   </span><br/></span><span><span></span><br/></span><span><span>                                                name  \</span><br/></span><span><span>0                Accel investment in Series A - Meta   </span><br/></span><span><span>1             Greylock investment in Series B - Meta   </span><br/></span><span><span>2  Meritech Capital Partners investment in Series...   </span><br/></span><span><span>3  Trinity Ventures investment in Series B - Phot...   </span><br/></span><span><span>4        Founders Fund investment in Series A - Geni   </span><br/></span><span><span></span><br/></span><span><span>                     funding_round_uuid      funding_round_name  \</span><br/></span><span><span>0  d950d7a5-79ff-fb93-ca87-13386b0e2feb         Series A - Meta   </span><br/></span><span><span>1  6fae3958-a001-27c0-fb7e-666266aedd78         Series B - Meta   </span><br/></span><span><span>2  6fae3958-a001-27c0-fb7e-666266aedd78         Series B - Meta   </span><br/></span><span><span>3  bcd5a63d-ed99-6963-0dd2-e36f6582f846  Series B - Photobucket   </span><br/></span><span><span>4  60e6afd9-1215-465a-dd17-0ed600d4e29b         Series A - Geni   </span><br/></span><span><span></span><br/></span><span><span>                          investor_uuid              investor_name  \</span><br/></span><span><span>0  b08efc27-da40-505a-6f9d-c9e14247bf36                      Accel   </span><br/></span><span><span>1  e2006571-6b7a-e477-002a-f7014f48a7e3                   Greylock   </span><br/></span><span><span>2  8d5c7e48-82da-3025-dd46-346a31bab86f  Meritech Capital Partners   </span><br/></span><span><span>3  7ca12f7a-2f8e-48b4-a8d1-1a33a0e275b9           Trinity Ventures   </span><br/></span><span><span>4  fb2f8884-ec07-895a-48d7-d9a9d4d7175c              Founders Fund   </span><br/></span><span><span></span><br/></span><span><span>  investor_type  is_lead_investor  </span><br/></span><span><span>0  organization              True  </span><br/></span><span><span>1  organization              True  </span><br/></span><span><span>2  organization              True  </span><br/></span><span><span>3  organization              &lt;NA&gt;  </span><br/></span><span><span>4  organization              True  </span><br/></span><span><span>    </span><br/></span><span><span></span><br/></span><span><span>Schema for table: funding_rounds</span><br/></span><span><span>  uuid Text</span><br/></span><span><span>    region Text</span><br/></span><span><span>    city Text</span><br/></span><span><span>    investment_type Text</span><br/></span><span><span>    announced_on Date</span><br/></span><span><span>    raised_amount_usd Float</span><br/></span><span><span>    post_money_valuation_usd Float</span><br/></span><span><span>    investor_count Float</span><br/></span><span><span>    org_uuid Text</span><br/></span><span><span>    org_name Text</span><br/></span><span><span>    lead_investor_uuids Text</span><br/></span><span><span>    </span><br/></span><span><span>Data for table: funding_rounds:</span><br/></span><span><span>                                   uuid      region            city  \</span><br/></span><span><span>0  8a945939-18e0-cc9d-27b9-bf33817b2818  California      Menlo Park   </span><br/></span><span><span>1  d950d7a5-79ff-fb93-ca87-13386b0e2feb  California      Menlo Park   </span><br/></span><span><span>2  6fae3958-a001-27c0-fb7e-666266aedd78  California      Menlo Park   </span><br/></span><span><span>3  bcd5a63d-ed99-6963-0dd2-e36f6582f846    Colorado          Denver   </span><br/></span><span><span>4  60e6afd9-1215-465a-dd17-0ed600d4e29b  California  West Hollywood   </span><br/></span><span><span></span><br/></span><span><span>  investment_type announced_on  raised_amount_usd  post_money_valuation_usd  \</span><br/></span><span><span>0           angel   2004-09-01           500000.0                       NaN   </span><br/></span><span><span>1        series_a   2005-05-01         12700000.0                98000000.0   </span><br/></span><span><span>2        series_b   2006-04-01         27500000.0               502500000.0   </span><br/></span><span><span>3        series_b   2006-05-01         10500000.0                       NaN   </span><br/></span><span><span>4        series_a   2007-01-17                NaN                10000000.0   </span><br/></span><span><span></span><br/></span><span><span>   investor_count                              org_uuid     org_name  \</span><br/></span><span><span>0             4.0  df662812-7f97-0b43-9d3e-12f64f504fbb         Meta   </span><br/></span><span><span>1             4.0  df662812-7f97-0b43-9d3e-12f64f504fbb         Meta   </span><br/></span><span><span>2             5.0  df662812-7f97-0b43-9d3e-12f64f504fbb         Meta   </span><br/></span><span><span>3             2.0  f53cb4de-236e-0b1b-dee8-7104a8b018f9  Photobucket   </span><br/></span><span><span>4             1.0  4111dc8b-c0df-2d24-ed33-30cd137b3098         Geni   </span><br/></span><span><span></span><br/></span><span><span>                                 lead_investor_uuids  </span><br/></span><span><span>0               3f47be49-2e32-8118-01a0-31685a4d0fd7  </span><br/></span><span><span>1               b08efc27-da40-505a-6f9d-c9e14247bf36  </span><br/></span><span><span>2  e2006571-6b7a-e477-002a-f7014f48a7e3,8d5c7e48-...  </span><br/></span><span><span>3                                               &lt;NA&gt;  </span><br/></span><span><span>4               fb2f8884-ec07-895a-48d7-d9a9d4d7175c  </span><br/></span><span><span>    </span><br/></span><span><span></span><br/></span><span><span>As a senior analyst, given the above schemas and data, write a detailed and correct Postgres sql query to answer the analytical question:</span><br/></span><span><span></span><br/></span><span><span>&#34;Who were the largest biotech investors in 2022?&#34;</span><br/></span><span><span></span><br/></span><span><span>Comment the query with your logic.</span><br/></span></code></pre></div></div><h3 id="3-double-check-the-query">3. Double check the query<a href="#3-double-check-the-query" title="Direct link to heading">​</a></h3><p>I found GPT made some common mistakes over and over again (the same ones any analyst would make), so I gave it a specific prompt to review each query and fix any bugs before doing anything else:</p><div><div><pre tabindex="0"><code><span><span>prompt </span><span>=</span><span> </span><span>f&#34;&#34;&#34;</span><span>{</span><span>query</span><span>.</span><span>sql</span><span>}</span><span></span><br/></span><span><span></span><br/></span><span><span>Double check the Postgres query above for common mistakes, including:</span><br/></span><span><span> - Remembering to add `NULLS LAST` to an ORDER BY DESC clause</span><br/></span><span><span> - Handling case sensitivity, e.g. using ILIKE instead of LIKE</span><br/></span><span><span> - Ensuring the join columns are correct</span><br/></span><span><span> - Casting values to the appropriate type</span><br/></span><span><span> </span><br/></span><span><span>Rewrite the query here if there are any mistakes. If it looks good as it is, just reproduce the original query.&#34;&#34;&#34;</span><br/></span></code></pre></div></div><h3 id="4-run-the-generated-sql-against-the-database-fix-any-errors">4. Run the generated SQL against the database, fix any errors<a href="#4-run-the-generated-sql-against-the-database-fix-any-errors" title="Direct link to heading">​</a></h3><p>Next we try to run the SQL against the database. If it produces a result, we store the result and query. If it produces no result or an error, we ask GPT to fix the SQL:</p><div><div><pre tabindex="0"><code><span><span>error_prompt </span><span>=</span><span> </span><span>f&#34;&#34;&#34;</span><span>{</span><span>query</span><span>.</span><span>sql</span><span>}</span><span></span><br/></span><span><span></span><br/></span><span><span>The query above produced the following error:</span><br/></span><span><span></span><br/></span><span><span></span><span>{</span><span>query</span><span>.</span><span>error</span><span>}</span><span></span><br/></span><span><span></span><br/></span><span><span>Rewrite the query with the error fixed:&#34;&#34;&#34;</span><span></span><br/></span><span><span></span><br/></span><span><span>no_result_prompt </span><span>=</span><span> </span><span>f&#34;&#34;&#34;</span><span>{</span><span>query</span><span>.</span><span>sql</span><span>}</span><span></span><br/></span><span><span></span><br/></span><span><span>The query above produced no result. Try rewriting the query so it will return results:&#34;&#34;&#34;</span><br/></span></code></pre></div></div><p>Here’s an example of this step working well, with the following query. Can you spot the error?</p><div><div><pre tabindex="0"><code><span><span>SELECT</span><span> org_category</span><span>,</span><span></span><br/></span><span><span></span><span>SUM</span><span>(</span><span>CASE</span><span> </span><span>WHEN</span><span> </span><span>YEAR</span><span>(</span><span>announced_on</span><span>)</span><span> </span><span>=</span><span> </span><span>2021</span><span> </span><span>THEN</span><span> raised_amount_usd </span><span>ELSE</span><span> </span><span>0</span><span> </span><span>END</span><span>)</span><span> </span><span>as</span><span> </span><span>2021</span><span>_investments</span><span>,</span><span></span><br/></span><span><span></span><span>SUM</span><span>(</span><span>CASE</span><span> </span><span>WHEN</span><span> </span><span>YEAR</span><span>(</span><span>announced_on</span><span>)</span><span> </span><span>=</span><span> </span><span>2022</span><span> </span><span>THEN</span><span> raised_amount_usd </span><span>ELSE</span><span> </span><span>0</span><span> </span><span>END</span><span>)</span><span> </span><span>as</span><span> </span><span>2022</span><span>_investments</span><span>,</span><span></span><br/></span><span><span></span><span>SUM</span><span>(</span><span>CASE</span><span> </span><span>WHEN</span><span> </span><span>YEAR</span><span>(</span><span>announced_on</span><span>)</span><span> </span><span>=</span><span> </span><span>2022</span><span> </span><span>THEN</span><span> raised_amount_usd </span><span>ELSE</span><span> </span><span>0</span><span> </span><span>END</span><span>)</span><span> </span><span>-</span><span> </span><span>SUM</span><span>(</span><span>CASE</span><span> </span><span>WHEN</span><span> </span><span>YEAR</span><span>(</span><span>announced_on</span><span>)</span><span> </span><span>=</span><span> </span><span>2021</span><span> </span><span>THEN</span><span> raised_amount_usd </span><span>ELSE</span><span> </span><span>0</span><span> </span><span>END</span><span>)</span><span> </span><span>as</span><span> diff_investments</span><br/></span><span><span></span><span>FROM</span><span> organizations o </span><span>JOIN</span><span> funding_rounds f </span><span>ON</span><span> o</span><span>.</span><span>uuid </span><span>=</span><span> f</span><span>.</span><span>org_uuid</span><br/></span><span><span></span><span>GROUP</span><span> </span><span>BY</span><span> org_category</span><br/></span><span><span></span><span>ORDER</span><span> </span><span>BY</span><span> diff_investments </span><span>DESC</span><span> NULLS </span><span>LAST</span><span></span><br/></span><span><span></span><span>LIMIT</span><span> </span><span>1</span><span>;</span><br/></span></code></pre></div></div><p>Syntax error:</p><div><div><pre tabindex="0"><code><span><span>ERROR:  syntax error at </span><span>or</span><span> near </span><span>&#34;2021_investments&#34;</span><span></span><br/></span><span><span>LINE </span><span>2</span><span>: </span><span>.</span><span>.</span><span>.</span><span>_on</span><span>)</span><span> </span><span>=</span><span> </span><span>2021</span><span> </span><span>THEN</span><span> raised_amount_usd </span><span>ELSE</span><span> </span><span>0</span><span> </span><span>END</span><span>)</span><span> </span><span>as</span><span> </span><span>2021</span><span>_inves</span><span>.</span><span>.</span><span>.</span><br/></span></code></pre></div></div><p>Which was then fixed with this new query:</p><div><div><pre tabindex="0"><code><span><span>SELECT</span><span> org_category</span><span>,</span><span></span><br/></span><span><span></span><span>SUM</span><span>(</span><span>CASE</span><span> </span><span>WHEN</span><span> </span><span>YEAR</span><span>(</span><span>announced_on</span><span>)</span><span> </span><span>=</span><span> </span><span>2021</span><span> </span><span>THEN</span><span> raised_amount_usd </span><span>ELSE</span><span> </span><span>0</span><span> </span><span>END</span><span>)</span><span> </span><span>as</span><span> investments_2021</span><span>,</span><span></span><br/></span><span><span></span><span>SUM</span><span>(</span><span>CASE</span><span> </span><span>WHEN</span><span> </span><span>YEAR</span><span>(</span><span>announced_on</span><span>)</span><span> </span><span>=</span><span> </span><span>2022</span><span> </span><span>THEN</span><span> raised_amount_usd </span><span>ELSE</span><span> </span><span>0</span><span> </span><span>END</span><span>)</span><span> </span><span>as</span><span> investments_2022</span><span>,</span><span></span><br/></span><span><span></span><span>SUM</span><span>(</span><span>CASE</span><span> </span><span>WHEN</span><span> </span><span>YEAR</span><span>(</span><span>announced_on</span><span>)</span><span> </span><span>=</span><span> </span><span>2022</span><span> </span><span>THEN</span><span> raised_amount_usd </span><span>ELSE</span><span> </span><span>0</span><span> </span><span>END</span><span>)</span><span> </span><span>-</span><span> </span><span>SUM</span><span>(</span><span>CASE</span><span> </span><span>WHEN</span><span> </span><span>YEAR</span><span>(</span><span>announced_on</span><span>)</span><span> </span><span>=</span><span> </span><span>2021</span><span> </span><span>THEN</span><span> raised_amount_usd </span><span>ELSE</span><span> </span><span>0</span><span> </span><span>END</span><span>)</span><span> </span><span>as</span><span> diff_investments</span><br/></span><span><span></span><span>FROM</span><span> organizations o </span><span>JOIN</span><span> funding_rounds f </span><span>ON</span><span> o</span><span>.</span><span>uuid </span><span>=</span><span> f</span><span>.</span><span>org_uuid</span><br/></span><span><span></span><span>GROUP</span><span> </span><span>BY</span><span> org_category</span><br/></span><span><span></span><span>ORDER</span><span> </span><span>BY</span><span> diff_investments </span><span>DESC</span><span> NULLS </span><span>LAST</span><span></span><br/></span><span><span></span><span>LIMIT</span><span> </span><span>1</span><span>;</span><br/></span></code></pre></div></div><h3 id="5-repeat-n-times">5. Repeat N times<a href="#5-repeat-n-times" title="Direct link to heading">​</a></h3><p>Repeat the above completion loop as many times as we want to get a set of queries and results. I chose to stop this loop once I got a result that matched a previous result, or I hit my limit of max tries (5 in this case).</p><h3 id="6-build-the-slack-bot">6. Build the Slack bot<a href="#6-build-the-slack-bot" title="Direct link to heading">​</a></h3><p>I used the off-the-shelf Patterns template for Slack bots and hooked it up. I added a second slack node for acknowledging the original Slack mention quickly, since the full GPT pipeline can take 20 seconds plus.</p><h2 id="conclusion">Conclusion<a href="#conclusion" title="Direct link to heading">​</a></h2><p>It seems like there’s almost no limit to how good GPT could get at this. The remaining failure modes were ones of either missing context or not enough iterative debugging (the kind that is the beating heart of any analytics endeavor). For instance, GPT had to guess the exact names and spellings of categories or company names when answering questions. If it was allowed to run some “research” queries first, it could have been able to build enough context for a final prompt and query to get to the right answer. Playing around with GPT at this level you get the feeling that “recursive GPT” is very close to AGI. You could even ask GPT to reinforcement learn itself, adding new prompts based on fixes to previous questions. Of course, who knows what will happen to all this when GPT-4 drops.</p><p>(If you want to play around with a similar bot, you can clone the <a href="https://studio.patterns.app/graph/xps3l66o4o1beuugequ9/crunchbase-sql-bot" target="_blank" rel="noopener noreferrer">template of this app</a> and switch to a different data set)</p></div></div>
  </body>
</html>
