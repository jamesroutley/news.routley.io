<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ruricolist/spinneret">Original</a>
    <h1>Spinneret: A modern Common Lisp HTML generator</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><strong>Table of Contents</strong></p>
<ul dir="auto">
<li><a href="#spinneret">Spinneret</a>
<ul dir="auto">
<li><a href="#printing-style">Printing style</a></li>
<li><a href="#inserted-spaces">Inserted spaces</a></li>
<li><a href="#line-wrapping">Line wrapping</a></li>
<li><a href="#syntax">Syntax</a>
<ul dir="auto">
<li><a href="#dynamic-output">Dynamic output</a></li>
<li><a href="#interpreting-trees">Interpreting trees</a></li>
<li><a href="#markdown">Markdown</a></li>
</ul>
</li>
<li><a href="#get-html-path"><code>get-html-path</code></a>
<ul dir="auto">
<li><a href="#html-path"><code>*html-path*</code></a></li>
</ul>
</li>
<li><a href="#deftag"><code>deftag</code></a></li>
<li><a href="#parenscript">Parenscript</a></li>
<li><a href="#validation">Validation</a></li>
</ul>
</li>
</ul>


<p dir="auto">In the crowded space of Common Lisp HTML generators, Spinneret
occupies the following coordinates:</p>
<ul dir="auto">
<li>
<p dir="auto">Modern. Targets HTML5. Does not treat XML and HTML as the same
problem. Assumes you will be serving your documents as UTF-8.</p>
</li>
<li>
<p dir="auto">Composable. Makes it easy to refactor HTML generation into separate
functions and macros.</p>
</li>
<li>
<p dir="auto">Pretty. Treats HTML as a document format, not a serialization.
Output is idiomatic and readable, following the coding style of the
HTML5 specification.</p>
</li>
<li>
<p dir="auto">Aggressive. If something can be interpreted as HTML, then it will
be, meaning that some Lisp forms can&#39;t be mixed with HTML syntax. In
the trade-off between 90% convenience and 10% correctness Spinneret
is on the side of convenience.</p>
</li>
<li>
<p dir="auto">Bilingual. Spinneret (after loading <code>spinneret/ps</code>) has the same semantics in Lisp and <a href="https://parenscript.common-lisp.dev/" rel="nofollow">Parenscript</a>.</p>
</li>
</ul>
<p dir="auto">HTML generation with Spinneret looks like this:</p>
<div data-snippet-clipboard-copy-content=" (in-package #:spinneret)

 (defparameter *shopping-list*
   &#39;(&#34;Atmospheric ponds&#34;
     &#34;Electric gumption socks&#34;
     &#34;Mrs. Leland&#39;s embyronic television combustion&#34;
     &#34;Savage gymnatic aggressors&#34;
     &#34;Pharmaceutical pianos&#34;
     &#34;Intravenous retribution champions&#34;))

 (defparameter *user-name* &#34;John Q. Lisper&#34;)

 (defparameter *last-login* &#34;12th Never&#34;)

 (defmacro with-page ((&amp;key title) &amp;body body)
   `(with-html
      (:doctype)
      (:html
        (:head
         (:title ,title))
        (:body ,@body))))

 (defun shopping-list ()
   (with-page (:title &#34;Home page&#34;)
     (:header
      (:h1 &#34;Home page&#34;))
     (:section
      (&#34;~A, here is *your* shopping list: &#34; *user-name*)
      (:ol (dolist (item *shopping-list*)
             (:li (1+ (random 10)) item))))
     (:footer (&#34;Last login: ~A&#34; *last-login*))))"><pre><code> (in-package #:spinneret)

 (defparameter *shopping-list*
   &#39;(&#34;Atmospheric ponds&#34;
     &#34;Electric gumption socks&#34;
     &#34;Mrs. Leland&#39;s embyronic television combustion&#34;
     &#34;Savage gymnatic aggressors&#34;
     &#34;Pharmaceutical pianos&#34;
     &#34;Intravenous retribution champions&#34;))

 (defparameter *user-name* &#34;John Q. Lisper&#34;)

 (defparameter *last-login* &#34;12th Never&#34;)

 (defmacro with-page ((&amp;key title) &amp;body body)
   `(with-html
      (:doctype)
      (:html
        (:head
         (:title ,title))
        (:body ,@body))))

 (defun shopping-list ()
   (with-page (:title &#34;Home page&#34;)
     (:header
      (:h1 &#34;Home page&#34;))
     (:section
      (&#34;~A, here is *your* shopping list: &#34; *user-name*)
      (:ol (dolist (item *shopping-list*)
             (:li (1+ (random 10)) item))))
     (:footer (&#34;Last login: ~A&#34; *last-login*))))
</code></pre></div>
<p dir="auto">Which produces:</p>
<div data-snippet-clipboard-copy-content=" &lt;!DOCTYPE html&gt;
 &lt;html lang=en&gt;
  &lt;head&gt;
   &lt;meta charset=UTF-8&gt;
   &lt;title&gt;Home page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
   &lt;header&gt;
    &lt;h1&gt;Home page&lt;/h1&gt;
   &lt;/header&gt;
   &lt;section&gt;
    John Q. Lisper, here is &lt;em&gt;your&lt;/em&gt; shopping list:
    &lt;ol&gt;
     &lt;li&gt;10 Atmospheric ponds
     &lt;li&gt;6 Electric gumption socks
     &lt;li&gt;4 Mrs. Leland&#39;s embyronic television combustion
     &lt;li&gt;9 Savage gymnatic aggressors
     &lt;li&gt;6 Pharmaceutical pianos
     &lt;li&gt;9 Intravenous retribution champions
    &lt;/ol&gt;
   &lt;/section&gt;
   &lt;footer&gt;
    Last login: 12th Never
   &lt;/footer&gt;
  &lt;/body&gt;
 &lt;/html&gt;"><pre><code> &lt;!DOCTYPE html&gt;
 &lt;html lang=en&gt;
  &lt;head&gt;
   &lt;meta charset=UTF-8&gt;
   &lt;title&gt;Home page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
   &lt;header&gt;
    &lt;h1&gt;Home page&lt;/h1&gt;
   &lt;/header&gt;
   &lt;section&gt;
    John Q. Lisper, here is &lt;em&gt;your&lt;/em&gt; shopping list:
    &lt;ol&gt;
     &lt;li&gt;10 Atmospheric ponds
     &lt;li&gt;6 Electric gumption socks
     &lt;li&gt;4 Mrs. Leland&#39;s embyronic television combustion
     &lt;li&gt;9 Savage gymnatic aggressors
     &lt;li&gt;6 Pharmaceutical pianos
     &lt;li&gt;9 Intravenous retribution champions
    &lt;/ol&gt;
   &lt;/section&gt;
   &lt;footer&gt;
    Last login: 12th Never
   &lt;/footer&gt;
  &lt;/body&gt;
 &lt;/html&gt;
</code></pre></div>
<p dir="auto">(Pretty-printing is pretty fast, but Spinneret obeys <code>*print-pretty*</code>
should you want to turn it off.)</p>
<h3 tabindex="-1" id="user-content-printing-style" dir="auto"><a href="#printing-style">Printing style<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Spinneret tries hard to produce human-writable output – output that
looks like a human being wrote it. Sometimes, however, you may have
markup to render that there is no human-writable way to render,
because no human being would ever write it.</p>
<p dir="auto">In these cases you can set or bind the <code>*html-style*</code> variable to
control Spinneret’s print style. The default is <code>:human</code>, which means
to attempt to produce human-writable output. It can also be set to
<code>:tree</code>, which simply prints every element as if it were a block
element, and every run of text on a new line.</p>
<div data-snippet-clipboard-copy-content="(let ((*html-style* :human))
  (with-html
    (:div
      (:p &#34;Text &#34; (:a &#34;link text&#34;) &#34; more text&#34;))))
=&gt; &lt;div&gt;
    &lt;p&gt;Text &lt;a&gt;link text&lt;/a&gt; more text
   &lt;/div&gt;&#34;

(let ((*html-style* :tree))
  (with-html-string
    (:div
      (:p &#34;Text &#34; (:a &#34;link text&#34;) &#34; more text&#34;))))
=&gt; &lt;div&gt;
    &lt;p&gt;
     Text
     &lt;a&gt;
      link text
     &lt;/a&gt;
      more text
    &lt;/p&gt;
   &lt;/div&gt;"><pre><code>(let ((*html-style* :human))
  (with-html
    (:div
      (:p &#34;Text &#34; (:a &#34;link text&#34;) &#34; more text&#34;))))
=&gt; &lt;div&gt;
    &lt;p&gt;Text &lt;a&gt;link text&lt;/a&gt; more text
   &lt;/div&gt;&#34;

(let ((*html-style* :tree))
  (with-html-string
    (:div
      (:p &#34;Text &#34; (:a &#34;link text&#34;) &#34; more text&#34;))))
=&gt; &lt;div&gt;
    &lt;p&gt;
     Text
     &lt;a&gt;
      link text
     &lt;/a&gt;
      more text
    &lt;/p&gt;
   &lt;/div&gt;
</code></pre></div>
<p dir="auto">With <code>*html-style*</code> bound to <code>:tree</code>, and <code>*print-pretty*</code> bound to
nil, output is verbose but predictable:</p>
<div data-snippet-clipboard-copy-content="(let ((*html-style* :tree)
      (*print-pretty* nil))
  (with-html-string
    (:div
      (:p &#34;Text &#34; (:a &#34;link text&#34;) &#34; more text&#34;))))
=&gt; &#34;&lt;div&gt;&lt;p&gt;Text &lt;a&gt;link text&lt;/a&gt;  more text&lt;/p&gt;&lt;/div&gt;&#34;"><pre><code>(let ((*html-style* :tree)
      (*print-pretty* nil))
  (with-html-string
    (:div
      (:p &#34;Text &#34; (:a &#34;link text&#34;) &#34; more text&#34;))))
=&gt; &#34;&lt;div&gt;&lt;p&gt;Text &lt;a&gt;link text&lt;/a&gt;  more text&lt;/p&gt;&lt;/div&gt;&#34;
</code></pre></div>
<p dir="auto">Notice that binding <code>*html-style*</code> to <code>:tree</code> ensures that all tags are
closed.</p>
<h3 tabindex="-1" id="user-content-inserted-spaces" dir="auto"><a href="#inserted-spaces">Inserted spaces<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">By default, when objects are output to HTML, spaces are inserted betweeen them. This is nearly always the right thing to do, but in some special cases, the spaces may be a problem. They can be turned off by setting the flag <code>*suppress-inserted-spaces*</code> to <code>t</code>.</p>
<h3 tabindex="-1" id="user-content-line-wrapping" dir="auto"><a href="#line-wrapping">Line wrapping<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">When pretty-printing, Spinneret makes the best decisions about line
wrapping that it can, given the information it has about how to get
the print length of various types. But, in the case of user-defined
types, it has no way to tell in advance how long they will be when
printed. If you find Spinneret is making bad line-breaking decisions
with your types, you can help it out by specializing <code>html-length</code>.
For example, if you use PURI, you could help Spinneret pretty-print
PURI URIs by teaching it how to get their length:</p>
<div data-snippet-clipboard-copy-content="(defmethod html-length ((uri puri:uri))
  ;; Doesn&#39;t cons.
  (length (puri:render-uri uri nil)))"><pre><code>(defmethod html-length ((uri puri:uri))
  ;; Doesn&#39;t cons.
  (length (puri:render-uri uri nil)))
</code></pre></div>
<h2 tabindex="-1" id="user-content-syntax" dir="auto"><a href="#syntax">Syntax<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">The rules for WITH-HTML are these:</p>
<ul dir="auto">
<li>
<p dir="auto">All generated forms write to <code>*html*</code>.</p>
</li>
<li>
<p dir="auto">A keyword in function position is interpreted as a tag name. If the
name is not valid as a tag, it is ignored.</p>
<p dir="auto">Certain keywords are recognized as pseudo-tags and given special
treatment:</p>
<p dir="auto">:RAW :DOCTYPE :!DOCTYPE :CDATA :!-- :COMMENT :HTML :HEAD :H* :TAG</p>
<ul dir="auto">
<li>
<p dir="auto">The pseudotag :RAW can be used to bypass Spinneret’s implicit
escaping for raw output. This allows inserting HTML literals, and
bypasses pretty printing.</p>
<p dir="auto">Note that you need :RAW for inline stylesheets and scripts,
otherwise angle brackets will be escaped as if they were HTML:</p>
<div dir="auto" data-snippet-clipboard-copy-content="(with-html-string (:style &#34;a &gt; p{color: white;}&#34;))
=&gt; &#34;&lt;style&gt;a &amp;gt; p{color: white;}&lt;/style&gt;&#34;

(with-html-string (:style (:raw &#34;a &gt; p{color: white;}&#34;)))
=&gt; &#34;&lt;style&gt;a &gt; p{color: white;}&lt;/style&gt;&#34;
"><pre>(with-html-string (:style <span><span>&#34;</span>a &gt; p{color: white;}<span>&#34;</span></span>))
=&gt; <span><span>&#34;</span>&lt;style&gt;a &amp;gt; p{color: white;}&lt;/style&gt;<span>&#34;</span></span>

(with-html-string (:style (:raw <span><span>&#34;</span>a &gt; p{color: white;}<span>&#34;</span></span>)))
=&gt; <span><span>&#34;</span>&lt;style&gt;a &gt; p{color: white;}&lt;/style&gt;<span>&#34;</span></span>
</pre></div>
</li>
<li>
<p dir="auto">The pseudotags :!– and :COMMENT insert comments into the output.</p>
</li>
<li>
<p dir="auto">The pseudotag :H* renders as one of :H1 through :H6 depending on
how many :SECTION elements it is dynamically nested inside. At the
top level, :H* is equivalent to :H1. Inside the dynamic extent of
one :SECTION tag, it is equivalent to :H2; inside two section
tags, it is equivalent to :H3; and so forth up to :H6.</p>
</li>
<li>
<p dir="auto">The pseudotag :TAG allows dynamic selection of a tag.</p>
</li>
</ul>
<p dir="auto">The value of the LANG attribute of HTML is controlled by
<code>*html-lang*</code>; the value of the meta charset attribute is controlled
by <code>*html-charset*</code>. These are defaults; passing an explicit
attribute takes precedence.</p>
<p dir="auto">Constant classes and ids can be specified with a selector-like
syntax. E.g.:</p>
<div data-snippet-clipboard-copy-content="  (:div#wrapper (:div.section ...))
  ≡ (:div :id &#34;wrapper&#34; (:div :class &#34;section&#34; ...))"><pre><code>  (:div#wrapper (:div.section ...))
  ≡ (:div :id &#34;wrapper&#34; (:div :class &#34;section&#34; ...))
</code></pre></div>
</li>
<li>
<p dir="auto">Keyword-value pairs following a tag are interpreted as attributes.
HTML syntax may not be used in attribute values. Attributes with nil
values are omitted from the output. Boolean attributes with non-nil
values are minimized.</p>
<p dir="auto">Duplicate attributes are handled like duplicate keyword arguments:
all values are evaluated, but only the leftmost value is used. The
exception is the handling of tokenized attributes, such as :CLASS or
:REL. The class of a tag is the union of all its :CLASS arguments.</p>
<p dir="auto">The argument :DATASET introduces a list of :DATA-FOO arguments:</p>
<div data-snippet-clipboard-copy-content="  (:p :dataset (:duck (dolomphious) :fish &#39;fizzgigious
                      :spoon &#34;runcible&#34;))
  ≡ (:p :data-duck (dolomphious) :data-fish &#39;fizzgigious
        :data-spoon &#34;runcible&#34;)"><pre><code>  (:p :dataset (:duck (dolomphious) :fish &#39;fizzgigious
                      :spoon &#34;runcible&#34;))
  ≡ (:p :data-duck (dolomphious) :data-fish &#39;fizzgigious
        :data-spoon &#34;runcible&#34;)
</code></pre></div>
<p dir="auto">For flexibility, even at the cost of efficiency, the argument :ATTRS
introduces a form to evaluate at run time for a plist of extra
attributes and values.</p>
</li>
<li>
<p dir="auto">Forms after the attributes are treated as arguments. Each non-nil
(primary) value returned by an argument to a tag is written to the
stream by HTML, a generic function on which you can define your own
methods. By default only literal arguments are printed. Literal
arguments are strings, characters, numbers and symbols beside NIL.</p>
</li>
</ul>
<p dir="auto">WITH-HTML-STRING is like WITH-HTML, but intercepts the generated HTML
at run time and returns a string.</p>
<h3 tabindex="-1" id="user-content-dynamic-output" dir="auto"><a href="#dynamic-output">Dynamic output<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">For flexibility, even at the cost of efficiency, the pseudo-attribute
:ATTRS introduces a form to evaluate at run time for a plist of extra
attributes and values.</p>
<div data-snippet-clipboard-copy-content="(:p :attrs (list :id &#34;dynamic!&#34;))
=&gt; &lt;p id=&#34;dynamic!&#34;&gt;"><pre><code>(:p :attrs (list :id &#34;dynamic!&#34;))
=&gt; &lt;p id=&#34;dynamic!&#34;&gt;
</code></pre></div>
<p dir="auto">Similarly, the pseudo-tag :TAG allows you to select a tag at run time.</p>
<div data-snippet-clipboard-copy-content="(:tag :name &#34;div&#34;
 (:tag :name &#34;p&#34;
  (:tag :name &#34;span&#34;
    &#34;Hello.&#34;)))
≡ (:div (:p (:span &#34;Hello&#34;)))"><pre><code>(:tag :name &#34;div&#34;
 (:tag :name &#34;p&#34;
  (:tag :name &#34;span&#34;
    &#34;Hello.&#34;)))
≡ (:div (:p (:span &#34;Hello&#34;)))
</code></pre></div>
<p dir="auto">Note that :TAG only allows you to <em>select</em> a tag, not <em>create</em> one.
The tag must still be one that is known to Spinneret to be valid. (That is, either defined as part of HTML or matching the requirements for a custom element.)</p>
<p dir="auto">For maximum dynamicity, you can combine :TAG and :ATTRS:</p>
<div data-snippet-clipboard-copy-content="(:tag :name &#34;div&#34; :attrs (list :id &#34;dynamic!&#34;))
=&gt; &lt;div id=dynamic!&gt;&lt;/div&gt;"><pre><code>(:tag :name &#34;div&#34; :attrs (list :id &#34;dynamic!&#34;))
=&gt; &lt;div id=dynamic!&gt;&lt;/div&gt;
</code></pre></div>
<h3 tabindex="-1" id="user-content-interpreting-trees" dir="auto"><a href="#interpreting-trees">Interpreting trees<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">For the <em>ne plus ultra</em> of flexibility, you can interpret trees at runtime using a subset of Spinneret syntax:</p>
<div data-snippet-clipboard-copy-content="(interpret-html-tree `(:div :id &#34;dynamic!&#34;))
=&gt; &lt;div id=dynamic!&gt;&lt;/div&gt;"><pre><code>(interpret-html-tree `(:div :id &#34;dynamic!&#34;))
=&gt; &lt;div id=dynamic!&gt;&lt;/div&gt;
</code></pre></div>
<p dir="auto">The interpreter is still under development; it supports most but not yet all Spinneret syntax.</p>
<h3 tabindex="-1" id="user-content-markdown" dir="auto"><a href="#markdown">Markdown<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">If the additional system <code>spinneret/cl-markdown</code> is loaded, then a
string in function position is first compiled as Markdown (using
<a href="https://github.com/gwkkwg/cl-markdown">CL-MARKDOWN</a>), then passed to <code>format</code> as a control string and
applied to its arguments.</p>
<p dir="auto">This is useful for inline formatting, like links, where sexps would be
clumsy:</p>
<div data-snippet-clipboard-copy-content="(with-html
 (&#34;Here is some copy, with [a link](~a)&#34; link))

(with-html
  (:span &#34;Here is some copy, with &#34;
    (:a :href link &#34;a link.&#34;)))"><pre><code>(with-html
 (&#34;Here is some copy, with [a link](~a)&#34; link))

(with-html
  (:span &#34;Here is some copy, with &#34;
    (:a :href link &#34;a link.&#34;)))
</code></pre></div>
<h2 tabindex="-1" id="user-content-get-html-path" dir="auto"><a href="#get-html-path"><code>get-html-path</code><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Sometimes it is useful for a piece of HTML-generating code to know
where in the document it appears. You might, for example, want to
define a <code>tabulate</code> function that prints list-of-lists as rows of
cells, but only prints the surrounding <code>&lt;table&gt;&lt;/table&gt;</code> if it is not
already within a table. The function <code>get-html-path</code> returns a list of
open tags, from latest to earliest. Usually it will look something
like</p>
<div data-snippet-clipboard-copy-content="  (get-html-path) ;-&gt; &#39;(:table :section :body :html)"><pre><code>  (get-html-path) ;-&gt; &#39;(:table :section :body :html)
</code></pre></div>
<p dir="auto">Thus `tabulate&#39; could be written</p>
<div data-snippet-clipboard-copy-content=" (defun tabulate (&amp;rest rows)
   (with-html
     (flet ((tabulate ()
              (loop for row in rows do
                (:tr (loop for cell in row do
                  (:td cell))))))
       (if (find :table (get-html-path))
           (tabulate)
           (:table (:tbody (tabulate)))))))"><pre><code> (defun tabulate (&amp;rest rows)
   (with-html
     (flet ((tabulate ()
              (loop for row in rows do
                (:tr (loop for cell in row do
                  (:td cell))))))
       (if (find :table (get-html-path))
           (tabulate)
           (:table (:tbody (tabulate)))))))
</code></pre></div>
<p dir="auto">Note that <code>get-html-path</code> returns a freshly-consed list each time it
is called.</p>
<h3 tabindex="-1" id="user-content-html-path" dir="auto"><a href="#html-path"><code>*html-path*</code><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">The variable underneath <code>get-html-path</code> is <code>*html-path*</code>, and it can
be let-bound to manipulate the nested tags (like <code>:h*</code> and <code>tabulate</code>
from the example above).</p>
<p dir="auto">WARNING: Spinneret binds <code>*html-path*</code> with <a href="http://clhs.lisp.se/Body/d_dynami.htm" rel="nofollow">dynamic
extent</a>. If you need to inspect
the binding, use <code>get-html-path</code> instead to get a value you can safely
store.</p>
<p dir="auto"><code>*html-path*</code> is most useful if the document generated by Spinneret is
split into several functions. Binding <code>*html-path*</code> allows to preserve
the structure of the document there.</p>
<p dir="auto">Example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="(defun inner-section ()
  &#34;Binds *HTML-PATH* to replicate the depth the output is used in.&#34;
  (with-html-string
    (let ((*html-path* (append *html-path* &#39;(:section :section))))
      (:h* &#34;Heading three levels deep&#34;))))

(defun outer-section (html)
  &#34;Uses HTML from elsewhere and embed it into a section&#34;
  (with-html-string
    (:section
     (:h* &#34;Heading two levels deep&#34;)
     (:section
      (:raw html)))))

(outer-section (inner-section))
;; &lt;section&gt;
;; &lt;h2&gt;Heading two levels deep&lt;/h2&gt;
;; &lt;section&gt;&lt;h3&gt;Heading three levels deep&lt;/h3&gt;
;; &lt;/section&gt;
;;&lt;/section&gt;"><pre>(<span>defun</span> <span>inner-section</span> ()
  <span><span>&#34;</span>Binds *HTML-PATH* to replicate the depth the output is used in.<span>&#34;</span></span>
  (with-html-string
    (<span>let</span> ((<span>*html-path*</span> (<span>append</span> <span>*html-path*</span> &#39;(:section :section))))
      (:h* <span><span>&#34;</span>Heading three levels deep<span>&#34;</span></span>))))

(<span>defun</span> <span>outer-section</span> (html)
  <span><span>&#34;</span>Uses HTML from elsewhere and embed it into a section<span>&#34;</span></span>
  (with-html-string
    (:section
     (:h* <span><span>&#34;</span>Heading two levels deep<span>&#34;</span></span>)
     (:section
      (:raw html)))))

(outer-section (inner-section))
<span><span>;</span>; &lt;section&gt;</span>
<span><span>;</span>; &lt;h2&gt;Heading two levels deep&lt;/h2&gt;</span>
<span><span>;</span>; &lt;section&gt;&lt;h3&gt;Heading three levels deep&lt;/h3&gt;</span>
<span><span>;</span>; &lt;/section&gt;</span>
<span><span>;</span>;&lt;/section&gt;</span></pre></div>
<h2 tabindex="-1" id="user-content-deftag" dir="auto"><a href="#deftag"><code>deftag</code><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">The stumbling block for all sexp-based HTML generators is order of
evaluation. It&#39;s tempting to write something like this:</p>
<div data-snippet-clipboard-copy-content=" ;; Doesn&#39;t work
 (defun field (control)
   (with-html (:p control)))

 (defun input (default &amp;key name label (type &#34;text&#34;))
   (with-html
     (:label :for name label)
     (:input :name name :id name :type type :value default)))"><pre><code> ;; Doesn&#39;t work
 (defun field (control)
   (with-html (:p control)))

 (defun input (default &amp;key name label (type &#34;text&#34;))
   (with-html
     (:label :for name label)
     (:input :name name :id name :type type :value default)))
</code></pre></div>
<p dir="auto">But it won&#39;t work: in <code>(field (input &#34;Default&#34; :name &#34;why&#34; :label &#34;Reason&#34;))</code>, <code>(input)</code> gets evaluated before <code>(field)</code>, and the HTML
is printed inside-out.</p>
<p dir="auto">Macros do work:</p>
<div data-snippet-clipboard-copy-content=" (defmacro field (control)
   `(with-html (:p ,control)))

 (defmacro input (name label &amp;key (type &#34;text&#34;))
   `(with-html
      (:label :for ,name ,label)
      (:input :name ,name :id ,name :type ,type)))"><pre><code> (defmacro field (control)
   `(with-html (:p ,control)))

 (defmacro input (name label &amp;key (type &#34;text&#34;))
   `(with-html
      (:label :for ,name ,label)
      (:input :name ,name :id ,name :type ,type)))
</code></pre></div>
<p dir="auto">But we can do better than this. Spinneret provides a macro-writing
macro, <code>deftag</code>, which lets you <em>refactor</em> HTML without <em>hiding</em> it.</p>
<div data-snippet-clipboard-copy-content=" (deftag field (control attrs)
  `(:p ,@attrs ,@control))

 (deftag input (default attrs &amp;key name label (type &#34;text&#34;))
   (once-only (name)
     `(progn
        (:label :for ,name ,label)
        (:input :name ,name :id ,name :type ,type
          ,@attrs
          :value (progn ,@default)))))"><pre><code> (deftag field (control attrs)
  `(:p ,@attrs ,@control))

 (deftag input (default attrs &amp;key name label (type &#34;text&#34;))
   (once-only (name)
     `(progn
        (:label :for ,name ,label)
        (:input :name ,name :id ,name :type ,type
          ,@attrs
          :value (progn ,@default)))))
</code></pre></div>
<p dir="auto">A macro defined using <code>deftag</code> takes its arguments just like an HTML
element. Instead of</p>
<div data-snippet-clipboard-copy-content="(input &#34;Default&#34; :name &#34;why&#34; :label &#34;Reason&#34;) ; defmacro"><pre><code>(input &#34;Default&#34; :name &#34;why&#34; :label &#34;Reason&#34;) ; defmacro
</code></pre></div>
<p dir="auto">You write</p>
<div data-snippet-clipboard-copy-content="(input :name &#34;why&#34; :label &#34;Reason&#34; &#34;Default&#34;) ; deftag"><pre><code>(input :name &#34;why&#34; :label &#34;Reason&#34; &#34;Default&#34;) ; deftag
</code></pre></div>
<p dir="auto">The macro re-arranges the arguments so they can be bound to an
ordinary lambda list, like the one above: the body of the tag is bound
to the first argument, and matching attributes are bound to keywords.
Multiple <code>:class</code> arguments, <code>:dataset</code>, and other shorthands are
handled exactly as in the usual HTML syntax.</p>
<p dir="auto">But the great advantage of <code>deftag</code> is how it handles attributes which
are <em>not</em> bound to keywords. In the definition of <code>input</code> using
<code>deftag</code>, you see that the <code>attrs</code> catch-all argument is spliced into
the call to <code>:input</code>. This means that any unhandled attributes pass
through to the actual input element.</p>
<div data-snippet-clipboard-copy-content="(input :name &#34;why&#34; :label &#34;Reason&#34; :required t :class &#34;special&#34; &#34;Default&#34;)
=&gt; &lt;label for=why&gt;Reason&lt;/label&gt;
   &lt;input class=special name=why id=why type=text required value=Default&gt;"><pre><code>(input :name &#34;why&#34; :label &#34;Reason&#34; :required t :class &#34;special&#34; &#34;Default&#34;)
=&gt; &lt;label for=why&gt;Reason&lt;/label&gt;
   &lt;input class=special name=why id=why type=text required value=Default&gt;
</code></pre></div>
<p dir="auto">In effect, <code>input</code> <em>extends</em> the <code>:input</code> tag, almost like a subclass.
This is a very idiomatic and expressive way of building abstractions
over HTML.</p>
<p dir="auto">(Spinneret used to provide a more elaborate way of building HTML
abstractions, <code>deftemplate</code>, but <code>deftag</code> is simpler and more useful.)</p>
<h2 tabindex="-1" id="user-content-spinneret-in-parenscript" dir="auto"><a href="#spinneret-in-parenscript">Spinneret in Parenscript<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">To use Spinneret with Parenscript, load the system <code>spinneret/ps</code>.</p>
<p dir="auto">The semantics of Spinneret in Parenscript are almost the same. There
is no <code>with-html-string</code>, and <code>with-html</code> returns a
<code>DocumentFragment</code>.</p>
<p dir="auto">If Markdown support is enabled, strings in function position are still
parsed as Markdown, but supplying arguments triggers an error (since
Parenscript does not have <code>format</code>).</p>
<p dir="auto"><code>get-html-path</code> is not implemented for Parenscript.</p>
<p dir="auto">Neither :ATTRS nor :TAG is available in Parenscript.</p>
<h2 tabindex="-1" id="user-content-parenscript-in-spinneret" dir="auto"><a href="#parenscript-in-spinneret">Parenscript in Spinneret<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">To use Parenscript in Spinneret, remember to wrap the <code>ps</code> macro with <code>:raw</code>, otherwise the generated JavaScript will be escaped.</p>
<div dir="auto" data-snippet-clipboard-copy-content="(with-html-string
  (:script
    (:raw (ps
            (defun greeting ()
              (alert &#34;Hello&#34;))))))
=&gt;
&#34;&lt;script&gt;function greeting() {
    __PS_MV_REG = [];
    return alert(&#39;Hello&#39;);
};&lt;/script&gt;&#34;

(with-html-string
  (:div :onclick (:raw (ps (alert &#34;Hello&#34;)))))
&#34;&lt;div onclick=\&#34;alert(&#39;Hello&#39;);\&#34;&gt;&lt;/div&gt;&#34;"><pre>(with-html-string
  (:script
    (:raw (ps
            (<span>defun</span> <span>greeting</span> ()
              (alert <span><span>&#34;</span>Hello<span>&#34;</span></span>))))))
=&gt;
<span><span>&#34;</span>&lt;script&gt;function greeting() {</span>
<span>    __PS_MV_REG = [];</span>
<span>    return alert(&#39;Hello&#39;);</span>
<span>};&lt;/script&gt;<span>&#34;</span></span>

(with-html-string
  (:div :onclick (:raw (ps (alert <span><span>&#34;</span>Hello<span>&#34;</span></span>)))))
<span><span>&#34;</span>&lt;div onclick=<span>\&#34;</span>alert(&#39;Hello&#39;);<span>\&#34;</span>&gt;&lt;/div&gt;<span>&#34;</span></span></pre></div>
<h2 tabindex="-1" id="user-content-validation" dir="auto"><a href="#validation">Validation<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Spinneret does not do document validation, but it does warn, at compile time, about invalid tags and attributes.</p>
<p dir="auto">Although HTML5 does include a mechanism for application-specific
attributes (the <code>data-</code> prefix), some client-side frameworks choose to
employ their own prefixes instead. You can disable validation for a
given prefix by adding it to <code>*unvalidated-attribute-prefixes*</code>.</p>
<div data-snippet-clipboard-copy-content="(pushnew &#34;ng-&#34; *unvalidated-attribute-prefixes* :test #’equal)"><pre><code>(pushnew &#34;ng-&#34; *unvalidated-attribute-prefixes* :test #’equal)
</code></pre></div>
<p dir="auto">You can disable attribute validation altogether by adding the empty
string to the list:</p>
<div data-snippet-clipboard-copy-content=";; Disable attribute validation.
(setf *unvalidated-attribute-prefixes* &#39;(&#34;&#34;))"><pre><code>;; Disable attribute validation.
(setf *unvalidated-attribute-prefixes* &#39;(&#34;&#34;))
</code></pre></div>
<p dir="auto">Tags are considered valid if they are defined as part of the HTML standard, or if they match the rules for the name of a <a href="https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name" rel="nofollow">custom element</a> – basically, start with an ASCII alphabetic character and include a hyphen. For custom elements, attributes are not validated.</p>
</article>
          </div></div>
  </body>
</html>
