<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.datadoodad.com/recurse%20center/RC04/">Original</a>
    <h1>RC04: Closures, Squirrels</h1>
    
    <div id="readability-page-1" class="page"><div>
      
        <header>
          
          

  <p>
    
      
      <span>
        <i aria-hidden="true"></i>
        
        <time datetime="2023-05-19T00:00:00-07:00">May 19, 2023</time>
      </span>
    

    <span></span>

    
      
      

      <span>
        <i aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


        </header>
      

      <section itemprop="text">
        

        
        <p><i>Daily dispatches from my 12 weeks at the Recurse Center in Summer 2023
</i></p>
        
        <p>What an amazing five days. Don’t pity me when I say this, but this week was easily the most social week I’ve had in years. <em>Years</em>. Wish I could say it’s just been the last three – between Covid lockdown and first-time parenthood… yeah, I haven’t done shit. But no. The reality is I haven’t been so socially embedded probably since around the time that I advanced to candidacy, and that was in 2016. After that I hunkered down on dissertation research and withdrew to the confines of an aptly named “monk cell” at the research institution that would become my home for years to come. I like solitude and quiet, so it was all good. But in retrospect I’m beginning to suspect I was waaayyyy more isolated than was good for me. So that’s a thing. Never would have guessed that a community unfolding primarily on a message board could feel so vital, but it does, and it is, and I’m happy for it. Attitude of gratitude baby!</p>

<!--more-->

<p>Two cool things that happened today:</p>



<p>I was doing a little pairing with another recurser, working on my implementation of a graph. And, well, I learned a thing or two.</p>

<p>The main thing I learned was the importance of closures. Here’s an example of my very basic <code>GraphNode</code> class, with a recursive <code>dfs()</code> function.</p>

<div><div><pre><code><span>class</span> <span>GraphNode</span><span>:</span>

    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>value</span><span>=</span><span>None</span><span>,</span> <span>neighbors</span><span>=</span><span>None</span><span>):</span>
        <span>self</span><span>.</span><span>value</span> <span>=</span> <span>value</span>
        <span>self</span><span>.</span><span>neighbors</span> <span>=</span> <span>neighbors</span> <span>if</span> <span>neighbors</span> <span>!=</span> <span>None</span> <span>else</span> <span>[]</span>

    <span>def</span> <span>__str__</span><span>(</span><span>self</span><span>):</span>
        <span>out</span> <span>=</span> <span>str</span><span>(</span><span>self</span><span>.</span><span>value</span><span>)</span> <span>+</span> <span>&#39;: &#39;</span>
        <span>out</span> <span>+=</span> <span>&#39; &#39;</span><span>.</span><span>join</span><span>([</span><span>str</span><span>(</span><span>neighbor</span><span>.</span><span>value</span><span>)</span> <span>for</span> <span>neighbor</span> <span>in</span> <span>self</span><span>.</span><span>neighbors</span><span>])</span>
        <span>return</span> <span>out</span>

    <span>def</span> <span>dfs</span><span>(</span><span>self</span><span>,</span> <span>target</span><span>,</span> <span>visited</span><span>=</span><span>None</span><span>):</span>

        <span># Base case: current node == target
</span>        <span>if</span> <span>self</span><span>.</span><span>value</span> <span>==</span> <span>target</span><span>:</span> <span>return</span> <span>True</span>

        <span># Initialize set to keep track of visited nodes
</span>        <span>visited</span> <span>=</span> <span>visited</span> <span>if</span> <span>visited</span> <span>else</span> <span>set</span><span>()</span>

        <span># Add current node to `visited`
</span>        <span>visited</span><span>.</span><span>add</span><span>(</span><span>self</span><span>)</span>

        <span># Visit current node&#39;s childen and recursively call function
</span>        <span>for</span> <span>neighbor</span> <span>in</span> <span>self</span><span>.</span><span>neighbors</span><span>:</span>
            <span>if</span> <span>neighbor</span> <span>not</span> <span>in</span> <span>visited</span> <span>and</span> <span>neighbor</span><span>.</span><span>dfs_orig</span><span>(</span><span>target</span><span>,</span> <span>visited</span><span>):</span> <span>return</span> <span>True</span>

        <span># If after all recursive calls target isn&#39;t found, return false
</span>        <span>return</span> <span>False</span>
</code></pre></div></div>

<p>Because graphs can contain cycles, when performing a depth-first search it’s critical to keep track of which nodes you’ve already visited so we can avoid them in the future. Otherwise, we risk falling into an infinite loop (a certainty if a cycle is encountered before the target is found). My solution was to include a <code>visited</code> parameter that defaults to <code>None</code>. On the method’s initial call where <code>visited == None</code>, I re-initialize <code>visited</code> as a set. And at that point we can add the current node to the set, since we’ve visited it. In recursive calls, we can pass this set as an argument, so that way we have an ongoing list of visited nodes we know to avoid.</p>

<p>It works, but I learned it’s probably somewhat bad practice – a work-around to deal with the fact that an empty immutable like a set cannot be a default function argument.</p>

<p>Turns out a better solution is to use a closure to encapsulate the <code>visited</code> set within an outer function. This outer function would then return the inner DFS function configured to use the visited set. Here’s how the new version looks:</p>

<div><div><pre><code><span>class</span> <span>GraphNode</span><span>:</span>

    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>value</span><span>=</span><span>None</span><span>,</span> <span>neighbors</span><span>=</span><span>None</span><span>):</span>
        <span>self</span><span>.</span><span>value</span> <span>=</span> <span>value</span>
        <span>self</span><span>.</span><span>neighbors</span> <span>=</span> <span>neighbors</span> <span>if</span> <span>neighbors</span> <span>!=</span> <span>None</span> <span>else</span> <span>[]</span>

    <span>def</span> <span>__str__</span><span>(</span><span>self</span><span>):</span>
        <span>out</span> <span>=</span> <span>str</span><span>(</span><span>self</span><span>.</span><span>value</span><span>)</span> <span>+</span> <span>&#39;: &#39;</span>
        <span>out</span> <span>+=</span> <span>&#39; &#39;</span><span>.</span><span>join</span><span>([</span><span>str</span><span>(</span><span>neighbor</span><span>.</span><span>value</span><span>)</span> <span>for</span> <span>neighbor</span> <span>in</span> <span>self</span><span>.</span><span>neighbors</span><span>])</span>
        <span>return</span> <span>out</span>

    <span>def</span> <span>dfs</span><span>(</span><span>self</span><span>,</span> <span>target</span><span>):</span>

        <span># Initialize set to keep track of visited nodes
</span>        <span>visited</span> <span>=</span> <span>set</span><span>()</span>

        <span># Inner recursive dfs function
</span>        <span>def</span> <span>dfs</span><span>(</span><span>node</span><span>=</span><span>self</span><span>,</span> <span>target</span><span>=</span><span>target</span><span>,</span> <span>visited</span><span>=</span><span>visited</span><span>):</span>

            <span># Base case: `node` == `target`
</span>            <span>if</span> <span>node</span><span>.</span><span>value</span> <span>==</span> <span>target</span><span>:</span> <span>return</span> <span>True</span>

            <span># Add `node` to `visited`
</span>            <span>visited</span><span>.</span><span>add</span><span>(</span><span>node</span><span>)</span>

            <span># Visite neighbors of `node` recursively
</span>            <span>for</span> <span>neighbor</span> <span>in</span> <span>node</span><span>.</span><span>neighbors</span><span>:</span>
                <span>if</span> <span>neighbor</span> <span>not</span> <span>in</span> <span>visited</span> <span>and</span> <span>dfs</span><span>(</span><span>neighbor</span><span>,</span> <span>target</span><span>,</span> <span>visited</span><span>):</span> <span>return</span> <span>True</span>

            <span># If `target` not found after recursive calls, return false
</span>            <span>return</span> <span>False</span>

        <span># Call inner function
</span>        <span>return</span> <span>dfs</span><span>()</span>
</code></pre></div></div>

<p>Now, the <code>visited</code> set is managed within the closure, keeping the outer function’s interface clean and its usage clearer. It also ensures that the state (i.e., the visited set) persists across recursive calls in a more intuitive manner.</p>



<p>I’ve been looking forward to Data Disco all week, and it delivered! We played around with the <a href="https://data.cityofnewyork.us/Environment/2018-Central-Park-Squirrel-Census-Squirrel-Data/vfnx-vebw">NYC Open Data Squirrel Census</a> dataset, which is a weird one, for sure. It’s about 3,000 squirrel observations made in Central Park during a two-week period from 10/6/2018 - 10/20/2018. It’s got long. and lat. coordinates, other locations information, details about age and colors of observed squirrels, whether it was making any squirrel noises of note (kuks, quaas, and moans) or speaking squirrel body language (tail twitches, tail flags) or doing anything else of note (running, chasing, climbing, eating, foraging). It also includes some user-supplied text fields, which add extra detail and color about the squirrel’s location, it’s activities, and its interactions.</p>

<p>We started with a simple scatter plot to just get a sense of where the observations were made. Evidently squirrels that approach observers are found throughout Central Park.</p>

<p><img src="https://iq.thc.org/assets/images/rc-04_squirrelmap.png" alt="Squirrel map"/></p>

<p>Then we developed a poem generator based on the user-supplied fields, which resulted in honestly some pretty damn rich material:</p>

<div><div><pre><code>Fat!
bench
climbing (over small wire fence then on the ground)

eating upside down on tree trunk
on trunk
Off-white, decorator&#39;s white?

hanging upside down to get a nut
large white highlight
posing

Between park and main drag
eating (on branch)
skinny tail

chasing squirrel #3
edge of park @ 98th (north)
Drawing included.

tree branches
walking
White ring on short tail

bringing green leaves to nest
on fence
Very far, so appx
</code></pre></div></div>



          

        
            
            
            
        

        
      </section>

      

      

      
  

    </div></div>
  </body>
</html>
