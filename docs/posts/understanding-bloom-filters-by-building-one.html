<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ricardoanderegg.com/posts/understanding-bloom-filters-by-building-one/">Original</a>
    <h1>Understanding Bloom filters by building one</h1>
    
    <div id="readability-page-1" class="page"><div>
<h2 id="what-is-a-bloom-filter">What is a Bloom Filter?</h2>
<p>A Bloom filter is a probabilistic data structure. It tells you if an element is in a set or not in a very fast and memory-efficient way. A Bloom filter can tell if an element <strong>is not in</strong> the set (“being 100% sure”) or that <strong>it may be in</strong> the set, but not “being 100% sure”. It only has 2 operations: <code>add</code>, to add an element, and <code>query</code>, to check if an element exists in the set or not.</p>
<h2 id="why-are-they-useful">Why are they useful?</h2>
<p>Bloom filters are some kind of data compressing. With them, you can check if an element exists in a set, but using a lot less space than if you had to store the complete dataset. For example, your browser may check if the URL you are trying to visit is a malicious one. You can use a bloom filter instead of storing all the URLs, when a user tries to visit a page, it checks if the URL is inside the set using a Bloom filter (set of malicious URLs). If the answer is <code>False</code> (remember, that’s with 100% probability), we can safely let the user visit that page.</p>
<h2 id="how-does-a-bloom-filter-work">How does a Bloom filter work?</h2>
<p>First, we need a Bit Vector. That Bit Vector will hold the information about or data. We must decide how big/long the vector will be (we will explain more about this later). We will call the vector size: <code>length</code>, and we will use a <code>length = 10</code>.</p>
<p>Initially, every element in our vector is set to 0.</p>
<div><pre tabindex="0"><code data-lang="python">vector = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
</code></pre></div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 669.77734375 151.53515625" width="669.77734375" height="151.53515625"><defs></defs><g transform="translate(76.10546875 11.55859375) rotate(0 32.29296875 32.29296875)"><path d="m1.06621867977083-.558108782395721 63.0506837964058-.23152619600296-.00100725889205933 63.9645435214043-63.8946782946587-.226898968219757" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m.281203711405396 1.98435324989259c12.7964557109874-3.10268135575818 28.8699747917257-3.17234935073422 65.7882590889931-2.73457771539688m-65.4248732542619 1.7322060232982c24.1465084373827-1.55509057957788 51.0713400482884-1.02682978231569 64.2155787646771-1.58651277422905m-1.44751865509897.826999717392027c-.159751963602687 24.5389085549636 1.70731841327033 45.6196929491605.573073923587799 63.437303006649m-.120661727152765-63.0481688911095c1.55522696459906 22.9133046186173 1.40593679035322 45.2660137248444.586217612028122 63.8962877094746m1.19841649290174.762528860010207c-23.6014646337375.580153813965225-48.2616813274115-2.0624473780323-67.5434173941612-.511971056461334m67.0699948454276-.0678788656368852c-16.8984927480451.596050860077298-33.8634499202235.404033871084607-65.3254006206989-.624299257993698m1.68303476925939-.22865307983011c.838085521693647-12.8337027332054-1.9652580723806-26.79166732249-2.567074239254-63.8265405297279m1.29910452011973 63.6602281993255c.0911939812008495-14.9635763075312.998210645944273-29.4388589672963-.274158746004105-64.5027658641338" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(141.5625 11.6171875) rotate(0 32.29296875 32.29296875)"><path d="m-.46903502382338-.789634978398681 64.5849302411079-.621393978595734.691259205341339 64.3590385317802-65.226032435894 1.97734946012497" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m-1.28427443467081-1.2112359944731c20.1582875875996-.710474569853468 39.661204462919-.179795045908613 67.7850375771523-.240175783634186m-67.2689868723974.523745006881654c17.1957136530538-.105961197916113 32.7028620518962-.311086440387808 66.0278126895428.75727441906929m-1.89664176944643 1.20514705125242c1.48818089997039 23.1289181541193.243886912219381 49.5885915420033 2.26437145471573 64.060428082943M65.255838396959.7861971082165837c-.614874469619167 24.734729424386-1.27014322815455 49.3772166078663-.0850384533405304 63.6947562992573m.0306015526875854 1.16754978243262c-22.903525871109-2.42156173504416-45.3021441341858-.669015603433294-65.9408039450645-.758169710636139m66.0052143419161-.0875638658180833c-24.1912122944013-.124439583366112-49.2575743156704-.668922201936439-66.135420113802-1.07525083422661m2.68718352075666 1.03573044482619c-3.2986878820799-14.8591820476584-3.34608627046568-29.4873403068646-3.14884799718857-66.6276097893715m1.08634714130312 65.6487953430042c.735258219051102-23.460556278412.0649462018487247-48.1539187625735.778034895658493-64.0634891688824" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(206.765625 11.6171875) rotate(0 32.29296875 32.29296875)"><path d="m-.47004228271544-1.41102895699441 65.2771967053413-.226898968219757-.640094935894013 66.563286960125-63.9501478075981-1.79575806856155" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m.427310789003968-1.28090398944914c26.8400615101687.921823585128805 53.055208851026.220636272525808 63.0606856942177 2.57008308172226m-62.8907103156671-1.68858506623656c25.3949458450421.394017038600359 51.5123676956384.828155902879153 64.9794203937054-.187237948179245m-.346688994206488-1.02443934138864c-1.63923386631657 20.7791153560633.0023611992771464 42.3087247154224 1.13492923974991 64.7552694678307M65.10654822271317.4001960875466466c-.222606983913508 22.8476308248115.496913495527181 46.1465679927016-.207741051912308 64.7176206409931m-1.20445219520479-2.11191473063082c-22.5883147322114 2.09568013780059-43.0201715634219 2.2275654875511-62.1960396170616 2.76070731878281m63.7905705953017-1.15585669223219c-20.903630972455-.40443956529613-41.675667287012-.743190791959719-66.0189564526081.742138653993607m-.255697795189917-.788271612487733c-.634347412058778-16.9268377287088-.932453426787324-35.7615066494342 2.43691974878311-64.0327439904213m-.789060345850885 63.8539829319343c-.512124550829249-14.0999212664196.0292056972881982-27.0160532796042-.896608620882034-64.7806760966778" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(270.2109375 11.6171875) rotate(0 32.29296875 32.29296875)"><path d="m.221216922625899-1.63792792521417 63.945842564106 1.97734946012497.635789692401886 62.7901794314385-63.623665034771 1.85416907072067" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m1.48352530039847-.750224465504289c15.8956409802435-.287545387572682 28.3472149591442 2.45304548280772 65.0663753151894-.786222994327545m-66.2756698047742.931916243396699c13.7837790880927.692098956994087 27.4852551290052.275847387007743 64.4229409396648-.00696393847465515m-.711448171176016-.3146708374843c1.84958764037226 24.1527226406157 2.58721580227946 44.9190374290585 1.82341915369034 66.8519052863121m-1.35786326881498-66.0037864679471c1.05576179543051 24.4265720608986.783769022612901 49.5169443613602.47689887881279 64.9717166721821m-2.23596228007227-.135221368633211c-21.652802323574-.378355021178649-42.2222058281783.497920816242768-62.4829525351524 1.1872381567955m64.2275467598811-1.87941628042609c-21.4966927910333-.322724145889595-42.133366851903 1.30264835333793-64.8109705746174 1.42845514416695m-.659006395377219-.897711253724992c.020227832387973-21.8238104080323 2.8026519842854-39.37594761355-.796099126338959-65.0868650078774m1.82104490045458 64.244327343069c.113712498284804-13.6467938997659-.6539143535123-27.9617577748126-.226800233125687-64.4599907100201" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(335.5859375 11.6171875) rotate(0 32.29296875 32.29296875)"><path d="m-.418878013268113.339421534910798 65.2217271924019-1.79575806856155.962272465229034 66.4401065707207-65.9907247424126 1.51502150297165" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m1.91482564248145-1.45141177810729c12.2265953404371 2.98286062258056 30.5278614725001.157234070475606 60.8157783150673 2.6459841132164m-62.0569524979219-1.36496468726546c17.1132979244801-.0258094163715578 33.0299434365457-.0506606491386628 64.4296633899212.49243238568306m.524003795348108.187205248512328c.543801268063177 12.2221185239738-.0120028057474002 29.1767867153059.531013071537018 65.1179136633873m-.987531772814691-65.7321430379525c-.358962927672479 22.5973485208691-.329591755482767 44.3336864902856-.0535795986652374 64.2451303303242m-1.27068529371172.750187241472304c-12.0356597334154.931984641102687-27.5980891048923 1.11106161072625-63.412870824337 1.10150092840195m63.2826650524512-2.26431562844664c-19.3965143358677 1.28974037627333-38.5766561818062 1.43157424787634-63.6276734173298.365534573793411m-1.41992855910212-1.37147641833872c3.11606434576337-16.9107033943066-.164352917744472-37.2393698165674-.271732747554779-61.3973947167397m2.13611478451639 62.9827008908615c-.762317301144431-18.1993160632548-.76282093059046-36.593566017806-.422500878572464-65.1258470714092" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(400.5703125 10) rotate(0 32.29296875 32.29296875)"><path d="m.216911679133773-1.45633653365076 65.548209965229 1.85416907072067-1.40478724241257 66.1009590029717-64.9829675555229-1.03781014680862" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m-1.09794101677835 1.28917909227312c20.0149878603646-2.35692260016694 33.148774930324.374097194774004 64.8850665688515-.740717470645904m-62.7963564908132-1.1351055437699c14.5918249030707.0851982653013692 30.4693277159924 1.01873345373788 62.7896268069744.2865369617939m2.58455093856901-1.14164433535188c-.219511186120869 19.1664693946492.12967779731953 35.252805351188-.978617131710053 65.7583727240562M64.89880717080086.5318792285397649c.407110064486119 18.6475590292241.596152066448781 36.7657420284799-1.10288742184639 63.1071975529194m2.28833310957998 2.1275325352326c-21.2219211175812.277375468085594-40.9303897052552.323523589442559-66.0346226096153-1.47892624139786m63.8062367523089 1.06520820315927c-15.6635498086565-.412583906884606-31.2201936801183-1.81425570392173-63.8665259182453-1.283537119627m1.46181037183851 1.04845901671797c-2.85050978746374-20.4332770091489-2.62424942340811-38.0307939017206-1.85130923986435-65.1342549920082m.16564027313143 64.2075618272647c-.344817294511085-14.3164076873443.000812308159584108-28.4355678695007.0250785052776337-64.0214092433453" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(466.02734375 10.05859375) rotate(0 32.29296875 32.29296875)"><path d="m1.17918414436281.397832537069917 63.1811502575874 1.51502150297165-.397030055522919 63.5481273531914-64.719534099102-.841435253620148" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m1.96396311558783-1.53644745983183c10.8694450725809 2.31470559354166 26.6147083977252 1.66859488005975 61.4129119515419 2.88375037908554m-63.2656408166513-1.9587980741635c18.6814293683849 1.31242466533913 35.6337966563864.690277671463628 64.0116202533245 1.13218572735786m1.68628822918981.819111221469939c.923683902945996 20.7217050994055.151681861606122 40.4314530302319-1.37929958105087 64.4158605933189m.498335191048682-65.4479303890839c.391111812002563 17.9442083858063-.930188783996201 36.1408705756287-.255985528230667 63.9085042774677m.12300821300596 1.72945001069456c-20.1343655354816.427422102161287-40.8771657480873-1.2767292302171-65.8345360159874-3.09896522760391m65.2511122012511 2.64800409134477c-13.3687873161274-.90632750903147-27.2997055602944-.930026703224357-64.206239014864-1.57442399859428m-1.83480400685221.175785236991942c-.242359521764956-11.5411741730532.960488137822904-26.2370057099979.166343271732331-63.029867708683m1.42790139559656 62.814204341732c.497094936340509-17.6869317872093.177047468393503-34.2717393602463.343476980924606-64.6085912883282" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(531.23046875 10.05859375) rotate(0 32.29296875 32.29296875)"><path d="m-.22560309804976 1.91285404004157 64.1889074444771-1.03781014680862-.13359659910202 63.7445022463799-65.5070649981499.254536807537079" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m-1.85533354245126 1.19457233510911c24.5954448585173-.14994621541824 47.7241176375668.648895082208255 66.1004863381386.786965787410736M.5173773495480418.3220400335267186c14.2639674996601-.227207115309939 30.1933126162025.593590417486921 64.3231827914715.567464619874954m1.31777157541364.151716792024672c-.37699275770116 13.4094007791959-1.33347928085256 29.5683800343439-1.78236240148544 64.1704553961754m.741251030005515-65.6574681038037c-1.1002611390454 22.3099036548629-.223988073239966 45.6980362602262-.379084855318069 65.7808864414692m.281466237269342.656739228405058c-23.5725550360286-1.26504808173507-47.8500413312126-2.70601009831756-66.7364391684532-2.86603790521622m66.3914308035746.96725685056299c-24.4285389090997.563249829480114-48.7415659239734.414196822115841-65.6067736446858 1.21845987439156m-.670825161971152.598606490530074c1.79357189554146-22.433989741328.5308071436303-42.4446949520163 1.04489666223526-66.3791547417641m.66871724370867 64.2360085612163c-.168256860477923-15.837140751804.14963798572302-33.5608352679512.478983610868454-63.568057268858" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(594.67578125 10.05859375) rotate(0 32.29296875 32.29296875)"><path d="m-.622633153572679.875043893232942 64.452340900898-.841435253620148-.921127498149872 64.8404743075371-61.8397008776665-.412003338336945" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m-.798811947926879.548461621627212c14.00388578442.413078426753564 29.2862997823409 1.04731363001971 64.2114616036415-.325993120670319m-64.2181912874803-.522575461305678c15.768841099913.612804958018314 31.9129292014739.981619038971912 64.6706034839153.911709576845169m1.52126782294363-.88091868814081c-.448713750211823 25.1414399551002-.502587587205994 48.2998534056838.263366281986237 65.5397352576256m-1.85377620812505-66.217279904522c1.21940707199515 21.9404567041078 1.28534974687041 44.4226128177004 1.3803536593914 65.6374299824238M64.63556774891913 64.2876830752939c-24.8557789935738-.986956167530664-49.3000952033341-.707880723786005-63.1016601920128-.450066149234772m63.0413710260764.231737232767046c-25.2290743715472-.467386854480793-51.4120643391027.923825221467922-64.3093407452107-.398049563169479m-.666095622815192.898191087879241c-.745106704615683-16.7112460900338.359707049942881-36.0404063798967-.38947719335556-65.0395379662514m.580195971764624 65.2256905501708c.24645733450765-15.7170288829242.727593567122167-29.6090941962073.0966374576091767-63.7992212474346" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(10 10.05859375) rotate(0 32.29296875 32.29296875)"><path d="m-.756229752674699.0336086396127939 63.6648100018501.254536807537079 2.74623662233353 64.1739341616631-64.3990823626518-.315665066242218" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m-1.20906243287027 1.34730291925371c24.1016876872869.457120663188325 46.5025945060435-1.30194895837463 64.5720096230507-.312548220157623m-63.8260301863775-.514064126648009c22.173412635002.562640974797614 42.6536213439176.284738937892325 65.7189213931561.265506535768509m-.825995245017111.383527779020369c.20459655798615 22.1942088642631 1.47832320011796 44.9911456185408.771558344364166 64.4787783026695m-.529208681546152-66.0182044142857c-.444297696053908 17.6154554937843-.00615977734319984 33.4675261685377.593619078397751 65.1724708378315m-1.71920938137919-1.95604855474085c-24.5933421938455.182760235578826-45.2584369359087.894580659181884-61.7290272116661 1.91652816534042M64.5914756981656 63.9203011514619c-17.1301612596602 1.05757188208277-32.1244859180632-.582636749671153-64.8364012539387-.13586637377739m-1.4179969811812 1.86772140208632c1.23403658303323-25.1872124519206 1.00251038703027-48.8401784591391.251893579959869-65.4309392571449m1.5194847965613 63.6365523105487c.61640437853981-13.1593411842703-.0859892426664737-26.4882561524151-.419772416353226-63.4202472865582" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(76.62109375 76.890625) rotate(0 32.29296875 32.29296875)"><path d="m-1.47724780999124-.229036087170243c22.0592268374989-.50497494732037 42.3270966345925.805024339808078 65.122737467289-.128778994083405m-62.9722388302907.848485535942018c17.5596405838725-.526314762396432 36.5162872025961-.658636507553674 63.6405179202557-.34853383898735M64.31022497452796-.9193170610815287c-.449886056868195 13.3738591114532 1.8418078093847 29.1402410347961 1.97389751672745 66.5929674506187m-2.43446197267622-66.4998205536977c.272706128070197 23.4159179706003.0324878761266092 46.4098817862323.0468318164348602 65.2045486271381m-.421282597817481.26772075239569c-24.1260965227855 1.6521200054093-48.8988967656638-1.69931488104623-63.9922642111778 1.20332473516464m65.4378495300189-1.35439895931631c-25.8140026087516-.134597023214525-49.7847711553084-.0513445038453995-65.6054785549641-.266264170408249m1.4685642933473-.932995832525194c-2.2206990436848-21.3729023483589.799628703183335-47.1873883301407-.344107091426849-62.9793477654457m-.337085328064859 65.1400664811954c-.579156329515463-26.0493037724278-1.65106823075104-51.4189381646676.209953993558884-65.8967144191265" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(142.078125 76.94921875) rotate(0 32.29296875 32.29296875)"><path d="m.19903620518744-.323339397087693c23.3674245988026 1.38396183918456 45.8255112001687.0394868678901549 64.2951140999794 1.66365760564804m-65.3406320428476-1.86027779523283c14.4099019305191-.449225858353238 29.6395699056549.345192089177508 64.5089957416058-.0556194484233856m.569568029604852-.381642944179475c2.20265810656238 23.1796874771135 1.96300469803501 43.6950740356479 1.34274631738663 64.2934240698814m-1.04888503905386-63.315657668747c-.715749642990929 13.413164088886-1.10498236789594 25.7487038567881.977718085050583 64.0156209766865m-.851561107672751 2.2937715286389c-18.5284173540313-3.33200688251054-38.7004256351866-.461084972701428-62.8976463675499-.498745501041412m62.3937723422423-2.00433012191206c-23.6407826176721.0245358232699004-49.6698680383837.343182820483264-63.4237072765827.0151145756244659m-2.64183182362467 2.13604181353003c2.76718936688856-22.6117663186749 2.10394815928892-42.7805337512415 3.69307667016983-64.0819917321205m-1.63994871731848 62.6214038198814c-1.13823415088707-16.6292594728635.11050500225967-33.1114728565546-.512663155794144-65.3491308391094" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(207.28125 76.94921875) rotate(0 32.29296875 32.29296875)"><path d="m.0839631799608469.986659890040755c17.6117447067758-1.24005908083644 37.0965610840838.45807420897756 63.0022197365761.359841763973236m-64.0553911840543-1.99878298584372c23.24186189674 1.1302387212043 45.1354295353624.412523070407406 65.7795426547527.514425069093704m1.71344151254743 1.53525217715651c-.353923843734734 16.097350512632-1.06321798407363 30.1669357512161-3.91578525304794 61.7159876227379m1.67773441318423-62.668078684248c-.42798053375904 13.3870199013843 1.17918852814014 27.0846906282692.251103132963181 63.5852687656879m.645458928309381-1.05207157786936c-20.6834653846228 3.43411109982998-37.9820182784009 3.41587857543499-63.5300182700157 2.27715057134628m63.5666226828471-1.3455387884751c-20.1062518219573-.171609480163383-37.4856636246885-.558394421121406-64.9902575314045 1.06776407361031m.874380907975137-.75919113215059c-.0440839725417752-14.5257632319357 1.29190615835956-28.1555856832318-2.03383868932724-64.0133100152016M-.93609678465873 64.25804523844272c1.16102168683887-25.1106239760171.47153127913356-50.5003798413774 1.8943278491497-63.4863311946392" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(270.7265625 76.94921875) rotate(0 32.29296875 32.29296875)"><path d="m-.94044784270227-.357815081253648c19.1802829932894 1.37951151985435 36.1039379500799 1.38569496530799 66.507726252079-1.33514839410782m-65.8394471621141 1.83510009106249c15.3663187699269-.296433637497175 32.5317126665017.141289134862673 64.3984477221966-.319064348936081m2.15784352179617 1.26464062277228c-.0835085914715421 13.9471790047137-3.05034629565321 30.0089877549108-3.35052531957626 63.3782362341881m.962895163334906-64.6735081607476c1.41327404298129 19.1662562601843.446440838950295 38.6691338048535.719526022672653 64.8265779316425m-.54713533166796 1.2304050559178c-22.7361647545367-.537321154933821-47.84602297526-1.11285996900166-64.2507080435753-2.13890892267227m64.0830790186301.51824579294771c-13.0640139899559-.823271998207858-28.03311545092.312630019147107-64.5463402569294-.601479738950729m1.08485995884985 1.27507364097983c.979793870515496-22.2916127298267-1.72679374211344-47.8534834094826 1.30131870508194-64.6307244896889m-1.42845003958792 63.8740765517578c-.0849035234261101-19.3247880680596 1.25017558028216-36.654690691478-.904033929109573-63.2077295482159" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(336.1015625 76.94921875) rotate(0 32.29296875 32.29296875)"><path d="m-.0917871948331595 1.34031820856035c21.1540315609665.121732557825671 46.1971260034028-2.91773257154979 63.6378055214882-3.27873474359512m-64.46944182273 1.36283749993891c16.3107815003132.345922506578572 30.7896871995399.306851036079534 65.0307500064373 1.54449823498726m1.46750184055418-2.2186546092853c-2.41844335563837 23.6655689561281-2.09283683069407 48.9065220522709-.947802007198334 65.235248029232m.876635053195059-64.5352847212926c-1.41211782738559 22.2462326099041-1.33292766258113 45.0865022757775-.0457241833209991 65.4338844120503m.882454208098352.94707911554724c-14.2870800151264-.167521529435106-30.3060688284706-1.71265911364455-67.8585438132286.0206541419029236m66.8286088788882-2.00986968819052c-15.5067956622333.905216110570976-31.3914265982094-.445380704776696-64.6144163906574 1.29546907544136m1.07972373720258 1.34451850596815c-2.8486035971075-19.880468810723-.176687410297964-38.0040349267438-1.91277927160263-68.3541570305824m-.239832601509988 65.6264300113544c1.13315609899808-15.6546432370662-.416466526114455-32.7464383830069-.523959428071976-64.6314899623394" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(401.0859375 75.33203125) rotate(0 32.29296875 32.29296875)"><path d="m-1.06749168597162-.891173535957933c23.0408719135456 3.11755681338014 49.0290952827796 1.3766356140584 65.9855514168739.76338142156601m-65.077782115899.168545938096941c16.6541001342579.863361979456458 33.72891846157-.394057994155373 64.8622023761272-.41816446185112m1.85359691735357.976797574199736c-1.52221456414212 17.6199086743647-3.46490904932965 37.2617957270253-1.93043941259384 64.3450521826744M63.85072985570878.7918024184182286c-.047663065253218 23.0758807971251.0738654708280961 46.7329507498289.654533118009567 63.5540769398212m-.544846215285361 1.72834196034819c-18.7930541307207-2.30638092458008-40.7323847354404-2.80407321154831-64.6891426444054-1.81552559137344m64.812788345851.317180073820055c-17.6333855328958-.693632895777768-35.9994342203936.414728914668018-63.9584400951862-.0727722346782684m-1.72368580941111-.0377060836181045c3.10155037046068-17.6160928180216 1.12149855495089-32.9935324530597 1.07858234643936-64.3374925255776m.0462982738390565 65.4499139850959c.185870692764802-14.9074125622043 1.33428712252287-26.9386530586737-.419100075960159-64.9657041728497" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(466.54296875 75.390625) rotate(0 32.29296875 32.29296875)"><path d="m1.63708725012839-.16134905256331c11.4105759726146.974537037676128 26.7338964673239 1.5335902798827 62.3233295083046 1.64963287115097m-64.7581289326772-1.85264676157385c23.0719145850388.4221743232257 45.9622219236786.279339272404395 64.8817746341229.354301244020462m1.68147047515959.261306428350508c-1.68018278328127 20.1842470882933-1.79525771585649 42.7912904259763-2.77765887975693 64.2141527533531m1.33728037122637-64.7251380318776c-.140405805809351 23.2480523228522-1.13890958021388 48.4105762719861-.212399750947952 65.837559491396m1.54252498503774-2.77644724305719c-13.4669272262378.734952707397824-26.5639566100683.642337401020413-66.5397190451622 1.01103347539902m65.6212282264605.518656975589693c-21.2662853217327 1.0722197702794-44.4241998625206 1.12445117148447-65.6933234035969-.624952524900436m.935286304913461-.794775522314012c1.73501590944717-17.8691074953422.870059232487183-36.4620251866072.468789637088776-63.6413655877113m-.997441372834146 65.0934294229373c-.243227949808425-20.4094129925004-.568542561004942-43.1464808235629 1.46537086367607-63.6689769923687" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(531.74609375 75.390625) rotate(0 32.29296875 32.29296875)"><path d="m.515031164512038 1.06934216059744c23.4823435683844.590719595538758 49.8329179564709 1.11550481616177 62.7623590826988-1.9537815451622M.2879192652180791.1508513418957591c16.3350211138379.661400520556999 34.0991012563012-.469090825563835 64.98163869977-1.10738590359688m-2.64206386264414.935286304913461c.173178291181173 14.9340008202817.573234951356497 27.7623745806268.36014312505722 65.0547271370888m2.2929917043075-65.5833788728342c-.70726204211482 17.3610051706208.358795729329501 34.0539834171083-1.11277028918266 66.0513083636761m.177954339422286.033918253146112c-23.6582209507578.627112074260296-47.805755027126-2.04976667606395-64.2843213677406-.687679708003998m65.4067370062694-1.18703287001699c-23.6958259564832 1.48050905522665-46.1617505991846-.0780504519049359-64.9234573543072 1.5791127383709m.432284408248961-1.19932941440493c-3.24611667993951-12.7849085876129-2.50163481834818-25.2221971648498-1.29017502069473-62.6243614554405m.79399514850229 63.5257508540526c-1.64810911933768-24.5514110045748-.47878177086699-48.0726677809391-.367414683103561-64.0601055920124" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(595.19140625 75.390625) rotate(0 32.29296875 32.29296875)"><path d="m1.76458224095404-1.85064690746367c20.1836473268464 4.1448597485129 42.8270972812563 1.02774073424975 63.9108977913857 3.15822547674179m-65.1869521951303-1.58034863416106c11.9488996514461-.0487615428643039 25.6423700350089.393208894900818 63.9408499896526.980788022279739M65.54768910445273.7116985376924276c-2.19434886057985 23.2622624056654.144305836361525 48.5848332677517-.734829366207123 65.6376013159752M64.01082471292466.7306550862267613c.329630485705636 15.6988463372101.600950739316247 33.5983886659364.365627020597458 63.7678487598896m1.88233228679746 2.06181600037962c-16.3451003729839-4.00545229912495-32.8396510480918-2.02826818228459-64.6060814261437-.367458879947662m62.5941440844908-1.85996004287153c-18.7279765113133-.334908160836278-36.9819511381662-.214411798388539-63.6109936535358-.485587328672409m-.551889845170081 1.72528379503638c-1.08868572220548-19.9806307007333-.240025074336372-36.9186531403582-1.58371776342392-64.2260957360268m.530546315945685 62.5871545141563c1.24374768082744-21.7504044344292.592492937489806-45.0129424671861 1.19360515475273-64.0715124309063" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(10.515625 75.390625) rotate(0 32.29296875 32.29296875)"><path d="m-.675231093540788 1.91988369263709c12.980839629878-1.67716766857186 28.3529203333645-3.83742387556114 64.0117277503014-1.67882770299912m-63.0218537980691-.115624091587961c19.8284524283612-.575660426309405 38.7126423521448.0144664755556005 64.4743707478046.561304777860642m-1.09424964245409-2.52449090126902c2.19636571107206 18.104516411863.455444511750315 34.0247314473832.76338142156601 65.7705379128456m.168545938096941-64.7049596225843c-.353995765181097 17.9320997987415-1.61141573879293 37.1363887378029-.41816446185112 65.3691994845867m.976797574199736.995704195462167c-15.6146001094829-1.30647798167432-29.2072218406698-.330873745548374-64.8268228173256.224847376346588m65.0192382996902-2.13709815498441c-20.8789034658817-.353312213555839-41.1766177761849.349945257767175-65.6177980601788 1.05889961123467m1.72834196034819.794767967425287c-2.86565083563568-25.1962268263676-3.36334312260391-48.9242892087656-1.81552559137344-65.8217586874962m.317180073820055 65.1852808678523c-.323371892144132-21.1604899070233.784989918301653-42.668968896383-.0727722346782684-65.3744776546955" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(100.9140625 92.18359375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">1</text></g><g transform="translate(166.37109375 92.2421875) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">2</text></g><g transform="translate(231.57421875 92.2421875) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">3</text></g><g transform="translate(295.01953125 92.2421875) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">4</text></g><g transform="translate(360.39453125 92.2421875) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">5</text></g><g transform="translate(425.37890625 90.625) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">6</text></g><g transform="translate(490.8359375 90.68359375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">7</text></g><g transform="translate(556.0390625 90.68359375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">8</text></g><g transform="translate(619.484375 90.68359375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">9</text></g><g transform="translate(34.80859375 90.68359375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(100.8515625 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(167.7421875 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(229.828125 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(295.7734375 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(361.71875 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(424.14453125 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(491.03515625 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(553.12109375 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(619.06640625 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(34.9609375 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g></svg>
<p>To store data inside the bit vector we need to preprocess it. We need to pass the data through <code>X</code> number hash functions, those functions will return integers. The hash functions we use must be as fast as possible. Some common hash functions that we can use are <a href="https://en.wikipedia.org/wiki/MurmurHash">MurMurHash</a> or <a href="https://github.com/Cyan4973/xxHash">xxHash</a>. Both have Python bindings that we can use for our implementation.</p>
<p>In this example we will use <code>X = 3</code> hash functions.</p>
<p><em>Note</em>: Since this post is about explaining how Bloom Filters work, I will use the hash functions included in the Python standard library, that way it will be easier to play with the examples without having to install anything. Those hash functions are not as fast as we need, but are good to code the examples.</p>
<p>Anyway, here’s a short snippet if you want to use the fast functions mentioned before:</p>
<div><pre tabindex="0"><code data-lang="python"><span># MurMurHash, xxHash and the built-in `hash()` function in Python.</span>
<span>import</span> murmurhash
<span>import</span> xxhash

data = <span>&#34;this is a message with some data&#34;</span>

hash_value1 = xxhash.xxh32_intdigest(data)
hash_value2 = murmurhash.hash(data)
hash_value3 = xxhash.xxh64_intdigest(data)


hash_value1, hash_value2, hash_value3
</code></pre></div><pre><code>(773648684, 2013144662, 11112426289249758424)
</code></pre>
<p>Python comes with the <a href="https://docs.python.org/3/library/hashlib.html">hashlib</a> module. We can use some functions found in there.</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> hashlib <span>import</span> sha1, md5, sha256
</code></pre></div><div><pre tabindex="0"><code data-lang="python">data = <span>&#34;this is a message with some data&#34;</span>
</code></pre></div><p>To get an integer from our hash function we need to get the hash digest (the bytes that the hash function returns), and convert those to integer. We can do it like this.</p>
<div><pre tabindex="0"><code data-lang="python"><span>def</span> sha1_int(data: bytes):
    <span>return</span> int(sha1(data).hexdigest(), base=16)


<span>def</span> md5_int(data: bytes):
    <span>return</span> int(md5(data).hexdigest(), base=16)


<span>def</span> sha256_int(data: bytes):
    <span>return</span> int(sha256(data).hexdigest(), base=16)
</code></pre></div><p><em>Note</em>: the functions in the hashlib module need the input data as <code>bytes</code>, not <code>string</code>. We can use <code>data.encode()</code> to do the conversion.</p>
<div><pre tabindex="0"><code data-lang="python">hash_value1 = sha1_int(data.encode())
hash_value2 = md5_int(data.encode())
hash_value3 = sha256_int(data.encode())  <span># built-in python hash() function</span>


hash_value1, hash_value2, hash_value3
</code></pre></div><pre><code>(745951622377321548266496312092986415888481579279,
 42524137162357419646727732885791601796,
 27838692698195609171558989627466754261699905594803567920934777340154558766262)
</code></pre>
<p>We have 3 integers, the outputs of each one of the hash functions. However, for a Bloom filter to be efficient, the outputs of the hash functions should be evenly distributed between <code>0</code> and our vector length (<code>10</code>). To achieve that, we take the <a href="https://en.wikipedia.org/wiki/Modulo_operation">modulo</a> (<code>m</code>) of each integer. The modulo value (<code>m</code>) is equal to the vector length. In our example:</p>
<p>We will get 3 new integers, each one will represent the index in our vector.</p>
<div><pre tabindex="0"><code data-lang="python">vector_lenght = 10
modulo = 10

hash_values = [hash_value1, hash_value2, hash_value3]

indexes = [h % modulo <span>for</span> h <span>in</span> hash_values]

print(indexes)
</code></pre></div><pre><code>[9, 6, 2]
</code></pre>
<p>Now that we have 3 vector indexes, we need to set those indexes to <code>1</code>.</p>
<div><pre tabindex="0"><code data-lang="python"><span>for</span> index <span>in</span> indexes:
    vector[index] = 1


print(vector)
</code></pre></div><pre><code>[0, 0, 1, 0, 0, 0, 1, 0, 0, 1]
</code></pre><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 669.64453125 151.53515625" width="669.64453125" height="151.53515625"><defs></defs><g transform="translate(75.97265625 11.55859375) rotate(0 32.29296875 32.29296875)"><path d="m1.06621867977083-.558108782395721 63.0506837964058-.23152619600296-.00100725889205933 63.9645435214043-63.8946782946587-.226898968219757" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m.281203711405396 1.98435324989259c12.7964557109874-3.10268135575818 28.8699747917257-3.17234935073422 65.7882590889931-2.73457771539688m-65.4248732542619 1.7322060232982c24.1465084373827-1.55509057957788 51.0713400482884-1.02682978231569 64.2155787646771-1.58651277422905m-1.44751865509897.826999717392027c-.159751963602687 24.5389085549636 1.70731841327033 45.6196929491605.573073923587799 63.437303006649m-.120661727152765-63.0481688911095c1.55522696459906 22.9133046186173 1.40593679035322 45.2660137248444.586217612028122 63.8962877094746m1.19841649290174.762528860010207c-23.6014646337375.580153813965225-48.2616813274115-2.0624473780323-67.5434173941612-.511971056461334m67.0699948454276-.0678788656368852c-16.8984927480451.596050860077298-33.8634499202235.404033871084607-65.3254006206989-.624299257993698m1.68303476925939-.22865307983011c.838085521693647-12.8337027332054-1.9652580723806-26.79166732249-2.567074239254-63.8265405297279m1.29910452011973 63.6602281993255c.0911939812008495-14.9635763075312.998210645944273-29.4388589672963-.274158746004105-64.5027658641338" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(141.4296875 11.6171875) rotate(0 32.29296875 32.29296875)"><path d="m-.46903502382338-.789634978398681 64.5849302411079-.621393978595734.691259205341339 64.3590385317802-65.226032435894 1.97734946012497" stroke="none" stroke-width="0" fill="#228be6"></path><path d="m-1.28427443467081-1.2112359944731c20.1582875875996-.710474569853468 39.661204462919-.179795045908613 67.7850375771523-.240175783634186m-67.2689868723974.523745006881654c17.1957136530538-.105961197916113 32.7028620518962-.311086440387808 66.0278126895428.75727441906929m-1.89664176944643 1.20514705125242c1.48818089997039 23.1289181541193.243886912219381 49.5885915420033 2.26437145471573 64.060428082943M65.255838396959.7861971082165837c-.614874469619167 24.734729424386-1.27014322815455 49.3772166078663-.0850384533405304 63.6947562992573m.0306015526875854 1.16754978243262c-22.903525871109-2.42156173504416-45.3021441341858-.669015603433294-65.9408039450645-.758169710636139m66.0052143419161-.0875638658180833c-24.1912122944013-.124439583366112-49.2575743156704-.668922201936439-66.135420113802-1.07525083422661m2.68718352075666 1.03573044482619c-3.2986878820799-14.8591820476584-3.34608627046568-29.4873403068646-3.14884799718857-66.6276097893715m1.08634714130312 65.6487953430042c.735258219051102-23.460556278412.0649462018487247-48.1539187625735.778034895658493-64.0634891688824" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(206.6328125 11.6171875) rotate(0 32.29296875 32.29296875)"><path d="m-.47004228271544-1.41102895699441 65.2771967053413-.226898968219757-.640094935894013 66.563286960125-63.9501478075981-1.79575806856155" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m.427310789003968-1.28090398944914c26.8400615101687.921823585128805 53.055208851026.220636272525808 63.0606856942177 2.57008308172226m-62.8907103156671-1.68858506623656c25.3949458450421.394017038600359 51.5123676956384.828155902879153 64.9794203937054-.187237948179245m-.346688994206488-1.02443934138864c-1.63923386631657 20.7791153560633.0023611992771464 42.3087247154224 1.13492923974991 64.7552694678307M65.10654822271317.4001960875466466c-.222606983913508 22.8476308248115.496913495527181 46.1465679927016-.207741051912308 64.7176206409931m-1.20445219520479-2.11191473063082c-22.5883147322114 2.09568013780059-43.0201715634219 2.2275654875511-62.1960396170616 2.76070731878281m63.7905705953017-1.15585669223219c-20.903630972455-.40443956529613-41.675667287012-.743190791959719-66.0189564526081.742138653993607m-.255697795189917-.788271612487733c-.634347412058778-16.9268377287088-.932453426787324-35.7615066494342 2.43691974878311-64.0327439904213m-.789060345850885 63.8539829319343c-.512124550829249-14.0999212664196.0292056972881982-27.0160532796042-.896608620882034-64.7806760966778" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(270.078125 11.6171875) rotate(0 32.29296875 32.29296875)"><path d="m.221216922625899-1.63792792521417 63.945842564106 1.97734946012497.635789692401886 62.7901794314385-63.623665034771 1.85416907072067" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m1.48352530039847-.750224465504289c15.8956409802435-.287545387572682 28.3472149591442 2.45304548280772 65.0663753151894-.786222994327545m-66.2756698047742.931916243396699c13.7837790880927.692098956994087 27.4852551290052.275847387007743 64.4229409396648-.00696393847465515m-.711448171176016-.3146708374843c1.84958764037226 24.1527226406157 2.58721580227946 44.9190374290585 1.82341915369034 66.8519052863121m-1.35786326881498-66.0037864679471c1.05576179543051 24.4265720608986.783769022612901 49.5169443613602.47689887881279 64.9717166721821m-2.23596228007227-.135221368633211c-21.652802323574-.378355021178649-42.2222058281783.497920816242768-62.4829525351524 1.1872381567955m64.2275467598811-1.87941628042609c-21.4966927910333-.322724145889595-42.133366851903 1.30264835333793-64.8109705746174 1.42845514416695m-.659006395377219-.897711253724992c.020227832387973-21.8238104080323 2.8026519842854-39.37594761355-.796099126338959-65.0868650078774m1.82104490045458 64.244327343069c.113712498284804-13.6467938997659-.6539143535123-27.9617577748126-.226800233125687-64.4599907100201" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(335.453125 11.6171875) rotate(0 32.29296875 32.29296875)"><path d="m-.418878013268113.339421534910798 65.2217271924019-1.79575806856155.962272465229034 66.4401065707207-65.9907247424126 1.51502150297165" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m1.91482564248145-1.45141177810729c12.2265953404371 2.98286062258056 30.5278614725001.157234070475606 60.8157783150673 2.6459841132164m-62.0569524979219-1.36496468726546c17.1132979244801-.0258094163715578 33.0299434365457-.0506606491386628 64.4296633899212.49243238568306m.524003795348108.187205248512328c.543801268063177 12.2221185239738-.0120028057474002 29.1767867153059.531013071537018 65.1179136633873m-.987531772814691-65.7321430379525c-.358962927672479 22.5973485208691-.329591755482767 44.3336864902856-.0535795986652374 64.2451303303242m-1.27068529371172.750187241472304c-12.0356597334154.931984641102687-27.5980891048923 1.11106161072625-63.412870824337 1.10150092840195m63.2826650524512-2.26431562844664c-19.3965143358677 1.28974037627333-38.5766561818062 1.43157424787634-63.6276734173298.365534573793411m-1.41992855910212-1.37147641833872c3.11606434576337-16.9107033943066-.164352917744472-37.2393698165674-.271732747554779-61.3973947167397m2.13611478451639 62.9827008908615c-.762317301144431-18.1993160632548-.76282093059046-36.593566017806-.422500878572464-65.1258470714092" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(400.4375 10) rotate(0 32.29296875 32.29296875)"><path d="m.216911679133773-1.45633653365076 65.548209965229 1.85416907072067-1.40478724241257 66.1009590029717-64.9829675555229-1.03781014680862" stroke="none" stroke-width="0" fill="#228be6"></path><path d="m-1.09794101677835 1.28917909227312c20.0149878603646-2.35692260016694 33.148774930324.374097194774004 64.8850665688515-.740717470645904m-62.7963564908132-1.1351055437699c14.5918249030707.0851982653013692 30.4693277159924 1.01873345373788 62.7896268069744.2865369617939m2.58455093856901-1.14164433535188c-.219511186120869 19.1664693946492.12967779731953 35.252805351188-.978617131710053 65.7583727240562M64.89880717080086.5318792285397649c.407110064486119 18.6475590292241.596152066448781 36.7657420284799-1.10288742184639 63.1071975529194m2.28833310957998 2.1275325352326c-21.2219211175812.277375468085594-40.9303897052552.323523589442559-66.0346226096153-1.47892624139786m63.8062367523089 1.06520820315927c-15.6635498086565-.412583906884606-31.2201936801183-1.81425570392173-63.8665259182453-1.283537119627m1.46181037183851 1.04845901671797c-2.85050978746374-20.4332770091489-2.62424942340811-38.0307939017206-1.85130923986435-65.1342549920082m.16564027313143 64.2075618272647c-.344817294511085-14.3164076873443.000812308159584108-28.4355678695007.0250785052776337-64.0214092433453" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(465.89453125 10.05859375) rotate(0 32.29296875 32.29296875)"><path d="m1.17918414436281.397832537069917 63.1811502575874 1.51502150297165-.397030055522919 63.5481273531914-64.719534099102-.841435253620148" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m1.96396311558783-1.53644745983183c10.8694450725809 2.31470559354166 26.6147083977252 1.66859488005975 61.4129119515419 2.88375037908554m-63.2656408166513-1.9587980741635c18.6814293683849 1.31242466533913 35.6337966563864.690277671463628 64.0116202533245 1.13218572735786m1.68628822918981.819111221469939c.923683902945996 20.7217050994055.151681861606122 40.4314530302319-1.37929958105087 64.4158605933189m.498335191048682-65.4479303890839c.391111812002563 17.9442083858063-.930188783996201 36.1408705756287-.255985528230667 63.9085042774677m.12300821300596 1.72945001069456c-20.1343655354816.427422102161287-40.8771657480873-1.2767292302171-65.8345360159874-3.09896522760391m65.2511122012511 2.64800409134477c-13.3687873161274-.90632750903147-27.2997055602944-.930026703224357-64.206239014864-1.57442399859428m-1.83480400685221.175785236991942c-.242359521764956-11.5411741730532.960488137822904-26.2370057099979.166343271732331-63.029867708683m1.42790139559656 62.814204341732c.497094936340509-17.6869317872093.177047468393503-34.2717393602463.343476980924606-64.6085912883282" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(531.09765625 10.05859375) rotate(0 32.29296875 32.29296875)"><path d="m-.22560309804976 1.91285404004157 64.1889074444771-1.03781014680862-.13359659910202 63.7445022463799-65.5070649981499.254536807537079" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m-1.85533354245126 1.19457233510911c24.5954448585173-.14994621541824 47.7241176375668.648895082208255 66.1004863381386.786965787410736M.5173773495480418.3220400335267186c14.2639674996601-.227207115309939 30.1933126162025.593590417486921 64.3231827914715.567464619874954m1.31777157541364.151716792024672c-.37699275770116 13.4094007791959-1.33347928085256 29.5683800343439-1.78236240148544 64.1704553961754m.741251030005515-65.6574681038037c-1.1002611390454 22.3099036548629-.223988073239966 45.6980362602262-.379084855318069 65.7808864414692m.281466237269342.656739228405058c-23.5725550360286-1.26504808173507-47.8500413312126-2.70601009831756-66.7364391684532-2.86603790521622m66.3914308035746.96725685056299c-24.4285389090997.563249829480114-48.7415659239734.414196822115841-65.6067736446858 1.21845987439156m-.670825161971152.598606490530074c1.79357189554146-22.433989741328.5308071436303-42.4446949520163 1.04489666223526-66.3791547417641m.66871724370867 64.2360085612163c-.168256860477923-15.837140751804.14963798572302-33.5608352679512.478983610868454-63.568057268858" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(594.54296875 10.05859375) rotate(0 32.29296875 32.29296875)"><path d="m-.622633153572679.875043893232942 64.452340900898-.841435253620148-.921127498149872 64.8404743075371-61.8397008776665-.412003338336945" stroke="none" stroke-width="0" fill="#228be6"></path><path d="m-.798811947926879.548461621627212c14.00388578442.413078426753564 29.2862997823409 1.04731363001971 64.2114616036415-.325993120670319m-64.2181912874803-.522575461305678c15.768841099913.612804958018314 31.9129292014739.981619038971912 64.6706034839153.911709576845169m1.52126782294363-.88091868814081c-.448713750211823 25.1414399551002-.502587587205994 48.2998534056838.263366281986237 65.5397352576256m-1.85377620812505-66.217279904522c1.21940707199515 21.9404567041078 1.28534974687041 44.4226128177004 1.3803536593914 65.6374299824238M64.63556774891913 64.2876830752939c-24.8557789935738-.986956167530664-49.3000952033341-.707880723786005-63.1016601920128-.450066149234772m63.0413710260764.231737232767046c-25.2290743715472-.467386854480793-51.4120643391027.923825221467922-64.3093407452107-.398049563169479m-.666095622815192.898191087879241c-.745106704615683-16.7112460900338.359707049942881-36.0404063798967-.38947719335556-65.0395379662514m.580195971764624 65.2256905501708c.24645733450765-15.7170288829242.727593567122167-29.6090941962073.0966374576091767-63.7992212474346" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(10 10.05859375) rotate(0 32.29296875 32.29296875)"><path d="m-.756229752674699.0336086396127939 63.6648100018501.254536807537079 2.74623662233353 64.1739341616631-64.3990823626518-.315665066242218" stroke="none" stroke-width="0" fill="#82c91e"></path><path d="m-1.20906243287027 1.34730291925371c24.1016876872869.457120663188325 46.5025945060435-1.30194895837463 64.5720096230507-.312548220157623m-63.8260301863775-.514064126648009c22.173412635002.562640974797614 42.6536213439176.284738937892325 65.7189213931561.265506535768509m-.825995245017111.383527779020369c.20459655798615 22.1942088642631 1.47832320011796 44.9911456185408.771558344364166 64.4787783026695m-.529208681546152-66.0182044142857c-.444297696053908 17.6154554937843-.00615977734319984 33.4675261685377.593619078397751 65.1724708378315m-1.71920938137919-1.95604855474085c-24.5933421938455.182760235578826-45.2584369359087.894580659181884-61.7290272116661 1.91652816534042M64.5914756981656 63.9203011514619c-17.1301612596602 1.05757188208277-32.1244859180632-.582636749671153-64.8364012539387-.13586637377739m-1.4179969811812 1.86772140208632c1.23403658303323-25.1872124519206 1.00251038703027-48.8401784591391.251893579959869-65.4309392571449m1.5194847965613 63.6365523105487c.61640437853981-13.1593411842703-.0859892426664737-26.4882561524151-.419772416353226-63.4202472865582" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(76.48828125 76.890625) rotate(0 32.29296875 32.29296875)"><path d="m-1.47724780999124-.229036087170243c22.0592268374989-.50497494732037 42.3270966345925.805024339808078 65.122737467289-.128778994083405m-62.9722388302907.848485535942018c17.5596405838725-.526314762396432 36.5162872025961-.658636507553674 63.6405179202557-.34853383898735M64.31022497452796-.9193170610815287c-.449886056868195 13.3738591114532 1.8418078093847 29.1402410347961 1.97389751672745 66.5929674506187m-2.43446197267622-66.4998205536977c.272706128070197 23.4159179706003.0324878761266092 46.4098817862323.0468318164348602 65.2045486271381m-.421282597817481.26772075239569c-24.1260965227855 1.6521200054093-48.8988967656638-1.69931488104623-63.9922642111778 1.20332473516464m65.4378495300189-1.35439895931631c-25.8140026087516-.134597023214525-49.7847711553084-.0513445038453995-65.6054785549641-.266264170408249m1.4685642933473-.932995832525194c-2.2206990436848-21.3729023483589.799628703183335-47.1873883301407-.344107091426849-62.9793477654457m-.337085328064859 65.1400664811954c-.579156329515463-26.0493037724278-1.65106823075104-51.4189381646676.209953993558884-65.8967144191265" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(141.9453125 76.94921875) rotate(0 32.29296875 32.29296875)"><path d="m.19903620518744-.323339397087693c23.3674245988026 1.38396183918456 45.8255112001687.0394868678901549 64.2951140999794 1.66365760564804m-65.3406320428476-1.86027779523283c14.4099019305191-.449225858353238 29.6395699056549.345192089177508 64.5089957416058-.0556194484233856m.569568029604852-.381642944179475c2.20265810656238 23.1796874771135 1.96300469803501 43.6950740356479 1.34274631738663 64.2934240698814m-1.04888503905386-63.315657668747c-.715749642990929 13.413164088886-1.10498236789594 25.7487038567881.977718085050583 64.0156209766865m-.851561107672751 2.2937715286389c-18.5284173540313-3.33200688251054-38.7004256351866-.461084972701428-62.8976463675499-.498745501041412m62.3937723422423-2.00433012191206c-23.6407826176721.0245358232699004-49.6698680383837.343182820483264-63.4237072765827.0151145756244659m-2.64183182362467 2.13604181353003c2.76718936688856-22.6117663186749 2.10394815928892-42.7805337512415 3.69307667016983-64.0819917321205m-1.63994871731848 62.6214038198814c-1.13823415088707-16.6292594728635.11050500225967-33.1114728565546-.512663155794144-65.3491308391094" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(207.1484375 76.94921875) rotate(0 32.29296875 32.29296875)"><path d="m.0839631799608469.986659890040755c17.6117447067758-1.24005908083644 37.0965610840838.45807420897756 63.0022197365761.359841763973236m-64.0553911840543-1.99878298584372c23.24186189674 1.1302387212043 45.1354295353624.412523070407406 65.7795426547527.514425069093704m1.71344151254743 1.53525217715651c-.353923843734734 16.097350512632-1.06321798407363 30.1669357512161-3.91578525304794 61.7159876227379m1.67773441318423-62.668078684248c-.42798053375904 13.3870199013843 1.17918852814014 27.0846906282692.251103132963181 63.5852687656879m.645458928309381-1.05207157786936c-20.6834653846228 3.43411109982998-37.9820182784009 3.41587857543499-63.5300182700157 2.27715057134628m63.5666226828471-1.3455387884751c-20.1062518219573-.171609480163383-37.4856636246885-.558394421121406-64.9902575314045 1.06776407361031m.874380907975137-.75919113215059c-.0440839725417752-14.5257632319357 1.29190615835956-28.1555856832318-2.03383868932724-64.0133100152016M-.93609678465873 64.25804523844272c1.16102168683887-25.1106239760171.47153127913356-50.5003798413774 1.8943278491497-63.4863311946392" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(270.59375 76.94921875) rotate(0 32.29296875 32.29296875)"><path d="m-.94044784270227-.357815081253648c19.1802829932894 1.37951151985435 36.1039379500799 1.38569496530799 66.507726252079-1.33514839410782m-65.8394471621141 1.83510009106249c15.3663187699269-.296433637497175 32.5317126665017.141289134862673 64.3984477221966-.319064348936081m2.15784352179617 1.26464062277228c-.0835085914715421 13.9471790047137-3.05034629565321 30.0089877549108-3.35052531957626 63.3782362341881m.962895163334906-64.6735081607476c1.41327404298129 19.1662562601843.446440838950295 38.6691338048535.719526022672653 64.8265779316425m-.54713533166796 1.2304050559178c-22.7361647545367-.537321154933821-47.84602297526-1.11285996900166-64.2507080435753-2.13890892267227m64.0830790186301.51824579294771c-13.0640139899559-.823271998207858-28.03311545092.312630019147107-64.5463402569294-.601479738950729m1.08485995884985 1.27507364097983c.979793870515496-22.2916127298267-1.72679374211344-47.8534834094826 1.30131870508194-64.6307244896889m-1.42845003958792 63.8740765517578c-.0849035234261101-19.3247880680596 1.25017558028216-36.654690691478-.904033929109573-63.2077295482159" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(335.96875 76.94921875) rotate(0 32.29296875 32.29296875)"><path d="m-.0917871948331595 1.34031820856035c21.1540315609665.121732557825671 46.1971260034028-2.91773257154979 63.6378055214882-3.27873474359512m-64.46944182273 1.36283749993891c16.3107815003132.345922506578572 30.7896871995399.306851036079534 65.0307500064373 1.54449823498726m1.46750184055418-2.2186546092853c-2.41844335563837 23.6655689561281-2.09283683069407 48.9065220522709-.947802007198334 65.235248029232m.876635053195059-64.5352847212926c-1.41211782738559 22.2462326099041-1.33292766258113 45.0865022757775-.0457241833209991 65.4338844120503m.882454208098352.94707911554724c-14.2870800151264-.167521529435106-30.3060688284706-1.71265911364455-67.8585438132286.0206541419029236m66.8286088788882-2.00986968819052c-15.5067956622333.905216110570976-31.3914265982094-.445380704776696-64.6144163906574 1.29546907544136m1.07972373720258 1.34451850596815c-2.8486035971075-19.880468810723-.176687410297964-38.0040349267438-1.91277927160263-68.3541570305824m-.239832601509988 65.6264300113544c1.13315609899808-15.6546432370662-.416466526114455-32.7464383830069-.523959428071976-64.6314899623394" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(400.953125 75.33203125) rotate(0 32.29296875 32.29296875)"><path d="m-1.06749168597162-.891173535957933c23.0408719135456 3.11755681338014 49.0290952827796 1.3766356140584 65.9855514168739.76338142156601m-65.077782115899.168545938096941c16.6541001342579.863361979456458 33.72891846157-.394057994155373 64.8622023761272-.41816446185112m1.85359691735357.976797574199736c-1.52221456414212 17.6199086743647-3.46490904932965 37.2617957270253-1.93043941259384 64.3450521826744M63.85072985570878.7918024184182286c-.047663065253218 23.0758807971251.0738654708280961 46.7329507498289.654533118009567 63.5540769398212m-.544846215285361 1.72834196034819c-18.7930541307207-2.30638092458008-40.7323847354404-2.80407321154831-64.6891426444054-1.81552559137344m64.812788345851.317180073820055c-17.6333855328958-.693632895777768-35.9994342203936.414728914668018-63.9584400951862-.0727722346782684m-1.72368580941111-.0377060836181045c3.10155037046068-17.6160928180216 1.12149855495089-32.9935324530597 1.07858234643936-64.3374925255776m.0462982738390565 65.4499139850959c.185870692764802-14.9074125622043 1.33428712252287-26.9386530586737-.419100075960159-64.9657041728497" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(466.41015625 75.390625) rotate(0 32.29296875 32.29296875)"><path d="m1.63708725012839-.16134905256331c11.4105759726146.974537037676128 26.7338964673239 1.5335902798827 62.3233295083046 1.64963287115097m-64.7581289326772-1.85264676157385c23.0719145850388.4221743232257 45.9622219236786.279339272404395 64.8817746341229.354301244020462m1.68147047515959.261306428350508c-1.68018278328127 20.1842470882933-1.79525771585649 42.7912904259763-2.77765887975693 64.2141527533531m1.33728037122637-64.7251380318776c-.140405805809351 23.2480523228522-1.13890958021388 48.4105762719861-.212399750947952 65.837559491396m1.54252498503774-2.77644724305719c-13.4669272262378.734952707397824-26.5639566100683.642337401020413-66.5397190451622 1.01103347539902m65.6212282264605.518656975589693c-21.2662853217327 1.0722197702794-44.4241998625206 1.12445117148447-65.6933234035969-.624952524900436m.935286304913461-.794775522314012c1.73501590944717-17.8691074953422.870059232487183-36.4620251866072.468789637088776-63.6413655877113m-.997441372834146 65.0934294229373c-.243227949808425-20.4094129925004-.568542561004942-43.1464808235629 1.46537086367607-63.6689769923687" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(531.61328125 75.390625) rotate(0 32.29296875 32.29296875)"><path d="m.515031164512038 1.06934216059744c23.4823435683844.590719595538758 49.8329179564709 1.11550481616177 62.7623590826988-1.9537815451622M.2879192652180791.1508513418957591c16.3350211138379.661400520556999 34.0991012563012-.469090825563835 64.98163869977-1.10738590359688m-2.64206386264414.935286304913461c.173178291181173 14.9340008202817.573234951356497 27.7623745806268.36014312505722 65.0547271370888m2.2929917043075-65.5833788728342c-.70726204211482 17.3610051706208.358795729329501 34.0539834171083-1.11277028918266 66.0513083636761m.177954339422286.033918253146112c-23.6582209507578.627112074260296-47.805755027126-2.04976667606395-64.2843213677406-.687679708003998m65.4067370062694-1.18703287001699c-23.6958259564832 1.48050905522665-46.1617505991846-.0780504519049359-64.9234573543072 1.5791127383709m.432284408248961-1.19932941440493c-3.24611667993951-12.7849085876129-2.50163481834818-25.2221971648498-1.29017502069473-62.6243614554405m.79399514850229 63.5257508540526c-1.64810911933768-24.5514110045748-.47878177086699-48.0726677809391-.367414683103561-64.0601055920124" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(595.05859375 75.390625) rotate(0 32.29296875 32.29296875)"><path d="m1.76458224095404-1.85064690746367c20.1836473268464 4.1448597485129 42.8270972812563 1.02774073424975 63.9108977913857 3.15822547674179m-65.1869521951303-1.58034863416106c11.9488996514461-.0487615428643039 25.6423700350089.393208894900818 63.9408499896526.980788022279739M65.54768910445273.7116985376924276c-2.19434886057985 23.2622624056654.144305836361525 48.5848332677517-.734829366207123 65.6376013159752M64.01082471292466.7306550862267613c.329630485705636 15.6988463372101.600950739316247 33.5983886659364.365627020597458 63.7678487598896m1.88233228679746 2.06181600037962c-16.3451003729839-4.00545229912495-32.8396510480918-2.02826818228459-64.6060814261437-.367458879947662m62.5941440844908-1.85996004287153c-18.7279765113133-.334908160836278-36.9819511381662-.214411798388539-63.6109936535358-.485587328672409m-.551889845170081 1.72528379503638c-1.08868572220548-19.9806307007333-.240025074336372-36.9186531403582-1.58371776342392-64.2260957360268m.530546315945685 62.5871545141563c1.24374768082744-21.7504044344292.592492937489806-45.0129424671861 1.19360515475273-64.0715124309063" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(10.515625 75.390625) rotate(0 32.29296875 32.29296875)"><path d="m-.675231093540788 1.91988369263709c12.980839629878-1.67716766857186 28.3529203333645-3.83742387556114 64.0117277503014-1.67882770299912m-63.0218537980691-.115624091587961c19.8284524283612-.575660426309405 38.7126423521448.0144664755556005 64.4743707478046.561304777860642m-1.09424964245409-2.52449090126902c2.19636571107206 18.104516411863.455444511750315 34.0247314473832.76338142156601 65.7705379128456m.168545938096941-64.7049596225843c-.353995765181097 17.9320997987415-1.61141573879293 37.1363887378029-.41816446185112 65.3691994845867m.976797574199736.995704195462167c-15.6146001094829-1.30647798167432-29.2072218406698-.330873745548374-64.8268228173256.224847376346588m65.0192382996902-2.13709815498441c-20.8789034658817-.353312213555839-41.1766177761849.349945257767175-65.6177980601788 1.05889961123467m1.72834196034819.794767967425287c-2.86565083563568-25.1962268263676-3.36334312260391-48.9242892087656-1.81552559137344-65.8217586874962m.317180073820055 65.1852808678523c-.323371892144132-21.1604899070233.784989918301653-42.668968896383-.0727722346782684-65.3744776546955" stroke="#000" stroke-width="2" fill="none"></path></g><g transform="translate(100.78125 92.18359375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">1</text></g><g transform="translate(166.23828125 92.2421875) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">2</text></g><g transform="translate(231.44140625 92.2421875) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">3</text></g><g transform="translate(294.88671875 92.2421875) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">4</text></g><g transform="translate(360.26171875 92.2421875) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">5</text></g><g transform="translate(425.24609375 90.625) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">6</text></g><g transform="translate(490.703125 90.68359375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">7</text></g><g transform="translate(555.90625 90.68359375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">8</text></g><g transform="translate(619.3515625 90.68359375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">9</text></g><g transform="translate(34.80859375 90.68359375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(100.71875 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(167.609375 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">1</text></g><g transform="translate(229.6953125 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(295.640625 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(361.5859375 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(424.01171875 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">1</text></g><g transform="translate(490.90234375 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(552.98828125 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g><g transform="translate(618.93359375 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">1</text></g><g transform="translate(34.9609375 26.62109375) rotate(0 8 17)"><text x="8" y="27" font-family="Cascadia, Segoe UI Emoji" font-size="28" fill="#000" text-anchor="middle" style="white-space:pre" direction="ltr">0</text></g></svg>
<h2 id="using-the-bloom-filter">Using the Bloom filter</h2>
<p>Now that we have added an element to our filter, we can query it to check if an element exists or not. To do that, we need some data as an input, then we will repeat the same operations we did before to get 3 indexes. If <strong>all</strong> the indexes in our vector are <code>== 1</code>, then we can say that <strong>maybe</strong> the element is in the set, however, as soon as one of those indexes is <code>== 0</code>, we can say that there’s a <strong>100%</strong> probability that the element is <strong>not</strong> in the set. To make things easier we will write a function to get some indexes.</p>
<div><pre tabindex="0"><code data-lang="python"><span>def</span> get_idx_from_data(data: bytes) -&gt; List[int]:
    hash_value1 = sha1_int(data)
    hash_value2 = md5_int(data)
    hash_value3 = sha256_int(data)

    hash_values = [hash_value1, hash_value2, hash_value3]

    indexes = [h % modulo <span>for</span> h <span>in</span> hash_values]

    <span>return</span> indexes
</code></pre></div><p>Let’s say we want to check it the element <code>&#34;this is a message with some data&#34;</code> is in our set. First, we get the indexes, and then we check if all of them are <code>== 1</code> in our vector.</p>
<div><pre tabindex="0"><code data-lang="python">element = <span>&#34;this is a message with some data&#34;</span>

<span># remember our function needs bytes, not strings</span>
indexes = get_idx_from_data(element.encode())

print(indexes)

maybe_found = <span>True</span>

<span>for</span> index <span>in</span> indexes:
    <span>if</span> vector[index] == 0:
        maybe_found = <span>False</span>

<span>if</span> maybe_found <span>is</span> <span>False</span>:
    print(<span>&#34;The element is definitely NOT in the set (100% probability)&#34;</span>)
<span>else</span>:
    print(<span>&#34;The element may be in the set&#34;</span>)
</code></pre></div><pre><code>[9, 6, 2]
The element may be in the set
</code></pre>
<div><pre tabindex="0"><code data-lang="python">element = <span>&#34;another message&#34;</span>

<span># remember our function needs bytes, not strings</span>
indexes = get_idx_from_data(element.encode())

print(indexes)

maybe_found = <span>True</span>

<span>for</span> index <span>in</span> indexes:
    <span>if</span> vector[index] == 0:
        maybe_found = <span>False</span>

<span>if</span> maybe_found <span>is</span> <span>False</span>:
    print(<span>&#34;The element is definitely NOT in the set (100% probability)&#34;</span>)
<span>else</span>:
    print(<span>&#34;The element may be in the set&#34;</span>)
</code></pre></div><pre><code>[5, 4, 5]
The element is definitely NOT in the set (100% probability)
</code></pre>
<h2 id="improving-the-code">Improving the code</h2>
<p>Now that we know how a bloom filter works, we can build a better abstraction around it.</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> typing <span>import</span> Callable


<span>class</span> <span>BloomFilter</span>:
    <span>def</span> __init__(self, vector_length: int, hash_functions: List[Callable]):
        self.vector_length = vector_length
        self.modulo = vector_length
        self.vector = [0 <span>for</span> _ <span>in</span> range(self.vector_length)]
        self.hash_functions = hash_functions

    <span>def</span> add(self, data: bytes):
        hash_values = []

        <span>for</span> func <span>in</span> self.hash_functions:
            hash_values.append(func(data))

        indexes = [h % self.modulo <span>for</span> h <span>in</span> hash_values]

        <span>for</span> idx <span>in</span> indexes:
            self.vector[idx] = 1

        <span>return</span> indexes

    <span>def</span> query(self, data: bytes) -&gt; bool:
        <span>&#34;&#34;&#34;
</span><span>        This method returns `False` if the element
</span><span>        is not in the set. Otherwise it returns
</span><span>        `True` (the element may or may not be in the set)
</span><span>        &#34;&#34;&#34;</span>

        hash_values = []

        <span>for</span> func <span>in</span> self.hash_functions:
            hash_values.append(func(data))

        indexes = [h % self.modulo <span>for</span> h <span>in</span> hash_values]

        <span>for</span> idx <span>in</span> indexes:
            <span>if</span> self.vector[idx] == 0:
                <span>return</span> <span>False</span>

        <span>return</span> <span>True</span>
</code></pre></div><div><pre tabindex="0"><code data-lang="python">bloom = BloomFilter(vector_length=10, hash_functions=[sha1_int, md5_int, sha256_int])
</code></pre></div><div><pre tabindex="0"><code data-lang="python">bloom.add(<span>&#34;hello bloom&#34;</span>.encode())
</code></pre></div><pre><code>[0, 8, 7]
</code></pre>
<div><pre tabindex="0"><code data-lang="python">bloom.query(<span>&#34;hello bloom&#34;</span>.encode())
</code></pre></div><pre><code>True
</code></pre>
<div><pre tabindex="0"><code data-lang="python">bloom.query(<span>&#34;hello cuckoo&#34;</span>.encode())
</code></pre></div><pre><code>False
</code></pre>
<pre><code>[1, 0, 0, 0, 0, 0, 0, 1, 1, 0]
</code></pre>
<p>Fantastic! Now we have our bloom filter and we can build multiple filters one using different vector lenghts of a different number/type of hash functions. But we are not done. We have seen that when the <code>bloom.query()</code> method returns <code>True</code> the element may or may not be in the set. If the element was not in the set, it is called a <strong>false positive</strong> (the filter returned <code>True</code> but the element is not in the set). Bloom filters <strong>never</strong> have <strong>false negatives</strong>, if it says the element is not in the set, it’s definitely not there. But the opposite is not true. Another problem we have is that if our vector is very short, at some point, all the elements will be <code>1</code>. If we use a lot of hash functions, our bloom filter will fill up faster too.</p>
<p>We can calculate the probability of false positives using this formula:</p>
<p>$$P_{F P}=\left(1-P_{0}\right)^{k}=\left(1-\left(1-\frac{1}{m}\right)^{k n}\right)^{k}$$</p>
<p>We can implement the formula in Python</p>
<div><pre tabindex="0"><code data-lang="python"><span>def</span> proba_false_positive(set_size, vector_length, num_hash_functions):

    n = set_size
    m = vector_length
    k = num_hash_functions

    <span>return</span> (1 - (1 - (1 / m)) ** (k * n)) ** k
</code></pre></div><p>With that formula, for a set of size <code>n</code>, we can derive the number <code>k</code> of hashing functions and the length <code>m</code> of a vector to use if we want to have a false positive probability \(P_{F P}\).</p>
<p>$$k = -\frac{\ln{P_{FP}}}{\ln{2}}$$</p>
<p>$$m = -\frac{n\ln{P_{FP}}}{(\ln2)^2}$$</p>
<p>For the explanation of how to get these formulas, <a href="https://sagi.io/bloom-filters-for-the-perplexed/#appendix">this blog post</a> explains it with great detail.</p>
<p>We can also implement those last 2 formulas in Python.</p>
<div><pre tabindex="0"><code data-lang="python"><span>def</span> optimal_values(set_size, proba_false_positives):
    n = set_size
    ln_pfp = math.log(proba_false_positives)
    ln_2 = math.log(2)

    optimal_num_hash_funcs = -(ln_pfp / ln_2)
    optimal_vector_legth = -(n * ln_pfp / ln_2**2)

    <span># we will use math.ceil to approximate the values to the next integer</span>
    <span>return</span> math.ceil(optimal_num_hash_funcs), math.ceil(optimal_vector_legth)
</code></pre></div><div><pre tabindex="0"><code data-lang="python">set_size=4_000_000
proba_false_positives=0.001

k, m = optimal_values(set_size=set_size, proba_false_positives=proba_false_positive)

print(<span>f</span><span>&#34;&#34;&#34;
</span><span>For a set with </span><span>{</span>set_size<span>}</span><span> elements, if we want a probability of false positives = </span><span>{</span>proba_false_positives<span>}</span><span>,
</span><span>we need a bloom filter with a vector length = </span><span>{</span>m<span>}</span><span> and use </span><span>{</span>k<span>}</span><span> hash functions.
</span><span>&#34;&#34;&#34;</span>.strip())
</code></pre></div><pre><code>For a set with 4000000 elements, if we want a probability of false positives = 0.001,
we need a bloom filter with a vector length = 57510351 and use 10 hash functions.
</code></pre>
<p>Now we know how to make our bloom filters a bit better. We can add some parameters to our <code>BloomFilter</code> class so that we can tune it to our requirements. But we still have another problem. We can now calculate how many hash functions we need, but so far we have manually given our bloom filter a list of hash functions. We need some way to generate as many hash functions as we need. In <a href="https://www.eecs.harvard.edu/~michaelm/postscripts/rsa2008.pdf">this paper</a> the authors prove that we can generate any number of hash functions \(g_{i}(x)\) by just using 2 functions.</p>
<p>$$g_{i}(x)=h_{1}(x)+i h_{2}(x)$$</p>
<p>Where \(i\) goes from <code>0</code> to <code>k - 1</code> (remember <code>k</code> is the number of hash functions that we need to generate).</p>
<p>In Python it would be something like:</p>
<div><pre tabindex="0"><code data-lang="python"><span>def</span> generate_hash_func(n: int) -&gt; Callable:
    h1 = sha1_int
    h2 = md5_int

    <span>def</span> new_func(data: bytes):

        <span>return</span> h1(data) + (n * h2(data))

    <span>return</span> new_func
</code></pre></div><p>With everything we have learned, we can now improve our implementation. The updated class will need a <code>set_size</code> (how much data we want to store) and a <code>proba_false_positives</code> (what’s the maximum probability of false positives that we can tolerate). Then we will use the new functions to set the appropriate vector length and generate the necessary hash functions.</p>
<p><em>Note</em>: I will also add a new method called <code>.add_faster()</code> that is slightly more optimized. The method <code>.add()</code> is easier to understand.</p>
<div><pre tabindex="0"><code data-lang="python"><span>class</span> <span>BloomFilter</span>:
    <span>def</span> __init__(self, set_size, proba_false_positives):

        self.optimal_hash_funcs, self.optimal_vec_len = self.calculate_optim_values(
            set_size, proba_false_positives
        )

        self.vector = [0 <span>for</span> _ <span>in</span> range(self.optimal_vec_len)]

        self.vector_length = len(self.vector)
        self.modulo = self.vector_length

        self.h1 = sha1_int
        self.h2 = md5_int

    <span>def</span> calculate_optim_values(self, set_size, proba_false_positives):
        n = set_size
        ln_pfp = math.log(proba_false_positives)
        ln_2 = math.log(2)

        optimal_num_hash_funcs = -(ln_pfp / ln_2)
        optimal_vector_legth = -(n * ln_pfp / ln_2 ** 2)

        <span># we will use math.ceil to approximate the values to the next integer</span>
        <span>return</span> math.ceil(optimal_num_hash_funcs), math.ceil(optimal_vector_legth)

    <span>def</span> generate_hash_func(self, n: int) -&gt; Callable:
        <span>&#34;&#34;&#34;
</span><span>        Generate a new hash function based
</span><span>        on the 2 root ones: self.h1() and self.h2()
</span><span>        &#34;&#34;&#34;</span>

        <span>def</span> new_func(data: bytes):

            <span>return</span> self.h1(data) + (n * self.h2(data))

        <span>return</span> new_func

    <span>def</span> add(self, data: bytes):
        hash_values = []

        <span>for</span> n <span>in</span> range(self.optimal_hash_funcs):

            hash_func = generate_hash_func(n)

            hash_values.append(hash_func(data))

        indexes = [h % self.modulo <span>for</span> h <span>in</span> hash_values]

        <span>for</span> idx <span>in</span> indexes:
            self.vector[idx] = 1

        <span>return</span> indexes

    <span>def</span> add_faster(self, data: bytes) -&gt; <span>None</span>:

        <span>for</span> n <span>in</span> range(self.optimal_hash_funcs):

            <span># I will do the modulo operation here to make</span>
            <span># it a bit faster (avoid generating another list)</span>

            idx = generate_hash_func(n)(data) % self.modulo

            self.vector[idx] = 1

        <span>return</span>

    <span>def</span> query(self, data: bytes) -&gt; bool:
        <span>&#34;&#34;&#34;
</span><span>        This method returns `False` if the element
</span><span>        is not in the set. Otherwise it returns
</span><span>        `True` (the element may or may not be in the set)
</span><span>        &#34;&#34;&#34;</span>

        hash_values = []

        <span>for</span> n <span>in</span> range(self.optimal_hash_funcs):

            hash_func = generate_hash_func(n)

            idx = hash_func(data) % self.modulo
            <span>if</span> self.vector[idx] == 0:
                <span>return</span> <span>False</span>

        <span>return</span> <span>True</span>
</code></pre></div><div><pre tabindex="0"><code data-lang="python">bloom = BloomFilter(set_size=1_000_000, proba_false_positives=0.001)
</code></pre></div><div><pre tabindex="0"><code data-lang="python">%%timeit
bloom.add(<span>&#34;hello bloom&#34;</span>.encode())
</code></pre></div><pre><code>50.4 µs ± 5.06 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)
</code></pre>
<div><pre tabindex="0"><code data-lang="python">%%timeit
bloom.add_faster(<span>&#34;hello bloom&#34;</span>.encode())
</code></pre></div><pre><code>54.2 µs ± 4.78 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)
</code></pre>
<div><pre tabindex="0"><code data-lang="python">%%timeit
bloom.query(<span>&#34;hello bloom&#34;</span>.encode())
</code></pre></div><pre><code>62.1 µs ± 18 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)
</code></pre>
<div><pre tabindex="0"><code data-lang="python">%%timeit
bloom.query(<span>&#34;hello cuckoo&#34;</span>.encode())
</code></pre></div><pre><code>5.66 µs ± 645 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</code></pre>


</div></div>
  </body>
</html>
