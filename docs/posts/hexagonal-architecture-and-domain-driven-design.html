<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://towardsdev.com/hexagonal-architecture-and-domain-driven-design-bc2525dbc05f">Original</a>
    <h1>Hexagonal Architecture and Domain Driven Design</h1>
    
    <div id="readability-page-1" class="page"><section><div><div><figure><div role="button" tabindex="0"><p><img alt="" src="https://miro.medium.com/max/1400/1*p9ttRrlDz5kM92lkqAg9mQ.jpeg" width="700" height="394" role="presentation"/></p></div></figure><p id="b3bf">In this article we will introduce a software architecture that implements the DDD (Domain Driven Design) introduced by Eric Evan in the “Bleu Book” : <em>Domain-Driven Design: Tackling Complexity in the Heart of Software</em></p><p id="dc93">When we correlate DDD and Architecture, many of us think of Microservices. But this is not the only one implementation for DDD concept.</p><p id="bd51">Hexagonal Architecture is also a good candidate for implementing DDD correctly and it is a very good architecture in general described by Robert C. Martin in this book: <em>Clean Architecture</em></p><p id="9be8">Moreover, in a microservice, we need to keep good practices and good architecture. Even though Hexagonal Architecture was first designed for monolithic, we can apply it for build our microservice well.</p><h2 id="0733">What we need for following this article</h2><ul><li id="ed44">JDK 11 or earlier</li><li id="e211">Maven 3+</li><li id="7690">Any IDE or text editor</li></ul><h2 id="44cb">What is DDD ?</h2><figure><p><img alt="" src="https://miro.medium.com/max/782/1*H2zSZi1GvWNzmNtxpZ5heA.png" width="391" height="391" role="presentation"/></p><figcaption>DDD representation from <a href="https://docs.abp.io/en/abp/4.0/Domain-Driven-Design-Implementation-Guide" rel="noopener ugc nofollow" target="_blank">Domain Driven Design Implementation Guide | Documentation Center | ABP.IO</a></figcaption></figure><p id="3a1f">Like already explained above, The Domain Drive Design was introduce by Eric Evans in 2003. It is a Software engineering approach that keep the Domain in the center of our core software set. The whole solution must revolve around the business rules and its terminologies.</p><p id="2d2f">We need to create a <code>Ubiquitous Language</code> between all stockholders (Domain team, Technical teams). Each terminology in this Language should be found in the application. For Exemple, if we are building an application to track airplane&#39;s schedule, we attempt to found in the application Entity like &#34;Airplane&#34; or &#34;Travel&#34; and Value Object like &#34;Destination&#34; or &#34;Arrival&#34;.</p><p id="16cc">For more information about DDD I advise you to read this free e-book <a href="https://www.infoq.com/minibooks/domain-driven-design-quickly/" rel="noopener ugc nofollow" target="_blank">https://www.infoq.com/minibooks/domain-driven-design-quickly/</a></p><h2 id="fe2b">Give me an Hexagone</h2><p id="bd8c">Well, now what’s the relationship with the Hexagonal Architecture ?</p><p id="bb36">When you connect DDD with Architecture, the first likeness is Microservices Architecture. Therefore, each microservice need to be build into the bounded context. For exemple, when you build an e-commerce, you will probably have one microservice for account management, another for payment features and another for stock management. Every of them have only one purpose who are named in Domain bounded context. It’s what make microservice a good candidate for DDD implementation.</p><p id="2dd2">But it is not the only one. Like Mark Richards says about architecture decisions on his book <em>Fundamentals of Software Architecture</em>: “It’s always a trade-off”. Indeed, all application not be created for become a microservice. For this type of architecture, you need to have the ecosystem for managing (for exemple container management tools like Kubernetes or OpenShift for exemple) and the need of great scalability. Each Architecture decision come with these cons. For Microservices, reliability and performance can be a challenge.</p><p id="146f">And even if you choose this way, each microservice need to have their own internal architecture.</p><p id="2c5c">So, what is exactly Hexagonal Architecture ?</p><p id="2a52">It’s a software architecture introduced by Alistair Cockburn in 2005. It is also called “ Port and Adapter Architecture “. The goal is for all your code about Domain should reside in the same place (or module) and all about other technical purpose (like database access, APIs call or Framework like Spring in Java) need to be outside the Domain.</p><p id="04db">Like that, you can change any part of the technical detail without impact the Domain.</p><p id="7529">The purpose of DDD is keep the focus on the Domain implementation and not worry about technical detail too soon.</p><p id="e441">Like explained in the schema below, we first have an application module (cf: app) who will use the Domain by his interfaces. Domain implement this exposed interfaces with these services and if this need to use external concern, like database access, it will use others interface, named port (outbound).</p><p id="f6a1">The module that wants to be used by the Domain, will have to implement this interface (adapter) and map data between him and Domain</p><figure><div role="button" tabindex="0"><p><img alt="" src="https://miro.medium.com/max/1400/1*ftvCFmvjmTqxAS5SyZvagQ.png" width="700" height="488" role="presentation"/></p></div></figure><p id="d7b0">We will create a new Spring boot application with a very simple case for illustrate this architecture.</p><p id="aae0">You’ll found source in the repository <a href="https://github.com/KevinDupeyrat/Hexagonal_Architecture_Article/tree/master/movies" rel="noopener ugc nofollow" target="_blank">Github</a></p><p id="b7f7">It’s an application for retrieving movies information from an external public API.</p><p id="e873">we’ll create a Maven project with <code>movies</code> parent and 3 submodules like above.</p><pre><span id="0a1c">movies</span></pre><p id="1172">As you can see, we have one “main” module named <code>movies-app</code>, one Domain module named <code>movies-domain</code> and one <code>infra</code> module named <code>movies-infra-api</code>. Each infra represent a detail about infrastructure like database access and external api call.</p><p id="617e">Since the Domain only contains class with business Rules, it cannot run alone. It required some configuration and a main method or other technical details for be used.</p><p id="4cef">But the first rule of Hexagonal Architecture is clear :</p><ul><li id="ec93">Domain depends on nothing. Everything depends on him.</li></ul><p id="f21f">The second is :</p><ul><li id="fc72">You do not use an infra module directly, you have to pass only through Domain module.</li></ul><p id="070a">That’s way, there is no direct dependency between two infra modules. No one has knowledge of the existence of an others</p><p id="8fce">Therefore, how Domain will be able to use infra-api if it not depends on them ?</p><h2 id="d3f7">Dependencies rules</h2><p id="5022">The pom.xml configuration will prevent us over accidentally coupling between modules.</p><p id="0ad5">For respect dependency rules for Hexagonal Architecture you need to have the dependencies part from pom.xml of <code>movies-domain</code> like bellow :</p><pre><span id="a384">...</span></pre><p id="3c5f">As you can see, nothing about Spring, about persistence or external API too. It’s an immutable rule, the Domain depends on</p><p id="a969">So how he can use other module ?</p><p id="b2af">Domain will expose some Interfaces and each infra module will implement it. Like that the Domain just care about use his</p><p id="7560">For dependency of all infra, we’ll have to importe the Domain module with scope `provide` like below :</p><pre><span id="c21e">...</span></pre><p id="cb40">And for the application module `movies-app`, we’ll need to importe Domain and all other module like below:</p><pre><span id="9722">...</span></pre><p id="f206">For all infra module we need to use `runtime` scope. That disable developers to accidentally use directly infra module</p><p id="7756">Sometimes the infra module needs another one. To do this, it must go through the Domain instead of using it directly. You should not find infra dependencies in other infra modules. It is the ‘app’ that will orchestrate all the infra</p><h2 id="ccf4">Domain</h2><p id="2943">So, we will start with the main important part of this project, the <code>Domain</code>. Before start to coding, we need to stop us one minute for thinks about the <code>Ubiquitous Language</code> of our Domain. In the real world, this part can take long times at the start of the project and can evolve throughout the life circle of the project.</p><p id="c2d2">What does your application need to do ? Why creat it ?</p><p id="e920">The answer is : Movies</p><p id="6498">We want to retrieve Movies information like title, description, rate, director, actors …</p><p id="96d8">So let’s start by creating our Ubiquitous Language that we must find in our application afterwards.</p><h2 id="8703">Ubiquitous Language</h2><p id="39c8">As our business Domain is very easy, it will be easy to create our UL quickly, but, in real situation, it may take time. A few days or months before finding it and that every stakeholder approves and uses it.</p><p id="f016">In our case, it will be something like this :</p><ul><li id="782b">Movies : Represent a list of Movie</li><li id="d08c">Title : The movie title</li><li id="025c">Synopsys : The movie explanation with little synopsys</li><li id="f44c">Rate : The rate of the movie</li><li id="4e3a">Director : Person who as create the movie</li><li id="2079">Actors : Persons who as playing in the movie</li><li id="a224">Release Date : Date of movie was released</li></ul><p id="1e71">the Rate need to be between 0 and 5</p><h2 id="af82">Api Movies</h2><p id="3064">For this purpose, we will use the open API <a href="https://developers.themoviedb.org/3/getting-started/introduction" rel="noopener ugc nofollow" target="_blank">TheMovieDB</a>, with the library provided by <strong>Holger Brandl </strong>in this <a href="https://github.com/holgerbrandl/themoviedbapi" rel="noopener ugc nofollow" target="_blank">repository</a>.</p><p id="ce63">I already created a fake account for this article. The token is put in the <code>application-local.yml</code> of the project. If the token is off, you can create an account and fetch a new token : <a href="https://www.themoviedb.org/signup" rel="noopener ugc nofollow" target="_blank">https://www.themoviedb.org/signup</a></p><p id="b2c1">Once everything is good for this API subscription, you can directly run the Spring Boot application and test it.</p><h2 id="6ecf">Expose our own APIs</h2><p id="8ea0">Our API exposes 3 APIs which are mapped with Movie DB APIs. We map the data with our own data model.</p><ul><li id="f51b">GET <a href="http://localhost:8080/api/v1/movies/populars" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/api/v1/movies/populars</a></li><li id="d59c">GET <a href="http://localhost:8080/api/v1/movies/upcoming" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/api/v1/movies/upcoming</a></li><li id="1398">GET <a href="http://localhost:8080/api/v1/movies/%7B%7Bid%7D%7D" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/api/v1/movies/{{id}}</a></li></ul><p id="0ef7">The first one give you a liste of movies sorted by popularity, the second one give you the liste of movies who are upcoming, dnd the last one, give you the detail about the movie with the id pass in path parameter.</p><h2 id="9cfe">Architecture</h2><p id="170b">For the architecture we obviously use the Hexagonal Architecture with <a href="https://maven.apache.org/" rel="noopener ugc nofollow" target="_blank">Apache Maven</a> for create module and build our application.</p><p id="7f0d">The configuration of the POM, as already explained above, respects the rules of hexagonal dependencies.</p><p id="c90b">In the <code>movie-app</code> module we have the main class for run the Spring Boot application and the management of our little API exposed.</p><figure><div role="button" tabindex="0"><p><img alt="" src="https://miro.medium.com/max/1400/1*D0wYStX2xz7upBRKkzqQwA.png" width="700" height="218" role="presentation"/></p></div></figure><p id="859f">We will explain each module bellow in more detail.</p><h2 id="f80e">Domain module</h2><p id="3c42">In the Domain module, we crate a package named <code>movies</code> who allow us to create different Domain or subdomain part in the same bounded context. Be worries about this contexte, you need to respect it for be sur to do not mixe different domains who not allow to evolute together.</p><p id="43ed">In this Domain module, we will found sub-packages to manage the module, for example, error package for exception handling, model package to represent business model. In this template package, you need to find the ubiquitous language.</p><p id="309d">You have a service package too, who represent all the business logic. Everything your application needs to expose as functionalities need to reside in this package.</p><figure><p><img alt="" src="https://miro.medium.com/max/1068/1*MGBlsg8X-77qOHb7K7nNuA.png" width="534" height="553" role="presentation"/></p></figure><h2 id="19bf">App module</h2><p id="e6a5">In the app module, we will found all you need for run your application. This is this module who orchestrate all other module.</p><figure><p><img alt="" src="https://miro.medium.com/max/1052/1*39vtQVbNhsAR-nA18U3MJA.png" width="526" height="427" role="presentation"/></p></figure><h2 id="9fab">Infra module</h2><p id="1ab7">Finally, we have the infra module who assemble all configuration and services for external API call.</p><figure><p><img alt="" src="https://miro.medium.com/max/1050/1*iUxrI9C7NLPpJwvZQXlJhA.png" width="525" height="405" role="presentation"/></p></figure><p id="54ab">I hope this article will help readers to understand the foundation of the clean architecture with implementation of the DDD : Hexagonal Architecture. Like is already explained in this article, the architecture choose is always a trade-off and Developers or Architectes don’t need to follow this implementation all the time.</p><p id="dafd">But, indeed, this architecture is a nice demonstration of a non coupling modules for better maintainability. We can change any part of the application without scare about regression in other part.</p><p id="f4e5">Github repository : <a href="https://github.com/KevinDupeyrat/Hexagonal_Architecture_Article/tree/master/movies" rel="noopener ugc nofollow" target="_blank">https://github.com/KevinDupeyrat/Hexagonal_Architecture_Article/tree/master/movies</a></p><p id="62bb"><em>Let’s stay in touch. </em><a href="https://www.linkedin.com/in/kevin-dupeyrat/" rel="noopener ugc nofollow" target="_blank"><em>LinkedIn</em></a><em> | </em><a href="https://medium.com/@kevin.dupeyrat" rel="noopener"><em>Medium</em></a></p></div></div></section></div>
  </body>
</html>
