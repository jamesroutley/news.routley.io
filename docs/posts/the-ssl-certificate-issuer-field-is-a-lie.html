<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.agwa.name/blog/post/the_certificate_issuer_field_is_a_lie">Original</a>
    <h1>The SSL Certificate Issuer Field Is a Lie</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>
A surprisingly hard, and <em>widely</em> misunderstood, problem with SSL
certificates is figuring out what organization (called a certificate
authority, or CA) issued a certificate.  This information is useful
for several reasons:
</p>

<ul><li>You&#39;ve discovered an unauthorized certificate for your domain via Certificate Transparency logs
and need to contact the certificate authority to get the certificate revoked.</li><li>You&#39;ve discovered a certificate via Certificate Transparency and want to know
if it was issued by one of your authorized certificate providers.</li><li>You&#39;re a researcher studying the certificate ecosystem and want to count how
many certificates each certificate authority has issued.</li></ul>

<p>
On the surface, this looks easy: every certificate contains an issuer
field with human-readable attributes, including an organization name.
Problem solved, right?
</p>

<p>
Not so fast: a certificate&#39;s issuer field is frequently a lie that tells
you nothing about the organization that really issued the certificate.
Just look at the certificate chain currently served by doordash.com:

</p>

<svg xmlns="http://www.w3.org/2000/svg" style="width: 40rem; max-width: 100%; display: block; margin: 0 auto;" viewBox="13 -2 513 363">
  <g>
    
    <g>
      <rect style="fill: #ffffff; fill-opacity: 0; stroke-opacity: 1; stroke-width: 2; stroke: #000000" x="160" y="0" width="220" height="80" rx="0" ry="0"></rect>
      <text font-size="12.8" style="fill: #000000; fill-opacity: 1; stroke: none;text-anchor:middle;font-family:sans-serif;font-style:normal;font-weight:normal" x="270" y="20.4312">
        <tspan x="270" y="20.4312">C = IE</tspan>
        <tspan x="270" y="36.4312">O = <tspan style="font-weight:bold">Baltimore</tspan></tspan>
        <tspan x="270" y="52.4312">OU = CyberTrust</tspan>
        <tspan x="270" y="68.4312">CN = Baltimore CyberTrust Root</tspan>
      </text>
    </g>
    
    <g>
      <line style="fill: none; stroke-opacity: 1; stroke-width: 3; stroke: #000000" x1="270" y1="152.146" x2="270" y2="80"></line>
      <polygon style="fill: #000000; fill-opacity: 1; stroke-opacity: 1; stroke-width: 3; stroke: #000000" fill-rule="evenodd" points="270,156.646 267,150.646 270,152.146 273,150.646 "></polygon>
      <a href="https://crt.sh/?sha256=3ABBE63DAF756C5016B6B85F52015FD8E8ACBE277C5087B127A60563A841ED8A">
        <text font-size="12.8" style="fill: #000000; fill-opacity: 1; stroke: none;text-anchor:start;font-family:monospace;font-style:normal;font-weight:normal" x="280" y="116.431">
          <tspan x="280" y="116.431">3ABBE63DAF756C5016B6B85F52015FD8</tspan>
          <tspan x="280" y="132.431">E8ACBE277C5087B127A60563A841ED8A</tspan>
        </text>
      </a>
    </g>
    
    <g>
      <rect style="fill: #ffffff; fill-opacity: 0; stroke-opacity: 1; stroke-width: 2; stroke: #000000" x="160" y="160" width="220" height="60" rx="0" ry="0"></rect>
      <text font-size="12.8" style="fill: #000000; fill-opacity: 1; stroke: none;text-anchor:middle;font-family:sans-serif;font-style:normal;font-weight:normal" x="270" y="178.431">
        <tspan x="270" y="178.431">C = US</tspan>
        <tspan x="270" y="194.431">O = <tspan style="font-weight:bold">Cloudflare, Inc.</tspan></tspan>
        <tspan x="270" y="210.431">CN = Cloudflare Inc ECC CA-3</tspan>
      </text>
    </g>
    
    <g>
      <line style="fill: none; stroke-opacity: 1; stroke-width: 3; stroke: #000000" x1="270" y1="292.146" x2="270" y2="220"></line>
      <polygon style="fill: #000000; fill-opacity: 1; stroke-opacity: 1; stroke-width: 3; stroke: #000000" fill-rule="evenodd" points="270,296.646 267,290.646 270,292.146 273,290.646 "></polygon>
      <a href="https://crt.sh/?sha256=6E5C90EB2E592F95FABF68AFAF7D05C53CBD536EEE7EE2057FDE63704F3E1CA1">
        <text font-size="12.8" style="fill: #000000; fill-opacity: 1; stroke: none;text-anchor:start;font-family:monospace;font-style:normal;font-weight:normal" x="280" y="256.431">
          <tspan x="280" y="256.431">6E5C90EB2E592F95FABF68AFAF7D05C5</tspan>
          <tspan x="280" y="272.431">3CBD536EEE7EE2057FDE63704F3E1CA1</tspan>
        </text>
      </a>
    </g>
    
    <g>
      <rect style="fill: #ffffff; fill-opacity: 0; stroke-opacity: 1; stroke-width: 2; stroke: #000000" x="200" y="300" width="140" height="60" rx="0" ry="0"></rect>
      <text font-size="12.8" style="fill: #000000; fill-opacity: 1; stroke: none;text-anchor:middle;font-family:sans-serif;font-style:normal;font-weight:normal" x="270" y="334.431">
        <tspan x="270" y="334.431">doordash.com</tspan>
      </text>
    </g>
  </g>
</svg>


<p>
According to this, DoorDash&#39;s certificate was issued by an intermediate
certificate belonging to &#34;Cloudflare, Inc.&#34;, which was issued by a root certificate belonging to &#34;Baltimore&#34;.
Except Cloudflare is not a certificate authority, and Baltimore is a
city.
</p>

<p>
In reality, both DoorDash&#39;s certificate and the intermediate certificate
were issued by <strong>DigiCert</strong>, a name which is mentioned nowhere in the
above chain.  What&#39;s going on?
</p>

<p>
First, Cloudflare has paid DigiCert to create and operate an intermediate
certificate with Cloudflare&#39;s name in it.  DigiCert, not Cloudflare,
controls the private key and performs the security-critical validation steps prior to
issuance.  All Cloudflare does is make an API call to DigiCert.
Certificates issued from the &#34;Cloudflare&#34;
intermediate are functionally no different from certificates issued from
any of DigiCert&#39;s other intermediates.  This type of white-labeling
is common in the certificate industry, since it lets companies
appear to be CAs without the expense of operating a CA.
</p>

<details><summary>Sidebar: that time everyone freaked out about Blue Coat</summary>
<p>
In 2016 Symantec created an intermediate certificate with &#34;Blue Coat&#34;
in the organization name.  This alarmed many non-experts who thought Blue
Coat, a notorious maker of TLS interception devices, was now operating
a certificate authority.  In reality, it was just a white-label
Symantec intermediate certificate, operated by Symantec under their
normal audits with their normal validation procedures, and it posed no more
risk to the Internet than any of the other intermediate certificates
operated by Symantec.
</p>


</details>

<p>
What about &#34;Baltimore&#34;?  That&#39;s short for <a href="https://en.wikipedia.org/wiki/Baltimore_Technologies" rel="external">Baltimore
Technologies</a>, a now-defunct infosec company, who acquired
<a href="https://en.wikipedia.org/wiki/GTE" rel="external">GTE</a>&#39;s certificate
authority subsidiary (named CyberTrust) in 2000, which they then sold to
a company named Betrusted in 2003, which merged with TruSecure in 2004,
who rebranded back to <a href="https://en.wikipedia.org/wiki/CyberTrust" rel="external">CyberTrust</a>, which was then acquired by <a href="https://en.wikipedia.org/wiki/Verizon_Communications" rel="external">Verizon</a> in 2007,
who then <a href="https://groups.google.com/g/mozilla.dev.security.policy/c/tHUcqnWPt3o/m/U2U__7-UBQAJ" rel="external">sold the private keys</a> for their root certificates to <a href="https://www.digicert.com/" rel="external">DigiCert</a> in 2015.
So &#34;Baltimore&#34; hasn&#39;t been accurate since 2003, and the true owner has changed
four times since then.
</p>

<p>
Mergers and acquisitions are <a href="https://gist.github.com/rmhrisk/c0afbb7e444dab9cf76936e24d4b32e8" rel="external">
common in the certificate industry</a>, and since the issuer name
is baked into certificates, the old name can persist long after
a different organization takes over.
Even once old certificates expire, the acquiring CA might keep
using the old name for branding purposes.  Consider
Thawte, which despite not existing since 1999, could still be found in
new certificates as recently as 2017.  (Thawte was sold to Verisign,
then Symantec, and then DigiCert, who finally stopped putting &#34;Thawte&#34;
in the issuer organization name.)
</p>

<p>
Consequentially, <strong>the certificate issuer field is completely useless for human consumption</strong>,
and causes constant confusion.  People wonder why they get Certificate
Transparency alerts for certificates issued by &#34;Cloudflare&#34; when their
<a href="https://sslmate.com/caa/" rel="external">CAA record</a> has only digicert.com in it.  Worse, people have trouble
revoking certificates: consider <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1698936" rel="external">this incident</a>
where someone tried to report a compromised private key to the certificate reseller named in
the certificate issuer field, who failed to revoke the certificate and
then ghosted the reporter.  If the compromised key had been reported to the
true certificate authority, the CA would have been required to revoke and respond within 24 hours.

</p>

<p>
I think certificate tools should do a better job helping people
understand who issued certificates, so a few years ago I started
maintaining a database which maps certificate issuers to their actual organization names.
When <a href="https://sslmate.com/certspotter/" rel="external">Cert Spotter</a> sends
an alert about an unknown certificate found in Certificate Transparency logs,
it shows the name from this database - not the name from the certificate issuer
field.  It also includes correct contact information for requesting revocation.
</p>

<p>
As of this month, the same information is available through SSLMate&#39;s
<a href="https://sslmate.com/ct_search_api/" rel="external">Certificate Transparency Search API</a>, letting you integrate useful certificate issuer
information into your own applications.  Here&#39;s what the API looks like
for the doordash.com certificate (some fields have been truncated for clarity):
</p>

<p><code>{
  &#34;id&#34;:&#34;3779499808&#34;,
  &#34;tbs_sha256&#34;:&#34;eb3782390d9fb3f3219129212b244cc34958774ba289453a0a584e089d0f2b86&#34;,
  &#34;cert_sha256&#34;:&#34;6e5c90eb2e592f95fabf68afaf7d05c53cbd536eee7ee2057fde63704f3e1ca1&#34;,
  &#34;dns_names&#34;:[&#34;*.doordash.com&#34;,&#34;doordash.com&#34;,&#34;sni.cloudflaressl.com&#34;],
  &#34;pubkey_sha256&#34;:&#34;456d8df5c5b1097c775a778d92f50d49b25720f672fcb0b8a75020fc85110bea&#34;,
  &#34;issuer&#34;:{
    <strong>&#34;friendly_name&#34;:&#34;DigiCert&#34;,</strong>
    &#34;website&#34;:&#34;https://www.digicert.com/&#34;,
    <strong>&#34;caa_domains&#34;:[&#34;digicert.com&#34;,&#34;symantec.com&#34;,&#34;geotrust.com&#34;,&#34;rapidssl.com&#34;, ...],</strong>
    <strong>&#34;operator&#34;:{&#34;name&#34;:&#34;DigiCert&#34;,&#34;website&#34;:&#34;https://www.digicert.com/&#34;},</strong>
    &#34;pubkey_sha256&#34;:&#34;144cd5394a78745de02346553d126115b48955747eb9098c1fae7186cd60947e&#34;,
    &#34;name&#34;:&#34;C=US, O=\&#34;Cloudflare, Inc.\&#34;, CN=Cloudflare Inc ECC CA-3&#34;
  },
  &#34;not_before&#34;:&#34;2022-05-29T00:00:00Z&#34;,
  &#34;not_after&#34;:&#34;2023-05-29T23:59:59Z&#34;,
  &#34;revoked&#34;:false,
  <strong>&#34;problem_reporting&#34;:&#34;Send email to revoke@digicert.com or visit https://problemreport.digicert.com/&#34;</strong>
}</code></p><p>
(<a href="https://api.certspotter.com/v1/issuances?domain=doordash.com&amp;expand=dns_names&amp;expand=problem_reporting&amp;expand=issuer&amp;expand=issuer.website&amp;expand=issuer.caa_domains&amp;expand=issuer.operator" rel="external">Here&#39;s the API query</a>)
</p>

<p>
Note the following fields:
</p>

<ul><li>The <code>friendly_name</code> field contains &#34;DigiCert&#34;, not &#34;Cloudflare&#34;.  This field is useful for displaying to humans.</li><li>The <code>caa_domains</code> field contains the CAA domains used by the CA.  You can compare this array against your domain&#39;s CAA record set to determine if the certificate is authorized - at least one of the domains in the array should also be in your CAA record set.</li><li>The <code>operator</code> field contains details about the company which operates the CA.  In this example, the operator name is the same as the friendly name, but later in this post I&#39;ll describe an edge case where they are different.</li><li>The <code>problem_reporting</code> field contains instructions on how to contact the CA to request the certificate be revoked.</li></ul>

<p>
The data comes from a few places:
</p>

<ul><li>
	<p>
		The <a href="https://www.ccadb.org/" rel="external">Common CA Database (CCADB)</a>&#39;s
		<a href="https://ccadb-public.secure.force.com/ccadb/AllCertificateRecordsCSVFormat" rel="external"><code>AllCertificateRecords</code></a>
		report, which is a CSV file listing every intermediate certificate
		trusted by Apple, Microsoft, or Mozilla.  To find out who operates an intermediate
		certificate, you can look up the fingerprint in the &#34;SHA-256 Fingerprint&#34;
		column, and then consult the &#34;Subordinate CA Owner&#34; column, or if that&#39;s empty, the
		&#34;CA Owner&#34; column.
	</p>
</li><li>
	<p>
		The CCADB&#39;s <a href="https://ccadb-public.secure.force.com/mozilla/CAInformationReportCSVFormat" rel="external"><code>CAInformationReport</code></a>,
		which lists the CAA domains and problem reporting instructions for a subset of CAs.
	</p>
</li><li>
	<p>
		For CAs not listed in <code>CAInformationReport</code>, the information comes from the CA&#39;s Certificate Policy (CP)
		and Certificate Practice Statement (CPS), a pair of documents which describe how the
		CA is operated.  The URL of the applicable CP and CPS can be found in <code>AllCertificateRecords</code>.
		Section 1.5.2 of the CPS contains problem reporting instructions, and Section 4.2 of either the CP or CPS
		lists the CAA domains.
	</p>
</li></ul>

<p>
In a few cases I&#39;ve manually curated the data to be more helpful.  The most notable example
is Amazon Certificate Manager. When you get a certificate through ACM,
it&#39;s issued by DigiCert from a white-label intermediate certificate with
&#34;Amazon&#34; in its name, similar to Cloudflare.  However, Amazon
has gone several steps further than Cloudflare in white-labeling:
</p>

<ul><li><p>To authorize ACM certificates, you put amazon.com in your CAA record, not digicert.com.</p></li><li><p>
		Amazon operates their own root certificates which have signed the
		white-label intermediates operated by DigiCert. This is highly unusual. Recall
		that the DigiCert-operated Cloudflare intermediate is signed by a DigiCert-operated root, as is typical
		for white-label intermediates.<label for="sidenote_idm125"></label><span><span> (</span>Why does Amazon operate roots whose sole purpose is to cross-sign
		intermediates operated by another CA? I assume it was to get
		to market more quickly.  I have no clue why they are still doing things this way
		after 8 years.<span>)</span></span>
	</p></li></ul>

<p>
If you look up one of Amazon&#39;s intermediates in <code>AllCertificateRecords</code>,
it will say that it is operated by DigiCert.  But due to the extreme
level of white-labeling, I think telling users that ACM certificates
were issued by &#34;DigiCert&#34; would cause more confusion than saying they
were issued by &#34;Amazon&#34;.  So here&#39;s what SSLMate&#39;s CT Search API returns
for an ACM certificate:
</p>

<p><code>{
  &#34;id&#34;:&#34;3837618459&#34;,
  &#34;tbs_sha256&#34;:&#34;9c312eef7eb0c9dccc6b310dcd9cf6be767b4c5efeaf7cb0ffb66b774db9ca52&#34;,
  &#34;cert_sha256&#34;:&#34;7e5142891ca365a79aff31c756cc1ac7e5b3a743244d815423da93befb192a2e&#34;,
  &#34;dns_names&#34;:[&#34;1.aws-lbr.amazonaws.com&#34;,&#34;amazonaws-china.com&#34;,&#34;aws.amazon.com&#34;, ...],
  &#34;pubkey_sha256&#34;:&#34;8c296c2d2421a34cf2a200a7b2134d9dde3449be5a8644224e9325181e9218bd&#34;,
  &#34;issuer&#34;:{
    <strong>&#34;friendly_name&#34;:&#34;Amazon&#34;,</strong>
    <strong>&#34;website&#34;:&#34;https://www.amazontrust.com/&#34;,</strong>
    &#34;caa_domains&#34;:[&#34;amazon.com&#34;,&#34;amazontrust.com&#34;,&#34;awstrust.com&#34;,&#34;amazonaws.com&#34;,&#34;aws.amazon.com&#34;],
    <strong>&#34;operator&#34;:{&#34;name&#34;:&#34;DigiCert&#34;,&#34;website&#34;:&#34;https://www.digicert.com/&#34;},</strong>
    &#34;pubkey_sha256&#34;:&#34;252333a8e3abb72393d6499abbacca8604faefa84681ccc3e5531d44cc896450&#34;,
    &#34;name&#34;:&#34;C=US, O=Amazon, OU=Server CA 1B, CN=Amazon&#34;
  },
  &#34;not_before&#34;:&#34;2022-06-13T00:00:00Z&#34;,
  &#34;not_after&#34;:&#34;2023-06-11T23:59:59Z&#34;,
  &#34;revoked&#34;:false,
  <strong>&#34;problem_reporting&#34;:&#34;Send email to revoke@digicert.com or visit https://problemreport.digicert.com/&#34;</strong>
}</code></p><p>
(<a href="https://api.certspotter.com/v1/issuances?domain=aws.amazon.com&amp;expand=issuer&amp;expand=dns_names&amp;expand=problem_reporting&amp;expand=issuer.operator&amp;expand=issuer.caa_domains&amp;expand=issuer.website" rel="external">API query</a>)
</p>

<p>
As you can see, <code>friendly_name</code> and <code>website</code> refer
to Amazon.  However, the <code>problem_reporting</code> field
tells you to contact DigiCert, and the <code>operator</code> field makes clear
that the issuer is really operated by DigiCert.
</p>

<p>
I&#39;ve overridden a few other cases as well.  Whenever a certificate issuer
uses a distinct set of CAA domains, I override the friendly name to match
the domains.  My reasoning is that CAA and Certificate Transparency are often
used in conjunction - a site operator might first publish CAA records,
and then monitor Certificate Transparency to detect violations of their
CAA records.  Or, they might first use Certificate Transparency to figure
out who their certificate authorities are, and then publish matching CAA records.
Thus, ensuring consistency between CAA and CT provides the best experience.
In fact, the certificate authority names that you see on
SSLMate&#39;s <a href="https://sslmate.com/caa/" rel="external">CAA Record Helper</a>
are the exact same values you can see in the <code>friendly_name</code> field.
</p>

<p>
If you&#39;re looking for a certificate monitoring solution, consider
<a href="https://sslmate.com/certspotter/" rel="external">Cert Spotter</a>, which
notifies you when certificates are issued for your domains, or
<a href="https://sslmate.com/ct_search_api/" rel="external">SSLMate&#39;s Certificate Transparency Search API</a>,
which lets you search Certificate Transparency logs by domain name.
</p>




</div></div>
  </body>
</html>
