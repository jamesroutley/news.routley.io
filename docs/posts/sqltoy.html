<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/weinberg/SQLToy/wiki">Original</a>
    <h1>SQLToy</h1>
    
    <div id="readability-page-1" class="page"><div data-view-component="true">          <div id="wiki-body">
              <div>
                
<p>A great way to learn how something works is to build it yourself. In this case you will learn how a SQL database works by building one!</p>

<p>SQL stands for Structured Query Language. It is the standard interface of most relational databases.</p>
<p>When you want to put some data in or get some data out of a SQL Database you write a Query. Queries are written in a kind of quasi-English language which lets you tell the database what you want (but leaves the how-to-do-it up to the database).</p>
<p>Here’s an example:</p>
<div data-snippet-clipboard-copy-content="SELECT name FROM employee;"><pre><span>SELECT</span> name <span>FROM</span> employee;</pre></div>
<p>This query will return the names of all the employees in a database table called <code>employee</code>.</p>
<div><h2>What are we going to implement?</h2><a id="user-content-what-are-we-going-to-implement" aria-label="Permalink: What are we going to implement?" href="#what-are-we-going-to-implement"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p>A very simple SQL database which in fact has no parser and therefore cannot even understand the above query directly. What we will be building are Javascript methods for each of the most common SQL operations like <code>SELECT</code> and <code>JOIN</code>. Then we will manually call them (in code) in the correct order to execute the query.</p>
<p>For example the above query will look like this:</p>
<div data-snippet-clipboard-copy-content="SELECT(employee, [&#39;name&#39;]);"><pre><span>SELECT</span><span>(</span><span>employee</span><span>,</span> <span>[</span><span>&#39;name&#39;</span><span>]</span><span>)</span><span>;</span></pre></div>

<p>As a preview, here’s a more complex query in both PostgreSQL and SQLToy.</p>

<div data-snippet-clipboard-copy-content="SELECT DISTINCT status, charity_group.name, COUNT(*) AS count FROM employee
  JOIN employee_charity_group 
    ON employee_charity_group.a = employee.id
  JOIN charity_group
    ON charity_group.id = employee_charity_group.b
  WHERE employee.salary &gt; 150000
  GROUP BY status, charity_group.name
  ORDER BY count DESC;

+----------+--------------------+---------+
| status   | name               | count   |
|----------+--------------------+---------|
| active   | Cat Lovers         | 2       |
| active   | Environmentalists  | 1       |
| active   | Food for the Needy | 1       |
| active   | House Builders     | 1       |
| inactive | Education for Kids | 1       |
| inactive | Environmentalists  | 1       |
+----------+--------------------+---------+|"><pre><span>SELECT DISTINCT</span> status, <span>charity_group</span>.<span>name</span>, <span>COUNT</span>(<span>*</span>) <span>AS</span> count <span>FROM</span> employee
  <span>JOIN</span> employee_charity_group 
    <span>ON</span> <span>employee_charity_group</span>.<span>a</span> <span>=</span> <span>employee</span>.<span>id</span>
  <span>JOIN</span> charity_group
    <span>ON</span> <span>charity_group</span>.<span>id</span> <span>=</span> <span>employee_charity_group</span>.<span>b</span>
  <span>WHERE</span> <span>employee</span>.<span>salary</span> <span>&gt;</span> <span>150000</span>
  <span>GROUP BY</span> status, <span>charity_group</span>.<span>name</span>
  <span>ORDER BY</span> count <span>DESC</span>;

<span>+</span><span><span>--</span>--------+--------------------+---------+</span>
| status   | name               | count   |
|<span><span>--</span>--------+--------------------+---------|</span>
| active   | Cat Lovers         | <span>2</span>       |
| active   | Environmentalists  | <span>1</span>       |
| active   | Food for the Needy | <span>1</span>       |
| active   | House Builders     | <span>1</span>       |
| inactive | Education for Kids | <span>1</span>       |
| inactive | Environmentalists  | <span>1</span>       |
<span>+</span><span><span>--</span>--------+--------------------+---------+|</span></pre></div>

<div data-snippet-clipboard-copy-content="let result;
result = JOIN(employee, employee_charity_group, (c) =&gt; c[&#34;employee_charity_group.A&#34;] === c[&#34;employee.id&#34;]);
result = JOIN(result, charity_group, (c) =&gt; c[&#34;employee_charity_group.B&#34;] === c[&#34;charity_group.id&#34;] );
result = WHERE(result, (row) =&gt; row[&#39;employee.salary&#39;] &gt; 150000);
result = GROUP_BY(result, [&#39;employee.status&#39;, &#39;charity_group.name&#39;]);
result = COUNT(result, &#39;charity_group.name&#39;);
result = SELECT(result,[&#39;employee.status&#39;, &#39;charity_group.name&#39;,&#39;COUNT(charity_group.name)&#39;],{&#39;COUNT(charity_group.name)&#39;: &#39;count&#39;})
result = DISTINCT(result, [&#39;employee.status&#39;, &#39;charity_group.name&#39;, &#39;count&#39;])
result = ORDER_BY(result, (a,b) =&gt; a.count &lt; b.count ? 1 : -1);"><pre><span>let</span> <span>result</span><span>;</span>
<span>result</span> <span>=</span> <span>JOIN</span><span>(</span><span>employee</span><span>,</span> <span>employee_charity_group</span><span>,</span> <span>(</span><span>c</span><span>)</span> <span>=&gt;</span> <span>c</span><span>[</span><span>&#34;employee_charity_group.A&#34;</span><span>]</span> <span>===</span> <span>c</span><span>[</span><span>&#34;employee.id&#34;</span><span>]</span><span>)</span><span>;</span>
<span>result</span> <span>=</span> <span>JOIN</span><span>(</span><span>result</span><span>,</span> <span>charity_group</span><span>,</span> <span>(</span><span>c</span><span>)</span> <span>=&gt;</span> <span>c</span><span>[</span><span>&#34;employee_charity_group.B&#34;</span><span>]</span> <span>===</span> <span>c</span><span>[</span><span>&#34;charity_group.id&#34;</span><span>]</span> <span>)</span><span>;</span>
<span>result</span> <span>=</span> <span>WHERE</span><span>(</span><span>result</span><span>,</span> <span>(</span><span>row</span><span>)</span> <span>=&gt;</span> <span>row</span><span>[</span><span>&#39;employee.salary&#39;</span><span>]</span> <span>&gt;</span> <span>150000</span><span>)</span><span>;</span>
<span>result</span> <span>=</span> <span>GROUP_BY</span><span>(</span><span>result</span><span>,</span> <span>[</span><span>&#39;employee.status&#39;</span><span>,</span> <span>&#39;charity_group.name&#39;</span><span>]</span><span>)</span><span>;</span>
<span>result</span> <span>=</span> <span>COUNT</span><span>(</span><span>result</span><span>,</span> <span>&#39;charity_group.name&#39;</span><span>)</span><span>;</span>
<span>result</span> <span>=</span> <span>SELECT</span><span>(</span><span>result</span><span>,</span><span>[</span><span>&#39;employee.status&#39;</span><span>,</span> <span>&#39;charity_group.name&#39;</span><span>,</span><span>&#39;COUNT(charity_group.name)&#39;</span><span>]</span><span>,</span><span>{</span><span>&#39;COUNT(charity_group.name)&#39;</span>: <span>&#39;count&#39;</span><span>}</span><span>)</span>
<span>result</span> <span>=</span> <span>DISTINCT</span><span>(</span><span>result</span><span>,</span> <span>[</span><span>&#39;employee.status&#39;</span><span>,</span> <span>&#39;charity_group.name&#39;</span><span>,</span> <span>&#39;count&#39;</span><span>]</span><span>)</span>
<span>result</span> <span>=</span> <span>ORDER_BY</span><span>(</span><span>result</span><span>,</span> <span>(</span><span>a</span><span>,</span><span>b</span><span>)</span> <span>=&gt;</span> <span>a</span><span>.</span><span>count</span> <span>&lt;</span> <span>b</span><span>.</span><span>count</span> ? <span>1</span> : <span>-</span><span>1</span><span>)</span><span>;</span></pre></div>
<p>Output:</p>
<div data-snippet-clipboard-copy-content="┌─────────────────┬──────────────────────┬───────┐
│ employee.status │  charity_group.name  │ count │
├─────────────────┼──────────────────────┼───────┤
│     active      │      Cat Lovers      │   2   │
│     active      │  Environmentalists   │   1   │
│     active      │  Food for the Needy  │   1   │
│     active      │    House Builders    │   1   │
│    inactive     │  Education for Kids  │   1   │
│    inactive     │  Environmentalists   │   1   │
└─────────────────┴──────────────────────┴───────┘"><pre><code>┌─────────────────┬──────────────────────┬───────┐
│ employee.status │  charity_group.name  │ count │
├─────────────────┼──────────────────────┼───────┤
│     active      │      Cat Lovers      │   2   │
│     active      │  Environmentalists   │   1   │
│     active      │  Food for the Needy  │   1   │
│     active      │    House Builders    │   1   │
│    inactive     │  Education for Kids  │   1   │
│    inactive     │  Environmentalists   │   1   │
└─────────────────┴──────────────────────┴───────┘
</code></pre></div>
<p>Save for some formatting, the results are the same.</p>

<p>The code in SQLToy is licensed under <a href="https://github.com/weinberg/SQLToy/blob/main/LICENSE">The MIT License</a>.</p>
<p>The contents of the Wiki are licensed separately under the <a href="https://github.com/weinberg/SQLToy/wiki/LICENSE">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.</p>
<hr/>


              </div>

          </div>
</div></div>
  </body>
</html>
