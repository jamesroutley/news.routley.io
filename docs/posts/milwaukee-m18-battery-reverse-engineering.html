<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://quagmirerepair.com/milwaukee-m18-battery-reverse-engineering">Original</a>
    <h1>Milwaukee M18 Battery Reverse Engineering</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>
<p>Coming soon... Milwaukee M18 Battery Dissection and Reverse Engineering...</p>
<p>2023-01-01: This project has been ongoing for a while... now its time to post some of this info and see what comes of it. I have access to several junk Milwaukee M18 batteries. Age varies a little. I thought it would be &#39;fun&#39; to reverse engineer a battery just to see how it functions... That is until I actually opened the first one up and saw all the 0402 resistors and capacitors. Then it seemed like a &#39;fun-bad&#39; idea. So here is the start of the first battery; Enjoy! (Reminder - Click on an image to get a larger version!)</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/PXL_20221228_121003625.webp"><img title="Milwaukee M18 48-11-1828 Reverse Engineering" src="https://quagmirerepair.com/files/M18_48111828_B41/PXL_20221228_121003625_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>And here is our first candidate for reverse engineering: a Milwaukee M18 48-11-1828 18VDC 54Wh / 3 Ah Battery Pack. (Hey its the first one I picked up... I was aiming for a 5Ah and missed somehow... Didn&#39;t actually look very close at what I grabbed until the PCB was already removed.) Serial: B41MD 028567. This particular battery doesn&#39;t seem to hold its charge properly (indicator lights go up to full when charging, but put it on a drill and spin it for a second, and the indicator now reads two bars.) Battery voltages appear nominal though. Wasn&#39;t really interested in the cells themselves, so left this area of investigation go for the time being.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/PXL_20221227_170428454.webp"><img title="Milwaukee M18 48-11-1828 Reverse Engineering" src="https://quagmirerepair.com/files/M18_48111828_B41/PXL_20221227_170428454_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>After removing 4 tamper-proof torx screws and popping the top off the battery top casing off, we&#39;re left with a simple circuit board connected to 5 pins and 10 batteries (5 sets of 2 cells). Did I say simple? (I might regret that later...)</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/DSC02928.webp"><img title="Milwaukee M18 48-11-1828 PCB Top View - Reverse Engineering teardown" src="https://quagmirerepair.com/files/M18_48111828_B41/DSC02928_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>I put this PCB under a decent camera (Sony A6300 with the FE 2.8/50 Macro lens) after removing the circuit board and de-soldering the connectors.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/DSC02930.webp"><img title="Milwaukee M18 48-11-1828 PCB bottom view - reverse engineering teardown" src="https://quagmirerepair.com/files/M18_48111828_B41/DSC02930_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>And back side of the PCB... Sorry, I really shouldn&#39;t have used that 300W Weller soldering iron on these... I don&#39;t have the proper tip for the wide terminals on my Hakko... [Another reminder to get this at some point.] I really need to get the coating off these boards.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/DSC02947.webp"><img title="Milwaukee M18 48-11-1828 PCB top view without coating - reverse engineering teardown" src="https://quagmirerepair.com/files/M18_48111828_B41/DSC02947_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>After a soak in some solvents and a quick scrub with a brass bristled brush, we&#39;re left with a nice clear board. We&#39;ve got two chips that took a bit of time to figure out what they were... [insert plenty of wasted time trying to get pictures of the poorly lasered markings and guessing of multiple digits (is that a B or an 8?; a 6, 5 or an 8?) - My wife finally arrived at the solution for U2 - Hooray for second opinions and excellent reading/deciphering skills!] U1 is a <a href="https://quagmirerepair.com/files/M18_48111828_B41/msp430g2744.pdf">Texas Instruments MSP430G2744 Mixed Signal Microcontroller (Datasheet, PDF, 86 pages, 2.15MB).</a> U2 is a <a href="https://quagmirerepair.com/files/M18_48111828_B41/bq76925.pdf">Texas Instruments BQ76925 3 to 6 Series Cell Li-Ion Battery Monitor IC (Datasheet - PDF, 48 Pages, 6.10MB).</a></p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/DSC02949.webp"><img title="Milwaukee M18 48-11-1828 PCB bottom view without coating - reverse engineering teardown" src="https://quagmirerepair.com/files/M18_48111828_B41/DSC02949_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>Back side of the board... It was at this point that I noticed the tiny little numbers in the upper right hand side of the PCB (the dim 3 and 4). I then had to flip the board over and verify that there was indeed a 1 and 2 on the top side... Uh oh... (This is a 4 layer circuit board) I should also note here the text on the bottom of the board reading &#34;280086026 Rev 7.0 Jan-31-2013&#34;; as far as I can tell that is the same as what the front says.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/DSC02967.webp"><img title="Milwaukee M18 48-11-1828 PCB top view without components - reverse engineering teardown" src="https://quagmirerepair.com/files/M18_48111828_B41/DSC02967_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>After a very tedious couple hours of de-soldering components and trying to measure each and every one, we&#39;re left with a board that looks like this; It needs some cleanup yet, but that will come shortly... I now have a <a href="https://quagmirerepair.com/files/M18_48111828_B41/BOM.pdf">BOM (PDF, 3 Pages, 29KB)</a> that is surprisingly complete and a board that is still mostly intact - If you want something to look for I lost a total of one pad and loosened two more. The lost pad isn&#39;t connected to anything as far as I can tell.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/DSC02970.webp"><img title="Milwaukee M18 48-11-1828 PCB top view without components and sanded - reverse engineering teardown" src="https://quagmirerepair.com/files/M18_48111828_B41/DSC02970_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>A quick sand with 400 grit sandpaper to take away the solder resist and silkscreen leaves us with most of the copper on Layer 1 visible. Now we need to get to the middle layers.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/DSC02977.webp"><img title="Milwaukee M18 48-11-1828 PCB Middle layer view - reverse engineering teardown" src="https://quagmirerepair.com/files/M18_48111828_B41/DSC02977_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>After a bunch more sanding, we&#39;re left with a decently clear view of Layer 2 on the PCB. We can see the ground/negative plane on the right hand side of the board.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/DSC02980.webp"><img title="Milwaukee M18 48-11-1828 PCB middle layer view view  - reverse engineering teardown" src="https://quagmirerepair.com/files/M18_48111828_B41/DSC02980_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>Same process on the other side of the PCB. We can see Layer 2 fairly nicely, although I will warn you that some of the vias aren&#39;t highlighted very well because of the ground plane on Layer 3... The larger copper area clustered around U1 appears to be the positive rail.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/Layer1marked.webp"><img title="Milwaukee M18 48-11-1828 Layer 1 Copper  - reverse engineering teardown" src="https://quagmirerepair.com/files/M18_48111828_B41/Layer1marked.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>I&#39;ve gone through and marked all the copper layers to the best of my abilities. You can <a href="https://quagmirerepair.com/files/M18_48111828_B41/Stacked_Images_for_website.zip">download a lower-res version of the document I&#39;m working off of here. (ZIP-XCF-Gimp, 30.1MB)</a> I&#39;m going to have to take a bit of a break on this project, but this should be enough info for you to start tracing connections without going to all the previous work. (Let me know if I messed up any of the connections!). And yes, I know I didn&#39;t dump firmware either...It is on my todo list! Enjoy!</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/28086026_R7.0_BQ76925_PRETTY.pdf"><img title="Milwaukee M18 48-11-1828 BQ76925 Battery Monitoring - reverse engineering teardown" src="https://quagmirerepair.com/files/M18_48111828_B41/28086026_R7.0_BQ76925_PRETTY.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<hr/>
<p>2023-01-16: Small update and work in progress notice: I&#39;ve attached a small diagram of the BQ76925 Battery Monitoring Connections. This is one area that always puzzled me about these batteries: Was there cell balancing? <s>The answer for this battery is a definite NO! (and this puzzles me...why not? I mean aside from cost?) </s> 2023.2.1 Correction: Thanks to Ben C. for pointing out my mistake; It does appear as if the BQ76925 has the ability to balance cells. Current is controlled by R7/R9/R11/R12/R11. But the actual balancing is controlled by commands from the host MSP430. Every battery connection except BAT+ and CT1- are fully diagramed in this image. I am really confused about the purpose of D20/D21 though... [2023.2.1 note: I think I stumbled onto part of the voltage regulation circuit for the microprocessor. Not diagramed fully though. I really should have included the block diagram from the BQ76925. I&#39;m including it here for reference.] I&#39;m still confused by the difference in capacitor layout between the two diagrams and the actual Milwaukee design though.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/82blockdiagram.webp"><img title="Milwaukee M18 48-11-1828 BQ76925 Block Diagram" src="https://quagmirerepair.com/files/M18_48111828_B41/82blockdiagram.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/simplifiedschematic_BQ76925.webp"><img title="Milwaukee M18 48-11-1828 BQ76925 Reference Diagram" src="https://quagmirerepair.com/files/M18_48111828_B41/simplifiedschematic_BQ76925.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<hr/>
<p>2023-01-28: Small update: Quick diagram of the charging control circuit. I needed to know which pin on the MSP430 controlled the charging circuit. Now you know too! <a href="https://quagmirerepair.com/files/M18_48111828_B41/si4401bd.pdf">Datasheet for 4401 P-Channel MOSFET (Datasheet, PDF, 8 pages, 181KB).</a> Just as a reminder, RT2 is not populated and R29 is populated. (somehow I mis-labeled this resister on <a href="https://quagmirerepair.com/files/M18_48111828_B41/BOM.pdf">my BOM</a> and the other board I have doesn&#39;t have RT2 or R29 on it... I need to dissect a couple more batteries to find a similar circuit board of similar vintage.) Now, I&#39;m wondering how the battery knows a charger is connected...</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/ChargingCircuit_lrg.webp"><img title="Milwaukee M18 Battery Charging Circuit" src="https://quagmirerepair.com/files/M18_48111828_B41/ChargingCircuit_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>And here are the UI circuit elements. It surprised me that they are using Q1 to turn the LEDs on and off; why would you use an extra IO Pin to cut power to LEDs? Would there be a leakage/voltage problem I&#39;m missing? Switch input is nicely de-bounced in hardware, although there again I&#39;m confused by the extra IO pin connected via R27... It seems wasted somehow; wouldn&#39;t a typical circuit use R27 to bias pin 33 towards VCC instead of connecting to an IO pin? There are direct connections from the 4 pin header to Pin 5 (Manual says &#39;Reset or nonmaskable interrupt input. Spy-Bi-Wire test data input/output during programming and test.&#39;) and Pin 37 (Manual says &#39;Selects test mode for JTAG pins on Port 1. The device protection fuse is connected to TEST. Spy-Bi-Wire test clock input during programming and test.&#39;) I really don&#39;t like seeing direct mentions about &#39;device protection fuses&#39; on pin descriptions when I&#39;d like to retrieve firmware at some point.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/28086026%20R7.0_UI.webp"><img title="Milwaukee M18 Battery UI Elements" src="https://quagmirerepair.com/files/M18_48111828_B41/28086026%20R7.0_UI_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<hr/>
<p>2023-02-03: Oh look! <a href="https://quagmirerepair.com/files/M18_48111828_B41/slua707.pdf">A handy guide from Texas Instruments on how to use the BQ76925 with the MSP430G2xx2. (PDF, 29 Pages, 941kB)</a> Why do the circuit diagrams look familiar? It is almost like Milwaukee used a Texas Instruments reference design with tweaks!</p>
<hr/>
<p>2023-02-04: A couple interesting google patent links for M18 Batteries:</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/28086026_R7.0_J1J2.webp"><img title="Milwaukee M18 Battery External Communication Circuits" src="https://quagmirerepair.com/files/M18_48111828_B41/28086026_R7.0_J1J2_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>I&#39;ll add this diagram to the page as well, since J1/J2 communication seems to be a popular request and that I think I finally have it decently diagramed. J2 seems to have a dual purpose;</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/28086026_R7.0_BQ76925_to_MSP430.webp"><img title="Milwaukee M18 Battery BQ76925 to MSP430 Communication links circuit diagram" src="https://quagmirerepair.com/files/M18_48111828_B41/28086026_R7.0_BQ76925_to_MSP430_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>And one more diagram... This diagram shows the various signal wires and communication links between the MSP430 and the BQ76925. Finally have the Thermistors fit into the circuit as well!</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/referencediagram.webp"><img title="TI Reference Diagram" src="https://quagmirerepair.com/files/M18_48111828_B41/referencediagram.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>Its almost funny seeing that Milwaukee&#39;s battery uses an almost exact copy of this reference diagram from <a href="https://quagmirerepair.com/files/M18_48111828_B41/slua707.pdf">Texas Instruments&#39; Application Report. (PDF, 29 Pages, 941kB)</a> Only thing different I can see is the alert line which is unused by Milwaukee... Wonder why? (I didn&#39;t dive into the details on this pin yet...) I guess you can&#39;t improve on something that is perfectly designed!</p>

<hr/>
<p>2023-02-06: Milwaukee M18 Battery Communication:</p>
<p>Settings for J1/J2 Communication:</p>
<p>2000 Baud (yes really... not 1200, not 2400 baud)</p>
<p>Data length: 8 Bits</p>
<p>Parity: None</p>
<p>Stop Bits: 1</p>
<p>Idle Level: High</p>
<p>Bit Order: Unknown</p>
<p>Thanks to Mick @ buyitfixit for reminding me that when you measure a bit duration of 500us and calculate a baud rate of 2000 you probably shouldn&#39;t try to decode a serial stream with 1200 or 2400 baud no matter the what the datasheets say (or what common baud rates are).</p>
<p>Last byte of each message appear to be a Checksum. IE 0x81 + 0x20 + 0x00 + 0x00 = 0xA1 (Thanks again to Mick @ buyitfixit)</p>
<p>Battery does not appear to send any data on P1/P2 when battery test button is pushed; also doesn&#39;t appear like Milwaukee M18 Batteries support the long-press self-test diagnostic/LED flash codes anymore. Can&#39;t get them to appear on any battery year 2015+... [edit: Newer M18 FORGE batteries appear to have the functionality built in again]</p>
<p>There are a surprising number of M18 tools that don&#39;t seem to communicate with the battery... Course I&#39;m dealing with mostly used/otherwise broken tools, so there is a possibility that there is something faulty there as well. M18 LED Flashlight, transfer pump, circular saw etc don&#39;t seem to communicate.</p>
<hr/>
<p>2023-02-11 Update: Below is some data for anybody to pour over. Still not quite sure on bit order - scope is set for LSB (Least Significant Bit). First spreadsheet is the results of a 7 second capture on my scope, triggered by the communication line dropping in voltage when the battery gets plugged into the charger. Charger begins communication with an 0x55 handshake (Charger is RX and Battery is TX). Various data points about the batteries are included in the spreadsheet. Strangely, a lot of it looks very similar with the only major difference being an early shutdown in communication when the battery reports itself as already full. First byte might be a device ID. Second byte may be a command. Last byte is a checksum. In between?</p>
<p><a href="https://quagmirerepair.com/files/M18_Communication/BatteryPluggedIntoCharger.zip">BatteryPluggedIntoCharger (ZIP - Libreoffice Calc Spreadsheet .ODS, 33KB)</a></p>
<p>2nd/3rd Spreadsheet: I also tapped the SDA/SCL Communication lines between the BQ76925 and R7F0C901B2 MCU in addition to watching the P1/P2 Data lines. Unfortunately, my scope has a very limited capture time due to four channels and the increased resolution required for the I2C communication. This shows the data that is being requested by the R7F0C901B2 MCU, but not the actual data supplied by the BQ76925. I&#39;ve included a couple pictures on the spreadsheet of register maps on the BQ76925 to help decode the data... Strangely, at least to me, VC4_CAL isn&#39;t requested and I only see requests for one battery cell voltage. (please correct me if I&#39;m mis-interpreting data wrong)</p>
<p><a href="https://quagmirerepair.com/files/M18_Communication/2023-02-10_Charging.zip">2023-02-10_Charging (ZIP - Libreoffice Calc Spreadsheet .ODS, 147KB)</a></p>
<p><a href="https://quagmirerepair.com/files/M18_Communication/SDA_SCL_Decode.zip">SDA_SCL_Decode (ZIP - Libreoffice Calc Spreadsheet .ODS, 148KB)</a></p>
<hr/>
<p>2023-09-12: Update: I have no affiliation with Tool Scientist, but he&#39;s taken the reverse engineering further than I had time to...</p>
<p><iframe title="YouTube video player" src="https://www.youtube.com/embed/OGzeGUDAtac?si=1f1OIe4aHAixg36b" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
<hr/>
<p>2023-10-29: New video from Tool Scientist explaining &#39;Tool to Battery Communication&#39;:</p>
<p><iframe title="YouTube video player" src="https://www.youtube.com/embed/q7spzrIbdKY?si=20fsAOwcgbHwpQl4" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
<p>Definitely glad to know I wasn&#39;t crazy or being downright stupid in not finding any communication happening between the tool and battery, though I&#39;ll have to confess I did miss the 12V/3V &#39;handshake&#39; - I saw that the voltages were there, but never saw the handshake or saw them drop out. That and the complete miss on the battery amperage monitoring even though I clearly saw that it was supposed to be there on the sample designs. I just assumed Milwaukee chose to not implement it. Excellent work by the tool scientist... Now on to some new circuit designs!</p>
<hr/>
<p>2024-09-14: Update: No new information, but happy to see a mention! (and yes I really didn&#39;t see this for 11 months!)</p>
<p><iframe title="YouTube video player" src="https://www.youtube.com/embed/0smUe5xvAOQ?si=l4J-iUnNyLoG0mtU" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
<hr/>
<p>2024-10-5: Another video from Tool Scientist. He explains things so much better than I can! Seems there is one small step yet until someone builds a 3rd party external balancer for these batteries. (PLEASE, if someone has done so, please let me know! I&#39;ll gladly build and test units if needed!) I&#39;ve done manual balancing on 100&#39;s of these batteries to get them working again! And what was he working on that he created code to generate a balance byte? :) I guess we&#39;ll find out in future videos!</p>
<p><iframe title="YouTube video player" src="https://www.youtube.com/embed/eaopJyROmhM?si=gbDO7GMiCnAzrHaX" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
<p>Also realized I never linked to the other partially finished, related pages to this project. For more information on the Rapid Charger internals, <a href="https://quagmirerepair.com/milwaukee-860323004-rapid-charger">CLICK HERE.</a> For a similar (but not the same) partially completed teardown of a 5Ah battery, <a href="https://quagmirerepair.com/m18-rev05-jun-26-2015">CLICK HERE.</a> (the reference in the video above about the Renesas R7F0C901B2 microprocessor is what made me check for the links that I apparently never put up on this page.)</p>
<p>(Also made a couple readability fixes for this page.)</p>
<hr/>
<details>
<summary><strong>2024-12-28: Bunny Trail on obsolete MSP430 chips (click to expand)</strong></summary>

<p>2024-12-28: After watching some of the latest Tool Scientist videos, I have to add a note: Has anyone considered the <a href="https://www.ti.com/tool/BQ76925EVM">Texas Instruments BQ76925EVM Evaluation Module?</a> Scroll down the page a little to where it says <a href="https://dr-download.ti.com/software-development/firmware/MD-cWgxkC7OXn/01.00.00.00/sluc581.zip">&#39;SLUC581 — bq76925 Example Code&#39;</a> Under technical docs, there is a <a href="https://www.ti.com/lit/pdf/slusam9">Datasheet</a> and a <a href="https://www.ti.com/lit/pdf/sluu514">User&#39;s Guide (SLUU514A).</a> There is also an <a href="https://www.ti.com/lit/an/slua707/slua707.pdf">Application Report (SLUA707)</a> which gives a hint at a prebuilt battery management codebase from TI... which I can&#39;t seem to find...</p>
<hr/>
<p>2025-01-07: Theoretical only; read and apply at your own risk!</p>
<p>Processor above is 40-Pin RHA package (Source: <a href="https://quagmirerepair.com/files/M18_48111828_B41/msp430g2744.pdf">MSP430G2744 Datasheet (Datasheet, PDF, 86 pages, 2.15MB).</a>, pages 5 &amp; 8</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/RHA40Pin.webp"><img title="MSP430G2744 40-Pin RHA Pinout" src="https://quagmirerepair.com/files/M18_48111828_B41/RHA40Pin.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>and this part can possibly be programmed by the <a href="https://www.ti.com/tool/MSP-FET">MSP-FET430UIF programming tool</a> while possibly using the <a href="https://www.ti.com/tool/MSP-TS430RHA40A">MSP-TS430RGA40A socket.</a> <a href="https://quagmirerepair.com/files/M18_48111828_B41/slau278ah.pdf">MSP430 Hardware Tools (PDF, 191 pages, 9.75MB).</a> pages 78-80 gives a Schematic, layout and BOM for the board.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/MSP-TS430RGA40A_Pinout.webp"><img title="MSP-TS430RHA40A schematic" src="https://quagmirerepair.com/files/M18_48111828_B41/MSP-TS430RGA40A_Pinout.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>(There is also <a href="https://quagmirerepair.com/files/M18_48111828_B41/slau144k.pdf">MSP430G2xx Family User&#39;s Guide (PDF, 703 pages, 9.49MB).</a> that gives you quite a lot of info about the processor and all its functions, including an interesting section 7 on Flash Memory Operation.)</p>
<p>of related interest would probably be the <a href="https://quagmirerepair.com/files/M18_48111828_B41/slau319af.pdf">MSP430 Programming with the JTAG Interface User&#39;s Guide (PDF, 83 pages, 1.68MB).</a> and the <a href="https://quagmirerepair.com/files/M18_48111828_B41/slau319af.pdf">MSP430 Flash Devices Bootloader BSL (PDF, 52 pages, 1.13MB).</a> There are two warnings, one in each document: 1): Each MSP430F1xx, 2xx, and 4xx flash device includes a physical fuse that is used to permanently disable memory access through JTAG communication. When this fuse is programmed (or blown), access to memory through JTAG is permanently disabled and cannot be restored. 2) Access to the MSP430 MCU memory through the BSL is protected against misuse by the BSL password.</p>
<p>Anyway, bunny trail... back to the <a href="https://quagmirerepair.com/files/M18_48111828_B41/slau278ah.pdf">MSP430 Hardware Tools (PDF, 191 pages, 9.75MB).</a> Pages 21 and 22 show two connection diagrams for programming.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/jtagconnections.webp"><img title="MSP430G2744 JTAG connections" src="https://quagmirerepair.com/files/M18_48111828_B41/jtagconnections.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>RST/NMI is Pin 5</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/spybywire.webp"><img title="MSP430G2744 Spy-bi-Wire connections" src="https://quagmirerepair.com/files/M18_48111828_B41/spybywire.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>RST/NMI/SBWTDIO is Pin 5</p>
<p>and now we need to revisit an earlier electrical diagram with a header labeled HD1 - We can now clearly identify it as a Spy-bi-Wire /2-Wire JTAG interface. R1 and C1-C3 [in above diagram] are on the battery circuit board.</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/spibywireconnections.webp"><img title="M18 Battery Spy-bi-Wire connections" src="https://quagmirerepair.com/files/M18_48111828_B41/spibywireconnections.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>This should be an basic schematic of all the pins on the M18 Battery / MSP430 chip related to JTAG and Programming. Most of the pins have a testpoint that could be soldered to except pin 36 which seems to go to a via which has no further connections...</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/28086026%20R7.0_JTAG.webp"><img title="M18 Battery MSP430 JTAG pins schematic" src="https://quagmirerepair.com/files/M18_48111828_B41/28086026%20R7.0_JTAG_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p>(also a fix for a misplaced div tag in html page code... now paragraphs don&#39;t run to the very edge of the page and are a little more readable.)</p>
<hr/>
<p>2025-01-11: Theories don&#39;t always work out so well in practice... Waiting on a MSP-TS430QFN40 yet... I think something is happening though; as soon as I attempt communication, battery refuses to respond to the pushbutton on the board and can only be woken up again by connecting to a charger. 3.3VDC still present across VCC / VSS</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/PXL_20250111_193218031-2.jpg"><img title="M18 Battery JTAG attempt" src="https://quagmirerepair.com/files/M18_48111828_B41/PXL_20250111_193218031-2_sm.jpg" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/Screenshot_2025-01-11_190028.png"><img title="M18 Battery JTAG attempt failure" src="https://quagmirerepair.com/files/M18_48111828_B41/Screenshot_2025-01-11_190028.png" alt="" width="80%" height="80%" loading="lazy"/></a></p>
<hr/>
<p>2025-01-15: MSP-TS430QFN40 arrived... De-soldered 4 chips... and attempted to plunk the first into the socket... it did not plunk into place, but fell between the contacts... ? Chip measures 5x5mm - RHA40 should be about 5.8x5.8mm or QFN40 about 6x6mm... After some careful squinting I can see that this is an 32pin Renesas R5F100BG. I can see that the other chips I removed are also labeled the same way... These batteries were all 2018 and newer... I knew that there were newer chips in use, but it never registered in my brain to check if I had any of the old batteries with the MSP430. Sigh. Time to reconnoiter...</p>
<p><a href="https://quagmirerepair.com/files/M18_48111828_B41/PXL_20250115_220800332_sm.webp"><img title="M18 Battery R5F100BG" src="https://quagmirerepair.com/files/M18_48111828_B41/PXL_20250115_220800332_sm.webp" alt="" width="80%" height="80%" loading="lazy"/></a></p>

</details>
<hr/>
<p>2025-04-14: Ahem... I really should [try to] keep up with other people. I still haven&#39;t found any old batteries with the MSP430 microcontroller to use and someone else has gone ahead and done all the work for me:</p>
<iframe title="YouTube video player" src="https://www.youtube.com/embed/gh2-gSRNw-Y?si=6WzcwNxz_D55PsiW" width="560" height="315" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen"></iframe> </div>
</div></div>
  </body>
</html>
