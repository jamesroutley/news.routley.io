<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jo-m.ch/posts/2022/07/self-hosting-on-localhost/">Original</a>
    <h1>Selfhosting on Localhost</h1>
    
    <div id="readability-page-1" class="page"><article><p>As a software engineer with a healthy bit of job-induced paranoia, I love the idea of escaping the claws of big corporate via self-hosting.
In recent years, a plethora of amazing free and open source projects have emerged, which allow you to replace everything from Dropbox and iTunes to Android Home.
However, I don’t want to manage yet another server in the cloud, I already do that for work.
Managed container services like Cloud Run or Fargate are nice, but they cost, but persistence and configuration is not always trivial, and you hand off a lot of control again.</p><p>So, why not host my services on a machine which</p><ul><li>I have to update and maintain anyways</li><li>Which has good and reliable backups set up already</li><li>Is available (to me) even if the internet or power goes down</li><li>Does not cost me additional money to run</li></ul><p>That would be my personal laptop.
After all, there is no place like 127.0.0.1, so they saying goes (or <code>::1</code> nowadays).
Of course, there are some limitations:</p><ul><li>Not reachable from outside my home, i.e. when my Phone is not in my home WiFi</li><li>… that’s it I think.</li></ul><p>Caveat: I am not hosting any “critical” service like contacts sync, email, calendar on my Laptop.
For those, I still “trust” the big G.</p><h2 id="apps">Apps
<a href="#apps">#</a></h2><p>What I currently run on my Laptop:</p><ul><li><a href="https://photoprism.app/" target="_blank">Photoprism</a>
for my pictures</li><li><a href="https://www.navidrome.org/" target="_blank">Navidrome</a>
serving my old iTunes music collection</li><li><a href="https://github.com/go-shiori/shiori" target="_blank">Shiori</a>
for my bookmarks</li><li><a href="https://syncthing.net/" target="_blank">Syncthing</a>
to sync files between my phone and my Laptop</li></ul><p>You might note that the first three of those 10 years ago would have been normal “desktop apps”.
Today, many people use cloud services for those however.
Syncthing <em>did</em> replace Dropbox for me, though.</p><h3 id="syncthing">Syncthing
<a href="#syncthing">#</a></h3><p>I use syncthing to sync files, photos, and notes between my Laptop and Phone.
The official <a href="https://play.google.com/store/apps/details?id=com.nutomic.syncthingandroid" target="_blank">Syncthing for Android</a>
app simply syncs my DCIM directory from my phone to my Laptop, giving me an entirely self-hosted and synchronized “camera roll”. I also use <a href="https://joplinapp.org/" target="_blank">Joplin Notes</a>
on my phone and laptop, using local folder storage, which is then also synched via Syncthing.</p><h2 id="how">How
<a href="#how">#</a></h2><p>I am a firm believer in Docker-compose for production deployments.
For simple localhost hosting, it is enough to mount some volumes from the local FS for persistence, and specify <code>restart: unless-stopped</code>.
Where a database is needed, SQLite is in use.
<strong>Warning:</strong> some additional caveats apply regarding firewall and network ports, see <a href="https://github.com/chaifeng/ufw-docker" target="_blank">https://github.com/chaifeng/ufw-docker</a>
. Make sure that the self-hosted apps are not reachable from the outside (LAN).</p><p>For example, this is my <code>docker-compose.yml</code> for Shiori:</p><div><pre tabindex="0"><code data-lang="yaml"><span><span><span># Setup:</span><span>
</span></span></span><span><span><span></span><span>#</span><span>
</span></span></span><span><span><span></span><span>#     mkdir -p ~/.shiori/data # must be owned by 1000:1000</span><span>
</span></span></span><span><span><span></span><span>#     docker-compose run --rm shiori migrate</span><span>
</span></span></span><span><span><span></span><span>#     docker-compose up -d</span><span>
</span></span></span><span><span><span></span><span>#</span><span>
</span></span></span><span><span><span></span><span># Then, add account in settings (http://localhost:2344/#setting):</span><span>
</span></span></span><span><span><span></span><span>#   default login: shiori:gopher</span><span>
</span></span></span><span><span><span></span><span>version</span>:<span> </span><span>&#39;2.4&#39;</span><span>
</span></span></span><span><span><span></span><span>services</span>:<span>
</span></span></span><span><span><span>    </span><span>shiori</span>:<span>
</span></span></span><span><span><span>        </span><span>image</span>:<span> </span>ghcr.io/go-shiori/shiori:latest<span>
</span></span></span><span><span><span>        </span><span>restart</span>:<span> </span>unless-stopped<span>
</span></span></span><span><span><span>        </span><span>user</span>:<span> </span><span>1000</span>:<span>1000</span><span>
</span></span></span><span><span><span>        </span><span>ports</span>:<span>
</span></span></span><span><span><span>            </span>- <span>2344</span>:<span>8080</span><span>
</span></span></span><span><span><span>        </span><span>volumes</span>:<span>
</span></span></span><span><span><span>        </span><span># persist all data at ~/.shiori/data</span><span>
</span></span></span><span><span><span>        </span>- <span>&#34;~/.shiori/data:/shiori/&#34;</span><span>
</span></span></span></code></pre></div><p>And Photoprism:</p><div><pre tabindex="0"><code data-lang="yaml"><span><span><span>version</span>:<span> </span><span>&#39;3.5&#39;</span><span>
</span></span></span><span><span><span>
</span></span></span><span><span><span></span><span>services</span>:<span>
</span></span></span><span><span><span>  </span><span>photoprism</span>:<span>
</span></span></span><span><span><span>    </span><span>image</span>:<span> </span>photoprism/photoprism:latest<span>
</span></span></span><span><span><span>    </span><span>restart</span>:<span> </span>unless-stopped<span>
</span></span></span><span><span><span>    </span><span>user</span>:<span> </span><span>1000</span>:<span>1000</span><span>
</span></span></span><span><span><span>    </span><span>security_opt</span>:<span>
</span></span></span><span><span><span>      </span>- seccomp:unconfined<span>
</span></span></span><span><span><span>      </span>- apparmor:unconfined<span>
</span></span></span><span><span><span>    </span><span>ports</span>:<span>
</span></span></span><span><span><span>      </span>- <span>&#34;127.0.0.1:2342:2342&#34;</span><span>
</span></span></span><span><span><span>    </span><span>environment</span>:<span>
</span></span></span><span><span><span>      </span><span>PHOTOPRISM_HTTP_PORT</span>:<span> </span><span>2342</span><span>
</span></span></span><span><span><span>      </span><span>PHOTOPRISM_ADMIN_PASSWORD</span>:<span> </span><span>&#34;...&#34;</span><span>
</span></span></span><span><span><span>      </span><span>PHOTOPRISM_PUBLIC</span>:<span> </span><span>&#34;false&#34;</span><span>
</span></span></span><span><span><span>      </span><span>PHOTOPRISM_READONLY</span>:<span> </span><span>&#34;true&#34;</span><span>
</span></span></span><span><span><span>      </span><span>PHOTOPRISM_DATABASE_DRIVER</span>:<span> </span><span>&#34;sqlite&#34;</span><span>
</span></span></span><span><span><span>      </span><span>PHOTOPRISM_SITE_URL</span>:<span> </span><span>&#34;http://localhost:2342/&#34;</span><span>
</span></span></span><span><span><span>    </span><span>volumes</span>:<span>
</span></span></span><span><span><span>      </span>- <span>&#34;~/Pictures/fotos:/photoprism/originals:ro&#34;</span><span>
</span></span></span><span><span><span>      </span>- <span>&#34;~/.photoprism:/photoprism/storage&#34;</span><span>
</span></span></span></code></pre></div><h2 id="maintenance">Maintenance
<a href="#maintenance">#</a></h2><p>To update the apps, a simple <code>docker-compose pull; docker-compose up -d</code> is enough.
I back up my laptop via Borg anyways, so there is no need for separate backup.
The only thing to consider there would be to run <code>sqlite file.db &#39;.backup file-backup.db&#39;</code> before backups, because it is not safe to simply copy in-use SQLite files.</p><hr/><p><a href="https://jo-m.ch/posts/2020/01/a-closer-look-at-the-got-it-bluetooth-tags/" title="older">← A closer look at the Got-It Bluetooth tags</a></p></article></div>
  </body>
</html>
