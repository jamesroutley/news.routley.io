<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.dash0.com/blog/monitoring-minecraft-with-opentelemetry">Original</a>
    <h1>Monitoring my Minecraft server with OpenTelemetry and Prometheus</h1>
    
    <div id="readability-page-1" class="page"><div><section id="content"><p>The <a target="_blank" href="https://github.com/dash0hq/minecraft-server">Minecraft Server<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a> repository on GitHub provides step-by-step setup instructions you can follow along.</p><h2 id="a-minecraft-server-to-call-my-own"><a aria-label="Link to section" href="#a-minecraft-server-to-call-my-own"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>A Minecraft server to call my own</a></h2><p>I want a Minecraft server for multiplayer, where I can do mischief with the kids. And hopefully do not embarrass myself too much by being repeatedly killed by angry chickens or whatever.</p><p>Kids these days think Java is not a cool programming language. Little do they know that it powers one of the games they love most: Minecraft.</p><p>(Well, technically the “original” Minecraft server is written in Java. <a target="_blank" href="https://www.minecraft.net/en-us/article/java-or-bedrock-edition">Microsoft made things confusing<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a> by adding the Bedrock server, which reportedly uses a combination of C, C# and Java, and is different in terms of gameplay from vanilla in subtle ways. <a target="_blank" href="https://www.reddit.com/r/Minecraft/comments/dm3c73/why_does_bedrock_edition_exist/">Opinions on Reddit<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a> differ on why Bedrock needed to exist in the first place.)</p><p>There are so many ways to host a Minecraft server when one considers the multiple launchers (ATLauncher, CurseForge, Bukkit, Fabric, Fork and the fifty more you are likely already typing in the comments). But I am a man of simple tastes, and running the “vanilla” Minecraft server as a Systemd unit on a Linux VM in the cloud is exactly my cup of tea.</p><p>And if I have learned anything about providing IT infrastructure to my family, it is that their expectations on SLOs and system reliability are up there with NASA’s Moon exploration programs. So, the Minecraft server should work reliably and, if it goes down, I should know well before they do.</p><p>Hence: I need monitoring.</p><p><em>Lots and lots of monitoring.</em></p><h2 id="the-monitoring-setup-at-a-glance"><a aria-label="Link to section" href="#the-monitoring-setup-at-a-glance"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>The monitoring setup at a glance</a></h2><p>The monitoring setup for my Minecraft server is shown in this diagrams:</p><section data-layout="aligned"><div id="image-a8808be095154addf7e73d3c94c6f60f2c1be666-1999x886-png"><a href="https://cdn.sanity.io/images/rdn92ihu/production/a8808be095154addf7e73d3c94c6f60f2c1be666-1999x886.png?w=1999&amp;h=886&amp;fit=max&amp;auto=format" data-pswp-width="1999" data-pswp-height="886" target="_blank" rel="noreferrer"><figure><img loading="lazy" width="1999" height="886" decoding="async" data-nimg="1" srcset="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Frdn92ihu%2Fproduction%2Fa8808be095154addf7e73d3c94c6f60f2c1be666-1999x886.png%3Fw%3D1999%26h%3D886%26fit%3Dmax%26auto%3Dformat&amp;w=2048&amp;q=100 1x, /_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Frdn92ihu%2Fproduction%2Fa8808be095154addf7e73d3c94c6f60f2c1be666-1999x886.png%3Fw%3D1999%26h%3D886%26fit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=100 2x" src="https://www.dash0.com/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Frdn92ihu%2Fproduction%2Fa8808be095154addf7e73d3c94c6f60f2c1be666-1999x886.png%3Fw%3D1999%26h%3D886%26fit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=100"/></figure></a></div></section><p>There are three components that collaborate in collecting the telemetry to send to Dash0:</p><ul><li>The <a target="_blank" href="https://github.com/open-telemetry/opentelemetry-java-instrumentation">OpenTelemetry Java Agent<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a> runs <em>inside</em> the Java Virtual Machine powering the Minecraft server itself, and it reports runtime telemetry about the JVM to the OpenTelemetry Collector.</li><li>The <a target="_blank" href="https://github.com/dirien/minecraft-prometheus-exporter">Minecraft Exporter for Prometheus<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a> collects Prometheus metrics that are specific to Minecraft like player count, how many blocks have been mined, and most importantly: how many cake slices have been eaten.</li><li>The <a target="_blank" href="https://github.com/open-telemetry/opentelemetry-collector-contrib/">OpenTelemetry Collector<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a>, well, <em>collects</em> more telemetry, like Systemd logs for the Minecraft server <em>and</em> the other components, receives telemetry from the OpenTelemetry Java Agent, scrapes the Minercraft exporter, adds some normalization to the telemetry (most importantly: resource metadata to neatly categorize which telemetry comes from what), and sends it all off to Dash0.</li></ul><h2 id="runtime-metrics-with-the-opentelemetry-java-agent"><a aria-label="Link to section" href="#runtime-metrics-with-the-opentelemetry-java-agent"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>Runtime metrics with the OpenTelemetry Java Agent</a></h2><p>The OpenTelemetry Java Agent has an extensive set of automatic instrumentations for distributed tracing for many application protocols like HTTP, databases, messaging queues, etc. But none of them are quite applicable to a Minecraft server: Minecraft clients talk over a TCP socket with a protocol specific to Minecraft, and there is no distributed tracing instrumentation for it in the OpenTelemetry Java Agent for it.</p><p>And to be honest, I am not missing it: I don’t see value in creating a span, say, every time I get manhandled by an Enderman. First of all: I don’t need that recorded for posterity. And secondly: that is way too much entropy for the good of the universe.</p><section data-layout="aligned"><div id="image-dbbc6848628d40c761fa17b8fe6e3985b51a797f-3456x1982-png"><a href="https://cdn.sanity.io/images/rdn92ihu/production/dbbc6848628d40c761fa17b8fe6e3985b51a797f-3456x1982.png?w=3456&amp;h=1982&amp;fit=max&amp;auto=format" data-pswp-width="3456" data-pswp-height="1982" target="_blank" rel="noreferrer"><figure><img alt="" loading="lazy" width="3456" height="1982" decoding="async" data-nimg="1" srcset="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Frdn92ihu%2Fproduction%2Fdbbc6848628d40c761fa17b8fe6e3985b51a797f-3456x1982.png%3Fw%3D3456%26h%3D1982%26fit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=100 1x" src="https://www.dash0.com/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Frdn92ihu%2Fproduction%2Fdbbc6848628d40c761fa17b8fe6e3985b51a797f-3456x1982.png%3Fw%3D3456%26h%3D1982%26fit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=100"/></figure></a></div><span><span><em>The Java dashboard in Dash0, showing me metrics about my Minecraft server.</em></span></span></section><p>But what we get out of the box with the OpenTelemetry Java Agent, is <em>runtime metrics</em> about the Java Virtual Machine itself, and especially, CPU and memory. In Dash0, it’s one click to import the <a target="_self" href="https://www.dash0.com/hub/integrations/int_java/overview">Java integration<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a> and get out-of-the-box visibility in the key JVM metrics.</p><h2 id="minecraft-specific-metrics-with-a-prometheus-exporter"><a aria-label="Link to section" href="#minecraft-specific-metrics-with-a-prometheus-exporter"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>Minecraft-specific metrics with a Prometheus exporter</a></h2><p>Collecting JVM metrics will tell us a lot about whether the server is running, or why in some situations it may feel slow, e.g., CPU usage too high, for example because of garbage collection. But what about the <em>fun stuff</em>, like how many players are connected, how many blocks are mined?</p><p>Besides, there’s things I will make sure do <em>not</em> get recorded, like how many times I died (the <code><span>minecraft_deaths_total</span></code> counter). Luckily, Dash0’s <a target="_self" href="https://www.dash0.com/changelog/spam-filters">Spam filters<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a> will allow me to bury my shame with just a couple clicks.</p><h3 id="many-many-prometheus-exporters"><a aria-label="Link to section" href="#many-many-prometheus-exporters"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>Many, many Prometheus exporters</a></h3><p>First of all, there is <em>a lot</em> of software out there that can expose Prometheus metrics about a Minecraft server. A search on GitHub yielded:</p><ul><li>The <a target="_blank" href="https://github.com/sladkoff/minecraft-prometheus-exporter">Minecraft Prometheus Exporter<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a>, which uses the extensibility of <a target="_blank" href="https://dev.bukkit.org/">Bukkit<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a> to add a Prometheus endpoint via an additional JAR file. I wanted to use a vanilla Minecraft server, so anything relying on Bukkit is not an option for me.</li><li>The <a target="_blank" href="https://github.com/cpburnz/minecraft-prometheus-exporter">minecraft-prometheus-exporter<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a> (names in the Prometheus ecosystem tend to be pretty to the point, which leads to name clashes) which uses <a target="_blank" href="https://fabricmc.net/">Fabric<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a>, another way to run Minecraft servers with mods. Like Bukkit, Fabric was not an option for me.</li><li>The <a target="_blank" href="https://github.com/Joshi425/minecraft-exporter">minecraft-exporter<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a>, written in Python. I truly had no wish to wrangle Python and its package ecosystem, so I gave this a pass.</li><li>And finally, the one I went with: the <a target="_blank" href="https://github.com/dirien/minecraft-prometheus-exporter">Minecraft Prometheus Exporter<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a> by <a target="_blank" href="https://github.com/dirien">Engin Diri<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a>, which ticked for me all the boxes: written in Go, easy to download from the GitHub releases pages, and has a lot of <a target="_blank" href="https://github.com/dirien/minecraft-prometheus-exporter#collectors-">cool telemetry<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a>.</li></ul><p>Now, finally armed with a Prometheus exporter that tickles my fancy, let’s have a look at how Prometheus exports generally work. Because, if you come from the world of OpenTelemetry, <em>it may not be what you expect</em>.</p><h3 id="push-vs-pull"><a aria-label="Link to section" href="#push-vs-pull"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>Push vs Pull</a></h3><p>Collecting metrics about the Minecraft-specific aspects of a Minecraft server is a bit more convoluted than collecting telemetry about the Java Virtual Machine it runs on. While both the OpenTelemetry Java Agent and the Minecraft Exporter collect metrics, there is a fundamental difference in how they <em>ship</em> the metrics to a backend. Specifically: the OpenTelemetry Java Agent <em>pushes</em> metrics towards a destination (in our case, the OpenTelemetry Collector), while the Minecraft Exporter needs to have its metrics <em>pulled</em>.</p><p>The <em>pull model</em> is a distinctive aspect of the Prometheus ecosystem, where you need something to <em>scrape</em> (i.e., pull at regular intervals metrics out of) your Prometheus endpoint. In our case, scraping too is something that the OpenTelemetry Collector can do with its <a target="_blank" href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/prometheusreceiver"><code><span>prometheusreceiver</span></code><span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a>.</p><p>Note, the name “receiver” can be misleading here: <em>usually</em> the OpenTelemetry Collector receives telemetry, as in, it is sent telemetry from something else. So components that “add telemetry” into the Collector are generally called receivers, even when they “actively get” telemetry from somewhere else, like in the case of scraping Prometheus endpoints or, as we will see later, <a target="_self" href="https://www.dash0.com/guides/collect-journald-logs">collecting Journald logs<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a>.</p><h2 id="collecting-logs"><a aria-label="Link to section" href="#collecting-logs"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>Collecting logs</a></h2><p>The last piece of telemetry we need for our setup is logs. And those are not just the logs of the Minecraft server itself, which includes information about crashes, slowdowns, player activity and so on. But also the logs about the other components of the monitoring setup, namely the OpenTelemetry Collector and the Minecraft Exporter. Since the OpenTelemetry Java Agent runs <em>inside</em> the Minecraft server, that is, inside the same Java Virtual Machine, the logs collected from the Minecraft server include the OpenTelemetry Java Agent ones.</p><p>In my setup, I run each of the components as a <a target="_blank" href="https://www.baeldung.com/linux/systemd">Systemd unit<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a>. The logs generated by Systemd units are collected by <a target="_blank" href="https://linuxconfig.org/introduction-to-the-systemd-journal">Journald<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a>, and the OpenTelemetry Collector can <a target="_self" href="https://www.dash0.com/blog/collect-journald-logs">get the logs from it<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a>.</p><h2 id="alerting"><a aria-label="Link to section" href="#alerting"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>Alerting</a></h2><p>For now, I am going to keep it simple: I want to be notified if the server is down. Ideally, before my son sends me some sternly-worded messages.</p><h3 id="is-the-server-running"><a aria-label="Link to section" href="#is-the-server-running"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>Is the server running?</a></h3><p>In Dash0, I can check for that with the following PromQL expression:</p><div id="code-snippet"><pre><p><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span></p><div><div><p><span>  otel_metric_name=&#34;jvm.cpu.time&#34;,</span></p></div><div><p><span>  process_command_args=~&#34;.*server\\.jar.*&#34;,</span></p></div><div><p><span>  service_name=&#34;minecraft-server&#34;,</span></p></div><div><p><span>  service_namespace=&#34;minecraft&#34;</span></p></div></div></pre></div><p>The alert fires if there is no CPU usage reported by the JVM running the Minecraft server, which is a pretty good proxy for “the server is not running”.</p><p>Notice that this also nicely doubles as a dead-man switch for the entire setup: for example, if the Minecraft server is running, but the OpenTelemetry Collector is not, I’d still get paged.</p><h3 id="is-the-server-restarting"><a aria-label="Link to section" href="#is-the-server-restarting"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>Is the server restarting?</a></h3><p>Knowing whether no server is running is a good start, but not nearly enough. Specifically, I should check for restarts of the JVM, which Systemd is going to do if the server crashes. This can be accomplished with a rule on logs, which in Dash0 I can query with PromQL using the “magic” <a target="_self" href="https://www.dash0.com/documentation/dash0/key-concepts/synthetic-metrics#available-metrics"><code><span>dash0.logs</span></code> metric<span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a>:</p><div id="code-snippet"><pre><p><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span></p><div><div><p><span>sum by (otel_log_severity_range) (</span></p></div><div><p><span>    otel_metric_name = &#34;dash0.logs&#34;,</span></p></div><div><p><span>    service_name = &#34;minecraft-server&#34;,</span></p></div><div><p><span>    otel_log_body =~ &#34;^Starting minecraft server.*&#34;}[10m]</span></p></div></div></pre></div><p>This rule will trigger when the server restarts, and the alert will resolve itself the next evaluation without restarts. In Dash0 I can set this to be a warning and route those alerts to Slack, so that I get a ping when there is some downtime. The <code><span>$__threshold</span></code> symbol is something optional in Dash0 that allows you to specify the severity of an alert. This is an extension of the Prometheus alerting model, where an alert has severity modeled only in labels, and that means that a rule can have only one severity, and one ends up having multiple copies of a rule, differing only in terms of hard-coded threshold and label.</p><h3 id="is-the-server-crashing"><a aria-label="Link to section" href="#is-the-server-crashing"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>Is the server crashing?</a></h3><p>But there is an even more interesting alert I can raise based on logs, and that is when Systemd fails to start the Minecraft server altogether, which was happening a lot as I was working out the setup:</p><div id="code-snippet"><pre><p><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span></p><div><div><p><span>sum by (otel_log_severity_range) (</span></p></div><div><p><span>    otel_metric_name = &#34;dash0.logs&#34;,</span></p></div><div><p><span>    service_name = &#34;minecraft-server&#34;,</span></p></div><div><p><span>    otel_log_body =~ &#34;^Failed to start the minecraft server.*&#34;}[1m]</span></p></div></div></pre></div><p>Besides, I do not need to know PromQL to create this rule: Dash0 has a query builder for counting logs matching specific filters:</p><section data-layout="aligned"><div id="image-6cdd5e613f543f774b891119af5435eacbaac9cb-3818x1752-png"><a href="https://cdn.sanity.io/images/rdn92ihu/production/6cdd5e613f543f774b891119af5435eacbaac9cb-3818x1752.png?w=3818&amp;h=1752&amp;fit=max&amp;auto=format" data-pswp-width="3818" data-pswp-height="1752" target="_blank" rel="noreferrer"><figure><img alt="" loading="lazy" width="3818" height="1752" decoding="async" data-nimg="1" srcset="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Frdn92ihu%2Fproduction%2F6cdd5e613f543f774b891119af5435eacbaac9cb-3818x1752.png%3Fw%3D3818%26h%3D1752%26fit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=100 1x" src="https://www.dash0.com/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Frdn92ihu%2Fproduction%2F6cdd5e613f543f774b891119af5435eacbaac9cb-3818x1752.png%3Fw%3D3818%26h%3D1752%26fit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=100"/></figure></a></div><span><span><em>Yeah, working out the server configuration was bumpy.</em></span></span></section><h3 id="why-use-logs-instead-of-metrics"><a aria-label="Link to section" href="#why-use-logs-instead-of-metrics"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>Why use logs instead of metrics?</a></h3><p>In the Prometheus ecosystem, the traditional way to know if a server is up, is to check the <code><span>up</span></code> metric associated with scraping the server itself. I felt like I would get much more bang for my buck checking logs instead, and in Dash0 that is also accomplished via PromQL.</p><p>What I do miss, however, is metrics about the status of Systemd units. While there is a <a target="_blank" href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/systemdreceiver"><code><span>systemdreceiver</span></code><span><svg width="100%" preserveAspectRatio="xMidYMid meet" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="ic arrow diagonal right up 8px"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.99116 2.125H1.50005V0.875H7.12505V6.5H5.87505V3.00888L1.94199 6.94194L1.05811 6.05806L4.99116 2.125Z" fill="currentColor"></path></g></svg></span></a> in the OpenTelemetry Collector, when I looked into its code hoping to see a metric reporting data on Systemd units, and specifically the status (which would have been perfect for my alert rule), I was surprised to find out that the receiver seems to do precisely <em>nothing</em>.</p><h2 id="conclusions"><a aria-label="Link to section" href="#conclusions"><svg width="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="tag"><path id="tag_2" fill-rule="evenodd" clip-rule="evenodd" d="M11.01 4.00146L10.5096 7.99996H14.4917L14.992 4.00146H17.01L16.5096 7.99996H20V9.99996H16.2593L15.7587 14H20V16H15.5084L15.0072 20.0051L12.99 20L13.4906 16H9.5084L9.00716 20.0051L6.99 20L7.49055 16H4V14H7.74083L8.24139 9.99996H4V7.99996H8.49166L8.99203 4.00146H11.01ZM13.7408 14L14.2414 9.99996H10.2593L9.7587 14H13.7408Z" fill="currentColor"></path></g></svg>Conclusions</a></h2><p>Setting up a Minecraft server and monitoring it with OpenTelemetry, a Prometheus exporter and Dash0 was a really fun project. Having an excuse to dust off my Java and Linux sysadmin muscles was very welcome.</p><p>I could have spent more time on the setup, and come up with dashboards. But honestly, that is not the important bit to me: if the server is up, I’ll be busy playing. So, instead of a dashboard, I did this:</p><section data-layout="aligned"><div id="image-30cef68f65122e9b0e2126d915222e1651ee85cc-1999x1246-jpg"><a href="https://cdn.sanity.io/images/rdn92ihu/production/30cef68f65122e9b0e2126d915222e1651ee85cc-1999x1246.jpg?w=1999&amp;h=1246&amp;fit=max&amp;auto=format" data-pswp-width="1999" data-pswp-height="1246" target="_blank" rel="noreferrer"><figure><img alt="" loading="lazy" width="1999" height="1246" decoding="async" data-nimg="1" srcset="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Frdn92ihu%2Fproduction%2F30cef68f65122e9b0e2126d915222e1651ee85cc-1999x1246.jpg%3Fw%3D1999%26h%3D1246%26fit%3Dmax%26auto%3Dformat&amp;w=2048&amp;q=100 1x, /_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Frdn92ihu%2Fproduction%2F30cef68f65122e9b0e2126d915222e1651ee85cc-1999x1246.jpg%3Fw%3D1999%26h%3D1246%26fit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=100 2x" src="https://www.dash0.com/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Frdn92ihu%2Fproduction%2F30cef68f65122e9b0e2126d915222e1651ee85cc-1999x1246.jpg%3Fw%3D1999%26h%3D1246%26fit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=100"/></figure></a></div><span><span><em>This is what time well spent looks like.</em></span></span></section></section><!--$--><section id="sources"><h3>Sources</h3><div id="sources"><div><p>https://github.com/dash0hq/minecraft-server</p></div></div></section><!--/$--></div></div>
  </body>
</html>
