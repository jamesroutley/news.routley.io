<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://duskos.org/">Original</a>
    <h1>Dusk OS: 32-bit Forth OS. Useful during first stage of civilizational collapse</h1>
    
    <div id="readability-page-1" class="page">

<p>Dusk OS is a 32-bit Forth and big brother to <a href="http://collapseos.org">Collapse OS</a>. Its
<a href="https://git.sr.ht/~vdupras/duskos/tree/master/fs/doc/design/purpose.txt">primary purpose</a> is to be maximally useful during the <a href="http://collapseos.org/why.html">first stage of
civilizational collapse</a>, that is, when we can&#39;t produce modern
computers anymore but that there&#39;s still many modern computers still around.</p>
<p>It does so by aggressively prioritizing <a href="https://git.sr.ht/~vdupras/duskos/tree/master/fs/doc/design/simple.txt">simplicity</a> at the cost of
<a href="https://git.sr.ht/~vdupras/duskos/tree/master/fs/doc/design/limits.txt">unorthodox constraints</a>, while also aiming to make
<a href="https://git.sr.ht/~vdupras/duskos/tree/master/fs/doc/design/shell.txt">operators happy</a>.</p>
<p>Dusk OS innovates by having an <a href="https://git.sr.ht/~vdupras/duskos/tree/master/fs/doc/cc/index.txt">&#34;almost C&#34; compiler</a> allowing it to
piggy-back on UNIX C code, through a modest <a href="https://git.sr.ht/~vdupras/duskos/tree/master/fs/doc/design/port.txt">porting effort</a>, to reach
its goals and stay true to its design constraints with a minimal effort.</p>
<p><a href="https://vimeo.com/800710912">Video showcasing Dusk OS</a></p>
<h2>Why build this OS?</h2>
<p>Most modern operating systems can do whatever we want them to do. Why do we
need another one? Simplicity.</p>
<p>It&#39;s difficult to predict post-collapse conditions, but we can suppose that
many <a href="#operator">operators</a> will need to use their machines in novel and
creative ways. Hackability of the operating system then becomes paramount. Open
source modern operating systems all can be modified to fit its user&#39;s needs,
but their complexity limits the likelihood that the user is able to do so. A
simpler OS increases this likelihood.</p>
<p>But we can&#39;t have our cake and eat it too, right? Either you have a simple toy
OS or a complex one. Well, maybe not?</p>
<p>Its authors believe that in the history of computing, Forth has been
under-explored. Its approach to simplicity is, we think, revolutionary. It
has significant shortcomings when system specifications become more complex
(Forth hates complexity and doesn&#39;t manage it well), but we believe it
possible to elegantly marry it with languages that like complexity better.</p>
<p>This mix, we believe, could provide the operator with computing powers rarely
seen with other approaches. We&#39;ve got to try it.</p>
<p>To be clear: this is a research project, we don&#39;t know what it will yield
beforehand. We have the intuition that it might lead to a big &#34;ah ah!&#34; moment
and reveal a breathtaking combination of power and simplicity.</p>
<h2>Features making Dusk OS special</h2>
<h3>A whole OS built from source on boot</h3>
<p>One thing that makes Dusk OS special is that it boots from a very tiny core
(1000 lines of i386 assembly). From this tiny core, on boot, it builds its way
up to a system that has a functional C compiler, which then allows it to
bootstrap itself some more.</p>
<p>With regards to &#34;source bootstrapping&#34;, it&#39;s even more extreme than Collapse OS
because modern machines allows this process to run quickly and the whole
process is still faster than a regular Linux boot. On Collapse OS target
machines, this process would be prohibitive, so a bigger part of the OS is
cross-compiled into the kernel.</p>
<p>This peculiarity of Dusk OS has interesting properties. The nicest one, in my
humble opinion, is that this allows us to sidestep the <em>entire</em> problems of
binary compatibility and relocation and only deal with source compatibility.
So, no ELF, no binutils, only code that is designed to run from where it was
generated in the first place. This is so much simpler!</p>
<p>Object files? Global symbols? Nah. C functions that don&#39;t have a static storage
type are simple Forth words.</p>
<h3>Harmonized Assembly Layer</h3>
<p>Dusk features what we call the <a href="https://git.sr.ht/~vdupras/duskos/tree/master/fs/doc/hal.txt">Harmonized Assembly Layer</a> (HAL for short).
This is a cross-CPU assembler, on which the C compiler relies, which prioritizes
implementation and usage simplicity, but is also designed to generate efficient
native code.</p>
<h3>Shortest path to self-hosting for an &#34;almost C&#34; compiler</h3>
<p>Dusk OS self-hosts in about 1000 lines of assembly and a few hundred lines of
Forth (the exact number depends on the target machine). From there, it
bootstraps to DuskCC, which is roughly 1500 lines of Forth code. To my
knowledge, Dusk OS is unique in that regard.</p>
<p>You can pick any C compiler that requires POSIX and it will automatically
require order of magnitudes more lines of code to bootstrap because you need
that POSIX system in addition to the C compiler. So even if you pick a small C
compiler such as tcc, you still need a POSIX system to build it, which is
usually in the millions of LOCs. </p>
<p>To be fair, Dusk OS is not the first project thinking of optimizing that path.
<a href="https://github.com/fosslinux/live-bootstrap">Efforts at making our modern software world bootstrappable</a>
lead to an &#34;almost C&#34;, <a href="https://git.sr.ht/~oriansj/M2-Planet">M2-Planet</a> with a feature set comparable to
DuskCC with very few lines of code. M2-Planet itself is about 5K lines of code
and the various stages that lead to it are generally a few hundred lines each.
The project initially ran on top of regular kernels (as in &#34;fat kernels with
lots of code&#34;), but some bare metal stages (<a href="https://github.com/ironmeld/builder-hex0">1</a>,
<a href="https://git.stikonas.eu/andrius/stage0-uefi">2</a>) were created and now this little chain end up being
comparable to Dusk in terms of lines of code. Still more than Dusk, but in the
same ballpark.</p>
<p>Although this path is short and technically leads you to an &#34;almost C&#34;
compiler, you can hardly use it because it has no &#34;real kernel&#34; (those bare
metal stages mentioned above are enough to compile M2-Planet, but really not
much else, they&#39;re extremely limited) and no shell. You&#39;ll need those if you
want to use your shiny compiler.</p>
<p>One of your best picks, should you try this path, would be <a href="https://www.fiwix.org">Fiwix</a>, a
minimal POSIX i386 kernel weighting less than 50K lines of C+asm. But then,
M2-Planet is not enough. You need to compile tcc (which M2-Planet can compile
after having applied a few patches) which weights 80K. Userspace is worse.
Bash+coreutils are 400K, even busybox is 190K. We still end up with a pretty
minimal and simple system, but it&#39;s still a lot more code than Dusk.</p>
<p>So, unless someone tells me about some option I don&#39;t know about, DuskCC is
quite innovative on the aspect of self-hosting path length.</p>

<h2>Who is Dusk for?</h2>
<p>Dusk OS doesn&#39;t have users, but <em>operators</em>. What&#39;s the difference? Control.
You <em>use</em> a phone, you <em>use</em> a coffee machine, hell you even <em>use</em> a car these
days. But you <em>operate</em> a bulldozer, you <em>operate</em> a crane, you <em>operate</em> a
plane.</p>
<p>You <em>use</em> Linux, you <em>use</em> Windows. You <em>operate</em> Dusk OS.</p>
<p>Can you <em>operate</em> Linux? Sure, if you&#39;re some kind of god<sup id="fnref:1"><a href="#fn:1">1</a></sup>, in the same way
that you can <em>operate</em> a Tesla if you&#39;re a top Tesla engineer. But you&#39;re much
more likely to be able to <em>operate</em> a landmower than a Tesla.</p>
<p>The Dusk operator is someone who&#39;s <a href="http://collapseos.org/why.html#creative">creative</a>, close to hardware, can
read a datasheet. Dusk shines when one wants to poke around the hardware
without limit.</p>
<p>It compares favorably to other more complete OSes because there&#39;s no concurrent
process to mess with your poking and the driver structure is more approachable,
hackable due to its stricter scope and savvier target audience.</p>
<p>Let&#39;s use an example. Let&#39;s say you&#39;re on a notebook that runs on a chipset of
Intel&#39;s ICHn family. You read the datasheet and see &#34;oh, nice, there&#39;s an SPI
interface in there. Maybe that it&#39;s not hooked to anything on the notebook,
let&#39;s play with it.&#34;</p>
<p>Now, that chipset is very, very central to the computer. There are good chances,
on a BSD or Linux system, that if you begin poking around its registers, you&#39;ll
step on someone else toes and crash the system because, for example, of some
other process that needed to read from disk at the same time.</p>
<p>In Dusk, you could completely break the SATA controller, you&#39;ll still be golden
as long as you don&#39;t access mass storage. Because Dusk doesn&#39;t have
concurrency, you have tight control over what happen or doesn&#39;t happen on the
machine, so all you need to do is to avoid words that access mass storage. That
gives you ample wiggling space for your hacking session.</p>
<p>To be clear: this is also possible with a custom made BSD or Linux, but you&#39;re
going to have to strip a lot of pieces from your distro before you get there
and some of those pieces might be useful debugging tools which will be
difficult to retrofit because they need a wider system. You&#39;ll also need a
higher cognitive space to fit BSD/Linux wider abstractions in your mind.</p>
<h2>Status</h2>
<ul>
<li>Has a VM written in C, buildable from a POSIX environment, which allows Dusk
  to build itself for any of its supported targets.</li>
<li>Has an <a href="https://git.sr.ht/~vdupras/duskos/tree/master/fs/doc/cc/index.txt">&#34;almost C&#34; compiler</a> which still needs some work, but is
  already capable of compiling a nice subset of C.</li>
<li>Can run on i386 and ARM. <a href="https://git.sr.ht/~vdupras/duskos/tree/master/HARDWARE.md">Detailed list of supported hardware.</a></li>
<li>Can read, write and boot from FAT12/FAT16 (no FAT32 for now) volumes.</li>
<li>Can create new FAT12/FAT16 volumes.</li>
<li>Very small footprint. In Grid mode (TUI mode) with the Grid text editor
  and DuskCC (including its stdlib) loaded, Dusk uses 180KB of RAM on a PC.</li>
<li>It completely self-hosts on all its target machines. (Well, only PC at this
  point because the ARM port is still a WIP, but it <em>will</em> self-host)</li>
<li>Simple and terse. The core system (all kernels, drivers, filesystems, CC,
  core libraries) is less than 9K lines of code.</li>
<li>Since <code>text/ed</code> has reached a usable status, the main author of Dusk has been
  developing it from within itself on an old Pentium 75 Mhz with 16mb of RAM and
  he&#39;s having a blast.</li>
</ul>
<p>List of ported codebases:</p>
<ul>
<li>The <a href="https://wiki.xxiivv.com/site/uxn.html">uxn</a> VM</li>
<li>The <code>puff()</code> algorithm from <a href="https://github.com/madler/zlib">zlib</a></li>
<li>The <a href="https://git.sr.ht/~rabbits/left">left</a> text editor. (Still a bit glitchy...)</li>
</ul>
<p>List of homegrown applications:</p>
<ul>
<li>C Compiler (see <code>doc/cc</code>)</li>
<li>Text editor (see <code>doc/text/ed</code>)</li>
</ul>
<h2>Funding</h2>
<p>You are inspired by Dusk OS and would like to fund its development? I don&#39;t do
any kind of crowdfunding, but if you happen to be a rich philanthropist, <a href="https://duskos.org/funding.html">maybe
we can do something</a>. </p>
<h2>Resources</h2>
<ul>
<li><a href="https://sr.ht/~vdupras/duskos">Source code repository</a></li>
<li><a href="https://git.sr.ht/~vdupras/duskos/tree/master/fs/doc/index.txt">Documentation</a></li>
<li><a href="https://git.sr.ht/~vdupras/duskos/tree/master/ROADMAP.md">Roadmap</a></li>
<li><a href="https://duskos.org/discuss.html">Mailing list</a></li>
<li><a href="https://tumbleforth.hardcoded.net">Tumble Forth, a Forth vulgarization blog</a></li>
<li><a href="https://alexw.nyc/tech/duskos-1.html">Alex&#39;s Dusk OS tutorial</a></li>
</ul>


</div>
  </body>
</html>
