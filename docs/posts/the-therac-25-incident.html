<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://thedailywtf.com/articles/the-therac-25-incident">Original</a>
    <h1>The Therac-25 Incident</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
            <blockquote>
<p>A few months ago, someone noted in the comments that they hadn&#39;t heard about the Therac-25 incident. I was surprised, and went off to do an informal survey of developers I know, only to discover that only about half of them knew what it was without searching for it.</p>
</blockquote>
<p>When you&#39;re strapping a patient to an electron gun capable of delivering a 25MeV particle beam, <em>following procedure</em> is vitally important. The technician operating the Therac-25 radiotherapy machine at the East Texas Cancer Center (ETCC) had been running this machine, and those like it, long enough that she had the routine down.</p>
<p>On March 21, 1986, the technician brought a patient into the treatment room. She checked their prescription, and positioned them onto the bed of the Therac-25. Above the patient was the end-point of the emitter, a turntable which allowed her to select what kind of beam the device would emit. First, she set the turntable to a simple optical laser mode, and used that to position the patient so that the beam struck a small section of his upper back, just to one side of his spine.</p>
<p><a href="https://commons.wikimedia.org/wiki/File:Therac_25_54.gif#/media/File:Therac_25_54.gif"><img itemprop="image" src="https://upload.wikimedia.org/wikipedia/commons/d/d6/Therac_25_54.gif" alt="Therac 25 54.gif" width="640" height="360"/></a></p>
<p>With the patient in the correct position, she rotated the turntable again. There were two other positions. One would position an array of magnets between the beam and the patient; these would shape and aim the beam. The other placed a block of metal between the beam and the patient. When struck by a 25MeV beam of electrons, the metal would radiate X-rays.</p>
<p>This patient&#39;s prescription was for an electron beam, so she positioned the turntable and left the room. In the room next door, shielded from the radiation, was the control terminal. The technician started keying in the prescription to begin the treatment.</p>
<p>If things were <em>exactly</em> following the routine, she&#39;d be able to communicate with the patient via an intercom, and monitor the patient via a video camera. Sadly, that system had broken down today. Still, this patient had already had a number of treatments, so they knew what to expect, so that communication was hardly necessary. In fact, the Therac-25 and all the supporting equipment were always finicky, so &#34;something doesn&#39;t work&#34; practically <em>was</em> part of the routine.</p>
<p>The technician had run this process so many times she started keying in the prescription. She&#39;d become an extremely fast typist, at least on this device, and perhaps <em>too</em> fast. In the field for beam type, she accidentally keyed in &#34;X&#34;, for &#34;x-ray&#34;. It was a natural mistake, as most patients got x-ray treatments, and it wasn&#39;t much of a problem: the computer would see that the turntable was in the wrong position and refuse to dose the patient. She quickly tapped the &#34;UP&#34; arrow on the keyboard to return to the field, corrected the value to &#34;E&#34;, for electron, and confirmed the other parameters.</p>
<p>Her finger hovered over the &#34;B&#34; key on the keyboard while she confirmed her data entry. Once she was sure everything was correct, she pressed &#34;B&#34; for &#34;beam start&#34;. There was no noise, there never was, but after a moment, the terminal read: &#34;Malfunction 54&#34;, and then &#34;Treatment Pause&#34;.</p>
<p>Error codes were no surprise. The technicians kept a chart next to the console, which documented all the error codes. In this case, &#34;Malfunction 54&#34; meant a &#34;dose input 2&#34; error.</p>
<p>That may not have explained anything, but the technician was used to the error codes being cryptic. And this was a &#34;treatment pause&#34;, which meant the next step was to resume treatment. According to the terminal, no radiation had been delivered yet, so she hit the &#34;P&#34; key to unpause the beam.</p>
<p>That&#39;s when she heard the screaming.</p>
<p>The patient had been through a number of these sessions already, and knew they shouldn&#39;t feel a thing. The first time the technician activated the beam, however, he felt a burning sensation, which he later described like &#34;hot coffee&#34; being poured on his back. Without any intercom to call for help, he started to get off the treatment table. He was still extricating himself, screaming for help, when the technician unpaused the beam, at which point he felt something like a massive electric shock.</p>
<p>That, at first, was the diagnosis. A malfunction in the machine must have delivered an electric shock. The patient was sent home, and the hospital physicist examined the Therac-25, confirming everything was in working order and there were no signs of trouble. It didn&#39;t seem like it would happen again.</p>
<p>The patient had been prescribed a dose of 180 rads as part of a six-week treatment program that would deliver 6,000 rads in total. According to the Therac-25, the patient had received an <em>underdose</em>, a fraction of that radiation. No one knew it yet, but the malfunction had actually delivered between 16,000 and 25,000 rads. The patient seemed fine, but in fact, they were already dead and no one knew it yet.</p>
<hr/>
<p>The ETCC incident was not the first, and sadly was not the last malfunction of the Therac-25 system. Between June 1985 and July 1987, there were six accidents involving the Therac-25, manufactured by Atomic Energy Canada Limited (AECL). Each was a severe radiation overdose, which resulted in serious injuries, maimings, and deaths.</p>
<p>As the first incidents started to appear, no one was entirely certain what was happening. Radiation poisoning is hard to diagnose, especially if you don&#39;t <em>expect</em> it. As with the ETCC incident, the machine reported an underdose despite overdosing the patient. Hospital physicists even contacted AECL when they suspected an overdose, only to be told such a thing was impossible.</p>
<p>A few weeks later, there was a <em>second</em> overdose at ETCC, and it was around that time that the FDA and the press started to get involved. Early on, there was a great deal of speculation about the cause. Of interest is <a href="https://catless.ncl.ac.uk/Risks/3/11#subj1.1">this comment</a> from the RISKS mailing list from 1986.</p>
<blockquote>
<p>Here is my speculation of what happened: I suspect that the current in the electron beam is probably much greater in X-ray mode (because you want similar dose rates in both modes, and the production of X-rays is more indirect).  So when you select X-rays, I&#39;ll bet the target drops into place and the beam current is boosted.  I suspect in this case, the currentwas boosted before the target could move into position, and a very high current electron beam went into the patient.</p>
</blockquote>
<blockquote>
<p>How could this be allowed to happen?  My guess is that the software people would not have considered it necessary to guard against this failure mode. Machine designers have traditionally used electromechanical interlocks to ensure safety.  Computer control of therapy machines is a fairly recent development and is layered on top of, rather than substituting for, the old electromechanical mechanisms.</p>
</blockquote>
<hr/>
<p>The Therac-25 was the first <em>entirely</em> software-controlled radiotherapy device. As that quote from Jacky above points out: most such systems use hardware interlocks to prevent the beam from firing when the targets are not properly configured. The Therac-25 did not.</p>
<p>The software included a number of key modules that ran on a PDP-11. First, there were separate processes for handling each key function of the system: user input, beam alignment, dosage tracking, etc. Each of these processes was implemented in PDP-11 Assembly. Governing these processes was a real-time OS, <em>also</em> implemented in Assembly. All of this software, from the individual processes to the OS itself, were the work of a single software developer.</p>
<p>AECL had every confidence in this software, though, because it wasn&#39;t <em>new</em>. The earliest versions of the software appeared on the Therac-6. Development started in 1972, and the software was adapted to the Therac-25 in 1976. The same core was also used on the Therac-20. Within AECL, the attitude was that the software <em>must</em> be safe because they&#39;d been using it for so long.</p>
<p>In fact, when AECL performed their own internal safety analysis of the Therac-25 in 1983, they did so with the following assumptions:</p>
<blockquote>
1) Programming errors have been reduced by extensive testing on a hardware simulator, and under field conditions on teletherapy units. Any residual software errors are not included in the analysis.
2) Program software does not decay due to wear, fatigue, or reproduction errors.
3) Computer software errors are caused by faulty hardware components, and &#34;soft&#34; (random) errors induced by alpha particles or electromagnetic noise.
</blockquote>
<p>In other words: we&#39;ve used the software for a long time and software always copies and deploys perfectly. So, any bugs we see would have to be transient bugs caused by radiation or hardware errors.</p>
<hr/>
<p>After the second incident at ETCC, the hospital physicist took the Therac-25 out of service and worked with the technician to replicate the steps that caused the overdose. It wasn&#39;t easy to trigger the &#34;Malfunction 54&#34; error message, especially when they were trying to methodically replicate the exact steps, because as it turned out, if you entered the data <em>slowly</em>, there were no problems.</p>
<p>To trigger the overdose, you needed to type quickly, the kind of speed that an experienced operator might have. The physicist practiced until he could replicate the error, then informed AECL. While he was taking measurements to see how large the overdoses were, AECL called back. They couldn&#39;t replicate the issue. &#34;It works on my machine,&#34; essentially.</p>
<p>After being coached on the required speed, the AECL technicians went back to it, and confirmed that they could trigger an overdose. When the hospital physicist took measurements, they found roughly 4,000 rads in the overdose. AECL, doing similar tests, triggered overdoses of 25,000 rads. The reality is that, depending on the timing, the output was potentially random.</p>
<p>With that information, the root cause was easier to understand: there was a race condition. Specifically, when the technician mistyped &#34;X&#34; for x-ray, the computer would calculate out the beam activation sequence to deliver a high-energy beam to create x-rays. When the technician hit the &#34;UP&#34; arrow to correct their mistake, it <em>should&#39;ve</em> forced a recalculation of that activation sequence—but if the user typed too quickly, the UI would update and the recalculation would never happen.</p>
<hr/>
<p>By the middle of 1986, the Food and Drug Administration (FDA) was involved, and demanded that AECL provide a Corrective Action Plan (CAP). What followed was a lengthy process of revisions as AECL would provide their CAP and the FDA would follow up with questions, resulting in new revisions to the CAP.</p>
<p>For example, the FDA reviewed the first CAP revision and noted that it was incomplete. Specifically, it did not include a test plan. AECL responded:</p>
<blockquote>
<p>no single test plan and report exists for the software since both hardware and software were tested and exercised separately together for many years.</p>
</blockquote>
<p>The FDA was not pleased with that, and after more back and forth, replied:</p>
<blockquote>
<p>We also expressed our concern that you did not intend to perform the [test] protocol to future modifications to the software. We believe that rigorous testing must be performed each time a modification is made to ensure the modification does not adversely affect the safety of the system.</p>
</blockquote>
<p>While AECL struggled to include complex tasks like <em>testing</em> in their CAP, they had released instructions that allowed for a temporary fix to prevent future incidents. Unfortunately, in January, 1987, there was another incident, caused by a <em>different</em> software bug.</p>
<p>In this bug, there was a variable shared by multiple processes, meant as a flag to decide whether or not the beam collimator in the turntable needs to be checked to ensure everything is in the correct position. If the value is non-zero, the check needs to be performed. If the value is zero, it does not. Unfortunately, the software would <em>increment</em> the field, and the field was only one byte wide. This meant every 256th increment, the variable would be zero when it should have been non-zero. If that incorrect zero lined up with an operator action, the beam would fire at full energy without the turntable in the right position.</p>
<p>AECL had a fix for that (stop incrementing and just set the value), and amended their CAP to include that fix. The FDA recognized that was probably going to fix the problem, but still had concerns. In an internal memo:</p>
<blockquote>
<p>We are in the position of saying that the proposed CAP can reasonably be expected to correct the deficiencies for which they were developed (Tyler). We cannot say that we are [reasonably] confident about the safety of the entire system…</p>
</blockquote>
<p>This back-and-forth continued through a number of CAP revisions. At each step in the process, the FDA found issues with testing. AECL&#39;s test process up to this point was simply to run the machine and note if anything went wrong. Since the software had been in use, in some version, for over a decade, they did not see any reason to test <em>the software</em>, and thus had no capacity or plan for actually testing the software when the FDA required it.</p>
<p>The FDA, reviewing some test results, noted:</p>
<blockquote>
<p>Amazingly, the test data presented to show that the software changes to handle the edit problems in the Therac-25 are appropriate prove the opposite result. … I can only assume the fix is not right, or the data were entered incorrectly.</p>
</blockquote>
<hr/>
<p>Eventually, the software <em>was</em> fixed. Legislative and regulatory changes were made to ensure incidents like this couldn&#39;t happen in the future, at least not the same way.</p>
<p>It&#39;s worth noting that there was <em>one developer</em> who wrote all of this code. They left AECL in 1986, and thankfully for them, no one has ever revealed their identity. And while it may be tempting to lay the blame at their feet—they made every technical choice, they coded every bug—it would be wildly unfair to do that.</p>
<p>With AECL&#39;s continued failure to explain how to <em>test</em> their device, it should be clear that the problem was a <em>systemic</em> one. It doesn&#39;t matter how good your software developer is; software quality doesn&#39;t appear because you have good developers. It&#39;s the end result of a process, and that process informs both your software development practices, but also your testing. Your management. Even your sales and servicing.</p>
<p>While the incidents at the ETCC finally drove changes, they <em>weren&#39;t</em> the first incidents. Hospital physicists had already reported problems to AECL. At least one patient had already initiated a lawsuit. But that information didn&#39;t propagate through the organization; no one put those pieces together to recognize that the device was faulty.</p>
<p>On this site, we joke a lot at the expense of the <a href="https://thedailywtf.com/articles/The_Brillant_Paula_Bean">Paula Bean</a>s and <a href="https://thedailywtf.com/articles/coming-to-grips">Roy</a>s of this world. But no matter how incompetent, no matter how reckless, no matter how ignorant the antagonist of a TDWTF article may be, they&#39;re part of a system, and that system <em>put them</em> in that position.</p>
<p>Failures in IT are rarely <em>individual</em> failures. They are process failures. They are systemic failures. They are organizational failures. The story of AECL and the Therac-25 illustrates how <em>badly</em> organizational failures can end up.</p>
<p>AECL did not have a software process. They didn&#39;t view software as anything more than a component of a larger whole. In that kind of environment, working on safety critical systems, <em>no</em> developer could have been entirely successful. Given that this was a situation where <em>lives</em> were literally on the line, building a system that produced safe, quality software seems like it should have been a priority. It wasn&#39;t.</p>
<p>While the Therac-25 incident is ancient history, software has become even more important. While we would hope safety-critical software has rigorous processes, we know that isn&#39;t always true. <a href="https://www.theregister.com/2020/04/09/boeing_737_max_software_fixes/">The 737MAX</a> is an infamous, recent example. But with the importance of software in the modern world, even more trivial software problems can get multiplied at scale. Whether it&#39;s <a href="https://www.datascienceexamples.com/racism-and-gender-bias-in-machine-learning-fixes-not-always-easy/">machine learning reinforcing racism</a>, <!-- I could have grabbed thousands of links there -->social networks <a href="https://hbr.org/2021/01/how-social-medias-obsession-with-scale-supercharged-disinformation">turning into cesspools of disinformation</a> or poorly secured IoT devices <a href="https://www.trendmicro.com/vinfo/us/security/news/internet-of-things/into-the-battlefield-a-security-guide-to-iot-botnets">turning into botnets</a>, our software exists and interacts with the world, and has real world consequences. <!-- Full Life Consequences? https://www.youtube.com/watch?v=OHxyZaZlaOs --></p>
<p>If nothing else, I hope this article makes you think about the <em>process</em> you use to create software. Is the <em>process</em> built to produce quality? What obstacles to quality are there? Is quality a priority, and if not, <em>why</em> not? Does your process consider quality <em>at scale</em>? You may know your software&#39;s failure modes, but do you understand your <em>organization</em>&#39;s failure modes? Its blind spots? The assumptions it makes which may not be valid in all cases? <!-- Not to drift off topic, but one of the most important reasons why we need to encourage diversity in this industry is because the only way to really question assumptions is to *get people involved who don't share those assumptions* --></p>
<hr/>
<p>Let&#39;s return for a moment to the race condition that caused the ETCC incidents. This was caused by users hitting the up arrow too quickly, preventing the system from properly registering their edits. While the FDA CAP process was grinding along, AECL wanted to ensure that people could still use the Therac-25 safely, and that meant publishing quick fixes that users could apply to their devices.</p>
<p>This is the letter AECL sent out to address that bug:</p>
<blockquote>
<p>SUBJECT: CHANGE IN OPERATING PROCEDURES FOR THE THERAC-25 LINEAR ACCELERATOR</p>
</blockquote>
<p>On one hand, this is a simple instruction that would effectively prevent the ETCC incidents from reoccurring. On the other, it&#39;s terrifying to imagine a patient&#39;s life hanging on a ripped up keycap and electrical tape.</p>
<hr/>
<p>This article is intended as a brief summary of the incident. Most of the technical details in this article come from <a href="https://web.archive.org/web/20041128024227/http://www.cs.umd.edu/class/spring2003/cmsc838p/Misc/therac.pdf">this detailed account</a> of the Therac-25 incident. That is <em>the</em> definitive source on the subject, and I recommend reading the whole thing. It contains much more detail, including deeper dives into the software choices and organizational failures.</p>
<!-- Easy Reader Version: everyone in this industry should know this story --><p><img src="https://thedailywtf.com/images/inedo/buildmaster-icon.png"/> [Advertisement] 
	<a href="https://inedo.com/BuildMaster?utm_source=tdwtf&amp;utm_medium=footerad&amp;utm_term=2018&amp;utm_content=Confidence&amp;utm_campaign=Buildmaster_Footer">Utilize BuildMaster</a> to release your software with confidence, at the pace your business demands. <a href="https://inedo.com/BuildMaster/download?utm_source=tdwtf&amp;utm_medium=footerad&amp;utm_term=2018&amp;utm_content=Confidence&amp;utm_campaign=Buildmaster_Footer">Download</a> today!  
</p>


        </div></div>
  </body>
</html>
