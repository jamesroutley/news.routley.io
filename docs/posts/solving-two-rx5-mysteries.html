<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.jacobvosmaer.nl/0065-rx5-mysteries/">Original</a>
    <h1>Solving two RX5 mysteries</h1>
    
    <div id="readability-page-1" class="page"><div><p><i><a href="https://blog.glyphdrawing.club/">Jacob Vosmaer&#39;s blog</a></i></p>

<p>2025-12-21</p>

<p>In my <a href="https://blog.glyphdrawing.club/0064-rx5usb-software/">last blog post</a> I wrote about how I made <a href="https://github.com/jacobvosmaer/rx5rom">my own software</a> to program <a href="https://gliglisynth.blogspot.com/">GliGli</a>&#39;s <a href="https://github.com/gligli/rx5usb">RX5USB</a> memory cartridge for the <a href="https://yamahablackboxes.com/collection/yamaha-rx5-drum-machine/">Yamaha RX5 drum machine</a>. There were still some open problems and in this post I will report on my progress addressing those.</p>

<h2>Mystery 1: reversing audio playback sometimes did not work</h2>

<p>The RX5 has a function to play back sounds in reverse. It&#39;s a bit of a gimmick but it sounds cool. Once I got my own software to the point where I could put my own samples on the RX5USB and play them back on the RX5, I was disappointed to discover that in reverse mode, many sounds came out as digital garbage noise. Why was this happening?</p>

<p>I now know this was because I was incorrectly writing the sample end points into the ROM header in the case of 12-bit sample audio. </p>

<blockquote>
  <p>Digital audio data is a stream of numbers. Confusingly both the stream as a whole and the individual numbers get referred to as &#34;samples&#34;. To avoid confusion, I will use the alternative term &#34;word&#34; for the individual numbers in the audio stream.</p>
</blockquote>

<p>The RX5 supports two word sizes (&#34;bit depths&#34;): 8-bit and 12-bit. The 12-bit format is awkward because the memory of the RX5 is organized into 8-bit bytes. If you store 12 bits in 2 bytes (16 bits) then loading the data becomes easy but you waste 4 bits of memory. If you don&#39;t want to waste those 4 bits, you end up storing 2 12-bit words across 3 bytes but this makes loading words awkward. On the RX5 a pair of 12-bit words, say 0x123 0x456, is stored in memory as <code>0x63 0x12 0x45</code>.</p>

<p>If the RX5 has to jump to a specific word in a 12-bit sample then it needs to know if it is landing on an odd or an even word. In principle it could figure it out by dividing the offset from the beginning by 3 and looking at the remainder but apparently that is not what the RX5 does. Instead, the ROM header <a href="https://github.com/jacobvosmaer/rx5rom/blob/9e8ea52c1c093a4353461198bf6fce4ea2a0589a/rx5-build.c#L112-L116">has an extra flag bit set on sample addresses</a> to distinguish even and odd word addresses.</p>

<p>What does this have to do with reversing audio playback? In order to play back in reverse, the RX5 has to jump to the end of the sample. My reversed audio bug was happening for 12-bit samples with an even number of words: these need the flag, but I was never setting it. Only odd length samples would play back correctly in reverse. The even length samples were getting garbled.</p>

<p>I came across this extra bit flag while studying the original Yamaha ROMs, trying to get loop points working for custom samples. Once I noticed the flag I wanted to know what it was for and I eventually found the pattern. When I fixed my code that sets the end address on a custom sample to include the bit flag, that turned out to fix the reverse playback problem.</p>

<p>I still haven&#39;t found a good way to set loop points but now that the end point is set correctly, you can at least loop whole samples with  <code>loop 1</code> in rx5-build.</p>

<h2>Mystery 2: the &#34;unknown&#34; header field</h2>

<p>The hard work of reverse engineering the RX5 ROM format was done by GliGli but he left us a few challenges. This &#34;even address flag&#34; was one of them; I <a href="https://github.com/gligli/rx5usb/blob/f3660a5a9947c54db7efff5203ed77daf0cf5a24/gui_tool/rx5classes.pas#L597-L601">don&#39;t see it</a> anywhere in the original RX5USB software. But a more obvious mystery is the <a href="https://github.com/gligli/rx5usb/blob/f3660a5a9947c54db7efff5203ed77daf0cf5a24/gui_tool/rx5classes.pas#L493">&#34;unknown&#34; header field</a>. GliGli figured out what all the bytes in the RX5 ROM header mean, except one which he labeled as &#34;unknown&#34;.</p>

<p>Looking at the WRC01 Yamaha ROM, the &#34;unknown&#34; field looks somehow correlated with the envelope generator parameters of the voices:</p>

<table>
<caption>Attack Rate, Decay 1 Rate, Decay 1 Level, Decay 2 Rate and Unknown attributes of the voices on the WRC01 cartridge (<a href="https://blog.glyphdrawing.club/font-with-built-in-syntax-highlighting/assets/WRC01A.txt">A</a>, <a href="https://blog.glyphdrawing.club/font-with-built-in-syntax-highlighting/assets/WRC01B.txt">B</a>)</caption>
<tbody>
<tr><th colspan="6">WRC01 A</th><th>     </th><th colspan="6">WRC01 B</th></tr>
<tr><th>Name</th><th>AR</th><th>D1R</th><th>D1L</th><th>D2R</th><th>Unk</th>
<th></th>
<th>Name</th><th>AR</th><th>D1R</th><th>D1L</th><th>D2R</th><th>Unk</th></tr>
<tr>
<td>SD 3  </td><td>99</td><td>24</td><td>59</td><td>42</td><td>31</td>
<td></td>
<td>Gun   </td><td>99</td><td>7</td><td>59</td><td>30</td><td>13</td>
</tr>
<tr>
<td>BD 3  </td><td>99</td><td>39</td><td>59</td><td>53</td><td>29</td>
<td></td>
<td>FMprc1</td><td>99</td><td>28</td><td>58</td><td>33</td><td>23</td>
</tr>
<tr>
<td>CgaHMT</td><td>99</td><td>55</td><td>51</td><td>47</td><td>35</td>
<td></td>
<td>FMprc2</td><td>99</td><td>34</td><td>58</td><td>36</td><td>24</td>
</tr>
<tr>
<td>CgaHOP</td><td>99</td><td>34</td><td>59</td><td>42</td><td>30</td>
<td></td>
<td>FMprc3</td><td>99</td><td>33</td><td>58</td><td>38</td><td>25</td>
</tr>
<tr>
<td>CgaLO </td><td>99</td><td>29</td><td>59</td><td>34</td><td>28</td>
<td></td>
<td>EbassH</td><td>99</td><td>43</td><td>55</td><td>36</td><td>23</td>
</tr>
<tr>
<td>BgoHI </td><td>99</td><td>47</td><td>1</td><td>99</td><td>35</td>
<td></td>
<td>EbassL</td><td>99</td><td>12</td><td>59</td><td>41</td><td>23</td>
</tr>
<tr>
<td>BgoLO </td><td>99</td><td>46</td><td>52</td><td>41</td><td>31</td>
<td></td>
<td>DXorch</td><td>99</td><td>12</td><td>59</td><td>38</td><td>21</td>
</tr>
<tr>
<td>TimblH</td><td>99</td><td>37</td><td>49</td><td>37</td><td>23</td>
<td></td>
<td>DXmrmb</td><td>99</td><td>37</td><td>47</td><td>39</td><td>25</td>
</tr>
<tr>
<td>TimblL</td><td>99</td><td>37</td><td>45</td><td>37</td><td>23</td>
<td></td>
<td>DXclav</td><td>99</td><td>16</td><td>59</td><td>44</td><td>25</td>
</tr>
<tr>
<td>AgoHI </td><td>99</td><td>39</td><td>45</td><td>36</td><td>20</td>
<td></td>
<td>Hey   </td><td>45</td><td>2</td><td>59</td><td>99</td><td>99</td>
</tr>
<tr>
<td>AgoLO </td><td>99</td><td>34</td><td>55</td><td>37</td><td>20</td>
<td></td>
<td>Wao   </td><td>45</td><td>2</td><td>59</td><td>99</td><td>99</td>
</tr>
<tr>
<td>Cuica </td><td>99</td><td>21</td><td>59</td><td>52</td><td>39</td>
<td></td>
<td>Ooo   </td><td>70</td><td>2</td><td>59</td><td>99</td><td>99</td>
</tr>
<tr>
<td>Cstnt </td><td>99</td><td>64</td><td>55</td><td>51</td><td>31</td>
<td></td>
<td></td><td></td><td></td><td></td><td></td><td></td>
</tr>
<tr>
<td>Whstl </td><td>99</td><td>6</td><td>59</td><td>60</td><td>24</td>
<td></td>
<td></td><td></td><td></td><td></td><td></td><td></td>
</tr>
<tr>
<td>Timpn </td><td>99</td><td>16</td><td>59</td><td>30</td><td>13</td>
<td></td>
<td></td><td></td><td></td><td></td><td></td><td></td>
</tr>
<tr>
<td>GlsCsh</td><td>99</td><td>35</td><td>1</td><td>99</td><td>25</td>
<td></td>
<td></td><td></td><td></td><td></td><td></td><td></td>
</tr>
</tbody></table>

<p>But what do these envelope parameters mean, and what is the envelope generator for?</p>

<h3>The RX5 envelope generator</h3>

<p>The RX5 is able to adjust the volume of samples it plays back on the fly using a volume envelope generator. The user can change the envelope parameters for creative effect but the main reason it&#39;s there is because of dynamic range and storage efficiency.</p>

<p>Nowadays sample-playback instruments may contain gigabytes of audio data but an RX5 ROM cartridge can hold only 254KB of audio data (plus 2KB of metadata). The smaller the word size the more audio you can squeeze into that memory. But with low word sizes you get a reduced <a href="https://en.wikipedia.org/wiki/Dynamic_range">dynamic range</a> in your digital audio. As a workaround the RX5 uses samples that have been <a href="https://en.wikipedia.org/wiki/Dynamic_range_compression">compressed</a> to play back at a constant volume, resulting in unnatural sounds with a good signal-to-noise ratio. On playback, the RX5 uses its volume envelope generator to restore a natural volume profile.</p>

<p>As an example, consider the timpani sound from WRC01.</p>

<p><img src="https://blog.glyphdrawing.club/font-with-built-in-syntax-highlighting/assets/timpn-rom.png" alt="Waveform of the WRC01 timpani ROM data"/>
<audio controls="" src="assets/Timpn .wav"></audio></p>

<p>It looks and sounds different when played back by the machine:</p>

<p><img src="https://blog.glyphdrawing.club/font-with-built-in-syntax-highlighting/assets/timpn-recorded.png" alt="Waveform of the WRC01 timpani, recorded out of the RX5"/>
<audio controls="" src="assets/timpn-recorded.mp3"></audio></p>

<p>The envelope generator takes the unnatural, constant loudness sound in ROM and applies a natural sounding fade-out effect to it.</p>

<p>Now we know what the envelope generator is for. How does it work? The manual says:</p>

<p><img src="https://blog.glyphdrawing.club/font-with-built-in-syntax-highlighting/assets/manual-envelope.png" alt="Volume envelope diagram from the RX5 user manual"/></p>

<p>Each sound starts at volume level 0 and rises to full volume at the &#34;attack rate&#34;. Then it decays to an intermediate &#34;decay 1 level&#34; at the &#34;decay 1 rate&#34;. After that it decays to zero at the &#34;decay 2 rate&#34;. If the gate time runs out at some point during the envelope it decays to zero with the &#34;release rate&#34; but in practice this never happens: on the RX5, all the default sounds   set the gate time  to 6.5s and the release rate to 60, which are the maximum values. The  decay 2 stage will  reach 0 before the gate time has elapsed.</p>

<h3>The reverse playback envelope</h3>

<p>What happens during reverse playback? The RX5 manual says the machine will play the audio in reverse, shaped by the normal volume envelope in reverse. On a hunch I decided to see if this is true and surprise surprise, it&#39;s not!</p>

<p>I recorded a number of sounds from the WRC01 cartridge in their normal forward form, and reversed by the RX5. Then in post processing I reversed the reverse playback sounds a second time, so that they run forward again. Here is the double reversed sound next to the original.</p>

<p><img src="https://blog.glyphdrawing.club/font-with-built-in-syntax-highlighting/assets/timpani-reversed.png" alt="Recorded waveforms for the WRC01 timpani sound"/>
<i>Above: normal playback, below: RX5 reversed playback, reversed a second time in Reaper.</i></p>



<p>This shows that reverse playback uses a different envelope from normal playback. Could the &#34;unknown&#34; ROM parameter have to do with this reverse envelope?  </p>

<p>I made a ROM image with 4 times the same 1 second sine wave tone in it. The tone has constant volume. The 4 instances have different &#34;unknown&#34; values: 10, 20, 30 and 40. This is what they looked like when played in reverse on the RX5:</p>

<p><img src="https://blog.glyphdrawing.club/font-with-built-in-syntax-highlighting/assets/sine-tones.png" alt="Sine tones played back by the RX5 in reverse"/>
<i>Four 1-second sine tones with &#34;unknown&#34; set to 10, 20, 30 and 40 respectively.</i></p>

<p>Instead of a constant tone, like the raw audio we put in the ROM, we get a swell. The higher the &#34;unknown&#34; parameter, the faster the swell. This looks like a rate parameter!</p>

<p>The &#34;unknown&#34; field is the attack rate of the reverse playback envelope.</p>

<p>GliGli&#39;s RX5USB software hard-codes the reverse envelope attack rate to 99, the maximum, which makes reversed sounds play back without a swell. This is a good default for custom samples because they usually don&#39;t have the heavy compression of the tail of the sound you see in the original Yamaha samples.</p>

<h2>Conclusion</h2>

<p>Sometimes being stubborn and pedantic pays off.
I think I&#39;m running out of RX5 mysteries. See you next time!</p>
<p>Tags:  <a href="https://blog.glyphdrawing.club/tags/c.html">c</a> <a href="https://blog.glyphdrawing.club/tags/rx5.html">rx5</a></p>
<p><a href="https://blog.glyphdrawing.club/">Index</a> — <a href="mailto:contact@jacobvosmaer.nl">Contact</a></p>

</div></div>
  </body>
</html>
