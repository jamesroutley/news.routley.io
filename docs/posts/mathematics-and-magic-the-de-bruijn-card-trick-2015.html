<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://golem.ph.utexas.edu/category/2015/01/mathematics_and_magic_the_de_b.html">Original</a>
    <h1>Mathematics and Magic: The de Bruijn Card Trick (2015)</h1>
    
    <div id="readability-page-1" class="page"><p>A mathematician hands out a pack of cards to a group of five people. They repeatedly cut the deck and then take a card each. The mathematician tries to use telepathy to divine the cards that the people are holding but unfortunately due to solar disturbances, the mind waves are a bit scrambled and the mathematician has to ask a few questions to help unscramble the images being received. “Who had porridge for breakfast?” “Who is holding a red card?” “Is anyone a Pisces?” “Who has a dog called Stanley?” The answers to these questions are sufficient to allow the mathematician to name the card that each person is holding. The audience applaud wildly.</p><p>I learnt about this trick in a book I got for Christmas.</p><p>The first thing to note is that the authors are both respected mathematicians, so it is perhaps not surprising to learn that the mathematics involved is actually non-trivial. In my undergraduate course on Knots and Surfaces I do a few knot and rope tricks to enliven the lectures and to demonstrate some of the ideas in the course, but these are generally sleight-of-hand tricks unlike the tricks in this book which all have some interesting mathematics underlying them.</p><p>In this post I want to wear my mathematician’s hat and explain how the above card trick is based on the existence of de Bruijn sequences. Of course, if I were wearing my magician’s hat, I wouldn’t be allowed to reveal how the trick works!</p><div id="more">
<p><a href="http://golem.ph.utexas.edu/~distler/blog/mathml.html" onclick="window.open(this.href, &#39;MathML&#39;, &#39;width=310,height=150,scrollbars=no,resizable=yes,status=no&#39;); return false;" onkeypress="if(window.event.keyCode == 13){window.open(this.href, &#39;MathML&#39;, &#39;width=310,height=150,scrollbars=no,resizable=yes,status=no&#39;); return false;}"><img src="https://golem.ph.utexas.edu/~distler/blog/images/MathML.png" alt="MathML-enabled post (click for more details)." title="MathML-enabled post (click for details)."/></a></p>

<h3>The card trick</h3>

<p>The alert amongst you will be guessing that the question “Who is holding a red card?” probably is the key, and indeed it is. The answer to this question contains five bits of information, so might be sufficient to identify one in 32 scenarios. Here’s the first sneaky part: the ‘deck’ only contained 32 cards.</p>

<p>The next sneaky part is that these 32 cards were arranged in an order such that the permutation of red and black cards amongst five consecutive cards uniquely identifies the five cards. The repeated cutting of the deck does not alter this cyclic order.</p>

<p>The final sneaky part is that the mathematician, being a mathematician, rather than memorising the order of the cards, has a cunning algorithm for turning the five bits of information into the suits and values of the five cards.</p>

<p>To explain all of this we need the idea of a de Bruijn sequence.</p>

<h3>De Bruijn sequences</h3>

<p>An <strong>order <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math> de Bruijn sequence on the letters</strong> <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mo stretchy="false">{</mo><msub><mi>a</mi> <mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>a</mi> <mi>k</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{ a_{1},\dots , a_{k}\} </annotation></semantics></math> is a cyclic string of <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><msup><mi>k</mi> <mi>n</mi></msup></mrow><annotation encoding="application/x-tex">k^{n}</annotation></semantics></math> elements from the set <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mo stretchy="false">{</mo><msub><mi>a</mi> <mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>a</mi> <mi>k</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{ a_{1},\dots , a_{k}\} </annotation></semantics></math> such that each length <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math> string of <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math> letters occurs exactly once as consecutive letters in the string.</p>

<p>For example, <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>0011</mn></mrow><annotation encoding="application/x-tex">0011</annotation></semantics></math> is a length <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math> de Bruijn sequence on the letters <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mo stretchy="false">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{ 0,1\} </annotation></semantics></math>, as it has <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>00</mn></mrow><annotation encoding="application/x-tex">00</annotation></semantics></math>, <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>01</mn></mrow><annotation encoding="application/x-tex">01</annotation></semantics></math>, <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math> and <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>11</mn></mrow><annotation encoding="application/x-tex">11</annotation></semantics></math> as its length <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math> substrings — remember we are considering our string as being cyclic, so <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math> is obtained by cycling round to the beginning. However <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>0101</mn></mrow><annotation encoding="application/x-tex">0101</annotation></semantics></math> is not such a de Bruijn sequence as, for instance, <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>00</mn></mrow><annotation encoding="application/x-tex">00</annotation></semantics></math> and <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>11</mn></mrow><annotation encoding="application/x-tex">11</annotation></semantics></math> are not substrings.</p>

<p>Here’s an order five sequence on two letters.
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>00000100101100111110001101110101</mn></mrow><annotation encoding="application/x-tex">
00000100101100111110001101110101
</annotation></semantics></math>
 Each possible string of five letters occurs exactly once in this sequence.</p>

<p>The following theorem shows that such sequences always exist.</p>

<blockquote>
  <p><strong>Theorem.</strong> For each <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math> and <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math> there are <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mo stretchy="false">(</mo><mi>k</mi><mo>!</mo><msup><mo stretchy="false">)</mo> <mrow><msup><mi>k</mi> <mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow></msup><mo stretchy="false">/</mo><msup><mi>k</mi> <mi>n</mi></msup></mrow><annotation encoding="application/x-tex">(k!)^{k^{n-1}}/k^{n}</annotation></semantics></math> distinct order <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math> de Bruijn sequence on <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math> letters.</p>
</blockquote>

<p>The sequences carry de Bruijn’s name because of a 1946 paper but the result he proved there on <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math>-letter sequences had already been proved, and forgotten, 50 years earlier by Flye Sainte Marie. The history is described in</p>

<ul>
<li>N. G. de Bruijn, <a href="http://alexandria.tue.nl/repository/books/252901.pdf">Acknowledgement of Priority to C. Flye Sainte-Marie on the counting of circular arrangements of <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><msup><mn>2</mn> <mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math> zeros and ones that show each <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math>-letter word exactly once</a>, T.H.-Report 75-WSK-06, (1975) Technological University Eindhoven.</li>
</ul>

<h3>Back to the card trick</h3>

<p>Now we can convert our sequence of zeroes and ones to reds and blacks to give us a sequence of playing card colours such that in five consecutive cards the position of the red cards tell you where they come in the sequence.
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>BBBBBRBBRBRRBBRRRRRBBBRRBRRRBRBR</mi></mrow><annotation encoding="application/x-tex">
BBBBBRBBRBRRBBRRRRRBBBRRBRRRBRBR
</annotation></semantics></math>
 We can chose a sequence of cards which match this colour pattern, such as the following.
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>8c Ac 2c 4c As 2d 5c 3s 6d 4s Ah 3d 7c 7s 7h 6h</mtext></mrow><annotation encoding="application/x-tex">
\text {8c Ac 2c 4c As 2d 5c 3s 6d 4s Ah 3d 7c 7s 7h 6h}
</annotation></semantics></math>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>4h 8h Ad 3c 6c 5s 3h 7d 6s 5h 2h 5d 2s 4d 8s 8d</mtext></mrow><annotation encoding="application/x-tex">
\text {4h 8h Ad 3c 6c 5s 3h 7d 6s 5h 2h 5d 2s 4d 8s 8d}
</annotation></semantics></math>
 Here, if it isn’t obvious, ‘A’ stands for ace, whilst ‘c’, ‘s’, ‘d’ and ‘h’ stand for the four suits clubs, spades, diamonds and hearts.</p>

<p>Actually my choice of cards for this sequence of colours was not random, but done so that each length five substring of reds and blacks encodes the first card in the corresponding subsequence of five cards. For instance, if we take the fifth substring, “BRBBR”, this is supposed to encode the fifth card, the ace of spades. We chose the cards to match the colour sequence, so the first B corresponds to colour of the ace of spades. The rest of the coding is similarly simple.</p>

<p>Let’s first convert the substring back to zeroes and ones, as that’s a more natural place to think mathematically: this means BRBBR becomes 01001. The first bit is the colour of the card, as we’ve already noted. The second bit together with the first bit will identify the suit, ordered alphabetically by colour:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>00</mn><mo>=</mo><mtext>clubs</mtext><mo>,</mo><mspace width="0.27778em"></mspace><mn>01</mn><mo>=</mo><mtext>spades</mtext><mo>,</mo><mspace width="0.27778em"></mspace><mn>10</mn><mo>=</mo><mtext>diamonds</mtext><mo>,</mo><mspace width="0.27778em"></mspace><mn>11</mn><mo>=</mo><mtext>hearts</mtext><mo>.</mo></mrow><annotation encoding="application/x-tex">
00 = \text {clubs},\;01 = \text {spades},\; 10 = \text {diamonds},\; 11 = \text {hearts}.
</annotation></semantics></math>
 The final three bits just encoded the card value modulo 8 in binary:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>001</mn><mo>=</mo><mtext>ace</mtext><mo>,</mo><mspace width="0.27778em"></mspace><mn>010</mn><mo>=</mo><mn>2</mn><mo>,</mo><mspace width="0.27778em"></mspace><mn>011</mn><mo>=</mo><mn>3</mn><mo>,</mo><mspace width="0.27778em"></mspace><mi>…</mi><mo>,</mo><mspace width="0.27778em"></mspace><mn>111</mn><mo>=</mo><mn>7</mn><mo>,</mo><mspace width="0.27778em"></mspace><mn>000</mn><mo>=</mo><mn>8</mn><mo>.</mo></mrow><annotation encoding="application/x-tex">
 001 = \text {ace},\; 010 = 2,\; 011=3,\;\dots ,\; 111=7,\;000 = 8.
</annotation></semantics></math>
 Thus 01001, or, BRBBR, gives the ace of spades.</p>

<p>All you need to do now to perform the card trick is take a pack of cards, throw out all of the nines, the tens and the royals, then order the remaining the cards as above. Next you need to memorize the order of these 32 cards(!!). Then you can pass round the cards allowing the audience to cut the deck, thus not altering the cyclic order. When the sequence of red and black cards is revealed to you, you can decode it to learn the first card, and your knowledge of the order allows you to say what the other four cards are as well.</p>

<p>We’ll now see a method that means that you don’t have to memorize the order, just memorize a simple mathematical procedure that can be used to recover the order.</p>

<h3>Linear feedback shift registers</h3>

<p>When the number of letters we are using is prime, some of the de Bruijn sequences can be generated by using so-called ‘linear feedback shift registers’. See</p>

<ul>
<li>Donald E. Knuth, The Art of Computer Programming, <a href="http://www.cs.utsa.edu/~wagner/knuth/">Volume 4A, Combinatorial Algorithms: Part 1</a>, Section 7.2.1.1.</li>
</ul>

<p>If we want to generate a single order <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math> sequence on the letters <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mo stretchy="false">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mi>…</mi><mi>k</mi><mo>−</mo><mn>1</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{ 0,1,\dots k-1\} </annotation></semantics></math>, where <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math> is prime, then we can pick an irreducible polynomial
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>x</mi> <mi>n</mi></msup><mo>−</mo><msub><mi>b</mi> <mi>n</mi></msub><msup><mi>x</mi> <mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><mi>…</mi><mo>−</mo><msub><mi>b</mi> <mn>2</mn></msub><mi>x</mi><mo>−</mo><msub><mi>b</mi> <mn>1</mn></msub><mo>∈</mo><msub><mi>ℤ</mi> <mi>k</mi></msub><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">
x^{n}-b_{n}x^{n-1}-\dots - b_{2}x -b_{1}\in \mathbb{Z}_{k}[x]
</annotation></semantics></math>
 and an initial string of <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math> numbers <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><msub><mi>s</mi> <mn>1</mn></msub><mi>…</mi><msub><mi>s</mi> <mi>n</mi></msub></mrow><annotation encoding="application/x-tex">s_{1}\dots s_{n}</annotation></semantics></math> which isn’t <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>000</mn><mi>…</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">000\dots 0</annotation></semantics></math>. We can then define the next term in the sequence by
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>s</mi> <mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>≔</mo><msub><mi>b</mi> <mn>1</mn></msub><msub><mi>s</mi> <mn>1</mn></msub><mo>+</mo><msub><mi>b</mi> <mn>2</mn></msub><msub><mi>s</mi> <mn>2</mn></msub><mo>+</mo><mi>…</mi><mo>+</mo><msub><mi>b</mi> <mi>n</mi></msub><msub><mi>s</mi> <mi>n</mi></msub><mo>∈</mo><msub><mi>ℤ</mi> <mi>k</mi></msub><mo>.</mo></mrow><annotation encoding="application/x-tex">
s_{n+1}\coloneqq b_{1} s_{1} + b_{2}s_{2} +\dots +b_{n} s_{n}\in \mathbb{Z}_{k}.
</annotation></semantics></math></p>

<p>For instance, we are interested in an order <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math> sequence on <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math> letters. We are going to use the polynomial <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><msup><mi>x</mi> <mn>5</mn></msup><mo>−</mo><msup><mi>x</mi> <mn>2</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x^{5}-x^{2}-1</annotation></semantics></math> which we observe is irreducible in <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><msub><mi>ℤ</mi> <mn>2</mn></msub><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\mathbb{Z}_{2}[x]</annotation></semantics></math>. We will start with the non-zero string <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>00001</mn></mrow><annotation encoding="application/x-tex">00001</annotation></semantics></math>. The algorithm above tells us that the next term is the first term plus the third term mod <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math>, ie. <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>0</mn><mo>+</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">0+0</annotation></semantics></math>, which is <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math>. So our sequence starts <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>000010</mn></mrow><annotation encoding="application/x-tex">000010</annotation></semantics></math>.</p>

<p>We then repeat using <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><msub><mi>s</mi> <mn>2</mn></msub><msub><mi>s</mi> <mn>3</mn></msub><mi>…</mi><msub><mi>s</mi> <mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">s_{2}s_{3}\dots s_{n+1}</annotation></semantics></math> as the string of <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math> letters, so iteratively we define
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>s</mi> <mi>i</mi></msub><mo>≔</mo><msub><mi>b</mi> <mn>1</mn></msub><msub><mi>s</mi> <mrow><mi>i</mi><mo>−</mo><mi>n</mi></mrow></msub><mo>+</mo><msub><mi>b</mi> <mn>2</mn></msub><msub><mi>s</mi> <mrow><mi>i</mi><mo>−</mo><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>…</mi><mo>+</mo><msub><mi>b</mi> <mi>n</mi></msub><msub><mi>s</mi> <mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>∈</mo><msub><mi>ℤ</mi> <mi>k</mi></msub><mo>.</mo></mrow><annotation encoding="application/x-tex">
s_{i}\coloneqq b_{1} s_{i-n} + b_{2}s_{i-n+1} +\dots +b_{n} s_{i-1}\in \mathbb{Z}_{k}.
</annotation></semantics></math>
 Provided that the polynomial we start with is irreducible this results in a sequence which will not repeat until after <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><msup><mi>k</mi> <mi>n</mi></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k^{n}-1</annotation></semantics></math> terms, and every substring of <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math> letters with occur <em>except</em> the trivial one <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>00</mn><mi>…</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">00\dots 0</annotation></semantics></math>. Such a sequence is known as a <strong>punctured</strong> de Bruijn sequence.</p>

<blockquote>
  <p><strong>Puzzle 1.</strong> Why is it necessary and sufficient that the polynomial is irreducible?</p>
</blockquote>

<p>Going back to our example which started <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>000010</mn></mrow><annotation encoding="application/x-tex">000010</annotation></semantics></math> we find that the resulting punctured de Bruijn sequence is
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>0000100101100111110001101110101</mn><mo>.</mo></mrow><annotation encoding="application/x-tex">
0000100101100111110001101110101.
</annotation></semantics></math></p>

<p>Any punctured de Bruijn sequence can be made into a true de Bruijn sequence by simply adding an extra zero into the unique substring of <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math> zeroes. Doing that to the above sequence gives back the de Bruijn sequence we saw much earlier in this post.</p>

<h3>Back to the card trick, again</h3>

<p>Now we can incorporate the linear feedback shift register into the trick. When the order of red and black cards are revealed to you, for instance as BRBBR, you first translate to binary, <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>01001</mn></mrow><annotation encoding="application/x-tex">01001</annotation></semantics></math>, and then to a card value, ace of spades, as before. The difference is that now you can calculate the next card rather than having to remember it.</p>

<p>You add the first and third bits together modulo <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math>, append that to the end of the string and forget the first bit. This gives you <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>10010</mn></mrow><annotation encoding="application/x-tex">10010</annotation></semantics></math> which is the two of diamonds, and you can check that this is indeed the next in the card sequence listed above! You repeat this to obtain the other three cards that are being held by members of the audience.</p>

<p>The astute amongst you will note that our linear feedback shift register algorithm only gives a punctured de Bruijn sequence, so would not include the substring <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>00000</mn></mrow><annotation encoding="application/x-tex">00000</annotation></semantics></math>, which corresponds to the eight of clubs. There are two ways around this.</p>

<ul>
<li><p>Either throw away the eight of clubs and perform the trick with just 31 cards,</p></li>
<li><p>or else remember that between the eight of diamonds <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>10000</mn></mrow><annotation encoding="application/x-tex">10000</annotation></semantics></math> and the ace of clubs <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><semantics><mrow><mn>00001</mn></mrow><annotation encoding="application/x-tex">00001</annotation></semantics></math> comes the eight of clubs.</p></li>
</ul>

<p>I hope you’ve seen how this trick involves some interesting mathematics and you can now go and amaze your friends. I’ll leave you to find out what other interesting applications de Bruijn sequences have. I haven’t got very far in the book of Diaconis and Graham yet, but I’m hoping that it’s all as fun as the bits I’ve read so far.</p>

</div></div>
  </body>
</html>
