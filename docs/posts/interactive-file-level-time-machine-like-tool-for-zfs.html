<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/kimono-koans/httm">Original</a>
    <h1>Interactive, file-level Time Machine-like tool for ZFS</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><p dir="auto"><a href="https://asciinema.org/a/490325" rel="nofollow"><img src="https://camo.githubusercontent.com/7dd44cace2f285aabc9e837171994d8461ed4ea30cfbe3267a46edc1dfb60468/68747470733a2f2f61736369696e656d612e6f72672f612f3439303332352e737667" alt="asciicast" data-canonical-src="https://asciinema.org/a/490325.svg"/></a></p>

<p dir="auto">The dream of a CLI ZFS Time Machine is still alive with <code>httm</code>.</p>
<p dir="auto"><code>httm</code> prints the size, date and corresponding locations of available unique versions (deduplicated by modify time and size) of files residing on ZFS snapshots, but can also be used <em>interactively</em> to select and restore such files.  <code>httm</code> might change the way you use ZFS snapshots (because ZFS isn&#39;t designed for finding for unique file versions) or the Time Machine concept (because <code>httm</code> is very fast!).</p>
<p dir="auto"><code>httm</code> boasts an array of seductive features, like:</p>
<ul dir="auto">
<li>Search for and recursively list all deleted files! Ooooooooo!</li>
<li>List file snapshots from <em>all</em> local pools (<code>httm</code> automatically detects local snapshots <em>as well as</em> locally replicated snapshots)!</li>
<li>List file snapshots from remote backup pools (you may designate replicated remote snapshot directories).</li>
<li>For use with even <code>rsync</code>-ed non-ZFS local datasets (like ext4, APFS, or NTFS), not just ZFS.</li>
<li>Specify multiple files for lookup on different datasets</li>
<li>3 native interactive modes: browse, select and restore</li>
<li>ANSI <code>ls</code> colors from your environment</li>
<li>Non-blocking recursive directory walking (available in all interactive modes)</li>
<li>Select from several formatting styles.  Parseable ... or not ...  oh my!</li>
</ul>
<p dir="auto">Use in combination with you favorite shell (hot keys!) for even more fun.</p>
<p dir="auto">Inspired by the <a href="https://github.com/jimsalterjrs/sanoid">findoid</a> script, <a href="https://github.com/junegunn/fzf">fzf</a> and many <a href="https://www.zsh.org" rel="nofollow">zsh</a> key bindings.</p>
<h2 dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installation</h2>
<p dir="auto">The <code>httm</code> project contains only a few components:</p>
<ol dir="auto">
<li>
<p dir="auto">The <code>httm</code> executable. To build and install:</p>
<div data-snippet-clipboard-copy-content="curl --proto &#39;=https&#39; --tlsv1.2 -sSf https://sh.rustup.rs | sh 
git clone https://github.com/kimono-koans/httm.git
cargo install --path ./httm/"><pre>curl --proto <span><span>&#39;</span>=https<span>&#39;</span></span> --tlsv1.2 -sSf https://sh.rustup.rs <span>|</span> sh 
git clone https://github.com/kimono-koans/httm.git
cargo install --path ./httm/</pre></div>
</li>
<li>
<p dir="auto">The optional <code>zsh</code> hot-key bindings: Use <code>ESC+s</code> to select snapshots filenames to be dropped to your command line (for instance after the <code>cat</code> command), or use <code>ESC+m</code> to browse for all of a file&#39;s snapshots. After you install the <code>httm</code> binary, to copy the hot key script to your home directory, and source that script within your <code>.zshrc</code>:</p>
<div data-snippet-clipboard-copy-content="httm --install-zsh-hot-keys"><pre>httm --install-zsh-hot-keys</pre></div>
</li>
<li>
<p dir="auto">The optional <code>man</code> page: <code>cargo</code> has no native facilities for man page installation (though it may in the future!).  You can use <code>manpath</code> to see the various directories your system uses and decide which directory works best for you.  To install, just copy it to a directory in your <code>man</code> path, like so:</p>
<div data-snippet-clipboard-copy-content="cp ./httm/httm.1 /usr/local/share/man/man1/"><pre>cp ./httm/httm.1 /usr/local/share/man/man1/</pre></div>
</li>
</ol>
<h3 dir="auto"><a id="user-content-caveats" aria-hidden="true" href="#caveats"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Caveats</h3>
<p dir="auto">Right now, you will need to use a Unix-ish-y Rust-supported platform to build and install (that is: Linux, Solaris/illumos, the BSDs, MacOS).  Note, your platform <em>does not</em> need to support ZFS to use <code>httm</code>.  And there is no fundamental reason a non-interactive Windows version of <code>httm</code> could not be built, as it once did build, but Windows platform support is not a priority for me right now.  Contributions from users are, of course, very welcome.</p>
<p dir="auto">On some Linux distributions, which include old versions of <code>libc</code>, <code>cargo</code> may require building with <code>musl</code> instead, see the linked <a href="https://github.com/kimono-koans/httm/issues/17" data-hovercard-type="issue" data-hovercard-url="/kimono-koans/httm/issues/17/hovercard">issue</a>.</p>
<h2 dir="auto"><a id="user-content-example-usage" aria-hidden="true" href="#example-usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Example Usage</h2>
<p dir="auto">Print all local file snapshots of your history file:</p>

<p dir="auto">Create tar archive of all versions of your <code>/var/log/syslog</code>:</p>
<div data-snippet-clipboard-copy-content="httm -n /var/log/syslog | tar -zcvf all-versions-zshrc.tar.gz -T -"><pre>httm -n /var/log/syslog <span>|</span> tar -zcvf all-versions-zshrc.tar.gz -T -</pre></div>
<p dir="auto">Create git archive of all file versions of <code>/etc/sysconfig/iptables</code>:</p>
<div data-snippet-clipboard-copy-content="# create variable for file name
file=&#34;/etc/sysconfig/iptables&#34;
# create git repo
mkdir ./archive-git; cd ./archive-git; git init
# copy each version to repo and commit after each copy
for version in $(httm -n $file); do 
    cp &#34;$version&#34; ./ 
    git add &#34;./$(basename $version)&#34;
    git commit -m &#34;$(stat -c %y $version)&#34;
done
# create git tar.gz archive 
git archive --format=tar.gz -o &#34;../archive-git-$(basename $file).tar.gz&#34; master; cd ../"><pre><span><span>#</span> create variable for file name</span>
file=<span><span>&#34;</span>/etc/sysconfig/iptables<span>&#34;</span></span>
<span><span>#</span> create git repo</span>
mkdir ./archive-git<span>;</span> <span>cd</span> ./archive-git<span>;</span> git init
<span><span>#</span> copy each version to repo and commit after each copy</span>
<span>for</span> <span>version</span> <span>in</span> <span><span>$(</span>httm -n <span>$file</span><span>)</span></span><span>;</span> <span>do</span> 
    cp <span><span>&#34;</span><span>$version</span><span>&#34;</span></span> ./ 
    git add <span><span>&#34;</span>./<span><span>$(</span>basename <span>$version</span><span>)</span></span><span>&#34;</span></span>
    git commit -m <span><span>&#34;</span><span><span>$(</span>stat -c %y <span>$version</span><span>)</span></span><span>&#34;</span></span>
<span>done</span>
<span><span>#</span> create git tar.gz archive </span>
git archive --format=tar.gz -o <span><span>&#34;</span>../archive-git-<span><span>$(</span>basename <span>$file</span><span>)</span></span>.tar.gz<span>&#34;</span></span> master<span>;</span> <span>cd</span> ../</pre></div>
<p dir="auto">Print all files on snapshots deleted from your home directory, recursive, newline delimited, piped to a <code>deleted-files.txt</code> file:</p>
<div data-snippet-clipboard-copy-content="httm -d -n -R --no-live ~ &gt; deleted-files.txt"><pre>httm -d -n -R --no-live <span>~</span> <span>&gt;</span> deleted-files.txt</pre></div>
<p dir="auto">Browse all files in your home directory, recursively, and view versions on local snapshots:</p>

<p dir="auto">Browse all files deleted from your home directory, recursively, and view versions on all local and alternative replicated dataset snapshots:</p>

<p dir="auto">Browse all files in your home directory, recursively, and view versions on local snapshots, to select and ultimately restore to your working directory:</p>

<h2 dir="auto"><a id="user-content-i-know-what-youre-thinking-but-slow-your-roll" aria-hidden="true" href="#i-know-what-youre-thinking-but-slow-your-roll"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>I know what you&#39;re thinking, but slow your roll.</h2>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/f102f04c4749fd407b3333ceffbd6cf374c7d6a2b659cd60c4173e8ddc23e9fa/68747470733a2f2f692e70696e696d672e636f6d2f6f726967696e616c732f32332f37662f32612f32333766326162383736353636336337323133323533363634303631393762372e676966"><img src="https://camo.githubusercontent.com/f102f04c4749fd407b3333ceffbd6cf374c7d6a2b659cd60c4173e8ddc23e9fa/68747470733a2f2f692e70696e696d672e636f6d2f6f726967696e616c732f32332f37662f32612f32333766326162383736353636336337323133323533363634303631393762372e676966" alt="To be clear, httm is not..." data-canonical-src="https://i.pinimg.com/originals/23/7f/2a/237f2ab8765663c721325366406197b7.gif"/></a></p>
<p dir="auto">To be clear, <code>httm</code> is not a H__ T__ T___ M______.</p>
<h2 dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>License</h2>
<p dir="auto">httm is licensed under the MPL 2.0 License - see the LICENSE file for more details.</p>
</article>
          </div></div>
  </body>
</html>
