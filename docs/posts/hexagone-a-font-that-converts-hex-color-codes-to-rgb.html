<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://eieio.games/nonsense/hexagone-converting-hex-to-rgb-with-a-font/">Original</a>
    <h1>Hexagone: a font that converts hex color codes to rgb</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
    <p>So here’s a neat trick:</p>

<div>
    
    <video controls="">
    
        <source src="/assets/images/hexagone/hexagone.mp4" type="video/mp4"/>
    </video>
    
    <p> the font is called hexagone because it gets rid of hex </p>
    
</div>

<p>By changing the font I’m able to automatically convert hex color codes to RGB! What’s going on?
<!-- excerpt-end --></p>


<p>That video might be a little hard to follow - let’s start with a demo so that you can try Hexagone yourself.  Type in any hex color code followed by an equals sign (like <code>#ecd17a=</code>) - it’ll automatically be converted to RGB. There’s no javascript here, just font trickery.</p>

<p>Maybe unsurprisingly this demo is sometimes buggy! Hopefully it worked for you. Let’s get into what’s going on.</p>


<p>Hexagone takes advantage of two powerful features of fonts: <em>ligatures</em> and <em>contextual alternates.</em></p>

<p>We use <em>ligatures</em> to combine multiple glyphs into one. For example, some fonts use ligatures to turn “tt” into a single character with an unbroken horizontal bar that goes through both characters.</p>

<p>We use <em>contextual alternates</em> to swap one glyph out for another one <em>based on the surrounding characters.</em> For example, when you type a fraction like “1/2” some fonts will notice and replace the “1” with a superscript 1, the “2” with a subscript “2”, and the “/” with a more fractiony-looking glyph. You could imagine doing that specific substitution with a ligature (swapping out “1/2” for a single “1/2” glyph) but contextual alternates allow you to more easily generalize that logic across a wide range of fractions.</p>

<p>And those are just some simple and very English-centric examples! I don’t understand the details very well, but I believe that Arabic has whole characters that are swapped out using contextual alternates!</p>

<p>So fonts are powerful because language is powerful and the way that we write language is complicated. But what primitives are actually available?</p>



<p>Hexagone works by chaining a series of replacement operations together. OpenType offers <a href="https://adobe-type-tools.github.io/afdko/OpenTypeFeatureFileSpecification.html#5.a">many alternatives</a> for how to write your replacement operations but ultimately they all come down to “look for a pattern and replace part of that pattern with a different pattern.” Here are some examples</p>

<div><div><pre><code># If a character is followed by a &#39;, that character is targeted 
# for replacement and any characters *without* a &#39; suffix are 
# just for pattern matching.

# Replace all As with Bs
sub a by B;

# Replace all lower case letters with upper-case letters
sub [a - z] by [A - Z];

# Replace two ts with a single &#34;double-t&#34; glyph
sub t t by t_t;

# Replace &#34;A&#34; with &#34;B&#34; - only if the A has a &#34;P&#34; on both sides:
sub P A&#39; P by B;

# Replace f f according to the rules in a table named &#34;HEX_DEC&#34;
sub f&#39; lookup HEX_DEC f&#39;;

# Replace &#34;f f&#34; with 255 - only if it&#39;s preceded by a # 
# and followed by an equals
sub numbersign f&#39; f&#39; equals by two five five;
</code></pre></div></div>

<p>Maybe those last examples give you a sense of how hexagone works - we look for things that look like hex and are surrounded by our activation characters and we swap them out.</p>

<p>Except that I lied to you. That last rule doesn’t work. Font shaping has some more restrictions!</p>



<p>There are two major restrictions I ran into while making hexagone:</p>
<ol>
  <li>Directly substituting multiple glyphs for multiple glyphs isn’t allowed.</li>
  <li>The internal replacement “cursor” always moves forward.</li>
</ol>

<p>1) is probably pretty clear - it’s what prevents that final rule in the last section from working (the error you get is “<em>Direct substitution of multiple glyphs by multiple glyphs is not supported.</em>” ).</p>

<p>2) Might be a little harder to picture. The basic idea is: let’s say that you have the text “ABC” and you’ve just written a rule to replace “B” with “DD” - so now your text is “ADDC.” If you have a rule that looks for “AD” and replaces it with “E” the rule won’t fire - your cursor has already passed that “A” and so you can’t go back and run a replacement on it now<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" rel="footnote">1</a></sup>!</p>

<p>I believe rule 1 exists to ensure that we don’t lose information when converting between fonts, and that rule 2 exists because without it you could easily make a non-halting font (I would love this! but it is probably not a good idea).</p>



<p>However! We can work around both of these problems with a few tricks.</p>

<ul>
  <li>We <em>can</em> replace multiple glyphs with a single glyph, or replace a single glyph with multiple glyphs.</li>
  <li>The ligature and contextual alternate bits of font-shaping run on separate passes</li>
</ul>

<p>And this gives us enough power to create hexagone. The rough logic is:</p>
<ul>
  <li>Make up a single glyph for every pair of two hex digits (from zero_zero to f_f) and stuff them into the font somewhere.</li>
  <li>On the ligature pass, identify groups of hex digits that we want to replace with rgb and replace them with the glyphs that we’ve made up. For example, replace “ef” with the glyph “e_f.”</li>
  <li>On the contextual alternates pass, replace our made-up glyphs with their decimal equivalents. For example, replace “1_a” with “26,” or 26).</li>
</ul>

<p>This ends up looking something like this:</p>
<div><div><pre><code># Character class defining all the glyphs we&#39;ve made up
@mine=[zero_zero zero_one ... f_f];
# Same as @mine but with .end appended
@mineend=[zero_zero.end ... f_f.end];
# Character class that identifies potential hex
@hex=[zero one two ... f]

# Map hex to our glyphs
lookup LIGA_NOTLAST {
   sub zero zero by zero_zero;
   sub zero one by zero_one;
   ...
   sub f e by f_e;
   sub f f by f_f;
} LIGA_NOTLAST;

# The same as liga_notlast but using &#34;.end&#34; glyphs
lookup LIGA_LAST {
    sub zero zero by zero_zero.end
    ...
} LIGA_LAST;

# Map our glyphs back to decimal
lookup HEX_DEC {
   sub zero_zero&#39; by zero comma;
   sub zero_one&#39; by one comma;
   ...
   sub f_e&#39; by two five four comma;
   sub f_f&#39; by two five five comma;
}

# The same as hex_dec but we use a paren instead of a comma.
lookup HEX_DEC_LAST {
   sub zero_zero.end&#39; by zero rightparen;
   ...
} HEX_DEC_LAST;

feature liga {
    sub numbersign @hex&#39; lookup LIGA_NOTLAST @hex&#39; @hex @hex @hex @hex equal;
    sub numbersign @mine @hex&#39; lookup LIGA_NOTLAST @hex&#39;  @hex @hex equal;
    sub numbersign @mine @mine @hex&#39; lookup LIGA_LAST @hex&#39; equal&#39;;
} liga;

feature calt {
    sub numbersign&#39; @mine @mine @mineend by r g b colon parenleft;
    sub @mine&#39; lookup HEX_DEC;
    sub @mineend&#39; lookup HEX_DEC_END;
} calt;

</code></pre></div></div>

<p>And that’s about it! I generated this file via a script and used python <code>fontforge</code> bindings to add the shaping logic to an existing font. You can see the code I wrote for this <a href="https://github.com/nolenroyalty/hexagone">here</a>. Be warned: I wrote it fast and it’s pretty bad!</p>



<p>Well, I don’t think it’s super useful!</p>

<p>I was introduced to the power of fonts back when I saw Tristan Hume’s <a href="https://blog.janestreet.com/commas-in-big-numbers-everywhere/">numderline</a> and when I started at the <a href="https://recurse.com">Recurse Center</a> I thought it might be fun to build a game inside a font.</p>

<p>Recurse recently ran an “impossible stuff day” (roughly a day where you take on an ambitious project that you’re not sure you can actually do) and I decided to spend the day trying to build Hexagone to figure out what a “game in a font” might look like. I picked Hexagone because it seemed challenging and interesting but also tractable, and because I came up with the name and thought it was funny (this was the primary reason).</p>

<p>Building Hexagone ended up being far from impossible, but it didn’t make me particularly excited about going further with a game. But I learned a lot and had a lot of fun!</p>

<p>Maybe Hexagone will inspire you to build your own nonsense font.</p>



<p>As I said above, I would never have come up with this idea without seeing <a href="https://blog.janestreet.com/commas-in-big-numbers-everywhere/">numderline</a> - thanks Tristan!</p>

<p>I built Hexagone at the <a href="https://recurse.com">Recurse Center</a>, a place that is like a writers retreat but for programming. It’s a lovely place to improve as a programmer and also a super supportive environment for odd nonsense like this (if that sounds fun to you you should <a href="https://www.recurse.com/apply">apply!</a>).</p>

<p>I also learned a lot about font stuff from <a href="https://litherum.blogspot.com/2019/03/addition-font.html">this Litherum post about an addition font</a>, <a href="https://tools.aftertheflood.com/sparks/">this info about the sparks font</a>, and <a href="https://ansuz.sooke.bc.ca/entry/131">this post from Matthew Skala</a>. Thanks all!</p>



  </div></div>
  </body>
</html>
