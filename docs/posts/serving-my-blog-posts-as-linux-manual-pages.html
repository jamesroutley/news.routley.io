<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jamesg.blog/2024/02/29/linux-manual-pages/">Original</a>
    <h1>Serving my blog posts as Linux manual pages</h1>
    
    <div id="readability-page-1" class="page"><div id="main">
    	 <!-- This page uses microformats to structure different pieces of information.
    I use h-entry to state this is a post. Any class name that starts with h-, p-, or -e is a microformat.
    By specifying microformats, some web tools can better understand this page. For example, IndieNews can use
    the p-name to figure out the title of the post (without the "| James' Coffee Blog" I add to the <title> tag of my website.
    Learn more about h-entry: https://indieweb.org/h-entry
-->
<article>
	<header>
		
		<p><em>Published on
			<a href="https://jamesg.blog/2024/02"><time datetime="2024-02-29T00:00:00">February 29, 2024</time></a>
			 under the <a href="https://jamesg.blog/category/coding">Coding</a> category. <a onclick="document.getElementsByTagName(&#39;incoming-links&#39;)[0].toggle(); document.getElementsByTagName(&#39;outgoing-links&#39;)[0].toggle();">Toggle Memex mode</a></em></p>
		  
		
		<a href="https://jamesg.blog/assets/manual_example.png"><img src="https://jamesg.blog/assets/manual_example.png" alt=""/></a>
		
		
		
	</header>
	<section>
		<div>
			<p><em>Intended audience: You are likely to enjoy this post the most if you are interested in Linux and/or Linux manual pages, or if you enjoy reading about esoteric programming projects.</em></p>
<p>Linux computers come with pre-installed manual pages that describe how to use specific commands. These pages are readable by typing <code>man &lt;command&gt;</code> into your terminal. For example, you can get the manual for the <code>tac</code> command, which prints out a file in from bottom-to-top by using the command <code>man tac</code>. Some command line software you install adds manual pages, too.</p>
<p>Linux manual pages are formatted using the <code>roff</code> syntax, which you can use to mark up documents. <code>roff</code> was the first typesetting command line software for Unix, developed at Bell Labs. Earlier this week, with a spark for building but no particular idea in mind, I started to think about the Linux manual page. Could I serve my blog posts as Linux manual pages? Herein lay an adventure.</p>
<p>TL;DR: You can request a Linux manual page version of a blog post with the following HTTP request:</p>
<pre><code>
curl -sL -H &#34;Accept: text/roff&#34; https://jamesg.blog/2024/02/28/programming-projects/ &gt; post.page &amp;&amp; man ./post.page
</code></pre>

<h2>Devising the system: Content negotiation</h2>
<p>I had an idea for how I wanted this to work in mind. I wanted a user to be able to request a <code>roff</code> version of a blog post using content negotiation, part of HTTP that lets you specify ixn what format you want a file. For example, you could request an image with an <code>Accept: image/png</code>. This tells a server that, if possible, it should send a PNG file. There are lots of intricacies to content negotiation. You can provide a list of types of content you can accept, and the order in which a server should try to return them</p>
<p>But! That&#39;s a rabbit hole for another day. What&#39;s important here is that an application can ask a server for content in a specific format using a HTTP header.</p>
<p>With content negotiation, I can route requests if a user sends an <code>Accept</code> header. If a user asks for an <code>text/roff</code> document, I could return a manual page that can be opened with the <code>man</code> command.</p>
<h2>Writing the manual pages</h2>
<p>Manual pages use the <code>roff</code>syntax, so I would need to have versions of my blog posts in that format. To do this, I updated my site to generate <code>man</code> pages for each blog post. The template I used to generate the manual page was as follows:</p>
<pre><code>
.TH jamesg.blog 1 &#34;&#34; &#34;jamesg.blog&#34;
.SH TITLE
...
.SH AUTHOR
James&#39; Coffee Blog (https://jamesg.blog)
.SH PUBLISHED
...
.SH POST
...
.SH URL
...
</code></pre>

<p>Here, I set a header with my domain name and create five sections: title, author, published date, the post content, and the URL of the post. The raw content is markdown. This doesn&#39;t always turn out well in a manual as spacing can sometimes be off. But, markdown was more readable than HTML and resulted in less information loss (i.e. titles having no distinction to paragraphs other than being on their own line) than using plain text.</p>
<p>I now had:</p>
<ol>
<li>Properly formatted manual pages, and;</li>
<li>The knowledge that content negotiation could allow someone to request a manual page.</li>
</ol>
<p>Now came the final piece of the puzzle: using content negotiation to facilitate the request for manual pages.</p>
<h2>Requesting a manual page</h2>
<p>You can use the following command to request the <code>roff</code> format of blog posts on this website:</p>
<pre><code>
curl -sL -H &#34;Accept: text/roff&#34; https://jamesg.blog/2024/02/28/programming-projects/ &gt; post.page
</code></pre>

<p>You can then open the result as a Linux manual page:</p>
<pre><code>
man ./post.page
</code></pre>

<p>Let&#39;s talk about how this works!</p>
<p>When a browser makes a request to <code>https://jamesg.blog/2024/02/19/personal-website-ideas/</code>, it asks for the HTML version of the page. In the <code>curl</code> command above, the command asks for the <code>text/roff</code> version. I added a few lines of text in my NGINX configuration to change how the server responds when <code>text/roff</code> is requested for a blog post.</p>
<p>First, I declared a few variables in my <code>/etc/nginx/nginx.conf</code> file that let me raise a flag when a specific content type was identified:</p>
<pre><code>
map $uri $redirect_suffix {
    ~^/(.*)/$   $1;
    default     &#34;&#34;;
}

map $http_accept $redirect_location {
    default &#34;&#34;;
    &#34;~^text/roff&#34; 1;
}
</code></pre>

<p>You can add multiple different redirect locations, but I only need two: the default, and my custom <code>text/roff</code> rule.</p>
<p>In my site NGINX configuration (the file in the <code>/etc/nginx/sites-enabled</code> folder), I used the following code to handle requests differently if a <code>roff</code> page is requested:</p>
<pre><code>
server {
                ...
        location / {
          if ($redirect_location = 1) {
              rewrite ^/(.*)/$ /$1.man last;
          }
            ...
        }
}
</code></pre>

<p>Here, I say: take a URL, and add <code>.man</code> to the end, removing the trailing slash, as long as the <code>Accept: text/roff</code> header is set. This tells NGINX to read from the <code>.man</code> file instead of the <code>index.html</code> file associated with each post on my site.</p>
<p>That is to say you can now read blog posts on this website as a Linux manual page. This was a fun investigation into using content negotiation in NGINX and a reminder of how far we have come with typesetting technology from the command line interfaces to modern-day typesetting software and HTML.</p>
<p><em>Thank you to <a href="https://toddpresta.com/">Todd</a> for providing guidance on setting up my NGINX configuration. Todd&#39;s help was sincerely appreciated!</em></p>
			
		</div>
		
		<p><a href="https://notbyai.fyi/"><img src="https://jamesg.blog/assets/ai.png" alt="Written by human, not by AI"/></a></p>
	</section>
	
	<section>
    <h2>Responses</h2>
    
    <h2>Comment on this post</h2>
    <p>Respond to this post by sending a <a href="https://indieweb.org/Webmention">Webmention</a>.</p>
    <p>Have a comment? Email me at <a href="mailto:readers@jamesg.blog?subject=Serving my blog posts as Linux manual pages">readers@jamesg.blog</a>.</p>  
</section>
</article>
      </div></div>
  </body>
</html>
