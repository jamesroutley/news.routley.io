<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://neugierig.org/software/blog/2023/06/twos-complement.html">Original</a>
    <h1>Finally getting two&#39;s complement</h1>
    
    <div id="readability-page-1" class="page"><div>



<p>Until recently I understood
<a href="https://en.wikipedia.org/wiki/Two%27s_complement">two&#39;s complement</a> as
something like: &#34;the way computers represent negative numbers, chosen to make
the math work out&#34;. If you look at that Wikipedia page there are some recipes,
formulas, and mathematical interpretations but I didn&#39;t have the intuition for
why it works. But now I do, so I&#39;d like to share it with you!</p>
<h2>Unsigned math</h2>
<p>First, here&#39;s a picture representing a perspective on how ordinary unsigned
integers work.</p>
<p><img src="https://neugierig.org/software/blog/2023/06/unsigned.png" width="200" height="200"/></p>
<p>Pictured here are the values held in an unsigned byte laid out on a circle. To
count upwards you go around the circle clockwise, and downwards you go in
reverse. The circle wraps around at 0xFF, the maximum value a byte can hold,
back to 0. I marked that point the &#34;overflow point&#34; because if you cross it, the
math breaks — taking 3 steps clockwise on this circle from 254 produces 1, not
254+3 = 257.</p>
<p>It&#39;s important to keep distinct the ideas of what the actual bits in the
computer are (which I write in <code>0xhex</code>) versus what number those bits represent
(which I write in decimal). For unsigned integers these aren&#39;t too interesting
because they correspond — e.g. the bit pattern 0x1 represents the integer 1.</p>
<h2>Signed math</h2>
<p>Next, here is that same picture, but interpreting the same hex bit patterns as
two&#39;s complement <em>signed</em> integers — the bit patterns from 0x80 up to 0xFF now
represent negative numbers.</p>
<p><img src="https://neugierig.org/software/blog/2023/06/signed.png" width="200" height="200"/></p>
<p>What&#39;s neat about this layout is that the same rotation rule works, even across
the negative/positive boundary. Repeating the above example, if you start at -2
(0xFE) and add 3 (take three steps to the right), you end up at 1 (0x1), which
is what you&#39;d expect because -2 + 3 = 1. What that means is that, given an
arbitrary number in memory, you can actually perform addition and subtraction on
it the same without even knowing whether it&#39;s representing a signed or unsigned
number. Suppose you have the bit pattern 0xFE and you add 0x1 to it, producing
0xFF. If you interpret that operation as signed math it&#39;s computing 254 + 1 =
255, while if you interpret it as unsigned math it was -2 + 1 = -1.</p>
<p>Another nice property of this representation is that you can immediately tell
whether a number is negative because they all have the highest bit set.</p>
<p>One last nice property of this representation is that positive numbers still
look the same as they do in unsigned — 0x1 is still +1.</p>
<h2>Remembering it</h2>
<p>How do you compute the bit pattern for a negative signed integer? The formula is
simple — <code>bitwise_not(abs(x)) + 1</code> — but without an intuition for it, it was
hard for me to remember if you add one or subtract one depending on whether
you&#39;re going from signed to unsigned or the other direction.</p>
<p>But look at the picture and imagine a negative number like -2. Take the absolute
value (2), then invert its bits to mirror it from one side of the circle to the
other (0xFD), and then rotate by one. With this picture it&#39;s easy to see that
0x1 mirrors to 0xFE when it should be 0xFF, so the correct rotation is to add
one, not subtract.</p>
<p>PS: I gained the intuition for the above pictures from someone else&#39;s website on
this topic. I don&#39;t remember the site, but I figure repeating it in my own words
will also help me remember the lesson better.</p>

</div></div>
  </body>
</html>
