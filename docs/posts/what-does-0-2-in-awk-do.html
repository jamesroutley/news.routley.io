<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://kau.sh/blog/awk-1-oneliner-dollar-explanation/">Original</a>
    <h1>What does $0=$2 in awk do?</h1>
    
    <div id="readability-page-1" class="page"><div id="site-content">
<section>

<article>
<p>The trick to understanding awk in all its terse glory is to understand its defaults. I made a <a href="https://kau.sh/blog/screencast-1-build-awk-jekyll-permalink-migration/">screencast</a> explaining how <a href="https://www.gnu.org/software/gawk/manual/gawk.html">awk</a> works by deconstructing a script I‚Äôd previously written for this blog <sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup>. In this post we‚Äôll look at deconstructing awk‚Äôs defaults so we can understand all those one-liner scripts stack overflow solutions throw your way.</p>

<p>I have a file that contains the version info for my apps and I‚Äôd like to extract the first version number in there:</p>
<div><pre tabindex="0"><code data-lang="gradle"><span><span><span>// appVersion.gradle
</span></span></span><span><span><span></span>
</span></span><span><span><span>def</span> baseCode <span>=</span> <span>30001</span>
</span></span><span><span>
</span></span><span><span><span>def</span> appVersion <span>=</span> <span>[</span>
</span></span><span><span>    product<span>-</span><span>1</span> <span>:</span> <span>[</span>
</span></span><span><span>        name: <span>&#34;21.091.420&#34;</span><span>,</span>
</span></span><span><span>        code: baseCode
</span></span><span><span>    <span>],</span>
</span></span><span><span>
</span></span><span><span>    product<span>-</span><span>2</span><span>:</span> <span>[</span>
</span></span><span><span>        name: <span>&#34;20.090.300&#34;</span><span>,</span>
</span></span><span><span>        code: baseCode
</span></span><span><span>    <span>],</span>
</span></span><span><span><span>//...
</span></span></span><span><span><span></span>
</span></span><span><span><span>// I want to pluck 21.091.420 from this file
</span></span></span></code></pre></div>
<p>Some quick googling revealed this <a href="https://unix.stackexchange.com/a/148289">stack overflow solution</a> which gets us close:</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span> <span>gawk</span> <span>-</span><span>F</span><span>&#39;&#34;&#39;</span> <span>&#39;$0=$2&#39;</span> <span>appVersion</span>.<span>gradle</span>
</span></span><span><span>
</span></span><span><span><span># -- output --</span>
</span></span><span><span><span># 21.091.420</span>
</span></span><span><span><span># 20.090.300</span>
</span></span></code></pre></div><p>I only require the first number though so a quick way<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup> to do this would just be:</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span><span>gawk</span> <span>-</span><span>F</span><span>&#39;&#34;&#39;</span> <span>&#39;$0=$2&#39;</span> <span>appVersion</span>.<span>gradle</span> <span>|</span> <span>head</span> <span>-</span><span>n</span> <span>1</span>
</span></span><span><span>
</span></span><span><span><span># -- output --</span>
</span></span><span><span><span># 21.091.420</span>
</span></span></code></pre></div>
<ol>
<li>awk is powerful and to reach out to <code>head</code> for that last teeny tiny mile seemed sacrilegious. I want this solution to be pure awk.</li>
<li>What the heck does that incantation <code>gawk &#39;$0=$2&#39;</code> do? <sup id="fnref:3"><a href="#fn:3" role="doc-noteref">3</a></sup></li>
</ol>

<p>Let‚Äôs try to take that script apart piece by piece:</p>
<h2 id="default-input-field-delimiter">default input field delimiter</h2>
<div><pre tabindex="0"><code data-lang="awk"><span><span><span>gawk</span>  <span>-</span><span>F</span><span>&#39;&#34;&#39;</span> <span>&#39;$0=$2&#39;</span> <span>appVersion</span>.<span>gradle</span>
</span></span><span><span><span>#     ‚Üë</span>
</span></span><span><span><span>#    input field delimiter</span>
</span></span></code></pre></div><p>If you don‚Äôt specify the input field delimiter, awk sensibly defaults to the space character. Let‚Äôs try some examples:</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span>  <span>|</span> <span>gawk</span>       <span>&#39;{print $2}&#39;</span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span>  <span>|</span> <span>gawk</span> <span>-</span><span>F</span><span>&#34; &#34;</span> <span>&#39;{print $2}&#39;</span>
</span></span><span><span>
</span></span><span><span><span># -- output --</span>
</span></span><span><span><span># kind</span>
</span></span><span><span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span>  <span>|</span> <span>gawk</span> <span>-</span><span>F</span><span>&#34;,&#34;</span> <span>&#39;{print $2}&#39;</span>
</span></span><span><span><span># -- no output --</span>
</span></span></code></pre></div><p>Notice how the line is split into numbered ‚Äúsegments‚Äù where <code>$1</code>, <code>$2</code>, <code>$3</code> hold the first three words in our example respectively. <strong><code>$0</code> represent the entire line</strong>.</p>
<h2 id="default-syntax">default syntax</h2>
<p>If you watched my <a href="https://kau.sh/blog/screencast-1-build-awk-jekyll-permalink-migration/">screencast</a> you‚Äôll remember that awk‚Äôs general syntax is as follows:</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span><span>awk</span> <span>&#39;
</span></span></span><span><span><span>    BEGIN { a1; a2; a3; }      ‚Üê optional
</span></span></span><span><span><span>    &lt;pattern&gt; { a1; a2; a3; }  ‚Üê action block (mandatory)
</span></span></span><span><span><span>    END { a4; a6; }            ‚Üê optional
</span></span></span><span><span><span>&#39;</span> <span>&lt;</span><span>filename</span><span>&gt;</span>
</span></span></code></pre></div><p>Most awk one-liners typically don‚Äôt use the begin &amp; end blocks.</p>
<p>So looking back at my simple one-liner:</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span>  <span>\</span>
</span></span><span><span>    <span>|</span> <span>gawk</span> <span>&#39; { print $2 }&#39;</span>
</span></span><span><span><span>#            ‚Üì</span>
</span></span><span><span><span>#            action block ‚úÖ</span>
</span></span></code></pre></div><p>üõë ‚úã but wait, what‚Äôs going on with the original one-liner üëá?</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span><span>gawk</span> <span>-</span><span>F</span><span>&#39;&#34;&#39;</span> <span>&#39;$0=$2&#39;</span> <span>appVersion</span>.<span>gradle</span>
</span></span><span><span><span>#           ‚Üë</span>
</span></span><span><span><span>#           ü§î</span>
</span></span><span><span><span>#         is this a &lt;pattern&gt;?</span>
</span></span><span><span><span>#         is this an action block?</span>
</span></span></code></pre></div><p>For this, we need to understand how the awk pattern recognition works:</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span><span># general syntax</span>
</span></span><span><span><span>gawk</span> <span>&#39;&lt;pattern&gt; { a1; a2; a3; }&#39;</span>
</span></span><span><span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>\</span>
</span></span><span><span>  <span>|</span> <span>gawk</span> <span>&#39;0 { print $2 }&#39;</span>
</span></span><span><span><span>#         ‚Üë</span>
</span></span><span><span><span>#         forcing result of &lt;pattern&gt; match as 0</span>
</span></span><span><span>
</span></span><span><span><span># -- output --</span>
</span></span><span><span><span># no output</span>
</span></span><span><span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>\</span>
</span></span><span><span>    <span>|</span> <span>gawk</span> <span>&#39;1 { print $2 }&#39;</span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>\</span>
</span></span><span><span>    <span>|</span> <span>gawk</span> <span>&#39;2 { print $2 }&#39;</span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>\</span>
</span></span><span><span>    <span>|</span> <span>gawk</span> <span>&#39;3 { print $2 }&#39;</span>
</span></span><span><span><span>#           ‚Üë</span>
</span></span><span><span><span>#           forcing result of &lt;pattern&gt; match as 3 / non-0</span>
</span></span><span><span>
</span></span><span><span><span># -- output for all the above --</span>
</span></span><span><span><span># kind</span>
</span></span></code></pre></div><p>So the way that <code>&lt;pattern&gt;</code> condition matching works is if awk sees 0 <sup id="fnref:4"><a href="#fn:4" role="doc-noteref">4</a></sup> the pattern match condition is ‚Äúfalse‚Äù and awk ignores the action block. Anything &gt; 0 and awk treats the condition as ‚Äútrue‚Äù and executes the action block. Ok back to the one-liner:</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span><span>gawk</span> <span>-</span><span>F</span><span>&#39;&#34;&#39;</span> <span>&#39;$0=$2&#39;</span> <span>appVersion</span>.<span>gradle</span>
</span></span><span><span><span>#           ‚Üë</span>
</span></span><span><span><span>#         is this a valid pattern?</span>
</span></span><span><span><span>#               ‚úÖ we&#39;re getting some non-0 value</span>
</span></span><span><span><span>#                  cause things are being printed</span>
</span></span><span><span><span>#         is this an action block? ü§î</span>
</span></span></code></pre></div><p>So <code>$0=$2</code> is coming back with a result of &gt; 0 and some invisible default is being executed. Progress‚Ä¶ but still many questions.</p>
<h2 id="default-action">default action</h2>
<p>Let‚Äôs try some commands. Notice the output for each of them:</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>|</span> <span>gawk</span> <span>&#39;0 {print $0}&#39;</span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>|</span> <span>gawk</span> <span>&#39;0 {print}&#39;</span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>|</span> <span>gawk</span> <span>&#39;0&#39;</span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>|</span> <span>gawk</span> <span>&#39;&#39;</span>
</span></span><span><span>
</span></span><span><span><span># -- output --</span>
</span></span><span><span><span># no output</span>
</span></span><span><span>
</span></span><span><span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>|</span> <span>gawk</span> <span>&#39;1 {print $0}&#39;</span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>|</span> <span>gawk</span> <span>&#39;1 {print}&#39;</span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>|</span> <span>gawk</span> <span>&#39;1&#39;</span>
</span></span><span><span>
</span></span><span><span><span># -- output --</span>
</span></span><span><span><span># Hello kind world</span>
</span></span></code></pre></div><p>So when the <code>&lt;pattern&gt;</code> match is false (0) nothing is printed and when it is 1 then the default is to just print the entire line (<code>$0</code>). In fact you don‚Äôt have to specify anything and awk assumes you want to <code>print $0</code> by default.</p>
<h2 id="variable-reassignment">variable reassignment</h2>
<p>You know how we glorify immutability with most programming? <code>awk</code> ain‚Äôt having any of that.</p>
<p>You can mutate the heck out of anything. You can mutate the current line before you even run an action on it. Check this piece of code out:</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>|</span> <span>gawk</span> <span>&#39;{print $0&#34; &lt;-&gt; &#34;$1&#34; &lt;-&gt; &#34;$2&#34; &lt;-&gt; &#34;$3}&#39;</span>
</span></span><span><span>
</span></span><span><span><span># -- output --</span>
</span></span><span><span><span># Hello kind world &lt;-&gt; Hello &lt;-&gt; kind &lt;-&gt; world</span>
</span></span><span><span><span>#        ‚Üë              ‚Üë          ‚Üë        ‚Üë</span>
</span></span><span><span><span>#        $0             $1         $2       $3</span>
</span></span><span><span>
</span></span><span><span><span>echo</span> <span>&#34;Hello kind world&#34;</span> <span>|</span> <span>gawk</span> <span>&#39;1 {$0=&#34;hijack&#34;; print $0&#34; &lt;-&gt; &#34;$1&#34; &lt;-&gt; &#34;$2&#34; &lt;-&gt; &#34;$3}&#39;</span>
</span></span><span><span><span># -- output --</span>
</span></span><span><span><span># hijack &lt;-&gt; hijack &lt;-&gt;  &lt;-&gt;</span>
</span></span><span><span><span>#    ‚Üë         ‚Üë       ‚Üë     ‚Üë</span>
</span></span><span><span><span>#    $0        $1      üôÖ    üôÖ</span>
</span></span></code></pre></div><p><em>Even before the action block is executed you can reassign the entire line</em>.</p>
<h2 id="number-of-fields">number of fields</h2>
<p>Here‚Äôs the last piece that should help bring this all together. Given this file again:</p>
<div><pre tabindex="0"><code data-lang="gradle"><span><span><span>// appVersion.gradle
</span></span></span><span><span><span></span>
</span></span><span><span><span>def</span> baseCode <span>=</span> <span>30001</span>
</span></span><span><span>
</span></span><span><span><span>def</span> appVersion <span>=</span> <span>[</span>
</span></span><span><span>    product<span>-</span><span>1</span> <span>:</span> <span>[</span>
</span></span><span><span>        name: <span>&#34;21.091.420&#34;</span><span>,</span>
</span></span><span><span>        code: baseCode
</span></span><span><span>    <span>],</span>
</span></span><span><span>
</span></span><span><span>    product<span>-</span><span>2</span><span>:</span> <span>[</span>
</span></span><span><span>        name: <span>&#34;20.090.300&#34;</span><span>,</span>
</span></span><span><span>        code: baseCode
</span></span><span><span>    <span>],</span>
</span></span><span><span><span>//...
</span></span></span></code></pre></div><div><pre tabindex="0"><code data-lang="awk"><span><span><span>gawk</span> <span>&#39;{print NF &#34;: &#34;$0}&#39;</span> <span>appVersion</span>.<span>gradle</span>
</span></span><span><span>
</span></span><span><span><span># -- output --</span>
</span></span><span><span><span># 0:</span>
</span></span><span><span><span># 4: def baseCode = 30001</span>
</span></span><span><span><span># 0:</span>
</span></span><span><span><span># 4: def appVersion = [</span>
</span></span><span><span><span># 3:     product-1 : [</span>
</span></span><span><span><span># 2:         name: &#34;21.091.420&#34;,</span>
</span></span><span><span><span># 2:         code: baseCode</span>
</span></span><span><span><span># 1:     ],</span>
</span></span><span><span><span># 0:</span>
</span></span><span><span><span># 2:     product-2: [</span>
</span></span><span><span><span># 2:         name: &#34;20.090.300&#34;,</span>
</span></span><span><span><span># 2:         code: baseCode</span>
</span></span><span><span><span># 1:     ],</span>
</span></span></code></pre></div><ul>
<li><code>NF</code> in awk stands for number of fields.</li>
<li>awk takes the <a href="#default-input-field-delimiter">input field separator</a> and stores the ‚Äúnumber of fields‚Äù discovered in that variable.</li>
<li>Notice above that when there‚Äôs an empty line NF is 0 since there‚Äôs no separator (or content) in that line.</li>
<li>On the second line there‚Äôs 4 tokens (each separated by space)</li>
</ul>

<p>All right, let‚Äôs do this one last time.</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span> <span>gawk</span> <span>-</span><span>F</span><span>&#39;&#34;&#39;</span> <span>&#39;$0=$2&#39;</span> <span>appVersion</span>.<span>gradle</span>
</span></span><span><span>
</span></span><span><span><span># -- output --</span>
</span></span><span><span><span># 21.091.420</span>
</span></span><span><span><span># 20.090.300</span>
</span></span></code></pre></div><p>What‚Äôs happening here is a beautiful symphony of awk defaults stacking on top of each other.</p>
<p>We first reassign the variable holding the entire line ($0) to $2. Remember that $2 holds the second word/token after splitting the original content in $0 with the input field separator <code>&#34;</code>. This should help point out the resulting fields with the new field separator:</p>
<div><pre tabindex="0"><code data-lang="sh"><span><span> gawk -F<span>&#39;&#34;&#39;</span> <span>&#39;{print NF &#34;: &#34;$0}&#39;</span> appVersion.gradle
</span></span><span><span><span># 0:</span>
</span></span><span><span><span># 1: def baseCode = 30001</span>
</span></span><span><span><span># 0:</span>
</span></span><span><span><span># 1: def appVersion = [</span>
</span></span><span><span><span># 1:     product-1 : [</span>
</span></span><span><span><span># 3:         name: &#34;21.091.420&#34;,</span>
</span></span><span><span><span># 1:         code: baseCode</span>
</span></span><span><span><span># 1:     ],</span>
</span></span><span><span><span># 0:</span>
</span></span><span><span><span># 1:     product-2: [</span>
</span></span><span><span><span># 3:         name: &#34;20.090.300&#34;,</span>
</span></span><span><span><span># 1:         code: baseCode</span>
</span></span><span><span><span># 1:     ],</span>
</span></span></code></pre></div><ul>
<li>First line of this file is empty, so $2 is 0 and $0 is assigned to 0.</li>
<li>Second line of this file has only one segment (since there‚Äôs no <code>&#34;</code>) and is stored in $1. $2 is again 0 and $0 is assigned to 0.</li>
<li>Sixth line has 3 tokens, $2 is <code>21.091.420</code> and is assigned to $0.</li>
</ul>
<p>The original command should make sense now:</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span> <span>gawk</span> <span>-</span><span>F</span><span>&#39;&#34;&#39;</span> <span>&#39;$0=$2&#39;</span> <span>appVersion</span>.<span>gradle</span>
</span></span><span><span>
</span></span><span><span><span># -- output --</span>
</span></span><span><span><span># 21.091.420</span>
</span></span><span><span><span># 20.090.300</span>
</span></span></code></pre></div><ul>
<li>The <code>&lt;pattern&gt;</code> match condition provided to awk is the output value of <code>$0=$2</code>
<ul>
<li>From the previous command output we noticed that for the first, second lines up until the sixth line, was all 0.</li>
<li>when awk sees 0 it ignores the action and there‚Äôs no print</li>
</ul>
</li>
<li>The sixth line is the first time we encounter a non-0 value, so the action block is executed.
<ul>
<li>what is the default action? print $0</li>
<li>what is $0?
<ul>
<li>the second token or segment $2 (after field separator <code>&#34;</code>) which is <code>21.091.420</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>üí•</p>
<p>This is really such a gorgeous piece of code. Clever and poetic.</p>

<p>If you‚Äôre curious how I came up with my own solution, I made it a little less clever, more verbose and hopefully now simpler to understand:</p>
<div><pre tabindex="0"><code data-lang="awk"><span><span><span>gawk</span> <span>-</span><span>F</span><span>&#39;&#34;&#39;</span> <span>&#39;NF==3 {print $2; exit}&#39;</span> <span>appVersion</span>.<span>gradle</span>
</span></span><span><span>
</span></span><span><span><span># -- output --</span>
</span></span><span><span><span># 21.091.420</span>
</span></span></code></pre></div><p>Go forth and awk.</p>

</article></section>
</div></div>
  </body>
</html>
