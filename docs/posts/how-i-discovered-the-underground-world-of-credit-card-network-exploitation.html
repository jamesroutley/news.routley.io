<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://chargebackstop.com/blog/card-networks-exploitation/">Original</a>
    <h1>How I discovered the underground world of credit card network exploitation</h1>
    
    <div id="readability-page-1" class="page"><div>
        
        <p><i>Originally posted by Piotr Mierzejewski at <a target="_blank" href="https://piotrmierzejewski.com/p/card-networks-exploitation">https://piotrmierzejewski.com/p/card-networks-exploitation</a>. Piotr is a founding engineer on the ChargebackStop.com team. Together we&#39;re helping SaaS companies detect &amp; prevent chargebacks before they happen.</i></p>
            <figure>
              <img loading="lazy" src="https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png" srcset="https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=290&amp;height=163 290w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=345&amp;height=194 345w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=395&amp;height=222 395w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=738&amp;height=414 738w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=1060&amp;height=594 1060w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=580&amp;height=326 580w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=690&amp;height=388 690w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=790&amp;height=444 790w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=1476&amp;height=828 1476w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=2120&amp;height=1188 2120w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=870&amp;height=489 870w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=1035&amp;height=582 1035w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=1185&amp;height=666 1185w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=2214&amp;height=1242 2214w,https://unicorn-s3.b-cdn.net/CleanShot-2023-08-02-at-15.38.55@2x-g2b1v.png?width=3180&amp;height=1782 3180w," sizes="(max-width: 320px) 290px,(max-width: 375px) 345px,(max-width: 425px) 395px,(max-width: 768px) 738px,1060px" alt="CleanShot-2023-08-02-at-15.38.55@2x-g2b1v"/>
              
            </figure>
          <p>A couple of weeks back at work, we were alerted that suddenly our card decline rates are much higher than usual.</p><p>A quick glance at our Stripe dashboard revealed a lot of failed charges by users with a very auto-generated-sounding names and rather odd email domains<a target="_blank" href="https://piotrmierzejewski.com/p/card-networks-exploitation#user-content-fn-1">1</a>. We quickly concluded that we were hit with a classic card testing attack. We enabled <a target="_blank" href="https://stripe.com/radar" target="_blank" rel="nofollow">Stripe Radar</a>, tossed implementing captcha in our checkout into our backlog, and moved on.</p><p>In the meantime, I noticed a couple of tweets describing similar issues from Pieter Levels and Danny Postma. I shared them with my team, we looked for infamous Jake Smith in our Stripe account (he wasn’t there), and moved on.</p><blockquote><p>Had to refund and cancel 240 customers called Jake Smith from Philippines with $7,000 in card testing payments</p><cite>— @levelsio (@levelsio) June 5, 2023</cite></blockquote><p><a target="_blank" href="https://twitter.com/levelsio/status/1665625055777398784?ref_src=twsrc%5Etfw"><i>Source</i></a></p><blockquote><p>Seems like everyone I know on Twitter is getting attacked by &#34;jack smith&#34; with fraudulent charges.</p><cite>— Danny Postma (@dannypostmaa) June 5, 2023</cite></blockquote><p><a target="_blank" href="https://twitter.com/dannypostmaa/status/1665693420680097793?ref_src=twsrc%5Etfw"><i>Source</i></a></p><p>Fast forward couple weeks, we get high decline ratio alert again. This time I started implementing Stripe Radar rules ad-hoc (such as blocking transactions after specific number of failures within given timeframe). Looking more closely at the traffic however, it turned out that attackers tested up to four cards a minute. Most of the time the traffic was much less intense and much less consistent.</p><p>After reading some <a target="_blank" href="https://stripe.com/docs/disputes/prevention/card-testing#optimize-integration" target="_blank" rel="nofollow">materials from Stripe on card testing</a>, I realised that our implementation should be pretty well guarded against this kind of attack. We require users to log in before we allow them to open the checkout, and use Payment Element with some of the signals. According to the page linked above, our protection against card testing should be close to ‘excellent’.</p><p>After some more digging and consulting my colleagues, we arrived at a conclusion that the traffic we were experiencing was most likely manual, or at most very lightly automated.</p><p>My belief was being reinforced as I noticed that almost all of the cards that attackers used:</p><ul><li>Were all issued by the same bank</li><li>Had the same funding source [2]</li><li>Came from the same country: USA</li></ul><p>How was it possible that attackers had a list of cards with such similar parameters? I always imagined that compromised credit cards would would be much more diverse. Were they actually leaked from the bank itself?</p><p>One of my sub-hypotheses was that the goal of the attackers is to pay for VEED account with a stolen card and resell it for profit. I started pulling this thread and I found a Telegram channel that recommended VEED as a great tool for adding subtitles to your videos.</p><p>I also found in that channel messages with credit cards’ BINs [3], CVC, expiration dates and links to tools that generate valid credit card numbers based on these inputs.</p><p>It turns out that there’s whole underground(-ish, all of of was publicly available on the internet to me) [4] world of people who share credit card parameters with biggest likelihood creating a card that’s accepted on a specific website (usually some SaaS)</p>
            <figure>
              <img loading="lazy" src="https://unicorn-s3.b-cdn.net/image-894yu.png" srcset="https://unicorn-s3.b-cdn.net/image-894yu.png?width=290&amp;height=256 290w,https://unicorn-s3.b-cdn.net/image-894yu.png?width=345&amp;height=305 345w,https://unicorn-s3.b-cdn.net/image-894yu.png?width=395&amp;height=349 395w,https://unicorn-s3.b-cdn.net/image-894yu.png?width=449&amp;height=396 449w,https://unicorn-s3.b-cdn.net/image-894yu.png?width=449&amp;height=396 449w,https://unicorn-s3.b-cdn.net/image-894yu.png?width=449&amp;height=396 449w,https://unicorn-s3.b-cdn.net/image-894yu.png?width=449&amp;height=396 449w," sizes="(max-width: 320px) 290px,(max-width: 375px) 345px,(max-width: 425px) 395px,(max-width: 768px) 449px,449px" alt="image-894yu"/>
              
            </figure>
          <p>A telegram channel message with instructions on getting Spotify Premium for free (illegally)</p><p>We were most likely a victim of such manual attack, initiated from some private Discord server or Telegram channel. I never managed to find a specific source, but I strongly suspect it given that all of the cards had the same parameters that were all determined by a BIN. In the public channels I managed to find they quite often sent nagging messages about going private in the couple following days. I suspect most of this activity is not accessible to me.</p>
            <figure>
              <img loading="lazy" src="https://unicorn-s3.b-cdn.net/image-wyerc.png" srcset="https://unicorn-s3.b-cdn.net/image-wyerc.png?width=290&amp;height=207 290w,https://unicorn-s3.b-cdn.net/image-wyerc.png?width=345&amp;height=246 345w,https://unicorn-s3.b-cdn.net/image-wyerc.png?width=395&amp;height=282 395w,https://unicorn-s3.b-cdn.net/image-wyerc.png?width=456&amp;height=325 456w,https://unicorn-s3.b-cdn.net/image-wyerc.png?width=456&amp;height=325 456w,https://unicorn-s3.b-cdn.net/image-wyerc.png?width=456&amp;height=325 456w,https://unicorn-s3.b-cdn.net/image-wyerc.png?width=456&amp;height=325 456w," sizes="(max-width: 320px) 290px,(max-width: 375px) 345px,(max-width: 425px) 395px,(max-width: 768px) 456px,456px" alt="image-wyerc"/>
              
            </figure>
          <p>A telegram channel message with instructions on getting YouTube Premium for free (illegally)</p><p>On top of that, there’s a plethora of online tools that will take a list of autogenerated cards and run it through any Stripe Checkout session automatically. This was a bit surprising as I expected Stripe Checkout to be the least prone to any sort of automation, since Stripe owns this integration end-to-end.</p>
            <figure>
              <img loading="lazy" src="https://unicorn-s3.b-cdn.net/image-p1kdj.png" srcset="https://unicorn-s3.b-cdn.net/image-p1kdj.png?width=290&amp;height=202 290w,https://unicorn-s3.b-cdn.net/image-p1kdj.png?width=345&amp;height=240 345w,https://unicorn-s3.b-cdn.net/image-p1kdj.png?width=395&amp;height=275 395w,https://unicorn-s3.b-cdn.net/image-p1kdj.png?width=738&amp;height=514 738w,https://unicorn-s3.b-cdn.net/image-p1kdj.png?width=749&amp;height=521 749w,https://unicorn-s3.b-cdn.net/image-p1kdj.png?width=580&amp;height=404 580w,https://unicorn-s3.b-cdn.net/image-p1kdj.png?width=690&amp;height=480 690w,https://unicorn-s3.b-cdn.net/image-p1kdj.png?width=749&amp;height=521 749w,https://unicorn-s3.b-cdn.net/image-p1kdj.png?width=749&amp;height=521 749w," sizes="(max-width: 320px) 290px,(max-width: 375px) 345px,(max-width: 425px) 395px,(max-width: 768px) 738px,749px" alt="image-p1kdj"/>
              
            </figure>
          <p>Part of automatic Stripe Checkout cracking tool source code, it generates random (invalid) email address on Gmail</p>
            <figure>
              <img loading="lazy" src="https://unicorn-s3.b-cdn.net/image-0acwm.png" srcset="https://unicorn-s3.b-cdn.net/image-0acwm.png?width=290&amp;height=349 290w,https://unicorn-s3.b-cdn.net/image-0acwm.png?width=339&amp;height=407 339w,https://unicorn-s3.b-cdn.net/image-0acwm.png?width=339&amp;height=407 339w,https://unicorn-s3.b-cdn.net/image-0acwm.png?width=339&amp;height=407 339w,https://unicorn-s3.b-cdn.net/image-0acwm.png?width=339&amp;height=407 339w,https://unicorn-s3.b-cdn.net/image-0acwm.png?width=339&amp;height=407 339w,https://unicorn-s3.b-cdn.net/image-0acwm.png?width=339&amp;height=407 339w," sizes="(max-width: 320px) 290px,(max-width: 375px) 339px,(max-width: 425px) 339px,(max-width: 768px) 339px,339px" alt="image-0acwm"/>
              
            </figure>
          <p>Unhappy Telegram chat message regarding Pieter Levels&#39; tweet quoted above</p><h2>The clean-up</h2><p>The painful aftermath of this attack for us was that some of the attackers succeeded and managed to pay for our product. At that stage we still weren’t sure of the scale of it though, so it was time to crunch some data.</p><p>We queried our data storage for customers with more than 5 failed charges since May 1st. Then I got ChatGPT to quickly create a Python script which found these customers’ email domains. Once we had a list of domains, we queried our database to get a list of all successful charges made by customers with emails in these domains.</p><p>With a list of charges I had another script written by ChatGPT to find which charges were being already disputed. We learnt that 15% of the successful fraudulent charges resulted in chargebacks. We decided to accept all of the disputes and swallow <a target="_blank" href="https://stripe.com/en-gb/pricing#faqs" target="_blank" rel="nofollow">Stripe’s £20 fee</a> for each. It’s a cost of running an online business, it seems. I created a restricted key in Stripe with lowest possible permissions, and prompted ChatGPT to create a script to accept the chargebacks.</p><p>The next Python script to come out of ChatGPT fetched all of the charges from the list, refunded all the non-disputed charges, and cancelled any active subscriptions for customers who created these charges. For these charges, we were at loss on <a target="_blank" href="https://support.stripe.com/questions/understanding-fees-for-refunded-payments" target="_blank" rel="nofollow">Stripe’s and network fees both for the successful charge and – potentially – for the refund</a>. It’s much less than £20 for a chargeback, but still a loss.</p><p>The final Python script I used wasn’t strictly necessary, but I wanted to ensure that all of the charges in the list are either disputed and accepted, or refunded. Additionally, I wanted to make sure that none of these customers had any active subscriptions anymore. I got ChatGPT to spit it out for me one more time, changed my Stripe restricted key to not have write access anymore, and ran the script. I was able to confirm the problem was solved (or at least part of the problem that we were able to uncover)!</p><p>As a sidenote: ChatGPT advised a lot of caution when running its scripts, suggested to test it well on a small sample, etc. Well appreciated! I reviewed all of the scripts carefully, and also never shared any customer data, IDs, or API keys. I think I saved at least a couple hours compared to hand-rolling these tools manually!</p><h2>On American banks</h2><p>The world of online payments is well-known to be unfair to businesses. You are unlikely to win a dispute, need to <a target="_blank" href="https://stripe.com/docs/disputes/measuring#excessive-dispute-activity" target="_blank" rel="nofollow">maintain dispute activity below 0.75%</a>, and pay <a target="_blank" href="https://stripe.com/docs/disputes/how-disputes-work#dispute-fees" target="_blank" rel="nofollow">£20 for every dispute, no matter if the business looses or wins</a>.</p><p>At the same time, banks (usually American ones) will happily accept transactions that have:</p><ul><li>Incorrect full name</li><li>Invalid CVV / CVC</li><li>Wrong expiration date</li><li>Only partial billing address provided, with incorrect ZIP code</li></ul><p>All of the above is still not enough to trigger a 3D secure authorisation. I’m not entirely sure why businesses should be held accountable for charges in which literally only the card number is correct.</p><p>I suspect that possibility of the above checks is somewhat limited in prepaid cards, but I’m sure that there’s room for improvement in this area.</p><h2>Prevention methods</h2><p>How can we prevent this from happening again?</p><p>As I mentioned before, at the beginning of the discovery process our gut reaction was enabling <a target="_blank" href="https://stripe.com/radar" target="_blank" rel="nofollow">Stripe Radar</a>. It’s a machine-learning-based solution that’s supposed to score every payment and block is automatically is some of the metrics do not add up.</p><p>As we learnt later on, it wasn’t very helpful with our case. The risk score for most of these transactions was between 0 and 5 (low risk). At the same time, I noticed a couple of legitimate customers being blocked after they failed to solve the 3D secure challenge twice. This is very anecdotal, but left me a little concerned about leaving the fate of the customer in hands of machine learning.</p><p>Thankfully, Stripe Radar also has <a target="_blank" href="https://stripe.com/docs/radar/rules" target="_blank" rel="nofollow">the ability to write custom rules</a> for when to request 3D secure challenge, send payment to manual review, or block it completely. It looks a little like pseudocode, but can be used to express surprisingly complex logic to narrow down malicious payment attempts.</p><p>This was the best weapon available to us. I put reasonable limits on the number of possible failed payment attempts within an hour, day, and week for a customer. Here’s a couple of rules from aforementioned Danny Postma that you can use as inspiration.</p><blockquote><p>Here&#39;s my custom Stripe Radar block list for anyone interested. pic.twitter.com/jPm1BAA5yK</p><cite>— Danny Postma (@dannypostmaa) May 2, 2023</cite></blockquote><p><a target="_blank" href="https://twitter.com/dannypostmaa/status/1653214594452832256?ref_src=twsrc%5Etfw"><i>Source</i></a></p><h2>Conclusions</h2><p>The cost of this fraudulent activity (starting with payment processor fees, chargeback penalties, engineering cost or even the risk of getting deplatformed) is being paid by businesses around the world. Stripe charging businesses £20 chargeback fee is another example of unfair treatment. All of these costs are eventually offloaded onto customers as higher prices.</p><p>The biggest learning to me is that the payment network that we all rely on a daily basis is quite exploitable. The ultimate decision whether the card can be charged is at issuing bank’s discretion.</p><p>Until the banks are willing to take more responsibility for their authorisations, this will keep on going. I’m not sure if there’s any incentive for them to fight it (are they at risk of getting deplatformed by the payment processors too?), but without their involvement best we can do is to keep a close eye on our charge failure rates, add captchas, and share our favourite Stripe Radar rules on Twitter.</p><h2>Footnotes</h2><ol><li>Nothing against self-hosting email, but the sad reality is that email address domains these days are either a couple of the most popular email providers, or company domains. </li><li>Funding source says if the card is a debit, credit, or prepaid card. </li><li>Bank Identification Number, the first six up to eight digits of any credit card. </li><li>I think the usual way of operating is starting out as a public channel, and then going private once they get the audience. </li></ol>
      </div></div>
  </body>
</html>
