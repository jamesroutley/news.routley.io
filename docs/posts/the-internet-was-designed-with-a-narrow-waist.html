<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.oilshell.org/blog/2022/02/diagrams.html">Original</a>
    <h1>The internet was designed with a narrow waist</h1>
    
    <div id="readability-page-1" class="page">
  <!-- INSERT LATCH HTML -->
<p><a href="https://www.oilshell.org/blog/">blog</a> | <a href="https://www.oilshell.org/">oilshell.org</a></p>

<p>
  2022-02-26
</p>

<p>In December, I <a href="https://www.oilshell.org/blog/2021/12/review-arch.html">reviewed eight 2021
posts</a> on
#<a href="https://www.oilshell.org/blog/tags.html?tag=software-architecture#software-architecture">software-architecture</a>.  This post goes deeper in that direction,
showing <strong>diagrams of the <a href="https://www.oilshell.org/cross-ref.html?tag=narrow-waist#narrow-waist">narrow waist</a></strong> idea.</p>
<p>When you hear the term, you should picture an <strong>hourglass</strong> with M things on
one side, N on the other, and an important concept in the middle.  Recap:</p>
<ul>
<li>A narrow waist is concept, interface, or protocol that solves an
<strong>interoperability</strong> problem.</li>
<li>It avoids <a href="https://www.oilshell.org/cross-ref.html?tag=m-by-n-explosion#m-by-n-explosion">O(M × N) code explosions</a>, letting
us write O(M + N) amounts of code instead.
<ul>
<li>This is a big deal in practice!  Most code is glue, but it doesn&#39;t have to
be this way.</li>
</ul>
</li>
<li><strong>Byte streams</strong> and <strong>text</strong> are essential narrow waists in software,
particularly in #<a href="https://www.oilshell.org/blog/tags.html?tag=distributed-systems#distributed-systems">distributed-systems</a>.</li>
</ul>
 
<a name="ip-the-narrow-waist-of-internet-architecture"></a>
<h2>IP: the Narrow Waist of Internet Architecture</h2>
<p>Let&#39;s start with 2 diagrams I found about the architecture of the Internet
itself.</p>
<p>The &#34;IP&#34; in TCP/IP stands for the <a href="https://en.wikipedia.org/wiki/Internet_Protocol">Internet
Protocol</a>.  It was developed
by Vint Cerf and Bob Kahn, who described it in 1974.  It allows
interoperability between <strong>applications</strong> on the top and <strong>physical
transports</strong> on the bottom.</p>
<p><img src="https://app.oilshell.org/picdir/resize?name=1a9r7d1__hourglass-deering.png&amp;max-width=400" alt="Hourglass Diagram 1"/></p>
<ul>
<li>Source: <a href="https://www.iab.org/wp-content/IAB-uploads/2010/11/hourglass-london-ietf.pdf">2001 Presentation by Steve
Deering</a> (PDF)</li>
</ul>
<p>For example, I started using the web in the 90&#39;s with a PC connected to a
modem, connected to a phone line.  (<a href="https://en.wikipedia.org/wiki/Tablature">Guitar
tablature</a> was a type of text that
traveled well over slow networks!)</p>
<p>In the next few decades, I used the Internet over Ethernet at college, over
wires meant for cable television, over DSL from the phone company, with
wireless routers, and with cell phones.</p>
<p>At no point did a web page author have to do anything to make this work!  This
is because web <strong>browsers</strong> and <strong>servers</strong> both use the Internet abstraction.
(I&#39;m mixing up some layers, but my ignorance is part of the point — it
just worked.)</p>
<p><img src="https://app.oilshell.org/picdir/resize?name=16ngjpw__hourglass-kub.png&amp;max-width=600" alt="Hourglass Diagram 2"/></p>
<ul>
<li>Source: <a href="https://people.eecs.berkeley.edu/%7Ekubitron/cs262/lectures/lec02-E2E-SystemR.pdf">2019 Lecture Notes by John
Kubiatowicz</a> (PDF)</li>
</ul>
<p>So in networking, the idea of a <a href="https://www.oilshell.org/cross-ref.html?tag=narrow waist#narrow%20waist">narrow waist</a> is used and taught
<strong>explicitly</strong>.</p>
<p>But we don&#39;t pay enough attention to this idea in <strong>software</strong> —
particularly in the modern &#34;cloud&#34;.  In the next few posts, I&#39;ll review some
<strong>Unix fallacies</strong>, i.e. local complaints which are ignorant of the large scale
architecture.</p>
<a name="pre-internet-m-n-confusion"></a>
<h3>Pre-Internet M × N Confusion</h3>
<p>The first e-mail applications did not use the Internet; they were directly
coupled to a local, physical network.  You could send messages to your
coworker, but not to your family across the ocean.</p>
<p>Moreover, you had to rewrite or port the app if you wanted to use different
hardware, e.g. a wireless network instead of wired.  You also had to rewrite or
port your file transfer application.</p>
<p>So instead of just <strong>one</strong> e-mail application, you had N e-mail apps that
worked on N networks.  And this was true for each of M applications, giving O(M
× N) amounts of code.</p>
<p>These days, each application <strong>uses</strong> the Internet, and each local network
<strong>supports</strong> the Internet, which is an O(M + N) amount of code.</p>
<ul>
<li>This is similar to rewriting assembly language programs when you got a new
computer, which was the status quo before standard <a href="https://en.wikipedia.org/wiki/Instruction_set_architecture">instructure set
architectures</a>
were invented.  It&#39;s hard to imagine now, but in the 60&#39;s, you would throw
out your software after buying a new computer <em>from the same vendor</em>!   (Back
then, only large organizations owned computers.)</li>
<li><a href="https://amturing.acm.org/award_winners/brooks_1002187.cfm">Fred Brooks&#39; Turing
Award</a> cites
seminal work in this area, e.g. IBM&#39;s System/360 line of mainframes.</li>
</ul>
<a name="these-abstractions-can-be-designed"></a>
<h3>These Abstractions Can Be Designed</h3>
<p>My point is that we take narrow waists for granted, like the air.  But real
people put a lot of effort into designing and inventing them!</p>
<p>I think we&#39;re still writing distributed systems the &#34;wrong&#34; way, with O(M
× N) amounts of labor.  This blog post from August goes deeper into that:</p>

<p>A major point is that crosscutting concerns like authentication, authorization,
metrics, monitoring, alerting, and deployment are done for each <strong>service</strong> and
for each <strong>programming language</strong>, leading to code explosions (and language
wars).  It cites the excellent <a href="https://www.youtube.com/watch?v=3Ea3pkTCYx4">Unix vs. Google
video</a>, which makes an analogy to
Multics.  (This discussion is similar but not identical to <a href="https://news.ycombinator.com/item?id=27903720">Kubernetes is Our
Generation&#39;s Multics</a>.)</p>
<p>With hindsight, this way of building systems now will seem as silly as throwing
out your software when you buy a new computer.  We should explicitly think
about new narrow waists and fix old ones, like the shell.</p>

<a name="shell-and-distributed-systems"></a>
<h2>Shell and Distributed Systems</h2>
<p>I made two diagrams to show where this line of thought is going.  Upcoming
posts will substantiate and elaborate on them.</p>
<a name="bytes-flat-files"></a>
<h3>Bytes / Flat Files</h3>
<p>This diagram shows that using the common abstraction of byte streams allows
essential <strong>generic / polymorphic operations</strong>, avoiding O(M × N) amounts
of code.</p>
<img alt="Narrow Waist of Bytes" src="https://www.oilshell.org/blog/2022/02/bytes-text-Page-1.drawio.svg" width="600"/>
<p>Slogans:</p>
<ul>
<li><em>Most code is glue!</em>  Especially in distributed systems.
<ul>
<li>By glue, I mean <strong>copying</strong> and simple data transformations like parsing and serialization.</li>
</ul>
</li>
<li><em>Shell is the language of byte streams and coarse-grained composition</em>.
<ul>
<li>It&#39;s also <em>the language of heterogeneity and diversity</em>.</li>
</ul>
</li>
</ul>
<a name="text-narrow-waist-of-unix-architecture"></a>
<h3>Text: Narrow Waist of Unix Architecture</h3>
<p>An important special case of byte streams is human-readable text.  When you
represent data with plain text, you get useful operations and tools <strong>for
free</strong>.</p>
<img alt="Narrow Waist of Text" width="600" src="https://www.oilshell.org/blog/2022/02/bytes-text-Page-2.drawio.svg"/>
<p>This isn&#39;t a theoretical issue; it has big consequences.  This economy of
engineering is why Unix and the Internet have been so successful.</p>
<p>It&#39;s also why programmers of all types lament the pervasiveness of text.  I
understand why: both #<a href="https://www.oilshell.org/blog/tags.html?tag=parsing#parsing">parsing</a> and serialization are laborious, and
have associated security problems.  (<a href="https://www.oilshell.org/blog/2021/07/blog-backlog-1.html#concepts">String
hygiene</a> is still
in the blog queue).</p>
<p>But I claim that programmers disregard system issues in favor of local
convenience.  And that we use poor abstractions provided by interested vendors.
These abstractions don&#39;t interoperate, leading to bigger problems than parsing.</p>
<p>Slogan: <em>Unix and the Web Are Equally Inconvenient for Every Programmer, And
That&#39;s Good</em>.</p>
<hr/>
<p>(<strong>Help wanted</strong>: I made these SVG diagrams with <a href="https://diagrams.net">https://diagrams.net</a>, and I
want to illustrate more narrow waists.  So it would be nice to generate them
with a parameterized program.  Can a reader get me started, e.g. with a
<a href="https://pikchr.org">pikchr</a> or <a href="https://asymptote.sourceforge.io/">asymptote</a>
script?)</p>
<a name="whats-next"></a>
<h2>What&#39;s Next?</h2>
<p>I started these drafts:</p>
<ol>
<li><strong>Characteristics of Narrow Waists</strong>. Let&#39;s define the idea more precisely
and give examples.  The most important point is that narrow waists are
necessarily a <strong>compromise</strong>.
<ul>
<li>They make systems possible and feasible, not optimal.  They can be good or
bad.</li>
</ul>
</li>
<li><strong>Bytes And Text Are Essential Narrow Waists</strong>.  Why are these two diagrams
interesting and important?  I give examples from real systems.</li>
<li><strong>Slogans and Comments: Software Architecture</strong>.  Architecture is abstract
and difficult to talk about.  One good way to explain the diagrams is with
more slogans, and #<a href="https://www.oilshell.org/blog/tags.html?tag=comments#comments">comments</a> from discussion threads.</li>
</ol>
<p>While I write these articles, you may want to review <a href="https://www.oilshell.org/blog/2021/12/review-arch.html">Retrospective: Software
Architecture</a>, published
December.  It turned into a pretty good post with concrete claims and project
updates!</p>
<a name="why-write-about-narrow-waists"></a>
<h3>Why Write About Narrow Waists?</h3>
<p>My main goal is to &#34;re-justify&#34; the effort put into <a href="https://www.oilshell.org/cross-ref.html?tag=osh-language#osh-language">OSH</a>,
and the design of the new <a href="https://www.oilshell.org/cross-ref.html?tag=oil-language#oil-language">Oil language</a>.  This project has
a difficult design and implementation because it sits at the center of many
strong forces in architecture.</p>
<p>But I also think <a href="https://www.oilshell.org/cross-ref.html?tag=narrow-waist#narrow-waist">narrow waists</a> are worth describing and
thinking about independent of Oil.  It&#39;s interesting and underexplored idea.
More claims:</p>
<ul>
<li>We should move toward <strong>explicit engineering</strong> of narrow waists, rather than
letting them evolve haphazardly.</li>
<li>We should also be cognizant of <strong>&#34;game theory&#34;</strong> between billion dollar
companies.  This powerful force explains much of our shared computing
infrastructure:
<ul>
<li>I quoted <a href="https://hopl4.sigplan.org/details/hopl-4-papers/10/JavaScript-The-First-20-Years">JavaScript: The First 20
Years</a>
(<a href="https://www.pldi21.org/prerecorded_hopl.12.html">video</a>,
<a href="https://dl.acm.org/doi/10.1145/3386327">PDF</a>) in the backlog section
<a href="https://www.oilshell.org/blog/2021/12/backlog-project.html#three-analogies-dont-break-x">Don&#39;t Break
X</a>.
It talks about &#34;web browser game theory&#34; as an overwhelming force in the
development of the language.</li>
<li><a href="https://lobste.rs/s/s3l7rc">It explains X windows</a>, which I didn&#39;t
understand until very recently.</li>
</ul>
</li>
</ul>
<a name="appendices"></a>
<h2>Appendices</h2>
<a name="whats-the-history-of-this-idea"></a>
<h3>What&#39;s the History of This Idea?</h3>
<p>I suppose there are two closely related but distinct claims here:</p>
<ul>
<li>Narrow waists enable interoperability, e.g. in networking, but also in
software.</li>
<li>Narrow waists avoid writing O(M × N) amounts of code.  They make large
systems feasible to implement.</li>
</ul>
<p>I&#39;d like to better understand the history of this idea.  (You could even call
it a <em>meta-idea</em> — an idea about ideas.)  I asked for references in
previous blog posts but I don&#39;t recall any noteworthy responses.</p>
<p>I think it&#39;s complicated by the varied terminology:</p>
<ul>
<li>Narrow waist, Thin waist</li>
<li>Hourglass model</li>
<li>Distinguished layer, Spanning layer, Universal layer</li>
</ul>
<p>The earliest writing I can find on it is a 1994 article by <a href="https://en.wikipedia.org/wiki/Leonard_Kleinrock">Leonard
Kleinrock</a>, via this Berkeley
article:</p>
<ul>
<li><a href="http://bnrg.eecs.berkeley.edu/%7Erandy/Papers/InternetServices.pdf">The Evolution of Internet Services</a> (PDF) by Katz, Brewer, McCanne.
<ul>
<li>Was this ever published?  It doesn&#39;t have a date or any citations in Google
Scholar.</li>
<li>Figure 1: <em>Kleinrock&#39;s Narrow Waist Model</em>.</li>
<li>Citation 1: L. Kleinrock, et al., <em>Realizing the Information Future: The
Internet and Beyond</em>, National Research Council, National Academy Press,
Washington, DC, 1994.</li>
</ul>
</li>
</ul>
<p>I don&#39;t have a copy of this article, but I see excerpts on Google Books, and
you can buy it on Amazon:</p>
<ul>
<li><a href="https://www.google.com/books/edition/Realizing_the_Information_Future/ak04ZE464i4C?hl=en&amp;gbpv=1&amp;bsq=waist">https://www.google.com/books/edition/Realizing_the_Information_Future/ak04ZE464i4C?hl=en&amp;gbpv=1&amp;bsq=waist</a></li>
<li><a href="https://www.amazon.com/Realizing-Information-Future-Internet-Beyond/dp/0309050448">https://www.amazon.com/Realizing-Information-Future-Internet-Beyond/dp/0309050448</a></li>
</ul>
<p><strong>So I would like help</strong> finding references to narrow waists, interoperability,
and O(M  × N) code explosions!  The idea is central in compilers (IRs)
and operating systems as well, but I don&#39;t see a lot of explicit writing about
it.</p>
<p>Here are some more links I dug up:</p>
<ul>
<li><a href="https://www.swyx.io/narrow-waists">Narrow Waists: Taming Abstraction
Explosion</a> (2019). This is article covers
a lot of the same ground!  The idea is very general.  But it&#39;s also lacking
history, and it&#39;s closer to a set of notes.</li>
<li><a href="https://a16z.com/2020/04/24/a16z-podcast-the-narrow-waist-of-the-internet/">https://a16z.com/2020/04/24/a16z-podcast-the-narrow-waist-of-the-internet/</a>.
Making an analogy from the Internet to a blockchain future.
<ul>
<li>(If anyone cares, <a href="https://lobste.rs/s/15ncn9/my_first_impressions_web3">my current
view</a> is that
blockchains don&#39;t work very well, and the incentives have ruined some
interesting projects.  But I think they&#39;re possible to &#34;steel man&#34; and have
non-zero value.  I mostly care about software that works, like shell,
Python, git, and BitTorrent.)</li>
</ul>
</li>
</ul>
<a name="more-on-networking"></a>
<h3>More on Networking</h3>
<p>Here are more links that show that the <a href="https://www.oilshell.org/cross-ref.html?tag=narrow-waist#narrow-waist">narrow waist</a> idea is explicit in
networking.</p>
<ul>
<li><a href="https://www2.eecs.berkeley.edu/Pubs/TechRpts/2012/EECS-2012-5.pdf">HTTP: An Evolvable Narrow Waist for the Future
Internet</a>
(2012)</li>
</ul>
<p>This paper convinced me that the idea is important.  It has engineering
consequences and predictive power!  The fact that the narrow waist moves and
evolves is fascinating.  (Counterpoint: <a href="https://twobithistory.org/2020/06/28/rest.html">Fuck It, Overload
HTTP</a>
and <a href="https://news.ycombinator.com/item?id=29009729">comments</a>.  This article
has some substantial misunderstandings that I could write about later.  This is
another argument about <strong>local convenience vs. system integrity</strong>.)</p>
<p>Around the same time, I saw a presentation on <a href="https://named-data.net/project/execsummary/">Named Data
Networking</a> at Google, which
proposed a new and explicitly designed narrow waist for the Internet.</p>
<p>Another article about a <strong>moving</strong> waist:</p>
<ul>
<li><a href="https://tools.ietf.org/id/draft-rosenberg-internet-waist-hourglass-00.txt">UDP and TCP as the New Waist of the Internet
Hourglass</a>
(2008)
<ul>
<li><em>One of the fundamental design principles of the Internet is that IP</em> [is
the narrow waist].  <em>The preponderence of NATs and firewalls in the
Internet has changed this reality, such that UDP and TCP are now the waist
of the hourglass.</em></li>
<li>My main goal isn&#39;t to explore or debate the architecture of the Internet,
but to make an analogy, and to make claims about how we write software.</li>
</ul>
</li>
</ul>
<p>These articles make use of the model, although I see their main ideas as
experimental:</p>
<ul>
<li><a href="https://cacm.acm.org/magazines/2019/7/237714-on-the-hourglass-model/fulltext">On the Hourglass
Model</a>
(CACM 2019).  It introduces a theoretical model, with conjectures about the
&#34;deployability&#34; of new network technology.</li>
<li><a href="https://phys.org/news/2011-08-internet-architecture-hourglass-future.html">How the Internet architecture got its hourglass shape and what that means
for the future</a>
(2011).  A simulation concerning the adoption of new network technology.</li>
</ul>





</div>
  </body>
</html>
