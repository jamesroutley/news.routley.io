<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bit.kevinslin.com/p/leveraging-gpt-4-to-automate-the">Original</a>
    <h1>Lessons from Creating a VSCode Extension with GPT-4</h1>
    
    <div id="readability-page-1" class="page"><div><div><article><div class=""><div><div dir="auto"><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7c91a709-7a96-47b7-9b72-7ab6bd65ee70_1024x1024.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7c91a709-7a96-47b7-9b72-7ab6bd65ee70_1024x1024.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7c91a709-7a96-47b7-9b72-7ab6bd65ee70_1024x1024.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7c91a709-7a96-47b7-9b72-7ab6bd65ee70_1024x1024.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7c91a709-7a96-47b7-9b72-7ab6bd65ee70_1024x1024.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7c91a709-7a96-47b7-9b72-7ab6bd65ee70_1024x1024.png" width="1024" height="1024" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/7c91a709-7a96-47b7-9b72-7ab6bd65ee70_1024x1024.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1024,&#34;width&#34;:1024,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:1845583,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:false,&#34;topImage&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7c91a709-7a96-47b7-9b72-7ab6bd65ee70_1024x1024.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7c91a709-7a96-47b7-9b72-7ab6bd65ee70_1024x1024.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7c91a709-7a96-47b7-9b72-7ab6bd65ee70_1024x1024.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7c91a709-7a96-47b7-9b72-7ab6bd65ee70_1024x1024.png 1456w" sizes="100vw" fetchpriority="high"/></picture></div></a></figure></div><p>Lately, I&#39;ve been playing around with LLMs to write code. I find that they&#39;re great at generating small self-contained snippets. Unfortunately, anything more than that requires a human to evaluate LLM output and come up with suitable follow-up prompts. Most examples of &#34;GPT wrote X&#34; are this - a human serves as a REPL for the LLM, carefully coaxing it to a functional result. This is not to undersell this process - it&#39;s remarkable that it works. But can we go further? Can we use an LLM to generate ALL the code for a complex program ALL at once without any human intervention?</p><p>To test GPT-4&#39;s ability to generate a complex program, I prompted it to create a VSCode extension that lets the user adjust the heading level of selected Markdown text. This task requires:</p><p>- Domain-specific knowledge about how to scaffold and expose a program to VSCode</p><p>- Mixing multiple languages and platforms: VS Code extensions are written in TypeScript, which requires writing configuration for Typescript, Node.js, and VSCode</p><p>- Generating multiple files </p><p>- Generating scaffolding to debug, build, and run code </p><p>For this experiment, I used GPT-4 for all generation purposes. I find it to be the most effective among current-day models.</p><p><span>In addition, I make use of the </span><a href="https://github.com/smol-ai/developer" rel="">smol-ai</a><span> framework to generate code.</span></p><p><code>smol-ai</code><span> description from the README:</span></p><blockquote><p>This is a prototype of a &#34;junior developer&#34; agent (aka smol dev) that scaffolds an entire codebase out for you once you give it a product spec, but does not end the world or overpromise AGI. instead of making and maintaining specific, rigid, one-shot starters, like create-react-app, or create-nextjs-app, this is basically create-anything-app where you develop your scaffolding prompt in a tight loop with your smol dev.</p></blockquote><p><span>I like </span><code>smol-ai</code><span> because of its simplicity. The entire code generation logic is in a single Python file consisting of three primary functions:</span></p><ol><li><p>generate a list of files that are needed to carry out the prompt (eg. package.json, index.js, ...)</p></li><li><p>generate a list of shared dependencies that are needed to carry out the prompt (eg. axios, react, ...)</p></li><li><p>for each file in the generated file list, generate code that would go into the file, making use of shared dependencies if applicable</p></li></ol><p><span>Note that </span><code>smol-ai</code><span> also provides other capabilities like the ability to debug errors and generate a prompt based on the current code base. These are not explored in this post.</span></p><p>I started with a basic prompt describing my problem statement</p><pre><code><code>python main_no_modal.py &#34;a vscode extension that lets the user adjust the heading level of the selected text. it should have three commands: increase heading level, decrease heading level, and set heading level&#34;
</code></code></pre><p>Note that the prompt is short and general. I wanted to see how well GPT could do without feeding in any additional details or domain-specific knowledge beyond what was in the training set.</p><p><span>After a few minutes spent generating code, </span><code>smol-ai</code><span> created the following files:</span></p><pre><code><code>.
â”œâ”€â”€ extension
â”‚Â Â  â”œâ”€â”€ package.json
â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ commands
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ decreaseHeadingLevel.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ increaseHeadingLevel.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ setHeadingLevel.ts
â”‚Â Â  â”‚Â Â  â””â”€â”€ extension.ts
â””â”€â”€ shared_dependencies.md
</code></code></pre><p><span>Note that </span><code>shared_dependencies.md</code><span> is created as a best guess of what common dependencies will be. In our case, it created a file with the following contents:</span></p><pre><code><code>the app is: a vscode extension that lets the user adjust the heading level of the selected text. it should have three commands: increase heading level, decrease heading level, and set heading level

the files we have decided to generate are: tsconfig.json, package.json, utils.ts, extension.ts

Shared dependencies:

1. Exported variables:
   - adjustHeadingLevel (from utils.ts)

2. Data schemas:
   - None

3. ID names of DOM elements:
   - None

4. Message names:
   - None

5. Function names:
   - increaseHeadingLevel
   - decreaseHeadingLevel
   - setHeadingLevel

6. Dependencies:
    - None
</code></code></pre><p><code>extension.ts</code><span> is the entry point of a vscode extension. In it, we register the three commands that we specified in the prompt.</span></p><pre><code><code>import * as vscode from &#39;vscode&#39;;
import { increaseHeadingLevel } from &#39;./commands/increaseHeadingLevel&#39;;
import { decreaseHeadingLevel } from &#39;./commands/decreaseHeadingLevel&#39;;
import { setHeadingLevel } from &#39;./commands/setHeadingLevel&#39;;

export function activate(context: vscode.ExtensionContext) {
    context.subscriptions.push(
        vscode.commands.registerCommand(&#39;extension.increaseHeadingLevel&#39;, increaseHeadingLevel),
        vscode.commands.registerCommand(&#39;extension.decreaseHeadingLevel&#39;, decreaseHeadingLevel),
        vscode.commands.registerCommand(&#39;extension.setHeadingLevel&#39;, setHeadingLevel)
    );
}

export function deactivate() {}
</code></code></pre><p><span>Below is the logic inside of </span><code>decreaseHeadingLevel.ts</code></p><pre><code><code>import * as vscode from &#39;vscode&#39;;

export async function decreaseHeadingLevel() {
    const editor = vscode.window.activeTextEditor;
    if (!editor) {
        return;
    }

    const document = editor.document;
    const selection = editor.selection;
    const selectedText = document.getText(selection);

    const headingRegex = /^(#+)\s(.*)$/;
    const match = selectedText.match(headingRegex);

    if (!match) {
        vscode.window.showErrorMessage(&#39;Invalid selection. Please select a heading to decrease its level.&#39;);
        return;
    }

    const currentLevel = match[1].length;
    if (currentLevel === 1) {
        vscode.window.showErrorMessage(&#39;Cannot decrease heading level. Already at the lowest level.&#39;);
        return;
    }

    const newLevel = currentLevel - 1;
    const newHeading = &#39;#&#39;.repeat(newLevel) + &#39; &#39; + match[2];

    await editor.edit((editBuilder) =&gt; {
        editBuilder.replace(selection, newHeading);
    });
}
</code></code></pre><p>The code checks for an active editor and if one exists, gets the selected text and looks for a markdown heading via regex. If a header is found and the current header level isn&#39;t already at the lowest level, it decreases the heading level.</p><p>At first glance, there is nothing amiss with the logic. It executes the command and checks for edge cases. It even provides helpful error messages which already puts it ahead of most human-generated programs...</p><p>To test this extension, we need to successfully execute the following steps:</p><ol><li><p>Install Dependencies</p></li><li><p>Compile Code</p></li><li><p>Run Extension</p></li></ol><p>We run into our first issue when trying to install dependencies.</p><pre><code><code>$ yarn

Couldn&#39;t find any versions for &#34;vscode-test&#34; that matches &#34;^1.6.2&#34;
? Please choose a version of &#34;vscode-test&#34; from this list: (Use arrow keys)
â¯ 1.6.1
</code></code></pre><p><span>An inspection of </span><code>package.json</code><span> returns the following</span></p><pre><code><code>{
  &#34;name&#34;: &#34;adjust-heading-level&#34;,
  ...
  &#34;engines&#34;: {
    &#34;vscode&#34;: &#34;^1.62.0&#34;
  },
  &#34;devDependencies&#34;: {
    &#34;@types/node&#34;: &#34;^14.17.0&#34;,
    &#34;@types/vscode&#34;: &#34;^1.62.0&#34;,
    &#34;typescript&#34;: &#34;^4.4.2&#34;,
    &#34;vscode&#34;: &#34;^1.1.37&#34;,
    &#34;vscode-test&#34;: &#34;^1.6.2&#34;
  },
}
</code></code></pre><p><span>The vscode engine determines the minimum version of vscode. The present-day (as of 2023-05-23) engine version is </span><code>1.78</code><span>. The </span><code>1.62.0</code><span> version was </span><a href="https://code.visualstudio.com/updates/v1_62" rel="">released on October 21st, 2021</a></p><p><span>This corresponds to GPT4&#39;s </span><a href="https://openai.com/research/gpt-4" rel="">knowledge cutoff date</a><span>:</span></p><blockquote><p>GPT-4 generally lacks knowledge of events that have occurred after the vast majority of its data cut off (September 2021)</p></blockquote><p><span>The </span><code>vscode-test</code><span> version of </span><code>1.6.2</code><span> seems suspiciously similar to </span><code>1.62</code><span> which indicates that GPT likely hallucinated the numbers.</span></p><p>In any case, this is easy enough to fix by specifying the correct version number and re-installing</p><pre><code><code>-   &#34;vscode-test&#34;: &#34;^1.6.2&#34;
+   &#34;vscode-test&#34;: &#34;^1.6.1&#34;
</code></code></pre><p>Re-running the install process is successful the second time around.</p><pre><code><code>$ yarn

...
[3/5] ğŸšš  Fetching packages...
[4/5] ğŸ”—  Linking dependencies...
[5/5] ğŸ”¨  Building fresh packages...
âœ¨  Done in 4.31s.
</code></code></pre><p><span>Because typescript is a compiled language, we need to execute a build step to compile the code to javascript. The </span><code>package.json</code><span> comes with the following scripts:</span></p><pre><code><code>&#34;scripts&#34;: {
    &#34;vscode:prepublish&#34;: &#34;npm run compile&#34;,
    &#34;compile&#34;: &#34;tsc -p ./&#34;,
    &#34;watch&#34;: &#34;tsc -watch -p ./&#34;,
    &#34;postinstall&#34;: &#34;node ./node_modules/vscode/bin/install&#34;,
    &#34;test&#34;: &#34;npm run compile &amp;&amp; node ./node_modules/vscode/bin/test&#34;
  },
</code></code></pre><p><span>We can build the code by running the </span><code>compile</code><span> script. This is where we run into our next issue:</span></p><pre><code><code>$ yarn compile
warning package.json: No license field
warning adjust-heading-level@0.1.0: The engine &#34;vscode&#34; appears to be invalid.
$ tsc -p ./
error TS5057: Cannot find a tsconfig.json file at the specified directory: &#39;./&#39;.
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
</code></code></pre><p><span>Typescript requires a </span><code>tsconfig.json</code><span> file to compile into javascript. If you remember our initial file layout, there is no </span><code>tsconfig.json</code><span> file.</span></p><pre><code><code>.
â”œâ”€â”€ extension
â”‚Â Â  â”œâ”€â”€ package.json
â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ commands
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ decreaseHeadingLevel.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ increaseHeadingLevel.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ setHeadingLevel.ts
â”‚Â Â  â”‚Â Â  â””â”€â”€ extension.ts
â””â”€â”€ shared_dependencies.md
</code></code></pre><p>We can remediate this by adding the config and re-building. But now we run into more issues:</p><pre><code><code>$ tsc --init
$ yarn compile

src/commands/decreaseHeadingLevel.ts:1:25 - error TS2307: Cannot find module &#39;vscode&#39; or its corresponding type declarations.

1 import * as vscode from &#39;vscode&#39;;
                          ~~~~~~~~

src/commands/decreaseHeadingLevel.ts:30:24 - error TS7006: Parameter &#39;editBuilder&#39; implicitly has an &#39;any&#39; type.

30     await editor.edit((editBuilder) =&gt; {
                          ~~~~~~~~~~~

src/commands/increaseHeadingLevel.ts:1:25 - error TS2307: Cannot find module &#39;vscode&#39; or its corresponding type declarations.

...

Found 7 errors
</code></code></pre><p><span>The reason typescript can&#39;t find the module </span><code>vscode</code><span> is because of the syntax we use for import statements:</span></p><pre><code><code>// this is failing
import * as vscode from &#39;vscode&#39;;

// this would work
import vscode from &#39;vscode&#39;;
</code></code></pre><p><span>The reason for the different syntax comes from the </span><a href="https://blog.logrocket.com/commonjs-vs-es-modules-node-js/" rel="">differences</a><span> between </span><code>CommonJs</code><span> and </span><code>ES Modules</code><span> and how they export dependencies as well as how typescript transpiles those exports. The </span><s>maddening hellscape</s><span> quirks in module compatibility can be a blog post unto itself - for now, we can fix the issue by disabling </span><code>esModuleInterop</code><span> inside of </span><code>tsconfig.json</code></p><pre><code><code>@@ -71,7 +71,7 @@
-    &#34;esModuleInterop&#34;: true,                             /* Emit additional JavaScript to ease support for importing CommonJS modules. This enables &#39;allowSyntheticDefaultImports&#39; for type compatibility. */
+    &#34;esModuleInterop&#34;: false,                             /* Emit additional JavaScript to ease support for importing CommonJS modules. This enables &#39;allowSyntheticDefaultImports&#39; for type compatibility. */
</code></code></pre><p><span>Note that </span><code>esModuleInterop</code><span> was changed to </span><code>true</code><span> by default since typescript 4.4. This was released on March 15, 2022 - after GPT4&#39;s knowledge cutoff date.</span></p><p>Let&#39;s try building again. Just one more error this time:</p><pre><code><code>$ yarn compile

src/commands/setHeadingLevel.ts:2:10 - error TS2305: Module &#39;&#34;../extension&#34;&#39; has no exported member &#39;adjustHeadingLevel&#39;.

2 import { adjustHeadingLevel } from &#39;../extension&#39;;

Found 1 error.
</code></code></pre><p>This last error comes from trying to import a function that does not exist.</p><p><span>Specifically, the following logic in </span><code>setHeadingLevel.ts</code><span>:</span></p><pre><code><code>import * as vscode from &#39;vscode&#39;;
import { adjustHeadingLevel } from &#39;../extension&#39;;

export async function setHeadingLevel() {
  ...
}
</code></code></pre><p><span>GPT is prone to </span><s>lie</s><span> be optimistic about declaring its dependencies. It sometimes calls or imports functions that do not exist. This is one of those cases.</span></p><p><span>We can fix this by removing the dependency and manually adding the logic inside of </span><code>setHeadingLevel</code></p><pre><code><code>@@ -1,5 +1,4 @@
 import * as vscode from &#39;vscode&#39;;
-import { adjustHeadingLevel } from &#39;../extension&#39;;
 
 export async function setHeadingLevel() {
     const editor = vscode.window.activeTextEditor;
@@ -14,6 +13,12 @@ export async function setHeadingLevel() {
         vscode.window.showErrorMessage(&#39;invalidSelection&#39;);
         return;
     }
+    const headingRegex = /^(#+)\s(.*)$/;
+    const match = selectedText.match(headingRegex);
+    if (!match) {
+        vscode.window.showErrorMessage(&#39;Invalid selection.&#39;);
+        return;
+    }
 
     const inputOptions: vscode.InputBoxOptions = {
         prompt: &#39;setHeadingLevelPrompt&#39;,
@@ -31,6 +36,16 @@ export async function setHeadingLevel() {
 
     if (headingLevel) {
         const newHeadingLevel = parseInt(headingLevel);
-        adjustHeadingLevel(editor, selection, selectedText, newHeadingLevel);
+    
+        const newHeading = &#39;#&#39;.repeat(newHeadingLevel) + &#39; &#39; + match[2];
+    
+        await editor.edit((editBuilder) =&gt; {
+            editBuilder.replace(selection, newHeading);
+        });
     }
 }
</code></code></pre><p><span>Note that most of the code was lifted from </span><code>decreaseHeadingLevel.ts</code><span>.</span></p><p>Lets build again. This time, it&#39;s successful ğŸ‰</p><pre><code><code>$ tsc -p ./
âœ¨  Done in 0.80s.
</code></code></pre><p>But does it run?</p><p>Note that GPT provided no instructions on how to run the extension. Or on how to install or build the extension for that matter. It is simple enough to do if you&#39;ve built vscode extensions before but this can be a barrier to entry for newcomers.</p><p><span>Running a vscode extension requires that you go to the &#34;Run and Debug&#34; panel and launch the </span><code>vscode extension</code><span> task when the </span><code>extension.ts</code><span> file is active in the editor.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdf93d08c-586b-448f-ac3e-a23b46347c12_2918x1852.jpeg" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdf93d08c-586b-448f-ac3e-a23b46347c12_2918x1852.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdf93d08c-586b-448f-ac3e-a23b46347c12_2918x1852.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdf93d08c-586b-448f-ac3e-a23b46347c12_2918x1852.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdf93d08c-586b-448f-ac3e-a23b46347c12_2918x1852.jpeg 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdf93d08c-586b-448f-ac3e-a23b46347c12_2918x1852.jpeg" width="1456" height="924" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/df93d08c-586b-448f-ac3e-a23b46347c12_2918x1852.jpeg&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:924,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:null,&#34;alt&#34;:&#34;Run VSCode Extension&#34;,&#34;title&#34;:null,&#34;type&#34;:null,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="Run VSCode Extension" title="Run VSCode Extension" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdf93d08c-586b-448f-ac3e-a23b46347c12_2918x1852.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdf93d08c-586b-448f-ac3e-a23b46347c12_2918x1852.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdf93d08c-586b-448f-ac3e-a23b46347c12_2918x1852.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdf93d08c-586b-448f-ac3e-a23b46347c12_2918x1852.jpeg 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p>This launches a new vscode window with our extension installed. This also errors out as soon as I tried invoking a command.</p><pre><code><code>Command &#39;Increase Heading Level&#39; resulted in an error command &#39;adjust-heading-level. &#39;increaseHeadingLevel&#39; was not found
</code></code></pre><p><span>VSCode knows about commands when they are declared inside of </span><code>package.json</code><span>.</span></p><p><span>Our </span><code>package.json</code><span> declares the following commands:</span></p><pre><code><code>  &#34;activationEvents&#34;: [
    &#34;onCommand:adjust-heading-level.increaseHeadingLevel&#34;,
    &#34;onCommand:adjust-heading-level.decreaseHeadingLevel&#34;,
    &#34;onCommand:adjust-heading-level.setHeadingLevel&#34;
  ],
  ...
  &#34;contributes&#34;: {
    &#34;commands&#34;: [
      {
        &#34;command&#34;: &#34;adjust-heading-level.increaseHeadingLevel&#34;,
        &#34;title&#34;: &#34;Increase Heading Level&#34;
      },
      {
        &#34;command&#34;: &#34;adjust-heading-level.decreaseHeadingLevel&#34;,
        &#34;title&#34;: &#34;Decrease Heading Level&#34;
      },
      {
        &#34;command&#34;: &#34;adjust-heading-level.setHeadingLevel&#34;,
        &#34;title&#34;: &#34;Set Heading Level&#34;
      }
    ]
  }
</code></code></pre><p><span>After declaring inside of </span><code>package.json</code><span>, these commands also need to be registered inside the extension.</span></p><p><span>Our </span><code>extension.ts</code></p><pre><code><code>export function activate(context: vscode.ExtensionContext) {
    context.subscriptions.push(
        vscode.commands.registerCommand(&#39;extension.increaseHeadingLevel&#39;, increaseHeadingLevel),
        vscode.commands.registerCommand(&#39;extension.decreaseHeadingLevel&#39;, decreaseHeadingLevel),
        vscode.commands.registerCommand(&#39;extension.setHeadingLevel&#39;, setHeadingLevel)
    );
}
</code></code></pre><p>Do you see the issue?</p><p><span>The typescript file declares commands as </span><code>extension.{COMMAND}</code><span> but the </span><code>package.json</code><span> declares them as </span><code>adjust-heading-level.{COMMAND}</code></p><p><span>We can fix this by adjusting </span><code>package.json</code><span> to match the code. While the fix itself is simple, being able to diagnose the issue correctly takes some domain knowledge in knowing where to look.</span></p><pre><code><code>@@ -1,5 +1,5 @@
 {
   &#34;displayName&#34;: &#34;Adjust Heading Level&#34;,
   &#34;description&#34;: &#34;A VSCode extension that lets the user adjust the heading level of the selected text.&#34;,
   &#34;version&#34;: &#34;0.1.0&#34;,
@@ -10,23 +10,20 @@
     &#34;Other&#34;
   ],
   &#34;activationEvents&#34;: [
-    &#34;onCommand:adjust-heading-level.increaseHeadingLevel&#34;,
-    &#34;onCommand:adjust-heading-level.decreaseHeadingLevel&#34;,
-    &#34;onCommand:adjust-heading-level.setHeadingLevel&#34;
   ],
   &#34;main&#34;: &#34;./src/extension.js&#34;,
   &#34;contributes&#34;: {
     &#34;commands&#34;: [
       {
-        &#34;command&#34;: &#34;adjust-heading-level.increaseHeadingLevel&#34;,
+        &#34;command&#34;: &#34;extension.increaseHeadingLevel&#34;,
         &#34;title&#34;: &#34;Increase Heading Level&#34;
       },
       {
-        &#34;command&#34;: &#34;adjust-heading-level.decreaseHeadingLevel&#34;,
+        &#34;command&#34;: &#34;extension.decreaseHeadingLevel&#34;,
         &#34;title&#34;: &#34;Decrease Heading Level&#34;
       },
       {
-        &#34;command&#34;: &#34;adjust-heading-level.setHeadingLevel&#34;,
+        &#34;command&#34;: &#34;extension.setHeadingLevel&#34;,
         &#34;title&#34;: &#34;Set Heading Level&#34;
       }
     ]
</code></code></pre><blockquote><p><span>NOTE: I also used this to remove the </span><code>activationEvents</code><span> - these determine when a vscode extension trigger activates. For command-based activations, vscode is now able to detect them automatically and so no longer needs to be manually declared</span></p></blockquote><p>Let&#39;s try running again and increasing the header level.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7ed37224-9ceb-4154-81c1-9935c97ab6fa_1672x1080.gif" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7ed37224-9ceb-4154-81c1-9935c97ab6fa_1672x1080.gif 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7ed37224-9ceb-4154-81c1-9935c97ab6fa_1672x1080.gif 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7ed37224-9ceb-4154-81c1-9935c97ab6fa_1672x1080.gif 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7ed37224-9ceb-4154-81c1-9935c97ab6fa_1672x1080.gif 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7ed37224-9ceb-4154-81c1-9935c97ab6fa_1672x1080.gif" width="1456" height="940" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/7ed37224-9ceb-4154-81c1-9935c97ab6fa_1672x1080.gif&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:940,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:272931,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/gif&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7ed37224-9ceb-4154-81c1-9935c97ab6fa_1672x1080.gif 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7ed37224-9ceb-4154-81c1-9935c97ab6fa_1672x1080.gif 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7ed37224-9ceb-4154-81c1-9935c97ab6fa_1672x1080.gif 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7ed37224-9ceb-4154-81c1-9935c97ab6fa_1672x1080.gif 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p>Well, that&#39;s not supposed to happen ğŸ˜Ÿ</p><p>Instead of increasing the header, we are getting the header level decreased.</p><p><span>Let&#39;s take a look at </span><code>increaseHeadingLevel.ts</code></p><pre><code><code>import * as vscode from &#39;vscode&#39;;

export async function increaseHeadingLevel() {
    const editor = vscode.window.activeTextEditor;
    if (!editor) {
        return;
    }

    const document = editor.document;
    const selection = editor.selection;
    const selectedText = document.getText(selection);

    const headingRegex = /^(#+)\s(.*)$/;
    const match = selectedText.match(headingRegex);

    if (!match) {
        vscode.window.showErrorMessage(&#39;Invalid selection. Please select a valid heading.&#39;);
        return;
    }

    const currentLevel = match[1].length;
    const newLevel = Math.max(1, currentLevel - 1);
    const newText = &#39;#&#39;.repeat(newLevel) + &#39; &#39; + match[2];

    await editor.edit((editBuilder) =&gt; {
        editBuilder.replace(selection, newText);
    });
}
</code></code></pre><p>Do you see the issue?</p><p>There is a bug caused by a single character diff.</p><pre><code><code>@@ -19,7 +19,7 @@ export async function increaseHeadingLevel() {
     }
 
     const currentLevel = match[1].length;
-    const newLevel = Math.max(1, currentLevel - 1);
+    const newLevel = Math.max(1, currentLevel + 1);
     const newText = &#39;#&#39;.repeat(newLevel) + &#39; &#39; + match[2];
</code></code></pre><p>Let&#39;s compile and run it again.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0cd3cf23-41b6-4400-876d-aad36a69ab6a_1672x1080.gif" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0cd3cf23-41b6-4400-876d-aad36a69ab6a_1672x1080.gif 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0cd3cf23-41b6-4400-876d-aad36a69ab6a_1672x1080.gif 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0cd3cf23-41b6-4400-876d-aad36a69ab6a_1672x1080.gif 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0cd3cf23-41b6-4400-876d-aad36a69ab6a_1672x1080.gif 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0cd3cf23-41b6-4400-876d-aad36a69ab6a_1672x1080.gif" width="1456" height="940" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/0cd3cf23-41b6-4400-876d-aad36a69ab6a_1672x1080.gif&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:940,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:1142319,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/gif&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0cd3cf23-41b6-4400-876d-aad36a69ab6a_1672x1080.gif 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0cd3cf23-41b6-4400-876d-aad36a69ab6a_1672x1080.gif 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0cd3cf23-41b6-4400-876d-aad36a69ab6a_1672x1080.gif 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0cd3cf23-41b6-4400-876d-aad36a69ab6a_1672x1080.gif 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p>It works ğŸ¥³</p><p>So how did we do? We got a working extension. We got it to accomplish the goal set out in our prompt.</p><p>The journey to this point was not &#34;automatic&#34;. We ran into many issues along the way. Lacking prior knowledge of typescript, node.js and vscode, these issues would have taken a while to debug.</p><p>And even though the code we were able to generate working code, there are still many improvements to be made:</p><ul><li><p>there are no instructions on how to develop, use, or publish the extension</p></li><li><p><span>there is no </span><code>.gitignore</code><span> for typescript/javascript/vscode artifacts</span></p></li><li><p><span>there is no </span><code>launch.json</code><span> file that configures running the extension in development</span></p></li><li><p>there are no tests</p></li><li><p>there is no code reuse</p></li></ul><p>GPT generated 9 files that cover ~100 lines of typescript, ~180 lines json, and 17 lines of markdown.</p><pre><code><code>$ cloc --exclude-dir=node_modules,out --not-match-f=package-lock.json --not-match-f=prompt.md --include-ext=ts,json,md .
      15 text files.
      13 unique files.
       7 files ignored.

github.com/AlDanial/cloc v 1.92  T=0.01 s (986.5 files/s, 36610.4 lines/s)
-------------------------------------------------------------------------------
Language                     files          blank        comment           code
-------------------------------------------------------------------------------
JSON                             4              8              0            181
TypeScript                       4             22              0             98
Markdown                         1              8              0             17
-------------------------------------------------------------------------------
SUM:                             9             38              0            296
-------------------------------------------------------------------------------
</code></code></pre><p>The final file tree</p><pre><code><code>$ tree --gitfile extension/.gitignore
.
â”œâ”€â”€ extension
â”‚Â Â  â”œâ”€â”€ package.json
â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ commands
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ decreaseHeadingLevel.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ increaseHeadingLevel.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ setHeadingLevel.ts
â”‚Â Â  â”‚Â Â  â””â”€â”€ extension.ts 
â”‚Â Â  â”œâ”€â”€ tsconfig.json
â”‚Â Â  â””â”€â”€ yarn.lock
â”œâ”€â”€ prompt.md
â””â”€â”€ shared_dependencies.md
</code></code></pre><p>Out of the ~300 lines generated, we had to modify/add ~18 lines in order to make everything work.</p><p>GPT was able to generate most of the code using a naive prompt with no domain-specific context.</p><p>Some things to note:</p><ul><li><p>GPT4 does great with code in its index but will likely generate bad logic if the underlying specs have changed since its knowledge cutoff date (September 2021)</p></li><li><p><span>GPT4 can hallucinate subtle bugs. In the </span><code>increaseHeadingLevel.ts</code><span> case, it was a one-character difference that caused the extension to do the exact opposite of what the command was supposed to do</span></p></li><li><p>GPT4 is great at scaffolding boilerplate but domain expertise still matters (for now). This is especially true when building on the tech that has changed since GPT4&#39;s cutoff date</p></li><li><p>GPT4 introduces yet another abstraction layer for programming. We now have 7 translation layers for the case of writing typescript (which can easily be doubled when involving containers or VMs) ğŸ¤¦â€â™‚</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18829857-0b0e-4aea-9528-605d1b32d071_2940x1018.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18829857-0b0e-4aea-9528-605d1b32d071_2940x1018.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18829857-0b0e-4aea-9528-605d1b32d071_2940x1018.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18829857-0b0e-4aea-9528-605d1b32d071_2940x1018.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18829857-0b0e-4aea-9528-605d1b32d071_2940x1018.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18829857-0b0e-4aea-9528-605d1b32d071_2940x1018.png" width="1456" height="504" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/18829857-0b0e-4aea-9528-605d1b32d071_2940x1018.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:504,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:181211,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18829857-0b0e-4aea-9528-605d1b32d071_2940x1018.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18829857-0b0e-4aea-9528-605d1b32d071_2940x1018.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18829857-0b0e-4aea-9528-605d1b32d071_2940x1018.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18829857-0b0e-4aea-9528-605d1b32d071_2940x1018.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>Turtlesâ€¦</figcaption></figure></div></li></ul><p>I did the initial experiment with a naive general prompt and no additional context. There is lots of room for improvement. Some next steps:</p><ul><li><p>every issue that we encountered when trying to run the extension, include it as a detail in the prompt for GPT to watch out for</p><ul><li><p>generalize this by indexing and summarizing the vscode extension docs to mitigate for new information that is not in GPT&#39;s current index</p><ul><li><p>explore doing this by chaining an LLM that has access to today&#39;s context (eg. Bard) with GPT</p></li></ul></li></ul></li><li><p>generate tests to validate logic and have GPT autocorrect itself if tests fail</p></li><li><p>generate a checklist for what a high-quality vscode extension looks like and have GPT verify and autocorrect the artifacts it generates</p></li></ul><blockquote><p>NOTE: I&#39;ve already run a subset of these steps and was able to get the error count to zero on the first generation. Will need to see if it generalizes to other examples. Look out for details in a future post</p></blockquote><p>I&#39;m a solo YC founder that is currently pivoting into building useful tools in the LLM space. If this is something that you&#39;re passionate about and want to be a part of, either as a cofounder (I&#39;m looking for someone with a technical background in sales/product/go-to-market) or as a founding team member, please reach out.</p></div></div></div></article></div></div></div>
  </body>
</html>
