<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.empirical.health/blog/apple-watch-cardio-fitness-accuracy-vo2max/">Original</a>
    <h1>How Apple Watch estimates VO2Max within 1.2 ml/kg/min without a treadmill test</h1>
    
    <div id="readability-page-1" class="page"><div> <div> <p> <time datetime="2024-10-22T00:00:00.000Z"> Oct 22, 2024 </time> </p> <h2>How Apple Watch estimates VO2Max to within 1.2 ml/kg/min without a treadmill test</h2>  <hr/> </div>  <p><a href="https://www.empirical.health/metrics/vo2-max">VO2Max</a> is a powerful metric of longevity: every <strong>1 ml/kg/min</strong> increase in VO2 max reduces risk of death by <strong>9 percent.</strong></p>
<p>Clinical testing of VO2Max typically uses a respiratory mask during intense exercise, such as a treadmill or cycling. But wearables like Apple Watch estimate <strong>cardio fitness</strong> (their version of VO2 max) to within an accuracy of 1.2 ml/kg/min <em>without</em> requiring a mask.</p>
<p>How do they do that? This article explains the science behind VO2 max, how the Apple Watch’s cardio fitness algorithm works (based on published details from 2021 and 2023 papers), and concrete data from the study used to validate its accuracy. Along the way we’ll cover how to combine <strong>physiological ODEs</strong> (ordinary differential equations) with flexible neural networks,
9-panel plots used in VO2 max testing, and more.</p>
<p>For details on how to actually <em>use</em> VO2Max, its link to longevity, and how to get a cardio fitness measurement, see our guide to <a href="https://www.empirical.health/metrics/vo2-max">Apple Watch’s cardio fitness metric</a>.</p>
<h2 id="primer-how-vo2max-is-measured-in-the-lab"><a href="#primer-how-vo2max-is-measured-in-the-lab">Primer: how VO2Max is measured in the lab</a></h2>
<p>Before we get into how Apple Watch algorithm <em>estimates</em> VO2Max, we have to first define how VO2Max is actually
<em>measured</em> in the lab.</p>
<p>VO₂ Max is defined as the <strong>max</strong>imum <strong>v</strong>olume of <strong>O₂</strong> (oxygen) the body can utilize during intense exercise. It’s
measured during a cardiopulmonary exercise test (CPET). During a CPET, you wear a respiratory mask while exercising (e.g., cycling or treadmill) at
a steadily increasing intensity. As the work intensity rises, you consume more O₂ (oxygen), expell more CO₂ (carbon dioxide),
and your heart rate rises.</p>
<p><img src="https://www.empirical.health/_astro/vo2max-respiratory-mask.DkKjCiJ8_1mF5VB.webp" alt="VO2max testing using a respiratory mask" width="500" height="500" loading="lazy" decoding="async"/></p>
<p>At some point, the intensity of the workout becomes high enough that your muscles need more oxygen than
your heart and lungs can supply. Your muscle cells are then forced to switch from aerobic to anerobic
energy production, so that CO₂ continues increasing while O₂ pleateaus. At least, this is the “idealized” test
situation—in practice, O₂ may not actually reach a plateau and the test may end when the the ratio of CO₂
to O₂ reaches 1.1, when the patient feels breathless, when an ECG shows signs of stress, etc.</p>
<p>This whole process produces a nine-panel plot, which shows various combinations of O₂ consumed, CO₂ expelled,
intensity of exercise (in watts), heart rate, breathing rate, blood oxygen saturation, and so on.</p>
<p><img src="https://www.empirical.health/_astro/cpet-9-panel.MP2ZG9N8_AJMRe.webp" alt="CPET 9-part panel" width="721" height="721" loading="lazy" decoding="async"/></p>
<p>In panel 3, you can see how both O₂ (red) and CO₂ (blue) increase as the exercise intensity ramps up (black).
There’s a point around 11 minutes where the two lines diverge (this is the anaerobic threshold).
Panel 5 shows that heart rate increases roughly in proportion to O₂.</p>

<p>If you wanted to estimate VO2Max without actually measuring O₂ and CO₂, how would you do it? You can make use
of two facts:</p>
<ol>
<li>Heart rate and O₂ are proportionate: as your heart rate increases, you’re consuming more oxygen.</li>
<li>You can estimate work (in watts) if you know the person’s pace and body weight.</li>
</ol>
<p>Various methods have been proposed in the medical literature, and as we’ll see, Apple’s algorithm appears to be a more
sophisticated version of those using neural networks combined with biophysical ordinary differential equations (ODEs).</p>
<h2 id="the-rockport-cardio-fitness-test-a-simple-method-from-1987"><a href="#the-rockport-cardio-fitness-test-a-simple-method-from-1987">The Rockport cardio fitness test: a simple method from 1987</a></h2>
<p>The <a href="https://pubmed.ncbi.nlm.nih.gov/3600239/">Rockport fitness walking test</a> was proposed in 1987 to estimate
VO2Max. Subjects performed multiple 1-mile walk tests as fast as possible. The heart rate and completion time were placed
into a linear regression, which yielded this formula to calculate VO2Max based on each subject’s weight, age, sex,
fastest time, and heart rate:</p>
<blockquote>
<p>VO2max = 6.9652 + (0.0091<em>weight) - (0.0257</em>age) + (0.5955<em>sex) - (0.2240</em>time) - (0.0115*heart_rate)</p>
</blockquote>
<p>The accuracy was good (r=0.92 in the initial study). As we’ll see in the next section, Apple appears to be using
a similar scientific basis but with a more sophisticated algorithm.</p>
<h2 id="apple-watch-estimates-cardio-fitness-using-heart-rate-and-gps-as-inputs"><a href="#apple-watch-estimates-cardio-fitness-using-heart-rate-and-gps-as-inputs">Apple Watch estimates cardio fitness using heart rate and GPS as inputs</a></h2>
<p>Apple Watch requires two things to produce a cardio fitness estimate:</p>
<ul>
<li>Outdoor walking/running/hiking workout on flat ground (5% grade or less).</li>
<li>Heart rate needs to increase more than 30% of the way between your resting heart rate and max heart rate. For example, if your resting heart rate is 60bpm and your max heart rate is 180bpm, you’d need to reach a heart rate of 96bpm or above to get a VO2Max estimate.</li>
</ul>
<p>These suggest they’re estimating both work and heart rate response to exercise—similar in its basic science to the Rockport test.</p>
<h2 id="estimating-vo2max-with-physiological-odes-and-neural-networks"><a href="#estimating-vo2max-with-physiological-odes-and-neural-networks">Estimating VO2Max with physiological ODEs and neural networks</a></h2>
<p><strong>Note</strong>: <em>some background in neural networks is helpful to understand the following section. If you don’t want the details,
feel free to just skip to the next section.</em></p>
<p>In 2023, researchers from Apple published a <a href="https://www.nature.com/articles/s41746-023-00926-4">paper on using biophysical ODEs for fitness estimation using wearables</a>, alongside an <a href="https://github.com/apple/ml-heart-rate-models/blob/main/ode/modules_cnn.py">open source repo with some Torch neural networks</a>. This gives a climpse into how modern deep learning algorithms can be used to improve upon the basic science of the Rockport test.</p>
<p>The paper starts by defining heart rate and oxygen response to exercise using a set of <strong>ordinary differential equations (ODEs)</strong>:</p>
<p><img src="https://www.empirical.health/_astro/biophysical_odes.nhB4VhAw_8NrtW.webp" alt="Biophysical ODEs to describe Apple Watch heart rate and VO2 Max" width="520" height="139" loading="lazy" decoding="async"/></p>
<p>Here, I(t) is exercise intensity at time t, f(I(t)) is the instantaneous demand for oxygen, D(t) is oxygen demand at time t,
and HR(t) is heart rate at time t. A, B, alpha, beta are learned parameters.</p>
<p>The first equation tells us how the oxygen demand changes over time to match the instantaneous demand from the intensity of the workout. The second equation tells us how drive heart rate toward the pace required to meet that oxygen demand. It includes factors that describe how fast the heart can adapt (A), how difficult it is to reach the maximum heart rate (beta), and
how much time it takes to rest down to the resting heart rate (alpha).</p>
<p>Each person’s fitness at a given time is characterized by seven physiological parameters: A, B, alpha, beta, f, HRmin, and HRmax.</p>
<p>Rather than estimate these parameters directly, the researchers trained a <strong>neural network</strong> that predicts a person’s
entire heart rate response to exercise given a latent vector z. The paper doesn’t specify z’s dimension, but in the
open source code z is a 32-dimensional vector. They thain trained additional neural networks to predict each physiological parameter as a function of that latent fector: A(z), B(z), alpha(z), and so on.</p>
<p><img src="https://www.empirical.health/_astro/vo2-max-encoder.DYPF8m0L_ZNa3A9.webp" alt="Neural encoder for physiological parameters" width="681" height="283" loading="lazy" decoding="async"/></p>
<p>These physiological parameters were then fed into a linear regression to predict VO2 Max. The error was about 5% (not bad).
What’s interesting is that the model is interpretable as a result of going through the physiological ODE. For example,
you can see an obvious correlation between the predicted A, B, alpha, and beta and VO2 Max in the plots below:</p>
<p><img src="https://www.empirical.health/_astro/vo2-max-vs-physiological-parameters.B9janclc_1I9uTA.webp" alt="Apple Watch ODE vs VO2Max" width="924" height="579" loading="lazy" decoding="async"/></p>
<h2 id="apple-watchs-cardio-fitness-algorithm-was-validated-in-a-study-with-221-participants"><a href="#apple-watchs-cardio-fitness-algorithm-was-validated-in-a-study-with-221-participants">Apple Watch’s cardio fitness algorithm was validated in a study with 221 participants</a></h2>
<p>Apple itself ran a study validating the algorithm, with 534 participants for development and 221 for validation. The
algorithm was surprisingly accurate, with a mean error of 1.2 to 1.4 ml/kg/min and a reliability coefficient (ICC) around 0.86–0.89.</p>
<p>You can see a plot of actual VO2Max (x axis) vs the Apple Watch’s estimate (y axis). It’s pretty good!
<img src="https://www.empirical.health/_astro/vo2max-accuracy.CM5HuM-6_ZDw8uo.webp" alt="VO2max vs actual" width="380" height="346" loading="lazy" decoding="async"/></p>
<p>However, the algorithm does have limitations for people with certain health conditions and on certain medications. From Apple’s own <a href="https://www.apple.com/healthcare/docs/site/Using_Apple_Watch_to_Estimate_Cardio_Fitness_with_VO2_max.pdf">report</a>:</p>
<blockquote>
<p>Other medical conditions can also decrease the accuracy of VO2
max estimates on Apple Watch. These include medical conditions or devices that decouple heart rate from
movement or exercise (for example, pain, arrhythmias, pacemakers, or cardiac-assist devices); medical
conditions that severely limit exercise tolerance, preventing patients from reaching heart rates close to
their predicted maximum heart rate (for example, peripheral arterial disease); and medical conditions that
significantly increase the difficulty of ambulation, such as skeletal or neuromuscular conditions causing gait
inefficiency (for example, multiple sclerosis or cerebral palsy).</p>
</blockquote>
<h3 id="what-to-do-if-you-get-a-low-cardio-fitness-notification"><a href="#what-to-do-if-you-get-a-low-cardio-fitness-notification">What to do if you get a low cardio fitness notification</a></h3>
<p>VO2Max is most commonly improved through zone 5 (high intensity) training. If you want to improve your VO2Max, download <a href="https://apps.apple.com/us/app/empirical-health-for-watch/id6449271489">Empirical Health for Apple Watch</a> or check out
our <a href="https://www.empirical.health/metrics/vo2-max">ultimate guide to Apple Watch health metrics</a>.</p>  </div></div>
  </body>
</html>
