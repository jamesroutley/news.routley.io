<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.openwall.com/lists/oss-security/2022/12/21/6">Original</a>
    <h1>Linux /proc/pid/stat parsing bugs</h1>
    
    <div id="readability-page-1" class="page">


<table>
<tbody><tr>

<td>
<a href="https://decomposition.al/"><img src="https://decomposition.al/logo.png" width="182" height="80" alt="Openwall"/></a>
</td><td>
<div>
<ul>
<li><a href="https://decomposition.al/">Products</a>
<ul>
<li><a href="https://decomposition.al/Owl/">Openwall GNU/*/Linux   <i>server OS</i></a>
</li><li><a href="https://decomposition.al/lkrg/">Linux Kernel Runtime Guard</a>
</li><li><a href="https://decomposition.al/john/">John the Ripper   <i>password cracker</i></a>
<ul>
<li><a href="https://decomposition.al/john/">Free &amp; Open Source for any platform</a>
</li><li><a href="https://decomposition.al/john/cloud/">in the cloud</a>
</li><li><a href="https://decomposition.al/john/pro/linux/">Pro for Linux</a>
</li><li><a href="https://decomposition.al/john/pro/macosx/">Pro for macOS</a>
</li></ul>
</li><li><a href="https://decomposition.al/wordlists/">Wordlists   <i>for password cracking</i></a>
</li><li><a href="https://decomposition.al/passwdqc/">passwdqc   <i>policy enforcement</i></a>
<ul>
<li><a href="https://decomposition.al/passwdqc/">Free &amp; Open Source for Unix</a>
</li><li><a href="https://decomposition.al/passwdqc/windows/">Pro for Windows (Active Directory)</a>
</li></ul>
</li><li><a href="https://decomposition.al/yescrypt/">yescrypt   <i>KDF &amp; password hashing</i></a>
</li><li><a href="https://decomposition.al/yespower/">yespower   <i>Proof-of-Work (PoW)</i></a>
</li><li><a href="https://decomposition.al/crypt/">crypt_blowfish   <i>password hashing</i></a>
</li><li><a href="https://decomposition.al/phpass/">phpass   <i>ditto in PHP</i></a>
</li><li><a href="https://decomposition.al/tcb/">tcb   <i>better password shadowing</i></a>
</li><li><a href="https://decomposition.al/pam/">Pluggable Authentication Modules</a>
</li><li><a href="https://decomposition.al/scanlogd/">scanlogd   <i>port scan detector</i></a>
</li><li><a href="https://decomposition.al/popa3d/">popa3d   <i>tiny POP3 daemon</i></a>
</li><li><a href="https://decomposition.al/blists/">blists   <i>web interface to mailing lists</i></a>
</li><li><a href="https://decomposition.al/msulogin/">msulogin   <i>single user mode login</i></a>
</li><li><a href="https://decomposition.al/php_mt_seed/">php_mt_seed   <i>mt_rand() cracker</i></a>
</li></ul>
</li><li><a href="https://decomposition.al/services/">Services</a>
</li><li id="narrow-li-1"><a>Publications</a>
<ul>
<li><a href="https://decomposition.al/articles/">Articles</a>
</li><li><a href="https://decomposition.al/presentations/">Presentations</a>
</li></ul>
</li><li><a>Resources</a>
<ul>
<li><a href="https://decomposition.al/lists/">Mailing lists</a>
</li><li><a href="https://openwall.info/wiki/">Community wiki</a>
</li><li><a href="https://github.com/openwall">Source code repositories (GitHub)</a>
</li><li><a href="https://cvsweb.openwall.com">Source code repositories (CVSweb)</a>
</li><li><a href="https://decomposition.al/mirrors/">File archive &amp; mirrors</a>
</li><li><a href="https://decomposition.al/signatures/">How to verify digital signatures</a>
</li><li><a href="https://decomposition.al/ove/">OVE IDs</a>
</li></ul>
</li><li id="last-li"><a href="https://decomposition.al/news">What&#39;s new</a>
</li></ul>
</div>


</td></tr></tbody></table>


<div>
<p>
<a href="https://twitter.com/openwall">
Follow @Openwall on Twitter for new release announcements and other news</a>

</p>
</div>

<a href="https://decomposition.al/blog/2022/12/20/course-announcement-distributed-software-systems-global-first-and-local-first-perspectives/5">[&lt;prev]</a> <a href="https://decomposition.al/blog/2022/12/20/course-announcement-distributed-software-systems-global-first-and-local-first-perspectives/7">[next&gt;]</a> <a href="https://decomposition.al/blog/2022/12/20/course-announcement-distributed-software-systems-global-first-and-local-first-perspectives/7">[thread-next&gt;]</a> <a href="https://decomposition.al/blog/2022/12/20/course-announcement-distributed-software-systems-global-first-and-local-first-perspectives/">[day]</a> <a href="https://decomposition.al/blog/2022/12/20/">[month]</a> <a href="https://decomposition.al/blog/2022/12/">[year]</a> <a href="https://decomposition.al/blog/2022/">[list]</a>
<pre>Date: Wed, 21 Dec 2022 18:13:17 +0100
From: Dmitry Vyukov &lt;dvyukov@...gle.com&gt;
To: oss-security@...ts.openwall.com
Subject: [Linux] /proc/pid/stat parsing bugs

Hello,

This is not a single vulnerability, the list of affected software is
large, but it&#39;s not a security issue for all of it.

It occurred to me that most of the Linux procfs /proc/pid/stat and
/proc/pid/task/tid/stat parsing code out there is buggy. The fine
contains a set of numbers about the task:
<a href="https://man7.org/linux/man-pages/man5/proc.5.html" rel="nofollow">https://man7.org/linux/man-pages/man5/proc.5.html</a>

e.g. $ cat /proc/self/stat
1715376 (cat) R 1544883 1715376 1544883 34819 1715376 4194304 106 0 0
0 0 0 0 0 20 0 1 0 42505561 9207808 237 18446744073709551615
93955355631616 93955355651497 140737444557056 0 0 0 0 0 0 0 0 0 17 36
0 0 0 0 0 93955355667504 93955355669120 93955385581568 140737444559745
140737444559765 140737444559765 140737444564971 0

Most of the code splits it by space and takes an N-th field.
The problem is that the process name &#34;(cat)&#34; can contain spaces (and
brackets). Potentially some important software (containers/sandboxes)
can be tricked into getting wrong data, and I&#39;ve seen cases close to
stack overflows (buffer for a fixed number of fields is allocated on
stack).

Some examples:
OpenJDK:
<a href="https://sourcegraph.com/github.com/openjdk/jdk/-/blob/src/jdk.management/unix/native/libmanagement_ext/OperatingSystemImpl.c?L133-139" rel="nofollow">https://sourcegraph.com/github.com/openjdk/jdk/-/blob/src/jdk.management/unix/native/libmanagement_ext/OperatingSystemImpl.c?L133-139</a>
<a href="https://sourcegraph.com/github.com/openjdk/jdk8u/-/blob/jdk/src/solaris/native/sun/management/OperatingSystemImpl.c?L223-229" rel="nofollow">https://sourcegraph.com/github.com/openjdk/jdk8u/-/blob/jdk/src/solaris/native/sun/management/OperatingSystemImpl.c?L223-229</a>

Ansible:
<a href="https://sourcegraph.com/github.com/ansible/ansible/-/blob/lib/ansible/modules/yum.py?L507-510" rel="nofollow">https://sourcegraph.com/github.com/ansible/ansible/-/blob/lib/ansible/modules/yum.py?L507-510</a>

Libuv:
<a href="https://sourcegraph.com/github.com/libuv/libuv/-/blob/src/unix/linux.c?L674-701" rel="nofollow">https://sourcegraph.com/github.com/libuv/libuv/-/blob/src/unix/linux.c?L674-701</a>

bdwgc:
<a href="https://sourcegraph.com/github.com/mono/linux-packaging-mono/-/blob/external/bdwgc/os_dep.c?L1138-1155" rel="nofollow">https://sourcegraph.com/github.com/mono/linux-packaging-mono/-/blob/external/bdwgc/os_dep.c?L1138-1155</a>

But really most of the code that does it:
<a href="https://sourcegraph.com/search?q=context:global+/%5C%22%5C/proc%5C/.*%5C/stat%5C%22/" rel="nofollow">https://sourcegraph.com/search?q=context:global+/%5C%22%5C/proc%5C/.*%5C/stat%5C%22/</a>

The only way to parse it is to do strrchr(&#39;)&#39;) first (fortunately it
contains just one unescaped string).

Thanks
</pre>
<p><a href="http://www.openwall.com/blists/">Powered by blists</a> - <a href="http://lists.openwall.net">more mailing lists</a>


</p><p>
Please check out the
<a href="https://oss-security.openwall.org/wiki/">
Open Source Software Security Wiki</a>, which is counterpart to this
<a href="https://oss-security.openwall.org/wiki/mailing-lists/oss-security">mailing list</a>.
</p><p>
Confused about <a href="https://decomposition.al/lists/">mailing lists</a> and their use?
<a href="https://en.wikipedia.org/wiki/Electronic_mailing_list">Read about mailing lists on Wikipedia</a>
and check out these
<a href="https://www.complang.tuwien.ac.at/anton/mail-news-errors.html">guidelines on proper formatting of your messages</a>.
</p><p>

<a href="https://decomposition.al/Owl/" title="Powered by Openwall GNU/*/Linux - security-enhanced &#34;Linux distribution&#34;"><img src="https://decomposition.al/Owl/artwork/buttons/80x15/Owl-80x15-4.png" width="80" height="15" alt="Powered by Openwall GNU/*/Linux"/></a>
<a href="https://openvz.org" title="Powered by OpenVZ - OS virtualization solution for Linux"><img src="https://decomposition.al/images/OpenVZ-80x15-cd.png" width="80" height="15" alt="Powered by OpenVZ"/></a>





</p></div>
  </body>
</html>
