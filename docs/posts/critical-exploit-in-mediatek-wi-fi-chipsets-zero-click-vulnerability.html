<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.sonicwall.com/en-us/2024/09/critical-exploit-in-mediatek-wi-fi-chipsets-zero-click-vulnerability-cve-2024-20017-threatens-routers-and-smartphones/">Original</a>
    <h1>Critical Exploit in MediaTek Wi-Fi Chipsets: Zero-Click Vulnerability</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="text"><h3>Overview</h3>
<p>The SonicWall Capture Labs threat research team became aware of the threat CVE-2024-20017, assessed its impact and developed mitigation measures for the vulnerability. CVE-2024-20017 is a critical zero-click vulnerability with a CVSS 3.0 score of 9.8, impacting MediaTek Wi-Fi chipsets MT7622/MT7915 and RTxxxx SoftAP driver bundles used in products from various manufacturers, including Ubiquiti, Xiaomi and Netgear. The affected versions include MediaTek SDK versions 7.4.0.1 and earlier, as well as OpenWrt 19.07 and 21.02. This translates to a large variety of vulnerable devices, including routers and smartphones. The flaw allows remote code execution without user interaction due to an out-of-bounds write issue. MediaTek has released patches to mitigate the vulnerability and users should update their devices immediately. While this vulnerability was <a href="https://corp.mediatek.com/product-security-bulletin/March-2024" data-wpel-link="external" target="_blank" rel="external noopener noreferrer">published</a> and patched back in March, only recently did a public <a href="https://github.com/mellow-hype/cve-2024-20017/tree/main" data-wpel-link="external" target="_blank" rel="external noopener noreferrer">PoC</a> become available making exploitation more likely.</p>
<h3>Technical Overview</h3>
<p>The vulnerability resides in wappd, a network daemon included in the MediaTek MT7622/MT7915 SDK and RTxxxx SoftAP driver bundle. This service is responsible for configuring and managing wireless interfaces and access points, particularly with Hotspot 2.0 technologies. The architecture of wappd is complex, comprising the network service itself, a set of local services that interact with the device’s wireless interfaces, and communication channels between components via Unix domain sockets.  Ultimately, the vulnerability is a buffer overflow as a result of a length value taken directly from attacker-controlled packet data without bounds checking and placed into a memory copy.  This buffer overflow creates an out-of-bounds write.</p>
<h3>Triggering the Vulnerability</h3>
<p>The vulnerability exists in the IAPP_RcvHandlerSSB function where an attacker controlled length value is passed to the IAPP_MEM_MOVE macro as described in hyprdude’s <a href="https://blog.coffinsec.com/0day/2024/08/30/exploiting-CVE-2024-20017-four-different-ways.html" data-wpel-link="external" target="_blank" rel="external noopener noreferrer">blog</a> and seen in Figure 1.</p>
<div itemscope="itemscope" itemtype="https://schema.org/ImageObject"><p><a href="https://d3ik27cqx8s5ub.cloudfront.net/blog/media/uploads/Figure1-6.png" data-wpel-link="external" target="_blank" rel="external noopener noreferrer"><img src="https://d3ik27cqx8s5ub.cloudfront.net/blog/media/uploads/Figure1-6.png" alt="" title="Figure1" itemprop="thumbnailUrl"/></a></p></div>
<p><em>Figure 1: Vulnerable Code sourced from hyprdude</em></p>
<p>Prior to the last line which calls IAPP_MEM_MOVE, the only bounds check done is to check that the provided length does not exceed the maximum packet length of 1600 bytes. As the size of the destination struct is only 167 bytes, this results in a stack buffer overflow of up to 1433 bytes. To trigger this vulnerability an attacker must send a packet with the expected structures prepending the attack payload.  These structures are referred to as the RT_IAPP_HEADER and the RT_IAPP_SEND_SECURITY_BLOCK within the code.  To bypass validation checks the length of the RT_IAPP_HEADER struct needs to be small and the RT_IAPP_HEADER.Command field must be to 50.</p>
<h3>Exploitation</h3>
<p>The publicly available exploit code achieves remote code execution by using a global address table overwrite technique via a return-oriented programming (ROP) chain. This method leverages the `system()` call to execute commands, such as sending a reverse shell back to the attacker. The reverse shell is established using Bash and the existing Netcat tool on the chipset. Figure 2 illustrates how the reverse shell command is crafted and embedded within the payload to enable this exploitation tactic.</p>
<div itemscope="itemscope" itemtype="https://schema.org/ImageObject"><p><a href="https://d3ik27cqx8s5ub.cloudfront.net/blog/media/uploads/Figure2-8.png" data-wpel-link="external" target="_blank" rel="external noopener noreferrer"><img src="https://d3ik27cqx8s5ub.cloudfront.net/blog/media/uploads/Figure2-8.png" alt="" title="Figure2" itemprop="thumbnailUrl"/></a></p></div>
<p><em>Figure 2: Reverse Shell Commands</em></p>
<h3>SonicWall Protections</h3>
<p>To ensure SonicWall customers are prepared for any exploitation that may occur due to this vulnerability, the following signatures have been released:</p>
<ul>
<li>IPS: 20322 MediaTek MT7915 wlan Service OOB Write 1</li>
<li>IPS: 20323 MediaTek MT7915 wlan Service OOB Write 2</li>
</ul>
<h3>Remediation Recommendations</h3>
<p>Due to the availability of the exploit code, it is highly recommended that users upgrade to the latest version of the firmware for their respective chipset.</p>
<h3>Relevant Links</h3>
<ul>
<li><a href="https://corp.mediatek.com/product-security-bulletin/March-2024" data-wpel-link="external" target="_blank" rel="external noopener noreferrer">https://corp.mediatek.com/product-security-bulletin/March-2024</a></li>
<li><a href="https://blog.coffinsec.com/0day/2024/08/30/exploiting-CVE-2024-20017-four-different-ways.html" data-wpel-link="external" target="_blank" rel="external noopener noreferrer">https://blog.coffinsec.com/0day/2024/08/30/exploiting-CVE-2024-20017-four-different-ways.html</a></li>
<li><a href="https://securityonline.info/cve-2024-20017-cvss-9-8-zero-click-exploit-discovered-in-popular-wi-fi-chipsets-poc-published/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer">https://securityonline.info/cve-2024-20017-cvss-9-8-zero-click-exploit-discovered-in-popular-wi-fi-chipsets-poc-published/</a></li>
<li><a href="https://github.com/mellow-hype/cve-2024-20017/tree/main" data-wpel-link="external" target="_blank" rel="external noopener noreferrer">https://github.com/mellow-hype/cve-2024-20017/tree/main</a></li>
</ul>

<div>
				<div>
					
					<ul><li>
									
								</li><li>
									
								</li><li>
									
								</li><li>
									
								</li><li>
								<a href="#" rel="nofollow" data-location="inline" data-page_id="61928" data-permalink="https://blog.sonicwall.com/en-us/2024/09/critical-exploit-in-mediatek-wi-fi-chipsets-zero-click-vulnerability-cve-2024-20017-threatens-routers-and-smartphones/" data-title="Critical Exploit in MediaTek Wi-Fi Chipsets: Zero-Click Vulnerability (CVE-2024-20017) Threatens Routers and Smartphones">
									<i></i>
									<span></span>
								</a>
							</li></ul>
				</div>
			</div><div id="sexy-author-bio"><div id="sab-author"><p><a rel="author" href="https://blog.sonicwall.com/en-us/author/securitynews/" title="Security News" target="_top" data-wpel-link="internal">Security News</a></p></div><p><a href="https://blog.sonicwall.com/en-us/author/securitynews/" target="_top" data-wpel-link="internal"><img src="https://d3ik27cqx8s5ub.cloudfront.net/blog/media/uploads/ultimatemember/3368/profile_photo-190x190.png?1726884306" width="100" height="100" alt="Security News" data-default="https://blogtest.sonicwall.com/wp-content/uploads/2018/04/user_default-avatar.png" onerror="if ( ! this.getAttribute(&#39;data-load-error&#39;) ){ this.setAttribute(&#39;data-load-error&#39;, &#39;1&#39;);this.setAttribute(&#39;src&#39;, this.getAttribute(&#39;data-default&#39;));}"/></a></p><p>The SonicWall Capture Labs Threat Research Team gathers, analyzes and vets cross-vector threat information from the SonicWall Capture Threat network, consisting of global devices and resources, including more than 1 million security sensors in nearly 200 countries and territories. The research team identifies, analyzes, and mitigates critical vulnerabilities and malware daily through in-depth research, which drives protection for all SonicWall customers. In addition to safeguarding networks globally, the research team supports the larger threat intelligence community by releasing weekly deep technical analyses of the most critical threats to small businesses, providing critical knowledge that defenders need to protect their networks.</p></div></div></div>
  </body>
</html>
