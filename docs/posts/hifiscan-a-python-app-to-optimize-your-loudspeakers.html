<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/erdewit/HiFiScan">Original</a>
    <h1>Show HN: HiFiScan, a Python app to optimize your loudspeakers</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/c5bfbde247cd10e93ff50a518b0f5e441a6e9959495f6bf0f1a1913d2b1b7a8d/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f707974686f6e2d332e382b2d626c75652e737667"><img src="https://camo.githubusercontent.com/c5bfbde247cd10e93ff50a518b0f5e441a6e9959495f6bf0f1a1913d2b1b7a8d/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f707974686f6e2d332e382b2d626c75652e737667" data-canonical-src="https://img.shields.io/badge/python-3.8+-blue.svg"/></a>
 <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/33f41b43581b78476d12896b822e08d6b050864de2d3c314b32f11c6637d28bf/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7374617475732d737461626c652d677265656e2e737667"><img src="https://camo.githubusercontent.com/33f41b43581b78476d12896b822e08d6b050864de2d3c314b32f11c6637d28bf/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7374617475732d737461626c652d677265656e2e737667" data-canonical-src="https://img.shields.io/badge/status-stable-green.svg"/></a>
 <a href="https://pypi.python.org/pypi/hifiscan" rel="nofollow"><img alt="PyPi" src="https://camo.githubusercontent.com/c6af6de31388ec58b1f3ef9a2c1236d53ed258952ea49b7bc6c3019c6ae43098/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f686966697363616e2e737667" data-canonical-src="https://img.shields.io/pypi/v/hifiscan.svg"/>
</a> <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/44c92aa855b3a4b0b5c6f84818afb96ab66b53a102115f5167a396a3f0ff8f3a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4253442d626c75652e737667"><img src="https://camo.githubusercontent.com/44c92aa855b3a4b0b5c6f84818afb96ab66b53a102115f5167a396a3f0ff8f3a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4253442d626c75652e737667" data-canonical-src="https://img.shields.io/badge/license-BSD-blue.svg"/></a>
</p>
<a name="user-content-introduction"></a>
<h2 dir="auto"><a id="user-content-introduction" aria-hidden="true" href="#introduction"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Introduction</h2>
<p dir="auto">The goal of HiFiScan is to help equalize an audio system to get
the best possible audio quality from it.
There are two ways to do this:</p>
<p dir="auto">1. Manual: The realtime frequency spectrum is displayed and
the peaks and troughs can be interactively equalized away.</p>
<p dir="auto">2. Automatic: The frequency response is measured and a correction
is calculated. This correction is a phase-neutral finite impulse
response (FIR) that can be imported into most equalizer programs.</p>
<p dir="auto">The measuring is done by playing a &#34;chirp&#34; sound that sweeps
across all frequencies and recording how loud each frequency comes out
of the speakers. A good microphone is needed, with a wide frequency range
and preferably with a flat frequency response.</p>
<p dir="auto">The equalization itself is not provided; It can be performed by an
equalizer of your choice, such as
<a href="https://github.com/wwmm/easyeffects/">EasyEffects</a>
for Linux,
<a href="https://sourceforge.net/projects/equalizerapo/" rel="nofollow">Equalizer APO</a>
and
<a href="https://sourceforge.net/projects/peace-equalizer-apo-extension/" rel="nofollow">Peace</a>
for Windows, or
<a href="https://eqmac.app/" rel="nofollow">eqMac</a> for macOS.</p>
<a name="user-content-installation"></a>
<h2 dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installation</h2>
<pre>pip install hifiscan
</pre>
<p dir="auto">The program is started from a console by typing:</p>
<pre>hifiscan
</pre>
<p dir="auto">All functionality is also available for interactive use in
<a href="https://github.com/erdewit/HiFiScan/blob/master/chirp.ipynb">this Jupyter notebook</a>.</p>
<a name="user-content-examples"></a>
<h2 dir="auto"><a id="user-content-examples" aria-hidden="true" href="#examples"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Examples</h2>
<a name="user-content-laptop"></a>
<h3 dir="auto"><a id="user-content-laptop" aria-hidden="true" href="#laptop"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Laptop</h3>
<p dir="auto">Lets first optimize the speakers of a laptop.
The laptop has tiny down-firing speakers and a massive
case resonance that makes it sound about as bad as it gets.</p>
<p dir="auto">The sound is recorded with a USB studio microphone; The built-in
microphone of the laptop is not suitable for this.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/laptop_setup.jpg"><img alt="images/laptop_setup.jpg" src="https://github.com/erdewit/HiFiScan/raw/master/images/laptop_setup.jpg"/></a></p>
<p dir="auto">Letting the measurements run it becomes clear just how bad
the spectrum is, with a peak at 1 kHz about 20 dB above average.
Every 10 dB is a factor 10 in power, so 20 dB is a factor 100.</p>
<p dir="auto">The low frequency is set to 200 Hz since the laptop can&#39;t possibly
output anything below this.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/laptop-spectrum.png"><img alt="images/laptop-spectrum.png" src="https://github.com/erdewit/HiFiScan/raw/master/images/laptop-spectrum.png"/></a></p>
<p dir="auto">To get an automatic correction, we go to the &#34;Impulse Response&#34; section
(selectable in the lower left corner). From here it&#39;s possible to use
all-default values and click straight on &#34;Export as WAV&#34; to get a
perfectly adequate result.</p>
<p dir="auto">But lets optimize a bit further for this laptop. There are various
tradeoffs that can be made, one of which involves the <strong>Duration</strong>
of the impulse. A longer duration gives better bass control,
but also adds more latency.
The latency added by the equalizer is halve the duration of the impulse.
Since the laptop has no bass anyway, we choose a 22 ms duration for a
super-low 11 ms latency. This is less time than it takes sound to travel
four meters and is good enough even for gaming or video-calls.</p>
<p dir="auto">We also increase the <strong>Range</strong> to 27 dB to get just a little bit of
extra equalization.</p>
<p dir="auto">The lower graph (in brown) shows how the equalized spectrum is expected
to be, and it looks nicely flattened.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/laptop-IR.png"><img alt="images/laptop-IR.png" src="https://github.com/erdewit/HiFiScan/raw/master/images/laptop-IR.png"/></a></p>
<p dir="auto">So lets export the impulse response and import
it into EasyEffects (In Convolver effect: &#34;Impulses -&gt; Import Impulse&#34;
and then &#34;Load&#34;):</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/Convolver.png"><img alt="images/Convolver.png" src="https://github.com/erdewit/HiFiScan/raw/master/images/Convolver.png"/></a></p>
<p dir="auto">We go back to the spectrum measurement and set the uncorrected
spectrum as reference (to compare with later measurements).
Measuring the equalized system gives this:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/laptop-flattened-spectrum.png"><img alt="images/laptop-flattened-spectrum.png" src="https://github.com/erdewit/HiFiScan/raw/master/images/laptop-flattened-spectrum.png"/></a></p>
<p dir="auto">It is seen that the equalization works by attenuation only:
Everything gets chopped to some level under the top (27 dB here)
and this flattens the whole landscape.</p>
<p dir="auto">All this attenuation does decrease the total loudness, so the
volume has to be turned up to get the same loudness. This also
brings up the flanks of the spectrum and increases the effective
frequency range. There&#39;s a very welcome 40 Hz of extra bass and
a whole lot of treble:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/laptop-spectrum-equivolume.png"><img alt="images/laptop-spectrum-equivolume.png" src="https://github.com/erdewit/HiFiScan/raw/master/images/laptop-spectrum-equivolume.png"/></a></p>
<p dir="auto">This is the point to leave the graphs and start to listen to
some music. Is there an improvement? There are of course lots
of different tastes in what sounds good, but for those who like
a neutrally balanced sound there is a huge improvement. Voices
are also much easier to understand.</p>
<p dir="auto">The lack of bass is somewhat offset by the
<a href="https://en.wikipedia.org/wiki/Missing_fundamental" rel="nofollow">missing fundamental</a>
phenomenon, were the brain &#34;adds&#34; a missing low frequency based on
its higher frequency harmonics. It seems that by equalizing the
harmonics the phantom bass gets equalized as well.</p>
<a name="user-content-hifi-stereo"></a>
<h3 dir="auto"><a id="user-content-hifi-stereo" aria-hidden="true" href="#hifi-stereo"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>HiFi Stereo</h3>
<p dir="auto">The HiFi installation has four JBL surround loudspeakers wired
in series as a 2x2 stereo setup, plus a subwoofer. The sound
can only be described as very dull, as if the tweeters are
not working.</p>
<p dir="auto">To calibrate we use the same microphone as for the laptop,
which is a Superlux E205UMKII.
Lets this time correct for any non-flatness of the microphone.
According to the documentation
it has this frequency response:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/mic_response.png"><img alt="images/mic_response.png" src="https://github.com/erdewit/HiFiScan/raw/master/images/mic_response.png"/></a></p>
<p dir="auto">With EasyEffects we make the following correction.
The correction can be applied either to the input or the
output. Here it&#39;s applied to the output, as long as it is
turned off after the calibration that&#39;s OK.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/mic_correction.png"><img alt="images/mic_correction.png" src="https://github.com/erdewit/HiFiScan/raw/master/images/mic_correction.png"/></a></p>
<p dir="auto">Measuring the spectrum bears out the concerning lack
of treble:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/stereo-spectrum.png"><img alt="images/stereo-spectrum.png" src="https://github.com/erdewit/HiFiScan/raw/master/images/stereo-spectrum.png"/></a></p>
<p dir="auto">So lets go to the Impulse Response section to fix this.</p>
<p dir="auto">The <strong>Range</strong> is set to 33 dB - this is an extreme value but what the heck.</p>
<p dir="auto">The <strong>Tapering</strong> is left at 5. It pulls the flanks of the Impulse
Response closer to zero (visible in the green curve), which also has
a smoothing effect on the spectrum. A value less than 5 might leave
the flanks of the green curve too high and this can cause nasty
<a href="https://en.wikipedia.org/wiki/Pre-echo" rel="nofollow">pre-echos</a>.
A value higher than 5 might cause too much smoothing of the bass
region.</p>
<p dir="auto">The <strong>Smoothing</strong> will also smooth the spectrum, but the smoothing is
done proportional to the frequency. It will smooth the bass region
less, allowing for better precision there. A good smoothing value
can be judged from the Correction Factor graph (in red): It should
be smooth with nicely rounded corners, yet with enough detail.</p>
<p dir="auto">The <strong>Duration</strong> is fiddled with until an acceptable bass response is
reached (visible in lowest graph in brown).</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/stereo-ir.png"><img alt="images/stereo-ir.png" src="https://github.com/erdewit/HiFiScan/raw/master/images/stereo-ir.png"/></a></p>
<p dir="auto">After exporting the Impulse Response and importing it into
EasyEffects the result looks promising.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/stereo-spectrum-corrected.png"><img alt="images/stereo-spectrum-corrected.png" src="https://github.com/erdewit/HiFiScan/raw/master/images/stereo-spectrum-corrected.png"/></a></p>
<p dir="auto">We turn up the volume to get the same loudness as before and
apply some visual smoothing to the spectrum for clarity.
It turns out that the tweeters can
do their job if only the amplifier drives them 100 times as hard.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/stereo-final.png"><img alt="images/stereo-final.png" src="https://github.com/erdewit/HiFiScan/raw/master/images/stereo-final.png"/></a></p>
<p dir="auto">The difference in sound quality is night and day. Music is really
really good now. For movies it brings very immersive
action and excellent clarity of dialogue.</p>
<p dir="auto">As mentioned in the introduction, the equalization is phase-
neutral. This means that despite the heavy and steep equalization
there are no relative phase shifts added. The details in a
lossless source of music (such as the bounces of a cymbal)
remain as crisp as can be.</p>
<p dir="auto">As an aside, the amplifier used is a $18 circuit board based on the
<a href="https://www.ti.com/product/TPA3116D2" rel="nofollow">TPA3116D2 digital amplifier chip</a>.
It draws 1.1 Watt while playing which only increases if the subwoofer
is really busy.</p>
<a name="user-content-bluetooth-headphones"></a>
<h3 dir="auto"><a id="user-content-bluetooth-headphones" aria-hidden="true" href="#bluetooth-headphones"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Bluetooth headphones</h3>
<p dir="auto">HiFiScan is not intended for use with headphones. There is
the
<a href="https://github.com/jaakkopasanen/AutoEq">AutoEq project</a>
with ready-made corrections for most headphones, Even so,
it can be used for experiments. For example, I have very
nice Dali IO-4 headphones that can be used with Bluetooth
or passively with an analog audio cable. It sounds better with
Bluetooth, which suggests that some equalization
is taking place. Lets measure this!</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/dali.jpg"><img alt="images/dali.jpg" src="https://github.com/erdewit/HiFiScan/raw/master/images/dali.jpg"/></a></p>
<p dir="auto">It is seen that there is a indeed a bit of active tuning
going on, although most of the tuning is done acoustically.
In orange is bluetooth and in cyan is the analog cable.
There&#39;s a wide +10dB peak at 1.8 kHz and a narrow +4dB peak at 5.5 kHz.
This tuning can be applied to the analog signal to get the same sound as
with Bluetooth.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/erdewit/HiFiScan/blob/master/images/dali-spectrum.png"><img alt="images/dali-spectrum.png" src="https://github.com/erdewit/HiFiScan/raw/master/images/dali-spectrum.png"/></a></p>
<a name="user-content-disclaimer"></a>
<h2 dir="auto"><a id="user-content-disclaimer" aria-hidden="true" href="#disclaimer"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Disclaimer</h2>
<p dir="auto">The software is provided on the conditions of the simplified BSD license.
Any blown speakers or shattered glasses are on you.</p>
<p dir="auto">Enjoy,</p>
<table>


<tbody>
<tr><th>author:</th><td>Ewald de Wit &lt;<a href="mailto:ewald.de.wit@gmail.com">ewald.de.wit@gmail.com</a>&gt;</td>
</tr>
</tbody>
</table>

</article>
          </div></div>
  </body>
</html>
