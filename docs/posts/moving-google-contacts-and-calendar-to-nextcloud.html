<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/">Original</a>
    <h1>Moving Google Contacts and Calendar to NextCloud</h1>
    
    <div id="readability-page-1" class="page"><section>
      <p>I have used a lot of Google products in the past and to this day still do. I have used Google Maps, Youtube, Gmail, Hangouts, Meet and a lot more in the past. I tried to de-google myself from more and more services, mainly because of concerns that all my data is behind one account, not controllable by me. There are some <a href="https://www.polygon.com/2021/2/8/22272284/terraria-google-stadia-canceled-developer-locked-out">horror stories</a> available from people getting locked out from their Google account for apparantly no reason. This and other stories like it are the reason why I took matter into my own hands.</p>
<p>In this blogpost I will take you along for the ride to set up Nextcloud for contact and calendar synchronization. I haven’t used Nextcloud yet when I started writing this blogpost. It seems overkill to use Nextcloud for this purpose alone, but I plan on using more of the suite in the future. For now we are focussing on setting up Nextcloud for contacts and calendars and migrating the data from Google.</p>
<div>
    <h2 id="what-is-nextcloud-anyway">
        What is Nextcloud anyway?
        <a data-clipboard-text="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/#what-is-nextcloud-anyway" aria-label="Anchor What is Nextcloud anyway?" href="#what-is-nextcloud-anyway">
            <svg><use xlink:href="#gblog_link"></use></svg>
        </a>
    </h2>
</div>
<p>Nextcloud is an open source productivity platform where you can hook in a lot of different applications. From office, contacts, calendars to video calls, website building and a kanban board. It is a very powerful tool to have in your selfhosted heaven!</p>
<p>One of the reasons I’ve chosen for Nextcloud, is because it gives me a great peace of mind that there is a whole community surrounding this tool, as well as the <a href="https://github.com/nextcloud/server/blob/master/COPYING">copyleft license</a>. If something ever happens to Nextcloud, you can be sure that you have plenty of time to migrate to other services, or that it will be forked and continue being worked on by others.</p>






  

  
  
  
  

  


  <div>
    <figure>
      <a href="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/images/nextcloud-dashboard.webp">
        <picture>
          <source srcset="/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/images/nextcloud-dashboard_hu820dbd9abdffdc61f391667084661bcd_226286_600x0_resize_q75_h2_box.webp 600w, /posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/images/nextcloud-dashboard_hu820dbd9abdffdc61f391667084661bcd_226286_1200x0_resize_q75_h2_box.webp 1200w" sizes="100vw"/>
          <img loading="lazy" src="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/images/nextcloud-dashboard_hu820dbd9abdffdc61f391667084661bcd_226286_1800x0_resize_q75_h2_box.webp" alt="Nextcloud dashboard"/>
        </picture>
      </a>
      
        <figcaption>
          Nextcloud dashboard
        </figcaption>
      
    </figure>
  </div>




<p>If you have read my previous blogposts, you will know that I love managing my services in Docker compose. It is easy to setup, gives plenty of control and setting it up on another server is pretty fast. So that’s what I am going to start with: setting up a Docker compose file. We will be using the <a href="https://fleet.linuxserver.io/image?name=linuxserver/nextcloud">linuxserver.io docker image</a>, since it is stable and pretty popular in the selfhosted community.</p>
<p>First: we will set up a <code>docker-compose.yml</code> file. You can put this file wherever you want, but it is a good idea to keep it organized. Nextcloud uses two folders: one to keep its data and one for the configuration. I made these in <code>/volume1/docker/Nextcloud</code> and <code>/volume1/docker/config/Nextcloud</code> respectively.</p>
<p>Nextcloud works best if you use a dedicated database for it. We will be using MariaDB for this, since it’s the one Nextcloud recommends. We will need a folder where the database can store it’s data, so therefore I made this folder: <code>/volume1/docker/config/MariaDB</code>.</p>
<p>Then we need to know the user id and group id, so the filepermissions can be set correctly in Docker. This is very easy to find out, by issueing the following command in the terminal:
</p><div><pre><code data-lang="Shell">$ id <span>$user</span>
<span>uid</span><span>=</span>1024<span>(</span>admin<span>)</span> <span>gid</span><span>=</span>100<span>(</span>users<span>)</span> <span>groups</span><span>=</span>100<span>(</span>users<span>)</span>,101<span>(</span>administrators<span>)</span>,65537<span>(</span>docker<span>)</span></code></pre></div>
<p>We need to know the <code>uid</code> (1024 in this example) and the <code>gid</code> (here it is 100).</p>
<p>Then we construct the following Docker compose file; make sure to change the volumespaths,  the <code>PUID</code> to the <code>uid</code> and the <code>PGID</code> to the <code>gid</code>:</p>
<div><div>
<table><tbody><tr><td>
<pre><code><span> 1
</span><span> 2
</span><span> 3
</span><span> 4
</span><span> 5
</span><span> 6
</span><span> 7
</span><span> 8
</span><span> 9
</span><span>10
</span><span>11
</span><span>12
</span><span>13
</span><span>14
</span><span>15
</span><span>16
</span><span>17
</span><span>18
</span><span>19
</span><span>20
</span><span>21
</span><span>22
</span><span>23
</span><span>24
</span><span>25
</span><span>26
</span><span>27
</span><span>28
</span><span>29
</span><span>30
</span><span>31
</span><span>32
</span><span>33
</span></code></pre></td>
<td>
<pre><code data-lang="Docker">---<span>
</span><span></span>version: <span>&#34;3.7&#34;</span><span>
</span><span></span>services:<span>
</span><span></span>  nextcloud:<span>
</span><span></span>    image: lscr.io/linuxserver/nextcloud<span>
</span><span></span>    container_name: nextcloud<span>
</span><span></span>    environment:<span>
</span><span></span>      - <span>PUID</span><span>=</span><span>1024</span> <span># The user ID of the current user</span><span>
</span><span></span>      - <span>PGID</span><span>=</span><span>100</span> <span># The group ID of the current user</span><span>
</span><span></span>      - <span>TZ</span><span>=</span>Europe/Amsterdam <span># The Timezone where you live</span><span>
</span><span></span>    volumes:<span>
</span><span></span>      - /volume1/docker/config/Nextcloud:/config<span>
</span><span></span>      - /volume1/docker/Nextcloud:/data<span>
</span><span></span>    ports:<span>
</span><span></span>      - 4433:443<span>
</span><span></span>    restart: unless-stopped<span>
</span><span></span>    depends_on:<span>
</span><span></span>      - mariadb<span>
</span><span>
</span><span></span>  mariadb:<span>
</span><span></span>    image: lscr.io/linuxserver/mariadb<span>
</span><span></span>    container_name: mariadb<span>
</span><span></span>    environment:<span>
</span><span></span>      - <span>PUID</span><span>=</span><span>1024</span> <span># The user ID of the current user</span><span>
</span><span></span>      - <span>PGID</span><span>=</span><span>100</span> <span># The group ID of the current user</span><span>
</span><span></span>      - <span>TZ</span><span>=</span>Europe/Amsterdam <span># The Timezone where you live</span><span>
</span><span></span>      - <span>MYSQL_ROOT_PASSWORD</span><span>=</span>supersecretpassword<span>
</span><span></span>      - <span>MYSQL_DATABASE</span><span>=</span>nextclouddatabase<span>
</span><span></span>      - <span>MYSQL_USER</span><span>=</span>nextcloud<span>
</span><span></span>      - <span>MYSQL_PASSWORD</span><span>=</span>nextcloud<span>
</span><span></span>    volumes:<span>
</span><span></span>      - /volume1/docker/config/MariaDB:/config<span>
</span><span></span>    restart: unless-stopped</code></pre></td></tr></tbody></table>
</div>
</div>
<p>As you can see, this docker compose is a little bit more substantial.  That’s because it also includes MariaDB. You probably should change the MYSQL_ROOT_PASSWORD to something a little more secure and randomized then what I have used in the example above.</p>
<p>Notice that I’ve mapped port 443 (which is the default HTTPS port) and remapped it to 4433. I’ve made this change, because I have a reverse proxy set up, which occupies this port. Therefore I had to change it and 4433 seems easy and suitable enough for me. If you do not plan to use a reverse proxy and keep Nextcloud local, you can just leave it at 443.</p>
<p>We can now start Nextcloud using this very simple command: <code>docker-compose up -d</code>, which should start Nextcloud and MariaDB in the background.</p>

<p>If everything went as expected, you should now be able to go to the browser and type in: <code>https://localhost:4433</code> (or leave the <code>:4433</code> portion of the url out, if you have used 443). Change <code>localhost</code> to the ip address of the system it is running on, if it’s a different computer or server and you should get to the wizard of Tautulli to set it up with Plex.</p>
<p>You will be greeted with a first time wizard to set up your admin account. You should use a very secure password for this login, as a lot of highly sensitive data will be stored on your Nextcloud instance. There is also a button to change out the default database. Open this and select MySQL or MariaDB. Change out your host to <code>localhost</code>, the username and password to <code>nextcloud</code> and the database name to <code>nextclouddatabase</code>. You can now login to Nextcloud.</p>
<p>When that’s done, you need to be able to receive e-mails from Nextcloud, for example when you’ve lost your password. Therefore it’s important we set it up as soon as possible. To do this, start by clicking on your profile initial in the top right corner and select Settings. Then under administration, select <code>Basic Settings</code> and set up the SMTP server of your e-mail. You can probably find the settings for this under account settings in your mail client, but if you are using a high-profile mailserver, such as Fastmail or Outlook, you can just <a href="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/duckduckgo.com">‘duck it’</a>.</p>






  

  
  
  
  

  


  <div>
    <figure>
      <a href="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/images/nextcloud-settings.webp">
        <picture>
          <source srcset="/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/images/nextcloud-settings_hu6ef41bd9690f036ba42dd16fe2f91390_61098_600x0_resize_q75_h2_box.webp 600w, /posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/images/nextcloud-settings_hu6ef41bd9690f036ba42dd16fe2f91390_61098_1200x0_resize_q75_h2_box.webp 1200w" sizes="100vw"/>
          <img loading="lazy" src="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/images/nextcloud-settings_hu6ef41bd9690f036ba42dd16fe2f91390_61098_1800x0_resize_q75_h2_box.webp" alt="Nextcloud settings page"/>
        </picture>
      </a>
      
        <figcaption>
          Nextcloud settings page
        </figcaption>
      
    </figure>
  </div>



<p>If you want to be able to sync your contacts while you are away from home, we need to set up remote access. You probably want to use a reverse proxy for this, which maps a (sub)domain to your Nextcloud docker instance. I will not go into how to set this up in this blogpost, but I may write about this in the future.</p>
<p>When you have set up a reverse proxy, you need to whitelist the domain in Nextcloud. This is done by adding a line to the <code>trusted_domains</code> in the <code>config.php</code> file. The file is located in the config folder of Nextcloud, which for me is located under <code>/volume1/docker/config/Nextcloud/www/nextcloud/config/config.php</code>. Open this file and add the following under <code>trusted_domains</code>:</p>
<div><div>
<table><tbody><tr><td>
<pre><code><span>1
</span><span>2
</span><span>3
</span><span>4
</span><span>5
</span></code></pre></td>
<td>
<pre><code data-lang="php">  <span>&#39;trusted_domains&#39;</span> <span>=&gt;</span>
  <span>array</span> <span>(</span>
    <span>0</span> <span>=&gt;</span> <span>&#39;192.168.2.11:4433&#39;</span><span>,</span> <span>// This should be set correctly already
</span><span></span>    <span>1</span> <span>=&gt;</span> <span>&#39;nextcloud.yourdomain.nl&#39;</span><span>,</span> <span>// Change this to your domain
</span><span></span>  <span>),</span></code></pre></td></tr></tbody></table>
</div>
</div>
<p>If you have set it all up correctly, you should now be able to access Nextcloud from the world wide web!</p>
<div>
    <h3 id="installing-the-nextcloud-apps">
        Installing the Nextcloud Apps
        <a data-clipboard-text="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/#installing-the-nextcloud-apps" aria-label="Anchor Installing the Nextcloud Apps" href="#installing-the-nextcloud-apps">
            <svg><use xlink:href="#gblog_link"></use></svg>
        </a>
    </h3>
</div>
<p>The first thing you need to, if you’ve not done it already, is install the Contacts and the Calendar app in Nextcloud. In the Nextcloud interface, click in the top right corner on your profile symbol and select <code>Apps</code>. They should be in the <code>Featured apps</code> tab, where you can install and enable them with one press of the button.</p>
<div>
    <h3 id="exporting-and-importing-contacts">
        Exporting and Importing Contacts
        <a data-clipboard-text="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/#exporting-and-importing-contacts" aria-label="Anchor Exporting and Importing Contacts" href="#exporting-and-importing-contacts">
            <svg><use xlink:href="#gblog_link"></use></svg>
        </a>
    </h3>
</div>
<p>When that’s done, we can finally start importing some stuff into Nextcloud. Exporting your contacts from Google is simple enough. Go to your (Google contacts)[https://contacts.google.com], select the contacts you want to export, press the three dots and select <code>Export</code>. You will now download the contacts. Export it as a vCard file, which can be imported into Nextcloud.</p>






  

  
  
  
  

  


  <div>
    <figure>
      <a href="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/images/export-button-google-contacts.webp">
        <picture>
          <source srcset="/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/images/export-button-google-contacts_hu58fba54bc499bfc1b2a5123282b9bb59_9238_600x0_resize_q75_h2_box.webp 600w, /posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/images/export-button-google-contacts_hu58fba54bc499bfc1b2a5123282b9bb59_9238_1200x0_resize_q75_h2_box.webp 1200w" sizes="100vw"/>
          <img loading="lazy" src="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/images/export-button-google-contacts_hu58fba54bc499bfc1b2a5123282b9bb59_9238_1800x0_resize_q75_h2_box.webp" alt="The export button of Google Contacts"/>
        </picture>
      </a>
      
        <figcaption>
          The export button of Google Contacts
        </figcaption>
      
    </figure>
  </div>


<p>To import it, in your Nextcloud instance, click in the top menu on <code>Contacts</code>. Click the settings in the bottom left corner and press it. Click <code>Import Contact</code> and select <code>Select local file</code>. Now open the just downloaded vCard file and Nextcloud will take care of the rest.</p>
<p>When done, all your contacts should now be in your control, awesome! You could delete them from Google account now if you prefer, or keep them there for the time being.</p>
<div>
    <h3 id="exporting-and-importing-your-calendar">
        Exporting and Importing your Calendar
        <a data-clipboard-text="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/#exporting-and-importing-your-calendar" aria-label="Anchor Exporting and Importing your Calendar" href="#exporting-and-importing-your-calendar">
            <svg><use xlink:href="#gblog_link"></use></svg>
        </a>
    </h3>
</div>
<p>The proces for your calendar is very similar to that of the contacts. To export your calendar from Google, go to your (Google Calendar)[https://calendar.google.com]. On the left, all your calendars should be listed in the interface. Hover over the calendar you want to export and click on the tree dots that appear. Click <code>Calendar Settings</code>. From there you can click the <code>Export calendar</code> button, which will export all your appointments, past, present and future, to a zip file.</p>
<p>When you unpack the downloaded zip file, there will be one or more <code>ics</code> files, one for each calendar. These can be imported into Nextcloud. In your Nextcloud dashboard, click on <code>Calendar</code>. Then in the bottom left corner, click <code>Settings &amp; import</code> and click on <code>Import calendar</code>. Now open your just downloaded ics files and it will import all your appointments. It can take a few minutes, so be patient if you are not seeing your appointments immediately.</p>
<div>
    <h3 id="importing-on-your-android-phone">
        Importing on your Android phone
        <a data-clipboard-text="https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/#importing-on-your-android-phone" aria-label="Anchor Importing on your Android phone" href="#importing-on-your-android-phone">
            <svg><use xlink:href="#gblog_link"></use></svg>
        </a>
    </h3>
</div>
<p>In true Degoogle-fashion, we will install an open source tool to sync our contacts and calendar to our phone. We can use F-Droid, an alternative app store for Android, but the app is also available in the Google Play store and it’s called <code>DAVx</code> by <code>Bitfire web engineering</code>. Install this app and open it up. The first time you start it, you may see some prompts to disable battery saving for this app. Do this and continue.</p>
<p>You can now start adding an account, by clicking on the little <code>+</code> icon in the app. When you are on the <code>Add account</code> screen, select <code>Login with URL and user name</code> and fill in your username and password. We need to grab the Base URL from Nextcloud. Go to your Nextcloud dashboard, click on <code>calendar</code> and click on <code>Settings &amp; Import</code>. Click on <code>Copy primary CalDAV address</code>. Paste this address somewhere so you can type it over on your phone. It should look something like this: <code>https://your-address/remote.php/dav</code>.</p>
<p>When you have all your information filled into DAVx, we can now click on <code>Login</code> and voilá: our contacts and calendar will be synced! :)</p>

<p>Setting up Nextcloud is not the easiest thing in the world, we have seen now, but it is incredibly powerful and has a lot more to offer than just Contacts and Calendar. I will be exploring more features in the future, but for now this is enough. I encourage you to try out <a href="https://f-droid.org/en/packages/org.fdroid.fdroid/">F-Droid</a> and explore what open source alternatives there are for your apps. As always, the Docker compose file is available on the <a href="https://github.com/selfhosted-heaven/nextcloud-docker-compose">Selfhosted Heaven github page</a>. If you have any questions or feedback, just leave a comment below!</p>

    </section></div>
  </body>
</html>
