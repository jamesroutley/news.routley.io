<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://camillovisini.com/coding/simulating-hand-drawn-motion-with-svg-filters">Original</a>
    <h1>Simulating hand-drawn motion with SVG filters</h1>
    
    <div id="readability-page-1" class="page"><div> <p>Ever wondered how cartoons create that hand-drawn “jitter” effect? I recently watched an <a href="https://www.youtube.com/watch?v=Ct1fwIuh_90" target="_blank">ARTE documentary</a> about Neapolitan pizza and was fascinated by the animated illustrations (drawn in simple shapes and plain colors) that accompanied the <a href="https://www.arte.tv/de/videos/125315-000-A/pizza-napoli/" target="_blank">segment</a> where the recipe and its ingredients were presented. The illustrations were static, but they had a subtle animation effect that made them look like they were moving slightly.</p>
<p>See for example in this short clip, where you can see the ingredients being presented (pay attention to the edges of the shapes):</p>
<div> <video autoplay="" muted="" loop="" playsinline=""> <source src="/_astro/clip_compressed.teW2uMh5.mp4" type="video/mp4"/> </video> <p> Animated illustration of ingredients for Pizza Napoli - Source: ARTE </p> </div>
<p>I was curious to find out how this effect might have been achieved. First, I had to find out what it was called – turns out that this specific effect is actually quite common in cartoon-style animations and illustrations.</p>
<p>After some research, I found out that this effect is called <strong>“boiling”</strong> or <a href="https://tvtropes.org/pmwiki/pmwiki.php/Main/LineBoil" target="_blank">line boil</a> and was traditionally achieved by drawing the same frame multiple times in a row, with slight variations in position and rotation. This creates the illusion of movement in an otherwise static scene. The technique is often used in animation to create a more dynamic and engaging visual experience (instead of just a static image or scene, for example when a character is standing still).</p>
<p>Let’s take a look at a simple example of this effect in the demo below. I have traced the same object multiple times. Naturally, as these drawings are tracings by hand and not perfect copies, there are subtle differences between them. But, this becomes only apparent when the drawings are overlaid and animated!</p>
<astro-island uid="11N2Td" component-url="/_astro/Demo1.8i29WPfy.js" component-export="default" renderer-url="/_astro/client.BjfohHTG.js" props="{&#34;frameKeys&#34;:[1,[[0,&#34;/_astro/frame-1.EqitRShQ.png&#34;],[0,&#34;/_astro/frame-2.DcVprxKR.png&#34;],[0,&#34;/_astro/frame-3.CF8TYzPZ.png&#34;]]]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;Demo1&#34;,&#34;value&#34;:true}"></astro-island>
<p>When looking closely at the initial short clip, you will notice that the effect is more of a trick. There seems to be a layer of a rough paper-like texture with some kind of overlay effect that is applied to the whole scene, giving it a dynamic quality. That’s not the part we will focus on, though.</p>
<p>More interestingly, the edges of the shapes seem to wobble slightly and appear gritty or sketch-like, as if they were drawn by hand. But are they drawn by hand, as in my demo above? I don’t think that’s the case, because the contours are wobbling “in a loop”. Or in other words: The boiling effect is somehow achieved artificially: Rather than by drawing the same frame multiple times with slight variations, it seems to be a post-processing effect applied to the static illustrations, which were likely drawn as “perfect” shapes.</p>
<p>This blog post describes my attempt to recreate this effect in a simple way and bring it to the web. Let’s dive in.</p>
<h2 id="decomposing-the-effect">Decomposing the effect</h2>
<p>To recreate the boiling effect, we can break it down into two main components:</p>
<ul>
<li><strong>Distorting the edges</strong>: The edges of the shapes should not be perfectly straight, but rather have a slight wobble that gives them a more organic and hand-drawn look. This could be achieved by applying a distortion effect to the edges of the shapes – which could be controlled by a set of parameters.</li>
<li><strong>Animating the effect</strong>: Then, these <em>distortion parameters</em> are animated over time (for example, updated with new values every 200 milliseconds), creating a subtle movement that makes an otherwise static scene feel more engaging.</li>
</ul>
<p>Probably, the second part is intuitive to understand, but the first part is a bit more complex. Because we are trying to create this effect in a web context, we will use <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorials/SVG_from_scratch/Filter_effects" target="_blank">SVG filter effects</a> for our approach (step 1). What follows is that we can then easily manipulate (and therefore animate) the properties of these filter effects using JavaScript (step 2). But how do these SVG filter effects work, exactly? Let’s take a closer look.</p>
<h2 id="svg-filter-effects">SVG filter effects</h2>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorials/SVG_from_scratch/Filter_effects" target="_blank">SVG filter effects</a> allow us to apply various visual effects to SVG elements, such as blurring, color manipulation, and distortion. In our case, we will use a combination of the <code>feTurbulence</code> and <code>feDisplacementMap</code> filter primitives to create the boiling effect.</p>
<p>Conceptually, the <strong>Turbulence Field</strong> generates a noise texture that can be used to distort the edges of the shapes. The <strong>Displacement Map</strong> then uses this noise texture to displace the pixels of the original image, creating the desired distortion effect. See this visualization:</p>
<div data-astro-cid-djlh6ttq="">   <div data-astro-cid-djlh6ttq="">  <p> Turbulence + Displacement: How SVG filter effects work together to create the distortion effect </p> </div>  </div> 
<p>Additionally, I’ve created a demo that let’s you explore the interplay of these two filter effects. You can move the layers to see how the distortion changes at the intersection of the two filter effects. Note: The demo contains some added elements and visual indicators for demo purposes and easier understanding.</p>
<astro-island uid="1G6450" component-url="/_astro/Demo2.CNG1nkG3.js" component-export="default" renderer-url="/_astro/client.BjfohHTG.js" props="{}" ssr="" client="only" opts="{&#34;name&#34;:&#34;Demo2&#34;,&#34;value&#34;:true}"></astro-island>
<p>The above demo illustrates how the distortion effect is applied to the image. Let’s take a closer look at how to set up the SVG filter effects in terms of code.</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="html" data-theme="one-dark-pro one-light"><code data-language="html" data-theme="one-dark-pro one-light"><span data-line=""><span>&lt;</span><span>svg</span><span> width</span><span>=</span><span>&#34;400&#34;</span><span> height</span><span>=</span><span>&#34;400&#34;</span><span> viewBox</span><span>=</span><span>&#34;0 0 400 400&#34;</span><span>&gt;</span></span>
<span data-line=""><span>  &lt;</span><span>defs</span><span>&gt;</span></span>
<span data-line=""><span>    &lt;</span><span>filter</span><span> id</span><span>=</span><span>&#34;distortionFilter&#34;</span><span>&gt;</span></span>
<span data-line=""><span>      &lt;!-- Step 1: Create a turbulence field to generate noise --&gt;</span></span>
<span data-line=""><span>      &lt;</span><span>feTurbulence</span></span>
<span data-line=""><span>        type</span><span>=</span><span>&#34;turbulence&#34;</span></span>
<span data-line=""><span>        baseFrequency</span><span>=</span><span>&#34;0.03&#34;</span></span>
<span data-line=""><span>        numOctaves</span><span>=</span><span>&#34;2&#34;</span></span>
<span data-line=""><span>        seed</span><span>=</span><span>&#34;1&#34;</span></span>
<span data-line=""><span>        result</span><span>=</span><span>&#34;noise&#34;</span></span>
<span data-line=""><span>      /&gt;</span></span>
<span data-line=""> </span>
<span data-line=""><span>      &lt;!-- Step 2: Use the noise (in2) to displace the image (in) --&gt;</span></span>
<span data-line=""><span>      &lt;</span><span>feDisplacementMap</span></span>
<span data-line=""><span>        in</span><span>=</span><span>&#34;SourceGraphic&#34;</span></span>
<span data-line=""><span>        in2</span><span>=</span><span>&#34;noise&#34;</span></span>
<span data-line=""><span>        scale</span><span>=</span><span>&#34;20&#34;</span></span>
<span data-line=""><span>        xChannelSelector</span><span>=</span><span>&#34;R&#34;</span></span>
<span data-line=""><span>        yChannelSelector</span><span>=</span><span>&#34;G&#34;</span></span>
<span data-line=""><span>      /&gt;</span></span>
<span data-line=""><span>    &lt;/</span><span>filter</span><span>&gt;</span></span>
<span data-line=""><span>  &lt;/</span><span>defs</span><span>&gt;</span></span>
<span data-line=""> </span>
<span data-line=""><span>  &lt;!-- Step 3: Apply the filter to the image --&gt;</span></span>
<span data-line=""><span>  &lt;</span><span>image</span></span>
<span data-line=""><span>    x</span><span>=</span><span>&#34;0&#34;</span><span> y</span><span>=</span><span>&#34;0&#34;</span><span> width</span><span>=</span><span>&#34;400&#34;</span><span> height</span><span>=</span><span>&#34;400&#34;</span></span>
<span data-line=""><span>    href</span><span>=</span><span>&#34;/image.jpg&#34;</span></span>
<span data-line=""><span>    filter</span><span>=</span><span>&#34;url(#distortionFilter)&#34;</span></span>
<span data-line=""><span>  /&gt;</span></span>
<span data-line=""><span>&lt;/</span><span>svg</span><span>&gt;</span></span></code></pre></figure>
<p>The code shown above applies a filter that distorts an image using procedural noise. <code>feTurbulence</code> generates the noise texture, and <code>feDisplacementMap</code> uses it to offset the image pixels (more specifically, for the <code>x</code>-axis, the red channel, and the <code>y</code>-axis, the green channel). The result is a subtle warping effect applied to the image. For now, the parameters of the filter are static, but we can animate them to create the boiling effect. The real magic happens there!</p>
<h2 id="animating-the-effect">Animating the effect</h2>
<p>Now that we know how to apply the effect to an image, we can additionally animate the parameters of the filter using JavaScript. The key is to update the various attributes of the SVG filter effects at regular intervals, creating a dynamic distortion effect that simulates the boiling motion that we are looking for.</p>
<p>Here’s an interactive demo that shows the original image and the animated boiling effect applied to it. You can control the parameters of the effect. Use the dropdown to choose from some sample images. I created these simple illustrations as raster images, but SVG filter effects can also be applied to, you guessed it, SVG images. The result is identical.</p>
<astro-island uid="ZzJ8gp" component-url="/_astro/Viewer1.TCrjvRJe.js" component-export="default" renderer-url="/_astro/client.BjfohHTG.js" props="{&#34;sceneKeys&#34;:[1,[[0,&#34;/_astro/carrot.D3m6Gu3B.png&#34;],[0,&#34;/_astro/cherry.DS5w8RIV.png&#34;],[0,&#34;/_astro/fruit.lWxJTdbt.png&#34;],[0,&#34;/_astro/star.BGk3PXNj.png&#34;]]],&#34;imageSrc&#34;:[0,&#34;star.png&#34;],&#34;numOctaves&#34;:[0,5],&#34;showfeDisplacementMap&#34;:[0,true],&#34;frequencies&#34;:[1,[[0,-0.02],[0,0.01],[0,-0.01],[0,0.02]]],&#34;animate&#34;:[0,true],&#34;displacementScale&#34;:[0,5],&#34;showControls&#34;:[0,true],&#34;showRawImage&#34;:[0,true],&#34;imageOptionsList&#34;:[1,[[0,{&#34;src&#34;:[0,&#34;star.png&#34;],&#34;invert&#34;:[0,true]}],[0,{&#34;src&#34;:[0,&#34;cherry.png&#34;],&#34;invert&#34;:[0,false]}],[0,{&#34;src&#34;:[0,&#34;carrot.png&#34;],&#34;invert&#34;:[0,false]}]]],&#34;description&#34;:[0,&#34;This effect uses an SVG filter combining &lt;code&gt;feTurbulence&lt;/code&gt; and\n  &lt;code&gt;feDisplacementMap&lt;/code&gt; to simulate a boiling distortion on the\n  image. You can control the base turbulence, the intensity of the\n  displacement, and the animation scale that modulates the effect over\n  time by offsetting the base frequency with a looping sequence of values.&#34;],&#34;invert&#34;:[0,true]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;Viewer1&#34;,&#34;value&#34;:true}"></astro-island>
<p>Here’s what the animation scale slider does. We begin with a <code>baseFrequency</code> of <code>0.02</code> and a small list of offsets that we define: <code>[-0.02, 0.01, -0.01, 0.02]</code>. Every <code>100ms</code>, we take the next offset, multiply it by the slider value, and add the result to that base. With the slider at <code>0.5</code> the first tick becomes <code>0.02 + (-0.02 × 0.5)</code>, resulting in the <code>baseFrequency</code> being set to <code>0.01</code>. The wobble appears gentle in this tick or frame. Set the slider to <code>1</code> and you will see the full <code>±0.02</code> wobble changes between frames. If you set it to <code>0</code>, there’s no wobble.</p>
<astro-island uid="Z1SSLAb" component-url="/_astro/Viewer1.TCrjvRJe.js" component-export="default" renderer-url="/_astro/client.BjfohHTG.js" props="{&#34;sceneKeys&#34;:[1,[[0,&#34;/_astro/carrot.D3m6Gu3B.png&#34;],[0,&#34;/_astro/cherry.DS5w8RIV.png&#34;],[0,&#34;/_astro/fruit.lWxJTdbt.png&#34;],[0,&#34;/_astro/star.BGk3PXNj.png&#34;]]],&#34;imageSrc&#34;:[0,&#34;cherry.png&#34;],&#34;numOctaves&#34;:[0,5],&#34;showfeDisplacementMap&#34;:[0,true],&#34;frequencies&#34;:[1,[[0,-0.02],[0,0.01],[0,-0.01],[0,0.02]]],&#34;animate&#34;:[0,true],&#34;displacementScale&#34;:[0,5],&#34;showControls&#34;:[0,true],&#34;showRawImage&#34;:[0,false],&#34;imageOptionsList&#34;:[1,[[0,{&#34;src&#34;:[0,&#34;cherry.png&#34;],&#34;invert&#34;:[0,false]}],[0,{&#34;src&#34;:[0,&#34;carrot.png&#34;],&#34;invert&#34;:[0,false]}],[0,{&#34;src&#34;:[0,&#34;fruit.png&#34;],&#34;invert&#34;:[0,false]}]]],&#34;description&#34;:[0],&#34;invert&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;Viewer1&#34;,&#34;value&#34;:true}"></astro-island>
<p>Here’s a full scene. The parameters are the same as the initial parameters in the previous demo (use the reset button to restore their values).</p>
<astro-island uid="1Le8QQ" component-url="/_astro/Viewer1.TCrjvRJe.js" component-export="default" renderer-url="/_astro/client.BjfohHTG.js" props="{&#34;sceneKeys&#34;:[1,[[0,&#34;/_astro/carrot.D3m6Gu3B.png&#34;],[0,&#34;/_astro/cherry.DS5w8RIV.png&#34;],[0,&#34;/_astro/fruit.lWxJTdbt.png&#34;],[0,&#34;/_astro/star.BGk3PXNj.png&#34;]]],&#34;imageSrc&#34;:[0,&#34;fruit.png&#34;],&#34;numOctaves&#34;:[0,5],&#34;showfeDisplacementMap&#34;:[0,true],&#34;frequencies&#34;:[1,[[0,-0.02],[0,0.01],[0,-0.01],[0,0.02]]],&#34;animate&#34;:[0,true],&#34;displacementScale&#34;:[0,5],&#34;showControls&#34;:[0,false],&#34;showRawImage&#34;:[0,false],&#34;imageOptionsList&#34;:[0],&#34;description&#34;:[0],&#34;invert&#34;:[0,false]}" ssr="" client="only" opts="{&#34;name&#34;:&#34;Viewer1&#34;,&#34;value&#34;:true}"></astro-island>
<p>Nice! With just two humble filter primitives and a bit of JavaScript, we’ve turned boring shapes into something that feels alive, simulating the warmth and imperfections found in hand-drawn animation styles.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In short, the “boiling” effect boils down to a procedural noise field (<code>feTurbulence</code>) fed into a displacement map (<code>feDisplacementMap</code>), whose parameters we shuffle every few milliseconds in JavaScript. By decomposing the problem into distortion and animation and wrapping the whole thing in SVG filters, we get an effect that lets us bring this effect to the web, and bring static illustrations to life.</p>
<p>The interactive demos I created (which was pretty fun to do so, I must admit!) show how small tweaks to the base frequency, displacement scale and animation scale can shift the mood from a subtle jitter to an extreme and annoying wobble, which leaves the original image’s shapes barely recognizable. A little goes a long way here: Don’t let things boil over. Now it’s your turn and try it out yourself!</p>
<p>By the way, you can find <a href="https://www.arte.tv/de/videos/RC-026196/ran-an-die-toepfe/" target="_blank">more recipes</a> from the ARTE series, all of which contain animations of this style. Unfortunately, even after searching for quite a while, I could not find out whom to give (well deserved) credits to for creating these cool illustrations in this documentary series.</p>
<p>I hope you enjoyed this little excursion into the world of “hand-drawn” motion effects and SVG filter primitives. If you have any questions or feedback, feel free to reach out.</p> </div></div>
  </body>
</html>
