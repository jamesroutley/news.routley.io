<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://30fps.net/pages/videogame-shadows/">Original</a>
    <h1>Classic 3D videogame shadow techniques</h1>
    
    <div id="readability-page-1" class="page"><div id="text">

<p>Towards the end of Wim Wenders’s excellent <em>Perfect Days</em>, the protagonist Hirayama is drinking beer under a bridge after he has seen a Businessman courting his crush. Suddenly the Businessman joins him under the bridge. As it turns out, things aren’t actually that simple but the point is their conversation takes them to some fundamental questions:</p>
<blockquote>
<p><strong>Businessman:</strong> Shadows. Do they get darker when they overlap?</p>
</blockquote>
<p>Then they step into to the light of a street lamp and investigate their shadows (<a href="https://www.youtube.com/watch?v=C6cdPxQjHb0">the full scene</a>):</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/Perfect_Days_shadows.jpg" alt=""/><figcaption>An iconic scene in <em>Perfect Days</em> (2023). Still via <a href="https://film-grab.com/2024/04/12/perfect-days/">film-grabs.com</a>.</figcaption>
</figure>
<p>Even though the Businessman sees no difference, Hirayama is convinced the overlapping shadows <em>do</em> become darker. “It has to get darker to make sense.” What a moving scene.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/metalgear-crop.jpg"/>
<figcaption>
Shadows do become darker when</figcaption>
</figure>
<p>Unfortunately Hirayama is mistaken. Shadows don’t get any darker there. There’s just one light source, and relatively far away, so the shadow is simply an absence of light. It doesn’t matter how many times the light is blocked.</p>
<p>When it comes to 3D videogames, shadows are something else. It’s easy to paint dark blob under some character’s feet and assume everything else is lit. Perhaps Hirayama was recalling the blob shadow in <em>Metal Gear Solid</em> that <em>does</em> become darker when it overlaps with others?</p>
<p>In the real world, shadows simply exist but in games they are both engineered and designed. They must run well but also look good. I find this relationship fascinating and I’m going to show you why. Let’s start simple.</p>

<h2 id="on-screen-2d-shadows">On-screen 2D shadows</h2>
<p>You can draw a shadow image to the screen before you draw a character. I’m not talking about shadow sprites <a href="https://www.mobygames.com/game/365/duke-nukem-3d/screenshots/dos/700154/">like in Duke Nukem 3D</a> but literally a 2D image without any scaling. This works if the character is in front of everything like in <em>Winter Gold</em> or <em>MDK</em>.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/16539773-winter-gold-snes-downhill-crop.png"/> <img src="https://www.stevegattuso.me/2024/10/29/10559518-mdk-dos-that-spaceship-is-deploying-a-lot-of-troops-crop.jpg"/>
<figcaption>
Winter Gold (1996, SNES) and MDK (1996, PC) draw animated 2D shadow images. Also check out Winter Gold’s <a href="https://www.youtube.com/watch?v=-Pr909aVsNo">sick Amiga-style intro video</a> :)
</figcaption>
</figure>
<p>I said it was simple.</p>
<h2 id="blob-shadow">Blob shadow</h2>
<p>OK now in 3D. Draw a dark disc under the character. Done.</p>
<p>Well, you should also align the shadow disc with the ground and also decide how to handle situations where the shadow would reach over a ledge. For example in <em>Super Mario 64</em>, the blobs are drawn using a special hardware feature that effectively clips the shadow to show up only on the ground plane.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/sm64_blob2.jpg"/> <img src="https://www.stevegattuso.me/2024/10/29/sm64_shadow_decal2.jpg"/> <img src="https://www.stevegattuso.me/2024/10/29/sm64_blobs.jpg"/>
<figcaption>
Super Mario 64 (1996, Nintendo 64) uses blob shadows for characters.</figcaption>
</figure>
<p>The blob shadow can also be animated. In Super Mario 64 it becomes smaller when jumping and <a href="https://youtu.be/F2sEmf_HzGI?t=3793">in <em>Metal Gear Solid</em> it changes shape</a>. If you’re feeling ambitious, you can also solve the shadow-over-a-ledge issue by <a href="http://blog.wolfire.com/2009/06/how-to-project-decals/">projecting the blob quad like a decal</a>.</p>
<h2 id="planar-shadows-with-a-render-texture">Planar shadows with a render texture</h2>
<p>The blob is just a texture and usually textures can be rendered to at runtime. So render the character from the top and use that instead of a dark circle. This works great in <em>Crash 3</em> (<a href="https://youtu.be/HG-NRnGp3RA?t=267">video</a>) but not so well in <em>Soldier of Fortune</em> because they kept the shadow resolution so low.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/16310901-crash-bandicoot-warped-playstation-c-boxes-allow-you-to-restart-crop2.png"/> <img src="https://www.stevegattuso.me/2024/10/29/soldieroffortune.jpg"/>
<figcaption>
<strong>Left:</strong> Crash Bandicoot: Warped (1998, PlayStation) renders shadow textures at runtime. <strong>Right:</strong> Soldier of Fortune (2000, PC) also does but at a lower resolution. A cropped still from <a href="https://www.youtube.com/watch?v=wq82etLV0a8">a video by FirstPlays HD</a>.
</figcaption>
</figure>
<p>Note that this is distinct from <a href="https://learnopengl.com/Advanced-Lighting/Shadows/Shadow-Mapping">shadow mapping</a> where a depth map is rendered from the light’s point of view. Here we render only a black &amp; white image that is used as a texture. So in a sense we’re talking about a 1-bit shadow map.</p>
<p>How could we make the shadows sharper?</p>
<h2 id="planar-shadows-with-geometry">Planar shadows with geometry</h2>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/f19-stealth-fighter-back.png"/>
<figcaption>
The F-117A plane casts a shadow in</figcaption>
</figure>
<p>One intuitive option is to flatten a shadow caster on a plane by projecting it away from the light. Then render it the second time but now in black. They are usually kept opaque to hide how object parts are drawn on top of another. Naturally the shadow will be correct only on a flat floor.</p>
<p>Some early flight simulators draw a top-down flat shadow when on a runway. During my research I expected to see examples where the shadow is also seen when in flight but couldn’t find any.</p>

<figure>
<img src="https://www.stevegattuso.me/2024/10/29/kingpin.jpg"/> <img src="https://www.stevegattuso.me/2024/10/29/half-life-shadows1.jpg"/>
<figcaption>
<a href="https://quakewiki.org/wiki/GLQuake">GLQuake’s</a> planar shadows in two games. <strong>Left:</strong> <em>Kingpin: Life of Crime</em> (1999, PC) gets away with black planar shadows. <strong>Right:</strong> Shadows exhibit transparency issues in <a href="https://www.moddb.com/downloads/half-life-1-alpha-052"><em>Half-Life</em> alpha 0.52</a>. Screenshot taken via Wine on Linux.
</figcaption>
</figure>
<p>Visually these look the same as black stencil shadows cast on a flat plane.</p>
<h3 id="shadows-on-terrain">Shadows on terrain</h3>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/virus.png"/>
<figcaption>
Virus (1987) Atari ST port. The little ship casts</figcaption>
</figure>
<p>David Braben’s 1987 <a href="https://www.youtube.com/watch?v=MNXypBxNGMo"><em>Virus</em></a> on Acorn Archimedes and other home computers draws spaceships that cast top-down shadows on terrain.</p>
<p>A more elaborate example is <em>Interstate ’76</em>. There they tilt and stretch a planar shadow to match the ground slope. The shadows <a href="https://www.stevegattuso.me/2024/10/29/interstate76_shadow_inside_terrain.jpg">occasionally penetrate the ground</a> but are pretty convincing overall. Interestingly, the below software-rendered screenshot has slightly transparent shadows while the hardware accelerated ones are pitch black.</p>
<p>They also had the courage to try to <a href="https://youtu.be/9UyOuqsvs64?t=52">project shadows for large objects like bridges</a> which isn’t, well, entirely successful.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/interstate-76.png" alt=""/><figcaption>Interstate ’76 (1997, PC) has sun casting tilted planar shadows on terrain.</figcaption>
</figure>
<p>But how do you cast shadows on any kind of scene?</p>
<h2 id="projected-texture-drop-shadow">Projected texture drop shadow</h2>
<figure><a id="projected-texture-drop-shadow">
<img src="https://www.stevegattuso.me/2024/10/29/dropshadow_ownby_2010.jpg"/> <img src="https://www.stevegattuso.me/2024/10/29/buzzjump.jpg"/>
</a><figcaption><a id="projected-texture-drop-shadow">
<strong>Left:</strong> A slide from the deck </a><a href="https://advances.realtimerendering.com/s2010/Ownby,Hall%20and%20Hall%20-%20Toystory3%20(SIGGRAPH%202010%20Advanced%20RealTime%20Rendering%20Course).pdf"><em>Toy Story 3: The Video Game Rendering Techniques</em></a>. </figcaption>
</figure>
<p>This approach bears a lot of similarity to <em>Planar shadows with a render texture</em> presented earlier but works on surfaces of any shape. The game renders a shadow texture from the top but instead of showing it on a flat plane, the <a href="https://paroj.github.io/gltut/Texturing/Tut17%20Projective%20Texture.html">texture is projected</a> to other objects. Think of it as the <a href="https://en.wikipedia.org/wiki/Bat-Signal">Bat-Signal</a> but pointed straight down from the sky.</p>
<p>Shadows like this can be made really sharp but they can look strange on vertical surfaces and occassionally even appear on the ceiling. See this <a href="https://youtu.be/EU4CbUoPBi4?t=752">gameplay video of <em>Sonic Adventure 2: Battle</em></a> (2001, GameCube).</p>
<p>This technique also works great for trees:</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/12333235-the-elder-scrolls-iv-oblivion-xbox-360-the-speedtree-engine-at-w.jpg" alt=""/><figcaption>The Elder Scrolls IV: Oblivion (2006, Xbox 360) has beautiful projected tree shadows.</figcaption>
</figure>
<p>Projected shadows can show through objects which makes them suitable only for special cases. Shadow maps are something you can use anywhere.</p>
<h2 id="shadow-maps">Shadow maps</h2>
<p>The de facto approach to shadows. The game draws a depth image, the shadow map, from the point of view of the light and reads from that image when rendering the world. This is easy to do since you can reuse the game engine’s regular rendering code.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/hl2_2004_shadows.jpg" alt=""/><figcaption><em>Half-Life 2 (2004, PC)</em> used shadow maps for characters. Dynamic flashlight shadows (not shown) were added in the 2007 <em>Episode Two</em> expansion.</figcaption>
</figure>
<p>The limited resolution of the shadow map gives rise to well-known artifacts with <a href="https://learn.microsoft.com/en-us/windows/win32/dxtecharts/common-techniques-to-improve-shadow-depth-maps#shadow-acne-and-erroneous-self-shadowing">inventive names such as “Peter Panning” and “shadow acne”</a>. Many tricks have been proposed to allocate more shadow map area to surfaces near the camera where the extra resolution is needed the most. Shadow maps usually need some tweaking to look right.</p>
<p>Before shadow maps became dominant, there was a popular competitor.</p>
<h2 id="stencil-shadows">Stencil shadows</h2>
<p>The has-been approach to shadows. Stencil shadows draw sharp shadows on any kind of surface. They create a unique film-noir look that’s hard to emulate with shadow maps. Most well-known example is of course <em>Doom 3</em> with its dark rooms:</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/Doom3snap4.jpg" alt=""/><figcaption>Doom 3 (2004) had no static level lighting and all shadows were computed at runtime. Screenshot from <a href="http://warp.povusers.org/doom3snapshots/"><em>Doom 3 shadow engine snapshots</em></a>.</figcaption>
</figure>
<p>Stencil shadows are based on the idea of <em>shadow volumes</em>, invisible geometry that cuts the world into lit and shadowed spaces. The game applies lighting only on pixels that don’t lie inside a shadow volume.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/Shadow_volume_illustration.png" alt=""/><figcaption>The game needs to construct “shadow volume” meshes shown in yellow. Surfaces inside the volumes stay unlit. <a href="https://commons.wikimedia.org/wiki/File:Shadow_volume_illustration.png">Shadow volume illustration</a> by Rainwarrior, CC BY-SA 3.0.</figcaption>
</figure>
<p>Stencil shadows need the world to be drawn many times to work. Simplified a bit, the game first draws the whole world with ambient lighting. Then for each light, all the shadow volumes, followed by the world again, affecting only unshadowed pixels. The volumes are drawn with different <a href="https://learnopengl.com/Advanced-OpenGL/Stencil-testing"><em>stencil operations</em></a> set <a href="https://registry.khronos.org/OpenGL-Refpages/gl4/html/glStencilOpSeparate.xhtml">for front and back faces</a>. It’s a lot of pixels to draw.</p>
<p>Possibly the earliest shipping game with stencil shadows is <em>Severance: Blade of Darkness</em> from 2001 whose shadows <a href="https://youtu.be/irwzEDLZ2gk?t=417">look great</a>.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/11323681-blade-of-darkness-windows-blade-was-also-well-known-for-its-wond-edit.jpg" alt=""/><figcaption>Severance: Blade of Darkness (2001, PC) had stencil shadows.</figcaption>
</figure>
<p>Reading the <a href="https://www.stevegattuso.me/2024/10/29/blade_of_darkness_edge_review.jpg">Edge UK edition March 2001 review</a> (<a href="https://retrocdn.net/images/2/2d/Edge_UK_095.pdf">pdf</a>) of the game makes it clear that despite the graphics advancements, the world wasn’t ready for a soulslike back then.</p>
<p>Stencil shadows are not used much nowadays. One reason is their unpredictable runtime cost. The cost is dependent on how large the volume is on screen and therefore varies a lot. Also an <a href="https://en.wikipedia.org/wiki/Shadow_volume#Depth_fail">optimized algorithm</a> was patented. For Doom 3, <a href="https://web.archive.org/web/20100131044756/http://techreport.com/discussions.x/7113">Id Software apparently reached</a> some sort of <a href="https://web.archive.org/web/20090818013827/http://www.theinquirer.net/inquirer/news/1019517/creative-background-doom-iii-shadow-story">a deal</a>.</p>
<h3 id="soft-stencil-shadows">Soft stencil shadows</h3>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/silent_hill_2_shadows1_crop2.jpg"/> <img src="https://www.stevegattuso.me/2024/10/29/silenthill2_color_buffer.png"/> <img src="https://www.stevegattuso.me/2024/10/29/silenthill2_shadow_buffer.png"/>
<figcaption>
<strong>Left:</strong> Silent Hill 2 (2001, PlayStation 2) has soft stencil shadows. <strong>Center:</strong> 2x zoomed crop. <strong>Right:</strong> A shadow debug view with unlit areas colored black. <a href="https://imgsli.com/MzExMjcy/">Screenshots</a> from the PCSX2 emulator lightened up for visualization.
</figcaption>
</figure>
<p>Stencil shadows don’t need to be sharp. Another game from 2001, <em>Silent Hill 2</em> on the PlayStation 2, blurred the stencil shadows afterwards as seen above. <a href="https://youtu.be/nna2yt1c9gI?t=354">It looks pretty much perfect</a> on the console.</p>
<h2 id="simplified-character-shadows">Simplified character shadows</h2>
<p>What if the shadows are cast by a simpler model than what’s shown on screen? For example in Zelda on the Nintendo 64, Link’s feet cast shadows even though nothing else does:</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/15709360-the-legend-of-zelda-ocarina-of-time-nintendo-64-in-zoras-domain.jpg" alt=""/><figcaption>The Legend of Zelda: Ocarina of Time (1998, Nintendo 64) has Link’s feet cast shadows as if they were tall vertical cylinders. I presume the shadows are two stretched decals.</figcaption>
</figure>
<p>One unique approach is seen in <em>Hyperblade</em> where players on a futuristic hockey arena cast planar shadows as simple animated shapes.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/hyperblade.png" alt=""/><figcaption>Hyperblade (1996, PC) projects a simplified planar shadow that moves. It’s not perfect as seen in the rightmost image. Stills from a <a href="https://youtu.be/EpScHKYEEpE?t=43">video by Bit Games Reviews</a>.</figcaption>
</figure>
<h2 id="shadows-in-static-level-lighting">Shadows in static level lighting</h2>
<p>Vertex colors and lightmaps are techniques to capture lighting of a game level. They have been used in many games as the only way to show large scale shadows, which is why I’ve included them here.</p>
<h3 id="vertex-colors">Vertex colors</h3>
<p><em>Ico</em> shows how sophisticated shadows can look with just old school per-vertex lighting.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/ico.jpg" alt=""/><figcaption>Ico (2001, PlayStation 2) has level lighting baked to vertex colors. For characters <a href="https://youtu.be/QCOAqyOE_V4?t=438">it uses stencil shadows</a>.</figcaption>
</figure>
<p>For low-poly maps even sharp shadows can be represented with vertex colors. A prime example is <em>Tony Hawk Pro Skater 2</em> (2000, Playstation) which looks amazing considering the simplicity of the technique.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/thps-2-dreamcast-venice-beach-1.jpg" alt=""/><figcaption>“Venice Beach” level in Tony Hawk Pro Skater 2 (2000, PlayStation) with its sharp vertex color shadows. This shot is from the Dreamcast port.</figcaption>
</figure>
<h3 id="lightmaps">Lightmaps</h3>
<p>Lightmaps are the classic way to store level lighting and shadows. Instead of storing a color for each vertex, there’s a second set of textures that represent only lighting. The resolution can vary per area, making the shadows more accurate where needed. On the other hand, lightmaps consume more memory than vertex colors.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/11192353-mirrors-edge-windows-training-grounds-crop.jpg" alt=""/><figcaption>Mirror’s Edge (2008, PC) is basically Lightmaps: The Game.</figcaption>
</figure>
<p>Lightmaps were popularized by <em>Quake</em> (1996, PC) and <a href="https://jbush001.github.io/2015/06/11/quake-lightmaps.html">this is how they look</a>.</p>
<p>That concludes our look into traditional shadow techniques. Let’s talk a bit about lighting in general next.</p>
<h2 id="shadows-in-modern-games">Shadows in modern games</h2>
<p>Modern games use the traditional techniques when appropriate. Some examples:</p>
<ul>
<li>Variants of <strong>shadow mapping</strong> such as <a href="https://learnopengl.com/Guest-Articles/2021/CSM">Cascaded Shadow Maps</a> to cover large areas while still staying fast.</li>
<li><strong>Lightmaps</strong> in combination with other techniques such as <a href="https://computergraphics.stackexchange.com/a/244">light probes</a>. <em>Call of Duty</em> <a href="https://www.stevegattuso.me/2024/10/29/CoD_Hemispheres_Presentation_Notes_p6.jpg">still has lightmaps</a>, see the <a href="https://advances.realtimerendering.com/s2024/content/Roughton/SIGGRAPH%20Advances%202024%20-%20Hemispheres%20Presentation%20Notes.pdf">Hemispherical Lighting Insights</a> slides.</li>
<li>The <strong>simplified character model idea</strong>. <em>The Last of Us</em> (2013, PlayStation 3) casts soft character shadows with stretched spheres. See <a href="https://www.stevegattuso.me/2024/10/29/tlou1.jpg">this slide</a> of the deck <a href="http://miciwan.com/SIGGRAPH2013/Lighting%20Technology%20of%20The%20Last%20Of%20Us.pdf">Lighting Technology of The Last Of Us (2013)</a>. Also Unreal Engine supports simplified <a href="https://dev.epicgames.com/documentation/en-us/unreal-engine/capsule-shadows-overview-in-unreal-engine">“capsule shadows”</a> for characters.</li>
<li><strong>Projected shadows</strong>. In <em>Hot Wheels Track Attack</em> (2010, Wii) they render a shadow mesh to a texture and project that on the race track, as described in <a href="https://www.bryanmcphail.com/wp/?p=640">one of the developer’s blog</a>. The game looks great <a href="https://youtu.be/k85H5C7P0RY?t=349">in motion</a>!</li>
</ul>
<h3 id="ray-traced-shadows">Ray-traced shadows</h3>
<p>In the beginning we established that shadows are formed by a lack of light. If the game really tries to simulate physically correct lighting then shadows will naturally appear. Even small geometric details <a href="https://images.nvidia.com/geforce-com/international/comparisons/control/control-ray-traced-contact-shadows-interactive-comparison-001-on-vs-off.html">will cast accurate shadows</a>, unlike in shadow maps. Big lamps will naturally create soft shadows and indirect light will brighten dark corners. An incredible amount of time and money have been invested in ray tracing algorithms and hardware to make this dream reality.</p>
<p>In practice modern games have such complex scenes the above simulated solution has to be approximated. For example in the ray-traced shadows of <em>Alan Wake 2</em> (2023) each pixel receives lighting <a href="https://www.stevegattuso.me/2024/10/29/aw2_restir.jpg">only from a single randomly chosen light</a>. The result is eventually <a href="https://www.stevegattuso.me/2024/10/29/aw2_direct_lighting.jpg">fed to a denoiser</a> that intelligently smooths out the noisy picture. See <a href="https://www.nvidia.com/en-us/on-demand/session/gdc24-gdc1003/?playlistId=playList-821861a9-571a-4073-abab-d60ece4d1e49">the whole presentation</a> for details. Therefore even ray-traced shadows won’t be “perfect” and will have their own look, depending on the tradeoffs made.</p>
<p>Finally, the obvious option.</p>
<h2 id="no-shadows">No shadows</h2>
<p>Sometimes your priorities are elsewhere.</p>
<figure>
<img src="https://www.stevegattuso.me/2024/10/29/16483987-alone-in-the-dark-dos-shall-we-dance-scaled.jpg" alt=""/><figcaption><em>Alone in the Dark</em> (1992, DOS) had no character shadows.</figcaption>
</figure>

<hr/>
<p>In the movie scene, when Hirayama is carefully studying the shadows, his new friend makes an observation:</p>
<blockquote>
<p><strong>Businessman:</strong> You’re really into this.<br/></p>
</blockquote>
<p>As computer graphics enthusiasts, I think we can symphatize.</p>
<p><em>All screenshots provided by <a href="https://www.mobygames.com/">MobyGames</a> unless noted otherwise.</em> <em>Thanks to mankeli for detailed notes on an early draft of this article. Thanks to noby, msqrt, shaiggon and Warma for feedback.</em></p>



</div></div>
  </body>
</html>
