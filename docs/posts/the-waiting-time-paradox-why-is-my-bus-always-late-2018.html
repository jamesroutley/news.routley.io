<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jakevdp.github.io/blog/2018/09/13/waiting-time-paradox/">Original</a>
    <h1>The waiting time paradox: why is my bus always late? (2018)</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>
<div>


<p><img src="http://jakevdp.github.io/images/rapid-ride.jpg" alt="Rapid Ride Bus"/>
<em>Image Source: <a href="https://en.wikipedia.org/wiki/RapidRide#/media/File:King_County_Metro_Rapid_Ride_New_Flyer_DE60LFR_6060.JPG">Wikipedia</a> License CC-BY-SA 3.0</em></p>
<p>If you, like me, frequently commute via public transit, you may be familiar with the following situation:</p>
<blockquote><p><em>You arrive at the bus stop, ready to catch your bus: a line that advertises arrivals every 10 minutes. You glance at your watch and note the time... and when the bus finally comes 11 minutes later, you wonder why you always seem to be so unlucky.</em></p>
</blockquote>
<p>Naïvely, you might expect that if buses are coming every 10 minutes and you arrive at a random time, your average wait would be something like 5 minutes.
In reality, though, buses do not arrive exactly on schedule, and so you might wait longer.
It turns out that under some reasonable assumptions, you can reach a startling conclusion:</p>
<p><strong>When waiting for a bus that comes on average every 10 minutes, your average waiting time will be 10 minutes.</strong></p>
<p>This is what is sometimes known as the <em>waiting time paradox</em>.</p>
<p>I&#39;ve encountered this idea before, and always wondered whether it is actually true... how well do those &#34;reasonable assumptions&#34; match reality?
This post will explore the waiting time paradox from the standpoint of both simulation and probabilistic arguments, and then take a look at some real bus arrival time data from the city of Seattle to (hopefully) settle the paradox once and for all.</p>

</div>
</div>
</div><div>
<div>
<div>
<p>If buses arrive exactly every ten minutes, it&#39;s true that your average wait time will be half that interval: 5 minutes.
Qualitatively speaking, it&#39;s easy to convince yourself that adding some variation to those arrivals will make the average wait time somewhat longer, as we&#39;ll see here.</p>
<p>The waiting time paradox turns out to be a particular instance of a more general phenomenon, the <em>inspection paradox</em>, which is discussed at length in this enlightening post by Allen Downey: <a href="http://allendowney.blogspot.com/2015/08/the-inspection-paradox-is-everywhere.html">The Inspection Paradox Is Everywhere</a>.</p>
<p>Briefly, the inspection paradox arises whenever the probability of observing a quantity is related to the quantity being observed.
Allen gives one example of surveying university students about the average size of their classes. Though the school may truthfully advertise an average of 30 students per class, the average class size <em>as experienced by students</em> can be (and generally will be) much larger. The reason is that there are (of course) more students in the larger classes, and so you oversample large classes when computing the average experience of students.</p>
<p>In the case of a nominally 10-minute bus line, sometimes the span between arrivals will be longer than 10 minutes, and sometimes shorter, and if you arrive at a random time, you have more opportunities to encounter a longer interval than to encounter a shorter interval. And so it makes sense that the average span of time <em>experienced by riders</em> will be longer than the average span of time between buses, because the longer spans are over-sampled.</p>
<p>But the waiting time paradox makes a stronger claim than this: when the average span between arrivals is $N$ minutes, the average span <em>experienced by riders</em> is $2N$ minutes.
Could this possibly be true?</p>

</div>
</div>
</div><div>
<div>
<p>To convince ourselves that the waiting time paradox is making a reasonable claim, let&#39;s start by simulating a stream of buses that arrive at an average of 10 minutes.
For the sake of numerical accuracy, we will simulate a large number of bus arrivals: one million buses (or approximately 19 years of round-the-clock 10-minute headways):</p>
</div>
</div><div>
<div>
<p>Just to confirm we&#39;ve done things correctly, let&#39;s check that the mean interval is close to $\tau = 10$:</p>
</div>
</div><div>
<div>
<p>With these bus arrivals simulated, we can now simulate the arrival of a large number of passengers to the bus stop during this span, and compute the wait time that each of them experiences.
Let&#39;s encapsulate this in a function for later use:</p>
</div>
</div><div>
<div>
<p>We can then simulate some wait times and compute the average:</p>
</div>
</div><div>
<div>
<p>The average wait time is also close to 10 minutes, just as the waiting time paradox predicted.</p>
</div>
</div><div>
<div>
<div>
<h2 id="Digging-Deeper:-Probabilities-&amp;-Poisson-Processes">Digging Deeper: Probabilities &amp; Poisson Processes<a href="#Digging-Deeper:-Probabilities-&amp;-Poisson-Processes">¶</a></h2>
</div>
</div>
</div><div>
<div>
<div>
<p>How can we understand what&#39;s going on here?</p>
<p>Fundamentally, this is an instance of the inspection paradox, in which the probability of observing a value is related to the value itself.
Let&#39;s denote by $p(T)$ the distribution of intervals $T$ between buses as they arrive at a bus stop. In this notation, the expectation value of the arrival times is
$$
E[T] = \int_0^\infty T~p(T)~dT
$$
In the above simulation, we had chosen $E[T] = \tau = 10$ minutes.</p>

</div>
</div>
</div><div>
<div>
<div>
<p>When a rider arrives at a bus stop at a random time, the probability of the time interval they experience will be affected by $p(T)$, but also by $T$ itself: the longer the interval, the larger the probability is that a passenger will experience it.</p>
<p>So we can write the distribution of arrival times experienced by passengers:
$$
p_{exp}(T) \propto T~p(T)
$$
The constant of proportionality comes from normalizing the distribution:
$$
p_{exp}(T) = \frac{T~p(T)}{\int_0^\infty T~p(T)~dT}
$$
Comparing to above we see this simplifies to
$$
p_{exp}(T) = \frac{T~p(T)}{E[T]} 
$$
The expected wait time $E[W]$ will then be half of the expected interval experienced by passengers, so we can write
$$
E[W] = \frac{1}{2}E_{exp}[T] = \frac{1}{2}\int_0^\infty T~p_{exp}(T)~dT
$$
which can be rewritten in a more suggestive way:
$$
E[W] = \frac{E[T^2]}{2E[T]}
$$
and now all that remains is for us to choose a form for $p(T)$ and compute the integrals.</p>

</div>
</div>
</div><div>
<div>
<div>
<h3 id="Choosing--p(T)">Choosing  <em>p(T)</em><a href="#Choosing--p(T)">¶</a></h3><p>With this formalism worked out, what is a reasonable distribution to use for $p(T)$?
We can get a picture of the $p(T)$ distribution within our simulated arrivals by plotting a histogram of the intervals between arrivals:</p>

</div>
</div>
</div><div>
<div>
<div>
<p>The vertical dotted line here shows the mean interval of about 10 minutes.
This looks very much like an exponential distribution, and that is no accident: our simulation of bus arrival times as uniform random numbers very closely approximates a <a href="https://en.wikipedia.org/wiki/Poisson_point_process">Poisson process</a>, and for such a process it can be shown that the distribution of intervals between arrivals is exponential.</p>
<p>(Side note: In our case this is only approximately exponential; in reality the intervals $T$ between $N$ uniformly sampled points within a timespan $N\tau$ follow the <a href="https://en.wikipedia.org/wiki/Beta_distribution">Beta distribution</a>: $T/(N\tau) \sim \mathrm{Beta}[1, N]$, which in the large $N$ limit approaches $T \sim \mathrm{Exp}[1/\tau]$.
See, e.g. <a href="https://math.stackexchange.com/questions/68749/difference-of-order-statistics-in-a-sample-of-uniform-random-variables">this StackExchange post</a>, or  <a href="https://twitter.com/jakevdp/status/1038086415190351872">this twitter thread</a> for more details).</p>
<p>An exponential distribution of intervals implies that the arrival times follow a Poisson process.
To double-check this reasoning, we can confirm that it matches another property of a Poisson process: the number of arrivals within a fixed span of time will be Poisson-distributed.
Let&#39;s check this by binning our simulated arrivals into hourly blocks:</p>

</div>
</div>
</div><div>
<div>
<p>The close match between the empirical and theoretical values gives confidence that our interpretation is correct: for large $N$, the arrival times we simulated above are well-described by a Poisson process, which implies exponentially-distributed arrival intervals.</p>
</div>
</div><div>
<div>
<p>That means we can write the probability distribution:
$$
p(T) = \frac{1}{\tau}e^{-T/\tau}
$$
Plugging this into the above results, we find that the average waiting time experienced by a person is
$$
E[W] = \frac{\int_0^\infty T^2~e^{-T/\tau}}{2\int_0^\infty T~e^{-T/\tau}} = \frac{2\tau^3}{2(\tau^2)} = \tau
$$
For bus arrivals consistent with a Poisson process, the expected wait time for a passenger is identical to the average interval between arrivals.</p>
</div>
</div><div>
<div>
<p>A complementary way to reason about this is this: a Poisson process is a <em>memoryless</em> process, meaning that the history of events has no bearing on the expected time to the next event.
So when you arrive at the bus stop, the average waiting time until the next bus is always the same: in our case, it is 10 minutes, and this is regardless of how long it has been since the previous bus!
Along the same lines, it does not matter how long you have been waiting already: the expected time to the next arrival is always exactly 10 minutes: for a Poisson process, you get no &#34;credit&#34; for time spent waiting.</p>
</div>
</div><div>
<div>
<div>
<h2 id="Waiting-Times-In-Reality">Waiting Times In Reality<a href="#Waiting-Times-In-Reality">¶</a></h2><p>The above is well and good if real-world bus arrivals are actually described by a Poisson process, but are they?</p>
<p><a href="https://seattletransitmap.com/"><img src="http://jakevdp.github.io/images/seattle-transit-map.png" alt="Seattle Transit Map"/></a>
<em>Image Source: <a href="https://seattletransitmap.com/">https://seattletransitmap.com/</a></em></p>
<p>To determine whether the waiting time paradox describes reality, we can dig into some data, available for download here: <a href="https://gist.githubusercontent.com/jakevdp/82409002fcc5142a2add0168c274a869/raw/1bbabf78333306dbc45b9f33662500957b2b6dc3/arrival_times.csv">arrival_times.csv</a> (3MB CSV file).
The dataset contains scheduled and actual arrival times for Seattle&#39;s <a href="https://kingcounty.gov/depts/transportation/metro/travel-options/bus/rapidride.aspx">Rapid Ride</a> lines C, D, and E at the 3rd &amp; Pike bus stop in downtown Seattle, recorded during the second quarter of 2016 (huge thanks to Mark Hallenbeck of the Washington State Transportation Center for providing this data!).</p>

</div>
</div>
</div><div>
<div>
<p>The reason I sought data from Rapid Ride routes in particular is that for much of the day, the buses are scheduled at regular intervals of between 10 and 15 minutes — not to mention the fact that I&#39;m a frequent passenger on the C-line.</p>
</div>
</div><div>
<div>
<div>
<h3 id="Data-Cleanup">Data Cleanup<a href="#Data-Cleanup">¶</a></h3><p>To start with, let&#39;s do a little bit of data cleanup to get it into a form that&#39;s easier to work with:</p>

</div>
</div>
</div><div>
<div>
<p>There are essentially six different datasets within this table: the northbound and southbound directions for each of the C, D, and E lines.
To get a feeling for their characteristics, let&#39;s plot a histogram of the actual minus scheduled arrival times for each of these six:</p>
</div>
</div><div>
<div>
<p>You might expect that the buses stick closer to their schedule near the beginning of each one-way trip and show more spread near the end, and this is borne out in the data: the southbound C-line and northbound D and E lines are near the beginning of their respective routes, and in the opposite direction they are near the end.</p>
</div>
</div><div>
<div>
<div>
<h3 id="Scheduled-and-Observed-Arrival-Intervals">Scheduled and Observed Arrival Intervals<a href="#Scheduled-and-Observed-Arrival-Intervals">¶</a></h3>
</div>
</div>
</div><div>
<div>
<p>Let&#39;s next take a look at the observed and scheduled intervals between arrivals for these six routes.
We&#39;ll start by using Pandas <code>groupby</code> functionality to compute these intervals:</p>
</div>
</div><div>
<div>
<div>
<p>It&#39;s already clear that these don&#39;t look much like the exponential distribution of our model, but that is not telling us much yet: the distributions may be affected by non-constant scheduled arrival intervals.</p>
<p>Let&#39;s repeat the above chart, examining the scheduled rather than observed arrival intervals:</p>

</div>
</div>
</div><div>
<div>
<p>This shows that the buses come at variety of arrival intervals thorughout the week, so we cannot evaluate the accuracy of the waiting time paradox from the distributions of raw arrival times.</p>
</div>
</div><div>
<div>
<div>
<h3 id="Constructing-Uniform-Schedules">Constructing Uniform Schedules<a href="#Constructing-Uniform-Schedules">¶</a></h3>
</div>
</div>
</div><div>
<div>
<p>Even though the scheduled arrival intervals are not uniform, there are a few particular intervals that have a large number of arrivals: for example, there are nearly 2000 northbound E-line buses with a scheduled interval of 10 minutes.
In order to explore whether the waiting time paradox applies, let&#39;s group the data by line, direction, and scheduled interval, then re-stack these similar arrivals together as if they had happened in sequence.
This should maintain all the relevant characteristics of the raw data, while making it easier to directly compare with the predictions of the waiting time paradox.</p>
</div>
</div><div>
<div>
<p>Using this cleaned data, we can plot the distribution of &#34;actual&#34; arrival intervals for each route, direction, and arrival frequency:</p>
</div>
</div><div>
<div>
<div>
<p>We see that for each line and schedule, the distribution of observed arrival intervals is nearly Gaussian, is peaked near the scheduled arrival interval, and has a standard deviation that is smaller near the beginning of the route (southbound for C, northbound for D/E) and larger near the end.
Even without a statistical test, it&#39;s clear by eye that the actual arrival intervals are definitely <strong>not</strong> exponentially distributed, which is the basic assumption on which the waiting time paradox rests.</p>
<p>We can make use of the wait time simulation function we used above in order to find the average wait time for each bus line, direction, and schedule:</p>

</div>
</div>
</div><div>
<div>
<p>The average waiting times are are perhaps a minute or two longer than half the scheduled interval, but not equal to the scheduled interval as the waiting time paradox implied. In other words, the inspection paradox is confirmed, but the waiting time paradox does not appear to match reality.</p>
</div>
</div><div>
<div>
<div>
<h2 id="Final-Thoughts">Final Thoughts<a href="#Final-Thoughts">¶</a></h2><p>The waiting time paradox has been an interesting launching-point for a discussion that covered simulation, probability, and comparison of statistical assumptions with reality.
Although we confirmed that real-world bus lines do follow some version of the inspection paradox, the above analysis shows pretty definitively that the core assumption behind the waiting time paradox — that the arrival of buses follows the statistics of a Poisson process — is not well-founded.</p>
<p>In retrospect, this is perhaps not all that surprising: a Poisson process is a memoryless process that assumes the  probability of an arrival is entirely independent of the time since the previous arrival.
In reality, a well-run bus system will have schedules deliberately structured to avoid this kind of behavior: buses don&#39;t begin their routes at random times throughout the day, but rather begin their routes on a schedule chosen to best serve the transit-riding public.</p>
<p>The larger lesson here is that you should be careful about the assumptions you bring to any data analysis task.
A Poisson process is a good description for arrival time data — sometimes.
But just because one type of data sounds like another type of data, it does not mean that assumptions valid for one are necessarily valid for the other.
Often assumptions that seem correct on their face can lead to conclusions that don&#39;t match reality.</p>

</div>
</div>
</div><div>
<div>
<p><em>This post was written entirely in the Jupyter notebook.  You can
<a href="http://jakevdp.github.io/downloads/notebooks/WaitingTimeParadox.ipynb">download</a>
this notebook, or see a static view
<a href="http://nbviewer.jupyter.org/url/jakevdp.github.io/downloads/notebooks/WaitingTimeParadox.ipynb">on nbviewer</a>.</em></p>
</div>
</div></div>
  </body>
</html>
