<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://damien.zone/introducing-mac-themes-garden/">Original</a>
    <h1>Mac Themes Garden</h1>
    
    <div id="readability-page-1" class="page"><div>
  
    <figure data-type="image"><a href="https://damien.zone/img/projects/macthemes-garden.webp?v=9d6b8774b4bb"><img src="https://damien.zone/img/projects/macthemes-garden.webp?v=9d6b8774b4bb" alt="Mac Themes Garden" loading="lazy" decoding="async"/></a></figure>
<h2 id="the-short-version">The short version</h2>
<p>I&#39;ve &#34;launched&#34; the <a href="https://macthemes.garden">Mac Themes Garden</a>! It is a website showcasing more than 3,000 (and counting) Kaleidoscope from the Classic Mac era, ready to be seen, downloaded and explored! Check it out! Oh, and there also is an <a href="https://macthemes.garden/feed.xml">RSS feed</a> you can subscribe to see themes as they are added/updated!</p>
<p>And yes, there is a button that you can include on your website! <a href="https://macthemes.garden/about#buttons">Grab it here</a>! Isn&#39;t it cute?</p>
<center>
<a href="https://macthemes.garden" title="Mac Themes Garden"><img src="https://macthemes.garden/buttons/88x31_macthemes.garden.png" alt="Mac Themes Garden"/></a>
</center>
<p><strong>Now, for the yapping.</strong> Note: if you&#39;re reading this in an RSS reader, you might want to open the article on my website directly as it contains a bunch of CSS demos and those won&#39;t work well in an RSS reader.</p>
<h2 id="some-background">Some background</h2>
<p>If you know me from Online, you may know that I&#39;ve been running the Mac Themes Bot on <a href="https://bsky.app/profile/macthemes.garden">Bluesky</a>/<a href="https://social.erambert.me/@macthemes">Mastodon</a>/<a href="https://cohost.org/macthemes">Cohost</a> for a few years now.</p>
<p>The idea of the bot was simple, showcasing custom themes from the Mac OS X and Classic Mac eras, on the rate of one an hour. Since I was inspired by <a href="https://web.archive.org/web/20191021204432/https://twitter.com/kaleidoscopemac">@kaleidoscopemac</a> on Twitter, I only started showcasing themes made for <a href="https://en.wikipedia.org/wiki/Unsanity">ShapeShifter by Unsanity</a>. A while later, that Twitter account got suspended.</p>
<p>The years passed, the bot carried on, made me and a bunch of other people smile on the various websites where I would run it. The <a href="https://cohost.org/macthemes">Cohost</a> incarnation in particular was really special because Cohost was a special site, but also it was full of nerds (complimentary) and people would go nuts for the random gems in there.</p>
<p>Around maybe early 2023, I grew frustrated of the fact that the only images I had for the Kaleidoscope <s>themes</s> schemes were those <a href="https://github.com/eramdam/shapeshifter-themes/blob/master/assets/!.emperor.gif">tiny .gif files</a> from the late 90s.</p>
<h3 id="recording-25-year-old-schemes">&#34;Recording&#34; 25-year-old schemes</h3>
<p>So I did the reasonable thing: set up a terribly manual process to take screenshots and record the author information of the <a href="https://archive.org/details/kaleidoscope-scheme-archive">~4,000 themes available</a>, with the intention of making a website showcasing everything once I was done.</p>
<p>Without going into details (which you can read <a href="https://web.archive.org/web/20250106111834/https://cohost.org/eramdam/post/5246796-replying-to-this-com">here</a>), the process looks like this:</p>
<ul>
<li>Open my Mac OS 9 VM in <a href="https://getutm.app/">UTM.app</a> (QEMU frontend)</li>
<li>Go through the folder of schemes</li>
<li>Select a given scheme, apply it</li>
<li>Take 3 screenshots:
<ol>
<li>One of the scheme&#39;s about box.</li>
<li>One of the scheme being used in the Finder/regular desktop situation.</li>
<li>And finally, a screenshot of the application <a href="http://www.shurey.com/Soft/Share/KSA/index.html">KSA Sampler</a> in order to mimic the original screenshots from the Kaleidoscope Scheme Archive. That specific screenshot would get pasted into Photoshop to be cropped/trimmed of its opaque background using Photoshop Actions.</li>
</ol>
</li>
<li>Write down the name, author and release year of the scheme</li>
<li>Find the corresponding .sit archive file</li>
<li>Record all of this in a record inside an Airtable database.</li>
</ul>
<p>Here&#39;s how it looks inside Airtable:</p>
<figure data-type="image"><a href="https://damien.zone/img/blog/airtable-macthemes.png?v=84922ebd65b7"><img src="https://damien.zone/img/blog/airtable-macthemes.png?v=84922ebd65b7" alt="6 rows inside an Airtable database, showing screenshots and scheme information" loading="lazy" decoding="async"/></a><figcaption>6 rows inside an Airtable database, showing screenshots and scheme informations</figcaption></figure>
<p>On a good day, I can maybe record, I don&#39;t know, a dozen or so themes an hour.</p>
<blockquote>
<p>But Damien, why didn&#39;t you automate this process?!</p>
</blockquote>
<p>I&#39;m glad you asked! I tried! But I, at least until now, could not find a good way to reliably perform the actions I need to take. And that&#39;s not even touching on the fact that sometimes a scheme doesn&#39;t have any author or year information! Sometimes the author inside the Kaleidoscope scheme file is completely wrong, and the actual author is written in a separate &#34;Read me&#34; file. Sometimes there&#39;s barely any information to go by, sometimes the scheme is buggy and would crash my VM.</p>
<p>At that point, the only automations I have are:</p>
<ul>
<li>a <a href="https://www.keyboardmaestro.com/main/">Keyboard Maestro</a> <a href="https://damien.zone/img/blog/keyboard-mastro-macro.png?v=d9a26f888bf7">macro</a> that calls the <code>qemu-monitor</code> for the running VM, takes a lossless screenshot and puts it into my clipboard, ready to be pasted</li>
<li>Photoshop actions to:
<ul>
<li>create a document from the clipboard</li>
<li>after cropping, remove all pixels of a given color in a document and trim it to remove extra alpha pixels (for the KSA Sampler screenshots above)</li>
</ul>
</li>
<li>A <a href="https://macintoshgarden.org/forum/startly-quickeys-5">Quickeys</a> shortcut to call &#34;Hide Others&#34; inside of Mac OS 9. Turns out this action didn&#39;t have a keyboard shortcut until Mac OS X? Didn&#39;t know that!</li>
</ul>
<p>Beyond that, I&#39;m afraid it&#39;s all manual since I want to record data that isn&#39;t straight forwardly extracted by just looking at files ðŸ˜”.</p>
<p><em>At any rate</em>, I was and thought &#34;I&#39;ll finish recording all these schemes, <strong>and then</strong> I&#39;ll make the website&#34;...</p>
<p>Dear reader, I am not done. By my own estimations, I am maybe halfway done. I do not know when I will be fully done, but my good friend <a href="https://wavebeem.com">Sage</a> pushed me to: make the damn website already.</p>
<p>And they were right, I should have made the website earlier! It was a fun and challenging distraction, and <em>fuck me</em> I could use distractions these days.</p>
<h2 id="making-da-website">Making Da Website</h2>
<p>So, around January of this year, I&#39;ve started work on the website.</p>
<p>The first step was to interface with the <a href="https://airtable.com/">Airtable</a> API in order to download the data from my database and store all the assets into a folder in my repository.
<a href="https://github.com/eramdam/macthemes.garden/blob/main/scripts/airtable.ts">Nothing too crazy</a>, but had to be done.</p>
<p>With the data on hand, the real fun began.</p>
<figure data-type="image"><a href="https://damien.zone/img/blog/macthemes-garden-v0.png?v=0de864f596fc"><img src="https://damien.zone/img/blog/macthemes-garden-v0.png?v=0de864f596fc" alt="Early version of the Mac Themes Garden site" loading="lazy" decoding="async"/></a></figure>
<p>The proof-of-concept was using Eleventy which I chose purely because I had just finished remaking my website (you&#39;re reading it now!) using it, so I figured it would be a good fit because of its simplicity and speed.</p>
<p>And it might have been if it wasn&#39;t for <a href="https://www.11ty.dev/docs/languages/webc/">WebC</a> being so wonky. You see, I knew I wanted to have multiple OS9-like &#34;windows&#34; in the website&#39;s layout. So I figured that, surely, WebC could let me make a &#34;component&#34; and make a UI that way and, I swear to god, I could not make it work that way.</p>
<h3 id="the-nitty-gritty">The nitty-gritty</h3>
<p>So I switched to <a href="https://astro.build/">Astro</a> whose concept of <a href="https://docs.astro.build/en/basics/astro-components/">components</a> was closer to what I wanted to do here, and I already knew how to use it because <a href="https://erambert.me">erambert.me</a> uses it.</p>
<p>I will not do a play-by-play of the making of the website, because once the ball was rolling, most of my time was spent playing with UI ideas and using Astro&#39;s <a href="https://docs.astro.build/en/guides/content-collections/">content collections</a> such that building the whole website as a bunch of static pages didn&#39;t take forever.</p>
<p>The &#34;problem&#34; is that I am playing with big numbers. Let&#39;s think about them:</p>
<ul>
<li>3,942 themes</li>
<li>868 authors</li>
</ul>
<p>As it is, if we assume one page per scheme and one page per author (which would list all the themes for that author), we arrive at: <strong>3,942 + 868 = 4,810 pages</strong>. Which isn&#39;t terrible, but that&#39;s already a lot of pages, and we&#39;re not doing anything fancy with it.</p>
<p>Let&#39;s start being fancy, let&#39;s add pagination and let&#39;s say we want to show 51 themes per page. Where:</p>
<ul>
<li><em>T</em> is the number of themes in the set (3,942)</li>
<li><em>A</em> is the number of authors in the set (868)</li>
<li><em>P</em> is the page size (51)</li>
</ul>
<pre><code><span>const</span> totalPages <span>=</span> <span>(</span><span>T</span> <span>*</span> <span>A</span><span>)</span> <span>+</span> Math<span>.</span><span>ceil</span><span>(</span><span>T</span> <span>/</span> <span>P</span><span>)</span>
</code></pre>
<p>That&#39;s <strong>4,888 pages</strong>! Except I then wanted to add some fancy things like an authors page <em>(A / 26 (for each letter in the alphabet))</em>, that&#39;s another ~33 pages. This gets us close to 5,000 pages. Which is fine, but it means every page better be really quick to generate in order for the build time to not balloon out-of-control.</p>
<p>That&#39;s where I had to be careful. I wanted the author pages to show all the themes made by a given author, which I naively implemented like this:</p>
<pre><code><span>export</span> <span>const</span> getStaticPaths <span>=</span> <span>(</span><span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> authors <span>=</span> <span>await</span> <span>getCollection</span><span>(</span><span>&#34;authors&#34;</span><span>)</span><span>;</span>

  <span>return</span> authors<span>.</span><span>map</span><span>(</span><span>(</span>a<span>)</span> <span>=&gt;</span> <span>{</span>
    <span>return</span> <span>{</span>
      props<span>:</span> <span>{</span> author<span>:</span> a <span>}</span><span>,</span>
      params<span>:</span> <span>{</span>
        author<span>:</span> a<span>.</span>data<span>.</span>slug<span>,</span>
      <span>}</span><span>,</span>
    <span>}</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span> satisfies GetStaticPaths<span>;</span>
<span>const</span> <span>{</span> author <span>}</span> <span>=</span> Astro<span>.</span>props<span>;</span>
<span>const</span> themesByAuthor <span>=</span> <span>(</span><span>await</span> <span>getCollection</span><span>(</span><span>&#34;themes&#34;</span><span>)</span><span>)</span><span>.</span><span>filter</span><span>(</span><span>(</span>t<span>)</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> t<span>.</span>data<span>.</span>authors<span>.</span><span>some</span><span>(</span><span>(</span>a<span>)</span> <span>=&gt;</span> a<span>.</span>id <span>===</span> author<span>.</span>id<span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre>
<p>Sure, this seems fine as it is. After all, it &#34;only&#34; takes ~30ms to run in development! But running our math from earlier, this will run for every single author page. Suddenly we&#39;re looking at:</p>
<p><strong>30ms Ã— 868 = 26,040 ms (26s)</strong> ðŸ˜±!</p>
<p>After all, we&#39;re iterating over the 3,942 schemes 868 times, this isn&#39;t great!</p>
<p>What&#39;s the fix then?</p>
<p>As it is almost always the case when it comes to performance: doing less work and only doing the hard work once! I took advantage of <a href="https://docs.astro.build/en/guides/content-collections/#defining-collection-references">Astro&#39;s collection references</a>. I first declare a reference for authors inside my <code>themes</code> schema:</p>
<pre><code>const themes = defineCollection({
<span><span> </span> loader<span>:</span> themesLoader<span>,</span>
<span> </span> schema<span>:</span> z<span>.</span><span>object</span><span>(</span><span>{</span>
<span> </span>   name<span>:</span> z<span>.</span><span>string</span><span>(</span><span>)</span><span>,</span>
</span><span><span>+</span>   authors<span>:</span> z<span>.</span><span>array</span><span>(</span><span>reference</span><span>(</span><span>&#34;authors&#34;</span><span>)</span><span>)</span><span>,</span>
</span><span><span> </span>   year<span>:</span> z<span>.</span><span>string</span><span>(</span><span>)</span><span>.</span><span>optional</span><span>(</span><span>)</span><span>,</span>
<span> </span>   mainThumbnail<span>:</span> z<span>.</span><span>string</span><span>(</span><span>)</span><span>,</span>
<span> </span>   thumbnails<span>:</span> z<span>.</span><span>array</span><span>(</span>z<span>.</span><span>string</span><span>(</span><span>)</span><span>)</span><span>,</span>
<span> </span>   archiveFile<span>:</span> z<span>.</span><span>string</span><span>(</span><span>)</span><span>,</span>
<span> </span>   
<span> </span> <span>}</span><span>)</span><span>,</span>
</span>});</code></pre>
<p>Which mean that I could simply call the <a href="https://docs.astro.build/en/reference/modules/astro-content/#getentries">getEntries</a> method to get the authors of a given theme.</p>
<pre><code><span>export</span> <span>const</span> getStaticPaths <span>=</span> <span>(</span><span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> authors <span>=</span> <span>await</span> <span>getCollection</span><span>(</span><span>&#34;authors&#34;</span><span>)</span><span>;</span>

  <span>return</span> authors<span>.</span><span>map</span><span>(</span><span>(</span>a<span>)</span> <span>=&gt;</span> <span>{</span>
    <span>return</span> <span>{</span>
      props<span>:</span> <span>{</span> author<span>:</span> a <span>}</span><span>,</span>
      params<span>:</span> <span>{</span>
        author<span>:</span> a<span>.</span>data<span>.</span>slug<span>,</span>
      <span>}</span><span>,</span>
    <span>}</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span> satisfies GetStaticPaths<span>;</span>
<span>const</span> <span>{</span> author <span>}</span> <span>=</span> Astro<span>.</span>props<span>;</span>
<span>const</span> themesByAuthor <span>=</span> <span>await</span> <span>getEntries</span><span>(</span>author<span>.</span>data<span>.</span>themes<span>)</span><span>;</span></code></pre>
<p>Which, depending on the number of themes, takes ~10ms <em>at most</em>, for most pages it takes less than 5ms! That is much better.</p>
<p>By applying this technique, I managed to keep the build time of the site under control and Astro builds almost 5,000 pages with various queries between each other in less than 16s!</p>
<figure data-type="image"><a href="https://damien.zone/img/blog/macthemes-build-time.png?v=0cd08b11b896"><img src="https://damien.zone/img/blog/macthemes-build-time.png?v=0cd08b11b896" alt="&#34;Astro&#39;s CLI showing it built 4920 pages in 15.54s&#34;" loading="lazy" decoding="async"/></a></figure>
<h3 id="getting-cute-with-it">Getting cute with it</h3>
<p>Like mentioned above, I knew I wanted to mimic a Mac OS 9 UI for the website. Now, I <em>could</em> have just used images to make the UI... but where&#39;s the fun in that?</p>
<p>So of course I&#39;ve used every CSS trick in the book to achieve the look. Let me go through some of the pieces of UI and explain how I re-created them.</p>
<h3 id="the-window-frame">The window frame</h3>
<figure data-type="image"><a href="https://damien.zone/img/blog/macthemes-garden-window.png?v=7f1017c11b6d"><img src="https://damien.zone/img/blog/macthemes-garden-window.png?v=7f1017c11b6d" alt="alt text" loading="lazy" decoding="async"/></a></figure>
<p>This is, obviously, a big part of the UI, so I wanted to be as close to the actual look of OS 9 as possible. Let&#39;s take a simple, empty example:</p>

<p>A lot of the styles involve using multiple box shadows to achieve the &#34;broken border&#34; effects in the different areas of the main UI chrome. Here is the style for the main window body (in white in the preview above):</p>
<pre><code><span>.macos9-window-body</span> <span>{</span>
  <span>border</span><span>:</span> 1px solid <span>var</span><span>(</span>--primary-black<span>)</span><span>;</span>
  <span>box-shadow</span><span>:</span>
    -1px -1px 0 <span>rgb</span><span>(</span>from <span>var</span><span>(</span>--primary-black<span>)</span> r g b / 40%<span>)</span><span>,</span>
    1px 1px 0 <span>var</span><span>(</span>--primary-white<span>)</span><span>;</span>

  <span>--top-left-shadow</span><span>:</span> <span>var</span><span>(</span>--grays-600<span>)</span><span>;</span>
  <span>--bottom-right-shadow</span><span>:</span> <span>var</span><span>(</span>--primary-white<span>)</span><span>;</span>
  <span>box-shadow</span><span>:</span>
    -1px -1px 0 <span>var</span><span>(</span>--top-left-shadow<span>)</span><span>,</span>
    -1px 0px 0 <span>var</span><span>(</span>--top-left-shadow<span>)</span><span>,</span>
    0 -1px 0 <span>var</span><span>(</span>--top-left-shadow<span>)</span><span>,</span>
    1px 1px 0 <span>var</span><span>(</span>--bottom-right-shadow<span>)</span><span>,</span>
    1px 0 0 <span>var</span><span>(</span>--bottom-right-shadow<span>)</span><span>,</span>
    0 1px 0 <span>var</span><span>(</span>--bottom-right-shadow<span>)</span><span>;</span>

  <span>background-color</span><span>:</span> <span>var</span><span>(</span>--primary-white<span>)</span><span>;</span>
<span>}</span></code></pre>
<h3 id="the-title-bar">The title bar</h3>
<p>That part was fun, there&#39;s a lot going on so let&#39;s take a look step by step. Here&#39;s how it looks and the HTML markup:</p>

<pre><code><span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>macos9-window-titlebar<span>&#34;</span></span><span>&gt;</span></span>
  <span><span><span>&lt;</span>button</span> <span>class</span><span><span>=</span><span>&#34;</span>button close<span>&#34;</span></span> <span>data-action</span><span><span>=</span><span>&#34;</span>close<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>span</span> <span>class</span><span><span>=</span><span>&#34;</span>button-dots<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
  <span><span><span>&lt;/</span>button</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>span</span> <span>class</span><span><span>=</span><span>&#34;</span>filler<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>span</span> <span>class</span><span><span>=</span><span>&#34;</span>title-text<span>&#34;</span></span><span>&gt;</span></span>Welcome!<span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>span</span> <span>class</span><span><span>=</span><span>&#34;</span>filler<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>button</span> <span>class</span><span><span>=</span><span>&#34;</span>button zoom<span>&#34;</span></span> <span>data-action</span><span><span>=</span><span>&#34;</span>zoom<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>span</span> <span>class</span><span><span>=</span><span>&#34;</span>button-dots<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
  <span><span><span>&lt;/</span>button</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>button</span> <span>class</span><span><span>=</span><span>&#34;</span>button collapse<span>&#34;</span></span> <span>data-action</span><span><span>=</span><span>&#34;</span>collapse<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>span</span> <span>class</span><span><span>=</span><span>&#34;</span>button-dots<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
  <span><span><span>&lt;/</span>button</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span></code></pre>
<p>The &#34;stripes&#34; pattern is done using a repeating CSS gradient and two pseudo-elements on each side with a slightly different gradient:</p>
<pre><code><span>.macos9-window-titlebar &gt; span.filler</span> <span>{</span>
  <span>flex</span><span>:</span> 1<span>;</span>
  <span>background-color</span><span>:</span> #dddddd<span>;</span>
  <span>background-image</span><span>:</span> <span>linear-gradient</span><span>(</span>#ffffff<span>,</span> #ffffff 50%<span>,</span> #777777 50%<span>,</span> #777777<span>)</span><span>;</span>
  <span>background-repeat</span><span>:</span> repeat<span>;</span>
  <span>background-size</span><span>:</span> 100% 2px<span>;</span>
  <span>height</span><span>:</span> 12px<span>;</span>

  <span>position</span><span>:</span> relative<span>;</span>

  <span>&amp;::before,
  &amp;::after</span> <span>{</span>
    <span>content</span><span>:</span> <span>&#34;&#34;</span><span>;</span>
    <span>position</span><span>:</span> absolute<span>;</span>
    <span>width</span><span>:</span> 1px<span>;</span>
    <span>background-size</span><span>:</span> 100% 2px<span>;</span>
    <span>display</span><span>:</span> block<span>;</span>
  <span>}</span>

  <span>&amp;::before</span> <span>{</span>
    <span>left</span><span>:</span> 0<span>;</span>
    <span>top</span><span>:</span> 0<span>;</span>
    <span>bottom</span><span>:</span> 0<span>;</span>
    <span>background-image</span><span>:</span> <span>linear-gradient</span><span>(</span>#fff<span>,</span> #fff 50%<span>,</span> #cccccc 50%<span>,</span> #cccccc<span>)</span><span>;</span>
    <span>border-bottom</span><span>:</span> 1px solid #cccccc<span>;</span>
  <span>}</span>
  <span>&amp;::after</span> <span>{</span>
    <span>right</span><span>:</span> 0<span>;</span>
    <span>top</span><span>:</span> 0<span>;</span>
    <span>bottom</span><span>:</span> 0<span>;</span>
    <span>background-image</span><span>:</span> <span>linear-gradient</span><span>(</span>#ccc<span>,</span> #ccc 50%<span>,</span> #777777 50%<span>,</span> #777777<span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre>
<p>We then have the window buttons which are...you guessed it, a lot of box-shadows and borders put together:</p>

<pre><code><span>.macos9-window-titlebar &gt; button</span> <span>{</span>
  <span>appearance</span><span>:</span> none<span>;</span>
  <span>border</span><span>:</span> none<span>;</span>
  <span>height</span><span>:</span> 13px<span>;</span>
  <span>width</span><span>:</span> 13px<span>;</span>

  <span>background</span><span>:</span> transparent<span>;</span>
  <span>background-image</span><span>:</span> <span>linear-gradient</span><span>(</span>135deg<span>,</span> #9a9a9a 0%<span>,</span> #f1f1f1 100%<span>)</span><span>;</span>
  <span>background-size</span><span>:</span> 9px 9px<span>;</span>
  <span>background-position</span><span>:</span> center<span>;</span>
  <span>box-shadow</span><span>:</span>
    inset 1px 1px 0 <span>var</span><span>(</span>--grays-700<span>)</span><span>,</span>
    inset -1px -1px 0 <span>var</span><span>(</span>--primary-white<span>)</span><span>,</span>
    inset 0 0 0 2px <span>var</span><span>(</span>--primary-black<span>)</span><span>,</span>
    inset 3px 3px 0 <span>var</span><span>(</span>--primary-white<span>)</span><span>,</span>
    inset -3px -3px 0 <span>var</span><span>(</span>--grays-700<span>)</span><span>;</span>

  <span>position</span><span>:</span> relative<span>;</span>
  <span>z-index</span><span>:</span> 0<span>;</span>

  <span>&amp;:active::before</span> <span>{</span>
    <span>content</span><span>:</span> <span>&#34;&#34;</span><span>;</span>
    <span>inset</span><span>:</span> 2px<span>;</span>
    <span>background-image</span><span>:</span> <span>linear-gradient</span><span>(</span>
      135deg<span>,</span>
      <span>rgba</span><span>(</span>53<span>,</span> 53<span>,</span> 53<span>,</span> 0.8<span>)</span> 0%<span>,</span>
      <span>rgba</span><span>(</span>156<span>,</span> 156<span>,</span> 156<span>,</span> 0.8<span>)</span> 100%
    <span>)</span><span>;</span>
    <span>display</span><span>:</span> block<span>;</span>
    <span>position</span><span>:</span> absolute<span>;</span>
    <span>z-index</span><span>:</span> 1<span>;</span>
  <span>}</span>
<span>}</span>

<span>.macos9-window-titlebar &gt; button .button-dots</span> <span>{</span>
  <span>position</span><span>:</span> absolute<span>;</span>
  <span>inset</span><span>:</span> 0<span>;</span>
  <span>display</span><span>:</span> block<span>;</span>

  <span>&amp;::before</span> <span>{</span>
    <span>content</span><span>:</span> <span>&#34;&#34;</span><span>;</span>
    <span>position</span><span>:</span> absolute<span>;</span>
    <span>top</span><span>:</span> 0<span>;</span>
    <span>right</span><span>:</span> 0<span>;</span>
    <span>width</span><span>:</span> 1px<span>;</span>
    <span>height</span><span>:</span> 1px<span>;</span>
    <span>background-color</span><span>:</span> #cccccc<span>;</span>
  <span>}</span>
  <span>&amp;::after</span> <span>{</span>
    <span>content</span><span>:</span> <span>&#34;&#34;</span><span>;</span>
    <span>position</span><span>:</span> absolute<span>;</span>
    <span>bottom</span><span>:</span> 0<span>;</span>
    <span>left</span><span>:</span> 0<span>;</span>
    <span>width</span><span>:</span> 1px<span>;</span>
    <span>height</span><span>:</span> 1px<span>;</span>
    <span>background-color</span><span>:</span> #cccccc<span>;</span>
  <span>}</span>
<span>}</span></code></pre>
<p>Oh, and there is also a neat trick: I&#39;m using <code>:has()</code> to sometimes re-align the title so it&#39;s actually visually centered when there is an uneven number of buttons on each side:</p>
<pre><code><span>.macos9-window-titlebar:has(.button.close, .button.zoom, .button.close)
.button.close + .filler</span> <span>{</span>
  <span>padding-left</span><span>:</span> <span>calc</span><span>(</span>13px + <span>var</span><span>(</span>--macos9-window-titlebar-gap<span>)</span><span>)</span><span>;</span>
<span>}</span></code></pre>
<h3 id="buttons">Buttons</h3>
<p>This is the part of the design that made me question my sanity and my commitment to the bit. Let&#39;s take a look at a simple button:</p>

<p>Looks simple enough, right? Well. How do you preserve the pixelated look in CSS without using images? Why, you go insane and draw the pixels yourself using CSS Grid areas of course! This was a <a href="https://codepen.io/wavebeem/pen/VYYLqJv?editors=1100">suggestion</a> from <a href="https://wavebeem.com">Sage</a>.</p>
<p>This requires some planning because CSS Grid areas have to be rectangular. That&#39;s when I went to Photoshop and drew a bunch of colored rectangles for each area with unique colors:</p>
<figure data-type="image"><a href="https://damien.zone/img/blog/macthemes-button-grid.png?v=36032ebdbd92"><img src="https://damien.zone/img/blog/macthemes-button-grid.png?v=36032ebdbd92" alt="" loading="lazy" decoding="async"/></a></figure>
<p>That&#39;s 38 areas for the inner/outer shadows to cover, as well as 4 areas for the plain background! It&#39;s easy enough to just generate that using JSX, we take care to add a <code>data-n</code> attribute which will help us target the areas in CSS:</p>
<pre><code><span><span><span>&lt;</span>a</span> <span>className</span><span><span>=</span><span>&#34;</span>os9-button<span>&#34;</span></span><span>&gt;</span></span><span>
  </span><span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>&#34;</span>grid<span>&#34;</span></span><span>&gt;</span></span><span>
    </span><span>{</span><span>Array</span><span>.</span><span>from</span><span>(</span><span>{</span> length<span>:</span> <span>38</span> <span>}</span><span>)</span><span>.</span><span>map</span><span>(</span><span>(</span>_<span>,</span> index<span>)</span> <span>=&gt;</span> <span>(</span>
      <span><span><span>&lt;</span>div</span>
        <span>key</span><span><span>=</span><span>{</span>index<span>}</span></span>
        <span>className</span><span><span>=</span><span>&#34;</span>shadow<span>&#34;</span></span>
        <span>data-n</span><span><span>=</span><span>{</span><span>String</span><span>(</span>index <span>+</span> <span>1</span><span>)</span><span>.</span><span>padStart</span><span>(</span><span>2</span><span>,</span> <span>&#34;0&#34;</span><span>)</span><span>}</span></span>
      <span>/&gt;</span></span>
    <span>)</span><span>)</span><span>}</span><span>
    </span><span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>&#34;</span>bgd<span>&#34;</span></span> <span>data-n</span><span><span>=</span><span>&#34;</span>1<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span>
    </span><span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>&#34;</span>bgd<span>&#34;</span></span> <span>data-n</span><span><span>=</span><span>&#34;</span>2<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span>
    </span><span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>&#34;</span>bgd<span>&#34;</span></span> <span>data-n</span><span><span>=</span><span>&#34;</span>3<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span>
    </span><span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>&#34;</span>bgd<span>&#34;</span></span> <span>data-n</span><span><span>=</span><span>&#34;</span>4<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span>
    </span><span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>&#34;</span>label<span>&#34;</span></span><span>&gt;</span></span><span>{</span>children<span>}</span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span>
  </span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span>
</span><span><span><span>&lt;/</span>a</span><span>&gt;</span></span></code></pre>
<p>Then, we have to use Sass to create the necessary selectors:</p>
<pre><code><span>@use</span> <span>&#34;sass:math&#34;</span><span>;</span>

<span>@for</span> <span>$i</span> <span>from</span> 1 <span>through</span> <span>38 </span><span>{</span>
  <span><span>$n</span></span><span>:</span> <span>$i</span><span>;</span>
  <span>@if</span> <span><span>$n</span> &lt; 10 </span><span>{</span>
    <span><span>$n</span></span><span>:</span> <span>&#34;0#{$n}&#34;</span><span>;</span>
  <span>}</span>
  <span>.shadow[data-n=&#34;<span>#{$n}</span>&#34;] </span><span>{</span>
    <span>grid-area</span><span>:</span> s<span>#{$n}</span><span>;</span>
  <span>}</span>
<span>}</span>

<span>@for</span> <span>$i</span> <span>from</span> 1 <span>through</span> <span>4 </span><span>{</span>
  <span>.bgd[data-n=&#34;<span>#{$i}</span>&#34;] </span><span>{</span>
    <span>grid-area</span><span>:</span> bg<span>#{$i}</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre>
<p>Then...we &#34;draw&#34; our CSS areas with code:</p>
<pre><code><span>.grid </span><span>{</span>
  <span>display</span><span>:</span> grid<span>;</span>
  <span>grid-template-areas</span><span>:</span>
    <span>&#34;... ... s01 s02 s02 s02 s03 ... ...&#34;</span>
    <span>&#34;... s04 s05 s06 s06 s06 s07 s08 ...&#34;</span>
    <span>&#34;s09 s10 s38 s11 s11 s11 s12 s13 s14&#34;</span>
    <span>&#34;s15 s16 s17 s17 bg1 bg1 s18 s19 s20&#34;</span>
    <span>&#34;s15 s16 s37 bg2 txt bg3 s18 s19 s20&#34;</span>
    <span>&#34;s15 s16 s37 bg2 bg4 s21 s18 s19 s20&#34;</span>
    <span>&#34;s22 s23 s24 s25 s26 s26 s27 s28 s29&#34;</span>
    <span>&#34;... s30 s31 s32 s32 s32 s32 s33 ...&#34;</span>
    <span>&#34;... ... s34 s35 s35 s35 s36 ... ...&#34;</span><span>;</span>
  <span>grid-template-columns</span><span>:</span> <span>repeat</span><span>(</span>4<span>,</span> max-content<span>)</span> 1fr <span>repeat</span><span>(</span>5<span>,</span> max-content<span>)</span><span>;</span>
  <span>grid-template-rows</span><span>:</span> <span>repeat</span><span>(</span>4<span>,</span> max-content<span>)</span> 1fr <span>repeat</span><span>(</span>4<span>,</span> max-content<span>)</span><span>;</span>
<span>}</span></code></pre>
<p>Yes, this took a while and multiple tries to get right LMAO. The full <a href="https://github.com/eramdam/macthemes.garden/blob/main/src/components/OS9Button.scss">stylesheet is here</a> if you&#39;re curious.</p>
<h3 id="random-tidbits">Random tidbits</h3>
<h3 id="window-controls">Window controls</h3>
<p>The windows are actually interactive! You can &#34;zoom&#34; (expand) the main window and collapse it by clicking the right button/double-clicking the title bar!</p>
<div>
  <div id="demo-window">
    <p> <span></span> <span>Welcome!</span> <span></span>  </p>
    <p>
      Play with the buttons!
    </p>
  </div>
</div>

<pre><code><span>const</span> windowElement <span>=</span> document<span>.</span><span>querySelector</span><span>(</span><span>&#39;#demo-window&#39;</span><span>)</span><span>;</span>
windowElement<span>.</span><span>querySelectorAll</span><span>(</span><span>&#34;button&#34;</span><span>)</span><span>.</span><span>forEach</span><span>(</span><span>(</span><span>button</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>if</span> <span>(</span>button<span>.</span>dataset<span>.</span>action <span>===</span> <span>&#34;collapse&#34;</span><span>)</span> <span>{</span>
    <span>const</span> titlebar <span>=</span> windowElement<span>.</span><span>querySelector</span><span>(</span><span>&#34;.macos9-window-titlebar&#34;</span><span>)</span><span>;</span>
    <span>if</span> <span>(</span>titlebar<span>)</span> <span>{</span>
      titlebar<span>.</span><span>addEventListener</span><span>(</span><span>&#34;dblclick&#34;</span><span>,</span> <span>(</span><span>e</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>if</span> <span>(</span>e<span>.</span>target <span>instanceof</span> <span>HTMLButtonElement</span><span>)</span> <span>{</span>
          <span>return</span><span>;</span>
        <span>}</span>

        windowElement<span>.</span>classList<span>.</span><span>toggle</span><span>(</span><span>&#34;collapsed&#34;</span><span>)</span><span>;</span>
        window<span>.</span><span>getSelection</span><span>(</span><span>)</span><span>?.</span><span>empty</span><span>(</span><span>)</span><span>;</span>
      <span>}</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
  button<span>.</span><span>addEventListener</span><span>(</span><span>&#34;click&#34;</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> action <span>=</span> button<span>.</span>dataset<span>.</span>action<span>;</span>
    <span>if</span> <span>(</span>action <span>===</span> <span>&#34;collapse&#34;</span><span>)</span> <span>{</span>
      windowElement<span>.</span>classList<span>.</span><span>toggle</span><span>(</span><span>&#34;collapsed&#34;</span><span>)</span><span>;</span>
    <span>}</span> <span>else</span> <span>if</span> <span>(</span>action <span>===</span> <span>&#34;zoom&#34;</span><span>)</span> <span>{</span>
      windowElement<span>.</span>classList<span>.</span><span>toggle</span><span>(</span><span>&#34;zoomed&#34;</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre>
<h3 id="open-graph-images">Open Graph images</h3>
<p>I could have taken the easy route when making the open graph images for each theme and simply dropped a PNG of the main window, something like this:</p>
<picture>
  <source srcset="/img/blog/macthemes-embed-v1-dark.png?v=e52e251e312a" media="(prefers-color-scheme: dark)" type="image/png"/>
  <source srcset="/img/blog/macthemes-embed-v1-light.png?v=4a2f5f4ea782" type="image/png"/>
  <img src="https://damien.zone/img/blog/macthemes-embed-v1-light.png?v=4a2f5f4ea782" alt="Discord embed with a simple window without any background" loading="lazy" decoding="async" width="437"/>
</picture>
<p>This is very cute in apps like Discord, but looks terrible about everywhere else because of the wrong aspect ratio and the non-support of alpha channels.</p>
<picture>
  <source srcset="/img/blog/macthemes-embed-v1-bsky-dark.png?v=b4ccfc724027" media="(prefers-color-scheme: dark)" type="image/png"/>
  <source srcset="/img/blog/macthemes-embed-v1-bsky-light.png?v=ad6a8204546d" type="image/png"/>
  <img src="https://damien.zone/img/blog/macthemes-embed-v1-bsky-light.png?v=ad6a8204546d" alt="Bluesky embed with a simple window without any background" loading="lazy" decoding="async" width="437"/>
</picture>
<p>So I took another approach:</p>
<figure data-type="image"><a href="https://macthemes.garden/themes-opengraph/13d46b4752aa-Monkey-Paradise.png"><img src="https://macthemes.garden/themes-opengraph/13d46b4752aa-Monkey-Paradise.png" alt="" loading="lazy" decoding="async"/></a></figure>
<p>But, obviously, doing that kind of compositing manually would be a terrible idea, and I&#39;m not good enough with ImageMagick, so I ended up using Vercel&#39;s <a href="https://github.com/vercel/satori">satori</a> to lay the two images out and generate an image for every single theme:</p>
<pre><code><span>import</span> <span>type</span> <span>{</span> InferEntrySchema <span>}</span> <span>from</span> <span>&#34;astro:content&#34;</span><span>;</span>
<span>import</span> satori <span>from</span> <span>&#34;satori&#34;</span><span>;</span>
<span>import</span> sharp <span>from</span> <span>&#34;sharp&#34;</span><span>;</span>

<span>export</span> <span>async</span> <span>function</span> <span>generateOpenGraphImageForTheme</span><span>(</span>
  theme<span>:</span> InferEntrySchema<span>&lt;</span><span>&#34;themes&#34;</span><span>&gt;</span><span>,</span>
<span>)</span> <span>{</span>
  <span>let</span> blurredImageData<span>:</span> Buffer <span>|</span> <span>undefined</span><span>;</span>
  <span>const</span> margin <span>=</span> <span>20</span><span>;</span>
  <span>const</span> imageDimension <span>=</span> <span>{</span>
    width<span>:</span> <span>1200</span><span>,</span>
    height<span>:</span> <span>630</span><span>,</span>
  <span>}</span><span>;</span>

  <span>if</span> <span>(</span>theme<span>.</span>thumbnails<span>.</span>length <span>&gt;</span> <span>1</span><span>)</span> <span>{</span>
    blurredImageData <span>=</span> <span>await</span> <span>sharp</span><span>(</span><span>&#34;public/&#34;</span> <span>+</span> theme<span>.</span>thumbnails<span>[</span><span>1</span><span>]</span><span>)</span>
      <span>.</span><span>resize</span><span>(</span>imageDimension<span>.</span>width<span>,</span> imageDimension<span>.</span>height<span>,</span> <span>{</span>
        fit<span>:</span> <span>&#34;cover&#34;</span><span>,</span>
        position<span>:</span> <span>&#34;top&#34;</span><span>,</span>
      <span>}</span><span>)</span>
      <span>.</span><span>blur</span><span>(</span><span>5</span><span>)</span>
      <span>.</span><span>toBuffer</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>const</span> mainThumbnailSharp <span>=</span> <span>sharp</span><span>(</span><span>&#34;public&#34;</span> <span>+</span> theme<span>.</span>mainThumbnail<span>)</span><span>;</span>
  <span>const</span> mainThumbnail <span>=</span> <span>await</span> mainThumbnailSharp<span>.</span><span>png</span><span>(</span><span>)</span><span>.</span><span>toBuffer</span><span>(</span><span>)</span><span>;</span>

  <span>const</span> svg <span>=</span> <span>await</span> <span>satori</span><span>(</span>
    <span><span><span>&lt;</span>div</span>
      <span>style</span><span><span>=</span><span>{</span><span>{</span>
        display<span>:</span> <span>&#34;flex&#34;</span><span>,</span>
        alignItems<span>:</span> <span>&#34;center&#34;</span><span>,</span>
        justifyItems<span>:</span> <span>&#34;center&#34;</span><span>,</span>
        width<span>:</span> <span>&#34;100%&#34;</span><span>,</span>
        height<span>:</span> <span>&#34;100%&#34;</span><span>,</span>
        position<span>:</span> <span>&#34;relative&#34;</span><span>,</span>
        backgroundColor<span>:</span> <span>&#34;white&#34;</span><span>,</span>
      <span>}</span><span>}</span></span>
    <span>&gt;</span></span><span>
      </span><span>{</span>blurredImageData <span>&amp;&amp;</span> <span>(</span>
        <span><span><span>&lt;</span>img</span>
          <span>src</span><span><span>=</span><span>{</span><span>toArrayBuffer</span><span>(</span>blurredImageData<span>)</span><span>}</span></span>
          <span>style</span><span><span>=</span><span>{</span><span>{</span>
            position<span>:</span> <span>&#34;absolute&#34;</span><span>,</span>
            filter<span>:</span> <span>&#34;brightness(40%)&#34;</span><span>,</span>
            inset<span>:</span> <span>0</span><span>,</span>
          <span>}</span><span>}</span></span>
        <span>/&gt;</span></span>
      <span>)</span><span>}</span><span>
      </span><span><span><span>&lt;</span>img</span>
        <span>src</span><span><span>=</span><span>{</span><span>toArrayBuffer</span><span>(</span>mainThumbnail<span>)</span><span>}</span></span>
        <span>style</span><span><span>=</span><span>{</span><span>{</span>
          padding<span>:</span> margin<span>,</span>
          width<span>:</span> <span>&#34;100%&#34;</span><span>,</span>
          height<span>:</span> <span>&#34;100%&#34;</span><span>,</span>
          boxSizing<span>:</span> <span>&#34;border-box&#34;</span><span>,</span>
          objectFit<span>:</span> <span>&#34;contain&#34;</span><span>,</span>
          objectPosition<span>:</span> <span>&#34;center center&#34;</span><span>,</span>
        <span>}</span><span>}</span></span>
      <span>/&gt;</span></span><span>
    </span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span>,</span>
    <span>{</span>
      width<span>:</span> imageDimension<span>.</span>width<span>,</span>
      height<span>:</span> imageDimension<span>.</span>height<span>,</span>
      fonts<span>:</span> <span>[</span><span>]</span><span>,</span>
    <span>}</span><span>,</span>
  <span>)</span><span>;</span>

  <span>return</span> <span>sharp</span><span>(</span>Buffer<span>.</span><span>from</span><span>(</span>svg<span>)</span><span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>toArrayBuffer</span><span>(</span>buffer<span>:</span> Buffer<span>)</span> <span>{</span>
  <span>const</span> arrayBuffer <span>=</span> <span>new</span> <span>ArrayBuffer</span><span>(</span>buffer<span>.</span>length<span>)</span><span>;</span>
  <span>const</span> view <span>=</span> <span>new</span> <span>Uint8Array</span><span>(</span>arrayBuffer<span>)</span><span>;</span>
  <span>for</span> <span>(</span><span>let</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> buffer<span>.</span>length<span>;</span> <span>++</span>i<span>)</span> <span>{</span>
    view<span>[</span>i<span>]</span> <span>=</span> buffer<span>[</span>i<span>]</span><span>;</span>
  <span>}</span>
  <span>return</span> arrayBuffer<span>;</span>
<span>}</span></code></pre>
<p>I then put together a <a href="https://github.com/eramdam/macthemes.garden/blob/7a8983b64114d6305eb906169aaf64b6005321a5/scripts/opengraph-images.ts">script</a> to process all the images by spawning multiple process, the whole script takes ~2min30 to run on my M1 Max Mac Studio and generate ~3900 images.</p>
<p>As a bonus, these images will also be used by the Mac Themes Bot when available going forward.</p>
<h2 id="whats-next">What&#39;s next</h2>
<p>I don&#39;t know how long it will take, but I want to continue/finish &#34;recording&#34; the schemes I have access to. Hopefully I am done before next year lolsob. You should subscribe to the <a href="https://macthemes.garden/feed.xml">RSS feed</a> to see those as I update them!</p>
<p>Apart from that, I have a bunch of ideas:</p>
<ul>
<li>a &#34;search by color&#34; feature</li>
<li>a way to see/showcase the custom icons contained in each scheme when applicable. There are some gems in there, trust me!</li>
<li>Somehow, find a way to hook the site into <a href="https://infinitemac.org/">InfiniteMac</a> to quickly view a scheme &#34;live&#34;</li>
<li>a user-submitted gallery of old Macs running the schemes from the site. Hit me up if this is something you&#39;d want to participate in :)</li>
</ul>
<p>That&#39;s all, folks, have a good life.</p>





  
</div></div>
  </body>
</html>
