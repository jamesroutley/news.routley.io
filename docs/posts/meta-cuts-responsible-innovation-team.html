<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.wsj.com/articles/facebook-parent-meta-platforms-cuts-responsible-innovation-team-11662658423?mod=djemalertNEWS">Original</a>
    <h1>Meta cuts Responsible Innovation Team</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
    <p>Go is a simple language, but I was pretty confused by the <code>context</code> package
when I first learned about it. I had trouble understanding how it could be used
to set a deadline or to cancel functions or how it even worked. Since then,
I’ve gotten a firmer grasp on how to use it both as a user and as a library
author.</p>

<p>Let’s start by defining what a <code>Context</code> is and its purpose. A <code>Context</code> is a
construct used to signal a function to stop its work and return. The key is
that a function needs to be <em>context aware</em> in order for this to have any
affect; there’s no magic.</p>

<p>Here is an example of a context aware function. Notice that we check
<code>ctx.Done()</code> to see if the context has been canceled in the function
doing the work.</p>

<div><div><pre><code><span>import</span> <span>(</span>
	<span>&#34;context&#34;</span>
	<span>&#34;fmt&#34;</span>
	<span>&#34;time&#34;</span>
<span>)</span>

<span>func</span> <span>doWork</span><span>(</span><span>ctx</span> <span>context</span><span>.</span><span>Context</span><span>)</span> <span>(</span><span>int</span><span>,</span> <span>error</span><span>)</span> <span>{</span>
	<span>select</span> <span>{</span>
	<span>case</span> <span>&lt;-</span><span>time</span><span>.</span><span>After</span><span>(</span><span>2</span> <span>*</span> <span>time</span><span>.</span><span>Second</span><span>)</span><span>:</span>
		<span>return</span> <span>1337</span><span>,</span> <span>nil</span>
	<span>case</span> <span>&lt;-</span><span>ctx</span><span>.</span><span>Done</span><span>()</span><span>:</span>
		<span>return</span> <span>0</span><span>,</span> <span>ctx</span><span>.</span><span>Err</span><span>()</span>
	<span>}</span>
<span>}</span>

<span>func</span> <span>main</span><span>()</span> <span>{</span>
	<span>ctx</span> <span>:=</span> <span>context</span><span>.</span><span>Background</span><span>()</span>
	<span>fmt</span><span>.</span><span>Println</span><span>(</span><span>doWork</span><span>(</span><span>ctx</span><span>))</span>

	<span>ctx</span><span>,</span> <span>cancel</span> <span>:=</span> <span>context</span><span>.</span><span>WithTimeout</span><span>(</span><span>ctx</span><span>,</span> <span>1</span><span>*</span><span>time</span><span>.</span><span>Second</span><span>)</span>
	<span>defer</span> <span>cancel</span><span>()</span>
	<span>fmt</span><span>.</span><span>Println</span><span>(</span><span>doWork</span><span>(</span><span>ctx</span><span>))</span>
<span>}</span>
</code></pre></div></div>

<div><div><pre><code>1337 &lt;nil&gt;
0 context deadline exceeded
</code></pre></div></div>

<p>In this example, we use a <code>select</code> statement to return immediately when the
context is finished, which is generally good practice. By doing so, we respect
the callers’ wish to cancel and return early.</p>

<p>Ultimately, contexts are a pretty simple and powerful concept, but requires
cooperation with child functions to work well. That is the part that previously
confused me. I had incorrectly believed contexts had some magic that would
ensure a deadline wasn’t exceeded, but as with most things in Go, there is no
magic and the idea is quite simple.</p>

  </div></div>
  </body>
</html>
