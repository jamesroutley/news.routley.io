<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tailscale.com/blog/choose-your-ip/">Original</a>
    <h1>Choose your own IP</h1>
    
    <div id="readability-page-1" class="page"><div>
      <p>Tailscale assigns every one of your nodes a private IPv4 address. We do this from the <a href="https://blog.jacobvosmaer.nl/kb/1015/100.x-addresses/">CGNAT range</a>,
which is typically used by ISPs that have run out of public IPv4 addresses. Starting today, you have control over what
IP address from that range is assigned to your nodes. This gives you the ability to decide what subset of the CGNAT
range your tailnet uses to avoid conflicts with other applications.</p>
<h2 id="globally-unique-to-locally-unique">Globally unique to locally unique</h2>
<p>In the early days of Tailscale we decided to allocate every node a unique IP address within the Tailscale universe. This
was particularly handy for <a href="https://blog.jacobvosmaer.nl/kb/1084/sharing/">node sharing</a>, when you let someone from another tailnet access a node in
your tailnet, they got to see it as the same CGNAT address. It also met our needs when we were an early-stage startup;
the CGNAT <code>100.64.0.0/10</code> range has some four million IP addresses, plenty for an experimental project that may or may
not be interesting to users. It turns out people like to use Tailscale and we are running out of IPs.</p>
<p>We had a few options — we could add other private IP address ranges to the CGNAT space we allocate, but this would have
at best been a stopgap. Or, we could have required all users to use IPv6 addresses, as we already also allocate nodes
and addresses from the much larger pool of IPv6 ULA addresses. We all know how well IPv6 adoption has gone —  this would
have broken legacy software our customers use that does not support IPv6. Rather, we decided to no longer allocate
globally unique CGNAT addresses, and allow the reuse of CGNAT addresses in different tailnets.</p>
<p>It also gives us the flexibility to allow enterprises to limit the range of CGNAT IP addresses that get allocated to
their tailnets, for compatibility with other systems that allocate from parts of the CGNAT range.</p>
<h2 id="jump-into-your-own-pool">Jump into your own pool</h2>
<p>Along with flexible addressing, we are launching a beta feature to let you define the <a href="https://blog.jacobvosmaer.nl/kb/1304/ip-pool/">IP pool</a> that
your nodes are assigned from the CGNAT range. This is done as part of your tailnet policy:</p>
<div><pre tabindex="0"><code data-lang="json"><span><span>    <span>{</span>
</span></span><span><span>        <span>&#34;acls&#34;</span><span>:</span> <span>[</span><span>&#34;...&#34;</span><span>],</span>
</span></span><span><span>        <span>&#34;nodeAttrs&#34;</span><span>:</span> <span>[</span>
</span></span><span><span>            <span>{</span>
</span></span><span><span>                <span>&#34;target&#34;</span><span>:</span> <span>[</span><span>&#34;autogroup:admin&#34;</span><span>],</span>
</span></span><span><span>                <span>&#34;ipPool&#34;</span><span>:</span> <span>[</span><span>&#34;100.81.0.0/16&#34;</span><span>],</span>
</span></span><span><span>            <span>},</span>
</span></span><span><span>            <span>{</span>
</span></span><span><span>                <span>&#34;target&#34;</span><span>:</span> <span>[</span><span>&#34;group:dev&#34;</span><span>],</span>
</span></span><span><span>                <span>&#34;ipPool&#34;</span><span>:</span> <span>[</span><span>&#34;100.85.0.0/16&#34;</span><span>],</span>
</span></span><span><span>            <span>},</span>
</span></span><span><span>        <span>],</span>
</span></span><span><span>    <span>}</span>
</span></span></code></pre></div><p>With this <a href="https://blog.jacobvosmaer.nl/kb/1018/acls/#node-attributes">node attribute</a> set, all new nodes managed by admins in your tailnet will be
assigned an IP from the range: <code>100.81.0.0/16</code>, whereas nodes managed by members of <code>group:dev</code> will be assigned an IP
from a subset from the range: <code>100.85.0.0/16</code>.</p>
<h2 id="change-ip-of-existing-nodes">Change IP of existing nodes</h2>
<p>Before these changes, IPv4 addresses were immutable. With locally unique IPv4, however, you can change the address for any node in your tailnet in a couple clicks, even nodes that have been shared to you!</p>
<video playsinline="" muted="" loop="" autoplay="">
		<source type="video/mp4" src="/blog/choose-your-ip/ipv4-address-edit.mp4" alt="Changing an IPv4 address"/>
</video>
<h2 id="natural-solutions">NATural solutions</h2>
<p>Address reuse causes no issue in the common case of a perfectly private tailnet, but if not implemented carefully, it
could wreak havoc with node sharing. If I try to share my node <code>100.65.1.1</code> with you, and you already have a node
numbered <code>100.65.1.1</code>, where do your packets go?</p>
<p>To address this (no pun intended), we assign shared nodes a new IP address from the tailnet it is shared into. Each
Tailscale node collects a new IP address for each share. Assigning multiple addresses to an interface causes a lot of UX
pain with some software, so instead nodes in the shared-to tailnet 1-1 NAT packets destined for the shared node, right
before they flow into the WireGuard tunnel.</p>
<p>This means the tailnet of the shared node never has to be aware of the IP addresses assigned to it in other tailnets,
which greatly simplifies accounting.</p>
<p>Now, each tailnet can have up to four million nodes with IPv4 addresses. If you are the sort of enterprise that needs
more than that, let’s chat.</p>
<p>One thing you can rely on with IPv4: whatever the problem, Network Address Translation is part of the solution.</p>
    </div></div>
  </body>
</html>
