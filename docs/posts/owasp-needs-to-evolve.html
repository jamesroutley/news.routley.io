<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/owasp-change/owasp-change.github.io">Original</a>
    <h1>OWASP Needs to Evolve</h1>
    
    <div id="readability-page-1" class="page"><div><p>Over the last few months of <a href="https://www.stevegattuso.me/2022/11/25/initial-go-at-mastodon-instance.html">running hackNY.social</a> I&#39;ve run into a few issues with my Postgres service crashing and taking the instance down with it. I haven&#39;t always noticed this downtime quickly, as I either need to try and fail to load up Mastodon or have someone ping me to ask what&#39;s going on. This called for a simple monitoring solution: a script that would periodically ping the Mastodon instance and monitor the HTTP status code. If it returns <code>200 OK</code> all is good, however any non-200 response should notify me so I can investigate.</p><p>There are probably a bazillion SaaS companies that are willing to do this for me, or there is the obvious answer of throwing together a Python script. Instead, I decicided to continue down a recent wormhole I&#39;ve been going down and write something in Clojure.</p><p>Starting a new project with <code>lein new</code> seemed like a good first step, however I quickly realized that spinning up a full-on JVM instance would be way overkill for a simple script that just needs to ping a server, write a log, and send a notification. Instead, I took this as an opportunity to try <a href="https://www.babashka.org">Babashka</a>: a lightweight Clojure implementation more suitable for scripting tasks. With Babashka I can get the quick spin-up time of something like a Python script while also reaping the benefits of Clojure&#39;s syntax and libraries.</p><p>I&#39;ve published the repository on <a href="https://codeberg.org/vesto/hackny-uptime-monitor">CodeBerg</a>, but you can jump straight to the implementation <a href="https://codeberg.org/vesto/hackny-uptime-monitor/src/branch/main/src/monitor/core.clj">here</a>.</p><p>The tl;dr is that the script pings the server, writes the result to a sqlite file (so I can easily query up/downtime logs), and sends a push notification to my phone (via <a href="https://pushover.net/">PushOver</a>) when it detectes something awry. I&#39;ve also implemented a mechanism that ensures I only receive alerts once per hour, as I don&#39;t particularly want this job to blast my phone away if the instance goes down overnight.</p><p>Overall I was really happy with Babashka. It was super simple to set up for both my development environment and the server I&#39;m running the job on. This project also pushed me to switch from <a href="https://github.com/tpope/vim-fireplace">vim-fireplace</a> to <a href="https://github.com/Olical/conjure">conjure</a> for my nvim &lt;-&gt; REPL integration, which was a day-and-night difference. I thought fireplace was the standard REPL integration for using LISP on vim, but Conjure has been much more powerful in its native key mappings + integrations with some of the new features of Neovim.</p><p>Being relatively new to Clojure, I&#39;d also love some feedback on my code. If you have any suggestions on how I might do things differently (either in terms of syntax or method) <a href="mailto:steve@stevegattuso.me">drop me an email</a>.</p></div></div>
  </body>
</html>
