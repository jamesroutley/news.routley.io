<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://twitter.com/marcan42/status/1494213855387734019">Original</a>
    <h1>Apple&#39;s custom NVMes are amazingly fast â€“ if you don&#39;t care about data integrity</h1>
    
    <div id="readability-page-1" class="page"><div role="main"><div><div><div><div data-testid="primaryColumn"><div><div itemscope="" itemtype="https://schema.org/Collection"><meta content="Tweet with replies" itemprop="name"/><section aria-labelledby="accessible-list-673995" role="region"><div aria-label="Timeline: Conversation"><div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213855387734019" itemprop="identifier"/><meta content="1" itemprop="position"/><meta content="17" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:18.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:18.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213855387734019" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213855387734019" itemprop="mainEntityOfPage"/><div><article aria-labelledby="id__bem22arljo id__owqs1863i8d id__swzvc4hr7t id__vftycywvui id__7mmdc6nudu9 id__fhhx3ps17yq id__4pnhz4nk7l2 id__icvwugyj28a id__kinn05ktj0s id__bhg78axdswb id__x27kiubei7 id__tdtw111i74 id__sfxn1x0ns2d id__35od7lmrza2" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__fhhx3ps17yq"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div><div itemprop="articleBody"><div><p><span>Well, this is unfortunate. It turns out Apple&#39;s custom NVMe drives are amazingly fast - if you don&#39;t care about data integrity.

If you do, they drop down to HDD performance. Thread.</span></p></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213859594616834" itemprop="identifier"/><meta content="2" itemprop="position"/><meta content="3" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:19.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:19.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213859594616834" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213855387734019" itemprop="isPartOf"/><div><article aria-labelledby="id__2ebvx6edw6b id__qxts7fglzqf id__xrh36qnno9m id__auz1rhq3clq id__vt0ive621r id__6jhy0gukqb6 id__n057r6q0ey id__lpry3mp8ja id__hj67ytt0i6k id__2c7vjs9o67j id__e51k7pk7x96 id__a3rkr1kcw3q id__ns2vgrd9q6s id__1qqgxzcujbr" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__6jhy0gukqb6"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>For a while, we&#39;ve noticed that random write performance with fsync (data integrity) on Asahi Linux (and also on Linux on T2 Macs) was terrible. As in 46 IOPS terrible. That&#39;s slower than many modern HDDs.

We thought we were missing something, since this didn&#39;t happen on macOS.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213862970707969" itemprop="identifier"/><meta content="3" itemprop="position"/><meta content="5" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:20.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:20.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213862970707969" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213859594616834" itemprop="isPartOf"/><div><article aria-labelledby="id__p5hby18ltdd id__8nlwsn7snjb id__bulha3ecyvv id__lwq0v2okeck id__zcccrmd3sh id__tk19mgkczjc id__wke5qj0fg4 id__mktrtax7ib id__cmy6kw07gim id__bs0c5lrzzy id__2bsxl81nu2m id__0sthzuatca9 id__1a8pmq4nvz1 id__x4vghqhdtx" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__tk19mgkczjc"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>As it turns out, macOS cheats. On Linux, fsync() will both flush writes to the drive, and ask it to flush its write cache to stable storage.

But on macOS, fsync() only flushes writes to the drive. Instead, they provide an F_FULLSYNC operation to do what fsync() does on Linux.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213865613426688" itemprop="identifier"/><meta content="4" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:21.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:21.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213865613426688" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213862970707969" itemprop="isPartOf"/><div><article aria-labelledby="id__shoj250i2b id__cg1bf9opnyt id__8576gmrerft id__pekjnt2637 id__wbiuk64k93 id__wqk2gyyuo6 id__y3bw64enpu id__2h1k547ct37 id__4i555bs12oh id__ygh2t461x9r id__m7s9ujddhv id__0ze61g39hyzi id__q9ayyzpwoj id__n8jpfgkd758" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__wqk2gyyuo6"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>So effectively macOS cheats on benchmarks; fio on macOS does not give numbers comparable to Linux, and databases and other applications requiring data integrity on macOS need to special case it and use F_FULLSYNC.

How bad is it if you use F_FULLSYNC? It&#39;s bad.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213868201324546" itemprop="identifier"/><meta content="5" itemprop="position"/><meta content="3" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:21.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:21.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213868201324546" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213865613426688" itemprop="isPartOf"/><div><article aria-labelledby="id__4id9evtsxnm id__73xt1dsips3 id__sw6f4afeh3h id__c355jaw90v id__w9ckywlm2d id__9posh7uji4a id__wu9jfiqt24d id__z17ewtjors id__lkbv3beud4m id__gurgflzgptw id__oafoe5b3kls id__p4a2yfztyj id__rw9ujbyugpi id__aqh5s2loqe" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__9posh7uji4a"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Single threaded, simple Python file rewrite test:

Macbook Air M1 (macOS):
- flushing: 46 IOPS
- not: 40000 IOPS

x86 iMac + WD SN550 1TB NVMe (Linux):
- flushing: 2000 IOPS
- not: 20000 IOPS

x86 laptop + Samsung SSD 860 EVO 500GB SATA:
- flushing: 143 IOPS
- not: 5000 IOPS</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213871149940737" itemprop="identifier"/><meta content="6" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:22.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:22.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213871149940737" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213868201324546" itemprop="isPartOf"/><div><article aria-labelledby="id__zu7mqsoy8hf id__9n4klah6wni id__oag6bk5xgno id__syq6ps8lshf id__1ps0xc7mg94 id__dpleerkkez7 id__jufxdxtf3fk id__lyvu2pewvij id__1yxk0vjgjxy id__9kxernrfebk id__f23ntxulat8 id__buylmnz8fil id__d1du6vqvcim id__clo4mnur9e" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__dpleerkkez7"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>So, effectively, Apple&#39;s drive is faster than all the others without cache flushes, but it is more than 3 times slower than a lowly SATA SSD at flushing its cache. Even if all you wrote is a couple of sectors. You pay a huge flush penalty if you do *any* writes.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213873993682946" itemprop="identifier"/><meta content="7" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:23.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:23.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213873993682946" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213871149940737" itemprop="isPartOf"/><div><article aria-labelledby="id__q4dssmgbtb id__d6hce3gado id__g4svbk9v7t id__0kz1avh0luul id__6j14gbp09hq id__3qhlsdw2hvs id__v0xcdzoj14h id__fvq6l4f8i1a id__y2eihhfhmn id__38cbu1aqi2c id__t4if44zwqqf id__s2b2h3vgej id__trnd8qjuvv id__4m0az1dpfg7" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__3qhlsdw2hvs"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Here, &#34;flushing&#34; on macOS means F_FULLSYNC and &#34;not&#34; means fsync(); on Linux both are fsync(), but &#34;not flushing&#34; is measured by telling Linux that the drive write cache is write-through (which stops it from issuing cache flushes).</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213876657049600" itemprop="identifier"/><meta content="8" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:24.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:24.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213876657049600" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213873993682946" itemprop="isPartOf"/><div><article aria-labelledby="id__h4lmkq83gmt id__bh2vb2unq8j id__fsnp9gdxu2u id__d89ty9b5ebh id__fv1zg2r0cc id__j6qzna73slj id__ythi6u8na8p id__4e738rpzjzx id__dojc5yik0mp id__9blgjne3zym id__wefrlwk4fgn id__by8anz0j3qi id__sbx3bj9dppf id__4qhcwhy2ghm" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__j6qzna73slj"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Note that the numbers are filesystem-dependent (and encryption makes things more complicated); e.g. the SATA SSD numbers double on VFAT vs. my root filesystem (ext4 on LVM on dm-crypt), but the pattern is clear.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213879089737729" itemprop="identifier"/><meta content="9" itemprop="position"/><meta content="4" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:24.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:24.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213879089737729" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213876657049600" itemprop="isPartOf"/><div><article aria-labelledby="id__htza2htgms id__gqm4hv4xutt id__0449b3082cpg id__yzh6o35j409 id__d4v3ut87cmg id__ou0ctrmc7mo id__mxf8200on1h id__po9c6l5obzj id__onfai5bfesf id__lte9bptflyh id__2f9ai6knio9 id__5d5wj6sfr6l id__r4z7gzptwi id__jfg3buk80sf" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__ou0ctrmc7mo"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>macOS doesn&#39;t even seem to try to proactively issue syncs; you can write a file on macOS, fsync() it, wait 5 seconds, issue a hard reboot (e.g. via USB-PD command), and the data is gone. That&#39;s pretty bad.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213881509875712" itemprop="identifier"/><meta content="10" itemprop="position"/><meta content="5" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:25.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:25.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213881509875712" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213879089737729" itemprop="isPartOf"/><div><article aria-labelledby="id__l44bcnb3k6t id__nbc40mxx9sf id__ce09y6b3wz8 id__bgopyccud6s id__ln2xan9ft8 id__siitzwd17oi id__uqeeecy143m id__6ttrs3cwrsv id__14ns2xlxe4t id__d0cvyqri12g id__t2nfeacosi id__m919ywim0vh id__lx6ndxrkflh id__90kof3qu2yo" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__siitzwd17oi"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Of course, in normal usage, this is basically never an issue on laptops; given the right software hooks, they should never run out of power before the OS has a chance to issue a disk flush command. But it certainly is for desktops. And it&#39;s a bit fragile re: panics and such.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213883976101888" itemprop="identifier"/><meta content="11" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:25.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:25.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213883976101888" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213881509875712" itemprop="isPartOf"/><div><article aria-labelledby="id__wcxc5dwl999 id__248e649bmxh id__13lcyaf31f9b id__oknsg63z25m id__z082t7vi1wq id__ilr7jjxk43m id__zy2svmt2k6 id__i0aa8qeoojh id__8ytu97rvssl id__22ech739fuz id__0ereez0wl98e id__cjzou5gfsk4 id__vi9dqdj43t id__netnjo01zf" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__ilr7jjxk43m"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Unfortunately, this manifests itself as quite visible issues on Linux. For example, apt-get on Asahi Linux is noticeably slow. Making fsync() not really flush on macOS is not fair; lots of portable software is written to assume fsync() means your data is safe.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213886928908288" itemprop="identifier"/><meta content="12" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:26.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:26.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213886928908288" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213883976101888" itemprop="isPartOf"/><div><article aria-labelledby="id__b5wr65y9i3n id__ryv0p7uehkh id__003mr54o04b7d id__lsjyu45q4cg id__roj1hcw2cj id__nbd7v1mx4cj id__stq0v87y6p9 id__63mbk0ouhvh id__uc15q7kuodp id__3lmh2317cms id__ex7wd5ahoi9 id__8xrotd82toq id__cglc3zwrbd8 id__23bdg7w2upq" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__nbd7v1mx4cj"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Our current thinking is we&#39;re going to add a knob to the NVMe driver to defer flush requests up to a maximum time of e.g. 1 second. That would ensure that a hard shutdown never loses you more than 1 second of data, which is better than what macOS can claim right now.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213889646796802" itemprop="identifier"/><meta content="13" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:27.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:27.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213889646796802" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213886928908288" itemprop="isPartOf"/><div><article aria-labelledby="id__zh0njuoiiw8 id__purzyn6mrfm id__v7ht47xv8qj id__h6fby9dftka id__ef51lhbfeqa id__hw0ieuun2pj id__32gp65bz5ds id__pifsw5luknl id__radd2fasfzq id__51vv2koqmx id__dfn4sc7of8n id__d1goq5ulxln id__zxdlls3dntd id__ov4jr3esdt8" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__hw0ieuun2pj"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Alas, that&#39;s still not quite safe. Not flushing means we cannot guarantee ordering of writes, which means you could end up with actual data corruption in e.g. a database, not just data loss. There&#39;s no good way around this other than doing full flushes.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213892331163649" itemprop="identifier"/><meta content="14" itemprop="position"/><meta content="5" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:27.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:27.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213892331163649" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213889646796802" itemprop="isPartOf"/><div><article aria-labelledby="id__sqzdizoavd id__mhmj97sm7aa id__swijuyck5pr id__s7r4n27non id__84esbooie5l id__mo5w9vp25u id__zsgao7szdfm id__pw43fnd0aw8 id__skailpfmev id__r3lzk4k4u39 id__fpsvw8rxfww id__b9ln6aemf2 id__wib76zx85v id__tan3t2pezh" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__mo5w9vp25u"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>So the unfortunate conclusion is that if you&#39;re e.g. running a transactional database on Apple hardware, and you need to be able to survive a hard poweroff without data corruption, you&#39;re never going to get more than ~46 TPS.

Unless Apple improves their ANS firmware to fix this.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494215160218939392" itemprop="identifier"/><meta content="15" itemprop="position"/><meta content="4" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:40:30.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:40:30.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494215160218939392" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213892331163649" itemprop="isPartOf"/><div><article aria-labelledby="id__7hpqivlh2ue id__ljwepvva8n8 id__3ahy4omli7o id__tfpckzu6nyq id__bp9o55jmyzj id__naml6tdvbz id__i8ybih7599p id__0co7eufnxyad id__qsqut785iy9 id__mugy0r8o4jm id__iqaqkgdqfz id__hmwgwyjj2gf id__54xizwgp08 id__vv40jtqwplk" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__naml6tdvbz"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>And for what it&#39;s worth, I inadvertently triggered a data consistency issue in macOS while testing this. Before running any tests I had GarageBand open. I closed it without saving the open project. After the first hard reboot later, it tried to reopen it and threw up an error.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494215321125007362" itemprop="identifier"/><meta content="16" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:41:08.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:41:08.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494215321125007362" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494215160218939392" itemprop="isPartOf"/><div><article aria-labelledby="id__zdyc7kzr9jb id__jet09guoti id__cp6127cz6d id__wuoqh8o3tw9 id__c61hz8xws4 id__2yphd14ehat id__bibwmvm0vv id__dl6zx7aiiz5 id__w7562ienbs9 id__sjffy4bhn2 id__iipb4gw60b id__k8bbwv23ogl id__9zhsoachm4r id__ni3w9w4l2yf" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__2yphd14ehat"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>So I guess the unsaved project file got (partially?) deleted, but not the state that tells it to reopen the currently open file on startup.

Data consistency matters.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494221053220257795" itemprop="identifier"/><meta content="17" itemprop="position"/><meta content="8" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T08:03:55.000Z" itemprop="dateCreated"/><meta content="2022-02-17T08:03:55.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494221053220257795" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494215321125007362" itemprop="isPartOf"/><div><article aria-labelledby="id__spluj22euta id__t7xy6c91rsm id__7obe2d9b7x5 id__2uxhal2t7q6 id__hcf0ix2uggt id__zq9yzm8qs4 id__qjiduf8xn1j id__8d1z2s6avcr id__36ncegddeci id__899xyjv7anx id__7b662gif1hx id__li31n2bbwmo id__3z8uxt214b6 id__4kt9i3qdoof" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__zq9yzm8qs4"><div><div><div><div><a href="https://thewitchofendor.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Update: tested on the Mac Mini by pulling the plug (which is a &#34;normal&#34; case; the USB-PD thing was a bit special). Still lost seconds of fsync()ed data. There is no (working) last-gasp flush mechanism.</span></p></div></div></div></div></div></div></div></div></article></div></div></div></div></div></section></div></div></div></div></div></div></div></div>
  </body>
</html>
