<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://twitter.com/marcan42/status/1494213855387734019">Original</a>
    <h1>Apple&#39;s custom NVMes are amazingly fast â€“ if you don&#39;t care about data integrity</h1>
    
    <div id="readability-page-1" class="page"><div role="main"><div><div><div><div data-testid="primaryColumn"><div><div itemscope="" itemtype="https://schema.org/Collection"><meta content="Tweet with replies" itemprop="name"/><section aria-labelledby="accessible-list-729859" role="region"><div aria-label="Timeline: Conversation"><div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213855387734019" itemprop="identifier"/><meta content="1" itemprop="position"/><meta content="25" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:18.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:18.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213855387734019" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213855387734019" itemprop="mainEntityOfPage"/><div><article aria-labelledby="id__rogmn3m3l3i id__yep48ao3vu id__f7hprs823r id__fma1cpltw8 id__exb8sq3yc4w id__l4zos8kpfad id__z4njheqpv6a id__e5z0ghj7vps id__d5oywau2zin id__4au7xrveaq id__guo4k7asqv4 id__rlfx6uuyxxc id__kyqscxstlsf id__nldmhbgbu9" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__l4zos8kpfad"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div><div itemprop="articleBody"><div><p><span>Well, this is unfortunate. It turns out Apple&#39;s custom NVMe drives are amazingly fast - if you don&#39;t care about data integrity.

If you do, they drop down to HDD performance. Thread.</span></p></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213859594616834" itemprop="identifier"/><meta content="2" itemprop="position"/><meta content="3" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:19.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:19.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213859594616834" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213855387734019" itemprop="isPartOf"/><div><article aria-labelledby="id__dxmernj48z6 id__lwmceb0c71 id__24wcp9768u3 id__fwiuh8xddv4 id__ly9e4s0y1aq id__q6dq884kr7 id__54066wlb74o id__c23j0y5yqol id__ibk1zlw1qqr id__brigmn43nwm id__yl22iqnww5l id__rrlkg95sj3c id__8we484gzcsx id__z7hk5zcc2j" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__q6dq884kr7"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>For a while, we&#39;ve noticed that random write performance with fsync (data integrity) on Asahi Linux (and also on Linux on T2 Macs) was terrible. As in 46 IOPS terrible. That&#39;s slower than many modern HDDs.

We thought we were missing something, since this didn&#39;t happen on macOS.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213862970707969" itemprop="identifier"/><meta content="3" itemprop="position"/><meta content="7" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:20.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:20.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213862970707969" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213859594616834" itemprop="isPartOf"/><div><article aria-labelledby="id__t0szdr3nkb id__ld165sin82k id__dvp03dnk3k7 id__hc7tbxso0l id__mcoq4380eiq id__2j0eii9bbfh id__spy1uilth1p id__7f1836cqx8q id__2tn6fpho8hl id__izp9khefobg id__33b680n6xc5 id__dnmn1ht6s3t id__2n0boqaqo9e id__26ez0z4foch" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__2j0eii9bbfh"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>As it turns out, macOS cheats. On Linux, fsync() will both flush writes to the drive, and ask it to flush its write cache to stable storage.

But on macOS, fsync() only flushes writes to the drive. Instead, they provide an F_FULLSYNC operation to do what fsync() does on Linux.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213865613426688" itemprop="identifier"/><meta content="4" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:21.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:21.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213865613426688" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213862970707969" itemprop="isPartOf"/><div><article aria-labelledby="id__b8a8t5i2mkt id__pxlj7lvknl id__a2qcuxggw9k id__zxohjwjmqlb id__h5zmp1ko0s id__dw5mvf49up7 id__x8ja609ti6 id__9vwbzxadm5q id__vflaplfxwnl id__dvs9jy92gbc id__ldj01glwdgn id__b5ualqwut19 id__2jb8q7i9j25 id__7jqn23ywd5n" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__dw5mvf49up7"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>So effectively macOS cheats on benchmarks; fio on macOS does not give numbers comparable to Linux, and databases and other applications requiring data integrity on macOS need to special case it and use F_FULLSYNC.

How bad is it if you use F_FULLSYNC? It&#39;s bad.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213868201324546" itemprop="identifier"/><meta content="5" itemprop="position"/><meta content="5" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:21.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:21.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213868201324546" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213865613426688" itemprop="isPartOf"/><div><article aria-labelledby="id__uu6wplhwoer id__vqvsglqh9x id__1rvibiup0cei id__rpxunf0zp2 id__a7ni82zpyl7 id__lnbl3ej43t8 id__uov85f2o7s8 id__ix8rj6pp9x id__jg2e1mcureg id__xui9ownrcro id__wfk1czrb1fk id__cg816l32li4 id__c9gwnuzw7w8 id__1oqs3du0mbn" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__lnbl3ej43t8"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Single threaded, simple Python file rewrite test:

Macbook Air M1 (macOS):
- flushing: 46 IOPS
- not: 40000 IOPS

x86 iMac + WD SN550 1TB NVMe (Linux):
- flushing: 2000 IOPS
- not: 20000 IOPS

x86 laptop + Samsung SSD 860 EVO 500GB SATA:
- flushing: 143 IOPS
- not: 5000 IOPS</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213871149940737" itemprop="identifier"/><meta content="6" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:22.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:22.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213871149940737" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213868201324546" itemprop="isPartOf"/><div><article aria-labelledby="id__gl5cz95zvq6 id__dddsxzfjg29 id__nee2sad6cl id__um22ztprxy id__psvr50r2gv9 id__n4n3nayci7 id__qyh9a02cro id__v00wpezu7b id__k72j3wqaper id__vzju1zz7sd id__8elep0seyfg id__ddeougn4tpb id__7alwhnfudp7 id__p9d144a97k" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__n4n3nayci7"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>So, effectively, Apple&#39;s drive is faster than all the others without cache flushes, but it is more than 3 times slower than a lowly SATA SSD at flushing its cache. Even if all you wrote is a couple of sectors. You pay a huge flush penalty if you do *any* writes.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213873993682946" itemprop="identifier"/><meta content="7" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:23.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:23.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213873993682946" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213871149940737" itemprop="isPartOf"/><div><article aria-labelledby="id__8hck9qorzo2 id__5t387b406rl id__ckgtcv0y8an id__qse2gpmyno id__pf86b36d5t8 id__w2jw2tjhs9 id__ru8dv1d4ap id__155idqybvzr id__go8s2kelhz id__kwrg57651ha id__5lhi7mrjc4w id__t6y7soed4z id__dla6rwsb1c5 id__e9tyr4aaj8m" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__w2jw2tjhs9"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Here, &#34;flushing&#34; on macOS means F_FULLSYNC and &#34;not&#34; means fsync(); on Linux both are fsync(), but &#34;not flushing&#34; is measured by telling Linux that the drive write cache is write-through (which stops it from issuing cache flushes).</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213876657049600" itemprop="identifier"/><meta content="8" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:24.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:24.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213876657049600" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213873993682946" itemprop="isPartOf"/><div><article aria-labelledby="id__7icdlz6kbzl id__rv08q8dqvt id__yd5nal11pfk id__xcxmrg33ab id__fvpj4lur84m id__e9cc26ycbl4 id__vj7p7h7pgot id__nmnc1poaqqc id__stebn63hdnq id__dv4n146cb2t id__qjtspawohhm id__yk6xag2o3ic id__3l9yl6tc1qs id__em82l6zvprg" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__e9cc26ycbl4"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Note that the numbers are filesystem-dependent (and encryption makes things more complicated); e.g. the SATA SSD numbers double on VFAT vs. my root filesystem (ext4 on LVM on dm-crypt), but the pattern is clear.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213879089737729" itemprop="identifier"/><meta content="9" itemprop="position"/><meta content="4" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:24.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:24.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213879089737729" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213876657049600" itemprop="isPartOf"/><div><article aria-labelledby="id__83wbrg317lr id__wl6qs8tne9b id__1snwpirftt3 id__crlnumqwfb id__1c0uemyihhh id__wja37e353e8 id__mgrt3ck2c2 id__99kvn0vz8ct id__sbvvm3kfh3j id__7hputbu4o8v id__mxtr8tjv6r id__cphdz50894c id__3vk5zll5eby id__204spd1lt2g" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__wja37e353e8"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>macOS doesn&#39;t even seem to try to proactively issue syncs; you can write a file on macOS, fsync() it, wait 5 seconds, issue a hard reboot (e.g. via USB-PD command), and the data is gone. That&#39;s pretty bad.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213881509875712" itemprop="identifier"/><meta content="10" itemprop="position"/><meta content="7" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:25.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:25.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213881509875712" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213879089737729" itemprop="isPartOf"/><div><article aria-labelledby="id__nc56v2u9kqg id__ivkmlxmw7a id__ssdx6w3e8z id__of5i9r29z7p id__b8qzob7sx id__pmubzzw4upq id__21unlrd95zy id__gk9hctkl4wr id__qx6s0g5ti2 id__8zac8ucwk id__vuje3ksd9i9 id__euqveixwnzn id__3pa16ahihd9 id__eazg7gh9doa" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__pmubzzw4upq"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Of course, in normal usage, this is basically never an issue on laptops; given the right software hooks, they should never run out of power before the OS has a chance to issue a disk flush command. But it certainly is for desktops. And it&#39;s a bit fragile re: panics and such.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213883976101888" itemprop="identifier"/><meta content="11" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:25.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:25.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213883976101888" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213881509875712" itemprop="isPartOf"/><div><article aria-labelledby="id__zltfudcncm id__o7egc99u39i id__iaalvh8kqp id__et7tdz3r3at id__1kpzloks6xi id__8naz0qwgpl4 id__4hv08hg1h85 id__eitj2s0ud7r id__xqrm0b20ok id__acee8w5006 id__dghztuvsrx8 id__mr62y7sfk9 id__mb6n9youz9 id__kk3vv1ik6xt" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__8naz0qwgpl4"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Unfortunately, this manifests itself as quite visible issues on Linux. For example, apt-get on Asahi Linux is noticeably slow. Making fsync() not really flush on macOS is not fair; lots of portable software is written to assume fsync() means your data is safe.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213886928908288" itemprop="identifier"/><meta content="12" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:26.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:26.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213886928908288" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213883976101888" itemprop="isPartOf"/><div><article aria-labelledby="id__99ex3rjqxxr id__fcb0lh36w9h id__q7okpdg94y id__0xaw9eszxern id__w0nu715iou id__cum9gy7cz5v id__mrf7kzu0em id__u6rtwftqm7c id__i0velywznu id__he3zf2wgaaq id__fii7hidybzf id__athgel9gmrb id__m46pnbnx1dp id__yf151so114" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__cum9gy7cz5v"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Our current thinking is we&#39;re going to add a knob to the NVMe driver to defer flush requests up to a maximum time of e.g. 1 second. That would ensure that a hard shutdown never loses you more than 1 second of data, which is better than what macOS can claim right now.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213889646796802" itemprop="identifier"/><meta content="13" itemprop="position"/><meta content="3" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:27.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:27.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213889646796802" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213886928908288" itemprop="isPartOf"/><div><article aria-labelledby="id__yhmu3kuzy1d id__2bopdmjtlbd id__iora4waxyvl id__p296qtzafbg id__g5nicysmkrn id__aptniyiqife id__cqq0l8m71a9 id__m0ctxvictc id__8bot8l0z8h id__jc1djlwfoz8 id__lpb3378ellb id__nl327068h5l id__g6xr6nc5yh9 id__b7wputvti6b" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__aptniyiqife"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Alas, that&#39;s still not quite safe. Not flushing means we cannot guarantee ordering of writes, which means you could end up with actual data corruption in e.g. a database, not just data loss. There&#39;s no good way around this other than doing full flushes.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213892331163649" itemprop="identifier"/><meta content="14" itemprop="position"/><meta content="5" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:27.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:27.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213892331163649" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213889646796802" itemprop="isPartOf"/><div><article aria-labelledby="id__4czzknttpes id__p8o75jw9jy id__9sjqegwxptn id__lzfradyj6eb id__i4ave922lb8 id__tpjjuyy6g0n id__ogn7gqpwi9c id__n5s8lujrti id__o7eccj4s99j id__1jq809clbz8 id__665ws98lyud id__6vszkn1szu2 id__sgre87dfd5 id__m9s5lekmx9q" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__tpjjuyy6g0n"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>So the unfortunate conclusion is that if you&#39;re e.g. running a transactional database on Apple hardware, and you need to be able to survive a hard poweroff without data corruption, you&#39;re never going to get more than ~46 TPS.

Unless Apple improves their ANS firmware to fix this.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494215160218939392" itemprop="identifier"/><meta content="15" itemprop="position"/><meta content="6" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:40:30.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:40:30.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494215160218939392" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213892331163649" itemprop="isPartOf"/><div><article aria-labelledby="id__kjyht5j00h id__lp77b6ra1cc id__e80c3czt1b id__5t79c8uuvoi id__ozij9jztozo id__f5rp91pmhhe id__8i2yz7amyxg id__l15k3t7r9z id__a5jhz0tbwmc id__hssze6p9bd id__un8t1ws6hp id__0dbzxkhgcy75 id__bfrbb6otrkn id__2m361uf44gy" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__f5rp91pmhhe"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>And for what it&#39;s worth, I inadvertently triggered a data consistency issue in macOS while testing this. Before running any tests I had GarageBand open. I closed it without saving the open project. After the first hard reboot later, it tried to reopen it and threw up an error.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494215321125007362" itemprop="identifier"/><meta content="16" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:41:08.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:41:08.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494215321125007362" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494215160218939392" itemprop="isPartOf"/><div><article aria-labelledby="id__1ki44e0u171 id__3h7tmzgtm2l id__qc6j6tnvz3q id__y8ds8ccr2lr id__8b6hckfcuz8 id__z1efqqauq08 id__88j0zvkn9x6 id__56c6l1s488 id__yvnvf7lc2o id__v4fz10rix8f id__35k0kwuh3ud id__314nauh494p id__9pdb3y1mr7m id__m4to6wrp20p" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__z1efqqauq08"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>So I guess the unsaved project file got (partially?) deleted, but not the state that tells it to reopen the currently open file on startup.

Data consistency matters.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494221053220257795" itemprop="identifier"/><meta content="17" itemprop="position"/><meta content="10" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T08:03:55.000Z" itemprop="dateCreated"/><meta content="2022-02-17T08:03:55.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494221053220257795" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494215321125007362" itemprop="isPartOf"/><div><article aria-labelledby="id__n5d87e33kbg id__mxeahg8ih7s id__m4apsf3qwp8 id__fsbfvhpyhcr id__86ftuxe9pku id__wkp2o9mbg1 id__rrv4kmga97s id__nrgx61mjm57 id__xvysgauzlz id__cu58jqcbrq id__8t2e5f0etr4 id__vxs0pglfk2g id__fdphopgbhrm id__3jno75uynh3" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__wkp2o9mbg1"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Update: tested on the Mac Mini by pulling the plug (which is a &#34;normal&#34; case; the USB-PD thing was a bit special). Still lost seconds of fsync()ed data. There is no (working) last-gasp flush mechanism.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494255642202484743" itemprop="identifier"/><meta content="18" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T10:21:21.000Z" itemprop="dateCreated"/><meta content="2022-02-17T10:21:21.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494255642202484743" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494221053220257795" itemprop="isPartOf"/><div><article aria-labelledby="id__vgqmf7vnay id__h2m8blq4vr6 id__qnna6sopmqr id__nmdxqsa3h3n id__qxguzkdvil id__t1dxes5oqi id__j4rgrauvz3 id__9v2u0m4oiip id__ux78p1hvp6l id__2dl8k5bn8th id__ytimkgqwi6l id__6x3b9ccqpp5 id__ab4ugkoijur id__a97n1gh8xxe" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__t1dxes5oqi"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Further testing: doing this on FAT32 (to avoid APFS write amplification, which is a separate problem...) doesn&#39;t help with the IOPS on flush, but then I can look at powermetrics bandwidth stats to see what NVMe is doing.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494255645612474369" itemprop="identifier"/><meta content="19" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T10:21:22.000Z" itemprop="dateCreated"/><meta content="2022-02-17T10:21:22.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494255645612474369" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494255642202484743" itemprop="isPartOf"/><div><article aria-labelledby="id__n56d103ni7 id__aw91vacu9q id__gv24d2f9uk id__gzbxecsc27q id__jv551skqf1p id__h3ujer8edc id__0ym4x9mapc7 id__1vksyed7ftm id__z3nxci44jsm id__nyod4v59knh id__hj88fw3ous id__fajtz7q4fdr id__12wljtde123q id__3msh369dv3l" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__h3ujer8edc"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Artificially throttled ~30 IOPS without full cache flushes, I get 93.52 ops/s 397.77 KBytes/s disk IO, which is reasonable, and:

ANS2 RD                         : 0.328 MB/s
ANS2 WR                         : 0.399 MB/s

That&#39;s NVMe controller DRAM bandwidth. Reasonable.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494255649026625537" itemprop="identifier"/><meta content="20" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T10:21:23.000Z" itemprop="dateCreated"/><meta content="2022-02-17T10:21:23.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494255649026625537" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494255645612474369" itemprop="isPartOf"/><div><article aria-labelledby="id__fcjubjbor78 id__omdw2r03b1k id__i99dkljjc9f id__qal8fqzlz0g id__79qsd6b3s9n id__ftfjcnnaioa id__sqxlc48i3g9 id__5xc1eaeb1m7 id__coeanb20x2c id__czp2mcqpi18 id__0wg20mhu34xf id__uhmbiy9st4p id__uz17h93bcuq id__oq89q3arafk" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__ftfjcnnaioa"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>But doing flushes, this jumps to:

ANS2 RD                         : 6.248 MB/s
ANS2 WR                         : 9.909 MB/s

So that NVMe controller is doing *something* memory-intensive on flush commands. Maybe it does a linear scan over a large cache hashtable?</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494256049150640129" itemprop="identifier"/><meta content="21" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T10:22:58.000Z" itemprop="dateCreated"/><meta content="2022-02-17T10:22:58.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494256049150640129" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494255649026625537" itemprop="isPartOf"/><div><article aria-labelledby="id__7rrdgc1oscc id__p60b61ulv3e id__21iqri9mllkj id__l3in4bh7bw id__xb7dqadfhjk id__po3d5axqzmh id__aycbnf08cc id__pmr97wbnvjm id__yirqvqa91zp id__vb083u0abl8 id__xcw643besa id__mk6lod2z7o id__rjzbi7lxpq id__1o00mio29t8" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__po3d5axqzmh"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>I can get these stats because the NVMe controller is integrated into the SoC and &#34;drive cache&#34; is just normal memory (it&#39;s unified just like GPU memory), and Apple have very good instrumentation of things like DRAM bandwidth utilization from different SoC agents.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494293060020506626" itemprop="identifier"/><meta content="22" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T12:50:02.000Z" itemprop="dateCreated"/><meta content="2022-02-17T12:50:02.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494293060020506626" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494256049150640129" itemprop="isPartOf"/><div><article aria-labelledby="id__th5rciwzpg id__gk6gm1zvkg5 id__mo093vzdim id__8l8o9uvh7ju id__oth6weficwi id__c7r1e3z887m id__ise0u5u4deg id__bg1gi0orzup id__whpsns0bi6 id__el6dtaoyxe id__wg6z2m3m72m id__etd1r4d42qe id__by7djm6y5l8 id__i4mlfxs1sye" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__c7r1e3z887m"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Uh, guys? I&#39;m not saying &#34;the machines are only fast because they cheat on data durability&#34;. I&#39;m saying there&#39;s a stupid, unfortunate performance bug when you *do* want durability that most people won&#39;t notice because macOS gives you poor durability by default.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494293064579686400" itemprop="identifier"/><meta content="23" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T12:50:03.000Z" itemprop="dateCreated"/><meta content="2022-02-17T12:50:03.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494293064579686400" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494293060020506626" itemprop="isPartOf"/><div><article aria-labelledby="id__ei9lwsy9uz id__v7w51p94ig id__qe8ahu3ub7 id__t25hj8kkh3 id__5aomr5lgj06 id__25vgifq377o id__q4kzyqjodfm id__qiujqgimwd id__c696lhymy1 id__ginqjnsv6fr id__6q918hl9y0d id__msfypk50e2 id__4orqzyeea1d id__o7mcqpd4ox" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__25vgifq377o"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>These SSDs are still fast for many use cases, and on laptops you don&#39;t care about this issue because there&#39;s a battery backup anyway.

And besides, Apple can almost certainly fix this in a firmware upgrade.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494293067771564040" itemprop="identifier"/><meta content="24" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T12:50:04.000Z" itemprop="dateCreated"/><meta content="2022-02-17T12:50:04.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494293067771564040" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494293064579686400" itemprop="isPartOf"/><div><article aria-labelledby="id__w1i1241aj0m id__mhkuzsyxywq id__bdjzumizq2f id__1h1syyuitcs id__yqozbmy0as id__j3mdpcckxm9 id__h38hgj5ipw id__odcre53zwbf id__hf62yfz1jur id__384tte7rzwp id__babd2avws0h id__gv6dqdhrj3 id__4v1xlc7wqtc id__5ygv030sbv4" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__j3mdpcckxm9"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Chances are this happened because this design came from iDevices, where there&#39;s always a battery, so software will never hit drive cache related consistency/durability issues, so probably ~no iOS software ever uses a full sync, so nobody noticed it&#39;s slow.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494293071118614529" itemprop="identifier"/><meta content="25" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T12:50:05.000Z" itemprop="dateCreated"/><meta content="2022-02-17T12:50:05.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494293071118614529" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494293067771564040" itemprop="isPartOf"/><div><article aria-labelledby="id__nhqvq75358 id__8bjx2bm8i9k id__n9rzpnrtlas id__bhdbdf2v12h id__47sefh8ofz7 id__v0fzem13k9 id__ks2l86iry1b id__ab64nbx1kv9 id__jk41fsvhq5 id__ead2j6nj7ln id__ey0l7czx25d id__duuwu2arz9 id__yk67y94key id__mudhamrlvqa" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__v0fzem13k9"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>And I&#39;m just the Nth guy to facepalm when I found out that macOS makes data durability double-opt-in with a nonstandard request. That&#39;s dumb, but it has nothing to do with the machines. It&#39;s just the reason why fio was magically fast on macOS and not on Linux.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494293769134690305" itemprop="identifier"/><meta content="26" itemprop="position"/><meta content="3" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T12:52:51.000Z" itemprop="dateCreated"/><meta content="2022-02-17T12:52:51.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494293769134690305" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494293071118614529" itemprop="isPartOf"/><div><article aria-labelledby="id__a79l21qqm0t id__3yty86rbfbi id__7twfyyduuqo id__j5fd6xp10l id__umjezfwtz6a id__we0iv29eq8 id__z86geui0sxo id__ywn3hhryof id__lngn4et905 id__eco9ed5znw8 id__4q98zx6nngp id__fgxlvy5656o id__cws1xvre2vp id__fy7a4y5jkzf" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__we0iv29eq8"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Note that the NVMe controller behaves in a perfectly spec-compliant way as far as data durability. It&#39;s just (ridiculously) slow when you ask for it. Probably a bug.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494307439906533376" itemprop="identifier"/><meta content="27" itemprop="position"/><meta content="3" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T13:47:11.000Z" itemprop="dateCreated"/><meta content="2022-02-17T13:47:11.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494307439906533376" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494293769134690305" itemprop="isPartOf"/><div><article aria-labelledby="id__vwsb5g4j2v id__a7tjinaq8b id__nzee1z4q0ie id__4uiyhmsqzg id__rhwr3f2gvl8 id__mafi34kihw id__mm0bwf3zi6c id__ys8id9g06ha id__r76ml21emx id__e6uqs2m1kcb id__0x944adlybh id__yx6bro188p id__sicob3ongp id__3kpo7wjy05y" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__mafi34kihw"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>But since incessant people on HN made me do another test, and for giggles:

FAT32 on internal NVMe with F_FULLFSYNC: 58 IOPS
FAT32 on a cheapo USB3 flash drive with the same: 223 IOPS.

If you run a durable database on an M1 today, try a cheap flash drive. It&#39;ll be faster :-)</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494307794182631424" itemprop="identifier"/><meta content="28" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T13:48:35.000Z" itemprop="dateCreated"/><meta content="2022-02-17T13:48:35.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494307794182631424" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494307439906533376" itemprop="isPartOf"/><div><article aria-labelledby="id__1bvlv1w7t7w id__ywx2lfq85e id__01ln79ahjkx7 id__a1e79kn3o7a id__cjx6gzx2yk id__ir75eh1m2eg id__e7qaiudfmfj id__be9hu05jaze id__ya7kvsaju2 id__n33dzd9h08 id__dxlqw2a5f1t id__f18d9ed86r4 id__skl6vkdusdf id__ibc07s4wtf" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__ir75eh1m2eg"><div><div><div><div><a href="https://twitter.com/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Of course, the flash drive doesn&#39;t have a cache at all, so it remains at 223 IOPS with fsync() vs. 60000 IOPS or so on NVMe - so make sure you go with NVMe if you&#39;re on a laptop where it&#39;s safe, only use the cheapo drive on Mac Minis and iMacs! </span><span>ðŸ˜‡</span></p></div></div></div></div></div></div></div></div></article></div></div></div></div></div></section></div></div></div></div></div></div></div></div>
  </body>
</html>
