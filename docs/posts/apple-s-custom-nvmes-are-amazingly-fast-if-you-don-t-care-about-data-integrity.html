<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://twitter.com/marcan42/status/1494213855387734019">Original</a>
    <h1>Apple&#39;s custom NVMes are amazingly fast â€“ if you don&#39;t care about data integrity</h1>
    
    <div id="readability-page-1" class="page"><div role="main"><div><div><div><div data-testid="primaryColumn"><div><div itemscope="" itemtype="https://schema.org/Collection"><meta content="Tweet with replies" itemprop="name"/><section aria-labelledby="accessible-list-22548" role="region"><div aria-label="Timeline: Conversation"><div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213855387734019" itemprop="identifier"/><meta content="1" itemprop="position"/><meta content="43" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:18.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:18.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213855387734019" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213855387734019" itemprop="mainEntityOfPage"/><div><article aria-labelledby="id__394hub8riil id__jd2n3k5a2hg id__g9swgugsnaq id__szo3deaubc id__w503v2glp3i id__gl9dag3cs7i id__bbmi15zg0id id__it7lrzqe5l id__ndx6peb5ou id__6n9c8khiovv id__ed3qbmbnygb id__akts8crghng id__xbdweszvcwk id__phjbbmd72w" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__gl9dag3cs7i"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div></div><div><div><div itemprop="articleBody"><div><p><span>Well, this is unfortunate. It turns out Apple&#39;s custom NVMe drives are amazingly fast - if you don&#39;t care about data integrity.

If you do, they drop down to HDD performance. Thread.</span></p></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213859594616834" itemprop="identifier"/><meta content="2" itemprop="position"/><meta content="3" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:19.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:19.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213859594616834" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213855387734019" itemprop="isPartOf"/><div><article aria-labelledby="id__mvbta4thb2 id__8x8ffbl3q4s id__lbh2c1ti6pj id__qnhifhxxaj id__we0axo6nyl id__1tzq55tnwl3 id__qzeq8y38x7 id__w5wqnrfcw1 id__lssorjpxl id__tx6dcqdq9q id__gvs3412kwxg id__sf2j74hpo1 id__vpqwj64t6i id__wgcefrms36" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__1tzq55tnwl3"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>For a while, we&#39;ve noticed that random write performance with fsync (data integrity) on Asahi Linux (and also on Linux on T2 Macs) was terrible. As in 46 IOPS terrible. That&#39;s slower than many modern HDDs.

We thought we were missing something, since this didn&#39;t happen on macOS.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213862970707969" itemprop="identifier"/><meta content="3" itemprop="position"/><meta content="10" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:20.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:20.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213862970707969" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213859594616834" itemprop="isPartOf"/><div><article aria-labelledby="id__jpq5n55l5zr id__oi6r2a2dqt id__0npew9f2i59g id__dbrbgx7rl9f id__icrehcojmsp id__rmc9vzo4k8o id__915nn76kcrd id__wcur2mxuqac id__nwesso2k4mj id__eccfswp0llv id__0908rqjdfipg id__ltnrwifgv7r id__ywppw9es3o id__nf39bn8gmw" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__rmc9vzo4k8o"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>As it turns out, macOS cheats. On Linux, fsync() will both flush writes to the drive, and ask it to flush its write cache to stable storage.

But on macOS, fsync() only flushes writes to the drive. Instead, they provide an F_FULLSYNC operation to do what fsync() does on Linux.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213865613426688" itemprop="identifier"/><meta content="4" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:21.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:21.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213865613426688" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213862970707969" itemprop="isPartOf"/><div><article aria-labelledby="id__us6nibzpmyg id__ykx2z5ebsw id__z8fabebmq3 id__bnytoj17cr4 id__d4fmsqg3pgd id__t1olgw5tdd id__7yfemvsp0sx id__9xilq6x7it id__9085tgafe6l id__q2o2h5jhgzq id__387yt7kg6h7 id__3do7eqofo9 id__629eqzbnzh4 id__emq6hce5t3c" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__t1olgw5tdd"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>So effectively macOS cheats on benchmarks; fio on macOS does not give numbers comparable to Linux, and databases and other applications requiring data integrity on macOS need to special case it and use F_FULLSYNC.

How bad is it if you use F_FULLSYNC? It&#39;s bad.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213868201324546" itemprop="identifier"/><meta content="5" itemprop="position"/><meta content="5" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:21.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:21.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213868201324546" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213865613426688" itemprop="isPartOf"/><div><article aria-labelledby="id__tkuzcx2pum id__4i22uhv9p8q id__x5d4lru7bkm id__bt2l7gqort id__q7582miolz id__jf8aw04dv68 id__smfa311sm39 id__6vw8quech83 id__8a96q3hjg03 id__khfn4kz9i3 id__8xi3z9ao72k id__4skwrzigmi5 id__a219i42ma6 id__afxeh53wao" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__jf8aw04dv68"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Single threaded, simple Python file rewrite test:

Macbook Air M1 (macOS):
- flushing: 46 IOPS
- not: 40000 IOPS

x86 iMac + WD SN550 1TB NVMe (Linux):
- flushing: 2000 IOPS
- not: 20000 IOPS

x86 laptop + Samsung SSD 860 EVO 500GB SATA:
- flushing: 143 IOPS
- not: 5000 IOPS</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213871149940737" itemprop="identifier"/><meta content="6" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:22.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:22.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213871149940737" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213868201324546" itemprop="isPartOf"/><div><article aria-labelledby="id__unc9c1cdlx id__wqpm62br3xa id__xu5sapvs01i id__5fx22d88m36 id__2uuez236mkw id__8rl5lyg4fpn id__o2223g17tea id__jamqtlawr0l id__uzd2ccqlqpd id__w72iwv8pqio id__kuwm59j659 id__8ucbxcwmcd8 id__oer342p7qwo id__j25qtpa9jm" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__8rl5lyg4fpn"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>So, effectively, Apple&#39;s drive is faster than all the others without cache flushes, but it is more than 3 times slower than a lowly SATA SSD at flushing its cache. Even if all you wrote is a couple of sectors. You pay a huge flush penalty if you do *any* writes.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213873993682946" itemprop="identifier"/><meta content="7" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:23.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:23.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213873993682946" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213871149940737" itemprop="isPartOf"/><div><article aria-labelledby="id__1hoqy5454qki id__558b7kmeeef id__8ivwz03eb7g id__0mrojynt6u2 id__rqnrt0k97r id__mc4zlh3x9dk id__sdbcsfd0je id__4ny8k0ldz4d id__mr0iadxbsq id__f8qqmjxu25p id__z2xgygmfbcl id__ewwp0mzzq2k id__bkm03i5kftl id__bqeu5ocia8g" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__mc4zlh3x9dk"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Here, &#34;flushing&#34; on macOS means F_FULLSYNC and &#34;not&#34; means fsync(); on Linux both are fsync(), but &#34;not flushing&#34; is measured by telling Linux that the drive write cache is write-through (which stops it from issuing cache flushes).</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213876657049600" itemprop="identifier"/><meta content="8" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:24.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:24.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213876657049600" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213873993682946" itemprop="isPartOf"/><div><article aria-labelledby="id__8yq7wbfbhe4 id__2fckn05oolg id__2piuj7n7ash id__eogtbyopwne id__svqo22gzid id__t5ijakrjnyc id__97uhuzvzu7 id__qmk2ivb45d id__dlhay5v9l3t id__18dz3x4v01n id__90ov8y9djvk id__w5au0p6tzk id__8cjoufb7qn id__c6szdhmb2g9" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__t5ijakrjnyc"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Note that the numbers are filesystem-dependent (and encryption makes things more complicated); e.g. the SATA SSD numbers double on VFAT vs. my root filesystem (ext4 on LVM on dm-crypt), but the pattern is clear.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213879089737729" itemprop="identifier"/><meta content="9" itemprop="position"/><meta content="4" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:24.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:24.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213879089737729" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213876657049600" itemprop="isPartOf"/><div><article aria-labelledby="id__omcdlsb32jf id__xx5js7wmsp id__27io4owkchv id__06cn3etuo7if id__8tlxh9tarsg id__6lep0nyzipr id__eg27b2psslp id__9hfla54scsl id__q6yj4mqzn8 id__qlnnfwenhfb id__phhqiuu7ayo id__olwdxutszs id__cwt08ol211d id__fi8fiqxsjrg" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__6lep0nyzipr"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>macOS doesn&#39;t even seem to try to proactively issue syncs; you can write a file on macOS, fsync() it, wait 5 seconds, issue a hard reboot (e.g. via USB-PD command), and the data is gone. That&#39;s pretty bad.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213881509875712" itemprop="identifier"/><meta content="10" itemprop="position"/><meta content="8" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:25.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:25.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213881509875712" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213879089737729" itemprop="isPartOf"/><div><article aria-labelledby="id__02b3c6dusxdi id__563iabg7ipv id__nh26v726f6g id__0nrahc2f097s id__v1mcsj0w3 id__0e5x6pad90u id__n2dxalefpu id__tqihyw7nlnk id__a2hej2mmplr id__281gwovmjgp id__j22f80tf609 id__gg47e40auek id__p005gfk51u8 id__sg7foh4o3sc" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__0e5x6pad90u"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Of course, in normal usage, this is basically never an issue on laptops; given the right software hooks, they should never run out of power before the OS has a chance to issue a disk flush command. But it certainly is for desktops. And it&#39;s a bit fragile re: panics and such.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213883976101888" itemprop="identifier"/><meta content="11" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:25.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:25.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213883976101888" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213881509875712" itemprop="isPartOf"/><div><article aria-labelledby="id__yf53ua0wci id__7vnyovsy4rb id__rkrhg9b8js9 id__19h1puc1ie6 id__kqz4l2c91or id__2h4duxl46t8 id__irqd2fbtreg id__lsbfw5vk28k id__ii1x91ktns id__q28ouyiwob id__pm9hb4ryou id__y14ma5nzq8 id__bxpq7t9b29a id__6wv9qpy6a7s" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__2h4duxl46t8"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Unfortunately, this manifests itself as quite visible issues on Linux. For example, apt-get on Asahi Linux is noticeably slow. Making fsync() not really flush on macOS is not fair; lots of portable software is written to assume fsync() means your data is safe.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213886928908288" itemprop="identifier"/><meta content="12" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:26.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:26.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213886928908288" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213883976101888" itemprop="isPartOf"/><div><article aria-labelledby="id__dudatpwqiy8 id__q1lqvac0ho id__qexdwlop7w id__0cd51nj65qcj id__zir9ret8trg id__ru2ybkctbf id__wr6hdb0qfuh id__s49xbzy18v id__upp78fbksba id__jneaqay40hj id__0idocbgz6j2v id__dmfzxltdepq id__yddhegxadb7 id__ajcdqpi9qgo" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__ru2ybkctbf"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Our current thinking is we&#39;re going to add a knob to the NVMe driver to defer flush requests up to a maximum time of e.g. 1 second. That would ensure that a hard shutdown never loses you more than 1 second of data, which is better than what macOS can claim right now.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213889646796802" itemprop="identifier"/><meta content="13" itemprop="position"/><meta content="4" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:27.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:27.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213889646796802" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213886928908288" itemprop="isPartOf"/><div><article aria-labelledby="id__o3bt5er3qd id__oc18s0smt6g id__62rvfbfmclb id__dkhjj44ku0a id__5k4p86kvrsl id__l58dc23ajcr id__5ia46hblae7 id__vutw5flqpp id__qwk8ip21xaq id__h3p9c5yv4c6 id__ngh6c533uc id__9ds2qludg0a id__kjv7a950lx id__0nsdqgj03qle" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__l58dc23ajcr"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Alas, that&#39;s still not quite safe. Not flushing means we cannot guarantee ordering of writes, which means you could end up with actual data corruption in e.g. a database, not just data loss. There&#39;s no good way around this other than doing full flushes.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494213892331163649" itemprop="identifier"/><meta content="14" itemprop="position"/><meta content="7" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:35:27.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:35:27.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494213892331163649" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213889646796802" itemprop="isPartOf"/><div><article aria-labelledby="id__09gnhzyumkhd id__e0eykirufwc id__ggqpms66xrl id__v82ie296bq9 id__7kg5zzc0eqb id__z8xak685h8k id__x73tcqgm4xq id__3nnq2hl1zp3 id__7oaxchqnmdd id__v1x8l3jxnc id__fn78hpxg2dj id__505cwif0inw id__jddwezfm3e id__big5qf8haao" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__z8xak685h8k"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>So the unfortunate conclusion is that if you&#39;re e.g. running a transactional database on Apple hardware, and you need to be able to survive a hard poweroff without data corruption, you&#39;re never going to get more than ~46 TPS.

Unless Apple improves their ANS firmware to fix this.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494215160218939392" itemprop="identifier"/><meta content="15" itemprop="position"/><meta content="7" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:40:30.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:40:30.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494215160218939392" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494213892331163649" itemprop="isPartOf"/><div><article aria-labelledby="id__2z213mjfgpc id__m52xzvznaxn id__wy54519fyy id__pbzp1js8i0r id__m0uvgwlvmr id__hqowxgu8djm id__mt60uw4ma0i id__lybarpg1vl id__mhip46arevd id__kjllg61k7ra id__vk07pjfz4ph id__xjbfdoqixv id__1981nq5epfq id__p6o2o9t4ke8" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__hqowxgu8djm"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>And for what it&#39;s worth, I inadvertently triggered a data consistency issue in macOS while testing this. Before running any tests I had GarageBand open. I closed it without saving the open project. After the first hard reboot later, it tried to reopen it and threw up an error.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494215321125007362" itemprop="identifier"/><meta content="16" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T07:41:08.000Z" itemprop="dateCreated"/><meta content="2022-02-17T07:41:08.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494215321125007362" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494215160218939392" itemprop="isPartOf"/><div><article aria-labelledby="id__7isjnnsrvpe id__7scqsxqx20h id__3yi8aem0vwm id__iwaeq9ag2ig id__o29n0y7rkqk id__m2s0kadc3z id__ke8v315e3mr id__v8698md8o9 id__0jj85kqlzyf id__ct2ncoy0q64 id__6ehd4eicp0b id__05bvomn25oep id__ex5kt9fpfr id__rudvx99ck4" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__m2s0kadc3z"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>So I guess the unsaved project file got (partially?) deleted, but not the state that tells it to reopen the currently open file on startup.

Data consistency matters.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494221053220257795" itemprop="identifier"/><meta content="17" itemprop="position"/><meta content="10" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T08:03:55.000Z" itemprop="dateCreated"/><meta content="2022-02-17T08:03:55.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494221053220257795" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494215321125007362" itemprop="isPartOf"/><div><article aria-labelledby="id__0b74mi5rn5h id__h5u19uiggfn id__w2bl9qw18n id__bvygfsv4ar id__13xlr3l1h9jo id__0q111ae09rs id__zxpudsnr3i id__4hdvji8ojvh id__qoi5y8oxw5 id__gvsze9n4sk8 id__mmf2jfdfbgb id__oklk4y3tyx id__74x6zv9y3cd id__1uf3dvmha2" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__0q111ae09rs"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Update: tested on the Mac Mini by pulling the plug (which is a &#34;normal&#34; case; the USB-PD thing was a bit special). Still lost seconds of fsync()ed data. There is no (working) last-gasp flush mechanism.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494255642202484743" itemprop="identifier"/><meta content="18" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T10:21:21.000Z" itemprop="dateCreated"/><meta content="2022-02-17T10:21:21.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494255642202484743" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494221053220257795" itemprop="isPartOf"/><div><article aria-labelledby="id__rw0fqqklfdi id__dcm3eqj99l id__j8csvz625ka id__lfkod1la1mh id__pj9kmsb0c8 id__e5x4vrlot04 id__e38cj0mp1hl id__9u0tzswwhw7 id__95h367llcmu id__c7jhmmsc0pr id__hz9s7kypife id__xw2wslr5ahr id__oo785795fqn id__waixjg9j0gh" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__e5x4vrlot04"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Further testing: doing this on FAT32 (to avoid APFS write amplification, which is a separate problem...) doesn&#39;t help with the IOPS on flush, but then I can look at powermetrics bandwidth stats to see what NVMe is doing.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494255645612474369" itemprop="identifier"/><meta content="19" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T10:21:22.000Z" itemprop="dateCreated"/><meta content="2022-02-17T10:21:22.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494255645612474369" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494255642202484743" itemprop="isPartOf"/><div><article aria-labelledby="id__igmbru9afmk id__quulss3uh5n id__h0tupsve1qo id__zkawbk4k3bg id__w97d2yoha6p id__6fvl2ossfwe id__6ito7d6d17e id__d9y31leprhq id__g61l9367mo9 id__ppmy56aqlql id__urs1ou709z id__md7ytstxiwk id__yo568a1yhxb id__6xx0341kcvy" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__6fvl2ossfwe"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Artificially throttled ~30 IOPS without full cache flushes, I get 93.52 ops/s 397.77 KBytes/s disk IO, which is reasonable, and:

ANS2 RD                         : 0.328 MB/s
ANS2 WR                         : 0.399 MB/s

That&#39;s NVMe controller DRAM bandwidth. Reasonable.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494255649026625537" itemprop="identifier"/><meta content="20" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T10:21:23.000Z" itemprop="dateCreated"/><meta content="2022-02-17T10:21:23.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494255649026625537" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494255645612474369" itemprop="isPartOf"/><div><article aria-labelledby="id__76omdrzntaa id__a57yj0xcqdp id__da0kvrwiibd id__r8fhnwre3s id__fg0qgw7sxa7 id__oizmolo6ijk id__ceh1jrooexr id__mthk1a6it3i id__0swykcynv5h id__cxbxdd8mkrv id__fvpmxoxo1dt id__54j973tjkqj id__79xsl7mqj52 id__3p37tedmjy4" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__oizmolo6ijk"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>But doing flushes, this jumps to:

ANS2 RD                         : 6.248 MB/s
ANS2 WR                         : 9.909 MB/s

So that NVMe controller is doing *something* memory-intensive on flush commands. Maybe it does a linear scan over a large cache hashtable?</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494256049150640129" itemprop="identifier"/><meta content="21" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T10:22:58.000Z" itemprop="dateCreated"/><meta content="2022-02-17T10:22:58.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494256049150640129" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494255649026625537" itemprop="isPartOf"/><div><article aria-labelledby="id__3rlpdtu8cai id__lvn4hjoaebl id__btyx7qrt6rm id__mqfiansv2ph id__150z5ba2l6l id__r99cxt6asap id__4fr5lqk0ozl id__yhk86tbd1zg id__1qp5yj9xypk id__ikytiiuhl2o id__fxawzs4cc2 id__122t9zdef4i8 id__9treuqmqs85 id__9olzblw7fqv" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__r99cxt6asap"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>I can get these stats because the NVMe controller is integrated into the SoC and &#34;drive cache&#34; is just normal memory (it&#39;s unified just like GPU memory), and Apple have very good instrumentation of things like DRAM bandwidth utilization from different SoC agents.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494293060020506626" itemprop="identifier"/><meta content="22" itemprop="position"/><meta content="1" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T12:50:02.000Z" itemprop="dateCreated"/><meta content="2022-02-17T12:50:02.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494293060020506626" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494256049150640129" itemprop="isPartOf"/><div><article aria-labelledby="id__q16lzs83nxq id__jzdlh7sqqe id__cbv2k19y79h id__uroh3e9sn3e id__tdiwfdny9r id__kc437evecef id__zu3fx64lv2b id__8r87cvlp14j id__camtvwl8l8t id__0aqut68t7jqe id__cw6z86u8g5 id__i30ijjj7zoi id__gwrfgymspq id__sbeelwhfsbm" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__kc437evecef"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Uh, guys? I&#39;m not saying &#34;the machines are only fast because they cheat on data durability&#34;. I&#39;m saying there&#39;s a stupid, unfortunate performance bug when you *do* want durability that most people won&#39;t notice because macOS gives you poor durability by default.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494293064579686400" itemprop="identifier"/><meta content="23" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T12:50:03.000Z" itemprop="dateCreated"/><meta content="2022-02-17T12:50:03.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494293064579686400" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494293060020506626" itemprop="isPartOf"/><div><article aria-labelledby="id__0jilqvnky3fd id__c2bqgr7pqsc id__qk1f2a2zjve id__wkty0t2npx id__5q8duyeoveh id__zxidje7gbtp id__sbi8gez560a id__wa5kegrdaqm id__8bb1sgoo53v id__8spiecn1cw3 id__kftikgqdr6 id__npcyb08o1t id__pfhs13cic6f id__evg0gadeaqh" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__zxidje7gbtp"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>These SSDs are still fast for many use cases, and on laptops you don&#39;t care about this issue because there&#39;s a battery backup anyway.

And besides, Apple can almost certainly fix this in a firmware upgrade.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494293067771564040" itemprop="identifier"/><meta content="24" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T12:50:04.000Z" itemprop="dateCreated"/><meta content="2022-02-17T12:50:04.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494293067771564040" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494293064579686400" itemprop="isPartOf"/><div><article aria-labelledby="id__tkwvqf1db5k id__3jvwh411v4j id__79jiy1enl4b id__56j7rbuka7q id__54150iyjs1f id__cnqvx694gft id__rl8lyhmpk5c id__xdiekivv7sp id__rgogzk71aom id__ngypq7dpwz9 id__ltip9m363xn id__gzi2gv2f8is id__d0q2b60kb54 id__u4gs5d6oo5r" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__cnqvx694gft"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Chances are this happened because this design came from iDevices, where there&#39;s always a battery, so software will never hit drive cache related consistency/durability issues, so probably ~no iOS software ever uses a full sync, so nobody noticed it&#39;s slow.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494293071118614529" itemprop="identifier"/><meta content="25" itemprop="position"/><meta content="2" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T12:50:05.000Z" itemprop="dateCreated"/><meta content="2022-02-17T12:50:05.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494293071118614529" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494293067771564040" itemprop="isPartOf"/><div><article aria-labelledby="id__g56h61y13uw id__j30fzr92rt8 id__e7hj0orw50l id__2q0qcvts7fp id__9fla0egn07 id__jnkso4kz978 id__hvpr0nbyff4 id__5ho2cheoglp id__yjo6wt25do id__8zh9rxnjmel id__iatztmgf9fi id__50qvp4sw0rg id__8kbs3wwwnw4 id__xbs29uvy8m" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__jnkso4kz978"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>And I&#39;m just the Nth guy to facepalm when I found out that macOS makes data durability double-opt-in with a nonstandard request. That&#39;s dumb, but it has nothing to do with the machines. It&#39;s just the reason why fio was magically fast on macOS and not on Linux.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494293769134690305" itemprop="identifier"/><meta content="26" itemprop="position"/><meta content="5" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T12:52:51.000Z" itemprop="dateCreated"/><meta content="2022-02-17T12:52:51.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494293769134690305" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494293071118614529" itemprop="isPartOf"/><div><article aria-labelledby="id__b80xpu8si9 id__ah9pkfyqcwv id__hl6l4wde6un id__0ozaua3ht2i id__7p87drc5g46 id__ifyybeg72 id__4huo8bln1n5 id__wtluf3guj5g id__fe3x1db4ego id__sghujfg58fq id__s5puyutfqog id__j3bjoa9oxos id__10fubmeug5k9 id__sw8syd1bfdq" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__ifyybeg72"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Note that the NVMe controller behaves in a perfectly spec-compliant way as far as data durability. It&#39;s just (ridiculously) slow when you ask for it. Probably a bug.</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494307439906533376" itemprop="identifier"/><meta content="27" itemprop="position"/><meta content="3" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T13:47:11.000Z" itemprop="dateCreated"/><meta content="2022-02-17T13:47:11.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494307439906533376" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494293769134690305" itemprop="isPartOf"/><div><article aria-labelledby="id__4we009t39fc id__vapn6bdw3x id__4uvw6ewfi6u id__cu6uuaqpchv id__vry3g03c0wm id__3t8i9z9gkd6 id__gh5bt3iuhyc id__2e8uma6dpff id__a4rwjjr91np id__jm77va1zfm8 id__5yzs7kqe23u id__vgpz0r3b1ss id__k8ajkq9bmqi id__lhqccp8opwc" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__3t8i9z9gkd6"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>But since incessant people on HN made me do another test, and for giggles:

FAT32 on internal NVMe with F_FULLFSYNC: 58 IOPS
FAT32 on a cheapo USB3 flash drive with the same: 223 IOPS.

If you run a durable database on an M1 today, try a cheap flash drive. It&#39;ll be faster :-)</span></p></div></div></div></div></div></div></div></div></article></div></div></div><div><div itemprop="hasPart" itemscope="" itemtype="https://schema.org/SocialMediaPosting"><meta content="1494307794182631424" itemprop="identifier"/><meta content="28" itemprop="position"/><meta content="10" itemprop="commentCount"/><meta content="" itemprop="contentRating"/><meta content="2022-02-17T13:48:35.000Z" itemprop="dateCreated"/><meta content="2022-02-17T13:48:35.000Z" itemprop="datePublished"/><meta content="https://twitter.com/marcan42/status/1494307794182631424" itemprop="url"/><meta content="https://twitter.com/marcan42/status/1494307439906533376" itemprop="isPartOf"/><div><article aria-labelledby="id__mkto0xj35v id__3dlb4g5t02y id__l8hc0r95upb id__ihj2busx0xl id__c3mdptgqf3v id__0k3l3hq23agq id__ku8j0wmnwp id__1gc7pdprjj4 id__6ix5b3i7qzl id__guujmdp3q35 id__5yqcwh0uomu id__aiei821gkep id__czptl2ph495 id__tonpiovgtzr" role="article" data-testid="tweet"><div><div><div><div><div><div><div><div id="id__0k3l3hq23agq"><div><div><div><div><a href="https://paulbutler.org/marcan42" role="link"><div><div><div><div aria-label=""><p><img alt="" draggable="true" src="https://pbs.twimg.com/profile_images/642190731122114560/oXAYC93Z_400x400.png"/></p></div></div></div></div></a></div></div></div></div></div></div></div></div><div><div><div><div itemprop="articleBody"><p><span>Of course, the flash drive doesn&#39;t have a cache at all, so it remains at 223 IOPS with fsync() vs. 60000 IOPS or so on NVMe - so make sure you go with NVMe if you&#39;re on a laptop where it&#39;s safe, only use the cheapo drive on Mac Minis and iMacs! </span><span>ðŸ˜‡</span></p></div></div></div></div></div></div></div></div></article></div></div></div></div></div></section></div></div></div></div></div></div></div></div>
  </body>
</html>
