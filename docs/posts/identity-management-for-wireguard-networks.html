<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lwn.net/SubscriberLink/910766/7678f8c4ede60928/">Original</a>
    <h1>Identity management for WireGuard networks</h1>
    
    <div id="readability-page-1" class="page"><div>
<!-- $Id: slink-none,v 1.2 2005-11-04 22:11:18 corbet Exp $ -->
<blockquote>
<div>
<h3>Welcome to LWN.net</h3>
<p>
The following subscription-only content has been made available to you 
by an LWN subscriber.  Thousands of subscribers depend on LWN for the 
best news from the Linux and free software communities.  If you enjoy this 
article, please consider <a href="https://lwn.net/subscribe/">subscribing to LWN</a>.  Thank you
for visiting LWN.net!
</p></div>
</blockquote>

<p>Since its inclusion in the Linux kernel, the <a href="https://www.wireguard.com/">WireGuard VPN tunnel</a> has become
increasingly popular.  In general, WireGuard is simpler to configure than
other VPNs, but the approach that it takes to authentication can present
some challenges. Each node in a WireGuard network has a cryptographic key
that serves as the node&#39;s identity; 
nodes that do not know each other&#39;s keys cannot directly communicate.
Keeping
track of these keys and distributing them to the other nodes
in a mesh network quickly becomes a chore as the network grows.
Fortunately, there are now 
several open-source 
tools that can automate the management of these keys and make using
WireGuard easier for both administrators and end users.  </p>

<p>
Key management can be particularly challenging for non-technical end users,
who are used to logging into services with a username and password.  Thus,
the main feature that all of these tools have in common is that they
allow a user to log into a WireGuard network using a username and password
(and possibly a second factor, such as a one-time password).  This is usually
accomplished by integrating with an identity provider that implements the <a href="https://openid.net/connect/">OpenID Connect</a> (OIDC) standard.
OIDC is built on top of the <a href="https://oauth.net/2/">OAuthÂ 2.0</a> protocol and
can be used to implement the ubiquitous &#34;Sign in
with <em>Some Big Company</em>&#34; functionality seen on many web sites.  </p>

<p>Some of the software discussed in this article <em>requires</em> an
OIDC provider; there are several open-source options for people who
aren&#39;t already running their own and don&#39;t want to farm the task out to
some big company.  <a href="https://www.keycloak.org/">Keycloak</a> is one
of the most mature and popular choices and <a href="https://www.authelia.com/">Authelia</a> is an up-and-coming
alternative.  </p>

<h4>Tailscale</h4>

<p><a href="https://tailscale.com/">Tailscale</a> is a commercial service
that provides managed WireGuard networks.  When a network administrator
creates a new network on Tailscale, they must choose an identity provider;
they can choose to have their users sign in with Google, GitHub, Microsoft,
or any other provider that supports OIDC.  The
approach of connecting key management for WireGuard to an identity provider was
pioneered by Tailscale, and likely served as inspiration for the other
projects covered in this article.  </p>

<p>To connect to a Tailscale network, a user must install <a href="https://github.com/tailscale/tailscale">Tailscale&#39;s client
software</a>.  The client talks to Tailscale&#39;s API and manages WireGuard
interfaces on a user&#39;s device.  When a user connects to a Tailscale
network, the client generates a WireGuard key pair, and then submits the
public key to Tailscale&#39;s API.  The user is then directed to Tailscale&#39;s
web site, which sends them to a login page for the identity provider chosen
for the network.  After a user is logged in (and
after their device is approved, depending on how the administrator has
configured the network), their public key is made available to be retrieved
by the Tailscale clients running on the other nodes.  The
other clients add the new key to their WireGuard configurations, allowing
them to communicate with the new node.  </p>

<p>The Tailscale client is available for Linux, macOS, and Windows, as well
as iOS and Android.  The source of the command-line version of the
Tailscale client (which is written in Go) is released under the 3-clause BSD
license, as is the Android client. 
Unfortunately, the server
software is proprietary.  That&#39;s where <a href="https://github.com/juanfont/headscale">Headscale</a> comes in.  </p>

<h4>Headscale</h4>

<p>Headscale is an independent implementation of Tailscale&#39;s server-side
API; like the Tailscale client, it is written in Go.  Tailscale&#39;s
command-line interface (CLI) client has a 
<tt>--login-server</tt> flag that allows 
users to override the URL to the Tailscale API, which can be used to
connect the client to Headscale.  Despite Headscale&#39;s unofficial status,
Tailscale 
seems to be fully supportive of its efforts; Tailscale has <a href="https://twitter.com/juanfont/status/1507760973037322240">coordinated
with Headscale&#39;s creator</a> on API changes and <a href="https://tailscale.com/blog/opensource/">hired one of Headscale&#39;s
maintainers</a>.  On Android, changing the API URL was originally
accomplished by recompiling the client, but a <a href="https://github.com/tailscale/tailscale-android/pull/55">pull
request</a> that adds a hidden menu to Tailscale&#39;s official builds of the
client was recently merged.  Tailscale&#39;s Windows and macOS clients can also
be used with Headscale, but support for changing the API URL in the iOS
client is <a href="https://github.com/tailscale/tailscale/issues/2965">currently
incomplete</a>.  </p>

<p>The list of Tailscale features that Headscale doesn&#39;t support is
surprisingly short.  Headscale <a href="https://github.com/juanfont/headscale/issues/661">does not yet
support</a> Tailscale&#39;s <a href="https://tailscale.com/blog/tailscale-ssh/">SSH key-management
feature</a>.  Other than that, users of Headscale can enjoy most of
Tailscale&#39;s features, including <a href="https://tailscale.com/kb/1018/acls/">network-level access-control
lists</a> (ACLs), <a href="https://tailscale.com/kb/1081/magicdns/">DNS for
the VPN</a>, and use Tailscale&#39;s <a href="https://tailscale.com/blog/how-tailscale-works/#encrypted-tcp-relays-derp">NAT-traversal mechanism</a>.  </p>

<p>Headscale doesn&#39;t include a web-based administrative interface (although
a <a href="https://github.com/gurucomputing/headscale-ui">third-party
interface</a> is available); it is configured <a href="https://github.com/juanfont/headscale/blob/main/config-example.yaml">using
a YAML 
file</a>.  Headscale can be used with an OIDC provider, but it also
supports using an internal database of usernames and passwords; this could
be convenient for small setups or home labs that don&#39;t already have an
identity provider set up.  Unlike Tailscale&#39;s backend, the Headscale server
doesn&#39;t support multi-tenancy; each instance of Headscale can only play
host to a single network.  </p>

<p>Though it has close ties to the Tailscale proprietary service, Headscale
does 
enable 
creating a completely self-hosted WireGuard VPN using only open-source
software. The project&#39;s friendly relationship
with Tailscale bodes well for Headscale&#39;s continued usefulness.
Unless Tailscale&#39;s management has a sudden change of heart, it is
unlikely that Tailscale will make changes to its clients that make
them incompatible with Headscale, at least without coordinating with
the project.  
</p>

<h4>NetBird</h4>

<p><a href="https://netbird.io/">NetBird</a> is another commercial service
that provides managed WireGuard networks.  The <a href="https://netbird.io/docs/overview/architecture">architecture of
NetBird</a> is similar to that of Tailscale.  A client application (the
NetBird agent) generates keys for a node and submits the public key to a
management service.  The user is directed to an identity
provider to log in; after the user is logged in and their device is
authenticated, their public key is distributed to the other clients in the
network, which add the key to their WireGuard configurations.  NetBird
doesn&#39;t seem to have a built-in user database, and requires the use of an
OIDC provider; people that don&#39;t already have one running will have to
install and configure one before trying it.  </p>

<p>Unlike Tailscale, NetBird is fully open-source; the sources to both the
client and the server-side components are BSD-licensed and <a href="https://github.com/netbirdio/">available on GitHub</a>, although one
needs to <a href="https://cla-assistant.io/netbirdio/netbird">agree to a
Contributor License Agreement</a> (CLA) before contributing.  
Agreeing to the CLA grants NetBird the right to relicense contributions in
any way that it might choose; it also contains some additional language
about 
patent rights.  
There are
also <a href="https://netbird.io/docs/getting-started/self-hosting">instructions
for hosting your own NetBird server</a>.  
</p>

<p>
The NetBird server consists of the
management API service and a signaling server to help clients find each
other.  A dashboard is also included; unlike Headscale, the same web
interface is available to both users of the NetBird service and those who
are self-hosting NetBird.  Beyond that, NetBird also needs a 3rd-party <a href="https://en.wikipedia.org/wiki/STUN">STUN</a>/<a href="https://en.wikipedia.org/wiki/Traversal_Using_Relays_around_NAT">TURN</a>
server to assist with NAT traversal.  Instead of inventing a new protocol
like Tailscale did, NetBird&#39;s NAT-traversal functionality is based on the
<a href="https://webrtc.org/">WebRTC</a> standard.  </p>

<p>NetBird offers many features similar to those offered by Tailscale.
Like Tailscale, NetBird supports <a href="https://netbird.io/docs/overview/acls">network-level ACLs</a>, and it
also has an <a href="https://netbird.io/blog/ssh-without-the-hassle">SSH
key-management</a> feature.  
NetBird doesn&#39;t currently have all of the DNS functionality that Tailscale
does, and its client is currently only available for desktop platforms. 
Mobile clients and private DNS for the VPN are both listed as &#34;coming soon&#34;
in the <a href="https://github.com/netbirdio/netbird#readme">project&#39;s
<tt>README</tt></a>, though.
</p>

<p>It&#39;s not quite at parity with all of Tailscale&#39;s features, but NetBird
largely replicates the core functionality of Tailscale&#39;s product, without
any proprietary software.  It has yet to achieve the same level of
popularity as Tailscale or to build the kind of community that Headscale has,
though; its core contributors are all NetBird employees.  Compared to
Tailscale, more of NetBird&#39;s software is open source, but the fate of that
software is likely to be tied to that of NetBird&#39;s business endeavors.
</p>

<h4>Firezone</h4>

<p><a href="https://www.firezone.dev/">Firezone</a> is a another company
that aims to provide managed WireGuard networks, although its hosted
offering doesn&#39;t appear to have actually launched yet; the <a href="https://www.firezone.dev/pricing">pricing page</a> is scant on
details and the <a href="https://docs.firezone.dev/">documentation</a>
features a &#34;<a href="https://e04kusl9oz5.typeform.com/to/gzzaZZ52#source=docsheader">Join
the Beta</a>&#34; link at the top of the page.  
</p>

<p>
Firezone is written in <a href="https://elixir-lang.org">Elixir</a>.
Its <a href="https://github.com/firezone/firezone">source code</a> is
available now under an ApacheÂ 2.0 license; <a href="https://github.com/firezone/firezone/blob/master/CONTRIBUTING.md">contributions</a>
do not appear to require a CLA. 
<a href="https://docs.firezone.dev/deploy">Instructions for self-hosting
Firezone</a> are provided in the documentation.  Like Headscale, Firezone
can <a href="https://docs.firezone.dev/authenticate">authenticate users using an
OIDC provider</a> or a 
built-in user database.  </p>

<p>Firezone does not (yet?) provide any sort of client software.  Instead,
users generate WireGuard keys for themselves, and then <a href="https://docs.firezone.dev/user-guides/add-devices">upload them to
Firezone&#39;s web interface</a>.  Users can then <a href="https://docs.firezone.dev/user-guides/client-instructions">download a
configuration for the standard WireGuard client</a> from the web interface.
Firezone allows <a href="https://docs.firezone.dev/user-guides/egress-rules">filtering traffic
between nodes</a> but doesn&#39;t include any additional features like DNS
or SSH key-management.  No NAT-traversal methods are mentioned in the
documentation; without assistance from NAT traversal, WireGuard nodes that
are behind NAT may have trouble connecting to the VPN depending on the
network configuration.</p>

<p>It&#39;s hard to tell if Firezone is intentionally minimal, or if it&#39;s still
just early in its development; there is no public roadmap that I could
find.  The project&#39;s commit history starts a little over a year ago, and
the vast majority of the commits are attributed to the company&#39;s founder.
In its current state, it could be appealing to someone who is already
comfortable managing their own WireGuard networks and is just looking for
integration with an OIDC provider.  </p>

<h4>Netmaker</h4>

<p><a href="https://www.netmaker.org/">Netmaker</a> is yet another provider
of managed WireGuard networks.  
Like Tailscale, Headscale, and NetBird, Netmaker&#39;s software is written in Go.
<a href="https://github.com/gravitl/netmaker">The source</a> is
available under the <a href="https://en.wikipedia.org/wiki/Server_Side_Public_License">Server Side
Public License</a> (SSPL).  Instructions for <a href="https://netmaker.readthedocs.io/en/master/quick-start.html">self-hosting
Netmaker</a> are available, but the license implies that the creators of
Netmaker would prefer that you not attempt to make a business of it.
</p>

<p>
The
SSPL is similar to the <a href="https://en.wikipedia.org/wiki/GNU_Affero_General_Public_License">GNU
Affero GPL license</a> in that it requires source code to be made available to
any user who interacts with a service over the network, but contains
additional language that requires the source of any components that are
used to manage the service to be released under the SSPL as well.
The SSPL is designed to protect the business interests of
companies that release software under it.
The additional restrictions that it imposes make it legally
unpalatable for other companies to offer the software as a service;
according to the Open Source Initiative, it is <a href="https://opensource.org/node/1099">not an open-source 
license</a>.
Like NetBird, Netmaker also requires contributors to <a href="https://cla-assistant.io/gravitl/netmaker">agree to a CLA</a>, which
grants patent rights and allows Netmaker to relicense the contribution.  </p>

<p>Based on the release notes for the earliest versions of Netmaker, it
doesn&#39;t look like the authors set out with the intention of building a
competitor to Tailscale.  Instead, it was originally built for <a href="https://k8s.netmaker.org/">use with Kubernetes</a>, and this use case
is still supported.  Netmaker uses WireGuard to enable
building Kubernetes clusters that span multiple data centers and to
securely connect 
clusters to external services and clients.  </p>

<p>More recent versions of Netmaker have become more like Tailscale.
Originally, Netmaker&#39;s client software authenticated to the API using a
pre-shared key; this makes sense for automatically-deployed virtual
machines and cloud instances but isn&#39;t suitable for end users.  Netmaker
still supports this method of authentication, but more recent versions also
support <a href="https://netmaker.readthedocs.io/en/master/netclient.html#joining-a-network">logging
in with a username and password</a>, using either a built-in user database
or <a href="https://netmaker.readthedocs.io/en/master/oauth.html">via an OIDC
provider</a>.  Netmaker also supports <a href="https://netmaker.readthedocs.io/en/master/acls.html">access-control
lists</a>; earlier versions included a DNS server, but more recent versions
have switched to <a href="https://netmaker.readthedocs.io/en/master/architecture.html?highlight=hosts#coredns">adding
VPN hostnames to <tt>/etc/hosts</tt></a> instead.  Like Firezone, no
NAT-traversal methods are mentioned in the documentation.  </p>

<p>Netmaker appears to have attracted more community contributions than
NetBird or Firezone, but its development is still primarily
employee-driven.  Its origin in the world of Kubernetes is still readily
apparent; prospective users can choose from <a href="https://netmaker.readthedocs.io/en/master/install.html">multiple
deployment options</a> and the <a href="https://netmaker.readthedocs.io/en/master/server-installation.html">advanced
server installation</a> guide presents a vast array of ways in which an
installation of Netmaker can be customized.  Netmaker&#39;s <a href="https://netmaker.readthedocs.io/en/master/netclient.html">client
software</a> runs on Linux, macOS, and Windows, as well as FreeBSD, but it
only offers a command-line interface at the moment.  Networking experts and
people who are already running their own Kubernetes clusters will likely be
happy and comfortable with Netmaker, but people looking for a VPN that is
easy for non-technical users might want to look elsewhere.  </p>

<h4>Conclusion</h4>

<p>For someone who wants to build a self-hosted WireGuard VPN for possibly
non-technical end users, Headscale (in combination with Tailscale&#39;s client
software) is the most complete solution, and the only solution if being
able to connect mobile phones to the network is a requirement.  If relying
on Tailscale&#39;s clients is a non-starter, NetBird provides a similar
experience to users, but NetBird doesn&#39;t have mobile clients yet.  Firezone
looks to be off to a promising start, but it still has a lot of catching up
to do relative to Headscale and NetBird; its complete lack of client
software still puts a lot of the work of managing WireGuard configurations
on the user.  Meanwhile, Netmaker&#39;s end-user experience is unpolished,
but its other use cases might make it  interesting to people managing
Kubernetes clusters or other large deployments of virtual machines.  </p>

<p>Despite its close association with Tailscale and dependence on its
clients, Headscale is the only truly community-driven project of the bunch.
All of the other solutions are open source (or, depending on how you feel
about the SSPL, source available), but they are all built by venture-backed
companies.  Given the relative lack of community contributions, these
projects may not have much of a future if the companies associated with
them are unable to find their way to commercial success.  </p></div></div>
  </body>
</html>
