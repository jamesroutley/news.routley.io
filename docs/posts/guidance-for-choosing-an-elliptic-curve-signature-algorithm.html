<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://soatok.blog/2022/05/19/guidance-for-choosing-an-elliptic-curve-signature-algorithm-in-2022/">Original</a>
    <h1>Guidance for Choosing an Elliptic Curve Signature Algorithm</h1>
    
    <div id="readability-page-1" class="page"><div>

		<div>

			
<p>Earlier this year, <a href="https://cendyne.dev">Cendyne</a> published <em><a href="https://cendyne.dev/posts/2022-03-06-ed25519-signatures.html">A Deep Dive into Ed25519 Signatures</a></em>, which covered some of the different types of digital signature algorithms, but mostly delved into the Ed25519 algorithm. Truth in advertising.</p>



<p>This got me thinking, “Why isn’t there a better comparison of different elliptic curve signature algorithms available online?”</p>





<p>Most people just defer to <a href="https://safecurves.cr.yp.to/">SafeCurves</a>, but it’s a little dated: We have <a href="https://eprint.iacr.org/2015/1060">complete addition formulas for Weierstrass curves</a> now, but SafeCurves doesn’t reflect that.</p>



<p>For the purpose of simplicity, I’m not going to focus on a general treatment of Elliptic Curve Cryptography (ECC), which includes pairing-based cryptography, Elliptic-Curve Diffie-Hellman, and (arguably) isogeny cryptography.</p>



<p>Instead, I’m going to focus entirely on elliptic curve digital signature algorithms.</p>



<p><strong>Note: </strong>The content of this post is a bit lower-level than most programmers ever need to be concerned with. If you’re a programmer and interested in learning cryptography, <a href="https://soatok.blog/2020/06/10/how-to-learn-cryptography-as-a-programmer/">start here</a>. If you’re looking for library recommendations, <a href="https://doc.libsodium.org/">libsodium</a> is a good safe default.</p>



<h2 id="compliance">Compliance Rules Everything Around Me</h2>



<p>If you have to meet some arbitrary compliance requirements (i.e. FIPS 140-3, CNSA, etc.), your decision is already made for you, and you shouldn’t waste your time reading blogs like this that will only get your hopes up about the options available to you.</p>



<p>Choose the option your compliance officer demands, and hope it’s good enough.</p>


<div>
<figure><img data-attachment-id="3102" data-permalink="https://soatok.blog/soatok-telegrams-wave-3-commission-11/" data-orig-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2021/04/soatok-telegrams-wave-3-commission-11.png?fit=512%2C512&amp;ssl=1" data-orig-size="512,512" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="Soatok Telegrams Wave 3 Commission-11" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2021/04/soatok-telegrams-wave-3-commission-11.png?fit=300%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2021/04/soatok-telegrams-wave-3-commission-11.png?fit=512%2C512&amp;ssl=1" loading="lazy" src="https://i0.wp.com/soatok.blog/wp-content/uploads/2021/04/soatok-telegrams-wave-3-commission-11.png?resize=256%2C256&amp;ssl=1" alt="" width="256" height="256" data-recalc-dims="1" data-lazy-src="https://i0.wp.com/soatok.blog/wp-content/uploads/2021/04/soatok-telegrams-wave-3-commission-11.png?resize=256%2C256&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/><figcaption>“Sure, let me check that box.”</figcaption></figure></div>


<h2>Elliptic Curves for Signature Algorithms</h2>



<p>Let’s start with the same curve Cendyne analyzed: Ed25519.</p>



<h3 id="ed25519">Ed25519 (EdDSA, Curve25519)</h3>



<p>Ed25519 is one of the two digital signature algorithms today that use the EdDSA algorithm framework. The other is Ed448, which targets a higher security level (224-bit vs 128-bit) but is also slower and uses SHAKE256 (which is overkill and not great for performance).</p>



<p>Ed25519 is a <strong>safe default choice</strong> for most applications where a digital signature is appropriate, for many reasons:</p>



<ol><li>Ed25519 uses <strong>deterministic nonces</strong>, which means you’re severely unlikely to ever reproduce <a href="https://arstechnica.com/gaming/2010/12/ps3-hacked-through-poor-implementation-of-cryptography/">the Sony ECDSA k-reuse bug</a> in your system.</li><li>Ed25519 includes the public key in the data hashed to produce the signature (more specifically s from the (R,s) pair). This offers a property that ECDSA lacks: <strong>Exclusive Ownership</strong>. I’ve <a href="https://soatok.blog/2021/08/16/lightning-round/#commitments">written about this property before</a>.</li></ol>



<p>Years ago, there would have an additional list item: Ed25519 uses Edward Curves, which have complete addition formulas and are therefore safer to implement in constant-time than Weierstrass curves (i.e. the NIST curves). However, we now have complete addition formulas for Weierstrass curves, so this has become a moot point (assuming your implementation <em>uses</em> complete addition formulas).</p>



<p>Ed25519 targets the <strong>128-bit security level</strong>.</p>



<h4>Why Not Use Ed25519?</h4>



<p>There is one minor pitfall of Ed25519 that makes it unsuitable for esoteric uses (say, Ring Signature Schemes or zero-knowledge proofs): Ed25519 is not a prime-order group; it has a cofactor h = 8. This detail famously created <a href="https://moderncrypto.org/mail-archive/curves/2017/000898.html">a double-spend vulnerability in all CryptoNote-based cryptocurrencies (including Monero)</a>.</p>



<p>For systems that want the security of Ed25519 and its various well-studied implementations, but still need a prime-order group for their protocol, cryptographers have developed <a href="https://ristretto.group/why_ristretto.html">the Ristretto Group</a> to meet your needs.</p>



<p>If you’re working on embedded systems, the determinism inherent to EdDSA might be undesirable due to <a href="https://research.kudelskisecurity.com/2017/10/04/defeating-eddsa-with-faults/">the possibility of fault attacks</a>. You can use a <a href="https://soatok.blog/2020/05/03/hedged-signatures-with-libsodium-using-dhole/">hedged variant of Ed25519</a> to mitigate this risk.</p>



<p>Additionally, Ed25519 is not approved for many government applications, although it did make <a href="https://csrc.nist.gov/publications/detail/fips/186/5/draft">the latest draft revision of FIPS 186 in 2019</a>. If you care about compliance (see above), you cannot use Ed25519. Yet.</p>


<div>
<figure><img data-attachment-id="5912" data-permalink="https://soatok.blog/2022/05/19/guidance-for-choosing-an-elliptic-curve-signature-algorithm-in-2022/fips/" data-orig-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/fips.jpg?fit=552%2C500&amp;ssl=1" data-orig-size="552,500" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="fips" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/fips.jpg?fit=300%2C272&amp;ssl=1" data-large-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/fips.jpg?fit=552%2C500&amp;ssl=1" loading="lazy" width="552" height="500" src="https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/fips.jpg?resize=552%2C500&amp;ssl=1" alt="" data-recalc-dims="1" data-lazy-srcset="https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/fips.jpg?w=552&amp;ssl=1 552w, https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/fips.jpg?resize=300%2C272&amp;ssl=1 300w" data-lazy-sizes="(max-width: 552px) 100vw, 552px" data-lazy-src="https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/fips.jpg?resize=552%2C500&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/><figcaption>A niche Internet meme for cryptography engineers</figcaption></figure></div>


<h4>Guidance for Ed25519</h4>



<p>Unless legally prohibited, Ed25519 should be your default choice, unless you need a prime-order group. In that case, build your desired protocol atop Ristretto255.</p>



<p>If you’re not sure if you need a prime-order group, you probably don’t. It’s a specialized requirement for uncommon use cases (ring signatures, password authenticated key exchange protocols, zero-knowledge proofs, etc.).</p>





<h3 id="secp256k1">The Bitcoin Curve (ECDSA, secp256k1)</h3>



<p>Secp256k1 is a Koblitz curve, which is <a href="https://crypto.stackexchange.com/a/58507">a special case of Weierstrass curves that are more performant when used in binary fields</a>, of the form, <img src="https://s0.wp.com/latex.php?latex=y%5E2%3Dx%5E3+%2B+7&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="y^2=x^3 + 7" data-lazy-src="https://s0.wp.com/latex.php?latex=y%5E2%3Dx%5E3+%2B+7&amp;is-pending-load=1#038;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/>. This curve is almost exclusively used in cryptocurrency software.</p>



<p>There is no specified reason why Bitcoin chose secp256k1 over another elliptic curve at the time of its inception, but we can speculate:</p>



<p>The author was a pseudonymous contributor to the Metzdowd mailing list for cypherpunks, and probably didn’t trust the NIST curves. Since Ed25519 didn’t exist at the time, the only obvious choice for a hipster elliptic curve parameter selection was to rely on <a href="https://www.secg.org/sec2-v2.pdf">the SECG recommendations</a>, which specify the NIST and Koblitz curves. If you cross the NIST curves off the list, only the Koblitz curves remained.</p>



<p>Therefore, the selection of secp256k1 is likely an artefact of computer history and not a compelling reason to select secp256k1 in new designs. Please look elsewhere.</p>


<div>
<figure><img data-attachment-id="5932" data-permalink="https://soatok.blog/2022/05/19/guidance-for-choosing-an-elliptic-curve-signature-algorithm-in-2022/avoid-secp256k1/" data-orig-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/avoid-secp256k1.jpg?fit=500%2C500&amp;ssl=1" data-orig-size="500,500" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="avoid-secp256k1" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/avoid-secp256k1.jpg?fit=300%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/avoid-secp256k1.jpg?fit=500%2C500&amp;ssl=1" loading="lazy" width="500" height="500" src="https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/avoid-secp256k1.jpg?resize=500%2C500&amp;ssl=1" alt="" data-recalc-dims="1" data-lazy-srcset="https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/avoid-secp256k1.jpg?w=500&amp;ssl=1 500w, https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/avoid-secp256k1.jpg?resize=300%2C300&amp;ssl=1 300w, https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/avoid-secp256k1.jpg?resize=150%2C150&amp;ssl=1 150w, https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/avoid-secp256k1.jpg?resize=400%2C400&amp;ssl=1 400w, https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/avoid-secp256k1.jpg?resize=200%2C200&amp;ssl=1 200w" data-lazy-sizes="(max-width: 500px) 100vw, 500px" data-lazy-src="https://i0.wp.com/soatok.blog/wp-content/uploads/2022/05/avoid-secp256k1.jpg?resize=500%2C500&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/><figcaption>Fact: Imgflip didn’t have a single secp256k1 meme until I made this one.</figcaption></figure></div>


<p>Secp256k1 targets the <strong>128-bit security level</strong>.</p>



<h4>Guidance for secp256k1</h4>



<p>Don’t bother, there are better options. (i.e. <a href="#ed25519">Ed25519</a>)</p>



<p>If you’re writing software for a cryptocurrency-related project, and you feel compelled to use secp256k1 for the sake of reducing your code footprint, please strongly consider the option of <a href="https://www.currentaffairs.org/2022/05/why-this-computer-scientist-says-all-cryptocurrency-should-die-in-a-fire">burning everything to the proverbial ground</a>.</p>


<div>
<figure><img data-attachment-id="130" data-permalink="https://soatok.blog/computeranger/" data-orig-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/04/computeranger.png?fit=224%2C224&amp;ssl=1" data-orig-size="224,224" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="This is outrageous!" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/04/computeranger.png?fit=224%2C224&amp;ssl=1" data-large-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/04/computeranger.png?fit=224%2C224&amp;ssl=1" loading="lazy" width="224" height="224" src="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/04/computeranger.png?resize=224%2C224&amp;ssl=1" alt="Soatok angrily grasping computer monitor" data-recalc-dims="1" data-lazy-src="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/04/computeranger.png?resize=224%2C224&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/><figcaption>Cryptocurrency sucks!</figcaption></figure></div>


<h4 id="secp256k1-beyond-cybercash">Cryptocurrency Aside, Why Avoid Secp256k1?</h4>



<p>As we noted above, secp256k1 isn’t widely used outside of cryptocurrency.</p>



<p>As a direct consequence of this (as we’ll discuss in <a href="#secp256r1">the NIST P-256 section</a>), most cryptography libraries don’t offer optimized, side-channel-resistant implementations of secp256k1; even if they do offer optimized implementations of NIST P-256.</p>



<p>Therefore, any secp256k1 library for most programming languages that <em>isn’t</em> an FFI wrapper for <a href="https://github.com/bitcoin-core/secp256k1">libsecp256k1</a> will have worse performance than the other 256-bit curves.</p>



<figure><div>
<blockquote data-width="550" data-dnt="true"><p lang="en" dir="ltr">tl;dr: ECDSA/secp256k1 is 3.3x slower at signing, 2.3x slower at verification even with endo than dalek Ed25519 with AVX2</p>— Tony &#34;Abolish ICE&#34; Arcieri 🦀🌹 (@bascule) <a href="https://twitter.com/bascule/status/1320183684935290882?ref_src=twsrc%5Etfw">October 25, 2020</a></blockquote>
</div></figure>



<p>Additionally, <a href="https://arstechnica.com/information-technology/2016/03/new-attack-steals-secret-crypto-keys-from-android-and-ios-phones/">secp256k1 implementations are often a source of exploitable side-channels</a> that permit attackers to pilfer your secret keys.</p>



<p>The previously linked article was about BouncyCastle’s implementation (which covers Java and .NET), but there’s still plenty of secp256k1 implementations that don’t FFI libsecp256k1.</p>



<p>From a quick Google Search:</p>



<ul><li><a href="https://github.com/ethereum/py_ecc/blob/a1d18addb439d7659a9cbac861bf1518371f0afd/py_ecc/secp256k1/secp256k1.py">Python</a> (uses EEA rather than Binary GCD for modular inverse)</li><li><a href="https://github.com/haltingstate/secp256k1-go/blob/572209b26df66a638573023571b5ce80983214eb/secp256k1-go2/sig.go#L86-L131">Go</a> (uses Numbers, which weren’t designed for cryptography)</li><li><a href="https://github.com/phpecc/phpecc/pull/281">PHP</a> (uses GMP, which isn’t constant-time)</li><li><a href="https://github.com/bitchan/eccrypto/blob/master/browser.js">JavaScript</a> (calls <a href="https://github.com/indutny/elliptic/blob/43ac7f230069bd1575e1e4a58394a512303ba803/lib/elliptic/ec/index.js#L121-L154">here</a>, which uses <a href="https://github.com/indutny/bn.js/blob/db57519421f0c47c9f68c05fa6fc12273dcca2c2/lib/bn.js#L2682-L2745">bn.js</a>, which isn’t constant-time)</li></ul>



<p>If you’re using secp256k1, and you’re not basing your choice on cybercash-interop, you’re playing with fire at the implementation and ecosystem levels–even if there are no security problems with the Koblitz curve itself.</p>



<p>You are much better off choosing any different curve than secp256k1 if you don’t have a Bitcoin/Ethereum/etc. interoperability requirement.</p>


<div>
<figure><img data-attachment-id="3097" data-permalink="https://soatok.blog/soatoktelegramswave3-07/" data-orig-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2021/04/soatoktelegramswave3-07.png?fit=512%2C512&amp;ssl=1" data-orig-size="512,512" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="SoatokTelegramsWave3-07" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2021/04/soatoktelegramswave3-07.png?fit=300%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2021/04/soatoktelegramswave3-07.png?fit=512%2C512&amp;ssl=1" loading="lazy" src="https://i0.wp.com/soatok.blog/wp-content/uploads/2021/04/soatoktelegramswave3-07.png?resize=256%2C256&amp;ssl=1" alt="" width="256" height="256" data-recalc-dims="1" data-lazy-src="https://i0.wp.com/soatok.blog/wp-content/uploads/2021/04/soatoktelegramswave3-07.png?resize=256%2C256&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/><figcaption>“No thanks, I use Ed25519.”</figcaption></figure></div>


<h3 id="secp256r1">NIST P-256 (ECDSA, secp256r1)</h3>



<p>NIST P-256 is the go-to curve to use with ECDSA in the modern era. Unlike Ed25519, P-256 uses a prime-order group, and is an approved algorithm to use in FIPS-validated modules.</p>



<p>Most cryptography libraries offer optimized assembly implementations of NIST P-256, which makes it less likely that your signing operations will leak timing information or become a significant performance bottleneck.</p>



<p>P-256 targets the <strong>128-bit security level</strong>.</p>



<h4>Why Not Use P-256?</h4>



<p>Once upon a time, P-256 was riskier than Ed25519 (for signatures) and X25519 (for Diffie-Hellman), due to the incomplete addition formulas that led to timing-leaky implementations.</p>



<p>If you’re running old software, you may still be vulnerable to timing attacks that can recover your ECDSA secret key. However, there is a good chance that you’re on a modern and secure implementation in 2022, especially if you’re outsourcing this to OpenSSL or its derivatives.</p>



<p>ECDSA requires a secure randomness source to sign data. If you don’t have one available, and you sign anything, you’re coughing up your secret key to any attacker capable of observing multiple signatures.</p>



<h4>Guidance for P-256</h4>



<p>P-256 is an acceptable choice, especially if you’re forced to cope with FIPS and/or the <a href="https://en.wikipedia.org/wiki/Commercial_National_Security_Algorithm_Suite">CNSA suite</a> requirements when using cryptography.</p>



<p>Of course, if you can get away with Ed25519, use Ed25519 instead.</p>



<p>If you use P-256, make sure you’re using it with SHA-256. Some implementations may default to something weaker (e.g. SHA-1).</p>



<p>If you’re also going to be performing ECDH with P-256, make sure you use compressed points. There used to be a patent; it died in 2018.</p>



<p>If you can afford it, make sure you use deterministic ECDSA (<a href="https://datatracker.ietf.org/doc/html/rfc6979">RFC 6979</a>) or <a href="https://soatok.blog/2020/05/03/hedged-signatures-with-libsodium-using-dhole/">hedged signatures</a> (if fault attacks are relevant to your threat model). </p>





<h3 id="secp384r1">NIST P-384 (ECDSA, secp384r1)</h3>



<p>NIST P-384 has a larger field than the curves we’ve previously examined, which allows P-384 to target the <strong>192-bit security level</strong>. That’s the primary reason why anyone would choose P-384.</p>



<p>Naturally, elliptic curve security is more complicated than merely security against the Elliptic Curve Discrete Logarithm Problem (ECDLP).</p>



<p>P-384 is most often paired with SHA-384, which is the most widely used flavor of the SHA-2 family hash functions that isn’t susceptible to <a href="https://soatok.blog/2020/10/06/dead-ends-in-cryptanalysis-1-length-extension-attacks/">length-extension attacks</a>. (There are also truncated SHA-512 variants specified later, but that’s also what SHA-384 is under-the-hood.)</p>



<p>If you’re aiming to build a “secure-by-default” tool for a system that the US government might one day become a customer of, with minimal cryptographic primitive choice, using NIST P-384 with SHA-384 makes for a reasonably minimalistic bundle.</p>



<h4>Why Not Use P-384?</h4>



<p>Unlike P-256, most P-384 implementations don’t use constant-time, optimized, and/or formally verified assembly code. (Notable counter-examples: <a href="https://github.com/awslabs/aws-lc#formal-verification">AWS-LC</a> and <a href="https://github.com/golang/go/commit/93bab8a2f918afa8417f7b46da69c21d643de880">Go x/crypto</a>.)</p>



<p>Like P-256, P-384 also requires a secure randomness source to sign data. If you aren’t providing one, expect your signing key to end up on fail0verflow one day.</p>



<h4>Guidance for P-384</h4>



<p>If you use P-384, make sure you’re using it with SHA-384.</p>



<p>The standard NIST curve advice of RFC 6979 and point compression and/or hedged signatures applies here too.</p>





<h3 id="secp521r1">NIST P-521 (ECDSA, secp521r1)</h3>



<p><strong>Biggest curve is best curve!</strong> — the clueless</p>



<figure><p><span><iframe loading="lazy" width="580" height="327" src="https://www.youtube.com/embed/i_APoSfCYwU?version=3&amp;rel=1&amp;showsearch=0&amp;showinfo=1&amp;iv_load_policy=1&amp;fs=1&amp;hl=en-US&amp;autohide=2&amp;wmode=transparent" allowfullscreen="true" sandbox="allow-scripts allow-same-origin allow-popups allow-presentation"></iframe></span>
</p></figure>



<p>Systems that choose P-521 often have an interesting threat model, even though said threat model is rarely formally specified.</p>



<p>It’s overwhelmingly likely that what eventually breaks the 256-bit elliptic curves will also break P-521 in short order: Cryptography Relevant Quantum Computers.</p>



<p>The only thing P-521 does against CRQCs that P-256 doesn’t is require more quantum memory. If you’re worried about QRQCs, you might want to look into <a href="https://soatok.blog/2022/01/27/the-controversy-surrounding-hybrid-cryptography/">hybrid post-quantum signature schemes</a>.</p>



<p>If you’re choosing P-521 in your designs, you’re basically saying, “I want to have 256 bits of asymmetric cryptographic security, come hell or high water!” even though the 128-bit security level is likely just fine for your actual threats.</p>



<h4>Aside: P-521 and 512-bit ECC Security</h4>



<p>P-521 is not a typo, although people sometimes think it is. P-521 uses the Mersenne prime <img src="https://s0.wp.com/latex.php?latex=2%5E%7B521%7D-1&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{521}-1" data-lazy-src="https://s0.wp.com/latex.php?latex=2%5E%7B521%7D-1&amp;is-pending-load=1#038;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/> instead of a 512-bit near-Mersenne prime.</p>



<p>This has led to an unfortunate trend in cryptography media to map ECC key sizes to symmetric security levels that misleads people as to the relationship between the two. For example:</p>







<p>Regrettably, this is misleading, because plotting the ECC Key Size versus equivalent Symmetric Security isn’t a how ECDLP security works. The ratio of the exponents involved is totally linear; it doesn’t suddenly increase beyond 384-bit curves for a mysterious mathematical reason.</p>



<ul><li>256-bit Curves target the 128-bit security level</li><li>384-bit Curves target the 192-bit security level</li><li>512-bit Curves target the 256-bit security level</li><li>521-bit Curves actually target the 260-bit security level, but that meets or exceeds the 256-bit security level, so that’s how the standards are interpreted</li></ul>



<p>The reason for this boils down entirely to the best attack against the Elliptic Curve Discrete Logarithm Problem: Pollard’s Rho, which recovers the secret key from an <img src="https://s0.wp.com/latex.php?latex=n&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="n" data-lazy-src="https://s0.wp.com/latex.php?latex=n&amp;is-pending-load=1#038;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/>-bit public key (which has a <img src="https://s0.wp.com/latex.php?latex=2%5E%7Bn%7D&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{n}" data-lazy-src="https://s0.wp.com/latex.php?latex=2%5E%7Bn%7D&amp;is-pending-load=1#038;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/> search space) in <img src="https://s0.wp.com/latex.php?latex=%5Csqrt%7B2%5E%7Bn%7D%7D&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="\sqrt{2^{n}}" data-lazy-src="https://s0.wp.com/latex.php?latex=%5Csqrt%7B2%5E%7Bn%7D%7D&amp;is-pending-load=1#038;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/> guesses.</p>



<p>Taking the square root of a number is the same as halving its exponent, so the security level is half: <img src="https://s0.wp.com/latex.php?latex=%5Csqrt%7B2%5E%7Bn%7D%7D+%3D+2%5E%7Bn%2F2%7D&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="\sqrt{2^{n}} = 2^{n/2}" data-lazy-src="https://s0.wp.com/latex.php?latex=%5Csqrt%7B2%5E%7Bn%7D%7D+%3D+2%5E%7Bn%2F2%7D&amp;is-pending-load=1#038;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/>.</p>



<p>Takeaway: If someone tells you that you need a 521-bit curve to meet the 256-bit security level, they are mistaken and it’s not their fault.</p>





<h4>Why Not Use P-521?</h4>



<p>It’s slow. Much slower than P-256 and Ed25519. Modestly slower than P-384.</p>



<p>Unlike P-384, you’re less likely to find an optimized, constant-time P-521 implementation.</p>



<h4>Guidance for P-521</h4>



<p>First, make a concerted effort to figure out the motivation for P-521 in your designs. Chances are, someone is putting too much emphasis on the wrong things for security.</p>



<p>If you use P-521, make sure you’re using it with SHA-512.</p>



<p>The standard NIST curve advice of RFC 6979 and point compression and/or hedged signatures applies here too.</p>





<h3 id="ed448">Ed448 (EdDSA, Curve448)</h3>



<p>Ed448 is the P-521 of the Edwards curves: It mostly exists to give standards committees a psychological comfort for the unlikely event that 256-bit ECC is desperately broken but ECC larger than 384 bits is somehow still safe.</p>



<figure></figure>



<p>The very concept of having multiple “security levels” for raw cryptography primitives is mostly an artefact of the historical military roots of cryptography, rather than a serious consideration in the modern world. </p>



<p>Unfortunately, this leads to implementations that prioritize runtime algorithm selection negotiation, which maximizes the risk of protocol-level vulnerabilities. See also: <a href="https://www.howmanydayssinceajwtalgnonevuln.com/">JWT</a>.</p>



<p>Ed448 was specified to use SHAKE256, which is a needlessly conservative decision which leads to an unnecessary performance bottleneck.</p>



<h4>Why Not Use Ed448?</h4>



<p>Aside from the performance hit mentioned previously, there’s no compelling reason to avoid Ed448 that isn’t also true of either Ed25519 or P-384.</p>



<h4>Guidance for Ed448</h4>



<p>If you want more speed, go with Ed25519. In addition to being faster, Ed25519 is also <a href="https://ianix.com/pub/ed25519-deployment.html">very widely supported</a>.</p>



<p>If you need a prime-order field, use Decaf with Ed448 or consider P-384.</p>



<h3 id="brainpool">The Brainpool Curves</h3>



<p>The main motivation for the Brainpool curves is that the NIST curves were not generated in a <a href="https://datatracker.ietf.org/doc/html/rfc5639">“verifiable pseudo-random way”</a>.</p>



<p>The only reasons you’d ever want to support the Brainpool curves include:</p>



<ol><li>You think the NIST curves are somehow backdoored by the NSA</li><li>You don’t appreciate small attack surfaces in cryptography libraries</li><li>The German government told you to (see: <a href="#compliance">compliance</a>)</li></ol>



<p>Most of the advice for the NIST Curves at each security level can be copy/pasted for the Brainpool curves, with one important caveat:</p>



<p>When considering real-world implementations, Brainpool curves are more likely to use the general purpose Big Number procedures (<a href="https://soatok.blog/2020/08/27/soatoks-guide-to-side-channel-attacks/#modular-inversion">which aren’t always constant-time</a>), rather than optimized assembly code, than the NIST curves are.</p>



<p>Therefore, my general guidance for the Brainpool curves is simply:</p>



<ol><li>Proceed at your own peril</li><li>Consider hiring a cryptography engineer to study the implementation you’re relying on, especially with regard to timing attacks</li></ol>


<div>
<figure><img data-attachment-id="1201" data-permalink="https://soatok.blog/soatoktelegrams2020-01/" data-orig-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/08/soatoktelegrams2020-01.png?fit=512%2C512&amp;ssl=1" data-orig-size="512,512" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="SoatokTelegrams2020-01" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/08/soatoktelegrams2020-01.png?fit=300%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/08/soatoktelegrams2020-01.png?fit=512%2C512&amp;ssl=1" loading="lazy" src="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/08/soatoktelegrams2020-01.png?resize=256%2C256&amp;ssl=1" alt="" width="256" height="256" data-recalc-dims="1" data-lazy-src="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/08/soatoktelegrams2020-01.png?resize=256%2C256&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/><figcaption>Me when I hear “brainpool”</figcaption></figure></div>


<h2>Re-Examining the SafeCurves Criteria</h2>



<p>Here’s a 2022 refresh of the SafeCurves criteria for all of the curves considered by this blog post.</p>



<figure><table><thead><tr><th><strong>SafeCurve Criteria</strong></th><th><strong>Relevance to the Curves Listed Above</strong></th></tr></thead><tbody><tr><td><a href="https://safecurves.cr.yp.to/field.html" target="_blank" rel="noopener">Fields</a></td><td>All relevant curves satisfy the requirements</td></tr><tr><td><a href="https://safecurves.cr.yp.to/equation.html" target="_blank" rel="noopener">Equations</a></td><td>All relevant curves satisfy the requirements</td></tr><tr><td><a href="https://safecurves.cr.yp.to/base.html" target="_blank" rel="noopener">Base Points</a></td><td>All relevant curves satisfy the requirements</td></tr><tr><td><a href="https://safecurves.cr.yp.to/rho.html" target="_blank" rel="noopener">Rho</a></td><td>All relevant curves satisfy the requirements</td></tr><tr><td><a href="https://safecurves.cr.yp.to/transfer.html" target="_blank" rel="noopener">Transfers</a></td><td>All relevant curves satisfy the requirements</td></tr><tr><td><a href="https://safecurves.cr.yp.to/disc.html" target="_blank" rel="noopener">Discriminants</a></td><td>Only <a href="#secp256k1">secp256k1</a> doesn’t satisfy the requirements (out of the curves listed in this blog post)</td></tr><tr><td><a href="https://safecurves.cr.yp.to/rigid.html" target="_blank" rel="noopener">Rigidity</a></td><td>The NIST curves do not meet this requirement.</td></tr><tr><td><a href="https://safecurves.cr.yp.to/ladder.html" target="_blank" rel="noopener">Ladders</a></td><td>While a Montgomery ladder is <a href="https://crypto.stackexchange.com/a/47903/">beneficial for speed and implementation security</a>, it isn’t strictly speaking <strong>required</strong>.</td></tr><tr><td><a href="https://safecurves.cr.yp.to/twist.html" target="_blank" rel="noopener">Twists</a></td><td>The only curve listed above that doesn’t meet the requirement is the 256-bit Brainpool curve (brainpoolp256t1).</td></tr><tr><td><a href="https://safecurves.cr.yp.to/complete.html" target="_blank" rel="noopener">Completeness</a></td><td>All relevant curves satisfy the requirements, <a href="https://eprint.iacr.org/2015/1060.pdf">as of 2015</a>.</td></tr><tr><td><a href="https://safecurves.cr.yp.to/ind.html" target="_blank" rel="noopener">Indistinguishability</a></td><td>All relevant curves satisfy the requirements, <a href="https://eprint.iacr.org/2014/043.pdf" target="_blank" rel="noopener">as of 2014</a>.</td></tr></tbody></table></figure>



<p>SafeCurves continues to be a useful resource, especially if you stray from the guidance on this page.</p>



<p>For example: You wouldn’t want to use pairing-friendly curves for general purpose ECC digital signatures, because they’re suitable for specialized problems. SafeCurves correctly recommends not using BN(2,254).</p>



<p>However, SafeCurves is showing its age in 2022. BN curves <a href="https://fidoalliance.org/specs/fido-v2.0-id-20180227/fido-ecdaa-algorithm-v2.0-id-20180227.html#iana-considerations">still end up in digital signature protocol standards</a> even though <a href="https://hackmd.io/@benjaminion/bls12-381">BLS-12-381</a> is clearly a better choice.</p>



<p>The Internet would benefit greatly for an updated SafeCurves that focuses on newer elliptic curve algorithms.</p>





<h2>TL;DR</h2>



<p>Ed25519 is great. NIST P-256 and P-384 are okay (with caveats). Anything else is questionable, and their parameter selection should come with a clear justification.</p>

		</div><!-- .entry-content -->

	</div></div>
  </body>
</html>
