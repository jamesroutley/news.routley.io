<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.http-feeds.org/">Original</a>
    <h1>HTTP Feeds</h1>
    
    <div id="readability-page-1" class="page"><div>
      

      

<p>Asynchronous <a href="#event-feeds">event streaming</a> and <a href="#aggregate-feeds">data replication</a> with plain HTTP APIs.</p>

<p>HTTP feeds is a minimal specification for polling events over HTTP:</p>

<ul>
  <li>An HTTP feed provides a HTTP GET endpoint</li>
  <li>that returns a chronological sequence (!) of events</li>
  <li>serialized in <a href="https://github.com/cloudevents/spec">CloudEvents</a> event format</li>
  <li>in batched responses using the media type <code>application/cloudevents-batch+json</code></li>
  <li>and respects the <code>lastEventId</code> query parameter to scroll through further items</li>
  <li>to support <a href="#polling">infinite polling</a> for real-time feed subscriptions.</li>
</ul>

<p>HTTP feeds can be used to <a href="https://scs-architecture.org">decouple systems</a> asynchronously <a href="https://www.innoq.com/en/articles/2021/12/http-feeds-schnittstellen-ohne-kafka-oder-rabbitmq">without message brokers</a>, such as Kafka or RabbitMQ.</p>

<h2 id="example">Example</h2>

<div><div><pre><code><span>GET</span> <span>/inventory</span> <span>HTTP</span><span>/</span><span>1.1</span>
<span>Host</span><span>:</span> <span>https://example.http-feeds.org</span>
</code></pre></div></div>

<div><div><pre><code><span>HTTP</span><span>/</span><span>1.1</span> <span>200</span> <span>OK</span>
<span>Content-Type</span><span>:</span> <span>application/cloudevents-batch+json</span>

[{
  &#34;specversion&#34; : &#34;1.0&#34;,
  &#34;type&#34; : &#34;org.http-feeds.example.inventory&#34;,
  &#34;source&#34; : &#34;https://example.http-feeds.org/inventory&#34;,
  &#34;id&#34; : &#34;1c6b8c6e-d8d0-4a91-b51c-1f56bd04c758&#34;,
  &#34;time&#34; : &#34;2021-01-01T00:00:01Z&#34;,
  &#34;subject&#34; : &#34;9521234567899&#34;,
  &#34;data&#34; : {
    &#34;sku&#34;: &#34;9521234567899&#34;,
    &#34;updated&#34;: &#34;2022-01-01T00:00:01Z&#34;,
    &#34;quantity&#34;: 5
  }
},{
  &#34;specversion&#34; : &#34;1.0&#34;,
  &#34;type&#34; : &#34;org.http-feeds.example.inventory&#34;,
  &#34;source&#34; : &#34;https://example.http-feeds.org/inventory&#34;,
  &#34;id&#34; : &#34;292042fb-ab04-4653-af90-19a24032bffe&#34;,
  &#34;time&#34; : &#34;2021-12-01T00:00:15Z&#34;,
  &#34;subject&#34; : &#34;9521234512349&#34;,
  &#34;data&#34; : {
    &#34;sku&#34;: &#34;9521234512349&#34;,
    &#34;updated&#34;: &#34;2022-01-01T00:00:12Z&#34;,
    &#34;quantity&#34;: 0
  }
},{
  &#34;specversion&#34; : &#34;1.0&#34;,
  &#34;type&#34; : &#34;org.http-feeds.example.inventory&#34;,
  &#34;source&#34; : &#34;https://example.http-feeds.org/inventory&#34;,
  &#34;id&#34; : &#34;fa3e2a22-398c-4d02-ad08-9415e43178e6&#34;,
  &#34;time&#34; : &#34;2021-01-01T00:00:22Z&#34;,
  &#34;subject&#34; : &#34;9521234567899&#34;,
  &#34;data&#34; : {
    &#34;sku&#34;: &#34;9521234567899&#34;,
    &#34;updated&#34;: &#34;2022-01-01T00:00:21Z&#34;,
    &#34;quantity&#34;: 4
  }
}]
</code></pre></div></div>

<p>Client calls again with the last processed event id.</p>

<div><div><pre><code><span>GET</span> <span>/inventory?lastEventId=fa3e2a22-398c-4d02-ad08-9415e43178e6</span> <span>HTTP</span><span>/</span><span>1.1</span>
<span>Host</span><span>:</span> <span>https://example.http-feeds.org</span>
</code></pre></div></div>

<div><div><pre><code><span>HTTP</span><span>/</span><span>1.1</span> <span>200</span> <span>OK</span>
<span>Content-Type</span><span>:</span> <span>application/cloudevents-batch+json</span>

[]
</code></pre></div></div>

<p>An empty array signals the end of the feed.</p>

<h2 id="polling">Polling</h2>

<p>A client can continue polling in an infinite loop to subscribe to a feed.</p>

<h3 id="simple-polling">Simple Polling</h3>

<p>A client calls the endpoint with the last known event id as <code>lastEventId</code> query parameter in an endless loop.
If the response is an empty array, the client reached the end of the stream and waits some time to make another call to get events that occured in the meantime.</p>

<p>Pseudocode:</p>

<div><div><pre><code><span>endpoint</span> <span>=</span> <span>&#34;https://example.http-feeds.org/inventory&#34;</span>
<span>lastEventId</span> <span>=</span> <span>null</span>

<span>while</span> <span>true</span><span>:</span>
  <span>try</span><span>:</span>
    <span>response</span> <span>=</span> <span>GET</span> <span>endpoint</span> <span>+</span> <span>&#34;?lastEventId=&#34;</span> <span>+</span> <span>lastEventId</span> 
    <span>for</span> <span>event</span> <span>in</span> <span>response</span><span>:</span>
      <span>process</span> <span>event</span>
      <span>lastEventId</span> <span>=</span> <span>event</span><span>.</span><span>id</span>
    <span>if</span> <span>response</span> <span>is</span> <span>empty</span><span>:</span>
      <span>wait</span> <span>N</span> <span>seconds</span> 
  <span>except</span><span>:</span>
    <span>wait</span> <span>N</span> <span>seconds</span>  
</code></pre></div></div>

<p>Client <em>must</em> persist the <code>id</code> of the last processed event as <code>lastEventId</code> for further fetches.</p>

<p>The client’s event processing <em>must</em> be idempotent (<em>at-least-once</em> delivery semantic). 
The <code>id</code> <em>may</em> be used for idempotency checks.</p>

<h3 id="long-polling">Long Polling</h3>

<p>The server may also support <em>long polling</em> for lower latency.
The client adds a <code>timeout</code> query parameter to specify the max period of milliseconds to wait for an response.</p>

<p>Client Pseudocode:</p>

<div><div><pre><code><span>endpoint</span> <span>=</span> <span>&#34;https://example.http-feeds.org/inventory&#34;</span>
<span>lastEventId</span> <span>=</span> <span>null</span>
<span>timeout</span> <span>=</span> <span>5000</span> <span>//</span> <span>5000</span> <span>milliseconds</span> <span>is</span> <span>a</span> <span>good</span> <span>timeout</span> <span>period</span> <span>for</span> <span>long</span> <span>polling</span>

<span>while</span> <span>true</span><span>:</span>
  <span>try</span><span>:</span>
    <span>response</span> <span>=</span> <span>GET</span> <span>endpoint</span> <span>+</span> <span>&#34;?lastEventId=&#34;</span> <span>+</span> <span>lastEventId</span> <span>+</span> <span>&#34;&amp;timeout=&#34;</span> <span>+</span> <span>timeout</span>
    <span>for</span> <span>event</span> <span>in</span> <span>response</span><span>:</span>
      <span>process</span> <span>event</span>
      <span>lastEventId</span> <span>=</span> <span>event</span><span>.</span><span>id</span>
    <span>//</span> <span>no</span> <span>client</span> <span>wait</span> <span>step</span> <span>within</span> <span>the</span> <span>loop</span>
  <span>except</span><span>:</span>
    <span>//</span> <span>Delay</span> <span>the</span> <span>next</span> <span>request</span> <span>only</span> <span>in</span> <span>case</span> <span>of</span> <span>a</span> <span>server</span> <span>error</span>
    <span>wait</span> <span>N</span> <span>seconds</span>
</code></pre></div></div>

<p>If there are no newer events available, the server keeps the connection open until new events arrive or the defined period timed out.
The server then sends the response (with the new events or an empty array) and the client can immediately perform another call.</p>

<p>The latency can be improved, as the server can react to new events efficiently by implementing an internal event notification, change data capture triggers, or performing a high-frequency polling to the database.</p>

<p>The cost of long polling is that the server needs to handle more open connections concurrently.
This may become an issue with more than <a href="http://www.kegel.com/c10k.html">10K connections</a>.</p>

<h2 id="event-id">Event ID</h2>

<p>The <code>event.id</code> is used as <code>lastEventId</code> to scroll through further events.
This means that events need to be strongly ordered to retrieve subsequent events.</p>

<p>Events may also get deleted from the feed, e.g. through <a href="#compaction">Compaction</a> and <a href="#deletion">Deletion</a>.
The server must still respect the original position and send only newer events, even when an event with the <code>lastEventId</code> was deleted.</p>

<p>One way to achieve this is to use an time-ordered <a href="https://uuid.ramsey.dev/en/stable/nonstandard/version6.html">UUIDv6</a> as event ID (see <a href="https://datatracker.ietf.org/doc/html/draft-peabody-dispatch-new-uuid-format#section-4.3">IETF draft</a> and <a href="https://github.com/f4b6a3/uuid-creator/wiki/1.6.-Time-ordered">Java-Library</a>). 
This a viable option, especially if only one server appends new events to the feed, but might be a problem with multiple servers when the clocks are not in-sync.</p>

<p>An alternative is to use a database <a href="https://www.postgresql.org/docs/current/functions-sequence.html">sequence</a> that is used as part of the <code>event.id</code> and interpreted when querying the database for the next batch. Example: The event.id <code>0000001000001::5f8de8ff-30d8-4fab-8f5a-c32f326d6f26</code> contains a database sequence <code>0000001000001</code> and a random UUID.</p>

<h2 id="event-feeds">Event Feeds</h2>

<p>HTTP feeds can be used to provide an API for publishing immutable domain events to other systems.</p>

<p>It is quite common that one http feed endpoint includes different event <code>type</code>s that belong to the same bounded context.</p>

<h2 id="aggregate-feeds">Aggregate Feeds</h2>

<p>HTTP feeds can be used to provide an API for data collections of mutable objects (aka aggregates, master data) to other systems.</p>

<p>An aggregate is identified through its <code>subject</code>. 
An aggregate feed <em>must</em> contain every aggregate at least once.
Every created aggregate and each update leads to an appended feed entry with the full current state.</p>

<p>Feed consumers can subscribe an <em>aggregate feed</em> to perform near real-time data synchronization to build local read models and to trigger actions when new or updated data is received.
A feed consumer has a consistent state when reaching the end of the feed.</p>

<p>The server should implement <a href="#compaction">Compaction</a> and may implement <a href="#deletion">Deletion</a> based on business requirements.</p>

<h3 id="compaction">Compaction</h3>

<p>Each aggregate update leads to an additional entry in the feed.
It is good practice to keep the feed small to enable a quick synchronization of new clients.
When feed items include the full current state of the resource, older feed items for the same aggregate may be outdated.</p>

<p>Clients that read the feed from the beginning will therefore occur an inconsistent state for a short time.
To mitigate, entries <em>may</em> be deleted from the feed when another entry was appended to the feed with the same <code>subject</code>.</p>

<p>Example:
There is an update for subject <code>9521234567899</code>.</p>

<div><div><pre><code><span>HTTP</span><span>/</span><span>1.1</span> <span>200</span> <span>OK</span>
<span>Content-Type</span><span>:</span> <span>application/cloudevents-batch+json</span>

[{
  &#34;specversion&#34; : &#34;1.0&#34;,
  &#34;type&#34; : &#34;org.http-feeds.example.inventory&#34;,
  &#34;source&#34; : &#34;https://example.http-feeds.org/inventory&#34;,
  &#34;id&#34; : &#34;1c6b8c6e-d8d0-4a91-b51c-1f56bd04c758&#34;,
  &#34;time&#34; : &#34;2021-01-01T00:00:01Z&#34;,
  &#34;subject&#34; : &#34;9521234567899&#34;,
  &#34;data&#34; : {
    &#34;sku&#34;: &#34;9521234567899&#34;,
    &#34;updated&#34;: &#34;2022-01-01T00:00:01Z&#34;,
    &#34;quantity&#34;: 5
  }
},{
  &#34;specversion&#34; : &#34;1.0&#34;,
  &#34;type&#34; : &#34;org.http-feeds.example.inventory&#34;,
  &#34;source&#34; : &#34;https://example.http-feeds.org/inventory&#34;,
  &#34;id&#34; : &#34;292042fb-ab04-4653-af90-19a24032bffe&#34;,
  &#34;time&#34; : &#34;2021-12-01T00:00:15Z&#34;,
  &#34;subject&#34; : &#34;9521234512349&#34;,
  &#34;data&#34; : {
    &#34;sku&#34;: &#34;9521234512349&#34;,
    &#34;updated&#34;: &#34;2022-01-01T00:00:12Z&#34;,
    &#34;quantity&#34;: 0
  }
},{
  &#34;specversion&#34; : &#34;1.0&#34;,
  &#34;type&#34; : &#34;org.http-feeds.example.inventory&#34;,
  &#34;source&#34; : &#34;https://example.http-feeds.org/inventory&#34;,
  &#34;id&#34; : &#34;fa3e2a22-398c-4d02-ad08-9415e43178e6&#34;,
  &#34;time&#34; : &#34;2021-01-01T00:00:22Z&#34;,
  &#34;subject&#34; : &#34;9521234567899&#34;,
  &#34;data&#34; : {
    &#34;sku&#34;: &#34;9521234567899&#34;,
    &#34;updated&#34;: &#34;2022-01-01T00:00:21Z&#34;,
    &#34;quantity&#34;: 4
  }
}]
</code></pre></div></div>

<p>After a compaction run, the first entry is gone:</p>

<div><div><pre><code><span>HTTP</span><span>/</span><span>1.1</span> <span>200</span> <span>OK</span>
<span>Content-Type</span><span>:</span> <span>application/cloudevents-batch+json</span>

[{
  &#34;specversion&#34; : &#34;1.0&#34;,
  &#34;type&#34; : &#34;org.http-feeds.example.inventory&#34;,
  &#34;source&#34; : &#34;https://example.http-feeds.org/inventory&#34;,
  &#34;id&#34; : &#34;292042fb-ab04-4653-af90-19a24032bffe&#34;,
  &#34;time&#34; : &#34;2021-12-01T00:00:15Z&#34;,
  &#34;subject&#34; : &#34;9521234512349&#34;,
  &#34;data&#34; : {
    &#34;sku&#34;: &#34;9521234512349&#34;,
    &#34;updated&#34;: &#34;2022-01-01T00:00:12Z&#34;,
    &#34;quantity&#34;: 0
  }
},{
  &#34;specversion&#34; : &#34;1.0&#34;,
  &#34;type&#34; : &#34;org.http-feeds.example.inventory&#34;,
  &#34;source&#34; : &#34;https://example.http-feeds.org/inventory&#34;,
  &#34;id&#34; : &#34;fa3e2a22-398c-4d02-ad08-9415e43178e6&#34;,
  &#34;time&#34; : &#34;2021-01-01T00:00:22Z&#34;,
  &#34;subject&#34; : &#34;9521234567899&#34;,
  &#34;data&#34; : {
    &#34;sku&#34;: &#34;9521234567899&#34;,
    &#34;updated&#34;: &#34;2022-01-01T00:00:21Z&#34;,
    &#34;quantity&#34;: 4
  }
}]
</code></pre></div></div>

<h3 id="deletion">Deletion</h3>

<p>Some aggregates need to  be deleted, e. g. by regulatory requirements.</p>

<p>Aggregate feeds use a <code>method</code> field with value <code>DELETE</code> to signal the deletion of an <code>subject</code> to consumers that built a local read model before.</p>

<p>When aggregate was deleted, the server must append a <code>DELETE</code> entry with the <code>subject</code> to delete and no data content.</p>

<div><div><pre><code><span>{</span><span>
  </span><span>&#34;specversion&#34;</span><span> </span><span>:</span><span> </span><span>&#34;1.0&#34;</span><span>,</span><span>
  </span><span>&#34;type&#34;</span><span> </span><span>:</span><span> </span><span>&#34;org.http-feeds.example.inventory&#34;</span><span>,</span><span>
  </span><span>&#34;source&#34;</span><span> </span><span>:</span><span> </span><span>&#34;https://example.http-feeds.org/inventory&#34;</span><span>,</span><span>
  </span><span>&#34;id&#34;</span><span> </span><span>:</span><span> </span><span>&#34;06b13630-e4c3-4d85-a669-ce66fc4daa75&#34;</span><span>,</span><span>
  </span><span>&#34;time&#34;</span><span> </span><span>:</span><span> </span><span>&#34;2021-12-31T00:00:01Z&#34;</span><span>,</span><span>
  </span><span>&#34;subject&#34;</span><span> </span><span>:</span><span> </span><span>&#34;9521234567899&#34;</span><span>,</span><span>
  </span><span>&#34;method&#34;</span><span>:</span><span> </span><span>&#34;DELETE&#34;</span><span>
</span><span>}</span><span>
</span></code></pre></div></div>

<p>Clients <em>must</em> delete this aggregate or otherwise handle the removal.</p>

<p>The server <em>should</em> start a <a href="#compaction">compaction run</a> afterwards to delete previous entries for the same aggregate.</p>

<h2 id="data-model">Data Model</h2>

<p>An HTTP feed endpoint must support these query parameters:</p>

<table>
  <thead>
    <tr>
      <th>Query Parameter</th>
      <th>Type</th>
      <th>Mandatory</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>lastEventId</code></td>
      <td>String</td>
      <td>Optional</td>
      <td>The last event <code>id</code> that was processed. Used to scroll through further events. May be missing or <code>null</code> to start from the beginning of the feed.</td>
    </tr>
    <tr>
      <td><code>timeout</code></td>
      <td>Number</td>
      <td>Optional</td>
      <td>A timeout is set, when long-polling should be used and is supported by the server. Max waiting time in milliseconds for long-polling, after which the server must send a response. A typical value is <code>5000</code>.</td>
    </tr>
  </tbody>
</table>

<p>The response body contains an array of events that comply with the <a href="https://github.com/cloudevents/spec">CloudEvents Specification</a> in the <a href="https://github.com/cloudevents/spec/blob/v1.0.1/json-format.md#4-json-batch-format"><code>application/cloudevents-batch+json</code> format</a>.</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Type</th>
      <th>Event Feed</th>
      <th>Aggregate Feed</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>specversion</code></td>
      <td>String</td>
      <td>Mandatory</td>
      <td>Mandatory</td>
      <td>The currently supported CloudEvents specification version.</td>
    </tr>
    <tr>
      <td><code>id</code></td>
      <td>String</td>
      <td>Mandatory</td>
      <td>Mandatory</td>
      <td>A unique value (such as a UUID) for this event. It can be used to implement deduplication/idempotency handling in downstream systems. It is used as the <code>lastEventId</code> in subsequent calls.</td>
    </tr>
    <tr>
      <td><code>type</code></td>
      <td>String</td>
      <td>Mandatory</td>
      <td>Mandatory</td>
      <td>The type of the event. May be used to specify and deserialize the payload. A feed may contain different event types. It SHOULD be prefixed with a reverse-DNS name.</td>
    </tr>
    <tr>
      <td><code>source</code></td>
      <td>String</td>
      <td>Mandatory</td>
      <td>Mandatory</td>
      <td>The source system that created the event. Should be a URI of the system.</td>
    </tr>
    <tr>
      <td><code>time</code></td>
      <td>String</td>
      <td>Mandatory</td>
      <td>Mandatory</td>
      <td>The event addition timestamp. ISO 8601 UTC date and time format.</td>
    </tr>
    <tr>
      <td><code>subject</code></td>
      <td>String</td>
      <td>n/a</td>
      <td>Mandatory</td>
      <td>Key to identify the business object. It doesn’t have to be unique within the feed. This should represent a business key such as an order number or sku. Used for <a href="#compaction">compaction</a> and <a href="#deletion">deletion</a>, if implemented.</td>
    </tr>
    <tr>
      <td><code>method</code></td>
      <td>String</td>
      <td>n/a</td>
      <td>Optional</td>
      <td>The HTTP equivalent method type that the feed item performs on the <code>subject</code>. <code>PUT</code> indicates that the <em>subject</em> was created or updated. <code>DELETE</code> indicates that the  <em>subject</em> was deleted. Defaults to <code>PUT</code>.</td>
    </tr>
    <tr>
      <td><code>datacontenttype</code></td>
      <td>String</td>
      <td>Optional</td>
      <td>Optional</td>
      <td>Defaults to <code>application/json</code>.</td>
    </tr>
    <tr>
      <td><code>data</code></td>
      <td>Object</td>
      <td>Mandatory</td>
      <td>Optional</td>
      <td>The payload of the item. Defaults to JSON. May be missing, e.g. when the method was <code>DELETE</code>.</td>
    </tr>
  </tbody>
</table>

<p>Further metadata may be added, e.g. for traceability.</p>

<h2 id="authentication">Authentication</h2>

<p>HTTP feeds <em>may</em> be protected with <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication">HTTP authentication</a>.</p>

<p>The most common authentication schemes are <a href="https://tools.ietf.org/html/rfc7617">Basic</a> and <a href="https://tools.ietf.org/html/rfc6750">Bearer</a>.</p>

<p>The server <em>may</em> filter feed items based on the principal.
When filtering is applied, <a href="#caching">caching</a> may be unfeasible.</p>

<h2 id="caching">Caching</h2>

<p>Servers <em>may</em> set <a href="https://devcenter.heroku.com/articles/increasing-application-performance-with-http-cache-headers">appropriate</a> response headers, such as <code>Cache-Control: public, max-age=31536000</code>, when a batch is full and will not be modified anymore.</p>

<h2 id="libraries-and-examples">Libraries and Examples</h2>

<ul>
  <li><a href="https://github.com/http-feeds/http-feeds-server-spring-boot-starter">http-feeds-server-spring-boot-starter</a></li>
  <li><a href="https://github.com/http-feeds/http-feeds-server-spring-boot-example">http-feeds-server-spring-boot-example</a></li>
  <li><a href="https://github.com/http-feeds/http-feeds-server-aws-serverless-example">http-feeds-server-aws-serverless-example</a></li>
</ul>

<h2 id="about">About</h2>

<p>This site is maintained by <a href="https://twitter.com/jochen_christ">Jochen Christ</a>. Jochen works as tech lead at <a href="https://www.innoq.com">INNOQ</a> and is also author of <a href="https://whichjdk.com">WhichJDK.com</a>, <a href="https://www.remotemobprogramming.org">Remote Mob Programming</a>, and <a href="https://www.datamesh-architecture.com">Data Mesh Architecture</a>.</p>

<p>HTTP feeds has evolved from <a href="https://github.com/rest-feeds/rest-feeds">rest-feeds</a>.</p>

<p>Contributions are highly appreciated, e.g. libraries or examples in different languages or frameworks help a lot.</p>

<p>Found an error or something is missing? 
Please <a href="https://github.com/http-feeds/http-feeds/issues/new">raise an issue</a> or <a href="https://github.com/http-feeds/http-feeds/pulls">create a pull request</a>.</p>

<p>This specification is published under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.</p>

<!-- 100% privacy friendly analytics -->







      
    </div></div>
  </body>
</html>
