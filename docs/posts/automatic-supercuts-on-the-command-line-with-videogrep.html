<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lav.io/notes/videogrep-tutorial/">Original</a>
    <h1>Automatic supercuts on the command line with Videogrep</h1>
    
    <div id="readability-page-1" class="page"><div>
      <h2 id="how-to-make-automatic-supercuts">How to Make Automatic Supercuts</h2>

<p>
  <iframe src="https://www.youtube.com/embed/nGHbOckpifw" allowfullscreen="" title="YouTube Video"></iframe>
</p>

<p>I’ve been working on some long-needed updates to <a href="https://antiboredom.github.io/videogrep">Videogrep</a>, my command-line tool that automatically generates supercuts. These updates were motivated in part by a 10 week class I recently developed and taught at the <a href="https://sfpc.study/">School for Poetic Computation</a> called <a href="https://github.com/antiboredom/scrapism-spring-2022">Scrapism</a> (web-scraping-as-art). The class includes a section on automatically manipulating video, and I’ll also be teaching this material this June, in a <a href="https://sonicacts.com/portal/supercuts-sabotage-by-montage-a-workshop-with-sam-lavigne">3-hour workshop</a> that is specifically about video and the command line at <a href="https://sonicacts.com/portal">Sonic Acts</a>.</p>
<p>The most significant improvement I’ve made to the software is migrating Videogrep’s offline transcription tool from <a href="https://github.com/cmusphinx/pocketsphinx">Pocketsphinx</a>, which is notoriously inaccurate and seemed to have stopped working on my Mac, to <a href="https://alphacephei.com/vosk/">Vosk</a>, which anecdotally works around 1000% better.</p>
<p>I’ve also attempted to simplify the tool a bit, removing some features that I don’t think anyone was really using, like searching by part of speech or word category.</p>
<p>In this tutorial I’ll walk you through how to use the new and improved Videogrep, as well as another tool called <a href="https://github.com/yt-dlp/yt-dlp">yt-dlp</a> that allows you to download videos from almost any website.</p>
<hr/>
<h2 id="prerequisites">Prerequisites</h2>
<p>This tutorial requires some familiarity with the command line (although not much). If you’re brand new to this type of thing, you may wish to take a look at this video/write-up I’ve prepared: <a href="https://scrapism.lav.io/intro-to-the-command-line/">Intro to the Command Line</a>.</p>
<p>You’ll also need Python installed on your computer. If you’re on a Mac you should already be good to go. If you’re on a PC, download and install the latest stable release of Python <a href="https://www.python.org/downloads/windows/">here</a>.</p>
<hr/>
<h2 id="downloading-videos-with-yt-dlp">Downloading videos with <code>yt-dlp</code></h2>
<p>Before we get into Videogrep, here’s a brief intro to <code>yt-dlp</code>.</p>
<p><code>yt-dlp</code> allows you to very easily download almost any video from the web. To install it, just run:</p>
<p>There are tons of things you can do with <code>yt-dlp</code>. I’m just going to cover the basics here, focusing on what I find the most useful for making supercuts.</p>
<h3 id="basic-usage">Basic usage</h3>
<p>To download a video, just type <code>yt-dlp</code> and the URL of the video you want. This will work for YouTube, Vimeo, Twitter and <em>hundreds</em> of other websites. For example, if we want to download some highlights from the nightmarish Metaverse announcement video (which I’ll be using later to demo <code>Videogrep</code>), it’s as easy as:</p>
<div><pre><code data-lang="bash">yt-dlp <span>&#34;https://www.youtube.com/watch?v=gElfIo6uw4g&#34;</span>
</code></pre></div><p><em>Note: I’ve surrounded the video URL in quotes to avoid problems that can occur if the URL contains special characters. This isn’t always necessary, but I usually do it anyway.</em></p>
<p>You can also download an entire user, channel, playlist, or search query. For example this will download the entire White House channel (it will take a long time).</p>
<div><pre><code data-lang="bash">yt-dlp <span>&#34;https://www.youtube.com/user/whitehouse/&#34;</span>
</code></pre></div><p>And this will download videos matching the search query “capitalism:”</p>
<div><pre><code data-lang="bash">yt-dlp <span>&#34;https://www.youtube.com/results?search_query=capitalism&#34;</span>
</code></pre></div><p>You can pretty much give yt-dlp any URL on YouTube, or any other video site.</p>
<h3 id="file-formats">File formats</h3>
<p>Websites like YouTube and Vimeo store videos in multiple file formats and sizes. By default, <code>yt-dlp</code> will download the highest quality video it can find, but frequently I like to work with smaller videos. To get a list of all available video formats simply add the <code>-F</code> option:</p>
<div><pre><code data-lang="bash">yt-dlp <span>&#34;https://www.youtube.com/watch?v=gElfIo6uw4g&#34;</span> -F
</code></pre></div><p>You’ll see something like this:</p>

  
  
  


<figure>
    
        <img src="https://lav.io/notes/videogrep-tutorial/vidtable_hu7b2e2875101bd6986e3024fb9a3550e3_559476_1500x0_resize_box_2.png"/>
    
    
</figure>

<p>You can then select a file to download by passing the <code>-f</code> option along with an id (the number or characters in the first column). So if I want to download this video as a 1280x720 mp4, I would type:</p>
<div><pre><code data-lang="bash">yt-dlp <span>&#34;https://www.youtube.com/watch?v=gElfIo6uw4g&#34;</span> -f <span>22</span>
</code></pre></div><p><em>Note: some formats are video or audio only.</em></p>
<h3 id="changing-the-video-filename">Changing the video filename</h3>
<p>By default <code>yt-dlp</code> will automatically name the downloaded video for you. This is useful, but sometimes it’s convenient to name the file yourself. To do so, add the <code>-o</code> flag.</p>
<div><pre><code data-lang="bash">yt-dlp <span>&#34;https://www.youtube.com/watch?v=gElfIo6uw4g&#34;</span> -o meta.mp4
</code></pre></div><h3 id="download-subtitles">Download subtitles</h3>
<p>Finally, YouTube usually provides auto-generated subtitles for videos. These are fairly high quality, and are useful for a variety of reasons, including making supercuts!</p>
<p>To download subtitles, just add <code>--write-auto-sub</code>.</p>
<div><pre><code data-lang="bash">yt-dlp <span>&#34;https://www.youtube.com/watch?v=gElfIo6uw4g&#34;</span> --write-auto-sub
</code></pre></div><p>You can also combine this with <code>-f</code>, and <code>-o</code>, like so:</p>
<div><pre><code data-lang="bash">yt-dlp <span>&#34;https://www.youtube.com/watch?v=gElfIo6uw4g&#34;</span> --write-auto-sub -f <span>22</span> -o meta.mp4
</code></pre></div><p>This will download the video as a 1280x720 mp4 with the filename meta.mp4, along with it’s subtitles in .vtt format.</p>
<hr/>
<h2 id="videogrep">Videogrep</h2>
<p>Videogrep uses the timestamps in subtitle files to make supercuts of videos. It will automatically look for a few different types of subtitle files, including <code>.srt</code> files (the most common subtitle format), <code>.vtt</code> files (a common web-based subtitle format), or specially formatted <code>.json</code> files that videogrep can generate itself (more on this later).</p>
<p><em>Note: the subtitle file must have the same name as the video file. So, if you have a video called <code>meta.mp4</code> you’d also need a subtitle file, in the same folder, called <code>meta.vtt</code> or <code>meta.srt</code>.</em></p>
<p>We’ll start using <code>.vtt</code> files that are provided with almost every YouTube video.</p>
<p>If you haven’t already done so, go ahead and download a YouTube video with <code>yt-dlp</code>, and make sure to pass along the <code>--write-auto-sub</code> option to also download the video subtitle file.</p>
<p>Once you have a video to work with, we can use <code>videogrep</code> to make a supercut of it. First, install <code>videogrep</code> with <code>pip</code>:</p>
<h3 id="usage">Usage</h3>
<p>To use <code>videogrep</code> give it input video or video files with the <code>--input</code> argument, and a search term with the <code>--search</code> argument.</p>
<div><pre><code data-lang="bash">videogrep --input VIDEO.mp4 --search <span>&#34;search term&#34;</span>
</code></pre></div><p>For our first example, let’s make a supercut of Mark Zuckerberg saying the word “experience” in <a href="https://www.youtube.com/watch?v=gElfIo6uw4g">this video</a>.</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --search <span>&#39;experience&#39;</span>
</code></pre></div><p>This will save a video called <code>supercut.mp4</code> in the same folder that you ran the script from. The video will be made only of clips containing the word “experience”.</p>

<p>To change the name of the output video, add the <code>--output</code> or <code>-o</code> option:</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --search <span>&#39;experience&#39;</span> --output experience1.mp4
</code></pre></div><p>Notice that the video doesn’t just contain the search word “experience” but also a few words before and after the keyword. By default <code>videogrep</code> will try to match whole sentences or phrases. A “sentence” is determined by the transcript file associated with the video.</p>
<p>If you want to just cut to individual words you can change the <code>--search-type</code> argument from the default (<code>--sentence</code>) to <code>fragment</code>:</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --search <span>&#39;experience&#39;</span> --search-type fragment --output experience2.mp4
</code></pre></div>
<p><em>Note: <code>--search-type fragment</code> requires that subtitle files have timestamps for each word. Frequently <code>.vtt</code> files will have these timestamps, but <code>.srt</code> files will not.</em></p>
<p>You may notice that some of the timing seems a bit off. In this example, videogrep is using timestamps in the <code>.vtt</code> file that YouTube generated and sometimes these aren’t 100% accurate. If you want to you can adjust how videogrep makes cuts with either the <code>--padding</code> argument, or the <code>--resyncsubs</code> argument.</p>
<p><code>--padding SECS</code> will add some padding time to the start and end of every clip, and <code>--resyncsubs SECS</code> will shift the time of the entire subtitle file.</p>
<p>In this example, pushing everything back by about 1/10th of a second seems to increase the accuracy:</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --search <span>&#39;experience&#39;</span> --search-type fragment --resyncsubs 0.1 --output experience3.mp4
</code></pre></div>
<h3 id="frequent-words-and-phrases">Frequent words and phrases</h3>
<p>If you want to learn what the most common words and phrases inside a video are, you can use the <code>--ngrams N</code> argument. For example, to print out the most common single words in our Meta video:</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --ngrams <span>1</span>
</code></pre></div><p>To print out the most common two word phrases:</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --ngrams <span>2</span>
</code></pre></div><p>The output would be:</p>
<div><pre><code data-lang="bash">to be <span>15</span>
going to <span>10</span>
the metaverse <span>10</span>
in the <span>9</span>
you can <span>8</span>
a lot <span>7</span>
...
</code></pre></div><p>Let’s use this to make a video:</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --search <span>&#39;the metaverse&#39;</span> --search-type fragment --resyncsubs 0.1 --output metaverse1.mp4
</code></pre></div>
<h3 id="regular-expressions">Regular Expressions</h3>
<p>Videogrep uses Python’s regular expression engine for the searches you specify with the <code>--search</code> argument. Regular expressions are a long and complicated topic that I won’t try to fully cover here, but I will provide a few useful pointers for getting started.</p>
<h4 id="what-is-a-regular-expression-engine">What is a “regular expression engine??”</h4>
<p>A regular expression engine takes a set of characters (some of which have special meaning) and uses them to try to find matches in a text. The input you give the engine (in this case, videogrep) is called a “regular expression”. The most simple type of regular expression is just a set of normal characters, like <code>ing</code>.</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --search <span>&#39;ing&#39;</span> --search-type fragment
</code></pre></div><p>This will look for any word that contains the characters <code>ing</code>, regardless of where they appear in the word. For example <code>making</code>, <code>building</code> and <code>things</code></p>

<p>In addition to just searching for characters chunks, regular expressions can also contain characters that aren’t matched literally but have a special meaning.</p>
<p>For example:</p>
<ul>
<li><code>.</code> is a wildcard that will match with any other character. The regular expression <code>h.t</code> will match “hot”, “hit”, “hat” and so on.</li>
<li><code>$</code> signifies the end of the word or sentence: <code>y$</code> will find anything that ends with the character “y”.</li>
<li><code>^</code> signifies the start of a word or sentence</li>
<li><code>|</code> means “or” - it let’s you search for multiple things.</li>
</ul>
<p>Here’s an example of matching multiple words with <code>|</code>:</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --search <span>&#39;physical|world&#39;</span> --search-type fragment --output physical_world.mp4
</code></pre></div>
<h4 id="very-important-note">Very important note</h4>
<p>If you want videogrep to match exactly what you enter, surround your search with <code>^</code> and <code>$</code>. For example, to match the word “the” you would use:</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --search <span>&#39;^the$&#39;</span> --search-type fragment --output the.mp4
</code></pre></div><p>If you’d like to learn a bit more about regular expressions, I recommend Allison Parrish’s <a href="https://github.com/aparrish/rwet/blob/master/regular-expressions-a-gentle-introduction.ipynb">Regular Expressions: A Gentle Introduction</a>.</p>
<h3 id="transcribing">Transcribing</h3>
<p>If you don’t have a subtitle file for your video (for instance if you’ve recorded it yourself), you can use videogrep to transcribe the video for you. To do this you’ll also need to install <a href="https://alphacephei.com/vosk/install">vosk</a> and <a href="https://www.ffmpeg.org/download.html">ffmpeg</a>.</p>
<p><em>Note: this does not currently work on M1 Macs without some hacking around.</em></p>
<p>To install <code>vosk</code>:</p>
<p>To install ffmpeg on a Mac, first install <a href="https://brew.sh/">brew</a>, and then:</p>
<p>Then, just pass the <code>--transcribe</code> option to videogrep:</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --transcribe
</code></pre></div><p>After some time passes you should see a new file in the same directory as your video with a <code>.json</code> extension. You can now use videogrep on that video. By default the transcription only works in English, but you can download <a href="https://alphacephei.com/vosk/models">other language models from vosk</a> and use the <code>--model</code> option to indicate which model to use.</p>
<h3 id="export-options">Export options</h3>
<p>Videogrep can export any file type that <a href="https://zulko.github.io/moviepy/">moviepy</a> can handle. In addition, it can export <code>edl</code> files compatible with the wonderful command line video player <code>mpv</code>, <code>xml</code> files that can be imported into Final Cut, Premiere, and Resolve, and it can also save individual clips rather than a concatenated supercut.</p>
<p>To save a supercut as individual clips, just pass the <code>--export-clips</code> option.</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --search experience --output experience.mp4 --export-clips
</code></pre></div><p>To save a supercut for import into another video editor, give the output file a <code>.xml</code> extension:</p>
<div><pre><code data-lang="bash">videogrep --input meta.mp4 --search experience --output experience.xml
</code></pre></div><p>You can now drag the xml file directly into Adobe Premiere, or import it into Davinci Resolve.</p>

  
  
  


<figure>
    
        <img src="https://lav.io/notes/videogrep-tutorial/importxml_huc90048f0937812a2d1ff1c7b33827d46_276754_1000x0_resize_box_2.png"/>
    
    
</figure>

<h3 id="multiple-files">Multiple files</h3>
<p>Videogrep can take multiple input videos. For example, to run it on every <code>mp4</code> in your current directly, just pass it <code>*.mp4</code> as an input:</p>
<div><pre><code data-lang="bash">yt-dlp <span>&#34;https://www.youtube.com/results?search_query=capitalism&#34;</span> --write-auto-sub

videogrep --input *.mp4 --search capitalism
</code></pre></div><h3 id="videogrep-as-a-module">Videogrep as a module</h3>
<p>Finally, you can also use videogrep from within Python. I’ve included <a href="https://github.com/antiboredom/videogrep/tree/master/examples">a few example scripts</a> in the repository that you can explore. These include: a script for extracting silences from a video; downloading and supercutting YouTube searches, and automatically making a supercut based on common words in a video.</p>
</div></div>
  </body>
</html>
