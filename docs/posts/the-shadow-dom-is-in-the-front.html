<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://abstract.properties/the-shadow-dom-is-in-the-front.html">Original</a>
    <h1>The Shadow DOM is in the front</h1>
    
    <div id="readability-page-1" class="page"><div>
                    <p>Due to its name, I used to think the Shadow DOM was this hard-to-use, murky thing that caused weird things to happen
to the UI. So I mistrusted it—I thought it was something to be used only with great caution.</p>
<p>But recently something clicked. It isn&#39;t somewhere behind in the shadows.</p>
<p>It&#39;s in the front: the Shadow DOM is a <strong>facade</strong> that obscures the Plain DOM.</p>
<p><img title="A photograph of the top of some brick buildings in Antwerp, showing the facade&#39;s distinctive stepping pattern" alt="A photograph of the top of some brick buildings in Antwerp, showing the facade&#39;s distinctive stepping pattern" srcset="/opengraph/antwerp-facade.860w.jpeg 860w, /opengraph/antwerp-facade.1200w.jpeg 1200w, /opengraph/antwerp-facade.1720w.jpeg 1720w"/>
</p>
<a id="how-the-shadow-dom-works" href="#how-the-shadow-dom-works"><h2>How the Shadow DOM works</h2></a>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_shadow_DOM">Shadow DOM</a> is typically used
hand-in-hand with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_custom_elements">Custom
Elements</a>.</p>
<p>You can make <strong>any</strong> custom HTML element (with any look &amp; feel) in plain JavaScript using
<code>customElements.define(&#34;my-custom-element&#34;, MyElementClass)</code>—as long as there&#39;s a hyphen in the name.</p>
<p>And in your custom element class, if you call <code>this.attachShadow({ mode: &#34;open&#34; })</code>, you get <code>this.shadowRoot</code>:
a shadow root node you can render to—just like any other element.</p>
<p>Consider this silly element, which dances when you click it:</p>
<div>
<table>
<thead>
<tr>
<th scpoe="col">Rendered</th>
<th scpoe="col">HTML</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<dancing-man left="superb" right="fantastic">
</dancing-man>
</td>
<td>
<div><pre><span>&lt;<span>dancing-man</span>
  <span>left</span>=<span>&#34;superb&#34;</span>
  <span>right</span>=<span>&#34;fantastic&#34;</span>
&gt;</span><span>&lt;/<span>dancing-man</span>&gt;</span>
</pre></div>
</td>
</tr>
</tbody>
</table>
</div>
<p>It&#39;s ~60 lines of CSS and ~70 lines of JS to create this little guy (<a href="https://gist.github.com/sufianrhazi/39fb369c1745e73f23fa9a99573858e4/049b016e0ea96354166db56665e1687524ff8cd2">full code here</a>):</p>
<div><pre><span>const</span> dancers = [
  [<span>&#34;(•_•)&#34;</span>, <span>&#34;&lt;) )╯&#34;</span>, <span>&#34; / \\ &#34;</span>],
  [<span>&#34;(•_•)&#34;</span>, <span>&#34;\\( (&gt;&#34;</span>, <span>&#34; / \\ &#34;</span>],
  [<span>&#34;(•_•)&#34;</span>, <span>&#34;╰( (&gt;&#34;</span>, <span>&#34; / \\ &#34;</span>],
  [<span>&#34;(•_•)&#34;</span>, <span>&#34;&lt;) )/&#34;</span>, <span>&#34; / \\ &#34;</span>],
];

<span>class</span> <span>DancingManElement</span> <span>extends</span> <span>HTMLElement</span> {
  
  <span>static</span> observedAttributes = [<span>&#34;left&#34;</span>, <span>&#34;right&#34;</span>];

  <span>constructor</span>(<span></span>) {
    <span>super</span>();

    
    <span>this</span>.<span>_leftSide</span> = <span>true</span>;
    <span>this</span>.<span>_clicks</span> = <span>0</span>;

    
    <span>this</span>.<span>attachShadow</span>({ <span>mode</span>: <span>&#34;open&#34;</span> });

    
    <span>this</span>.<span>addEventListener</span>(<span>&#34;click&#34;</span>, <span>(<span>e</span>) =&gt;</span> {
      e.<span>preventDefault</span>();
      <span>this</span>.<span>_clicks</span> += <span>1</span>;
      <span>this</span>.<span>_leftSide</span> = !<span>this</span>.<span>_leftSide</span>;
      <span>this</span>.<span>_rerender</span>();
    });

    
    <span>const</span> font = <span>new</span> <span>FontFace</span>(
      <span>&#34;Comic Neue&#34;</span>,
      <span>&#34;url(https://fonts.gstatic.com/s/comicneue/v8/4UaErEJDsxBrF37olUeD_xHM8pxULilENlY.woff2)&#34;</span>,
      {
        <span>style</span>: <span>&#34;normal&#34;</span>,
        <span>weight</span>: <span>&#34;700&#34;</span>,
      },
    );
    font.<span>load</span>().<span>then</span>(<span>(<span>loaded_face</span>) =&gt;</span> {
      
      <span>document</span>.<span>fonts</span>.<span>add</span>(loaded_face);
    });
  }

  <span>connectedCallback</span>(<span></span>) {
    
    <span>this</span>.<span>_rerender</span>();
  }

  <span>attributeChangedCallback</span>(<span>name, oldValue, newValue</span>) {
    
    <span>this</span>.<span>_rerender</span>();
  }

  <span>_rerender</span>(<span></span>) {
    
    <span>const</span> leftMessage = <span>this</span>.<span>getAttribute</span>(<span>&#34;left&#34;</span>) || <span>&#34;groovy&#34;</span>;
    <span>const</span> rightMessage = <span>this</span>.<span>getAttribute</span>(<span>&#34;right&#34;</span>) || <span>&#34;dig it&#34;</span>;

    <span>const</span> dancer = dancers[<span>this</span>.<span>_clicks</span> % dancers.<span>length</span>].<span>join</span>(<span>&#34;\n&#34;</span>);

    
    <span>this</span>.<span>shadowRoot</span>.<span>innerHTML</span> = <span>`
&lt;style&gt;
  /* Shine animation for when the element is (re)rendered */
  @keyframes shine {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
  }
  .dancing-man {
    /* 3 even columns: left dancer right */
    display: inline-grid;
    grid-template-columns: 1fr 1fr 1fr;
    align-items: center;
    gap: 12px;

    /* Looks like a badge/button */
    cursor: pointer;
    border: 2px black solid;
    border-radius: 50%;
    background: linear-gradient(30deg, #e0e0e0, #f9f9f9, #e0e0e0);
    padding: 8px 16px;
    color: #000000;

    /* An offset container for the shine animation */
    position: relative;
    overflow: hidden;
  }
  .dancing-man::before {
    /* The shine animation gradient */
    content: &#34;&#34;;
    position: absolute;
    width: 100%;
    height: 100%;
    transform: translateX(-100%);
    background: linear-gradient(
      30deg,
      transparent 20%,
      transparent 40%,
      rgb(255, 255, 255, 0.4) 50%,
      rgb(255, 255, 255, 0.4) 55%,
      transparent 70%,
      transparent 100%
    );
    animation: shine 400ms 100ms 1 ease-in;
  }
  .dancing-man:active {
    /* Darker colors while pressed */
    background: linear-gradient(30deg, #c4c4c4, #f9f9f9, #c4c4c4);
    border-color: #404040;
  }
  .message_left,
  .message_right {
    font-family: &#39;Comic Neue&#39;;
    font-weight: 700;
    font-style: normal;
    visibility: hidden;
  }
  .dancing-man.right .message_right,
  .dancing-man.left .message_left {
    visibility: visible;
  }
&lt;/style&gt;
&lt;button class=&#34;dancing-man <span>${<span>this</span>._leftSide ? <span>&#34;left&#34;</span> : <span>&#34;right&#34;</span>}</span>&#34;&gt;
  &lt;div class=&#34;message_left&#34;&gt;<span>${leftMessage}</span>&lt;/div&gt;
  &lt;pre class=&#34;dancer&#34;&gt;<span>${dancer}</span>&lt;/pre&gt;
  &lt;div class=&#34;message_right&#34;&gt;<span>${rightMessage}</span>&lt;/div&gt;
&lt;/button&gt;
`</span>;
  }
}

customElements.<span>define</span>(<span>&#34;dancing-man&#34;</span>, <span>DancingManElement</span>);
</pre></div>
<p>These Custom Elements are more flexible than components that just render to the Normal DOM.</p>
<p>With the Shadow DOM, they can act like a sticker: behaving and displaying exactly the same on any website, regardless of
how that website is styled via CSS.</p>
<p>The Shadow DOM <strong>does not</strong> inherit any style from the document .</p>
<p>This makes it so flexible! Instead of looking like the document&#39;s style, the HTML and CSS in this custom element&#39;s
Shadow DOM is viewed in a style-less facade that&#39;s placed on top of the Normal DOM.</p>
<p>This gives you full control over how your component looks and feels.</p>
<dialog popover="" id="note-1">

</dialog>
<a id="just-drop-it-in" href="#just-drop-it-in"><h2>Just drop it in</h2></a>
<p>To demonstrate, go and open up any website, paste that code in the developer tools, and edit the HTML to include a <code>&lt;dancing-man&gt;</code>
of your own. You can just drop it in and forget about it!</p>
<figure>
<video alt="A screen recording of the Washington Post&#39;s website motto replaced by a dancing man saying &#39;democracy dies&#39; and &#39;in darkness&#39;" autoplay="" muted="" loop="" playsinline="" width="500">
  <source src="/img/gifv/dancing-man-wapo.mp4" type="video/mp4"/>
  <source src="/img/gifv/dancing-man-wapo.mov" type="video/mov"/>
</video>
<figcaption>Sure, the tone may be off, but I&#39;m trying to make a point here: <strong>it&#39;s like a sticker</strong></figcaption>
</figure>
<a id="what-else-can-it-do?" href="#what-else-can-it-do%3F"><h2>What else can it do?</h2></a>
<p>The Shadow DOM also lets a Custom Element choose to render its children using the <code>&lt;slot&gt;</code> element.</p>
<p>Our <code>&lt;dancing-man&gt;</code> element does not use a <code>&lt;slot&gt;</code>, so it hides <strong>all</strong> the children it contains:</p>
<div>
<table>
<thead>
<tr>
<th scpoe="col">Rendered</th>
<th scpoe="col">HTML</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<dancing-man left="what will" right="this do">
  <span>Look, I&#39;ve got children!</span>
</dancing-man>
</td>
<td>
<div><pre><span>&lt;<span>dancing-man</span>
  <span>left</span>=<span>&#34;what will&#34;</span>
  <span>right</span>=<span>&#34;this do&#34;</span>
&gt;</span>
  <span>&lt;<span>span</span>&gt;</span>
    Look, I&#39;ve got children!
  <span>&lt;/<span>span</span>&gt;</span>
<span>&lt;/<span>dancing-man</span>&gt;</span>
</pre></div>
</td>
</tr>
</tbody>
</table>
</div>
<p>Here, the user doesn&#39;t see that <code>&lt;span&gt;Look, I&#39;ve got children!&lt;/span&gt;</code> child at all. It&#39;s completely obscured by the
Shadow DOM facade.</p>
<p>This allows our Custom Element to just do what it does well: show a dancing man.</p>
<p>It&#39;s neither constrained by the look and feel of the document nor obligated to show any children given to it.</p>
<p>This is even true for the accessibility tree! (which is what screen readers and other assistive devices use to help
blind/low vision folks understand the document)</p>
<figure>
<img alt="A screenshot of devtools showing that this span has no representation in the accessibility tree" src="https://portswigger.net/img/screenshot/dancing-man-accessibility-tree.png"/>
<figcaption>The &#34;Look, I&#39;ve got children!&#34; span is completely obscured by the Shadow DOM</figcaption>
</figure>
<a id="but-what-if-we-want-to-show-these-children?" href="#but-what-if-we-want-to-show-these-children%3F"><h3>But what if we want to show these children?</h3></a>
<p>If we were to <a href="https://gist.github.com/sufianrhazi/39fb369c1745e73f23fa9a99573858e4/revisions#diff-98102796c334eb7e4d969a8137a73da3955a8e048e2db532fecb7d4a9347cef1">change our code
slightly</a>,
we could use the <code>&lt;slot&gt;</code> element and <code>slot</code> attribute to let our dancing-man dance with its children.</p>
<div>
<table>
<thead>
<tr>
<th scpoe="col">Rendered</th>
<th scpoe="col">HTML</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<dancing-man-slots>
  <span slot="left">just <strong>dance</strong></span>
  <span slot="right">it&#39;ll be <code>ok</code></span>
</dancing-man-slots>
</td>
<td>
<div><pre><span>&lt;<span>dancing-man-slots</span>&gt;</span>
  <span>&lt;<span>span</span> <span>slot</span>=<span>&#34;left&#34;</span>&gt;</span>
    just <span>&lt;<span>strong</span>&gt;</span>dance<span>&lt;/<span>strong</span>&gt;</span>
  <span>&lt;/<span>span</span>&gt;</span>
  <span>&lt;<span>span</span> <span>slot</span>=<span>&#34;right&#34;</span>&gt;</span>
    it&#39;ll be <span>&lt;<span>code</span>&gt;</span>ok<span>&lt;/<span>code</span>&gt;</span>
  <span>&lt;/<span>span</span>&gt;</span>
<span>&lt;/<span>dancing-man-slots</span>&gt;</span>
</pre></div>
</td>
</tr>
</tbody>
</table>
</div>
<p>See how the font is the same as the font in our document? And how the <code>&lt;code&gt;</code> in the child looks like how it does on
this page?</p>
<p>These <code>&lt;slot&gt;</code> elements act like literal slots in a facade, revealing the Plain DOM underneath. Like a window showing
the inside of a building behind its facade.</p>
<p><a href="https://gist.github.com/sufianrhazi/39fb369c1745e73f23fa9a99573858e4/revisions#diff-98102796c334eb7e4d969a8137a73da3955a8e048e2db532fecb7d4a9347cef1L125-L129">The change to our
code</a> was to use <code>&lt;slot name=&#34;left&#34;&gt;</code> and <code>&lt;slot name=&#34;right&#34;&gt;</code> instead of attributes to
place child elements in specific slots within the Shadow DOM:</p>
<div><pre> &lt;button class=&#34;dancing-man ${this._leftSide ? &#34;left&#34; : &#34;right&#34;}&#34;&gt;
<span>-  &lt;div class=&#34;message_left&#34;&gt;${leftMessage}&lt;/div&gt;</span>
<span>+  &lt;slot name=&#34;left&#34; class=&#34;message_left&#34;&gt;groovy&lt;/slot&gt;</span>
  &lt;pre class=&#34;dancer&#34;&gt;${dancer}&lt;/pre&gt;
<span>-  &lt;div class=&#34;message_right&#34;&gt;${rightMessage}&lt;/div&gt;</span>
<span>+  &lt;slot name=&#34;right&#34; class=&#34;message_right&#34;&gt;dig it&lt;/slot&gt;</span>
 &lt;/button&gt;
</pre></div>
<p>The <code>name</code> attribute of <code>&lt;slot name=&#34;left&#34;&gt;groovy&lt;/slot&gt;</code> maps to the <code>slot</code> attribute on our <code>&lt;span slot=&#34;left&#34;&gt;just &lt;strong&gt;dance&lt;/strong&gt;&lt;/span&gt;</code> child.</p>
<p>If no <code>slot=&#34;left&#34;</code> attribute was present, then the fallback content of <code>groovy</code> would be used.</p>
<p>And if you want to show all of the unmapped slots, you can include a <code>&lt;slot&gt;default content&lt;/slot&gt;</code> element in the
Shadow DOM that doesn&#39;t have a <code>name</code> attribute.</p>
<a id="in-conclusion" href="#in-conclusion"><h2>In conclusion</h2></a>
<p>The Shadow DOM is a misleading name. It&#39;s not this scary, hidden thing lurking in the shadows.</p>
<p>It&#39;s a facade (that can have slots) that sits between the user and the Plain DOM.</p>



                </div></div>
  </body>
</html>
