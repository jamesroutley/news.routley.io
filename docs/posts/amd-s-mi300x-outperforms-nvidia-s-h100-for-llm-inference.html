<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.blog.tensorwave.com/amds-mi300x-outperforms-nvidias-h100-for-llm-inference/">Original</a>
    <h1>AMD&#39;s MI300X Outperforms Nvidia&#39;s H100 for LLM Inference</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>There has been much anticipation around AMD’s flagship MI300X accelerator. With unmatched raw <a href="https://www.amd.com/en/products/accelerators/instinct/mi300/mi300x.html">specs</a>, the pressing question remains: Can it outperform NVIDIA’s Hopper architecture in real-world AI workloads? We have some exciting early results to share.</p>



<p>For the past month, <strong><a href="https://tensorwave.com">TensorWave</a> and <a href="https://mk1.ai">MK1</a></strong> have worked closely to unlock performance of AMD hardware for AI inference. To start, we focused on Mixture of Expert (MoE) architectures due to their compute efficiency and popularity – notably used by Mistral, Meta, Databricks, and X.ai for their most powerful open-source LLMs.</p>



<p>The initial results are impressive: using MK1’s inference software, the MI300X <strong>achieves 33% higher throughput compared to the H100 SXM</strong> running vLLM on Mixtral 8x7B for a real-world chat use case. Despite NVIDIA’s software ecosystem being more mature, it is clear that AMD is already a formidable competitor in the AI market. When hardware availability and cost are factored in, the MI300X proves to be an attractive option for enterprises running large-scale inference in the cloud. </p>



<blockquote>
<p>We expect AMD’s performance advantage to climb even higher after further optimization, so stay tuned for more updates!</p>
<cite>-Darrick Horton, CEO TensorWave</cite></blockquote>



<div>
<p><strong>Subscribe to the TensorWave Newsletter</strong></p>




</div>



<p>We invite you to experience the MI300X firsthand at TensorWave, which comes prepackaged with MK1’s inference software. <a href="mailto:alex@tensorwave.com">C</a><a href="mailto:contact@tensorwave.com">ontact us</a> to find out more.</p>



<h2 id="h-inference-benchmarks">Inference Benchmarks</h2>



<p>We conducted extensive offline and online inference tests comparing the MI300X and H100 SXM5 accelerators using the Mixtral 8x7B model.</p>



<ul>
<li><strong>Offline Tests:</strong> These are standardized and provide insights into the performance of the forward pass across different setups.</li>
</ul>



<ul>
<li><strong>Online Tests:</strong> These are more sophisticated and estimate system performance in a real-world setting where multiple users are serviced asynchronously.</li>
</ul>



<p><strong><span>Benchmark Setup</span></strong></p>



<p><strong>AMD</strong></p>



<ul>
<li><strong>Hardware:</strong> TensorWave node equipped with 8 MI300X accelerators, 2 AMD EPYC CPU Processors (192 cores), and 2.3 TB of DDR5 RAM.</li>



<li><strong>MI300X Accelerator: </strong>192GB VRAM, 5.3 TB/s, ~1300 TFLOPS for FP16</li>



<li><strong>Drivers: </strong>ROCm 6.1.2</li>



<li><strong>Inference Stack: </strong>MK1’s inference engine (Flywheel) v0.9.2 and AMD’s ROCm optimized fork of vLLM (rocm/vllm) v0.4.0.</li>



<li><strong>Configuration: </strong>Tensor parallelism set to 1 (tp=1), since we can fit the entire model Mixtral 8x7B in a single MI300X’s 192GB of VRAM.</li>
</ul>



<p><strong>NVIDIA</strong></p>



<ul>
<li><strong>Hardware:</strong> Baremetal node with 8 H100 SXM5 accelerators with NVLink, 160 CPU cores, and 1.2 TB of DDR5 RAM.</li>



<li><strong>H100 SXM5 Accelerator: </strong>80GB VRAM, 3.35 TB/s, ~986 TFLOPS for FP16</li>



<li><strong>Drivers: </strong>CUDA 12.2</li>



<li><strong>Inference Stack: </strong>vLLM v4.3<strong> </strong></li>



<li><strong>Configuration: </strong>Tensor parallelism set to 2 (tp=2), which is required to fit Mixtral 8x7B in two H100’s 80GB VRAM.</li>
</ul>



<p><strong><em>Notes</em></strong></p>



<ul>
<li>All benchmarks are performed using the Mixtral 8x7B model.</li>



<li>All inference frameworks are configured to use FP16 compute paths. Enabling FP8 compute is left for future work.</li>



<li>To make an accurate comparison between the systems with different settings of tensor parallelism, we extrapolate throughput for the MI300X by 2.</li>
</ul>



<h2 id="h-offline-results">Offline Results</h2>



<p>To measure peak throughput for each inference solution, we generate prompts of a fixed size and directly feed them to the model. This method, known as offline batching, enhances hardware efficiency by processing multiple prompts simultaneously. Although larger batch sizes boost throughput, they also increase latency due to more requests being processed. Following standard practice, we constrain requests in a batch to have equal input sizes, and to have equal output sizes.</p>



<p>We assess the throughput of each system by varying the batch size. This was done using a modified version of `benchmark_throughput.py` script in the vLLM repository, refactored to include Flywheel as a backend. Prompts were also randomly generated within a batch to remove caching mechanisms. The performance metrics, detailed in the table below, measure throughput as a function of batch size.</p>



<figure><img decoding="async" width="1024" height="576" src="https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Untitled-design-4-1024x576.png" alt="" srcset="https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Untitled-design-4-1024x576.png 1024w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Untitled-design-4-300x169.png 300w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Untitled-design-4-768x432.png 768w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Untitled-design-4-1536x864.png 1536w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Untitled-design-4.png 1600w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Notably, our results show that <strong>MI300X running MK1 Flywheel outperforms H100 running vLLM for every batch size</strong>, with an increase in performance ranging from 1.22x to 2.94x.</p>



<h2 id="h-online-results-for-chat-data-distribution">Online Results for Chat Data Distribution</h2>



<p>Moving beyond offline metrics, we designed a series of online benchmarks to simulate a realistic typical chat application. This involves generating responses to user inputs that closely mirror actual usage patterns.</p>



<p>Specifically, we simulate chat traffic by spawning independent workers to send requests to an endpoint. We then sweep the number of workers to increase the number of concurrent requests.</p>



<p>In these experiments, requests were generated using a standard text chat distribution with an average of 573 input tokens and 50 output tokens. Note that our benchmarking tool supports arbitrary data distributions; please reach out if you have a specific use case you’d like to test.</p>



<p>The key metrics of interest are:</p>



<ul>
<li><strong>Throughput (Requests per Second)</strong>: The number of requests the system can handle per second for a given workload.</li>



<li><strong>Average Latency (Seconds)</strong>: The average time taken to generate a full response for each request.</li>



<li><strong>Time Per Output Token (TPOT)</strong>: The time to generate each subsequent token (averaged) after the first token, which impacts the overall speed of generating long responses.</li>
</ul>



<p>For the first benchmark, we tested a non-streaming use case where throughput and latency are measured for servicing the <em>full response</em>.</p>



<figure><img decoding="async" width="1024" height="576" src="https://www.blog.tensorwave.com/wp-content/uploads/2024/06/TensorWave-Blog-LATENCY-Img-AMDs-MI300X-Outperforms-NVIDIAs-H100-for-LLM-Inference-1024x576.png" alt="" srcset="https://www.blog.tensorwave.com/wp-content/uploads/2024/06/TensorWave-Blog-LATENCY-Img-AMDs-MI300X-Outperforms-NVIDIAs-H100-for-LLM-Inference-1024x576.png 1024w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/TensorWave-Blog-LATENCY-Img-AMDs-MI300X-Outperforms-NVIDIAs-H100-for-LLM-Inference-300x169.png 300w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/TensorWave-Blog-LATENCY-Img-AMDs-MI300X-Outperforms-NVIDIAs-H100-for-LLM-Inference-768x432.png 768w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/TensorWave-Blog-LATENCY-Img-AMDs-MI300X-Outperforms-NVIDIAs-H100-for-LLM-Inference-1536x864.png 1536w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/TensorWave-Blog-LATENCY-Img-AMDs-MI300X-Outperforms-NVIDIAs-H100-for-LLM-Inference.png 1600w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>At a target average latency of 5 seconds, <strong>two MI300X with tp=1 services 33% more requests per second than two H100s with tp=2</strong>. This means you can service the same number of users with similar quality of service using fewer accelerators!</p>



<p>For the second benchmark, we enable streaming and measure throughput and TPOT for individual tokens as they are streamed out.</p>



<figure><img loading="lazy" decoding="async" width="1024" height="576" src="https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Throughput-1024x576.png" alt="" srcset="https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Throughput-1024x576.png 1024w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Throughput-300x169.png 300w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Throughput-768x432.png 768w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Throughput-1536x864.png 1536w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Throughput.png 1600w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Here we observe that the MI300X has higher throughput for every TPOT compared to the H100. This means the <strong>MI300X can generate text faster at higher traffic volumes</strong>, which is crucial for any LLM application.</p>



<h2 id="h-conclusion">Conclusion</h2>



<p>Our benchmarks demonstrate that AMD&#39;s MI300X outperforms NVIDIA&#39;s H100 in both offline and online inference tasks for MoE architectures like Mixtral 8x7B. The MI300X not only offers higher throughput but also excels in real-world scenarios requiring fast response times. </p>



<p>Given its impressive performance, competitive cost, and hardware availability, the MI300X with MK1 software is an excellent choice for enterprises looking to scale their AI inference capabilities. We encourage you to explore the capabilities of MI300X at TensorWave and experience these benefits first-hand. Contact us to learn more and schedule a test drive of this powerful accelerator!</p>







<figure><a href="https://tensorwave.com/book-a-call?utm_source=twblog&amp;utm_content=unlocking_inference"><img loading="lazy" decoding="async" width="1024" height="576" src="https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Display-Ads-YouTube-Horizontal-Ad-1024x576.png" alt="" srcset="https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Display-Ads-YouTube-Horizontal-Ad-1024x576.png 1024w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Display-Ads-YouTube-Horizontal-Ad-300x169.png 300w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Display-Ads-YouTube-Horizontal-Ad-768x432.png 768w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Display-Ads-YouTube-Horizontal-Ad-1536x864.png 1536w, https://www.blog.tensorwave.com/wp-content/uploads/2024/06/Display-Ads-YouTube-Horizontal-Ad.png 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure>




</div></div>
  </body>
</html>
