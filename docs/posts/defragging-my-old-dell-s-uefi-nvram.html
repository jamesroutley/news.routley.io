<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://artemis.sh/2025/02/22/uefi-nvram-defrag.html">Original</a>
    <h1>Defragging my old Dell&#39;s UEFI NVRAM</h1>
    
    <div id="readability-page-1" class="page"><p>I’m setting up an old Dell box (2011-era tech). I was migrating to some new boot
drives and setting up grub on them again. Got to the point of deleting the old
boot entries and adding new ones, and got an error like <code>Could not prepare boot
variable: No space left on device</code>. Weird, because there weren’t that many EFI
variables, but <code>df -h</code> also reported that efivars was full:</p><div><div><pre><code>efivarfs              64K   60K   0K  100% /sys/firmware/efi/efivars
</code></pre></div></div><p>funky.</p><p>It wasn’t due to a glut of boot entries either; I’m pretty keen on keeping the
old ones cleared out, so we only had a few on here.</p><p>Well, I thought maybe there was a lot of dead space in the nvram that wasn’t in
use but also couldn’t be allocated. So I booted an <a href="https://archlinux.org/packages/extra/any/edk2-shell/">EFI
shell</a>, and did this:</p><div><div><pre><code>fs0:
dmpstore -s efi-vars
dmpstore -d
dmpstore -l efi-vars
</code></pre></div></div><p>Please be careful with these commands, it worked for me but for all I know it
might brick your setup. Check <code>help dmpstore</code> first.</p><div><div><pre><code>efivarfs              64K   14K   46K  24% /sys/firmware/efi/efivars
</code></pre></div></div><p>And all my UEFI configuration seems to be right as I left it before doing this.
So I think this confirms my suspicions.</p></div>
  </body>
</html>
