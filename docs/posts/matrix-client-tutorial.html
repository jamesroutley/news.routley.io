<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://uhoreg.gitlab.io/matrix-tutorial/index.html">Original</a>
    <h1>Matrix Client Tutorial</h1>
    
    <div id="readability-page-1" class="page"><article role="main">
<section id="matrix-client-tutorial">

<div>
<p>Warning</p>
<p>This book is a work in progress.  Most of the information that it contains
should be correct, but it is not complete.</p>
</div>
<p>Welcome to the Matrix.  <a href="https://matrix.org/" rel="nofollow noopener">Matrix<svg aria-hidden="true" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> is an open protocol for
decentralised communication.  Matrix allows users on different servers to
communicate with each other, similar to how people on different email servers
can email each other.</p>
<p>This book is an introduction to creating a client using the <a href="https://spec.matrix.org/unstable/client-server-api/#" rel="nofollow noopener">Matrix
Client-Server API<svg aria-hidden="true" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a>.  It will show how to make HTTP
calls to a Matrix homeserver, and discuss issues that clients will need to
consider, such as reliability and security issues.  It does not attempt to be a
comprehensive guide to the entire Client-Server API, but will point you to the
relevant portions of spec for further details.</p>
<p>You should read this book if:</p>
<ul>
<li><p>you are creating a Matrix library/SDK,</p></li>
<li><p>you are writing a Matrix client without the use of a library/SDK, or</p></li>
<li><p>you want to get a better understanding of how Matrix works.</p></li>
</ul>
<p>If you are creating a Matrix client using a library/SDK, some of the
information in this book may still be useful, but some things will already be
handled by your library/SDK.</p>
<p>We assume that you have:</p>
<ul>
<li><p>an understanding of JSON encoding,</p></li>
<li><p>an understanding of HTTP requests, including HTTP status codes, headers, and
different types of requests (<code>GET</code>, <code>POST</code>, etc.),</p></li>
<li><p>experience writing asynchronous code in your preferred programming language.</p></li>
</ul>
<p>This book is written in a <a href="https://en.wikipedia.org/wiki/Literate_programming" rel="nofollow noopener">literate
programming<svg aria-hidden="true" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> style, which
interleaves code blocks and text.  In short, code blocks are named, and can
reference other code blocks using the syntax <code>{{other code block name}}</code>, which
will insert the code blocks with the given name in place of the reference.
Multiple code blocks can have the same name, in which case they are inserted in
the order that they appear in the book (though in many cases, the order does
not matter).  This allows us to, for example, have a reference such as <code>{{class Foo methods}}</code>, and define the methods of the <code>Foo</code> class in multiple chunks.</p>
<p>The code output of this book will be a library that a Matrix client could use.
The actual user interface for a client is out of scope for this book, although
for some topics, there may be discussion on how clients may wish to display
things to the user.</p>
<p>The code is written in Python using <a href="https://docs.aiohttp.org/" rel="nofollow noopener"><code>aiohttp</code><svg aria-hidden="true" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a>, but
the rest of the content should apply any other programming languages and most
of the code should be easy to port to another language.</p>
<div>
<p>Note</p>
<p>The main purpose of the example code here is to illustrate how the Matrix
Client-Server API is used, rather than to develop a fully-featured library.
While the library generated should be usable for simple situations, it may make
some tradeoffs differently from what a “real” Matrix library would make.  These
tradeoffs will be discussed in the text where appropriate.</p>
</div>
<p>The source for this book, including the example code, is available at
<a href="https://gitlab.com/uhoreg/matrix-tutorial" rel="nofollow noopener">https://gitlab.com/uhoreg/matrix-tutorial<svg aria-hidden="true" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a>.  We will call our Matrix library
the very unimaginative name <code>matrixlib</code>.</p>
<div data-controller="code">

<div><pre><code><span># {{copyright}}</span>

<span>&#34;&#34;&#34;Matrix client library example&#34;&#34;&#34;</span>
</code></pre></div></div>
<p>The main entry point for our library will be a <code>client</code> module.  It will
contain helper functions and a <a href="https://uhoreg.gitlab.io/matrix-tutorial/client.html"><span><code>Client</code> class</span></a>, representing a
client connection.</p>
<div data-controller="code">

<div><pre><code><span># {{copyright}}</span>

<span>&#34;&#34;&#34;General Matrix client functionality&#34;&#34;&#34;</span>

<span>import</span> <span>aiohttp</span>
<span>import</span> <span>asyncio</span>
<span>import</span> <span>logging</span>
<span>import</span> <span>math</span>
<span>import</span> <span>os</span>
<span>import</span> <span>re</span>
<span>import</span> <span>sys</span>
<span>import</span> <span>time</span>
<span>import</span> <span>typing</span>
<span>from</span> <span>urllib.parse</span> <span>import</span> <span>quote</span> <span>as</span> <span>urlquote</span><span>,</span> <span>urljoin</span><span>,</span> <span>urlparse</span>

<span>from</span> <span>.</span> <span>import</span> <span>error</span>
<span>from</span> <span>.</span> <span>import</span> <span>events</span>
<span>from</span> <span>.</span> <span>import</span> <span>pubsub</span>
<span>from</span> <span>.</span> <span>import</span> <span>schema</span>


<span>{{</span><span>client</span> <span>module</span> <span>classes</span><span>}}</span>


<span>{{</span><span>client</span> <span>module</span> <span>functions</span><span>}}</span>
</code></pre></div></div>
<p>In the first chapter of this book, we will discover the basics of the Matrix
Client-Server API.  We will learn how to make requests to the homeserver, log
in and out, and send and receive messages.  Using this, we will create a simple
echo bot.</p>

<p>In the second(?) chapter, we will look at how to perform end-to-end encryption
in Matrix.  We will extend the echo bot from the previous part so that it works
in encrypted rooms.  If you do not need encryption, you may skip this part.</p>

<div id="id1">
<p>Todo</p>
<p>more topics, e.g.</p>
<ul>
<li><p>media repo</p>
<ul>
<li><p>URL previews</p></li>
</ul>
</li>
<li><p>user management</p>
<ul>
<li><p>registering</p></li>
<li><p>device management</p></li>
<li><p>displayname, avatar</p></li>
<li><p>3PIDs</p></li>
</ul>
</li>
<li><p>interacting with rooms</p>
<ul>
<li><p>create room</p></li>
<li><p>room versions and upgrades</p></li>
<li><p>spaces</p></li>
<li><p>room tags</p></li>
<li><p>room directory</p></li>
<li><p>DMs</p></li>
<li><p>invites, knocking</p></li>
<li><p>security issues</p>
<ul>
<li><p>disambiguation, homographs</p></li>
</ul>
</li>
</ul>
</li>
<li><p>more messaging features</p>
<ul>
<li><p>reactions</p></li>
<li><p>edits</p></li>
<li><p>redactions</p></li>
<li><p>IM features (mentions, spoilers, etc)</p></li>
<li><p>typing notifications</p></li>
<li><p>read receipts</p></li>
<li><p>presence</p></li>
</ul>
</li>
<li><p>more on getting events</p>
<ul>
<li><p>navigating within rooms (backfilling, jumping to a message, how to handle having
multiple chunks of timeline)</p></li>
<li><p>sync filtering, lazy loading</p></li>
<li><p>push rules/notifications</p></li>
</ul>
</li>
<li><p>VoIP</p></li>
<li><p>widgets</p></li>
<li><p>how to test</p></li>
<li><p>what client authors need to understand about federation</p></li>
</ul>
</div>

<div data-controller="code">

<div><pre><code>Copyright Hubert Chathi &lt;hubert@uhoreg.ca&gt;

Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

SPDX-License-Identifier: Apache-2.0
</code></pre></div></div>
<p>The theme used is based on <a href="https://sphinxawesome.xyz/" rel="nofollow noopener">Awesome Sphinx Theme<svg aria-hidden="true" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a>
by Kai Welke.  The main text is set in <a href="https://rsms.me/inter/" rel="nofollow noopener">Inter<svg aria-hidden="true" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> by
Rasmus Andersson, with <a href="https://github.com/mozilla/Fira" rel="nofollow noopener">Fira Mono<svg aria-hidden="true" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> by Erik
Spiekermann and Ralph du Carrois used for monospaced text.</p>
</section>
</article></div>
  </body>
</html>
