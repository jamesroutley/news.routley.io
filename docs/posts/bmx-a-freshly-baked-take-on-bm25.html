<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.mixedbread.ai/blog/intro-bmx">Original</a>
    <h1>BMX: A Freshly Baked Take on BM25</h1>
    
    <div id="readability-page-1" class="page"><div><p>We are proud to announce that researchers from Mixedbread and the Hong Kong Polytechnic University have developed a new lexical search algorithm, BMX, that outperforms the current standard BM25 across the board and is easy to use via Mixedbread&#39;s open-source Baguetter library.</p>
<p>Read on to learn about BMX, how it works, our benchmarks, and how to use it in practice. If you want to jump right in, you can look into the paper and the library right here:</p>
<ul>
<li><a href="https://arxiv.org/abs/2408.06643" target="_blank" rel="noreferrer noopener">BMX Paper<svg aria-hidden="true" height="7" viewBox="0 0 6 6" width="7"><path fill="currentColor" d="M1.25215 5.54731L0.622742 4.9179L3.78169 1.75597H1.3834L1.38936 0.890915H5.27615V4.78069H4.40513L4.41109 2.38538L1.25215 5.54731Z"></path></svg></a>: Our research paper covering the approach in more academic detail.</li>
<li><a href="https://github.com/mixedbread-ai/baguetter" target="_blank" rel="noreferrer noopener">Baguetter<svg aria-hidden="true" height="7" viewBox="0 0 6 6" width="7"><path fill="currentColor" d="M1.25215 5.54731L0.622742 4.9179L3.78169 1.75597H1.3834L1.38936 0.890915H5.27615V4.78069H4.40513L4.41109 2.38538L1.25215 5.54731Z"></path></svg></a>: Our reference implementation of BMX and an easy to hack testing framework for information retrieval.</li>
</ul>


<p>Most text search engines are powered by lexical (keyword) search algorithms, the most prominent of which is BM25. It powers search engines for web search, e-commerce, legal search engines, and many more applications. A key strength of <a href="https://en.wikipedia.org/wiki/Okapi_BM25" target="_blank" rel="noreferrer noopener">BM25<svg aria-hidden="true" height="7" viewBox="0 0 6 6" width="7"><path fill="currentColor" d="M1.25215 5.54731L0.622742 4.9179L3.78169 1.75597H1.3834L1.38936 0.890915H5.27615V4.78069H4.40513L4.41109 2.38538L1.25215 5.54731Z"></path></svg></a> is that it performs really well in an out of distribution setting, meaning that it generalizes well on data it has not seen before. However, the keyword search approach comes with its own limitations:</p>
<ol>
<li>BM25 does not consider the similarity between the query and any given document, which could enable a more accurate assessment of this document&#39;s relevance to the query.</li>
<li>Lexical search algorithms lack semantic understanding and are therefore unable to deal with linguistic nuances like synonyms and homonyms. This limitation is a key factor in the underperformance of lexical search compared to domain-specific text embedding-based semantic search.</li>
</ol>
<p>To tackle these challenges, we propose BMX, a lexical search algorithm that incorporates both similarity and semantics. It comes with these key innovations:</p>
<ol>
<li>
<p><strong>Entropy-weighted similarity</strong>: We adjust the similarity scores between query tokens and related documents based on the entropy of each token. This approach reduces the influence of common tokens, allowing less frequent but more meaningful tokens to have a greater impact on the similarity score.</p>
</li>
<li>
<p><strong>Weighted query augmentation (WQA)</strong>: To incorporate semantics into lexical search, we developed a method that processes both the original query and its augmented versions simultaneously within BMX. This approach removes the need for multiple retrievals and reranking steps, leading to increased efficiency.</p>
</li>
</ol>

<p>Now, we will explore the core scoring algorithm in BMX as well as weighted query augmentation (WQA). This will be a math-heavy section, but please bear with us!</p>


<p>To validate our ideas and assess the performance of BMX, we evaluated it extensively on different benchmarks including <a href="https://arxiv.org/abs/2104.08663" target="_blank" rel="noreferrer noopener">BEIR<svg aria-hidden="true" height="7" viewBox="0 0 6 6" width="7"><path fill="currentColor" d="M1.25215 5.54731L0.622742 4.9179L3.78169 1.75597H1.3834L1.38936 0.890915H5.27615V4.78069H4.40513L4.41109 2.38538L1.25215 5.54731Z"></path></svg></a>, <a href="https://arxiv.org/abs/2407.12883" target="_blank" rel="noreferrer noopener">BRIGHT<svg aria-hidden="true" height="7" viewBox="0 0 6 6" width="7"><path fill="currentColor" d="M1.25215 5.54731L0.622742 4.9179L3.78169 1.75597H1.3834L1.38936 0.890915H5.27615V4.78069H4.40513L4.41109 2.38538L1.25215 5.54731Z"></path></svg></a>, and some multilingual benchmarks. You can find a full overview of our benchmarking in the <a href="https://arxiv.org/abs/2408.06643" target="_blank" rel="noreferrer noopener">BMX paper<svg aria-hidden="true" height="7" viewBox="0 0 6 6" width="7"><path fill="currentColor" d="M1.25215 5.54731L0.622742 4.9179L3.78169 1.75597H1.3834L1.38936 0.890915H5.27615V4.78069H4.40513L4.41109 2.38538L1.25215 5.54731Z"></path></svg></a>. Our results show that BMX outperforms BM25 across the board and can offer a significant improvement in retrieval quality.</p>
<h3 id="beir"><a href="#beir">BEIR<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>BEIR is a benchmark focused on out-of-domain information retrieval. It covers datasets for different domains, document or query lengths, and tasks. After evaluation on the 15 available benchmarks, we compare BMX to the implementations of BM25 in <a href="https://github.com/mixedbread-ai/baguetter" target="_blank" rel="noreferrer noopener">Baguetter<svg aria-hidden="true" height="7" viewBox="0 0 6 6" width="7"><path fill="currentColor" d="M1.25215 5.54731L0.622742 4.9179L3.78169 1.75597H1.3834L1.38936 0.890915H5.27615V4.78069H4.40513L4.41109 2.38538L1.25215 5.54731Z"></path></svg></a> and the <a href="https://github.com/xhluca/bm25s" target="_blank" rel="noreferrer noopener">bm25s<svg aria-hidden="true" height="7" viewBox="0 0 6 6" width="7"><path fill="currentColor" d="M1.25215 5.54731L0.622742 4.9179L3.78169 1.75597H1.3834L1.38936 0.890915H5.27615V4.78069H4.40513L4.41109 2.38538L1.25215 5.54731Z"></path></svg></a> library:</p>
<div><table><thead><tr><th>Model</th><th>AA</th><th>SD</th><th>SF</th><th>NFC</th><th>TCV</th><th>TCH</th><th>FQA</th><th>HQA</th><th>MM</th><th>FVR</th><th>NQ</th><th>DBP</th><th>QRA</th><th>CF</th><th>CQA</th><th>Avg.</th></tr></thead><tbody><tr><td><strong>BM25S, k1=1.2, b=0.75</strong></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Robertson</td><td>49.2</td><td>15.5</td><td>68.3</td><td>31.9</td><td>59.0</td><td>33.8</td><td>25.4</td><td>58.5</td><td>22.6</td><td>50.3</td><td>29.2</td><td>30.3</td><td>80.4</td><td>13.7</td><td>29.9</td><td>39.87</td></tr><tr><td>ATIRE</td><td>48.7</td><td>15.6</td><td>68.1</td><td>31.8</td><td>61.0</td><td>33.2</td><td>25.3</td><td>58.5</td><td>22.6</td><td>50.3</td><td>29.1</td><td>30.3</td><td>80.5</td><td>13.7</td><td>30.1</td><td>39.92</td></tr><tr><td>BM25+</td><td>48.7</td><td>15.6</td><td>68.1</td><td>31.8</td><td>61.0</td><td>33.2</td><td>25.3</td><td>58.5</td><td>22.6</td><td>50.3</td><td>29.1</td><td>30.3</td><td>80.5</td><td>13.7</td><td>30.1</td><td>39.92</td></tr><tr><td>BM25L</td><td>49.6</td><td>15.8</td><td>68.7</td><td>32.2</td><td>62.9</td><td>33.0</td><td>25.0</td><td>55.9</td><td>21.4</td><td>46.6</td><td>28.1</td><td>29.4</td><td>80.3</td><td>13.5</td><td>29.8</td><td>39.48</td></tr><tr><td>BM25</td><td>48.7</td><td>15.6</td><td>68.0</td><td>31.8</td><td>61.0</td><td>33.2</td><td>25.3</td><td>58.5</td><td>22.6</td><td>50.3</td><td>29.1</td><td>30.3</td><td><strong>80.5</strong></td><td><strong>13.7</strong></td><td>30.1</td><td>39.91</td></tr><tr><td><strong>Baguetter, k1=1.2, b=0.75</strong></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Robertson</td><td>49.55</td><td>15.69</td><td>68.71</td><td>32.85</td><td>64.36</td><td>30.95</td><td>25.27</td><td>59.13</td><td>23.19</td><td>50.93</td><td>28.55</td><td>31.69</td><td>78.73</td><td>13.54</td><td>30.73</td><td>40.26</td></tr><tr><td>ATIRE</td><td>49.23</td><td>15.66</td><td>68.73</td><td>32.71</td><td>65.94</td><td>31.15</td><td>25.30</td><td>59.13</td><td>23.23</td><td>50.98</td><td>28.59</td><td>31.56</td><td>78.72</td><td>13.55</td><td>31.00</td><td>40.37</td></tr><tr><td>BM25+</td><td>49.23</td><td>15.66</td><td>68.73</td><td>32.71</td><td>65.94</td><td>31.15</td><td>25.30</td><td>59.13</td><td>23.23</td><td>50.98</td><td>28.59</td><td>31.56</td><td>78.72</td><td>13.55</td><td><strong>31.00</strong></td><td>40.37</td></tr><tr><td>BM25L</td><td>50.32</td><td>15.88</td><td>69.37</td><td><strong>33.00</strong></td><td>67.05</td><td>31.52</td><td>24.79</td><td>56.35</td><td>22.01</td><td>47.37</td><td>27.35</td><td>30.87</td><td>78.21</td><td>13.29</td><td>30.87</td><td>39.88</td></tr><tr><td>BM25</td><td>49.32</td><td>15.65</td><td>68.67</td><td>32.68</td><td>65.78</td><td>31.11</td><td>25.26</td><td>59.09</td><td>23.24</td><td>50.98</td><td>28.85</td><td>31.56</td><td>78.73</td><td>13.55</td><td>30.99</td><td>40.36</td></tr><tr><td><strong>BMX</strong></td><td><strong>50.46</strong></td><td><strong>15.91</strong></td><td><strong>69.42</strong></td><td>32.84</td><td><strong>68.1</strong></td><td><strong>34.34</strong></td><td><strong>25.39</strong></td><td><strong>61.73</strong></td><td><strong>24.21</strong></td><td><strong>55.75</strong></td><td><strong>29.84</strong></td><td><strong>32.2</strong></td><td>78.56</td><td>13.32</td><td>30.77</td><td><strong>41.52</strong></td></tr></tbody></table></div>
<p>As the table shows, BMX generally outperforms all BM25 variants, achieving the best results on 11 out of 15 datasets. In our view, this underscores the importance of incorporating query-document similarity in our search algorithm.</p>
<p>Other than that, we also observe that embedding-based models consistently outperform lexical models, which can be attributed to their powerful semantic understanding. However, due to their significant advantage regarding resource requirements, lexical search algorithms still remain much more widely used.</p>
<h3 id="bright"><a href="#bright">BRIGHT<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>BRIGHT was introduced as the first text retrieval benchmark requiring intensive reasoning to retrieve the relevant documents. The benchmark includes 1,385 real-world queries across diverse domains such as StackExchange, LeetCode, and math competitions. These queries are paired with, for example, relevant web pages linked in StackExchange answers and theorems tagged in math Olympiad questions, all of which necessitate deliberate reasoning to identify their connections to the respective queries. For this evaluation, we also took a look at the performance of BMX with WQA.</p>
<div><table><thead><tr><th>Model</th><th>BIO</th><th>ES</th><th>ECO</th><th>PSY</th><th>ROB</th><th>SO</th><th>SL</th><th>LC</th><th>PONY</th><th>AOPS</th><th>TQ</th><th>TT</th><th>Avg.</th></tr></thead><tbody><tr><td><strong>Embedding Models</strong></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>E5-Mistral-7B</td><td>18.80</td><td>26.00</td><td>15.50</td><td>15.80</td><td>16.40</td><td>9.80</td><td><strong>18.50</strong></td><td>28.70</td><td>4.80</td><td>7.10</td><td>23.90</td><td><strong>25.10</strong></td><td>17.50</td></tr><tr><td><strong>Proprietary Models</strong></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>OpenAI</td><td>23.70</td><td>26.30</td><td>20.00</td><td><strong>27.50</strong></td><td>12.90</td><td>12.50</td><td>20.30</td><td>23.60</td><td>2.50</td><td>8.50</td><td>22.20</td><td>10.80</td><td>17.57</td></tr><tr><td>Cohere</td><td>19.00</td><td>27.50</td><td>20.20</td><td>21.80</td><td>16.20</td><td>16.50</td><td>17.70</td><td>26.80</td><td>1.80</td><td>6.50</td><td>15.10</td><td>7.10</td><td>16.35</td></tr><tr><td>Voyage</td><td>23.60</td><td>25.10</td><td>19.80</td><td>24.80</td><td>11.20</td><td>15.00</td><td>15.60</td><td><strong>30.60</strong></td><td>1.50</td><td>7.40</td><td><strong>26.10</strong></td><td>11.10</td><td>17.65</td></tr><tr><td><strong>Lexical Models</strong></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>BM25 (<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mn>1</mn><mo>=</mo><mn>0.9</mn></mrow><annotation encoding="application/x-tex">k1=0.9</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>k</span><span>1</span><span></span><span>=</span><span></span></span><span><span></span><span>0.9</span></span></span></span>, <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>0.4</mn></mrow><annotation encoding="application/x-tex">b=0.4</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>b</span><span></span><span>=</span><span></span></span><span><span></span><span>0.4</span></span></span></span>)</td><td>19.25</td><td>29.67</td><td>16.89</td><td>15.77</td><td>14.19</td><td>15.22</td><td>15.30</td><td>25.05</td><td>4.62</td><td>8.28</td><td>6.57</td><td>2.34</td><td>14.43</td></tr><tr><td>BM25 (<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mn>1</mn><mo>=</mo><mn>0.9</mn></mrow><annotation encoding="application/x-tex">k1=0.9</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>k</span><span>1</span><span></span><span>=</span><span></span></span><span><span></span><span>0.9</span></span></span></span>, <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>0.4</mn></mrow><annotation encoding="application/x-tex">b=0.4</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>b</span><span></span><span>=</span><span></span></span><span><span></span><span>0.4</span></span></span></span>) + WQA</td><td>22.9</td><td>33.86</td><td>17.2</td><td>24.33</td><td>14.54</td><td><strong>20.21</strong></td><td>16.01</td><td>26.61</td><td>6.03</td><td>8.41</td><td>10.50</td><td>3.29</td><td>16.99</td></tr><tr><td>BMX (<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha=0.05</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>α</span><span></span><span>=</span><span></span></span><span><span></span><span>0.05</span></span></span></span>)</td><td>26.4</td><td>33.55</td><td>13.29</td><td>16.06</td><td>14.68</td><td>13.80</td><td>15.47</td><td>25.35</td><td><strong>10.91</strong></td><td>9.18</td><td>8.17</td><td>2.38</td><td>15.77</td></tr><tr><td>BMX (<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha=0.05</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>α</span><span></span><span>=</span><span></span></span><span><span></span><span>0.05</span></span></span></span>) + WQA</td><td><strong>31.57</strong></td><td><strong>40.24</strong></td><td>17.40</td><td>23.53</td><td><strong>16.67</strong></td><td>18.32</td><td>15.05</td><td>28.34</td><td>10.82</td><td><strong>9.22</strong></td><td>9.98</td><td>2.74</td><td><strong>18.66</strong></td></tr></tbody></table></div>
<p>The table demonstrates that BMX with weighted query augmentation outperforms all baselines, including embedding models and other lexical models. We attribute this to BMX&#39;s ability to generalize effectively across various domains, while embedding models often struggle with out-of-domain data. The results highlight that the WQA mechanism successfully enhances BMX’s semantic understanding, enabling it to handle realistic retrieval scenarios more effectively than alternative solutions. Also, BMX achieves this without the need for costly training on massive high-quality datasets, as would be required for embedding models.</p>
<h3 id="multilingual-benchmark"><a href="#multilingual-benchmark">Multilingual Benchmark<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>To verify the performance of BMX on multilingual data, we also performed benchmarking on datasets for Chinese, Japanese, Korean, German, and French retrieval tasks.</p>
<div><table><thead><tr><th><strong>Model</strong></th><th>MMarcoRetrieval (Chinese)</th><th>JaQuAD (Japanese)</th><th>StrategyQA (Korean)</th><th>GermanDPR (German)</th><th>FQuAD (French)</th><th><strong>Avg.</strong></th></tr></thead><tbody><tr><td>BM25</td><td>47.41</td><td>54.26</td><td>33.89</td><td>52.27</td><td>91.80</td><td>55.93</td></tr><tr><td><strong>BMX</strong></td><td><strong>47.94</strong></td><td><strong>54.63</strong></td><td><strong>35.72</strong></td><td><strong>53.58</strong></td><td><strong>91.92</strong></td><td><strong>56.76</strong></td></tr></tbody></table></div>
<p>The table presents the evaluation results, demonstrating that BMX consistently outperforms BM25 across these multilingual datasets. This suggests the increased effectiveness of BMX in handling diverse multilingual information retrieval tasks.</p>

<h3 id="installation"><a href="#installation">Installation<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Before you start, make sure to install the Baguetter library:</p>
<figure></figure>
<h3 id="usage"><a href="#usage">Usage<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>The following examples show how to use BMX in practice:</p>


<p>Improving the quality of lexical search without a significant increase in complexity or computational resource requirements could lead to a range of beneficial outcomes. Using BMX could improve the user experience of any application that relies on search algorithms. We also expect performance benefits for natural language processing applications that include our algorithm as part of their pipeline.</p>
<p>We&#39;re excited to hear about the community&#39;s opinions on BMX and where this algorithm could be used in the future. If you want to give us feedback or discuss anything search- or machine learning-related, please come join our <a href="https://www.mixedbread.ai/redirects/discord" target="_blank" rel="noreferrer noopener">Discord community<svg aria-hidden="true" height="7" viewBox="0 0 6 6" width="7"><path fill="currentColor" d="M1.25215 5.54731L0.622742 4.9179L3.78169 1.75597H1.3834L1.38936 0.890915H5.27615V4.78069H4.40513L4.41109 2.38538L1.25215 5.54731Z"></path></svg></a>.</p></div></div>
  </body>
</html>
