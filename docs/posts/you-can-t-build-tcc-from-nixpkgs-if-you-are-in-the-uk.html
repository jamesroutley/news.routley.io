<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/NixOS/nixpkgs/issues/444342">Original</a>
    <h1>You can&#39;t build tcc from Nixpkgs if you are in the UK</h1>
    
    <div id="readability-page-1" class="page"><div id="issue-body-viewer" data-testid="issue-body-viewer"><div data-testid="markdown-body" data-team-hovercards-enabled="true" data-turbolinks="false"><div><h3 dir="auto">Nixpkgs version</h3>
<ul dir="auto">
<li>Stable (25.05)</li>
</ul>
<h3 dir="auto">Steps to reproduce</h3>
<p dir="auto">The <code>fetchFromRepoOrCz</code> function in <code>pkgs/build-support/fetchrepoorcz/default.nix</code> downloads sources from <a href="https://repo.or.cz/" rel="nofollow">https://repo.or.cz/</a></p>
<p dir="auto">Unfortunately, the site <strong>blocks connections from the UK due to the Online Safety act</strong> and redirects all requests to <a href="https://repo.or.cz/uk-blocked.html" rel="nofollow">https://repo.or.cz/uk-blocked.html</a></p>
<p dir="auto">I noticed this while trying to build <code>docutils</code> from a UK-based build machine. The build error is</p>
<div data-snippet-clipboard-copy-content="nix log /nix/store/q9q3xki1m7miwk8p9dqb6wjlq8mg0m11-source.drv

trying https://repo.or.cz/docutils.git/snapshot/docutils-0.21.2.tar.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   242  100   242    0     0    331      0 --:--:-- --:--:-- --:--:--   331
100  2517  100  2517    0     0   3275      0 --:--:-- --:--:-- --:--:--     0
unpacking source archive /build/docutils-0.21.2.tar.gz

gzip: stdin: not in gzip format
tar: Child returned status 1
tar: Error is not recoverable: exiting now
do not know how to unpack source archive /build/docutils-0.21.2.tar.gz"><pre><code>nix log /nix/store/q9q3xki1m7miwk8p9dqb6wjlq8mg0m11-source.drv

trying https://repo.or.cz/docutils.git/snapshot/docutils-0.21.2.tar.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   242  100   242    0     0    331      0 --:--:-- --:--:-- --:--:--   331
100  2517  100  2517    0     0   3275      0 --:--:-- --:--:-- --:--:--     0
unpacking source archive /build/docutils-0.21.2.tar.gz

gzip: stdin: not in gzip format
tar: Child returned status 1
tar: Error is not recoverable: exiting now
do not know how to unpack source archive /build/docutils-0.21.2.tar.gz
</code></pre></div>
<p dir="auto">In fact, if one runs <code>curl -LO https://repo.or.cz/docutils.git/snapshot/docutils-0.21.2.tar.gz</code> the resulting file will contain the data from <a href="https://repo.or.cz/uk-blocked.html" rel="nofollow">https://repo.or.cz/uk-blocked.html</a> which is not a valid gzip archive.</p>
<p dir="auto">I searched for issues mentioning <code>fetchFromRepoOrCz</code> but found none.</p>
<p dir="auto">A quick search with <code>rg</code> in the repository returns only 7 packages using the function:</p>
<ul dir="auto">
<li>pkgs/by-name/wi/windowmaker/package.nix (declared but not used)</li>
<li>pkgs/by-name/ti/tinycc/package.nix</li>
<li>pkgs/applications/editors/vim/plugins/nvim-treesitter/generated.nix (declared but not used)</li>
<li>pkgs/by-name/cd/cdimgtools/package.nix</li>
<li>pkgs/by-name/sy/syslinux/package.nix</li>
<li>pkgs/by-name/gl/glpng/package.nix</li>
<li>pkgs/development/python-modules/docutils/default.nix</li>
</ul>
<h3 dir="auto">Can Hydra reproduce this build failure?</h3>
<p dir="auto">No, Hydra cannot reproduce this build failure.</p>
<h3 dir="auto">Link to Hydra build job</h3>
<p dir="auto"><em>No response</em></p>
<h3 dir="auto">Relevant log output</h3>
<p dir="auto"><strong>docutils</strong> on an i686</p>
<div dir="auto" data-snippet-clipboard-copy-content="nix log /nix/store/q9q3xki1m7miwk8p9dqb6wjlq8mg0m11-source.drv

trying https://repo.or.cz/docutils.git/snapshot/docutils-0.21.2.tar.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   242  100   242    0     0    331      0 --:--:-- --:--:-- --:--:--   331
100  2517  100  2517    0     0   3275      0 --:--:-- --:--:-- --:--:--     0
unpacking source archive /build/docutils-0.21.2.tar.gz

gzip: stdin: not in gzip format
tar: Child returned status 1
tar: Error is not recoverable: exiting now
do not know how to unpack source archive /build/docutils-0.21.2.tar.gz"><pre><span>nix log /nix/store/q9q3xki1m7miwk8p9dqb6wjlq8mg0m11-source.drv</span>

<span>trying https://repo.or.cz/docutils.git/snapshot/docutils-0.21.2.tar.gz</span>
<span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span>
<span>                                 Dload  Upload   Total   Spent    Left  Speed</span>
<span>100   242  100   242    0     0    331      0 --:--:-- --:--:-- --:--:--   331</span>
<span>100  2517  100  2517    0     0   3275      0 --:--:-- --:--:-- --:--:--     0</span>
<span>unpacking source archive /build/docutils-0.21.2.tar.gz</span>

<span>gzip: stdin: not in gzip format</span>
<span>tar: Child returned status 1</span>
<span>tar: Error is not recoverable: exiting now</span>
<span>do not know how to unpack source archive /build/docutils-0.21.2.tar.gz</span></pre></div>
<p dir="auto"><strong>tinycc</strong> on an i686</p>
<div dir="auto" data-snippet-clipboard-copy-content="nix-build -I nixpkgs=/etc/nixpkgs &#39;&lt;nixpkgs&gt;&#39; --attr tinycc
these 3 derivations will be built:
  /nix/store/gbzvgibfic9nm3d3ssvvqf00f6n9pryx-source.drv
  /nix/store/hlp8s9r43dbrzdw3xrqg19hl8fbn7x0b-libtcc.pc.drv
  /nix/store/2kf9hm960vfzjwnrdiq2z5pqfa4g680j-tcc-0.9.27-unstable-2025-01-06.drv
building &#39;/nix/store/hlp8s9r43dbrzdw3xrqg19hl8fbn7x0b-libtcc.pc.drv&#39;...
building &#39;/nix/store/gbzvgibfic9nm3d3ssvvqf00f6n9pryx-source.drv&#39;...

trying https://repo.or.cz/tinycc.git/snapshot/f6385c05308f715bdd2c06336801193a21d69b50.tar.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   242  100   242    0     0    787      0 --:--:-- --:--:-- --:--:--   788
100  2517  100  2517    0     0   7423      0 --:--:-- --:--:-- --:--:--  7423
unpacking source archive /build/f6385c05308f715bdd2c06336801193a21d69b50.tar.gz

gzip: stdin: not in gzip format
tar: Child returned status 1
tar: Error is not recoverable: exiting now
do not know how to unpack source archive /build/f6385c05308f715bdd2c06336801193a21d69b50.tar.gz
error: builder for &#39;/nix/store/gbzvgibfic9nm3d3ssvvqf00f6n9pryx-source.drv&#39; failed with exit code 1
error: 1 dependencies of derivation &#39;/nix/store/2kf9hm960vfzjwnrdiq2z5pqfa4g680j-tcc-0.9.27-unstable-2025-01-06.drv&#39; failed to build"><pre><span>nix-build -I nixpkgs=/etc/nixpkgs &#39;&lt;nixpkgs&gt;&#39; --attr tinycc</span>
<span>these 3 derivations will be built:</span>
<span>  /nix/store/gbzvgibfic9nm3d3ssvvqf00f6n9pryx-source.drv</span>
<span>  /nix/store/hlp8s9r43dbrzdw3xrqg19hl8fbn7x0b-libtcc.pc.drv</span>
<span>  /nix/store/2kf9hm960vfzjwnrdiq2z5pqfa4g680j-tcc-0.9.27-unstable-2025-01-06.drv</span>
<span>building &#39;/nix/store/hlp8s9r43dbrzdw3xrqg19hl8fbn7x0b-libtcc.pc.drv&#39;...</span>
<span>building &#39;/nix/store/gbzvgibfic9nm3d3ssvvqf00f6n9pryx-source.drv&#39;...</span>

<span>trying https://repo.or.cz/tinycc.git/snapshot/f6385c05308f715bdd2c06336801193a21d69b50.tar.gz</span>
<span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span>
<span>                                 Dload  Upload   Total   Spent    Left  Speed</span>
<span>100   242  100   242    0     0    787      0 --:--:-- --:--:-- --:--:--   788</span>
<span>100  2517  100  2517    0     0   7423      0 --:--:-- --:--:-- --:--:--  7423</span>
<span>unpacking source archive /build/f6385c05308f715bdd2c06336801193a21d69b50.tar.gz</span>

<span>gzip: stdin: not in gzip format</span>
<span>tar: Child returned status 1</span>
<span>tar: Error is not recoverable: exiting now</span>
<span>do not know how to unpack source archive /build/f6385c05308f715bdd2c06336801193a21d69b50.tar.gz</span>
<span>error: builder for &#39;/nix/store/gbzvgibfic9nm3d3ssvvqf00f6n9pryx-source.drv&#39; failed with exit code 1</span>
<span>error: 1 dependencies of derivation &#39;/nix/store/2kf9hm960vfzjwnrdiq2z5pqfa4g680j-tcc-0.9.27-unstable-2025-01-06.drv&#39; failed to build</span></pre></div>
<p dir="auto"><strong>cdimgtools</strong> on an x86_64</p>
<div dir="auto" data-snippet-clipboard-copy-content="nix build --offline &#39;nixpkgs#cdimgtools&#39;
error: builder for &#39;/nix/store/4lr0c2yqa9l3a4fka97fncvhkvh14sc2-source.drv&#39; failed with exit code 1;
       last 12 log lines:
       &gt;
       &gt; trying https://repo.or.cz/cdimgtools.git/snapshot/version/0.3.tar.gz
       &gt;   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
       &gt;                                  Dload  Upload   Total   Spent    Left  Speed
       &gt; 100   242  100   242    0     0    623      0 --:--:-- --:--:-- --:--:--   623
       &gt; 100  2517  100  2517    0     0   5007      0 --:--:-- --:--:-- --:--:--  5007
       &gt; unpacking source archive /build/0.3.tar.gz
       &gt;
       &gt; gzip: stdin: not in gzip format
       &gt; tar: Child returned status 1
       &gt; tar: Error is not recoverable: exiting now
       &gt; do not know how to unpack source archive /build/0.3.tar.gz"><pre><span>nix build --offline &#39;nixpkgs#cdimgtools&#39;</span>
<span>error: builder for &#39;/nix/store/4lr0c2yqa9l3a4fka97fncvhkvh14sc2-source.drv&#39; failed with exit code 1;</span>
<span>       last 12 log lines:</span>
<span>       &gt;</span>
<span>       &gt; trying https://repo.or.cz/cdimgtools.git/snapshot/version/0.3.tar.gz</span>
<span>       &gt;   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span>
<span>       &gt;                                  Dload  Upload   Total   Spent    Left  Speed</span>
<span>       &gt; 100   242  100   242    0     0    623      0 --:--:-- --:--:-- --:--:--   623</span>
<span>       &gt; 100  2517  100  2517    0     0   5007      0 --:--:-- --:--:-- --:--:--  5007</span>
<span>       &gt; unpacking source archive /build/0.3.tar.gz</span>
<span>       &gt;</span>
<span>       &gt; gzip: stdin: not in gzip format</span>
<span>       &gt; tar: Child returned status 1</span>
<span>       &gt; tar: Error is not recoverable: exiting now</span>
<span>       &gt; do not know how to unpack source archive /build/0.3.tar.gz</span></pre></div>
<h3 dir="auto">Additional context</h3>
<p dir="auto"><em>No response</em></p>
<h3 dir="auto">System metadata</h3>
<ul dir="auto">
<li>system: <code>&#34;i686-linux&#34;</code></li>
<li>host os: <code>Linux 6.12.42, NixOS, 25.05 (Warbler), 25.05.20250819.a58390a</code></li>
<li>multi-user?: <code>no</code></li>
<li>sandbox: <code>yes</code></li>
<li>version: <code>nix-env (Nix) 2.28.4</code></li>
<li>nixpkgs: <code>/nix/store/lgzfgc1acidk895knamw9kywlhmdwv9h-source</code></li>
</ul>
<h3 dir="auto">Notify maintainers</h3>
<ul dir="auto">
<li>docutils: <strong>no maintainer</strong></li>
<li>tinycc: <a data-hovercard-type="user" data-hovercard-url="/users/joachifm/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/joachifm">@joachifm</a></li>
<li>syslinux: <strong>no maintainer</strong></li>
<li>cdimgtools: <a data-hovercard-type="user" data-hovercard-url="/users/hhm0/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/hhm0">@hhm0</a></li>
<li>glpng: <strong>no maintainer</strong></li>
</ul>
<hr/>
<p dir="auto"><strong>Note for maintainers:</strong> Please tag this issue in your pull request description. (i.e. <code>Resolves #ISSUE</code>.)</p>
<h3 dir="auto">I assert that this issue is relevant for Nixpkgs</h3>
<ul>
<li> I assert that this is a bug and not a support request.</li>
<li> I assert that this is not a <a href="https://github.com/NixOS/nixpkgs/issues?q=is%3Aopen+is%3Aissue+label%3A%220.kind%3A+build+failure%22">duplicate of an existing issue</a>.</li>
<li> I assert that I have read the <a href="https://github.com/NixOS/.github/blob/master/CODE_OF_CONDUCT.md">NixOS Code of Conduct</a> and agree to abide by it.</li>
</ul>
<h3 dir="auto">Is this issue important to you?</h3>
<p dir="auto">Add a 👍 <a href="https://github.blog/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/" rel="nofollow">reaction</a> to <a href="https://github.com/NixOS/nixpkgs/issues?q=is%3Aissue+is%3Aopen+sort%3Areactions-%2B1-desc">issues you find important</a>.</p></div></div><div><!--$--><p><span data-direction="ne" role="tooltip" aria-hidden="true" id=":R4daklmb:">Lillecarl</span><span data-direction="ne" role="tooltip" aria-hidden="true" id=":R4taklmb:">Lillecarl, clemlesne and e-magon</span></p><!--/$--></div></div></div>
  </body>
</html>
