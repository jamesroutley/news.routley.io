<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://far.computer/how-to/">Original</a>
    <h1>How to repurpose your old phone into a web server</h1>
    
    <div id="readability-page-1" class="page"><div>
<p><a href="https://far.computer/">back to home</a></p>
<hr/>


<p>this webpage is hosted on a drawer-bound fairphone 2 from 2015, running <a href="https://postmarketos.org/">postmarketos</a></p>
<p>in this tutorial you will be guided through the steps taken to get there</p>
<p>you will end up with a small home server, able to run basic services</p>
<p>we aim to reduce e-waste, encourage reuse and give a second life to forgotten chips</p>
<p>you will need</p>
<ul>
<li>an unused android phone</li>
<li>a charger and power source</li>
<li>a wifi connection</li>
<li>a computer running linux (natively or in a virtual machine)</li>
</ul>
<hr/>
<h2>step 1: installing postmarketos</h2>
<p>first step is installing <a href="https://postmarketos.org/">postmarketos</a> on your phone</p>
<p>find your device in the <a href="https://wiki.postmarketos.org/wiki/Devices">devices page</a> and verify that your device is properly supported</p>
<p>keep that page open throughout the installation</p>
<p>install <a href="https://wiki.postmarketos.org/wiki/Pmbootstrap/Installation">pmbootstrap</a>, the main command-line application for postmarketos</p>
<p>we&#39;ll first generate the image, then flash it to the device</p>
<h3>generate the image</h3>
<p>update the ports and initialize your device information:</p>
<pre><code>$ pmbootstrap pull
$ pmbootstrap init
</code></pre>
<p>when asked for the codename for your device, provide the one listed in your device&#39;s page you opened above</p>
<p>when asked for which user interface to use, you can choose <code>console</code> (which should be the most minimal option) or <code>fbkeyboard</code> to have a minimal keyboard on-screen (which you shouldn&#39;t have to use thanks to ssh, but just in case, it&#39;s fun)</p>
<p>generate the image:</p>
<pre><code>$ pmbootstrap install
</code></pre>
<h3>flash the image</h3>
<p>check your device&#39;s page for how to boot your device in flash mode</p>
<p>usually this means powering the device on with the &#34;volume down&#34; button pressed</p>
<p>connect the phone into your computer and boot it in flash mode</p>
<p>next, check the <code>Installation</code> section of the page and follow any instructions listed there</p>
<p>finally, if you have not already, flash the image to the device:</p>
<pre><code>$ pmbootstrap flasher flash_rootfs
</code></pre>
<p>then, reboot the device and verify that postmarketos starts-up correctly</p>
<hr/>
<h2>step 2: setting up your server</h2>
<p>now that your phone is postmarketos&#39;ed, let&#39;s log into it</p>
<p>the default postmarketos username/password combination is <code>user</code>/<code>147147</code></p>
<p>keep the phone connected to your computer and ssh into it:</p>
<pre><code>$ ssh user@172.16.42.1
</code></pre>
<p>connect the phone to your wifi network:</p>
<pre><code>$ nmcli device wifi connect your_wifi_network --ask
</code></pre>
<p>congrats, you now officially have a little local phone server</p>
<p>running this command should show you the phone&#39;s local ip address:</p>
<pre><code>$ ip -4 addr show wlan0 | grep inet | awk &#39;{print $2}&#39; | cut -d&#39;/&#39; -f1
</code></pre>
<p>on a typical home router it will have the form <code>192.168.1.x</code></p>
<p>you can now plug the phone somewhere safe and connect to it via wifi:</p>
<pre><code>ssh user@192.168.1.x
</code></pre>
<hr/>
<h2>step 3: serving a web page</h2>
<p>create the <code>/var/www/html/</code> directory:</p>
<pre><code>sudo mkdir -p /var/www/html/
</code></pre>
<p>write a simple hello world html file:</p>
<pre><code>$ sudo sh -c &#39;echo &#34;&lt;h1&gt;hello world&lt;/h1&gt;&#34; &gt; /var/www/html/index.html&#39;
</code></pre>
<p>add a nftables rule to allow incoming packets on port 80, in <code>/etc/nftables.d/99_http.nft</code>:</p>
<pre><code>inet filter input tcp dport 80 ct state new accept
</code></pre>
<p>then restart nftables:</p>
<pre><code>$ sudo systemctl restart nftables
</code></pre>
<p>run the following to launch your webserver:</p>
<pre><code>$ httpd -h /var/www/html/
</code></pre>
<p>test out the server by curling the website from your computer:</p>
<pre><code>$ curl 192.168.1.x
</code></pre>
<p>you should see the <code>&lt;h1&gt;hello world&lt;/h1&gt;</code> text from above</p>
<p>now type the ip address in the web browser of any device connected to the same wifi network, and marvel at your own tiny local digital garden</p>
<p>note that this http server will not be automatically restarted if your phone reboots for any reason</p>
<hr/>
<h2>extra: remote access</h2>
<p>as a preemptive security measure, i would recommend <strong>not</strong> to open port <code>22</code> (used for ssh) to the wider internet</p>
<p>instead you should set up a vpn access to your router box (most support this on their web interfaces) if you need remote access</p>
<p>once you are connected to your local network, access the phone using ssh as before</p>
<p>if you know what you are doing and still want to open up port <code>22</code> to the internet, remember to disable password login and set up <a href="https://wiki.archlinux.org/title/SSH_keys">ssh keys</a></p>
<hr/>
<h2>extra: maintenance</h2>
<p>to update the packages on your server, run:</p>
<pre><code>$ sudo apk update
$ sudo apk upgrade
</code></pre>
<hr/>
<h2>next steps</h2>
<p>In the <a href="https://far.computer/how-to/advanced.html">advanced</a> part of this tutorial (still under construction), you will learn how to:</p>
<ul>
<li>setup a domain and https</li>
<li>make the http server persist after reboot</li>
</ul>

</div></div>
  </body>
</html>
