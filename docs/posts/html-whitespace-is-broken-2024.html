<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.dwac.dev/posts/html-whitespace/">Original</a>
    <h1>HTML whitespace is broken (2024)</h1>
    
    <div id="readability-page-1" class="page"><div><article><time datetime="2024-09-02T19:00:00.000Z">September 2, 2024</time><p>Recently, I was working on a project which required a deeper understanding of how whitespace works in HTML. I was never a fan of HTML&#39;s whitespace behavior before as I&#39;ve been burned by it a few times. But as I dug into it more deeply, I found myself discovering complex design issues that I wanted to explore in a blog post. This is partially to write down my knowledge in this space for future reference and partially to vent about how unnecessarily complicated it all is.</p><p>So let&#39;s discuss:</p><ol><li><a href="#how-html-whitespace-works">How whitespace actually works.</a></li><li><a href="#how-did-we-get-here">Why it works that way.</a></li><li><a href="#html-tooling">The problems many HTML tools have.</a></li><li><a href="#how-could-we-fix-this">How it <em>should</em> work.</a></li><li><a href="#practical-advice">What we can do about it.</a></li></ol><h2 id="how-html-whitespace-works">How HTML Whitespace Works</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Whitespace" target="_blank">MDN has a great article</a> explaining whitespace in HTML but I&#39;ll try to break it down here. Let&#39;s start with <code>inline</code> elements.</p><h3 id="inline-elements">Inline Elements</h3><p>HTML is whitespace-sensitive in that elements will render differently based on whether or not whitespace exists between them. In these two examples, if a space is present between the two links, then that space is rendered in the output.</p><figure><figcaption>Example 1: No whitespace.</figcaption><pre><code><span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>First<span><span><span>&lt;/</span>a</span><span>&gt;</span></span><span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>Second<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
</code></pre><a href="#">First</a><a href="#">Second</a></figure><figure><figcaption>Example 2: Single space.</figcaption><pre><code><span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>First<span><span><span>&lt;/</span>a</span><span>&gt;</span></span> <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>Second<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
</code></pre><a href="#">First</a> <a href="#">Second</a></figure><p>This makes some amount of sense to me. The difference between 1. and 2. is clear in the code, obviously the developer intentionally put a space in 2. and it follows that 1. would not have any space between its links.</p><p>Beyond single spaces, HTML is subject to whitespace &#34;collapsing&#34;, where multiple spaces are &#34;collapsed&#34; into a single space. This means adding additional spaces has no effect. It&#39;s exactly the same as having one space.</p><figure><figcaption>Example 3: Lots of spaces.</figcaption><pre><code><span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>First<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>       <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>Second<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
</code></pre><a href="#">First</a> <a href="#">Second</a></figure><p>Newlines and tabs are also treated identically and collapsed into spaces.</p><figure><figcaption>Example 4: Newline.</figcaption><pre><code><span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>First<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
<span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>Second<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
</code></pre><a href="#">First</a> <a href="#">Second</a></figure><p>The space between the tags is rendered as an independent text node, meaning it does not inherit the styles for either of the <code>&lt;a&gt;</code> tags. It does not include an underscore and clicking the whitespace does not trigger either link. Given that the space in HTML is not within either <code>&lt;a&gt;</code> tag, that seems pretty reasonable to me.</p><p>But let&#39;s keep experimenting. If we put this inside a <code>&lt;span&gt;</code> tag, then any leading and trailing whitespace is <em>not</em> preserved.</p><figure><figcaption>Example 5: Indented.</figcaption><pre><code><span><span><span>&lt;</span>span</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>First<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>Second<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
</code></pre><span><a href="#">First</a> <a href="#">Second</a></span></figure><p>Even though there are many spaces before the first <code>&lt;a&gt;</code>, they do not render to the user. This is because whitespace at the start of a rendering context (basically whitespace before the first line of a block) is removed completely.</p><p>Typically, spaces which are visible to the user are referred to as <em>significant</em>, while spaces which are not rendered are considered <em>insignificant</em>. For the above example, the newline and indentation between the links are significant because they will be collapsed to a single space and rendered. The indentation before the first link and trailing newline after the second link are insignificant and not displayed to the user.</p><p>This also applies to whitespace inside a tag. Consider these examples:</p><figure><figcaption>Example 6: Basic link.</figcaption><pre><code>Hello, <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>World<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>!
</code></pre>Hello, <a href="#">World</a>!</figure><figure><figcaption>Example 7: Spaced link.</figcaption><pre><code>Hello, <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span> World <span><span><span>&lt;/</span>a</span><span>&gt;</span></span>!
</code></pre>Hello, <a href="#">World </a>!</figure><figure><figcaption>Example 8. Very spacey link.</figcaption><pre><code>Hello, <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>        World          <span><span><span>&lt;/</span>a</span><span>&gt;</span></span>!
</code></pre>Hello, <a href="#">World </a>!</figure><p>In 7., we can see that the space between &#34;World&#34; and &#34;!&#34; is preserved and the space is underscored with the rest of the link. If you click that space precisely enough you&#39;ll actually follow the link.</p><p>In fact 7., shows even more collapsing. There are actually <em>two</em> spaces between &#34;Hello,&#34; and &#34;World&#34;, one outside the <code>&lt;a&gt;</code> tag and the other inside it. You might expect this to render two spaces, the latter of which is underlined because it is a part of the link.</p><p>However the browser actually collapses both spaces together and only displays one. The begs the question: Which space is preserved? How does the browser decide?</p><p>Let&#39;s test this out by swapping the ordering:</p><figure><figcaption>Example 9: Link before text.</figcaption><pre><code><span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>Hello, <span><span><span>&lt;/</span>a</span><span>&gt;</span></span> World!
</code></pre><a href="#">Hello, </a>World!</figure><p>Here we see that the space <em>is</em> underscored, so the space was again given to the preceding text node.</p><p>This also highlights the most common foot gun I&#39;ve seen with HTML whitespace: links with extra spaces. Consider this example:</p><figure><figcaption>Example 10: Long link text.</figcaption><pre><code>Hello, <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>
    here is some long link text that goes on its own line
<span><span><span>&lt;/</span>a</span><span>&gt;</span></span> please take a look at it!
</code></pre>Hello, <a href="#">here is some long link text that goes on its own line </a>please take a look at it!</figure><p>Since the link is on its own line, the text ends with a newline character before the <code>&lt;/a&gt;</code>. This means the rendered output places the space within the link itself, so the underscore trails one character further than you might expect.</p><p>There&#39;s also a space after the <code>&lt;/a&gt;</code>, meaning this falls into the case where there are multiple spaces across two elements. As a result, the space goes to the preceding node which is the link in this case. The solution here is to remove the newline at the end of the <code>&lt;a&gt;</code> tag by reformatting it, line length limits be dammed.</p><figure><figcaption>Example 11: Single-line link.</figcaption><pre><code>Hello,
<span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>here is some long link text that goes on its own line<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
please take a look at it!
</code></pre>Hello, <a href="#">here is some long link text that goes on its own line</a> please take a look at it!</figure><p>Your formatter might not like this solution, but we&#39;ll <a href="#automated-formatting">get to that later</a>.</p><h3 id="block-elements">Block Elements</h3><p>All of the above applies to <em>inline</em> HTML elements.</p><p><em>Block</em> elements are similar, but preserve a little less whitespace. As mentioned earlier about inline elements, any spaces at the start or end of a line are dropped. Block elements work similarly. Any whitespace in a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_display/Block_formatting_context" target="_blank">block formatting context</a> becomes its own block, except that whitespace-only blocks are then dropped entirely. Practically speaking, this means that any spaces around blocks are effectively ignored.</p><figure><figcaption>Example 12: Block elements without whitespace.</figcaption><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>Hello<span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span><span><span>&lt;</span>div</span><span>&gt;</span></span>World<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>Hello</p><p>World</p></figure><figure><figcaption>Example 13: Block elements with whitespace.</figcaption><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>Hello<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>      <span><span><span>&lt;</span>div</span><span>&gt;</span></span>World<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>Hello</p><p>World</p></figure><figure><figcaption>Example 14: Block elements with newline.</figcaption><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>Hello<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;</span>div</span><span>&gt;</span></span>World<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>Hello</p><p>World</p></figure><p>Recall that for inline elements, a space between them is significant and gets included in the former element.</p><p>For block elements, there&#39;s actually no difference between these examples because all the whitespace differences are ignored and newlines are placed between the blocks. Example 12. does not actually contain <em>any</em> whitespace, yet the two <code>&lt;div&gt;</code> tags are presented as if there is a newline between them.</p><h3 id="css">CSS</h3><p>Now that you understand how block and inline elements behave, let&#39;s do a quick pop quiz, how do you expect the following to render?</p><figure><figcaption>Example 15: <code>&lt;aside&gt;</code> without whitespace.</figcaption><pre><code><span><span><span>&lt;</span>aside</span><span>&gt;</span></span>Hello<span><span><span>&lt;/</span>aside</span><span>&gt;</span></span><span><span><span>&lt;</span>aside</span><span>&gt;</span></span>World<span><span><span>&lt;/</span>aside</span><span>&gt;</span></span>
</code></pre></figure><p>You might intuitively think, &#34;Well <code>&lt;aside&gt;</code> is a block element, so it should follow the same rules as <code>&lt;div&gt;</code>. Therefore this will render exactly like example 12., and there&#39;s a newline between them.&#34;</p><p>That&#39;s very well-reasoned of you, and you are correct... <em>most</em> of the time... This is actually a trick question. <code>&lt;aside&gt;</code> is natively a block element, but it doesn&#39;t have to be. Therefore you can actually render different spacing based on how you <em>style</em> the element.</p><figure><figcaption>Example 16: Block <code>&lt;aside&gt;</code>.</figcaption><pre><code><span><span><span>&lt;</span>style</span><span>&gt;</span></span><span><span><span>aside</span> <span>{</span> <span>display</span><span>:</span> <span>&#39;block&#39;</span><span>;</span> <span>}</span></span></span><span><span><span>&lt;/</span>style</span><span>&gt;</span></span>
<span><span><span>&lt;</span>aside</span><span>&gt;</span></span>Hello<span><span><span>&lt;/</span>aside</span><span>&gt;</span></span><span><span><span>&lt;</span>aside</span><span>&gt;</span></span>World<span><span><span>&lt;/</span>aside</span><span>&gt;</span></span>
</code></pre></figure><figure><figcaption>Example 17: Inline <code>&lt;aside&gt;</code>.</figcaption><pre><code><span><span><span>&lt;</span>style</span><span>&gt;</span></span><span><span><span>aside</span> <span>{</span> <span>display</span><span>:</span> <span>&#39;inline&#39;</span><span>;</span> <span>}</span></span></span><span><span><span>&lt;/</span>style</span><span>&gt;</span></span>
<span><span><span>&lt;</span>aside</span><span>&gt;</span></span>Hello<span><span><span>&lt;/</span>aside</span><span>&gt;</span></span><span><span><span>&lt;</span>aside</span><span>&gt;</span></span>World<span><span><span>&lt;/</span>aside</span><span>&gt;</span></span>
</code></pre></figure><p>The same HTML can actually lead to different whitespace behavior. That might not sound too bad. After all, this is exactly the layout difference between <code>block</code> and <code>inline</code>. However it actually <em>changes</em> the fundamental text content displayed to the user. Example 16. displays two strings, &#34;Hello&#34; and &#34;World&#34;. While 17. displays a single string &#34;HelloWorld&#34;. There&#39;s a semantic difference between those two options, not just a styling distinction.</p><p>You can actually observe this distinction in JavaScript through <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent" target="_blank"><code>textContent</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/innerText" target="_blank"><code>innerText</code></a> on a parent element. The former joins the strings together with no spacing in both cases.</p><pre><code>&gt; parentOfBlockAsides.textContent
&#39;HelloWorld&#39;
&gt; parentOfInlineAsides.textContent
&#39;HelloWorld&#39;
</code></pre><p>However <code>innerText</code> adds a newline for the <code>block</code> elements <em>only</em>:</p><pre><code>&gt; parentOfBlockAsides.innerText
&#39;Hello\nWorld&#39;
&gt; parentOfInlineAsides.innerText
&#39;HelloWorld&#39;
</code></pre><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent#differences_from_innertext" target="_blank">Per MDN</a>, <code>innerText</code> is &#34;aware of styling&#34; so it can tell the difference between these two examples in a way <code>textContent</code> cannot.</p><p>You can even hear the difference with text-to-speech tools! Windows Narrator on Chrome treats block elements as different text fields while inline elements are joined into a single word.</p><p>Here I put the word &#34;Refrigerator&#34; split across multiple <code>&lt;aside&gt;</code> tags. The first attempt uses the default <code>display: block;</code> while the second is <code>display: inline;</code>.</p><dwac-lazy><template><video loop="" playsinline="" width="1920" height="1080" controls=""><source src="./demos/1-refrigerator.mp4" type="video/mp4"/><track label="English" kind="subtitles" srclang="en" src="./demos/1-refrigerator.vtt" default=""/></video></template></dwac-lazy><p>Narrator treats the first attempt as four different words. It implicitly converts &#34;fri&#34; to &#34;Friday&#34; (assuming certain semantics on the text) and can&#39;t pronounce &#34;ger&#34; at all, choosing to spell it out instead as &#34;g-e-r&#34;.</p><p>The second attempt correctly speaks &#34;Refrigerator&#34; even though it has identical DOM structure to the first attempt. The only difference is the <code>display</code> property. This tells us two things:</p><p>First, whitespace handling of HTML content can be controlled purely through CSS. This is also interesting because it means that whitespace handling is not done by the HTML parser. The parser must retain all spaces because it&#39;s actually the CSS layer which decides whether or not those spaces are significant.</p><p>Second, the actual <em>content</em> of a web page can be manipulated by CSS. The page should contain either &#34;Refrigerator&#34; or &#34;Re-fri-ger-ator&#34;, regardless of the CSS applied. The presentation layer of CSS should not get to decide which of those two interpretations is correct, that&#39;s HTML&#39;s job. This also implies that search engines may index different textual content based whether they process a page&#39;s CSS styling, which really bulldozes any idea of separation of concerns between HTML and CSS.</p><h3 id="preformatted-text">Preformatted Text</h3><p>&#34;But wait!&#34; I hear you say. &#34;If you don&#39;t like HTML spacing, just use the <code>&lt;pre&gt;</code> tag!&#34;</p><p>Yes, that is a valid point. HTML does have a <code>&lt;pre&gt;</code> tag for &#34;preformatted&#34; text which automatically preserves <em>all</em> whitespace.</p><figure><figcaption>Example 18: Preformatted text.</figcaption><pre><code><span><span><span>&lt;</span>pre</span><span>&gt;</span></span>
Hello world
I am preformatted         text, which is interesting.
    This line is indented more than the rest!
<span><span><span>&lt;/</span>pre</span><span>&gt;</span></span>
</code></pre><pre>Hello world
I am preformatted         text, which is interesting.
    This line is indented more than the rest!
</pre></figure><p>No whitespace collapsing occurs and all of it is considered significant... except when it isn&#39;t, thanks HTML! There are actually two insignificant spaces here:</p><ol><li>The first newline immediately following the initial <code>&lt;pre&gt;</code> (<code>&lt;pre&gt;\nHello...</code>).</li><li>The last newline immediately preceding the final <code>&lt;/pre&gt;</code> (<code>than the rest!\n&lt;/pre&gt;</code>).</li></ol><p>Neither of these newlines are rendered. There&#39;s no blank line at the start or end of the rendered result. Surprisingly, if we check <code>textContent</code> we don&#39;t see the first newline, but we <em>do</em> see the second newline, even though it&#39;s not rendered.</p><pre><code>&gt; preElement.textContent
&#39;Hello world\n...than the rest!\n&#39;
</code></pre><p>This detail hints at even more nuanced behavior, as whitespace at the start of a <code>&lt;pre&gt;</code> tag is treated <em>differently</em> from whitespace at the end.</p><figure><figcaption>Example 19: Preformatted text with leading / trailing whitespace.</figcaption><pre><code><span><span><span>&lt;</span>pre</span><span>&gt;</span></span>

Hello world

<span><span><span>&lt;/</span>pre</span><span>&gt;</span></span>
</code></pre><pre>Hello world

</pre></figure><p>Writing this out directly, the source text looks like:</p><pre><code>\n\nHello world\n\n
</code></pre><p>Here, you&#39;ll notice the two newline characters at the start are dropped and not rendered at all. However, only one newline character at the end is dropped, and we end up rendering an extra line. So all newlines at the start of a <code>&lt;pre&gt;</code> tag are dropped, but only the <em>last</em> newline at the end is dropped.</p><p>If we add spaces between the <code>&lt;pre&gt;</code> and <code>&lt;/pre&gt;</code> tags and their nearest newlines... (I&#39;m using an underscore to make this visible).</p><figure><figcaption>Example 20: Preformatted text with leading/trailing spaces.</figcaption><pre><code><span><span><span>&lt;</span>pre</span><span>&gt;</span></span>_
Hello world
_<span><span><span>&lt;/</span>pre</span><span>&gt;</span></span>
</code></pre><pre> 
Hello world
 </pre></figure><p>Now we get the empty lines at the start and end of the block. This means <code>&lt;pre&gt;</code> tags treat newlines distinctly from other spaces, and those newlines <em>must</em> be the first or last characters of the text.</p><p>I can kind of see where the spec authors were going here. Usually if you&#39;re putting a <code>&lt;pre&gt;</code> tag on the page, you&#39;re probably going to put a newline before the content like so:</p><pre><code><span><span><span>&lt;</span>pre</span><span>&gt;</span></span>
Some preformatted text
which is multiple lines.
<span><span><span>&lt;/</span>pre</span><span>&gt;</span></span>
</code></pre><p>You&#39;re probably not going to do:</p><pre><code><span><span><span>&lt;</span>pre</span><span>&gt;</span></span>Some preformatted text
which is multiple lines.<span><span><span>&lt;/</span>pre</span><span>&gt;</span></span>
</code></pre><p>even though that would be more accurate when it comes to whitespace handling. The main takeaway is that even <code>&lt;pre&gt;</code> isn&#39;t as straightforward as you might have expected, despite that being kind of the whole point of the tag. Not only that, but up until now spaces and newlines have used the same collapsing behavior. This shows us that newlines and spaces can sometimes be treated distinctly from each other.</p><p><code>&lt;pre&gt;</code> is also just generally unergonomic. While the whitespace behavior is definitely more intuitive, you can&#39;t indent it at all without affecting its content. Compare these two examples:</p><figure><figcaption>Example 21: Indented <code>&lt;pre&gt;</code> tag.</figcaption><pre><code><span><span><span>&lt;</span>pre</span><span>&gt;</span></span>
    Hello, World!
<span><span><span>&lt;/</span>pre</span><span>&gt;</span></span>
</code></pre><pre>    Hello, World!
</pre></figure><figure><figcaption>Example 22: Double indented <code>&lt;pre&gt;</code> tag.</figcaption><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>pre</span><span>&gt;</span></span>
        Hello, World!
    <span><span><span>&lt;/</span>pre</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><div><pre>        Hello, World!
    </pre></div></figure><p>These both feel like they should contain the same text &#34;Hello, World!&#34; and that&#39;s clearly the developer&#39;s intent. However 21. is preceded by 4 spaces while 22. is preceded by 8 spaces and trailed with a newline and another 4 spaces. This is especially tricky because the indentation causes spaces to come <em>after</em> the trailing newline, so the <code>&lt;/pre&gt;</code> collapsing of a final newline doesn&#39;t apply because it&#39;s not the last character. Therefore, we end up with an extra blank line in the output.</p><p>One other challenge is that <code>&lt;pre&gt;</code> applies its whitespace rules to the entire element, which can be much broader than really necessary. Like the links with trailing spaces earlier, sometimes the problem is just a single space. If you fix that problem by using a <code>&lt;pre&gt;</code> tag, you&#39;re likely just creating more problems for all the other spaces in the text which were previously rendering just fine.</p><p>So while <code>&lt;pre&gt;</code> does solve a number of whitespace issues I&#39;ve described, it causes a whole separate set of developer experience (DX) issues which make it harder and less ergonomic to use correctly.</p><h3 id="white-space"><code>white-space</code></h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/white-space" target="_blank">The <code>white-space</code> CSS property</a> adds even more complexity to this. It supports <code>white-space: pre;</code> which can basically opt any element into the <code>&lt;pre&gt;</code> tag&#39;s parsing rules. It also supports <code>pre-line</code>, <code>pre-wrap</code> and a few other possible options to further configure the behavior for specific use cases.</p><p>As I mentioned earlier, whitespace processing is defined by CSS rules, not the HTML parser so the <a href="https://drafts.csswg.org/css-text/" target="_blank">standard which specifies this behavior</a> is actually maintained by the CSS working group and primarily focuses on the behavior of the <code>white-space</code> property.</p><p>Between block elements, inline elements, and <code>&lt;pre&gt;</code> tags I think I&#39;ve done a decent job justifying why HTML whitespace is confusing. However if you still don&#39;t believe me, I&#39;ll also mention that flexbox <a href="#whitespace-of-flexbox-elements">forces block rendering on its children</a> and <code>inline-block</code> elements are also <a href="#whitespace-of-inline-block-elements">sensitive to minor whitespace changes</a>.</p><h3 id="nbsp"><code>&amp;nbsp;</code></h3><p>So if this is all so complicated and <code>&lt;pre&gt;</code> isn&#39;t the right solution, what other options are there?</p><p>We&#39;ve all been there. Two elements are right next to each other and you need just a little spacing between them. What do you do? <code>&amp;nbsp;</code></p><p>If you&#39;ve never understood what this actually is, <code>&amp;nbsp;</code> is an <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity" target="_blank">HTML entity</a> representing a <a href="https://unicode-explorer.com/c/00A0" target="_blank">&#34;no-break space&#34;</a>. Specifically, it&#39;s a space which the browser will never line wrap on. <code>Hello&amp;nbsp;World</code> will never be split up into <code>Hello</code> and <code>World</code> on different lines, no matter how narrow the viewport gets.</p><p>This is a useful, but frequently misused tool. If you need a space between two elements, especially elements in an inline text context where devs frequently reach for <code>&amp;nbsp;</code>, you probably don&#39;t want the non-breaking behavior. If the entity appears outside of a text context, such as between two blocks, then the non-breaking behavior doesn&#39;t even apply and has no effect.</p><p>Instead, I suspect what devs really <em>want</em> from <code>&amp;nbsp;</code> is its non-collapsible behavior. Multiple <code>&amp;nbsp;</code> characters are not merged together and they can start or end lines.</p><figure><figcaption>Example 23: <code>&amp;nbsp;</code>.</figcaption><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>Hello,<span>&amp;nbsp;</span><span>&amp;nbsp;</span><span>&amp;nbsp;</span><span>&amp;nbsp;</span><span>&amp;nbsp;</span>World<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;</span>div</span><span>&gt;</span></span><span>&amp;nbsp;</span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;</span>div</span><span>&gt;</span></span><span>&amp;nbsp;</span><span>&amp;nbsp;</span><span>&amp;nbsp;</span><span>&amp;nbsp;</span>test<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>Hello,     World</p><p>    test</p></figure><p><code>&amp;nbsp;</code> is not considered whitespace like newlines, tabs, or general spaces so collapsing rules treat it like any other text.</p><p>This sounds nice but comes with additional baggage. Beyond the non-breaking behavior, <code>&amp;nbsp;</code> <em>always</em> takes up exactly one space-worth of width and this is never reduced. Except there is one extremely common scenario where spaces are eliminated, and that&#39;s line wrapping.</p><p><code>&amp;nbsp;</code> is a non-breaking space, so you&#39;d think it never line wraps. Except as I mentioned, the &#34;non-breaking&#34; behavior has no effect when used outside of a text context. So if you use <code>&amp;nbsp;</code> to space out two blocks, you&#39;ve created a line wrapping problem. Check out this example of two red boxes with a blue <code>&amp;nbsp;</code> between them:</p><dwac-lazy><template><video autoplay="" muted="" loop="" playsinline="" width="1920" height="1080" controls=""><source src="./demos/3-nbsp-overflow.mp4" type="video/mp4"/></video></template></dwac-lazy><p>The ideal behavior would only show the space between the two squares when they are adjacent to each other, but <code>&amp;nbsp;</code> is not able to support that and <em>always</em> takes up space, even if the boxes are already separated due to line wrapping. I suspect most usages of <code>&amp;nbsp;</code> actually have line wrapping bugs which developers don&#39;t notice because they don&#39;t go out of their way to test this particular behavior.</p><p>Unfortunately there&#39;s no great alternative to <code>&amp;nbsp;</code> which would line wrap in the correct fashion. <code>&amp;#32;</code> sounds like the right entity, but that <a href="#32">gets collapsed</a> like a regular space, so it doesn&#39;t help here either.</p><p>So what&#39;s the correct solution for spacing out two elements? Well it&#39;s probably best to do this in CSS with <code>margin</code>, <code>padding</code>, or any of the other thousand properties which introduce spacing and fail to center elements. If you really need to, a <code>&lt;pre&gt;</code> tag or the <code>white-space</code> property is probably the best way to have maximum control over your spacing behavior. However, I honestly can&#39;t blame you if you still end up reaching for <code>&amp;nbsp;</code>. I don&#39;t have a great alternative beyond &#34;do it in CSS&#34;, which just isn&#39;t a drop-in solution.</p><h2 id="how-did-we-get-here">How Did We Get Here?</h2><p>Why exactly does HTML work this way? Why did we make this language so complicated?</p><p>I think the core problem here is that all whitespace in HTML is <em>ambiguous</em>. Specifically, it is ambiguous with regard to the developer&#39;s intent. For any given space, did the developer mean for it to be displayed to the user or did they just want to keep their code under the line length limit? It&#39;s impossible for the browser to know.</p><p>To address this, the designers of HTML tried to come up with a set of rules which would roughly map the HTML code they wanted to write to the rendered output they wanted to create. So you, as a developer, have a UI in your head and write out the HTML to display it, and usually the whitespace &#34;just works&#34;. Honestly, I&#39;m kind of amazed the browser is as consistently correct as it is.</p><p>But even that isn&#39;t 100% correct. Sometimes the developer doesn&#39;t expect whitespace to behave the way it does and leads to complicated, hard to understand bugs. <code>&lt;pre&gt;</code> tags simplify things and are intended for use cases where whitespace is significant and needs to be retained, but it makes authoring those strings in HTML really awkward and overly precise.</p><p>Developers are forced to choose between the default syntax that <em>usually</em> works and is convenient to write or a <code>&lt;pre&gt;</code> syntax which can very precisely express the spacing they want but is incredibly awkward and inconvenient to work with.</p><p>Contrast this with basically any other programming language where user visible strings are syntactically distinct from general whitespace:</p><pre><code><span>function</span> <span>sayHello</span><span>(</span><span>)</span><span>:</span> <span>string</span> <span>{</span>
    <span>return</span> <span>&#39;Hello, World!&#39;</span> <span>+</span>
        <span>&#39; I\&#39;m some text without a newline.&#39;</span> <span>+</span>
        <span>&#39; and I\&#39;m some text with a trailing newline.\n&#39;</span><span>;</span>
<span>}</span>
</code></pre><p>All the spaces and newlines are explicit. Everything within the quotes is intended for the end-user and everything outside the quotes is intended for the developer. This format has its own problems, multiline text can get very awkward for example. But it&#39;s at least unambiguous whether any given space is significant to the end user or insignificant and intended only for the developer.</p><p>Just imagine working in a language where text didn&#39;t need to be quoted:</p><pre><code>function sayHello(): string {
    return Hello, World! +
         I&#39;m some text without a newline. +
         and I&#39;m some text with a trailing newline.\n;
}
</code></pre><p>That sounds awful and I have no idea how it would work. Except you don&#39;t need to imagine such a situation, because you already write HTML which works exactly like this, and despite writing a whole blog post on the matter, I have no idea how that works either!</p><p>Also, if you believe HTML&#39;s syntax is justified because it is intended to represent documents and occasionally authored by non-developers, I just want to say: <a href="#isnt-html-just-a-document">No it isn&#39;t.</a></p><p>Let&#39;s zoom out from the browser to talk about the developer writing HTML and the tools which help them succeed. Any tool which processes HTML needs to understand these whitespace semantics, so let&#39;s look at just three: <a href="#automated-formatting">automated formatting</a>, <a href="#content-management-systems">Content Management Systems</a>, and <a href="#minification">minification</a>.</p><h3 id="automated-formatting">Automated Formatting</h3><p>For as long as we&#39;ve had code, we&#39;ve had arguments about the best way to write it. Everyone&#39;s got an opinion and all of them except mine are wrong. So we use tools which automatically format everyone&#39;s code into a single, consistent, agreed-upon format. Sounds great.</p><p>The problem with this is that formatting regularly changes whitespace. A long element can be broken up into multiple lines:</p><pre><code>
<span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>cool colorful bright awesome<span>&#34;</span></span><span>&gt;</span></span>Here is some long text.<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>


<span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>cool colorful bright awesome<span>&#34;</span></span><span>&gt;</span></span>
    Here is some long text.
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>Anything affecting indenting can also cause line breaks. For example, consider adding a wrapper <code>&lt;div&gt;</code>.</p><pre><code>
<span><span><span>&lt;</span>div</span><span>&gt;</span></span>Here is some long text saying important stuff.<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>


<span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>wrapper<span>&#34;</span></span><span>&gt;</span></span>
    
    <span><span><span>&lt;</span>div</span><span>&gt;</span></span>
        Here is some long text saying important stuff.
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>These formatting changes are intended to be no-ops. They make my life easier as a developer, but should never change significant whitespace for the user. Except they do change significant whitespace because they introduce leading and trailing spaces. Consider:</p><figure><figcaption>Example 24. One-line link.</figcaption><pre><code>Check out my <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>web site<span><span><span>&lt;/</span>a</span><span>&gt;</span></span> and read my blog!
</code></pre>Check out my <a href="#">web site</a> and read my blog!</figure><p>In this case we have text with a link in the middle. But if this exceeds the line length limit, formatting the text can introduce line breaks like:</p><figure><figcaption>25. Link with overextended underline.</figcaption><pre><code>Check out my
<span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>
    web site
<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
and read my blog!
</code></pre>Check out my <a href="#">web site </a>and read my blog!</figure><p>Now we have that overextended underline again, all because of a single formatting change!</p><p><a href="https://prettier.io/" target="_blank">Prettier</a> actually has an option for this called <a href="https://prettier.io/docs/en/options.html#html-whitespace-sensitivity" target="_blank"><code>--html-whitespace-sensitivity</code></a>. Setting this to <code>ignore</code> will allow the above change, so the formatted code looks great, but may break your UI. <code>strict</code> will avoid introducing a significant whitespace change so your UI is safe, but leads to truly &#34;pretty&#34; HTML code like:</p><pre><code>Check out my
<span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span>
  <span>&gt;</span></span>web site<span><span><span>&lt;/</span>a</span>
<span>&gt;</span></span>
and read my blog!
</code></pre><p>In strict mode, Prettier can&#39;t introduce a newline between <code>&lt;a&gt;</code> and <code>web</code> because that could change the rendered output. Instead, it has to put the newline <em>inside</em> the <code>&lt;a&gt;</code> start tag since that&#39;s the only location it can add insignificant whitespace. Same for the <code>&lt;/a&gt;</code> and the following <code>and</code>.</p><p>Prettier also has an <code>--html-whitespace-sensitivity css</code> option which tells it to &#34;Respect the default value of CSS <code>display</code> property.&#34; Hopefully after reading this post you should know what that means! Given a <code>&lt;div&gt;</code> tag, it can format with the <code>ignore</code> behavior because leading and trailing whitespace aren&#39;t significant in block rendering contexts. <code>&lt;span&gt;</code> tags will use <code>strict</code> behavior because the leading and trailing whitespace <em>is</em> significant. This makes a lot of sense as a useful middle ground between <code>ignore</code> and <code>strict</code>.</p><p>But after reading this post you should also know that&#39;s not entirely accurate and breaks if you do <code>div { display: inline; }</code>. Prettier doesn&#39;t know anything about your CSS so it can only infer the default <code>display</code> for a given tag, it can&#39;t know the actual <code>display</code> value used at runtime.</p><p>No shame on Prettier here by the way. I can&#39;t blame the tool for formatting HTML like this. The <code>css</code> mode is actually a very useful middle ground for getting the nicer <code>ignore</code> formatting in at least most of the cases where it won&#39;t have any negative effects while still using <code>strict</code> where it&#39;s likely to be important.</p><p>Again, the real problem here is that HTML whitespace is ambiguous and can&#39;t tell that Prettier wants to insert whitespace for the developer&#39;s benefit without affecting the rendered output. The fact that you can&#39;t know the actual whitespace behavior without knowing the CSS <code>display</code> and <code>white-space</code> properties is just the cherry on top that cements HTML formatting as a fundamentally unsolvable problem.</p><h3 id="content-management-systems">Content Management Systems</h3><p>Many hands are involved in developing and shipping a web page from scratch to its end users. Web developers, designers, product managers, and so much more participate in various parts of the process. As a result, the idea of a single individual writing an entire web page from scratch in a <code>*.html</code> file is relatively rare in the year 2024.</p><p>A very common scenario is for a web developer to focus on the &#34;HTML parts&#34; of the page while the marketing, product, or localization teams are focused on the raw text content inside a separate content management system (CMS). An e-commerce site selling shoes probably does not want to file a bug with the developers every time they need to update the marketing copy for how the shoes will make you a faster runner in a not-at-all-legally-binding manner. As a result, modern HTML code looks less like <code>&lt;span&gt;Fast shoes.&lt;/span&gt;</code> and more like:</p><pre><code><span><span><span>&lt;</span>span</span><span>&gt;</span></span>${cms.getString(&#39;shoes.description&#39;)}<span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
</code></pre><p>That sounds straightforward, but pulls on a whole host of whitespace issues. The content is displayed in an HTML context, meaning HTML&#39;s whitespace rules still apply, however the author of the text likely doesn&#39;t know that.</p><p>For example, if the text starts or ends with whitespace, that whitespace will be naturally placed into the <code>&lt;span&gt;</code> and affect spacing with adjacent elements.</p><p>Another possibility is if the marketing team is led by one of those people who insists on all sentences ending with two spaces after the period. Those two spaces will be collapsed into a single space, and lead to a very upset marketing team which directly leads to a mildly annoyed development team.</p><p>Those use cases are possible, but not exactly common and likely something most developers can just ignore. However you have to imagine that the marketing team is looking at a text field like this:</p><p><picture><source srcset="./shoes-description.webp" type="image/webp" width="624" height="144"/><img srcset="./shoes-description.png" alt="Screenshot of a text area labeled &#34;Description&#34;. The user has entered &#34;These shoes will make you the fastest* runner around!&#34; This is followed by two newlines and then a disclaimer &#34;* Not legally binding.&#34;" width="624" height="144" decoding="async" loading="eager" fetchpriority="high"/></picture></p><p>Marketing is interpreting the content as plain text, but that&#39;s <a href="#isnt-html-just-a-document">not how HTML works</a>. As a result, they end up looking at a completely borked disclaimer:</p><blockquote>These shoes will make you the fastest* runner around! * Not legally binding.</blockquote><p>You&#39;d think the CMS should be able to solve this problem, but it really can&#39;t. There&#39;s two newlines between <code>around!</code> and <code>* Not</code>, but there&#39;s no trivial replacement which will prevent them from being collapsed into a single space. The only viable option here is to render all text as <code>&lt;pre&gt;</code>, which is a very heavy-handed solution and forces <em>all</em> whitespace to be retained when likely only some of it actually mattered. For example, the newline between <code>you</code> and <code>the</code> is likely just the author avoiding a horizontal scrollbar in the text area, not a hard line break which end users should see. Realistically, both the CMS and the individual writing this copy need some understanding of HTML&#39;s whitespace collapsing rules which will be applied to it.</p><p>One other negative effect is that it becomes difficult to reuse text content between multiple frontends. For example, if the same shoes are displayed in a native Android or iOS app which don&#39;t have the same whitespace collapsing behavior, they will render the same text differently. This makes it very difficult to ensure that the same text is actually rendered consistently and implicitly couples any text rendered to HTML to the whitespace collapsing rules of that environment, even though the raw text itself should be independently usable in any frontend.</p><h3 id="minification">Minification</h3><p>The same problems exist for HTML minifiers: tools which remove unnecessary content from web pages to reduce file size. Multiple spaces are equivalent to single spaces, so they can pretty easily reduce</p><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>
    Hello       World
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>down to just</p><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span> Hello World <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>But they need to retain those leading and trailing spaces for all the same reasons as mentioned above. HTML minifiers can&#39;t know for certain what elements will render in which kind of context and exactly what the whitespace behavior will be. Therefore they need to retain a bunch of spaces which likely don&#39;t matter to make sure they retain the one space which does matter and accept a larger output file size, penalizing all users of the page.</p><h2 id="how-could-we-fix-this">How Could we Fix This?</h2><p>Since this is all so complicated and involved, it would be great to fix HTML so all these whitespace problems go away. Is that possible? What would it look like?</p><p>I don&#39;t have a perfect solution in mind, but I do have some thoughts. As I mentioned earlier, the root problem is that whitespace in HTML is ambiguous: does a space exist to support the developer authoring their HTML code, or to display something reasonable to the end user? That question is unanswerable and is the core problem we should fix.</p><p>The best way to do that is to change HTML syntax such that significant whitespace is syntactically distinct from insignificant whitespace. The obvious approach is to do this just like every other programming language, quote your strings!</p><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>
    &#34;Hello, World! My name is Devel and I&#39;ve got a bone&#34;
    &#34; to pick with HTML&#39;s whitespace behavior. It&#39;s&#34;
    &#34; super confusing and no one understands it!&#34;
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>I see your disgusted reaction and honestly, I kinda get it. I don&#39;t think this looks very good either and I wouldn&#39;t exactly want to write it. It&#39;s not particularly elegant and I hate the leading spaces necessary on all but the first line - so inconsistent.</p><p>In this proposed syntax, we at least have implicit concatenation like Python so you don&#39;t need <code>+</code> signs everywhere. The idea is that all spaces inside the quotes are significant and retained for the user while all spaces outside the quotes are insignificant and used solely for the developer. Whitespace characters like tabs are allowed and preserved when used within quotes. Newlines are banned by default as it would be way too easy to forget a closing quote and introduce unintended significant spacing. Therefore, a quoted newline is a syntax error. An <code>&amp;lf;</code> HTML entity would allow newlines to be directly specified or you could use a triple quote syntax to define a multi-line string.</p><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>
    &#34;&#34;&#34;
    Here is a newline.
    And another newline.
    One more for fun.
    &#34;&#34;&#34;
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>Lots of languages have triple quote syntax like this and my suggestion is to follow <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/tokens/raw-string" target="_blank">C#&#39;s example</a> by making this &#34;indentation-aware&#34;. The opening and closing <code>&#34;&#34;&#34;</code> tokens need to be the last / first tokens on their respective lines and the text content between them must be indented to match. Therefore the string above is identical to:</p><pre><code>Here is a newline.\nAnd another newline.\nOne more for fun.
</code></pre><p>This formats nicely while still allowing precise whitespace to be added where it is needed.</p><p>Aside from adding quotes there&#39;s a couple other changes which need to be made:</p><ol><li>Any text outside of a quoted string is a syntax error.<ul><li>Exactly how it renders is up to the browser, I really don&#39;t care what the fallback behavior is given that browsers tend not to throw errors on bad HTML.</li><li>The main point is that any tool is free to treat unquoted text as a syntax error along the lines of <code>&lt;div &lt;span&gt;&gt;</code>.</li></ul></li><li><code>white-space</code> needs to be removed/reworked to always use the standard whitespace behavior.<ul><li>It can still control line wrapping and other presentational aspects, it&#39;s just the raw text content which should be consistent across all options.</li><li>This reduces the dependency on CSS to understand how HTML text is parsed.</li></ul></li><li><code>&lt;pre&gt;</code> tags should be removed.<ul><li>All text is preformatted (inside quotes), so having a special tag is no longer needed.</li><li>Formatting arbitrary user input into a quoted string is not meaningfully harder than HTML escaping the string already is today, so there&#39;s no value in keeping <code>&lt;pre&gt;</code> tags around.</li><li>You could keep this as a backwards compatibility feature which is an exception to the &#34;no unquoted strings&#34; rule, but a purist implementation of this proposal would remove it entirely.</li></ul></li></ol><p>Would this solve the problem? Since whitespace is no longer ambiguous, we don&#39;t need whitespace collapsing anymore. Whitespace outside the quotes is removed altogether, while whitespace inside the quotes is preserved. No collapsing needed! Developers can add multiple spaces without needing <code>&amp;nbsp;</code>:</p><pre><code>
<span><span><span>&lt;</span>span</span><span>&gt;</span></span>
    &#34;Hello,        World!&#34;
<span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
</code></pre><p>Prettier and other formatters can adjust the developer side of the whitespace as much as they want and even join/split the string literals to move them across lines without changing the rendered output.</p><pre><code><span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>wrapper<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>container<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>div</span> <span>id</span><span><span>=</span><span>&#34;</span>marketing-made-me-add-this<span>&#34;</span></span><span>&gt;</span></span>
            
            &#34;Hello, World! My name is Devel and I&#39;ve&#34;
            &#34; got a bone to pick with HTML&#39;s whitespace&#34;
            &#34; behavior.\nIt&#39;s super confusing and no&#34;
            &#34; one understands how it works!&#34;
        <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>Content management systems can be greatly simplified as well since there&#39;s no whitespace behavior to understand or preserve. Whatever text marketing gives just gets wrapped in quotes and either replaces <code>\n</code> with <code>&amp;lf;</code> or uses triple quotes. This way it outputs exactly the way marketing intended.</p><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>
    &#34;&#34;&#34;
    These shoes will make you the fastest* runner around!

    * Not legally binding.
    &#34;&#34;&#34;
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>Minifiers also can just drop all the whitespace outside the quotes, then retain and join everything in the quotes together into a single line:</p><pre><code>
<span><span><span>&lt;</span>div</span><span>&gt;</span></span>
    &#34;Hello&#34;
    &#34; World&#34;
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>


<span><span><span>&lt;</span>div</span><span>&gt;</span></span>&#34;Hello World&#34;<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>Unfortunately this doesn&#39;t quite solve the <a href="#css">Narrator issue discussed earlier</a>. Two strings still need to be treated distinctly in a block formatting context, while strings would be implicitly joined in an inline formatting context.</p><figure><figcaption>Example 26: Quoted <code>block</code> vs <code>inline</code>.</figcaption><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>&#34;Re&#34;<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;</span>div</span><span>&gt;</span></span>&#34;fri&#34;<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;</span>div</span><span>&gt;</span></span>&#34;ger&#34;<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;</span>div</span><span>&gt;</span></span>&#34;ator&#34;<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>

<span><span><span>&lt;</span>span</span><span>&gt;</span></span>&#34;Re&#34;<span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
<span><span><span>&lt;</span>span</span><span>&gt;</span></span>&#34;fri&#34;<span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
<span><span><span>&lt;</span>span</span><span>&gt;</span></span>&#34;ger&#34;<span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
<span><span><span>&lt;</span>span</span><span>&gt;</span></span>&#34;ator&#34;<span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
</code></pre><p>Re</p><p>fri</p><p>ger</p><p>ator</p></figure><p>You need inline elements to join together so it&#39;s possible to style and control parts of words. For example, adding emphasis to only part of a word.</p><figure><figcaption>Example 27: Emphasized part of word.</figcaption><pre><code><span><span><span>&lt;</span>em</span><span>&gt;</span></span>&#34;in&#34;<span><span><span>&lt;/</span>em</span><span>&gt;</span></span>&#34;conceivable!&#34;
</code></pre><em>in</em>conceivable!</figure><p>I don&#39;t see a good solution to that without completely reworking HTML&#39;s rendering model such that every tag has a statically-knowable formatting context, which is a much more complicated change to make.</p><h3 id="dx-impact">DX Impact</h3><p>I get that lot of developers would probably push back on adding quotes to everything because of the negative developer experience (DX) impact. To preempt some of those arguments, I&#39;ll remind you of a few points I&#39;ve hopefully made clear by now:</p><ol><li>Today&#39;s confusing whitespace rules is its own DX problem.<ul><li>This proposal eliminates that problem and means you never have to deal with a bad link underlines again.</li></ul></li><li>HTML tooling becomes more stable.<ul><li>It is no longer possible for source formatting to affect behavior.</li><li>Less fighting with your formatter or debugging weird issues, more time solving real problems.</li></ul></li><li>HTML already breaks the rules of common text formatting.<ul><li>The idea that you can write HTML today by just typing the text you want <a href="#isnt-html-just-a-document">is a lie</a>.</li></ul></li><li>Every other language already works this way.<ul><li>Adding quotes would not suddenly make HTML unreasonably burdensome to write.</li><li>Two more characters per element is not going to break your keyboard.</li></ul></li></ol><p>An alternative approach could use whitespace control characters like <a href="https://mozilla.github.io/nunjucks/templating.html#whitespace-control" target="_blank">Nunjuck&#39;s implementation</a> to achieve a different solution to this problem, however I think that actually leads to an <a href="#whitespace-control-characters">overall worse DX</a>.</p><h3 id="ship-it">Ship It?</h3><p>Since it seems to solve all the problems described, can we ship this? Unfortunately no.</p><p>Shipping a breaking change of this magnitude to HTML would be functionally impossible and go against many of the core principles of the open web. The best you could do is introduce a new HTML parsing option which web pages could opt-in to along the lines of <code>&lt;!DOCTYPE html6&gt;</code>. Alternatively, you can treat this as an entirely DX problem and invent a new &#34;quoted HTML&#34; file format called <code>*.qhtml</code> with tooling to convert it to standard HTML. Even then, the ecosystem effects of this would be incredibly complicated and end up becoming a solution more painful than the problem it&#39;s solving.</p><p>So what could we ship?</p><h3 id="non-collapsible-whitespace">Non-Collapsible Whitespace</h3><p>The one fix I can think of is to find a drop-in replacement for <code>&amp;nbsp;</code>. If developers want a non-collapsible space which does not come with the baggage of non-breaking and forced-width behavior, then we can come up with a new entity which meets those needs.</p><p>My suggestion: <strong>Add a new, named HTML entity (<code>&amp;ncsp;</code>) as a regular space which does not get collapsed.</strong></p><p>This would take on the non-collapsible benefits of <code>&amp;nbsp;</code>, while dropping the non-breaking and forced-width behavior which leads to line wrapping issues. When you &#34;just want to add a space&#34;, <code>&amp;ncsp;</code> is likely closer to what you actually want and look better when line wrapped.</p><p>Given the <a href="#32">layering of the HTML parser and CSS today</a>, I suspect this would actually require an entirely new Unicode character representing a &#34;non-collapsible space&#34;, distinct from the existing space character. Except Unicode is used in more than just HTML. In theory, other text rendering engines may do some form of whitespace collapsing and a non-collapsible space might be useful in some of those contexts, but I can see some push back to adding a new character specifically to solve an HTML rendering bug.</p><p>I <a href="https://github.com/w3c/csswg-drafts/issues/10821" target="_blank">filed an issue</a> with the CSS working group to discuss adding an <code>&amp;ncsp;</code> entity. Please share your own thoughts on this particular idea.</p><h2 id="practical-advice">Practical Advice</h2><p>Given that we can&#39;t &#34;fix&#34; HTML, what can we do? Understanding the actual whitespace behavior of HTML goes a long way, but as you&#39;ve probably figured out, it&#39;s surprisingly complicated and I don&#39;t think it really scales to expect everyone who writes HTML to fully understand this, nor would I expect a typical code reviewer to spot whitespace bugs looking only at HTML code. Fortunately, HTML whitespace does <em>usually</em> work and we can often rely on that, it&#39;s mainly about minimizing edge case behavior where you need to look up a blog post like this. Rather than <em>preventing</em> unexpected collapsing behavior, we can <em>mitigate</em> the issue to be less of a problem in practice. To that end, I have a few suggestions, all of which use the term &#34;Avoid&#34; rather than &#34;Never&#34; since they are focused more on mitigation than prevention.</p><h3 id="avoid-leading-and-trailing-whitespace-in-links">Avoid Leading and Trailing Whitespace in Links</h3><p>First, avoid leading and trailing whitespace in <code>&lt;a&gt;</code> tags or any other underlined text.</p><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>
    Here is some interesting text with
    <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>#<span>&#34;</span></span><span>&gt;</span></span>a link that exceeds the line length limit<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
    but I don&#39;t care.
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>In my experience, links are by far the biggest challenges with whitespace given that they are underlined by default and it&#39;s a common style. While spacing may be incorrect in many other situations, the underline is usually where it becomes a noticeable problem that needs to be fixed.</p><p>As long as <code>&lt;a&gt;</code> tags are written with no leading or trailing whitespace, this isn&#39;t an issue and your underlines will always be correct. It does mean that in some situations you might have to exceed the line length limit, and potentially fight with your formatter (don&#39;t use <code>--html-whitespace-sensitivity ignore</code>), but I think it&#39;s worth it given how common of a foot gun this particular use case is.</p><h3 id="avoid-changing-layout-behavior-with-display">Avoid Changing Layout Behavior with <code>display</code></h3><p>Second, avoid changing <code>display</code> to a different layout behavior. If you want a <code>display: block;</code> element, pick a tag which uses <code>display: block;</code> by default. This should reduce the possibility of your whitespace behavior being dependent on CSS invisible to a formatter, however it might be difficult when you need a specific semantic tag. Take for example, if you need an inline <code>&lt;aside&gt;</code> tag. There are two ways to do this:</p><ol><li>Add a second tag so the one containing the text uses the correct <code>display</code> value by default, independent of the semantic <code>&lt;aside&gt;</code> tag wrapping it.<pre><code><span><span><span>&lt;</span>aside</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>span</span><span>&gt;</span></span>
        My text content.
    <span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>aside</span><span>&gt;</span></span>
</code></pre></li><li>Pick a tag with the <code>display</code> behavior you want by default (<code>&lt;div&gt;</code> or <code>&lt;span&gt;</code>), and then use <code>role</code> to switch it to the semantic element you want. There might be other accessibility implications to this though.<pre><code><span><span><span>&lt;</span>span</span> <span>role</span><span><span>=</span><span>&#34;</span>aside<span>&#34;</span></span><span>&gt;</span></span>
    My text content.
<span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
</code></pre></li></ol><p>Both of these approaches work with the <code>--html-whitespace-sensitivity css</code> option and avoid a CSS dependency just to understand the text displayed.</p><p>Technically the same guidance should apply to <a href="#whitespace-of-flexbox-elements">usage of flexbox and grid</a>, both of which force their children to be block elements in a way formatters would be unable to detect. Therefore <code>flex</code> and <code>grid</code> elements should always contain child tags which are block formatted by default (ex. use <code>&lt;div&gt;</code> instead of <code>&lt;span&gt;</code>), to align with the formatter&#39;s expectations.</p><h3 id="avoid-changing-collapsing-behavior-with-white-space">Avoid Changing Collapsing Behavior with <code>white-space</code></h3><p>Third, avoid <code>white-space: pre;</code> and prefer a real <code>&lt;pre&gt;</code> tag instead. Again, this reduces dependencies on CSS and might not always be possible, but hopefully is a decent best-practice to follow.</p><p>When you need to configure <code>white-space</code> to something other than <code>pre</code>, I recommend only setting it on <code>&lt;pre&gt;</code> tags. The <code>&lt;pre&gt;</code> tag communicates to HTML tooling that its whitespace should be fully retained because its preformatted. Even if you&#39;re actually using a different <code>white-space</code> mode in your CSS, the <code>&lt;pre&gt;</code> tag is at least a key signal to HTML tooling that all whitespace should be treated as significant.</p><h3 id="avoid-insignificant-whitespace-in-pre-tags">Avoid Insignificant Whitespace in <code>&lt;pre&gt;</code> Tags</h3><p>Fourth, always write <code>&lt;pre&gt;</code> tags with no leading and trailing whitespace, and without indentation. They should generally look like:</p><pre><code><span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>outer<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>inner<span>&#34;</span></span><span>&gt;</span></span>
<span><span><span>&lt;</span>pre</span><span>&gt;</span></span>Some preformatted text
with a new line
and some other content.<span><span><span>&lt;/</span>pre</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>Yeah, I don&#39;t like the look either. But this approach avoids the confusing leading/trailing newline behavior and prevents indentation accidentally leaking into the content.</p><p>None of these suggestions really help HTML tooling maintainers unfortunately since they still need to deal with whitespace regardless. But I warned you at the start, this post is partially for sharing knowledge and partially for venting about how awful whitespace in HTML actually is.</p><p>Broken? Yes.</p><p>Fixable? Not really.</p><p>Manageable?</p><dwac-lazy><template><video autoplay="" muted="" loop="" playsinline="" width="498" height="244"><source src="./im-gonna-complain.webm" type="video/webm"/><source src="./im-gonna-complain.mp4" type="video/mp4"/></video></template></dwac-lazy><p>Shout out to <a href="https://knowler.dev/" target="_blank">Nathan Knowler</a> who helped me understand the layering between HTML and CSS, precise behavior of <code>&amp;nbsp;</code>, as well as some of the finer points of the <code>white-space</code> property.</p><h2 id="appendix">Appendix</h2><h3 id="whitespace-of-flexbox-elements">Whitespace of Flexbox Elements</h3><p>Did you know that flexbox creates even more unique whitespace behavior? Here&#39;s the same code sample, with and without <code>display: flex;</code>.</p><figure><figcaption>Example 28: Block with <code>&lt;div&gt;</code> children.</figcaption><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span><span>&gt;</span></span>First<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span><span>&gt;</span></span>Second<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><div><p>First</p><p>Second</p></div></figure><figure><figcaption>Example 29: Flexbox with <code>&lt;div&gt;</code> children.</figcaption><pre><code><span><span><span>&lt;</span>div</span> <span><span>style</span><span><span>=</span><span>&#34;</span><span><span>display</span><span>:</span> flex<span>;</span></span><span>&#34;</span></span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span><span>&gt;</span></span>First<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span><span>&gt;</span></span>Second<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><div><p>First</p><p>Second</p></div></figure><p><code>display: flex;</code> lays out in the inline axis by default, typically horizontally. Even though we have block elements in the <code>&lt;div&gt;</code> children, they are placed on the same line. Note the lack of visible whitespace between the elements. Since whitespace between block elements are treated as blocks of whitespace elements, they follow the same rule of &#34;No empty blocks&#34; and are removed, therefore the whitespace before the <code>&lt;div&gt;</code> children is considered insignificant.</p><p>Let&#39;s try the same thing with <code>&lt;span&gt;</code> tags!</p><figure><figcaption>Example 30: Flexbox with <code>&lt;span&gt;</code> children.</figcaption><pre><code><span><span><span>&lt;</span>div</span> <span><span>style</span><span><span>=</span><span>&#34;</span><span><span>display</span><span>:</span> flex<span>;</span></span><span>&#34;</span></span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>span</span><span>&gt;</span></span>First<span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>span</span><span>&gt;</span></span>Second<span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p><span>First</span> <span>Second</span></p></figure><p>Here we see that the flex behavior actually didn&#39;t change at all. The <code>&lt;span&gt;</code> elements are still side by side <em>and</em> there is no whitespace between them. But don&#39;t inline elements preserve spaces between them?</p><p>This is because flexbox children create new block formatting contexts by default. <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_display/Block_formatting_context" target="_blank">Quoting MDN again</a>:</p><blockquote><p>A block formatting context is created by at least one of the following:</p><ul><li>[...]</li><li>Flex items (direct children of the element with <code>display: flex</code> or <code>inline-flex</code>) if they are neither <code>flex</code> nor <code>grid</code> nor <code>table</code> containers themselves.</li></ul></blockquote><p>This means each child gets its own block rendering context, regardless of the default behavior of its tag. Therefore, whitespace between them is dropped, even though we&#39;re using <code>&lt;span&gt;</code> elements which are natively <code>display: inline;</code>. Grid actually works the same as flexbox in this respect too.</p><p>What this tells us is that not just can CSS inform the whitespace processing behavior of an HTML element, but the CSS of a <em>different</em> element can have the same influence.</p><p>This is especially problematic if you&#39;re writing HTML fragments or partials. If you write a file which is not a full HTML page but just a small part of it, and start that file off with a <code>&lt;span&gt;</code> tag, it is actually unknowable what the <code>display</code> value of that <code>&lt;span&gt;</code> will be.</p><pre><code>

<span><span><span>&lt;</span>span</span><span>&gt;</span></span>I&#39;m inline right?<span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
</code></pre><p>This is because you can&#39;t know what the <em>parent</em> of that <code>&lt;span&gt;</code> tag will be. If the parent is a <code>&lt;div&gt;</code>, then it will use <code>display: inline;</code> like <code>&lt;span&gt;</code> naturally does. If it is a flexbox or grid, then it will be <code>display: block;</code>.</p><pre><code>

<span><span><span>&lt;</span>div</span> <span><span>style</span><span><span>=</span><span>&#34;</span><span><span>display</span><span>:</span> flex<span>;</span></span><span>&#34;</span></span></span><span>&gt;</span></span>
    
    ${render(&#39;./my-component.html&#39;)}
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>The correct answer depends on how that HTML partial is used and can even differ across multiple usages of the same partial!</p><h3 id="whitespace-of-inline-block-elements">Whitespace of <code>inline-block</code> Elements</h3><p>There&#39;s even <em>more</em> nuanced whitespace behavior for <code>inline-block</code>! <code>inline-block</code> elements are treated as inline on the outside and block on the inside. This means whitespace between <code>inline-block</code> elements can be significant just like it is for <code>inline</code> elements.</p><p>Let&#39;s look at <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Whitespace#example_3" target="_blank">this example from MDN</a> with a couple boxes.</p><figure><figcaption>Example 31: <code>&lt;inline-block&gt;</code> with whitespace.</figcaption><pre><code><span><span><span>&lt;</span>style</span><span>&gt;</span></span><span><span>
    <span>li</span> <span>{</span>
        <span>display</span><span>:</span> inline-block<span>;</span>
        <span>width</span><span>:</span> 2em<span>;</span>
        <span>height</span><span>:</span> 2em<span>;</span>
        <span>background</span><span>:</span> red<span>;</span>
        <span>border</span><span>:</span> 1px solid black<span>;</span>
    <span>}</span>
</span></span><span><span><span>&lt;/</span>style</span><span>&gt;</span></span>
<span><span><span>&lt;</span>ul</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>li</span><span>&gt;</span></span><span><span><span>&lt;/</span>li</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>li</span><span>&gt;</span></span><span><span><span>&lt;/</span>li</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>ul</span><span>&gt;</span></span>
</code></pre><ul><li></li><li></li></ul></figure><p>You should see a small space between the two boxes. I&#39;ve blown up the font size to make this space more visible. But where does that space come from? There&#39;s no margin or padding here. In fact, what if we change the HTML ever so slightly...</p><figure><figcaption>Example 32: <code>&lt;inline-block&gt;</code> without whitespace.</figcaption><pre><code><span><span><span>&lt;</span>ul</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>li</span><span>&gt;</span></span><span><span><span>&lt;/</span>li</span><span>&gt;</span></span><span><span><span>&lt;</span>li</span><span>&gt;</span></span><span><span><span>&lt;/</span>li</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>ul</span><span>&gt;</span></span>
</code></pre><ul><li></li><li></li></ul></figure><p>Shout out to any developers who had to debug that spacing issue. And also shout out to Firefox which actually displays a &#34;whitespace&#34; element in its DevTools to make this somewhat visible.</p><p><picture><source srcset="./demos/2-ff-whitespace.avif" type="image/avif" width="894" height="635"/><img srcset="./demos/2-ff-whitespace.png" alt="Screenshot of Firefox rendering a web page with two pairs of boxes like above. The first pair does not contain any spacing between them, while the second pair does. DevTools is open to the &#34;Inspector&#34; panel showing the rendered DOM. It contains two `&lt;ul&gt;` tags, each containing two `&lt;li&gt;` tags representing each box. The elements are formatted in this view, so the whitespace around each of them is meaningless. However between the two `&lt;li&gt;` tags in the second `&lt;ul&gt;` is a small element labeled &#34;whitespace&#34;. The user has clicked on this element and the spacing between the second pair of boxes is highlighted and marked as `#text`, indicating exactly where that spacing is coming from." width="894" height="635" decoding="async" loading="lazy"/></picture></p><h3 id="32"><code>&amp;#32;</code></h3><p>If <code>&amp;nbsp;</code> doesn&#39;t work, what can you do instead? Ideally, you could just use a regular space since that would naturally avoid introducing the non-breaking behavior and allow it to be zero-width when line wrapped. However HTML whitespace collapsing prevents you from just inserting arbitrary spaces wherever you want, especially if you want multiple adjacent spaces.</p><p>My immediate intuition was to reach for <code>&amp;#32;</code>. If you didn&#39;t know, <code>&amp;nbsp;</code> is a <em>named</em> HTML entity, however there are unnamed entities as well. Specifically, you can use <code>&amp;#&lt;num&gt;;</code> to get the character at that Unicode value. 32 happens to be the Unicode value of a standard space, so we can use <code>&amp;#32;</code> just like a space character.</p><p>Unfortunately it&#39;s so equivalent that it&#39;s also subject to the same whitespace collapsing behavior. So you can put as many <code>&amp;#32;</code> as you want, you&#39;ll still get at most only one space. My sincerest apologies to the three people reading this who want to put two spaces after the end of a sentence.</p><figure><figcaption>Example 33: <code>&amp;#32;</code> spaces.</figcaption><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>Hello<span>&amp;#32;</span><span>&amp;#32;</span><span>&amp;#32;</span><span>&amp;#32;</span><span>&amp;#32;</span><span>&amp;#32;</span>World!<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>Hello World!</p></figure><p>This behavior actually feels objectively wrong to me. Whitespace collapsing is a affordance for the developer experience so you don&#39;t have to butcher your HTML code to get a reasonable output. But if the developer hand-writes <code>&amp;#32;</code>, they clearly care about rendering a space in that slot and are giving up a convenient DX to do it. Whatever developer writes multiple <code>&amp;#32;</code> almost certainly does not expect them to be collapsed together.</p><p>I wasn&#39;t able to come up with a compelling reason for why a developer would want <code>&amp;#32;</code> to be collapsible, but I think I do understand why it works this way. As <a href="#css">mentioned earlier</a>, CSS controls whitespace collapsing, not the HTML parser. This means the HTML parser needs to convert <code>&amp;#32;</code> to literal spaces and retain <em>all</em> of them for all elements. It&#39;s then up to CSS to decide which spaces are significant. Because of that, CSS can&#39;t distinguish between a literal space and a <code>&amp;#32;</code> entity, they&#39;re the same thing (Unicode character 32 to be precise).</p><p>I can see an argument that this actually is desirable for purposes of consistency. On a certain level, a literal space and <code>&amp;#32;</code> <em>should</em> be indistinguishable and lead to the same behavior. However, I think that&#39;s a stronger argument for how the spaces are observable at runtime, not how the HTML parser interprets the code. I think it would be reasonable for the HTML parser to distinguish a space character and a <code>&amp;#32;</code> entity to use different collapsing behaviors. For example, <code>&lt;</code> and <code>&amp;lt;</code> are not the same because the former starts an HTML tag while the later is a text literal for <code>&lt;</code> which explicitly does <em>not</em> start an HTML tag. Unfortunately the HTML parser isn&#39;t the one doing the collapsing, so we&#39;ve lost that information by the time CSS handles it. This &#34;bug&#34; with <code>&amp;#32;</code> feels like a side-effect of the decision to allow CSS to influence whitespace behavior.</p><h3 id="isnt-html-just-a-document">Isn&#39;t HTML Just a Document?</h3><p>One potential advantage to the way HTML whitespace works is that it makes the format more accessible to non-developers. HTML was intended to represent documents, so just look for the text you want to modify and then update it to whatever new text you want to use. Don&#39;t worry about the syntax at all!</p><p>That sounds great in theory, but it&#39;s also not true. A core aspect of writing plain text is the spacing and formatting of that text. Yet HTML breaks even the most basic rules of how text can be formatted. Take this example of some text a non-developer might try to write without any knowledge of HTML and how it actually renders when thrown into a document unmodified.</p><figure><figcaption>34. Plain text.</figcaption><pre><code>First:  Say &#34;hello&#34;.
Second: Say &#34;world&#34;.

Here&#39;s my shopping list for today:
&gt; Apples
&gt; Oranges
&gt; Bananas
</code></pre>First: Say &#34;hello&#34;. Second: Say &#34;world&#34;. Here&#39;s my shopping list for today: &gt; Apples &gt; Oranges &gt; Bananas</figure><p>Everything gets rendered onto one line, <code>\n</code> is effectively meaningless and dropped entirely. <code>First:</code> had two spaces to align with <code>Second:</code>, but they are collapsed together. The list format is completely destroyed. This is all without mentioning that you should escape <code>&gt;</code> into <code>&amp;gt;</code>, so I would argue it&#39;s almost a security issue to think of HTML in this mindset in the first place. This kind of use case requires <code>&lt;pre&gt;</code> tags which completely changes the behavior of everything.</p><p>Text documents have two intrinsic features to support formatting: spaces and newlines. HTML breaks both of those features with whitespace collapsing. You can&#39;t blindly copy-paste from any other text document into an HTML page and expect any kind of sane behavior. Where non-developers do write text content which is rendered in HTML web pages, they typically do it through a content management system (CMS), not by hand-writing HTML files anyways.</p><p>You can&#39;t think of HTML code like a plain text document.</p><h3 id="whitespace-control-characters">Whitespace Control Characters</h3><p>If you really don&#39;t like quoting strings in HTML, one potential alternative approach to is to borrow an idea from HTML preprocessors which have whitespace control characters. For example, <a href="https://mozilla.github.io/nunjucks/" target="_blank">Nunjucks</a> uses <code>{% expr %}</code> to denote interpolations, but you can use <code>{%- expr -%}</code> to <a href="https://mozilla.github.io/nunjucks/templating.html#whitespace-control" target="_blank">trim whitespace</a> surrounding the content.</p><pre><code>&lt;div&gt;
    Say hello to
    {%- username -%}
    and welcome them to the team!
&lt;/div&gt;
</code></pre><p>Here, the whitespace around <code>{%- username -%}</code> is removed because <code>{%-</code> and <code>-%}</code> are used, meaning this will output:</p><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>
    Say hello to Devel and welcome them to the team!
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre><p>You could add a similar syntax to HTML to trim whitespace around particular elements, maybe <code>&lt;-tag-&gt;</code> and <code>&lt;-/tag-&gt;</code>? I don&#39;t know, that looks way worse than quotes to me...</p><p>I don&#39;t hate this approach, as it does remove the general ambiguity around whether any given space is significant or not and if that&#39;s more palatable to the community I could probably be talked into it some form of this being applied to HTML.</p><p>However it doesn&#39;t address the issue of interior whitespace such as multiple adjacent spaces or spaces from a CMS tool. We&#39;d also still need to make the suggested changes to decouple CSS from whitespace-processing behavior.</p><p>I also don&#39;t care for this approach because I believe it shifts the burden of understanding whitespace to the developer. They need to recognize &#34;Oh, in this situation I need to use a <code>&lt;-tag&gt;</code> because the whitespace after it is important, but the whitespace before isn&#39;t&#34;. I think just requiring quotes would make this much more obvious to most developers who would get their spacing right the first time, rather than opting into special syntax to fix the problem afterwards.</p><p>I do see the impact of quotes to the general DX of HTML and I understand the knee-jerk emotional reaction of a lot of developers. That said, I honestly believe quotes would be a net DX <em>improvement</em>, even if it does result in more typing.</p></article></div></div>
  </body>
</html>
