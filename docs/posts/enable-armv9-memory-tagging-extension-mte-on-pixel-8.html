<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://outflux.net/blog/archives/2023/10/26/enable-mte-on-pixel-8/">Original</a>
    <h1>Enable ARMv9 Memory Tagging Extension (MTE) on Pixel 8</h1>
    
    <div id="readability-page-1" class="page"><div id="post-1608">
	 <h3><a href="https://outflux.net/blog/archives/2023/10/26/enable-mte-on-pixel-8/" rel="bookmark">Enable MTE on Pixel 8</a></h3>
	

	<div>
		<p>The Pixel 8 hardware (<a href="https://www.androidpolice.com/google-tensor-g3/">Tensor G3</a>) supports the ARM <a href="https://source.android.com/docs/security/test/memory-safety/arm-mte">Memory Tagging Extension (MTE)</a>, and software support is available both in Android userspace and the Linux kernel. This feature is a powerful defense against linear buffer overflows and many types of use-after-free flaws. I’m extremely happy to see this hardware finally available in the real world.</p>
<p>Turning it on for userspace is already wired up the Android UI: <code>Settings / System / Developer options / Memory Tagging Extension / Enable MTE until you turn if off</code>. Once enabled it will internally change an Android “system property” named “<a href="https://source.android.com/docs/security/test/memory-safety/bootloader-support"><code>arm64.memtag.bootctl</code></a>” by adding the option “<code>memtag</code>“.</p>
<p>Turning it on for the kernel is slightly more involved, but not difficult at all. This requires manually setting the “<code>arm64.memtag.bootctl</code>” property mentioned above to include “<code>memtag-kernel</code>” as well:</p>
<ul>
<li>Plug your phone into a system that can run the <code>adb</code> tool</li>
<li>If not already installed, install <code>adb</code>. For example on Debian/Ubuntu: <code>sudo apt install adb</code></li>
<li>Turn on “USB Debugging” in the phone’s “Developer options” menu, and accept the debugging session confirmation that will pop up when you first run <code>adb</code></li>
<li>Verify the current setting: <code>adb shell getprop | grep memtag.bootctl</code></li>
<p>  <code>[arm64.memtag.bootctl]: [memtag]</code></p>
<li>Enable kernel MTE: <code>adb shell setprop arm64.memtag.bootctl memtag,memtag-kernel</code></li>
<li>Check the results: <code>adb shell getprop | grep memtag.bootctl</code></li>
<p>  <code>[arm64.memtag.bootctl]: [memtag,memtag-kernel]</code></p>
<li>Reboot your phone
</li></ul>
<p>To check that MTE is enabled for the kernel (which is implemented using <a href="https://docs.kernel.org/dev-tools/kasan.html#hardware-tag-based-kasan">Kernel Address Sanitizer’s Hardware Tagging</a> mode), you can check the kernel command line after rebooting:</p>
<pre>$ mkdir foo &amp;&amp; cd foo
$ adb bugreport
...
$ mkdir unpacked &amp;&amp; cd unpacked
$ unzip ../bugreport*.zip
...
$ grep kasan= bugreport*.txt
...: Command line: ... kasan=off ... kasan=on ...
</pre>
<p>The latter “<code>kasan=on</code>” overrides the earlier “<code>kasan=off</code>“.</p>
<p>Enjoy!</p>
<p>© 2023, <a href="https://outflux.net/blog/">Kees Cook</a>. This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 License</a>.</p>
	</div>

	

</div><p>No comments yet.</p></div>
  </body>
</html>
