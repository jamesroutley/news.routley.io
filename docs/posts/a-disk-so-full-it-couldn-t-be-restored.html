<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sixcolors.com/post/2024/03/a-disk-so-full-it-couldnt-be-restored/">Original</a>
    <h1>A disk so full, it couldn&#39;t be restored</h1>
    
    <div id="readability-page-1" class="page"><div>



					



<figure><img decoding="async" src="https://i0.wp.com/sixcolors.com/wp-content/uploads/2024/03/disk-full-warning-macos-6c.png?ssl=1" alt="Disk full alert." data-image-w="" data-image-h="" data-recalc-dims="1"/><figcaption></figcaption></figure>
<p>My younger child’s MacBook Pro was unsalvageably full. Only a complete wipe would suffice—and then Time Machine failed us.</p>
<p>I love my children, but they do sometimes forget what I do for a living: answer questions and write books about the most troubling problems people have with their Macs, iPhones, and iPads. But when something goes truly wrong, they suddenly remember, “Hey, Dad might know how to fix it!”</p>
<p>So it happened that my younger asked for my help when their M2 MacBook Pro’s storage filled  up while they were downloading a (legitimate, purchased) game using Steam. No problem! I could just empty the trash. Nope, they tried that. Well, what about finding some caches and…nope. I could just go into the Terminal and…ok, that didn’t work either.</p>
<p>Turned out, my kid had managed a neat trick, though they were not alone: they had filled macOS’s startup volume storage so full that the operating system was incapable of deleting files in any fashion. Instead of halting the massive Steam download when the drive became disastrously full, macOS  continued to write files until there was just 41K free on the drive.</p>
<p>I don’t know quite what happened. They didn’t realize their terabyte SSD was quite so filled, as they keep most of their useful files in the cloud. It was likely…er, perfectly legitimate video files. Yeah, I’m sure there was <em>no problem</em> with the copyright there. But they weren’t concerned about retaining them. They just wanted their computer to work again!</p>
<p>I have a theory about what happened. Due to our gigabit Internet connection and the size of the Steam file, macOS outstripped its ability to throttle filling storage because it was also <a href="https://support.apple.com/en-us/102154.">making a local Time Machine snapshot</a>. The Steam file appeared monolithic to me—one giant file—but clearly not to Time Machine. macOS keeps these snapshots to provide local backups for the last 24 hours even while it’s copying files to an external or networked Time Machine destination. I don’t think macOS tracks these snapshots well, and I suspect a collision of live files on disk with the specially created snapshots.</p>
<p>I went through a succession of file deletion attempts, relying on my own knowledge and searching for similar situations in online forums:</p>
<ul>
<li><strong>Empty Trash:</strong> Emptying the Trash via the Finder a big “no” (File &gt; Empty Trash). “The operation can’t be completed because the disk is full.” Yes, macOS, I’m already aware of this.</li>
<li><strong>Terminal:</strong> While Terminal would launch, using the standard Unix <code>rm</code> command resulted in a similar error: “No space left on device.” All <code>rm</code> alternatives, like using the <code>find</code> command to search for very large unneeded files and adding the <code>-exec</code> option to run the <code>rm</code> command, failed too. Terminal was a bust.</li>
<li><strong>Disk Utility:</strong> Disk Utility shows Time Machine snapshots on APFS startup volumes, and you can typically select and delete these snapshots, which occupy only the amount of storage space required to contain the differences from the previous snapshot. That failed with a “no space left” error as well.</li>
</ul>
<p>It was time to restart to see if it would clear caches. Unfortunately, restarting left the Mac unable to start up at all. No matter what I tried, it would reach about halfway through the progress bar before failing.</p>
<p>I shifted to recoveryOS, Apple’s somewhat new name for the special disk partition in macOS that lets you run operations on the main startup volume while it’s not mounted, including Disk Utility repairs and reinstallation. From there, I hit the wall as well, as Terminal commands continued to fail with the same error.</p>
<p>I restarted again to access the Apple silicon <a href="https://support.apple.com/guide/mac-help/transfer-files-a-mac-apple-silicon-mchlb37e8ca7/mac">Share Disk</a> option to mount my kid’s drive on one of my Macs, hoping that over Samba (the disk-sharing protocol), I’d be able to force a deletion. No dice.</p>
<p>At this point, I shifted to stronger medicine. I had a series of Time Machine backups of their drive, including one from the previous evening, and they weren’t terribly concerned about losing data, as they have most things they care about in some kind of cloud storage. Here’s where things went pear-shaped in an entirely different direction.</p>
<p>First, I erased the drive and used macOS Recovery to reinstall Ventura, the native system with which the MacBook Pro had shipped. I then used Migration Assistant at macOS startup to access the networked Time Machine backup. In choosing what files to restore, I unchecked a number to ensure there would be plenty of storage. My kid had a lot of things they could delete, too, they said, and I could give them the Time Machine backup as a mountable drive if they needed access to files that weren’t restored later.</p>
<p>Halfway through, Ventura stalled and wouldn’t resume. I decided to upgrade to Sonoma, the version of macOS that was running at the time the Mac filled its drive. That worked fine—but the upgrade took the Mac to version 14.4, and my kid had had 14.3.1 installed. When I attempted to restore directly at startup, I was told the version different wouldn’t allow it. Now what?</p>
<p>I completed a basic Sonoma user account setup and then ran Migration Assistant. It found the networked Mac on which I manage Time Machine backups and recognized it. However, it refused to mount my child’s backup volume. No matter what I did, “Mount failed” appeared. Digging around in forums, I found that Sonoma has broken the SMB/Samba-based networking mount procedure for Time Machine restores, and no one had found a solution. This appears to still be the case in 14.4.</p>
<figure><img decoding="async" src="https://i0.wp.com/sixcolors.com/wp-content/uploads/2024/03/disk-snapshots-alyx-6c.png?ssl=1" alt="" data-image-w="" data-image-h="" data-recalc-dims="1"/><figcaption>Retrieving a backup image for restoration.</figcaption></figure>
<p>Because my younger only needed their apps and certain files, we both gave up at that point. I copied their Time Machine backup onto an external 1 TB SSD through this straightforward method:</p>
<ol>
<li>On my Mac, which handles networked backups, I double-clicked the disk image for their computer and then entered their Time Machine volume password. (I always set a networked password for Time Machine volumes.)</li>
<li>I found the disk icon with the latest timestamp and copied this to an empty 1 TB drive.</li>
<li>Ejecting it from my Mac, I connected it to their stub account on their MacBook Pro and copied over the necessary files, including the contents of most of their home directory folders, excluding some large downloads and unneeded (ahem) video files.</li>
</ol>
<p>I gave them the drive so that they could restore anything else they needed if it were missing, and we’ll probably keep it on hand for a while to make sure nothing is missing.</p>
<p>This put them back in business, but I missed two tricks that I could have tried to make things easier:</p>
<ul>
<li>I could have unmounted the Time Machine backup drive from my computer I use for other computers on the network. (I have a separate drive I use for local Time Machine backups from that computer’s startup volume.) Then I could have connected that directly to my kid’s computer and it likely would have become available as a Migration Assistant starting point.</li>
<li>Failing that, I could have copied the virtual disk from the Time Machine disk image I mounted on my Mac of their backup so that the external 1 TB drive I was transferring “looked” like a Mac source volume. I’m not sure if this would have worked, but I didn’t try it. Then, I could have potentially restored directly from it using Migration Assistant.</li>
</ul>
<p>I’m sorry I didn’t try the above, but I had already invested a cumulative couple of hours of my time and over a day of effort while my kid was unconcerned about a perfect directory-to-directory recovery.</p>
<p>I hate to think what people without decades of Mac experience do when confronted with systemic, cascading failures like this when I felt helpless despite what I thought I knew and all the answers I searched for and found on forums.</p>
<p>[<em>If you liked this story, consider <a href="https://www.kickstarter.com/projects/glennf/how-comics-were-made">backing Glenn’s latest Kickstarter project</a>, How Comics Were Made: a Visual History of Printing Cartoons.</em>]</p>

<p>[<em><strong><a href="https://glennf.com">Glenn Fleishman</a></strong> is a Macworld contributor, Jeopardy champion, and serial Kickstarterer. He&#39;s currently working on the book <a href="https://howcomicsweremade.ink ">How Comics Were Made</a>.</em>]</p>



	<p><strong>If you appreciate articles like this one, support us by <a href="https://sixcolors.com/subscribe/">becoming a Six Colors subscriber</a>. Subscribers get access to an exclusive podcast, members-only stories, and a special community.</strong></p>

				</div></div>
  </body>
</html>
