<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/queer/boxxy">Original</a>
    <h1>Boxxy puts bad Linux applications in a box with only their files</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">boxxy (case-sensitive) is a tool for boxing up misbehaving Linux applications
and forcing them to put their files and directories in the right place,
<strong>without symlinks!</strong></p>
<p dir="auto">boxxy is a part of the <a href="https://discord.gg/7WgSTwh" rel="nofollow">amyware discord server</a>.</p>
<p dir="auto">If you like what I make, consider supporting me on Patreon:</p>
<p dir="auto"><a href="https://patreon.com/amyware" rel="nofollow"><img src="https://camo.githubusercontent.com/569fea43464046133c8679542e46f8287a8243d9e9c28b6c8bde0e34d080b1fe/68747470733a2f2f692e696d6775722e636f6d2f59466a6f4364312e706e67" width="162" height="38" data-canonical-src="https://i.imgur.com/YFjoCd1.png"/></a></p>
<p dir="auto">Linux-only! boxxy uses Linux namespaces for its functionality.</p>
<p dir="auto">For example, consider tmux. It wants to put its config in <code>~/.tmux.conf</code>. With
boxxy, you can put its config in <code>~/.config/tmux/tmux.conf</code> instead:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# ~/.config/boxxy/boxxy.yaml
rules:
- name: &#34;redirect tmux config from ~/.tmux.conf to ~/.config/tmux/tmux.conf&#34;
  target: &#34;~/.tmux.conf&#34;
  rewrite: &#34;~/.config/tmux/tmux.conf&#34;
  mode: &#34;file&#34;"><pre><span><span>#</span> ~/.config/boxxy/boxxy.yaml</span>
<span>rules</span>:
- <span>name</span>: <span><span>&#34;</span>redirect tmux config from ~/.tmux.conf to ~/.config/tmux/tmux.conf<span>&#34;</span></span>
  <span>target</span>: <span><span>&#34;</span>~/.tmux.conf<span>&#34;</span></span>
  <span>rewrite</span>: <span><span>&#34;</span>~/.config/tmux/tmux.conf<span>&#34;</span></span>
  <span>mode</span>: <span><span>&#34;</span>file<span>&#34;</span></span></pre></div>
<p dir="auto"><a href="https://asciinema.org/a/558679" rel="nofollow"><img src="https://camo.githubusercontent.com/4c3c0cf0d934c5becca6e031e627a80f1f42aece053905e00099cd6af34a7d82/68747470733a2f2f61736369696e656d612e6f72672f612f3535383637392e737667" alt="asciicast" data-canonical-src="https://asciinema.org/a/558679.svg"/></a></p>

<p dir="auto">I recently had to use the AWS CLI. It wants to save data in <code>~/.aws</code>, but I
don&#39;t want it to just clutter up my <code>$HOME</code> however it wants. boxxy lets me
force it to puts its data somewhere nice and proper.</p>



<ul dir="auto">
<li>new project, 0.x.y, comes with all those warnings</li>
<li><strong>cannot</strong> use sudo inside the container (see <a href="https://github.com/queer/boxxy/issues/6" data-hovercard-type="issue" data-hovercard-url="/queer/boxxy/issues/6/hovercard">#6</a>)</li>
<li>primarily tested for my use-cases</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="git:(mistress) | ▶  cat ~/.config/boxxy/boxxy.yaml
rules:
- name: &#34;Store AWS CLI config in ~/.config/aws&#34;
  target: &#34;~/.aws&#34;
  rewrite: &#34;~/.config/aws&#34;

git:(mistress) | ▶  boxxy aws configure
 INFO  boxxy &gt; loaded 1 rules
 INFO  boxxy::enclosure &gt; applying rule &#39;Store AWS CLI config in ~/.config/aws&#39;
 INFO  boxxy::enclosure &gt; redirect: ~/.aws -&gt; ~/.config/aws
 INFO  boxxy::enclosure &gt; boxed &#34;aws&#34; ♥
AWS Access Key ID [****************d]: a
AWS Secret Access Key [****************c]: b
Default region name [b]: c
Default output format [a]: d
git:(mistress) | ▶  ls ~/.aws
git:(mistress) | ▶  ls ~/.config/aws
config  credentials
git:(mistress) | ▶  cat ~/.config/aws/config
[default]
region = c
output = d
git:(mistress) | ▶"><pre>git:(mistress) <span>|</span> ▶  cat <span>~</span>/.config/boxxy/boxxy.yaml
rules:
- name: <span><span>&#34;</span>Store AWS CLI config in ~/.config/aws<span>&#34;</span></span>
  target: <span><span>&#34;</span>~/.aws<span>&#34;</span></span>
  rewrite: <span><span>&#34;</span>~/.config/aws<span>&#34;</span></span>

git:(mistress) <span>|</span> ▶  boxxy aws configure
 INFO  boxxy <span>&gt;</span> loaded 1 rules
 INFO  boxxy::enclosure <span>&gt;</span> applying rule <span><span>&#39;</span>Store AWS CLI config in ~/.config/aws<span>&#39;</span></span>
 INFO  boxxy::enclosure <span>&gt;</span> redirect: <span>~</span>/.aws -<span>&gt;</span> <span>~</span>/.config/aws
 INFO  boxxy::enclosure <span>&gt;</span> boxed <span><span>&#34;</span>aws<span>&#34;</span></span> ♥
AWS Access Key ID [<span>****************</span>d]: a
AWS Secret Access Key [<span>****************</span>c]: b
Default region name [b]: c
Default output format [a]: d
git:(mistress) <span>|</span> ▶  ls <span>~</span>/.aws
git:(mistress) <span>|</span> ▶  ls <span>~</span>/.config/aws
config  credentials
git:(mistress) <span>|</span> ▶  cat <span>~</span>/.config/aws/config
[default]
region = c
output = d
git:(mistress) <span>|</span> ▶</pre></div>

<ul dir="auto">
<li><code>alias aws=&#34;boxxy aws&#34;</code> (repeat for other tools)</li>
<li>use contexts to keep project configs separate on disk</li>
<li>dotfiles!</li>
<li>stop using symlinks!!!</li>
<li>no more dev config files when writing code</li>
</ul>

<p dir="auto">The boxxy configuration file lives in <code>~/.config/boxxy/boxxy.yaml</code>. If none
exists, an empty one will be created for you.</p>
<div dir="auto" data-snippet-clipboard-copy-content="rules:
# The name of the rule. User-friendly name for your reference
- name: &#34;redirect aws-cli from ~/.aws to ~/.config/aws&#34;
  # The target of the rule, ie the file/directory that will be shadowed by the
  # rewrite.
  target: &#34;~/.aws&#34;
  # The rewrite of the rule, ie the file/directory that will be used instead of
  # the target.
  rewrite: &#34;~/.config/aws&#34;
- name: &#34;use different k8s configs when in ~/Projects/my-cool-startup&#34;
  target: &#34;~/.kube/config&#34;
  rewrite: &#34;~/Projects/my-cool-startup/.kube/config&#34;
  # The context for the rule. Any paths listed in the context are paths where
  # this rule will apply. If no context is specified, the rule applies
  # globally.
  context:
  - &#34;~/Projects/my-cool-startup&#34;
  # The mode of this rule, either `directory` or `file`. `directory` is the
  # default. Must be specified for the correct behaviour when the target is a
  # file. Required because the target file/directory may not exist yet.
  mode: &#34;file&#34;
  # The list of commands that this rule applies to. If no commands are
  # specified, the rule applies to all programs run with boxxy.
  only:
  - &#34;kubectl&#34;"><pre><span>rules</span>:
<span><span>#</span> The name of the rule. User-friendly name for your reference</span>
- <span>name</span>: <span><span>&#34;</span>redirect aws-cli from ~/.aws to ~/.config/aws<span>&#34;</span></span>
  <span><span>#</span> The target of the rule, ie the file/directory that will be shadowed by the</span>
  <span><span>#</span> rewrite.</span>
  <span>target</span>: <span><span>&#34;</span>~/.aws<span>&#34;</span></span>
  <span><span>#</span> The rewrite of the rule, ie the file/directory that will be used instead of</span>
  <span><span>#</span> the target.</span>
  <span>rewrite</span>: <span><span>&#34;</span>~/.config/aws<span>&#34;</span></span>
- <span>name</span>: <span><span>&#34;</span>use different k8s configs when in ~/Projects/my-cool-startup<span>&#34;</span></span>
  <span>target</span>: <span><span>&#34;</span>~/.kube/config<span>&#34;</span></span>
  <span>rewrite</span>: <span><span>&#34;</span>~/Projects/my-cool-startup/.kube/config<span>&#34;</span></span>
  <span><span>#</span> The context for the rule. Any paths listed in the context are paths where</span>
  <span><span>#</span> this rule will apply. If no context is specified, the rule applies</span>
  <span><span>#</span> globally.</span>
  <span>context</span>:
  - <span><span>&#34;</span>~/Projects/my-cool-startup<span>&#34;</span></span>
  <span><span>#</span> The mode of this rule, either `directory` or `file`. `directory` is the</span>
  <span><span>#</span> default. Must be specified for the correct behaviour when the target is a</span>
  <span><span>#</span> file. Required because the target file/directory may not exist yet.</span>
  <span>mode</span>: <span><span>&#34;</span>file<span>&#34;</span></span>
  <span><span>#</span> The list of commands that this rule applies to. If no commands are</span>
  <span><span>#</span> specified, the rule applies to all programs run with boxxy.</span>
  <span>only</span>:
  - <span><span>&#34;</span>kubectl<span>&#34;</span></span></pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="rules:
- name: &#34;any valid string&#34; # required
  target: &#34;path&#34; # required
  rewrite: &#34;path&#34; # required
  context: # optional
  - &#34;path&#34;
  - &#34;path&#34;
  mode: &#34;directory | file&#34; # optional
  only: # optional
  - &#34;binary name&#34;
  - &#34;binary name&#34;
  env: # optional
    KEY: &#34;value&#34;"><pre><span>rules</span>:
- <span>name</span>: <span><span>&#34;</span>any valid string<span>&#34;</span></span> <span><span>#</span> required</span>
  <span>target</span>: <span><span>&#34;</span>path<span>&#34;</span></span> <span><span>#</span> required</span>
  <span>rewrite</span>: <span><span>&#34;</span>path<span>&#34;</span></span> <span><span>#</span> required</span>
  <span>context</span>: <span><span>#</span> optional</span>
  - <span><span>&#34;</span>path<span>&#34;</span></span>
  - <span><span>&#34;</span>path<span>&#34;</span></span>
  <span>mode</span>: <span><span>&#34;</span>directory | file<span>&#34;</span></span> <span><span>#</span> optional</span>
  <span>only</span>: <span><span>#</span> optional</span>
  - <span><span>&#34;</span>binary name<span>&#34;</span></span>
  - <span><span>&#34;</span>binary name<span>&#34;</span></span>
  <span>env</span>: <span><span>#</span> optional</span>
    <span>KEY</span>: <span><span>&#34;</span>value<span>&#34;</span></span></pre></div>

<ol dir="auto">
<li>set up pre-commit: <code>pre-commit install</code></li>
<li>make sure it builds: <code>cargo build</code></li>
<li>do the thing!</li>
<li>test with the command of your choice, ex. <code>cargo run -- ls -lah ~/.config</code></li>
</ol>

<ul dir="auto">
<li>create temporary directory in /tmp</li>
<li>set up new user/mount namespace</li>
<li>bind-mount <code>/</code> to tmp directory</li>
<li>bind-mount rule mounts rw so that target programs can use them</li>
<li>remount <code>/</code> ro</li>
<li>run!</li>
</ul>

<ul dir="auto">
<li><code>fixtures/helloworld-appimage-x86_84.AppImage</code>: <a href="https://github.com/ClonedRepos/hello-world-appimage">https://github.com/ClonedRepos/hello-world-appimage</a></li>
</ul>
</article></div></div>
  </body>
</html>
