<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.blog/2023-10-30-the-architecture-of-todays-llm-applications/">Original</a>
    <h1>The architecture of today&#39;s LLM applications</h1>
    
    <div id="readability-page-1" class="page"><div>
  <div>
    


<main role="main" id="post-74969">
  
<p>We want to empower you to experiment with LLM models, build your own applications, and discover untapped problem spaces. That‚Äôs why we sat down with GitHub‚Äôs <a href="https://github.com/whatsinfinitum" target="_blank" rel="noopener">Alireza Goudarzi</a>, a senior machine learning researcher, and <a href="https://github.com/wunderalbert" target="_blank" rel="noopener">Albert Ziegler</a>, a principal machine learning engineer, to discuss the emerging architecture of today‚Äôs LLMs.</p>
<p>In this post, we‚Äôll cover five major steps to building your own LLM app, the emerging architecture of today‚Äôs LLM apps, and problem areas that you can start exploring today.</p>
<h2 id="five-steps-to-building-an-llm-app" id="five-steps-to-building-an-llm-app">Five steps to building an LLM app<a href="#five-steps-to-building-an-llm-app" aria-label="Five steps to building an LLM app"></a></h2>
<p>Building software with LLMs, or any machine learning (ML) model, is <a href="https://karpathy.medium.com/software-2-0-a64152b37c35" target="_blank" rel="noopener">fundamentally different</a> from building software without them. For one, rather than compiling source code into binary to run a series of commands, developers need to navigate datasets, embeddings, and parameter weights to generate consistent and accurate outputs. After all, LLM outputs are probabilistic and don‚Äôt produce the same predictable outcomes.</p>
<figure id="attachment_74972"><a href="https://github.blog/wp-content/uploads/2023/10/FivestepstobuildingLLMapp.png?resize=1022%2C537?w=1022" target="_blank" rel="noopener"><img decoding="async" width="1022" height="537" src="https://github.blog/wp-content/uploads/2023/10/FivestepstobuildingLLMapp.png?resize=1022%2C537" alt="Diagram that lists the five steps to building a large language model application. Data source for diagram is detailed here: https://github.blog/?p=74969&amp;preview=true#five-steps-to-building-an-llm-app" loading="lazy" srcset="https://github.blog/wp-content/uploads/2023/10/FivestepstobuildingLLMapp.png?resize=1022%2C537?w=1022 1022w, https://github.blog/wp-content/uploads/2023/10/FivestepstobuildingLLMapp.png?resize=1022%2C537?w=300 300w, https://github.blog/wp-content/uploads/2023/10/FivestepstobuildingLLMapp.png?resize=1022%2C537?w=768 768w" sizes="(max-width: 1000px) 100vw, 1000px" data-recalc-dims="1"/></a><figcaption>Click on diagram to enlarge and save.</figcaption></figure>
<p><strong>Let‚Äôs break down, at a high level, the steps to build an LLM app today. <g-emoji fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f447.png?v8" alias="point_down">üëá</g-emoji></strong></p>
<p><strong>1. Focus on a single problem, first</strong>. The key? Find a problem that‚Äôs the right size: one that‚Äôs focused enough so you can quickly iterate and make progress, but also big enough so that the right solution will wow users.</p>
<p>For instance, rather than trying to address all developer problems with AI, the GitHub Copilot team initially focused on one part of the software development lifecycle: <a href="https://github.blog/2023-09-06-how-to-build-an-enterprise-llm-application-lessons-from-github-copilot/" target="_blank" rel="noopener">coding functions in the IDE</a>.</p>
<p><strong>2. Choose the right LLM</strong>. You‚Äôre saving costs by building an LLM app with a pre-trained model, but how do you pick the right one? Here are some factors to consider:</p>
<ul>
<li><strong>Licensing</strong>. If you hope to eventually sell your LLM app, you‚Äôll need to use a model that has an API licensed for commercial use. To get you started on your search, here‚Äôs a community-sourced <a href="https://github.com/eugeneyan/open-llms" target="_blank" rel="noopener">list of open LLMs that are licensed for commercial use</a>.</li>
<li><strong>Model size.</strong> The size of LLMs can range from 7 to 175 billion parameters‚Äîand some, like <a href="https://learn.microsoft.com/en-us/semantic-kernel/prompt-engineering/llm-models" target="_blank" rel="noopener">Ada</a>, are even as small as 350 million parameters. Most LLMs (at the time of writing this post) range in size from 7-13 billion parameters.</li>
</ul>
<p>Conventional wisdom tells us that if a model has more parameters (variables that can be adjusted to improve a model‚Äôs output), the better the model is at learning new information and providing predictions. However, the <a href="https://spectrum.ieee.org/large-language-models-size" target="_blank" rel="noopener">improved performance of smaller models</a> is challenging that belief. Smaller models are also usually faster and cheaper, so improvements to the quality of their predictions make them a viable contender compared to big-name models that might be out of scope for many apps.</p>

<ul>
<li><strong>Model performance</strong>. Before you customize your LLM using techniques like fine-tuning and in-context learning (which we‚Äôll cover below), evaluate how well and fast‚Äîand how consistently‚Äîthe model generates your desired output. To measure model performance, you can use <strong>offline evaluations</strong>.</li>
</ul>

<p><strong>3. Customize the LLM</strong>. When you train an LLM, you‚Äôre building the scaffolding and neural networks to enable deep learning. When you customize a pre-trained LLM, you‚Äôre adapting the LLM to specific tasks, such as generating text around a specific topic or in a particular style. The section below will focus on techniques for the latter. To customize a pre-trained LLM to your specific needs, you can try in-context learning, reinforcement learning from human feedback (RLHF), or fine-tuning.</p>
<ul>
<li><strong>In-context learning,</strong> sometimes referred to as <a href="https://github.blog/2023-06-20-how-to-write-better-prompts-for-github-copilot/" target="_blank" rel="noopener">prompt engineering</a> by end users, is when you provide the model with specific instructions or examples at the time of inference‚Äîor the time you‚Äôre querying the model‚Äîand asking it to infer what you need and generate a contextually relevant output.</li>
</ul>
<p>In-context learning can be done in a variety of ways, like providing examples, rephrasing your queries, and adding a sentence that states your goal at a high-level.</p>
<ul>
<li><strong>RLHF</strong> comprises a reward model for the pre-trained LLM. The reward model is trained to predict if a user will accept or reject the output from the pre-trained LLM. The learnings from the reward model are passed to the pre-trained LLM, which will adjust its outputs based on user acceptance rate.</li>
</ul>
<p>The benefit to RLHF is that it doesn‚Äôt require supervised learning and, consequently, expands the criteria for what‚Äôs an acceptable output. With enough human feedback, the LLM can learn that if there‚Äôs an 80% probability that a user will accept an output, then it‚Äôs fine to generate. Want to try it out? Check out these <a href="https://github.com/opendilab/awesome-RLHF" target="_blank" rel="noopener">resources, including codebases, for RLHF</a>.</p>
<ul>
<li><strong>Fine-tuning</strong> is when the model‚Äôs generated output is evaluated against an intended or known output. For example, you know that the sentiment behind a statement like this is negative: ‚ÄúThe soup is too salty.‚Äù To evaluate the LLM, you‚Äôd feed this sentence to the model and query it to label the sentiment as positive or negative. If the model labels it as positive, then you‚Äôd adjust the model‚Äôs parameters and try prompting it again to see if it can classify the sentiment as negative.</li>
</ul>
<p>Fine-tuning can result in a highly customized LLM that excels at a specific task, but it uses supervised learning, which requires time-intensive labeling. In other words, each input sample requires an output that‚Äôs labeled with exactly the correct answer. That way, the actual output can be measured against the labeled one and adjustments can be made to the model‚Äôs parameters. The advantage of RLHF, as mentioned above, is that you don‚Äôt need an exact label.</p>
<p><strong>4. Set up the app‚Äôs architecture</strong>. The different components you‚Äôll need to set up your LLM app can be roughly grouped into three categories:</p>
<ul>
<li><strong>User input</strong> which requires a UI, an LLM, and an app hosting platform.</li>
<li><strong>Input enrichment and prompt construction tools.</strong> This includes your data source, embedding model, a vector database, prompt construction and optimization tools, and a data filter.
</li>
<li>
<p><strong>Efficient and responsible AI tooling,</strong> which includes an LLM cache, LLM content classifier or filter, and a telemetry service to evaluate the output of your LLM app.</p>
</li>
</ul>
<p><strong>5. Conduct online evaluations of your app.</strong> These evaluations are considered ‚Äúonline‚Äù because they assess the LLM‚Äôs performance during user interaction. For example, online evaluations for GitHub Copilot are measured through acceptance rate (how often a developer accepts a completion shown to them), as well as the retention rate (how often and to what extent a developer edits an accepted completion).</p>

<hr/>
<h2 id="the-emerging-architecture-of-llm-apps" id="the-emerging-architecture-of-llm-apps">The emerging architecture of LLM apps<a href="#the-emerging-architecture-of-llm-apps" aria-label="The emerging architecture of LLM apps"></a></h2>
<p>Let‚Äôs get started on architecture. We‚Äôre going to revisit our friend <a href="https://github.blog/2023-07-17-prompt-engineering-guide-generative-ai-llms/#building-applications-using-llms" target="_blank" rel="noopener">Dave</a>, whose Wi-Fi went out on the day of his World Cup watch party. Fortunately, Dave was able to get his Wi-Fi running in time for the game, thanks to an LLM-powered assistant.</p>
<p><strong>We‚Äôll use this example and the diagram above to <strong>walk through a user flow with an LLM app, and break down the kinds of tools you‚Äôd need to build it. <g-emoji fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f447.png?v8" alias="point_down">üëá</g-emoji></strong></strong></p>
<figure id="attachment_74991"><a href="https://github.blog/wp-content/uploads/2023/10/LLMapparchitecturediagram.png?resize=4088%2C2148?w=1536" target="_blank" rel="noopener"><img decoding="async" width="4088" height="2148" src="https://github.blog/wp-content/uploads/2023/10/LLMapparchitecturediagram.png?resize=4088%2C2148" alt="Flow chart that reads from right to left, showing components of a large language model application and how they all work together. Data source for diagram is detailed here: https://github.blog/?p=74969&amp;preview=true#the-emerging-architecture-of-llm-apps" loading="lazy" srcset="https://github.blog/wp-content/uploads/2023/10/LLMapparchitecturediagram.png?resize=4088%2C2148?w=4088 4088w, https://github.blog/wp-content/uploads/2023/10/LLMapparchitecturediagram.png?resize=4088%2C2148?w=300 300w, https://github.blog/wp-content/uploads/2023/10/LLMapparchitecturediagram.png?resize=4088%2C2148?w=768 768w, https://github.blog/wp-content/uploads/2023/10/LLMapparchitecturediagram.png?resize=4088%2C2148?w=1024 1024w, https://github.blog/wp-content/uploads/2023/10/LLMapparchitecturediagram.png?resize=4088%2C2148?w=1536 1536w, https://github.blog/wp-content/uploads/2023/10/LLMapparchitecturediagram.png?resize=4088%2C2148?w=2048 2048w, https://github.blog/wp-content/uploads/2023/10/LLMapparchitecturediagram.png?resize=4088%2C2148?w=3000 3000w" sizes="(max-width: 1000px) 100vw, 1000px" data-recalc-dims="1"/></a><figcaption>Click diagram to enlarge and save.</figcaption></figure>
<h3 id="user-input-tools" id="user-input-tools">User input tools<a href="#user-input-tools" aria-label="User input tools"></a></h3>
<p>When Dave‚Äôs Wi-Fi crashes, he calls his internet service provider (ISP) and is directed to an LLM-powered assistant. The assistant asks Dave to explain his emergency, and Dave responds, ‚ÄúMy TV was connected to my Wi-Fi, but I bumped the counter, and the Wi-Fi box fell off! Now, we can‚Äôt watch the game.‚Äù</p>
<p>In order for Dave to interact with the LLM, we need four tools:</p>
<ul>
<li><strong>LLM API and host</strong>: Is the LLM app running on a local machine or in the cloud? In an ISP‚Äôs case, it‚Äôs probably hosted in the cloud to handle the volume of calls like Dave‚Äôs. <a href="https://github.com/vercel" target="_blank" rel="noopener">Vercel</a> and early projects like <a href="https://github.com/jina-ai/rungpt" target="_blank" rel="noopener">jina-ai/rungpt</a> aim to provide a cloud-native solution to deploy and scale LLM apps.</li>
</ul>
<p>But if you want to build an LLM app to tinker, hosting the model on your machine might be more cost effective so that you‚Äôre not paying to spin up your cloud environment every time you want to experiment. You can find conversations on GitHub Discussions about hardware requirements for models like LLaMA‚Äö two of which can be found <a href="https://github.com/facebookresearch/llama/issues/79" target="_blank" rel="noopener">here</a> and <a href="https://github.com/facebookresearch/llama/issues/425" target="_blank" rel="noopener">here</a>.</p>
<ul>
<li><strong>The UI</strong>: Dave‚Äôs keypad is essentially the UI, but in order for Dave to use his keypad to switch from the menu of options to the emergency line, the UI needs to include a router tool.</li>
<li><strong>Speech-to-text translation tool</strong>: Dave‚Äôs verbal query then needs to be fed through a speech-to-text translation tool that works in the background.</li>
</ul>
<h3 id="input-enrichment-and-prompt-construction-tools" id="input-enrichment-and-prompt-construction-tools">Input enrichment and prompt construction tools<a href="#input-enrichment-and-prompt-construction-tools" aria-label="Input enrichment and prompt construction tools"></a></h3>
<p>Let‚Äôs go back to Dave. The LLM can analyze the sequence of words in Dave‚Äôs transcript, classify it as an IT complaint, and provide a contextually relevant response. (The LLM‚Äôs able to do this because it‚Äôs been trained on the internet‚Äôs entire corpus, which includes IT support documentation.)</p>
<p><strong>Input enrichment tools</strong> aim to contextualize and package the user‚Äôs query in a way that will generate the most useful response from the LLM.</p>
<ul>
<li>A <strong>vector database</strong> is where you can store embeddings, or index high-dimensional vectors. It also increases the probability that the LLM‚Äôs response is helpful by providing additional information to further contextualize your user‚Äôs query.</li>
</ul>
<p>Let‚Äôs say the LLM assistant has access to the company‚Äôs complaints search engine, and those complaints and solutions are stored as embeddings in a vector database. Now, the LLM assistant uses information not only from the internet‚Äôs IT support documentation, but also from documentation specific to customer problems with the ISP.</p>
<ul>
<li>But in order to retrieve information from the vector database that‚Äôs relevant to a user‚Äôs query, we need an <strong>embedding model</strong> to translate the query into an embedding. Because the embeddings in the vector database, as well as Dave‚Äôs query, are translated into high-dimensional vectors, the vectors will capture both the semantics and intention of the natural language, not just its syntax.</li>
</ul>
<p>Here‚Äôs a list of <a href="https://github.com/topics/text-embedding" target="_blank" rel="noopener">open source text embedding models</a>. <a href="https://platform.openai.com/docs/guides/embeddings/embedding-models" target="_blank" rel="noopener">OpenAI</a> and <a href="https://huggingface.co/blog/getting-started-with-embeddings" target="_blank" rel="noopener">Hugging Face</a> also provide embedding models.</p>
<p>Dave‚Äôs contextualized query would then read like this:</p>
<pre><code>// pay attention to the the following relevant information.
to the colors and blinking pattern.

// pay attention to the following relevant information.

// The following is an IT complaint from, Dave Anderson, IT support expert.
Answers to Dave&#39;s questions should serve as an example of the excellent support
provided by the ISP to its customers.

*Dave: Oh it&#39;s awful! This is the big game day. My TV was connected to my
Wi-Fi, but I bumped the counter and the Wi-Fi box fell off and broke! Now we
can&#39;t watch the game.
</code></pre>
<p>Not only do these series of prompts contextualize Dave‚Äôs issue as an IT complaint, they also pull in context from the company‚Äôs complaints search engine. That context includes common internet connectivity issues and solutions.</p>
<p>MongoDB released a public preview of <a href="https://www.mongodb.com/developer/products/atlas/building-generative-ai-applications-vector-search-open-source-models/" target="_blank" rel="noopener">Vector Atlas Search</a>, which indexes high-dimensional vectors within MongoDB. <a href="https://github.com/qdrant" target="_blank" rel="noopener">Qdrant</a>, <a href="https://github.com/pinecone-io" target="_blank" rel="noopener">Pinecone</a>, and <a href="https://github.com/milvus-io" target="_blank" rel="noopener">Milvus</a> also provide free or open source vector databases.</p>

<ul>
<li>A <strong>data filter</strong> will ensure that the LLM isn‚Äôt processing unauthorized data, like personal identifiable information. Preliminary projects like <a href="https://github.com/amoffat/HeimdaLLM" target="_blank" rel="noopener">amoffat/HeimdaLLM</a> are working to ensure LLMs access only authorized data.</li>
<li>A <strong>prompt optimization tool</strong> will then help to package the end user‚Äôs query with all this context. In other words, the tool will help to prioritize which context embeddings are most relevant, and in which order those embeddings should be organized in order for the LLM to produce the most contextually relevant response. This step is what ML researchers call prompt engineering, where a series of algorithms create a prompt. (A note that this is different from the prompt engineering that end users do, which is also known as in-context learning).</li>
</ul>
<p>Prompt optimization tools like <a href="https://github.com/langchain-ai/langchain" target="_blank" rel="noopener">langchain-ai/langchain</a> help you to compile prompts for your end users. Otherwise, you‚Äôll need to DIY a series of algorithms that retrieve embeddings from the vector database, grab snippets of the relevant context, and order them. If you go this latter route, you could use <a href="https://github.blog/2023-09-20-github-copilot-chat-beta-now-available-for-all-individuals/" target="_blank" rel="noopener">GitHub Copilot Chat</a> or ChatGPT to assist you.</p>
<div><p>Learn how the GitHub Copilot team uses the <a href="https://github.blog/2023-07-17-prompt-engineering-guide-generative-ai-llms/" target="_blank" rel="noopener">Jaccard similarity</a> to decide which pieces of context are most relevant to a user‚Äôs query &gt;</p></div>
<h3 id="efficient-and-responsible-ai-tooling" id="efficient-and-responsible-ai-tooling">Efficient and responsible AI tooling<a href="#efficient-and-responsible-ai-tooling" aria-label="Efficient and responsible AI tooling"></a></h3>
<p>To ensure that Dave doesn‚Äôt become even more frustrated by waiting for the LLM assistant to generate a response, the LLM can quickly retrieve an output from a cache. And in the case that Dave does have an outburst, we can use a content classifier to make sure the LLM app doesn‚Äôt respond in kind. The telemetry service will also evaluate Dave‚Äôs interaction with the UI so that you, the developer, can improve the user experience based on Dave‚Äôs behavior.</p>
<ul>
<li>An <strong>LLM cache</strong> stores outputs. This means instead of generating new responses to the same query (because Dave isn‚Äôt the first person whose internet has gone down), the LLM can retrieve outputs from the cache that have been used for similar queries. Caching outputs can reduce latency, computational costs, and variability in suggestions.</li>
</ul>
<p>You can experiment with a tool like <a href="https://github.com/zilliztech/GPTCache" target="_blank" rel="noopener">zilliztech/GPTcache</a> to cache your app‚Äôs responses.</p>
<ul>
<li>A <strong>content classifier or filter</strong> can prevent your automated assistant from responding with harmful or offensive suggestions (in the case that your end users take their frustration out on your LLM app).</li>
</ul>
<p>Tools like <a href="https://github.com/derwiki/llm-prompt-injection-filtering" target="_blank" rel="noopener">derwiki/llm-prompt-injection-filtering</a> and <a href="https://github.com/laiyer-ai/llm-guard" target="_blank" rel="noopener">laiyer-ai/llm-guard</a> are in their early stages but working toward preventing this problem.</p>
<ul>
<li>A <strong>telemetry service</strong> will allow you to evaluate how well your app is working with actual users. A service that responsibly and transparently monitors user activity (like how often they accept or change a suggestion) can share useful data to help improve your app and make it more useful.</li>
</ul>
<p><a href="https://github.com/open-telemetry" target="_blank" rel="noopener">OpenTelemetry</a>, for example, is an open source framework that gives developers a standardized way to collect, process, and export telemetry data across development, testing, staging, and production environments.</p>
<p>Learn <a href="https://github.blog/2023-10-16-measuring-git-performance-with-opentelemetry/" target="_blank" rel="noopener">how GitHub uses OpenTelemetry</a> to measure Git performance &gt;</p>

<p>Woohoo! ü•≥ Your LLM assistant has effectively answered Dave‚Äôs many queries. His router is up and working, and he‚Äôs ready for his World Cup watch party. Mission accomplished!</p>
<hr/>
<h2 id="real-world-impact-of-llms" id="real-world-impact-of-llms">Real-world impact of LLMs<a href="#real-world-impact-of-llms" aria-label="Real-world impact of LLMs"></a></h2>
<p>Looking for inspiration or a problem space to start exploring? Here‚Äôs a list of ongoing projects where LLM apps and models are making real-world impact.</p>
<ul>
<li>NASA and IBM recently open sourced the <a href="https://www.earthdata.nasa.gov/news/impact-ibm-hls-foundation-model" target="_blank" rel="noopener">largest geospatial AI model</a> to increase access to NASA earth science data. The hope is to accelerate discovery and understanding of climate effects.</li>
<li>Read how the Johns Hopkins Applied Physics Laboratory is designing a <a href="https://www.jhuapl.edu/news/news-releases/230817a-cpg-ai-battlefield-medical-assistance" target="_blank" rel="noopener">conversational AI agent</a> that provides, in plain English, medical guidance to untrained soldiers in the field based on established care procedures.</li>
<li>Companies like <a href="https://github.com/customer-stories/duolingo" target="_blank" rel="noopener">Duolingo</a> and <a href="https://github.com/customer-stories/mercado-libre" target="_blank" rel="noopener">Mercado Libre</a> are using <a href="https://github.com/features/copilot" target="_blank" rel="noopener">GitHub Copilot</a> to help more people learn another language (for free) and democratize ecommerce in Latin America, respectively.</li>
</ul>
<hr/>
<h3 id="further-reading" id="further-reading">Further reading<a href="#further-reading" aria-label="Further reading"></a></h3>
<ul>
<li><a href="https://github.blog/2023-10-05-a-developers-guide-to-open-source-llms-and-generative-ai/#open-source-llms-available-today">A developer‚Äôs guide to open source LLMs and generative AI</a></li>
<li><a href="https://github.blog/2023-10-27-demystifying-llms-how-they-can-do-things-they-werent-trained-to-do/">Demystifying LLMs: How they can do things they weren‚Äôt trained to do</a></li>
<li><a href="https://github.blog/2023-07-17-prompt-engineering-guide-generative-ai-llms/">A developer‚Äôs guide to prompt engineering and LLMs</a></li>
<li><a href="https://github.blog/2023-09-06-how-to-build-an-enterprise-llm-application-lessons-from-github-copilot/">How to build an enterprise LLM application: Lessons from GitHub Copilot</a></li>
</ul>

      
  </main>


  </div>
</div><div data-color-mode="dark" data-light-theme="light" data-dark-theme="dark">
  <section id="newsletter">
  <div>
    <div>
      <div>
        <div>
          <h2> Subscribe to The GitHub Insider</h2>
          <p>Discover tips, technical guides, and best practices in our monthly newsletter for developers.</p>
        </div>
        
      </div>
    </div>
  </div>
</section>
	
</div></div>
  </body>
</html>
