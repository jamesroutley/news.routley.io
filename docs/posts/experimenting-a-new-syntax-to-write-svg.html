<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://yuanchuan.dev/experimenting-a-new-syntax-to-write-svg">Original</a>
    <h1>Experimenting a new syntax to write SVG</h1>
    
    <div id="readability-page-1" class="page"><div>
  
  <div>
    <article>
  <p>
    It&#39;s been a while since I introduced a new syntax to the <a href="https://css-doodle.com">css-doodle</a> project
    to solve my own problems.
    While I&#39;m not sure it would be useful elsewhere,
    I need to make some notes before I forget the details.
  </p>

  <!--more-->

  <h2>Motivation</h2>
  <p>
    I always find it a bit hard to write SVG without the help of additional tools or libraries.
    The main issue for me is that SVG code grows too fast to keep up.
    If we take a closer look at the way most SVG is written,
    you&#39;ll notice that the code grows in two dimensions: <strong>attributes</strong> and <strong>tags</strong>.
  </p>

  <p>
    <svg width="180px" height="180px" viewBox="0 0 10 10">
      <path fill="none" stroke="#000" stroke-width=".25" stroke-linecap="square" d="M 1 1 L 1 9 M 1 1 L 9 1
           M .5 8.5 L 1 9.2 L 1.5 8.5
           M 8.5 .5 L 9.2 1 L 8.5 1.5"></path>
      <g text-anchor="middle" font-size=".8" font-family="monospace">
        <text x="5" y="2">ATTRIBUTES</text>
        <text x="1.75" y="5" writing-mode="vertical-lr">TAGS</text>
      </g>
    </svg>
  </p>

  <p>
    From this perspective, it might explain why writing HTML is relatively easier than SVG.
    There are much fewer attributes in HTML elements
    so the code of HTML grows approximately by tags in <strong>ONE</strong> dimension.
  </p>

  <p>
    HTML could have become like SVG if CSS did not exist.
    We can see this from several deprecated attributes
    such as <code>bgColor</code>, <code>align</code>, <code>border</code>, etc.
  </p>

<figure><pre><code data-lang="css"><span>&lt;</span><span>div</span> <span>bgColor</span><span>=</span><span>&#34;#ff0&#34;</span><span>&gt;&lt;/</span><span>div</span><span>&gt;</span></code></pre></figure>
  <p>
    Nowadays, though, it&#39;s still possible for HTML to grow in <strong>two</strong> dimensions
    if using tools like <a href="https://tailwindcss.com/">Tailwind</a>,
    where the long predefined class names are kind of extended attributes to HTML elements.
  </p>

  <h2>CSS Syntax</h2>
  <p>
    Fortunately, not all SVG attributes are only written in tags.
    The <a href="https://www.w3.org/TR/SVG2/styling.html#PresentationAttributes">
      presentation attributes
    </a>
    can also be placed in <a href="https://www.w3.org/TR/html401/present/styles.html">style sheets</a> as normal CSS properties.
  </p>
<figure><pre><code data-lang="css"><span>path</span> <span>{</span>
  <span>stroke</span><span>:</span> <span>rebeccapurple</span><span>;</span>
  <span>stroke-dasharray</span><span>:</span> <span>5</span> <span>1</span> <span>5</span><span>;</span>
<span>}</span></code></pre></figure>

  <p>
    What I love about CSS is its readability.
    There are no unnecessary quotes around property values even when separated by spaces.
    And the CSS code always expands from top to bottom if following best practices.
  </p>

  <p>What if I could write all SVG attributes in CSS? </p>

  <p>
    Despite the fact it&#39;s unlikely to change the two-dimensional nature of SVG code to one-dimensional at the same time to
    make it <a href="https://en.wikipedia.org/wiki/Isomorphism">isomorphic</a> transforming back and forth,
    it would at least be pleasant to write SVG with the syntax of CSS.
  </p>

<figure><pre><code data-lang="css"><span>svg</span> <span>{</span>
  <span>viewBox</span><span>:</span> <span>0</span> <span>0</span> <span>10</span> <span>10</span><span>;</span>
<span>}</span></code></pre></figure>

  <p>
    This seems to work. Tags are written as CSS selectors and attributes as CSS properties.
    For child SVG elements we can use the upcoming <a href="https://www.w3.org/TR/css-nesting-1/">CSS nesting syntax</a>.
    However, I&#39;d prefer the <a href="https://sass-lang.com/documentation/style-rules#nesting">SCSS</a> way of nesting because I don&#39;t have the same concerns with browser engines
    as described in <a href="https://developer.chrome.com/blog/help-css-nesting/#:~:text=There%20are%20a%20few%20reasons%20the%20most%20popular%20nesting%20syntax%20can&#39;t%20be%20used%20as%20is">this article</a>.
  </p>

<figure><pre><code data-lang="css"><span>svg</span> <span>{</span>
  <span>viewBox</span><span>:</span> <span>0</span> <span>0</span> <span>100</span> <span>100</span><span>;</span>
  <span>path</span> <span>{</span>
    <span>d</span><span>:</span> <span>M</span> <span>50</span> <span>1</span> <span>1</span> <span>50</span> <span>50</span> <span>99</span> <span>99</span> <span>50</span> <span>z</span><span>;</span>
    <span>stroke</span><span>:</span> <span>rebeccapurple</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre></figure>

  <!--
  <p>
    Now the focus will be mainly on attributes.
  </p>
  -->

  <h2>Parsing Challenges</h2>

  <p>
    The process of converting from SVG syntax to CSS did not go as smoothly as expected
    due to the various formats of SVG attribute names and values.
    Therefore, I had to extend the CSS syntax a bit.
  </p>

  <h3>1. Colon-separated attributes</h3>

<figure><pre><code data-lang="html"><span>&lt;use</span> <span>xlink:href=</span><span>&#34;#circle&#34;</span> <span>/&gt;</span></code></pre></figure>

  <p>
    Since CSS uses the colon symbol as the separator in a declaration,
    it must be handled specially if the attribute name also contains a <em>colon</em> character.
  </p>

<figure><pre><code data-lang="css"><span>use</span> <span>{</span>
  <span>xlink</span><span>:</span><span>href</span><span>:</span> <span>#c</span><span>ircle</span><span>;</span>
<span>}</span></code></pre></figure>

  <h3>2. Semicolons in SVG animation</h3>
<figure><pre><code data-lang="html"><span>&lt;animate</span> <span>value=</span><span>&#34;25,20,50,75; 45,55,50,75&#34;</span> <span>/&gt;</span></code></pre></figure>

  <p>
    In CSS, a semicolon is used to mark the end of a declaration.
    In SVG, on the other hand, semicolons are used to group animation values.
    How can you tell the difference between the two types of semicolons when they are put together?
  </p>

<figure><pre><code data-lang="css"><span>animate</span> <span>{</span>
  <span>value</span><span>:</span> <span>25</span><span>,</span><span>20</span><span>,</span><span>50</span><span>,</span><span>75</span><span>;</span> <span>45,55,50,75;</span>
<span>}</span></code></pre></figure>

  <h3>3. Text</h3>
<figure><pre><code data-lang="html"><span>&lt;text&gt;</span>hello world<span>&lt;/text&gt;</span></code></pre></figure>

  <p>
    There is no way to specify a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Text">text node</a> in CSS property,
    so I need to define a new one to hold the content of the text node
    as respect to <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Pseudo-elements">pseudo-element</a> in CSS.
  </p>
<figure><pre><code data-lang="css"><span>text</span> <span>{</span>
  <span>content</span><span>:</span> <span>hello</span> <span>world</span><span>;</span>
<span>}</span></code></pre></figure>

  <h3>4. Inline styles</h3>
<figure><pre><code data-lang="html"><span>&lt;circle</span> <span>style=</span><span>&#34;animation: move .2s; fill: red&#34;</span> <span>/&gt;</span></code></pre></figure>
  <p>
    Using the <code>style</code> keyword to represent
    each CSS property is the best way I could find to convert inline styles.
    They are normally not encouraged to use so
    it seems reasonable to make them a bit more verbose.
  </p>
<figure><pre><code data-lang="css"><span>circle</span> <span>{</span>
  <span>style</span> <span>animation</span><span>:</span> <span>move</span> <span>.2s</span><span>;</span>
  <span>style</span> <span>fill</span><span>:</span> <span>red</span><span>;</span>
<span>}</span></code></pre></figure>

  <p>
    This is how the code for a simple graph will look like:
  </p>

  <div>
<figure><pre><code data-lang="css"><span>svg</span> <span>{</span>
  <span>viewBox</span><span>:</span> <span>0</span> <span>0</span> <span>10</span> <span>10</span><span>;</span>
  <span>stroke</span><span>:</span> <span>black</span><span>;</span>
  <span>stroke-width</span><span>:</span> <span>.1</span><span>;</span>
  <span>rect</span> <span>{</span>
    <span>x</span><span>:</span> <span>8</span><span>;</span>
    <span>y</span><span>:</span> <span>8</span><span>;</span>
    <span>width</span><span>:</span> <span>1</span><span>;</span>
    <span>height</span><span>:</span> <span>1</span><span>;</span>
    <span>fill</span><span>:</span> <span>yellow</span><span>;</span>
    <span>style</span> <span>transform-box</span><span>:</span> <span>fill-box</span><span>;</span>
    <span>transform-origin</span><span>:</span> <span>center</span><span>;</span>
    <span>transform</span><span>:</span> <span>rotate</span><span>(</span><span>45</span><span>)</span>
  <span>}</span>
  <span>circle</span> <span>{</span>
    <span>fill</span><span>:</span> <span>deepskyblue</span><span>;</span>
    <span>cx</span><span>:</span> <span>4</span><span>;</span>
    <span>cy</span><span>:</span> <span>4</span><span>;</span>
    <span>r</span><span>:</span> <span>3</span>
  <span>}</span>
<span>}</span></code></pre></figure>

    <css-doodle></css-doodle>
  </div>

  <h2>Some New Features</h2>

  <p>

    As I experimented further, I realized that several new features would make the new syntax more user-friendly.
  </p>

  <h3>1. Attribute Destructuring</h3>
  <p>
    Some attributes can logically be grouped in pairs,
    so it is convenient to place them on the same line, separated by <em>commas</em>.
  </p>

<figure><pre><code data-lang="css"><span>/* &lt;rect width=&#34;50%&#34; height=&#34;50%&#34; /&gt; */</span>
<span>rect</span> <span>{</span>
  <span>width,</span> <span>height</span><span>:</span> <span>50%</span><span>;</span>
<span>}</span>

<span>/* &lt;circle cx=&#34;4&#34; cy=&#34;5&#34; /&gt; */</span>
<span>circle</span> <span>{</span>
  <span>cx,</span> <span>cy</span><span>:</span> <span>4</span> <span>5</span><span>;</span>
<span>}</span></code></pre></figure>

  <p>
    This shorthand also makes it possible to use it with the <code>@plot</code> function
    in <code>css-doodle</code> which returns a pair of coordinate values.
  </p>
<figure><pre><code data-lang="css"><span>circle</span> <span>{</span>
  <span>cx,</span> <span>cy</span><span>:</span> <span>@</span><span>plot</span><span>(</span><span>r</span><span>:</span> <span>4</span><span>);</span>
<span>}</span></code></pre></figure>

  <h3>2. Id Abbreviation</h3>

  <p>
    The <code>id</code> attribute is for referencing element and is often used
    in gradients, markers, and filters.
    Instead of writing it inside blocks,
    it can also be set as an ordinary CSS <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/ID_selectors">id selector</a> of the element.
  </p>

<figure><pre><code data-lang="css"><span>filter</span><span>#my-filter</span> <span>{</span>

<span>}</span>

<span>/* is equivalent to */</span>

<span>filter</span> <span>{</span>
  <span>id</span><span>:</span> <span>my-filter</span><span>;</span>
<span>}</span></code></pre></figure>

  <h3>3. Inline defs</h3>
  <p>
    In SVG, graphic objects are stored within the <code>&lt;defs&gt;</code> element and to be use somewhere else by referencing their ids.
    But sometimes I find it quite neat to define them directly where they are to be used. The reference ids are then generated automatically.
  </p>
<figure><pre><code data-lang="css"><span>circle</span> <span>{</span>
  <span>fill</span><span>:</span> <span>defs</span> <span>linearGradient</span> <span>{</span><span>}</span>
<span>}</span>

<span>/* is equivalent to */</span>

<span>defs</span> <span>{</span>
  <span>linearGradient#my-gradient</span> <span>{</span><span>}</span>
<span>}</span>
<span>circle</span> <span>{</span>
  <span>fill</span><span>:</span> <span>url(#my-gradient)</span><span>;</span>
<span>}</span></code></pre></figure>

  <h4>4. Multiplication</h4>
  <p>
    Inspired by <a href="https://docs.emmet.io/abbreviations/syntax/#multiplication">Emmet</a>,
    the operator <code>*</code> is used to generate the same element multiple times.
  </p>
<figure><pre><code data-lang="css"><span>circle</span><span>*</span><span>3</span> <span>{</span>

<span>}</span>

<span>/* is equivalent to */</span>

<span>circle</span> <span>{}</span>
<span>circle</span> <span>{}</span>
<span>circle</span> <span>{}</span></code></pre></figure>

  <p>
    It&#39;ll be most effective when combined with <code>css-doodle</code> functions.
  </p>

<div>
<figure><pre><code data-lang="css"><span>svg</span> <span>{</span>
  <span>viewBox</span><span>:</span> <span>0</span> <span>0</span> <span>10</span> <span>10</span><span>;</span>
  <span>stroke</span><span>:</span> <span>#000</span><span>;</span>
  <span>stroke-width</span><span>:</span> <span>.1</span><span>;</span>
  <span>path*3</span> <span>{</span>
    <span>fill</span><span>:</span> <span>none</span><span>;</span>
    <span>d</span><span>:</span> <span>@</span><span>pn</span><span>(</span><span>M</span> <span>5</span> <span>10</span> <span>Q</span> <span>5</span> <span>5</span> <span>8</span> <span>1</span><span>,</span>
           <span>M</span> <span>5</span> <span>10</span> <span>Q</span> <span>4</span> <span>5</span> <span>2</span> <span>4</span><span>,</span>
           <span>M</span> <span>5</span> <span>10</span> <span>Q</span> <span>6</span> <span>6</span> <span>8</span> <span>4</span><span>);</span>
  <span>}</span>
  <span>circle</span><span>*</span><span>3</span> <span>{</span>
    <span>fill</span><span>:</span> <span>@</span><span>pn</span><span>(</span><span>yellow</span><span>,</span> <span>blueviolet</span><span>,</span> <span>deeppink</span><span>);</span>
    <span>cx,</span> <span>cy</span><span>:</span> <span>@</span><span>pn</span><span>(</span><span>8</span> <span>1</span><span>,</span> <span>2</span> <span>4</span><span>,</span> <span>8</span> <span>4</span><span>);</span>
    <span>r</span><span>:</span> <span>.5</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre></figure>

<css-doodle></css-doodle>
</div>

<p>Here&#39;s an example to draw a symmetrical structure.</p>

<div>
<figure><pre><code data-lang="css"><span>svg</span> <span>{</span>
  <span>viewBox</span><span>:</span> <span>-50</span> <span>-50</span> <span>100</span> <span>100</span><span>;</span>
  <span>path*6</span> <span>{</span>
    <span>transform</span><span>:</span> <span>rotate</span><span>(</span><span>@</span><span>calc</span><span>(</span><span>@</span><span>n</span><span>*</span><span>60</span><span>));</span>
    <span>stroke-linecap</span><span>:</span> <span>round</span><span>;</span>
    <span>stroke</span><span>:</span> <span>black</span><span>;</span>
    <span>d</span><span>:</span> <span>M</span> <span>0</span> <span>0</span> <span>0</span> <span>44</span>
       <span>@</span><span>M2x3</span><span>(</span><span>M</span> <span>0</span> <span>@</span><span>calc</span><span>(</span><span>-9</span><span>*@</span><span>ny</span><span>)</span>
             <span>L</span> <span>@</span><span>pn</span><span>(</span><span>±</span><span>9</span><span>)</span> <span>@</span><span>calc</span><span>(</span><span>-10</span><span>*@</span><span>ny</span> <span>-</span> <span>5.8</span><span>));</span>
  <span>}</span>
<span>}</span></code></pre></figure>

<css-doodle></css-doodle>
</div>

  <h2>More examples</h2>

  <p>
    Earlier this year, I <a href="https://twitter.com/yuanchuan23/status/1486321084865859585">tweeted</a> a code example that used this new syntax,
    as a reply to rewrite <a href="https://twitter.com/takawo/status/1486284989788418048">Shunsuke Takawo</a>&#39;s Processing program in <code>css-doodle</code>.
    The <em>multiplication</em> operator had not yet been added at that time.
  </p>

  <p>
    <img src="https://yuanchuan.dev/assets/images/post/svg/sample1.jpeg"/>
  </p>

  <p>
    Now the SVG part can be simplified as this: (<a href="https://codepen.io/yuanchuan/pen/yLjPmvv?editors=1010">CodePen</a>)
  </p>

<figure><pre><code data-lang="css"><span>svg</span> <span>{</span>
  <span>viewBox</span><span>:</span> <span>-57</span> <span>-57</span> <span>114</span> <span>114</span><span>;</span>
  <span>stroke-width</span><span>:</span> <span>.15</span><span>;</span>
  <span>stroke</span><span>:</span> <span>#000</span><span>;</span>
  <span>fill</span><span>:</span> <span>#fff</span><span>;</span>
  <span>circle*720</span> <span>{</span>
    <span>r</span><span>:</span> <span>@</span><span>calc</span><span>(</span><span>sin</span><span>(</span><span>π</span><span>/</span><span>@</span><span>N</span><span>*@</span><span>n</span><span>)</span><span>*</span><span>10</span><span>);</span>
    <span>cx,</span> <span>cy</span><span>:</span> <span>@</span><span>Plot</span><span>(</span>
      <span>r</span><span>:</span> <span>40</span><span>+</span><span>sin</span><span>(</span><span>4</span><span>t</span><span>)</span><span>*</span><span>5</span><span>+</span><span>sin</span><span>(</span><span>12</span><span>t</span><span>)</span><span>*</span><span>5</span>
    <span>);</span>
  <span>}</span>
<span>}</span></code></pre></figure>

  <p>
    I shared <a href="https://twitter.com/yuanchuan23/status/1486165654772523010">another sample on Twitter</a> that was generated using SVG paths and filters.
    I did not attach the code because I thought it was not as elegant as its output.
    Still, it would be a good example to recreate it with <code>css-doodle</code> functions under the new syntax.
  </p>

  <p>
    <img src="https://yuanchuan.dev/assets/images/post/svg/sample2.jpg"/>
  </p>

  <p>First, outline the structure by placing each <code>Q</code> coordinate around a circle.</p>

<div>
<figure><pre><code data-lang="css"><span>svg</span> <span>{</span>
  <span>viewBox</span><span>:</span> <span>0</span> <span>0</span> <span>100</span> <span>140</span><span>;</span>
  <span>g</span> <span>{</span>
    <span>fill</span><span>:</span> <span>none</span><span>;</span>
    <span>stroke</span><span>:</span> <span>black</span><span>;</span>
    <span>path*20</span> <span>{</span>
      <span>d</span><span>:</span> <span>M</span> <span>70</span> <span>50</span>
         <span>Q</span> <span>@</span><span>Plot</span><span>(</span><span>r</span><span>:</span> <span>60</span><span>;</span> <span>move</span><span>:</span> <span>20</span> <span>80</span><span>)</span>
           <span>@</span><span>Plot</span><span>(</span><span>r</span><span>:</span> <span>125</span><span>;</span> <span>move</span><span>:</span> <span>80</span> <span>60</span><span>);</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre></figure>

    <css-doodle click-to-update=""></css-doodle>
  </div>

  <p>
    Then add more paths and random stroke styles. Not as extactly as the old one but you get the idea.
    (<a href="https://codepen.io/yuanchuan/pen/xxjPvJe?editors=1000">CodePen</a>)
  </p>

  <div>
<figure><pre><code data-lang="css"><span>svg</span> <span>{</span>
  <span>viewBox</span><span>:</span> <span>0</span> <span>0</span> <span>100</span> <span>140</span><span>;</span>
  <span>g</span> <span>{</span>
    <span>fill</span><span>:</span> <span>none</span><span>;</span>
    <span>path*200</span> <span>{</span>
      <span>stroke</span><span>:</span> <span>@</span><span>p</span><span>(</span>
        <span>#f9f8eb</span><span>,</span> <span>#76b39d</span><span>,</span> <span>#05004e</span><span>,</span> <span>#fd5f00</span>
      <span>);</span>
      <span>stroke-width</span><span>:</span> <span>@</span><span>r2</span><span>;</span>
      <span>stroke-dasharray</span><span>:</span> <span>@</span><span>M2</span><span>.</span><span>@</span><span>r</span><span>(</span><span>10</span><span>,</span> <span>60</span><span>);</span>
      <span>d</span><span>:</span> <span>M</span> <span>70</span> <span>50</span>
         <span>Q</span> <span>@</span><span>Plot</span><span>(</span><span>r</span><span>:</span> <span>60</span><span>;</span> <span>move</span><span>:</span> <span>20</span> <span>80</span><span>)</span>
           <span>@</span><span>Plot</span><span>(</span><span>r</span><span>:</span> <span>125</span><span>;</span> <span>move</span><span>:</span> <span>80</span> <span>60</span><span>);</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre></figure>

    <css-doodle click-to-update=""></css-doodle>
  </div>

  <h2>How To Use It in Your Own Project?</h2>

  <p>
    The latest version of <code>css-doodle</code> offers
    the generator as a function that returns the output SVG code.
  </p>

<figure><pre><code data-lang="js"><span>import</span> <span>{</span> <span>svg</span> <span>}</span> <span>from</span> <span>&#39;</span><span>css-doodle/generator</span><span>&#39;</span><span>;</span>

<span>let</span> <span>code</span> <span>=</span> <span>svg</span><span>(</span><span>`
  viewBox: 0 0 10 10;
  circle {
    cx, cy, r: 5
  }
`</span><span>)</span>

<span>// output:</span>

<span>&lt;</span><span>svg</span> <span>xmlns</span><span>=</span><span>&#34;</span><span>http://www.w3.org/2000/svg</span><span>&#34;</span> <span>viewBox</span><span>=</span><span>&#34;</span><span>0 0 10 10</span><span>&#34;</span><span>&gt;</span>
  <span>&lt;</span><span>circle</span> <span>cx</span><span>=</span><span>&#34;</span><span>5</span><span>&#34;</span> <span>cy</span><span>=</span><span>&#34;</span><span>5</span><span>&#34;</span> <span>r</span><span>=</span><span>&#34;</span><span>5</span><span>&#34;</span><span>&gt;&lt;</span><span>/circle</span><span>&gt;
</span><span>&lt;</span><span>/svg&gt;</span></code></pre></figure>


  <h2>Limitations</h2>

  <p>
    The conversion isn&#39;t complete. Dealing with SVG elements like <code>&lt;foreignobject&gt;</code> can be difficult.
    I haven&#39;t tested it with long SVG code, but I think it&#39;ll also be bloated as the drawing gets complex.
  </p>
  <p>
    I like this new syntax mainly because it has less visual noise compared to the original SVG.
    For me the most satisfying thing is that it integrates so well with <code>css-doodle</code>.
  </p>

</article>








  </div>
</div></div>
  </body>
</html>
