<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://simonwillison.net/2022/Sep/30/action-transcription/">Original</a>
    <h1>A tool for capturing captions and transcripts from online videos</h1>
    
    <div id="readability-page-1" class="page"><div id="primary">

<div>




<p>I released a new project this weekend, built during the Bellingcat Hackathon (I came second!) It’s called <a href="https://github.com/simonw/action-transcription">Action Transcription</a> and it’s a tool for caturing captions and transcripts from online videos.</p>
<p>Here’s <a href="https://www.youtube.com/watch?v=AneNxjSGn1I">my video</a> introducing the new tool:</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen" frameborder="0" height="315" src="https://www.youtube.com/embed/AneNxjSGn1I" width="560"> </iframe>
<h4>Bellingcat</h4>
<p><a href="https://www.bellingcat.com/about/">Bellingcat</a> describe themselves as an “independent international collective of researchers, investigators and citizen journalists using open source and social media investigation to probe a variety of subjects”.</p>
<p>They specialize in open source intelligence—which, confusingly, does NOT mean “open source software”—this is a <a href="https://en.wikipedia.org/wiki/Open-source_intelligence">much older usage of the term</a> that describes the use of publicly available information to gather intelligence.</p>
<p>They have broken a LOT of impressive stories over their eight year lifespan. Wikipedia <a href="https://en.wikipedia.org/wiki/Bellingcat">has a good list</a>—highlights include identifying the suspects behind the <a href="https://en.wikipedia.org/wiki/Bellingcat#Skripal_poisoning">Skripal poisoning case</a>.</p>
<p>The theme of the hackathon was “General Digital Investigation Tools”. The goal was to build prototypes of tools that could be used by their community of investigators—most of whom are volunteers working from home with little-to-no budget, and often with limited technical skills (they can use tools very effectively but they might not be comfortable writing code or using the command-line).</p>
<p>Inspired by the recent release of <a href="https://github.com/openai/whisper">OpenAI’s Whisper</a>, I decided to build a tool that would make it easier to extract captions and transcripts from videos on social media sites.</p>
<h4>Why GitHub Actions and GitHub Issues?</h4>
<p>My goals for the project were:</p>
<ul>
<li>Help people achieve something useful</li>
<li>Make it as inexpensive to run as possible—ideally free</li>
<li>Make it easy for people to install and run their own copies</li>
</ul>
<p>I decided to build the entire thing using GitHub Actions and GitHub Issues.</p>
<p>GitHub Actions is a powerful service for running CI jobs and other automation, but its best feature for this particular project is that it’s free.</p>
<p>I’m fine with spending money myself, but if I’m building tools for other people having a way for them to run the tool without paying for anything is a huge win.</p>
<p>My tool needed a UI. To keep things as simple as possible, i didn’t want to host anything outside of GitHub itself. So I turned to GitHub Issues to provide the interface layer.</p>
<p>It’s easy to create Actions scripts that trigger when a new issue is created. And those scripts can then interact with that issue—attaching comments, or even closing it as completed.</p>
<p>I decided that my flow would be:</p>
<ol>
<li>The user opens an issue and pastes in a link to an online video.</li>
<li>GitHub Actions is triggered by that issue, extracts the URL and fetches the video using <a href="https://youtube-dl.org/">youtube-dl</a> (which, despite the name, can actually download videos from <a href="https://ytdl-org.github.io/youtube-dl/supportedsites.html">over 1,200 sites</a> including many of the social media services popular in Russia).</li>
<li>The script extracts just the audio from the video.</li>
<li>The audio is then passed through OpenAI’s Whisper, which can create a high quality transcript in the original language AND create a shockingly good English translation.</li>
<li>The caption is then both written back to the GitHub repository and attached to the original issue as a comment.</li>
</ol>
<p>GitHub Actions doesn’t (yet) provide GPUs, and Whisper works a whole lot faster with GPU access. So I decided to run Whisper using <a href="https://replicate.com/cjwbw/whisper">this hosted copy of the model on Replicate</a>.</p>
<h4>Extracting YouTube’s captions directly</h4>
<p>I had a check-in meeting with Tristan from Bellingcat just to make sure my hack wasn’t a duplicate effort, and to get feedback on the plan.</p>
<p>Tristan liked the plan, but pointed out that extracting captions directly from YouTube would be a useful additional feature.</p>
<p>In addition to supporting manual captions, it turns out YouTube already creates machine-generated captions in over 100 languages! The quality of these isn’t nearly as good as OpenAI Whisper, but they’re still useful. And they’re free (running Whisper currently costs me money).</p>
<p>So I adapted the plan, to provide the user with two options. The default option would extract captions directly from the video provider—which would definitely work for YouTube and might work for other sites too.</p>
<p>The second option would use Whisper to create a transcript and a translation, taking longer but providing results even for sites that didn’t offer their own captions.</p>
<p>I decided to use issue tags to trigger these two workflows: tag with “captions” to extract captions directly, tag with “whisper” to use Whisper.</p>
<h4>The implementation</h4>
<p>The implementation ended up being <a href="https://github.com/simonw/action-transcription/blob/7d900b209c6c465df35a27bb812d03754677cb78/.github/workflows/issue_created.yml">218 lines</a> of JavaScript-embedded-in-YAML in a GitHub Actions <code>issue_created.yml</code> workflow.</p>
<p>I used <a href="https://github.com/actions/github-script">actions/github-script</a> for it—a convenient reusable Action that provides a pre-configured set of JavaScript objects for interacting with the GitHub API.</p>
<p>The code isn’t hugely elegant: I’m not hugely familiar with the Node.js ecosystem so I ended up hacking around with Copilot quite a bit to figure out the patterns that would work.</p>
<p>It turns out captions can come back in a variety of different formats. The two most common appeared to be TTML—which uses XML, and WebVTT, a text-based format.</p>
<p>I decided to archive the original caption files in the GitHub repository itself, but I wanted to extract just the text and post that as the issue comment.</p>
<p>So I ended up building two tiny new tools: <a href="https://github.com/simonw/webvtt-to-json">webvtt-to-json</a> and <a href="https://github.com/simonw/ttml-to-json">ttml-to-json</a>—which converted the different formats into a standard JSON format of my own invention, normalizing the captions so I could then extract the text and include it in a comment.</p>
<p>Hackathons tend to encourage some pretty scrappy solutions!</p>
<h4>The results</h4>
<p>These two issues demonstrate the final result of the tool:</p>
<ul>
<li><a href="https://github.com/simonw/action-transcription-demo/issues/3">Example issue with a VK video transcribed to English using Whisper</a></li>
<li><a href="https://github.com/simonw/action-transcription-demo/issues/4">Example issue that extracted YouTube auto-generated English captions</a></li>
</ul>
<p>That first one in particular shows quite how good the Whisper model is at handling Russian text, and translating it to English.</p>
<h4>Adding issue templates</h4>
<p>I added one last enhancement to the project after recording the demo video for the judges embedded above.</p>
<p><a href="https://docs.github.com/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/configuring-issue-templates-for-your-repository">Issue templates</a> are a new GitHub feature that let you define a form that users must fill out when they create a new issue.</p>
<p>Frustratingly, these only work with public repositories. I had built my hack in a private repo at first, so I was only able to explore using issue templates once I had made it public.</p>
<p>I created <a href="https://github.com/simonw/action-transcription/tree/7d900b209c6c465df35a27bb812d03754677cb78/.github/ISSUE_TEMPLATE">two issue templates</a>—one for caption tasks and one for whisper tasks.</p>
<p>Now when a user goes to open a new issue they get to chose one of the two templates and fill in the URL as part of a form! Here’s a GIF demo showing that flow in action:</p>
<p><img alt="Animated demo. Click Issues, then New Issue, then select Get Started on the Capture captions menu option. Paste in a URL and click Submit new issue." src="https://static.simonwillison.net/static/2022/action-transcription-demo.gif"/></p>
<h4>Template repositories</h4>
<p>One last trick. I want users to be able to run this system themselves, on their own GitHub account.</p>
<p>I made <a href="https://github.com/simonw/action-transcription">simonw/action-transcription</a> a <a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/creating-a-template-repository">template repository</a>.</p>
<p>This means that any user can click a green button to get their own copy of the repository—and when they do, they’ll get their own fully configured copy of the GitHub Actions workflows too.</p>
<p>If they want to use Whisper they’ll need to get an API key from <a href="https://replicate.com/">Replicate.com</a> and add it to their repository’s secrets—but regular caption extraction will work fine without that.</p>
<p>I’ve used this technique before—I wrote about it here:</p>
<ul>
<li><a href="https://simonwillison.net/2022/Mar/14/shot-scraper-template/">Instantly create a GitHub repository to take screenshots of a web page</a></li>
<li><a href="https://simonwillison.net/2021/Aug/28/dynamic-github-repository-templates/">Dynamic content for GitHub repository templates using cookiecutter and GitHub Actions</a></li>
</ul>
<h4>GitHub Actions as a platform</h4>
<p>I’m pleased with how this project turned out. But I’m mainly excited about the underlying pattern. I think building tools using GitHub Actions that people can clone to their own accounts is a really promising way of developing sophisticated automated software that people can then run independently, entirely through the GitHub web interface.</p>
<p>I’m excited to see more tools adopt a similar pattern.</p>




</div>

</div></div>
  </body>
</html>
