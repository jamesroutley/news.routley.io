<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://aleph.se/andart2/math/the-cursed-d65536/">Original</a>
    <h1>The Cursed D65536</h1>
    
    <div id="readability-page-1" class="page"><article id="post-1908">
	<!-- .entry-header -->

	
	
	<div>
					<p><img src="https://imgs.xkcd.com/comics/d65536.png"/></p>
<p><a href="https://xkcd.com/2626/">XKCD joked about the problem of secure generation of random 32 bit numbers by rolling a 65536-sided die</a>. Such a die would of course be utterly impractical, but could you actually make a polyhedron that when rolled is a fair dice with 65536 equally likely outcomes?</p>

<p>I immediately <a href="https://twitter.com/anderssandberg/status/1531411623142998020">tweeted</a> one approach: take a d8 (octahedron), and subdivide each triangle recursively into 4 equal ones, projecting out to a sphere seven times. Then take the dual (vertices to faces, faces to vertices). The subdivision generates <img src="http://s0.wp.com/latex.php?latex=8%5Ccdot+4%5E7%3D131072&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="8\cdot 4^7=131072" title="8\cdot 4^7=131072"/> triangular faces. Each face has 3 vertices, shared between 6 faces, so the total number of vertices is 65536, and they become faces of my die.</p>
<p>This is wrong, as Greg Egan himself <a href="https://twitter.com/gregeganSF/status/1531466695612633088">pointed out</a>. (Note to self: never do math after midnight)</p>
<p>Euler’s formula states that <img src="http://s0.wp.com/latex.php?latex=F+%2B+V+%3D+E+%2B+2.&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="F + V = E + 2." title="F + V = E + 2."/> Since each face on the subdivided d8 has three edges, shared by two sides <img src="http://s0.wp.com/latex.php?latex=E%3D%283%2F2%29F&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="E=(3/2)F" title="E=(3/2)F"/>. So <img src="http://s0.wp.com/latex.php?latex=V%3DE-F%2B2%3D2%2BF%2F2&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="V=E-F+2=2+F/2" title="V=E-F+2=2+F/2"/>. With <img src="http://s0.wp.com/latex.php?latex=F%3D131072&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="F=131072" title="F=131072"/> I get <img src="http://s0.wp.com/latex.php?latex=V%3D65538&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="V=65538" title="V=65538"/>… two vertices too much, which means that after dualization I end up with a d65538 intead of a d65536!</p>
<p>This is of course hilariously cursed. It will look almost perfect, but very rarely give numbers outside the expected range.</p>
<p>(What went wrong? My above argument ignored that some vertices – the original polyhedron corners – are different from others.)</p>
<p><a href="https://twitter.com/ovjocm/status/1531637923472216064">Tim Freeman suggested an eminently reasonable approach</a>: start with a tetrahedron, subdivide triangles 7 times with projection outwards, and you end up with a d65536. With triangular sides rather than the mostly hexagonal ones in the cartoon.</p>

<p>But it gets better: when you subdivide a triangle the new vertices are projected out to the surrounding sphere. But that doesn’t mean the four new triangles have the same area. So the areas of the faces are uneven, and we have an unfair die.</p>
<p><a href="http://aleph.se/andart2/wp-content/uploads/2022/06/FUGz4TXWIAAeAVW.jpg"><img src="http://aleph.se/andart2/wp-content/uploads/2022/06/FUGz4TXWIAAeAVW-1024x960.jpg" alt="" width="1024" height="960" srcset="http://aleph.se/andart2/wp-content/uploads/2022/06/FUGz4TXWIAAeAVW-1024x960.jpg 1024w, http://aleph.se/andart2/wp-content/uploads/2022/06/FUGz4TXWIAAeAVW-300x281.jpg 300w, http://aleph.se/andart2/wp-content/uploads/2022/06/FUGz4TXWIAAeAVW-768x720.jpg 768w, http://aleph.se/andart2/wp-content/uploads/2022/06/FUGz4TXWIAAeAVW-1200x1125.jpg 1200w, http://aleph.se/andart2/wp-content/uploads/2022/06/FUGz4TXWIAAeAVW.jpg 1423w" sizes="(max-width: 1024px) 100vw, 1024px"/></a>Coloring the sides by relative area shows the fractal pattern of areas.</p>
<p><a href="http://aleph.se/andart2/wp-content/uploads/2022/06/FUG0iF0WQAAgELE.png"><img src="http://aleph.se/andart2/wp-content/uploads/2022/06/FUG0iF0WQAAgELE-1024x281.png" alt="" width="1024" height="281" srcset="http://aleph.se/andart2/wp-content/uploads/2022/06/FUG0iF0WQAAgELE-1024x281.png 1024w, http://aleph.se/andart2/wp-content/uploads/2022/06/FUG0iF0WQAAgELE-300x82.png 300w, http://aleph.se/andart2/wp-content/uploads/2022/06/FUG0iF0WQAAgELE-768x211.png 768w, http://aleph.se/andart2/wp-content/uploads/2022/06/FUG0iF0WQAAgELE-1200x330.png 1200w, http://aleph.se/andart2/wp-content/uploads/2022/06/FUG0iF0WQAAgELE.png 1423w" sizes="(max-width: 1024px) 100vw, 1024px"/></a>Plotting a histogram of areas show the fractal unevenness. The biggest face has 6.56 times area of the smallest face, so it is not a neglible bias.</p>
<p>One way of solving this is to move the points laterally along the sphere surface to equalize the areas. One can for example use <a href="https://en.wikipedia.org/wiki/Lloyd%27s_algorithm">Lloyd’s algorithm</a>. <a href="https://arxiv.org/abs/1607.04590">There are many other ways people distribute points evenly on spheres</a> that might be relevant. But subtly unfair giant dice have their own charm.</p>
<h2>Unequal dice</h2>
<p>Note that dice with different face areas can also be fair. Imagine a n-sided prism with length <img src="http://s0.wp.com/latex.php?latex=L&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="L" title="L"/>. If <img src="http://s0.wp.com/latex.php?latex=L%5Crightarrow+%5Cinfty&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="L\rightarrow \infty" title="L\rightarrow \infty"/> the probability of landing on one of the end polygons <img src="http://s0.wp.com/latex.php?latex=%5Crightarrow+0&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="\rightarrow 0" title="\rightarrow 0"/> while for each of the sides it is <img src="http://s0.wp.com/latex.php?latex=%5Crightarrow+1%2Fn&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="\rightarrow 1/n" title="\rightarrow 1/n"/> (and by symmetry they are all equal). If <img src="http://s0.wp.com/latex.php?latex=L+%5Crightarrow+0&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="L \rightarrow 0" title="L \rightarrow 0"/> then the probability instead approaches 1 and the side probability approaches 0. So by continuity, in between there must be a <img src="http://s0.wp.com/latex.php?latex=L%5E%2A&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="L^*" title="L^*"/> where the probability of landing on one of the ends equals the probability of landing on one of the sides. There is no reason for the areas to be equal.</p>
<p>Indeed, <a href="https://youtu.be/8UUPlImm0dM?t=169">as discussed in this video</a>, the value of <img src="http://s0.wp.com/latex.php?latex=L%5E%2A&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="L^*" title="L^*"/> depends on the dice throwing dynamics.</p>
<p>Dice that are fair by symmetry (and hence under any reasonable throwing dynamics) always have to have an even number of sides and belong to certain symmetry groups <a href="https://statweb.stanford.edu/~cgates/PERSI/papers/fairdice.pdf">(Diaconis &amp; Keller 1989)</a>.</p>

<p>A cool way to handle an unfair die is if the assignment of the numbers to the faces are completely scrambled between each roll. It does not matter how uneven the probabilities are, since after being scrambled once the probability of any number being on the most likely face will be the same.</p>
<p>How do you scramble fairly? The obvious approach is a gigantic d(65536!) die, marked with every possible permutation of the faces. This has <img src="http://s0.wp.com/latex.php?latex=%5Capprox+10%5E%7B661281%7D&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="\approx 10^{661281}" title="\approx 10^{661281}"/> sides. </p>
<p>But the previous problems give the nagging question: what if it is unfair? </p>
<p>We can of course scramble the d(65536!) with a d(65536!)! die. If that is fair, then things become fair.  But what if we lack such a tremendous die, or there are no big dies that are fair?</p>
<p>Clearly a very unfair d(65536!) can prevent fair d65536-rolling.  Imagine that the face with the unit permutation (leave all faces unchanged) has probability 1: the unfairness of the d65536 will remain. If the big die instead has probability close but not exactly 1 for the unit permutation then occasionally it will scramble faces. It could hence make the smaller die fair over long periods (but short-term it would tend to have the same bias towards some faces)… unless the other dominant faces on the d(65536!) were permutations that just moved faces with the same area to each other.</p>
<p>A nearly fair d(65536!) die will on the other hand scramble so that all permutation have some chance of happening, over time allowing the d65536 state to explore the full space of possibility (ergodic dynamics). This seems to be the generic case, with the unfairness-preserving dice as a peculiar special case. In general we should suspect that <a href="https://statweb.stanford.edu/~cgates/PERSI/papers/mixing.pdf">the typical behavior of mixing</a> occurs: the first few permutations do not change the unfairness much, but after some (usually low) number of permutations the outcomes become very close to the uniform distribution. Hence rolling the d(65536!) die a few times between each roll of the d65536 die and permuting its face numbering accordingly will make it nearly perfectly uniform, assuming the available permutations are irreducible and aperiodic, and that we make enough extra rolls.</p>
<p>How many extra rolls are needed? Suppose all possible permutations are available on the d(65536!) die with nonzero probability. We want to know how many samples from it are needed to make their concatenation nearly uniformly distributed over the 65536! possible ones. If we are lucky the dynamics of the big die creates “<a href="http://cgm.cs.mcgill.ca/~breed/2014COMP599/randall_intro.pdf">rapid mixing dynamics</a>” where this happens after a polynomial times a logarithm steps. Typically the time scales as <img src="http://s0.wp.com/latex.php?latex=%5Cpropto+1%2F%281-%7C%5Clambda_1%7C%29&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="\propto 1/(1-|\lambda_1|)" title="\propto 1/(1-|\lambda_1|)"/> where <img src="http://s0.wp.com/latex.php?latex=%5Clambda_1&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="\lambda_1" title="\lambda_1"/> is the second largest eigenvalue of the transition matrix. In our case of  subdividing the d4, the <img src="http://s0.wp.com/latex.php?latex=%7C%5Clambda_1%7C%5Crightarrow+0&amp;bg=ffffff&amp;fg=000000&amp;s=0" alt="|\lambda_1|\rightarrow 0" title="|\lambda_1|\rightarrow 0"/> quite fast as we subdivide, making the effect of a big die of this type rapidly mixing. We likely only need a handful of rolls of the d(65536!) to scramble the d65536 enough to regard it as essentially fair.</p>
<p>But, the curse strikes again: we likely need another subdivision scheme to make the d(65536!) die than the d65536 die – this is just a plausibility result, not a proof. </p>
<p>Anyway, XKCD is right that it is hard to get the random bits for cryptography. I suggest flipping coins instead. </p>
					</div><!-- .entry-content -->

	<!-- .entry-footer -->
</article></div>
  </body>
</html>
