<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/unix/POSIXAllowsZeroInode">Original</a>
    <h1>In POSIX, you can theoretically use inode zero</h1>
    
    <div id="readability-page-1" class="page"><div><h2>In POSIX, you can theoretically use inode zero</h2>

	<p><small>May 30, 2025</small></p>
</div><div><p>When I wrote about <a href="https://utcc.utoronto.ca/~cks/space/blog/unix/UnixEarlyFilenameLenghts">the length of file names in early Unix</a>, I noted that inode numbers were unsigned
16-bit integers and thus you could only have at most 65,536 inodes
in any given filesystem. Over on the Fediverse, <a href="https://tty0.social/@JdeBP/114591798042059195">JdeBP correctly
noted that I had an off by one error</a>. The original Unix
directory entry format used a zero inode number to mark deleted
entries, which meant that you couldn&#39;t actually use inode zero for
anything (not even the root directory of the filesystem, which
needed a non-zero inode number in order to have a &#39;.&#39; entry).</p>

<p>(Contrary to what I said in that Fediverse thread, I think that V7
and earlier may not have actually had a zero inode. The magic happens
in <a href="https://www.tuhs.org/cgi-bin/utree.pl?file=V7/usr/sys/h/param.h">usr/sys/h/param.h</a>
in the itod() and itoo() macros. These give a result for inode 0,
but I suspect they&#39;re never supposed to be used; if I&#39;m doing it
right, inode 1 is at offset 0 within block 2.)</p>

<p>Since I&#39;m the sort of person that I am, this made me wonder if you
could legally use inode zero today in a POSIX compliant system. The
Single Unix Specification, which is more or less POSIX, sets out
that <a href="https://pubs.opengroup.org/onlinepubs/9799919799/basedefs/sys_types.h.html">ino_t is some unsigned integer type</a>,
but it doesn&#39;t constrain its value. Instead, inode numbers are
simply called the &#39;file serial number&#39; in places like <a href="https://pubs.opengroup.org/onlinepubs/9799919799/basedefs/sys_stat.h.html">sys/stat.h</a>
and <a href="https://pubs.opengroup.org/onlinepubs/9799919799/basedefs/dirent.h.html">dirent.h</a>,
and <a href="https://pubs.opengroup.org/onlinepubs/9799919799/functions/fstatat.html">the stat() family of functions</a>,
<a href="https://pubs.opengroup.org/onlinepubs/9799919799/functions/readdir.html">readdir()</a>
and <a href="https://pubs.opengroup.org/onlinepubs/9799919799/functions/posix_getdents.html">posix_getdents()</a>
don&#39;t put any restrictions on the inode numbers except that st_dev
and st_ino together uniquely identify a file. In the normal way to
read standards, anything not explicitly commented on is allowed, so
you&#39;re allowed to return a zero for the inode value in these things
(provided that there is only one per st_dev, or at least that
all of them are the same file, hardlinked together).</p>

<p>On Linux, I don&#39;t think there&#39;s any official restrictions on whether
there can be a zero inode in some weird filesystem (<a href="https://www.man7.org/linux/man-pages/man3/stat.3type.html">eg</a>, <a href="https://www.man7.org/linux/man-pages/man2/getdents.2.html">also</a>),
although kernel and user-space code may make assumptions. FreeBSD
doesn&#39;t document any restrictions in <a href="https://man.freebsd.org/cgi/man.cgi?query=stat&amp;sektion=2&amp;apropos=0&amp;manpath=FreeBSD+14.2-RELEASE+and+Ports">stat(2)</a>
or <a href="https://man.freebsd.org/cgi/man.cgi?query=getdirentries&amp;apropos=0&amp;sektion=2&amp;manpath=FreeBSD+14.2-RELEASE+and+Ports&amp;arch=default&amp;format=html">getdirentries(2)</a>.
The OpenBSD <a href="https://man.openbsd.org/stat.2">stat(2)</a> and <a href="https://man.openbsd.org/getdents.2">getdents(2)</a> manual pages are similarly
silent about whether or not the inode number can be zero.</p>

<p>(The tar archive format doesn&#39;t include inode numbers. The <a href="https://man.archlinux.org/man/cpio.5.en">cpio
archive format</a> does, but
I can&#39;t find a mention of a zero inode value having special meaning.
The POSIX <a href="https://pubs.opengroup.org/onlinepubs/9799919799/utilities/pax.html">pax</a>
archive format is similarly silent; both cpio and pax use the inode
number only as part of recording hardlinks.)</p>

<p>Whether it would be a good idea to make a little filesystem that
returned a zero inode value for some file is another question.
Enterprising people can try it and see, which these days might be
possible with various &#39;filesystem in user space&#39; features (although
these might filter and restrict the inode numbers that you can use).
My personal expectation is that there are a variety of things that
expect non-zero inode numbers for any real file and might use a zero
inode number as, for example, a &#39;no such file&#39; signal value.</p>
</div></div>
  </body>
</html>
