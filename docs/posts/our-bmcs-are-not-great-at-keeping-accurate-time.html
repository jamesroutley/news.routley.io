<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/BMCsNotGreatAtKeepingTime">Original</a>
    <h1>Our BMCs are not great at keeping accurate time</h1>
    
    <div id="readability-page-1" class="page"><div><h2>Our BMCs are not great at keeping accurate time</h2>

	<p><small>August  7, 2022</small></p>
</div><div><p>A <a href="https://utcc.utoronto.ca/~cks/space/blog/tech/IPMIAndBMCTerminology">BMC</a> is an extra embedded computer
on your server motherboard (as opposed to <a href="https://en.wikipedia.org/wiki/Intel_Management_Engine">the extra CPU that&#39;s
embedded in your CPU or chipset</a>). As separate
computers running a separate operating system, <a href="https://en.wikipedia.org/wiki/BMC">BMCs</a> keep time independently from
your server&#39;s time (the <em>host</em> time, reusing terminology from
virtualization), and this time is visible in places like the IPMI
event log (as well as just asking what time the BMC has via IPMI).
I&#39;ve been tracking the reported BMC time against the server&#39;s own
view of time on our servers for a while, and recently I summarized
the results of that <a href="https://twitter.com/thatcks/status/1552717296522727424">on Twitter</a>:</p>

<blockquote><p>Having tracked how much an IPMI&#39;s idea of time drifts across our
modest fleet for a while, well, we&#39;re now resetting the IPMI time once
a day.</p>
</blockquote>

<p>The BMC time drift we&#39;re seeing isn&#39;t terrible, but it&#39;s enough to
add up significantly if left uncorrected for very long, especially
on some of our servers. It&#39;s possible that some servers see comparable
clock drift numbers (<a href="https://mastodon.social/web/@cks/108784724937359958">as estimated by summing ntpdate time adjustments</a>), but server
clocks are much more easily kept correct through NTP and other
mechanisms.</p>

<p>(It also looks like many of our servers have clocks that clearly
drift less than their BMCs.)</p>

<p>In an ideal world, we would have all of our BMCs synchronize their
clocks via NTP. In this world, not all of our servers have BMCs
with dedicated network ports (only <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/OurServerAges2022">our most recent Dell 1U servers
do</a>), and on top of that not all vendors include
NTP as a free feature on all of their BMCs. Charging licensing costs
for some features is a good way to insure that we don&#39;t use them,
unless the licensing cost is trivial (which, spoiler, it hasn&#39;t
been when we asked, although we usually ask for the KVM over IP
licensing cost).</p>

<p>In theory our BMC clock drift probably doesn&#39;t matter very much.
Our servers almost never put anything into their IPMI event logs
and we almost never look at them. But having started looking at
this (and putting the data in <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/PrometheusGrafanaSetup-2019">our Prometheus metrics server</a>), I couldn&#39;t just let it go. There&#39;s
probably a lesson here, one related to turning over rocks.</p>

<p>(Server clock drift does matter for all sorts of reasons, including
that we want all of our servers to agree on the time. I&#39;m not sure
that estimating server clock drift from the sum of ntpdate time
adjustments is all that accurate, but it&#39;s the data source I have
available.)</p>
</div></div>
  </body>
</html>
