<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://will-keleher.com/posts/5-Useful-Bash-Patterns.html">Original</a>
    
    <div id="readability-page-1" class="page"><div id="main">
      
<h3>1. Find and replace a pattern in a codebase with capture groups</h3>
<p><strong><code>git grep -l pattern | xargs gsed -ri &#39;s|pat(tern)|\1s are birds|g&#39;</code></strong></p>
<ul>
<li><code>git grep -l</code>: make sure we&#39;re only looking for files in our codebase  (<code>ag -l</code> is another good option)</li>
<li><code>xargs</code>: allow running this with <code>gsed -i</code></li>
<li><code>gsed -i</code>: edit files (default mac <code>sed</code> is bad, so gnu-sed is essential)</li>
<li><code>gsed -r</code>: use regular expression for the pattern to allow capture groups</li>
<li><code>s|</code>: the first character after the <code>s</code> is used as the delimiter. <code>/</code> is pretty consistently annoying because it&#39;s used in file paths &amp; urls.</li>
<li><code>gsed &#39;...&#39;</code>: the single quotes are important to avoid escapes</li>
<li><code>&#39;s|pat(tern)|\1s are birds|g&#39;</code>: being able to easily use capture groups in a find and replace is amazing</li>
<li><code>|g</code>: replace this multiple times in a line</li>
</ul>
<h3>2. Track down a commit when a command started failing</h3>
<p><strong><code>while command; do git checkout HEAD^; done;</code></strong></p>
<ul>
<li><code>while command</code>: As long as <code>command</code> exits successfully (with a 0), this loop will keep going. (this is why <code>while true;</code> works! The same thing works with <code>if</code>: <code>if git grep yay; then echo &#34;found yay&#34;; fi</code>)</li>
<li><code>git checkout HEAD^</code>: go back in time.</li>
<li><a href="https://git-scm.com/docs/git-bisect">git bisect</a> is the &#34;real&#34; way to do this, but it&#39;s not something I&#39;ve ever needed, and <code>while command</code> and <code>while ! command</code> are both generally useful to know</li>
<li>A similar pattern to poll until something succeeds could be <code>while ! curl localhost:8080; do sleep 1; done;</code>.</li>
</ul>
<h3>3. Parallelize running commands by grabbing PIDs.</h3>
<pre><code>pids=<span>&#34;&#34;</span>;
do_thing_1 &amp;
pids=<span>&#34;$pids $!&#34;</span>
do_thing_2 &amp;
pids=<span>&#34;$pids $!&#34;</span>
EXIT_CODE=<span>0</span>
<span>for</span> p <span>in</span> <span>$pids</span>; <span>do</span>
  <span>if</span> ! wait <span>$p</span>; then EXIT_CODE=<span>1</span>; fi
done

<span>exit</span> <span>$EXIT_CODE</span>;
</code></pre>
<h3>4. Use <code>$SECONDS</code> to track how long things take</h3>
<p><strong><code>echo &#34;Your command completed after $SECONDS seconds&#34;;</code></strong></p>
<ul>
<li>Try running this in your shell: <code>SECONDS=0; sleep 5; echo $SECONDS;</code></li>
<li>I often prefer this over <code>time</code> when setting up logs for a script</li>
</ul>
<h3>5. Use <code>for</code> to iterate over simple lists:</h3>
<pre><code><span>for</span> route <span>in</span> foo bar baz; <span>do</span>
  curl localhost:8080/<span>$route</span>
<span>done</span>
</code></pre>
<p>The default separator in bash is a space, and you can take advantage of this to make simple <code>for</code> loops. (This default is quite frustrating to work around in general: spaces in file names are the devil.)</p>

      </div></div>
  </body>
</html>
