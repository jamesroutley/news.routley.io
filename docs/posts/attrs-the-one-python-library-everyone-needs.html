<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://glyph.twistedmatrix.com/2016/08/attrs.html">Original</a>
    <h1>Attrs – The One Python Library Everyone Needs</h1>
    
    <div id="readability-page-1" class="page"><div>
  <p>Do you write programs in Python?  You should be using
<a href="https://attrs.readthedocs.io">attrs</a>.</p>
<p>Why, you ask?  Don’t ask.  Just use it.</p>
<p>Okay, fine.  Let me back up.</p>
<p>I love Python; it’s been my primary programming language for 10+ years and
despite a number of <a href="https://www.haskell.org">interesting</a>
<a href="https://www.rust-lang.org">developments</a> in the interim I have no plans to
switch to anything else.</p>
<p>But Python is not without its problems.  In some cases it encourages you to do
the wrong thing.  Particularly, there is a deeply unfortunate proliferation of
class inheritance and the
<a href="https://en.wikipedia.org/wiki/God_object">God-object</a> anti-pattern in many
libraries.</p>
<p>One cause for this might be that Python is a highly accessible language, so
less experienced programmers make mistakes that they then have to
<a href="https://twistedmatrix.com/documents/current/core/development/policy/compatibility-policy.html">live with forever</a>.</p>
<p>But I think that perhaps a more significant reason is the fact that Python
sometimes punishes you for trying to do the right thing.</p>
<p>The “right thing” in the context of object design is to make lots of small,
self-contained classes that do
<a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">one thing</a> and
do it <a href="https://www.destroyallsoftware.com/talks/boundaries">well</a>.  For
example, if you notice your object is starting to accrue a lot of private
methods, perhaps you should be making those “public”<sup id="fnref:1:attrs-2016-8"><a href="#fn:1:attrs-2016-8" id="fnref:1">1</a></sup> methods of a private
attribute.  But if it’s tedious to do that, you probably won’t bother.</p>
<p>Another place you probably should be defining an object is when you have a bag
of related data that needs its relationships, invariants, and behavior
explained.  Python makes it soooo easy to just define a tuple or a list.  The
first couple of times you type <code>host, port = ...</code> instead of <code>address = ...</code> it
doesn’t seem like a big deal, but then soon enough you’re typing
<code>[(family, socktype, proto, canonname, sockaddr)] = ...</code> everywhere and your
life is filled with regret.  That is, if you’re lucky.  If you’re <em>not</em> lucky,
you’re just maintaining code that does something like
<code>values[0][7][4][HOSTNAME][“canonical”]</code> and your life is filled with
garden-variety <em>pain</em> rather than the more complex and nuanced emotion of
regret.</p>
<hr/>
<p>This raises the question: <em>is</em> it tedious to make a class in Python?  Let’s
look at a simple data structure: a 3-dimensional cartesian coordinate.  It
starts off simply enough:</p>

<p>So far so good.  We’ve got a 3 dimensional point.  What next?</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span><span>):</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Well, that’s a bit unfortunate.  I just want a holder for a little bit of data,
and I’ve already had to override a special method from the Python runtime with
an internal naming convention?  Not <em>too</em> bad, I suppose; <em>all</em> programming is
weird symbols after a fashion.</p>
<p>At least I see my attribute names in there, that makes sense.</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span><span>):</span>
        <span>self</span><span>.</span><span>x</span>
</code></pre></div>
</td></tr></tbody></table>
<p>I already said I wanted an <code>x</code>, but now I have to assign it as an attribute...</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span><span>):</span>
        <span>self</span><span>.</span><span>x</span> <span>=</span> <span>x</span>
</code></pre></div>
</td></tr></tbody></table>
<p>... to <code>x</code>?  Uh, <em>obviously</em> ...</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span><span>):</span>
        <span>self</span><span>.</span><span>x</span> <span>=</span> <span>x</span>
        <span>self</span><span>.</span><span>y</span> <span>=</span> <span>y</span>
        <span>self</span><span>.</span><span>z</span> <span>=</span> <span>z</span>
</code></pre></div>
</td></tr></tbody></table>
<p>... and now I have to do that once for every attribute, so this actually
<em>scales</em> poorly?  I have to type every attribute name 3 times?!?</p>
<p>Oh well.  At least I’m done now.</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span><span>):</span>
        <span>self</span><span>.</span><span>x</span> <span>=</span> <span>x</span>
        <span>self</span><span>.</span><span>y</span> <span>=</span> <span>y</span>
        <span>self</span><span>.</span><span>z</span> <span>=</span> <span>z</span>
    <span>def</span> <span>__repr__</span><span>(</span><span>self</span><span>):</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Wait what do you mean I’m not done.</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span><span>):</span>
        <span>self</span><span>.</span><span>x</span> <span>=</span> <span>x</span>
        <span>self</span><span>.</span><span>y</span> <span>=</span> <span>y</span>
        <span>self</span><span>.</span><span>z</span> <span>=</span> <span>z</span>
    <span>def</span> <span>__repr__</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>(</span><span>self</span><span>.</span><span>__class__</span><span>.</span><span>__name__</span> <span>+</span>
                <span>(</span><span>&#34;(x=</span><span>{}</span><span>, y=</span><span>{}</span><span>, z=</span><span>{}</span><span>)&#34;</span><span>.</span><span>format</span><span>(</span><span>self</span><span>.</span><span>x</span><span>,</span> <span>self</span><span>.</span><span>y</span><span>,</span> <span>self</span><span>.</span><span>z</span><span>)))</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Oh come <em>on</em>.  So I have to type every attribute name <em>5</em> times, if I want to
be able to see what the heck this thing is when I’m debugging, which a tuple
would have given me for free?!?!?</p>
<table><tbody><tr><td><div><pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span></pre></div></td><td><div><pre><span></span><code><span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span><span>):</span>
        <span>self</span><span>.</span><span>x</span> <span>=</span> <span>x</span>
        <span>self</span><span>.</span><span>y</span> <span>=</span> <span>y</span>
        <span>self</span><span>.</span><span>z</span> <span>=</span> <span>z</span>
    <span>def</span> <span>__repr__</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>(</span><span>self</span><span>.</span><span>__class__</span><span>.</span><span>__name__</span> <span>+</span>
                <span>(</span><span>&#34;(x=</span><span>{}</span><span>, y=</span><span>{}</span><span>, z=</span><span>{}</span><span>)&#34;</span><span>.</span><span>format</span><span>(</span><span>self</span><span>.</span><span>x</span><span>,</span> <span>self</span><span>.</span><span>y</span><span>,</span> <span>self</span><span>.</span><span>z</span><span>)))</span>
    <span>def</span> <span>__eq__</span><span>(</span><span>self</span><span>,</span> <span>other</span><span>):</span>
        <span>if</span> <span>not</span> <span>isinstance</span><span>(</span><span>other</span><span>,</span> <span>self</span><span>.</span><span>__class__</span><span>):</span>
            <span>return</span> <span>NotImplemented</span>
        <span>return</span> <span>(</span><span>self</span><span>.</span><span>x</span><span>,</span> <span>self</span><span>.</span><span>y</span><span>,</span> <span>self</span><span>.</span><span>z</span><span>)</span> <span>==</span> <span>(</span><span>other</span><span>.</span><span>x</span><span>,</span> <span>other</span><span>.</span><span>y</span><span>,</span> <span>other</span><span>.</span><span>z</span><span>)</span>
</code></pre></div>
</td></tr></tbody></table>
<p><em>7</em> times?!?!?!?</p>
<table><tbody><tr><td><div><pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span></pre></div></td><td><div><pre><span></span><code><span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span><span>):</span>
        <span>self</span><span>.</span><span>x</span> <span>=</span> <span>x</span>
        <span>self</span><span>.</span><span>y</span> <span>=</span> <span>y</span>
        <span>self</span><span>.</span><span>z</span> <span>=</span> <span>z</span>
    <span>def</span> <span>__repr__</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>(</span><span>self</span><span>.</span><span>__class__</span><span>.</span><span>__name__</span> <span>+</span>
                <span>(</span><span>&#34;(x=</span><span>{}</span><span>, y=</span><span>{}</span><span>, z=</span><span>{}</span><span>)&#34;</span><span>.</span><span>format</span><span>(</span><span>self</span><span>.</span><span>x</span><span>,</span> <span>self</span><span>.</span><span>y</span><span>,</span> <span>self</span><span>.</span><span>z</span><span>)))</span>
    <span>def</span> <span>__eq__</span><span>(</span><span>self</span><span>,</span> <span>other</span><span>):</span>
        <span>if</span> <span>not</span> <span>isinstance</span><span>(</span><span>other</span><span>,</span> <span>self</span><span>.</span><span>__class__</span><span>):</span>
            <span>return</span> <span>NotImplemented</span>
        <span>return</span> <span>(</span><span>self</span><span>.</span><span>x</span><span>,</span> <span>self</span><span>.</span><span>y</span><span>,</span> <span>self</span><span>.</span><span>z</span><span>)</span> <span>==</span> <span>(</span><span>other</span><span>.</span><span>x</span><span>,</span> <span>other</span><span>.</span><span>y</span><span>,</span> <span>other</span><span>.</span><span>z</span><span>)</span>
    <span>def</span> <span>__lt__</span><span>(</span><span>self</span><span>,</span> <span>other</span><span>):</span>
        <span>if</span> <span>not</span> <span>isinstance</span><span>(</span><span>other</span><span>,</span> <span>self</span><span>.</span><span>__class__</span><span>):</span>
            <span>return</span> <span>NotImplemented</span>
        <span>return</span> <span>(</span><span>self</span><span>.</span><span>x</span><span>,</span> <span>self</span><span>.</span><span>y</span><span>,</span> <span>self</span><span>.</span><span>z</span><span>)</span> <span>&lt;</span> <span>(</span><span>other</span><span>.</span><span>x</span><span>,</span> <span>other</span><span>.</span><span>y</span><span>,</span> <span>other</span><span>.</span><span>z</span><span>)</span>
</code></pre></div>
</td></tr></tbody></table>
<p><em>9</em> times?!?!?!?!?</p>
<table><tbody><tr><td><div><pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span></pre></div></td><td><div><pre><span></span><code><span>from</span> <span>functools</span> <span>import</span> <span>total_ordering</span>
<span>@total_ordering</span>
<span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span><span>):</span>
        <span>self</span><span>.</span><span>x</span> <span>=</span> <span>x</span>
        <span>self</span><span>.</span><span>y</span> <span>=</span> <span>y</span>
        <span>self</span><span>.</span><span>z</span> <span>=</span> <span>z</span>
    <span>def</span> <span>__repr__</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>(</span><span>self</span><span>.</span><span>__class__</span><span>.</span><span>__name__</span> <span>+</span>
                <span>(</span><span>&#34;(x=</span><span>{}</span><span>, y=</span><span>{}</span><span>, z=</span><span>{}</span><span>)&#34;</span><span>.</span><span>format</span><span>(</span><span>self</span><span>.</span><span>x</span><span>,</span> <span>self</span><span>.</span><span>y</span><span>,</span> <span>self</span><span>.</span><span>z</span><span>)))</span>
    <span>def</span> <span>__eq__</span><span>(</span><span>self</span><span>,</span> <span>other</span><span>):</span>
        <span>if</span> <span>not</span> <span>isinstance</span><span>(</span><span>other</span><span>,</span> <span>self</span><span>.</span><span>__class__</span><span>):</span>
            <span>return</span> <span>NotImplemented</span>
        <span>return</span> <span>(</span><span>self</span><span>.</span><span>x</span><span>,</span> <span>self</span><span>.</span><span>y</span><span>,</span> <span>self</span><span>.</span><span>z</span><span>)</span> <span>==</span> <span>(</span><span>other</span><span>.</span><span>x</span><span>,</span> <span>other</span><span>.</span><span>y</span><span>,</span> <span>other</span><span>.</span><span>z</span><span>)</span>
    <span>def</span> <span>__lt__</span><span>(</span><span>self</span><span>,</span> <span>other</span><span>):</span>
        <span>if</span> <span>not</span> <span>isinstance</span><span>(</span><span>other</span><span>,</span> <span>self</span><span>.</span><span>__class__</span><span>):</span>
            <span>return</span> <span>NotImplemented</span>
        <span>return</span> <span>(</span><span>self</span><span>.</span><span>x</span><span>,</span> <span>self</span><span>.</span><span>y</span><span>,</span> <span>self</span><span>.</span><span>z</span><span>)</span> <span>&lt;</span> <span>(</span><span>other</span><span>.</span><span>x</span><span>,</span> <span>other</span><span>.</span><span>y</span><span>,</span> <span>other</span><span>.</span><span>z</span><span>)</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Okay, whew - 2 more lines of code isn’t great, but now at least we don’t have
to define all the other comparison methods.  But <em>now</em> we’re done, right?</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>from</span> <span>unittest</span> <span>import</span> <span>TestCase</span>
<span>class</span> <span>Point3DTests</span><span>(</span><span>TestCase</span><span>):</span>
</code></pre></div>
</td></tr></tbody></table>
<p>You know what? I’m done.  20 lines of code so far and we don’t even have a
class that <em>does</em> anything; the hard part of this problem was supposed to be
the quaternion solver, not “make a data structure which can be printed and
compared”.  I’m <em>all in</em> on piles of undocumented garbage tuples, lists, and
dictionaries it is; defining proper data structures well is way too hard in
Python.<sup id="fnref:2:attrs-2016-8"><a href="#fn:2:attrs-2016-8" id="fnref:2">2</a></sup></p>
<hr/>
<h2 id="namedtuple-to-the-not-really-rescue"><code>namedtuple</code> to the (not really) rescue</h2>
<p>The standard library’s answer to this conundrum is
<a href="https://docs.python.org/2.7/library/collections.html#collections.namedtuple"><code>namedtuple</code></a>.
While a valiant first draft (it bears many similarities to
<a href="https://github.com/twisted/epsilon/blob/master/epsilon/structlike.py">my own</a>
somewhat embarrassing and antiquated entry in this genre) <code>namedtuple</code> is
unfortunately unsalvageable.  It exports a huge amount of undesirable public
functionality which would be a huge compatibility nightmare to maintain, and it
doesn’t address half the problems that one runs into.  A full enumeration of
its shortcomings would be tedious, but a few of the highlights:</p>
<ul>
<li>Its fields are accessable as numbered indexes whether you want them to be or
  not.  Among other things, this means you can’t have private attributes,
  because they’re exposed via the apparently public <code>__getitem__</code> interface.</li>
<li>It compares equal to a raw <code>tuple</code> of the same values, so it’s easy to get
  into bizarre type confusion, especially if you’re trying to use it to migrate
  <em>away</em> from using <code>tuple</code>s and <code>list</code>s.</li>
<li>It’s a tuple, so it’s <em>always</em> immutable.  Sort of.</li>
</ul>
<p>As to that last point, either you can use it like this:</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>Point3D</span> <span>=</span> <span>namedtuple</span><span>(</span><span>&#39;Point3D&#39;</span><span>,</span> <span>[</span><span>&#39;x&#39;</span><span>,</span> <span>&#39;y&#39;</span><span>,</span> <span>&#39;z&#39;</span><span>])</span>
</code></pre></div>
</td></tr></tbody></table>
<p>in which case it doesn’t <em>look</em> like a type in your code; simple
syntax-analysis tools without special cases won’t recognize it as one.  You
can’t give it any other behaviors this way, since there’s nowhere to put a
method.  Not to mention the fact that you had to type the class’s name twice.</p>
<p>Alternately you can use inheritance and do this:</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>class</span> <span>Point3D</span><span>(</span><span>namedtuple</span><span>(</span><span>&#39;_Point3DBase&#39;</span><span>,</span> <span>&#39;x y z&#39;</span><span>.</span><span>split</span><span>()])):</span>
    <span>pass</span>
</code></pre></div>
</td></tr></tbody></table>
<p>This gives you a place you can put methods, and a docstring, and generally have
it look like a class, which it is... but in return you now have a weird
internal name (which, by the way, is what shows up in the <code>repr</code>, not the
class’s actual name).  However, you’ve also silently made the attributes not
listed here mutable, a strange side-effect of adding the <code>class</code> declaration;
that is, unless you add <code>__slots__ = &#39;x y z&#39;.split()</code> to the class body, and
then we’re just back to typing every attribute name twice.</p>
<p>And this doesn’t even mention the fact that science has proven that
<a href="https://www.youtube.com/watch?v=3MNVP9-hglc">you shouldn’t use inheritance</a>.</p>
<p>So, <code>namedtuple</code> can be an improvement if it’s all you’ve got, but only in some
cases, and it has its own weird baggage.</p>
<hr/>
<h2 id="enter-the-attr">Enter The <code>attr</code></h2>
<p>So here’s where my favorite mandatory Python library comes in.</p>
<p>Let’s re-examine the problem above.  How do I make <code>Point3D</code> with <code>attrs</code>?</p>

<p>Since this isn’t built into the language, we do have to have 2 lines of
boilerplate to get us started: the import and the decorator saying we’re about
to use it.</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>import</span> <span>attr</span>
<span>@attr</span><span>.</span><span>s</span>
<span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Look, no inheritance!  By using a class decorator, <code>Point3D</code> remains a Plain
Old Python Class (albeit with some helpful double-underscore methods tacked on,
as we’ll see momentarily).</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>import</span> <span>attr</span>
<span>@attr</span><span>.</span><span>s</span>
<span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
    <span>x</span> <span>=</span> <span>attr</span><span>.</span><span>ib</span><span>()</span>
</code></pre></div>
</td></tr></tbody></table>
<p>It has an attribute called <code>x</code>.</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>import</span> <span>attr</span>
<span>@attr</span><span>.</span><span>s</span>
<span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
    <span>x</span> <span>=</span> <span>attr</span><span>.</span><span>ib</span><span>()</span>
    <span>y</span> <span>=</span> <span>attr</span><span>.</span><span>ib</span><span>()</span>
    <span>z</span> <span>=</span> <span>attr</span><span>.</span><span>ib</span><span>()</span>
</code></pre></div>
</td></tr></tbody></table>
<p>And one called <code>y</code> and one called <code>z</code> and we’re done.</p>
<p>We’re done?  Wait.  What about a nice string representation?</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>&gt;&gt;&gt; </span><span>Point3D</span><span>(</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>)</span>
<span>Point3D(x=1, y=2, z=3)</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Comparison?</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>&gt;&gt;&gt; </span><span>Point3D</span><span>(</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>)</span> <span>==</span> <span>Point3D</span><span>(</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>)</span>
<span>True</span>
<span>&gt;&gt;&gt; </span><span>Point3D</span><span>(</span><span>3</span><span>,</span> <span>2</span><span>,</span> <span>1</span><span>)</span> <span>==</span> <span>Point3D</span><span>(</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>)</span>
<span>False</span>
<span>&gt;&gt;&gt; </span><span>Point3D</span><span>(</span><span>3</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>)</span> <span>&gt;</span> <span>Point3D</span><span>(</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>)</span>
<span>True</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Okay sure but what if I want to extract the data defined in explicit attributes
in a format appropriate for JSON serialization?</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>&gt;&gt;&gt; </span><span>attr</span><span>.</span><span>asdict</span><span>(</span><span>Point3D</span><span>(</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>))</span>
<span>{&#39;y&#39;: 2, &#39;x&#39;: 1, &#39;z&#39;: 3}</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Maybe that last one was a little on the nose.  But nevertheless, it’s one of
many things that becomes easier because <code>attrs</code> lets you <em>declare the fields on
your class</em>, along with lots of potentially interesting metadata about them,
and then get that metadata back out.</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>&gt;&gt;&gt;</span> <span>import</span> <span>pprint</span>
<span>&gt;&gt;&gt;</span> <span>pprint</span><span>.</span><span>pprint</span><span>(</span><span>attr</span><span>.</span><span>fields</span><span>(</span><span>Point3D</span><span>))</span>
<span>(</span><span>Attribute</span><span>(</span><span>name</span><span>=</span><span>&#39;x&#39;</span><span>,</span> <span>default</span><span>=</span><span>NOTHING</span><span>,</span> <span>validator</span><span>=</span><span>None</span><span>,</span> <span>repr</span><span>=</span><span>True</span><span>,</span> <span>cmp</span><span>=</span><span>True</span><span>,</span> <span>hash</span><span>=</span><span>True</span><span>,</span> <span>init</span><span>=</span><span>True</span><span>,</span> <span>convert</span><span>=</span><span>None</span><span>),</span>
 <span>Attribute</span><span>(</span><span>name</span><span>=</span><span>&#39;y&#39;</span><span>,</span> <span>default</span><span>=</span><span>NOTHING</span><span>,</span> <span>validator</span><span>=</span><span>None</span><span>,</span> <span>repr</span><span>=</span><span>True</span><span>,</span> <span>cmp</span><span>=</span><span>True</span><span>,</span> <span>hash</span><span>=</span><span>True</span><span>,</span> <span>init</span><span>=</span><span>True</span><span>,</span> <span>convert</span><span>=</span><span>None</span><span>),</span>
 <span>Attribute</span><span>(</span><span>name</span><span>=</span><span>&#39;z&#39;</span><span>,</span> <span>default</span><span>=</span><span>NOTHING</span><span>,</span> <span>validator</span><span>=</span><span>None</span><span>,</span> <span>repr</span><span>=</span><span>True</span><span>,</span> <span>cmp</span><span>=</span><span>True</span><span>,</span> <span>hash</span><span>=</span><span>True</span><span>,</span> <span>init</span><span>=</span><span>True</span><span>,</span> <span>convert</span><span>=</span><span>None</span><span>))</span>
</code></pre></div>
</td></tr></tbody></table>
<p>I am not going to dive into <em>every</em> interesting feature of <code>attrs</code> here; you can
read the documentation for that.  Plus, it’s well-maintained, so new goodies
show up every so often and I might miss something important.  But <code>attrs</code> does
a few key things that, once you have them, you realize that Python was sorely
missing before:</p>
<ol>
<li>It lets you define types <em>concisely</em>, as opposed to the normally quite
   verbose manual <code>def __init__...</code>.  Types without typing.</li>
<li>It lets you say <em>what you mean directly</em> with a declaration rather than
   expressing it in a roundabout imperative recipe.  Instead of “I have a type,
   it’s called MyType, it has a constructor, in the constructor I assign the
   property ‘A’ to the parameter ‘A’ (and so on)”, you say “I have a type, it’s
   called MyType, it has an attribute called <code>a</code>”, and behavior is derived from
   that fact, rather than having to later <em>guess</em> about the fact by reverse
   engineering it from behavior (for example, running <code>dir</code> on an instance, or
   looking at <code>self.__class__.__dict__</code>).</li>
<li>It <em>provides useful default behavior</em>, as opposed to Python’s
   sometimes-useful but often-backwards defaults.</li>
<li>It adds a place for you to put <em>a more rigorous implementation later</em>, while
   starting out simple.</li>
</ol>
<p>Let’s explore that last point.</p>
<h2 id="progressive-enhancement">Progressive Enhancement</h2>
<p>While I’m not going to talk about <em>every</em> feature, I’d be remiss if I didn’t
mention a few of them.  As you can see from those mile-long <code>repr()</code>s for
<code>Attribute</code> above, there are a number of interesting ones.</p>
<p>For example: you can validate attributes when they are passed into an
<code>@attr.s</code>-ified class.  Our Point3D, for example, should probably contain
numbers.  For simplicity’s sake, we could say that that means instances of
<code>float</code>, like so:</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>import</span> <span>attr</span>
<span>from</span> <span>attr.validators</span> <span>import</span> <span>instance_of</span>
<span>@attr</span><span>.</span><span>s</span>
<span>class</span> <span>Point3D</span><span>(</span><span>object</span><span>):</span>
    <span>x</span> <span>=</span> <span>attr</span><span>.</span><span>ib</span><span>(</span><span>validator</span><span>=</span><span>instance_of</span><span>(</span><span>float</span><span>))</span>
    <span>y</span> <span>=</span> <span>attr</span><span>.</span><span>ib</span><span>(</span><span>validator</span><span>=</span><span>instance_of</span><span>(</span><span>float</span><span>))</span>
    <span>z</span> <span>=</span> <span>attr</span><span>.</span><span>ib</span><span>(</span><span>validator</span><span>=</span><span>instance_of</span><span>(</span><span>float</span><span>))</span>
</code></pre></div>
</td></tr></tbody></table>
<p>The fact that we were using <code>attrs</code> means we have a place to <em>put</em> this extra
validation: we can just add type information to each attribute as we need it.
Some of these facilities let us avoid other common mistakes.  For example, this
is a popular “spot the bug” Python interview question:</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>class</span> <span>Bag</span><span>:</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>contents</span><span>=</span><span>[]):</span>
        <span>self</span><span>.</span><span>_contents</span> <span>=</span> <span>contents</span>
    <span>def</span> <span>add</span><span>(</span><span>self</span><span>,</span> <span>something</span><span>):</span>
        <span>self</span><span>.</span><span>_contents</span><span>.</span><span>append</span><span>(</span><span>something</span><span>)</span>
    <span>def</span> <span>get</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>self</span><span>.</span><span>_contents</span><span>[:]</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Fixing it, of course, becomes this:</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>class</span> <span>Bag</span><span>:</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>contents</span><span>=</span><span>None</span><span>):</span>
        <span>if</span> <span>contents</span> <span>is</span> <span>None</span><span>:</span>
            <span>contents</span> <span>=</span> <span>[]</span>
        <span>self</span><span>.</span><span>_contents</span> <span>=</span> <span>contents</span>
</code></pre></div>
</td></tr></tbody></table>
<p>adding two extra lines of code.</p>
<p><code>contents</code> inadvertently becomes a global varible here, making all <code>Bag</code>
objects not provided with a different list share the same list.  With <code>attrs</code>
this instead becomes:</p>
<table><tbody><tr><td></td><td><div><pre><span></span><code><span>@attr</span><span>.</span><span>s</span>
<span>class</span> <span>Bag</span><span>:</span>
    <span>_contents</span> <span>=</span> <span>attr</span><span>.</span><span>ib</span><span>(</span><span>default</span><span>=</span><span>attr</span><span>.</span><span>Factory</span><span>(</span><span>list</span><span>))</span>
    <span>def</span> <span>add</span><span>(</span><span>self</span><span>,</span> <span>something</span><span>):</span>
        <span>self</span><span>.</span><span>_contents</span><span>.</span><span>append</span><span>(</span><span>something</span><span>)</span>
    <span>def</span> <span>get</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>self</span><span>.</span><span>_contents</span><span>[:]</span>
</code></pre></div>
</td></tr></tbody></table>
<p>There are several other features that <code>attrs</code> provides you with opportunities
to make your classes both more convenient and more correct.  Another great
example? If you want to be strict about extraneous attributes on your objects
(or more memory-efficient on CPython), you can just pass <code>slots=True</code> at the
class level - e.g. <code>@attr.s(slots=True)</code> - to automatically turn your existing
<code>attrs</code> declarations a matching
<a href="https://docs.python.org/3.5/reference/datamodel.html#object.__slots__"><code>__slots__</code> attribute</a>.
All of these handy features allow you to make better and more powerful use of
your <code>attr.ib()</code> declarations.</p>
<hr/>
<h2 id="the-python-of-the-future">The Python Of The Future</h2>
<p>Some people are excited about eventually being able to program in Python 3
everywhere.  What <em>I’m</em> looking forward to is being able to program in
Python-with-<code>attrs</code> everywhere.  It exerts a subtle, but positive, design
influence in all the codebases I’ve seen it used in.</p>
<p>Give it a try: you may find yourself surprised at places where you’ll now use a
tidily explained class, where previously you might have used a
sparsely-documented tuple, list, or a dict, and endure the occasional confusion
from co-maintainers.  Now that it’s so easy to have structured types that
clearly point in the direction of their purpose (in their <code>__repr__</code>, in their
<code>__doc__</code>, or even just in the names of their attributes), you might find
you’ll use a lot more of them.  Your code will be better for it; I know mine
has been.</p>

</div></div>
  </body>
</html>
