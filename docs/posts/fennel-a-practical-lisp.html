<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.mattroelle.com/fennel-the-practical-lisp">Original</a>
    <h1>Fennel: A Practical Lisp</h1>
    
    <div id="readability-page-1" class="page"><div>
	
<nav>
<a href="https://www.mattroelle.com/">Info</a>
<a href="https://www.mattroelle.com/blog">Blog</a>
</nav>


<p>04/08/2022</p>

<h3>Fennel?</h3>
<p>
Around 6 months ago, I discovered a little lisp called <a target="_blank" href="https://fennel-lang.org">Fennel.</a>

It compiles to <a target="_blank" href="https://lua.org">Lua</a>, meaning it&#39;s extremely portable since Lua runs basically anywhere. Lua interop is seamless. It runs flawlessly on desktop, in the web, on mobile devices, gaming consoles and on microcontrollers to name a few.
</p>
<p>

Lua is written in portable C code and embeddable by design, extending any game engine with Lua, and therefore Fennel, is a breeze. The official implementation of lua is roughly 30,000 lines of C code according to <a href="https://www.lua.org/about.html">lua.org</a>, it&#39;s tiny. There are libraries for many languages<sup><a href="#sub-1">[1]</a></sup> that make getting lua running inside of your project possible in an afternoon.

</p>


<p>
Fennel quickly became my full-time programming language for all things. This website runs Fennel via <a href="https://openresty.org/">OpenResty.</a> I am working on a video game project  &amp; game-dev framework using the <a href="https://love2d.org/" target="_blank">LOVE</a> engine.
I write Fennel to extend my Neovim configuration. On a tilde server I&#39;m a part of we run an IRC server written in Fennel, called <a href="https://git.sr.ht/~technomancy/taverner" target="_blank">Taverner.</a>
</p>

<p>
Seriously, I use it everywhere.
</p>

<p>
There are a couple of runtimes available for you to use. On some platforms, you have access to <a href="https://luajit.org/" target="_blank">LuaJIT</a>. On platforms that don&#39;t support JIT compilation, like some embedded devices, phones and gaming consoles, you can easily use <a href="https://www.lua.org/about.html">PUC Lua</a>, which is the official implementation.
</p>

<p>
LuaJIT is a JIT compiler for Lua, and it is <a href="https://gist.github.com/spion/3049314" target="_blank">stupid fast</a>. 
On platforms like iOS and game consoles, where you don&#39;t have access to LuaJIT, you can use the LuaJIT Interpreter as an alternative to PUC which still has impressive speeds.</p>


<h3>Overview</h3>

<p>
Now I&#39;m not an expert lisp programmer, I&#39;ve dabbled in Common Lisp and Racket and written a decent amount of Clojure. So, I can&#39;t really comment on how &#34;true&#34; of a lisp Fennel is. However, when I think about all the the things I like about the other lisps I&#39;ve used, Fennel checks all the boxes.
</p>

<h4>Lispy Syntax</h4>
<p>
Syntatically speaking, Fennel looks a lot like Clojure. Here&#39;s a quick example, taken from the website.
</p>

<pre id="sample">(<span>local</span> dirs {<span>:up</span> [0 -1] <span>:down</span> [0 1] <span>:left</span> [-1 0] <span>:right</span> [1 0]})

(<span>each</span> [key delta (<span>pairs</span> dirs)]
  (<span>when</span> (<span>love.keyboard.isDown</span> key)
    (<span>let</span> [[dx dy] delta
          [px py] player
          x (<span>+</span> px (<span>*</span> dx <span>player.speed</span> dt))
          y (<span>+</span> py (<span>*</span> dy <span>player.speed</span> dt))]
      (<span>world:move</span> player x y))))
</pre>

<p>If you&#39;re familiar with lisp, this code will hopefully be somewhat clear. The map syntax is similar to clojure. There is some syntatic sugar, the things that start with colons are strings. The infix colon notation comes from Lua, it is a method calling convention.</p>

<p>The (parenthesis) denote operations, function calls or macro invocations, much like all other lisps.</p><p>The [square brackets] denote either a sequential table or binding expression, like function args or a let binding. The {curly brackets} denote a table. These forms can also be used for destructuring.</p>

<p>Tables are Lua&#39;s answer to Objects. Tables are the only data structure, they are basically fancy hashmaps. Even sequential data is represented as a table with numeric keys.</p>

<h4>Functional and Object-Oriented</h4>

<p>Lua has support for first class functions and Fennel enforces immutable locals, unless declared like <code>(var x 10)</code>, allowing for a really strict functional style if that&#39;s your jam. If you&#39;re coming from a Clojure background, there is a <a href="https://gitlab.com/andreyorst/fennel-cljlib">cljlib</a>, a Fennel library that implements a large portion of Clojure.</p>

<p>Lua also has these things called <a href="https://www.lua.org/pil/13.html" taget="_blank">Metatables and Metamethods</a>. Metamethods are operator overloading on steroids. You can overload what it means to add a new key to a table, or access a key in a table, so you can literally implement custom class systems, tailor made to your use-case.</p>

<p>Seriously, just Google &#34;Lua class library&#34; and the top 3 links are all various flavors of OOP libraries people made that you can choose from. Do what feels right to you. I&#39;ve tried them all, they are all more than sufficient.</p>

<p>Here is an <a href="https://technomancy.us/197">article by technomancy</a> that details 5 different flavors of method implementations in Fennel/Lua, some with support for live reloading of instances, sort of like in the Common Lisp Object System</p>


<h4>Macro System</h4>

<p>Now, I&#39;m still less than a year into writing lisp. I have written one, potentially two macros that I am actually using. I usually end up replacing any macro I write with a regular function. So please decide for yourself if you think the Fennel macro system is up to par.</p>

<p>That said, I&#39;ve written some really unnecessarily complicated macros with dope syntax and I can attest that Fennel&#39;s macro system allows for bending the language literally any way you want to go. There are even backdoor compiler tricks that allow for quasi reader macros.</p>

<p>Read the <a href="https://fennel-lang.org/macros" target="_blank">official macro guide</a> for more information.</p>

<h4>Excellent REPL</h4>

<p>Fennel has excellent REPL capabilities. If you&#39;re a vim user, Conjure works great. There is fennel-mode for emacs. 

</p><p>There is NREPL support via <a href="https://gitlab.com/technomancy/jeejah" target="_blank">Jeejah</a>. I have done some testing with Jeejah and had promising results, but have not used it extensively</p>

<p>I&#39;ve recently switched to Emacs full time and I&#39;m using <a href="https://git.sr.ht/~technomancy/fennel-mode" target="_blank">fennel-mode</a> and communicating with an embedded REPL in my game project via STDIO. It works wonderfully.</p>

<p>I now code completely out of a handful of multi-thousand line files. I have my library stuff, shared between projects, and my game code. I no longer need to think about organizing my code because line numbers don&#39;t matter, I&#39;m only ever thinking about one function at a time. REPL driven development with Fennel is amazing.</p>

<h3>In Conclusion</h3>

<p>I absolutely cannot recommend Fennel enough. It&#39;s a lisp that&#39;s blazing fast, portable as heck, and has access to the whole Lua ecosystem, which is way more mature than I think most people realize. It&#39;s the lisp I always wanted</p>

<p> In using it, I have written more good software in the last 6 months than ever before in my life. I urge you to check it out. <strong>Visit <a href="https://fennel-lang.org">fennel-lang.org</a> to learn more</strong>, or get started on game dev with <a href="https://gitlab.com/alexjgriffith/min-love2d-fennel">gitlab.com/alexjgriffith/min-love2d-fennel</a>. You won&#39;t be disappointed</p><p>

If you have questions or want help getting started, please email me, <a href="mailto:matt@mattroelle.com">matt@mattroelle.com</a>! I&#39;d love to talk Fennel anytime. We are also organizing a Fennel User Group. I&#39;ll update this post when we get the info up on the Fennel website.



</p><div>
<p>
<sub id="sub-1">[1]Â 
Fennel runs on the Lua runtime. The Lua runtime, both PUC and luajit implementations, are easily supported in many environments. There is official support for: <a href="https://www.oreilly.com/library/view/creating-solid-apis/9781491986301/ch01.html" target="_blank">C/C++</a><a>, </a><a href="https://github.com/amethyst/rlua" target="_blank">Rust</a>, <a href="http://nlua.org/" target="_blank">C#</a>, and more.</sub>
</p>
<p>
<sub>Since most languages have an FFI to C, rolling your own integration in almost any environment is not that hard either.</sub>
</p>
</div>


</div></div>
  </body>
</html>
