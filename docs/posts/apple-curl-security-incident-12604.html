<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://daniel.haxx.se/blog/2024/03/08/the-apple-curl-security-incident-12604/">Original</a>
    <h1>Apple curl security incident 12604</h1>
    
    <div id="readability-page-1" class="page"><div>
		
<p>tldr: Apple thinks it is fine. I do not.</p>



<p>On December 28 2023, <a href="https://github.com/curl/curl/issues/12604">bugreport 12604</a> was filed in the curl issue tracker. We get a lot issues filed most days so this fact alone was hardly anything out of the ordinary. We read the reports, investigate, ask follow-up questions to see what we can learn and what we need to address.</p>



<p>The title stated of the problem in this case was quite clear: <em><a href="https://github.com/curl/curl/issues/12604">flag –cacert behavior isn’t consistent between macOS and Linux</a></em>, and it was filed by Yuedong Wu.</p>



<p>The friendly reporter showed how the curl version bundled with macOS behaves differently than curl binaries built entirely from open source. Even when running the same curl version on the same macOS machine.</p>



<p>The curl command line option <code><a href="https://curl.se/docs/manpage.html#--cacert">--cacert</a></code> provides a way for the user to say to curl that <strong>this is the exact set of CA certificates to trust</strong> when doing the following transfer. If the TLS server cannot provide a certificate that can be verified with that set of certificates, it should fail and return error.</p>



<p>This particular behavior and functionality in curl has been established since many years (this option was added to curl in December 2000) and of course is provided to allow users to know that it communicates with a known and trusted server. A pretty fundamental part of what TLS does really.</p>



<p>When this command line option is used with curl on macOS, <em>the version shipped by Apple</em>, <strong>it seems to fall back and checks the system CA store in case the provided set of CA certs fail the verification</strong>.  A <em>secondary check</em> that was not asked for,  is not documented and plain frankly comes completely by surprise. Therefore, when a user runs the check with a trimmed and dedicated CA cert file, it will not fail if the system CA store contains a cert that can verify the server!</p>



<p>This is a security problem because now<strong> suddenly certificate checks pass that should not pass.</strong></p>



<p>I reported this as a security problem in an email sent to Product Security at Apple on December 29 2023, 08:30 UTC. It’s not a major problem, but it is an issue.</p>



<h2>Apple’s says it is fine</h2>



<p>On March 8, 2024 Apple Product Security responded with their wisdom:</p>



<pre>Hello,

Thank you again for reporting this to us and allowing us time to investigate.

Apple’s version of OpenSSL (LibreSSL) intentionally uses the built-in system trust store as a default source of trust. Because the server certificate can be validated successfully using the built-in system trust store, we don&#39;t consider this something that needs to be addressed in our platforms.

Best regards,
KC
Apple Product Security</pre>



<p>Case closed.</p>



<h2>I disagree</h2>



<p>Obviously I think differently. This <em>undocumented feature</em> makes CA cert verification with curl on macOS totally unreliable and inconsistent with documentation. It tricks users.</p>



<p>Be aware.</p>



<p>Since this is not a security vulnerability in the curl version we ship, we have not issued a CVE or anything for this problem. The problem is strictly speaking not even in curl code. It comes with the version of LibreSSL that Apple ships and builds curl to use on their platforms.</p>
	</div></div>
  </body>
</html>
