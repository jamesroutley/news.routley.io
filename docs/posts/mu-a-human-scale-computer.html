<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/akkartik/mu">Original</a>
    <h1>Mu: A Human-Scale Computer</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text">
<p dir="auto">Mu is a minimal-dependency hobbyist computing stack (everything above the
processor).</p>
<p dir="auto">Mu is not designed to operate in large clusters providing services for
millions of people. Mu is designed for <em>you</em>, to run one computer. (Or a few.)
Running the code you want to run, and nothing else.</p>
<p dir="auto">Here&#39;s the Mu computer running <a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life" rel="nofollow">Conway&#39;s Game of Life</a>.</p>
<div data-snippet-clipboard-copy-content="git clone https://github.com/akkartik/mu
cd mu
./translate apps/life.mu  # emit a bootable code.img
qemu-system-i386 code.img
"><pre>git clone https://github.com/akkartik/mu
<span>cd</span> mu
./translate apps/life.mu  <span><span>#</span> emit a bootable code.img</span>
qemu-system-i386 code.img</pre></div>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/akkartik/mu/blob/main/html/life.png"><img alt="screenshot of Game of Life running on the Mu computer" src="https://github.com/akkartik/mu/raw/main/html/life.png"/></a></p>
<p dir="auto">(<a href="http://akkartik.github.io/mu/html/apps/life.mu.html" rel="nofollow">Colorized sources.</a>
This is memory-safe code, and most statements map to a single instruction of
machine code.)</p>
<p dir="auto">Rather than start from some syntax and introduce layers of translation to
implement it, Mu starts from the processor&#39;s instruction set and tries to get
to <em>some</em> safe and clear syntax with as few layers of translation as possible.
The emphasis is on internal consistency at any point in time rather than
compatibility with the past. (<a href="http://akkartik.name/akkartik-convivial-20200607.pdf" rel="nofollow">More details.</a>)</p>
<p dir="auto">Tests are a key mechanism here for creating a computer that others can make
their own. I want to encourage a style of active and interactive reading with
Mu. If something doesn&#39;t make sense, try changing it and see what tests break.
Any breaking change should cause a failure in some well-named test somewhere.</p>
<p dir="auto">Currently Mu requires a 32-bit x86 processor. It supports a short list of
generic hardware, and can&#39;t do networking yet.</p>
<h2 dir="auto"><a id="user-content-goals" aria-hidden="true" href="#goals"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Goals</h2>
<p dir="auto">In priority order:</p>
<ul dir="auto">
<li><a href="http://akkartik.name/about" rel="nofollow">Reward curiosity.</a>
<ul dir="auto">
<li>Easy to build, easy to run. <a href="https://news.ycombinator.com/item?id=16882140#16882555" rel="nofollow">Minimal dependencies</a>,
so that installation is always painless.</li>
<li>All design decisions comprehensible to a single individual. (On demand.)</li>
<li>All design decisions comprehensible without needing to talk to anyone.
(I always love talking to you, but I try hard to make myself redundant.)</li>
<li><a href="http://akkartik.name/post/readable-bad" rel="nofollow">A globally comprehensible <em>codebase</em> rather than locally clean code.</a></li>
<li>Clear error messages over expressive syntax.</li>
</ul>
</li>
<li>Safe.
<ul dir="auto">
<li>Thorough test coverage. If you break something you should immediately see
an error message.</li>
<li>Memory leaks over memory corruption.</li>
</ul>
</li>
<li>Teach the computer bottom-up.</li>
</ul>
<p dir="auto">Thorough test coverage in particular deserves some elaboration. It implies
that any manual test should be easy to turn into a reproducible automated
test. Mu has some unconventional methods for providing this guarantee. It
exposes testable interfaces for hardware using dependency injection so that
tests can run on -- and make assertions against -- fake hardware. It also
performs <a href="http://akkartik.name/post/tracing-tests" rel="nofollow">automated white-box testing</a>
which enables robust tests for performance, concurrency, fault-tolerance, etc.</p>
<h2 dir="auto"><a id="user-content-non-goals" aria-hidden="true" href="#non-goals"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Non-goals</h2>
<ul dir="auto">
<li>Speed. Staying close to machine code should naturally keep Mu fast enough.</li>
<li>Efficiency. Controlling the number of abstractions should naturally keep Mu
using far less than the gigabytes of memory modern computers have.</li>
<li>Portability. Mu will run on any computer as long as it&#39;s x86. I will
enthusiastically contribute to support for other processors -- in separate
forks. Readers shouldn&#39;t have to think about processors they don&#39;t have.</li>
<li>Compatibility. The goal is to get off mainstream stacks, not to perpetuate
them. Sometimes the right long-term solution is to <a href="http://akkartik.name/post/versioning" rel="nofollow">bump the major version number</a>.</li>
<li>Syntax. Mu code is meant to be comprehended by <a href="http://akkartik.name/post/comprehension" rel="nofollow">running, not just reading</a>.
It will always be just a thin memory-safe veneer over machine code.
I don&#39;t know how to make higher-level notations both fast and
comprehensible, so they are likely to remain slow and comprehensible, useful
for prototyping but invariably needing to be rewritten in statements that
map 1:1 with machine code. The goal of a prototype should be a risk-free
rewrite, thanks to tests that capture all the details of lessons learned.</li>
</ul>
<h2 dir="auto"><a id="user-content-toolchain" aria-hidden="true" href="#toolchain"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Toolchain</h2>
<p dir="auto">The Mu stack consists of:</p>
<ul dir="auto">
<li>the Mu type-safe and memory-safe language;</li>
<li>SubX, an unsafe notation for a subset of x86 machine code; and</li>
<li><em>bare</em> SubX, a more rudimentary form of SubX without certain syntax sugar.</li>
</ul>
<p dir="auto">All Mu programs get translated through these layers into tiny zero-dependency
binaries that run natively. The translators for most levels are built out of
lower levels. The translator from Mu to SubX is written in SubX, and the
translator from SubX to bare SubX is built in bare SubX. There is also an
emulator for Mu&#39;s supported subset of x86, that&#39;s useful for <a href="https://github.com/akkartik/mu/blob/main/linux/subx_debugging.md">debugging SubX
programs</a>.</p>
<p dir="auto">Mu programs build natively either on Linux or on Windows using <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10" rel="nofollow">WSL 2</a>.
For Macs and other Unix-like systems, use the (much slower) emulator:</p>
<div data-snippet-clipboard-copy-content="./translate_emulated apps/ex2.mu  # 2-5 minutes to emit code.img
"><pre>./translate_emulated apps/ex2.mu  <span><span>#</span> 2-5 minutes to emit code.img</span></pre></div>
<p dir="auto">Mu programs can be written for two very different environments:</p>
<ul dir="auto">
<li>
<p dir="auto">At the top-level, Mu programs emit a bootable image that runs without an OS
(under emulation; I haven&#39;t tested on native hardware yet). There&#39;s rudimentary
support for some core peripherals: a 1024x768 screen, a keyboard with some
key-combinations, a PS/2 mouse that must be polled, a slow ATA disk drive.
No hardware acceleration, no virtual memory, no process separation, no
multi-tasking, no network. Boot always runs all tests, and only gets to
<code>main</code> if all tests pass.</p>
</li>
<li>
<p dir="auto">The top-level is built using tools created under the <code>linux/</code> sub-directory.
This sub-directory contains an entirely separate set of libraries intended
for building programs that run with just a Linux kernel, reading from stdin
and writing to stdout. The Mu compiler is such a program, at <code>linux/mu.subx</code>.
Individual programs typically run tests if given a command-line argument
called <code>test</code>.</p>
</li>
</ul>
<p dir="auto">The largest program built in Mu today is its prototyping environment for
writing slow, interpreted programs in a Lisp-based high-level language.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/akkartik/mu/blob/main/html/20210624-shell.png"><img alt="screenshot of the Mu shell" src="https://github.com/akkartik/mu/raw/main/html/20210624-shell.png"/></a></p>
<p dir="auto">(For more details, see <a href="https://github.com/akkartik/mu/tree/main/shell#readme">the <code>shell/</code> directory.</a>)</p>
<p dir="auto">While I currently focus on programs without an OS, the <code>linux/</code> sub-directory
is fairly ergonomic. There&#39;s a couple of dozen example programs to try out
there. It is likely to be the option for a network stack in the foreseeable
future; I have no idea how to interact on the network without Linux.</p>
<h2 dir="auto"><a id="user-content-syntax" aria-hidden="true" href="#syntax"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Syntax</h2>
<p dir="auto">The entire stack shares certain properties and conventions. Programs consist
of functions and functions consist of statements, each performing a single
operation. Operands to statements are always variables or constants. You can&#39;t
perform <code>a + b*c</code> in a single statement; you have to break it up into two.
Variables can live in memory or in registers. Registers must be explicitly
specified. There are some shared lexical rules. Comments always start with
&#39;#&#39;. Numbers are always written in hex. Many terms can have context-dependent
<em>metadata</em> attached after &#39;/&#39;.</p>
<p dir="auto">Here&#39;s an example program in Mu:</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/akkartik/mu/blob/main/html/ex2.mu.png"><img alt="ex2.mu" src="https://github.com/akkartik/mu/raw/main/html/ex2.mu.png" width="400px"/></a></p>
<p dir="auto">More resources on Mu:</p>
<ul dir="auto">
<li>
<p dir="auto"><a href="https://github.com/akkartik/mu/blob/main/mu.md">Mu Syntax reference</a></p>
</li>
<li>
<p dir="auto"><a href="https://github.com/akkartik/mu/blob/main/vocabulary.md">Library reference.</a> Mu programs can transparently call
low-level functions written in SubX.</p>
</li>
</ul>
<p dir="auto">Here&#39;s an example program in SubX:</p>
<div data-snippet-clipboard-copy-content="== code
Entry:
  # ebx = 1
  bb/copy-to-ebx  1/imm32
  # increment ebx
  43/increment-ebx
  # exit(ebx)
  e8/call  syscall_exit/disp32
"><pre>== code
Entry:
  <span><span>#</span> ebx = 1</span>
  bb/copy-to-ebx  1/imm32
  <span><span>#</span> increment ebx</span>
  43/increment-ebx
  <span><span>#</span> exit(ebx)</span>
  e8/call  syscall_exit/disp32</pre></div>
<p dir="auto">More resources on SubX:</p>
<ul dir="auto">
<li>
<p dir="auto"><a href="https://github.com/akkartik/mu/blob/main/subx.md">SubX syntax reference</a></p>
</li>
<li>
<p dir="auto"><a href="https://github.com/akkartik/mu/pulls">Some starter exercises for learning SubX</a>
(labelled <code>hello</code>). Feel free to <a href="mailto:ak@akkartik.com">ping me</a> with any
questions.</p>
</li>
<li>
<p dir="auto">The <a href="https://github.com/akkartik/mu/blob/main/subx_opcodes">list of x86 opcodes</a> supported in SubX: <code>linux/bootstrap/bootstrap help opcodes</code>.</p>
</li>
<li>
<p dir="auto"><a href="https://github.com/akkartik/mu/blob/main/linux/subx_debugging.md">Some tips for debugging SubX programs.</a></p>
</li>
</ul>
<h2 dir="auto"><a id="user-content-forks" aria-hidden="true" href="#forks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Forks</h2>
<p dir="auto">Forks of Mu are encouraged. If you don&#39;t like something about this repo, feel
free to make a fork. If you show it to me, I&#39;ll link to it here. I might even
pull features upstream!</p>
<ul dir="auto">
<li><a href="https://github.com/grokthis/ucisc">uCISC</a>: a 16-bit processor being
designed from scratch by <a href="https://www.youtube.com/channel/UCh4OpfF7T7UtezGejRTLxCw" rel="nofollow">Robert Butler</a>
and programmed with a SubX-like syntax.</li>
<li><a href="https://git.s-ol.nu/subv" rel="nofollow">subv</a>: experimental SubX-like syntax by <a href="https://mmm.s-ol.nu" rel="nofollow">s-ol
bekic</a> for the RISC-V instruction set.</li>
<li><a href="https://git.sr.ht/~akkartik/mu-x86_64" rel="nofollow">mu-x86_64</a>: experimental fork for
64-bit x86 in collaboration with <a href="https://bernsteinbear.com" rel="nofollow">Max Bernstein</a>.
It&#39;s brought up a few concrete open problems that I don&#39;t have good solutions
for yet.</li>
<li><a href="https://git.sr.ht/~akkartik/mu-normie" rel="nofollow">mu-normie</a>: with a more standard
build system for the <code>linux/bootstrap/</code> directory that organizes the repo by
header files and compilation units. Stays in sync with this repo.</li>
</ul>
<h2 dir="auto"><a id="user-content-desiderata" aria-hidden="true" href="#desiderata"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Desiderata</h2>
<p dir="auto">If you&#39;re still reading, here are some more things to check out:</p>
<ul dir="auto">
<li>
<p dir="auto"><a href="https://github.com/akkartik/mu/blob/main/tutorial/index.md">A slow guided tour of Mu.</a></p>
</li>
<li>
<p dir="auto"><a href="https://github.com/akkartik/mu/blob/main/editor/editor.md">How to get your text editor set up for Mu and SubX programs.</a></p>
</li>
<li>
<p dir="auto"><a href="https://archive.org/details/@kartik_agaram" rel="nofollow">Some videos demonstrating Mu programs and features.</a></p>
</li>
<li>
<p dir="auto"><a href="https://github.com/akkartik/mu/blob/main/mu_instructions">A summary</a> of how the Mu compiler translates statements
to SubX. Most Mu statements map to a single x86 instruction.
(<a href="http://akkartik.github.io/mu/html/mu_instructions.html" rel="nofollow">colorized version</a>)</p>
</li>
<li>
<p dir="auto">A prototype live-updating programming environment for a postfix language
that I might work on again one day:</p>
<div data-snippet-clipboard-copy-content="cd linux
./translate tile/*.mu
./a.elf screen
"><pre><span>cd</span> linux
./translate tile/<span>*</span>.mu
./a.elf screen</pre></div>
</li>
<li>
<p dir="auto">Previous prototypes: <a href="https://github.com/akkartik/mu0">mu0</a>, <a href="https://github.com/akkartik/mu1">mu1</a>.</p>
</li>
</ul>
<h2 dir="auto"><a id="user-content-credits" aria-hidden="true" href="#credits"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Credits</h2>
<p dir="auto">Mu builds on many ideas that have come before, especially:</p>
<ul dir="auto">
<li><a href="http://akkartik.name/naur.pdf" rel="nofollow">Peter Naur</a> for articulating the paramount
problem of programming: communicating a codebase to others;</li>
<li><a href="http://www.amazon.com/Notes-Synthesis-Form-Harvard-Paperbacks/dp/0674627512" rel="nofollow">Christopher Alexander</a>
and <a href="https://www.dreamsongs.com/Files/PatternsOfSoftware.pdf" rel="nofollow">Richard Gabriel</a> for
the intellectual tools for reasoning about the higher order design of a
codebase;</li>
<li><a href="http://www.cs.umd.edu/class/spring2003/cmsc838p/Design/criteria.pdf" rel="nofollow">David Parnas</a>
and others for highlighting the value of separating concerns and stepwise
refinement;</li>
<li>The folklore of debugging by print and the trace facility in many Lisp
systems;</li>
<li>Automated tests for showing the value of developing programs inside an
elaborate harness;</li>
</ul>
<p dir="auto">On a more tactical level, this project has made progress in a series of bursts
as I discovered the following resources. In autobiographical order, with no
claims of completeness:</p>
<ul dir="auto">
<li><a href="http://web.archive.org/web/20061108010907/http://www.rano.org/bcompiler.html" rel="nofollow">“Bootstrapping a compiler from nothing”</a> by Edmund Grimley-Evans.</li>
<li><a href="https://github.com/kragen/stoneknifeforth">StoneKnifeForth</a> by <a href="http://canonical.org/~kragen" rel="nofollow">Kragen Sitaker</a>,
including <a href="https://github.com/kragen/stoneknifeforth/blob/master/386.c">a tiny sketch of an ELF loader</a>.</li>
<li><a href="https://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" rel="nofollow">“Creating tiny ELF executables”</a> by Brian Raiter.</li>
<li><a href="https://net.cs.uni-bonn.de/fileadmin/user_upload/plohmann/x86_opcode_structure_and_instruction_overview.pdf" rel="nofollow">Single-page cheatsheet for the x86 ISA</a>
by Daniel Plohmann (<a href="https://github.com/akkartik/mu/blob/main/cheatsheet.pdf">cached local copy</a>)</li>
<li><a href="http://minimal.linux-bg.org" rel="nofollow">Minimal Linux Live</a> for teaching how to create
a bootable disk image using the syslinux bootloader.</li>
<li><a href="https://www.cs.bham.ac.uk/~exr/lectures/opsys/10_11/lectures/os-dev.pdf" rel="nofollow">“Writing a bootloader from scratch”</a>
by Nick Blundell.</li>
<li>Wikipedia on BIOS interfaces: <a href="https://en.wikipedia.org/wiki/INT_10H" rel="nofollow">Int 10h</a>, <a href="https://en.wikipedia.org/wiki/INT_13H" rel="nofollow">Int 13h</a>.</li>
<li><a href="https://stackoverflow.com/questions/43786251/int-13h-42h-doesnt-load-anything-in-bochs/43787939#43787939" rel="nofollow">Some tips on programming bootloaders</a>
by Michael Petch.</li>
<li><a href="https://github.com/mit-pdos/xv6-public">xv6, the port of Unix Version 6 to x86 processors</a></li>
<li>Some tips on handling keyboard interrupts by <a href="https://alex.dzyoba.com/blog/os-interrupts" rel="nofollow">Alex Dzyoba</a>
and <a href="https://stackoverflow.com/questions/37618111/keyboard-irq-within-an-x86-kernel" rel="nofollow">Michael Petch</a>.</li>
</ul>
</article>
        </div></div>
  </body>
</html>
