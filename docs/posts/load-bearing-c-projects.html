<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.bruce-hill.com/load-bearing-c-projects">Original</a>
    <h1>Load-Bearing C Projects</h1>
    
    <div id="readability-page-1" class="page"><div>
<article>
<p><img src="https://sharpbrains.com/media/load-bearing-c-projects/bridge.jpg" alt="Load-Bearing
C Projects"/>
</p>

<p>A guide to building and maintaining nontrivial C projects of
high quality.</p>
<p>Estimated reading time: 18 mins</p>

<span>May 23, 2021</span>

<p>C can be a very fun language to program in, if you can set up your project
well. A lot of what I know about managing C projects was learned the hard way by
experimentation and studying other people’s code. This post is meant to be the
guide I never had to organizing and polishing nontrivial C projects, as well as
setting up Makefiles for building them and manpages for documentation.</p>
<p>For this post, I’m going to assume some knowledge of C programming, but not
much experience working on larger, multi-file C projects. We’ll start with a
simple “Hello world” command line utility and grow the project through
incremental steps, explaining as we go.</p>
<h2 id="beginning-a-project">Beginning a Project</h2>
<p>Our program begins its life in a simple and traditional way:</p>
<div id="cb1"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span>/*</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span> * hello.c - A simple hello world program.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span> */</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span>#include </span><span>&lt;stdio.h&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span>int</span> main<span>(</span><span>void</span><span>)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span>{</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    printf<span>(</span><span>&#34;Hello world!</span><span>\n</span><span>&#34;</span><span>);</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span>return</span> <span>0</span><span>;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>I like to start all of my files with a short, descriptive comment that says
what the file contains. It’s very easy to assume this information is so obvious
that it doesn’t need to be explicit, but I find that it’s surprisingly helpful,
especially when you start to have a lot of files. It might seem obvious when you
write it what a file like <code>loader.c</code> does, but it’s much less obvious
to someone else, or to future-you. A little comment like
<code>loader.c - Contains code for loading serialized data</code> helps a lot!
Make it a habit to start giving files descriptive headers right off the bat, and
you’ll be glad you did later. It doesn’t need to be anything too verbose, just a
single sentence can be enormously helpful.</p>
<p>In order to compile this program, you need to invoke a C compiler. On most
systems, <code>cc</code> (<strong>C C</strong>ompiler) is a symbolic link to the
preferred compiler on that system: <code>gcc</code> on Linux, or
<code>clang</code> on MacOS. <span>On MacOS, <code>gcc</code> is
actually a symlink to <code>clang</code> because so many people type
<code>gcc</code> when they should use <code>cc</code>.</span> As a best
practice, I would recommend using <code>cc</code> instead of <code>gcc</code>
when compiling C programs. It’s a good reminder that there are other compilers
out there besides GCC. So, let’s compile and run our program:</p>
<div id="cb2"><pre><code><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span>$</span> cc hello.c <span>-o</span> hello</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span>$</span> ./hello</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span>Hello</span> world!</span></code></pre></div>
<p>Great, our program compiles and runs! However, typing
<code>cc hello.c -o hello</code> every time we want to recompile the program can
be a little tedious. <code>make</code> (specifically GNU Make in this blog post)
is a great way to set up how you want a project to compile. <code>make</code>
isn’t perfect, but it’s very simple to use for personal projects, and it’s
available on pretty much every system. There are a lot of alternative build
systems like <code>automake</code> or <code>ninja</code> or whatnot, but in my
opinion, they introduce a lot of complexity that isn’t needed for most projects.
If your project is so complicated that it needs a complicated build system, you
should reconsider how much of that complexity is truly necessary and how much of
it is due to overengineering.</p>
<h2 id="automating-builds-with-make">Automating Builds with Make</h2>
<p>The essence of how <code>make</code> works is it looks for a file called
<code>Makefile</code>, which contains a set of rules. Each rule follows a simple
pattern: output file, followed by its dependencies, then a shell command that
will use the dependencies to generate the output file:</p>
<div id="cb3"><pre><code><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span>hello:</span><span> hello.c</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span>    </span>cc hello.c -o hello</span></code></pre></div>
<p>In this case, that means “the file <code>hello</code> depends on
<code>hello.c</code> and can be built by running the command
<code>cc hello.c -o hello</code>”. Now, you can try building <code>hello</code>
using make:</p>
<div id="cb4"><pre><code><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span>$</span> make hello</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span>make:</span> <span>&#39;hello&#39;</span> is up to date</span></code></pre></div>
<p>Oh, it looks like nothing happened. That’s because the Makefile specifies
that the output file <code>hello</code> only depends on the input file
<code>hello.c</code>, and <code>hello.c</code> hasn’t been modified since we
compiled <code>hello</code>. <strong>Make will not recompile unless either the
output file does not exist, or the dependencies have a more recent file
modification time!</strong> Try making a trivial change to <code>hello.c</code>
and re-running <code>make</code>:</p>
<div id="cb5"><pre><code><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span>$</span> touch <span>-m</span> hello.c <span># Update the file modification time</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span>$</span> make hello</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span>cc</span> hello.c <span>-o</span> hello</span></code></pre></div>
<p>Great, it compiled!</p>
<p>If you don’t provide any arguments, <code>make</code> defaults to first rule
defined in the Makefile. In this case, that means the <code>hello</code> rule.
So, in our case, we can just run <code>make</code> instead of
<code>make hello</code> and it will do the same thing.</p>
<h3 id="cleaning-up">Cleaning Up</h3>
<p>It’s sometimes nice to have a way to force recompilation even when
<code>hello.c</code> hasn’t changed. For example, if we want to rebuild the same
source code with different compiler flags. A common way to do this is to add a
“phony” <code>clean</code> rule that removes build files (“phony” here just
means that <code>clean</code> isn’t the name of an actual file, it’s just the
name of the rule):</p>
<div id="cb6"><pre><code><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span>.PHONY:</span><span> clean</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span>clean:</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span>    </span>rm -f hello</span></code></pre></div>
<p>Now, we can run <code>make clean</code> and it will remove the build files
and let us rebuild:</p>
<div id="cb7"><pre><code><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span>$</span> make clean</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span>rm</span> <span>-f</span> hello</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span>$</span> make</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span>cc</span> hello.c <span>-o</span> hello</span></code></pre></div>
<h3 id="making-everything">Making Everything</h3>
<p>Another common practice is to include a phony <code>all</code> rule as the
first rule in the file. This can sometimes be useful if you have multiple build
targets that you want to compile by default. For this example, there’s only one
target, so that would look like this:</p>

<p>Notice that there’s actually no “body” to the rule, it’s just a phony target
with one dependency: <code>hello</code>. This means that running
<code>make all</code> involves nothing besides satisfying the precondition of
building <code>hello</code>. In this example, it’s probably not worth having
this rule, but keep it in mind as an option for if you have multiple build
targets.</p>
<h2 id="adding-compiler-flags">Adding Compiler Flags</h2>
<p>So far, we have a working Makefile, but sooner or later, it will be useful to
have different compiler flags available (for example, warning flags, or
optimization flags). The simplest solution is to just add those flags to the
Makefile rule:</p>
<div id="cb9"><pre><code><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span>hello:</span><span> hello.c</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span>    </span>cc -std=c99 -Wall -Wextra -Werror -O2 hello.c -o hello</span></code></pre></div>
<p>However, this makes it tricky to quickly swap between different flag
settings. Instead, it’s better to use <code>make</code> variables to store the
flag values. I like to split the flags into four categories:</p>
<ul>
<li>Warning flags (<code>CWARN</code>)</li>
<li>Optimization level (<code>O</code>)</li>
<li>Debug flags (<code>G</code>)</li>
<li>Everything else (<code>CFLAGS</code>)</li>
</ul>
<p>This is what it looks like in a Makefile:</p>
<div id="cb10"><pre><code><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span>CC</span><span>=</span><span>cc</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span>CFLAGS</span><span>=</span><span>-std=C99</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span>CWARN</span><span>=</span><span>-Wall -Wextra -Werror</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span>O</span><span>=</span><span>-O2</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span>G</span><span>=</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span>hello:</span><span> hello.c</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span>  </span><span>$(</span><span>CC</span><span>)</span> <span>$(</span><span>CFLAGS</span><span>)</span> <span>$(</span><span>CWARN</span><span>)</span> <span>$(</span><span>O</span><span>)</span> <span>$(</span><span>G</span><span>)</span> hello.c -o hello</span></code></pre></div>
<p>Now, running <code>make</code> will use the default flags:</p>
<div id="cb11"><pre><code><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span>$</span> make</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span>cc</span> <span>-std</span><span>=</span>C99 <span>-Wall</span> <span>-Wextra</span> <span>-Werror</span> <span>-O2</span>  hello.c <span>-o</span> hello</span></code></pre></div>
<p>However, we can also manually specify flags, for example, if we want to do a
debug build:</p>
<div id="cb12"><pre><code><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span>$</span> make G=-ggdb O=-O0</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span>cc</span> <span>-std</span><span>=</span>C99 <span>-Wall</span> <span>-Wextra</span> <span>-Werror</span> <span>-O0</span> <span>-ggdb</span> hello.c <span>-o</span> hello</span></code></pre></div>
<p>Or we can even specify the compiler to use:</p>
<div id="cb13"><pre><code><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span>make</span> CC=tcc</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span>tcc</span> <span>-std</span><span>=</span>C99 <span>-Wall</span> <span>-Wextra</span> <span>-Werror</span> <span>-O2</span>  hello.c <span>-o</span> hello</span></code></pre></div>
<h2 id="handling-multiple-files">Handling Multiple Files</h2>
<p>At this point, we’re in a very good place when it comes to a single-file
project. We can run <code>make</code> whenever we want and it will ensure the
program compiles. However, if the project grows over time, it’s likely that
there will be a point when there’s too much code to put in a single file. As a
rule of thumb, I typically don’t let individual C files get more than 700 lines
long, but I won’t split into multiple files unless there is a clean demarcation
of functionality. Having code split into multiple files based on functionality
makes it easier for you (or other contributors) to find the code you’re looking
for, and makes it easier to understand changes in source control. However, if
you go too far and split everything into too many tiny files, then it becomes
tedious to have to hop across many different files when editing or reading code.
Each file should be relatively self-contained and modular–the public-facing API
should not change frequently, and non-API changes to the code in one file should
not require changes in another file.</p>
<p>For this example, let’s consider moving the hello-world-printing logic to a
separate file: <code>greeter.c</code>:</p>
<div id="cb14"><pre><code><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span>/*</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span> * greeter.c - The logic for greeting things.</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span> */</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span>#include </span><span>&lt;stdio.h&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span>void</span> greet<span>(</span><span>char</span> <span>*</span>subject<span>)</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span>{</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    printf<span>(</span><span>&#34;Hello </span><span>%s</span><span>!</span><span>\n</span><span>&#34;</span><span>,</span> subject<span>);</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>If we want to use this code in our main program, our main program will need
to import a header file so it knows what functions are available:</p>
<div id="cb15"><pre><code><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span>/*</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span> * greeter.h - Header file for greeting logic.</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span> */</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span>void</span> greet<span>(</span><span>char</span> <span>*</span>subject<span>);</span></span></code></pre></div>
<div id="cb16"><pre><code><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span>/*</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span> * hello.c - A simple hello world program.</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span> */</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span>#include </span><span>&#34;greeter.h&#34;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span>int</span> main<span>(</span><span>void</span><span>)</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span>{</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    greet<span>(</span><span>&#34;world&#34;</span><span>);</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span>return</span> <span>0</span><span>;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<p>The next step is to tell our Makefile that we need to compile and link this
new file as well:</p>
<div id="cb17"><pre><code><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span>hello:</span><span> hello.c greeter.h greeter.o</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span>    </span><span>$(</span><span>CC</span><span>)</span> <span>$(</span><span>CFLAGS</span><span>)</span> <span>$(</span><span>CWARN</span><span>)</span> <span>$(</span><span>O</span><span>)</span> <span>$(</span><span>G</span><span>)</span> greeter.o hello.c -o hello</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span>greeter.o:</span><span> greeter.c greeter.h</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span>    </span><span>$(</span><span>CC</span><span>)</span> -c <span>$(</span><span>CFLAGS</span><span>)</span> <span>$(</span><span>CWARN</span><span>)</span> <span>$(</span><span>O</span><span>)</span> <span>$(</span><span>G</span><span>)</span> greeter.c -o greeter.o</span></code></pre></div>
<p>Some things to notice:</p>
<ul>
<li>The <code>hello</code> rule now has 3 dependencies: <code>hello.c</code>,
<code>greeter.h</code>, and <code>greeter.o</code>. If any of these files
change, <code>hello</code> will be rebuilt.</li>
<li>There is a new rule: <code>greeter.o</code>. This is an object file that
contains the compiled code of <code>greeter.c</code>. <code>make</code> works
like a dependency tree, so if <code>greeter.c</code> changes and you build
<code>hello</code>, it will rebuild <code>greeter.o</code> first.</li>
<li>The rule for <code>greeter.o</code> uses the compiler flag <code>-c</code>,
which tells the compiler to not invoke the linker, just build an object file
that can be used in the main program.</li>
</ul>
<p>In theory, splitting into multiple files can also greatly improve
recompilation time because you can skip recompiling files that weren’t changed.
In this example, if you make changes to <code>hello.c</code>, but
<code>greeter.c</code> remains unchanged, then <code>make</code> will only
recompile <code>hello</code>, but reuse the existing <code>greeter.o</code>. In
practice, unless you’re running on an old Raspberry Pi, or have a truly massive
project (like an operating system), it will probably only take a few hundred
milliseconds to compile your entire project, so you won’t notice much of a
difference.</p>
<p>As you add more and more files, adding rules like this will get a bit
repetitive, but fortunately, <code>make</code> has some pattern matching rules
that allow you to write general-purpose rules. This is how I would normally
handle <code>greeter.o</code>:</p>
<div id="cb18"><pre><code><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span>%.o:</span><span> %.c %.h</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span>    </span><span>$(</span><span>CC</span><span>)</span> -c <span>$(</span><span>CFLAGS</span><span>)</span> <span>$(</span><span>CWARN</span><span>)</span> <span>$(</span><span>O</span><span>)</span> <span>$(</span><span>G</span><span>)</span> <span>$&lt;</span> -o <span>$@</span></span></code></pre></div>
<p>The <code>%.o: %.c %.h</code> part is special Make wildcard syntax that means
“if you’re looking for how to build a file called <code>foo.o</code>, and
there’s no specific rule for it, then you can build it with this rule and the
dependencies <code>foo.c</code> and <code>foo.h</code>.” The <code>$&lt;</code>
is a special Make variable representing “the first dependency”
(<code>greeter.c</code>), and <code>$@</code> is a Make variable for for “the
output file” (<code>greeter.o</code>). The C file itself imports the
<code>greeter.h</code> header file, so the C compiler doesn’t need to be passed
the header filename, but it’s included in the Makefile because any changes to
the header should probably trigger a recompilation of
<code>greeter.o</code>.</p>
<p>And just to make things a little bit tidier, I like to put the C files that
will need to be compiled in their own <code>make</code> variable:</p>
<div id="cb19"><pre><code><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span>CC</span><span>=</span><span>cc</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span>CFLAGS</span><span>=</span><span>-std=C99</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span>CWARN</span><span>=</span><span>-Wall -Wextra -Werror</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span>O</span><span>=</span><span>-O2</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span>G</span><span>=</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span>HEADERS</span><span>=</span><span>greeter.h</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span>CFILES</span><span>=</span><span>greeter.c</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span>OBJFILES</span><span>=$(</span><span>CFILES</span><span>:</span><span>%.c</span><span>=</span><span>%.o</span><span>)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span>hello:</span><span> hello.c </span><span>$(</span><span>HEADERS</span><span>)</span><span> </span><span>$(</span><span>OBJFILES</span><span>)</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span>  </span><span>$(</span><span>CC</span><span>)</span> <span>$(</span><span>CFLAGS</span><span>)</span> <span>$(</span><span>CWARN</span><span>)</span> <span>$(</span><span>O</span><span>)</span> <span>$(</span><span>G</span><span>)</span> <span>$(</span><span>OBJFILES</span><span>)</span> hello.c -o hello</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span>%.o:</span><span> %.c %.h</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span>    </span><span>$(</span><span>CC</span><span>)</span> -c <span>$(</span><span>CFLAGS</span><span>)</span> <span>$(</span><span>CWARN</span><span>)</span> <span>$(</span><span>O</span><span>)</span> <span>$(</span><span>G</span><span>)</span> <span>$&lt;</span> -o <span>$@</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span>.PHONY:</span><span> clean</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span>clean:</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span>    </span>rm -f hello <span>$(</span><span>OBJFILES</span><span>)</span></span></code></pre></div>
<p>The <code>OBJFILES=$(CFILES:%.c=%.o)</code> part is <code>make</code> syntax
that sets the <code>OBJFILES</code> variable to whatever is in the
<code>CFILES</code> variable, but with <code>.c</code> replaced with
<code>.o</code>. With this setup, we can easily add new files to the project
just by updating <code>HEADERS</code> and <code>CFILES</code>.</p>

<p>As the number of header files grows, you run the risk of importing the same
header file multiple times. This can happen if <code>foo.h</code> and
<code>baz.h</code> both <code>#include &#34;qux.h&#34;</code>. This causes the compiler
to complain about redeclaring variables or types. However, there’s a simple fix:
wrap the header file in a <code>#ifndef</code> macro like this:</p>
<div id="cb20"><pre><code><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span>#ifndef FILE__GREETER_H</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span>#define FILE__GREETER_H</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span>/*</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span> * greeter.h - Header file for greeting logic.</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span> */</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span>void</span> greet<span>(</span><span>char</span> <span>*</span>subject<span>);</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span>#endif</span></span></code></pre></div>
<p>The name <code>FILE__GREETER_H</code> isn’t meaningful, it just has to be a
unique value that doesn’t collide with any names being used elsewhere. I tend to
go with <code>FILE__&lt;filename&gt;</code> as my template. This macro ensures
that if a file is <code>#include</code>d multiple times, the subsequent includes
don’t appear and the compiler is happy.</p>
<h2 id="c-file-layout">C File Layout</h2>
<p>At this point, we have a robust project setup that’s easy to compile and
extend. That leaves the question of how to divide up the code among different
files. The approach that I favor is to have:</p>
<ul>
<li>Header files containing datatype declarations and function declarations that
are used in other files.</li>
<li>One <code>.c</code> file for each header file containing function
implementations.</li>
<li>One main <code>.c</code> file that includes the <code>main()</code> function
and primarily handles command line argument parsing and invoking functions
defined in other files.</li>
</ul>
<h2 id="command-line-argument-parsing">Command Line Argument Parsing</h2>
<p>Parsing command line arguments isn’t very fun, but it’s also not very
difficult. If you intend to run your program as a command line program, you
should support a few basic flags, like <code>--help</code>. Below is my general
approach to command line flags. It’s overkill for a program as simple as
<code>hello</code>, but it shows how you can begin to build a more feature-rich
command line tool:</p>
<div id="cb21"><pre><code><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span>/*</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span> * hello.c - A simple hello world program.</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span> */</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span>#include </span><span>&lt;stdio.h&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span>#include </span><span>&lt;string.h&gt;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span>#include </span><span>&#34;greeter.h&#34;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span>#define startswith</span><span>(</span><span>str</span><span>,</span><span> prefix</span><span>)</span><span> </span><span>(!</span><span>strncmp</span><span>(</span><span>str</span><span>,</span><span> prefix</span><span>,</span><span> strlen</span><span>(</span><span>prefix</span><span>)))</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span>const</span> <span>char</span> <span>*</span>description <span>=</span> <span>&#34;hello - A simple hello world program&#34;</span><span>;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span>const</span> <span>char</span> <span>*</span>usage <span>=</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span>&#34;Usage: hello &lt;flags...&gt;</span><span>\n</span><span>&#34;</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span>&#34;Flags:</span><span>\n</span><span>&#34;</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span>&#34;    --help|-h          Print this message and exit</span><span>\n</span><span>&#34;</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span>&#34;    --name=|-n &lt;name&gt;  The name being greeted&#34;</span><span>;</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span>int</span> main<span>(</span><span>int</span> argc<span>,</span> <span>char</span> <span>*</span>argv<span>[])</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span>{</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span>// Variables that get set by command line flags:</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span>char</span> <span>*</span>name <span>=</span> <span>&#34;world&#34;</span><span>;</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span>// Loop over command line arguments:</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>1</span><span>;</span> i <span>&lt;</span> argc<span>;</span> i<span>++)</span> <span>{</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>        <span>if</span> <span>(</span>strcmp<span>(</span>argv<span>[</span>i<span>],</span> <span>&#34;--help&#34;</span><span>)</span> <span>==</span> <span>0</span><span>)</span> <span>{</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>          print_help<span>:</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>            printf<span>(</span><span>&#34;</span><span>%s\n%s\n</span><span>&#34;</span><span>,</span> description<span>,</span> usage<span>);</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>            <span>return</span> <span>0</span><span>;</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>        <span>}</span> <span>else</span> <span>if</span> <span>(</span>startswith<span>(</span>argv<span>[</span>i<span>],</span> <span>&#34;--name=&#34;</span><span>))</span> <span>{</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>            name <span>=</span> <span>&amp;</span>argv<span>[</span>i<span>][</span>strlen<span>(</span><span>&#34;--name=&#34;</span><span>)];</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>        <span>}</span> <span>else</span> <span>if</span> <span>(</span>argv<span>[</span>i<span>][</span><span>0</span><span>]</span> <span>==</span> <span>&#39;-&#39;</span> <span>&amp;&amp;</span> argv<span>[</span>i<span>][</span><span>1</span><span>]</span> <span>!=</span> <span>&#39;-&#39;</span><span>)</span> <span>{</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>            <span>// Single-char flags:</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>            <span>for</span> <span>(</span><span>char</span> <span>*</span>c <span>=</span> <span>&amp;</span>argv<span>[</span>i<span>][</span><span>1</span><span>];</span> <span>*</span>c<span>;</span> c<span>++)</span> <span>{</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>                <span>switch</span> <span>(*</span>c<span>)</span> <span>{</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>                    <span>case</span> <span>&#39;h&#39;</span><span>:</span> <span>goto</span> print_help<span>;</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>                    <span>case</span> <span>&#39;n&#39;</span><span>:</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>                        name <span>=</span> <span>(</span>i<span>+</span><span>1</span> <span>&lt;</span> argc<span>)</span> <span>?</span> argv<span>[++</span>i<span>]</span> <span>:</span> <span>&#34;&#34;</span><span>;</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>                        <span>break</span><span>;</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>                    <span>default</span><span>:</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>                        printf<span>(</span><span>&#34;Unknown flag: -</span><span>%c\n%s\n</span><span>&#34;</span><span>,</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>                               <span>*</span>c<span>,</span> usage<span>);</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>                        <span>return</span> <span>1</span><span>;</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>                <span>}</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>            <span>}</span></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>        <span>}</span> <span>else</span> <span>{</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>            printf<span>(</span><span>&#34;Unknown flag: </span><span>%s\n%s\n</span><span>&#34;</span><span>,</span> argv<span>[</span>i<span>],</span> usage<span>);</span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>            <span>return</span> <span>1</span><span>;</span></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>        <span>}</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>    <span>}</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>    <span>// Do the business logic:</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>    greet<span>(</span>name<span>);</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    <span>return</span> <span>0</span><span>;</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a><span>}</span></span></code></pre></div>
<h2 id="minimum-viable-documentation">Minimum Viable Documentation</h2>
<p>Documentation is often a hassle, but there three things you should really
have:</p>
<ul>
<li>A README file</li>
<li>A software license</li>
<li>A manpage</li>
</ul>
<h3 id="readme">README</h3>
<p>The README file is the first thing to include. I like to use markdown (which
renders nicely on most platforms, but is also human-readable), so I’ll create a
<code>README.md</code> file like this:</p>
<div id="cb22"><pre><code><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span># hello</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>This is a simple hello world project.</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span>## Dependencies</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>There are no dependencies besides a C compiler and <span>`make`</span>.</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span>## Building</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>Simply run <span>`make`</span> to build.</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span>## Installing</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>Run <span>`sudo make install`</span> to install.</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span>## Usage</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>After compiling, run <span>`./hello`</span>. See <span>`man ./hello.1`</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>for more details.</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span>## Code Layout</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span>- </span><span>`hello.c`</span> The main program logic.</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span>- </span><span>`greeting.h`</span>/<span>`greeting.c`</span> The implementation of</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>  the greeting.</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span>## License</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>This software is released under the MIT license</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>with the Commons Clause, see <span>`LICENSE`</span> for more</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>details.</span></code></pre></div>
<h3 id="software-license">Software License</h3>
<p>It’s good practice to include a software license with your projects. This
lets others know what is or isn’t allowed. Personally, I like the <a href="https://commonsclause.com/" target="_blank" rel="noreferrer">Commons
Clause</a> applied to the <a href="https://opensource.org/licenses/MIT" target="_blank" rel="noreferrer">MIT License</a>. The Commons Clause is not very
well known, and if you want to be pedantic, it’s not technically “Open Source”.
However, I think the combination of MIT License with the Commons Clause is best
aligned with my goals for freely distributing my work:</p>
<ul>
<li>My code is available for free</li>
<li>Anyone can use it</li>
<li>Anyone can view the source</li>
<li>Anyone can modify it</li>
<li>Anyone can redistribute it</li>
<li>But if anyone wants to <em>sell</em> my work, they’ll need to get my
permission first</li>
</ul>
<p><a href="https://sharpbrains.com/media/load-bearing-c-projects/LICENSE">Here is an example of a
license file I would use.</a></p>
<h3 id="manpages">Manpages</h3>
<p>Manpages (manual pages) are a bit more of a pain in the neck compared to
READMEs and license files, but they’re not fundamentally very complicated.
<code>man</code> (the command) looks in a specified location for documentation
on a command. That documentation is written using <a href="https://en.wikipedia.org/wiki/Roff_(software)" target="_blank" rel="noreferrer">roff typesetting.</a> Here’s an example of a manpage file:</p>
<div id="cb23"><pre><code><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span>.\&#34; Manpage for hello.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span>.</span><span>TH</span><span> man </span><span>1</span><span> &#34;January 2, 2021&#34; &#34;0.1&#34; &#34;hello manual page&#34;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span>.</span><span>SH</span><span> NAME</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>hello <span>\-</span> A hello world program</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span>.</span><span>SH</span><span> SYNOPSIS</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span>.</span><span>B</span><span> hello</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>[<span>\fB</span>-h<span>\fR</span>|<span>\fB</span>--help<span>\fR</span>]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>[<span>\fB</span>-n<span>\fR</span>|<span>\fB</span>--name<span>\fR</span>=<span>\fI</span>name<span>\fR</span>]</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span>.</span><span>SH</span><span> DESCRIPTION</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span>\fB</span>hello<span>\fR</span> is a hello world program. It greets things.</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span>.</span><span>SH</span><span> OPTIONS</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span>.</span><span>B</span><span> </span><span>\-</span><span>h</span><span>\fR</span><span>, </span><span>\fB</span><span>--help</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>Print a help message.</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span>.</span><span>B</span><span> </span><span>\-</span><span>n</span><span>\fR</span><span> </span><span>\fI</span><span>name</span><span>\fR</span><span>, </span><span>\fB</span><span>--name</span><span>\fR</span><span>=</span><span>\fI</span><span>name</span><span>\fR</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>Set the name being greeted. Default: <span>\fI</span>world<span>\fR</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span>.</span><span>SH</span><span> EXAMPLES</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span>.</span><span>TP</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span>.</span><span>B</span><span> hello</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>Print <span>&#34;Hello world!&#34;</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span>.</span><span>TP</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span>.</span><span>B</span><span> hello --help</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>Print the usage.</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span>.</span><span>TP</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span>.</span><span>B</span><span> hello --name=</span><span>\fI</span><span>Dave</span><span>\fR</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>Print <span>&#34;Hello Dave!&#34;</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span>.</span><span>SH</span><span> AUTHOR</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>Harry Q. Bovik</span></code></pre></div>
<p>And this is how it renders:</p>
<figure>
<img src="https://sharpbrains.com/media/load-bearing-c-projects/hello.1.png" alt="Example manpage for our program"/>
<figcaption aria-hidden="true">Example manpage for our program</figcaption>
</figure>
<p>Fully explaining roff would require a separate blog post, but there are
essentially only three things you need to know to write a manpage:</p>
<ul>
<li>Lines that begin with things like <code>.SH</code> indicate a formatting
directive for a line or section (<code>.SH</code> is <strong>s</strong>ection
<strong>h</strong>eader, for example).</li>
<li>You can change the formatting of text inline with <code>\fI</code>
(italics), <code>\fB</code> (bold), and <code>\fR</code> (regular). These names
are slightly misleading because on the terminal, “italic” text is rendered as
lilac-colored and underlined, and “bold” text is rendered as blue and bold.</li>
<li>When you don’t know how to do something, you can just look at an existing
manpage to see how they did it. The simplest way to do this is
<code>vim $(man -w foobar)</code> which will show you the source code of the
manpage for <code>foobar</code>.</li>
</ul>
<p>Once you have a manpage written out, the file should saved with the name
<code>hello.1</code> (or whatever your program’s name is, followed by
<code>.1</code>). The <code>1</code> refers to the manual section number for
“executable programs and shell files”, which is what this is. See
<code>man man</code> for more details on the different sections.</p>
<p>If you want to preview your manpage, run <code>man ./hello.1</code>. You
<strong>must</strong> include the <code>./</code> prefix or use an absolute
path, otherwise <code>man</code> won’t be able to find your file. Eventually,
when you install the manpage file, it will either be put into
<code>/usr/share/man/man1/</code> or <code>/usr/local/share/man/man1</code>,
depending on your system. In order to find the correct directory, you can run
<code>man -w cat</code>, which will tell you where the manpage for the
<code>cat</code> program is (any program will work).</p>
<h4 id="alternative-using-pandoc-for-manpages">Alternative: Using Pandoc for
Manpages</h4>
<p>As an alternative to writing manpages with roff typesetting, you can also
write them using Markdown (or your format of choice) and convert the text to
roff using <a href="https://pandoc.org" target="_blank" rel="noreferrer">Pandoc.</a> Pandoc is a really handy tool for cross-compiling
between different document formats, and it plays very nicely with
<code>make</code> as well. <a href="https://jeromebelleman.gitlab.io/posts/publishing/manpages/" target="_blank" rel="noreferrer">Jérôme Belleman has written a nice, short
tutorial here,</a> and <a href="https://eddieantonio.ca/blog/2015/12/18/authoring-manpages-in-markdown-with-pandoc/" target="_blank" rel="noreferrer">Eddie Antonio has written a slightly more
in-depth tutorial here.</a> If you do go this route, be sure to check the
Pandoc-generated manpages into your source control, so that your users don’t
need to have Pandoc installed to access the manpages.</p>
<h2 id="making-software-installable">Making Software Installable</h2>
<p>At this point, we’re <em>nearly</em> done, there’s just one more thing left:
installing the program. We’ll need to add an <code>install</code> rule to our
makefile. This rule has two tasks: put a copy of the executable in the right
spot and put a copy of the manpage in the right spot. There are generally
standard locations where these things go, but it’s good practice to allow the
user to customize the install location with <code>make</code> flags if they want
to. Here’s what a simple installation rule would look like:</p>
<div id="cb24"><pre><code><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span>PREFIX</span><span>=</span><span>/usr/local</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span>BINDIR</span><span>=$(</span><span>PREFIX</span><span>)</span><span>/bin</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span>MANDIR</span><span>=$(</span><span>PREFIX</span><span>)</span><span>/man</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span>.PHONY:</span><span> install</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span>install:</span><span> hello</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span>    </span>mkdir -p -m 755 <span>&#34;</span><span>$(</span><span>BINDIR</span><span>)</span><span>&#34;</span> <span>&#34;</span><span>$(</span><span>MANDIR</span><span>)</span><span>/man1&#34;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    cp hello <span>&#34;</span><span>$(</span><span>BINDIR</span><span>)</span><span>/&#34;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    cp hello.1 <span>&#34;</span><span>$(</span><span>MANDIR</span><span>)</span><span>/man1/&#34;</span></span></code></pre></div>
<p>Also, I like to include an <code>uninstall</code> rule, just as a courtesy to
make it easier to cleanly uninstall programs:</p>
<div id="cb25"><pre><code><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span>.PHONY:</span><span> uninstall</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span>uninstall:</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span>    </span>rm -f <span>&#34;</span><span>$(</span><span>BINDIR</span><span>)</span><span>/hello&#34;</span> <span>&#34;</span><span>$(</span><span>MANDIR</span><span>)</span><span>/man1/hello.1&#34;</span></span></code></pre></div>
<h2 id="conclusion">Conclusion</h2>
<p>And that’s everything! With all of this, you have a pretty swanky setup for a
decently-sized C program that compiles, installs, and comes with documentation.
This is essentially the same setup used by the Lua programming language’s source
code, and by most <a href="https://suckless.org/" target="_blank" rel="noreferrer">suckless</a> programs. It’s easy to maintain, and once you have
a project with this setup, it’s very easy to copy over to a new project.</p>
<p>Here are the final files:</p>
<ul>
<li><a href="https://sharpbrains.com/media/load-bearing-c-projects/LICENSE">LICENSE</a></li>
<li><a href="https://sharpbrains.com/media/load-bearing-c-projects/Makefile">Makefile</a></li>
<li><a href="https://sharpbrains.com/media/load-bearing-c-projects/README.md">README.md</a></li>
<li><a href="https://sharpbrains.com/media/load-bearing-c-projects/greeter.c">greeter.c</a></li>
<li><a href="https://sharpbrains.com/media/load-bearing-c-projects/greeter.h">greeter.h</a></li>
<li><a href="https://sharpbrains.com/media/load-bearing-c-projects/hello.1">hello.1</a></li>
<li><a href="https://sharpbrains.com/media/load-bearing-c-projects/hello.c">hello.c</a></li>
</ul>
<h2 id="epilogue-languages-other-than-c">Epilogue: Languages Other than C</h2>
<p>Most of the tips here apply just as well to projects in other programming
languages as well. For example, I write blog posts in markdown use <a href="https://pandoc.org" target="_blank" rel="noreferrer">Pandoc</a> to convert
them to HTML, then use <code>rsync</code> to send them to my server. I have a
Makefile that handles all of that, and it looks something like this:</p>
<div id="cb26"><pre><code><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span>MD_FILES</span> <span>:=</span><span> </span><span>$(</span><span>shell</span><span> find -name &#39;*.md&#39;</span><span>)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span>MD_GEN</span><span>=$(</span><span>MD_FILES</span><span>:</span><span>%.md</span><span>=</span><span>%.html</span><span>)</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span>all:</span><span> </span><span>$(</span><span>MD_GEN</span><span>)</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span>%.md:</span><span> %.html</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span>    </span>pandoc --defaults .pandoc/defaults.yml <span>$&lt;</span> -o <span>$@</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span>sync:</span><span> all</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span>    </span>rsync -a ./ www@bruce-hill.com:/var/www/</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span>.PHONY:</span><span> all sync</span></span></code></pre></div>
<p>Hopefully after reading this post, you now have a clearer idea of how C
projects can be organized, and how to make your own Makefiles and manpages. The
tools and ideas described here have a very simple core, but are incredibly
flexible and useful, so it’s well worth trying out on your next project. Thanks
for sticking around to the end of this rather long post!</p>

</article>

</div></div>
  </body>
</html>
