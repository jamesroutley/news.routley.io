<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://apisix.apache.org/blog/2022/08/12/arm-performance-google-aws-azure-with-apisix/">Original</a>
    <h1>GCP, AWS, and Azure ARM-based server performance comparison</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody"><blockquote><p>This article uses  Apache APISIX to compare the performance of Google, AWS, and Azure ARM-based servers in network IO-intensive scenarios.</p></blockquote><p>ARM has become the cornerstone of the world&#39;s largest computing ecosystem and mobile devices, and is considered by many experts to be the future of cloud computing due to its low power consumption, flexible licensing and low cost.</p><p>Therefore, mainstream cloud vendors led by AWS, Google Cloud Platform (GCP) and Azure have successively launched servers with ARM architecture. Among them, AWS launched the first server processor AWS Graviton based on ARM architecture in 2018.</p><h3 id="aws-graviton">AWS Graviton<a aria-hidden="true" href="#aws-graviton" title="Direct link to heading">​</a></h3><p>AWS Graviton is a series of server processors based on the <a href="https://www.arm.com/" target="_blank" rel="noopener noreferrer">ARM architecture</a> released by AWS in 2018. The first generation of AWS Graviton processors uses custom chips and 64-bit Neoverse cores.</p><p>Released in 2020, AWS Graviton2 processors represent a major leap forward in performance and functionality compared to first-generation AWS Graviton processors. 7x faster performance, 4x more cores, 2x cache, 5x faster memory, and more.</p><p>The latest AWS Graviton3 processors to be released at the end of May 2022 are based on the more advanced <a href="https://www.arm.com/zh-TW/products/silicon-ip-cpu/neoverse/neoverse-v1" target="_blank" rel="noopener noreferrer">Neoverse V1</a> design, they offer up to twice the floating point performance, twice the cryptographic performance, and three times the ML compared to the AWS Graviton2 processors performance, including support for bfloat16. The following figure shows the main models equipped with AWS Graviton3 processors:</p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/1.webp"><p><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/2022/blog/0812/1.webp, https://static.apiseven.com/2022/blog/0812/1.png" alt="AWS Graviton3 processors" src="https://static.apiseven.com/apisix-webp/2022/blog/0812/1.webp"/></p><div aria-hidden="true"><p><img srcset="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/1.webp, https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/1.png" alt="AWS Graviton3 processors" src="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/1.webp"/></p></div><p>Click to Preview</p></div><h3 id="google-cloud-platform-t2a">Google Cloud Platform T2A<a aria-hidden="true" href="#google-cloud-platform-t2a" title="Direct link to heading">​</a></h3><p>The Google Cloud Platform(GCP) Tau T2A VM is a preview of Google&#39;s first ARM-based virtual machine in July 2022, powered by Ampere® Altra® Arm processors based on the Neoverse N1 design. Tau T2A VMs come in a variety of predefined VM shapes with up to 48 vCPUs per VM and 4GB of memory per vCPU.</p><p>They offer up to 32 Gbps of network bandwidth and a wide range of network-attached storage options, making the Tau T2A VM suitable for scale-out workloads including web servers, containerized microservices, data record processing, media transcoding, and Java applications. The main models are as follows:</p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/2.webp"><p><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/2022/blog/0812/2.webp, https://static.apiseven.com/2022/blog/0812/2.png" alt="Tau T2A VM" src="https://static.apiseven.com/apisix-webp/2022/blog/0812/2.webp"/></p><div aria-hidden="true"><p><img srcset="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/2.webp, https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/2.png" alt="Tau T2A VM" src="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/2.webp"/></p></div><p>Click to Preview</p></div><h3 id="azure-arm-based-virtual-machines">Azure Arm-based Virtual Machines<a aria-hidden="true" href="#azure-arm-based-virtual-machines" title="Direct link to heading">​</a></h3><p>In April, Microsoft announced a preview of its family of Azure virtual machines based on Ampere® Altra® Arm processors. The new VMs are designed to efficiently run scale-out workloads, web servers, application servers, open source databases, cloud-native and rich .NET applications, Java applications, game servers, media servers, and more. The new VM series includes general Dpsv5 and memory-optimized Epsv5 VMs. The main models are as follows:</p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/3.webp"><p><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/2022/blog/0812/3.webp, https://static.apiseven.com/2022/blog/0812/3.png" alt="Dpsv5 and Epsv5 VMs" src="https://static.apiseven.com/apisix-webp/2022/blog/0812/3.webp"/></p><div aria-hidden="true"><p><img srcset="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/3.webp, https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/3.png" alt="Dpsv5 and Epsv5 VMs" src="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/3.webp"/></p></div><p>Click to Preview</p></div><p>In this article, we will reflect the overall performance of each server by testing single-core performance. Here, the network IO-intensive API gateway Apache APISIX is selected to bind a single CPU core for stress testing on three models: AWS c7g.large, GCP t2a-standard-2 and Azure D2ps v5 (belonging to the Dpsv5-series, dual-core CPU), and analyze the performance of the server through the two indicators of QPS and response delay.</p><p><a href="https://github.com/apache/apisix" target="_blank" rel="noopener noreferrer">Apache APISIX</a> is a cloud-native, high-performance, scalable API gateway. Based on NGNIX + LuaJIT and etcd, APISIX has the characteristics of dynamic routing and plug-in hot loading compared with traditional API gateways, which is especially suitable for API management under cloud native architecture.</p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/4.webp"><p><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/2022/blog/0812/4.webp, https://static.apiseven.com/2022/blog/0812/4.png" alt="Apache APISIX" src="https://static.apiseven.com/apisix-webp/2022/blog/0812/4.webp"/></p><div aria-hidden="true"><p><img srcset="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/4.webp, https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/4.png" alt="Apache APISIX" src="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/4.webp"/></p></div><p>Click to Preview</p></div><p>Next, we will use the APISIX official open source performance <a href="https://github.com/apache/apisix/blob/master/benchmark/run.sh" target="_blank" rel="noopener noreferrer">test script for testing</a>.</p><h3 id="test-case">Test case<a aria-hidden="true" href="#test-case" title="Direct link to heading">​</a></h3><p>We will test the performance of Apache APISIX under two typical scenarios in order to obtain more realistic and rich test data:</p><ul><li><p><strong>Scenario 1: Single upstream.</strong> In this scenario, a single upstream (without any plugins) is used to test the performance of APISIX in pure proxy back-to-origin mode.</p></li><li><p><strong>Scenario 2: Single upstream + multiple plugins.</strong> This scenario uses a single upstream with multiple plugins and two plugins are used here. It mainly tests the performance of APISIX when the two core consumption performance plugins, <code>limit-count</code> and <code>prometheus</code>, are enabled.</p></li></ul><h3 id="test-results">Test Results<a aria-hidden="true" href="#test-results" title="Direct link to heading">​</a></h3><p>The figure below is the QPS (queries per second) test result and the higher the number, the better the performance.</p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/5.webp"><p><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/2022/blog/0812/5.webp, https://static.apiseven.com/2022/blog/0812/5.png" alt="QPS result" src="https://static.apiseven.com/apisix-webp/2022/blog/0812/5.webp"/></p><div aria-hidden="true"><p><img srcset="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/5.webp, https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/5.png" alt="QPS result" src="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/5.webp"/></p></div><p>Click to Preview</p></div><p>The figure below is the response delay test results in milliseconds. The smaller the number, the better the performance.</p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/6.webp"><p><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/2022/blog/0812/6.webp, https://static.apiseven.com/2022/blog/0812/6.png" alt="Response delay results" src="https://static.apiseven.com/apisix-webp/2022/blog/0812/6.webp"/></p><div aria-hidden="true"><p><img srcset="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/6.webp, https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/6.png" alt="Response delay results" src="https://static.apiseven.com/apisix-thumbnail/2022/blog/0812/6.webp"/></p></div><p>Click to Preview</p></div><p>From the perspective of QPS and response delay, under network IO-intensive API gateways like Apache APISIX, AWS C7g has a 100% performance improvement compared to GCP T2A, and Azure Dpsv5 has a performance lead of about 15% compared to GCP T2A.</p><p>Since this article only focuses on testing the performance of ARM machines from different cloud vendors, so we will ignore the change of &#34;the same number of CPU cores with different memory&#34;, and analyze the cost-performance ratio of AWS Graviton3 and GCP T2A only from the perspective of the number of CPU cores.</p><div><p><h5><span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></p><p>In the current test scenario, the cost-performance ratio can be understood as: QPS/cost.</p></div><p>The table below compares server hourly prices for different cores for AWS C7g (US East Ohio), GCP T2A (us-central1) and Azure Dpsv5 (East US):</p><table><thead><tr><th>VM series / vCPU</th><th>1</th><th>2</th><th>4</th><th>8</th><th>16</th><th>32</th><th>64</th></tr></thead><tbody><tr><td>AWS C7g</td><td>$0.0361</td><td>$0.0723</td><td>$0.1445</td><td>$0.289</td><td>$0.5781</td><td>$1.1562</td><td>$1.7342</td></tr><tr><td>GCP T2A</td><td>$0.0385</td><td>$0.077</td><td>$0.154</td><td>$0.308</td><td>$0.616</td><td>$1.232</td><td>$1.848</td></tr><tr><td>Azure Dpsv5</td><td>*</td><td>$0.077</td><td>$0.154</td><td>$0.308</td><td>$0.616</td><td>$1.232</td><td>$1.848</td></tr></tbody></table><p>The following table summarizes the cost and cost–performance ratio of AWS c7g.large and GCP t2a-standard-2 running for one year, referring to the QPS data for a single upstream in the Apache APISIX performance test. The larger the number, the higher the QPS can be obtained at the unit price.</p><table><thead><tr><th></th><th>Annual cost</th><th>Cost performance (QPS/cost)</th></tr></thead><tbody><tr><td>AWS c7g.large</td><td>$633.3</td><td>36.3</td></tr><tr><td>GCP t2a-standard-2</td><td>$674.5</td><td>16.8</td></tr><tr><td>Azure D2ps v5</td><td>$398.0（41% off)</td><td>33.6</td></tr></tbody></table><p>From the test results, AWS C7g is more cost-effective than GCP T2A and Azure Dpsv5. Although Azure Dpsv5 has only a 15% performance improvement compared to GCP T2A, the cost performance is nearly double.</p><p>AWS launched the first ARM-based processor, AWS Graviton, in 2018. It was about 4 years ahead of GCP for the deployment of the ARM-based server field. Now the AWS Graviton processor has developed to the third generation.</p><p>Through the performance test results and price–performance ratio analysis of Apache APISIX, we can see that AWS Graviton3 has higher performance and cost-effective than GCP T2A and Azure Dpsv5. This is inseparable from the fact that AWS has been deeply involved in the field of ARM-based servers for many years.</p><p>In addition, we used Apache APISIX bound single-core tests during our testing, and the price-performance ratio of AWS Graviton 3 may be further improved if multiple cores are used.</p><ul><li><a href="https://aws.amazon.com/cn/blogs/aws/new-amazon-ec2-c7g-instances-powered-by-aws-graviton3-processors/" target="_blank" rel="noopener noreferrer">New – Amazon EC2 C7g Instances, Powered by AWS Graviton3 Processors</a></li><li><a href="https://cloud.google.com/compute/docs/general-purpose-machines#t2a_machines" target="_blank" rel="noopener noreferrer">Tau T2A machine series (Preview)</a></li><li><a href="https://azure.microsoft.com/en-us/blog/now-in-preview-azure-virtual-machines-with-ampere-altra-armbased-processors/" target="_blank" rel="noopener noreferrer">Now in preview: Azure Virtual Machines with Ampere Altra Arm-based processors</a></li></ul></div></div>
  </body>
</html>
