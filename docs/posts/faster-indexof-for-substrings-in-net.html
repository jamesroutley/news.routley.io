<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/dotnet/runtime/pull/63285">Original</a>
    <h1>Faster IndexOf for Substrings in .NET</h1>
    
    <div id="readability-page-1" class="page"><div>
      
        

<div data-gid="PR_kwDODI9FZc4wdy7G" data-url="/_render_node/PR_kwDODI9FZc4wdy7G/pull_requests/body?variables%5BdeferredCommentActions%5D=true" data-channel="eyJjIjoicHVsbF9yZXF1ZXN0OjgxMzExNzEyNiIsInQiOjE2NDEzMDk0MDZ9--7564a0146a9defa3b357e34ac32f27c71e771108b292aca5531396aab16cef5e">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/EgorBo/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/EgorBo"><img height="40" width="40" alt="@EgorBo" src="https://avatars.githubusercontent.com/u/523221?s=88&amp;u=928bd85ed90950adb6fbc06270173ef9bcbbe707&amp;v=4"/></a>

</p>

  <div id="issue-1092477071">
    <div data-body-version="2018da4103203a3e7b286b5bd518f4be00ba7117a058f83d66643e7237a76b5f">

      



      <div>

        
<task-lists disabled="" sortable="">
<div>
          <p dir="auto">Closes <a data-error-text="Failed to load title" data-id="1036339714" data-permission-text="Title is private" data-url="https://github.com/dotnet/runtime/issues/60866" data-hovercard-type="issue" data-hovercard-url="/dotnet/runtime/issues/60866/hovercard" href="https://github.com/dotnet/runtime/issues/60866">#60866</a></p>
<p dir="auto">A quick benchmark:</p>
<div data-snippet-clipboard-copy-content="using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Benchmarks).Assembly).Run(args);

public class Benchmarks
{
    string _data = &#34;I am a man who walks alone and when I&#39;m walking a...&#34;;

    [Benchmark]
    public int IndexOf() =&gt; _data.IndexOf(&#34;walking&#34;, StringComparison.Ordinal); // or _data.AsSpan().IndexOf()
}"><pre><span>using</span> <span>BenchmarkDotNet</span>.<span>Attributes</span>;
<span>using</span> <span>BenchmarkDotNet</span>.<span>Running</span>;

<span>BenchmarkSwitcher</span>.<span>FromAssembly</span>(<span>typeof</span>(<span>Benchmarks</span>).<span>Assembly</span>).<span>Run</span>(<span>args</span>);

<span>public</span> <span>class</span> <span>Benchmarks</span>
{
    <span>string</span> <span>_data</span> <span>=</span> <span><span>&#34;</span>I am a man who walks alone and when I&#39;m walking a...<span>&#34;</span></span>;

    [<span>Benchmark</span>]
    <span>public</span> <span>int</span> <span>IndexOf</span>() <span>=&gt;</span> <span>_data</span>.<span>IndexOf</span>(<span><span>&#34;</span>walking<span>&#34;</span></span>, <span>StringComparison</span>.<span>Ordinal</span>); <span><span>//</span> or _data.AsSpan().IndexOf()</span>
}</pre></div>
<p dir="auto">Results:</p>
<div data-snippet-clipboard-copy-content="|             Toolchain |     Mean |    Error |   StdDev | Ratio |
|---------------------- |---------:|---------:|---------:|------:|
| \Baseline\corerun.exe | 32.94 ns | 0.665 ns | 0.954 ns |  1.00 |
|     \MyPR\corerun.exe | 14.56 ns | 0.031 ns | 0.026 ns |  0.45 | &gt;2x faster"><pre><code>|             Toolchain |     Mean |    Error |   StdDev | Ratio |
|---------------------- |---------:|---------:|---------:|------:|
| \Baseline\corerun.exe | 32.94 ns | 0.665 ns | 0.954 ns |  1.00 |
|     \MyPR\corerun.exe | 14.56 ns | 0.031 ns | 0.026 ns |  0.45 | &gt;2x faster
</code></pre></div>
<p dir="auto">The algorithm is based on <a href="http://0x80.pl/articles/simd-strfind.html#algorithm-1-generic-simd" rel="nofollow">http://0x80.pl/articles/simd-strfind.html#algorithm-1-generic-simd</a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/523221/148053125-5032749c-6dcf-49f1-9f3b-155c6be457f6.png"><img src="https://user-images.githubusercontent.com/523221/148053125-5032749c-6dcf-49f1-9f3b-155c6be457f6.png" alt="image"/></a></p>
<p dir="auto">While the currently used algorithm just does <code>IndexOf(text, &#39;w&#39;)</code> + <code>SequenceEquals</code> for each substring starting with <code>w</code> it finds.</p>
<p dir="auto">TODO:</p>
<ul>
<li> Add Arm64 impl</li>
<li> Use it for 1-byte IndexOf and, probably, Contains</li>
<li> Implement &#34;find last unique char&#34; if last == first</li>
<li> Benchmarks for various inputs, not just the worst cases for the currently used algorithm</li>
<li> Copyrights</li>
<li> Optional: support OrdinalIgnoreCase</li>
</ul>
      </div>
</task-lists>


          
      </div>

      <!-- '"` --><!-- </textarea></xmp> -->    </div>
</div>

</div>

          


      
<div data-gid="C_kwDODV4kW9oAKGMyNjYzNTM1YzliZGY4NzNiZTZmYjI1NmNjMDg2NzMyZGI5OWI3MTM">
  
        <div>
      <div data-test-selector="pr-timeline-commits-list">
      <div data-view-component="true">
  
  
  <div data-view-component="true">          <div data-channel="eyJjIjoicmVwbzoyMTA3MTYwMDU6Y29tbWl0OmMyNjYzNTM1YzliZGY4NzNiZTZmYjI1NmNjMDg2NzMyZGI5OWI3MTMiLCJ0IjoxNjQxMzA5NDA2fQ==--92230cde71cab23cdc4b25547dbb4045675780317de3f579e309e09e440d8cbe" data-url="/dotnet/runtime/pull/63285/commits/c2663535c9bdf873be6fb256cc086732db99b713/_render_node/commit/pull_condensed">
  <div>
    <div>
      
<div>
  <p><a data-skip-pjax="true" data-test-selector="commits-avatar-stack-avatar-link" data-hovercard-type="user" data-hovercard-url="/users/EgorBo/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/EgorBo">
        <img data-test-selector="commits-avatar-stack-avatar-image" src="https://avatars.githubusercontent.com/u/523221?s=40&amp;v=4" width="20" height="20" alt="@EgorBo"/>
</a>  </p>
</div>

      

      

      

      
    </div>
  </div>
</div>

</div>
</div>      <div data-view-component="true">
  
  
  <div data-view-component="true">          <div data-channel="eyJjIjoicmVwbzoyMTA3MTYwMDU6Y29tbWl0OjMxYmNiMDA5MGI2ZjZjYWE5NjNjNDNiZjFlYTA5ZWM1MjgxZGRkY2EiLCJ0IjoxNjQxMzA5NDA2fQ==--99a253293013b4bf33def220c6dce2ec578921ab2996d4c3ae98d81f27302dae" data-url="/dotnet/runtime/pull/63285/commits/31bcb0090b6f6caa963c43bf1ea09ec5281dddca/_render_node/commit/pull_condensed">
  <div>
    <div>
      
<div>
  <p><a data-skip-pjax="true" data-test-selector="commits-avatar-stack-avatar-link" data-hovercard-type="user" data-hovercard-url="/users/EgorBo/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/EgorBo">
        <img data-test-selector="commits-avatar-stack-avatar-image" src="https://avatars.githubusercontent.com/u/523221?s=40&amp;v=4" width="20" height="20" alt="@EgorBo"/>
</a>  </p>
</div>

      

      

      

      
    </div>
  </div>
</div>

</div>
</div>  </div>
</div>


</div>

      


      
<div data-gid="IC_kwDODI9FZc472M9J">
  
      
<div data-gid="IC_kwDODI9FZc472M9J" data-url="/_render_node/IC_kwDODI9FZc472M9J/timeline/issue_comment?variables%5BdeferredCommentActions%5D=false&amp;variables%5BdeferredEditForm%5D=false">

  
<p><a href="https://github.com/apps/msftbot"><img height="40" width="40" alt="@msftbot" src="https://avatars.githubusercontent.com/in/26612?s=88&amp;v=4"/></a>

</p>


  <div id="issuecomment-1004064585">
    <div data-body-version="0c6ed68ff27e8938284f32602a5680bcb99c5bb463e59d0824f43665c59912c9">

      



      <div>

        
<task-lists disabled="" sortable="">
<div>
          <p dir="auto">Tagging subscribers to this area: <a data-error-text="Failed to load team members" data-id="4880419" data-permission-text="Team members are private" data-url="/orgs/dotnet/teams/area-system-memory/members" data-hovercard-type="team" data-hovercard-url="/orgs/dotnet/teams/area-system-memory/hovercard" href="https://github.com/orgs/dotnet/teams/area-system-memory">@dotnet/area-system-memory</a></p>
<details>
<summary>Issue Details</summary>
<hr/>
<p dir="auto">A draft for <a data-error-text="Failed to load title" data-id="1036339714" data-permission-text="Title is private" data-url="https://github.com/dotnet/runtime/issues/60866" data-hovercard-type="issue" data-hovercard-url="/dotnet/runtime/issues/60866/hovercard" href="https://github.com/dotnet/runtime/issues/60866">#60866</a>, just to check tests on CI.</p>
<p dir="auto">A quick benchmark:</p>
<div data-snippet-clipboard-copy-content="using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Benchmarks).Assembly).Run(args);

public class Benchmarks
{
    string _data = &#34;I am a man who walks alone and when I&#39;m walking a...&#34;;

    [Benchmark]
    public int IndexOf() =&gt; _data.IndexOf(&#34;walking&#34;, StringComparison.Ordinal);
    // same as:
    //   _data.AsSpan().IndexOf(&#34;walking&#34;)
}"><pre><span>using</span> <span>BenchmarkDotNet</span>.<span>Attributes</span>;
<span>using</span> <span>BenchmarkDotNet</span>.<span>Running</span>;

<span>BenchmarkSwitcher</span>.<span>FromAssembly</span>(<span>typeof</span>(<span>Benchmarks</span>).<span>Assembly</span>).<span>Run</span>(<span>args</span>);

<span>public</span> <span>class</span> <span>Benchmarks</span>
{
    <span>string</span> <span>_data</span> <span>=</span> <span><span>&#34;</span>I am a man who walks alone and when I&#39;m walking a...<span>&#34;</span></span>;

    [<span>Benchmark</span>]
    <span>public</span> <span>int</span> <span>IndexOf</span>() <span>=&gt;</span> <span>_data</span>.<span>IndexOf</span>(<span><span>&#34;</span>walking<span>&#34;</span></span>, <span>StringComparison</span>.<span>Ordinal</span>);
    <span><span>//</span> same as:</span>
    <span><span>//</span>   _data.AsSpan().IndexOf(&#34;walking&#34;)</span>
}</pre></div>
<p dir="auto">Results:</p>
<div data-snippet-clipboard-copy-content="|             Toolchain |     Mean |    Error |   StdDev | Ratio |
|---------------------- |---------:|---------:|---------:|------:|
| \Baseline\corerun.exe | 32.94 ns | 0.665 ns | 0.954 ns |  1.00 |
|     \MyPR\corerun.exe | 14.56 ns | 0.031 ns | 0.026 ns |  0.45 | &gt;2x faster"><pre><code>|             Toolchain |     Mean |    Error |   StdDev | Ratio |
|---------------------- |---------:|---------:|---------:|------:|
| \Baseline\corerun.exe | 32.94 ns | 0.665 ns | 0.954 ns |  1.00 |
|     \MyPR\corerun.exe | 14.56 ns | 0.031 ns | 0.026 ns |  0.45 | &gt;2x faster
</code></pre></div>
<p dir="auto">The algorithm is based on <a href="http://0x80.pl/articles/simd-strfind.html#algorithm-1-generic-simd" rel="nofollow">http://0x80.pl/articles/simd-strfind.html#algorithm-1-generic-simd</a></p>
<p dir="auto">TODO:</p>
<ul>
<li> Consider adding SSE impl</li>
<li> Add Arm64 impl</li>
<li> Use it for 1-byte IndexOf and, probably, Contains</li>
<li> Implement &#34;find last unique char&#34; if last == first</li>
<li> Benchmarks for various inputs, not just the worst cases for the currently used algorithm</li>
</ul>
<table role="table">
  <tbody><tr>
    <th>Author:</th>
    <td>EgorBo</td>
  </tr>
  <tr>
    <th>Assignees:</th>
    <td>EgorBo</td>
  </tr>
  <tr>
    <th>Labels:</th>
    <td>
<p dir="auto"><code>area-System.Memory</code></p>
</td>
  </tr>
  <tr>
    <th>Milestone:</th>
    <td>-</td>
  </tr>
</tbody></table>
</details>
      </div>
</task-lists>


          
      </div>

      <!-- '"` --><!-- </textarea></xmp> -->    </div>
</div>


</div>


</div>


      
<div data-gid="C_kwDODV4kW9oAKGY5ZmQ5ZGJkNjM0MTIwZDNmZTRiZmFiODJjOGE3ODJiNDEwZmM5NTY">
  
        <div>
  <div data-test-selector="pr-timeline-commits-list">
      <div data-view-component="true">
  
  
  <div data-view-component="true">          <div data-channel="eyJjIjoicmVwbzoyMTA3MTYwMDU6Y29tbWl0OmY5ZmQ5ZGJkNjM0MTIwZDNmZTRiZmFiODJjOGE3ODJiNDEwZmM5NTYiLCJ0IjoxNjQxMzA5NDA2fQ==--0b930019856ed53db5ed5ee91f573e3c9b8f8d2950b9c1cd9896751fe4981526" data-url="/dotnet/runtime/pull/63285/commits/f9fd9dbd634120d3fe4bfab82c8a782b410fc956/_render_node/commit/pull_condensed">
  <div>
    <div>
      
<div>
  <p><a data-skip-pjax="true" data-test-selector="commits-avatar-stack-avatar-link" data-hovercard-type="user" data-hovercard-url="/users/EgorBo/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/EgorBo">
        <img data-test-selector="commits-avatar-stack-avatar-image" src="https://avatars.githubusercontent.com/u/523221?s=40&amp;v=4" width="20" height="20" alt="@EgorBo"/>
</a>  </p>
</div>

      

      

      

      
    </div>
  </div>
</div>

</div>
</div>  </div>
</div>


</div>

      


      


      
<div data-gid="IC_kwDODI9FZc472xVZ">
  
      
<div data-gid="IC_kwDODI9FZc472xVZ" data-url="/_render_node/IC_kwDODI9FZc472xVZ/timeline/issue_comment?variables%5BdeferredCommentActions%5D=false&amp;variables%5BdeferredEditForm%5D=false">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/danmoseley/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/danmoseley"><img height="40" width="40" alt="@danmoseley" src="https://avatars.githubusercontent.com/u/6385855?s=88&amp;u=8aceca309734645b8a172bb62945168fbac876cb&amp;v=4"/></a>

</p>


  <div id="issuecomment-1004213593">
    <div data-body-version="4d82b1acf676b8cd13c8f68468ff77f842673e0492db3ab1151c5df64efd50b8">

      



      <div>

        
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p dir="auto">OrdinalIgnoreCase</p>
</blockquote>
<p dir="auto">Possibly in this case it could prefer any characters in the search string that do not change in case (eg., numbers, spaces).</p>
      </div>
</task-lists>


          
      </div>

      <!-- '"` --><!-- </textarea></xmp> -->    </div>
</div>


</div>


</div>


      
<div data-gid="C_kwDODV4kW9oAKDI4OTA3NzI3M2JmYTg5MjNmZDIxZTczMWE4NGM4MjA0NDk2ZTY2MDM">
  
        <div>
  <div data-test-selector="pr-timeline-commits-list">
      <div data-view-component="true">
  
  
  <div data-view-component="true">          <div data-channel="eyJjIjoicmVwbzoyMTA3MTYwMDU6Y29tbWl0OjI4OTA3NzI3M2JmYTg5MjNmZDIxZTczMWE4NGM4MjA0NDk2ZTY2MDMiLCJ0IjoxNjQxMzA5NDA2fQ==--3e1ac7fd8904e76b275d02dcebfe6c2f23e2060eceae95a8db56d90a4262c9e3" data-url="/dotnet/runtime/pull/63285/commits/289077273bfa8923fd21e731a84c8204496e6603/_render_node/commit/pull_condensed">
  <div>
    <div>
      
<div>
  <p><a data-skip-pjax="true" data-test-selector="commits-avatar-stack-avatar-link" data-hovercard-type="user" data-hovercard-url="/users/EgorBo/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/EgorBo">
        <img data-test-selector="commits-avatar-stack-avatar-image" src="https://avatars.githubusercontent.com/u/523221?s=40&amp;v=4" width="20" height="20" alt="@EgorBo"/>
</a>  </p>
</div>

      

      

      

      
    </div>
  </div>
</div>

</div>
</div>  </div>
</div>


</div>

      
<div data-gid="IC_kwDODI9FZc473HTO">
  
      
<div data-gid="IC_kwDODI9FZc473HTO" data-url="/_render_node/IC_kwDODI9FZc473HTO/timeline/issue_comment?variables%5BdeferredCommentActions%5D=false&amp;variables%5BdeferredEditForm%5D=false">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/EgorBo/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/EgorBo"><img height="40" width="40" alt="@EgorBo" src="https://avatars.githubusercontent.com/u/523221?s=88&amp;u=928bd85ed90950adb6fbc06270173ef9bcbbe707&amp;v=4"/></a>

</p>


  <div id="issuecomment-1004303566">
    <div data-body-version="0c04fc8efbcfe5c76917b0c0041626821e613419a416bd915ed0063b397e17b3">

      



      <div>

        
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<blockquote>
<p dir="auto">OrdinalIgnoreCase</p>
</blockquote>
<p dir="auto">Possibly in this case it could prefer any characters in the search string that do not change in case (eg., numbers, spaces).</p>
</blockquote>
<p dir="auto">Good point!</p>
      </div>
</task-lists>


          
      </div>

      <!-- '"` --><!-- </textarea></xmp> -->    </div>
</div>


</div>


</div>


      
<div data-gid="IC_kwDODI9FZc473K2h">
  
      
<div data-gid="IC_kwDODI9FZc473K2h" data-url="/_render_node/IC_kwDODI9FZc473K2h/timeline/issue_comment?variables%5BdeferredCommentActions%5D=false&amp;variables%5BdeferredEditForm%5D=false">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars.githubusercontent.com/u/2642209?s=88&amp;u=1f14e8d00a8c59e57c9d193baab69bf0f52a95ec&amp;v=4"/></a>

</p>


  <div id="issuecomment-1004318113">
    <div data-body-version="72e3e697b2c29d135106d7f8d1911d7f811ac22f7fe1c045d2f0cff7df66f2dd">

      



      <div>

        
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p dir="auto">Benchmarks for various inputs, not just the worst cases for the currently used algorithm</p>
</blockquote>
<p dir="auto">I&#39;d previously added the</p>
<p dir="auto">I tried running it with this PR and got this:</p>
<table role="table">
<thead>
<tr>
<th>Method</th>
<th>Toolchain</th>
<th>Options</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Count</td>
<td>\main\corerun.exe</td>
<td>None</td>
<td>3,847.0 ms</td>
<td>1.00</td>
</tr>
<tr>
<td>Count</td>
<td>\pr\corerun.exe</td>
<td>None</td>
<td>583.9 ms</td>
<td>0.15</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Count</td>
<td>\main\corerun.exe</td>
<td>Compiled</td>
<td>3,830.5 ms</td>
<td>1.00</td>
</tr>
<tr>
<td>Count</td>
<td>\pr\corerun.exe</td>
<td>Compiled</td>
<td>569.4 ms</td>
<td>0.15</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Count</td>
<td>\main\corerun.exe</td>
<td>NonBacktracking</td>
<td>3,899.1 ms</td>
<td>1.00</td>
</tr>
<tr>
<td>Count</td>
<td>\pr\corerun.exe</td>
<td>NonBacktracking</td>
<td>645.4 ms</td>
<td>0.17</td>
</tr>
</tbody>
</table>
      </div>
</task-lists>


          
      </div>

      <!-- '"` --><!-- </textarea></xmp> -->    </div>
</div>


</div>


</div>


      
<div data-gid="IC_kwDODI9FZc473gxK">
  
      
<div data-gid="IC_kwDODI9FZc473gxK" data-url="/_render_node/IC_kwDODI9FZc473gxK/timeline/issue_comment?variables%5BdeferredCommentActions%5D=false&amp;variables%5BdeferredEditForm%5D=false">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/EgorBo/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/EgorBo"><img height="40" width="40" alt="@EgorBo" src="https://avatars.githubusercontent.com/u/523221?s=88&amp;u=928bd85ed90950adb6fbc06270173ef9bcbbe707&amp;v=4"/></a>

</p>


  <div id="issuecomment-1004407882">
    <div data-body-version="831143825b8c2bed7543b7e76761858ffb982e70b801e06a2c7ca6f28d7860f4">

      



      <div>

        
<task-lists disabled="" sortable="">
<div>
          <p dir="auto">Nice! The worst case for this algorithm is a small string + value that doesn&#39;t exist in it (its first character), e.g.:</p>
<p dir="auto">for larger strings (once AVX path is kicked in) the regression disappears.</p>
<p dir="auto">As a possible solution we can use the old one till the first hit (<code>IndexOf(firstChar)</code>) and switch to the new algorithm after. So in cases like ^ we only will do a single IndexOf that won&#39;t find anything.</p>
      </div>
</task-lists>


          
      </div>

      <!-- '"` --><!-- </textarea></xmp> -->    </div>
</div>


</div>


</div>


      


      
<div data-gid="IC_kwDODI9FZc474mAi">
  
      
<div data-gid="IC_kwDODI9FZc474mAi" data-url="/_render_node/IC_kwDODI9FZc474mAi/timeline/issue_comment?variables%5BdeferredCommentActions%5D=false&amp;variables%5BdeferredEditForm%5D=false">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/EgorBo/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/EgorBo"><img height="40" width="40" alt="@EgorBo" src="https://avatars.githubusercontent.com/u/523221?s=88&amp;u=928bd85ed90950adb6fbc06270173ef9bcbbe707&amp;v=4"/></a>

</p>


  <div id="issuecomment-1004691490">
    <div data-body-version="b43e9b716d9c64625ce4d2dac73e246be1a6002ce01d9b6908862a0fca224bda">

      



      <div>

        
<task-lists disabled="" sortable="">
<div>
          <p dir="auto">At the same time, the worst case for the baseline algorithm is when it has to stop every character:</p>
<p dir="auto">(the new one is 20x faster)</p>
      </div>
</task-lists>


          
      </div>

      <!-- '"` --><!-- </textarea></xmp> -->    </div>
</div>


</div>


</div>


      
<div data-gid="PRR_kwDODI9FZc4ySDP0">
  
        <div>
  <div id="pullrequestreview-843592692" data-gid="PRR_kwDODI9FZc4ySDP0" data-channel="eyJjIjoicHVsbF9yZXF1ZXN0X3Jldmlldzo4NDM1OTI2OTIiLCJ0IjoxNjQxMzA5NDA2fQ==--6181aa5113a906e461ccde49e50a58a1cd78034a2a6925c5049afdd8fdef2613" data-url="/dotnet/runtime/pull/63285/partials/reviews/843592692">
    <div data-view-component="true">
  <p><a href="https://github.com/JensRantil" data-view-component="true"><img data-hovercard-type="user" data-hovercard-url="/users/JensRantil/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" src="https://avatars.githubusercontent.com/u/730342?s=60&amp;v=4" alt="JensRantil" size="40" height="40" width="40" data-view-component="true"/></a></p>
  
</div>
      <div data-view-component="true">
  
  
  <div data-view-component="true">          <div id="pullrequestreview-843592692">
                  

                  <div>
  
  <task-lists disabled="" sortable="">
    <p dir="auto">Now I&#39;m just a random programmer doing a drive-by code review <g-emoji alias="wave" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f44b.png">ðŸ‘‹</g-emoji>, but would it make sense to split the ~200 line method into smaller submethods for increased readability? <g-emoji alias="shrug" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f937.png">ðŸ¤·</g-emoji> Maybe my only contribution to .NET in my lifetime. :)</p>
  </task-lists>
  
</div>


                  
                  

</div>
</div>
</div>
      </div>
</div>


</div>





<!-- Rendered timeline since 2022-01-04 06:01:22 -->



    </div></div>
  </body>
</html>
