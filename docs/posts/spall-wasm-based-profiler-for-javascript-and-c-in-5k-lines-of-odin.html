<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gravitymoth.com/spall/">Original</a>
    <h1>Show HN: Spall â€“ WASM-based profiler for JavaScript and C in ~5k lines of Odin</h1>
    
    <div id="readability-page-1" class="page"><section id="content">
				<h2>What is Spall?</h2>
				<p>Spall is a tool for viewing traces that runs in your browser, and a small header-only C library for
				tracing your projects.</p>
				<div>
					
					<div>
						<h3>The Short Notes</h3>
						<ul>
							<li>Supports chrome, dtrace and C/C++ backends</li>
							<li>Runs as fast as your monitor does</li>
							<li>Can handle up to 2 GB JSON traces</li>
							<li>Supports chrome devtools sampling data</li>
							<li>Gives you handy runtime stats</li>
						</ul>
					</div>
				</div>
				<h2>Getting Started With Spall</h2>
				<h3>For Web-Profiler Vets</h3>
				<p>If you&#39;re an old-hat with <code>chrome://tracing</code>, <code>speedscope</code>, or <code>perfetto</code>, you should feel right at home.
				Spall supports most of the <code>chrome://tracing</code>/<code>speedscope</code>/<code>perfetto</code> JSON format. You should be able to get 
				off and running with your existing files and JSON trace dumping code. If you use chrome&#39;s sampling profiler for bigger captures and 
				you&#39;re struggling to view them, Spall can ingest and display those files too!</p>
				<h3 id="spall-walkthrough">For Everybody Else</h3>
				<p>If you want to learn to use Spall and get a quick briefer on profilers, keep reading!</p>

				<p>Profilers <i>typically</i> come in two flavors, <b>sampling</b> and <b>tracing</b>. Spall is a frontend with support
				for both tracing and sampling profiler libraries. Spall is mostly used for tracing, where function begin and ends get timed
				and written to a file. Sampling, where the profiler takes a snapshot of your program on an interval, can be a little easier to 
				configure but can miss shorter-lived functions completely, and provides very little data for programs with short runtimes.</p>

				<p>Spall includes a <a href="https://github.com/colrdavidson/spall/blob/master/spall.h">small, single-header C library</a>,
				to make tracing easy. For relatively simple programs using clang or gcc, you can use <code>-finstrument-functions</code>
				to instrument your whole program quickly. For more complex programs, you might want to manually instrument specific 
				parts of your code to reduce your trace sizes and keep your runtimes a little more accurate.</p>

				<p>The common advice for profilers is to sample first, and then trace sparingly to narrow in on the problem,
				but if your traces are cheap enough (Spall&#39;s traces are around ~12 ns per function for coffeelake-mobile CPUs
				when configured correctly), with auto-tracing you can often skip right to tracing and get far more useful data. 
				Hopefully Spall&#39;s native version will be shippable soon, so you&#39;ll be able to trace bigger programs happily.
				With the native version prototype as-is, along with `-finstrument-functions` instrumentation,
				Spall&#39;s library can push and display least 8 million functions per second, tracing all
				of the Odin compiler&#39;s 100 million function-calls that get run while compiling Spall itself.</p>

				<p>There are some very simple <a href="https://github.com/colrdavidson/spall/blob/master/examples/">examples</a> to get
				started with tracing! (If you can&#39;t bind against the C header in your project, don&#39;t worry, more language support is planned soon!)</p>

				<p>If you want to sample and you&#39;re on a platform with <code>dtrace</code> support, there&#39;s a lovely community supported library, 
				<a href="https://github.com/bvisness/dtrace2spall">dtrace2spall</a>, that you can use to get started without changing your code.</p>

				<p>If you&#39;re a webdev, you&#39;ve used the chrome devtools performance tab to profile your website before, and you wanted to get a *little*
				more information out of that trace, or just not have it stutter when you zoom, you can export it and drop it into spall!
				Just hit the Save Profile button in the top left, and then drag and drop it into the interface</p>

				<p>Spall demoed live at the <a href="https://handmade-seattle.com">Handmade Seattle conference</a>, 
				going head-to-head against perfetto, and handily won, with buttery smooth frames and tiny load-times for huge files!</p>
				<p>
					<iframe title="vimeo-player" src="https://player.vimeo.com/video/776796857?h=eb79b4ca63" frameborder="0" allowfullscreen="">
					</iframe>
				</p>
				<p>Check out more excellent talks and demos like Spall over at 
				<a href="https://guide.handmade-seattle.com/c/2022/">Handmade Seattle&#39;s Video Guide</a></p>

				<h3 id="basic-features">Basic Features</h3>

				<p>Once you&#39;ve got your program instrumented, you can drag-and-drop
				or click &#34;open file&#34; at the top left, and select your <code>spall</code> or <code>json</code> file, and get started.</p>

				<h4>Navigation</h4>
				
				<p>Clicking and dragging moves the view around and scrolling zooms in and out</p>

				<h4>Event Selection</h4>
				
				<p>Clicking on an event brings up some basic information about it</p>

				<h4>Event Multiselection</h4>
				
				<p>Shift-click allows you to select a chunk of events to run stats on</p>

				<h4>Get All Stats</h4>
				
				<p>Clicking on the &#34;get stats for the whole file&#34; button at the top left runs stats for your whole program</p>

				<h4>That&#39;s All!</h4>
				<p>You&#39;ve got the basics at this point, go have fun!</p>

				
				<p>The web-version of Spall is available on <a href="https://github.com/colrdavidson/spall">github</a> if you want to go play with the source yourself!</p>
				<div>
					<p>Do you like Spall? Are you looking to hire a senior systems engineer?</p><p>Check out the rest of my
					<a href="https://colrdavidson.github.io">portfolio</a> for more cool projects and contact info!</p>
				</div>
			</section></div>
  </body>
</html>
