<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.moderntreasury.com/journal/accounting-for-developers-part-iii">Original</a>
    <h1>Accounting for developers part III – building a lending marketplace</h1>
    
    <div id="readability-page-1" class="page"><div><h2 id="introduction">Introduction</h2><p>We recently released two pieces on accounting principles for developers building products that move money. <a href="https://www.moderntreasury.com/journal/accounting-for-developers-part-i" tabindex="0">Part I</a> covered basic accounting principles like debits and credits, account normality, and dual aspect. In <a href="https://www.moderntreasury.com/journal/accounting-for-developers-part-ii" tabindex="0">Part II</a>, we walked through how to apply these principles to build a Venmo clone.</p><p>This follow-up will explore the accounting principles behind a lending app. Here, we’ll look at a consumer lending marketplace akin to Lending Club that we’ll call Modern Lending. While we are showcasing a lending marketplace, you will find that the principles presented here are applicable to most types of lending ledgers.</p><h2 id="who-this-guide-is-for">Who This Guide Is For</h2><p>This guide is ideal for developers who are building products that feature a lending component and operate at some scale.</p><p>For lending applications, keeping track of money using double-entry is especially important. Double-entry ensures funds are not created or destroyed out of nothing, and balances are always accurate. Using double-entry constraints in database development is a best practice for fintechs and other companies that move money (read more about this topic in our article <a href="https://www.moderntreasury.com/journal/how-and-why-homegrown-ledgers-break" tabindex="0">How And Why Homegrown Ledgers Break</a> and the public examples of <a href="https://www.uber.com/blog/money-scale-strong-data/" tabindex="0" target="_blank" rel="noreferrer">Uber</a>, <a href="https://developer.squareup.com/blog/books-an-immutable-double-entry-accounting-database-service/" tabindex="0" target="_blank" rel="noreferrer">Square</a>, and <a href="https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040" tabindex="0" target="_blank" rel="noreferrer">Airbnb</a>).</p><h2 id="why-double-entry">Why Double Entry</h2><p>As a reminder, obeying double-entry accounting rules boils down to following these principles:</p><ul><li>Your ledger should be composed of <strong>accounts</strong> and <strong>transactions;</strong></li><li>Accounts represent the balances your ledger will track. They can be classified as <strong>debit normal</strong> or <strong>credit normal</strong>.</li><li>Transactions represent business events that have a monetary impact. They are composed of multiple <strong>entries</strong> (at least two). Each entry can be on the <strong>debit side</strong><em> </em>or <strong>credit side</strong>.</li><li>The aggregate balance of all credit normal accounts and all debit normal accounts in a ledger should net out to zero (credits = debits).</li></ul><p>(For a refresher on <a href="https://www.moderntreasury.com/journal/what-is-double-entry-accounting" tabindex="0">double-entry,</a> visit <a href="https://www.moderntreasury.com/journal/accounting-for-developers-part-i" tabindex="0">Part I</a> of our series.)</p><h2 id="building-modern-lending">Building Modern Lending</h2><h2 id="step-1-reviewing-the-use-case">Step 1: Reviewing The Use Case </h2><p>Let’s start with the requirements for our fictitious Modern Lending. This is a peer-to-peer lending marketplace where individuals can add money to a shared pool of cash managed by Modern Lending. These investors can then set their risk preferences, accept interest rates and invest directly on the platform.</p><p>Modern Lending then lends out the money to borrowers on the platform, adjusting the amount and interest rate based on their creditworthiness. Borrowers pay back their principal balance over time, and after repayments, Modern Lending returns capital to investors, plus interest. Modern Lending recognizes (books) the spread between the interest it gets paid by borrowers and the interest it pays to investors as revenue.</p><p>This translates into the following set of product requirements:</p><ul><li>Users should be able to self-select as <em>investors</em> or <em>borrowers</em> during onboarding;</li><li><strong>For investors:</strong><ul><li>During onboarding, they would choose between a set of investing options, varying by term (when they get their money back) and interest rate (how much they get in return).</li><li>After onboarding, they would <a href="https://www.moderntreasury.com/learn/what-is-a-wire-transfer" tabindex="0">wire</a> or <a href="https://www.moderntreasury.com/learn/what-is-ach" tabindex="0">ACH</a> their committed investment into the Modern Lending cash pool. This investment would be represented in their account as a balance.</li><li>At the end of their chosen term, they receive their principal back plus interest.</li></ul></li><li><strong>For borrowers:	</strong><ul><li>During onboarding, they would submit information about creditworthiness and income.</li><li>They would then receive a list of potential loans they can take varying by amount, term, and interest rate.</li><li>Next, they would pick one of these loans and have money disbursed to them in the form of a <a href="https://www.moderntreasury.com/learn/what-is-a-wire-transfer" tabindex="0">wire</a>, <a href="https://www.moderntreasury.com/learn/what-is-ach" tabindex="0">ACH</a>, or <a href="https://www.moderntreasury.com/learn/what-is-rtp" tabindex="0">RTP</a> transfer.</li><li>Over time, the borrower would make repayments in the platform against their principal and interest balance, which would be represented in-app.</li></ul></li></ul><p>Let’s assume there are no transaction costs or fees. We will also assume we are building this application for scale—Modern Lending should be configured to handle thousands of investors and borrowers triggering disbursements and collections every day. Finally, let’s also assume we would like to build our ledger flexibly to accommodate future product expansions.<br/></p><p>This scenario creates a set of <strong>ledgering<em> </em>requirements</strong>:</p><ul><li><strong>Transactions need to be logged as they happen. </strong>For this, we will need a <a href="https://www.moderntreasury.com/learn/ledger-api" tabindex="0">ledger API</a> that embeds directly into our application code and writes into the ledger database as business events happen. Modern Lending needs to parse financial transactions and dictate how to write in the ledger—we’ll call this ‘translation’ service <em>transaction handling logic</em>.</li><li><strong>Balances need to be kept up to date consistently and automatically</strong>. Transactions need to be parsed appropriately in order to update the correct balances. Aggregations need to be efficient, and balances need to be updated within milliseconds of a transaction taking place. They also need to be queryable to support transactions such as showing the user an updated balance after a transaction is completed. For this to be true, we need to map our accounts to their given <em>normality—</em>a set of constraints that will help the ledger obey double-entry rules. Such constraints are represented in a <em><a href="https://www.moderntreasury.com/learn/chart-of-accounts" tabindex="0">chart of accounts</a>.</em></li><li><strong>The ledger needs to accommodate a high volume of financial transactions and be built flexibly to expand our product offerings in the future. </strong>In essence, this needs to be a central ledger that is divorced from fund movements (i.e., our underlying bank account setup) and is fully programmatic and flexible. The ledger’s functionality and underlying data models should not be tightly coupled to business logic.</li></ul><p>In the next sections, we discuss the accounting setup—first, our <em>chart of accounts</em>, then our <em>transaction handling logic.</em></p><h2 id="step-2-reviewing-the-data-flow">Step 2: Reviewing the Data Flow</h2><p>Before we start with the ledgering setup, it’s important for us to understand how data flows in a lending system. Modern Lending would need to implement the following services infrastructure alongside its ledger.</p><div><figure><span><span></span><img alt="How Modern Lending&#39;s systems come together" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></figure></div><figcaption>How Modern Lending&#39;s systems come together</figcaption><p>There are two kinds of data Modern Lending needs to keep track of:</p><ol><li><strong>Historical data, </strong>or data that reliably represents the current financial state of Modern Lending based on posted transactions.</li><li><strong>Prospective data,</strong> specifically those that are defined by the business model: interest rates, loan terms, payment amounts, and the payment breakdown of interest versus principal.</li></ol><p>Modern Lending will need to make use of an <a href="https://www.investopedia.com/terms/a/amortization_schedule.asp" tabindex="0" target="_blank" rel="noreferrer">amortization schedule</a>, a tool that utilizes interest rates, principal, and loan term to define monthly payments. It is also common for lending businesses to front-load the percentage of a customer’s payments that goes towards interest versus principal. An internal service on Modern Lending’s backend can track this data and modify outputs based on new inputs (i.e., new loan terms).</p><p>The ledger database acts in tandem with the amortization schedule. The ledger acts as the source of truth for historical information. Every time the amortization schedule service needs to provide an updated view of current balances, it cross-references the amortization schedule with the ledger database to provide accurate data.</p><p>Keeping historical information in the ledger and the amortization schedule outside of the ledger keeps Modern Lending’s data store clean and referenceable over the course of the lifetime of the loan.</p><p>Notice that the ledger also needs to interact with another service divorced from the underlying ledger: payments and reconciliation logic. This service is our way of representing Modern Lending’s payment processor of choice: this can be a card processor or Modern Treasury Payments API if you’re using ACH, wire, or RTP.  Transactions come in as webhooks and get parsed as ledger transactions according to the rules presented below.</p><h2 id="step-3-building-your-chart-of-accounts">Step 3: Building Your Chart Of Accounts</h2><p>A <a href="https://www.moderntreasury.com/learn/chart-of-accounts" tabindex="0">chart of accounts</a> is a simple depiction of the accounts Modern Lending will need, their type, and normality.</p><div><figure><span><span></span><img alt="Modern Lending&#39;s Chart of Accounts" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></figure></div><figcaption>Modern Lending&#39;s Chart of Accounts</figcaption><p>Let’s review this in detail. First, we have two general accounts: cash and revenue. <strong>Cash </strong>tracks the overall cash position of Modern Lending. As it represents a <strong>use of funds</strong>, it is a <strong>debit normal</strong> account. Revenue, on the other hand, represents a tally of how much money we recognize (book) as revenue during the regular course of business. It is a <strong>credit normal </strong>account because it represents a <strong>source </strong>of funds. For the sake of this example, Modern Lending has a single revenue stream: interest.</p><p>You may have noticed we have a set of “n of” accounts. This is our way of representing that <strong>each</strong> investor and <strong>each</strong> borrower will have two sets of accounts: one tracking principal and one tracking interest. While we will only need one <strong>cash </strong>and one <strong>revenue </strong>account, we need multiple sets of user accounts.</p><p><strong>Principal accounts </strong>track total capital invested by investors and total capital lent to borrowers. The investor principal accounts are <strong>credit normal</strong> because they represent <strong>sources</strong> of funds—or funds Modern Lending owes. Conversely, borrower principal accounts are <strong>debit normal</strong> because they represent <strong>uses of funds</strong>—akin to receivables.</p><p>Finally, <strong>interest accounts </strong>track the interest balance for both investors and borrowers. They follow the same normality rules as the principal accounts: they are <strong>credit normal</strong> when they track interest due to investors and <strong>debit normal </strong>when they track interest that is owed to Modern Lending by the borrowers.</p><h2 id="step-4-mapping-transaction-logic">Step 4: Mapping Transaction Logic</h2><p>Let’s consider the typical set of events that will hit the ledger. As mentioned before, a stream of transactions is parsed through the internal service handling payments and reconciliation. Transactions are then written into the ledger according to the rules presented below. The examples below are meant to be illustrative of what transaction handling logic looks like - there are other transaction types not presented here Modern Lending would need to parse out.</p><p>Here we cover the following archetypical transactions:</p><ol><li><strong>Investor deposit</strong>. An investor adds money to their balance.</li><li><strong>Borrower disbursement</strong>. A borrower initiates a loan and receives funds.</li><li><strong>Interest calculation. </strong>Monthly interest gets added to the interest balance for both borrowers and investors. As part of this calculation, part of the interest gets recognized as booked revenue.</li><li><strong>Borrower repayment</strong>. A borrower repays monthly installments covering both interest and principal.</li><li><strong>Investor withdrawal</strong>. At the end of their term, Modern Lending sends principal plus interest owed to investors.</li></ol><p>In this example, we’ll simplify our marketplace down to one investor (Brittany) and one borrower (Art). We’ll also assume the following data about our loans is coming from our amortization schedule:</p><ul><li>Brittany is depositing $10,000 as an investor and expects a 4.8% return upon completion of her 1-year term. This equates to a payment of $10,480 to her at the end of month 12, or $10,000 in principal plus $480 in interest.</li><li>Art is borrowing $5,000 and will pay 12% annual interest over the course of his 1-year loan. This equates to $600 in interest at the end of the year. If we also assume simple interest calculations and monthly payments, the amortization schedule also informs our ledger that Art needs to make monthly payments of $466.67, with $416.67 ($5,000 / 12) of this being directed towards principal, and $50 ($600 / 12) directed towards interest.</li></ul><h3>Transaction Type 1. Investor deposit</h3><div><figure><span><span></span><img alt="Transaction Type 1: Investor Deposit" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></figure></div><figcaption>Brittany&#39;s $10K investor deposit</figcaption><p>As Brittany deposits money on the Modern Lending platform, we <strong>debit (increase) </strong>the cash account and <strong>credit (increase) </strong>Brittany’s investor balance account. Brittany’s interest rate is fetched from our amortization schedule.</p><p>Notice that we don’t record any kind of interest due to Brittany on the ledger at this time, regardless of the fact Brittany was promised a 4.8% return upon sign-up. Interest is ledgered in a separate transaction (see below).</p><h3>Transaction Type 2. Borrower disbursement</h3><div><figure><span><span></span><img alt="Transaction Type 2: Borrower Disbursement" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></figure></div><figcaption>Art gets disbursed $5K</figcaption><p>When Art is approved for a loan and receives $5,000, we <strong>credit (decrease) </strong>our cash account and <strong>debit (increase) </strong>Art’s principal due account. As above, notice we do not record any kind of interest owed by Art at this time.</p><h3>Transaction Type 3. Interest calculation</h3><div><figure><span><span></span><img alt="Transaction Type 3: Interest Calculation" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></figure></div><figcaption>Monthly interest calculation</figcaption><p>Recall that Brittany lent $10,000 and expects a 4.8% return in a year. That means her effective interest payment at maturity (when the loan is due) equates to $480. Given we are assuming simple interest, we can see that we should add $40 to her interest balance to the ledger every month ($480/12). This is a <strong>credit</strong> because we are increasing a <strong>credit normal</strong> account.</p><p>As outlined before, Art borrowed $5,000 at 12% to be paid in a year. This means Art’s final interest balance will be $600 at the end of the year. Assuming simple interest again, our ledger should add $50 every month to Art’s interest balance ($600/ 12). This is a <strong>debit</strong> because we are increasing a <strong>debit normal </strong>account. (Let’s assume Brittany’s remaining $5,000 just sits on Modern Lending’s cash account for now).</p><p>At the end of the year, Modern Lending will have received $600 from Art and will owe Brittany $480 in interest. The difference of $120 is recognized as revenue. Every month, as interest gets calculated, we add $10 to our revenue account ($120 / 12).</p><p>You may be wondering why we recognize revenue as interest gets calculated, as opposed to when a borrower pays out their repayments or when an investor receives their payout. There is a difference between booked revenue (accrual) and realized revenue (cash). These two concepts are borne from <a href="https://www.investopedia.com/ask/answers/09/accrual-accounting.asp" tabindex="0" target="_blank" rel="noreferrer">accrual and cash accounting</a> principles.</p><p>In this case, we are using accrual accounting and booking revenue at the point in which it is earned: when interest is incurred. In a marketplace of hundreds or thousands, these transactions would be handled by a monthly cron job that calculates interest and modifies balances on the ledger at a predetermined date.</p><p>Were we using cash accounting, we would add to the realized ledger only after a borrower makes their repayments and investors get paid back. Because your application ledger doesn’t need to comply with <a href="https://www.investopedia.com/terms/g/gaap.asp" tabindex="0" target="_blank" rel="noreferrer">GAAP accounting rules</a>, we suggest you pick the method that leads to the cleanest ledger.</p><h3>Transaction Type 4. Borrower repayment</h3><div><figure><span><span></span><img alt="Transaction Type 4: Borrower Repayment" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></figure></div><figcaption>Art pays his monthly installment</figcaption><p>Every month Art makes a payment towards his balance. At the end of the term of his loan Art will have to pay a total of $5,600, $5,000 in principal, and $600 in interest. This translates into a monthly payment of $466.67.</p><p>After the transaction clears, we <strong>debit (increase) </strong>our cash account by $466.67. In the same transaction, we<strong> credit (decrease) </strong>both principal and interest balances for Art. Principal gets deducted by $416.67 ($5,000 / 12) and interest gets deducted by $50 ($600 / 12).</p><p>At this point, the ledger shows one payment made by Art, a principal balance of $4,583.33 ($5,000 - $416.67), and an <em>interest balance of zero. </em>This happens because we recognized interest in the “interest calculation” section and then immediately zeroed it out as the payment was made. The sum of credits towards Art’s interest balance represents the total paid in interest. We can contrast this with the data from Modern Lending’s amortization schedule to derive Art’s remaining principal balance.</p><h3>Transaction Type 5. Investor disbursement</h3><div><figure><span><span></span><img alt="Transaction Type 5: Investor Disbursement" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></figure></div><figcaption>Brittany gets repaid at year end</figcaption><p>Finally, at the end of the year, Brittany would get disbursed her principal of $10,000 in addition to the 4.8% return—or $480—promised to her. We <strong>credit (decrease) </strong>our cash account, and simultaneously, we lower her principal and interest down to zero by <strong>debiting (decreasing) </strong>$10,000 and $480, respectively.</p><h2 id="step-5-bringing-it-all-together">Step 5: Bringing It All Together</h2><p>Let’s review the elements we would need in place to service this use case:</p><ul><li>Modern Lending <strong>needs a central ledger</strong> that represents the entire collection of accounts and transactions;<br/></li><li>Working with the ledger, <strong>we need two services</strong>: one that streams transaction data (typically a payments API like <a href="https://www.moderntreasury.com/" tabindex="0">Modern Treasury</a>) and one amortization schedule.<br/></li><li><strong>The ledger will need <em>at least six</em> types of accounts:</strong><ul><li>One debit normal cash account</li><li>One credit normal revenue from interest account</li><li>One credit normal investor principal account per investor in the platform</li><li>One credit normal investor interest account per investor in the platform</li><li>One debit normal borrower interest account per borrower in the platform</li><li>One debit normal borrower principal account per borrower in the platform.<br/></li></ul></li><li><strong>Transaction logic that supports <em>at least the following five types of typical transactions</em>:</strong><ul><li>Investor deposit</li><li>Borrower disbursement</li><li>Interest calculation</li><li>Borrower repayment</li><li>Investor disbursement</li></ul></li></ul><p>If any of the concepts above are confusing, or you simply need a refresher on debits and credits, take a look at part I of this series <a href="https://www.moderntreasury.com/journal/accounting-for-developers-part-i" tabindex="0">here</a>. Bottom line is that while using double-entry is the best way to ensure integrity of the financial information flowing through Modern Lending’s product, it requires a bit of setup and parsing through the most common transactions. While this seems hard at first, understanding accounting principles goes a long way. The hard part—we believe—is setting up the underlying ledger database with the right constraints and level of flexibility.</p><p>If you are interested in a ledger that can power this—or any other application that moves money—take a look at <a href="https://www.moderntreasury.com/products/ledgers" tabindex="0">Modern Treasury Ledgers</a> and <a href="https://www.moderntreasury.com/talk-to-us" tabindex="0">reach out</a> if we can be helpful.</p></div></div>
  </body>
</html>
