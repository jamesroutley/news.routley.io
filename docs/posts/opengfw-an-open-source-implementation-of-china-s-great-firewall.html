<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/apernet/OpenGFW">Original</a>
    <h1>OpenGFW: an open source implementation of China&#39;s Great Firewall</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://github.com/apernet/OpenGFW/blob/master/LICENSE"><img src="https://camo.githubusercontent.com/ea91095c2cdfaf326654935e542d6d05f492a58a7c61ef3fa05ac8b4f008f8d7/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d504c5f322e302d627269676874677265656e2e737667" alt="License" data-canonical-src="https://img.shields.io/badge/License-MPL_2.0-brightgreen.svg"/></a></p>
<p dir="auto"><strong><a href="https://github.com/apernet/OpenGFW/blob/master/README.zh.md">中文文档</a></strong>
<strong><a href="https://github.com/apernet/OpenGFW/blob/master/README.ja.md">日本語ドキュメント</a></strong></p>
<p dir="auto">OpenGFW is your very own DIY Great Firewall of China (<a href="https://en.wikipedia.org/wiki/Great_Firewall" rel="nofollow">https://en.wikipedia.org/wiki/Great_Firewall</a>), available as a flexible, easy-to-use open source program on Linux. Why let the powers that be have all the fun? It&#39;s time to give power to the people and democratize censorship. Bring the thrill of cyber-sovereignty right into your home router and start filtering like a pro - you too can play Big Brother.</p>
<p dir="auto">Telegram group: <a href="https://t.me/OpGFW" rel="nofollow">https://t.me/OpGFW</a></p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Caution</p><p dir="auto">This project is still in very early stages of development. Use at your own risk.</p>
</div>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p dir="auto">We are looking for contributors to help us with this project, especially implementing analyzers for more protocols!!!</p>
</div>

<ul dir="auto">
<li>Full IP/TCP reassembly, various protocol analyzers
<ul dir="auto">
<li>HTTP, TLS, QUIC, DNS, SSH, SOCKS4/5, WireGuard, and many more to come</li>
<li>&#34;Fully encrypted traffic&#34; detection for Shadowsocks,
etc. (<a href="https://gfw.report/publications/usenixsecurity23/en/" rel="nofollow">https://gfw.report/publications/usenixsecurity23/en/</a>)</li>
<li>Trojan (proxy protocol) detection based on Trojan-killer (<a href="https://github.com/XTLS/Trojan-killer">https://github.com/XTLS/Trojan-killer</a>)</li>
<li>[WIP] Machine learning based traffic classification</li>
</ul>
</li>
<li>Full IPv4 and IPv6 support</li>
<li>Flow-based multicore load balancing</li>
<li>Connection offloading</li>
<li>Powerful rule engine based on <a href="https://github.com/expr-lang/expr">expr</a></li>
<li>Hot-reloadable rules (send <code>SIGHUP</code> to reload)</li>
<li>Flexible analyzer &amp; modifier framework</li>
<li>Extensible IO implementation (only NFQueue for now)</li>
<li>[WIP] Web UI</li>
</ul>

<ul dir="auto">
<li>Ad blocking</li>
<li>Parental control</li>
<li>Malware protection</li>
<li>Abuse prevention for VPN/proxy services</li>
<li>Traffic analysis (log only mode)</li>
<li>Help you fulfill your dictatorial ambitions</li>
</ul>




<div dir="auto" data-snippet-clipboard-copy-content="export OPENGFW_LOG_LEVEL=debug
./OpenGFW -c config.yaml rules.yaml"><pre><span>export</span> OPENGFW_LOG_LEVEL=debug
./OpenGFW -c config.yaml rules.yaml</pre></div>

<p dir="auto">OpenGFW has been tested to work on OpenWrt 23.05 (other versions should also work, just not verified).</p>
<p dir="auto">Install the dependencies:</p>
<div dir="auto" data-snippet-clipboard-copy-content="opkg install kmod-nft-queue kmod-nf-conntrack-netlink"><pre>opkg install kmod-nft-queue kmod-nf-conntrack-netlink</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="io:
  queueSize: 1024
  rcvBuf: 4194304
  sndBuf: 4194304
  local: true # set to false if you want to run OpenGFW on FORWARD chain

workers:
  count: 4
  queueSize: 16
  tcpMaxBufferedPagesTotal: 4096
  tcpMaxBufferedPagesPerConn: 64
  udpMaxStreams: 4096

# The path to load specific local geoip/geosite db files.
# If not set, they will be automatically downloaded from https://github.com/Loyalsoldier/v2ray-rules-dat
# geo:
#   geoip: geoip.dat
#   geosite: geosite.dat"><pre><span>io</span>:
  <span>queueSize</span>: <span>1024</span>
  <span>rcvBuf</span>: <span>4194304</span>
  <span>sndBuf</span>: <span>4194304</span>
  <span>local</span>: <span>true </span><span><span>#</span> set to false if you want to run OpenGFW on FORWARD chain</span>

<span>workers</span>:
  <span>count</span>: <span>4</span>
  <span>queueSize</span>: <span>16</span>
  <span>tcpMaxBufferedPagesTotal</span>: <span>4096</span>
  <span>tcpMaxBufferedPagesPerConn</span>: <span>64</span>
  <span>udpMaxStreams</span>: <span>4096</span>

<span><span>#</span> The path to load specific local geoip/geosite db files.</span>
<span><span>#</span> If not set, they will be automatically downloaded from https://github.com/Loyalsoldier/v2ray-rules-dat</span>
<span><span>#</span> geo:</span>
<span><span>#</span>   geoip: geoip.dat</span>
<span><span>#</span>   geosite: geosite.dat</span></pre></div>

<p dir="auto"><a href="https://github.com/apernet/OpenGFW/blob/master/docs/Analyzers.md">Analyzer properties</a></p>
<p dir="auto">For syntax of the expression language, please refer
to <a href="https://expr-lang.org/docs/language-definition" rel="nofollow">Expr Language Definition</a>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# A rule must have at least one of &#34;action&#34; or &#34;log&#34; field set.
- name: log horny people
  log: true
  expr: let sni = string(tls?.req?.sni); sni contains &#34;porn&#34; || sni contains &#34;hentai&#34;

- name: block v2ex http
  action: block
  expr: string(http?.req?.headers?.host) endsWith &#34;v2ex.com&#34;

- name: block v2ex https
  action: block
  expr: string(tls?.req?.sni) endsWith &#34;v2ex.com&#34;

- name: block v2ex quic
  action: block
  expr: string(quic?.req?.sni) endsWith &#34;v2ex.com&#34;

- name: block and log shadowsocks
  action: block
  log: true
  expr: fet != nil &amp;&amp; fet.yes

- name: block trojan
  action: block
  expr: trojan != nil &amp;&amp; trojan.yes

- name: v2ex dns poisoning
  action: modify
  modifier:
    name: dns
    args:
      a: &#34;0.0.0.0&#34;
      aaaa: &#34;::&#34;
  expr: dns != nil &amp;&amp; dns.qr &amp;&amp; any(dns.questions, {.name endsWith &#34;v2ex.com&#34;})

- name: block google socks
  action: block
  expr: string(socks?.req?.addr) endsWith &#34;google.com&#34; &amp;&amp; socks?.req?.port == 80

- name: block wireguard by handshake response
  action: drop
  expr: wireguard?.handshake_response?.receiver_index_matched == true

- name: block bilibili geosite
  action: block
  expr: geosite(string(tls?.req?.sni), &#34;bilibili&#34;)

- name: block CN geoip
  action: block
  expr: geoip(string(ip.dst), &#34;cn&#34;)

- name: block cidr
  action: block
  expr: cidr(string(ip.dst), &#34;192.168.0.0/16&#34;)"><pre><span><span>#</span> A rule must have at least one of &#34;action&#34; or &#34;log&#34; field set.</span>
- <span>name</span>: <span>log horny people</span>
  <span>log</span>: <span>true</span>
  <span>expr</span>: <span>let sni = string(tls?.req?.sni); sni contains &#34;porn&#34; || sni contains &#34;hentai&#34;</span>

- <span>name</span>: <span>block v2ex http</span>
  <span>action</span>: <span>block</span>
  <span>expr</span>: <span>string(http?.req?.headers?.host) endsWith &#34;v2ex.com&#34;</span>

- <span>name</span>: <span>block v2ex https</span>
  <span>action</span>: <span>block</span>
  <span>expr</span>: <span>string(tls?.req?.sni) endsWith &#34;v2ex.com&#34;</span>

- <span>name</span>: <span>block v2ex quic</span>
  <span>action</span>: <span>block</span>
  <span>expr</span>: <span>string(quic?.req?.sni) endsWith &#34;v2ex.com&#34;</span>

- <span>name</span>: <span>block and log shadowsocks</span>
  <span>action</span>: <span>block</span>
  <span>log</span>: <span>true</span>
  <span>expr</span>: <span>fet != nil &amp;&amp; fet.yes</span>

- <span>name</span>: <span>block trojan</span>
  <span>action</span>: <span>block</span>
  <span>expr</span>: <span>trojan != nil &amp;&amp; trojan.yes</span>

- <span>name</span>: <span>v2ex dns poisoning</span>
  <span>action</span>: <span>modify</span>
  <span>modifier</span>:
    <span>name</span>: <span>dns</span>
    <span>args</span>:
      <span>a</span>: <span><span>&#34;</span>0.0.0.0<span>&#34;</span></span>
      <span>aaaa</span>: <span><span>&#34;</span>::<span>&#34;</span></span>
  <span>expr</span>: <span>dns != nil &amp;&amp; dns.qr &amp;&amp; any(dns.questions, {.name endsWith &#34;v2ex.com&#34;})</span>

- <span>name</span>: <span>block google socks</span>
  <span>action</span>: <span>block</span>
  <span>expr</span>: <span>string(socks?.req?.addr) endsWith &#34;google.com&#34; &amp;&amp; socks?.req?.port == 80</span>

- <span>name</span>: <span>block wireguard by handshake response</span>
  <span>action</span>: <span>drop</span>
  <span>expr</span>: <span>wireguard?.handshake_response?.receiver_index_matched == true</span>

- <span>name</span>: <span>block bilibili geosite</span>
  <span>action</span>: <span>block</span>
  <span>expr</span>: <span>geosite(string(tls?.req?.sni), &#34;bilibili&#34;)</span>

- <span>name</span>: <span>block CN geoip</span>
  <span>action</span>: <span>block</span>
  <span>expr</span>: <span>geoip(string(ip.dst), &#34;cn&#34;)</span>

- <span>name</span>: <span>block cidr</span>
  <span>action</span>: <span>block</span>
  <span>expr</span>: <span>cidr(string(ip.dst), &#34;192.168.0.0/16&#34;)</span></pre></div>

<ul dir="auto">
<li><code>allow</code>: Allow the connection, no further processing.</li>
<li><code>block</code>: Block the connection, no further processing.</li>
<li><code>drop</code>: For UDP, drop the packet that triggered the rule, continue processing future packets in the same flow. For
TCP, same as <code>block</code>.</li>
<li><code>modify</code>: For UDP, modify the packet that triggered the rule using the given modifier, continue processing future
packets in the same flow. For TCP, same as <code>allow</code>.</li>
</ul>
</article></div></div>
  </body>
</html>
