<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/maharmstone/ntfs2btrfs">Original</a>
    <h1>ntfs2btrfs: In-place conversion of NTFS filesystem to Btrfs</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text">
<p dir="auto">Ntfs2btrfs is a tool which does in-place conversion of Microsoft&#39;s NTFS
filesystem to the open-source filesystem Btrfs, much as <code>btrfs-convert</code>
does for ext2. The original image is saved as a reflink copy at
<code>image/ntfs.img</code>, and if you want to keep the conversion you can delete
this to free up space.</p>
<p dir="auto">Although I believe this tool to be stable, please note that I take no
responsibility if something goes awry!</p>
<p dir="auto">You&#39;re probably also interested in <a href="https://github.com/maharmstone/btrfs">WinBtrfs</a>,
which is a Btrfs filesystem driver for Windows.</p>
<p dir="auto">Thanks to <a href="https://github.com/ebiggers">Eric Biggers</a>, who <a href="https://github.com/ebiggers/ntfs-3g-system-compression/">successfully reverse-engineered</a> Windows 10&#39;s
&#34;WOF compressed data&#34;, and whose code I&#39;ve used here.</p>
<h2 dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Usage</h2>
<p dir="auto">On Windows, from an Administrator command prompt:</p>
<p dir="auto"><code>ntfs2btrfs.exe D:\</code></p>
<p dir="auto">Bear in mind that it won&#39;t work with your boot drive or a drive containing a
pagefile that&#39;s currently in use.</p>
<p dir="auto">On Linux, as root:</p>
<p dir="auto"><code>ntfs2btrfs /dev/sda1</code></p>
<h2 dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installation</h2>
<p dir="auto">On Windows, go to the <a href="https://github.com/maharmstone/ntfs2btrfs/releases">Releases page</a> and
download the latest Zip file.</p>
<p dir="auto">For Linux:</p>
<ul dir="auto">
<li><a href="https://aur.archlinux.org/packages/ntfs2btrfs-git" rel="nofollow">Arch</a> (thanks to <a href="https://github.com/nicman23">nicman23</a>)</li>
<li><a href="https://src.fedoraproject.org/rpms/ntfs2btrfs" rel="nofollow">Fedora</a> (thanks to <a href="https://github.com/Conan-Kudo">Conan-Kudo</a>)</li>
<li><a href="https://raw.githubusercontent.com/maharmstone/ntfs2btrfs/master/ntfs2btrfs-20210923.ebuild" rel="nofollow">Gentoo ebuild</a></li>
<li><a href="https://sid.ethz.ch/debian/ntfs2btrfs/" rel="nofollow">Debian &amp; Ubuntu</a> (thanks to <a href="https://github.com/alexmyczko">alexmyczko</a>)</li>
</ul>
<p dir="auto">For other distributions or operating systems, you will need to compile it yourself - see
below.</p>
<h2 dir="auto"><a id="user-content-changelog" aria-hidden="true" href="#changelog"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Changelog</h2>
<ul dir="auto">
<li>
<p dir="auto">20210923</p>
<ul dir="auto">
<li>Added (Btrfs) compression support (zlib, lzo, and zstd)</li>
<li>Added support for other hash algorithms: xxhash, sha256, and blake2</li>
<li>Added support for rolling back to NTFS</li>
<li>Added support for NT4-style security descriptors</li>
<li>Increased conversion speed for volume with many inodes</li>
<li>Fixed bug when fragmented file was in superblock location</li>
<li>Fixed buffer overflow when reading security descriptors</li>
<li>Fixed bug where filesystems would be corrupted in a way that <code>btrfs check</code> doesn&#39;t pick up</li>
</ul>
</li>
<li>
<p dir="auto">20210523</p>
<ul dir="auto">
<li>Improved handling of large compressed files</li>
</ul>
</li>
<li>
<p dir="auto">20210402 (source code only release)</p>
<ul dir="auto">
<li>Fixes for compilation on non-amd64 architectures</li>
</ul>
</li>
<li>
<p dir="auto">20210105</p>
<ul dir="auto">
<li>Added support for NTFS compression</li>
<li>Added support for &#34;WOF compressed data&#34;</li>
<li>Fixed problems caused by sparse files</li>
<li>Miscellaneous bug fixes</li>
</ul>
</li>
<li>
<p dir="auto">20201108</p>
<ul dir="auto">
<li>Improved error handling</li>
<li>Added better message if NTFS is corrupted or unclean</li>
<li>Better handling of relocations</li>
</ul>
</li>
<li>
<p dir="auto">20200330</p>
<ul dir="auto">
<li>Initial release</li>
</ul>
</li>
</ul>
<h2 dir="auto"><a id="user-content-compilation" aria-hidden="true" href="#compilation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Compilation</h2>
<p dir="auto">On Windows, open the source directory in a recent version of MSVC, right-click
on CMakeLists.txt, and click Compile.</p>
<p dir="auto">On Linux:</p>

<p dir="auto">You&#39;ll also need <a href="https://github.com/fmtlib/fmt">libfmt</a> installed - it should be
in your package manager.</p>
<p dir="auto">Compression support requires zlib, lzo, and/or zstd - again, they will be in your
package manager. See also the cmake options WITH_ZLIB, WITH_LZO, and WITH_ZSTD,
if you want to disable this.</p>
<h2 dir="auto"><a id="user-content-what-works" aria-hidden="true" href="#what-works"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>What works</h2>
<ul dir="auto">
<li>Files</li>
<li>Directories</li>
<li>Symlinks</li>
<li>Other reparse points</li>
<li>Security descriptors</li>
<li>Alternate data streams</li>
<li>DOS attributes (hidden, system, etc.)</li>
<li>Rollback to original NTFS image</li>
</ul>
<h2 dir="auto"><a id="user-content-what-doesnt-work" aria-hidden="true" href="#what-doesnt-work"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>What doesn&#39;t work</h2>
<ul dir="auto">
<li>Windows&#39; old extended attributes (you&#39;re not using these)</li>
<li>Large (i.e &gt;16KB) ADSes (you&#39;re not using these either)</li>
<li>Preservation of LXSS metadata</li>
<li>Preservation of the case-sensitivity flag</li>
<li>Unusual cluster sizes (i.e. not 4 KB)</li>
<li>Encrypted files</li>
</ul>
<h2 dir="auto"><a id="user-content-can-i-boot-windows-from-btrfs-with-this" aria-hidden="true" href="#can-i-boot-windows-from-btrfs-with-this"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Can I boot Windows from Btrfs with this?</h2>
<p dir="auto">Yes, if the stars are right. See <a href="https://github.com/maharmstone/quibble">Quibble</a>.</p>
</article>
        </div></div>
  </body>
</html>
