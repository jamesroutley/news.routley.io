<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.jhaddix.com/post/stealing-checks-worth-millions-pwning-a-bank">Original</a>
    <h1>Stealing checks worth millions and pwning a bank</h1>
    
    <div id="readability-page-1" class="page"><div data-hook="post-description"><article><div><div><div><div data-rce-version="8.71.11"><div dir="ltr" data-id="rich-content-viewer"><div><div id="viewer-f32to"><div><div data-hook="imageViewer" role="button" tabindex="0"><div><p><img data-pin-url="https://www.jhaddix.com/post/stealing-checks-worth-millions-pwning-a-bank" data-pin-media="https://static.wixstatic.com/media/abefef_9487bbdc01ed4bbe8d6ce8c6b023eac2~mv2.png/v1/fit/w_1000%2Ch_1000%2Cal_c,enc_auto/file.png" src="https://static.wixstatic.com/media/abefef_9487bbdc01ed4bbe8d6ce8c6b023eac2~mv2.png/v1/fill/w_1000,h_960,al_c,usm_0.66_1.00_0.01/abefef_9487bbdc01ed4bbe8d6ce8c6b023eac2~mv2.png" width="1219" height="1170"/></p></div></div></div></div><p id="viewer-emtet"><span>Another long (hacker) story of mine!

Once upon a time contracted to do a penetration test on a bank…

I spent the better part of a week assessing every nook and cranny of the main web application. I mapped every function, and every web path, but the main website was very hardened. </span></p><p id="viewer-8htgj"><span>After spending a lot of time understanding it, most of the makeup of the transfer system was API based and the infrastructure was AWS.  I decided to open up the mobile application to see if it was any different and if its functions were on the same domain. </span></p><p id="viewer-br9c1"><span>I proxied the iOS app through a proxy to see its web traffic.  I also was running the app on a jailbroken phone to see what files were created when installing and using the app.  Nowadays you can proxy your <a data-hook="linkViewer" href="https://www.e-spincorp.com/burp-suite-professional-for-mobile-application-security-testing/" target="_blank" rel="noopener noreferrer"><u>mobile apps like this</u></a><u>.</u>

The 1st issue I found was because of a new feature many banks were launching at that time:   </span></p><p id="viewer-f9qj"><span><strong>depositing checks by taking an image of them  </strong></span></p><p id="viewer-8qtli"><span>When using this function the app was storing these images in folders on the phone that were readable by other apps (shared storage).

This was bad.  Using URL schemes in different popular apps that were allowed to access shared storage, I wrote a proof of concept piece of JavaScript that could steal these check images and send them back to myself.

It would be easier though to use the bank itself’s domain in these attacks.  I lucked out and found a Cross-Site Scripting bug on one API endpoint that was not returning a json content type, and reflecting my input.  The previous attack was now much easier.</span></p><p id="viewer-1o90f"><span>I was so obsessed with this vulnerability, I almost missed the most simple vulnerability:   The server where the check images were eventually uploaded to had insecure AWS permissions.  I could just use AWS tools to retrieve all the checks of clients.   For this you can use tools like:  </span></p><p id="viewer-5squo"><span><a data-hook="linkViewer" href="https://t.co/3JfshXERcj" target="_blank" rel="noopener noreferrer">https://github.com/gwen001/s3-buckets-finder…</a>  </span></p><p id="viewer-671cr"><span>and   </span></p><p id="viewer-8485o"><span><a data-hook="linkViewer" href="https://t.co/kD4i0txSHB" target="_blank" rel="noopener noreferrer">https://github.com/sa7mon/S3Scanner…</a>  </span></p><p id="viewer-59tkb"><span>The “checks” feature had one more vulnerability.   The app was renaming the images to a predictable name, like:  </span></p><p id="viewer-5is0j"><span>IMG2758973.png  </span></p><p id="viewer-e28vk"><span>Even if AWS permissions had been not wide open you could have requested:   IMG2758974.png or IMG2758972.png   To get someone else’s check image. 

So let&#39;s review, I had:</span></p><ul><li id="viewer-5lum3"><p>Written a worm that could have taken the check images from people&#39;s phones</p></li><li id="viewer-cv2g8"><p>Found that I could have just taken all 2 million check images from AWS</p></li><li id="viewer-81svr"><p>I had XSS on their main domain because of a misconfiguration in the mobile API</p></li></ul><p id="viewer-90o9i"><span>When being able to see all the files a mobile app creates, you can review its data stores.   Hardcoded in a plist file was a credential for user. I had no idea for what login though. I wrote it down for later. 

During all this app analysis I was running my recon scripts in the background.   Tools like </span></p><p id="viewer-b8vfq"><span><a data-hook="linkViewer" href="https://twitter.com/owaspamass" target="_blank" rel="noopener noreferrer">@owaspamass</a>  and <a data-hook="linkViewer" href="https://github.com/projectdiscovery/subfinder" target="_blank" rel="noopener noreferrer"><u>subfinder</u></a> to find subdomains.   And <a data-hook="linkViewer" href="https://github.com/ffuf/ffuf" target="_blank" rel="noopener noreferrer"><u>ffuf</u></a> or <a data-hook="linkViewer" href="https://github.com/epi052/feroxbuster" target="_blank" rel="noopener noreferrer"><u>feroxbuster</u></a> for directory/file brute force.   </span></p><p id="viewer-c3gbq"><span>One interesting thing you can do with Amass is specify an <a data-hook="linkViewer" href="https://en.wikipedia.org/wiki/Autonomous_system_(Internet)" target="_blank" rel="noopener noreferrer"><u>Autonomous System Number</u></a> to retrieve domains inside of that IP space. </span></p><p id="viewer-fituv"><span>Something like:   </span></p><pre id="viewer-3amd3"><span>Amass intel <span>-</span>asn bigbanksASN  </span></pre><p id="viewer-4eerd"><span>This came back with a domain that I had never seen before.   The regular domain was something like: </span></p><pre id="viewer-70edt"><span>http<span>:</span><span>/</span><span>/</span>redactedbigbank<span>.</span>com</span></pre><p id="viewer-9jq4k"><span>The new one found was something like: </span></p><pre id="viewer-3of62"><span>http<span>:</span><span>/</span><span>/</span>RedactedbigbankCWI<span>.</span>com</span></pre><p id="viewer-7kq7s"><span>Scanning this domain for subdomains and hosts revealed even more surface area to hack.   Eventually, I ended up finding several blank page websites in this set of hosts. </span></p><p id="viewer-6r4ff"><span>Some were asking for basic authentication. So I supplied the username and password from the mobile app plist file.  It worked!  </span></p><blockquote id="viewer-b93pa"><span><em><strong>The web app was so sensitive in nature I can’t really even describe the contents, but it was a big find by itself.</strong></em></span></blockquote><p id="viewer-3ooeh"><span>
In addition, on that web server, I ended up having access to   </span></p><pre id="viewer-2hgho"><span><span>/</span>manager<span>/</span>html   </span></pre><p id="viewer-9f0vv"><span>Which is a server-level administration endpoint for Tomcat.   The credentials I had once again worked. I followed my normal Tomcat hacking methodology and was able to get a reverse shell on the box. For security testers, something <a data-hook="linkViewer" href="https://vk9-sec.com/apache-tomcat-manager-war-reverse-shell/" target="_blank" rel="noopener noreferrer"><u>like this</u></a> is the normal process for hacking Tomcat endpoints like that.</span></p><div id="viewer-4rl92"><div><div data-hook="imageViewer" role="button" tabindex="0"><div><p><img data-pin-url="https://www.jhaddix.com/post/stealing-checks-worth-millions-pwning-a-bank" data-pin-media="https://static.wixstatic.com/media/abefef_3d4efd9499dc46c4914f4c73ce8396c4~mv2.png/v1/fit/w_833%2Ch_352%2Cal_c,enc_auto/file.png" src="https://static.wixstatic.com/media/abefef_3d4efd9499dc46c4914f4c73ce8396c4~mv2.png/v1/fill/w_833,h_352,al_c/abefef_3d4efd9499dc46c4914f4c73ce8396c4~mv2.png" width="833" height="352"/></p></div></div></div></div><p id="viewer-8780l"><span><em><span>(example, not a real IP)</span></em></span></p><p id="viewer-farn5"><span>At this point, I was out of time but I was confident I could have moved laterally into the bank&#39;s network and gotten more.   It was a fun test.   If you want more hacker story threads like this;   like, follow, and retweet <a data-hook="linkViewer" href="https://twitter.com/Jhaddix/status/1512229133622734849" target="_blank" rel="noopener noreferrer"><u>here </u></a>!</span></p></div></div></div></div></div></div></article></div></div>
  </body>
</html>
