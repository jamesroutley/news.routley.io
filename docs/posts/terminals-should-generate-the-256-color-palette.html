<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/jake-stewart/0a8ea46159a7da2c808e5be2177e1783">Original</a>
    <h1>Terminals should generate the 256-color palette</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div id="file-color256-md">
      
      <div id="file-color256-md-readme" tabindex="0" role="region" aria-label="color256.md content, created by jake-stewart on 10:10AM on February 03.">
    <article itemprop="text"><p dir="auto">Terminals should generate the 256-color palette from the user&#39;s
base16 theme.</p>
<p dir="auto">If you&#39;ve spent much time in the terminal, you&#39;ve probably set a
custom base16 theme. They work well. You define a handful of colors
in one place and all your programs use them.</p>
<p dir="auto">The drawback is that 16 colors is limiting. Complex and color-heavy
programs struggle with such a small palette.</p>
<p dir="auto">The mainstream solution is to use truecolor and gain access to 16
million colors. But there are drawbacks:</p>
<ul dir="auto">
<li>Each truecolor program needs its own theme configuration.</li>
<li>Changing your color scheme means editing multiple config files.</li>
<li>Light/dark switching requires explicit support from program maintainers.</li>
<li>Truecolor escape codes are longer and slower to parse.</li>
<li>Fewer terminals support truecolor.</li>
</ul>
<p dir="auto">The 256-color palette sits in the middle with more range than base16
and less overhead than truecolor. But it has its own issues:</p>
<ul dir="auto">
<li>The default theme clashes with most base16 themes.</li>
<li>The default theme has poor readability and inconsistent contrast.</li>
<li>Nobody wants to manually define 240 additional colors.</li>
</ul>
<p dir="auto">The solution is to generate the extended palette from your existing
base16 colors. You keep the simplicity of theming in one place while
gaining access to many more colors.</p>
<p dir="auto">If terminals did this automatically then terminal program maintainers
would consider the 256-color palette a viable choice, allowing them
to use a more expressive color range without requiring added
complexity or configuration files.</p>
<div dir="auto"><h2 dir="auto">Understanding the 256-Color Palette</h2><a id="user-content-understanding-the-256-color-palette" aria-label="Permalink: Understanding the 256-Color Palette" href="#understanding-the-256-color-palette"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The 256-color palette has a specific layout.  If you are already
familiar with it, you can skip to the next section.</p>

<p dir="auto">The first 16 colors form the base16 palette. It contains black,
white, and all primary and secondary colors, each with normal and
bright variants.</p>
<ol start="0" dir="auto">
<li>black</li>
<li>red</li>
<li>green</li>
<li>yellow</li>
<li>blue</li>
<li>magenta</li>
<li>cyan</li>
<li>white</li>
<li>bright black</li>
<li>bright red</li>
<li>bright green</li>
<li>bright yellow</li>
<li>bright blue</li>
<li>bright magenta</li>
<li>bright cyan</li>
<li>bright white</li>
</ol>

<p dir="auto">The next 216 colors form a 6x6x6 color cube. It works like 24-bit
RGB but with 6 shades per channel instead of 256.</p>
<p dir="auto">You can calculate a specific index using this formula, where R, G,
and B range from 0 to 5:</p>
<pre><code>16 + (36 * R) + (6 * G) + B
</code></pre>

<p dir="auto">The final 24 colors form a grayscale ramp between black and white.
Pure black and white themselves are excluded since they can be found
in the color cube at (0, 0, 0) and (5, 5, 5).</p>
<p dir="auto">You can calculate specific index using this formula, where S is the
shade ranging from 0 to 23:</p>
<pre><code>232 + S
</code></pre>
<div dir="auto"><h2 dir="auto">Problems with the 256-Color Palette</h2><a id="user-content-problems-with-the-256-color-palette" aria-label="Permalink: Problems with the 256-Color Palette" href="#problems-with-the-256-color-palette"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>

<p dir="auto">The most obvious problem with the 256-color palette is the inconsistency
with the user&#39;s base16 theme:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/inconsistent.png"><img src="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/inconsistent.png" alt="inconsistent theme"/></a></p>
<p dir="auto">Using a custom 256-color palette gives a more pleasing result:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/consistent.png"><img src="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/consistent.png" alt="consistent theme"/></a></p>

<p dir="auto">The default 216-color cube interpolates between black and each color
incorrectly. It is shifted towards lighter shades (37% intensity
for the first non-black shade as opposed to the expected 20%), causing
readability issues when attempting to use dark shades as background:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/poor-readability-1.png"><img src="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/poor-readability-1.png" alt="poor readability example"/></a></p>
<p dir="auto">If the color cube is instead interpolated correctly, readability
is preserved:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/fixed-readability-1.png"><img src="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/fixed-readability-1.png" alt="fixed readability example"/></a></p>

<p dir="auto">The default 256-color palette uses fully saturated colors, leading
to inconsistent brightness against the black background. Notice
that blue always appears darker than green, despite having the same
shade:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/poor-readability-2.png"><img src="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/poor-readability-2.png" alt="poor readability example"/></a></p>
<p dir="auto">If a less saturated blue is used instead then the consistent
brightness is preserved:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/fixed-readability-2.png"><img src="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/fixed-readability-2.png" alt="fixed readability example"/></a></p>

<p dir="auto">These problems can be solved by generating the 256-color palette
from the user&#39;s base16 colors.</p>
<p dir="auto">The base16 palette has 8 normal colors which map to the 8 corners
of the 216-color cube. The terminal foreground and background should
be used instead of the base16 black and white.</p>
<p dir="auto">These colors can be used to construct the 216-color cube via trilinear
interpolation, and the grayscale ramp with a simple background to
foreground interpolation.</p>
<p dir="auto">The LAB colorspace should be used to achieve consistent apparent
brightness across hues of the same shade.</p>
<p dir="auto"><strong>Solarized with RGB interpolation:</strong></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/without-lab.png"><img src="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/without-lab.png" alt="without lab"/></a></p>
<p dir="auto"><strong>Solarized with LAB interpolation:</strong></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/with-lab.png"><img src="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/with-lab.png" alt="with lab"/></a></p>
<p dir="auto">Combined image of many generated themes:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/example.png"><img src="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/example.png" alt="example generated themes"/></a></p>
<p dir="auto">Before and after using 256 palette generation with default colors:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/before_after.png"><img src="https://raw.githubusercontent.com/jake-stewart/color256/refs/heads/main/writeup/before_after.png" alt="example before and after"/></a></p>

<p dir="auto">This code is public domain, intended to be modified and used anywhere
without friction.</p>
<div dir="auto"><pre><span>def</span> <span>lerp_lab</span>(<span>t</span>, <span>lab1</span>, <span>lab2</span>):
    <span>return</span> (
        <span>lab1</span>[<span>0</span>] <span>+</span> <span>t</span> <span>*</span> (<span>lab2</span>[<span>0</span>] <span>-</span> <span>lab1</span>[<span>0</span>]),
        <span>lab1</span>[<span>1</span>] <span>+</span> <span>t</span> <span>*</span> (<span>lab2</span>[<span>1</span>] <span>-</span> <span>lab1</span>[<span>1</span>]),
        <span>lab1</span>[<span>2</span>] <span>+</span> <span>t</span> <span>*</span> (<span>lab2</span>[<span>2</span>] <span>-</span> <span>lab1</span>[<span>2</span>]),
    )

<span>def</span> <span>generate_256_palette</span>(<span>base16</span>, <span>bg</span><span>=</span><span>None</span>, <span>fg</span><span>=</span><span>None</span>):
    <span>base8_lab</span> <span>=</span> [<span>rgb_to_lab</span>(<span>c</span>) <span>for</span> <span>c</span> <span>in</span> <span>base16</span>[:<span>8</span>]]
    <span>bg_lab</span> <span>=</span> <span>rgb_to_lab</span>(<span>bg</span>) <span>if</span> <span>bg</span> <span>else</span> <span>base8_lab</span>[<span>0</span>]
    <span>fg_lab</span> <span>=</span> <span>rgb_to_lab</span>(<span>fg</span>) <span>if</span> <span>fg</span> <span>else</span> <span>base8_lab</span>[<span>7</span>]

    <span>palette</span> <span>=</span> [<span>*</span><span>base16</span>]

    <span>for</span> <span>r</span> <span>in</span> <span>range</span>(<span>6</span>):
        <span>c0</span> <span>=</span> <span>lerp_lab</span>(<span>r</span> <span>/</span> <span>5</span>, <span>bg_lab</span>, <span>base8_lab</span>[<span>1</span>])
        <span>c1</span> <span>=</span> <span>lerp_lab</span>(<span>r</span> <span>/</span> <span>5</span>, <span>base8_lab</span>[<span>2</span>], <span>base8_lab</span>[<span>3</span>])
        <span>c2</span> <span>=</span> <span>lerp_lab</span>(<span>r</span> <span>/</span> <span>5</span>, <span>base8_lab</span>[<span>4</span>], <span>base8_lab</span>[<span>5</span>])
        <span>c3</span> <span>=</span> <span>lerp_lab</span>(<span>r</span> <span>/</span> <span>5</span>, <span>base8_lab</span>[<span>6</span>], <span>fg_lab</span>)
        <span>for</span> <span>g</span> <span>in</span> <span>range</span>(<span>6</span>):
            <span>c4</span> <span>=</span> <span>lerp_lab</span>(<span>g</span> <span>/</span> <span>5</span>, <span>c0</span>, <span>c1</span>)
            <span>c5</span> <span>=</span> <span>lerp_lab</span>(<span>g</span> <span>/</span> <span>5</span>, <span>c2</span>, <span>c3</span>)
            <span>for</span> <span>b</span> <span>in</span> <span>range</span>(<span>6</span>):
                <span>c6</span> <span>=</span> <span>lerp_lab</span>(<span>b</span> <span>/</span> <span>5</span>, <span>c4</span>, <span>c5</span>)
                <span>palette</span>.<span>append</span>(<span>lab_to_rgb</span>(<span>c6</span>))

    <span>for</span> <span>i</span> <span>in</span> <span>range</span>(<span>24</span>):
        <span>t</span> <span>=</span> (<span>i</span> <span>+</span> <span>1</span>) <span>/</span> <span>25</span>
        <span>lab</span> <span>=</span> <span>lerp_lab</span>(<span>t</span>, <span>bg_lab</span>, <span>fg_lab</span>)
        <span>palette</span>.<span>append</span>(<span>lab_to_rgb</span>(<span>lab</span>))

    <span>return</span> <span>palette</span></pre></div>

<p dir="auto">The default 256-color palette has room for improvement. Considering
its poor readability and its clash with the user&#39;s theme, program
authors avoid it, opting for the less expressive base16 or more
complex truecolor.</p>
<p dir="auto">Terminals should generate the 256-color palette from the user&#39;s
base16 theme. This would make the palette a viable option especially
considering its advantages over truecolor:</p>
<ul dir="auto">
<li>Access to a wide color palette without needing config files.</li>
<li>Light/dark switching capability without developer effort.</li>
<li>Broader terminal support without compatibility issues.</li>
</ul>
</article>
  </div>

  </div>

</div></div>
  </body>
</html>
