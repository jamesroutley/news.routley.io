<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://factorio.com/blog/post/fff-371">Original</a>
    <h1>Factorio runs on Apple Silicon</h1>
    
    <div id="readability-page-1" class="page"><div>
        <p>Hello, engineers! I&#39;m a newer face at Wube and have been mainly working on expansion content for about one year now.
  Today, I&#39;m here to share some exciting non-expansion news for our Mac players.</p>

<hr/>
<h3>Factorio Runs on Apple Silicon</h3>

<p>As of version 1.1.71, Factorio runs natively on Apple Silicon Macs! On these machines, the game should run faster and
  use less energy than in previous versions. You can see which binary version you are running in the top-left corner of
  the main menu.</p>

<div>
  <div>
    <p><img src="https://cdn.factorio.com/assets/img/blog/fff-371-version-x64.png"/></p><p><i>
      x86_64 binary for Intel Macs
    </i></p>
  </div>
  <div>
    <p><img src="https://cdn.factorio.com/assets/img/blog/fff-371-version-arm.png"/></p><p><i>
      arm64 binary for Apple Silicon Macs ðŸ¥³
    </i></p>
  </div>
</div>

<p>This has been a long time coming, but we were never in a good position to implement these improvements... until
  now.</p>

<h4>Motivation</h4>

<p>In February, I traveled from the USA to the Wube offices in Prague for the first time. While waiting in the airport, I
  decided to work on Factorio with my Intel Macbook Pro. Within 30 minutes, my laptop&#39;s battery had depleted more than
  half of its charge. I had a 22-hour day ahead of me, many more hours of travel planned this year, and a lot of work to
  do.</p>

<p>I immediately ordered an Apple Silicon MacBook from my seat in the airport.</p>

<p>When it arrived, I was instantly impressed with its battery life. I can now comfortably work on Factorio wherever I
  am. More importantly, the factory can grow wherever I am. But I wasn&#39;t satisfied. As a software engineer and Factorio
  engineer, I had to ask myself: can I play Factorio for <i>even longer</i> with native Apple Silicon support?</p>

<h4>Development</h4>

<p>The first problem to solve was multiplayer determinism. Ensuring that the arm64 and x86_64 versions of Factorio
  behaved identically is critical for multiplayer to function. Luckily at the time, Twinsen was already developing a
  port for Nintendo Switch <a href="https://factorio.com/blog/post/fff-370">(FFF-370)</a> and shared with me his plans to support
  cross-platform play. So I didn&#39;t need to worry about this for now.
</p>

<p>The development of the port for Nintendo Switch was super-confidential. Not even the community members who had access
  to Factorio&#39;s source code were permitted to know. So, to avoid leaking the fact that the port was being developed, I
  postponed working on this project until after the announcement. On October 19th, the time was right to start again.
</p>

<p>Next, we needed to update our macOS build process. Our process hadn&#39;t been reviewed for years. It contained a few
  time-consuming steps that were difficult to port for ARM architectures, and it was using outdated compiler versions.
  With some trial-and-error, I rewrote and simplified Factorio&#39;s Mac build instructions, and reduced the time to set up a
  clean Mac for Factorio development from a few hours to a few minutes (depending on the Internet connection).</p>

<p>With a more streamlined, standardized build process, I set to work updating our build rules to support ARM. This part
  was simple; they were already structured to support multiple architectures, so I simply added the ARM architecture
  alongside the x86-64 architecture and fixed a few broken flags. I threw in a few new build rules for generating a
  universal macOS binary (which was extremely easy), and soon we had a functioning version of Factorio that ran natively
  on both Apple Silicon and Intel Macs!</p>

<p>The final challenge was deployment. Our macOS build server uses an x86-64 CPU, so I needed to figure out how to
  compile both the x86-64 and the arm64 versions of Factorio on a single x86-64 machine. Our compilers and linkers
  worked just fine, but obtaining the C++ libraries for ARM was surprisingly more difficult than it needed to be. After
  a lot of experimenting, I found the steps that worked most consistently and wrote a custom BASH script that downloads
  and manually &#34;installs&#34; the arm64 C++ libraries from Homebrew. This is the most hacky part of the whole process, but
  most developers will never need to do this.</p>

<p>In total, it took about 4 weeks to investigate, develop, test, finalize, and deploy the new macOS build process.</p>

<h4>Performance Improvements</h4>

<p>After we had a functioning universal binary, we ran benchmarks and conducted manual tests to see what improved.</p>

<p>We ran benchmarks on 3 different Apple Silicon machines, using the same compiled release binary and run settings. We
  used the famous
  <a href="https://factoriobox.1au.us/map/info/4c5f65003d84370f16d6950f639be1d6f92984f24c0240de6335d3e161705504">flame_Sla
    10k</a>
  map and averaged our results. Here is a summary of our findings:
</p>

<p>
  <img width="100%" src="https://cdn.factorio.com/assets/img/blog/fff-371-ups-graph.png"/>
</p>

<p>
  Overall, we observed that the arm64 version of Factorio performed 19%-25% better in our
  benchmarks than the x86_64 version.
</p>

<p>We even compared runs between macOS 10.13.6 High Sierra, 12.6.1 Monterey, and 13.0 Ventura. We observed no notable
  performance difference between these OS versions. The differences we observed were all less than 10% and did not consistently
  favor any particular version.</p>

<p>In addition to running benchmarks, I did a couple very unscientific tests on my laptop (MacBook Pro 14-inch 2021, Apple M1 Max, 64 GB)
to check FPS and energy consumption:
</p><ul>
  <li><b>x86_64</b>: Average FPS: 37; Energy Impact: 5,270</li>
  <li><b>arm64</b>: Average FPS: 45; Energy Impact: 4,545</li>
</ul>


<p><SPAN size="2">*Energy Impact is calculated by
    <a href="https://support.apple.com/en-gb/guide/activity-monitor/actmntr43697/mac">Activity Monitor</a> and is
    purportedly &#34;a relative measure of the current energy consumption of the app (lower is better)&#34;.</SPAN></p>

<p>
  These results â€” although not as precise â€” are similar to the benchmarks. The arm64 version&#39;s FPS was about 20% higher
  and energy impact was about 15% lower than that of the x86_64 version.
</p>

<p>
  These results are exciting, and are definitely better than what I had hoped for! Individual experiences may differ, but
  so far, players have reported an overall improvement in performance.
</p>

<h4>Shoutouts</h4>

<p>
  My thanks to colleague Therenas, community member Xorimuth, and others with source access for help
  with troubleshooting and testing the new builds; to colleague Sanqui for his help and patience in updating our
  deployment machines; and of course to Twinsen for his excellent work on ARM support.
</p>

<h4>Conclusion</h4>

<p>Last weekend, I charged my Macbook to full and opened the mega base our team built during our most recent expansion
  play-through. I set to work fixing manufacturing problems and troubleshooting logistic issues, expanding the factory,
  and building defenses. I got lost in the glorious mess we&#39;d built for three and a half hours before needing to
  recharge, and my game ran at a comfortable 60 FPS the entire time.</p>

<p>Factorio players have a lot of bottlenecks to contend with when building a Factory. Hopefully now, their laptop&#39;s
  battery is one less bottleneck they need to worry about.</p>

<p>See you next time!</p>

        

        
    </div></div>
  </body>
</html>
