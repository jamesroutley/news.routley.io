<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://maxleiter.com/blog/node-has-tooling-problems">Original</a>
    <h1>The Node ecosystem still has tooling problems</h1>
    
    <div id="readability-page-1" class="page"><div><article><p><span>Jul 30, 2022<!-- --> </span></p><div><p>I recently published a <a href="https://github.com/maxleiter/sortablejs-vue3" target="_blank" rel="noopener noreferrer">small npm package</a> containing a Vue library. The package is written in TypeScript powered by Vite, which I (wrongly) assumed would mediate most of my woes. </p>
<p><img loading="lazy" src="https://maxleiter.com/blog/node-tooling/obiwan.gif" alt="Obi Wan gif of him sarcastically saying &#34;Oh, this is going to be easy&#34;" layout="fill"/></p>
<p>First, I used Vite to build a small front-end site to demonstrate the library. This let me test the component and demonstrate usage in the same repository. Getting this working was fairly straight forward for someone with experience wrangling TypeScript configurations, but I imagine for a less experienced developer it could&#39;ve been a daunting task. I ended up with two tsconfigs, <code>tsconfig.node.json</code> and <code>tsconfig.site.json</code>, had to figure out module resolution, realized I needed <code>vue-tsc</code>, and had a multitude of other minor roadblocks. The nicest thing about Vite is it is <em>fast</em>, which made working on this manageable.</p>
<p>Second, I had to figure out how to publish a library. After lots of research (AKA reading Reddit threads and blog posts), I figured out the proper incantation of <code>tsc</code> parameters, <code>package.json</code> options, and tsconfigs to get something almost functional by channeling the Unix Magic wizard:</p>
<p><img src="https://maxleiter.com/blog/node-tooling/unix-poster.jpg" alt="Unix Magic poster, a wizard crafting a potion surrounded by ingredients named after Unix tools" height="500"/></p><p> I added a *third* tsconfig, <code>tsconfig.dist.json</code> (that also extends <code>tsconfig.node.json</code>), added a new <code>vite.config.ts</code> for distribution (which required special options for passing to rollup), and I added something like the following to my package.json:</p>
<pre><code><p><span>&#34;types&#34;</span><span>:</span><span> </span><span>&#34;./dist/types/main.d.ts&#34;</span><span>,</span><span></span></p><p><span>  </span><span>&#34;files&#34;</span><span>:</span><span> </span><span>[</span><span></span></p><p><span>    </span><span>&#34;dist&#34;</span><span></span></p><p><span>  </span><span>]</span><span>,</span><span></span></p><p><span>  </span><span>&#34;main&#34;</span><span>:</span><span> </span><span>&#34;./dist/sortablejs-vue3.umd.js&#34;</span><span>,</span><span></span></p><p><span>  </span><span>&#34;module&#34;</span><span>:</span><span> </span><span>&#34;./dist/sortablejs-vue3.es.js&#34;</span><span>,</span><span></span></p><p><span>  </span><span>&#34;exports&#34;</span><span>:</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>&#34;.&#34;</span><span>:</span><span> </span><span>{</span><span></span></p><p><span>      </span><span>&#34;import&#34;</span><span>:</span><span> </span><span>&#34;./dist/sortablejs-vue3.es.js&#34;</span><span>,</span><span></span></p><p><span>      </span><span>&#34;require&#34;</span><span>:</span><span> </span><span>&#34;./dist/sortablejs-vue3.umd.js&#34;</span><span></span></p><p><span>    </span><span>}</span><span></span></p><p><span>  </span><span>}</span><span>,</span></p></code></pre><p>The next thing I did was establish some tooling. I set-up Prettier with an npm script to format my code (which requires two new configuration files), a GitHub bot for updating dependencies (which requires a configuration file), and Vercel for deploying the demo site. Someone later submit a pull request for auto-publishing to npm when new tags are pushed, which required a <code>.github/</code> directory to be made. </p>
<p>Now I was ready to release the library! Or so I thought: for some reason, <code>.github/</code> was being included in the package contents. After some digging, I found I needed to add an <code>.npmignore</code>, something I&#39;ve done in the past but forgot about. Thankfully, using it again caused me to remember that npm defaults to using your <code>.gitignore</code>, and when you add an npmignore it <em>no longer does!</em> I copied the contents of my <code>.gitignore</code> over and added a line for <code>.github</code>.   </p>
<p>Finally, I had a publishable library!</p>
<p>You can see the code at <a href="https://github.com/MaxLeiter/sortablejs-vue3" target="_blank" rel="noopener noreferrer">https://github.com/MaxLeiter/sortablejs-vue3</a>, and I hope it&#39;s helpful to anyone looking to publish something similar in the future.</p>
</div></article></div></div>
  </body>
</html>
