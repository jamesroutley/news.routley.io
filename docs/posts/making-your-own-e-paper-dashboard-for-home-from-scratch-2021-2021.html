<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lengrand.fr/complete-setup-epaper/">Original</a>
    <h1>Making your own e-paper dashboard for home from scratch (2021) (2021)</h1>
    
    <div id="readability-page-1" class="page"><div>
				<p><strong>In the few coming minutes, you will read about epaper screens, raspberry pi, node, web components, tailwindcss, open-wc, netlify and more :).</strong></p><p>This article is quite long so for once I&#39;ll create a few pointers with TL;DR every time :)</p><ul><li><a href="https://lengrand.fr/complete-setup-epaper/#the-hardware-"><strong>The hardware</strong></a></li><li><a href="https://lengrand.fr/complete-setup-epaper/#the-screen">-&gt; the screen</a></li><li><a href="https://lengrand.fr/complete-setup-epaper/#the-computer-">-&gt; the computer</a></li><li><a href="https://lengrand.fr/complete-setup-epaper/#the-os">-&gt; the OS</a></li><li><a href="https://lengrand.fr/complete-setup-epaper/#the-software"><strong>The software</strong></a></li><li><a href="https://lengrand.fr/complete-setup-epaper/#the-backend">-&gt; the &#39;backend&#39;</a></li><li><a href="https://lengrand.fr/complete-setup-epaper/#the-frontend">-&gt; the frontend</a></li><li><strong><a href="https://lengrand.fr/complete-setup-epaper/#additional-thoughts-and-remarks-">Some remarks</a></strong></li></ul><hr/><p>It&#39;s the second time I create a dashboard for my house. We are working hard on reducing our carbon emissions. Tracking energy usage as well as making food plans is a very good way to do just that. </p><p>This time, <strong>I wanted my dashboard to be built with an e-paper screen, to avoid the ugly backlight of a tablet, and reduce energy consumption</strong>. Here is the final product : </p><figure><img src="https://lengrand.fr/content/images/2021/02/image-21.png" alt="" loading="lazy"/><figcaption>The complete e-paper dasbboard setup</figcaption></figure><p><strong>In this post, I&#39;ll tell you all about how it&#39;s built, and how you can do it too. I won&#39;t describe everything, but point you to relevant documentations I followed. I&#39;ll also share tips and tricks.</strong></p><h2 id="the-hardware-">The hardware! </h2><p><strong>TL;DR: Get a Waveshare screen, a Raspberry Pi and follow <a href="https://www.waveshare.com/7.5inch-e-paper-hat.htm">instructions</a>.</strong></p><p>As any good physical product, everything starts with the hardware :). If you want to build the same dashboard, you&#39;ll need:</p><ul><li><a href="https://www.waveshare.com/7.5inch-e-paper.htm">A waveshare 7.5 inch screen (with UAT)</a></li><li><a href="https://www.raspberrypi.org/products/raspberry-pi-zero/">A raspberry Pi zero</a></li><li><a href="https://www.amazon.com/TUOFENG-Wire-Solid-different-colored-spools/dp/B07TX6BX47/ref=sr_1_34?dchild=1&amp;keywords=Soldering+Wire&amp;qid=1614031046&amp;sr=8-34">A bunch of soldering cables</a></li><li><a href="https://www.amazon.de/Lego-10698-Classic-Gro%C3%9Fe-Bausteine-Box/dp/B00PY3EYQO/ref=sxin_9_ac_d_rm?__mk_de_DE=%C3%85M%C3%85%C5%BD%C3%95%C3%91&amp;ac_md=2-2-bGVnbyBzdGVpbmU%3D-ac_d_rm&amp;cv_ct_cx=lego&amp;dchild=1&amp;keywords=lego&amp;pd_rd_i=B00PY3EYQO&amp;pd_rd_r=5eae0c54-ccbb-4a6f-9244-769b32337e2a&amp;pd_rd_w=XXCMe&amp;pd_rd_wg=iso2P&amp;pf_rd_p=54ea5632-6b46-46db-836f-bc13df6ca6a4&amp;pf_rd_r=G3WK7JTERFGJYNVQRKGG&amp;psc=1&amp;qid=1614031248&amp;sr=1-3-fe323411-17bb-433b-b2f8-c44f2e1370d4">Some lego :)</a></li></ul><p>Total is about 70€, everything included.</p><h3 id="the-screen">The screen</h3><p>I am using this <a href="https://www.waveshare.com/wiki/7.5inch_e-Paper_HAT">7.5 inch 2 colors screen from Waveshare</a>. My initial plan was to go for a <a href="https://www.waveshare.com/wiki/9.7inch_e-Paper_HAT">9.7inch with gray levels</a>, but I had no experience at all with that hardware so I went for the safer, 50$, solution.</p><p>The first good news is that the screen is CRAZY thin, here is a photo to give you an idea : </p><figure><img src="https://lengrand.fr/content/images/2021/02/image-25.png" alt="" loading="lazy"/><figcaption>A photo of the e-ink screen from the side</figcaption></figure><p>When buying an e-paper screen, here are the things you want to look for : </p><ul><li><strong>Refresh time</strong>. One of the cons of having an e-ink screen is that refreshes usually take a while. If you want performance, also look whether partial refreshes are available. Here is a video of mine so you get an idea:</li></ul><figure><blockquote><p lang="en" dir="ltr">It updates every 5 minutes and that&#39;s what a refresh looks like in case you wonder : <a href="https://t.co/PjW4CS4rXp">pic.twitter.com/PjW4CS4rXp</a></p>— Julien Lengrand-Lambert (@jlengrand) <a href="https://twitter.com/jlengrand/status/1362321332516585480?ref_src=twsrc%5Etfw">February 18, 2021</a></blockquote>

</figure><ul><li><strong>Resolution</strong>. e-ink screen of higher resolution are still quite expensive (compared to a tablet). Depending on what you want to do with the screen, you might end up with artifacts. A nice font will help you there, but it won&#39;t do miracles either. For example, this is what my dashboard looked like before I put my text in bold. You can clearly see the artifacts : </li></ul><figure><img src="https://lengrand.fr/content/images/2021/02/image-22.png" alt="" loading="lazy"/><figcaption>A photo of the screen with text missing due to resolution</figcaption></figure><ul><li><strong>Gray levels</strong>. My screen is two colors ( essentially, ink or no ink). Some other screen have 16 gray levels. Some others even have color. You may	 want to choose one of those but remember that it will cost you in refresh time or price. </li><li><strong>Driver board</strong>. We&#39;ll talk more about this soon but be aware that not all screen come with connectors and a driver board. If you don&#39;t know what I am talking about, be careful buying a HAT version, otherwise you won&#39;t be able to use the screen : </li></ul><figure><img src="https://lengrand.fr/content/images/2021/02/image-23.png" alt="" loading="lazy"/><figcaption>A photo of the screen with driver board</figcaption></figure><h3 id="the-computer-">The &#39;computer&#39;</h3><p>This post will be using a Raspberry Pi. Note that the Waveshare screens have a pretty extensive <a href="https://www.waveshare.com/wiki/7.5inch_e-Paper_HAT">documentation</a> so you can also go for Arduino or even the Jatson nano if you fancy it.</p><p>Just to be clear, I am using a Raspberry Pi Zero W in my build, so you don&#39;t need crazy amounts of power to run it. </p><p><strong>If you&#39;re afraid of soldering, I recommend you use the B version of the Raspberry</strong> because the driver board from Waveshare can directly clip on the GPIO : </p><figure><img src="https://lengrand.fr/content/images/2021/02/image-24.png" alt="" loading="lazy"/><figcaption>Driver Board connected to a Raspberry Pi model B</figcaption></figure><p>As I mentioned, I decided to go for a Raspberry Pi Zero W for two reasons : </p><ul><li>The form factor is much smaller, which allows for a super small setup together with the screen</li><li>The Zero goes for 10$, which is close to nothing! </li></ul><p>In case you go for the 0 like me, you&#39;ll have to solder a few cables. Don&#39;t be afraid though, everything is <a href="https://www.waveshare.com/wiki/7.5inch_e-Paper_HAT">described here</a>. All you need is the table below together with the Raspberry GPIO. </p><figure><img src="https://lengrand.fr/content/images/2021/02/image-26.png" alt="" loading="lazy"/><figcaption>GPIO correspondances of the R Pi Zero</figcaption></figure><figure><img src="https://lengrand.fr/content/images/2021/02/image-27.png" alt="" loading="lazy"/><figcaption>Where to solder each pin</figcaption></figure><p>Once you&#39;ve done that, you&#39;re pretty much good to go! Find a 5V adapter and power up your Raspberry Pi! The nice thing is that your screen will feed off the Raspberry so you need only one alimentation. We&#39;re ready to move to phase 2!</p><h3 id="the-os">The OS</h3><p>I&#39;ve decided to keep this in the hardware part, because I don&#39;t have much to say. What we will want to do on our Raspberry Pi is install a default OS that is not too old. <a href="https://www.raspberrypi.org/software/operating-systems/">You can create and flash one here</a> by following the instructions.</p><p>The next thing you want to do is follow all the instructions described <a href="https://www.waveshare.com/wiki/7.5inch_e-Paper_HAT">in the default Waveshare setup</a>. Again, they are very well done so I don&#39;t have much to add but if you have any issue feel free to drop me a message.</p><p>In case you need to setup WiFi for your Raspberry Pi, <a href="https://www.raspberrypi.org/documentation/configuration/wireless/wireless-cli.md">here is the guide I used</a>!</p><p>You will enable SPI, install the necessaries libraries and download the library and test code from Waveshare. I tested with Python.</p><p>In case you have the same screen as I do, you will want to run the <code>epd_7in5_V2_test.py</code> script located in <code>waveshare/e-Paper/RaspberryPi_JetsonNano/python/examples/</code>! If all goes according to plan and you&#39;ve soldered everything correctly, your screen will wake up!</p><h2 id="the-software">The software</h2><p><strong>TL;DR: Use <a href="https://github.com/samsonmking/epaper.js">epaper.js</a> on the Pi, created a service around it and serve static content in the static folder :).</strong></p><p>Our screen is awake, and we have a linux to work with! Time to start creating our dashboard! </p><p>I have made use of the amazing <a href="https://github.com/samsonmking/epaper.js">epaper.js</a> project to create my dashboard. The project is insanely useful. In short, it runs a static website locally and projects it on the screen using puppeteer. </p><p>This has a huge advantage : you only have to create a website and then deploy it on the device! <strong>You can find the complete code for the front and back end of the project <a href="https://github.com/jlengrand/epaper-dashboard-blog">here on Github</a>. And the website is available <a href="https://epaper-dashboard-blog.netlify.app/">at any time on Netlify</a>.</strong></p><p>The project is composed of two parts, which live in the same repository. </p><ul><li>The root repository that contains the code that will run on the Raspberry Pi, &#39;the backend&#39;</li><li>The <code>epaper-ui</code>folder, which will contain our actual dashboard, the &#39;frontend&#39;.</li></ul><p>Let&#39;s dive into each of the parts, but first, a word of warning: </p><p>Epaper.js  can only be run on the raspberry. Indeed, it depends on native libraries (the GPIO drivers) that do not exist on your computer :). Not a problem, just something to be aware of (For example, don&#39;t set a CI on your project on Github).</p><p>Conversely, the latest version of Node that I could run on my raspberry is version 10.x, which means that I could not run the frontend code on it. Again, not a problem; just something to be aware of. </p><p>What that means is simply that I have been developing the frontend on my computer, and the backend only on the pi.</p><p>Now that it&#39;s clear, let&#39;s go!</p><h3 id="the-frontend">The frontend</h3><p>This part is the easiest to talk about. Keep in mind that for your own project, you can use any technology that suits you. The only requirement you have is that the result of your build lands in the <code>static</code> folder of the repository to be picked up by the backend. </p><p>Here is the current deployed frontend :</p><figure><img src="https://lengrand.fr/content/images/2021/02/image-31.png" alt="" loading="lazy"/><figcaption>Latest version of the frontend, in the web form</figcaption></figure><p>I decided to use Web Components, and my website is based on top of <a href="https://lit-element.polymer-project.org/guide/properties">LitElement</a> and <a href="https://tailwindcss.com/">TailwindCSS</a>. I used the excellent <a href="https://open-wc.org/">open-wc</a> library to generate my project skeleton in Typescript. Those are personal choices, you may well choose anything you like. </p><p>I picked these because by using Web Components I had very little to learn on top of the basic capabilities of HTML. Thanks to tailwind I also didn&#39;t have to learn much CSS :). My knowledge is limited in the front-end, having a simple syntax, a boring technological choice and no build-chain seemed like a perfect deal. No need to screw around with Webpack &lt;3!</p><p>Another good thing is that because I am basically only building a website, I could use <a href="https://www.netlify.com/">Netlify</a> as a platform to see the results of my work. And gosh I love their product!</p><p>Some things to note : </p><ul><li><a href="https://lengrand.fr/a-simple-setup-to-use-litelement-with-tailwindcss-for-small-projects/">I wrote a short article on how to easily use tailwind together with LitElement</a></li><li>Since it is a personal dashboard, I needed personal data. I leave it up to you to decide where to fetch your data from. The easiest for us to sync up with the girlfriend is Google Spreadsheets :).<a href="https://lengrand.fr/fetching-google-calendar-data-without-oauth-the-hacky-way/"> I wrote a whole blog post</a> about how to do that to sync calendars and avoid having to use Oauth2. In short, you can publish your spreadsheets online as CSV files. I do that and then ingest the data to create my dashboard. The great thing is that the CSV files are always up to date! </li></ul><p>I created my whole dashboard by using <code>$ npm start</code> in the <code>epaper-ui</code> folder, running <code>$npm build</code> every time I was happy with the result. That pushed the built version in the <code>static</code> folder of my project and sent it over to Github. By pulling the repository on my raspberry, I can make sure to always have the latest version of the dashboard.</p><p>Again, you can <a href="https://github.com/jlengrand/epaper-dashboard-blog/tree/main/epaper-ui">check the source code</a> here, and the <a href="https://epaper-dashboard-blog.netlify.app/">resulting dashboard over here</a>. </p><p>One last thing I want to mention before moving on is the way I refresh my dashboard :). The epaper.js examples <a href="https://github.com/samsonmking/epaper.js/tree/master/examples/weather-station">has an example with data that updates</a>. <strong>However</strong>, that data updates from the backend to the frontend. In my application, all the data is pulled from the internet via the frontend, which means that I cannot use the same mechanism. </p><p>To solve this problem, I make use of a very old capability of HTML itself to tell the page to refresh itself after very few minutes : </p><figure><img src="https://lengrand.fr/content/images/2021/02/image-30.png" alt="" loading="lazy"/><figcaption>Tells the page to refresh every 60 seconds.</figcaption></figure><p>Depending on how you build your own dashboard, you may not be concerned by this.</p><h3 id="the-backend">The backend</h3><p>Naming that part &#39;the backend&#39; makes it seem like I&#39;ve done a whole lot of work but I&#39;ve really only been piggybacking on the great work done by <a href="https://github.com/samsonmking/epaper.js">epaper.js</a>.</p><p>Let me show you the integral content of my &#39;backend&#39; code :</p><figure><img src="https://lengrand.fr/content/images/2021/02/image-28.png" alt="" loading="lazy"/><figcaption>Two lines of code, only calling the epaper.js init</figcaption></figure><p>Yep, the only thing I did was call the epaper.js library and pick the device I am using. (Be careful, in case you use another model of Waveshare display you will have to change that value).</p><p>That is enough for the content of the static folder to be successfully displayed on the screen :). </p><p>Now, you might be expecting a few more things coming up. And you&#39;d be right...</p><p>The first time I ran my dashboard ( <code>$node index.js</code> ) and logged off the SSH connection, I got a little surprise : the application stopped. Of course, I had to run it in the background.</p><p>However, it is not directly possible, because epaper.js supports stdin inputs (for buttons or keyboards). I looked around and decided to comment out the lines of code that handle stdin :). To do this, you can go on your clone of the project on the raspberry and in <code>node_modules/epaperjs/index.js</code>. You want to comment out the following line in the init function: </p><figure><img src="https://lengrand.fr/content/images/2021/02/image-29.png" alt="" loading="lazy"/><figcaption>Disabling the setupKeyInput method</figcaption></figure><p>There are cleaner ways, but that works for now.</p><p>Once that works, the next thing to do is to make it start automatically at boot of the raspberry. I have created a service for that. It comes in two parts: </p><ul><li>the <code>dashboard.js</code> file in the root of the project.</li><li>the <code>dashboard.service</code> file in the service folder of the project. To activate it, you want to follow <a href="https://www.shubhamdipt.com/blog/how-to-create-a-systemd-service-in-linux/">the typical way to create a new service Linux</a>. (careful, you want to make sure that the location of dashboard.js in the file is correct for your system!).</li></ul><p><strong>Et voilà! Your dashboard now runs automagically on boot of the raspberry and can be started and stopped on demand. </strong></p><h2 id="additional-thoughts-and-remarks-"> Additional thoughts and remarks: </h2><ul><li>One thing that got me a few times is that an e-paper screen literally works by projecting ink on the screen. Once the ink is there, it won&#39;t go way by itself. This means that even when the raspberry is off, the data sticks to the screen. I got tricked a few times by this :).</li><li>Depending on the resolution of your screen, you may see artifacts on the screen. Choosing a newspaper font can help there. There is a <a href="https://www.reddit.com/r/archlinux/comments/736xx4/which_fonts_do_you_find_render_best_on_regular_or/">good Reddit thread</a> about this.</li></ul><p>Overall, I&#39;m extremely happy about the result of this side project and the choices I&#39;ve made. Picking epaper.js, open-wc and tailwind has helped tremendously to iterate fast and be productive. Having a simple website that I can work with and deploy on Netlify at any time has been a tremendous help. </p><p>It was also great fun to build this project with the family. The gilfriend was responsible of the design of the dashboard as well as the data, I built it while my 4 year old did the casing.</p><p>Because I don&#39;t need the interactions capabilities of epaper.js, I probably could get rid of the websockets altogether in the project and pull the website directly from the web instead of running it locally. That would be very interesting, because then <strong>I would automatically get the latest version of the dashboard every time I push a new version to Netlify. To be continued....</strong></p><p>Take care! If you have thoughts or questions, <strong><strong>you can find me <a href="https://twitter.com/jlengrand/">on Twitter</a>.</strong></strong></p>
			</div></div>
  </body>
</html>
