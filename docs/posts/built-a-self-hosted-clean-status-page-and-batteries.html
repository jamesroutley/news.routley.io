<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/rajnandan1/kener">Original</a>
    <h1>Show HN: Built a self hosted clean status page and batteries</h1>
    
    <div id="readability-page-1" class="page"><div><p>Emacs is made to be modified. One of my skeptical colleagues said the fact that Emacs has state scares him, but I think it’s one of its strengths (and why it has endured).</p>
<h4 id="the-problem"><a href="#the-problem" aria-label="the problem permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>The Problem</h4>
<p>I started doing some Ruby and Rails review over the holidays and had just finished configuring Emacs for Ruby usage. While spinning up my Ruby project, Emacs became unresponsive and wouldn’t open the <span><code>.rb</code></span> file I needed to get into. It would hang without any additional CPU usage (confirmed by <span><code>htop</code></span>), but none of the keybindings worked. I initially thought that something with the new packages for working with Ruby, but it became evident this was much more insidious. Upon rebooting Emacs, I couldn’t open <em>any</em> files without the application hanging..</p>
<h4 id="a-red-herring"><a href="#a-red-herring" aria-label="a red herring permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>A Red Herring</h4>
<p>I use <a href="https://github.com/doomemacs/doomemacs" target="_blank" rel="nofollow noopener noreferrer">Doom Emacs</a> because it’s really easy to set up and configure, and for me it had significant performance improvements over Spacemacs (I build Emacs with native compilation, which Doom supports). The suggested troubleshooting for the framework starts with running <span><code>$ doom doctor</code></span>, which yielded a few expected warning and no errors.</p>
<p>However, I did get the following line printed after exiting the process (<span><code>Ctrl-C</code></span>)</p>
<p><span><div data-language="text"><pre><code>/var/folders/hc/${weird_hash}/T//doom.3016.0.sh: line 1: #!/usr/bin/env: No such file or directory</code></pre></div></span></p><p>I started troubleshooting on the Recurse Center Zulip (which has a very active Emacs user group), and someone else confirmed that they got the same line printed after exiting doom doctor with their working installation of Emacs. This seemed to me like it wasn’t actually a problem so I cast my net wider…</p>
<h4 id="nuke-it-from-orbit-its-the-only-way-to-be-sure"><a href="#nuke-it-from-orbit-its-the-only-way-to-be-sure" aria-label="nuke it from orbit its the only way to be sure permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Nuke It From Orbit (It’s the only way to be sure)</h4>
<p>I decided to save my <span><code>~/.config/doom</code></span> files and start over. I wiped my Emacs installation, and reinstalled and upgraded Emacs to 29.1 using</p>
<p><span><div data-language="text"><pre><code>$ brew install emacs-plus@29 --with-native-compilation`</code></pre></div></span></p><p>I then reinstalled Doom Emacs with</p>
<p><span><div data-language="text"><pre><code>$ git clone --depth 1 --single-branch https://github.com/doomemacs/doomemacs ~/.config/emacs
~/.config/emacs/bin/doom install</code></pre></div></span></p><p>I opened Emacs with the fresh install and tried to open the <span><code>init.el</code></span> file and it hung. again.</p>
<h4 id="binary-troubleshooting"><a href="#binary-troubleshooting" aria-label="binary troubleshooting permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Binary Troubleshooting</h4>
<p>Doom emacs <span><code>init.el</code></span> file comes with a few modules enabled by default. To continue to troubleshoot this, I started toggling and untoggling modules until I finally discovered that the <span><code>vc</code></span> version control module was the culprit for the hanging process upon opening any file.</p>
<h4 id="doom-emacs-help"><a href="#doom-emacs-help" aria-label="doom emacs help permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Doom Emacs Help</h4>
<p>While I’d used the debugger within Emacs, it had always been in a situation where hitting <span><code>Ctrl-G</code></span> enough would exit the process (and I could just use <span><code>toggle-debug-on-error</code></span> or <span><code>debug-on-entry</code></span>). Other recursers suggested I take a look at the Doom Emacs discord, which led me to the following <a href="https://discourse.doomemacs.org/t/what-is-a-backtrace-how-to-produce-them/85" target="_blank" rel="nofollow noopener noreferrer">discourse about backtracing</a>, including a section on backtracing <a href="https://discourse.doomemacs.org/t/what-is-a-backtrace-how-to-produce-them/85#from-frozen-emacs-5" target="_blank" rel="nofollow noopener noreferrer">from frozen Emacs</a>!</p>
<p>I was able to set <span><code>debug-on-entry</code></span> for <span><code>find-file</code></span> if the <span><code>vc</code></span> module was installed, found the active Emacs process number, and ran <span><code>$ kill -USR2 $EMACSPID</code></span>. Lo, I finally generated a backtrace!</p>
<h4 id="the-real-problem"><a href="#the-real-problem" aria-label="the real problem permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>The Real Problem</h4>
<p>So I knew that with the <span><code>vc</code></span> module enabled and running <span><code>find-file</code></span>, Emacs would hang. I also discovered that running any <span><code>magit</code></span> command would also hang <em>with</em> the <span><code>vc</code></span> module disabled. I was able to open files, just not run <span><code>magit</code></span>. Some recursers suggested that I compare the backtraces for the two processes and discovered both had <span><code>call-process(&#34;/opt/homebrew/bin/gpg&#34; nil...</code></span>, which suggested the issue was actually with <span><code>gpg</code></span>.</p>
<p>It turned out I had an expired <span><code>gpg</code></span> key, and command line troubleshooting for <span><code>gpg</code></span> just kept generating lockfiles. I removed the keys, and <em>finally</em> Emacs worked as expected!</p>
<p>While killing an Emacs process without killing Emacs is now in my org file, I’ll probably forget all the other steps it took to get here, so I thought it was important to write down for posterity!</p></div></div>
  </body>
</html>
