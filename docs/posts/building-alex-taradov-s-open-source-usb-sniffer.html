<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.downtowndougbrown.com/2023/08/building-alex-taradovs-open-source-usb-sniffer/">Original</a>
    <h1>Building Alex Taradov’s open-source USB sniffer</h1>
    
    <div id="readability-page-1" class="page"><div>
				
<p>A couple of months ago I stumbled upon <a rel="noreferrer noopener" href="https://hackaday.com/2023/06/13/cheap-usb-sniffer-has-wireshark-interface/" target="_blank">a post on Hackaday</a> about an inexpensive <a rel="noreferrer noopener" href="https://github.com/ataradov/usb-sniffer" target="_blank">open-source USB 2.0 sniffer</a> created by <a rel="noreferrer noopener" href="https://taradov.com/" target="_blank">Alex Taradov</a>. This is a really cool project! Normally, USB sniffers like this can cost thousands of dollars, especially if you’re paying for fancy protocol decoding and also want high-speed 480 Mbps support. This one costs about $50 in parts to assemble yourself, although it will take hours to solder and you will need some experience with hot air (or reflow oven) soldering since the USB PHY is a QFN chip with an exposed pad underneath.</p>



<p>I actually have an Ellisys USB Tracker 110b that I bought on eBay many years ago, but it only does low-/full-speed decoding. I thought this would be a good opportunity to upgrade my capabilities to also be able to handle high-speed USB sniffing, while also providing some good soldering practice.</p>



<p>Here’s my (very long) video about the process of building up one of these and programming it. I left in all the mistakes I made along the way. Why not show the world that it’s normal to make dumb mistakes when you build stuff?</p>



<figure><p>
<iframe title="Building and testing Alex Taradov&#39;s USB Sniffer" width="500" height="281" src="https://www.youtube.com/embed/YL3ZzR47SxE?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
</p></figure>



<p>I thought I’d use this post to explain in a little more detail what exactly a USB sniffer is. Why would I buy (or make) a hardware USB sniffer when Wireshark already has software USBPcap support in Windows?</p>



<p>The answer to that question is complicated, but the bottom line is that for many needs, USB packet capture inside your operating system works perfectly fine and you don’t have to buy a hardware sniffer. People use software USB packet capture methods to reverse-engineer USB drivers all the time.</p>



<p>Where hardware sniffers come in handy is if you’re a firmware developer who is <a rel="noreferrer noopener" href="https://www.downtowndougbrown.com/2018/12/usb-mass-storage-with-embedded-devices-tips-and-quirks/" data-type="post" data-id="1157" target="_blank">diagnosing a problem with a USB device or host you’re creating</a>, or maybe you’re a driver developer working on a driver for a USB host controller. You need to see exactly what’s happening on the USB data wires to make sure that every packet looks correct. Perhaps you suspect your device’s firmware has a bug where the DATA0/1 toggle isn’t behaving as it should. Or maybe you just want to learn more about USB and how it works under the hood. Software USB capture mechanisms like USBPcap don’t show you every individual low-level packet, but you really need to see them in the situations I described above.</p>



<p>You could always just hook an oscilloscope or logic analyzer up to the D+ and D- lines and decode the packets yourself by looking at the waveform:</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2023/08/DS1Z_QuickPrint4.png" target="_blank" rel="noreferrer noopener"><img decoding="async" loading="lazy" src="https://www.downtowndougbrown.com/wp-content/uploads/2023/08/DS1Z_QuickPrint4.png" alt="" width="600" height="360" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2023/08/DS1Z_QuickPrint4.png 800w, https://www.downtowndougbrown.com/wp-content/uploads/2023/08/DS1Z_QuickPrint4-300x180.png 300w, https://www.downtowndougbrown.com/wp-content/uploads/2023/08/DS1Z_QuickPrint4-768x461.png 768w" sizes="(max-width: 600px) 100vw, 600px"/></a></figure>



<p>I guarantee that would get old really fast. You would also need a pretty fancy oscilloscope or logic analyzer in order to decode 480 Mbps high-speed traffic while also having enough memory to record everything you want to see. Nobody actually does that though.</p>



<p>This is exactly where hardware USB sniffers come into play. They are essentially specialized logic analyzers that only know how to decode USB traffic. They do one thing, and they do that one thing very well: record raw USB traffic and stream it to your computer as fast as possible.</p>



<p>The other thing that’s nice about hardware USB sniffers is you can sniff a <em>different</em> USB host’s traffic. Let’s say I want to figure out how a TiVo talks to its USB to Wi-Fi adapter. OK, that might be a bit of a dated reference. What am I thinking? It’s the 2020s. Let me try coming up with a more modern scenario instead: maybe I want to see how a Nintendo Switch talks to a keyboard I’ve plugged in. Or how an <a rel="noreferrer noopener" href="https://www.downtowndougbrown.com/2017/05/connecting-an-ios-device-to-an-ethernet-network/" data-type="post" data-id="1073" target="_blank">iPhone talks to a USB-Ethernet adapter</a>. Hardware sniffers, including Alex’s, are capable of doing this because the computer capturing the sniffed data can be different from the computer/device that is actually performing the USB communication.</p>



<p>The really cool thing about this sniffer is that it integrates with Wireshark. You can make use of protocol decoders already built into Wireshark for interpreting USB packets, as well as its fancy filtering capability. Ellisys devices, in comparison, use a proprietary USB analysis program. <a rel="noreferrer noopener" href="https://www.ellisys.com/products/usbex200/buy.php" target="_blank">Protocol decoding is unlocked for an extra charge of thousands of dollars</a>.</p>



<figure><a href="https://www.downtowndougbrown.com/wp-content/uploads/2023/08/wireshark.png" target="_blank" rel="noreferrer noopener"><img decoding="async" loading="lazy" src="https://www.downtowndougbrown.com/wp-content/uploads/2023/08/wireshark-1024x555.png" alt="" width="512" height="278" srcset="https://www.downtowndougbrown.com/wp-content/uploads/2023/08/wireshark-1024x555.png 1024w, https://www.downtowndougbrown.com/wp-content/uploads/2023/08/wireshark-300x163.png 300w, https://www.downtowndougbrown.com/wp-content/uploads/2023/08/wireshark-768x416.png 768w, https://www.downtowndougbrown.com/wp-content/uploads/2023/08/wireshark-1536x832.png 1536w, https://www.downtowndougbrown.com/wp-content/uploads/2023/08/wireshark.png 1920w" sizes="(max-width: 512px) 100vw, 512px"/></a></figure>



<p>I’m not here to criticize Ellisys, Total Phase, and Teledyne LeCroy though. I get it. These are very fancy tools and the cost is probably not a big deal to a company that can already afford to build USB devices and go through all of the necessary certifications. Heck, the cost of one of those analyzers is likely worth it just for the support you get from the company. However, I want everyone else to know that there are cheaper alternatives out there. If you’re making USB devices for fun on your own time as a hobbyist, you probably already know how to solder anyway, and there are solutions out there that won’t break the bank. Thanks for making such a cool project and releasing it as open source, Alex!</p>
			  
			</div></div>
  </body>
</html>
