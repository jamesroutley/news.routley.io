<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lwn.net//Articles/959067/">Original</a>
    <h1>Microdot: A Web Framework for Microcontrollers</h1>
    
    <div id="readability-page-1" class="page"><div>
<center>
           <div><b>Benefits for LWN subscribers</b><p>The primary benefit from <a href="https://lwn.net/subscribe/">subscribing to LWN</a>
       is helping to keep us publishing, but, beyond that, subscribers get
       immediate access to all site content and access to a number of extra
       site features.  Please sign up today!</p></div>
           </center>
           
<p>
There are many different Python <a href="https://wiki.python.org/moin/WebFrameworks">web frameworks</a>, from
nano-frameworks all the way up to the full-stack variety.  One that
recently caught my eye is <a href="https://github.com/miguelgrinberg/microdot">Microdot</a>, the
&#34;<q>impossibly small web framework for Python and MicroPython</q>&#34;; since
it 
targets <a href="https://micropython.org/">MicroPython</a>, it is
plausible for running the user 
interface of an &#34;internet of things&#34; (IoT) device, for example.  Beyond
that, it is <a href="https://flask.palletsprojects.com/en/3.0.x/">Flask</a>-inspired,
which should make it reasonably familiar to many potential web
developers. 
</p>

<p>
Microdot was created by Miguel Grinberg, who also created the well-known <a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">Flask
Mega-Tutorial</a> that has served as the introduction to the Flask web
framework for many people.  While Flask is considered to be a
microframework, it still requires a full 
CPython environment to run; another Python microframework described
alongside Flask in a <a href="https://lwn.net/Articles/792882/">2019 LWN article</a>, <a href="https://bottlepy.org/docs/dev/">Bottle</a>, has similar needs.
Microdot came about because Grinberg <a href="https://blog.miguelgrinberg.com/post/microdot-yet-another-python-web-framework">wanted
a framework for MicroPython</a> and did not find anything usable back in 2019.
</p>

<p>
MicroPython is a cut-down version of Python that is suitable for
microcontrollers; LWN <a href="https://lwn.net/Articles/931051/">looked at version 1.20</a> in May 2023.  There is a <a href="https://docs.micropython.org/en/latest/genrst/index.html">lengthy
list of differences</a> between MicroPython and CPython, but there is
enough overlap that Python—and web—programmers will feel right at home with
Microdot. Code can be moved back and forth, because Microdot can also run
under CPython, though, of course, MicroPython runs on regular CPUs 
as well.
</p>

<p>
As shown in Grinberg&#39;s announcement blog post, a canonical &#34;hello world&#34;
web application looks fairly straightforward:
</p><pre>    from microdot import Microdot

    app = Microdot()

    @app.get(&#39;/&#39;)
    async def index(request):
        return {&#39;hello&#39;: &#39;world&#39;}

    app.run(debug=True)
</pre>


<p>
The <tt>@app.get()</tt> decorator describes the URL to match and the
<tt>index()</tt> function returns data that is used as the response.  In this
case, returning a dictionary causes Microdot to format the response as
JSON; a status code or custom headers can be returned as the second and
third elements of a multi-value return. 
</p>

<p>
One thing that does stand out in the example is the
&#34;<tt>async def</tt>&#34; in the 
definition of <tt>index()</tt>. While Microdot 1.0, which was released
in August 2022, had a synchronous base with an <a href="https://docs.python.org/3/library/asyncio.html"><tt>asyncio</tt></a>
extension, Microdot 2.0, which was released in
December, is designed to be fully asynchronous. Regular
<tt>def</tt> can still be used with Microdot 2.0, but web-server
responsiveness will suffer on microcontrollers, which generally lack
threading support.  Instead, inside a handler defined with
<tt>async def</tt>, processing 
that requires I/O should be handled using 
<tt>await</tt>, rather than synchronously waiting for the operation to
return control.  Grinberg gave a <a href="https://lwn.net/Articles/726600/">talk on
asynchronous Python</a> at PyCon 2017 that may be of interest to readers
who are not familiar with the topic.
</p>

<p>
While Microdot is inspired by Flask, it is not beholden to it.  In
particular, Grinberg said that he liked the Flask <a href="https://flask.palletsprojects.com/en/3.0.x/blueprints/">Blueprints</a>
for modularizing web applications, but thought the Flask mechanism was too
complicated.  So Microdot has the concept of <a href="https://microdot.readthedocs.io/en/stable/intro.html#mounting-a-sub-application">&#34;mounting&#34;
sub-applications</a> at different points in the URL hierarchy.  As the
documentation shows, a <tt>customer_app</tt> and an <tt>orders_app</tt> can
be created in two separate files, which get imported into the main
application source file in order to create the full application with
something like: 
</p><pre>    def create_app():
        app = Microdot()
        app.mount(customers_app, url_prefix=&#39;/customers&#39;)
        app.mount(orders_app, url_prefix=&#39;/orders&#39;)
        return app
</pre>


<p>
That allows the functionality for customers and orders to be written as if
they are at
the top-level of the hierarchy, then they can be mounted where they should
actually 
appear; any reorganization would not require changes to the
sub-applications, just a different mount point, as long as relative URLs
are used within the sub-application code.
</p>

<p>
For rendering its pages, Microdot <a href="https://microdot.readthedocs.io/en/stable/extensions.html#rendering-templates">supports</a> the familiar <a href="https://jinja.palletsprojects.com/en/3.1.x/">Jinja templating
engine</a>, but only for CPython. For MicroPython, <a href="https://github.com/pfalcon/utemplate"><tt>utemplate</tt></a> can be
used and it will work on CPython too; it implements a simplified version
of the Jinja 
syntax.  Other <a href="https://microdot.readthedocs.io/en/stable/extensions.html">extensions</a>
provide WebSocket, secure user session, server-sent event (SSE), and other
functionality. 
</p>

<p>
In its most minimal configuration, Microdot clocks in at a little over 700
lines of code (plus comments and blank lines) in a single file; the full
configuration is a bit over double that in 11 files.  Grinberg contrasts
that with Flask and <a href="https://fastapi.tiangolo.com/">FastAPI</a>,
which both come in around ten times the number of lines of code when
including their main 
dependencies (<a href="https://werkzeug.palletsprojects.com/en/3.0.x/">Werkzeug</a> and <a href="https://www.starlette.io/">Starlette</a>, respectively).  Meanwhile,
the third-party dependencies for Microdot are minimal, as one might guess:
</p><blockquote>
The single-file minimal version does not require any dependencies at all,
and it even includes its own web server. Some of the optional features do
require third-party dependencies, and this is comparable to the larger
frameworks. Like Flask, you will need to add a templating library (Jinja or
uTemplate) to use templates. For user sessions, Microdot relies on PyJWT,
while Flask uses its own Itsdangerous package. 
</blockquote>


<p>
<a href="https://microdot.readthedocs.io/en/stable/extensions.html#deploying-on-a-production-web-server">Deploying
a web application</a> on MicroPython uses the built-in web server, but
CPython can use <a href="https://asgi.readthedocs.io/en/latest/">Asynchronous Server Gateway
Interface</a> (ASGI) servers or those that support its predecessor of
sorts: <a href="https://wsgi.readthedocs.io/en/latest/what.html">Web Server
Gateway Interface</a> (WSGI). TLS is also <a href="https://microdot.readthedocs.io/en/stable/intro.html#web-server-configuration">supported</a>
so serving can be done over HTTPS. There are several example programs using
each server type, and both template engines, linked from the
documentation.  While WSGI is a synchronous protocol, Microdot itself runs
in an <tt>asyncio</tt> event loop, so <tt>async def</tt> and
<tt>await</tt> <a href="https://microdot.readthedocs.io/en/stable/intro.html#concurrency">should
still be used</a>. 
</p>

<p>
Overall, Microdot looks like a nice option for new projects for
microcontrollers.  Grinberg specifically does not recommend that people
drop their current CPython framework in favor of Microdot, unless
they are unhappy with it or need to really eke out the memory savings that
Microdot can provide.  There are now multiple MicroPython web frameworks and
tools <a href="https://awesome-micropython.com/#web">listed</a> on the <a href="https://awesome-micropython.com/">Awesome MicroPython web site</a>,
so there are lots more options than what Grinberg found five years ago.  A
simple web application makes for an almost ideal interface to a headless,
network-connected device, so finding ways to make them easier to develop is
welcome.  From that perspective, Microdot is worth a look.
</p></div></div>
  </body>
</html>
