<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/ttesmer/948df432cf46ec6db8c1e83ab59b1b21">Original</a>
    <h1>Automatic Differentiation in 38 lines of Haskell</h1>
    
    <div id="readability-page-1" class="page"><p>
    Automatic Differentiation in 38 lines of Haskell using Operator Overloading and Dual Numbers. Inspired by conal.net/papers/beautiful-differentiation
  </p><div>
  <div id="file-example-md">
      
      <div id="file-example-md-readme">
    <article itemprop="text">
<p dir="auto">You can now differentiate (almost<sup><a href="#user-content-fn-1-11f38500a8b3d8cb10d696f79768d2a6" id="user-content-fnref-1-11f38500a8b3d8cb10d696f79768d2a6" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup>) any differentiable hyperbolic, polynomial, exponential, and/or trigonometric function.
Let&#39;s use the polynomial <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="11f38500a8b3d8cb10d696f79768d2a6">$f(x) = 2x^3 + 3x^2 + 4x + 2$</math-renderer>, whose straightforward derivative, <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="11f38500a8b3d8cb10d696f79768d2a6">$f&#39;(x) = 6x^2 + 6x + 4$</math-renderer>, can be used to verify the AD program.</p>
<div dir="auto"><pre>λ<span>&gt;</span> f x <span>=</span> <span>2</span> <span>*</span> x<span>^</span><span>3</span> <span>+</span> <span>3</span> <span>*</span> x<span>^</span><span>2</span> <span>+</span> <span>4</span> <span>*</span> x <span>+</span> <span>2</span> <span><span>--</span> our polynomial</span>
λ<span>&gt;</span> f <span>10</span>
<span>2342</span>
λ<span>&gt;</span> diff f <span>10</span> <span><span>--</span> evaluate df/dx with x=10</span>
<span>664.0</span>
λ<span>&gt;</span> <span>2</span><span>*</span><span>3</span> <span>*</span> <span>10</span><span>^</span><span>2</span> <span>+</span> <span>3</span><span>*</span><span>2</span> <span>*</span> <span>10</span> <span>+</span> <span>4</span> <span><span>--</span> verify derivative at 10</span>
<span>664</span></pre></div>
<p dir="auto">We can also compose functions:</p>
<div dir="auto"><pre>λ<span>&gt;</span> f x <span>=</span> <span>2</span> <span>*</span> x<span>^</span><span>2</span> <span>+</span> <span>3</span> <span>*</span> x <span>+</span> <span>5</span>
λ<span>&gt;</span> f2 <span>=</span> <span>tanh</span> <span>.</span> <span>exp</span> <span>.</span> <span>sin</span> <span>.</span> f
λ<span>&gt;</span> f2 <span>0.25</span>
<span>0.5865376368439258</span>
λ<span>&gt;</span> diff f2 <span>0.25</span>
<span>1.6192873</span></pre></div>
<p dir="auto">And differentiate high-dimensional functions, such as <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="11f38500a8b3d8cb10d696f79768d2a6">$f: \mathbb{R}^m \rightarrow \mathbb{R}^n$</math-renderer>, by doing manually what <code>diff</code> is doing:</p>
<div dir="auto"><pre>λ<span>&gt;</span> f x y z <span>=</span> <span>2</span> <span>*</span> x<span>^</span><span>2</span> <span>+</span> <span>3</span> <span>*</span> y <span>+</span> <span>sin</span> z        <span><span>--</span> f: R^3 -&gt; R</span>
λ<span>&gt;</span> f (<span>D</span> <span>3</span> <span>1</span>) (<span>D</span> <span>4</span> <span>1</span>) (<span>D</span> <span>5</span> <span>1</span>) <span>::</span> <span>Dual</span> <span>Float&#39;</span> <span><span>--</span> call `f` with dual numbers, set derivative to 1</span>
<span>D</span> <span>29.041077</span> <span>15.283662</span>
λ<span>&gt;</span> f x y z <span>=</span> (<span>2</span> <span>*</span> x<span>^</span><span>2</span>, <span>3</span> <span>*</span> y <span>+</span> <span>sin</span> z)       <span><span>--</span> f: R^3 -&gt; R^2</span>
λ<span>&gt;</span> f (<span>D</span> <span>3</span> <span>1</span>) (<span>D</span> <span>4</span> <span>1</span>) (<span>D</span> <span>5</span> <span>1</span>) <span>::</span> (<span>Dual</span> <span>Float&#39;</span>, <span>Dual</span> <span>Float&#39;</span>)
(<span>D</span> <span>18.0</span> <span>12.0</span>,<span>D</span> <span>11.041076</span> <span>3.2836623</span>)</pre></div>
<p dir="auto">Or get partial derivatives by setting only the sensitivities we want as dual numbers:</p>
<div dir="auto"><pre>λ<span>&gt;</span> f x y z <span>=</span> <span>2</span> <span>*</span> x<span>^</span><span>2</span> <span>+</span> <span>3</span> <span>*</span> y <span>+</span> <span>sin</span> z <span><span>--</span> f: R^3 -&gt; R</span>
λ<span>&gt;</span> f (<span>D</span> <span>3</span> <span>1</span>) <span>4</span> <span>5</span> <span>::</span> <span>Dual</span> <span>Float&#39;</span>
<span>D</span> <span>29.041077</span> <span>12.0</span></pre></div>
<p dir="auto">If you want to learn more about how this works, read the paper by Conal M. Elliott<sup><a href="#user-content-fn-2-11f38500a8b3d8cb10d696f79768d2a6" id="user-content-fnref-2-11f38500a8b3d8cb10d696f79768d2a6" data-footnote-ref="" aria-describedby="footnote-label">2</a></sup> or watch the talk, titled &#34;Provably correct, asymptotically efficient, higher-order reverse-mode automatic differentiation&#34; by Simon Peyton Jones himself<sup><a href="#user-content-fn-3-11f38500a8b3d8cb10d696f79768d2a6" id="user-content-fnref-3-11f38500a8b3d8cb10d696f79768d2a6" data-footnote-ref="" aria-describedby="footnote-label">3</a></sup>, or read their paper<sup><a href="#user-content-fn-4-11f38500a8b3d8cb10d696f79768d2a6" id="user-content-fnref-4-11f38500a8b3d8cb10d696f79768d2a6" data-footnote-ref="" aria-describedby="footnote-label">4</a></sup> by the same name.
There&#39;s also a package named <a href="https://hackage.haskell.org/package/ad" rel="nofollow"><code>ad</code></a> which implements this in a usable way. This gist is merely to understand the most basic form of it. Additionally, there&#39;s Andrej Karpathy&#39;s <a href="https://github.com/karpathy/micrograd">micrograd</a> written in Python.</p>

</article>
  </div>

  </div>
</div></div>
  </body>
</html>
