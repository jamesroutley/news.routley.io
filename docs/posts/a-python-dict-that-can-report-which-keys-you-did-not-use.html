<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.peterbe.com/plog/a-python-dict-that-can-report-which-keys-you-did-not-use">Original</a>
    <h1>A Python dict that can report which keys you did not use</h1>
    
    <div id="readability-page-1" class="page"><div id="main-content"><p>This can come in handy if you&#39;re working with large Python objects and you want to be certain that you&#39;re either unit testing everything you retrieve or certain that all the data you draw from a database is actually used in a report.</p>
<pre><code>
<span>class</span> <span>TrackingDict</span>(<span>dict</span>):
    <span>def</span> <span>__init__</span>(<span>self, *args, **kwargs</span>):
        <span>super</span>().__init__(*args, **kwargs)
        <span>self</span>._accessed_keys = <span>set</span>()

    <span>def</span> <span>__getitem__</span>(<span>self, key</span>):
        <span>self</span>._accessed_keys.add(key)
        <span>return</span> <span>super</span>().__getitem__(key)

<span>    @property</span>
    <span>def</span> <span>accessed_keys</span>(<span>self</span>):
        <span>return</span> <span>self</span>._accessed_keys

<span>    @property</span>
    <span>def</span> <span>never_accessed_keys</span>(<span>self</span>):
        <span>return</span> <span>set</span>(<span>self</span>.keys()) - <span>self</span>._accessed_keys
</code></pre>

<p>Example use case:</p>
<pre><code>
user = {
    <span>&#34;name&#34;</span>: <span>&#34;John Doe&#34;</span>,
    <span>&#34;age&#34;</span>: <span>30</span>,
    <span>&#34;email&#34;</span>: <span>&#34;jd@example.com&#34;</span>,
}
user = TrackingDict(user)
<span>assert</span> user[<span>&#34;name&#34;</span>] == <span>&#34;John Doe&#34;</span>

<span>print</span>(<span>&#34;Accessed keys:&#34;</span>, user.accessed_keys)
<span>print</span>(<span>&#34;Never accessed keys:&#34;</span>, user.never_accessed_keys)
</code></pre>

<p>This will print</p>
<pre><code>
Accessed keys: {&#39;name&#39;}
Never accessed keys: {&#39;email&#39;, &#39;age&#39;}
</code></pre>

<p>This can be useful if you have, for example, a <code>pytest</code> test that checks all the values of a dict object and you want to be sure that you&#39;re testing everything. For example:</p>
<pre><code>
<span>assert</span> <span>not</span> user.never_accessed_keys, <span>f&#34;You never checked <span>{user.never_accessed_keys}</span>&#34;</span>
</code></pre>

<p><strong>UPDATE (June 16)</strong></p>
<p>Here&#39;s a <strong>typed</strong> version, by commenter <strong>Michael Cook</strong>:</p>
<pre><code>
<span>from</span> typing <span>import</span> TypeVar, <span>Any</span>

K = TypeVar(<span>&#39;K&#39;</span>)
V = TypeVar(<span>&#39;V&#39;</span>)

<span>class</span> <span>TrackingDict</span>(<span>dict</span>[K, V]):
    <span>&#34;&#34;&#34;
    A `dict` that keeps track of which keys are accessed.
    &#34;&#34;&#34;</span>

    <span>def</span> <span>__init__</span>(<span>self, *args: <span>Any</span>, **kwargs: <span>Any</span></span>) -&gt; <span>None</span>:
        <span>super</span>().__init__(*args, **kwargs)
        <span>self</span>._accessed_keys: <span>set</span>[K] = <span>set</span>()

    <span>def</span> <span>__getitem__</span>(<span>self, key: K</span>) -&gt; V:
        <span>self</span>._accessed_keys.add(key)
        <span>return</span> <span>super</span>().__getitem__(key)

<span>    @property</span>
    <span>def</span> <span>accessed_keys</span>(<span>self</span>) -&gt; <span>set</span>[K]:
        <span>return</span> <span>self</span>._accessed_keys

<span>    @property</span>
    <span>def</span> <span>never_accessed_keys</span>(<span>self</span>) -&gt; <span>set</span>[K]:
        <span>return</span> <span>set</span>(<span>self</span>.keys()) - <span>self</span>._accessed_keys
</code></pre></div></div>
  </body>
</html>
