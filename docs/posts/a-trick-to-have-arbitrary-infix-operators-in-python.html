<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://tomerfiliba.com/blog/Infix-Operators/">Original</a>
    <h1>A trick to have arbitrary infix operators in Python</h1>
    
    <div id="readability-page-1" class="page"><div id="content-wrapper">
        <div id="content">

            
            
            
            
            
            <p><img src="http://imgs.xkcd.com/comics/rps.png" title="Thanks go to Oren Held; and XKCD, of course"/></p><p>As you may already know, there are 3 kinds of operators calling-notations: <strong>prefix</strong> (<code>+ 3 5</code>),
<strong>infix</strong> (<code>3 + 5</code>), and <strong>postfix</strong> (<code>3 5 +</code>). Prefix (as well as postfix) operators are used
in languages like LISP/Scheme, and have the nice property of not requiring parenthesis —
there’s only one way to read an expression like <code>3 5 + 2 *</code>, unlike <code>3 + 5 * 2</code>.
On the other hand, it reduces code readability and the locality of operators and their arguments.
This is why we all love infix operators.</p>

<p>Now imagine I have a function, <code>add(x,y)</code>, and I have an expression like <code>add(add(add(5,6),7),8)</code>...
wouldn’t it be cool if I could use infix notation here? Sadly though, Python won’t allow you to
define new operators or change how functions take their arguments... but that doesn’t
mean we have to give up!</p>

<p>Haskell, for instance, allows you to define custom operators and set their precedence, as well
as invoking &#34;normal&#34; functions as infix operators. Suppose you have a function <code>f(x,y)</code> — you
can invoke it like <code>f 5 6</code> or <code>5 `f` 6</code> (using backticks). This allows us to turn
our previous expression, <code>add(add(add(5,6),7),8)</code>, into <code>5 `add` 6 `add` 7 `add` 8</code>,
which is much more readable. But how can we do this in Python?</p>

<p>Well, there’s this <a href="http://code.activestate.com/recipes/384122-infix-operators/">Cookbook recipe</a>
that provides a very nice way to achieving the same functionality in Python (adapted a little by me):</p>

<div><pre><code data-lang="python"><span>from</span> <span>functools</span> <span>import</span> <span>partial</span>

<span>class</span> <span>Infix</span><span>(</span><span>object</span><span>):</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>func</span><span>):</span>
        <span>self</span><span>.</span><span>func</span> <span>=</span> <span>func</span>
    <span>def</span> <span>__or__</span><span>(</span><span>self</span><span>,</span> <span>other</span><span>):</span>
        <span>return</span> <span>self</span><span>.</span><span>func</span><span>(</span><span>other</span><span>)</span>
    <span>def</span> <span>__ror__</span><span>(</span><span>self</span><span>,</span> <span>other</span><span>):</span>
        <span>return</span> <span>Infix</span><span>(</span><span>partial</span><span>(</span><span>self</span><span>.</span><span>func</span><span>,</span> <span>other</span><span>))</span>
    <span>def</span> <span>__call__</span><span>(</span><span>self</span><span>,</span> <span>v1</span><span>,</span> <span>v2</span><span>):</span>
        <span>return</span> <span>self</span><span>.</span><span>func</span><span>(</span><span>v1</span><span>,</span> <span>v2</span><span>)</span></code></pre></div>


<p>Using instances of this peculiar class, we can now use a new &#34;syntax&#34; for calling functions as
infix operators:</p>

<div><pre><code data-lang="pycon"><span>&gt;&gt;&gt; </span><span>@Infix</span>
<span>... </span><span>def</span> <span>add</span><span>(</span><span>x</span><span>,</span> <span>y</span><span>):</span>
<span>... </span>    <span>return</span> <span>x</span> <span>+</span> <span>y</span>
<span>...</span>
<span>&gt;&gt;&gt; </span><span>5</span> <span>|</span><span>add</span><span>|</span> <span>6</span>
<span>11</span></code></pre></div>


<p>Surrounding decorated functions with pipes (bitwise ORs) allows them to take their parameters
infix-ly. Using this, we can do all sorts of cool things:</p>

<div><pre><code data-lang="pycon"><span>&gt;&gt;&gt; </span><span>instanceof</span> <span>=</span> <span>Infix</span><span>(</span><span>isinstance</span><span>)</span>
<span>&gt;&gt;&gt;</span>
<span>&gt;&gt;&gt; </span><span>if</span> <span>5</span> <span>|</span><span>instanceof</span><span>|</span> <span>int</span><span>:</span>
<span>... </span>    <span>print</span> <span>&#34;yes&#34;</span>
<span>...</span>
<span>yes</span></code></pre></div>


<p>And even <a href="http://en.wikipedia.org/wiki/Currying">curry</a> functions:</p>

<div><pre><code data-lang="pycon"><span>&gt;&gt;&gt; </span><span>curry</span> <span>=</span> <span>Infix</span><span>(</span><span>partial</span><span>)</span>
<span>&gt;&gt;&gt;</span>
<span>&gt;&gt;&gt; </span><span>def</span> <span>f</span><span>(</span><span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span><span>):</span>
<span>... </span>    <span>return</span> <span>x</span> <span>+</span> <span>y</span> <span>+</span> <span>z</span>
<span>...</span>
<span>&gt;&gt;&gt; </span><span>f</span> <span>|</span><span>curry</span><span>|</span> <span>3</span>
<span>&lt;functools.partial object at 0xb7733dec&gt;</span>
<span>&gt;&gt;&gt; </span><span>g</span> <span>=</span> <span>f</span> <span>|</span><span>curry</span><span>|</span> <span>3</span> <span>|</span><span>curry</span><span>|</span> <span>4</span> <span>|</span><span>curry</span><span>|</span> <span>5</span>
<span>&gt;&gt;&gt; </span><span>g</span><span>()</span>
<span>12</span></code></pre></div>


<p>Ain’t that cool?</p>



            
            
            
            

            
            
            
            
            

            

        </div>
    </div></div>
  </body>
</html>
