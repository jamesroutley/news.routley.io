<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bernsteinbear.com/blog/creduce/?utm_source=rss">Original</a>
    <h1>You can use C-Reduce for any language</h1>
    
    <div id="readability-page-1" class="page"><div>
        

        
        
        <p><i>November 15, 2024</i></p>
        
        
        <div>
            <p><a href="https://github.com/csmith-project/creduce">C-Reduce</a> is a tool by Regehr and
friends for minimizing C compiler bug reproducers. Imagine if you had a 10,000
line long C file that triggered a Clang bug. You don’t want to send a massive
blob to the compiler developers because that’s unhelpful, but you also don’t
want to cut it down to size by hand. The good news is that C-Reduce can do that
for you. The bad news is that everyone thinks it only works for C.</p>

<p>It’s pretty widely applicable. You only need:</p>

<ul>
  <li>A deterministic condition<sup id="fnref:loop" role="doc-noteref"><a href="#fn:loop" rel="footnote">1</a></sup></li>
  <li>A reasonably quick reproducer (it helps with the speed of the reduction)</li>
  <li>One or more mutable source files for C-Reduce to cut down</li>
</ul>

<p>I ran into a bug with RustPython running scrapscript and wanted to report it.
So I ran wrote a script <code>interesting.sh</code> to reproduce the bug:</p>

<div><div><pre><code><span>#!/bin/bash</span>
<span># No -o pipefail; we don&#39;t want rustpython failures to cause the script to fail</span>
<span>set</span> <span>-eu</span>

<span># Note the absolute path to the binary, which is not in $PATH</span>
/path/to/RustPython/target/release/rustpython scrapscript.py 2&gt;&amp;1 | <span>grep</span> <span>\</span>
    <span>&#34;tried to push value onto stack but overflowed max_stackdepth&#34;</span>
</code></pre></div></div>

<p>And then I ran C-Reduce. This all happened within a couple of seconds:</p>

<div><div><pre><code><span>$</span><span> </span>creduce <span>--not-c</span> interesting.sh scrapscript.py
<span>===&lt; 2263604 &gt;</span><span>===</span>
<span>running 4 interestingness tests in parallel
</span><span>===&lt; pass_blank :: 0 &gt;</span><span>===</span>
<span>(0.5 %, 200799 bytes)
(0.6 %, 200607 bytes)
</span><span>===&lt; pass_lines :: 0 &gt;</span><span>===</span>
<span>(9.2 %, 183225 bytes)
(18.1 %, 165228 bytes)
(26.5 %, 148382 bytes)
(29.3 %, 142674 bytes)
(34.6 %, 131961 bytes)
(38.1 %, 124960 bytes)
(40.6 %, 119872 bytes)
(42.3 %, 116504 bytes)
(44.4 %, 112161 bytes)
(46.4 %, 108180 bytes)
(47.5 %, 105950 bytes)
</span><span>...
</span></code></pre></div></div>

<p>What you see is C-Reduce cutting down the file by 50% nearly instantly… and I
don’t even have a very fast computer.</p>

<p>We use <code>--not-c</code> because otherwise C-Reduce uses a bunch of C-specific passes.
If we’re working on Python, it will likely just slow things down (but not
materially change the outcome).</p>

<p>There you have it. Fast and easy. As I finish typing these next couple of
sentences, we’re already at 96.9% reduced.</p>


        </div>
            
    <!-- Workaround for FB MITM -->
    <!-- Google tag (gtag.js) -->







    </div></div>
  </body>
</html>
