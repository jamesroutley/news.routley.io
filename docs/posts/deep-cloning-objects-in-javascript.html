<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.builder.io/blog/structured-clone">Original</a>
    <h1>Deep cloning objects in JavaScript</h1>
    
    <div id="readability-page-1" class="page"><div><div data-name="blog-article" data-source="Rendered by Builder.io"><div builder-content-id="f4ddb8da3c21492ea5ff448b53b33ab5" builder-model="blog-article"><div data-builder-component="blog-article" data-builder-content-id="f4ddb8da3c21492ea5ff448b53b33ab5"><div builder-type="blocks"><p><span><p>Did you know, there&#39;s now a native way in JavaScript to do deep copies of objects?</p><p>That&#39;s right, this <code>structuredClone</code> function is built into the JavaScript runtime:</p></span></p><div builder-id="builder-36c488f34390432b94a12e0888650a33"><div><div><pre><code>const calendarEvent = {
  title: &#34;Builder.io Conf&#34;,
  date: new Date(123),
  attendees: [&#34;Steve&#34;]
}

// üòç
const copied = structuredClone(calendarEvent)</code></pre></div></div></div><p><span><p>Did you notice in the example above we not only copied the object, but also the nested array, and even the Date object?</p><p>And all works precisely as expected:</p></span></p><div builder-id="builder-33474c248e954493849183f4d0a9523f"><div><div><pre><code>copied.attendees // [&#34;Steve&#34;]
copied.date // Date: Wed Dec 31 1969 16:00:00
cocalendarEvent.attendees === copied.attendees // false</code></pre></div></div></div><p><span><p>That‚Äôs right, <code>structuredClone</code> can not only do the above, but additionally:</p><ul><li>Clone infinitely nested objects and arrays</li><li>Clone circular references</li><li>Clone a wide variety of JavaScript types, such as <code>Date</code>, <code>Set</code>, <code>Map</code>, <code>Error</code>, <code>RegExp</code>, <code>ArrayBuffer</code>, <code>Blob</code>, <code>File</code>, <code>ImageData</code>, and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#supported_types" rel="noopener noreferrer" target="_blank">many more</a></li><li>Transfer any <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Transferable_objects" rel="noopener noreferrer" target="_blank">transferable objects</a></li></ul><p>So for example, this madness would even work as expected:</p></span></p><div builder-id="builder-f41b32bcf42742d2901b0ee215b78b0d"><div><div><pre><code>const kitchenSink = {
  set: new Set([1, 3, 3]),
  map: new Map([[1, 2]]),
  regex: /foo/,
  deep: { array: [ new File(someBlobData, &#39;file.txt&#39;) ] },
  error: new Error(&#39;Hello!&#39;)
}
kitchenSink.circular = kitchenSink

// ‚úÖ All good, fully and deeply copied!
const clonedSink = structuredClone(kitchenSink)</code></pre></div></div></div><div builder-id="builder-c5d1bb87545c44049bdc9f0df7d7911f"><a href="#why-not-just-object-spread" id="why-not-just-object-spread"><span><h2>Why not just object spread?</h2></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><p><span><p>It is important to note we are talking about a deep copy. If you just need to do a shallow copy, aka a copy that does not copy nested objects or arrays, then we can just do an object spread:</p></span></p><div builder-id="builder-abe99c668ccd45b49b77971cd9794fc6"><div><div><pre><code>const simpleEvent = {
  title: &#34;Builder.io Conf&#34;,
}
// ‚úÖ no problem, there are no nested objects or arrays
const shallowCopy = {...calendarEvent}</code></pre></div></div></div><p><span><p>Or even one of these, if you prefer</p></span></p><div builder-id="builder-5967b33bd4214a1b890c0351971b19e9"><div><div><pre><code>const shallowCopy = Object.assign({}, simpleEvent)
const shallowCopy = Object.create(simpleEvent)</code></pre></div></div></div><p><span><p>But as soon as we have nested items, we run into trouble:</p></span></p><div builder-id="builder-c2218c84d0e047d7b50bd9716eeb176b"><div><div><pre><code>const calendarEvent = {
  title: &#34;Builder.io Conf&#34;,
  date: new Date(123),
  attendees: [&#34;Steve&#34;]
}

const shallowCopy = {...calendarEvent}

// üö© oops - we just added &#34;Bob&#34; to both the copy *and* the original event
shallowCopy.attendees.push(&#34;Bob&#34;)

// üö© oops - we just updated the date for the copy *and* original event
shallowCopy.date.setTime(456)</code></pre></div></div></div><p><span><p>As you can see, we did not make a full copy of this object.</p><p>The nested date and array are still a shared reference between both, which can cause us major issues if we want to edit those thinking we are only updating the copied calendar event object.</p></span></p><div builder-id="builder-980b1f7bc0364b808c196a4df1b4c2c5"><a href="#why-not-code-json-parse-json-stringify-x-code" id="why-not-code-json-parse-json-stringify-x-code"><span><h2>Why not <code>JSON.parse(JSON.stringify(x))</code> ?</h2></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><p><span><p>Ah yes, this trick. It is actually a great one, and is surprisingly performant, but has some shortcomings that <code>structuredClone</code> addresses.</p><p>Take this as an example:</p></span></p><div builder-id="builder-2e2500c35b304aadabc88ab3ed5f93e8"><div><div><pre><code>const calendarEvent = {
  title: &#34;Builder.io Conf&#34;,
  date: new Date(123),
  attendees: [&#34;Steve&#34;]
}

// üö© JSON.stringify converted the `date` to a string
const problematicCopy = JSON.parse(JSON.stringify(calendarEvent))</code></pre></div></div></div><p><span><p>If we log <code>problematicCopy</code>, we would get:</p></span></p><div builder-id="builder-6e83229f45ba4872aa18b7b0f43b9247"><div><div><pre><code>{
  title: &#34;Builder.io Conf&#34;,
  date: &#34;1970-01-01T00:00:00.123Z&#34;
  attendees: [&#34;Steve&#34;]
}</code></pre></div></div></div><p><span><p>That‚Äôs not what we wanted! <code>date</code> is supposed to be a <code>Date</code> object, not a string.</p><p>This happened because <code>JSON.stringify</code> can only handle basic objects, arrays, and primitives. Any other type can be handled in hard to predict ways. For instance, Dates are converted to a string. But a <code>Set</code> is simply converted to <code>{}</code>.</p><p><code>JSON.stringify</code> even completely ignores certain things, like <code>undefined</code> or functions.</p><p>For instance, if we copied our <code>kitchenSink</code> example with this method:</p></span></p><div builder-id="builder-ac9e622fa5c4476b87a761e73520c349"><div><div><pre><code>const kitchenSink = {
  set: new Set([1, 3, 3]),
  map: new Map([[1, 2]]),
  regex: /foo/,
  deep: { array: [ new File(someBlobData, &#39;file.txt&#39;) ] },
  error: new Error(&#39;Hello!&#39;)
}

const veryProblematicCopy = JSON.parse(JSON.stringify(kitchenSink))</code></pre></div></div></div><p><span><p>We would get:</p></span></p><div builder-id="builder-12cab9f8152e403aaa3a1a9fa9ca6785"><div><div><pre><code>{
  &#34;set&#34;: {},
  &#34;map&#34;: {},
  &#34;regex&#34;: {},
  &#34;deep&#34;: {
    &#34;array&#34;: [
      {}
    ]
  },
  &#34;error&#34;: {},
}</code></pre></div></div></div><p><span><p>Ew!</p><p>Oh yeah, and we had to remove the circular reference we originally had for this, as <code>JSON.stringify</code> simply throws errors if it encounters one of those.</p><p>So while this method can be great if our requirements fit what it can do, there is a lot that we can do with <code>structuredClone</code> (aka everything above that we failed to do here) that this method cannot.</p></span></p><div builder-id="builder-6016311df60e48b4a720e9e6fd5bb96f"><a href="#why-not-code-clone-deep-code" id="why-not-code-clone-deep-code"><span><h2>Why not <code>_.cloneDeep</code>?</h2></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><p><span><p>To date, Lodash‚Äôs <code>cloneDeep</code> function has been a very common solution to this problem.</p><p>And this does, in fact, work as expected:</p></span></p><div builder-id="builder-68dd9a4555a24c7cb7900843b7c69ad3"><div><div><pre><code>import cloneDeep from &#39;lodash/cloneDeep&#39;

const calendarEvent = {
  title: &#34;Builder.io Conf&#34;,
  date: new Date(123),
  attendees: [&#34;Steve&#34;]
}

// ‚úÖ All good!
const clonedEvent = structuredClone(calendarEvent)</code></pre></div></div></div><p><span><p>But, there is just one caveat here. According to the <a href="https://marketplace.visualstudio.com/items?itemName=wix.vscode-import-cost">Import Cost</a> extension in my IDE, that prints the kb cost of anything I import, this one function comes in at a whole 17.4kb minified (5.3kb gzipped):</p></span></p><div builder-id="builder-02edcbbc54254ea193c56e7495ce4ba5"><picture><source srcset="https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?format=webp&amp;width=100 100w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?format=webp&amp;width=200 200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?format=webp&amp;width=400 400w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?format=webp&amp;width=800 800w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?format=webp&amp;width=1200 1200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?format=webp&amp;width=1600 1600w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?format=webp&amp;width=2000 2000w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?format=webp&amp;width=548 548w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?format=webp&amp;width=728 728w" type="image/webp"/><img alt="Screenshot of the import cost of &#39;lodash/cloneDeep&#39; at 5.3kb gzipped" loading="lazy" src="https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?width=800" srcset="https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?width=100 100w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?width=200 200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?width=400 400w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?width=800 800w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?width=1200 1200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?width=1600 1600w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?width=2000 2000w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?width=548 548w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Faa5ab14fd21741bf8e327dd6e6fb68b1?width=728 728w" sizes="(max-width: 638px) 86vw,  (max-width: 998px) 73vw, 58vw"/></picture></div><p><span><p>And that assumes you import just that function. If you instead import the more common way, not realizing that tree shaking doesn‚Äôt always work the way you hoped, you could accidentally import up to <a href="https://bundlephobia.com/package/lodash@4.17.21">25kb</a> just for this one function üò±</p></span></p><div builder-id="builder-0c88e47c09194f36a6703a0e7708a129"><picture><source srcset="https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?format=webp&amp;width=100 100w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?format=webp&amp;width=200 200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?format=webp&amp;width=400 400w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?format=webp&amp;width=800 800w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?format=webp&amp;width=1200 1200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?format=webp&amp;width=1600 1600w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?format=webp&amp;width=2000 2000w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?format=webp&amp;width=548 548w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?format=webp&amp;width=728 728w" type="image/webp"/><img alt="Screenshot of the import cost of &#39;lodash&#39; at 25.2kb gzipped" loading="lazy" src="https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?width=800" srcset="https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?width=100 100w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?width=200 200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?width=400 400w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?width=800 800w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?width=1200 1200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?width=1600 1600w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?width=2000 2000w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?width=548 548w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F5dbbee190753414bb31b720059a501db?width=728 728w" sizes="(max-width: 638px) 86vw,  (max-width: 998px) 73vw, 58vw"/></picture></div><p><span><p>While that will not be the end of the world to anyone, it‚Äôs simply not necessary in our case, not when browsers already have <code>structuredClone</code> built in.</p></span></p><div builder-id="builder-273f873f903749e99cf0e82640fb14e4"><a href="#what-can-code-structured-clone-code-em-not-em-clone" id="what-can-code-structured-clone-code-em-not-em-clone"><span><h2>What can <code>structuredClone</code> <em>not</em> clone</h2></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><div builder-id="builder-35b8f10d3d8148b89e950c1335546219"><a href="#functions-cannot-be-cloned" id="functions-cannot-be-cloned"><span><h3>Functions cannot be cloned</h3></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><p><span><p>They will a throw a¬†<code>DataCloneError</code>¬†exception:</p></span></p><div builder-id="builder-16a1f929c8bf45db944fd2348a3268b6"><div><div><pre><code>// üö© Error!
structuredClone({ fn: () =&gt; { } })</code></pre></div></div></div><div builder-id="builder-45eb949a7f214b3d9538288483981786"><a href="#dom-nodes" id="dom-nodes"><span><h3>DOM nodes</h3></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><p><span><p>Also throws a <code>DataCloneError</code>¬†exception:</p></span></p><div builder-id="builder-5646bd3bd658482f80566716fcf7282b"><div><div><pre><code>// üö© Error!
structuredClone({ el: document.body })</code></pre></div></div></div><div builder-id="builder-62ed3c96704d475896635daf18e8e15a"><a href="#property-descriptors-setters-and-getters" id="property-descriptors-setters-and-getters"><span><h3>Property descriptors, setters, and getters</h3></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><p><span><p>As well as similar metadata-like features are not cloned.</p><p>For instance, with a getter, the resulting value is cloned, but not the getter function itself (or any other property metadata):</p></span></p><div builder-id="builder-58148ca0ac31495fbb005565b4540dad"><div><div><pre><code>structuredClone({ get foo() { return &#39;bar&#39; } })
// Becomes: { foo: &#39;bar&#39; }</code></pre></div></div></div><div builder-id="builder-d244355296314a628e1d46c9c4fc90bd"><a href="#object-prototypes" id="object-prototypes"><span><h3>Object prototypes</h3></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><p><span><p>The prototype chain is not walked or duplicated. So if you clone an instance of <code>MyClass</code>, the cloned object will no longer be known to be an instance of this class (but all valid properties of this class will be cloned)</p></span></p><div builder-id="builder-8390f0d92e00423f93c5f6a1d2d0f7a9"><div><div><pre><code>class MyClass { 
  foo = &#39;bar&#39; 
  myMethod() { /* ... */ }
}
const myClass = new MyClass()

const cloned = structuredClone(myClass)
// Becomes: { foo: &#39;bar&#39; }

cloned instanceof myClass // false</code></pre></div></div></div><div builder-id="builder-f91c468430904bec8aa2fa661353de29"><a href="#full-list-of-supported-types" id="full-list-of-supported-types"><span><h3>Full list of supported types</h3></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><p><span><p>More simply put, anything not in the below list cannot be cloned:</p></span></p><div builder-id="builder-4c6e890aa2e1486ca8085383f8092673"><h4><a href="#a-href-https-developer-mozilla-org-en-us-docs-web-api-web-workers-api-structured-clone-algorithm-javascript-types-rel-noopener-noreferrer-target-blank-js-built-ins-a" id="a-href-https-developer-mozilla-org-en-us-docs-web-api-web-workers-api-structured-clone-algorithm-javascript-types-rel-noopener-noreferrer-target-blank-js-built-ins-a"></a><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#javascript_types" rel="noopener noreferrer" target="_blank">JS Built-ins</a></h4><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></div><p><span><p><code>Array</code>, <code>ArrayBuffer</code>, <code>Boolean</code>, <code>DataView</code>, <code>Date</code>, <code>Error</code>¬†types (those specifically listed below), <code>Map</code> , <code>Object</code> but only plain objects (e.g. from object literals), <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#primitive_values">Primitive types</a>, except¬†<code>symbol</code> (aka <code>number</code>, <code>string</code>, <code>null</code>, <code>undefined</code>, <code>boolean</code>, <code>BigInt</code>), <code>RegExp</code>, <code>Set</code>, <code>TypedArray</code></p></span></p><div builder-id="builder-bf4d36d1b5764e2c804c52b01b9fa5b4"><a href="#error-types" id="error-types"><span><h4>Error types</h4></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><p><span><p><code>Error</code>, <code>EvalError</code>, <code>RangeError</code>, <code>ReferenceError</code> , <code>SyntaxError</code>, <code>TypeError</code>, <code>URIError</code></p></span></p><div builder-id="builder-831acff4257948ab958250dd94218778"><h4><a href="#a-href-https-developer-mozilla-org-en-us-docs-web-api-web-workers-api-structured-clone-algorithm-webapi-types-rel-noopener-noreferrer-target-blank-web-api-types-a" id="a-href-https-developer-mozilla-org-en-us-docs-web-api-web-workers-api-structured-clone-algorithm-webapi-types-rel-noopener-noreferrer-target-blank-web-api-types-a"></a><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#webapi_types" rel="noopener noreferrer" target="_blank">Web/API types</a></h4><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></div><p><span><p><code>AudioData</code>, <code>Blob</code>, <code>CryptoKey</code>, <code>DOMException</code>, <code>DOMMatrix</code>, <code>DOMMatrixReadOnly</code>, <code>DOMPoint</code>, <code>DomQuad</code>, <code>DomRect</code>, <code>File</code>, <code>FileList</code>, <code>FileSystemDirectoryHandle</code>, <code>FileSystemFileHandle</code>, <code>FileSystemHandle</code>, <code>ImageBitmap</code>, <code>ImageData</code>, <code>RTCCertificate</code>, <code>VideoFrame</code></p></span></p><div builder-id="builder-4b44994d751f4891a7982587725fcdcd"><a href="#browser-and-runtime-support" id="browser-and-runtime-support"><span><h2>Browser and runtime support</h2></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><p><span><p>And here is the best part - <code>structuredClone</code> is supported in all major browsers, and even Node.js and Deno.</p><p>Just note the caveat with Web Workers having more limited support:</p></span></p><div builder-id="builder-c0ca0549766546a0b613e0cff7247bbf"><picture><source srcset="https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?format=webp&amp;width=100 100w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?format=webp&amp;width=200 200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?format=webp&amp;width=400 400w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?format=webp&amp;width=800 800w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?format=webp&amp;width=1200 1200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?format=webp&amp;width=1600 1600w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?format=webp&amp;width=2000 2000w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?format=webp&amp;width=548 548w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?format=webp&amp;width=728 728w" type="image/webp"/><img alt="Browser support table - screenshot from the link directly below this image" loading="lazy" src="https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?width=800" srcset="https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?width=100 100w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?width=200 200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?width=400 400w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?width=800 800w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?width=1200 1200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?width=1600 1600w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?width=2000 2000w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?width=548 548w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F1fdbc5b0826240e487a4980dfee69661?width=728 728w" sizes="(max-width: 638px) 86vw,  (max-width: 998px) 73vw, 58vw"/></picture></div><div builder-id="builder-4992aa50966c428ca01007ef6239c479"><p><span><p>Source: <a href="https://developer.mozilla.org/en-US/docs/Web/API/structuredClone">MDN</a></p></span></p></div><div builder-id="builder-90b3b91591394d9dabbc973da1adb95c"><a href="#conclusion" id="conclusion"><span><h2>Conclusion</h2></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><p><span><p>It‚Äôs been a long time coming, but we finally now have <code>structuredClone</code> to make deep cloning objects in JavaScript a breeze.  Thank you, <a href="https://web.dev/structured-clone/">Surma</a>.</p></span></p><div builder-id="builder-432467a43d414d05baec3d953b211180"><a href="#about-me" id="about-me"><span><h2>About Me</h2></span><svg focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></div><p><span><p>Hi! I&#39;m¬†<a href="https://twitter.com/Steve8708?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor" rel="noopener noreferrer" target="_blank">Steve</a>, CEO of¬†<a href="https://www.builder.io/" rel="noopener noreferrer" target="_blank">Builder.io</a>.</p><p>We make a way to drag + drop with your components to create pages and other CMS content on your site or app, visually.</p><p>You can read more about how this can improve your workflow <a href="https://www.builder.io/blog/headless-cms-workflow" rel="noopener noreferrer" target="_blank">here</a>.</p><p>You may find it interesting or useful:</p></span></p><div data-model="symbol" builder-id="builder-672f1c59927048908c2546489cd63e61"><div data-name="symbol" data-source="Rendered by Builder.io"><div builder-content-id="02714711c4b647959d015e34679ca6ee" builder-model="symbol"><div data-builder-component="symbol" data-builder-content-id="02714711c4b647959d015e34679ca6ee"><div builder-type="blocks"><div data-model="symbol" builder-id="builder-ae5eb8c51cd742758c3b4f2771ba6833"><div data-name="symbol" data-source="Rendered by Builder.io"><template data-template-variant-id="6d0b491a00e64dce9781e3c0a9839b71"><div builder-content-id="6d0b491a00e64dce9781e3c0a9839b71" builder-model="symbol"><div data-builder-component="symbol" data-builder-content-id="de784470c6884829b5e7c7603f4c51ed"><div builder-type="blocks"><div builder-id="builder-7c77e4f236f848b48c79a96f49072518"><div builder-id="builder-661f4bd90a3547fa85f50126d1418c87"><picture><source srcset="https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F83677fb912dd4a539a3f3bb5c0c82de1?format=webp&amp;width=100 100w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F83677fb912dd4a539a3f3bb5c0c82de1?format=webp&amp;width=200 200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F83677fb912dd4a539a3f3bb5c0c82de1?format=webp&amp;width=400 400w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F83677fb912dd4a539a3f3bb5c0c82de1?format=webp&amp;width=800 800w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F83677fb912dd4a539a3f3bb5c0c82de1?format=webp&amp;width=1200 1200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F83677fb912dd4a539a3f3bb5c0c82de1?format=webp&amp;width=1600 1600w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F83677fb912dd4a539a3f3bb5c0c82de1?format=webp&amp;width=2000 2000w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2F83677fb912dd4a539a3f3bb5c0c82de1?format=webp&amp;width=405 405w" type="image/webp"/></picture></div><div builder-id="builder-296e83c56835496a896d380e22d2fbd9"><div><div><div builder-type="blocks" builder-parent-id="builder-296e83c56835496a896d380e22d2fbd9"><div builder-id="builder-50cefa294545480a96166693c05e207d"><div><video autoplay="" muted="" loop=""></video></div></div></div></div><div><div builder-type="blocks" builder-parent-id="builder-296e83c56835496a896d380e22d2fbd9"><div builder-id="builder-2487409df20c4d6ea916563459503bd5"><p><span><p>Visually build with your components</p></span></p><div builder-id="builder-522f74098b38447289e1bbe3e525c9d6"><p><span><p><a href="https://www.builder.io/m/developers" rel="noopener noreferrer" target="_blank">Builder.io</a>¬†is a visual editor that connects to any site or app and lets you¬†<a href="https://www.builder.io/m/products" rel="noopener noreferrer" target="_blank">drag and drop</a>¬†with¬†<a href="https://www.builder.io/m/developers" rel="noopener noreferrer" target="_blank">your components</a>.<br/></p>
</span></p></div><div builder-id="builder-04ce70c139f74cba9ce6b77cd2b59966"><div><div><div builder-type="blocks" builder-parent-id="builder-04ce70c139f74cba9ce6b77cd2b59966"><p><a role="button" href="https://builder.io/signup" target="_blank" builder-id="builder-bbfd1a8be4e54fa0bc8f887da6d8a83c">Try it out</a></p></div></div><div><div builder-type="blocks" builder-parent-id="builder-04ce70c139f74cba9ce6b77cd2b59966"><p><a role="button" href="http://tinylogger.com/m/developers" target="_blank" builder-id="builder-b73a1d9611ee46b180da86ffdd53fa77">Learn more</a></p></div></div></div></div><div builder-id="builder-dde61f974a184a338de6b5e43b675061"><div><div><pre><code>// Dynamically render your components
export function MyPage({ json }) {
  return &lt;BuilderComponent content={json} /&gt;
}

registerComponents([MyHero, MyProducts])</code></pre></div></div></div></div></div></div></div></div></div><p><img role="presentation" aria-hidden="true" src="https://cdn.builder.io/api/v1/pixel?apiKey=YJIGb4i01jvw0SRdL5Bt" builder-id="builder-pixel-dikxm6sv1gi"/></p></div></div></div></template><div builder-content-id="de784470c6884829b5e7c7603f4c51ed" builder-model="symbol"><div data-builder-component="symbol" data-builder-content-id="de784470c6884829b5e7c7603f4c51ed"><div builder-type="blocks"><div builder-id="builder-7fd4bfcb2f3540cca129a9e10d1254f5"><div builder-id="builder-fd60c008f44a4c46be618e21afe30be5"><div><div><div builder-type="blocks" builder-parent-id="builder-fd60c008f44a4c46be618e21afe30be5"><div builder-id="builder-fde718fc845242dba058f6c26c328713"><div><video autoplay="" muted="" loop=""></video></div></div></div></div><div><div builder-type="blocks" builder-parent-id="builder-fd60c008f44a4c46be618e21afe30be5"><div builder-id="builder-887926a7e2554b608061da194a5942c3"><div builder-id="builder-ad34f80965614eccb6593bd1f0008217"><picture><source srcset="https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fa59bf5c79450490387c6ffe5914637d6?format=webp&amp;width=100 100w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fa59bf5c79450490387c6ffe5914637d6?format=webp&amp;width=200 200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fa59bf5c79450490387c6ffe5914637d6?format=webp&amp;width=400 400w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fa59bf5c79450490387c6ffe5914637d6?format=webp&amp;width=800 800w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fa59bf5c79450490387c6ffe5914637d6?format=webp&amp;width=1200 1200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fa59bf5c79450490387c6ffe5914637d6?format=webp&amp;width=1600 1600w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fa59bf5c79450490387c6ffe5914637d6?format=webp&amp;width=2000 2000w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fa59bf5c79450490387c6ffe5914637d6?format=webp&amp;width=389 389w" type="image/webp"/></picture></div><div builder-id="builder-ece484d769ba4d4f810e43c07f784852"><picture><source srcset="https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fec73bc7266784389afd672007bfbdc94?format=webp&amp;width=100 100w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fec73bc7266784389afd672007bfbdc94?format=webp&amp;width=200 200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fec73bc7266784389afd672007bfbdc94?format=webp&amp;width=400 400w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fec73bc7266784389afd672007bfbdc94?format=webp&amp;width=800 800w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fec73bc7266784389afd672007bfbdc94?format=webp&amp;width=1200 1200w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fec73bc7266784389afd672007bfbdc94?format=webp&amp;width=1600 1600w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fec73bc7266784389afd672007bfbdc94?format=webp&amp;width=2000 2000w, https://cdn.builder.io/api/v1/image/assets%2FYJIGb4i01jvw0SRdL5Bt%2Fec73bc7266784389afd672007bfbdc94?format=webp&amp;width=308 308w" type="image/webp"/></picture></div><p><span><p>Introducing Visual Copilot: a new AI model to convert Figma designs to high quality code in a click.</p>
</span></p><p><a role="button" href="https://builder.io/signup" target="_blank" builder-id="builder-a85aff888e7849f98193f66bd662f27e">Try Visual Copilot</a></p></div></div></div></div></div></div><p><img src="https://cdn.builder.io/api/v1/pixel?apiKey=YJIGb4i01jvw0SRdL5Bt" aria-hidden="true" alt="" role="presentation" width="0" height="0" builder-id="builder-pixel-zfu01ayjarm"/></p></div></div></div></div></div><p><img src="https://cdn.builder.io/api/v1/pixel?apiKey=YJIGb4i01jvw0SRdL5Bt" aria-hidden="true" alt="" role="presentation" width="0" height="0" builder-id="builder-pixel-yjnhh3kt8hs"/></p></div></div></div></div></div><p><img src="https://cdn.builder.io/api/v1/pixel?apiKey=YJIGb4i01jvw0SRdL5Bt" aria-hidden="true" alt="" role="presentation" width="0" height="0" builder-id="builder-pixel-11w6iqtm00ff"/></p></div></div></div></div></div></div>
  </body>
</html>
