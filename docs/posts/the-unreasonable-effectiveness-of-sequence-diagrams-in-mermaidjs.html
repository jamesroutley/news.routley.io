<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jessems.com/posts/2023-07-22-the-unreasonable-effectiveness-of-sequence-diagrams-in-mermaidjs">Original</a>
    <h1>The Unreasonable Effectiveness of Sequence Diagrams in MermaidJS</h1>
    
    <div id="readability-page-1" class="page"><div id="__next"><article dir="ltr"><p><img loading="lazy" width="784" height="319" decoding="async" data-nimg="1" srcset="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2F20230722225447.477bc2cf.png&amp;w=828&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2F20230722225447.477bc2cf.png&amp;w=1920&amp;q=75 2x" src="https://jessems.com/_next/image?url=%2F_next%2Fstatic%2Fmedia%2F20230722225447.477bc2cf.png&amp;w=1920&amp;q=75"/></p>
<p>Recently I came across this article written by the founder of MermaidJS, Knut Sveidqvist:</p>
<p><a target="_blank" rel="noreferrer" href="https://www.mermaidchart.com/blog/posts/sequence-diagrams-the-good-thing-uml-brought-to-software-development">Sequence diagrams, the only good thing UML brought to software development<span> (opens in a new tab)</span></a></p>
<p>Knut argues that the UML standard has been a flop, but sequence diagrams have been somewhat of a success, because unlike most of UML, they&#39;re actually quite useful.</p>
<p>What has surprised me since — and what this article is about — is how surprisingly pleasant it is to create sequence diagrams in code with MermaidJS.</p>
<p>I&#39;m a big fan of visualizing things. Not everyone seems to be such a proponent of this. My experience is that as soon as I&#39;m able to offload some of the complexity of a problem to a visual representation, it frees up space. I can use that space to increase my capacity for grappling with complexity. If I cannot do this, I notice that I struggle to hold mutliple big chunks in my head at once.</p>
<p>If you&#39;ve dabbled in UML, or if you&#39;ve seen a sequence diagram, you might acknowledge that they&#39;re pretty useful.</p>
<p>The problem is that creating them with visual tools is a pain in the ass. I&#39;ve created a handful of sequence diagrams using Lucidchart and it&#39;s a slow process and extremely brittle to any future change.</p>
<p><img loading="lazy" width="1734" height="942" decoding="async" data-nimg="1" srcset="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2F20230722154740.fd17f09d.png&amp;w=1920&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2F20230722154740.fd17f09d.png&amp;w=3840&amp;q=75 2x" src="https://jessems.com/_next/image?url=%2F_next%2Fstatic%2Fmedia%2F20230722154740.fd17f09d.png&amp;w=3840&amp;q=75"/></p>
<p>Mermaid, on the other hand, represents a different approach. It is a Javascript diagramming library, where you declaratively define your diagram in code.</p>
<p>This input:</p>

<p>Leads to this output:</p>

<p>I&#39;ll admit, that never sounded appealing to me. I reach for visualizations because the code is overwhelming me. Reaching for code to solve my code problem seemed like something that would only appeal to someone that loves code so much that they&#39;re probably no good at visualizing.</p>
<p>But then I tried it and I loved it. It was quick, painless and beautiful. I&#39;m honestly surprised how quick it is and how well it works.</p>
<p>Here are some tips on how I use it.</p>
<h2>Fleshing out user stories<span id="fleshing-out-user-stories"></span><a href="#fleshing-out-user-stories" aria-label="Permalink for this section"></a></h2>
<p>At my work at <a target="_blank" rel="noreferrer" href="https://bithawk.ch">BitHawk<span> (opens in a new tab)</span></a> I use it to flesh out user stories. Typically I&#39;ll need to understand how some part of the sytem works before I come up with a solution. Both the current implementation as well as the solution may benefit from being mapped out as a sequence diagram.</p>
<p>I start with a markdown file, which may look something like this:</p>

<p>But then I could augment it with a sequence diagram to explain my implementation plan. Right inside of markdown!</p>

<p>I will first render this with a markdown parser with hot reloading.</p>
<p>The one I settled on is a Rust library called <a target="_blank" rel="noreferrer" href="https://github.com/npm/marky-markdown">Marky<span> (opens in a new tab)</span></a>, which has some nice built-in templates and comes with Mermaid support.</p>

<p>And the result looks like this:</p>
<p><img alt="Result" loading="lazy" width="2748" height="1324" decoding="async" data-nimg="1" srcset="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2F20230722171418.c8625d38.png&amp;w=3840&amp;q=75 1x" src="https://jessems.com/_next/image?url=%2F_next%2Fstatic%2Fmedia%2F20230722171418.c8625d38.png&amp;w=3840&amp;q=75"/></p>
<p>With the default theme the diagram is somewhat small. As soon as I have some time I&#39;ll create a theme that allows for a full-width diagram, until then I&#39;ve been zooming in a bit with the browser to make the diagram full screen.</p>
<p>This allows me to tweak the code and get an instant preview of the result.</p>
<h3>Linking up your sequence diagram<span id="linking-up-your-sequence-diagram"></span><a href="#linking-up-your-sequence-diagram" aria-label="Permalink for this section"></a></h3>
<p>At this point the diagram is being rendered as html elements. The main benefit I see is that this allows you to link conceptual components to their actual implementation. This is especially useful in the ServiceNow context where Scripts live within records which have their own URLs.</p>

<p>And this is how that looks:</p>
<p><img loading="lazy" width="2880" height="1634" decoding="async" data-nimg="1" srcset="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2F20230722172930.c3dc181a.gif&amp;w=3840&amp;q=75 1x" src="https://jessems.com/_next/image?url=%2F_next%2Fstatic%2Fmedia%2F20230722172930.c3dc181a.gif&amp;w=3840&amp;q=75"/></p>
<h3>Rendering as an image<span id="rendering-as-an-image"></span><a href="#rendering-as-an-image" aria-label="Permalink for this section"></a></h3>
<p>That might be good enough for most use cases. But typically I want to copy and paste my markdown into an HTML input field on a <code dir="ltr">rm_story</code> record in ServiceNow. When I do that I want the HTML formatting as well as an image of the diagram to transfer over.</p>
<p>So long as the diagram is being rendered as HTML, this won&#39;t work. We need to render the diagram as a base64 image. That way, when we copy the text with the image, all of the image data is loaded into the clipboard.</p>
<p>Here&#39;s how we can accomplish that.</p>
<p>First we convert the mermaid diagrams in our markdown file to an image. I like going with SVG here, but the HTML field I&#39;m targetting doesn&#39;t support that, so I&#39;ll have to settle for PNG. I use the <a target="_blank" rel="noreferrer" href="https://github.com/mermaid-js/mermaid-cli">mermaid cli library<span> (opens in a new tab)</span></a> for this.</p>

<p>Sometimes I&#39;ll scale up the PNG a bit if it looks too small.</p>

<p>And then I&#39;ll run marky again. This time without the D flag (because <code dir="ltr">mmdc</code> converted our mermaid code into image references) and with the I flag to include the images as base64 encoded blobs.</p>

<p>If we now navigate to the hot reload server, we&#39;ll be able to select the entire page, copy it and paste it into our HTML field, transferring content, styling and images.</p>
<p><img loading="lazy" width="2880" height="1634" decoding="async" data-nimg="1" srcset="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2F20230722175514.a1c102cb.gif&amp;w=3840&amp;q=75 1x" src="https://jessems.com/_next/image?url=%2F_next%2Fstatic%2Fmedia%2F20230722175514.a1c102cb.gif&amp;w=3840&amp;q=75"/></p>
<h2>Conclusion<span id="conclusion"></span><a href="#conclusion" aria-label="Permalink for this section"></a></h2>
<p>I agree with Knut, sequence diagrams are useful and I&#39;ve discovered that MermaidJS combined with some Markdown tooling is a very convenient way to use them in practice.</p></article></div></div>
  </body>
</html>
