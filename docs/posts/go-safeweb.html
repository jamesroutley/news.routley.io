<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/google/go-safeweb">Original</a>
    <h1>Go-Safeweb</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><strong>DISCLAIMER</strong>: This is not an officially supported Google product.</p>
<p dir="auto"><code>go-safeweb</code> is a collection of libraries for writing secure-by-default HTTP
servers in Go.</p>

<p dir="auto">This project is in an early stage. We are currently <strong>not accepting</strong> any
contributions.</p>

<p dir="auto">The flexibility of Go’s <a href="https://pkg.go.dev/net/http/" rel="nofollow"><code>net/http</code></a> package
allows users to quickly implement HTTP servers.</p>
<p dir="auto">Responses are then written simply as slices of bytes, headers can be arbitrarily
manipulated and so on. This approach offers much needed flexibility for these
who really need it.</p>
<p dir="auto">Unfortunately, this approach leaves great space for introducing security
vulnerabilities and even experienced developers tend to do so.</p>
<p dir="auto">This document aims to design an HTTP API that eliminates whole classes of bugs,
like Cross-Site Scripting (XSS) or Cross-Site Request Forgery (XSRF). This can
be achieved by an approach known at Google as <em>safe coding</em>. Learn more at
<a href="http://static.googleusercontent.com/media/research.google.com/en//pubs/archive/42934.pdf" rel="nofollow">Securing the Tangled Web (Chistoph Kern, 2014)</a>
or
<a href="https://www.youtube.com/watch?v=ccfEu-Jj0as" rel="nofollow">Preventing Security Bugs through Software Design (Christoph Kern, 2016)</a>.</p>



<p dir="auto">Security mechanisms are applied by default (opt-out, not opt-in).</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">G2: Unsafe Usage is Easy to Review, Track and Restrict</h4><a id="user-content-g2-unsafe-usage-is-easy-to-review-track-and-restrict" aria-label="Permalink: G2: Unsafe Usage is Easy to Review, Track and Restrict" href="#g2-unsafe-usage-is-easy-to-review-track-and-restrict"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">All opt-outs from security mechanisms are explicit. Wherever possible, they’re
contained inside a package or an option that’s easy to restrict.</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">G3: Designed for Evolving Security Requirements</h4><a id="user-content-g3-designed-for-evolving-security-requirements" aria-label="Permalink: G3: Designed for Evolving Security Requirements" href="#g3-designed-for-evolving-security-requirements"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Enforcing new security measures is feasible through AST manipulation. Existing
users can be migrated using static analysis and/or runtime monitoring. Read more
<a href="#evolving-security-requirements-example">here</a>.</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">G4: High Compatibility with Go’s Standard Library and Existing Open-Source Frameworks</h4><a id="user-content-g4-high-compatibility-with-gos-standard-library-and-existing-open-source-frameworks" aria-label="Permalink: G4: High Compatibility with Go’s Standard Library and Existing Open-Source Frameworks" href="#g4-high-compatibility-with-gos-standard-library-and-existing-open-source-frameworks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Whenever possible, keep existing layouts, function signatures and other API
parts the same as the Go’s standard library. High compatibility enables wide
adoption.</p>


<p dir="auto">Creating safe APIs for all the corner cases might result in a bloated codebase.
Our experience shows that this isn’t necessary.</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">NG2: Full Compatibility with Go’s Standard Library and Existing Open-Source Frameworks</h4><a id="user-content-ng2-full-compatibility-with-gos-standard-library-and-existing-open-source-frameworks" aria-label="Permalink: NG2: Full Compatibility with Go’s Standard Library and Existing Open-Source Frameworks" href="#ng2-full-compatibility-with-gos-standard-library-and-existing-open-source-frameworks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Existing open-source frameworks or the Go standard library need to support each
developer scenario. This would have left us with limited options of creating
safe-by-default HTTP servers.</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">NG3: Features That Are Not Security Critical</h4><a id="user-content-ng3-features-that-are-not-security-critical" aria-label="Permalink: NG3: Features That Are Not Security Critical" href="#ng3-features-that-are-not-security-critical"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Go Safe Web aims to help you create a secure-by-default Go HTTP server and
nothing more. Features that are not security critical will not be added.
Focusing solely on security allows us to maintain high compatibility with the
standard library and makes adoption easier.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Security Vulnerabilities and Mitigations</h2><a id="user-content-security-vulnerabilities-and-mitigations" aria-label="Permalink: Security Vulnerabilities and Mitigations" href="#security-vulnerabilities-and-mitigations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">On a high level, we plan to address, or provide the needed infrastructure to
address, following issues (not an exhaustive list):</p>
<ul dir="auto">
<li><strong>XSS (cross-site scripting) and XSSI (cross-site script inclusion)</strong> - e.g.
by controlling how responses are generated</li>
<li><strong>XSRF (cross-site request forgery)</strong> - e.g. by using Fetch Metadata policies,
supporting token-based XSRF protection</li>
<li><strong>CORS (cross-origin resource sharing)</strong> - e.g. by taking control of CORS
response headers and handling CORS preflight requests</li>
<li><a href="https://csp.withgoogle.com/docs/index.html" rel="nofollow"><strong>CSP (content security policy)</strong></a> -
e.g. by automatically adding script nonces to HTML responses, adding relevant
security headers</li>
<li><strong>Transport Security</strong> - e.g. by
<a href="https://corinfaife.co/google/go-safeweb/blob/master/safehttp/plugins/hsts">enforcing HSTS support</a></li>
<li><strong>IFraming</strong> - e.g. by setting relevant HTTP headers to restrict framing or
providing server-side support for origin selection</li>
<li><strong>Auth (access control)</strong> - e.g. by providing infrastructure for plugging in
access control logic in an uniform, auditable way</li>
<li><strong>HTTP Request Parsing Bugs</strong> - e.g. by implementing strict and well
documented parsing behavior</li>
<li><strong>Error responses</strong> - e.g. by providing infrastructure for uniform error
handling (e.g. to prevent accidental leaks or XSS from error responses)</li>
<li><strong>Enforcement of other security specific HTTP headers</strong> -
<a href="https://corinfaife.co/google/go-safeweb/blob/master/safehttp/plugins/staticheaders">here</a></li>
</ul>

<div dir="auto"><h3 tabindex="-1" dir="auto">Evolving Security Requirements (example)</h3><a id="user-content-evolving-security-requirements-example" aria-label="Permalink: Evolving Security Requirements (example)" href="#evolving-security-requirements-example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Imagine an API for configuring access control. It features three types of rules:</p>
<ul dir="auto">
<li><code>ALLOW(user)</code> - allows a given <code>user</code></li>
<li><code>DENY(user)</code> - denies a given <code>user</code> (has priority over <code>ALLOW</code>)</li>
<li><code>REPORT(user)</code> - reports that it has seen a request from a given <code>user</code></li>
</ul>
<p dir="auto">Imagine now that at some point, security standards need to be increased and
<code>user = &#34;frombulator&#34;</code> has been determined to not meet the desired bar.</p>
<p dir="auto">How do we, for all the services running in our company, address this?</p>
<ol dir="auto">
<li>For existing services, we add a <code>LegacyFrombulatorAccess</code> option like so:
<code>security.AccessControl(rules, unsafe.LegacyFrombulatorAccess())</code>.</li>
<li>We change the <code>security.AccessControl()</code> call to add by default a
<code>DENY(&#34;frombulator&#34;)</code> rule. This rule <strong>is not added</strong> if
<code>unsafe.LegacyFrombulatorAccess</code> is applied.</li>
<li>Instead, <code>unsafe.LegacyFrombulatorAccess</code> adds a <code>REPORT(&#34;frombulator&#34;)</code>
rule.</li>
</ol>
<p dir="auto">This way, we have:</p>
<ul dir="auto">
<li>Ensured that all new callers of <code>security.AccessControl</code> use the safe setting
by default.</li>
<li>Can monitor existing services dependence on calls from the <code>frombulator</code>.
After a period of observation (let’s say, 30 days):
<ul dir="auto">
<li>If the service doesn’t receive requests from the <code>frombulator</code>: <strong>prune the
<code>unsafe.LegacyFrombulatorAccess</code></strong> option.</li>
<li>If the service does receive requests from the <code>frombulator</code>: <strong>inform the
service owners and plan a fix.</strong></li>
</ul>
</li>
</ul>
<p dir="auto">Crucially, only the last case (dependence on unsafe configuration) requires
engineering work per service. The rest can be automated.</p>
<p dir="auto"><strong>This approach is possible due to careful API design.</strong> A missing <code>DENY</code> or
<code>REPORT</code> rule, or a single sink in the form of <code>security.AccessControl</code> would
make this infeasible.</p>

<p dir="auto">Every file containing source code must include copyright and license
information. This includes any JS/CSS files that you might be serving out to
browsers. (This is to help well-intentioned people avoid accidental copying that
doesn&#39;t comply with the license.)</p>
<p dir="auto">Apache header:</p>
<div data-snippet-clipboard-copy-content="Copyright 2020 Google LLC

Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License."><pre><code>Copyright 2020 Google LLC

Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre></div>
</article></div></div>
  </body>
</html>
