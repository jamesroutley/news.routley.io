<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/">Original</a>
    <h1>Automatic Musical Composition with Python</h1>
    
    <div id="readability-page-1" class="page"><div><p>In this blog, I will introduce my approach to automatic musical composition, including the theory, the algorithm, and a Python package implementation <a href="https://github.com/flujoo/ch0p1n">ch0p1n</a>.</p>
<h2 id="what-is-automatic-composition">What Is Automatic Composition?</h2>
<p>Automatic composition is using algorithms to generate music.</p>
<p>As a trivial example, imagine that you put a cat on a piano to randomly press keys to generate music. The music is thus the result of a predetermined algorithm rather than of your instantaneous emotions or compositional skills. This is why it is called <em>automatic</em> composition.</p>
<p>Automatic composition has many different approaches or paradigms.<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup> The approach I take is inspired by the theories of Arnold Schoenberg, Heinrich Schenker and William Caplin. The key idea is that <strong>music can develop or be generated from limited materials under some common operations</strong>. I will explain the theoretical foundation of my approach in the following three sections.</p>
<h2 id="generate-music-from-limited-materials">Generate Music from Limited Materials</h2>
<p>Let’s see an example, the beginning of Beethoven’s first piano sonata:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata.png" alt=""/></p>
<audio controls="">
  <source src="assets/beethoven_sonata.mp3" type="audio/mpeg"/>
</audio>
<p>As indicated below, the two framed structures are almost identical:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_repeat_1.png" alt=""/></p>
<p>In fact, the structure in the blue frame can be generated by merely transposing the structure in the red one. Therefore, to compose this piece, I need only to create the structure in the red frame, then reuse or slightly modify it to generate the structure in the blue frame, rather than create both structures from scratch.</p>
<p>The same situation happens in other parts too. As indicated below, the four framed structures are also highly similar:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_repeat_2.png" alt=""/></p>
<p>Does this kind of reuse exist only in Beethoven’s music? No, this probably happens in every musical work. <strong>No matter how long a musical work lasts or how varied it can sound, the amount of its core materials is always small.</strong></p>
<p>For another example, the following is an excerpt from Mozart’s K. 485:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/mozart_rondo.png" alt=""/></p>
<p>Sometimes, however, a material can be modified so much that you can barely recognize it, as in the following example, the beginning of Chopin’s nocturne Op.9 No.1:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/chopin_op9_no1_repeat.png" alt=""/></p>
<audio controls="">
  <source src="assets/chopin_op9_no1.mp3" type="audio/mpeg"/>
</audio>
<p>The two framed structures look and sound quite different, but, in my approach, it is still that the structure in the blue frame can be generated by elaborating the structure in the red one, rather than that they are totally unrelated. It is so because the two structures have some morphological characteristics in common, they have the same background harmonic progression, and from the perspective of musical form, the structure in the blue frame is indeed a repetition of the structure in the red one.<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup></p>
<p>Please note that, in stating that a structure can be generated from other structure, I do not assert that Beethoven or Chopin actually did this or deliberately did this when composing music. Rather, my point is that we can use this music generation perspective to formalize or automate the process of musical composition.</p>
<h2 id="common-operations-to-manipulate-materials">Common Operations to Manipulate Materials</h2>
<p>Once a structure is created, some common operations can be applied to them to generate new structures. I will talk about some operations below.</p>
<p>The first operation I will talk about is <strong>repetition</strong>. It means repeating a structure in a new harmony without changing its morphology.</p>
<p>The Beethoven’s sonata is an example of repetition:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_repeat_1.png" alt=""/></p>
<p>The structure in the blue frame is a <strong>transposition</strong> of the structure in the red one. The two structures have the same morphology, although they are adapted to different background harmonies.</p>
<p>The Chopin’s nocturne is another example. The accompaniment motif in the blue frame is a repetition of the one in the red frame:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/chopin_op9_no1_accompaniment.png" alt=""/></p>
<p>In the repetition, some pitches move to their nearest pitches to fit the new harmony, according to some <a href="https://en.wikipedia.org/wiki/Voice_leading">voice-leading</a> rules.<sup id="fnref:3"><a href="#fn:3" role="doc-noteref">3</a></sup> Some of these changes are indicated below:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/chopin_op9_no1_accompaniment_2.png" alt=""/></p>
<audio controls="">
  <source src="assets/chopin_op9_no1_accompaniment_2.mp3" type="audio/mpeg"/>
</audio>
<p>The next operation is <strong>elaboration</strong>. It means adding passing notes, neighbor notes, and other types of notes to a structure. The Chopin’s nocturne is an example, in which a lot of tuplets are added in the repetition:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/chopin_op9_no1_repeat.png" alt=""/></p>
<p>Sometimes, elaborations are rather inferred from than showed in scores. Heinrich Schenker’s theory differentiates music’s superficial structure from its deep structure(s), and the superficial structure is the outcome of elaboration of a deep structure, as showed in the following example:<sup id="fnref:4"><a href="#fn:4" role="doc-noteref">4</a></sup></p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/elaboration.png" alt=""/></p>
<p>In the above score, for example, piece b can be generated by elaborating piece c.</p>
<p>The opposite operation of elaboration is <strong>reduction</strong>. For example, in the above score, piece b can be reduced to piece c.</p>
<p>The last operation I will talk about is <strong>fragmentation</strong>. It means taking a fragment from a material.</p>
<p>As in the Beethoven’s sonata, the structure in the blue frame is a fragment from the structure in the red one:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_fragment.png" alt=""/></p>
<p>The Chopin’s nocturne is a more interesting example:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/chopin_op9_no1_antecedent_fragment.png" alt=""/></p>
<audio controls="">
  <source src="assets/chopin_op9_no1_antecedent.mp3" type="audio/mpeg"/>
</audio>
<p>The fragment in the red frame can be modified to generate the structure in the orange frame; the fragment in the blue frame can be modified to generate the structures in the green frames. The two fragments are taken from the structure in the purple frame.</p>
<p>There are more operations can be applied to musical materials, but I will stop here. The four operations I have introduced are enough for the purpose of this blog.</p>
<h2 id="combine-materials-according-to-musical-forms">Combine Materials According to Musical Forms</h2>
<p>Created and generated structures can be combined into larger structures, according to musical forms. A <strong>musical form</strong> is a way in which musical materials should be organized.</p>
<p>For example, the beginning of the Beethoven’s sonata has the form <strong>sentence</strong>. Below is how this sentence is analyzed in William Caplin’s system:<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup></p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_caplin.png" alt=""/></p>
<p>The beginning of the Chopin’s nocturne is from a larger structure of the form <strong>compound period</strong>, which is far more complex than sentence.</p>
<p>I will not go deep into the subject of musical forms here. I highly recommend William Caplin’s excellent textbook<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup> on this topic. My key point is that musical materials should be combined according to musical forms to generate meaningful music.</p>
<h2 id="summary-of-the-theoretical-foundation">Summary of the Theoretical Foundation</h2>
<p>There are three key concepts in the theory behind my approach:</p>
<ol>
<li><strong>limited core materials</strong>, from which more materials can be generated,</li>
<li><strong>common operations</strong>, which can be applied to materials to generate more, and</li>
<li><strong>musical forms</strong>, according to which materials should be combined.</li>
</ol>
<p>Now it is time to turn the theory into an algorithm.</p>
<h2 id="represent-musical-structures">Represent Musical Structures</h2>
<p>We first need to strictly define musical <em>materials</em> and <em>structures</em>, which we have been talking about quite vaguely.</p>
<p>Let’s return to the Beethoven’s sonata. Below is its first two bars:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_basic_idea.png" alt=""/></p>
<p>This piece of music has two voices or musical lines. Each musical line consists of notes, rests or chords which consist of notes too. A note has several attributes, among which only pitch and duration will be considered here. Rather than represent notes as single objects, we will handle their pitch and durational contents separately.</p>
<p><strong>Pitches</strong> can be represented by <a href="https://en.wikipedia.org/wiki/Scientific_pitch_notation">scientific pitch notations</a> or <a href="https://en.wikipedia.org/wiki/Scientific_pitch_notation#Table_of_note_frequencies">MIDI note numbers</a>. Mostly, the latter are used, for ease of operation. For example, pitch C4 is represented by MIDI note number 60.</p>
<p>The pitch content of a <strong>rest</strong> can be represented by <code>None</code> in Python.</p>
<p>The pitch contents of a <strong>chord</strong> can be represented by list in Python. For example, in Python we can use <code>[&#39;C4&#39;, &#39;A-3&#39;, &#39;F3&#39;]</code> or <code>[60, 56, 53]</code> to represent the pitch contents of the chord in the red frame:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_chord.png" alt=""/></p>
<p><strong>Durations</strong> can be represented by numbers. For example, quarter note’s duration is 1.</p>
<p>The pitch contents of a <strong>musical line</strong> can be represented by what I call <strong>pitch line</strong>. In Python, a pitch line is a list whose members are <code>None</code>, numbers or lists of numbers. With Python package <a href="https://docs.python.org/3/library/typing.html">typing</a>, pitch line can be defined as:</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>typing</span> <span>import</span> <span>List</span><span>,</span> <span>Union</span>

<span>Pitch</span> <span>=</span> <span>int</span>
<span>PitchLine</span> <span>=</span> <span>List</span><span>[</span><span>Union</span><span>[</span><span>None</span><span>,</span> <span>Pitch</span><span>,</span> <span>List</span><span>[</span><span>Pitch</span><span>]]]</span>
</code></pre></div><p>The durational contents of a musical line can be represented by <strong>duration line</strong>. In Python, a duration line is a list whose members are numbers.</p>
<p>Finally, <strong>harmonies</strong> and <strong>scales</strong> can be represented by lists of <a href="https://en.wikipedia.org/wiki/Pitch_class#Other_ways_to_label_pitch_classes">pitch classes</a>. For example, in Python C major harmony can be represented by <code>[&#39;C&#39;, &#39;E&#39;, &#39;G&#39;]</code> or <code>[0, 4, 7]</code>.</p>
<h2 id="motifs">Motifs</h2>
<p>You may have heard this term a lot. A <strong>motif</strong> is structurally a musical line, usually short in length. Motifs are the building blocks of music. They can be repeated, elaborated, fragmented and combined to generate music.</p>
<p>For example, the following is how Schoenberg analysed the beginning of the Beethoven’s sonata:<sup id="fnref:5"><a href="#fn:5" role="doc-noteref">5</a></sup></p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_schoenberg.png" alt=""/></p>
<p>In his analysis, the melody part of this piece can be generated from only three motifs.</p>
<p>There are different kinds of motifs. For example, two kinds of motifs are framed in the following score:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/chopin_op9_no1_motifs.png" alt=""/></p>
<p>The motifs in the red frames can be called <strong>accompaniment motifs</strong> as they appear in the accompaniment line of this nocturne. They can also be called <strong>harmonic motifs</strong> as they consist of only harmonic notes. The motifs in the blue frames can be called <strong>melodic motifs</strong> as they appear in the melody line, or <strong>non-harmonic motifs</strong> if they contain non-harmonic notes.</p>
<p>In the following several sections, I will talk about the implementation of the common operations that can be applied to motifs.</p>
<h2 id="implementation-of-repetition-transpose">Implementation of Repetition: <code>transpose()</code></h2>
<p>The function <code>transpose()</code> from my Python package <a href="https://github.com/flujoo/ch0p1n">ch0p1n</a> is for transposing a motif along a scale.</p>
<p>Suppose there is a motif which can be represented as:</p>
<div><pre tabindex="0"><code data-lang="python"><span>pitch_motif</span> <span>=</span> <span>[</span><span>60</span><span>,</span> <span>67</span><span>,</span> <span>76</span><span>,</span> <span>72</span><span>]</span>
<span># [&#39;C4&#39;, &#39;G4&#39;, &#39;E5&#39;, &#39;C5&#39;]</span>

<span>duration_motif</span> <span>=</span> <span>[</span><span>1</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>]</span>
</code></pre></div><p>Remember that we separately represent a motif’s pitch and durational contents.</p>
<p>We can show this motif in score with <code>show()</code>, which is built on Python package <a href="https://github.com/cuthbertLab/music21">music21</a>:</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>ch0p1n.utils</span> <span>import</span> <span>show</span>

<span>show</span><span>(</span>
  <span>pitch_lines</span> <span>=</span> <span>[</span><span>pitch_motif</span><span>],</span>
  <span>duration_lines</span> <span>=</span> <span>[</span><span>duration_motif</span><span>],</span>
  <span>group</span> <span>=</span> <span>1</span><span>,</span> <span># the number of voices in the treble staff</span>
  <span>key</span> <span>=</span> <span>0</span><span>,</span>
  <span>meter</span> <span>=</span> <span>&#39;4/4&#39;</span><span>,</span>
  <span>clefs</span> <span>=</span> <span>[</span><span>&#39;g&#39;</span><span>,</span> <span>&#39;f&#39;</span><span>]</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/transpose_original.png" alt=""/></p>
<p>Transpose it up by one step along the C major scale:</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>ch0p1n.motif</span> <span>import</span> <span>transpose</span>

<span>pitch_motif_transposed</span> <span>=</span> <span>transpose</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>scale</span> <span>=</span> <span>[</span><span>0</span><span>,</span> <span>2</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>7</span><span>,</span> <span>9</span><span>,</span> <span>11</span><span>],</span>
  <span>step</span> <span>=</span> <span>1</span>
<span>)</span>
</code></pre></div><p>The code is pretty self-explanatory. Let’s check the result:</p>
<div><pre tabindex="0"><code data-lang="python"><span>&gt;&gt;&gt;</span> <span>pitch_motif_transposed</span>

<span>[</span><span>62</span><span>,</span> <span>69</span><span>,</span> <span>77</span><span>,</span> <span>74</span><span>]</span>
</code></pre></div><div><pre tabindex="0"><code data-lang="python"><span>show</span><span>(</span>
  <span>pitch_lines</span> <span>=</span> <span>[</span><span>pitch_motif_transposed</span><span>],</span>
  <span>duration_lines</span> <span>=</span> <span>[</span><span>duration_motif</span><span>],</span>
  <span>group</span> <span>=</span> <span>1</span><span>,</span> <span># the number of voices in the treble staff</span>
  <span>key</span> <span>=</span> <span>0</span><span>,</span>
  <span>meter</span> <span>=</span> <span>&#39;4/4&#39;</span><span>,</span>
  <span>clefs</span> <span>=</span> <span>[</span><span>&#39;g&#39;</span><span>,</span> <span>&#39;f&#39;</span><span>]</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/transpose_scale.png" alt=""/></p>
<p>It looks good. Every pitch has moved up by one step along the C major scale.</p>
<p>Since harmony is a special kind of scale, we can use <code>transpose()</code> to repeat the motif in a harmony, say, the G major harmony:</p>
<div><pre tabindex="0"><code data-lang="python"><span>pitch_motif_transposed</span> <span>=</span> <span>transpose</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>scale</span> <span>=</span> <span>[</span><span>7</span><span>,</span> <span>11</span><span>,</span> <span>2</span><span>],</span> <span># G major harmony</span>
  <span>step</span> <span>=</span> <span>1</span>
<span>)</span>
</code></pre></div><p>Let’s show the original and the transposed motifs together:</p>
<div><pre tabindex="0"><code data-lang="python"><span>show</span><span>(</span>
  <span>pitch_lines</span> <span>=</span> <span>[</span><span>pitch_motif</span> <span>+</span> <span>pitch_motif_transposed</span><span>],</span>
  <span>duration_lines</span> <span>=</span> <span>[</span><span>duration_motif</span> <span>*</span> <span>2</span><span>],</span>
  <span>group</span> <span>=</span> <span>1</span><span>,</span>
  <span>key</span> <span>=</span> <span>0</span><span>,</span>
  <span>meter</span> <span>=</span> <span>&#39;4/4&#39;</span><span>,</span>
  <span>clefs</span> <span>=</span> <span>[</span><span>&#39;g&#39;</span><span>,</span> <span>&#39;f&#39;</span><span>]</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/transpose_harmony.png" alt=""/></p>
<p>The original motif is in the first bar, and the transposed the second. You can see how each pitch moves up by one step in the G major harmony.</p>
<p>In some cases, however, <code>transpose()</code> does not work well. Still in the above example, suppose we transpose the motif down rather than up by one step with <code>step = -1</code>:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/transpose_fail.png" alt=""/></p>
<p>The transposed motif in the second bar is not acceptable because it contains no pitch class G to fully reify the G major harmony.</p>
<h2 id="implementation-of-repetition-lead">Implementation of Repetition: <code>lead()</code></h2>
<p>We can improve this situation with function <code>lead()</code> from <a href="https://github.com/flujoo/ch0p1n">ch0p1n</a>. The function got its name from the concept of voice-leading, which means every note in a motif <em>leads</em> by step to the note(s) in a given harmony.</p>
<p>Let’s give it a try:</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>ch0p1n.motif</span> <span>import</span> <span>lead</span>

<span>pitch_motifs</span> <span>=</span> <span>lead</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>harmony</span> <span>=</span> <span>[</span><span>7</span><span>,</span> <span>11</span><span>,</span> <span>2</span><span>],</span> <span># G major harmony</span>
  <span>steps</span> <span>=</span> <span>[</span><span>-</span><span>1</span><span>,</span> <span>0</span><span>],</span>
  <span>complete</span> <span>=</span> <span>False</span><span>,</span>
  <span>similar</span> <span>=</span> <span>None</span>
<span>)</span>
</code></pre></div><p><code>steps = [-1, 0]</code> means each pitch will move zero step if it fits the harmony, and at the same time one step downwards. In other words, each pitch may generate more than one pitch in the given harmony under <code>lead()</code>, and the result returned is thus a list of pitch motifs rather than a single one. I will talk about parameters <code>complete</code> and <code>similar</code> later.</p>
<p>Let’s check the result:</p>
<div><pre tabindex="0"><code data-lang="python"><span>&gt;&gt;&gt;</span> <span>pitch_motifs</span>

<span>[</span>
  <span>[</span><span>59</span><span>,</span> <span>62</span><span>,</span> <span>74</span><span>,</span> <span>71</span><span>],</span>
  <span>[</span><span>59</span><span>,</span> <span>67</span><span>,</span> <span>74</span><span>,</span> <span>71</span><span>]</span>
<span>]</span>
</code></pre></div><p>There are two pitch motifs generated. Let’s show them in score:</p>
<div><pre tabindex="0"><code data-lang="python"><span># to merge `pitch_motifs`</span>
<span>from</span> <span>itertools</span> <span>import</span> <span>chain</span>

<span>show</span><span>(</span>
  <span>pitch_lines</span> <span>=</span> <span>[</span><span>list</span><span>(</span><span>chain</span><span>(</span><span>*</span><span>pitch_motifs</span><span>))],</span>
  <span>duration_lines</span> <span>=</span> <span>[</span><span>duration_motif</span> <span>*</span> <span>2</span><span>],</span>
  <span>group</span> <span>=</span> <span>1</span><span>,</span>
  <span>key</span> <span>=</span> <span>0</span><span>,</span>
  <span>meter</span> <span>=</span> <span>&#39;4/4&#39;</span><span>,</span>
  <span>clefs</span> <span>=</span> <span>[</span><span>&#39;g&#39;</span><span>,</span> <span>&#39;f&#39;</span><span>]</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/lead.png" alt=""/></p>
<p>While the motif in the first bar is as same as the unacceptable one generated by <code>transpose()</code> with <code>step = -1</code>, the motif in the second bar is good, which fully reifies the G major harmony.</p>
<p>With <code>complete = True</code>, we can screen out the pitch motifs which are not harmonically complete or do not fully reify the given harmony:</p>
<div><pre tabindex="0"><code data-lang="python"><span>pitch_motifs</span> <span>=</span> <span>lead</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>harmony</span> <span>=</span> <span>[</span><span>7</span><span>,</span> <span>11</span><span>,</span> <span>2</span><span>],</span>
  <span>steps</span> <span>=</span> <span>[</span><span>-</span><span>1</span><span>,</span> <span>0</span><span>],</span>
  <span>complete</span> <span>=</span> <span>True</span><span>,</span>
  <span>similar</span> <span>=</span> <span>None</span>
<span>)</span>
</code></pre></div><p>Now there leaves only one pitch motif, the good one:</p>
<div><pre tabindex="0"><code data-lang="python"><span>&gt;&gt;&gt;</span> <span>pitch_motifs</span>

<span>[</span>
  <span>[</span><span>59</span><span>,</span> <span>67</span><span>,</span> <span>74</span><span>,</span> <span>71</span><span>]</span>
<span>]</span>
</code></pre></div><p>With parameter <code>similar</code>, we can screen out the pitch motifs which do not have the same contour as the original one. I will skip this part in this introductory blog.</p>
<h2 id="implementation-of-repetition-thread">Implementation of Repetition: <code>thread()</code></h2>
<p>The function <code>thread()</code> is for repeating a motif in consecutive harmonies or <em>threading</em> a motif through harmonies. Let’s try it on the motif defined earlier:</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>ch0p1n.motif</span> <span>import</span> <span>thread</span>

<span>pitch_motifs</span> <span>=</span> <span>thread</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>duration_motif</span> <span>=</span> <span>duration_motif</span><span>,</span>
  <span>harmonies</span> <span>=</span> <span>[[</span><span>5</span><span>,</span> <span>9</span><span>,</span> <span>0</span><span>],</span> <span>[</span><span>7</span><span>,</span> <span>11</span><span>,</span> <span>2</span><span>]],</span> <span># F, G</span>
  <span>durations</span> <span>=</span> <span>[</span><span>2</span><span>,</span> <span>2</span><span>],</span>
  <span>steps</span> <span>=</span> <span>[</span><span>1</span><span>]</span>
<span>)</span>

<span>show</span><span>(</span>
  <span>pitch_lines</span> <span>=</span> <span>pitch_motifs</span><span>,</span>
  <span>duration_lines</span> <span>=</span> <span>[</span><span>duration_motif</span><span>],</span>
  <span>group</span> <span>=</span> <span>1</span><span>,</span>
  <span>key</span> <span>=</span> <span>0</span><span>,</span>
  <span>meter</span> <span>=</span> <span>&#39;2/4&#39;</span><span>,</span>
  <span>clefs</span> <span>=</span> <span>[</span><span>&#39;g&#39;</span><span>,</span> <span>&#39;f&#39;</span><span>]</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/thread.png" alt=""/></p>
<p>The first two notes of the motif are adapted to the F major harmony, while the last two notes to the G major harmony.</p>
<p>So far, I have talked only about harmonic motifs. To deal with non-harmonic motifs, which is more complex, we need first to consider how to elaborate motifs.</p>
<h2 id="implementation-of-elaboration">Implementation of Elaboration</h2>
<p>Simply speaking, elaboration is adding notes to a motif. The function <code>elaborate()</code> from <a href="https://github.com/flujoo/ch0p1n">ch0p1n</a> serves the exact purpose.</p>
<p>Let’s try it on the motif defined earlier:</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>ch0p1n.motif</span> <span>import</span> <span>elaborate</span>

<span>motif</span> <span>=</span> <span>elaborate</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>duration_motif</span> <span>=</span> <span>duration_motif</span><span>,</span>
  <span>reference</span> <span>=</span> <span>2</span><span>,</span>
  <span>steps</span> <span>=</span> <span>[</span><span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>],</span>
  <span>scale</span> <span>=</span> <span>[</span><span>0</span><span>,</span> <span>2</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>7</span><span>,</span> <span>9</span><span>,</span> <span>11</span><span>],</span>
  <span>position</span> <span>=</span> <span>&#39;left&#39;</span>
<span>)</span>
</code></pre></div><p>Show the original and the elaborated motifs together:</p>
<div><pre tabindex="0"><code data-lang="python"><span>show</span><span>(</span>
  <span>pitch_lines</span> <span>=</span> <span>[</span><span>pitch_motif</span> <span>+</span> <span>motif</span><span>[</span><span>0</span><span>]],</span>
  <span>duration_lines</span> <span>=</span> <span>[</span><span>duration_motif</span> <span>+</span> <span>motif</span><span>[</span><span>1</span><span>]],</span>
  <span>group</span> <span>=</span> <span>1</span><span>,</span>
  <span>key</span> <span>=</span> <span>0</span><span>,</span>
  <span>meter</span> <span>=</span> <span>&#39;4/4&#39;</span><span>,</span>
  <span>clefs</span> <span>=</span> <span>[</span><span>&#39;g&#39;</span><span>,</span> <span>&#39;f&#39;</span><span>]</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/elaborate.png" alt=""/></p>
<p>Two notes are prepended to the third note.</p>
<p>Let’s have a look at the code.</p>
<p>The argument <code>reference</code> indicates where to add notes or elaborate the motif. For example, <code>reference = 2</code> means the notes are added at the third note. We can elaborate the last note instead:</p>
<div><pre tabindex="0"><code data-lang="python"><span>motif</span> <span>=</span> <span>elaborate</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>duration_motif</span> <span>=</span> <span>duration_motif</span><span>,</span>
  <span>reference</span> <span>=</span> <span>3</span><span>,</span> <span># the last note</span>
  <span>steps</span> <span>=</span> <span>[</span><span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>],</span>
  <span>scale</span> <span>=</span> <span>[</span><span>0</span><span>,</span> <span>2</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>7</span><span>,</span> <span>9</span><span>,</span> <span>11</span><span>],</span>
  <span>position</span> <span>=</span> <span>&#39;left&#39;</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/elaborate_reference.png" alt=""/></p>
<p>The argument <code>steps</code> specifies the pitches of the notes to add. For example, <code>steps = [-1, -1]</code> indicates that the reference note should move one step downwards to generate the first note, then this note should move one step downwards to generate the second note. Let’s add three descending notes with this argument:</p>
<div><pre tabindex="0"><code data-lang="python"><span>motif</span> <span>=</span> <span>elaborate</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>duration_motif</span> <span>=</span> <span>duration_motif</span><span>,</span>
  <span>reference</span> <span>=</span> <span>2</span><span>,</span>
  <span>steps</span> <span>=</span> <span>[</span><span>1</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>],</span> <span># three descending notes</span>
  <span>scale</span> <span>=</span> <span>[</span><span>0</span><span>,</span> <span>2</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>7</span><span>,</span> <span>9</span><span>,</span> <span>11</span><span>],</span>
  <span>position</span> <span>=</span> <span>&#39;left&#39;</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/elaborate_steps.png" alt=""/></p>
<p>With <code>steps</code>, you can also repeat some note or add rests to a motif, as in the following example:</p>
<div><pre tabindex="0"><code data-lang="python"><span>motif</span> <span>=</span> <span>elaborate</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>duration_motif</span> <span>=</span> <span>duration_motif</span><span>,</span>
  <span>reference</span> <span>=</span> <span>2</span><span>,</span>
  <span>steps</span> <span>=</span> <span>[</span><span>0</span><span>,</span> <span>0</span><span>,</span> <span>None</span><span>]</span> <span># repeat the note twice then add a rest</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/elaborate_rest.png" alt=""/></p>
<p>The argument <code>scale</code> specifies the scale along which to move the reference note to generate the notes to add. For example, <code>scale = [0, 2, 4, 5, 7, 9, 11]</code> indicates that it is the C major scale. We can use C chromatic scale instead:</p>
<div><pre tabindex="0"><code data-lang="python"><span>motif</span> <span>=</span> <span>elaborate</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>duration_motif</span> <span>=</span> <span>duration_motif</span><span>,</span>
  <span>reference</span> <span>=</span> <span>2</span><span>,</span>
  <span>steps</span> <span>=</span> <span>[</span><span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>],</span>
  <span>scale</span> <span>=</span> <span>list</span><span>(</span><span>range</span><span>(</span><span>12</span><span>)),</span> <span># C chromatic scale</span>
  <span>position</span> <span>=</span> <span>&#39;left&#39;</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/elaborate_scale.png" alt=""/></p>
<p>The argument <code>position</code> specifies the position of the added notes relative to the reference note. For example, <code>position = &#39;left&#39;</code> indicates that the notes are added at the left side of the reference note. We can add the notes at the right side:</p>
<div><pre tabindex="0"><code data-lang="python"><span>motif</span> <span>=</span> <span>elaborate</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>duration_motif</span> <span>=</span> <span>duration_motif</span><span>,</span>
  <span>reference</span> <span>=</span> <span>2</span><span>,</span>
  <span>steps</span> <span>=</span> <span>[</span><span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>],</span>
  <span>scale</span> <span>=</span> <span>[</span><span>0</span><span>,</span> <span>2</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>7</span><span>,</span> <span>9</span><span>,</span> <span>11</span><span>],</span>
  <span>position</span> <span>=</span> <span>&#39;right&#39;</span> <span># add the notes at the right side</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/elaborate_right.png" alt=""/></p>
<p>Please note that, with <code>&#39;left&#39;</code> and <code>&#39;right&#39;</code>, the added notes take durations from the reference note. If you want that the durations are taken from the note before or after the reference note, use <code>&#39;previous&#39;</code> or <code>&#39;next&#39;</code>. For example,</p>
<div><pre tabindex="0"><code data-lang="python"><span>motif</span> <span>=</span> <span>elaborate</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>duration_motif</span> <span>=</span> <span>duration_motif</span><span>,</span>
  <span>reference</span> <span>=</span> <span>2</span><span>,</span>
  <span>steps</span> <span>=</span> <span>[</span><span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>],</span>
  <span>scale</span> <span>=</span> <span>[</span><span>0</span><span>,</span> <span>2</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>7</span><span>,</span> <span>9</span><span>,</span> <span>11</span><span>],</span>
  <span>position</span> <span>=</span> <span>&#39;previous&#39;</span> <span># take durations from the previous note</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/elaborate_previous.png" alt=""/></p>
<p>The argument <code>ratio</code> specifies the percentage of duration the added notes take. For example, <code>ratio = 1/2</code> means that the added notes take 50% of the duration of the reference note:</p>
<div><pre tabindex="0"><code data-lang="python"><span>motif</span> <span>=</span> <span>elaborate</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>pitch_motif</span><span>,</span>
  <span>duration_motif</span> <span>=</span> <span>duration_motif</span><span>,</span>
  <span>reference</span> <span>=</span> <span>2</span><span>,</span>
  <span>steps</span> <span>=</span> <span>[</span><span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>],</span>
  <span>scale</span> <span>=</span> <span>[</span><span>0</span><span>,</span> <span>2</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>7</span><span>,</span> <span>9</span><span>,</span> <span>11</span><span>],</span>
  <span>position</span> <span>=</span> <span>&#39;left&#39;</span><span>,</span>
  <span>ratio</span> <span>=</span> <span>1</span><span>/</span><span>2</span> <span># take 50% of the duration of the reference note</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/elaborate_ratio.png" alt=""/></p>
<h2 id="implementation-of-reduction">Implementation of Reduction</h2>
<p>Reduction is the opposite of elaboration. It is removing notes from a motif. The corresponding function from <a href="https://github.com/flujoo/ch0p1n">ch0p1n</a> is <code>reduce()</code>.</p>
<p>Take the last motif from the previous section as an example:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/reduce.png" alt=""/></p>
<p>Reduce it to the unelaborated version:</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>ch0p1n.motif</span> <span>import</span> <span>reduce</span>

<span>motif</span> <span>=</span> <span>reduce</span><span>(</span>
  <span>pitch_motif</span> <span>=</span> <span>motif</span><span>[</span><span>0</span><span>],</span>
  <span>duration_motif</span> <span>=</span> <span>motif</span><span>[</span><span>1</span><span>],</span>
  <span>start</span> <span>=</span> <span>2</span><span>,</span>
  <span>end</span> <span>=</span> <span>3</span><span>,</span>
  <span>position</span> <span>=</span> <span>&#39;right&#39;</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/reduce_original.png" alt=""/></p>
<p>The arguments <code>start</code> and <code>end</code> specify the notes to remove. The argument <code>position</code> specifies the reference note to which to add the durations of the removed notes.</p>
<h2 id="repeat-non-harmonic-motifs">Repeat Non-Harmonic Motifs</h2>
<p>Non-harmonic motifs contain non-harmonic notes. For example, the following is a non-harmonic motif:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/non_harmonic_circled.png" alt=""/></p>
<p>The background harmony is Fm, and the circled notes are non-harmonic since they do not fit the harmony.</p>
<p>To repeat a non-harmonic motif,</p>
<ol>
<li>reduce it to contain only harmonic notes,</li>
<li>repeat the reduced motif, and</li>
<li>elaborate the repeated motif.</li>
</ol>
<p>Let’s try this strategy on this motif.</p>
<p>This motif can be represented as:</p>
<div><pre tabindex="0"><code data-lang="python"><span>pitch_motif</span> <span>=</span> <span>[</span><span>65</span><span>,</span> <span>68</span><span>,</span> <span>72</span><span>,</span> <span>77</span><span>,</span> <span>80</span><span>,</span> <span>79</span><span>,</span> <span>77</span><span>,</span> <span>76</span><span>,</span> <span>77</span><span>,</span> <span>None</span><span>]</span>
<span>duration_motif</span> <span>=</span> <span>[</span><span>1</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>,</span> <span>1.5</span><span>,</span> <span>1</span><span>/</span><span>6</span><span>,</span> <span>1</span><span>/</span><span>6</span><span>,</span> <span>1</span><span>/</span><span>6</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>]</span>
</code></pre></div><p>Reduce it:</p>
<div><pre tabindex="0"><code data-lang="python"><span>pitch_motif</span><span>,</span> <span>duration_motif</span> <span>=</span> <span>reduce</span><span>(</span>
  <span>pitch_motif</span><span>,</span>
  <span>duration_motif</span><span>,</span>
  <span>start</span> <span>=</span> <span>5</span><span>,</span>
  <span>end</span> <span>=</span> <span>7</span><span>,</span>
  <span>position</span> <span>=</span> <span>&#39;left&#39;</span>
<span>)</span>

<span># the same below</span>
<span>show</span><span>(</span>
  <span>[</span><span>pitch_motif</span><span>],</span>
  <span>[</span><span>duration_motif</span><span>],</span>
  <span>key</span> <span>=</span> <span>-</span><span>4</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/non_harmonic_reduced.png" alt=""/></p>
<p>Repeat it in C7 harmony:</p>
<div><pre tabindex="0"><code data-lang="python"><span>pitch_motif</span> <span>=</span> <span>transpose</span><span>(</span><span>pitch_motif</span><span>,</span> <span>[</span><span>0</span><span>,</span> <span>4</span><span>,</span> <span>7</span><span>,</span> <span>10</span><span>],</span> <span>1</span><span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/non_harmonic_repeated.png" alt=""/></p>
<p>Finally, elaborate it:</p>
<div><pre tabindex="0"><code data-lang="python"><span>pitch_motif</span><span>,</span> <span>duration_motif</span> <span>=</span> <span>elaborate</span><span>(</span>
  <span>pitch_motif</span><span>,</span>
  <span>duration_motif</span><span>,</span>
  <span>reference</span> <span>=</span> <span>4</span><span>,</span>
  <span>steps</span> <span>=</span> <span>[</span><span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>],</span>
  <span>scale</span> <span>=</span> <span>[</span><span>5</span><span>,</span> <span>7</span><span>,</span> <span>8</span><span>,</span> <span>10</span><span>,</span> <span>0</span><span>,</span> <span>1</span><span>,</span> <span>4</span><span>],</span>
  <span>position</span> <span>=</span> <span>&#39;right&#39;</span><span>,</span>
  <span>ratio</span> <span>=</span> <span>1</span><span>/</span><span>4</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/non_harmonic_elaborated.png" alt=""/></p>
<h2 id="implementation-of-fragmentation-divide">Implementation of Fragmentation: <code>divide()</code></h2>
<p>Fragmentation is breaking a motif up into several shorter motifs or taking a fragment from a motif. The corresponding functions from <a href="https://github.com/flujoo/ch0p1n">ch0p1n</a> are <code>divide()</code> and <code>fragment()</code>.</p>
<p>Consider the following motif from the Chopin’s nocturne:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/fragmentation.png" alt=""/></p>
<p>This motif can be represented as:</p>
<div><pre tabindex="0"><code data-lang="python"><span>pitch_motif</span> <span>=</span> <span>[</span><span>82</span><span>,</span> <span>84</span><span>,</span> <span>85</span><span>,</span> <span>81</span><span>,</span> <span>82</span><span>,</span> <span>78</span><span>]</span> <span>+</span> <span>[</span><span>77</span><span>]</span><span>*</span><span>4</span> <span>+</span> <span>[</span><span>78</span><span>,</span> <span>77</span><span>,</span> <span>75</span><span>,</span> <span>72</span><span>,</span> <span>73</span><span>,</span> <span>70</span><span>]</span>
<span>duration_motif</span> <span>=</span> <span>[</span><span>0.5</span><span>]</span><span>*</span><span>6</span> <span>+</span> <span>[</span><span>1</span><span>]</span><span>*</span><span>4</span> <span>+</span> <span>[</span><span>0.5</span><span>]</span><span>*</span><span>4</span> <span>+</span> <span>[</span><span>2</span><span>,</span> <span>1</span><span>]</span>
</code></pre></div><p>With <code>divide()</code>, we can divide this motif into, say, three shorter motifs of equal length:</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>ch0p1n.motif</span> <span>import</span> <span>divide</span>

<span>motifs</span> <span>=</span> <span>divide</span><span>(</span><span>pitch_motif</span><span>,</span> <span>duration_motif</span><span>,</span> <span>3</span><span>)</span>
</code></pre></div><div><pre tabindex="0"><code data-lang="python"><span>&gt;&gt;&gt;</span> <span>motifs</span>

<span>[</span>
  <span>([</span><span>82</span><span>,</span> <span>84</span><span>,</span> <span>85</span><span>,</span> <span>81</span><span>,</span> <span>82</span><span>,</span> <span>78</span><span>,</span> <span>77</span><span>],</span> <span>[</span><span>0.5</span><span>,</span> <span>0.5</span><span>,</span> <span>0.5</span><span>,</span> <span>0.5</span><span>,</span> <span>0.5</span><span>,</span> <span>0.5</span><span>,</span> <span>1</span><span>]),</span>
  <span>([</span><span>77</span><span>,</span> <span>77</span><span>,</span> <span>77</span><span>,</span> <span>78</span><span>,</span> <span>77</span><span>],</span> <span>[</span><span>1</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>,</span> <span>0.5</span><span>,</span> <span>0.5</span><span>]),</span>
  <span>([</span><span>75</span><span>,</span> <span>72</span><span>,</span> <span>73</span><span>,</span> <span>70</span><span>],</span> <span>[</span><span>0.5</span><span>,</span> <span>0.5</span><span>,</span> <span>2</span><span>,</span> <span>1</span><span>])</span>
<span>]</span>
</code></pre></div><div><pre tabindex="0"><code data-lang="python"><span>for</span> <span>motif</span> <span>in</span> <span>motifs</span><span>:</span>
  <span>show</span><span>([</span><span>motif</span><span>[</span><span>0</span><span>]],</span> <span>[</span><span>motif</span><span>[</span><span>1</span><span>]],</span> <span>key</span> <span>=</span> <span>-</span><span>5</span><span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/divide_1.png" alt=""/></p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/divide_2.png" alt=""/></p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/divide_3.png" alt=""/></p>
<h2 id="implementation-of-fragmentation-fragment">Implementation of Fragmentation: <code>fragment()</code></h2>
<p>With <code>fragment()</code>, we can take a fragment from a motif. For example,</p>
<div><pre tabindex="0"><code data-lang="python"><span>from</span> <span>ch0p1n.motif</span> <span>import</span> <span>fragment</span>

<span>motif</span> <span>=</span> <span>fragment</span><span>(</span>
  <span>pitch_motif</span><span>,</span>
  <span>duration_motif</span><span>,</span>
  <span>start</span> <span>=</span> <span>6</span><span>,</span>
  <span>end</span> <span>=</span> <span>9</span><span>,</span>
  <span>ratio</span> <span>=</span> <span>1</span><span>/</span><span>2</span><span>,</span>
  <span>fit</span> <span>=</span> <span>&#39;right&#39;</span>
<span>)</span>

<span>show</span><span>([</span><span>motif</span><span>[</span><span>0</span><span>]],</span> <span>[</span><span>motif</span><span>[</span><span>1</span><span>]],</span> <span>key</span> <span>=</span> <span>-</span><span>5</span><span>,</span> <span>meter</span> <span>=</span> <span>&#39;6/4&#39;</span><span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/fragment.png" alt=""/></p>
<p>The arguments <code>start</code> and <code>end</code> specify the start note and the end note of the fragment. <code>ratio = 1/2</code> indicates that the fragment’s length should be 50% of the original motif, and to accomplish this, <code>fit = &#39;right&#39;</code> indicates that the end note should be prolonged.</p>
<h2 id="case-study-replicate-and-vary-beethovens-sonata">Case Study: Replicate and Vary Beethoven’s Sonata</h2>
<p>Now it is time to put it all together. Let’s first try to generate the beginning of the Beethoven’s sonata from a small amount of materials, under the operations that we have been talking about.</p>
<p>To simplify the problem and to make patterns more discernible, I will remove slurs, articulations, dynamics, grace notes, and some other notes from the original score:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_simplified.png" alt=""/></p>
<p>This piece consists of two voices or musical lines, the melody line in the treble staff and the accompaniment line in the bass staff.</p>
<p>The melody line, in my analysis, consists of seven melodic motifs, as indicated below:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_melody.png" alt=""/></p>
<p>And all of them can be generated from the following melodic motif:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/basic_idea_reduced.png" alt=""/></p>
<p>The accompaniment line consists of seven accompaniment motifs:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_accompaniment.png" alt=""/></p>
<p>And these motifs can be generated from:</p>
<p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_accompaniment_core.png" alt=""/></p>
<p>In summary, to generate the beginning of the Beethoven’s sonata, the core materials are</p>
<ol>
<li>the melodic motif to generate the melody line,</li>
<li>the accompaniment motif to generate the accompaniment line,</li>
<li>harmonies for repetition of motifs, and</li>
<li>the scale for elaboration of motifs.</li>
</ol>
<p>Let’s turn this analysis into code.</p>
<p>Represent the core melodic motif:</p>
<div><pre tabindex="0"><code data-lang="python"><span>melodic_pitch_motif</span> <span>=</span> <span>[</span><span>65</span><span>,</span> <span>68</span><span>,</span> <span>72</span><span>,</span> <span>77</span><span>,</span> <span>80</span><span>,</span> <span>77</span><span>]</span>
<span>melodic_duration_motif</span> <span>=</span> <span>[</span><span>1</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>,</span> <span>2</span><span>,</span> <span>2</span><span>]</span>
</code></pre></div><p>Represent the core accompaniment motif:</p>
<div><pre tabindex="0"><code data-lang="python"><span>accompaniment_pitch_motif</span> <span>=</span> <span>[[</span><span>60</span><span>,</span> <span>56</span><span>,</span> <span>53</span><span>]]</span>
<span>accompaniment_duration_motif</span> <span>=</span> <span>[</span><span>8</span><span>]</span>
</code></pre></div><p>Represent the harmonies and the scale:</p>
<div><pre tabindex="0"><code data-lang="python"><span># Fm, C7, Fm, C7, Fm, Gdim, C7</span>
<span>harmonies</span> <span>=</span> <span>[</span>
  <span>[</span><span>5</span><span>,</span> <span>8</span><span>,</span> <span>0</span><span>],</span>
  <span>[</span><span>0</span><span>,</span> <span>4</span><span>,</span> <span>7</span><span>,</span> <span>10</span><span>],</span>
  <span>[</span><span>5</span><span>,</span> <span>8</span><span>,</span> <span>0</span><span>],</span>
  <span>[</span><span>0</span><span>,</span> <span>4</span><span>,</span> <span>7</span><span>,</span> <span>10</span><span>],</span>
  <span>[</span><span>5</span><span>,</span> <span>8</span><span>,</span> <span>0</span><span>],</span>
  <span>[</span><span>7</span><span>,</span> <span>10</span><span>,</span> <span>1</span><span>],</span>
  <span>[</span><span>0</span><span>,</span> <span>4</span><span>,</span> <span>7</span><span>,</span> <span>10</span><span>]</span>
<span>]</span>

<span># F harmonic minor scale</span>
<span>scale</span> <span>=</span> <span>[</span><span>5</span><span>,</span> <span>7</span><span>,</span> <span>8</span><span>,</span> <span>10</span><span>,</span> <span>0</span><span>,</span> <span>1</span><span>,</span> <span>4</span><span>]</span>
</code></pre></div><p>Represent the generative mechanism:</p>
<div><pre tabindex="0"><code data-lang="python"><span>def</span> <span>generate_beethoven_sonata</span><span>(</span>
      <span>melodic_pitch_motif</span><span>,</span>
      <span>melodic_duration_motif</span><span>,</span>
      <span>accompaniment_pitch_motif</span><span>,</span>
      <span>accompaniment_duration_motif</span><span>,</span>
      <span>harmonies</span><span>,</span>
      <span>scale</span>
    <span>):</span>

    <span># melody line</span>
    <span>melodic_pitch_line</span> <span>=</span> <span>[]</span>
    <span>melodic_duration_line</span> <span>=</span> <span>[]</span>

    <span># accompaniment line</span>
    <span>accompaniment_pitch_line</span> <span>=</span> <span>[]</span>
    <span>accompaniment_duration_line</span> <span>=</span> <span>[]</span>

    <span># abbreviation rules:</span>
    <span># &#39;mpm1&#39; is short for &#39;melodic pitch motif 1&#39;</span>
    <span># &#39;mdm1&#39; is short for &#39;melodic duration motif 1&#39;</span>
    <span># &#39;apm1&#39; is short for &#39;accompaniment pitch motif 1&#39;</span>

    <span># shorten names for convenience</span>
    <span>mpm</span> <span>=</span> <span>melodic_pitch_motif</span>
    <span>mdm</span> <span>=</span> <span>melodic_duration_motif</span>
    <span>apm</span> <span>=</span> <span>accompaniment_pitch_motif</span>
    <span>adm</span> <span>=</span> <span>accompaniment_duration_motif</span>


    <span># melodic motif 1 ------------------------------------------</span>
    <span>mpm1</span><span>,</span> <span>mdm1</span> <span>=</span> <span>elaborate</span><span>(</span>
      <span>mpm</span><span>,</span>
      <span>mdm</span><span>,</span>
      <span>reference</span> <span>=</span> <span>5</span><span>,</span>
      <span>steps</span> <span>=</span> <span>[</span><span>None</span><span>],</span>
      <span>scale</span> <span>=</span> <span>scale</span><span>,</span>
      <span>position</span> <span>=</span> <span>&#39;right&#39;</span>
    <span>)</span>

    <span>mpm1</span><span>,</span> <span>mdm1</span> <span>=</span> <span>elaborate</span><span>(</span>
      <span>mpm1</span><span>,</span>
      <span>mdm1</span><span>,</span>
      <span>reference</span> <span>=</span> <span>4</span><span>,</span>
      <span>steps</span> <span>=</span> <span>[</span><span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>],</span>
      <span>scale</span> <span>=</span> <span>scale</span><span>,</span>
      <span>position</span> <span>=</span> <span>&#39;right&#39;</span><span>,</span>
      <span>ratio</span> <span>=</span> <span>1</span><span>/</span><span>4</span>
    <span>)</span>

    <span>melodic_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>mpm1</span><span>)</span>
    <span>melodic_duration_line</span><span>.</span><span>extend</span><span>(</span><span>mdm1</span><span>)</span>


    <span># melodic motif 2 ------------------------------------------</span>
    <span>mpm2</span> <span>=</span> <span>transpose</span><span>(</span><span>mpm</span><span>,</span> <span>harmonies</span><span>[</span><span>1</span><span>],</span> <span>1</span><span>)</span>

    <span>mpm2</span><span>,</span> <span>mdm2</span> <span>=</span> <span>elaborate</span><span>(</span>
      <span>mpm2</span><span>,</span>
      <span>mdm</span><span>,</span>
      <span>reference</span> <span>=</span> <span>5</span><span>,</span>
      <span>steps</span> <span>=</span> <span>[</span><span>None</span><span>],</span>
      <span>scale</span> <span>=</span> <span>scale</span><span>,</span>
      <span>position</span> <span>=</span> <span>&#39;right&#39;</span>
    <span>)</span>

    <span>mpm2</span><span>,</span> <span>mdm2</span> <span>=</span> <span>elaborate</span><span>(</span>
      <span>mpm2</span><span>,</span>
      <span>mdm2</span><span>,</span>
      <span>reference</span> <span>=</span> <span>4</span><span>,</span>
      <span>steps</span> <span>=</span> <span>[</span><span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>],</span>
      <span>scale</span> <span>=</span> <span>scale</span><span>,</span>
      <span>position</span> <span>=</span> <span>&#39;right&#39;</span><span>,</span>
      <span>ratio</span> <span>=</span> <span>1</span><span>/</span><span>4</span>
    <span>)</span>

    <span>melodic_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>mpm2</span><span>)</span>
    <span>melodic_duration_line</span><span>.</span><span>extend</span><span>(</span><span>mdm2</span><span>)</span>


    <span># melodic motif 3 ------------------------------------------</span>
    <span>mpm3</span><span>,</span> <span>mdm3</span> <span>=</span> <span>divide</span><span>(</span><span>mpm1</span><span>,</span> <span>mdm1</span><span>,</span> <span>2</span><span>)[</span><span>1</span><span>]</span>
    <span>melodic_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>mpm3</span><span>)</span>
    <span>melodic_duration_line</span><span>.</span><span>extend</span><span>(</span><span>mdm3</span><span>)</span>


    <span># melodic motif 4 ------------------------------------------</span>
    <span>mpm4</span><span>,</span> <span>mdm4</span> <span>=</span> <span>divide</span><span>(</span><span>mpm2</span><span>,</span> <span>mdm2</span><span>,</span> <span>2</span><span>)[</span><span>1</span><span>]</span>
    <span>melodic_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>mpm4</span><span>)</span>
    <span>melodic_duration_line</span><span>.</span><span>extend</span><span>(</span><span>mdm4</span><span>)</span>


    <span># melodic motif 5 ------------------------------------------</span>
    <span>mpm5</span><span>,</span> <span>mdm5</span> <span>=</span> <span>divide</span><span>(</span><span>mpm</span><span>,</span> <span>mdm</span><span>,</span> <span>4</span><span>)[</span><span>2</span><span>]</span>
    <span>mpm5</span> <span>=</span> <span>transpose</span><span>(</span><span>mpm5</span><span>,</span> <span>harmonies</span><span>[</span><span>4</span><span>],</span> <span>1</span><span>)</span>
    <span>melodic_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>mpm5</span><span>)</span>
    <span>melodic_duration_line</span><span>.</span><span>extend</span><span>(</span><span>mdm5</span><span>)</span>


    <span># melodic motif 6 ------------------------------------------</span>
    <span>mpm6</span><span>,</span> <span>mdm6</span> <span>=</span> <span>divide</span><span>(</span><span>mpm</span><span>,</span> <span>mdm</span><span>,</span> <span>4</span><span>)[</span><span>2</span><span>]</span>
    <span>mpm6</span> <span>=</span> <span>transpose</span><span>(</span><span>mpm6</span><span>,</span> <span>harmonies</span><span>[</span><span>5</span><span>],</span> <span>1</span><span>)</span>
    <span>mpm6</span><span>,</span> <span>mdm6</span> <span>=</span> <span>elaborate</span><span>(</span><span>mpm6</span><span>,</span> <span>mdm6</span><span>,</span> <span>0</span><span>,</span> <span>[</span><span>-</span><span>1</span><span>]</span><span>*</span><span>3</span><span>,</span> <span>scale</span><span>)</span>
    <span>melodic_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>mpm6</span><span>)</span>
    <span>melodic_duration_line</span><span>.</span><span>extend</span><span>(</span><span>mdm6</span><span>)</span>


    <span># melodic motif 7 ------------------------------------------</span>
    <span>mpm7</span><span>,</span> <span>mdm7</span> <span>=</span> <span>divide</span><span>(</span><span>mpm</span><span>,</span> <span>mdm</span><span>,</span> <span>4</span><span>)[</span><span>2</span><span>]</span>
    <span>mpm7</span> <span>=</span> <span>transpose</span><span>(</span><span>mpm7</span><span>,</span> <span>harmonies</span><span>[</span><span>6</span><span>],</span> <span>-</span><span>2</span><span>)</span>
    <span>mpm7</span><span>,</span> <span>mdm7</span> <span>=</span> <span>elaborate</span><span>(</span><span>mpm7</span><span>,</span> <span>mdm7</span><span>,</span> <span>0</span><span>,</span> <span>[</span><span>1</span><span>],</span> <span>scale</span><span>,</span> <span>&#39;left&#39;</span><span>)</span>
    <span>melodic_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>mpm7</span><span>)</span>
    <span>melodic_duration_line</span><span>.</span><span>extend</span><span>(</span><span>mdm7</span><span>)</span>


    <span># accompaniment motif 1 ------------------------------------</span>
    <span>apm1</span><span>,</span> <span>adm1</span> <span>=</span> <span>elaborate</span><span>(</span><span>apm</span><span>,</span> <span>adm</span><span>,</span> <span>0</span><span>,</span> <span>[</span><span>None</span><span>],</span> <span>scale</span><span>,</span> <span>&#39;left&#39;</span><span>)</span>
    <span>apm1</span><span>,</span> <span>adm1</span> <span>=</span> <span>elaborate</span><span>(</span><span>apm1</span><span>,</span> <span>adm1</span><span>,</span> <span>1</span><span>,</span> <span>[</span><span>0</span><span>,</span> <span>0</span><span>,</span> <span>None</span><span>],</span> <span>scale</span><span>,</span> <span>&#39;left&#39;</span><span>)</span>
    <span>accompaniment_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>apm1</span><span>)</span>
    <span>accompaniment_duration_line</span><span>.</span><span>extend</span><span>(</span><span>adm1</span><span>)</span>


    <span># accompaniment motif 2 ------------------------------------</span>
    <span>apm2</span> <span>=</span> <span>transpose</span><span>(</span><span>apm</span><span>,</span> <span>harmonies</span><span>[</span><span>1</span><span>],</span> <span>-</span><span>1</span><span>)</span>
    <span>apm2</span><span>,</span> <span>adm2</span> <span>=</span> <span>elaborate</span><span>(</span><span>apm2</span><span>,</span> <span>adm</span><span>,</span> <span>0</span><span>,</span> <span>[</span><span>None</span><span>],</span> <span>scale</span><span>,</span> <span>&#39;left&#39;</span><span>)</span>
    <span>apm2</span><span>,</span> <span>adm2</span> <span>=</span> <span>elaborate</span><span>(</span><span>apm2</span><span>,</span> <span>adm2</span><span>,</span> <span>1</span><span>,</span> <span>[</span><span>0</span><span>,</span> <span>0</span><span>,</span> <span>None</span><span>],</span> <span>scale</span><span>,</span> <span>&#39;left&#39;</span><span>)</span>
    <span>accompaniment_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>apm2</span><span>)</span>
    <span>accompaniment_duration_line</span><span>.</span><span>extend</span><span>(</span><span>adm2</span><span>)</span>


    <span># accompaniment motif 3 ------------------------------------</span>
    <span>apm3</span><span>,</span> <span>adm3</span> <span>=</span> <span>divide</span><span>(</span><span>apm1</span><span>,</span> <span>adm1</span><span>,</span> <span>2</span><span>)[</span><span>1</span><span>]</span>
    <span>accompaniment_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>apm3</span><span>)</span>
    <span>accompaniment_duration_line</span><span>.</span><span>extend</span><span>(</span><span>adm3</span><span>)</span>


    <span># accompaniment motif 4 ------------------------------------</span>
    <span>apm4</span><span>,</span> <span>adm4</span> <span>=</span> <span>divide</span><span>(</span><span>apm2</span><span>,</span> <span>adm2</span><span>,</span> <span>2</span><span>)[</span><span>1</span><span>]</span>
    <span>apm4</span> <span>=</span> <span>transpose</span><span>(</span><span>apm3</span><span>,</span> <span>harmonies</span><span>[</span><span>3</span><span>],</span> <span>1</span><span>)</span>
    <span>accompaniment_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>apm4</span><span>)</span>
    <span>accompaniment_duration_line</span><span>.</span><span>extend</span><span>(</span><span>adm4</span><span>)</span>


    <span># accompaniment motif 5 ------------------------------------</span>
    <span>apm5</span> <span>=</span> <span>transpose</span><span>(</span><span>apm3</span><span>,</span> <span>harmonies</span><span>[</span><span>4</span><span>],</span> <span>1</span><span>)</span>
    <span>apm5</span><span>,</span> <span>adm5</span> <span>=</span> <span>divide</span><span>(</span><span>apm5</span><span>,</span> <span>adm4</span><span>,</span> <span>2</span><span>)[</span><span>0</span><span>]</span>
    <span>accompaniment_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>apm5</span><span>)</span>
    <span>accompaniment_duration_line</span><span>.</span><span>extend</span><span>(</span><span>adm5</span><span>)</span>


    <span># accompaniment motif 6 ------------------------------------</span>
    <span>apm6</span> <span>=</span> <span>transpose</span><span>(</span><span>apm3</span><span>,</span> <span>harmonies</span><span>[</span><span>5</span><span>],</span> <span>2</span><span>)</span>
    <span>apm6</span><span>,</span> <span>adm6</span> <span>=</span> <span>divide</span><span>(</span><span>apm6</span><span>,</span> <span>adm4</span><span>,</span> <span>2</span><span>)[</span><span>0</span><span>]</span>
    <span>accompaniment_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>apm6</span><span>)</span>
    <span>accompaniment_duration_line</span><span>.</span><span>extend</span><span>(</span><span>adm5</span><span>)</span>


    <span># accompaniment motif 7 ------------------------------------</span>
    <span>apm7</span> <span>=</span> <span>transpose</span><span>(</span><span>apm3</span><span>,</span> <span>harmonies</span><span>[</span><span>6</span><span>],</span> <span>2</span><span>)</span>
    <span>apm7</span><span>,</span> <span>adm7</span> <span>=</span> <span>divide</span><span>(</span><span>apm7</span><span>,</span> <span>adm4</span><span>,</span> <span>2</span><span>)[</span><span>0</span><span>]</span>
    <span>accompaniment_pitch_line</span><span>.</span><span>extend</span><span>(</span><span>apm7</span><span>)</span>
    <span>accompaniment_duration_line</span><span>.</span><span>extend</span><span>(</span><span>adm5</span><span>)</span>


    <span># show score -----------------------------------------------</span>
    <span>show</span><span>(</span>
      <span>[</span><span>melodic_pitch_line</span><span>,</span> <span>accompaniment_pitch_line</span><span>],</span>
      <span>[</span><span>melodic_duration_line</span><span>,</span> <span>accompaniment_duration_line</span><span>],</span>
      <span>key</span> <span>=</span> <span>-</span><span>4</span>
    <span>)</span>
</code></pre></div><p>Generate the music:</p>
<div><pre tabindex="0"><code data-lang="python"><span>generate_beethoven_sonata</span><span>(</span>
  <span>melodic_pitch_motif</span><span>,</span>
  <span>melodic_duration_motif</span><span>,</span>
  <span>accompaniment_pitch_motif</span><span>,</span>
  <span>accompaniment_duration_motif</span><span>,</span>
  <span>harmonies</span><span>,</span>
  <span>scale</span>
<span>)</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_replicate.png" alt=""/></p>
<p>This is pretty close. We can make the function <code>generate_beethoven_sonata()</code> more concise, or more fine-tuned to generate a score closer to the original one, but I will stop here.</p>
<p>The most interesting thing is once we have captured the generative mechanism with function <code>generate_beethoven_sonata()</code>, we can supply other inputs to it to generate different music. For example,</p>
<div><pre tabindex="0"><code data-lang="python"><span>melodic_pitch_motif</span> <span>=</span> <span>[</span><span>65</span><span>,</span> <span>67</span><span>,</span> <span>72</span><span>,</span> <span>73</span><span>,</span> <span>79</span><span>,</span> <span>77</span><span>]</span>
<span>melodic_duration_motif</span> <span>=</span> <span>[</span><span>1</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>,</span> <span>2</span><span>,</span> <span>2</span><span>]</span>
<span>scale</span> <span>=</span> <span>[</span><span>5</span><span>,</span> <span>7</span><span>,</span> <span>10</span><span>,</span> <span>0</span><span>,</span> <span>1</span><span>]</span>

<span>harmonies</span> <span>=</span> <span>[</span>
  <span>[</span><span>5</span><span>,</span> <span>7</span><span>,</span> <span>8</span><span>,</span> <span>0</span><span>],</span>
  <span>[</span><span>0</span><span>,</span> <span>1</span><span>,</span> <span>7</span><span>,</span> <span>10</span><span>],</span>
  <span>[</span><span>5</span><span>,</span> <span>7</span><span>,</span> <span>8</span><span>,</span> <span>0</span><span>],</span>
  <span>[</span><span>0</span><span>,</span> <span>1</span><span>,</span> <span>7</span><span>,</span> <span>10</span><span>],</span>
  <span>[</span><span>5</span><span>,</span> <span>7</span><span>,</span> <span>8</span><span>,</span> <span>0</span><span>],</span>
  <span>[</span><span>5</span><span>,</span> <span>7</span><span>,</span> <span>10</span><span>,</span> <span>1</span><span>],</span>
  <span>[</span><span>0</span><span>,</span> <span>1</span><span>,</span> <span>7</span><span>,</span> <span>10</span><span>]</span>
<span>]</span>
</code></pre></div><p><img src="https://flujoo.github.io/en/my-approach-to-automatic-musical-composition/assets/beethoven_sonata_vary.png" alt=""/></p>
<audio controls="">
  <source src="assets/beethoven_sonata_vary.mp3" type="audio/mpeg"/>
</audio>
<p>This might be how a Japanese Beethoven would have composed it.</p>

</div></div>
  </body>
</html>
