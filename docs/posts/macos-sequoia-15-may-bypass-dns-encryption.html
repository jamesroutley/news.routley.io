<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.obdev.at/blog/warning-macos-sequoia-15-may-bypass-dns-encryption/">Original</a>
    <h1>macOS Sequoia 15 may bypass DNS encryption</h1>
    
    <div id="readability-page-1" class="page"><div>

<main role="main">
<article>

<section>
<figure>
<img src="https://www.obdev.at/Images/odblog/nhi5-DNS.png"/>
</figure>

<p><strong>The problem discussed here turned out to be specific to Little Snitch 6.1 and not a general issue in macOS. It has already been fixed in Little Snitch 6.1.1.</strong></p>
<p>See the end of the article for details.</p>

<p>When you enter a hostname in your web browser (e.g., apple.com), that name must first be translated into an IP address so your computer can connect to the server. This lookup is usually performed unencrypted, meaning your Internet provider and other parties monitoring your connection can see which sites you visit. To protect these lookups from prying eyes, Little Snitch 6 offers a new feature: DNS encryption. With DNS encryption enabled, all name lookups are routed through Little Snitch and performed in encrypted form.</p>
<p>For this purpose, Little Snitch registers a DNS proxy. macOS then sends <strong>all</strong> DNS requests to that proxy, which in turn performs the lookup in encrypted form. The key point here is that <strong>all</strong> requests must be routed through the proxy.</p>

<p>While investigating a DNS-related issue on macOS 15 Sequoia, we discovered that some DNS requests—particularly those made via certain low-level legacy APIs—were not being received by our proxy!</p>
<p>There appears to be a bug in macOS Sequoia causing <strong>some</strong> requests to bypass the installed DNS proxy and be sent unencrypted to the system’s default name server instead.</p>
<p>Note that this bug likely affects any kind of DNS proxy, not just Little Snitch.</p>
<p>So, if you rely on the new DNS encryption feature of Little Snitch 6, or if you are using another third-party DNS proxy, be aware that some DNS lookups may bypass the proxy until Apple provides a fix in a future macOS update.</p>
<p><strong>Note:</strong> DNS lookups performed via higher-level APIs do not appear to be affected by this bug. For example, your web-browsing in Safari or Chrome still fully benefits from encrypted lookups. Firefox, on the other hand, does seem to be affected.</p>

<ol>
<li>Enable DNS encryption in Little Snitch &gt; Settings.</li>
<li>Start <a href="https://www.wireshark.org">Wireshark</a> with a capture filter for <code>port 53</code>.</li>
<li>Run the following code in an Xcode playground:</li>
</ol>
<pre><code>import Foundation

let domain = &#34;dnsproxytest.com&#34;
var result: UnsafeMutablePointer&lt;addrinfo&gt;?
let status = getaddrinfo(domain, nil, nil, &amp; result)</code></pre>
<p>You will notice that the lookup for <code>dnsproxytest.com</code> can be seen in Wireshark in unencrypted form on UDP port 53 (the default for unencrypted lookups).</p>
<p>Additionally, you will see that Little Snitch Network Monitor does not display any traffic for the lookup because the lookup completely bypasses the network filter!</p>
<p>We have reported this bug to Apple and hope for a fix soon. Please stay tuned, we will keep you updated here.</p>

<p>After further investigation, we found that this bug has already existed at least since macOS 14.5 Sonoma (maybe even earlier, but we currently don’t have access to an older 14.x system for testing).</p>

<p>After further investigation, we found that this bug only affects the DNS proxy of Little Snitch 6.1. <strong>It’s not a general problem of DNS proxies in macOS</strong>. We will therefore be able to fix this issue at our end and provide an updated version of Little Snitch 6 later today.</p>

<p>The issue has been fixed in Little Snitch 6.1.1.</p></section>
</article>
</main>

			</div></div>
  </body>
</html>
