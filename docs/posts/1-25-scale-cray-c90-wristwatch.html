<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://www.chrisfenton.com/1-25-scale-cray-c90-wristwatch/">Original</a>
    <h1>1/25-Scale Cray C90 Wristwatch</h1>
    
    <div id="readability-page-1" class="page"><div id="content">

	<section id="primary">
		<main id="main" role="main">
					
			
<article id="post-842" class="page">

	
	<!-- .entry-header -->

	<div>

		
<figure><a href="http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_watch.jpg"><img width="800" height="775" src="http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_watch.jpg" alt="" srcset="http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_watch.jpg 800w, http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_watch-300x291.jpg 300w, http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_watch-768x744.jpg 768w" sizes="(max-width: 800px) 100vw, 800px"/></a><figcaption>“Ah, it’s time to order a more practical watch!”</figcaption></figure>



<p>Welcome to the latest edition of my on-going series in Cray-related computational necromancy. This was another just-for-fun project. Over the many years Andras and I have been working on our Cray revival efforts, there has always been a big lag between our available software (and <a href="https://www.modularcircuits.com/blog/articles/the-cray-files/">Andras’ amazing simulator</a>) and my FPGA-compatible Verilog implementation. My free time and interests have oscillated wildly over the years, and implementing and debugging hardware is generally everything-intensive. My original cycle-accurate (but buggy) Cray-1 RTL gradually morphed first into a binary-compatible, but less-accurate Cray X-MP (which is mostly just a Cray-1 with 24-bit addresses instead of 22-bit), and finally into a binary-compatible and not-at-all cycle-accurate Cray Y-MP/C90/J90 core (which is mostly just a Cray-1 with 32-bit addresses). During the final transition, it got a full re-write in System Verilog and a vast simplification in the hopes I’ll someday actually be able to boot up UNICOS on it. That hasn’t quite happened yet, but it’s far enough along that I felt it was ready to play around with and make it into a ‘real’ project. What to do with this? A Cray Wristwatch, of course!</p>



<p>A benefit of the extremely slow pace and long duration of my Cray-related work is the ongoing march of Moore’s law in the background. Very capable FPGA boards are now cheaper and smaller, and it seemed time to give another scale model Cray Supercomputer a shot. As I mentioned, this one isn’t quite as cycle-accurate (or CPU-count accurate), but I’m still quite happy with how it turned out. </p>



<h3>But . . . Why??</h3>



<p>I had a tiny Cray supercomputer and a round OLED display just looking for a project, and a <a href="https://en.wikipedia.org/wiki/Cray_C90">Cray C916</a> just happens to be the right shape for the supercomputer wristwatch you’ve always dreamed about. If you wanted something practical, go read someone else’s blog.</p>



<h3>How is this different from the Cray-1?</h3>



<p>The Cray “Parallel Vector Processor” (PVP) line that extended from the Cray-1A in 1976 all the way to the final <a href="https://en.wikipedia.org/wiki/Cray_X1">Cray X1E</a> in 2005 really did maintain quite a bit of compatibility. The main differences between them were the extension from 22 address bits with the original Cray-1 to 24 bits with the X-MP and 32 bits with the X-MP/EA and Y-MP machines. As Cray PVP machines are only 64-bit word addressable (bytes? what are those?), 32-bit addresses give you access to a respectable 32 gigabytes of memory. </p>



<p>Later machines also switched from 64-bit “Cray” floating point to IEEE double-precision 64-bit floating point and added a ‘bit matrix multiply’ functional unit, but aside from that there were architecturally few differences across ~30 years of development. So programming my Cray J90 core is pretty much identical to the Cray-1, ignoring the address widths (this means the actual Address Registers were extended from 24 bits on the Cray-1 to 32-bits in my J90 core). </p>



<p>This was a from-scratch re-write with the intent of it being both debuggable and maintainable by me though, so I changed quite a few of the micro-architectural details with those goals in mind. Vector chaining is gone, the vector registers are now implemented in a big 2R1W SRAM, and the instruction cache maps much more nicely to the available block RAMs in my FPGA. Generally cleaner, simpler, and a little slower (but I did manage to get the clock all the way up to the 105 MHz that the real J90 ran at!). </p>



<h3>System Architecture</h3>



<p>The heart of the system is a <a href="https://store.digilentinc.com/cmod-a7-breadboardable-artix-7-fpga-module/">Diligent CMOD-A7 FPGA board</a>. The FPGA contains the Cray CPU core running at a respectable 105 MHz (actually matching the clock speed of the J90, although still fairly far from the 244 MHz of the real C90), a few KW of SRAM and a pair of DMA channels connected to a SPI interface via FIFOs. A Teensy 3.6 microcontroller serves as the ‘Front-End’ processor, and controls the reset signals and the SPI interface going to the J90. It also drives a neato circular OLED display I picked up (the previous generation of <a href="https://4dsystems.com.au/products/featured-products/pixxilcd-13p2">this one</a>, I think). In practice, the Teensy dead-starts the J90 by initializing its memory via SPI and taking it out of reset, and then it just dumps frames of data from the J90 DMA engine, converts them to an appropriately formatted image and dumps them to the display.</p>



<h3>Software</h3>



<p>My work with supercomputers both modern and historical has made me quite fond of N-body gravity simulations – to show off the vector prowess of my J90 core, my wristwatch runs a full n-body simulation of Jupiter and 63 of its moons. That’s right! Each body gravitationally interacts with all 63 other bodies. Remarkably, through effective use of vector registers, the whole simulation requires only 127 carefully-chosen instructions, and is able to sustain 40 MFLOPS!</p>



<p>As I still don’t really have a proper development environment, I first wrote my program in Python using some simple primitives mimicking the Cray vector instructions. I then modified that to spit out some simple machine code, and ran it on my RTL simulator verify that nothing blew up numerically. At that point I was able to boot it on the real FPGA board and run it for a few hours to verify the stability.</p>



<figure><img loading="lazy" width="756" height="655" src="http://www.chrisfenton.com/wp-content/uploads/2021/01/IMG_1428.png" alt="" srcset="http://www.chrisfenton.com/wp-content/uploads/2021/01/IMG_1428.png 756w, http://www.chrisfenton.com/wp-content/uploads/2021/01/IMG_1428-300x260.png 300w" sizes="(max-width: 756px) 100vw, 756px"/></figure>



<h3>But how do you tell the time?</h3>



<p>With great difficulty. The display shows a free-running simulation of Jupiter and 63 of its moons. For convenience, I just plot the X/Y coordinates of each moon in the ecliptic plane. The ephemerides come from the <a href="https://ssd.jpl.nasa.gov/horizons.cgi">HORIZONS</a> server that NASA operates, at a specified date and time. The J90 just dumps a new frame whenever the Teensy has pulled the previous one, so with a <em>teensy</em> (ha!) bit of calibration on the micro controller side, it would be pretty easy to have the frames dumped in ‘real time’, which, knowing the starting time and date, would allow you to not-at-all-easily infer the current time by looking at the positions of Jupiter’s moons. Which is exactly what I was going for with my Supercomputer Wristwatch – using it should be as incomprehensible as my motivation for creating it in the first place!</p>



<h3>Why a C90?</h3>



<figure><a href="http://www.chrisfenton.com/wp-content/uploads/2024/06/cray_c90.jpg"><img loading="lazy" width="250" height="283" src="http://www.chrisfenton.com/wp-content/uploads/2024/06/cray_c90.jpg" alt=""/></a><figcaption>A 25:1 Replica of my wristwatch</figcaption></figure>



<p>Although it does maintain binary compatibility, the real Cray Y-MP C916 was a 244 MHz, 16-CPU monster – my 1/25-scale version is a mere single-CPU running at 105 MHz (and lacks other performance enhancements like dual-issue vector pipelines) . . . this model was mostly chosen because of the convenient circular dome in the middle that could hold my nifty OLED watch face. </p>



<p>I designed the model and built it with a 3D printer, carefully trimmed my circuit boards to fit, mounted the display, and still had enough room for a battery left over. </p>



<h2>The Final Product</h2>



<p>I love how this project turned out – it’s adorable, it’s programmable, and it pushes the boundaries of uselessness and complexity. The final case can accommodate a <a href="https://en.wikipedia.org/wiki/Watch_strap">NATO-style wrist strap </a> and has a built-in battery charger, but in practice it makes a better desk novelty than a watch. </p>



<figure><a href="http://www.chrisfenton.com/wp-content/uploads/2024/06/trimmed_boards.jpg"><img loading="lazy" width="640" height="853" src="http://www.chrisfenton.com/wp-content/uploads/2024/06/trimmed_boards.jpg" alt="" srcset="http://www.chrisfenton.com/wp-content/uploads/2024/06/trimmed_boards.jpg 640w, http://www.chrisfenton.com/wp-content/uploads/2024/06/trimmed_boards-225x300.jpg 225w" sizes="(max-width: 640px) 100vw, 640px"/></a><figcaption>The final (very trimmed down) board</figcaption></figure>



<figure><a href="http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_underside.jpg"><img loading="lazy" width="640" height="853" src="http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_underside.jpg" alt="" srcset="http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_underside.jpg 640w, http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_underside-225x300.jpg 225w" sizes="(max-width: 640px) 100vw, 640px"/></a><figcaption>A densely packed C90.</figcaption></figure>



<figure><a href="http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_complete.jpg"><img loading="lazy" width="1024" height="1016" src="http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_complete-1024x1016.jpg" alt="" srcset="http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_complete-1024x1016.jpg 1024w, http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_complete-300x298.jpg 300w, http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_complete-150x150.jpg 150w, http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_complete-768x762.jpg 768w, http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_complete-1536x1524.jpg 1536w, http://www.chrisfenton.com/wp-content/uploads/2024/06/j90_complete.jpg 1991w" sizes="(max-width: 1024px) 100vw, 1024px"/></a><figcaption>The final product</figcaption></figure>

		
	</div><!-- .entry-content -->

</article>

<!-- #comments -->
		
		</main><!-- #main -->
	</section><!-- #primary -->
	
	
	<!-- #secondary -->



	</div></div>
  </body>
</html>
