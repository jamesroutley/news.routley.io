<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://journal.hexmos.com/training-data-poisoning/?src=hn">Original</a>
    <h1>How ML Model Data Poisoning Works in 5 Minutes</h1>
    
    <div id="readability-page-1" class="page"><section>
        <!--kg-card-begin: html--><p>Training data poisoning is an attack type common in LLMs (Large Language Models). It deals with injecting harmful data into the training data, which breaks the ML model causing wrong results.</p>

<p>If this harmful data is not properly detected or flagged, then the model will be vulnerable to attacks and poisoned information may be surfaced to users.</p>

<p>It compromises the model and the application. Risks like performance degradation, downstream software exploitation, and reputational damage.</p>

<h2 id="why-data-poisoning-is-problematic">Why data poisoning is problematic</h2>

<p>These are three real-world data poisoning attacks.</p>

<h3 id="case-study-of--microsoft-chatbot">Case study of  Microsoft Chatbot</h3>

<p>In 2016, Microsoft released their chatbot named <a href="https://atlas.mitre.org/studies/AML.CS0009?ref=journal.hexmos.com">Tay</a> on Twitter to learn from human interactions by posting comments. But after the release, it started to act crazy.</p>

<p>It started using vulgar language and making hateful comments. This was one of the first incidents of data poisoning.</p>

<h3 id="artists-vs-image-generators">Artists vs. image generators.</h3>

<p>Artists worldwide were hit due to the rise of image-generation models. Image generator models are run by scraping artwork from different websites.</p>

<p>The artist community started to take measures against AI for copying their original work.</p>

<p>If it gets scraped into an AI training set, it can cause the resulting model to break in unpredictable ways.</p>

<p>If you want to have cat images labeled as dogs, you prompt the model with a simple prompt like an image of a cat. The image it creates will be a very typical representation of what the model understood to be a cat.</p>

<p>If this image is seen in training, it will have a very high influence on the understanding of the concept cat (a much higher than rather untypical image of cats have). Hence, if you poison that image, you will get a very large effect on the model’s training.</p>

<p><a target="_blank" rel="noopener noreferrer" href="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/721e8e9d6e5f671d1c66754c79b99741e628c0f998b78858f5f21c45ea644f27.jpeg?ref=journal.hexmos.com"><img src="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/721e8e9d6e5f671d1c66754c79b99741e628c0f998b78858f5f21c45ea644f27.jpeg" alt="artist_poison"/></a></p>

<h3 id="virus-total-incident">Virus total incident</h3>

<p>There have been <a href="https://atlas.mitre.org/studies/AML.CS0002?ref=journal.hexmos.com">instances</a> when big companies have been compromised by a data poisoning attack. Virus Total analyzes suspicious files and URLs to detect types of malware and malicious content.</p>

<p>Here an attacker executed an attack by employing  <a href="https://github.com/a0rtega/metame?ref=journal.hexmos.com">metame</a>, a metamorphic code engine designed for arbitrary executables, to create &#34;mutant&#34; variants of a malware sample from a prevalent ransomware family.</p>

<p>These &#34;mutant&#34; samples were then uploaded to a platform, leading to several vendors classifying them as part of the ransomware family, despite many of them being unable to execute.</p>

<p>This effectively poisoned the dataset used by ML model to identify and classify the ransomware family, resulting in misclassifications of the viruses.</p>

<h2 id="different-attack-scenarios">Different Attack scenarios.</h2>

<p>Data poisoning against Large language models is caused due to adding wrong data in its training stages. This causes the model to generate wrong results as we saw in the above examples.</p>

<p><a target="_blank" rel="noopener noreferrer" href="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/18b50482daf00bbd01cedc4bc9337efd2d6285519d6b052a8dba02d01d85d8f0.png?ref=journal.hexmos.com"><img src="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/18b50482daf00bbd01cedc4bc9337efd2d6285519d6b052a8dba02d01d85d8f0.png" alt="poison data"/></a></p>

<p>These kinds of attacks are very difficult to fix and stealthy, it&#39;s difficult to trace back the root cause. Because models are getting retrained with newly collected data, depending on their intended use and their owner&#39;s preference.</p>

<p>Since poisoning usually happens over time, and over some number of training cycles, it is hard to tell when prediction accuracy has started to shift.</p>

<p>A version of the model from before the attack started would need to be retrained. When dealing with large quantities of data and a large number of attacks, however, retraining in such a way is simply not feasible and the models never get fixed.</p>

<p>This vulnerability is ranked 3rd in OWASP&#39;s top 10 for Large Language Models</p>

<p>The impacts of this vulnerability are :</p>

<p><strong>Degrading Performance</strong>: Reduced accuracy across various tasks as the model&#39;s internal logic is corrupted.</p>

<p><strong>Bias and Discrimination</strong>: Poisoned data can skew the model&#39;s results, potentially leading to discriminatory or harmful output.</p>

<p><strong>Embedded Backdoors</strong>: For targeted attacks, hidden triggers can be introduced, making the LLM produce a specific incorrect response whenever that trigger is presented. More about triggers in the below section.</p>



<h3 id="backdoors">Backdoors</h3>

<p>Backdoor attacks cause a model to misclassify training data samples that contain a trigger. Trigger is a visual feature in images or a particular character sequence in the natural language setting.</p>

<p>For example, one might tamper with training images so that a vision system fails to identify any person wearing a shirt with the trigger symbol printed on it.</p>

<p>In this threat model, the attacker modifies data at both training time (by placing poisons) and at inference time (by inserting the trigger).</p>

<p>The trigger is a pattern that is easily applied to any input — e.g., a small patch or sticker in the case of images or a specific phrase in the case of natural language processing</p>

<p><a target="_blank" rel="noopener noreferrer" href="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/9a7c4e95dfb5a65e50391051be0a040bf05151ac0f07fec58352a859269d3c4a.png?ref=journal.hexmos.com"><img src="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/9a7c4e95dfb5a65e50391051be0a040bf05151ac0f07fec58352a859269d3c4a.png" alt="image"/></a></p>

<p><em>The small box under the STOP signal is a trigger</em></p>

<h3 id="prevent-and-detect">Prevent and detect</h3>

<p>Developers need to focus on measures that could either block attack attempts or detect malicious inputs before the next training cycle happens—things like :</p>

<ul>
<li>
<p><strong>Input validity checking</strong>: This can be done by implementing data validation checks and employing multiple data labelers to validate the accuracy of the data labeling.</p>
</li>
<li>
<p><strong>Anomaly detection</strong>: Use anomaly detection techniques to detect any abnormal behavior in the training data, such as sudden changes in the data distribution or data labeling. These techniques can be used to detect data poisoning attacks early on.</p>
</li>
</ul>

<p>Developers need to limit the public release of technical project details including data, algorithms, model architectures, and model checkpoints that are used in production.</p>

<p>Establish access controls on internal model registries and limit internal access to production models. Limit access to training data only to approved users.</p>

<p>Eg:  Restrictions can be placed on how many inputs provided by a unique user are accepted into the training data or with what weight. Newly trained classifiers can be compared to previous ones to compare their outputs by using dark launches—(rolling them out to only a small subset of users).</p>

<p>To perform data poisoning, attackers also need to gain information about how the model works, so it’s important to leak as little information as possible and have strong access controls in place for both the model and the training data.</p>

<h2 id="on-the-attackers-shoes">On the attacker&#39;s Shoes.</h2>

<h3 id="number-predictor-poisoning">Number predictor poisoning</h3>

<p>We use a training set of 2000 images and a testing set of 1000 images. Each image is a handwritten digit from 0 through 9, and the task is to identify the digit.</p>

<pre tabindex="0"><code><span><span><span>from</span> sklearn.datasets <span>import</span> fetch_openml
</span></span><span><span><span>from</span> sklearn.svm <span>import</span> SVC
</span></span><span><span><span>import</span> numpy 
</span></span><span><span>
</span></span><span><span><span># Fetch the mnist_784 model original data</span>
</span></span><span><span>mnist <span>=</span> fetch_openml(<span>&#39;mnist_784&#39;</span>, as_frame<span>=</span><span>False</span>, parser<span>=</span><span>&#34;auto&#34;</span>)
</span></span><span><span>print(mnist<span>.</span>DESCR)
</span></span><span><span>X, y <span>=</span> mnist<span>.</span>data, mnist<span>.</span>target
</span></span></code></pre>
<p>Prepare shorter training and testing sets. The first loop adds 2000 samples to the training set, while the second loop adds 1000 samples to the testing set.</p>

<pre tabindex="0"><code><span><span>
</span></span><span><span>X_train_orig <span>=</span> numpy<span>.</span>array([[]])<span>.</span>reshape(<span>0</span>, <span>784</span>)
</span></span><span><span>y_train_orig <span>=</span> numpy<span>.</span>array([])
</span></span><span><span>X_test_orig <span>=</span> numpy<span>.</span>array([])<span>.</span>reshape(<span>0</span>, <span>784</span>)
</span></span><span><span>y_test_orig <span>=</span> numpy<span>.</span>array([])
</span></span><span><span>
</span></span><span><span><span>for</span> i <span>in</span> range(<span>2000</span>):
</span></span><span><span>  X_train_orig <span>=</span> numpy<span>.</span>concatenate((X_train_orig, [X[i]]), axis<span>=</span><span>0</span>)
</span></span><span><span>  y_train_orig <span>=</span> numpy<span>.</span>append(y_train_orig, y[i])
</span></span><span><span>
</span></span><span><span><span>for</span> i <span>in</span> range(<span>1000</span>):
</span></span><span><span>  X_test_orig <span>=</span> numpy<span>.</span>concatenate((X_test_orig, [X[i<span>+</span> <span>60000</span>]]), axis<span>=</span><span>0</span>)
</span></span><span><span>  y_test_orig <span>=</span> numpy<span>.</span>append(y_test_orig, y[i <span>+</span> <span>60000</span>])
</span></span><span><span>    
</span></span></code></pre>
<p>This code snippet creates a Support Vector Machine (SVM) classifier (svm_clf) using scikit-learn&#39;s SVC class with a specified random state. It then trains the SVM classifier using the training data.</p>

<pre tabindex="0"><code><span><span>svm_clf <span>=</span> SVC(random_state<span>=</span><span>42</span>)
</span></span><span><span>svm_clf<span>.</span>fit(X_train_orig, y_train_orig)
</span></span><span><span>
</span></span><span><span><span># Print results</span>
</span></span><span><span>print(<span>&#34;Correct</span><span>\t</span><span>Predicted&#34;</span>)
</span></span><span><span><span>for</span> i <span>in</span> range(<span>5</span>):
</span></span><span><span>  print(y_test_orig[i], <span>&#34;</span><span>\t</span><span>&#34;</span>, svm_clf<span>.</span>predict([X_test_orig[i]])[<span>0</span>])
</span></span><span><span>
</span></span></code></pre>
<p>After training, it prints the results by predicting the labels for the first 5 samples from the testing set (X_test_orig and y_test_orig) using the trained SVM classifier</p>

<p><a target="_blank" rel="noopener noreferrer" href="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/f30c0d85316503a1147e568e09e0b0061bc7778a00b2ec2480e4205abd33424a.png?ref=journal.hexmos.com"><img src="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/f30c0d85316503a1147e568e09e0b0061bc7778a00b2ec2480e4205abd33424a.png" alt="image"/></a></p>

<h3 id="poisoning-100-of-the-1s">Poisoning 100 of the 1&#39;s</h3>

<p>Execute these commands to prepare a y_train_poisoned list with the first 100 1&#39;s changed to 2&#39;s:</p>

<pre tabindex="0"><code><span><span>
</span></span><span><span>y_train_poisoned <span>=</span> y_train_orig<span>.</span>copy()
</span></span><span><span>
</span></span><span><span>count_before <span>=</span> [<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>]
</span></span><span><span>count_after  <span>=</span> [<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>]
</span></span><span><span>
</span></span><span><span><span>for</span> yi <span>in</span> y_train_poisoned:
</span></span><span><span>  count_before[int(yi)] <span>+=</span> <span>1</span>
</span></span><span><span>
</span></span></code></pre>
<p>This modifies the y_train_poisoned array by changing the label &#39;1&#39; to &#39;2&#39; for the first 100 occurrences of &#39;1&#39; in the array. It keeps track of the number of poisoned labels using the number_poisoned variable and breaks the loop once 100 labels have been poisoned.</p>

<pre tabindex="0"><code><span><span>
</span></span><span><span>number_poisoned <span>=</span> <span>0</span>
</span></span><span><span><span>for</span> i <span>in</span> range(<span>2000</span>):
</span></span><span><span>  <span>if</span> y_train_poisoned[i] <span>==</span> <span>&#39;1&#39;</span>:
</span></span><span><span>    y_train_poisoned[i] <span>=</span> <span>&#39;2&#39;</span>
</span></span><span><span>    number_poisoned <span>+=</span> <span>1</span>
</span></span><span><span>  <span>if</span> number_poisoned <span>==</span> <span>100</span>:
</span></span><span><span>    <span>break</span>
</span></span><span><span>
</span></span></code></pre>
<p>calculates and prints the count of each digit (0-9) in the original training labels (count_before) and the modified/poisoned training labels (count_after).</p>

<pre tabindex="0"><code><span><span>
</span></span><span><span><span>for</span> yi <span>in</span> y_train_poisoned:
</span></span><span><span>  count_after[int(yi)] <span>+=</span> <span>1</span>
</span></span><span><span>
</span></span><span><span>print(<span>&#34;Correct</span><span>\t</span><span>Before</span><span>\t</span><span>After&#34;</span>)
</span></span><span><span><span>for</span> i <span>in</span> range(<span>10</span>):
</span></span><span><span>  print(i, <span>&#34;</span><span>\t</span><span>&#34;</span>, count_before[i], <span>&#34;</span><span>\t</span><span>&#34;</span>, count_after[i])
</span></span><span><span>
</span></span></code></pre>
<p><a target="_blank" rel="noopener noreferrer" href="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/7472243e59ce2cc7de0ead82e543df7fc0eff5b8b97152891d772d270eb48307.png?ref=journal.hexmos.com"><img src="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/7472243e59ce2cc7de0ead82e543df7fc0eff5b8b97152891d772d270eb48307.png" alt="image"/></a></p>

<h3 id="training-from-the-poisoned-data">Training from the Poisoned Data</h3>

<p>Execute these commands to create and train a model on the poisoned data, and display its predictions.</p>

<p>This creates another SVM classifier (svm_clf_poisoned) using scikit-learn&#39;s SVC class with a specified random state. It then trains this classifier using the poisoned training labels</p>

<pre tabindex="0"><code><span><span>svm_clf_poisoned <span>=</span> SVC(random_state<span>=</span><span>42</span>)
</span></span><span><span>svm_clf_poisoned<span>.</span>fit(X_train_orig, y_train_poisoned)
</span></span><span><span>
</span></span><span><span>prediction_correct <span>=</span> [<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>]
</span></span><span><span>prediction_incorrect <span>=</span> [<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>,<span>0</span>]
</span></span><span><span>
</span></span></code></pre>
<p>This code snippet predicts the labels for the first 1000 samples from the testing set using the trained SVM classifier with poisoned labels. It then updates the counts of correct and incorrect predictions for each digit in the prediction_correct and prediction_incorrect lists based on whether the predicted label matches the actual label.</p>

<p>In the results, we see that the poisoning was successful and we were able to poison the value of &#39;2&#39;. We get 33 Incorrect values for &#39;2&#39;.</p>

<pre tabindex="0"><code><span><span><span>for</span> i <span>in</span> range(<span>1000</span>):
</span></span><span><span>  p <span>=</span> svm_clf_poisoned<span>.</span>predict([X_test_orig[i]])[<span>0</span>]
</span></span><span><span>  <span>if</span> p <span>==</span> y_test_orig[i]:
</span></span><span><span>    prediction_correct[int(p)] <span>+=</span> <span>1</span>
</span></span><span><span>  <span>else</span>:
</span></span><span><span>    prediction_incorrect[int(p)] <span>+=</span> <span>1</span>
</span></span><span><span>print(<span>&#34;Value</span><span>\t</span><span>Correct</span><span>\t</span><span>Incorrect&#34;</span>)
</span></span><span><span><span>for</span> i <span>in</span> range(<span>10</span>):
</span></span><span><span>  print(i, <span>&#34;</span><span>\t</span><span>&#34;</span>, prediction_correct[i], <span>&#34;</span><span>\t</span><span>&#34;</span>, prediction_incorrect[i])
</span></span><span><span>
</span></span></code></pre>
<p><a target="_blank" rel="noopener noreferrer" href="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/f510bf8636df7208c05cd7c1434d667ca6f616d92ad6b04a3bb3b0bf4393e13f.png?ref=journal.hexmos.com"><img src="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/f510bf8636df7208c05cd7c1434d667ca6f616d92ad6b04a3bb3b0bf4393e13f.png" alt="image"/></a></p>

<p>Resource source: <a href="https://samsclass.info/129S/proj/ML106.htm?ref=journal.hexmos.com">here</a></p>

<h2 id="conclusion">Conclusion</h2>

<p>That concludes our basic description of data poisoning attacks. You can find a collection of papers and resources on this topic from this github repo - <a href="https://github.com/corca-ai/awesome-llm-security?ref=journal.hexmos.com">Awsome LLM Security</a></p>

<p>Checkout our other Articles on AI/ML:</p>

<ol>
<li><a href="https://journal.hexmos.com/train-llm-faster/">Training LLMs Taking Too Much Time? Technique you need to know to train it faster</a></li>
<li><a href="https://journal.hexmos.com/ai-business-usecases-you-cannot-ignore/">AI/ML Business Use Cases You Cannot Afford To Ignore</a></li>
<li><a href="https://journal.hexmos.com/ai-attendance-system-for-teams/">How we made an AI Attendance System for better Team Performance</a></li>
</ol>

<div id="hex-ad2-wrapper">
  <p><a href="https://hexmos.com/feedzap?utm_source=https://journal.hexmos.com/ai-attendance-system-for-teams/&amp;utm_medium=bannerad&amp;utm_campaign=fz" target="_blank">
      <img src="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/2c0a978c01c88cc64ba41f36a5d717c4f380a3f922f465ab9b945ee41eecc870.png"/>
      </a>
   </p>
   <div id="hex-ad2-div2">
    <div id="hex-ad2-card-content">
      <p><b>FeedZap: Read 2X Books This Year</b></p>
      <p>
        FeedZap helps you
        <b>consume your books through a healthy, snackable feed</b>, so that you
        can read more with less time, effort and energy.
      </p>
      </div></div></div>
<a href="https://hexmos.com/feedzap?utm_source=https://journal.hexmos.com/ai-attendance-system-for-teams/&amp;utm_medium=bannerad&amp;utm_campaign=fz" target="_blank">
</a>
<p><a href="https://hexmos.com/feedzap?utm_source=https://journal.hexmos.com/ai-attendance-system-for-teams/&amp;utm_medium=bannerad&amp;utm_campaign=fz" target="_blank">
  </a><a href="https://www.linkedin.com/company/hexmos?ref=journal.hexmos.com" target="_blank">
    <img src="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/da11375afb47769cab987d89ac81a9a2ca8d863fa62267ebd86d64ff981a3981.gif"/>
  </a>
  <a href="https://twitter.com/HexmosTech?ref=journal.hexmos.com" target="_blank">
    <img src="https://journal-wa6509js.s3.ap-south-1.amazonaws.com/4f3ad2e999c95ddfb3e4e1a7c683e9bbd4866f3e7b4255e68c4fc553da5ea82e.gif"/>
  </a>
</p><!--kg-card-end: html-->
    </section></div>
  </body>
</html>
