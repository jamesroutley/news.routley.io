<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/hadashiA/MRubyD">Original</a>
    <h1>MRubyD: A new mruby virtual machine implemented in pure C#</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">MRubyD is a new <a href="https://github.com/mruby/mruby">mruby</a> virtual machine implemented in pure C#. The name &#34;MRubyD&#34; stands for <em>mruby for <a href="https://dotnet.microsoft.com" rel="nofollow">dotnet</a></em> and pays homage to the well-known alternative implementation mruby/c. Designed with seamless integration in mind for C#-based game engines, and emphasize ruby level compatibility. MRubyD leverages the latest C# features for high performance and high extensibility.</p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p dir="auto">This library is currently in preview</p>
</div>

<ul dir="auto">
<li>
<p dir="auto"><strong>Implemented in C#</strong></p>
</li>
<li>
<p dir="auto"><strong>High Performance</strong></p>
</li>
<li>
<p dir="auto"><strong>High compatibility with Ruby-level APIs  (Work in progress)</strong>
It is intended for use in software with a certain amount of resources, such as games. For this reason, we are focusing on Ruby API compatibility.
At release, all opcodes are implemented and pass the <a href="https://github.com/mruby/mruby/blob/master/test/t/syntax.rb">syntax.rb</a> tests from the mruby repository.</p>
</li>
<li>
<p dir="auto"><strong>Rich Library Integration &amp; Extensibility</strong></p>
</li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">Limitations (Preview Release)</h2><a id="user-content-limitations-preview-release" aria-label="Permalink: Limitations (Preview Release)" href="#limitations-preview-release"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This release is a preview version and comes with the following constraints:</p>
<ul dir="auto">
<li>Built-in types and methods are still being implemented.
<ul dir="auto">
<li>Please refer to <a href="https://github.com/hadashiA/MRubyD/tree/main/tests/MRubyD.Tests/ruby/test">ruby test</a>, etc., for currently supported methods.</li>
<li>We are working on supporting all methods that are built into mruby by default.</li>
</ul>
</li>
<li><code>private</code> and <code>protected</code> visibitily is not yet implemented. (mruby got support for this in 3.4)</li>
<li>This project provides only the VM implementation; it does not include a compiler. To compile mruby scripts, you need the native mruby-compiler.</li>
</ul>

<ul>
<li> Implement builtin ruby libs</li>
<li> Support Fiber</li>
<li> All ruby code port to C# (for performance reason)</li>
<li> Unity Integration</li>
<li> <a href="https://github.com/hadashiA/VitalRouter">VitalRouter.MRuby</a> for the new version.</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="dotnet add package MRubyD"><pre>dotnet add package MRubyD</pre></div>


<div dir="auto" data-snippet-clipboard-copy-content="def fibonacci(n)
  return n if n &lt;= 1 
  fibonacci(n - 1) + fibonacci(n - 2)
end

fibonacci 10"><pre><span>def</span> <span>fibonacci</span><span>(</span><span>n</span><span>)</span>
  <span>return</span> <span>n</span> <span>if</span> <span>n</span> &lt;= <span>1</span> 
  <span>fibonacci</span><span>(</span><span>n</span> - <span>1</span><span>)</span> + <span>fibonacci</span><span>(</span><span>n</span> - <span>2</span><span>)</span>
<span>end</span>

<span>fibonacci</span> <span>10</span></pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="$ mrbc -o fibonaci.mrbc fibonacci.rb"><pre>$ mrbc -o fibonaci.mrbc fibonacci.rb</pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="using MRubyD;

// Read the .mrb byte-code.
var bytes = File.ReadAllBytes(&#34;fibonacci.mrb&#34;);

// initialize state
var state = MRubyState.Create();

// execute bytecoe
var result = state.Exec(bytes);

result.IsInteger    //=&gt; true
result.IntegerValue //=&gt; 55"><pre><span>using</span> <span>MRubyD</span><span>;</span>

<span>// Read the .mrb byte-code.</span>
<span>var</span> <span>bytes</span> <span>=</span> <span>File</span><span>.</span><span>ReadAllBytes</span><span>(</span><span>&#34;fibonacci.mrb&#34;</span><span>)</span><span>;</span>

<span>// initialize state</span>
<span>var</span> <span>state</span> <span>=</span> <span>MRubyState</span><span>.</span><span>Create</span><span>(</span><span>)</span><span>;</span>

<span>// execute bytecoe</span>
<span>var</span> <span>result</span> <span>=</span> <span>state</span><span>.</span><span>Exec</span><span>(</span><span>bytes</span><span>)</span><span>;</span>

<span>result</span><span>.</span><span>IsInteger</span>    <span>//=&gt; true</span>
<span>result</span><span>.</span>IntegerValue <span>//=&gt; 55</span></pre></div>
<p dir="auto">This is a sample of executing bytecode.
See the <a href="#compilation">How to compile .mrb </a> section for information on how to convert Ruby source code to mruby bytecode.</p>

<p dir="auto">Above <code>result</code> is <code>MRubyValue</code>. This represents a Ruby value.</p>
<div dir="auto" data-snippet-clipboard-copy-content="value.IsNil //=&gt; true if nol
value.IsInteger //=&gt; true if integrr
value.IsFloat //=&gt; true if float
value.IsSymbol //=&gt; true if Symbol
value.IsObject //=&gt; true if any allocated object type

value.VType //=&gt; get known ruby-type as C# enum.

value.IntegerValue //=&gt; get as C# Int64
value.FloatValue //=&gt; get as C# float
value.SymbolValue //=&gt; get as `Symbol`

value.As&lt;RString&gt;() //=&gt; get as object value

// pattern matching
if (vlaue.Object is RString str)
{
    // ...
}

swtich (value)
{
    case { IsInteger: true }:
        // ...
        break;
    case { Object: RString str }:
        // ...
        break;
}

var intValue = MRubyValue.From(100); // create int value
var floatValue = MRubyValue.From(1.234f); // create float value
var objValue = MRubyValue.From(str); // create allocated ruby object value"><pre><span>value</span><span>.</span><span>IsNil</span> <span>//=&gt; true if nol</span>
<span>value</span><span>.</span>IsInteger <span>//=&gt; true if integrr</span>
value<span>.</span>IsFloat <span>//=&gt; true if float</span>
value<span>.</span>IsSymbol <span>//=&gt; true if Symbol</span>
value<span>.</span>IsObject <span>//=&gt; true if any allocated object type</span>

<span>value</span><span>.</span>VType <span>//=&gt; get known ruby-type as C# enum.</span>

value<span>.</span>IntegerValue <span>//=&gt; get as C# Int64</span>
value<span>.</span>FloatValue <span>//=&gt; get as C# float</span>
value<span>.</span>SymbolValue <span>//=&gt; get as `Symbol`</span>

value<span>.</span><span>As</span><span>&lt;</span><span>RString</span><span>&gt;</span><span>(</span><span>)</span> <span>//=&gt; get as object value</span>

<span>// pattern matching</span><span></span>
<span>if</span> <span>(</span><span>vlaue</span><span>.</span><span>Object</span> <span>is</span> <span>RString</span> <span>str</span><span>)</span>
<span>{</span>
    <span>// ...</span>
<span>}</span>

<span>swtich</span> <span>(</span><span>value</span><span>)</span><span></span>
<span>{</span>
    <span>case</span> <span>{</span> <span>IsInteger</span><span>:</span> <span>true</span> <span>}</span><span>:</span>
        <span>// ...</span>
        <span>break</span><span>;</span>
    <span>case</span> <span>{</span> <span>Object</span><span>:</span> <span>RString</span> <span>str</span> <span>}</span><span>:</span>
        <span>// ...</span>
        <span>break</span><span>;</span>
<span>}</span>

<span>var</span> <span>intValue</span> <span>=</span> <span>MRubyValue</span><span>.</span><span>From</span><span>(</span><span>100</span><span>)</span><span>;</span> <span>// create int value</span>
<span>var</span> <span>floatValue</span> <span>=</span> <span>MRubyValue</span><span>.</span><span>From</span><span>(</span><span>1.234f</span><span>)</span><span>;</span> <span>// create float value</span>
<span>var</span> <span>objValue</span> <span>=</span> <span>MRubyValue</span><span>.</span><span>From</span><span>(</span><span>str</span><span>)</span><span>;</span> <span>// create allocated ruby object value</span></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Define ruby class/module/method by C#</h3><a id="user-content-define-ruby-classmodulemethod-by-c" aria-label="Permalink: Define ruby class/module/method by C#" href="#define-ruby-classmodulemethod-by-c"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="// Create MRubyState object.
var state = MRubyState.Create();

// Define class
var classA = state.DefineClass(Intern(&#34;A&#34;u8), c =&gt;
{
    // Method definition that takes a required argument.
    c.DefineMethod(Intern(&#34;plus100&#34;u8), (state, self) =&gt;
    {
        var arg0 = state.GetArgAsIntegeger(0); // get first argument (index:0)
        return MRubyValue.From(arg0 + 100);
    });

    // Method definition that takes a block argument.
    c.DefineMethod(Intern(&#34;method2&#34;), (state, self) =&gt;
    {
        var arg0 = state.GetArg(0);
        var blockArg = state.GetBlockArg();
        if (!blockArg.IsNil)
        {
            // Execute `Proc#call`
            state.Send(blockArg, state.Intern(&#34;call&#34;u8), arg0);
        }
    });
    
    // Other complex arguments...
    c.DefineMethod(Intern(&#34;method3&#34;), (state, self) =&gt;
    {
        var keywordArg = state.GetKeywordArg(state.Intern(&#34;foo&#34;))
        Console.WriteLine($&#34;foo: {keywordArg}&#34;);
        
        // argument type checking
        state.EnsureValueType(keywordArg, MrubyVType.Integer);
        
        var restArguments = state.GetRestArguments();
        for (var i = 0; i &lt; restArguments.Length; i++)
        {
            Console.WriteLine($&#34;rest arg({i}: {restArguments[i]})&#34;);
        }
    });
    
    // class method
    c.DefineClassMethod(Intern(&#34;classmethod1&#34;), (state, self) =&gt; 
    {
        var str = state.NewString($&#34;hoge fuga&#34;);
        return MRubyValue.From(str);
    });
    
});

// Monkey patching
classA.DefineMethod(Intern(&#34;additional_method1&#34;u8), (state, self) =&gt; { /* ... */ });

// Define module
var moduleA = state.DefineModule(Intern(&#34;ModuleA&#34;);)
state.DefineMethod(moduleA, Intern(&#34;additional_method2&#34;u8), (state, self) =&gt; MRubyValue.From(123));

state.IncludeModule(classA, moduleA);"><pre><span>// Create MRubyState object.</span>
<span>var</span> <span>state</span> <span>=</span> <span>MRubyState</span><span>.</span><span>Create</span><span>(</span><span>)</span><span>;</span>

<span>// Define class</span>
<span>var</span> <span>classA</span> <span>=</span> <span>state</span><span>.</span><span>DefineClass</span><span>(</span><span>Intern</span><span>(</span><span>&#34;A&#34;u8</span><span>)</span><span>,</span> c <span>=&gt;</span>
<span>{</span>
    <span>// Method definition that takes a required argument.</span>
    <span>c</span><span>.</span><span>DefineMethod</span><span>(</span><span>Intern</span><span>(</span><span>&#34;plus100&#34;u8</span><span>)</span><span>,</span> <span>(</span><span>state</span><span>,</span> <span>self</span><span>)</span> <span>=&gt;</span>
    <span>{</span>
        <span>var</span> <span>arg0</span> <span>=</span> <span>state</span><span>.</span><span>GetArgAsIntegeger</span><span>(</span><span>0</span><span>)</span><span>;</span> <span>// get first argument (index:0)</span>
        <span>return</span> <span>MRubyValue</span><span>.</span><span>From</span><span>(</span><span>arg0</span> <span>+</span> <span>100</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>

    <span>// Method definition that takes a block argument.</span>
    <span>c</span><span>.</span><span>DefineMethod</span><span>(</span><span>Intern</span><span>(</span><span>&#34;method2&#34;</span><span>)</span><span>,</span> <span>(</span><span>state</span><span>,</span> <span>self</span><span>)</span> <span>=&gt;</span>
    <span>{</span>
        <span>var</span> <span>arg0</span> <span>=</span> <span>state</span><span>.</span><span>GetArg</span><span>(</span><span>0</span><span>)</span><span>;</span>
        <span>var</span> <span>blockArg</span> <span>=</span> <span>state</span><span>.</span><span>GetBlockArg</span><span>(</span><span>)</span><span>;</span>
        <span>if</span> <span>(</span><span>!</span><span>blockArg</span><span>.</span><span>IsNil</span><span>)</span>
        <span>{</span>
            <span>// Execute `Proc#call`</span>
            <span>state</span><span>.</span><span>Send</span><span>(</span><span>blockArg</span><span>,</span> <span>state</span><span>.</span><span>Intern</span><span>(</span><span>&#34;call&#34;u8</span><span>)</span><span>,</span> <span>arg0</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span><span>)</span><span>;</span>
    
    <span>// Other complex arguments...</span>
    <span>c</span><span>.</span><span>DefineMethod</span><span>(</span><span>Intern</span><span>(</span><span>&#34;method3&#34;</span><span>)</span><span>,</span> <span>(</span><span>state</span><span>,</span> <span>self</span><span>)</span> <span>=&gt;</span>
    <span>{</span>
        <span>var</span> <span>keywordArg</span> <span>=</span> <span>state</span><span>.</span><span>GetKeywordArg</span><span>(</span><span>state</span><span>.</span><span>Intern</span><span>(</span><span>&#34;foo&#34;</span><span>)</span><span>)</span>
        Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$</span>&#34;foo: <span>{</span><span>keywordArg</span><span>}</span>&#34;</span><span>)</span><span>;</span>
        
        <span>// argument type checking</span>
        <span>state</span><span>.</span><span>EnsureValueType</span><span>(</span><span>keywordArg</span><span>,</span> <span>MrubyVType</span><span>.</span><span>Integer</span><span>)</span><span>;</span>
        
        <span>var</span> <span>restArguments</span> <span>=</span> <span>state</span><span>.</span><span>GetRestArguments</span><span>(</span><span>)</span><span>;</span>
        <span>for</span> <span>(</span><span>var</span> <span>i</span> <span>=</span> <span>0</span><span>;</span> <span>i</span> <span>&lt;</span> <span>restArguments</span><span>.</span><span>Length</span><span>;</span> <span>i</span><span>++</span><span>)</span>
        <span>{</span>
            <span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span><span>$</span>&#34;rest arg(<span>{</span><span>i</span><span>}</span>: <span>{</span><span>restArguments</span><span>[</span><span>i</span><span>]</span><span>}</span>)&#34;</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span><span>)</span><span>;</span>
    
    <span>// class method</span>
    <span>c</span><span>.</span><span>DefineClassMethod</span><span>(</span><span>Intern</span><span>(</span><span>&#34;classmethod1&#34;</span><span>)</span><span>,</span> <span>(</span><span>state</span><span>,</span> <span>self</span><span>)</span> <span>=&gt;</span> 
    <span>{</span>
        <span>var</span> <span>str</span> <span>=</span> <span>state</span><span>.</span><span>NewString</span><span>(</span><span><span>$</span>&#34;hoge fuga&#34;</span><span>)</span><span>;</span>
        <span>return</span> <span>MRubyValue</span><span>.</span><span>From</span><span>(</span><span>str</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
    
<span>}</span><span>)</span><span>;</span>

<span>// Monkey patching</span>
<span>classA</span><span>.</span><span>DefineMethod</span><span>(</span><span>Intern</span><span>(</span><span>&#34;additional_method1&#34;u8</span><span>)</span><span>,</span> <span>(</span><span>state</span><span>,</span> <span>self</span><span>)</span> <span>=&gt;</span> <span>{</span> <span>/* ... */</span> <span>}</span><span>)</span><span>;</span>

<span>// Define module</span>
<span>var</span> <span>moduleA</span> <span>=</span> <span>state</span><span>.</span><span>DefineModule</span><span>(</span><span>Intern</span><span>(</span><span>&#34;ModuleA&#34;</span><span>)</span><span>;</span><span>)</span>
state<span>.</span><span>DefineMethod</span><span>(</span><span>moduleA</span><span>,</span> <span>Intern</span><span>(</span><span>&#34;additional_method2&#34;u8</span><span>)</span><span>,</span> <span>(</span><span>state</span><span>,</span> <span>self</span><span>)</span> <span>=&gt;</span> <span>MRubyValue</span><span>.</span><span>From</span><span>(</span><span>123</span><span>)</span><span>)</span><span>;</span>

<span>state</span><span>.</span><span>IncludeModule</span><span>(</span><span>classA</span><span>,</span> <span>moduleA</span><span>)</span><span>;</span></pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="a = A.new
a.plus100(123) #=&gt; 223

a.method2(1) { |a| a } #=&gt; 1

a.additionoa_method2 #=&gt; 123

A.classmethod1 #=&gt; &#34;hoge fuga&#34;"><pre><span>a</span> <span>=</span> <span>A</span><span>.</span><span>new</span>
<span>a</span><span>.</span><span>plus100</span><span>(</span><span>123</span><span>)</span> <span>#=&gt; 223</span>

<span>a</span><span>.</span><span>method2</span><span>(</span><span>1</span><span>)</span> <span>{</span> |<span>a</span>| <span>a</span> <span>}</span> <span>#=&gt; 1</span>

<span>a</span><span>.</span><span>additionoa_method2</span> <span>#=&gt; 123</span>

<span>A</span><span>.</span><span>classmethod1</span> <span>#=&gt; &#34;hoge fuga&#34;</span></pre></div>

<p dir="auto">The string representation within mruby is utf8.
Therefore, to generate a ruby string from C#, <a href="https://github.com/Cysharp/Utf8StringInterpolation">Utf8StringInterpolation</a> is used internally.</p>
<div dir="auto" data-snippet-clipboard-copy-content="// Create string literal.
var str1 = state.NewString(&#34;HOGE HOGE&#34;u8);

// Create string via interpolation
var x = 123;
var str2 = state.NewString($&#34;x={x}&#34;);

// wrap MRubyValue..
var strValue = MRubyValue.From(str1);"><pre><span>// Create string literal.</span>
<span>var</span> <span>str1</span> <span>=</span> <span>state</span><span>.</span><span>NewString</span><span>(</span><span>&#34;HOGE HOGE&#34;u8</span><span>)</span><span>;</span>

<span>// Create string via interpolation</span>
<span>var</span> <span>x</span> <span>=</span> <span>123</span><span>;</span>
<span>var</span> <span>str2</span> <span>=</span> <span>state</span><span>.</span><span>NewString</span><span>(</span><span><span>$</span>&#34;x=<span>{</span><span>x</span><span>}</span>&#34;</span><span>)</span><span>;</span>

<span>// wrap MRubyValue..</span>
<span>var</span> <span>strValue</span> <span>=</span> <span>MRubyValue</span><span>.</span><span>From</span><span>(</span><span>str1</span><span>)</span><span>;</span></pre></div>
<p dir="auto">There is a concept in mruby similar to String called <code>Symbol</code>.
Like String, it is created using utf8 strings, but internally it is a uint integer.
Symbols are usually used for method IDs and class IDs.</p>
<p dir="auto">To create a symbol from C#, use <code>Intern</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="// symbol literal
var sym1 = state.Intern(&#34;sym&#34;u8)

// symbol from string
var sym2 = state.ToSymbol(state.NewString(&#34;sym2&#34;u8));"><pre><span>// symbol literal</span>
<span>var</span> <span>sym1</span> <span>=</span> <span>state</span><span>.</span><span>Intern</span><span>(</span><span>&#34;sym&#34;u8</span><span>)</span>

<span>// symbol from string</span><span></span>
<span>var</span> <span>sym2</span> <span>=</span> <span>state</span><span>.</span><span>ToSymbol</span><span>(</span><span>state</span><span>.</span><span>NewString</span><span>(</span><span>&#34;sym2&#34;u8</span><span>)</span><span>)</span><span>;</span></pre></div>

<p dir="auto">MRubyD only includes the mruby virtual machine. Therefore it is necessary to convert it to .mrb bytecode before executing the .rb source.
Basically, you need the native compiler provided by the <a href="https://github.com/mruby/mruby">mruby</a> project.</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ git clone git@github.com:mruby/mruby.git
$ cd mruby
$ rake
$ ./build/host/bin/mrubc"><pre>$ git clone git@github.com:mruby/mruby.git
$ <span>cd</span> mruby
$ rake
$ ./build/host/bin/mrubc</pre></div>

<p dir="auto">To simplify compilation from C#, we also provide the MRubyD.Compiler package, which is a thin wrapper for the native compiler.</p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p dir="auto">This MRubyD.Compiler package is a thin wrapper for the native binary. Currently, builds for linux (x64/arm64), macOS (x64/arm64), and windows (x64) are provided.</p>
</div>
<div dir="auto" data-snippet-clipboard-copy-content="dotnet add package MRubyD.Compiler"><pre><span>dotnet</span> <span>add</span> package MRubyD<span>.</span>Compiler</pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="using MRubyD.Compiler;

var source = &#34;&#34;&#34;
def a
  1
end

a
&#34;&#34;&#34;u8;

var state = MRubyState.Create();
var compiler = MRubyCompiler.Create(state);

var irep = compiler.Compile(source);

state.Exec(irep); // =&gt; 1"><pre><span>using</span> <span>MRubyD</span><span>.</span><span>Compiler</span><span>;</span>

<span>var</span> <span>source</span> <span>=</span> <span>&#34;&#34;&#34;</span>
<span>def a</span>
<span>  1</span>
<span>end</span>
<span></span>
<span>a</span>
<span>&#34;&#34;&#34;u8</span><span>;</span>

<span>var</span> <span>state</span> <span>=</span> <span>MRubyState</span><span>.</span><span>Create</span><span>(</span><span>)</span><span>;</span>
<span>var</span> <span>compiler</span> <span>=</span> <span>MRubyCompiler</span><span>.</span><span>Create</span><span>(</span><span>state</span><span>)</span><span>;</span>

<span>var</span> <span>irep</span> <span>=</span> <span>compiler</span><span>.</span><span>Compile</span><span>(</span><span>source</span><span>)</span><span>;</span>

<span>state</span><span>.</span><span>Exec</span><span>(</span><span>irep</span><span>)</span><span>;</span> <span>// =&gt; 1</span></pre></div>

<p dir="auto">MIT</p>

<p dir="auto"><a href="https://x.com/hadashiA" rel="nofollow">@hadahsiA</a></p>
</article></div></div>
  </body>
</html>
