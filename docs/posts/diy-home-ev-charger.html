<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jamesfotherby.com/index-page/electric-vehicle-charger/">Original</a>
    <h1>DIY Home EV Charger</h1>
    
    <div id="readability-page-1" class="page"><div>
			
<p>I built my own 7.2kW EV charger and fitted it inside a Zappi enclosure. The 2 aims were simplicity and safety. This article documents the build. I wrote the Arduino software for it and all design files, software and part lists are available on the <a href="https://github.com/fotherja/EV_Charger">GitHub page</a>.</p>



<h2>Motivation</h2>



<p>It costs about £900 in the UK to have an EV charger installed by an electrician. This motivated me to question whether I could build my own since I enjoy these sorts of projects. On researching the topic further I found an open source charger (<a href="https://openev.freshdesk.com/support/home">the EVSE</a>) with good documentation. This gave me the confidence to build my own.</p>



<h2>Disclaimer</h2>



<p>A word about safety. I’m not an electrician. I’m not allowed to make alterations to my consumer unit. I will have to remove the charger when I leave my house. I’m sure there are countless people that would condemn what I have done here and I can understand why. Building your own outdoor charger which switches 240V 32A could be dangerous if not done right. I have learnt about earthing systems, PEN faults, RCDs, cable current capacities etc. I think I have educated myself enough to have built an adequately safe system. Nevertheless, I welcome constructive criticism and discussion.</p>



<h2>Introduction</h2>



<p>EV chargers use a simple “pilot” signal to detect when they are plugged into a car and to tell the car how much current it is allowed to draw from the charger. They don’t modify the mains at all, they just switch it on/off to the car via some relays. In addition to this they also incorporate the functionality of an RCD. But to be honest, that’s about it!</p>


<div>
<figure><img decoding="async" src="https://jamesfotherby.com/wp-content/uploads/2023/06/Zappi_Enclosure.jpg" alt="" width="840" height="630" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/Zappi_Enclosure.jpg 968w, https://jamesfotherby.com/wp-content/uploads/2023/06/Zappi_Enclosure-300x225.jpg 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/Zappi_Enclosure-768x576.jpg 768w" sizes="(max-width: 840px) 100vw, 840px"/></figure></div>


<p>I managed to buy a second hand “showroom” Zappi charger. It came without any of the electronics inside but it gave me an enclosure, cable and plug to work with. I paid £120 inclusive of postage.</p>



<p>I bought 5 metres of 6mm² SWA cable to run from my consumer unit to my desired charger location. I added a 50A MCB into my consumer unit on the non-RCD side and routed the SWA cable using cleats and stainless steel screws.</p>



<p>The SWA cable enters the Zappi enclosure through an outdoor water resistant gland. The live and neutral pass together through a current transformer before attaching to the PCB.</p>



<h2>Ground Current Detection</h2>



<p>One of the most important safety mechanisms to include is a ground current detection system. The chassis of the car is grounded via the earth wire through the charging plug. The earth supply comes from the consumer unit (we have TN-C-S supply).</p>



<p>There is quite a bit of theory behind grounding systems. <a href="https://www.youtube.com/watch?v=AWxeb2MI37c">John Ward</a> has some instructional YouTube videos on the topic which I have watched. He discusses the problem of PEN faults etc. It’s worth spending the time educating yourself about earthing if you are doing any electrical work.</p>



<p>Although unlikely, it is possible for a fault to occur such that a live wire contacts the car chassis. Perhaps it’s pulled loose inside the car somewhere and is touching the chassis or perhaps a wet connector is bridging a path to the chassis.</p>



<p>Either way the live will source current into the chassis which will drain straight to ground (In a TN-C-S supply the ground and neutral conductors are bonded at the consumer unit). The amount of current will depend on the resistance of the faulty bridge. (water is unlikely to allow many amps to flow). Given the chassis is well earthed, it shouldn’t rise up in voltage enough to present a shock hazard to someone that touches it.</p>



<p>Nevertheless, this is a fault situation that should be detected and dealt with. If some water is bridging the live to the chassis perhaps a couple of amps will flow (not enough to trip the 50A MCB for the charger) but enough to cause localised heating and further damage.</p>



<p>So we need to measure current flowing to ground (should be zero in normal operation). If this is more than 20 mA we want to isolate the car by opening the relays. The reason RCDs typically trip at 5-30mA is because this amount of current for a couple hundred milliseconds doesn’t cause permanent injury to humans. I like the <a href="https://en.wikipedia.org/wiki/Electrical_injury">wikipedia article on electrical injury</a>.</p>


<div>
<figure><img decoding="async" width="1024" height="640" src="https://jamesfotherby.com/wp-content/uploads/2023/06/Electrical_Injury-1024x640.png" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/Electrical_Injury-1024x640.png 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/Electrical_Injury-300x188.png 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/Electrical_Injury-768x480.png 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/Electrical_Injury-1536x960.png 1536w, https://jamesfotherby.com/wp-content/uploads/2023/06/Electrical_Injury-991x619.png 991w, https://jamesfotherby.com/wp-content/uploads/2023/06/Electrical_Injury.png 1600w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure></div>


<p><em>AC-1: imperceptible, AC-2: perceptible but no muscle reaction, AC-3: muscle contraction with reversible effects, AC-4: possible irreversible effects, AC-4.1: up to 5% probability of ventricular fibrillation, AC-4.2: 5–50% probability of fibrillation, AC-4.3: over 50% probability of fibrillation</em></p>



<p>The way to measure current to earth is simple. We employ a <a href="https://shop.openenergymonitor.com/gfci-for-openevse/">current transformer</a> measuring the common mode current of the live and neutral wires. All current should be differential (all current flowing out of the live wire should go through the load and return back through the neutral). If there is a fault and some current does not return then it must be going to earth. This is a common mode current and we want to be measuring this!</p>


<div>
<figure><img loading="lazy" decoding="async" src="https://jamesfotherby.com/wp-content/uploads/2023/06/RCD.png" alt="" width="840" height="472" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/RCD.png 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/RCD-300x169.png 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/RCD-768x432.png 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/RCD-991x557.png 991w" sizes="(max-width: 840px) 100vw, 840px"/></figure></div>


<h2>Schematic</h2>



<figure><img loading="lazy" decoding="async" width="1024" height="688" src="https://jamesfotherby.com/wp-content/uploads/2023/06/schematic.webp" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/schematic.webp 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/schematic-300x202.webp 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/schematic-768x516.webp 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/schematic-991x666.webp 991w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The electronics are necessary for:</p>



<ul>
<li>Generating the DC voltages for the arduino, op-amps, relays etc</li>



<li>Mounting of the 40A 250V L &amp; N relays that switch power to the charging plug</li>



<li>Generating the +/- 12V 1kHz PWM signal for the pilot</li>



<li>Amplifying and rectifying the current transformer’s signal prior to the Arduino’s ADC</li>
</ul>



<h3>Power Supplies</h3>



<p>I used a <a href="https://www.mouser.co.uk/ProductDetail/RECOM-Power/RAC10-15DK-277?qs=sGAEpiMZZMv0NwlthflBi7FfJEZeKKJHA7rGuJoj96Y%3D&amp;countrycode=GB&amp;currencycode=GBP">RAC10-15DK/277</a> AC/DC power module. This generates +/- 15 V rails. Adjustable positive/negative linear voltage regulators (<a href="https://www.onsemi.com/pdf/datasheet/lm317-d.pdf">LM317</a> &amp; <a href="https://www.onsemi.com/pdf/datasheet/lm337-d.pdf">LM337</a>) produce +/- 12V rails. I was aware the op-amps outputs might not be able to swing all the way to their supply rails so I wanted some flexibility by using adjustable voltage regulators.</p>


<div>
<figure><img loading="lazy" decoding="async" width="860" height="618" src="https://jamesfotherby.com/wp-content/uploads/2023/06/Dropout.png" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/Dropout.png 860w, https://jamesfotherby.com/wp-content/uploads/2023/06/Dropout-300x216.png 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/Dropout-768x552.png 768w" sizes="(max-width: 860px) 100vw, 860px"/></figure></div>


<p>The regulators need a minimum load of about 5 mA to maintain regulation. Therefore R3 &amp; R17 provide a small load for them. The regulators are operating uncomfortably close to their dropout voltages. According to the datasheet the dropout at 20 mA load is about 1.6 V at 0℃ which allows us to up our op-amp rails to about 13.4 V if necessary.</p>



<p>Due to the chip/stock shortages at present, I bought a Pro-Mini module which conveniently housed an Atmega328P Arduino with a 5V regulator. Beware though, this onboard regulator has a max input voltage of 10V so I dropped the regulated 12V using a 4.3V zener diode before supplying it to the RAW input of the Pro-Mini.</p>



<h3>Pilot Generation</h3>



<p>All communication with the car is done through a single wire referenced to earth called the pilot signal. Read <a href="https://openev.freshdesk.com/support/solutions/articles/6000052070-theory-of-operation#:~:text=CPU-,Pilot%20circuit,-The%20%2B/%2D%2012v%20square">here</a> and <a href="https://en.wikipedia.org/wiki/SAE_J1772#:~:text=it%20breaks%20last.-,Signaling,-%5Bedit%5D">here</a> for descriptions on how this signal works. In a nutshell, depending on whether the car is connected/ready to charge etc, the car places different resistances on the pilot signal. This causes changes in the voltage of the pilot signal.</p>



<p>An LM358 Op-Amp takes a 0-5V PWM signal from the Arduino and converts it into a +/-12V signal to form the pilot. Easy.</p>



<p>We use a voltage divider network to condition the pilot voltage before feeding it into an ADC channel for measurement. A <a href="https://www.mouser.co.uk/ProductDetail/Littelfuse/P6KE16CA?qs=zHiv0nsVGmomoh78uy39%252BQ%3D%3D&amp;countrycode=GB&amp;currencycode=GBP">13.6 V 600W bidirectional TVS</a> just ensures no whacky voltages are ever experienced on the pilot wire.</p>



<h2>Relay operation</h2>



<p>I initially thought I ought to share the load on the SMPS between its 2 power rails. So one relay would be powered by the +ve rail and the other by the -ve rail. However doing this added a couple of extra parts to the design and slightly increased the overall complexity. For the sake of simplicity I kept both relays powered from the +ve supply rail and this has ended up working absolutely fine.</p>



<p>The <a href="https://www.mouser.co.uk/ProductDetail/TE-Connectivity-PB/T9VV1K15-12S?qs=1mbolxNpo8fTt0la6JKWEQ%3D%3D&amp;countrycode=GB&amp;currencycode=GBP">T9VV1K15-12S</a> relay specifications report a coil holding voltage of only 4.7V. This can conserve a lot of power. You can see from the schematic, we charge 100uF capacitors from the +15V rail through 1W 47R resistors (R13 &amp; R14). When the relays are activated they initially but briefly get 15V. But the steady state voltage decays to about 9V. I should have gone for 68R or even 100R resistors for even more power conservation.</p>



<p>The <a href="https://www.onsemi.com/pdf/datasheet/bc337-d.pdf">BC337 transistors</a> get about 2 mA of base current through the 2.2K resistors. This is adequate to sufficiently switch the transistors.</p>



<h3>Current transformer</h3>



<p>A current transformer is analogous to a voltage transformer. We put 1 turn on the transformer primary by passing the live and neutral once through the ferrite core. On the secondary we have many turns – 100s of turns. A current on the primary is therefore induced onto the secondary albeit at a magnitude proportional to the turns ratio. If we have a 20mA current on the primary and a 1:400 turns ratio we’ll have a 50uA secondary current.</p>



<p>Just like a voltage transformer doesn’t like to be short circuited. A current transformer doesn’t like to be open circuited. The best method to measure the secondary current is to use a transimpedance amplifier.</p>



<p>U2 is the <a href="https://www.analog.com/media/en/technical-documentation/data-sheets/op07.pdf">OP07</a> low-offset op-amp. The V+ terminal is grounded and in this configuration the output will swing around to always keep V- at the same voltage as V+ (ie. 0 V). Imagine if the current transformer forces 50 uA towards the V- terminal of U2. The op-amp will reduce its output voltage to -5 V so that the 50 uA is entirely pulled through R2 (V = I x R = 50uA x 100K). Hence the V- terminal is kept at exactly 0 V. So you can see in this configuration that currents from the transformer are converted into voltages at the output of the op-amp. C1 just helps to reduce the gain at high frequencies and act as a low pass filter. D1 and D2 stop any voltage excursions beyond about 0.7 V should the transimpedance amplifier get saturated.</p>



<p>We probably didn’t need the low-offset features of the OP07. C2 removes any DC bias anyway. U3B is configured to act as a further amplifier stage and precision rectifier. The 4.3 V zener diodes used clip the output to a ~4 V maximum as well. R12 and C3 add a final low pass filter before going to the ADC channel.</p>



<p>All in all, AC currents from the ground fault current transformer are converted into voltages, amplified, rectified, limited and filtered before being passed to the Arduino ADC for measurement. This circuitry worked and made sense to me so I went with it. But you could probably simplify it further.</p>



<h3>PCB Design</h3>


<div>
<figure><img loading="lazy" decoding="async" width="791" height="694" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB.webp" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB.webp 791w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB-300x263.webp 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB-768x674.webp 768w" sizes="(max-width: 791px) 100vw, 791px"/></figure></div>


<p>I used KiCad to design the PCB. I have settled on KiCad because it is open source and you can do multi-layer PCBs if you need to. <a href="https://www.snapeda.com/">SnapEDA </a>is key for importing PCB footprints for parts. There is not much to say about the PCB design. I kept a 4mm clearance around high voltage traces. I ordered the PCBs from <a href="https://www.pcbway.com/?gw1&amp;campaignid=172480651&amp;adgroupid=8787904531&amp;feeditemid=&amp;targetid=kwd-96217560494&amp;loc_physical_ms=9050375&amp;matchtype=p&amp;network=g&amp;device=c&amp;devicemodel=&amp;creative=377957049820&amp;keyword=pcbway&amp;placement=&amp;target=&amp;adposition=&amp;gclid=Cj0KCQjw3v6SBhCsARIsACyrRAmj5mhhjIHoLEmh1p9mmHL0xKibSXEeBjK1pRfQJY_44iNmkzL0VCQaAq5gEALw_wcB">PCBway</a> who get them back to you in about 1 week!</p>



<figure>
<figure><img loading="lazy" decoding="async" width="1024" height="768" data-id="92" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm3-1024x768.jpg" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm3-1024x768.jpg 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm3-300x225.jpg 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm3-768x576.jpg 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm3-991x744.jpg 991w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm3.jpg 1210w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" decoding="async" width="1024" height="768" data-id="93" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm2-1024x768.jpg" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm2-1024x768.jpg 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm2-300x225.jpg 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm2-768x576.jpg 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm2-991x744.jpg 991w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm2.jpg 1210w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" decoding="async" width="1024" height="768" data-id="95" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm1-1024x768.jpg" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm1-1024x768.jpg 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm1-300x225.jpg 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm1-768x576.jpg 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm1-991x744.jpg 991w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Asm1.jpg 1210w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" decoding="async" width="1024" height="768" data-id="94" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Real-1024x768.jpg" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Real-1024x768.jpg 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Real-300x225.jpg 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Real-768x576.jpg 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Real-991x744.jpg 991w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_PCB_Real.jpg 1210w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" decoding="async" width="1024" height="768" data-id="96" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Correction-1024x768.jpg" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Correction-1024x768.jpg 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Correction-300x225.jpg 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Correction-768x576.jpg 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Correction-991x744.jpg 991w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Correction.jpg 1210w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>
</figure>



<h3>Assembly</h3>



<p>I soldered up the PCB with the parts I got from <a href="https://www.mouser.co.uk/">Mouser</a>. I realised I got one op-amp’s pins flipped wrong on my design so you can see an ugly little correction to fix that. I also didn’t realise the Pro-Mini’s regulator can’t handle &gt;10 V so I burnt one out whilst adjusting the supply rail voltages. Lucky I had bought a pack of 3 Pro-Minis. I’ve added a 4.3v zener diode after this mistake to drop the voltage down before feeding it to the Pro-Mini. I have corrected these problems on the schematic and PCB on github and called the PCB V2.0.</p>



<h3>Software</h3>



<p>Hopefully the code is commented well enough to make sense. Find it on the <a href="https://github.com/fotherja/EV_Charger">GitHub repository</a>.</p>



<p>There is a self test coil on the current transformer. The software performs a self test by putting a 50Hz 5 mA square wave through the 5-Turn test coil. This essentially simulates a 25 mA ground fault. We time how long it takes for the fault to be detected. If the fault is detected within 100 ms the test is passed.</p>



<h3>Testing</h3>



<p>I took some thermal images of the device under load. The relay resistors are dissipating 900mW (They’re 1W rated) which gets them to about 60 celsius above ambient. The wiring and terminal blocks are fine with nothing hotter than 15 Celsius above ambient.</p>


<div>
<figure><img loading="lazy" decoding="async" width="768" height="1024" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Thermal-768x1024.jpg" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Thermal-768x1024.jpg 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Thermal-225x300.jpg 225w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Thermal-rotated.jpg 960w" sizes="(max-width: 768px) 100vw, 768px"/></figure></div>


<p>The following embedded video demonstrates the device working. </p>



<figure><p>
<iframe loading="lazy" title="DIY EV Charger" width="991" height="557" src="https://www.youtube.com/embed/pCcnrtT_gis?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
</p></figure>



<p>The following RCD test video is done by connecting a 10K resistor (24 mA ground fault current) from live to ground. It causes the device to immediately interrupt the charging process and trip out. That proves successful RCD functionality.</p>



<figure><p>
https://www.youtube.com/watch?v=KtpMBw55b-U&amp;t=2s&amp;ab_channel=JamesFotherby
</p></figure>



<p>Out of interest, I measured the voltage across the relay coil when actuating. The blue trace is the coil voltage and the red trace the switched AC output. It seems to take about 5 ms to actuate the relay. The contacts obviously bounce a little bit after coming together.</p>



<figure><img loading="lazy" decoding="async" width="1024" height="576" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Coil-voltage-1024x576.png" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Coil-voltage-1024x576.png 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Coil-voltage-300x169.png 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Coil-voltage-768x432.png 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Coil-voltage-991x557.png 991w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Coil-voltage.png 1280w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Likewise the release of the relay seems to take about 10 ms.</p>



<figure><img loading="lazy" decoding="async" width="1024" height="576" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Coil-release-voltage-1024x576.png" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Coil-release-voltage-1024x576.png 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Coil-release-voltage-300x169.png 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Coil-release-voltage-768x432.png 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Coil-release-voltage-991x557.png 991w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Coil-release-voltage.png 1280w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The pilot voltages are exactly as they are supposed to be. The SAE_J1772 specifications do allow +/- 0.5V from the +12V, and +/- 1V on the +9V, 6V and 3V levels so we’re comfortable.</p>



<p>This trace shows what happens when a car is detected. The +12V DC pilot is pulled down by the car’s 2.74K resistor. After a 200ms hiatus, the software switches to “State B” and starts the 1kHz PWM.</p>



<figure><img loading="lazy" decoding="async" width="1024" height="576" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Start_PWM-1024x576.png" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Start_PWM-1024x576.png 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Start_PWM-300x169.png 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Start_PWM-768x432.png 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Start_PWM-991x557.png 991w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Start_PWM.png 1280w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Here’s the pilot when the car is charging. -12V to +6V. The software is measuring the voltages at the centres of the low and high regions.</p>



<figure><img loading="lazy" decoding="async" width="1024" height="576" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Charging-1024x576.png" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Charging-1024x576.png 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Charging-300x169.png 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Charging-768x432.png 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Charging-991x557.png 991w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Charging.png 1280w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>It was important to test the ground fault detection circuit. I tested it to trip at 6 mA. Here’s a trace to show the speed of a trip when a 22K resistor is connected to earth across the 240V live resulting in an 11 mA current. The detection time is 12 ms (start of the AC waveform to the rising edge of the blue waveform. Hence with the 10 ms relay release time the power will be cut in 22 ms. That’s within the EV charger national specifications.</p>



<figure><img loading="lazy" decoding="async" width="1024" height="576" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Trip2-1024x576.png" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Trip2-1024x576.png 1024w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Trip2-300x169.png 300w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Trip2-768x432.png 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Trip2-991x557.png 991w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_Trip2.png 1280w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<h2>Conclusion</h2>



<p>I’m delighted with the end result. It doesn’t have an LCD screen but my car tells me how fast it’s charging and allows me to configure charging times etc. I don’t need any smart functionality. I have a smart meter so I know how much electricity I’m using etc too.</p>



<figure><img loading="lazy" decoding="async" width="768" height="1024" src="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_ON_Post-768x1024.jpg" alt="" srcset="https://jamesfotherby.com/wp-content/uploads/2023/06/EV_ON_Post-768x1023.jpg 768w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_ON_Post-225x300.jpg 225w, https://jamesfotherby.com/wp-content/uploads/2023/06/EV_ON_Post.jpg 908w" sizes="(max-width: 768px) 100vw, 768px"/></figure>



<p>Total cost? Well about £200. Plus several days of hard thinking, soldering and coding. Good fun though. Let me know what you think.</p>



<h3>Post Publication Updates</h3>



<p>This project was <a href="https://hackaday.com/2022/04/28/diy-arduino-based-ev-charger-saves-money-looks-pro/#comments">featured on Hackaday</a>. There are quite a few (mostly negative) comments about this project commenting on the safety of this implementation. This is a summary as of 2/5/2022 of the feedback.</p>



<p>1) The soldered connections on the PCB are inadequate – Ok, I agree with this. A 40A terminal block would be much better. I should have done that. Is there any appreciable risk of those solder joints melting before the 50A MCB trips? I took some thermal image pics of the system operating at 30A and there are no hot spots in the solder/wiring/connections. The flimsier looking terminal block actually came with the Zappi enclosure so it implies the terminal blocks are appropriately rated.</p>



<p>2) Bad choice of relays – according to the datasheet, the relays used in this project are for EV chargers and can handle 250V 40A. EV cars soft start/stop their charging so the relays don’t have to connect/interrupt under load unless due to a fault condition. If you look at teardowns of some commercial chargers (eg. Zappi) you’ll find separate L&amp;N single pole relays just like I have used. But, I agree having a dual gang relay so the L&amp;N are mechanically linked does sound better. I have measured the power factor of the car charging (albeit when charging from a 13A socket) using a plug-in power meter and it reports a power factor of 0.95. So I think the car does present a resistive load. Logically, car manufacturers must have to ensure their onboard SMPS chargers have good power factor else the extra currents would cause problems in domestic setups, I agree.</p>



<p>3) Unsafe to use an Arduino (ATMEGA328P). I think you technically need special authorisation from atmel to use this chip for automotive or safety critical applications. I like the suggestion of incorporating a watchdog timer to guard against hanging. I’ll add that. And I like the suggestion [steaky] of having to regularly toggle a pin purposefully to maintain engagement of the relay so they’d open by default during an error. Is that actually done in commercial chargers? It’s not done by the EVSE. If an unexpected reset occurred the relays would open in this implementation.</p>



<p>4) Should be a type B RCD – I think this is the main point from everyone. That the RCD functionality is inadequate. I essentially copied the EVSE RCD design, which I thought was a acceptable approach. What do people think of the EVSE RCD? The requirement for EV chargers to have a Type B RCDs is a relatively new regulation brought into play in the last few years. <a href="https://www2.theiet.org/forums/forum/messageview.cfm?catid=205&amp;threadid=107114">This forum</a> discusses the change prior to the standard being introduced. Type B RCDs can detect DC ground fault currents (not such an easy thing to do), <a href="https://www.eevblog.com/forum/beginners/probe-oscilloscope-ground-blow-up-issues-usb/?action=dlattach;attach=341471">this is a good article</a> explaining everything about them and how they work. </p>



<p>How safe is adequately safe? 5 years ago the Type A RCD incorporated in this project would have been deemed adequate. Currently I’m ok going with the safety standards of 5 years ago. I’m trying to address the main safety points here, after which you encounter rarer and rarer eventualities that require some extremely unlikely situations to occur. People say my house is going to burn down. I think that’s a bit melodramatic. For starters the unit is mounted outside. Will it void my car warranty? I don’t think so because the AC power isn’t altered by the charger. This is a bespoke implementation which admittedly doesn’t meet the stringent regulatory requirements that commercially produced chargers must. For my situation, I’m ok with that.</p>



<p>Summary of community recommendations:</p>



<ol>
<li>Terminal blocks on the PCB</li>



<li>Use a dual gang relay</li>



<li>Add watch dog timer – DONE</li>



<li>Add Type B RCD Functionality</li>



<li>Could add smart functionality – eg Power draw sensing, WiFi etc</li>
</ol>




		</div></div>
  </body>
</html>
