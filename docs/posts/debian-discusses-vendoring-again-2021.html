<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lwn.net/Articles/842319/">Original</a>
    <h1>Debian discusses vendoring again (2021)</h1>
    
    <div id="readability-page-1" class="page"><div>
<center>
           <div><b>LWN.net needs you!</b><p>Without subscribers, LWN would simply not exist.  Please consider
       <a href="https://lwn.net/subscribe/">signing up for a subscription</a> and helping
       to keep LWN publishing</p></div>
           </center>
           
<p>
The problems with &#34;vendoring&#34; in packages—bundling dependencies rather than
getting them from other packages—seems to crop up frequently these days.
We looked at Debian&#39;s <a href="https://lwn.net/Articles/835599/">concerns</a> about
packaging <a href="https://kubernetes.io/">Kubernetes</a> and its myriad of Go
dependencies back in October. A more recent discussion in that
distribution&#39;s community looks at another famously dependency-heavy
ecosystem: JavaScript libraries from the <a href="https://www.npmjs.com/">npm</a> repository.  Even C-based ecosystems
are not immune to the problem, as we <a href="https://lwn.net/Articles/836911/">saw with
iproute2 and libbpf</a> back in November;  the discussion of vendoring seems
likely to recur over the coming years. 
</p>

<p>
Many application projects, particularly those written in languages like
JavaScript, PHP, and Go, tend to have a rather large pile of
dependencies.  These projects typically simply download specific
versions of the needed dependencies at build time.  This works well for fast-moving
projects using collections of fast-moving libraries and frameworks, but it
works rather less well for traditional Linux distributions.  So
distribution projects have been trying to figure out how best to incorporate these
types of applications.
</p>

<p>
This time around, Raphaël Hertzog <a href="https://lwn.net/ml/debian-devel/X9pReHUtn9LWBu+B@home.ouaza.com/">raised the
issue</a> with regard to the <a href="https://docs.greenbone.net/src/gsa/7.0/index.html">Greenbone Security
Assistant</a> (gsa), which provides a web front-end to the <a href="https://www.openvas.org/">OpenVAS</a> vulnerability scanner (which is
now known as Greenbone Vulnerability Management or gvm).
</p><div><p>
[...]  the
version currently in Debian no longer works with the latest gvm
so we have to update it to the latest upstream release... but the
latest upstream release has significant changes, in particular
it now relies on yarn or npm from the node ecosystem to download
all the node modules that it needs (and there are many of them,
and there&#39;s no way that we will package them individually).
</p><p>
The Debian policy forbids download during the build so we can&#39;t
run the upstream build system as is.
</p></div>


<p>
Hertzog suggested three possible solutions: collecting all of
the dependencies into the Debian source package (though there would be
problems creating the <a href="https://www.debian.org/doc/packaging-manuals/copyright-format/1.0/"><tt>copyright</tt>
file</a>), moving the package to the
<a href="https://www.debian.org/doc/debian-policy/ch-archive#s-contrib">contrib
repository</a> and adding a post-install step to download the dependencies, or
removing gsa from
Debian entirely.  He is working on updating gsa as part of his work on
<a href="https://www.kali.org/">Kali Linux</a>, which is a Debian
derivative that is focused on penetration testing and security auditing.
Kali Linux does not have the same restrictions on downloading during builds
that Debian has, so the Kali gsa package can simply use the upstream build
process.
</p>

<p>
He would prefer to keep gsa in Debian, &#34;<q>but there&#39;s only so
much busy-work that I&#39;m willing to do to achieve this goal</q>&#34;.  He
wondered if it made more sense for Debian to consider relaxing its
requirements.  But Jonas Smedegaard <a href="https://lwn.net/ml/debian-devel/160814520549.3822905.17688764528316962056@auryn.jones.dk/">offered</a>
another possible approach: analyzing what packages are needed by gsa and
then either using existing Debian packages for those dependencies or
creating new ones for those that are not available.  Hertzog was convinced
that wouldn&#39;t be done, but Smedegaard said that the
JavaScript team is already <a href="https://wiki.debian.org/Javascript/Nodejs/Tasks">working on that
process</a> for multiple projects. 
</p>

<p>
Hertzog ran the analysis script described on that page and <a href="https://lwn.net/ml/debian-devel/X9tMDrI7ybtA/8md@home.ouaza.com/">pointed to</a>
the <a href="https://wiki.debian.org/Javascript/Nodejs/Tasks/gsa">output</a> from
the <tt>package.json</tt> file of gsa.  He said that it confirmed his
belief that there are too many dependencies to package;
&#34;<q>Even if you package everything, you will never ever have the right
combination of version of the various packages.</q>&#34; 
</p>

<p>
To many, that list looks daunting at best, impossible at worst, but
Smedegaard <a href="https://lwn.net/ml/debian-devel/160820908322.3822905.3803292725902751282@auryn.jones.dk/">seemed
unfazed</a>,  noting several reasons to believe that those dependencies can
be handled.  But
Hertzog <a href="https://lwn.net/ml/debian-devel/X9tjP0LAE31Errik@home.ouaza.com/">pointed
out</a> that the work is not of any real benefit, at least in his mind.  He
cannot justify spending lots of time packaging those npm modules (then
maintaining them) for a single package &#34;<q>when said package was updated in Kali in a matter of
hours</q>&#34;.  He thinks the distribution should focus its efforts
elsewhere:
</p><p>
By trying to shoehorn node/go modules into Debian packages we are creating
busy work with almost no value. We must go back to what is the value
added by Debian and find ways to continue to provide this value while
accepting the changed paradigm that some applications/ecosystems have
embraced.
</p>


<p>
He said that Debian is failing to keep up with the paradigm change in these other
ecosystems, which means that &#34;<q>many useful things</q>&#34; are not
being packaged.  Pirate Praveen agreed that there are useful things going
unpackaged, but <a href="https://lwn.net/ml/debian-devel/35MHLQ.PEWX0JI5RYHD@onenetbeyond.org/">disagreed
with Hertzog&#39;s approach</a> of simply using the upstream download-and-build
process.  Praveen thinks that a mix of vendoring (bundling) for
ultra-specific dependencies and creating
packages for more generally useful modules is the right way forward. It
comes down to distributions continuing to provide a particular service for their users:
</p><p>
All the current trends are making it easy for developers to ship code
directly to users. Which encourages more isolation instead of 
collaboration between projects. It also makes it easy for shipping more
proprietary code, duplication of security tracking or lack of it. 
Debian and other distributions have provided an important buffer between
developers and users as we did not necessarily follow the priorities or
choices of upstream developers exactly always.
</p>


<p>
One of the reasons Smedegaard felt that the dependencies for gsa could be
handled via Debian packages is that gsa (and other large projects) tend to
overspecify the versions required; in many cases, other versions (which
might already be packaged for Debian) work just fine.  But figuring that
out is &#34;<q>a substantial amount of work</q>&#34;, Josh Triplett <a href="https://lwn.net/ml/debian-devel/X91Ib/s8eQ4bt0NE@localhost/">said</a> in a lengthy
message. He
cautioned against the &#34;<q>standard tangent</q>&#34; where complaints
about the number of dependencies for these types of projects are aired.
</p><p>
[...] people
will still use fine-grained packages and dependencies per the standard
best-practices of those communities, no matter the number or content of
mails in this thread suggesting otherwise. The extremes of &#34;package for
a one-line function&#34; are not the primary issue here; not every
fine-grained dependency is that small, and the issues raised in this
mail still apply whether you have 200 dependencies or 600. So let&#39;s take
it as a given that packages *will* have hundreds of library
dependencies, and try to make that more feasible.
</p>


<p>
He said that disregarding a project&#39;s guidance on the versions for its
dependencies is fraught, especially for dynamically typed languages where
problems may only be detected at run time.   For those ecosystems, the
normal Debian practice of having only one version of a given library
available may be getting in the way.  Relaxing that requirement somewhat
could be beneficial:
</p><p>
 I&#39;m not suggesting there should be 50 versions of a given
library in the archive, but allowing 2-4 versions would greatly simplify
packaging, and would allow such unification efforts to take place
incrementally, via transitions *in the archive* and *in collaboration
with upstream*, rather than *all at once before a new package can be
uploaded*.
</p>


<p>
Triplett outlined the problems that developers encounter when trying to
package a project of this sort.  They can either try to make it work
with the older libraries available in Debian, upgrade the libraries in
Debian and fix all the resulting problems in every package that uses them,
or simply bundle the required libraries.  The first two are enormously
difficult in most cases, so folks settle for bundling, which is undesirable
but unavoidable:
</p><p>
Right now, Debian pushes back heavily on bundling, and *also* pushes
back heavily on all of the things that would solve the problems with
unbundled dependencies. That isn&#39;t sustainable. If we continue to push
back on bundling, we need to improve our tools and processes and
policies to make it feasible to maintain unbundled packages. Otherwise,
we need to build tools and processes and policies around bundled
dependencies. (Those processes could still include occasional
requirements for unbundling, such as for security-sensitive libraries.)
</p>


<p>
Adrian Bunk is <a href="https://lwn.net/ml/debian-devel/20201222220100.GA6924@localhost/">concerned</a> with
handling security problems in a world with multiple library versions.  He
said that these ecosystems seem to not be interested in supporting
stable packages for three to five years, as needed by distributions such
as Debian stable or Ubuntu LTS.  More library proliferation (version-wise)
just means more work for Debian when the inevitable CVE comes along, he said.
</p>

<p>
But Triplett <a href="https://lwn.net/ml/debian-devel/X+e/Vc/FsURXNuta@localhost/">said</a> that he is
not expecting there to be a lot of different library versions, but that at
times it might make sense to have more than one:
</p><div><p>
I&#39;m talking about packaging xyz 1.3.1 and 2.0.1, as separate xyz-1 and
xyz-2 packages, and allowing the use of both in build dependencies.
Then, a package using xyz-1 can work with upstream to migrate to xyz-2,
and when we have no more packages in the archive using xyz-1 we can drop
it.
</p><p>
That&#39;s different from requiring *exactly one* version of xyz, forcing
all packages to transition immediately, and preventing people from
uploading packages because they don&#39;t fork upstream and port to
different versions of dependencies.
</p></div>


<p>
It seems safe to say that few minds were changed in the course of the
discussion.  Bunk and Triplett seemed to talk past each other a fair bit.
And no one spoke up with some wild new solution to these problems.  But the
problems are not going to disappear anytime soon—or ever.   Without some
kind of shift, bundling will likely be the path of least resistance, at
least until some hideous security problem has to be fixed in enough
different packages that bundling is further restricted or prohibited.  That
would, of course, then require a different solution.
</p>

<p>
The approach currently
being taken by Smedegaard, Praveen, and others to tease out the
dependencies into their own packages has its attractions,
but scalability and feasibility within a volunteer-driven organization like Debian are not
among them.  The size and scope of the open-source-creating community is
vastly larger than Debian or any of its language-specific teams, so it
should not come as a surprise that the distribution is not keeping up.
Debian is hardly alone with this problem either, of course; it is a problem
that the Linux distribution community will continue to grapple with.
</p></div></div>
  </body>
</html>
