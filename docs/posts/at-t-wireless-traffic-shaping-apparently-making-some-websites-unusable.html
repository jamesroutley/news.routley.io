<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://adriano.fyi/post/2023/2023-04-16-att-traffic-shaping-makes-websites-unusable/">Original</a>
    <h1>AT&amp;T Wireless traffic shaping apparently making some websites unusable</h1>
    
    <div id="readability-page-1" class="page"><div role="main">
  <div>
    <div>
      <article role="main">
        <p>When I’m living in my RV, wireless service providers are my primary source of connectivity. So when either AT&amp;T or Verizon make major changes, I take notice.</p>
<p>I recently noticed that multiple websites are quite slow when browsing with my AT&amp;T business plan, listed in AT&amp;T Premier (business account management UI) as “Wireless Broadband Ultra for Router or Hotspt (sic)”. This is an “unlimited” <strong>100Mbit</strong> plan with 50GB for Business Fast Track (prioritized) data. Being that I was far below the 50GB of monthly Fast Track data, my data should have had top priority, so I became suspicious. To be honest, I’ve never noticed a discernible difference between Fast Track and non-Fast Track data rates. This is all to say that I have no reason to believe that I’m being deprioritized due to usage.</p>
<p>Naturally, the first hing I did was conduct a speed test. I already knew from previous experience that for some reason, AT&amp;T traffic to <a href="https://fast.com">fast.com</a> is throttled. Why AT&amp;T wants bandwidth to appear lower than reality is a mystery to me, but I digress. Linode.com has speed tests that AT&amp;T has no special treatment for, and the <a href="http://speedtest.fremont.linode.com/">nearest one to me</a> was in Fremont, CA.</p>
<p>The speedtest revealed <strong>21Mbps</strong> down and <strong>4.5Mbps</strong> up – pretty reasonable in a relatively rural area like Durango, CO. Latency was ~<strong>130ms</strong>. That speed certainly wouldn’t explain why it took anywhere between 15 seconds and 2 minutes to load <code>strava.com</code>.</p>
<p>So I opened up the “Network” tab in Firefox and could clearly see that dozens of resources from <code>cloudfront.com</code> were taking multiple seconds to load. The problem clearly has <em>something</em> to do with Cloudfront.</p>
<p>

<label for="zoomCheck-0c93c">
  <img loading="lazy" decoding="async" src="https://adriano.fyi/img/att_traffic_shaping_network_tab.png" alt="Firefox network tab loading strava.com" title="Firefox network tab loading strava.com"/>
</label>
</p>
<p>Is Cloudfront having problems? That’s easy enough to verify; my <a href="https://www.sierrawireless.com/router-solutions/rv55/">Sierra Wireless RV55 CAT-12 LTE-A router</a> also contains an unlimited Verizon Business SIM card that I can use to conduct tests on Cloudfront, independent of AT&amp;T.</p>
<p>I noticed that one of Strava’s javascript resources clocked in at <strong>1.68MB</strong>, making it a nice test subject for speed tests (<a href="https://web-assets.strava.com/assets/federated/find-and-invite-friends/827.js">https://web-assets.strava.com/assets/federated/find-and-invite-friends/827.js</a>). At the time of writing <code>web-assets.strava.com</code> resolves to <code>dgpcy4fyk1eox.cloudfront.net</code>, so rest assured, we are dealing with Cloudfront.</p>
<p>After switching to Verizon, I could see that Cloudfront was having no problems. Our friend <code>827.js</code> downloaded in just over 1 second at <strong>1.4MB/s</strong>. I clearly saw earlier in the Firefox network tab that this resource took nearly 1 minute to load on AT&amp;T.</p>
<blockquote>
<p>While <code>wget</code> is not my goto for command line HTTP fetching, it displays transfer rates in a human friendly format by default, so I used the following as my test case: <code>wget -O /dev/null -q --show-progress https://web-assets.strava.com/assets/federated/find-and-invite-friends/827.js</code></p>
</blockquote>
<p>So the problem isn’t Cloudfront, because Verizon was fast enough. It wasn’t blazing fast by any means, but I also didn’t have to wait 2 minutes to learn whether Strava awarded me King of the Moutain on a local trail (I wasn’t).</p>
<p>Maybe this is a global AT&amp;T problem. That’s easy to test as well – my iPhone is also on the same AT&amp;T business account as my data-only plan, so I turned on the iPhone hotspot and made it the router’s WAN device to make sure we’re changing a single variable at a time. I conducted another speed test, revealing <strong>23Mbps</strong> down and <strong>3Mbps</strong> up. Nothing surprising there – normal bandwidth fluctuations for a wireless device. How about our <code>wget</code> test? <strong>1.7MB/s</strong>. The problem is clearly not <em>all</em> of AT&amp;T wireless.</p>
<p>Let’s go back to the original configuration: connect directly to my AT&amp;T data-only plan with my router and re-run the <code>wget</code> test. Maybe I was imagining things. I’m somewhat surprised to see the <code>wget</code> test with a transfer rate of <strong>~30KB/s</strong>. I believe this rules out AT&amp;T with a souring peering agreement somewhere between me and Cloudfront. My phone traffic to Cloudfront is unaffected; it’s only my data-only plan that is affected.</p>
<p>I now have a pretty clear picture of what is likely happening. Good old-fashion traffic shaping. Now that the router is connected directly to AT&amp;T, the true test of traffic shaping is transfer rates while connected to a VPN. I’ll let the image speak for itself.</p>
<p>

<label for="zoomCheck-39fcb">
  <img loading="lazy" decoding="async" src="https://adriano.fyi/img/att_traffic_shaping.gif" alt="Traffic shaping in progress" title="traffic shaping in progress"/>
</label>
</p>
<hr/>
<p>As of the time of writing, I’m unsure what is causing such a significant slowdown. It has rendered some websites effectively useless. Everything in this writeup indicates, to me, that AT&amp;T is engaged in extremely aggressive traffic shaping for some plans, rendering many websites nearly unusable.</p>
<p>Do you have any ideas how to diagnose this problem further? Do you know the best way engage AT&amp;T’s technical folks to take this seriously? Write me at <code>att-traffic-shaping @ this domain</code>. I’ll add updates here if anything changes, or I get a response on <a href="https://bizcommunity.att.com">https://bizcommunity.att.com</a>.</p>

<hr/>
<h2 id="update-1-190309-utc">Update #1 (19:03:09 UTC)</h2>
<p>Here is a pcap file captured with <code>sudo tcpdump host &#39;dgpcy4fyk1eox.cloudfront.net&#39; -w capture.pcap</code>: <a href="https://adriano.fyi/files/capture.pcap">capture.pcap</a></p>
<p>I’ve also attempted to disable/enable IPv6 on my local machine and my VPN connection to check for any differences. No differences were observed.</p>
<h2 id="update-2-194300-utc">Update #2 (19:43:00 UTC)</h2>
<p>Traceroutes</p>
<p>Connected to AT&amp;T iPhone via Wifi hotspot</p>
<div><pre tabindex="0"><code data-lang="fallback"><span><span>traceroute web-assets.strava.com                                                                                                                                                    130 ↵
</span></span><span><span>traceroute to web-assets.strava.com (99.84.208.10), 30 hops max, 60 byte packets
</span></span><span><span> 1  _gateway (172.20.10.1)  4.386 ms  4.280 ms  5.292 ms
</span></span><span><span> 2  107.243.82.3 (107.243.82.3)  139.792 ms * *
</span></span><span><span> 3  * * *
</span></span><span><span> 4  * * *
</span></span><span><span> 5  * * *
</span></span><span><span> 6  * * *
</span></span><span><span> 7  * * *
</span></span><span><span> 8  * * *
</span></span><span><span> 9  * * *
</span></span><span><span>10  * * *
</span></span><span><span>11  * * *
</span></span><span><span>12  * * *
</span></span><span><span>13  12.117.216.210 (12.117.216.210)  244.538 ms  369.608 ms  933.487 ms
</span></span><span><span>14  * * *
</span></span><span><span>15  * * *
</span></span><span><span>16  * * *
</span></span><span><span>17  * * *
</span></span><span><span>18  * * *
</span></span><span><span>19  * * *
</span></span><span><span>20  * * *
</span></span><span><span>21  server-99-84-208-10.iad79.r.cloudfront.net (99.84.208.10)  206.664 ms  206.643 ms  206.623 ms
</span></span></code></pre></div><p>Connected to router on AT&amp;T business plan</p>
<div><pre tabindex="0"><code data-lang="fallback"><span><span>traceroute web-assets.strava.com
</span></span><span><span>traceroute to web-assets.strava.com (99.84.208.115), 30 hops max, 60 byte packets
</span></span><span><span> 1  _gateway (192.168.13.31)  61.896 ms  61.950 ms  62.064 ms
</span></span><span><span> 2  172.26.96.161 (172.26.96.161)  132.156 ms  132.775 ms  132.749 ms
</span></span><span><span> 3  107.72.231.188 (107.72.231.188)  132.743 ms  132.718 ms  132.199 ms
</span></span><span><span> 4  * * *
</span></span><span><span> 5  12.83.179.49 (12.83.179.49)  148.138 ms  148.187 ms  148.162 ms
</span></span><span><span> 6  slkut21crs.ip.att.net (12.122.1.186)  148.361 ms  137.643 ms  142.401 ms
</span></span><span><span> 7  dvmco22crs.ip.att.net (12.122.28.45)  146.657 ms  146.627 ms  149.389 ms
</span></span><span><span> 8  cgcil21crs.ip.att.net (12.122.28.78)  149.369 ms  149.345 ms  216.643 ms
</span></span><span><span> 9  12.122.28.206 (12.122.28.206)  149.302 ms  146.467 ms  149.256 ms
</span></span><span><span>10  wshdc84crs.ip.att.net (12.122.135.230)  146.421 ms  149.211 ms  149.161 ms
</span></span><span><span>11  wshdc406me9.ip.att.net (12.123.10.125)  143.819 ms  139.466 ms  139.378 ms
</span></span><span><span>12  12.117.216.210 (12.117.216.210)  139.342 ms  139.314 ms  187.019 ms
</span></span><span><span>13  * * *
</span></span><span><span>14  * * *
</span></span><span><span>15  * * *
</span></span><span><span>16  * * *
</span></span><span><span>17  * * *
</span></span><span><span>18  * * *
</span></span><span><span>19  * * *
</span></span><span><span>20  server-99-84-208-115.iad79.r.cloudfront.net (99.84.208.115)  152.577 ms  140.190 ms  141.460 ms
</span></span></code></pre></div><h2 id="update-3-215403-utc">Update #3 (21:54:03 UTC)</h2>
<p>Here is a pcap file captured with <code>sudo tcpdump host &#39;dgpcy4fyk1eox.cloudfront.net&#39; -w iphone-capture.pcap</code> while tethered to my AT&amp;T iPhone and fetching <code>827.js</code> with <code>wget -O /dev/null -q --show-progress https://web-assets.strava.com/assets/federated/find-and-invite-friends/827.js</code> : <a href="https://adriano.fyi/files/iphone-capture.pcap">iphone-capture.pcap</a></p>
<h2 id="update-4-233900-utc">Update #4 (23:39:00 UTC)</h2>
<p>As my initial post mentioned, I had hoped to get some sort of resolution by posting to <a href="http://bizcommunity.att.com">http://bizcommunity.att.com</a>. As of right now, that post <a href="https://bizcommunity.att.com/conversations/the-break-room/im-apparently-experiencing-extremely-aggressive-att-traffic-shaping/643c3d81aba4c269accb1a2b">https://bizcommunity.att.com/conversations/the-break-room/im-apparently-experiencing-extremely-aggressive-att-traffic-shaping/643c3d81aba4c269accb1a2b</a> has been marked as “Private”. This URL also 404s, unless I’m logged in under the account with which I posted it.</p>
<p>I can’t say whether this is normal practice on the bizcommunity forum, but I posted a followup post with a much more benign title, “Are all new posts here marked as private?” <a href="https://bizcommunity.att.com/conversations/the-break-room/are-all-new-posts-here-marked-as-private/643c866bb67b2d067eb0985c">https://bizcommunity.att.com/conversations/the-break-room/are-all-new-posts-here-marked-as-private/643c866bb67b2d067eb0985c</a>, which as of right now is not private and still accessible to the public.</p>
<h2 id="update-5-235400-utc">Update #5 (23:54:00 UTC)</h2>
<p>Hello reader, I’m another HN member trying to help get to the bottom of this! I’ve analyzed all the data provided and feel confident there is some kind of manipulation / throttling happening with Adriano’s AT&amp;T business plan, but if anyone wants to correct my interpretation or provide other insights feel free to reach out to me on my <a href="https://rasbora.dev/">blog</a>!</p>
<p>We start by analyzing the packet capture from the throttled connection. There are a few takeaways from this:</p>
<ul>
<li>TCP segment &amp; window sizes have normal values.</li>
<li>There are almost no retransmissions or lost packets.</li>
<li>There appears to be ample room for the TCP stream to scale up to a much faster speed.</li>
<li>The TCP stream starts scaling up to 800Kbps before dramatically going down.</li>
<li>The TCP stream regularly blocks for 50-200ms intervals waiting for new data to arrive from cloudfront.</li>
<li>These blocks coincide with throughput scaling up to ~350Kbps.</li>
</ul>
<p>

<label for="zoomCheck-f99c9">
  <img loading="lazy" decoding="async" src="https://adriano.fyi/img/att_throughput.png" alt="ATT Throughput" title="ATT Throughput"/>
</label>
</p>
<p>

<label for="zoomCheck-b0954">
  <img loading="lazy" decoding="async" src="https://adriano.fyi/img/att_rtt.png" alt="ATT RTT" title="ATT RTT"/>
</label>
</p>
<p>All of the spikes in round trip time correspond to a segment of the stream where the client acknowladges receipt of new data and is forced to wait 50-200ms for any new data to arrive. This happens at a regular cadence that appears artificial in nature (i.e not regular network congestion) because the throughput chart stays within a well defined boundary.</p>
<p>If this were a problem with AT&amp;T’s network or a side effect of LTE networks being inherently high latency we would expect to observe similair patterns over the iphone connection:</p>
<p>

<label for="zoomCheck-90505">
  <img loading="lazy" decoding="async" src="https://adriano.fyi/img/iphone_throughput.png" alt="iphone Throughput" title="iphone Throughput"/>
</label>
</p>
<p>

<label for="zoomCheck-07ed4">
  <img loading="lazy" decoding="async" src="https://adriano.fyi/img/iphone_rtt.png" alt="iphone RTT" title="iphone RTT"/>
</label>
</p>
<p>We can draw a few conclusions from these charts:</p>
<ul>
<li>The iphone AT&amp;T connection doesn’t exhibit the same RTT or throughput pattern despite having similair latency &amp; network routing.</li>
<li>The throughput chart is indicative of a healthy TCP stream that slowly scales up the total bandwidth to make the most out of available network resources.</li>
<li>We are never waiting very long for fresh data to arrive.</li>
</ul>
<p>In my opinion these patterns rule out any extraneous factors affecting the network and are indicative of intentional manipulation of the TCP stream. If AT&amp;T were to occasionaly drop an incoming packet than the client would never send an acknowledgement to cloudfront and after a little while cloudfront would automatically retransmit that packet, on our client side packet capture we would observe this as a packet coming in with a big delay, if we were being rate limited we would expect to see these delayed packets coming in regularly around the time when we were starting to hit a threshold, it seems likely AT&amp;T is dropping certain inbound packets once the incoming rate reaches around ~350Kbps.</p>
<h2 id="update-6-004300-utc">Update #6 (00:43:00 UTC)</h2>
<p>Refer to Update #4 above: I’m getting shut down on the AT&amp;T bizcommunity site. My posts are being marked private, so I’ll save them here for posterity.</p>
<h3 id="forum-post-1-im-apparently-experiencing-extremely-aggressive-att-traffic-shaping">Forum Post 1: I’m apparently experiencing extremely aggressive AT&amp;T traffic shaping</h3>
<p>URL (was public): <a href="https://bizcommunity.att.com/conversations/the-break-room/im-apparently-experiencing-extremely-aggressive-att-traffic-shaping/643c3d81aba4c269accb1a2b">https://bizcommunity.att.com/conversations/the-break-room/im-apparently-experiencing-extremely-aggressive-att-traffic-shaping/643c3d81aba4c269accb1a2b</a></p>
<p>The short of it is that I’m experiencing what appears to be aggressive traffic shaping by AT&amp;T. Many sites are affected, because Cloudflare is one content delivery network for which AT&amp;T is apparently shaping my traffic.</p>
<p>This is a business account.  I have both cell phone devices and a data-only plan “Wireless Broadband Ultra for Router or Hotspt  (sic)” on the account. Only the data-only plan is affected.</p>
<p>Because Cloudflare is such a large content delivery network, this affects millions of websites. A large percentage of the websites I’ve accessed over the last few days have been affected, forcing me to use a VPN to subvert the problem.</p>
<p>I’ve added more concrete data in a writeup on my personal website: <a href="https://adriano.fyi/post/2023/2023-04-16-att-traffic-shaping-makes-websites-unusable">https://adriano.fyi/post/2023/2023-04-16-att-traffic-shaping-makes-websites-unusable</a></p>
<p>The data paint a fairly clear picture of traffic shaping.</p>
<p>[ GIF IMAGE FROM ABOVE HERE ]
[ NOTE: web-assets.strava.com resolves to Cloudflare, see the writeup on my site for details ]</p>
<p>I’d love to get a response from AT&amp;T on the matter because this is a major performance degradation to the point that many websites are unusable. Is anyone else experiencing similar issues?</p>
<p>Cheers,
AC</p>
<h3 id="forum-post-2-are-all-new-posts-here-marked-as-private">Forum Post 2: Are all new posts here marked as private?</h3>
<p>URL (currently public): <a href="https://bizcommunity.att.com/conversations/the-break-room/are-all-new-posts-here-marked-as-private/643c866bb67b2d067eb0985c">https://bizcommunity.att.com/conversations/the-break-room/are-all-new-posts-here-marked-as-private/643c866bb67b2d067eb0985c</a></p>
<p>I posted earlier today regarding a traffic shaping issue that I’m experiencing. The title of the post is “I’m apparently experiencing extremely aggressive AT&amp;T traffic shaping”. When I came back to check for any responses, I see that my previous post is marked as “Private”, which I don’t believe was under my control, and certainly wasn’t my intention.</p>
<p>This post is a test to see whether posts are automatically flagged as private, or if someone took action on my last post to mark it as private.</p>
<p>[edit] As of 2023-04-16 23:37 UTC, this post is not Private like my previous post.</p>
<h3 id="response-and-followup-to-forum-post-2">Response and followup to Forum Post 2</h3>
<p>Notice the <code>Private</code> label on my response. So it looks to others like I impolitely never respond to their polite response.</p>
<p>

<label for="zoomCheck-2e748">
  <img loading="lazy" decoding="async" src="https://adriano.fyi/img/att_bizcommunity_marked_private.png" alt="respones and followup to forum post 2" title="getting shut down in bizcommunity"/>
</label>
</p>
<h2 id="update-6-2023-04-17-041200-utc">Update #6 (2023-04-17 04:12:00 UTC)</h2>
<p>This ended with the least satisfying end one could expect. Over on Hacker News <code>kevin_nisbet</code> <a href="https://news.ycombinator.com/item?id=35595891">recommended changing the APN</a> on the device to see if there were any routing differences. I changed the APN to <code>NXTGENPHONE</code>, which I figured would work as a “generic LTE device”, per <a href="https://www.att.com/support/article/wireless/KM1062162/">https://www.att.com/support/article/wireless/KM1062162/</a>. However, the router was not able to authenticate with the <code>NXTGENPHONE</code> APN, so I switched back to <code>broadband</code>.</p>
<p>After switching back and re-authenticating with the <code>broadband</code> APN, I’m no longer being throttled.</p>
<p>I’ll keep monitoring for future throttling and add any responses from the <code>bizcommunity</code> admins.</p>
<p>For now, we’re done here.</p>


        
          
        

        

        
      </article>

      
        
      


      

    </div>
  </div>
</div></div>
  </body>
</html>
