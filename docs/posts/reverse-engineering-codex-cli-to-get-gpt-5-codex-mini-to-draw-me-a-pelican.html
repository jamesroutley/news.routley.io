<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://simonwillison.net/2025/Nov/9/gpt-5-codex-mini/">Original</a>
    <h1>Reverse engineering Codex CLI to get GPT-5-Codex-Mini to draw me a pelican</h1>
    
    <div id="readability-page-1" class="page"><div>


<div data-permalink-context="/2025/Nov/9/gpt-5-codex-mini/">

<p>9th November 2025</p>



<p>OpenAI partially released a new model yesterday called GPT-5-Codex-Mini, which they <a href="https://x.com/OpenAIDevs/status/1986861734619947305">describe</a> as &#34;a more compact and cost-efficient version of GPT-5-Codex&#34;. It’s currently only available via their Codex CLI tool and VS Code extension, with proper API access &#34;<a href="https://x.com/OpenAIDevs/status/1986861736041853368">coming soon</a>&#34;. I decided to use Codex to reverse engineer the Codex CLI tool and give me the ability to prompt the new model directly.</p>
<p>I made <a href="https://www.youtube.com/watch?v=9o1_DL9uNlM">a video</a> talking through my progress and demonstrating the final results.</p>



<ul>
  <li><a href="https://simonwillison.net/2025/Nov/9/gpt-5-codex-mini/#this-is-a-little-bit-cheeky">This is a little bit cheeky</a></li>
  <li><a href="https://simonwillison.net/2025/Nov/9/gpt-5-codex-mini/#codex-cli-is-written-in-rust">Codex CLI is written in Rust</a></li>
  <li><a href="https://simonwillison.net/2025/Nov/9/gpt-5-codex-mini/#iterating-on-the-code">Iterating on the code</a></li>
  <li><a href="https://simonwillison.net/2025/Nov/9/gpt-5-codex-mini/#let-s-draw-some-pelicans">Let’s draw some pelicans</a></li>
  <li><a href="https://simonwillison.net/2025/Nov/9/gpt-5-codex-mini/#bonus-the-debug-option">Bonus: the --debug option</a></li>
</ul>

<h4 id="this-is-a-little-bit-cheeky">This is a little bit cheeky</h4>
<p>OpenAI clearly don’t intend for people to access this model directly just yet. It’s available exclusively through Codex CLI which is a privileged application—it gets to access a special backend API endpoint that’s not publicly documented, and it uses a special authentication mechanism that bills usage directly to the user’s existing ChatGPT account.</p>
<p>I figured reverse-engineering that API directly would be somewhat impolite. But... Codex CLI is an open source project released under an Apache 2.0 license. How about upgrading that to let me run my own prompts through its existing API mechanisms instead?</p>
<p>This felt like a somewhat absurd loophole, and I couldn’t resist trying it out and seeing what happened.</p>
<h4 id="codex-cli-is-written-in-rust">Codex CLI is written in Rust</h4>
<p>The <a href="https://github.com/openai/codex">openai/codex</a> repository contains the source code for the Codex CLI tool, which OpenAI rewrote in Rust just a few months ago.</p>
<p>I don’t know much Rust at all.</p>
<p>I made my own clone on GitHub and checked it out locally:</p>
<div><pre>git clone git@github.com:simonw/codex
<span>cd</span> codex</pre></div>
<p>Then I fired up Codex itself (in dangerous mode, because I like living dangerously):</p>
<div><pre>codex --dangerously-bypass-approvals-and-sandbox</pre></div>
<p>And ran this prompt:</p>
<blockquote>
<p>Figure out how to build the rust version of this tool and then build it</p>
</blockquote>
<p>This worked. It churned away for a bit and figured out how to build itself. This is a useful starting point for a project like this—in figuring out the compile step the coding agent gets seeded with a little bit of relevant information about the project, and if it can compile that means it can later partially test the code it is writing while it works.</p>
<p>Once the compile had succeeded I fed it the design for the new feature I wanted:</p>
<blockquote>
<p>Add a new sub-command to the Rust tool called “codex prompt”</p>
<p>codex prompt “prompt goes here”—this runs the given prompt directly against the OpenAI API that Codex uses, with the same code path and authentication credentials as the rest of Codex.</p>
<p>codex prompt -m &lt;model_name&gt; “prompt goes here”—same again but lets you set the model</p>
<p>codex prompt “prompt goes here” -s/--system “system prompt goes here”—runs with a custom system/developer message</p>
<p>codex prompt --models—this lists all available models that can be used with the “codex prompt” command</p>
</blockquote>
<p>My design for this new sub-command is lifted directly from my own <a href="https://llm.datasette.io/en/stable/help.html#llm-prompt-help">llm command</a>.</p>
<h4 id="iterating-on-the-code">Iterating on the code</h4>
<p>Codex got to work. I’ve <a href="https://gistpreview.github.io/?ddabbff092bdd658e06d8a2e8f142098">shared the full transcript here</a> (using the tool <a href="https://simonwillison.net/2025/Oct/23/claude-code-for-web-video/">I described here</a>), but this TODO list it made itself is a useful summary of what it decided to do:</p>
<pre><code>Updated Plan
└ ✔ Inspect CLI structure and relevant core utilities for sending prompts and listing models
  ✔ Implement new `codex prompt` subcommand (CLI plumbing + command handler)
  ✔ Format, lint, and test (`just fmt`, `just fix -p codex-cli`, `cargo test -p codex-cli`)
</code></pre>
<p>I like that it figured out <a href="https://github.com/openai/codex/blob/a47181e471b6efe55e95f9858c913fc89a3a44fa/codex-rs/justfile">the justfile</a> in the repo and decided to use it to run formatting and linting commands without me needing to tell it to. (Update: it turns out that was dictated by the <a href="https://github.com/openai/codex/blob/f8b30af6dc275b3e64de5f1987e6cafe604cb72a/AGENTS.md">AGENTS.md</a> file.)</p>
<p>I tried running the first version of the code it wrote like this:</p>
<div><pre>./target/debug/codex prompt <span><span>&#39;</span>Generate an SVG of a pelican riding a bicycle<span>&#39;</span></span> -m gpt-5-codex-mini</pre></div>
<p>... and it didn’t quite work. I got this:</p>
<pre><code>(reasoning summary) **Seeking
(reasoning summary)  instructions
(reasoning summary)  and
(reasoning summary)  sandbox
(reasoning summary)  info
(reasoning summary) **
(reasoning summary) **Dec
(reasoning summary) iding
(reasoning summary)  on
(reasoning summary)  SVG
(reasoning summary)  creation
(reasoning summary)  approach
(reasoning summary) **
(reasoning summary) **Checking
(reasoning summary)  current
(reasoning summary)  directory
(reasoning summary) **
(reasoning summary) **Preparing
(reasoning summary)  to
(reasoning summary)  check
(reasoning summary)  current
(reasoning summary)  directory
(reasoning summary) **
I�m ready to help�what would you like me to do next?I�m ready to help�what would you like me to do next?
Token usage: total=2459 input=2374 cached_input=0 output=85 reasoning_output=64
</code></pre>
<p>Note that it DID think about SVG creation, but then decided it should look at the current directory. This isn’t what I want—it appeared to be running in Codex’s normal mode with a system prompt telling it to edit files on disk. I wanted it to respond to the prompt without acting as if it had a full workspace available to it.</p>
<p>I prompted it again, pasting in the broken output:</p>
<blockquote>
<p>this did not seem to work—here is what happened—note that the reasoning summary comes out on a lot of lines when I would rather it streams out to stderr on the same line (flushing constantly)—and then despite the reasoning summary thinking about pelican on SVG it did not actually act on that and display the result, which is very surprising. [pasted content]</p>
</blockquote>
<p>It churned for a bit more, but from the output it looked like it was still trying to include Codex-specific tools and workspace information. So I said:</p>
<blockquote>
<p>Note that this new ’codex prompt’ command should NOT be able to execute any tools at all, and should not have to think about the workspace or sandbox—it should send a single prompt with no tools and then stream and display a response and then stop.</p>
</blockquote>
<p>This got me a new build, but when I ran it:</p>
<pre><code>Error: unexpected status 400 Bad Request: {&#34;detail&#34;:&#34;Instructions are not valid&#34;}
</code></pre>
<p>My guess is that OpenAI’s custom backend API for Codex doesn’t like it if you attempt to call it <em>without</em> passing in the expected instructions. Fair enough!</p>
<p>Rather than paste that error in I got Codex to try the command itself, so it could see the error:</p>
<blockquote>
<p>You try running this and see what happens: ./target/debug/codex prompt ’Generate an SVG of a pelican riding a bicycle’</p>
</blockquote>
<p>Codex switched back to the default instructions. From its reply:</p>
<blockquote>
<p><code>cli/src/prompt_cmd.rs#L1-L320</code> now forces a tool-free request: we keep the workspace defaults, inject a lightweight system/developer message (“don’t run tools”), disable apply_patch/web search via config overrides, and build the outbound prompt as just that system span plus the user text.</p>
</blockquote>
<p>I guess that will have to do. I asked for one more feature:</p>
<blockquote>
<p>Add a --debug option to the codex prompt command which causes the full JSON request and response to be printed to stderr, plus the URL that is being accessed and the HTTP verb</p>
</blockquote>
<p>... and we’re ready to try this thing out!</p>
<p>Notably I haven’t written a single line of Rust myself here and paid almost no attention to what it was actually doing. My main contribution was to run the binary every now and then to see if it was doing what I needed yet.</p>
<p>I’ve pushed the working code to <a href="https://github.com/simonw/codex/compare/a47181e471b6efe55e95f9858c913fc89a3a44fa...ae5f98a9248a8edb5d3c53261273a482fc0b5306">a prompt-subcommand branch in my repo</a> if you want to take a look and see how it all works.</p>

<h4 id="let-s-draw-some-pelicans">Let’s draw some pelicans</h4>
<p>With the final version of the code built, I drew some pelicans. Here’s the <a href="https://gistpreview.github.io/?a11f9ac456d2b2bc3715ba900ef1203d">full terminal transcript</a>, but here are some highlights.</p>
<p>This is with the default GPT-5-Codex model:</p>
<div><pre>./target/debug/codex prompt <span><span>&#34;</span>Generate an SVG of a pelican riding a bicycle<span>&#34;</span></span></pre></div>
<p>I pasted it into my <a href="https://tools.simonwillison.net/svg-render">tools.simonwillison.net/svg-render</a> tool and got the following:</p>
<p><img src="https://static.simonwillison.net/static/2025/codex-hacking-default.png" alt="It&#39;s a dumpy little pelican with a weird face, not particularly great"/></p>
<p>I ran it again for GPT-5:</p>
<div><pre>./target/debug/codex prompt <span><span>&#34;</span>Generate an SVG of a pelican riding a bicycle<span>&#34;</span></span> -m gpt-5</pre></div>
<p><img src="https://static.simonwillison.net/static/2025/codex-hacking-gpt-5.png" alt="Much better bicycle, pelican is a bit line-drawing-ish but does have the necessary parts in the right places"/></p>
<p>And now the moment of truth... GPT-5 Codex Mini!</p>
<div><pre>./target/debug/codex prompt <span><span>&#34;</span>Generate an SVG of a pelican riding a bicycle<span>&#34;</span></span> -m gpt-5-codex-mini</pre></div>
<p><img src="https://static.simonwillison.net/static/2025/codex-hacking-mini.png" alt="This is terrible. The pelican is an abstract collection of shapes, the bicycle is likewise very messed up"/></p>
<p>I don’t think I’ll be adding that one to my SVG drawing toolkit any time soon.</p>

<h4 id="bonus-the-debug-option">Bonus: the --debug option</h4>
<p>I had Codex add a <code>--debug</code> option to help me see exactly what was going on.</p>
<div><pre>./target/debug/codex prompt -m gpt-5-codex-mini <span><span>&#34;</span>Generate an SVG of a pelican riding a bicycle<span>&#34;</span></span> --debug</pre></div>
<p>The output starts like this:</p>
<pre><code>[codex prompt debug] POST https://chatgpt.com/backend-api/codex/responses
[codex prompt debug] Request JSON:
</code></pre>
<div><pre>{
  <span>&#34;model&#34;</span>: <span><span>&#34;</span>gpt-5-codex-mini<span>&#34;</span></span>,
  <span>&#34;instructions&#34;</span>: <span><span>&#34;</span>You are Codex, based on GPT-5. You are running as a coding agent ...<span>&#34;</span></span>,
  <span>&#34;input&#34;</span>: [
    {
      <span>&#34;type&#34;</span>: <span><span>&#34;</span>message<span>&#34;</span></span>,
      <span>&#34;role&#34;</span>: <span><span>&#34;</span>developer<span>&#34;</span></span>,
      <span>&#34;content&#34;</span>: [
        {
          <span>&#34;type&#34;</span>: <span><span>&#34;</span>input_text<span>&#34;</span></span>,
          <span>&#34;text&#34;</span>: <span><span>&#34;</span>You are a helpful assistant. Respond directly to the user request without running tools or shell commands.<span>&#34;</span></span>
        }
      ]
    },
    {
      <span>&#34;type&#34;</span>: <span><span>&#34;</span>message<span>&#34;</span></span>,
      <span>&#34;role&#34;</span>: <span><span>&#34;</span>user<span>&#34;</span></span>,
      <span>&#34;content&#34;</span>: [
        {
          <span>&#34;type&#34;</span>: <span><span>&#34;</span>input_text<span>&#34;</span></span>,
          <span>&#34;text&#34;</span>: <span><span>&#34;</span>Generate an SVG of a pelican riding a bicycle<span>&#34;</span></span>
        }
      ]
    }
  ],
  <span>&#34;tools&#34;</span>: [],
  <span>&#34;tool_choice&#34;</span>: <span><span>&#34;</span>auto<span>&#34;</span></span>,
  <span>&#34;parallel_tool_calls&#34;</span>: <span>false</span>,
  <span>&#34;reasoning&#34;</span>: {
    <span>&#34;summary&#34;</span>: <span><span>&#34;</span>auto<span>&#34;</span></span>
  },
  <span>&#34;store&#34;</span>: <span>false</span>,
  <span>&#34;stream&#34;</span>: <span>true</span>,
  <span>&#34;include&#34;</span>: [
    <span><span>&#34;</span>reasoning.encrypted_content<span>&#34;</span></span>
  ],
  <span>&#34;prompt_cache_key&#34;</span>: <span><span>&#34;</span>019a66bf-3e2c-7412-b05e-db9b90bbad6e<span>&#34;</span></span>
}</pre></div>
<p>This reveals that OpenAI’s private API endpoint for Codex CLI is <code>https://chatgpt.com/backend-api/codex/responses</code>.</p>
<p>Also interesting is how the <code>&#34;instructions&#34;</code> key (truncated above, <a href="https://gist.github.com/simonw/996388ecf785ad54de479315bd4d33b7">full copy here</a>) contains the default instructions, without which the API appears not to work—but it also shows that you can send a message with <code>role=&#34;developer&#34;</code> in advance of your user prompt.</p>


</div>



</div></div>
  </body>
</html>
