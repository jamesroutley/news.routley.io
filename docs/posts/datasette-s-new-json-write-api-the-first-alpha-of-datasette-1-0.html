<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://simonwillison.net/2022/Dec/2/datasette-write-api/">Original</a>
    <h1>Datasette’s new JSON write API: The first alpha of Datasette 1.0</h1>
    
    <div id="readability-page-1" class="page"><div id="primary">

<div>




<p>This week I published <a href="https://docs.datasette.io/en/latest/changelog.html#a0-2022-11-29">the first alpha release of Datasette 1.0</a>, with a significant new feature: Datasette core now includes <a href="https://docs.datasette.io/en/latest/json_api.html#the-json-write-api">a JSON API</a> for creating and dropping tables and inserting, updating and deleting data.</p>
<p><img alt="The Datasette logo" src="https://static.simonwillison.net/static/2022/datasette.svg"/></p>
<p>Combined with Datasette’s existing APIs for reading and filtering table data and executing SELECT queries this effectively turns Datasette into a SQLite-backed JSON data layer for any application.</p>
<p>If you squint at it the right way, you could even describe it as offering a NoSQL interface to a SQL database!</p>
<p>My initial motivation for this work was to provide an API for loading data into my <a href="https://datasette.cloud/">Datasette Cloud</a> SaaS product—but now that I’ve got it working I’m realizing that it can be applied to a whole host of interesting things.</p>
<p>I shipped <a href="https://docs.datasette.io/en/latest/changelog.html#a0-2022-11-29">the 1.0a0 alpha</a> on Wednesday, then spent the last two days ironing out some bugs (released in <a href="https://docs.datasette.io/en/latest/changelog.html#a1-2022-12-01">1.0a1</a>) and building some illustrative demos.</p>
<h4>Scraping Hacker News to build an atom feed</h4>
<p>My first demo reuses my <a href="https://github.com/simonw/scrape-hacker-news-by-domain">scrape-hacker-news-by-domain</a> project from earlier this year.</p>
<p><a href="https://news.ycombinator.com/from?site=simonwillison.net">https://news.ycombinator.com/from?site=simonwillison.net</a> is the page on Hacker News that shows submissions from my blog. I like to keep an eye on that page to see if anyone has linked to my work.</p>
<p><img alt="The page lists posts from my blog - the top one has 222 points and 39 comments, but most of the others have 2 or 3 points and no discussion at all." src="https://static.simonwillison.net/static/2022/hacker-news-from.jpg"/></p>
<p>Data from that page is not currently available through the <a href="https://github.com/HackerNews/API">official Hacker News API</a>... but it’s in an HTML format that’s pretty easy to scrape.</p>
<p>My <a href="https://shot-scraper.datasette.io/">shot-scraper</a> command-line browser automation tool has the ability to execute JavaScript against a web page and return scraped data as JSON.</p>
<p>I wrote about that in <a href="https://simonwillison.net/2022/Mar/14/scraping-web-pages-shot-scraper/">Scraping web pages from the command line with shot-scraper</a>, including a recipe for scraping that Hacker News page that looks like this:</p>
<div><pre>shot-scraper javascript \
  <span><span>&#34;</span>https://news.ycombinator.com/from?site=simonwillison.net<span>&#34;</span></span> \
  -i scrape.js -o simonwillison-net.json</pre></div>
<p>Here’s that <a href="https://github.com/simonw/scrape-hacker-news-by-domain/blob/main/scrape.js">scrape.js</a> script.</p>
<p>I’ve been running a <a href="https://simonwillison.net/2020/Oct/9/git-scraping/">Git scraper</a> that executes that scraping script using GitHub Actions for several months now, out of my <a href="https://github.com/simonw/scrape-hacker-news-by-domain">simonw/scrape-hacker-news-by-domain</a> repository.</p>
<p>Today I modified that script to also publish the data it has scraped to my personal Datasette Cloud account using the new  API—and then used the <a href="https://datasette.io/plugins/datasette-atom">datasette-atom</a> plugin to generate an Atom feed from that data.</p>
<p>Here’s <a href="https://simon.datasette.cloud/data/hacker_news_posts?_sort_desc=dt">the new table</a> in Datasette Cloud.</p>
<p>This is the <code>bash</code> script that runs in GitHub Actions and pushes the data to Datasette:</p>
<div><pre><span>export</span> SIMONWILLISON_ROWS=<span><span>$(</span></span>
<span>  jq -n --argjson rows <span><span>&#34;</span><span><span>$(</span>cat simonwillison-net.json<span>)</span></span><span>&#34;</span></span> \</span>
<span>  <span><span>&#39;</span>{ &#34;rows&#34;: $rows, &#34;replace&#34;: true }<span>&#39;</span></span></span>
<span><span>)</span></span>
curl -X POST \
  https://simon.datasette.cloud/data/hacker_news_posts/-/insert \
  -H <span><span>&#34;</span>Content-Type: application/json<span>&#34;</span></span> \
  -H <span><span>&#34;</span>Authorization: Bearer <span>$DS_TOKEN</span><span>&#34;</span></span> \
  -d <span><span>&#34;</span><span>$SIMONWILLISON_ROWS</span><span>&#34;</span></span></pre></div>
<p><code>$DS_TOKEN</code> is an environment variable containing a signed API token, see the <a href="https://docs.datasette.io/en/latest/authentication.html#api-tokens">API token documentation</a> for details.</p>
<p>I’m using <code>jq</code> here (with a recipe <a href="https://til.simonwillison.net/gpt3/jq">generated using GPT-3</a>) to convert the scraped data into the JSON format needeed by the Datasette API. The result looks like this:</p>
<div><pre>{
  <span>&#34;rows&#34;</span>: [
    {
      <span>&#34;id&#34;</span>: <span><span>&#34;</span>33762438<span>&#34;</span></span>,
      <span>&#34;title&#34;</span>: <span><span>&#34;</span>Coping strategies for the serial project hoarder<span>&#34;</span></span>,
      <span>&#34;url&#34;</span>: <span><span>&#34;</span>https://simonwillison.net/2022/Nov/26/productivity/<span>&#34;</span></span>,
      <span>&#34;dt&#34;</span>: <span><span>&#34;</span>2022-11-27T12:12:56<span>&#34;</span></span>,
      <span>&#34;points&#34;</span>: <span>222</span>,
      <span>&#34;submitter&#34;</span>: <span><span>&#34;</span>usrme<span>&#34;</span></span>,
      <span>&#34;commentsUrl&#34;</span>: <span><span>&#34;</span>https://news.ycombinator.com/item?id=33762438<span>&#34;</span></span>,
      <span>&#34;numComments&#34;</span>: <span>38</span>
    }
  ],
  <span>&#34;replace&#34;</span>: <span>true</span>
}</pre></div>
<p>This is then POSTed up to the <code>https://simon.datasette.cloud/data/hacker_news_posts/-/insert</code> API endpoint.</p>
<p>The <code>&#34;rows&#34;</code> key is a list of rows to be inserted.</p>
<p><code>&#34;replace&#34;: true</code> tells Datasette to replace any existing rows with the same primary key. Without that, the API would return an error if any rows already existed.</p>
<p>The API also accepts <code>&#34;ignore&#34;: true</code> which will cause it to ignore any rows that already exist.</p>
<p>Full insert API documentation <a href="https://docs.datasette.io/en/latest/json_api.html#inserting-rows">is here</a>.</p>
<h4>Initially creating the table</h4>
<p>Before I could insert any rows I needed to create the table.</p>
<p>I did that from the command-line too, using this recipe:</p>
<div><pre><span>export</span> ROWS=<span><span>$(</span></span>
<span>  jq -n --argjson rows <span><span>&#34;</span><span><span>$(</span>cat simonwillison-net.json<span>)</span></span><span>&#34;</span></span> \</span>
<span>  <span><span>&#39;</span>{ &#34;table&#34;: &#34;hacker_news_posts&#34;, &#34;rows&#34;: $rows, &#34;pk&#34;: &#34;id&#34; }<span>&#39;</span></span></span>
<span><span>)</span></span>
<span><span>#</span> Use curl to POST some JSON to a URL</span>
curl -X POST \
  https://simon.datasette.cloud/data/-/create \
  -H <span><span>&#34;</span>Content-Type: application/json<span>&#34;</span></span> \
  -H <span><span>&#34;</span>Authorization: Bearer <span>$DS_TOKEN</span><span>&#34;</span></span> \
  -d <span>$ROWS</span></pre></div>
<p>This uses the same trick as above, but hits a different API endpoint: <code>/data/-/create</code> which is the endpoint for <a href="https://docs.datasette.io/en/latest/json_api.html#creating-a-table">creating a table</a> in the <code>data.db</code> database.</p>
<p>The JSON submitted to that endpoint looks like this:</p>
<div><pre>{
  <span>&#34;table&#34;</span>: <span><span>&#34;</span>hacker_news_posts<span>&#34;</span></span>,
  <span>&#34;pk&#34;</span>: <span><span>&#34;</span>id<span>&#34;</span></span>,
  <span>&#34;rows&#34;</span>: [
    {
      <span>&#34;id&#34;</span>: <span><span>&#34;</span>33762438<span>&#34;</span></span>,
      <span>&#34;title&#34;</span>: <span><span>&#34;</span>Coping strategies for the serial project hoarder<span>&#34;</span></span>,
      <span>&#34;url&#34;</span>: <span><span>&#34;</span>https://simonwillison.net/2022/Nov/26/productivity/<span>&#34;</span></span>,
      <span>&#34;dt&#34;</span>: <span><span>&#34;</span>2022-11-27T12:12:56<span>&#34;</span></span>,
      <span>&#34;points&#34;</span>: <span>222</span>,
      <span>&#34;submitter&#34;</span>: <span><span>&#34;</span>usrme<span>&#34;</span></span>,
      <span>&#34;commentsUrl&#34;</span>: <span><span>&#34;</span>https://news.ycombinator.com/item?id=33762438<span>&#34;</span></span>,
      <span>&#34;numComments&#34;</span>: <span>38</span>
    }
  ]
}</pre></div>
<p>It’s almost the same shape as the <code>/-/insert</code> call above. That’s because it’s using a feature of the Datasette API inherited from <a href="https://sqlite-utils.datasette.io/">sqlite-utils</a>—it can create a table from a list of rows, automatically determining the correct schema.</p>
<p>If you already know your schema you can pass a <code>&#34;columns&#34;: [...]</code> key instead, but I’ve found that this kind of automatic schema generation works really well in practice.</p>
<p>Datasette will let you call the create API like that multiple times, and if the table already exists it will insert new rows directly into the existing tables. I expect this to be a really convenient way to write automation scripts where you don’t want to bother checking if the table exists already.</p>
<h4>Building an Atom feed</h4>
<p>My end goal with this demo was to build an Atom feed I could subscribe to in my NetNewsWire feed reader.</p>
<p>I have a plugin for that already: <a href="https://datasette.io/plugins/datasette-atom">datasette-atom</a>, which lets you generate an Atom feed for any data in Datasette, defined using a SQL query.</p>
<p>I created a SQL view for this (using the <a href="https://datasette.io/plugins/datasette-write">datasette-write</a> plugin, which is installed on Datasette Cloud):</p>
<div><pre><span>CREATE</span> <span>VIEW</span> <span>hacker_news_posts_atom</span> <span>as</span> <span>select</span>
  id <span>as</span> atom_id,
  title <span>as</span> atom_title,
  url,
  commentsUrl <span>as</span> atom_link,
  dt <span>||</span> <span><span>&#39;</span>Z<span>&#39;</span></span> <span>as</span> atom_updated,
  <span><span>&#39;</span>Submitter: <span>&#39;</span></span> <span>||</span> submitter <span>||</span> <span><span>&#39;</span> - <span>&#39;</span></span> <span>||</span> points <span>||</span> <span><span>&#39;</span> points, <span>&#39;</span></span> <span>||</span> numComments <span>||</span> <span><span>&#39;</span> comments<span>&#39;</span></span> <span>as</span> atom_content
<span>from</span>
  hacker_news_posts
<span>order by</span>
  dt <span>desc</span>
<span>limit</span>
  <span>100</span>;</pre></div>
<p><code>datasette-atom</code> requires a table, view or SQL query that returns <code>atom_id</code>, <code>atom_title</code> and <code>atom_updated</code> columns—and will make use of <code>atom_link</code> and <code>atom_content</code> as well if they are present.</p>
<p>Datasette Cloud defaults to keeping all tables and views private—but a while ago I created the <a href="https://datasette.io/plugins/datasette-public">datasette-public</a> plugin to provide a UI for making a table public.</p>
<p>It turned out this didn’t work for SQL views yet, so <a href="https://github.com/simonw/datasette-public/issues/5">I fixed that</a>—then used that option to make my view public. You can visit it at:</p>
<p><a href="https://simon.datasette.cloud/data/hacker_news_posts_atom">https://simon.datasette.cloud/data/hacker_news_posts_atom</a></p>
<p>And to get an Atom feed, just add <code>.atom</code> to the end of the URL:</p>
<p><a href="https://simon.datasette.cloud/data/hacker_news_posts_atom.atom">https://simon.datasette.cloud/data/hacker_news_posts_atom.atom</a></p>
<p>Here’s what it looks like in NetNewsWire:</p>
<p><img alt="A screenshot of a feed reading interface, showing posts from Hacker News with the submitter, number of points and number of comments" src="https://static.simonwillison.net/static/2022/netnewswire-hacker-news.jpg"/></p>
<p>I’m pretty excited about being able to combine these tools in this way: it makes getting from scraped data to a Datasette table to an Atom feed a very repeatable process.</p>
<h4>Building a TODO list application</h4>
<p>My second demo explores what it looks like to develop custom applications against the new API.</p>
<p><a href="https://todomvc.com">TodoMVC</a> is a project that provides the same TODO list interface built using dozens of different JavaScript frameworks, as a comparison tool.</p>
<p>I decided to use it to build my own TODO list application, using Datasette as the backend.</p>
<p>You can try it out at <a href="https://todomvc.datasette.io/">https://todomvc.datasette.io/</a>—but be warned that the demo resets every 15 minutes so don’t use it for real task tracking!</p>
<p><img alt="Animated GIF showing a TODO list interface - I add two items to it, then check one of them off as done, then remove the other one" src="https://static.simonwillison.net/static/2022/todomvc.gif"/></p>
<p>The source code for this demo lives in <a href="https://github.com/simonw/todomvc-datasette">simonw/todomvc-datasette</a>—which also serves the demo itself using GitHub Pages.</p>
<p>The code is based on the TodoMVC <a href="https://github.com/tastejs/todomvc/tree/gh-pages/examples/vanillajs">Vanilla JavaScript example</a>. I used that unmodified, except for one file—<a href="https://github.com/simonw/todomvc-datasette/blob/main/js/store.js">store.js</a>, which I modified to use the Datasette API instead of <code>localStorage</code>.</p>
<p>The demo currently uses a hard-coded authentication token, which is signed to allow actions to be performed against the <a href="https://latest.datasette.io/">https://latest.datasette.io/</a> demo instance as a user called <code>todomvc</code>.</p>
<p>That user is granted permissions <a href="https://github.com/simonw/datasette/blob/cab5b60e09e94aca820dbec5308446a88c99ea3d/tests/plugins/my_plugin.py#L223-L230">in a custom plugin</a> at the moment, but I plan to provide a more user-friendly way to do this in the future.</p>
<p>A couple of illustrative snippets of code. First, on page load this constructor uses the Datasette API to create the table used by the application:</p>
<div><pre><span>function</span> <span>Store</span><span>(</span><span>name</span><span>,</span> <span>callback</span><span>)</span> <span>{</span>
  <span>callback</span> <span>=</span> <span>callback</span> <span>||</span> <span>function</span> <span>(</span><span>)</span> <span>{</span><span>}</span><span>;</span>

  <span>// Ensure a table exists with this name</span>
  <span>let</span> <span>self</span> <span>=</span> <span>this</span><span>;</span>
  <span>self</span><span>.</span><span>_dbName</span> <span>=</span> <span>`todo_<span><span>${</span><span>name</span><span>}</span></span>`</span><span>;</span>
  <span>fetch</span><span>(</span><span>&#34;https://latest.datasette.io/ephemeral/-/create&#34;</span><span>,</span> <span>{</span>
    <span>method</span>: <span>&#34;POST&#34;</span><span>,</span>
    <span>mode</span>: <span>&#34;cors&#34;</span><span>,</span>
    <span>headers</span>: <span>{</span>
      <span>Authorization</span>: <span>`Bearer <span><span>${</span><span>TOKEN</span><span>}</span></span>`</span><span>,</span>
      <span>&#34;Content-Type&#34;</span>: <span>&#34;application/json&#34;</span><span>,</span>
    <span>}</span><span>,</span>
    <span>body</span>: <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span>
      <span>table</span>: <span>self</span><span>.</span><span>_dbName</span><span>,</span>
      <span>columns</span>: <span>[</span>
        <span>{</span><span>name</span>: <span>&#34;id&#34;</span><span>,</span> <span>type</span>: <span>&#34;integer&#34;</span><span>}</span><span>,</span>
        <span>{</span><span>name</span>: <span>&#34;title&#34;</span><span>,</span> <span>type</span>: <span>&#34;text&#34;</span><span>}</span><span>,</span>
        <span>{</span><span>name</span>: <span>&#34;completed&#34;</span><span>,</span> <span>type</span>: <span>&#34;integer&#34;</span><span>}</span><span>,</span>
      <span>]</span><span>,</span>
      <span>pk</span>: <span>&#34;id&#34;</span><span>,</span>
    <span>}</span><span>)</span><span>,</span>
  <span>}</span><span>)</span><span>.</span><span>then</span><span>(</span><span>function</span> <span>(</span><span>r</span><span>)</span> <span>{</span>
    <span>callback</span><span>.</span><span>call</span><span>(</span><span>this</span><span>,</span> <span>[</span><span>]</span><span>)</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span></pre></div>
<p>Most applications would run against a table that has already been created, but this felt like a good opportunity to show what table creation looks like.</p>
<p>Note that the table is being created using <code>/ephemeral/-/create</code>—this endpoint that lets you create tables in the ephemeral database, which is a temporary database that drops every table after 15 minutes. I built the <a href="https://datasette.io/plugins/datasette-ephemeral-tables">datasette-ephemeral-tables</a> plugin to make this possible.</p>
<p>Here’s the code which is called when a new TODO list item is created or updated:</p>
<div><pre><span>Store</span><span>.</span><span>prototype</span><span>.</span><span>save</span> <span>=</span> <span>function</span> <span>(</span><span>updateData</span><span>,</span> <span>callback</span><span>,</span> <span>id</span><span>)</span> <span>{</span>
<span>// {title, completed}</span>
<span>callback</span> <span>=</span> <span>callback</span> <span>||</span> <span>function</span> <span>(</span><span>)</span> <span>{</span><span>}</span><span>;</span>
<span>var</span> <span>table</span> <span>=</span> <span>this</span><span>.</span><span>_dbName</span><span>;</span>

<span>// If an ID was actually given, find the item and update each property</span>
<span>if</span> <span>(</span><span>id</span><span>)</span> <span>{</span>
  <span>fetch</span><span>(</span>
    <span>`https://latest.datasette.io/ephemeral/<span><span>${</span><span>table</span><span>}</span></span>/<span><span>${</span><span>id</span><span>}</span></span>/-/update`</span><span>,</span>
    <span>{</span>
      <span>method</span>: <span>&#34;POST&#34;</span><span>,</span>
      <span>mode</span>: <span>&#34;cors&#34;</span><span>,</span>
      <span>headers</span>: <span>{</span>
        <span>Authorization</span>: <span>`Bearer <span><span>${</span><span>TOKEN</span><span>}</span></span>`</span><span>,</span>
        <span>&#34;Content-Type&#34;</span>: <span>&#34;application/json&#34;</span><span>,</span>
      <span>}</span><span>,</span>
      <span>body</span>: <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span><span>update</span>: <span>updateData</span><span>}</span><span>)</span><span>,</span>
    <span>}</span>
  <span>)</span>
    <span>.</span><span>then</span><span>(</span><span>(</span><span>r</span><span>)</span> <span>=&gt;</span> <span>r</span><span>.</span><span>json</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>then</span><span>(</span><span>(</span><span>data</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>callback</span><span>.</span><span>call</span><span>(</span><span>self</span><span>,</span> <span>data</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
<span>}</span> <span>else</span> <span>{</span>
  <span>// Save it and store ID</span>
  <span>fetch</span><span>(</span><span>`https://latest.datasette.io/ephemeral/<span><span>${</span><span>table</span><span>}</span></span>/-/insert`</span><span>,</span> <span>{</span>
    <span>method</span>: <span>&#34;POST&#34;</span><span>,</span>
    <span>mode</span>: <span>&#34;cors&#34;</span><span>,</span>
    <span>headers</span>: <span>{</span>
      <span>Authorization</span>: <span>`Bearer <span><span>${</span><span>TOKEN</span><span>}</span></span>`</span><span>,</span>
      <span>&#34;Content-Type&#34;</span>: <span>&#34;application/json&#34;</span><span>,</span>
    <span>}</span><span>,</span>
    <span>body</span>: <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span>
      <span>row</span>: <span>updateData</span><span>,</span>
    <span>}</span><span>)</span><span>,</span>
  <span>}</span><span>)</span>
    <span>.</span><span>then</span><span>(</span><span>(</span><span>r</span><span>)</span> <span>=&gt;</span> <span>r</span><span>.</span><span>json</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>then</span><span>(</span><span>(</span><span>data</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>let</span> <span>row</span> <span>=</span> <span>data</span><span>.</span><span>rows</span><span>[</span><span>0</span><span>]</span><span>;</span>
      <span>callback</span><span>.</span><span>call</span><span>(</span><span>self</span><span>,</span> <span>row</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
<span>}</span>
<span>}</span><span>;</span></pre></div>
<p>TodoMVC passes an <code>id</code> if a record is being updated—which this code uses as a sign that the <code>...table/row-id/-/update</code> API should be called (see <a href="https://docs.datasette.io/en/latest/json_api.html#updating-a-row">update API documentation</a>).</p>
<p>If the row doen’t have an ID it is inserted using <code>table/-/insert</code>, this time using the <code>&#34;row&#34;:</code> key because we are only inserting a single row.</p>
<p>The hardest part of getting this to work was ensuring Datasette’s <a href="https://docs.datasette.io/en/latest/json_api.html#json-api">CORS mode</a> worked correctly for writes. I had to add a new <code>Access-Control-Allow-Methods</code> header, which I shipped in <a href="https://docs.datasette.io/en/latest/changelog.html#a1-2022-12-01">Datasette 1.0a1</a> (see <a href="https://github.com/simonw/datasette/issues/1922">issue #1922</a>).</p>
<h4>Try the ephemeral hosted API</h4>
<p>I built the <a href="https://datasette.io/plugins/datasette-ephemeral-tables">datasette-ephemeral-tables</a> plugin because I wanted to provide a demo instance of the write API that anyone could try out without needing to install Datasette themselves—but that wouldn’t leave me responsible for taking care of their data or cleaning up any of their mess.</p>
<p>You’re welcome to experiment with the API using the <a href="https://latest.datasette.io/">https://latest.datasette.io/</a> demo instance.</p>
<p>First, you’ll need to sign in as a root user. You can do that (no password required) using the button <a href="https://latest.datasette.io/login-as-root">on this page</a>.</p>
<p>Once signed in you can view the ephemeral database (which isn’t visible to anonymous users) here:</p>
<p><a href="https://latest.datasette.io/ephemeral">https://latest.datasette.io/ephemeral</a></p>
<p>You can use the API explorer to try out the different write APIs against it here:</p>
<p><a href="https://latest.datasette.io/-/api">https://latest.datasette.io/-/api</a></p>
<p>And you can create your own signed token for accessing the API on this page:</p>
<p><a href="https://latest.datasette.io/-/create-token">https://latest.datasette.io/-/create-token</a></p>
<p><img alt="The Create an API token page lets you create a token that expires after a set number of hours - you can then copy that token to your clipboard" src="https://static.simonwillison.net/static/2022/create-token.jpg"/></p>
<p>The TodoMVC application described above also uses the <code>ephemeral</code> database, so you may see a <code>todo_todos-vanillajs</code> table appear there if anyone is playing with that demo.</p>
<h4 id="your-machine">Or run this on your own machine</h4>
<p>You can install the latest Datasette alpha like this:</p>
<pre><code>pip install datasette==1.0a1
</code></pre>
<p>Then create a database and sign in as the <code>root</code> user in order to gain access to the API:</p>
<pre><code>datasette demo.db --create --root
</code></pre>
<p>Click on the link it outputs to sign in as the root user, then visit the API explorer to start trying out the API:</p>
<p><a href="http://127.0.0.1:8001/-/api">http://127.0.0.1:8001/-/api</a></p>
<p><img alt="The API explorer interface has tools for sending GET and POST requests, plus a list of API endpoints" src="https://static.simonwillison.net/static/2022/api-explorer.jpg"/></p>
<p>The API explorer works without a token at all, using your existing browser cookies.</p>
<p>If you want to try the API using <code>curl</code> or similar you can use this page to create a new signed API token for the <code>root</code> user:</p>
<p><a href="http://127.0.0.1:8001/-/create-token">http://127.0.0.1:8001/-/create-token</a></p>
<p>This token will become invalid if you restart the server, unless you fix the <code>DATASETTE_SECRET</code> environment variable to a stable string before you start the server:</p>
<pre><code>export DATASETTE_SECRET=$(
  python3 -c &#39;print(__import__(&#34;secrets&#34;).token_hex(16))&#39;
)
</code></pre>
<p>Check the <a href="https://docs.datasette.io/en/latest/json_api.html#the-json-write-api">Write API documentation</a> for more details.</p>
<h4>What’s next?</h4>
<p>If you have feedback on these APIs, <em>now is the time</em> to share it! I’m hoping to ship Datasette 1.0 at the start of 2023, after which these APIs will be considered stable for hopefully a long time to come.</p>
<p>If you have thoughts or feedback (or questions) join us on the <a href="https://datasette.io/discord">Datasette Discord</a>. You can also file issue comments against <a href="https://github.com/simonw/issues">Datasette</a> itself.</p>
<p>My priority for the next 1.0 alpha is to bake in a small number of backwards incompatible changes to other aspects of Datasette’s JSON API that I’ve been hoping to include in 1.0 for a while.</p>
<p>I’m also going to be rolling out API support to my <a href="https://datasette.cloud/">Datasette Cloud</a> preview users. If you’re interested in trying that out you can <a href="https://www.datasette.cloud/preview/">request access here</a>.</p>




</div>

</div></div>
  </body>
</html>
