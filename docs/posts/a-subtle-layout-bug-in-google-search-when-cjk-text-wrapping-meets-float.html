<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://likang.dev/posts/google-search-bug/">Original</a>
    <h1>A subtle layout bug in Google Search: When CJK text-wrapping meets float</h1>
    
    <div id="readability-page-1" class="page"><div id="blog-hero"><p><img src="https://likang.dev/_astro/cover.CONxu474_ZWui2s.webp" alt="CSS bug in Google Search’s pagination" fetchpriority="high" loading="eager" width="1280" height="720" decoding="async"/></p> <p> <time datetime="2024-11-18T16:00:00.000Z">November 19, 2024</time> /  5 min read </p> </div><div>  <p>Recently, I investigated an interesting layout bug in Google Search’s pagination component. I first noticed it a few months ago but thought it was caused by some Chrome extensions I had installed. Later, I set up a fresh browser profile and reproduced the issue, realizing it was a broader problem.</p>
<p>The bug specifically affects the Chinese version, where the “Next” link (下一页) wraps onto multiple lines unexpectedly. It looked like a simple CSS issue at first, but a deeper dive revealed some fascinating quirks involving CSS layouts and CJK (Chinese, Japanese, Korean) text rendering.</p>

<h2 id="a-closer-look-at-the-bug">A Closer Look at the Bug</h2>
<p>Let’s break it down. The “Next” link in the pagination component is made up of two parts:</p>
<ol>
<li>A logo image</li>
<li>The localized text for “Next”</li>
</ol>
<p>Here’s a simplified version of the HTML:</p>
<div><figure><pre data-language="html"><code><div><p><span>&lt;</span><span>td</span><span>&gt;</span></p></div><div><p><span><span>  </span></span><span>&lt;</span><span>a</span><span> </span><span>href</span><span>=</span><span><span>&#34;</span><span>#next</span><span>&#34;</span></span><span> </span><span>style</span><span>=</span><span><span>&#34;</span><span>display: block;</span><span>&#34;</span></span><span>&gt;</span></p></div><div><p><span><span>    </span></span><span>&lt;</span><span>img</span><span> </span><span>src</span><span>=</span><span><span>&#34;</span><span>next.png</span><span>&#34;</span></span><span> </span><span>style</span><span>=</span><span><span>&#34;</span><span>float: left; display: block; width: 71px</span><span>&#34;</span></span><span> /&gt;</span></p></div><div><p><span><span>    </span></span><span>&lt;</span><span>span</span><span> </span><span>style</span><span>=</span><span><span>&#34;</span><span>display: block; margin-left: 53px;</span><span>&#34;</span></span><span>&gt;下一页&lt;/</span><span>span</span><span>&gt;</span></p></div><div><p><span><span>  </span></span><span>&lt;/</span><span>a</span><span>&gt;</span></p></div><div><p><span>&lt;/</span><span>td</span><span>&gt;</span></p></div></code></pre></figure></div>
<p>The issue comes from the <code>float: left</code> applied to the image, combined with the lack of a <code>clear</code> property on the text span. To fix it:</p>
<ul>
<li>Remove <code>float: left</code>, or</li>
<li>Add <code>clear: left</code> to the <code>span</code>.</li>
</ul>

<h2 id="real-question">Real Question</h2>
<p>Why does this bug only show up in the Chinese version? To figure that out, let’s look at how text wrapping behaves in different languages when the <code>span</code> text’s <code>margin-left</code> changed.</p>
<p><img src="https://likang.dev/_astro/pagination.C2V2MxAf_CLfzQ.webp" alt="" width="853" height="480" loading="lazy" decoding="async"/></p><p>From this visualization, we can see:</p>
<ol>
<li>CJK and Latin text wrap differently.</li>
<li>The <code>span</code> text first appears below the image, but as the <code>margin-left</code> increases, it shifts to the right.</li>
</ol>
<h3 id="cjk-text-wrapping">CJK Text-Wrapping</h3>
<p>CSS uses the <code>overflow-wrap</code> and <code>word-break</code> properties to control text wrapping behavior. Under the default values of these two properties, most languages break lines at spaces between words. However, CJK languages don’t rely on spaces as word separators, which allows line breaks to occur between any characters.</p>
<h3 id="why-not-japanese-or-korean-versions">Why Not Japanese or Korean Versions?</h3>
<p>This is where it gets even more interesting. Let’s take a closer look at the <strong>block-level</strong> <code>span</code> text in the HTML. Its previous sibling (the image) is floated, which means the image is removed from the normal content flow according to CSS rules. As a result:</p>
<ol>
<li>The <code>span</code> starts at the same position as the floated image.</li>
<li>Its content aligns to avoid overlapping the float, meaning:
<ul>
<li>If there’s enough space beside the floated image, the content flows into the remaining space next to it.</li>
<li>If there isn’t enough space, the content moves to the next available line below the float.</li>
</ul>
</li>
</ol>
<p>But when is there enough space beside the floated image? This depends on the width of the parent container. In this case, the parent <code>&lt;a&gt;</code> tag is a block element inside a <code>&lt;td&gt;</code>, which means its width is content-based. Its width is determined entirely by the wider of its two children—the floated image or the <code>span</code> text.</p>
<p>With this understanding, the conditions for wrapping are clear: if the width of the <code>span</code> (including its <code>margin-left</code>) is larger than the floated image, and the gap is just enough to fit a character, the <code>span</code> may wrap around the image.  In the Chinese version, the text <code>下一页</code> contains three characters, while the Japanese and Korean versions only have two. This subtle difference causes the issue to occur exclusively in the Chinese version.</p>
<p>Now, why does it matter that the <code>span</code> is a block-level element? Because as a block element, it respects the float and  makes its content sit beside it or moves below it. If it were an inline-level element, it would try its best to flow inline next to the image, making the issue visible across all languages.</p>
<h2 id="why-did-this-bug-last-so-long">Why Did This Bug Last So Long?</h2>
<p>Several factors make this bug tricky:</p>
<ol>
<li><strong>Language-Specific Behavior:</strong> Localization introduces edge cases that might go unnoticed during English-centric testing.</li>
<li><strong>CJK-Specific Wrapping:</strong> The default wrapping rules for CJK languages differ significantly.</li>
<li><strong>Subtle Width Interactions:</strong> The bug occurs due to a perfect storm of:
<ul>
<li>More than two CJK characters,</li>
<li>Precise <code>margin-left</code> values, and</li>
<li>Floated image behavior.</li>
</ul>
</li>
</ol>
<h2 id="what-we-can-learn">What We Can Learn</h2>
<p>This quirky bug teaches us some important lessons:</p>
<ol>
<li><strong>Test with CJK Languages:</strong>  Don’t assume layouts will work universally. Always test localized versions.</li>
<li><strong>Floats Are Tricky:</strong> Floats are kind of outdated. Use Flexbox or Grid for layouts when possible.</li>
<li><strong>Cultural Awareness Matters:</strong> Writing systems like CJK interact differently with CSS—don’t assume your layouts work universally.</li>
</ol>
<h2 id="one-more-thing">One more thing</h2>
<p><img src="https://likang.dev/_astro/cover_ruler.ByhReyW6_2cUsS6.webp" alt="An Image Shown Misaligned Text" width="1280" height="720" loading="lazy" decoding="async"/></p><p>While examining the layout of the pagination component for this post, I noticed another issue: the page numbers and the “Next” text are slightly misaligned in CJK languages. It’s not a major problem, but for a platform like Google, even small details matter. The fix is simple—apply a unified <code>line-height</code> to the text.</p>
<p>This happens because CJK text often falls back to a different font family than Latin text. Since different fonts have unique vertical metrics, such as baseline and line box properties, the text can appear misaligned when displayed together without proper adjustments. The fix? Use a consistent <code>font-family</code> or explicitly set <code>line-height</code>.</p>   </div></div>
  </body>
</html>
