<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://code.jsoftware.com/wiki/Essays/Incunabulum">Original</a>
    <h1>J one-page interpreter fragment (1992)</h1>
    
    <div id="readability-page-1" class="page"><div id="mw-content-text" lang="en" dir="ltr"><div><p>One summer weekend in 1989, Arthur Whitney visited Ken Iverson at
Kiln Farm and produced—on one page and in one
afternoon—an interpreter fragment on the AT&amp;T 3B1 computer.
I studied this interpreter for about a week for its organization
and programming style; and on Sunday, August 27, 1989, at about
four o&#39;clock in the afternoon, wrote the first line of
code that became the implementation described in this document.
</p><p>Arthur&#39;s one-page interpreter fragment is as follows:
</p>
<pre>typedef char C;typedef long I;
typedef struct a{I t,r,d[3],p[2];}*A;
#define P printf
#define R return
#define V1(f) A f(w)A w;
#define V2(f) A f(a,w)A a,w;
#define DO(n,x) {I i=0,_n=(n);for(;i&lt;_n;++i){x;}}
I *ma(n){R(I*)malloc(n*4);}mv(d,s,n)I *d,*s;{DO(n,d[i]=s[i]);}
tr(r,d)I *d;{I z=1;DO(r,z=z*d[i]);R z;}
A ga(t,r,d)I *d;{A z=(A)ma(5+tr(r,d));z-&gt;t=t,z-&gt;r=r,mv(z-&gt;d,d,r);
 R z;}
V1(iota){I n=*w-&gt;p;A z=ga(0,1,&amp;n);DO(n,z-&gt;p[i]=i);R z;}
V2(plus){I r=w-&gt;r,*d=w-&gt;d,n=tr(r,d);A z=ga(0,r,d);
 DO(n,z-&gt;p[i]=a-&gt;p[i]+w-&gt;p[i]);R z;}
V2(from){I r=w-&gt;r-1,*d=w-&gt;d+1,n=tr(r,d);
 A z=ga(w-&gt;t,r,d);mv(z-&gt;p,w-&gt;p+(n**a-&gt;p),n);R z;}
V1(box){A z=ga(1,0,0);*z-&gt;p=(I)w;R z;}
V2(cat){I an=tr(a-&gt;r,a-&gt;d),wn=tr(w-&gt;r,w-&gt;d),n=an+wn;
 A z=ga(w-&gt;t,1,&amp;n);mv(z-&gt;p,a-&gt;p,an);mv(z-&gt;p+an,w-&gt;p,wn);R z;}
V2(find){}
V2(rsh){I r=a-&gt;r?*a-&gt;d:1,n=tr(r,a-&gt;p),wn=tr(w-&gt;r,w-&gt;d);
 A z=ga(w-&gt;t,r,a-&gt;p);mv(z-&gt;p,w-&gt;p,wn=n&gt;wn?wn:n);
 if(n-=wn)mv(z-&gt;p+wn,z-&gt;p,n);R z;}
V1(sha){A z=ga(0,1,&amp;w-&gt;r);mv(z-&gt;p,w-&gt;d,w-&gt;r);R z;}
V1(id){R w;}V1(size){A z=ga(0,0,0);*z-&gt;p=w-&gt;r?*w-&gt;d:1;R z;}
pi(i){P(&#34;%d &#34;,i);}nl(){P(&#34;\n&#34;);}
pr(w)A w;{I r=w-&gt;r,*d=w-&gt;d,n=tr(r,d);DO(r,pi(d[i]));nl();
 if(w-&gt;t)DO(n,P(&#34;&lt; &#34;);pr(w-&gt;p[i]))else DO(n,pi(w-&gt;p[i]));nl();}

C vt[]=&#34;+{~&lt;#,&#34;;
A(*vd[])()={0,plus,from,find,0,rsh,cat},
 (*vm[])()={0,id,size,iota,box,sha,0};
I st[26]; qp(a){R  a&gt;=&#39;a&#39;&amp;&amp;a&lt;=&#39;z&#39;;}qv(a){R a&lt;&#39;a&#39;;}
A ex(e)I *e;{I a=*e;
 if(qp(a)){if(e[1]==&#39;=&#39;)R st[a-&#39;a&#39;]=ex(e+2);a= st[ a-&#39;a&#39;];}
 R qv(a)?(*vm[a])(ex(e+1)):e[1]?(*vd[e[1]])(a,ex(e+2)):(A)a;}
noun(c){A z;if(c&lt;&#39;0&#39;||c&gt;&#39;9&#39;)R 0;z=ga(0,0,0);*z-&gt;p=c-&#39;0&#39;;R z;}
verb(c){I i=0;for(;vt[i];)if(vt[i++]==c)R i;R 0;}
I *wd(s)C *s;{I a,n=strlen(s),*e=ma(n+1);C c;
 DO(n,e[i]=(a=noun(c=s[i]))?a:(a=verb(c))?a:c);e[n]=0;R e;}

main(){C s[99];while(gets(s))pr(ex(wd(s)));}
</pre>

<hr/>
<p>Contributed by <a href="https://code.jsoftware.com/wiki/User:Roger_Hui" title="User:Roger Hui">Roger Hui</a>. From <i><a href="https://code.jsoftware.com/mediawiki/index.php?title=Doc/An_Implementation_of_J&amp;action=edit&amp;redlink=1" title="Doc/An Implementation of J (page does not exist)">An Implementation of J</a></i>, Appendix A: Incunabulum, 1992-01-27.
</p>
<!-- 
NewPP limit report
Cached time: 20221219162138
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.005 seconds
Real time usage: 0.006 seconds
Preprocessor visited node count: 4/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 1934/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->

<!-- Saved in parser cache with key my_wiki:pcache:idhash:4206-0!canonical and timestamp 20221219162138 and revision id 8624
 -->
</div></div></div>
  </body>
</html>
