<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://supabase.com/blog/2022/03/31/supabase-edge-functions">Original</a>
    <h1>Supabase Edge Functions</h1>
    
    <div id="readability-page-1" class="page"><article><div><p>Today we&#39;re launching one of our <a href="https://twitter.com/lau_cazanove/status/1506530181946691592">most</a> <a href="https://twitter.com/edgarasben/status/1506653203458363393">requested</a> and <a href="https://twitter.com/runjep/status/1507462077216088069">highly-</a><a href="https://twitter.com/marcopolotwo/status/1506431782362632195">anticipated</a> <a href="https://github.com/supabase/supabase/discussions/4269">features</a> ‚Äî Edge Functions. Edge Functions let you execute Typescript code close to your users, no matter where they&#39;re located.</p><p>Edge Functions are executed on the secure-by-default <a href="https://deno.land/">Deno runtime</a>, and deployed around the world in seconds using Deno&#39;s <a href="https://deno.com/deploy">hosted Deno Deploy offering</a>. However, as a user of Supabase Edge Functions, you don&#39;t need to know or worry about any of that; we handle all the gnarly details, delivering a seamless experience that allows you to focus on your business logic.</p><h2 id="choosing-a-platform">Choosing a platform</h2><p>Serverless compute options can be broken down into two broad categories:</p><ul><li>Containers as a Service (e.g. Google Cloud Run, Fly.io)</li><li>Functions as a Service (e.g. Cloudflare Workers, Fastly Compute @ Edge, Suborbital)</li></ul><p>Additionally, there are self-hosted offerings within each category as well (e.g. Firecracker sort-of for the former, OpenFaaS for the latter).</p><p>Our first critical decision was to choose Functions as a Service (‚ÄùFaaS‚Äù) over Containers and other alternatives. While Containers can allow for more flexible workloads, authoring and maintaining Functions allows for a substantially simpler developer experience-something Supabase has always focused on. As a Supabase user, all you need to think about is the business logic you wanted to write a Function for in the first place; you don&#39;t need to think about optimizing docker image builds, updating your system dependencies, etc.</p><p>Additionally, while a lot of work has been invested in improving container start-up times, Functions generally still enjoy significantly faster start-ups.</p><p>Our next major decision was to choose global deployments instead of a deploying to a specific geographical region.
<img src="https://supabase.com/images/blog/launch-week-4/thursday-functions/where-functions-deploy.png" alt="Functions deployment region"/>
Launching Functions in a single region (e.g. close to your database) can present a lot of advantages if there are a lot of database operations being executed within your business logic.</p><p>However, Supabase already offers a flexible solution for that - <a href="https://supabase.com/docs/guides/database/functions">Database Functions</a>! As such, for Supabase <!-- -->[Edge]<!-- --> Functions, we decided to deploy far-and-wide so that they are as close to your end-users as possible. You can even invoke a Database Function from an Edge Function, allowing you to enjoy the best of both worlds.</p><h2 id="the-deno-runtime">The Deno runtime</h2><p>Deno is a modern Typescript and JavaScript runtime created with first-class support for web technologies. Here some of the reasons why we&#39;re excited about Deno:</p><h3 id="open-source">Open-source</h3><p><em>Deno Deploy</em> is Deno&#39;s hosted service and, although it is proprietary, the Deno CLI is open source. This means that the open source offering from Deno maintains feature-parity with the proprietary service. If you use Deno to develop functions locally, its behavior will be the same as when deployed on the edge, unlocking an incredible developer experience. We couldn&#39;t achieve a similarly seamless experience with e.g. AWS Lambda, no matter how much we tried.</p><p>Deno even goes a step further than maintaining feature-parity, releasing all new APIs to open-source <strong>first</strong> before rolling them out to their hosted offering. This ensures that you can always develop and test bleeding-edge functionality locally, with all the tools you&#39;re used to and familiar with, before deploying to a hosted cloud environment.</p><h3 id="batteries-included">Batteries included</h3><p>Deno comes with all the tools needed for a modern, productive developer experience, so you can spend less time searching through third party modules, and more time being productive. Out of the box, it includes support for Typescript, ES modules, and provides <a href="https://deno.land/manual/tools/testing">test runners</a>, <a href="https://deno.land/manual/tools/formatter">formatters</a>, <a href="https://deno.land/manual/tools/linter">linters</a>, <a href="https://deno.land/manual/tools/bundler">bundlers</a> and a package manager.</p><h3 id="secure-by-default">Secure by default</h3><p>Like modern web browsers, the Deno runtime executes your code in a secure sandbox by default. Functions cannot access environment variables, network or filesystem unless they are explicitly allowed. Supply chain attacks have been a daunting problem in the Node ecosystem and Deno mitigates many of these attacks by having a security-first model.</p><h2 id="the-supa-deno-platform">The Supa-Deno platform</h2><p>When a request comes in to an Edge Function you deploy on Supabase, it first lands at a ‚ÄúRelay‚Äù. The <a href="https://github.com/supabase/functions-relay">Relay</a> acts as an API gateway, authenticating the JWT, and providing some additional functionality like logging and rate-limiting. Upon receiving the incoming request, the Relay retrieves the metadata for your Function, and uses it to construct a unique identifier (‚ÄùDeployment ID‚Äù) for the Function. This Deployment ID then gets passed over to the Deno Deploy platform, which takes care of invoking your Function securely, and passing your output back to the Relay, which in turn passes it back to your end-user.</p><p>If a user&#39;s request comes in for your Function before it has been cached by the Deno Deploy platform (a ‚Äùcold start‚Äù), it reaches out to Supabase to retrieve your Functions code, and any associated permissions and secrets. Even though this might sound like a lot of work, we&#39;ve worked to ensure that these cold starts are still pretty spiffy.</p><p><img src="https://supabase.com/images/blog/launch-week-4/thursday-functions/functions-architecture.png" alt="Functions architecture"/></p><p>The primary goal of this architecture is to reduce the amount of work done in the hot path (marked in purple above). Each component in the hot path is globally distributed so that Edge Functions start up and respond to your users&#39; requests fast.</p><h3 id="region-earth-">Region: Earth üåé</h3><p>Supabase Edge Functions are deployed to one region - Earth (and we&#39;re exploring Mars as an additional region üëΩ). Edge Functions are deployed to over 30 data centers in a matter of seconds, ensuring fast response times no matter where your users are located.</p><p><a href="https://supabase.com/docs/guides/database/functions">Database Functions</a> (also served via our <a href="https://supabase.com/docs/guides/api">REST and GraphQL APIs</a>) are colocated with your Postgres database, making them ideal for DB-intensive operations. These APIs can also be called seamlessly from your Supabase Edge Functions, making for a powerful combination.</p><h3 id="scale-to-zero">Scale to zero</h3><p>Functions scale down to zero and you only pay for what you use. This makes them great for an extremely wide variety of workloads-whether you&#39;re starting out with extremely sporadic usage, or bursty request patterns, or using them consistently and heavily.</p><h2 id="a-fun-and-efficient-developer-experience">A fun and efficient Developer Experience</h2><p>Delivering a phenomenal Developer Experience is something we care about a lot at Supabase. In the serverless functions space, we&#39;ve found that local development and testing, coupled with fast deploys are critical.</p><p>We&#39;ve <a href="https://supabase.com/docs/guides/local-development">extended the Supabase CLI</a> to optimize the Edge Functions DX along these two dimensions. You get live-reloading, and a local Deno environment that matches the production environment, making for a great local iteration environment.</p><video width="99%" autoplay="" muted="" playsinline="" controls=""><source src="/videos/blog/launch-week-4/functions-hot-reloading.mp4" type="video/mp4" muted="" playsinline=""/></video><p>Once you&#39;ve tested your Function locally (or gone straight to production cos you live <em>on the edge</em> ... get it?) it takes just seconds to deploy a new function and see the logs streaming in your Dashboard‚Äîensuring a tight iteration loop with your production environment.</p><video width="99%" autoplay="" muted="" playsinline="" controls=""><source src="/videos/blog/launch-week-4/logs-polish.mov" type="video/mp4" muted="" playsinline=""/></video><p>Our observability pipeline has been built <a href="https://supabase.com/blog/2021/12/02/supabase-acquires-logflare">using Logflare</a>. Structured logs from your Edge Functions get sent to Logflare, which also processes them into metrics. Your Supabase Dashboard is able to reach out to Logflare endpoints, and with some of the <a href="https://supabase.com/blog/2021/11/30/supabase-studio">(not so) secret sauce</a> from our front-end team, you get responsive charts and logs for your Edge Functions.</p><p><img src="https://supabase.com/images/blog/launch-week-4/thursday-functions/functions-new-deploy-invoke-logs.gif" alt="new ‚Äî&gt; deploy ‚Äî&gt; invoke ‚Äî&gt; logs"/>
new ‚Äî&gt; deploy ‚Äî&gt; invoke ‚Äî&gt; logs</p><p>To round off the end-to-end experience, <code>supabase-js</code> now works in Deno, making it easy to interact with the rest of your Supabase project from within your Edge Functions. Your project&#39;s URLs, API keys, and database connection strings are made available as environment variables within your Function to make this even easier. And if you want to interact with third-party APIs which require a secret key, such as Stripe, you can easily and securely make these available to your Function as environment variables via the Supabase CLI. To get an idea for what is possible, check out our examples page <a href="https://github.com/supabase/supabase/tree/master/examples/edge-functions">here</a>.</p><h2 id="quickstart">Quickstart</h2><iframe width="640" height="385" src="https://www.youtube-nocookie.com/embed/rzglqRdZUQE" frameborder="1" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><p>Can&#39;t wait to get started? Develop, test, and deploy your first Supabase Edge Function in less than 7 minutes with our <a href="https://youtu.be/rzglqRdZUQE">Quickstart Video Tutorial</a>!
Check the <a href="https://supabase.com/docs/guides/functions">Edge Functions Docs</a> for the steps.</p><h2 id="example-apps-mobile-payments-with-react-native-and-flutter">Example apps: Mobile payments with React Native and Flutter</h2><p>When researching use-cases with all of you, <a href="https://github.com/supabase/supabase/discussions/4269#discussioncomment-1748067">processing payments</a> was being pointed out the most, so naturally, to support the launch, we&#39;ve created example apps in collaboration with Stripe for <a href="https://github.com/supabase-community/expo-stripe-payments-with-supabase-functions">React Native</a> and <a href="https://github.com/supabase-community/flutter-stripe-payments-with-supabase-functions">Flutter</a>, to allow you to get started and earn money even faster.</p><p><img src="https://supabase.com/images/blog/launch-week-4/thursday-functions/functions-payment.gif" alt="functions-payment-example"/></p><h2 id="can-i-host-static-sites">Can I host static sites</h2><p>Even though Deno supports <a href="https://deno.land/manual/jsx_dom/jsx">rendering <code>jsx</code> and <code>tsx</code> files</a>, we don&#39;t plan on becoming a website hosting provider with Edge Functions. For now, Edge Functions can only be invoked via the <code>POST</code> method. Offering secure and fast web hosting with a good developer experience is a hard problem to solve and there are <a href="https://www.netlify.com/">other</a> <a href="https://vercel.com/">fantastic</a> <a href="https://pages.cloudflare.com/">providers</a> which do exactly that.</p><p>From our experience launching Supabase Storage last year, becoming a hosting provider is not something you want to take lightly. Malicious folks will upload their phishing sites whenever they get a chance and this can quickly spiral out of control, causing you to land on the denylist in the <a href="https://safebrowsing.google.com/">Safe Browsing dataset</a>. Even though we removed the project within minutes after being notified, various ISPs had already cached the information from the Safe browsing dataset and were ‚Äúhelping‚Äù their users by restricting access to the Supabase domain. This isn&#39;t something we&#39;re planning to repeat. But as always, we&#39;d love to hear your use cases and feature requests, we&#39;re just one <a href="https://github.com/supabase/supabase/discussions">GitHub discussion</a> away!</p><h2 id="roadmap">Roadmap</h2><p>These are some of the features that are on our roadmap for functions.</p><ul><li>Cron functions to trigger your function on a schedule</li><li>Studio support and self hosting multiple functions</li><li>Optimizing cold start times</li><li>Wasm is a great fit for running functions and companies like <a href="https://suborbital.dev/">Suborbital</a> are leading the charge by making it easy to write functions that run in a Wasm-based runtime. Deno supports Wasm natively and we plan on allowing users to write their functions in languages that compile down to Wasm like Rust.</li><li>We can expose Deno&#39;s permission model so that you can lock down your functions further by restricting outbound connections to specific domains.</li><li>To invoke functions, you need a valid JWT signed by your project&#39;s JWT secret. We plan on making this verification optional. This enables more use cases like hooking up Supabase functions to Stripe webhooks where the function manages it&#39;s own authentication.</li></ul><p>Give us a shout with your feedback and excited to see what you build in the hackathon!</p></div></article></div>
  </body>
</html>
