<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://chanind.github.io/python/2022/10/31/jupyter-sge-ngrok.html">Original</a>
    <h1>Running Jupyter Notebooks in Grid Engine with Ngrok</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>A lot of universities use <a href="https://en.wikipedia.org/wiki/Oracle_Grid_Engine">Oracle Grid Engine</a> (aka Sun Grid Engine, or SGE) for high-performance computing. This system lets you submit jobs requesting varying amounts of CPUs, GPUs, and memory to run machine learning (ML) and other compute-intensive tasks. This is great for when you’ve built a pipeline to train a ML model and just need a lot of power to run the training, but is awkward for experimentation and development since you’re just given a command prompt.</p>

<p>On the other end of the development cycle, there’s <a href="https://jupyter.org/">Jupyter</a>, which lets you write Python code in an interactive notebook, mixing text and images in with executable code. Development and experimentation in Jupyter is a joy since you can easily print interactive tables with data to the screen, or draw images, output interactive tensorboards - basically anything that can be displayed in a web browser can be turned into a Jupyter widget. If we can combine Jupyter with Grid Engine we can get the power of Grid Engine with the development ease of Jupyter.</p>

<p>The issue is that usually Grid Engine jobs don’t have ports open to the outside or directly allow ssh access to the running job, so running Jupyter inside of a Grid Engine session is difficult. Fortunately that’s where <a href="https://ngrok.com/">Ngrok</a> comes in. Ngrok is a tool which can forward a service running on a local machine and give you a web URL where you can access that service from the internet. This is perfect since it solves the problem of letting you easily access a Jupyter notebook that’s running inside of a Grid Engine session.</p>

<h2 id="initial-setup">Initial setup</h2>

<p>First, sign up for a free Ngrok account at <a href="https://ngrok.com">ngrok.com</a>. After you sign in, find the link to download the ngrok client for Linux and copy the URL of this link.</p>

<p>Next, ssh into Grid Engine and install ngrok in your home directory. This should look something like below:</p>

<div><div><pre><code><span># paste the linux download URL for ngrok here, it may be different than what&#39;s below</span>
wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz
<span>tar</span> <span>-xvzpf</span> ngrok-v3-stable-linux-amd64.tgz
</code></pre></div></div>

<p>At this point, you should have an executable called <code>ngrok</code> in your home directory.</p>

<p>Next, copy your auth token from the ngrok website (it should be a long pseudo-random string like <code>c8132179a3cE725B4e267_51F32179C3eE725B4E267</code>) and run the following command:</p>

<div><div><pre><code>./ngrok config add-authtoken &lt;your token here&gt;
</code></pre></div></div>

<p>At this point, ngrok should be good to go! Next just make sure you have jupyter installed with:</p>



<p>It’s a good idea to set a password for jupyter since we’re going to make it accessible on the internet in the next section, and you don’t want random strangers on the internet to be able to run code in your notebook.</p>

<div><div><pre><code>jupyter notebook password
</code></pre></div></div>

<h2 id="running-jupyter--ngrok-in-an-interactive-session">Running Jupyter + Ngrok in an interactive session</h2>

<p>Next, start an interactive session in Grid Engine, something like the following:</p>

<div><div><pre><code>qrsh <span>-l</span> <span>tmem</span><span>=</span>10G,h_rt<span>=</span>2:00:00,gpu<span>=</span><span>true</span> <span>-now</span> no <span>-verbose</span>
</code></pre></div></div>

<p>Once your session has started, you need to run both ngrok and Jupyter on the same port. The specific port number doesn’t matter much - you just don’t want to pick a number that someone else on the same machine might also be using. Below I’m using port 7923, but change this to whatever number you prefer (numbers in the 7000-9999 range tend to be good choices).</p>

<div><div><pre><code>(trap &#39;kill 0&#39; SIGINT; jupyter notebook --no-browser --port 7923 &amp; ~/ngrok http 7923)
</code></pre></div></div>

<p>The command above just runs jupyter and ngrok in parallel, and kills them both when you exit the shell.</p>

<p>Now, ngrok should display a URL on the screen (something like <code>https://aba4-128-90-27-382.eu.ngrok.io</code>) which you can open up in your browser, and, voila, you should see your jupyter notebook running inside of your Grid Engine interactive shell! And that’s it, you’ve got Jupyter running inside of Grid Engine.</p>

<p>If you have any improvements to this technique, let me know!</p>

  </div>
  
  
</article>

      </div>
    </div></div>
  </body>
</html>
