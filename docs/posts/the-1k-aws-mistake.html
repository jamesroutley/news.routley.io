<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.geocod.io/code-and-coordinates/2025-11-18-the-1000-aws-mistake/">Original</a>
    <h1>The $1k AWS Mistake</h1>
    
    <div id="readability-page-1" class="page"><p>A cautionary tale about AWS VPC networking, NAT Gateways, and how a missing VPC Endpoint turned our S3 data transfers into an expensive lesson.</p><div><p>I&#39;ve been using AWS since around 2007. Back then, EC2 storage was entirely ephemeral and stopping an instance meant losing all your data. The platform has come a long way since then.</p>
<p>Even after nearly two decades with the platform, there&#39;s always something new to learn. And sometimes those lessons come with a $1,000 price tag.</p>
<h2 id="the-setup"><a href="#the-setup" aria-label="the setup permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The setup</h2>
<p>We recently moved over to using S3 for mirroring some large internal data files for Geocodio. We&#39;re talking about geographic datasets (things like address points, boundary data, and census information) that range from a few gigabytes to hundreds of gigabytes each. Some of these files are updated almost daily with fresh data, while others are refreshed less frequently. They need to be synced regularly from our ETL platform (which is hosted with Hetzner) to our processing infrastructure on AWS.</p>
<p>AWS has notoriously high data transfer costs. <a href="https://blog.cloudflare.com/aws-egregious-egress/">Cloudflare has written extensively about this</a>, and it&#39;s a common complaint across the industry. Corey Quinn from Last Week in AWS has also <a href="https://www.lastweekinaws.com/blog/the-aws-managed-nat-gateway-is-unpleasant-and-not-recommended/">called out the AWS Managed NAT Gateway</a> for being particularly expensive. AWS charges $0.09 per GB for data transfer out to the internet from most regions, which adds up fast when you&#39;re moving terabytes of data.</p>
<p>So before starting this project, I did my homework. I carefully researched the costs involved and confirmed two critical things:</p>
<ol>
<li><strong>AWS still allows free transfer between EC2 instances and S3</strong> (as long as they&#39;re in the same region)</li>
<li><strong>Transfers <em>into</em> S3 are free</strong> (this was important since the data comes from our ETL platform hosted with Hetzner)</li>
</ol>
<p>Great! I had a clear picture of the costs.</p>
<p>...Or so I thought.</p>
<h2 id="the-surprise"><a href="#the-surprise" aria-label="the surprise permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The surprise</h2>
<p>A few days after deploying the new S3 sync process, I got a notification from AWS Cost Anomaly Detection. (Boy, was I happy that I had that enabled!)</p>
<p>The alert showed something alarming: <strong>20,167.32 GB</strong> of &#34;NAT Gateway&#34; data transfers in a single day, which amounted to <strong>$907.53</strong>.</p>
<p>Month to date, this had already surpassed $1,000.</p>
<p><img src="https://www.geocod.io/img/blog/aws-traffic-cost.png" alt="AWS Cost Anomaly Detection showing unexpected NAT Gateway charges"/></p>
<p>I stared at the dashboard in disbelief. How could this be happening? I had specifically confirmed that EC2-to-S3 transfers were free!</p>
<h2 id="but-why-oh-why"><a href="#but-why-oh-why" aria-label="but why oh why permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>But why oh why?</h2>
<p>After some frantic investigating (and a bit of panic), I discovered the culprit.</p>
<p>When you&#39;re using VPCs with a NAT Gateway (which most production AWS setups do), S3 transfers <strong>still go through the NAT Gateway</strong> by default. Even though you&#39;re making requests to an AWS service that&#39;s in the same region, the traffic is routed out through your NAT Gateway and back in, incurring data transfer charges at $0.045 per GB.</p>
<p><img src="https://www.geocod.io/img/blog/aws-nat-gateway-problem.png" alt="Architecture diagram showing traffic flowing from EC2 through NAT Gateway to S3"/></p>
<p>The solution? <strong>VPC Endpoints for S3</strong>, specifically what AWS calls a &#34;Gateway Endpoint.&#34;</p>
<p>A Gateway Endpoint is a special type of VPC endpoint that allows you to privately route traffic to S3 without going through your NAT Gateway or Internet Gateway. It&#39;s essentially a direct pipe from your VPC to S3.</p>
<p>Even better, Gateway Endpoints for S3 are <strong>completely free</strong>. No hourly charges, no data transfer charges. Nothing.</p>
<h2 id="the-fix"><a href="#the-fix" aria-label="the fix permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The fix</h2>
<p>The solution is to create a VPC Gateway Endpoint for S3. This is a special type of VPC endpoint that creates a direct route from your VPC to S3, bypassing the NAT Gateway entirely.</p>
<p><img src="https://www.geocod.io/img/blog/aws-vpc-endpoint-solution.png" alt="Architecture diagram showing direct traffic flow from EC2 through VPC Gateway Endpoint to S3"/></p>
<p>In our case, we manage infrastructure with Terraform, so it was just a matter of adding the Gateway Endpoint resource and associating it with our route tables. AWS automatically handles the routing updates to direct S3 traffic through the endpoint instead of the NAT Gateway.</p>
<h2 id="the-lesson"><a href="#the-lesson" aria-label="the lesson permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The lesson</h2>
<p>I&#39;ve built countless VPCs, configured security groups, set up load balancers, and optimized costs in dozens of ways over the years. But somehow, VPC Endpoints for S3 had slipped through the cracks of my knowledge.</p>
<p>AWS&#39;s networking can be deceptively complex. Even when you think you&#39;ve done your research and confirmed the costs, there are layers of configuration that can dramatically change your bill.</p>
<p>Don&#39;t make my mistake. Here are a few things I&#39;d suggest checking to help you avoid <em>your own</em> surprise $1,000 bill:</p>
<p><strong>AWS Cost Anomaly Detection is worth setting up.</strong> It caught this issue within days, saving us from an even larger surprise at the end of the month. If you haven&#39;t enabled it yet, <a href="https://console.aws.amazon.com/costmanagement/">do it <em>now</em></a>.</p>
<p><strong><a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html">VPC Endpoints</a> are your friend.</strong> If you&#39;re using S3 or DynamoDB from EC2 instances in a VPC with a NAT Gateway, you absolutely need Gateway Endpoints. There&#39;s literally no reason not to use them. They&#39;re free and improve performance.</p>
<p><strong>Always validate your assumptions.</strong> I thought &#34;EC2 to S3 is free&#34; was enough. I should have tested with a small amount of data and monitored the costs before scaling up to terabytes.</p>
<p><strong>The cloud is complicated.</strong> There&#39;s always more to learn, even after nearly two decades. And that&#39;s okay. It just means we need to be careful and vigilant.</p>
<p>And we&#39;re not alone in this. Just last year, <a href="https://www.infoq.com/news/2024/11/aws-websockets-costs/">Recall.ai discovered they were paying $1M annually in unexpected AWS WebSocket data processing fees</a>. Even experienced teams hit these surprises.</p>
<h2 id="whats-next"><a href="#whats-next" aria-label="whats next permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What&#39;s next</h2>
<p>We&#39;ve since audited our entire AWS infrastructure to make sure we have Gateway Endpoints configured for all VPCs that communicate with S3.</p>
<p>If you&#39;re using AWS and you haven&#39;t checked your VPC Endpoint configuration lately, I&#39;d recommend taking a look. That $1,000 lesson doesn&#39;t need to be repeated.</p>
<p><em>TL;DR: NAT Gateways charge for ALL data processing, even for traffic to AWS services like S3 that have no data transfer fees. Use VPC Endpoints to bypass this.</em></p>
<h2 id="additional-resources"><a href="#additional-resources" aria-label="additional resources permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Additional Resources</h2>
<ul>
<li><a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html">AWS VPC Endpoints for S3</a></li>
<li><a href="https://aws.amazon.com/aws-cost-management/aws-cost-anomaly-detection/">AWS Cost Anomaly Detection</a></li>
<li><a href="https://carmencincotti.com/2023-03-27/the-five-minute-hack-to-saving-money-with-gateway%20endpoints/">Save Cash by Avoiding The AWS NAT Gateway with Gateway Endpoints</a> by Carmen Cincotti</li>
<li><a href="https://www.lastweekinaws.com/blog/the-aws-managed-nat-gateway-is-unpleasant-and-not-recommended/">The AWS Managed NAT Gateway is Unpleasant and Not Recommended</a> by Corey Quinn</li>
<li><a href="https://blog.cloudflare.com/aws-egregious-egress/">Cloudflare&#39;s take on AWS egress costs</a></li>
</ul></div></div>
  </body>
</html>
