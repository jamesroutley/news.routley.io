<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.trailofbits.com/2023/11/06/adding-build-provenance-to-homebrew/">Original</a>
    <h1>Adding Build Provenance to Homebrew</h1>
    
    <div id="readability-page-1" class="page"><article id="post-105252">
	<!-- .entry-header -->

	<div>
		<p><em>By William Woodruff</em></p>
<p><em>This is a joint post with Alpha-Omega—read their <a href="https://alpha-omega.dev/blog/alpha-omega-grant-to-help-homebrew-reach-slsa-build-level-2">announcement post</a> as well!</em></p>
<p>We’re starting a new project in collaboration with <a href="https://openssf.org/community/alpha-omega/" target="_blank" rel="noopener">Alpha-Omega</a> and <a href="https://openssf.org/" target="_blank" rel="noopener">OpenSSF</a> to improve the transparency and security of <a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a>. This six-month project will bring <em>cryptographically verifiable</em> build provenance to <a href="https://github.com/Homebrew/homebrew-core" target="_blank" rel="noopener"><code>homebrew-core</code></a>, allowing end users and companies to prove that Homebrew’s packages come from the official Homebrew CI/CD. In a nutshell, Homebrew’s packages will become compliant with <a href="https://slsa.dev/spec/v1.0/levels" target="_blank" rel="noopener">SLSA Build L2</a> (formerly known as Level 2).</p>
<p>As the dominant macOS package manager and popular userspace alternative on Linux, Homebrew facilitates hundreds of millions of package installs per year, including development tools and toolchains that millions of programmers rely on for <a href="https://www.cs.cmu.edu/~rdriley/487/papers/Thompson_1984_ReflectionsonTrustingTrust.pdf" target="_blank" rel="noopener">trustworthy builds</a> of their software. This critical status makes Homebrew a high-profile target for supply chain attacks, which this project will help stymie.</p>
<h2>Vulnerable links in the supply chain</h2>
<p>The software supply chain is built from individual links, and the attacker’s goal is to break the entire chain by finding and subverting the weakest link. Conversely, the defender aims to strengthen every link because the attacker needs to break only one to win.</p>
<p>Previous efforts to strengthen the entire chain have focused on various links:</p>
<ul>
<li><strong>The security of the software itself:</strong> static and dynamic analyses, as well as the rise of <a href="https://www.rust-lang.org/" target="_blank" rel="noopener">programming languages</a> <a href="https://github.com/google/wuffs" target="_blank" rel="noopener">intended to eliminate entire vulnerability classes</a></li>
<li><strong>Transport security:</strong> the use of HTTPS and other authenticated, integrity-preserving channels for retrieving and publishing software artifacts</li>
<li><strong>Packaging index and manager security:</strong> the adoption of 2FA by package indices, as well as technologies like PyPI’s <a href="https://blog.trailofbits.com/2023/05/23/trusted-publishing-a-new-benchmark-for-packaging-security/" target="_blank" rel="noopener">Trusted Publishing</a> for reducing the “blast radius” of package publishing workflows</li>
</ul>
<p>With this post, we’d like to spotlight another link that urgently needs strengthening: <strong>opaque and complex build processes</strong>.</p>
<h2>Taming beastly builds with verifiable provenance</h2>
<p>Software grows in complexity over time, and builds are no exception; modern build processes contain all the indications of a weak link in the software supply chain:</p>
<ul>
<li><strong>Opaque, unauditable build hosts:</strong> Much of today’s software is built on hosted CI/CD services, forming an implicit trust relationship. These services inject their dependencies into the build environment and change constantly—often for important reasons, such as patching vulnerable software.</li>
<li><strong>Large, dense dependency graphs:</strong> We rely more than ever on small third-party dependencies, often maintained (or not) by hobbyists with limited interest or experience in secure development. The pace of development we’ve come to expect necessitates this dense web of small dependencies. Still, their rise (along with the rise of automatic dependency updating) means that all our projects contain dozens of <a href="https://qz.com/646467/how-one-programmer-broke-the-internet-by-deleting-a-tiny-piece-of-code" target="_blank" rel="noopener">left-pad</a> incidents waiting to happen.</li>
<li><strong>Complex, unreproducible build systems and processes:</strong> Undeclared and implicit dependencies, environments that cannot be reproduced locally, incorrect assumptions, and race conditions are just a few of the ways in which builds can misbehave or fail to reproduce, leaving engineers in the lurch. These reliability and usability problems are also security problems in our world of CI/CD and real-time security releases.</li>
</ul>
<p>Taming these complexities requires visibility into them. We must be able to enumerate and formally describe the components of our build systems to analyze them automatically. This goes by many names and covers many techniques (SBOMs, build transparency, reproducibility, etc.), but the basic idea is one of provenance.</p>
<p>At the same time, collecting provenance adds a new link to our chain. Without integrity and authenticity protections, provenance is just another piece of information that an attacker could potentially manipulate.</p>
<p>This brings us to our ultimate goal: provenance that we can cryptographically verify, giving us confidence in our claims about a build’s origin and integrity.</p>
<p>Fortunately, all the building blocks for verifiable provenance already exist: <a href="https://www.sigstore.dev/" target="_blank" rel="noopener">Sigstore</a> gives us strong digital signatures bound to machine (or human) identities, <a href="https://github.com/secure-systems-lab/dsse" target="_blank" rel="noopener">DSSE</a> and <a href="https://in-toto.io/" target="_blank" rel="noopener">in-toto</a> offer standard formats and signing procedures for crafting signed attestations, and <a href="https://slsa.dev/" target="_blank" rel="noopener">SLSA</a> provides a formal taxonomy for evaluating the strength and trustworthiness of our statements.</p>
<h2>Verifiable provenance for Homebrew</h2>
<p>What does this mean for Homebrew? Once complete, every single <a href="https://docs.brew.sh/Bottles" target="_blank" rel="noopener">bottle</a> provided by <code>homebrew-core</code> will be digitally signed in a way that attests it was built on Homebrew’s trusted CI/CD. Those digital signatures will be provided through Sigstore; the attestations behind them will be performed with the <a href="https://github.com/in-toto/attestation" target="_blank" rel="noopener">in-toto attestation framework</a>.</p>
<p>Even if an attacker manages to compromise Homebrew’s bottle hosting or otherwise tamper with the contents of the bottles referenced in the <code>homebrew-core</code> formulas, they cannot contrive an authentic digital signature for their changes.</p>
<p>This protection complements Homebrew’s existing integrity and source-side authenticity guarantees. Once provenance on <code>homebrew-core</code> is fully deployed, a user who runs <code>brew</code> <code>install</code> <code>python</code> will be able to prove each of the following:</p>
<ol>
<li>The formula metadata used to install Python is authenticated, thanks to Homebrew’s <a href="https://formulae.brew.sh/api/formula.jws.json" target="_blank" rel="noopener">signed JSON API</a>.</li>
<li>The bottle has not been tampered with in transit, thanks to digests in the formula metadata.</li>
<li>The bottle was built in a public, auditable, controlled CI/CD environment against a specific source revision.</li>
</ol>
<p>That last property is brand new and is equivalent to <a href="https://slsa.dev/spec/v1.0/levels#build-l2-hosted-build-platform" target="_blank" rel="noopener">Build L2</a> in the SLSA taxonomy of security levels.</p>
<h2>Follow along!</h2>
<p>This work is open source and will be conducted openly, so you can follow our activity. We are actively involved in the <a href="https://www.sigstore.dev/community" target="_blank" rel="noopener">Sigstore</a> and <a href="https://openssf.org/getinvolved/" target="_blank" rel="noopener">OpenSSF</a> Slacks, so please drop in and say hi!</p>
<p>Alpha-Omega, an associated project of OpenSSF, is funding this work. The Alpha-Omega mission is to protect society by catalyzing sustainable security improvements to the most critical open-source software projects and ecosystems. OpenSSF holds <a href="https://calendar.google.com/calendar/u/0?cid=czYzdm9lZmhwNWk5cGZsdGI1cTY3bmdwZXNAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ" target="_blank" rel="noopener">regularly scheduled meetings</a> for its working groups and projects, and we’ll be in attendance.</p>

			</div><!-- .entry-content -->

	
</article></div>
  </body>
</html>
