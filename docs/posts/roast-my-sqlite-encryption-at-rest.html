<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ncruces/go-sqlite3/tree/main/vfs/adiantum">Original</a>
    <h1>Show HN: Roast my SQLite encryption at-rest</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">This package wraps an SQLite VFS to offer encryption at rest.</p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Warning</p><p dir="auto">This work was not certified by a cryptographer.
If you need vetted encryption, you should purchase the
<a href="https://sqlite.org/see" rel="nofollow">SQLite Encryption Extension</a>,
and either wrap it, or seek assistance wrapping it.</p>
</div>
<p dir="auto">The <code>&#34;adiantum&#34;</code> VFS wraps the default SQLite VFS using the
<a href="https://github.com/lukechampine/adiantum">Adiantum</a>
tweakable and length-preserving encryption.</p>
<p dir="auto">The default Adiantum construction uses XChaCha12 for its stream cipher,
AES for its block cipher, and NH and Poly1305 for hashing.</p>
<p dir="auto">The VFS encrypts all files <em>except</em>
<a href="https://sqlite.org/tempfiles.html#super_journal_files" rel="nofollow">super journals</a>:
they <em>never</em> contain database data, only filenames,
and padding them to the block size is problematic.
Temporary files <em>are</em> encrypted with <strong>random</strong> keys,
as they <em>may</em> contain database data.
To avoid the overhead of encrypting temporary files,
keep them in memory:</p>
<div data-snippet-clipboard-copy-content="PRAGMA temp_store = memory;"><pre><code>PRAGMA temp_store = memory;
</code></pre></div>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p><p dir="auto">Adiantum is typically used for disk encryption.
The standard threat model for disk encryption considers an adversary
that can read multiple snapshots of a disk.
The only security property that disk encryption (and this package)
provides is that all information such an adversary can obtain
is whether the data in a sector has (or has not) changed over time.</p>
</div>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Caution</p><p dir="auto">This package does not claim protect databases against forgery.
Any encryption scheme that allows constant-time block updates
can&#39;t prevent individual blocks from being reverted to former versions of themselves,
so block-level authentication is of limited value.</p>
</div>
</article></div></div>
  </body>
</html>
