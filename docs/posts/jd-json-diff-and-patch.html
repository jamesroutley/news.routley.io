<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/josephburnett/jd">Original</a>
    <h1>Jd â€“ JSON Diff and Patch</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><a href="https://goreportcard.com/report/josephburnett/jd" rel="nofollow"><img src="https://camo.githubusercontent.com/a954bf3a267f730dfe4082198e3d47ac65467c6b82943c7afd49e0a7c96d35ca/68747470733a2f2f676f7265706f7274636172642e636f6d2f62616467652f6a6f736570686275726e6574742f6a64" alt="Go Report Card" data-canonical-src="https://goreportcard.com/badge/josephburnett/jd"/></a></p>

<p dir="auto"><code>jd</code> is a commandline utility and Go library for diffing and patching JSON and YAML values. It supports a native <code>jd</code> format (similar to unified format) as well as JSON Merge Patch (<a href="https://datatracker.ietf.org/doc/html/rfc7386" rel="nofollow">RFC 7386</a>) and a subset of JSON Patch (<a href="https://datatracker.ietf.org/doc/html/rfc6902" rel="nofollow">RFC 6902</a>). Try it out at <a href="http://play.jd-tool.io/" rel="nofollow">http://play.jd-tool.io/</a>.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/josephburnett/jd/blob/master/logo_small.png"><img src="https://github.com/josephburnett/jd/raw/master/logo_small.png" alt="jd logo"/></a></p>

<p dir="auto">To get the <code>jd</code> commandline utility:</p>
<ul dir="auto">
<li>run <code>brew install jd</code>, or</li>
<li>run <code>go install github.com/josephburnett/jd@latest</code>, or</li>
<li>visit <a href="https://github.com/josephburnett/jd/releases/latest">https://github.com/josephburnett/jd/releases/latest</a> and download the pre-built binary for your architecture/os, or</li>
<li>run in a Docker image <code>jd(){ docker run --rm -i -v $PWD:$PWD -w $PWD josephburnett/jd &#34;$@&#34;; }</code>.</li>
</ul>
<p dir="auto">To use the <code>jd</code> web UI:</p>
<ul dir="auto">
<li>visit <a href="http://play.jd-tool.io/" rel="nofollow">http://play.jd-tool.io/</a>, or</li>
<li>run <code>jd -port 8080</code> and visit <a href="http://localhost:8080" rel="nofollow">http://localhost:8080</a>.</li>
</ul>

<div data-snippet-clipboard-copy-content="Usage: jd [OPTION]... FILE1 [FILE2]
Diff and patch JSON files.

Prints the diff of FILE1 and FILE2 to STDOUT.
When FILE2 is omitted the second input is read from STDIN.
When patching (-p) FILE1 is a diff.

Options:
  -color     Print color diff.
  -p         Apply patch FILE1 to FILE2 or STDIN.
  -o=FILE3   Write to FILE3 instead of STDOUT.
  -set       Treat arrays as sets.
  -mset      Treat arrays as multisets (bags).
  -setkeys   Keys to identify set objects
  -yaml      Read and write YAML instead of JSON.
  -port=N    Serve web UI on port N
  -f=FORMAT  Produce diff in FORMAT &#34;jd&#34; (default), &#34;patch&#34; (RFC 6902) or
             &#34;merge&#34; (RFC 7386)
  -t=FORMATS Translate FILE1 between FORMATS. Supported formats are &#34;jd&#34;,
             &#34;patch&#34; (RFC 6902), &#34;merge&#34; (RFC 7386), &#34;json&#34; and &#34;yaml&#34;.
             FORMATS are provided as a pair separated by &#34;2&#34;. E.g.
             &#34;yaml2json&#34; or &#34;jd2patch&#34;.

Examples:
  jd a.json b.json
  cat b.json | jd a.json
  jd -o patch a.json b.json; jd patch a.json
  jd -set a.json b.json
  jd -f patch a.json b.json
  jd -f merge a.json b.json"><pre><code>Usage: jd [OPTION]... FILE1 [FILE2]
Diff and patch JSON files.

Prints the diff of FILE1 and FILE2 to STDOUT.
When FILE2 is omitted the second input is read from STDIN.
When patching (-p) FILE1 is a diff.

Options:
  -color     Print color diff.
  -p         Apply patch FILE1 to FILE2 or STDIN.
  -o=FILE3   Write to FILE3 instead of STDOUT.
  -set       Treat arrays as sets.
  -mset      Treat arrays as multisets (bags).
  -setkeys   Keys to identify set objects
  -yaml      Read and write YAML instead of JSON.
  -port=N    Serve web UI on port N
  -f=FORMAT  Produce diff in FORMAT &#34;jd&#34; (default), &#34;patch&#34; (RFC 6902) or
             &#34;merge&#34; (RFC 7386)
  -t=FORMATS Translate FILE1 between FORMATS. Supported formats are &#34;jd&#34;,
             &#34;patch&#34; (RFC 6902), &#34;merge&#34; (RFC 7386), &#34;json&#34; and &#34;yaml&#34;.
             FORMATS are provided as a pair separated by &#34;2&#34;. E.g.
             &#34;yaml2json&#34; or &#34;jd2patch&#34;.

Examples:
  jd a.json b.json
  cat b.json | jd a.json
  jd -o patch a.json b.json; jd patch a.json
  jd -set a.json b.json
  jd -f patch a.json b.json
  jd -f merge a.json b.json
</code></pre></div>
<div dir="auto"><h4 tabindex="-1" dir="auto">Command Line Option Details</h4><a id="user-content-command-line-option-details" aria-label="Permalink: Command Line Option Details" href="#command-line-option-details"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>setkeys</code> This option determines what keys are used to decide if two objects &#39;match&#39;. Then the matched objects are compared, which will return a diff if there are differences in the objects themselves, their keys and/or values. You shouldn&#39;t expect this option to mask or ignore non-specified keys, it is not intended as a way to &#39;ignore&#39; some differences between objects.</p>

<p dir="auto">Note: import only release commits (<code>v1.Y.Z</code>) because <code>master</code> can be unstable.</p>
<div dir="auto" data-snippet-clipboard-copy-content="import (
	&#34;fmt&#34;
	jd &#34;github.com/josephburnett/jd/lib&#34;
)

func ExampleJsonNode_Diff() {
	a, _ := jd.ReadJsonString(`{&#34;foo&#34;:&#34;bar&#34;}`)
	b, _ := jd.ReadJsonString(`{&#34;foo&#34;:&#34;baz&#34;}`)
	fmt.Print(a.Diff(b).Render())
	// Output:
	// @ [&#34;foo&#34;]
	// - &#34;bar&#34;
	// + &#34;baz&#34;
}

func ExampleJsonNode_Patch() {
	a, _ := jd.ReadJsonString(`[&#34;foo&#34;]`)
	diff, _ := jd.ReadDiffString(`` +
		`@ [1]` + &#34;\n&#34; +
		`+ &#34;bar&#34;` + &#34;\n&#34;)
	b, _ := a.Patch(diff)
	fmt.Print(b.Json())
	// Output:
	// [&#34;foo&#34;,&#34;bar&#34;]
}"><pre><span>import</span> (
	<span>&#34;fmt&#34;</span>
	jd <span>&#34;github.com/josephburnett/jd/lib&#34;</span>
)

<span>func</span> <span>ExampleJsonNode_Diff</span>() {
	<span>a</span>, <span>_</span> <span>:=</span> <span>jd</span>.<span>ReadJsonString</span>(<span>`{&#34;foo&#34;:&#34;bar&#34;}`</span>)
	<span>b</span>, <span>_</span> <span>:=</span> <span>jd</span>.<span>ReadJsonString</span>(<span>`{&#34;foo&#34;:&#34;baz&#34;}`</span>)
	<span>fmt</span>.<span>Print</span>(<span>a</span>.<span>Diff</span>(<span>b</span>).<span>Render</span>())
	<span>// Output:</span>
	<span>// @ [&#34;foo&#34;]</span>
	<span>// - &#34;bar&#34;</span>
	<span>// + &#34;baz&#34;</span>
}

<span>func</span> <span>ExampleJsonNode_Patch</span>() {
	<span>a</span>, <span>_</span> <span>:=</span> <span>jd</span>.<span>ReadJsonString</span>(<span>`[&#34;foo&#34;]`</span>)
	<span>diff</span>, <span>_</span> <span>:=</span> <span>jd</span>.<span>ReadDiffString</span>(<span>``</span> <span>+</span>
		<span>`@ [1]`</span> <span>+</span> <span>&#34;<span>\n</span>&#34;</span> <span>+</span>
		<span>`+ &#34;bar&#34;`</span> <span>+</span> <span>&#34;<span>\n</span>&#34;</span>)
	<span>b</span>, <span>_</span> <span>:=</span> <span>a</span>.<span>Patch</span>(<span>diff</span>)
	<span>fmt</span>.<span>Print</span>(<span>b</span>.<span>Json</span>())
	<span>// Output:</span>
	<span>// [&#34;foo&#34;,&#34;bar&#34;]</span>
}</pre></div>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/josephburnett/jd/blob/master/ebnf.png"><img src="https://github.com/josephburnett/jd/raw/master/ebnf.png" alt="Railroad diagram of EBNF"/></a></p>
<ul dir="auto">
<li>A diff is zero or more sections</li>
<li>Sections start with a <code>@</code> header and the path to a node</li>
<li>A path is a JSON list of zero or more elements accessing collections</li>
<li>A JSON number element (e.g. <code>0</code>) accesses an array</li>
<li>A JSON string element (e.g. <code>&#34;foo&#34;</code>) accesses an object</li>
<li>An empty JSON object element (<code>{}</code>) accesses an array as a set or multiset</li>
<li>After the path is one or more removals or additions, removals first</li>
<li>Removals start with <code>-</code> and then the JSON value to be removed</li>
<li>Additions start with <code>+</code> and then the JSON value to added</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="Diff ::= ( &#39;@&#39; &#39;[&#39; ( &#39;JSON String&#39; | &#39;JSON Number&#39; | &#39;Empty JSON Object&#39; )* &#39;]&#39; &#39;\n&#39; ( ( &#39;-&#39; &#39;JSON Value&#39; &#39;\n&#39; )+ | &#39;+&#39; &#39;JSON Value&#39; &#39;\n&#39; ) ( &#39;+&#39; &#39;JSON Value&#39; &#39;\n&#39; )* )*"><pre><span>Diff</span> <span>::=</span> ( <span><span>&#39;</span>@<span>&#39;</span></span> <span><span>&#39;</span>[<span>&#39;</span></span> ( <span><span>&#39;</span>JSON String<span>&#39;</span></span> <span>|</span> <span><span>&#39;</span>JSON Number<span>&#39;</span></span> <span>|</span> <span><span>&#39;</span>Empty JSON Object<span>&#39;</span></span> )<span>*</span> <span><span>&#39;</span>]<span>&#39;</span></span> <span><span>&#39;</span>\n<span>&#39;</span></span> ( ( <span><span>&#39;</span>-<span>&#39;</span></span> <span><span>&#39;</span>JSON Value<span>&#39;</span></span> <span><span>&#39;</span>\n<span>&#39;</span></span> )<span>+</span> <span>|</span> <span><span>&#39;</span>+<span>&#39;</span></span> <span><span>&#39;</span>JSON Value<span>&#39;</span></span> <span><span>&#39;</span>\n<span>&#39;</span></span> ) ( <span><span>&#39;</span>+<span>&#39;</span></span> <span><span>&#39;</span>JSON Value<span>&#39;</span></span> <span><span>&#39;</span>\n<span>&#39;</span></span> )<span>*</span> )<span>*</span></pre></div>



<div dir="auto" data-snippet-clipboard-copy-content="@ [&#34;Movies&#34;,67,&#34;Title&#34;]
- &#34;Dr. Strangelove&#34;
+ &#34;Dr. Evil Love&#34;
@ [&#34;Movies&#34;,67,&#34;Actors&#34;,&#34;Dr. Strangelove&#34;]
- &#34;Peter Sellers&#34;
+ &#34;Mike Myers&#34;
@ [&#34;Movies&#34;,102]
+ {&#34;Title&#34;:&#34;Austin Powers&#34;,&#34;Actors&#34;:{&#34;Austin Powers&#34;:&#34;Mike Myers&#34;}}"><pre>@ [&#34;Movies&#34;,67,&#34;Title&#34;]
<span><span>-</span> &#34;Dr. Strangelove&#34;</span>
<span><span>+</span> &#34;Dr. Evil Love&#34;</span>
@ [&#34;Movies&#34;,67,&#34;Actors&#34;,&#34;Dr. Strangelove&#34;]
<span><span>-</span> &#34;Peter Sellers&#34;</span>
<span><span>+</span> &#34;Mike Myers&#34;</span>
@ [&#34;Movies&#34;,102]
<span><span>+</span> {&#34;Title&#34;:&#34;Austin Powers&#34;,&#34;Actors&#34;:{&#34;Austin Powers&#34;:&#34;Mike Myers&#34;}}</span></pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="@ [&#34;Movies&#34;,67,&#34;Tags&#34;,{}]
- &#34;Romance&#34;
+ &#34;Action&#34;
+ &#34;Comedy&#34;"><pre>@ [&#34;Movies&#34;,67,&#34;Tags&#34;,{}]
<span><span>-</span> &#34;Romance&#34;</span>
<span><span>+</span> &#34;Action&#34;</span>
<span><span>+</span> &#34;Comedy&#34;</span></pre></div>

<div dir="auto"><h3 tabindex="-1" dir="auto">Use git diff to produce a structural diff:</h3><a id="user-content-use-git-diff-to-produce-a-structural-diff" aria-label="Permalink: Use git diff to produce a structural diff:" href="#use-git-diff-to-produce-a-structural-diff"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="git difftool -yx jd @ -- foo.json
@ [&#34;foo&#34;]
- &#34;bar&#34;
+ &#34;baz&#34;"><pre>git difftool -yx jd @ -- foo.json
@ [&#34;foo&#34;]
<span><span>-</span> &#34;bar&#34;</span>
<span><span>+</span> &#34;baz&#34;</span></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">See what changes in a Kubernetes Deployment:</h3><a id="user-content-see-what-changes-in-a-kubernetes-deployment" aria-label="Permalink: See what changes in a Kubernetes Deployment:" href="#see-what-changes-in-a-kubernetes-deployment"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="kubectl get deployment example -oyaml &gt; a.yaml
kubectl edit deployment example
# change cpu resource from 100m to 200m
kubectl get deployment example -oyaml | jd -yaml a.yaml"><pre>kubectl get deployment example -oyaml <span>&gt;</span> a.yaml
kubectl edit deployment example
<span><span>#</span> change cpu resource from 100m to 200m</span>
kubectl get deployment example -oyaml <span>|</span> jd -yaml a.yaml</pre></div>
<p dir="auto">output:</p>
<div dir="auto" data-snippet-clipboard-copy-content="@ [&#34;metadata&#34;,&#34;annotations&#34;,&#34;deployment.kubernetes.io/revision&#34;]
- &#34;2&#34;
+ &#34;3&#34;
@ [&#34;metadata&#34;,&#34;generation&#34;]
- 2
+ 3
@ [&#34;metadata&#34;,&#34;resourceVersion&#34;]
- &#34;4661&#34;
+ &#34;5179&#34;
@ [&#34;spec&#34;,&#34;template&#34;,&#34;spec&#34;,&#34;containers&#34;,0,&#34;resources&#34;,&#34;requests&#34;,&#34;cpu&#34;]
- &#34;100m&#34;
+ &#34;200m&#34;
@ [&#34;status&#34;,&#34;conditions&#34;,1,&#34;lastUpdateTime&#34;]
- &#34;2021-12-23T09:40:39Z&#34;
+ &#34;2021-12-23T09:41:49Z&#34;
@ [&#34;status&#34;,&#34;conditions&#34;,1,&#34;message&#34;]
- &#34;ReplicaSet \&#34;nginx-deployment-787d795676\&#34; has successfully progressed.&#34;
+ &#34;ReplicaSet \&#34;nginx-deployment-795c7f5bb\&#34; has successfully progressed.&#34;
@ [&#34;status&#34;,&#34;observedGeneration&#34;]
- 2
+ 3"><pre>@ [&#34;metadata&#34;,&#34;annotations&#34;,&#34;deployment.kubernetes.io/revision&#34;]
<span><span>-</span> &#34;2&#34;</span>
<span><span>+</span> &#34;3&#34;</span>
@ [&#34;metadata&#34;,&#34;generation&#34;]
<span><span>-</span> 2</span>
<span><span>+</span> 3</span>
@ [&#34;metadata&#34;,&#34;resourceVersion&#34;]
<span><span>-</span> &#34;4661&#34;</span>
<span><span>+</span> &#34;5179&#34;</span>
@ [&#34;spec&#34;,&#34;template&#34;,&#34;spec&#34;,&#34;containers&#34;,0,&#34;resources&#34;,&#34;requests&#34;,&#34;cpu&#34;]
<span><span>-</span> &#34;100m&#34;</span>
<span><span>+</span> &#34;200m&#34;</span>
@ [&#34;status&#34;,&#34;conditions&#34;,1,&#34;lastUpdateTime&#34;]
<span><span>-</span> &#34;2021-12-23T09:40:39Z&#34;</span>
<span><span>+</span> &#34;2021-12-23T09:41:49Z&#34;</span>
@ [&#34;status&#34;,&#34;conditions&#34;,1,&#34;message&#34;]
<span><span>-</span> &#34;ReplicaSet \&#34;nginx-deployment-787d795676\&#34; has successfully progressed.&#34;</span>
<span><span>+</span> &#34;ReplicaSet \&#34;nginx-deployment-795c7f5bb\&#34; has successfully progressed.&#34;</span>
@ [&#34;status&#34;,&#34;observedGeneration&#34;]
<span><span>-</span> 2</span>
<span><span>+</span> 3</span></pre></div>
<p dir="auto">apply these change to another deployment:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# edit file &#34;patch&#34; to contain only the hunk updating cpu request
kubectl patch deployment example2 --type json --patch &#34;$(jd -t jd2patch ~/patch)&#34;"><pre><span><span>#</span> edit file &#34;patch&#34; to contain only the hunk updating cpu request</span>
kubectl patch deployment example2 --type json --patch <span><span>&#34;</span><span><span>$(</span>jd -t jd2patch <span>~</span>/patch<span>)</span></span><span>&#34;</span></span></pre></div>
</article></div></div>
  </body>
</html>
