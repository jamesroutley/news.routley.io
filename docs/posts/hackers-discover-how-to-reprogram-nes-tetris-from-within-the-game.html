<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://arstechnica.com/gaming/2024/05/hackers-discover-how-to-reprogram-nes-tetris-from-within-the-game/">Original</a>
    <h1>Hackers discover how to reprogram NES Tetris from within the game</h1>
    
    <div id="readability-page-1" class="page"><div>
            <h4>
      Building a better Tetris    —
</h4>
            
            <h2 itemprop="description">New method could help high-score chasers trying to avoid game-ending crashes.</h2>
            <section>

  


  
</section>        </div><section>
            <div itemprop="articleBody">
                                    
<figure>
  <img src="https://cdn.arstechnica.net/wp-content/uploads/2024/05/tetris-crash-reprogram-800x450.jpg" alt="I can see the code that controls the Tetri-verse!"/>
      <figcaption><p><a href="https://cdn.arstechnica.net/wp-content/uploads/2024/05/tetris-crash-reprogram.jpg" data-height="1440" data-width="2561">Enlarge</a> <span>/</span> I can see the code that controls the Tetri-verse!</p><p>Aurich Lawson</p></figcaption>  </figure>

  




<!-- cache hit 140:single/related:51dd443caa33d1c50b65ecebf80fafe4 --><!-- empty -->
<p>Earlier this year, <a href="https://arstechnica.com/gaming/2024/01/someone-has-finally-beaten-nes-tetris/">we shared the story</a> of how a classic NES <em>Tetris</em> player hit the game&#39;s &#34;kill screen&#34; for the first time, activating a crash after an incredible 40-minute, 1,511-line performance. Now, some players are using that kill screen—and some complicated memory manipulation it enables—to code new behaviors into versions of <em>Tetris</em> running on unmodified hardware and cartridges.
</p><p>We&#39;ve covered similar &#34;arbitrary code execution&#34; glitches in <a href="https://arstechnica.com/gaming/2014/01/how-an-emulator-fueled-robot-reprogrammed-super-mario-world-on-the-fly/">games like <em>Super Mario World</em></a>, <a href="https://arstechnica.com/gaming/2021/03/how-to-beat-paper-mario-really-fast-by-playing-ocarina-of-time/"><em>Paper Mario</em></a>, and <a href="https://arstechnica.com/gaming/2020/01/how-to-get-star-fox-64-ships-into-ocarina-of-time-no-hacking-required/"><em>The Legend of Zelda: Ocarina of Time</em></a> in the past. And the basic method for introducing outside code into NES <em>Tetris</em> has been <a href="https://www.patreon.com/posts/december-update-60288924?l=fr">publicly theorized since at least 2021</a> when players were investigating <a href="https://github.com/CelestialAmber/TetrisNESDisasm">the game&#39;s decompiled code</a> (HydrantDude, who has <a href="https://www.youtube.com/watch?v=BpEcjdr_YDo">gone deep on <em>Tetris</em> crashes in the past</a>, also <a href="https://www.youtube.com/watch?v=QOES2XTqT74&amp;lc=UgwkeKtM7UOPrkYcDnl4AaABAg">says</a> the community has long had a privately known method for how to take full control of <em>Tetris</em>&#39; RAM).
</p><figure><p><iframe type="text/html" width="640" height="360" src="https://www.youtube.com/embed/QOES2XTqT74?start=0&amp;wmode=transparent" frameborder="0" allowfullscreen=""></iframe></p><figcaption><p>Displaced Gamers explains how to reprogram NES <em>Tetris</em> within the game.</p></figcaption></figure>
<p>But <a href="https://www.youtube.com/watch?v=QOES2XTqT74">a recent video from Displaced Gamers</a> takes the idea from private theory to public execution, going into painstaking detail on how to get NES <em>Tetris</em> to start reading the game&#39;s high score tables as machine code instructions.</p>
<h2>Fun with controller ports</h2>
<p>Taking over a copy of NES <em>Tetris</em> is possible mostly due to the specific way the game crashes. Without going into <a href="https://www.youtube.com/watch?v=h7H_ilLn7nc">too much detail</a>, a crash in NES <em>Tetris</em> happens when the game&#39;s score handler takes too long to calculate a new score between frames, which can happen after level 155. When this delay occurs, a portion of the control code gets interrupted by the new frame-writing routine, causing it to jump to an unintended portion of the game&#39;s RAM to look for the next instruction.</p>                                            
                                                        
<p>Usually, this unexpected interrupt leads the code to jump to address the very beginning of RAM, where garbage data gets read as code and often leads to a quick crash. But players can manipulate this jump thanks to a little-known vagary in how <em>Tetris</em> handles potential inputs when running on the Japanese version of the console, the Famicom.</p>
<figure><a href="https://cdn.arstechnica.net/wp-content/uploads/2024/05/expansion.jpg" data-height="1440" data-width="1920" alt="The Famicom expansion port that is key to making this hack work."><img alt="The Famicom expansion port that is key to making this hack work." src="https://cdn.arstechnica.net/wp-content/uploads/2024/05/expansion-640x480.jpg" width="640" height="480" srcset="https://cdn.arstechnica.net/wp-content/uploads/2024/05/expansion-1280x960.jpg 2x"/></a><figcaption><p><a href="https://cdn.arstechnica.net/wp-content/uploads/2024/05/expansion.jpg" data-height="1440" data-width="1920">Enlarge</a> <span>/</span> The Famicom expansion port that is key to making this hack work.</p></figcaption></figure>
<p>Unlike the American Nintendo Entertainment System, the Japanese Famicom featured two controllers hard-wired to the unit. Players who wanted to use third-party controllers could plug them in through <a href="https://www.nesdev.org/wiki/Expansion_port">an expansion port</a> on the front of the system. The <em>Tetris</em> game code reads the inputs from this &#34;extra&#34; controller port, which can include two additional standard NES controllers <a href="https://misteraddons.com/products/nes-controllers-to-famicom-console-adapter">through the use of an adapter</a> (this is true even though the Famicom <a href="https://tetris.wiki/Tetris_(Famicom)">got a completely different version of <em>Tetris</em></a> from Bullet-Proof Software).</p>
<p>As it happens, the area of RAM that <em>Tetris</em> uses to process this extra controller input is also used for the memory location of that jump routine we discussed earlier. Thus, when that jump routine gets interrupted by a crash, that RAM will be holding data representing the buttons being pushed on those controllers. This gives players a potential way to control precisely where the game code goes after the crash is triggered.</p>
<h2>Coding in the high-score table</h2>
<p>For Displaced Gamers&#39; jump-control method, the player has to hold down &#34;up&#34; on the third controller and right, left, and down on the fourth controller (that latter combination requires some controller fiddling to allow for simultaneous left and right directional input). Doing so sends the jump code to an area of RAM that holds the names and scores for the game&#39;s high score listing, giving an even larger surface of RAM that can be manipulated directly by the player.</p>                                            
                                                        
<p>By putting &#34;(G&#34; in the targeted portion of the B-Type high score table, we can force the game to jump to <em>another</em> area of the high score table, where it will start reading the names and scores sequentially as what Displaced Gamers calls &#34;bare metal&#34; code, with the letters and numbers representing opcodes for the NES CPU.</p>
<figure><a href="https://cdn.arstechnica.net/wp-content/uploads/2024/05/tetrisscore.png" data-height="700" data-width="884" alt="This very specific name and score combination is actually read as code in Displaced Gamers&#39; proof of concept."><img alt="This very specific name and score combination is actually read as code in Displaced Gamers&#39; proof of concept." src="https://cdn.arstechnica.net/wp-content/uploads/2024/05/tetrisscore-640x507.png" width="640" height="507" srcset="https://cdn.arstechnica.net/wp-content/uploads/2024/05/tetrisscore.png 2x"/></a><figcaption><p><a href="https://cdn.arstechnica.net/wp-content/uploads/2024/05/tetrisscore.png" data-height="700" data-width="884">Enlarge</a> <span>/</span> This very specific name and score combination is actually read as code in Displaced Gamers&#39; proof of concept.</p></figcaption></figure>
<p>Unfortunately, there are only 43 possible symbols that can be used in the name entry area and 10 different digits that can be part of a high score. That means only a small portion of <a href="https://www.nesdev.org/wiki/CPU_unofficial_opcodes">the NES&#39;s available opcode instructions</a> can be &#34;coded&#34; into the high score table using the available attack surface.</p>
<p>Despite these restrictions, Displaced Gamers was able to code a short proof-of-concept code snippet that can be translated into high-score table data <code>(A name of &#39;))&#34;-P)&#39;</code>, and a second-place score of 8,575 in the A-Type game factors prominently, in case you&#39;re wondering). This simple routine puts two zeroes in the top digits of the game&#39;s score, lowering the score processing time that would otherwise cause a crash (though the score will eventually reach the &#34;danger zone&#34; for a crash again, with continued play).</p>
<p>Of course, the lack of a battery-backed save system means hackers need to achieve these high scores manually (and enter these complicated names) every time they power up <em>Tetris</em> on a stock NES. The limited space in the high score table also doesn&#39;t leave much room for direct coding of complex programs on top of <em>Tetris</em>&#39; actual code. But there are ways around this limitation; HydrantDude <a href="https://www.youtube.com/watch?v=QOES2XTqT74&amp;lc=UgwkeKtM7UOPrkYcDnl4AaABAg">writes</a> of a specific set of high-score names and numbers that &#34;build[s] another bootstrapper which builds another bootstrapper that grants full control over all of RAM.&#34;</p>
<p>With that kind of full control, a top-level player could theoretically recode NES <em>Tetris</em> to patch out the crash bugs altogether. That could be extremely helpful for players who are <a href="https://www.youtube.com/watch?v=jPyf5kIGoKA">struggling to make it past level 255</a>, where the game actually loops back to the tranquility of Level 0. In the meantime, I guess you could always just <a href="https://www.youtube.com/watch?v=hB6eY73sLV0">follow the lead of <em>Super Mario World</em> speedrunners</a> and transform <em>Tetris</em> into <em>Flappy Bird</em>.</p>

                                                </div>

            
            
            
        </section></div>
  </body>
</html>
