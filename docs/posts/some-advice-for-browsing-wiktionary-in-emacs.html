<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nickdrozd.github.io/2022/12/19/wiktionary-advice.html">Original</a>
    <h1>Some Advice for Browsing Wiktionary in Emacs</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p><strong>Emacs comes with a web browser built in</strong>. Although it’s often regarded as a novelty, <em>EWW</em> (as it’s known) is a real browser, and <strong><a href="https://nickdrozd.github.io/2018/10/17/web-scraping.html">I use it all the time</a></strong>. A lot of web browsing involves text, and Emacs is the ultimate text-handling platform, so it’s obvioiusly a good match.</p>

<p>But as with many things in Emacs, EWW has some <strong>irregularities</strong>. For example, here is the <strong>Wiktionary</strong> entry for the word <strong>“locus”</strong> as viewed in EWW:</p>

<p><img src="https://greydanus.github.io/assets/wiktionary-advice/locus-eww-before.png" alt="img"/></p>

<p><strong>Five definitions are listed, but one of them is blank</strong>. What is the missing definition? Is it important? I sure hope not. Dropping information from a web page without warning would be a serious problem!</p>

<p>Compare with the same page as viewed in <strong>Firefox</strong>:</p>

<p><img src="https://greydanus.github.io/assets/wiktionary-advice/locus-ff.png" alt="img"/></p>

<p>The Firefox version shows <strong>only four definitions</strong>, exactly the same ones shown in EWW. So it appears that rather than <em>dropping</em> a definition, EWW is <em>inserting</em> a blank one. That’s not such a serious problem, but it’s still <strong>kind of annoying</strong>.</p>

<p>To see what’s going on, we need to look at the <strong>HTML source</strong>. (This can be obtained from within EWW by pressing <code>v</code>.) The word definitions are grouped in an ordered list <code>ol</code> with each individual definition showing up as a list item <code>li</code>:</p>

<figure><pre><code data-lang="html"><span>&lt;ol&gt;&lt;li&gt;</span>A <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/place&#34;</span> <span>title=</span><span>&#34;place&#34;</span><span>&gt;</span>place<span>&lt;/a&gt;</span> or <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/locality&#34;</span> <span>title=</span><span>&#34;locality&#34;</span><span>&gt;</span>locality<span>&lt;/a&gt;</span>, especially a <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/centre&#34;</span> <span>title=</span><span>&#34;centre&#34;</span><span>&gt;</span>centre<span>&lt;/a&gt;</span> of <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/activity&#34;</span> <span>title=</span><span>&#34;activity&#34;</span><span>&gt;</span>activity<span>&lt;/a&gt;</span> or the <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/scene&#34;</span> <span>title=</span><span>&#34;scene&#34;</span><span>&gt;</span>scene<span>&lt;/a&gt;</span> of a <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/crime&#34;</span> <span>title=</span><span>&#34;crime&#34;</span><span>&gt;</span>crime<span>&lt;/a&gt;</span>.
<span>&lt;dl&gt;&lt;dd&gt;&lt;div</span> <span>class=</span><span>&#34;h-usage-example&#34;</span><span>&gt;&lt;i</span> <span>class=</span><span>&#34;Latn mention e-example&#34;</span> <span>lang=</span><span>&#34;en&#34;</span><span>&gt;</span>The cafeteria was the <span>&lt;b&gt;</span>locus<span>&lt;/b&gt;</span> of activity.<span>&lt;/i&gt;&lt;/div&gt;&lt;/dd&gt;&lt;/dl&gt;&lt;/li&gt;</span>
<span>&lt;li</span> <span>class=</span><span>&#34;mw-empty-elt&#34;</span><span>&gt;&lt;/li&gt;&lt;li</span> <span>class=</span><span>&#34;senseid&#34;</span> <span>id=</span><span>&#34;English:_set&#34;</span><span>&gt;&lt;span</span> <span>class=</span><span>&#34;ib-brac&#34;</span><span>&gt;</span>(<span>&lt;/span&gt;&lt;span</span> <span>class=</span><span>&#34;ib-content&#34;</span><span>&gt;&lt;a</span> <span>href=</span><span>&#34;/wiki/mathematics&#34;</span> <span>title=</span><span>&#34;mathematics&#34;</span><span>&gt;</span>mathematics<span>&lt;/a&gt;&lt;/span&gt;&lt;span</span> <span>class=</span><span>&#34;ib-brac&#34;</span><span>&gt;</span>)<span>&lt;/span&gt;</span> The <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/set&#34;</span> <span>title=</span><span>&#34;set&#34;</span><span>&gt;</span>set<span>&lt;/a&gt;</span> of all <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/point&#34;</span> <span>title=</span><span>&#34;point&#34;</span><span>&gt;</span>points<span>&lt;/a&gt;</span> whose <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/coordinate&#34;</span> <span>title=</span><span>&#34;coordinate&#34;</span><span>&gt;</span>coordinates<span>&lt;/a&gt;</span> <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/satisfy&#34;</span> <span>title=</span><span>&#34;satisfy&#34;</span><span>&gt;</span>satisfy<span>&lt;/a&gt;</span> a given <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/equation&#34;</span> <span>title=</span><span>&#34;equation&#34;</span><span>&gt;</span>equation<span>&lt;/a&gt;</span> or <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/condition&#34;</span> <span>title=</span><span>&#34;condition&#34;</span><span>&gt;</span>condition<span>&lt;/a&gt;</span>.
<span>&lt;dl&gt;&lt;dd&gt;&lt;div</span> <span>class=</span><span>&#34;h-usage-example&#34;</span><span>&gt;&lt;i</span> <span>class=</span><span>&#34;Latn mention e-example&#34;</span> <span>lang=</span><span>&#34;en&#34;</span><span>&gt;</span>A circle is the <span>&lt;b&gt;</span>locus<span>&lt;/b&gt;</span> of points from which the distance to the center is a given value, the radius.<span>&lt;/i&gt;&lt;/div&gt;&lt;/dd&gt;&lt;/dl&gt;&lt;/li&gt;</span>
<span>&lt;li&gt;&lt;span</span> <span>class=</span><span>&#34;ib-brac&#34;</span><span>&gt;</span>(<span>&lt;/span&gt;&lt;span</span> <span>class=</span><span>&#34;ib-content&#34;</span><span>&gt;&lt;a</span> <span>href=</span><span>&#34;/wiki/genetics&#34;</span> <span>title=</span><span>&#34;genetics&#34;</span><span>&gt;</span>genetics<span>&lt;/a&gt;&lt;/span&gt;&lt;span</span> <span>class=</span><span>&#34;ib-brac&#34;</span><span>&gt;</span>)<span>&lt;/span&gt;</span> A fixed <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/position&#34;</span> <span>title=</span><span>&#34;position&#34;</span><span>&gt;</span>position<span>&lt;/a&gt;</span> on a <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/chromosome&#34;</span> <span>title=</span><span>&#34;chromosome&#34;</span><span>&gt;</span>chromosome<span>&lt;/a&gt;</span> that may be occupied by one or more <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/genes&#34;</span> <span>title=</span><span>&#34;genes&#34;</span><span>&gt;</span>genes<span>&lt;/a&gt;</span>.<span>&lt;/li&gt;</span>
<span>&lt;li&gt;&lt;span</span> <span>class=</span><span>&#34;ib-brac&#34;</span><span>&gt;</span>(<span>&lt;/span&gt;&lt;span</span> <span>class=</span><span>&#34;ib-content&#34;</span><span>&gt;</span>chiefly<span>&amp;#32;</span>in the <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/Appendix:Glossary#plural&#34;</span> <span>title=</span><span>&#34;Appendix:Glossary&#34;</span><span>&gt;</span>plural<span>&lt;/a&gt;&lt;/span&gt;&lt;span</span> <span>class=</span><span>&#34;ib-brac&#34;</span><span>&gt;</span>)<span>&lt;/span&gt;</span> A <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/passage&#34;</span> <span>title=</span><span>&#34;passage&#34;</span><span>&gt;</span>passage<span>&lt;/a&gt;</span> in <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/writing&#34;</span> <span>title=</span><span>&#34;writing&#34;</span><span>&gt;</span>writing<span>&lt;/a&gt;</span>, especially in a <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/collection&#34;</span> <span>title=</span><span>&#34;collection&#34;</span><span>&gt;</span>collection<span>&lt;/a&gt;</span> of <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/ancient&#34;</span> <span>title=</span><span>&#34;ancient&#34;</span><span>&gt;</span>ancient<span>&lt;/a&gt;</span> <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/sacred&#34;</span> <span>title=</span><span>&#34;sacred&#34;</span><span>&gt;</span>sacred<span>&lt;/a&gt;</span> writings arranged according to a <span>&lt;a</span> <span>href=</span><span>&#34;/wiki/theme&#34;</span> <span>title=</span><span>&#34;theme&#34;</span><span>&gt;</span>theme<span>&lt;/a&gt;</span>.<span>&lt;/li&gt;&lt;/ol&gt;</span></code></pre></figure>

<p>Apparently the blank definition comes from an <strong>explicitly empty list item</strong>: <code>&lt;li class=&#34;mw-empty-elt&#34;&gt;&lt;/li&gt;</code>. I don’t know why Wiktionary includes that list item, and I don’t know how Firefox knows not to display it.</p>

<p><strong>It’s not obvious that it’s a <a href="https://lists.gnu.org/archive/html/bug-gnu-emacs/2022-11/msg02149.html">bug</a> to show the empty list item</strong>. I mean, it’s there, right? But still, it looks like an error, so I don’t want to see it. This will require <strong>modifying the browser’s behavior</strong>.</p>

<p>Fortunately, Emacs provides a mechanism to unobtrusively modify any behavior at all, namely <strong><a href="http://localhost:4000/2019/01/14/tetris.html">advice</a></strong>. In short, we will define a new function that will attach itself to an existing function and do some extra stuff.</p>

<p>This could be done in lots of different ways. My idea was to modify the list item handler <code>shr-tag-li</code>, a function of one argument:</p>

<figure><pre><code data-lang="emacs-lisp"><span>(</span><span>defun</span> <span>shr-tag-li</span> <span>(</span><span>dom</span><span>)</span> <span>...</span><span>)</span></code></pre></figure>

<p>We need to define a new function of two arguments to wrap this one. The two arguments will be the handler function and its argument, and the wrapping function will call the handler on its argument <strong>only when the list item is non-empty</strong>:</p>

<figure><pre><code data-lang="emacs-lisp"><span>(</span><span>defun</span> <span>skip-empty-li</span> <span>(</span><span>shrtagli</span> <span>dom</span><span>)</span>
  <span>(</span><span>when</span> <span>(</span><span>cddr</span> <span>dom</span><span>)</span>
    <span>(</span><span>funcall</span> <span>shrtagli</span> <span>dom</span><span>)))</span></code></pre></figure>

<p>The wrapper will be attached to the wrapped with <code>advice-add</code>:</p>

<figure><pre><code data-lang="emacs-lisp"><span>(</span><span>advice-add</span>
   <span>&#39;shr-tag-li</span> <span>:around</span>
   <span>#&#39;</span><span>skip-empty-li</span><span>)</span></code></pre></figure>

<p>And that’s it. <strong>This fixes the problem</strong>:</p>

<p><img src="https://greydanus.github.io/assets/wiktionary-advice/locus-eww-after.png" alt="img"/></p>

  </div>
</article>

      </div>
    </div></div>
  </body>
</html>
