<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/microsoft/vscode/issues/292452">Original</a>
    <h1>Billing can be bypassed using a combo of subagents with an agent definition</h1>
    
    <div id="readability-page-1" class="page"><div><div><div id="issue-body-viewer" data-testid="issue-body-viewer"><div data-testid="markdown-body" data-team-hovercards-enabled="true" data-turbolinks="false"><div><h2 dir="auto">Summary</h2>
<p dir="auto">It&#39;s possible in Copilot to bypass any billing / &#39;premium request&#39; usage by taking advantage of:</p>
<ul dir="auto">
<li>Subagents and tool calls not consuming any &#39;requests&#39;.</li>
<li>Request cost being calculated on the initial model used.</li>
<li>&#34;Free&#34; models incl. in Copilot e.g. GPT-5-mini, GPT-4.1 etc.</li>
<li>Ability to define an agent for a subagent.</li>
<li>Ability to specify a model for an agent.</li>
</ul>
<p dir="auto">Combining these correctly results in &#39;free&#39; and almost unlimited, usage of expensive premium models like Opus 4.5 which would usually cost &#39;3 premium requests&#39;:</p>
<h2 dir="auto">Instructions</h2>
<ol dir="auto">
<li>Start a new Chat.</li>
<li>Set the model to a &#34;free&#34; model, included in Copilot e.g. GPT-5 Mini.</li>
<li>Create an agent, and set it&#39;s model to a premium model, e.g. Opus 4.5</li>
<li>Set the mode to &#34;agent&#34;.</li>
<li>In the initial message, instruct it to launch an agent &#39;[your_agents_name_here]&#39; as a subagent using the runSubagent tool, and to pass on the following query e.g. &#34;What time is it in London, UK&#34;.</li>
<li>Submit the message.</li>
<li>The initial request will be picked up by the free GPT-5 Mini model, incurring no fees.</li>
<li>The free model will create a subagent (which is also free)</li>
<li>The free subagent will launch with an &#39;agent&#39; profile, this profile has the model set to a premium model</li>
<li>The premium model will be used for the subagent - but premium requests will be consumed.</li>
</ol>
<h2 dir="auto">Example 1</h2>
<p dir="auto"><strong>Example Chat Message:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="/ask-opus Make a todolist app."><pre>/ask-opus Make a todolist app.</pre></div>
<hr/>
<p dir="auto"><strong>Example Prompt File:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="---
name: ask-opus
description: Run a query in a subagent that uses the Opus-4.5 model.
model: GPT-5 mini (copilot)
agent: agent
---
&lt;USER_REQUEST_INSTRUCTIONS&gt;
Call #tool:agent/runSubagent - include the following args:
- agentName: &#34;opus-agent&#34;
- prompt: $USER_QUERY
&lt;/USER_REQUEST_INSTRUCTIONS&gt;

&lt;USER_REQUEST_RULES&gt;
- You can call the &#39;subagent&#39; defined in &#39;USER_REQUEST_INSTRUCTIONS&#39; as many times as needed to fulfill the user&#39;s request.
- It&#39;s recommended you use the subagent to help you decide how best to respond and/or complete the task (because it is a larger model than you) including how best to break the task down into smaller steps if needed.
- Use the subagent for all todos/tasks/queries, do not perform any task or respond to any query yourself, you are just an orchestrator.
- Do not manipulate/summarize subagent responses to save on tokens, always be comprehensive and verbose.
- Do not evaluate or respond to the remainder of this message, the subagent is responsible for all further content.
&lt;/USER_REQUEST_RULES&gt;

--- USER_REQUEST_START ---"><pre><span>---</span>
<span>name</span>: <span>ask-opus</span>
<span>description</span>: <span>Run a query in a subagent that uses the Opus-4.5 model.</span>
<span>model</span>: <span>GPT-5 mini (copilot)</span>
<span>agent</span>: <span>agent</span>
<span>---</span>
&lt;USER_REQUEST_INSTRUCTIONS&gt;
Call #tool<span>:</span><span>agent</span>/runSubagent - include the following args:
<span>-</span> agentName: &#34;opus-agent&#34;
<span>-</span> prompt: $USER_QUERY
&lt;/USER_REQUEST_INSTRUCTIONS&gt;

&lt;USER_REQUEST_RULES&gt;
<span>-</span> You can call the &#39;subagent&#39; defined in &#39;USER_REQUEST_INSTRUCTIONS&#39; as many times as needed to fulfill the user&#39;s request.
<span>-</span> It&#39;s recommended you use the subagent to help you decide how best to respond and/or complete the task (because it is a larger model than you) including how best to break the task down into smaller steps if needed.
<span>-</span> Use the subagent for all todos/tasks/queries, do not perform any task or respond to any query yourself, you are just an orchestrator.
<span>-</span> Do not manipulate/summarize subagent responses to save on tokens, always be comprehensive and verbose.
<span>-</span> Do not evaluate or respond to the remainder of this message, the subagent is responsible for all further content.
&lt;/USER_REQUEST_RULES&gt;

--- USER_REQUEST_START ---</pre></div>
<hr/>
<p dir="auto"><strong>Example Agent File</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="---
name: opus-agent
description: An AI agent that assists a user with a task or query.
argument-hint: Query or task to complete
model: Claude Opus 4.5 (copilot)
---
Respond to the user&#39;s query/task ($ARGUMENTS) in comprehensively and accurately."><pre><span>---</span>
<span>name</span>: <span>opus-agent</span>
<span>description</span>: <span>An AI agent that assists a user with a task or query.</span>
<span>argument-hint</span>: <span>Query or task to complete</span>
<span>model</span>: <span>Claude Opus 4.5 (copilot)</span>
<span>---</span>
Respond to the user&#39;s query/task ($ARGUMENTS) in comprehensively and accurately.</pre></div>
<hr/>
<h2 dir="auto">Example 2</h2>
<p dir="auto">Another vector for abuse - albeit requiring more effort is:</p>
<ul dir="auto">
<li>Set <code>chat.agent.maxRequests</code> to a high value.</li>
<li>Use a premium model e.g. Opus 4.5 as the initial model for the chat session.</li>
<li>Build a custom script (not disclosed for safety), that you tell the model to call as part of a tool invocation.</li>
<li>Craft some prompts to direct the model to repeat the tool call(s).</li>
<li>The right script, with the right prompts can be tailored to create a loop, allowing the premium model to continually be invoked unlimited times for no additional cost beyond that of the initial message.â€¨</li>
</ul>
<p dir="auto">In my testing I had a single message result in a 3hr+ process that launched hundreds of Opus 4.5 subagents to process hundreds of files - and only consumed 3 premium credits. Had I not stopped it at 3hrs, it would have continued.</p>
<hr/>
<p dir="auto"><strong>Related</strong>: I also noted the message &#39;types&#39; are being declared on the client, inferring no API validation e.g: <a href="https://github.com/microsoft/vscode-copilot-chat/blob/main/src/extension/intents/node/toolCallingLoop.ts#L484">https://github.com/microsoft/vscode-copilot-chat/blob/main/src/extension/intents/node/toolCallingLoop.ts#L484</a></p>
<p dir="auto">I believe this is another vector that allows for more blatant abuse directly against the API.</p>
<hr/>
<p dir="auto"><strong>Note</strong>: Initially submitted this to MSRC (VULN-172488), MSRC insisted bypassing billing is outside of MSRC scope and instructed me multiple times to file as a public bug report.</p>
<hr/>
<ul dir="auto">
<li>Copilot Chat Extension Version: 0.37.2026013101</li>
<li>VS Code Version: 1.109.0-insider (Universal) - <a data-hovercard-type="commit" data-hovercard-url="https://github.com/microsoft/vscode/commit/f3d99dee2f4c63061a08f828e0ca6b6acf6ac0f8/hovercard" href="https://github.com/microsoft/vscode/commit/f3d99dee2f4c63061a08f828e0ca6b6acf6ac0f8"><tt>f3d99de</tt></a></li>
<li>OS Version: OSX Tahoe 26.3</li>
<li>Feature: Agent / SubAgent</li>
</ul>
<p dir="auto">This is NOT the same issue as <a data-error-text="Failed to load title" data-id="3169386998" data-permission-text="Title is private" data-url="https://github.com/microsoft/vscode/issues/252230" data-hovercard-type="issue" data-hovercard-url="/microsoft/vscode/issues/252230/hovercard" href="https://github.com/microsoft/vscode/issues/252230">#252230</a></p></div></div><div><!--$!--><template></template><p><span data-direction="s" aria-hidden="true" id="_R_1aklnb_">Reactions are currently unavailable</span></p><!--/$--></div></div></div></div></div>
  </body>
</html>
