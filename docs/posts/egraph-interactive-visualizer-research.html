<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/saulshanabrook/saulshanabrook/discussions/34">Original</a>
    <h1>EGraph Interactive Visualizer Research</h1>
    
    <div id="readability-page-1" class="page"><div role="presentation" data-paste-markdown-skip="">
    <tbody data-target-translation-id="7060589" data-target-translation-type="discussion">
        <tr>
    <td>
        <p dir="auto">I am starting to work on an interactive e-graph visualizer because I believe I am hitting some constraints with the current graphviz rendering.</p>
<p dir="auto">For example, I am trying to debug why the computation for <a href="https://github.com/egraphs-good/egglog-python/blob/main/python/egglog/exp/array_api_loopnest.py">this e-graph</a> didn&#39;t fully complete as I imagined:</p>
<div dir="auto" data-snippet-clipboard-copy-content="&gt;&gt;&gt; egraph.extract(val.shape[0])
TupleInt.range(Int(4)).filter(lambda i: ~TupleInt.from_vec(Vec[Int](Int(0), Int(1))).contains(i)).map(lambda i: TupleInt.from_vec(Vec[Int](Int(3), Int(2), Int(3), Int(4)))[i])[
    Int(0)
]"><pre><span>&gt;&gt;</span><span>&gt;</span> <span>egraph</span>.<span>extract</span>(<span>val</span>.<span>shape</span>[<span>0</span>])
<span>TupleInt</span>.<span>range</span>(<span>Int</span>(<span>4</span>)).<span>filter</span>(<span>lambda</span> <span>i</span>: <span>~</span><span>TupleInt</span>.<span>from_vec</span>(<span>Vec</span>[<span>Int</span>](<span>Int</span>(<span>0</span>), <span>Int</span>(<span>1</span>))).<span>contains</span>(<span>i</span>)).<span>map</span>(<span>lambda</span> <span>i</span>: <span>TupleInt</span>.<span>from_vec</span>(<span>Vec</span>[<span>Int</span>](<span>Int</span>(<span>3</span>), <span>Int</span>(<span>2</span>), <span>Int</span>(<span>3</span>), <span>Int</span>(<span>4</span>)))[<span>i</span>])[
    <span>Int</span>(<span>0</span>)
]</pre></div>
<p dir="auto">Like where did the rewrites fall down so that this isn&#39;t simplified to a number?</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/1186124/358641797-29d7445d-bfb0-489d-8f4c-2e5ebd99ae14.svg?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjQyMzkwMjcsIm5iZiI6MTcyNDIzODcyNywicGF0aCI6Ii8xMTg2MTI0LzM1ODY0MTc5Ny0yOWQ3NDQ1ZC1iZmIwLTQ4OWQtOGY0Yy0yZTVlYmQ5OWFlMTQuc3ZnP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDgyMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA4MjFUMTExMjA3WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NDEzMjc5MjllNDA4ZTdlN2QxYmUyYjJlOWI4MDNhZTE1N2VhZDM1ZjBlMjNmZmQzNDI2N2E5ZjM1YWI2YzU0ZSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.vvnQB5kPuS1nB6R-ASBnHPZ2xQl2lU8a1UHaCnSClz4"><img src="https://private-user-images.githubusercontent.com/1186124/358641797-29d7445d-bfb0-489d-8f4c-2e5ebd99ae14.svg?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjQyMzkwMjcsIm5iZiI6MTcyNDIzODcyNywicGF0aCI6Ii8xMTg2MTI0LzM1ODY0MTc5Ny0yOWQ3NDQ1ZC1iZmIwLTQ4OWQtOGY0Yy0yZTVlYmQ5OWFlMTQuc3ZnP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDgyMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA4MjFUMTExMjA3WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NDEzMjc5MjllNDA4ZTdlN2QxYmUyYjJlOWI4MDNhZTE1N2VhZDM1ZjBlMjNmZmQzNDI2N2E5ZjM1YWI2YzU0ZSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.vvnQB5kPuS1nB6R-ASBnHPZ2xQl2lU8a1UHaCnSClz4" alt="output"/></a></p>
<p dir="auto">So I thought I would go and see if I could build an interactive visualizer, instead of using graphviz. I had built <a href="https://github.com/vega/editor/pull/1023" data-hovercard-type="pull_request" data-hovercard-url="/vega/editor/pull/1023/hovercard">something similar for the Vega editor</a>. So I know it&#39;s generally possible to build an interactive visualizer for large program graphs. I started looking at <a href="https://github.com/vega/editor/tree/master/src/features/dataflow">all the code I wrote for that feature</a>, and started to remember why it took so long... The combination of wrangling Cytoscape JS and Eclipse Layout Kernel ended up being quite a bit more work than one might imagine... Syncing all the state, doing things like pre-computing the expected size of each node based on the text layout so that it could assist in layout etc.</p>
<p dir="auto">So I wanted to see, maybe there is an existing system that would work for me?</p>
<p dir="auto">My requirements:</p>
<ul dir="auto">
<li>Uses <a href="https://eclipse.dev/elk/" rel="nofollow">Eclipse Layout Kernel</a>&#39;s <a href="https://eclipse.dev/elk/reference/algorithms/org-eclipse-elk-layered.html" rel="nofollow">layered layout</a>. I have found this to work well for large numbers of nodes... It supports compound nodes and and just does a better layout than anything else I could find</li>
<li>Supports compound nodes, so we can have e-classes and e-nodes inside of them.</li>
<li>Supports &#34;ports&#34; meaning so that we have edges come from different parts of the node, corresponding to the different args to a function. ELK will take this into account to minimize crossing.</li>
<li>Vaguely performant enough so we can visualize graphs with at least 1000k nodes.</li>
</ul>
<p dir="auto">Starting to look at <a href="https://github.com/kieler/elkjs/network/dependents?dependent_type=PACKAGE">all the packages that depend on elkjs</a>, I found a few that have some stars:</p>
<ul dir="auto">
<li><a href="https://mermaid.js.org/" rel="nofollow">Mermaid</a> - no supports for ports <span><svg title="Open" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"></path><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"></path></svg><a data-error-text="Failed to load title" data-id="1279942161" data-permission-text="Title is private" data-url="https://github.com/mermaid-js/mermaid/issues/3169" data-hovercard-type="issue" data-hovercard-url="/mermaid-js/mermaid/issues/3169/hovercard" href="https://github.com/mermaid-js/mermaid/issues/3169">Facilitate node &#34;ports&#34;  by positional labels or sub graph<span>Â mermaid-js/mermaid#3169</span></a></span></li>
<li><a href="https://github.com/winglang/wing">Wing</a> - used for viz for bespoke programming editor - not general purpose</li>
<li><a href="https://github.com/f5/unovis">unovis</a> - &#34;is a modular data visualization framework for React, Angular, Svelte, Vue, and vanilla TypeScript or JavaScript&#34; - no support for ports</li>
<li><a href="https://github.com/galaxyproject/galaxy">galaxy</a> some kind of science infrastructure - not general purpose</li>
<li><a href="https://github.com/reaviz/reaflow">Reaflow</a> - Seems to <a href="https://reaflow.dev/?path=/story/demos-layouts--custom-options" rel="nofollow">work with elk and custom ports</a></li>
<li><a href="https://github.com/eclipse-sprotty/sprotty">Sprotty</a> - official ELKjs visualizer... Could work? I remember last time it was a little confusing how to use this without a Java backend</li>
<li><a href="https://github.com/cytoscape/cytoscape.js-elk">Cytoscape JS ELK</a> - official cytoscape ELKjs layout engine. I remember there were a few things missing here last time I used it so ended up re-implementing it.</li>
<li>React Flow - Has no built in ELK integration but <a href="https://reactflow.dev/learn/layouting/layouting#elkjs" rel="nofollow">comes with a demo using it for layout</a></li>
</ul>
<p dir="auto">So I think for now, I will tryout reaflow and see if it doesnt&#39;t work with large graphs?</p>
    </td>
  </tr>

    </tbody>
  </div></div>
  </body>
</html>
