<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://avi.im/blag/2023/internet-mvcc/">Original</a>
    <h1>Internet is wholesome: MVCC edition</h1>
    
    <div id="readability-page-1" class="page"><article><p>This is a short story about how I hit a wall while implementing a database research paper, found a publication error and how people on the internet helped me.</p><p>The paper is Hekaton MVCC - <a href="https://vldb.org/pvldb/vol5/p298_per-akelarson_vldb2012.pdf">High-Performance Concurrency Control Mechanisms for Main-Memory Databases</a>. Scroll down to the bottom if you are interested in knowing the errata.</p><h2 id="timeline">Timeline</h2><ul><li><code>$whoami</code> I am a backend developer, and databases excite me! I dream of being a database developer one day. I have an educational side project called <a href="https://github.com/avinassh/py-caskdb">CaskDB</a> which aims to teach how to build a key-value store. I always look forward to adding new database features, as it allows me to learn new things.</li><li>[Apr 7] Pekka Enberg <a href="https://twitter.com/penberg/status/1644221651293204480">tweeted</a> about the <a href="https://vldb.org/pvldb/vol5/p298_per-akelarson_vldb2012.pdf">Hekaton MVCC paper</a>. This research paper was new to me, and I found it approachable. CaskDB does not have transactions yet, so this gave me a great learning opportunity to implement it.</li><li>[Apr 8] Pekka started implementing the paper in Rust and <a href="https://twitter.com/penberg/status/1644676555942109185">tweeted</a> about it. It became easy for me to follow the paper with the code. I also started working on my <a href="https://github.com/avinassh/mvcc-go">Go implementation</a>.</li><li>I am a massive fan of Andy and have watched the videos from his course <a href="https://15721.courses.cs.cmu.edu/spring2023/">CMU Advanced Database Systems</a>. I started rewatching the <a href="https://www.youtube.com/watch?v=9EY0vYFNWxY">Hekaton lectures</a>. The lecture series is excellent; go check it out!</li><li>Reading the paper was straightforward, but when I began thinking about code, I noticed gaps in my understanding. Code is fun; that’s when you see the unexpected challenges and nuances.</li><li>[Apr 9] I started working through the paper’s <code>Version Visibility</code> section. This part explains an ongoing transaction’s effect on a row’s visibility. It addresses the questions like transaction <code>tx1</code> updated a row; can <code>tx2</code> see it? Some of the ideas around row visibility didn’t make sense.</li><li>I went back to the paper and reread it several times now. I thought maybe I had missed something from the earlier sections. I took a pencil and paper and started drawing all possible flows. I did it multiple times, but in vain.</li><li>For a moment, I started wondering if the paper could have errors. But this is a famous paper, and I couldn’t find any errata online. I was uncertain whether I had misunderstood the paper or if it was flawed.</li><li>I started asking in Slack / Discord / Zulip groups. People were helpful, but the answers were related to general MVCC, not particular to the Hekaton MVCC. I explained the paper to one of my friends and asked if he saw any issues. Nothing helped!
<img src="https://avi.im/blag/images/2023/hekaton-rc.png" alt=""/></li><li>[Apr 12] I emailed one of the authors, Professor Spyros Blanas, with zero hopes of hearing anything back.</li><li>[Apr 13] I woke up to the Professor’s reply, and they acknowledged that there was indeed a typo in the paper! What a blissful morning! Not only was he kind enough to reply, but he also gave me a high-level idea of how things should be.</li><li>From one of the groups, <a href="https://transactional.blog">Alex Miller</a> saw my message. It turns out he is friends with another author Cristian, and they discussed my issue. He agreed that one of the tables needed to be corrected. My morning just got better!</li><li>I was surprised to learn even popular research papers can have typos.</li><li>[Apr 14] I discussed the issue with Pekka. I filed <a href="https://github.com/penberg/mvcc-rs/issues/15">an issue</a> and submitted <a href="https://github.com/penberg/mvcc-rs/pull/16">a patch</a>.</li><li>Tx Commit.</li></ul><p>I was humbled by the responses I received, given that I didn’t expect much as just some random person on the internet. It was heartwarming to see that people were willing to take the time to help me out.</p><p>A little kindness goes a long way.</p><h2 id="errata">Errata</h2><p>I have written another detailed blog post <a href="https://avi.im/blag/2023/hekaton-paper-typo/">here</a> so search engines can pick up and help someone in the future. The paper contains two tables, which decide the row visibility during a transaction. One of the tables, <code>Table 2</code>, has a typo:</p><p><img src="https://avi.im/blag/images/2023/hekaton-table-2.png" alt=""/></p><p>According to the above rules, a committed row becomes invisible for new transactions. The fix is simple:</p><blockquote><p>V is visible only if TE is not T</p></blockquote><p>Check the <a href="https://avi.im/blag/2023/hekaton-paper-typo/">errata</a> blog post to read the error’s implications and the fix in detail.</p><p><small><i>Thanks to Bhargav, Hari, Satan, Saad, Sumesh, Piyush, and Gautam for reading a draft of this.</i></small></p></article></div>
  </body>
</html>
