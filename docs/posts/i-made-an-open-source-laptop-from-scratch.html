<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.byran.ee/posts/creation/">Original</a>
    <h1>Show HN: I made an open-source laptop from scratch</h1>
    
    <div id="readability-page-1" class="page"><article> 
<blockquote>
<p>I do not think there is any thrill that can go through the human heart like that felt by the inventor as he sees some creation of the brain unfolding to success
– <a href="https://en.wikipedia.org/wiki/Nikola_Tesla" target="_blank">Nikola Tesla</a></p>
</blockquote>
<p><strong>It’s got a 4K AMOLED display, a Cherry MX mechanical keyboard, plays Minecraft at 4K, runs +7B LLMs, surfs the web, and has ~7h battery life. All open-source.</strong></p>
<h2 id="video">Video</h2>
<p><a href="https://youtu.be/fks3PBodyiE" target="_blank"><img src="https://www.byran.ee/img/thumbnail.jpg"/></a></p>
<p><em>How I Made A Laptop From Scratch (YouTube.com). Demo at 22:14.</em></p>
<p><strong>The writeup below pretty much abridges the video above.</strong></p>
<p><em><a href="https://www.byran.ee/progress">See the progression updates from the development journey here.</a></em></p>
<p>Imagine a skill-chart of qualities of technology: screen, audio, performance, build, tactility, touch-interaction, efficiency, size, and so many more. At the balancing point of all these qualities is the laptop. To that end, let’s build a laptop that hits as many qualities of a modern commercial thin &amp; light laptop—while trying to do as much from scratch as possible.</p>
<img src="https://www.byran.ee/img/photo.jpg"/>
<p><em>Booting and inserting magnetically attached keyboard</em></p>
<img src="https://www.byran.ee/img/minecraft.jpg"/>
<p><em>Epic Hypixel Bedwars gaming</em></p>
<h2 id="finding-an-electron-in-a-cloud">Finding an electron in a cloud</h2>
<p>I first made a mental map and transferred it into Obsidian:</p>
<p><img src="https://www.byran.ee/img/map.png"/></p>
<p>Boiling it down, it landed me with a lofty list of goals:</p>
<ul>
<li><a href="https://www.rock-chips.com/uploads/pdf/2022.8.26/192/RK3588%20Brief%20Datasheet.pdf" target="_blank">RK3588</a> SoC Motherboard
<ul>
<li><a href="https://wiki.friendlyelec.com/wiki/index.php/CM3588" target="_blank">CM3588</a>-based</li>
<li>USB-C USB3.1 Gen 1</li>
<li>PCIe Wi-Fi/BT + SSD</li>
</ul>
</li>
<li>Powertrain
<ul>
<li><a href="https://www.espressif.com/sites/default/files/documentation/esp32-s3-mini-1_mini-1u_datasheet_en.pdf" target="_blank">ESP32-S3</a> embedded controller</li>
<li>~60Wh Li-ion battery pack</li>
</ul>
</li>
<li>Peripherals
<ul>
<li>Wireless mechanical keyboard</li>
<li>Glass-topped multi-touch trackpad</li>
</ul>
</li>
<li>4K AMOLED 13.3” display</li>
<li>Anodized aluminum CNC chassis</li>
</ul>
<p><img src="https://www.byran.ee/img/general.jpg"/></p>
<p><em>General system overview</em></p>
<h2 id="fermionic-analysis">Fermionic Analysis</h2>
<h3 id="choosing-the-chip">Choosing <em>the</em> chip</h3>
<p>I looked towards single-board computer SoCs, as board manufacturers commonly release schematics for reference. In many aspects, the Rockchip RK3588 is the fastest consumer-procurable chip on the market. Despite the spotty software support, the hardware documentation has lots of developer resources and <a href="https://wiki.friendlyelec.com/wiki/images/1/15/CM3588_NAS_SDK_2309_SCH.PDF" target="_blank">reference schematics</a> from SBC manufacturers.</p>
<p>Some quick specs:</p>
<ul>
<li>Quad core A76 and quad core A55</li>
<li>Mali-G10 GPU</li>
<li>6TOPs NPU</li>
<li>8K@60FPS decoder</li>
<li>I/O: 8K display, dual USB3.1, PCIe 3.0 x 4, HDMI2.1/eDP 1.4, etc.</li>
</ul>
<p>With only a few months to work on this project, an SoM (system on module) like the Raspberry Pi CM5 presented the best option for its hardware compatibility and a high likelihood of a snug integration. Choosing an SoM also alleviates memory and other high-speed signaling concerns. Looking around for a RK3588 SoM, I came across the CM3588 by FriendlyElec. Cheap, well-documented, and easily procurable. Sounds good!</p>
<img src="https://www.byran.ee/img/cm3588.jpg"/>
<p><em>FriendlyElec CM3588 SoM</em></p>
<h3 id="display">Display</h3>
<p>I hopped on <a href="https://www.panelook.com" target="_blank">panelook.com</a> and filtered by size and resolution. I’ve always been a sucker for high pixel density, so I went with a 4K AMOLED 13.3” display. Cross referencing stock availability on Taobao (Chinese domestic Aliexpress), the <a href="https://www.panelook.com/ATNA33TP11_Samsung_13.3_OLED_parameter_59424.html" target="_blank">ATNA33TP11</a> seemed to be the one with most <em>brand-new</em> stock since OLED risked burn-in.</p>
<p>A highlight: during display evaluation, switching out a connector and shortening the board by 2mm improved signal integrity <em>just enough</em> for the 1.5GHz x 4 signals go pass through. Getting the display running on Linux meant finding system logs from Asus laptops that have this display, reverse-engineering the values, and tuning the power-on timings amongst other things <em>just right</em>. TLDR; getting a 4K AMOLED eDP display running on non-mainline Linux was a heck of a journey, so read <a href="">this if you’re interested</a> (coming soon).</p>
<img src="https://www.byran.ee/img/screen.jpg"/>
<p><em>ATNA33TP11 working with display evaluation board V2 short</em></p>
<h3 id="powertrain">Powertrain</h3>
<p>The cells had to be 6mm thin and four packs lined up should take roughly half of the entire chassis volume. Chinese manufacturers don’t stock batteries readily, and shipping them to the US would be a pain. Thus, I looked on the American side. I stumbled upon with <a href="https://www.batteryspace.com/polymerli-ionmodule37v4250mah157wh85arate-prewiredwithpcbpl5467100.aspx" target="_blank">these batteries</a> from AA Portable Power Corp. or batteryspace.com. or Powerizer. Doing the power calculations, we get: 4.250Ah <em>3.7V</em> 4S = 62.9 Wh with max 8A (so max 134.4W discharge)! Solid.</p>
<p>The total voltage is 4.2V (peak) * 4S = 16.8V. The system’s designed for up to 20V USB-C (AKA 100W) and passed into the <a href="https://www.ti.com/product/BQ25713" target="_blank">BQ25713</a> charging IC. The batteries are balanced with the <a href="https://www.ti.com/product/BQ77915" target="_blank">BQ77915</a> to ensure safe charging, and the power is tracked with an <a href="https://www.analog.com/en/products/ltc2943.html" target="_blank">LTC2943</a> to calculate a state-of-charge percentage. I popped in an ESP32-S3 module as the controller for everything, and set it to production.</p>
<p>After writing drivers and sitting on the undecipherable datasheets for days, I had the batteries charging. I successfully <a href="https://a.co/d/3b8R9mN" target="_blank">load tested</a> it to around 5A and powered the full system. There’s still a lot of quiescent current (about ~50mA), but I haven’t had the time to optimize the firmware.</p>
<p>The USB of the ESP32 connects to the internal USB on the motherboard to feed the power telemetry over UART. A Python script and kernel module in the OS forwards it to the battery service in the kernel to display it natively.</p>
<img src="https://www.byran.ee/img/powertrain.jpg"/>
<p><em>Powertrain V0.2 inside laptop</em></p>

<p>In settings, tick “Align controls with KiCad” for mouse pan/zoom/scroll</p>
<p><a href="https://kicanvas.org/?github=https%3A%2F%2Fgithub.com%2FHello9999901%2Flaptop%2Ftree%2Fmain%2Fpower" target="_blank">Powertrain V0.2 KiCanvas Full Link</a></p>
<h3 id="mainboard">Mainboard</h3>
<p>With those decisions made up, I aimed for &gt;90mm motherboard width based on a prelim CAD from the batteries and display dimensions.</p>
<p>On the physical I/O side, I settled on dual USB3.1 Type-C ports, a USB2.0 Type-A port, a headphone jack, and a microSD card slot. Internally, the M.2 E-key connects to an <a href="https://a.co/d/4lJDnwX" target="_blank">RTL8852BE</a> WiFi 6 (802.11ax) + BT5.2 wireless card and the M.2 M-key accommodates up to an 2242-sized NVMe SSD. A full size NVMe SSD can fit with some modifications of the chassis too.</p>
<p>Tangent over, this leaves me with around ~90mm of board height. Implementing all the features on the final mainboard would stretch this writeup too long, so read <a href="">this if you’re interested</a> (coming soon).</p>

<p>In settings, tick “Align controls with KiCad” for mouse pan/zoom/scroll</p>
<p><a href="https://kicanvas.org/?github=https%3A%2F%2Fgithub.com%2FHello9999901%2Flaptop%2Ftree%2Fmain%2Fmotherboard" target="_blank">Motherboard V1.0 KiCanvas Full Link</a></p>
<img src="https://www.byran.ee/img/mainboard.jpg"/>
<p><em>Mainboard B-roll shot</em></p>
<p><img src="https://www.byran.ee/img/hardware.jpg"/></p>
<p><em>Detailed hardware overview</em></p>
<h3 id="operating-on-a-system">Operating on a System</h3>
<p><a href="https://github.com/Joshua-Riek/ubuntu-rockchip" target="_blank">Joshua Riek’s ubuntu-rockchip</a> kernel/distro combined an out-of-the-box experience with lots of optimizations. Using Armbian’s kernel (I believe it’s still off Rockchip’s kernel) meant that it offered nearly all the features of the RK3588 on a developer-ready kernel configuration.</p>
<p>Since nearly all the work I needed to do was abstracted in the DeviceTree (DTS) hardware configuration language implemented with U-boot, the bootloader, I took advantage of their system-agnostic nature to speed up my trial-and-error process having never done any Linux work.</p>
<p>Instead of developing and compiling code on the RK3588 itself, I used my daily driver MacBook and Visual Studio Code. Once I made a change in the DTS, I’d use Orbstack (virtualization software) running Ubuntu 24.04 (shared filesystem and kernel with macOS) and compile the DeviceTree there.</p>
<pre tabindex="0" data-language="txt"><code><span><span>DTSI, DTS, and DTS Overlay Files (some for SoC, some for other ICs, etc.) -&gt; dtcpp binary (preprocessing &amp; linking various DeviceTree definitions) -&gt; dtc binary (DeviceTree compilation) -&gt; anyon_e.dtb (compiled DeviceTree binary!)</span></span></code></pre>
<p>Pointing U-Boot to a custom compiled DTB (devicetree binary), I <code>scp</code>’ed the compiled <code>anyon_e.dtb</code> to the OS. A <code>u-boot-update</code> regenerates the bootloader configurations, and a reboot updates the changes.</p>
<p>That’s how I did the hardware bringup—display configurations, PCIe, USB, and other low-level system tweaks. The rest is just a standard install of Ubuntu 24.04 LTS with Linux Kernel 6.1.</p>
<img src="https://www.byran.ee/img/working.jpg"/>
<p><em>Testing batteries and writing DTS</em></p>
<p><img src="https://www.byran.ee/img/software.jpg"/></p>
<p><em>In-depth software overview</em></p>
<h3 id="peripherals">Peripherals</h3>
<p>Imagine being able to just pull out your laptop’s keyboard and use it as just another wireless keyboard for literally anything! Just me? Maybe.</p>
<p>Being a mechanical keyboard addict with quite a few <a href="https://zmk.dev" target="_blank">ZMK keyboards</a> designed, I chose the <a href="https://github.com/pashutk/Cherry_MX_ULP" target="_blank">Cherry MX ULP mechanical switches</a> for the best feel. Of course, a battery and fully mechanical switches add <em>a lot</em> of height. I used a 1mm thin <a href="https://www.powerstream.com/thin-lithium-ion.htm" target="_blank">200mAh battery</a> and a custom battery protection board that sticks up between two rows of keys to cut down on ~1.6mm (PCB height). The nRF52840 SoC running ZMK Firmware is right underneath the spacebar. A sandwich of PLA and 6061 aluminum from Fabworks crammed everything under ~7mm.</p>
<p>Since the keycaps aren’t easily procurable, I got a <a href="https://www.printedsolid.com/products/e3d-revo-nozzles?srsltid=AfmBOopKMJDs7gFpzrJg3kHQ-aJLDFTjeFO0ZJAYf1hADzy5iurNlkLB" target="_blank">0.15mm nozzle</a> for my Bambu Lab X1C and printed them with PLA. It got me down a rabbit hole of tungsten nozzles, and I got quoted ~$400 for 20x 0.15mm nozzles. I’ve been thinking of trying that out too. But alas, printing out all the keycaps and assembling for the last time, the keyboard was done.</p>
<p>Moving on to the trackpad, it was quite quick. I knew from the start that I wanted a good trackpad, so making my own with zero capacitive tracking experience is a no-go. Searching online, I came across the Azoteq <a href="https://www.mouser.com/ProductDetail/Azoteq/PXM0057-401-S?qs=t7xnP681wgVkp9ZZYy6TPA%3D%3D" target="_blank">PXM0057-401</a> evaluation module on Mouser. It had it all—glass surface, multi-touch, and worked over USB. And, it was only 35 bucks or so. However, the trackpad has ceased production without many alternatives.</p>
<p>With the keyboard and trackpad working, it was time to put on the finishing touches.</p>

<p>In settings, tick “Align controls with KiCad” for mouse pan/zoom/scroll</p>
<p><a href="https://kicanvas.org/?github=https%3A%2F%2Fgithub.com%2FHello9999901%2Flaptop%2Ftree%2Fmain%2Fkeyboard" target="_blank">Keyboard V1.0 KiCanvas Full Link</a></p>
<img src="https://www.byran.ee/img/peripherals.jpg"/>
<p>*Counterclockwise from top left: keyboard side profile, typing on keyboard, trackpad, 1mm battery on back, nRF52840 SoC area</p>
<p><img src="https://www.byran.ee/img/wireframe_exploded.jpg"/></p>
<p><em>OnShape wireframe exploded view</em></p>
<h3 id="mechanical">Mechanical</h3>
<p>Roughly the same time I began the system design, I sent a few CNC aluminum blocks off to JLC for evaluation with different anodization finishes. The dark gray anodization felt “best”, but I preferred the look of the matte black, so I settled on that.
Using PTC OnShape, I (attempted) CAD’ed a robust and minimalistic look and a blend of my two favorite laptop lineup designs, the Razer Blade and the MacBook Pro. Because of the removable keyboard, the bottom has no screws. Instead, the palm rest screws into the bottom chassis. <a href="https://cad.onshape.com/documents/a18bb6df7dbba66df24a7ec8/w/967d921e60c207e3b6f5cf7b/e/1f78a9387b17c2d178742295?renderMode=0&amp;uiState=678da20d5bee0d1ad2dd55f1" target="_blank">CAD Link here.</a></p>
<p>The hardest part about the chassis was the hinge. I used <a href="https://frame.work/products/display-hinge-kit?v=FRANFB0001" target="_blank">Framework’s 13.3” hinge</a> because it has a 3D model. I constrained it in OnShape so I can see the exact closing angles.</p>
<p>The chassis layout is fairly simple: batteries on the bottom, the power board on the right, motherboard on the left, and the hinge mechanism on top. Oh, and a transparent PETG FDM printed power button that lights up on a custom PCB. To balance out the asymmetric hinge (caused by the mainboard being too wide), a little <a href="https://www.mcmaster.com/2153T11/" target="_blank">carbon fiber rod</a> lines up on the left side too.</p>
<img src="https://www.byran.ee/img/chassis_empty.jpg"/>
<p><em>Chassis test fitting</em></p>
<p>It was a battle to get the screen assembly to not hit anything while also covering
Although I started considering thermals way in advance, hence the gap here for the heatpipe to go through, I still had difficulty fitting everything in. The distance between the bottom of the keyboard and the top of the heatsink is less than a half a millimeter. The cooling system is really constrained because I don’t have the resources to make a custom heatpipe and fin solution. So, I made a full copper CNC heatsink (from JLCCNC) and a heatpipe connected to a fan. It’s all connected with <a href="https://www.lttstore.com/products/ptm7950-phase-change-thermal-pad" target="_blank">PTM7950</a>.</p>
<p>I also added <a href="https://puiaudio.com/product/speakers-and-receivers/as04004mo-sp40" target="_blank">these</a> PUI audio speakers on either side. The audio from the CM3588’s DAC didn’t work and I ran out of debugging time, so I made a USB to audio converter board separately and shot it through an Class-D amplifier. I would’ve also made the amp, but I ran out of time.</p>
<p>As I reached final assembly, I used a mix of JLC’s selective laser sintering (SLS) of nylon powder and FDM printed PA6-CF for smaller structural parts. Putting it all together with the matte black CNC aluminum chassis, I finally had my laptop.</p>
<img src="https://www.byran.ee/img/inside.jpg"/>
<p><em>Inside full laptop assembly</em></p>
<h2 id="reflection">Reflection</h2>
<p>The hardest class I’ve taken so far was quantum mechanics in my junior spring term. A few months before spending hours solving time-independent and dependent Schrödinger equations, I was on the squash bus (the sport, not the vegetable). My friend suggested I make a laptop for my senior project—and that was all.
I came up with the name anyon_e in June, after I finished the quantum course.</p>
<p>Making this laptop was hard. Mentally pressured with a deadline, and a constant inter-disciplinary challenge across electrical, software, and mechanical systems. Summing up everything I’ve ever done. It took up most of my mind from May until now.</p>
<p>Inspired by open-source projects like <a href="https://zmk.dev" target="_blank">ZMK</a>, <a href="https://www.kicad.org" target="_blank">KiCAD</a>, <a href="https://www.blender.org" target="_blank">Blender</a>, and countless <a href="https://certification.oshwa.org/basics.html" target="_blank">OSHW</a> projects, I want to do my own little part. To put power in people’s hands in creation, innovation, imagination, or whatever else. To attempt the impossible.</p>
<img src="https://www.byran.ee/img/conclusion.jpg"/>
<p>Sincerely,</p> </article></div>
  </body>
</html>
