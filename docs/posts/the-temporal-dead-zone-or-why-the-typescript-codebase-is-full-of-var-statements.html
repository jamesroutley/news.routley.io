<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://vincentrolfs.dev/blog/ts-var">Original</a>
    <h1>The Temporal Dead Zone, or why the TypeScript codebase is full of var statements</h1>
    
    <div id="readability-page-1" class="page"><div>
<h2>The Temporal Dead Zone, or why the TypeScript codebase is littered with var statements</h2>
<p>
  October 1, 2025
  <span id="viewcount"></span>
</p>





<p>
  If you have been working with JavaScript for a while, you probably know there
  are a couple of different ways to initialize a variable. Nowadays we usually
  use
</p>
<pre><code><span>const</span> password <span>=</span> <span>&#34;hunter2&#34;</span></code></pre>
<p>and only occasionally, if you need some mutable state:</p>
<pre><code><span>let</span> password <span>=</span> <span>&#34;hunter2&#34;</span></code></pre>
<p>
  These declarations have been around for a while and they have reasonable block
  scoping rules:
</p>
<pre><code><span>function</span> <span>example</span><span>(</span><span>measurement</span><span>)</span> <span>{</span>
  console<span>.</span><span>log</span><span>(</span>calculation<span>)</span><span>;</span> 
  console<span>.</span><span>log</span><span>(</span>anotherCalc<span>)</span><span>;</span> 

  <span>if</span> <span>(</span>measurement <span>&gt;</span> <span>1</span><span>)</span> <span>{</span>
    <span>const</span> calculation <span>=</span> measurement <span>+</span> <span>1</span><span>;</span>
    <span>let</span> anotherCalc <span>=</span> measurement <span>*</span> <span>2</span><span>;</span>
    
  <span>}</span> <span>else</span> <span>{</span>
    
  <span>}</span>

  console<span>.</span><span>log</span><span>(</span>calculation<span>)</span><span>;</span> 
  console<span>.</span><span>log</span><span>(</span>anotherCalc<span>)</span><span>;</span> 
<span>}</span>
</code></pre>
<p>
  But if you have been working with JS for a <strong>really</strong> long while,
  you might remember the time when neither of these declarations were possible.
  All we had was <code>var</code>. And <code>var</code> stinks. Not only is
  every variable mutable, with no way to enforce immutability, but to make
  matters worse, <code>var</code> leaks beyond block scope:
</p>
<pre><code><span>function</span> <span>example</span><span>(</span><span>measurement</span><span>)</span> <span>{</span>
  console<span>.</span><span>log</span><span>(</span>calculation<span>)</span><span>;</span> 
  console<span>.</span><span>log</span><span>(</span>i<span>)</span><span>;</span> 

  <span>if</span> <span>(</span>measurement <span>&gt;</span> <span>1</span><span>)</span> <span>{</span>
    <span>var</span> calculation <span>=</span> measurement <span>+</span> <span>1</span><span>;</span>
    
  <span>}</span> <span>else</span> <span>{</span>
    
  <span>}</span>

  console<span>.</span><span>log</span><span>(</span>calculation<span>)</span><span>;</span> 

  <span>for</span> <span>(</span><span>var</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> <span>3</span><span>;</span> i<span>++</span><span>)</span> <span>{</span>
    
  <span>}</span>

  console<span>.</span><span>log</span><span>(</span>i<span>)</span><span>;</span> 
<span>}</span>
</code></pre>
<p>Terrible!</p>
<p>
  So it was a big surprise to me to find out that the TypeScript codebase (which
  is itself written in TypeScript â€” <a href="https://devblogs.microsoft.com/typescript/typescript-native-port/" target="_blank" rel="noopener noreferrer">
  for now
</a>) is <a href="https://github.com/microsoft/TypeScript/blob/968d5deb8b5fd4af3ce85433872bdefc1eb17f10/src/compiler/scanner.ts#L1033" target="_blank" rel="noopener noreferrer">
  littered with var statements like it&#39;s 2003
</a>:
</p>
<pre><code>
<span>export</span> <span>function</span> <span>createSourceMapGenerator</span><span>(</span>
  host<span>:</span> EmitHost<span>,</span>
  file<span>:</span> <span>string</span><span>,</span>
  sourceRoot<span>:</span> <span>string</span><span>,</span>
  sourcesDirectoryPath<span>:</span> <span>string</span><span>,</span>
  generatorOptions<span>:</span> SourceMapGeneratorOptions
<span>)</span><span>:</span> SourceMapGenerator <span>{</span>
  
  <span>var</span> <span>{</span> enter<span>,</span> exit <span>}</span> <span>=</span> generatorOptions<span>.</span>extendedDiagnostics
    <span>?</span> performance<span>.</span><span>createTimer</span><span>(</span><span>&#34;Source Map&#34;</span><span>,</span> <span>&#34;beforeSourcemap&#34;</span><span>,</span> <span>&#34;afterSourcemap&#34;</span><span>)</span>
    <span>:</span> performance<span>.</span>nullTimer<span>;</span>

  
  <span>var</span> rawSources<span>:</span> <span>string</span><span>[</span><span>]</span> <span>=</span> <span>[</span><span>]</span><span>;</span>
  <span>var</span> sources<span>:</span> <span>string</span><span>[</span><span>]</span> <span>=</span> <span>[</span><span>]</span><span>;</span>
  <span>var</span> sourceToSourceIndexMap <span>=</span> <span>new</span> <span>Map<span>&lt;</span><span>string</span><span>,</span> <span>number</span><span>&gt;</span></span><span>(</span><span>)</span><span>;</span>
  <span>var</span> sourcesContent<span>:</span> <span>(</span><span>string</span> <span>|</span> <span>null</span><span>)</span><span>[</span><span>]</span> <span>|</span> <span>undefined</span><span>;</span> 

  <span>var</span> names<span>:</span> <span>string</span><span>[</span><span>]</span> <span>=</span> <span>[</span><span>]</span><span>;</span>
  <span>var</span> nameToNameIndexMap<span>:</span> Map<span>&lt;</span><span>string</span><span>,</span> <span>number</span><span>&gt;</span> <span>|</span> <span>undefined</span><span>;</span>
  <span>var</span> mappingCharCodes<span>:</span> <span>number</span><span>[</span><span>]</span> <span>=</span> <span>[</span><span>]</span><span>;</span>
  <span>var</span> mappings <span>=</span> <span>&#34;&#34;</span><span>;</span>

  
  <span>var</span> lastGeneratedLine <span>=</span> <span>0</span><span>;</span>
  <span>var</span> lastGeneratedCharacter <span>=</span> <span>0</span><span>;</span>
  <span>var</span> lastSourceIndex <span>=</span> <span>0</span><span>;</span>
  <span>var</span> lastSourceLine <span>=</span> <span>0</span><span>;</span>
  <span>var</span> lastSourceCharacter <span>=</span> <span>0</span><span>;</span>
  <span>var</span> lastNameIndex <span>=</span> <span>0</span><span>;</span>
  <span>var</span> hasLast <span>=</span> <span>false</span><span>;</span>

  
<span>}</span>
</code></pre>
<p>
  The reason has to do with what is called the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let#temporal_dead_zone_tdz" target="_blank" rel="noopener noreferrer">
  Temporal Dead
  Zone (TDZ)
</a>. For each variable in your code, there is a zone where the variable is
  declared but not initialized. The following example makes this clear:
</p>
<pre><code><span>function</span> <span>example</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> result <span>=</span> Math<span>.</span><span>random</span><span>(</span><span>)</span> <span>&lt;</span> <span>0.5</span> <span>?</span> <span>useX</span><span>(</span><span>)</span> <span>:</span> <span>1</span><span>;</span> 
  <span>const</span> x <span>=</span> <span>10</span><span>;</span>

  <span>return</span> result<span>;</span>

  <span>function</span> <span>useX</span><span>(</span><span>)</span> <span>{</span>
    <span>return</span> x<span>;</span>
  <span>}</span>
<span>}</span>
</code></pre>
<p>
  In the above example, it is totally valid to declare <code>useX</code> at the
  bottom of the function. The trouble comes when you call it before
  <code>x</code> has been initialized - in other words, when the interpreter is
  still in the TDZ of <code>x</code>. The interpreter refuses to let you access
  <code>x</code> and throws an error.
</p>
<p>
  And that is great! Because if you would use <code>var</code> instead of
  <code>const</code> in this example, there would be no error and the function
  would simply return undefined!
</p>
<pre><code><span>function</span> <span>example</span><span>(</span><span>)</span> <span>{</span>
  <span>var</span> result <span>=</span> <span>useX</span><span>(</span><span>)</span><span>;</span> 
  <span>var</span> x <span>=</span> <span>10</span><span>;</span>

  <span>return</span> result<span>;</span> 

  <span>function</span> <span>useX</span><span>(</span><span>)</span> <span>{</span>
    <span>return</span> x<span>;</span>
  <span>}</span>
<span>}</span>

console<span>.</span><span>log</span><span>(</span><span>example</span><span>(</span><span>)</span><span>)</span><span>;</span> 
</code></pre>
<p>Terrible!</p>
<p>
  So the TDZ is actually a super useful feature brought on by
  <code>const</code> and <code>let</code>. So why doesn&#39;t TypeScript want to use
  it? It&#39;s because <em>Performance</em>.
</p>
<p>
  Figuring out whether it is in a variable&#39;s TDZ is a lot of work for the
  interpreter. As you can see above, it cannot be done statically, but depends
  on nondeterministic runtime behavior. That brings a penalty which was
  significant for the TypeScript codebase. After migrating a decent amount of
  their statements to <code>var</code>, <a href="https://github.com/microsoft/TypeScript/issues/52924" target="_blank" rel="noopener noreferrer">
  they saw an 8%
  performance improvement across some benchmarks
</a>.
</p>
<p>
  I for one am very happy that I don&#39;t have to use <code>var</code> anymore. And
  for TypeScript, I&#39;m sure it&#39;s just another reason to <a href="https://devblogs.microsoft.com/typescript/typescript-native-port/" target="_blank" rel="noopener noreferrer">
  migrate their codebase to Go
</a>.
</p>




<p>Discuss this article on <a href="https://www.reddit.com/r/typescript/comments/1nw0cmg/the_temporal_dead_zone_or_why_the_typescript/" target="_blank" rel="noopener">Reddit</a>.</p>

<p>
  Feel free to email me at
  <a href="mailto:mail@vincentrolfs.dev">mail@vincentrolfs.dev</a>. Or you can
  follow me on Mastodon at
  <a href="https://hachyderm.io/@vincentrolfs" target="_blank" rel="noopener">@vincentrolfs@hachyderm.io</a>.
</p>
</div></div>
  </body>
</html>
