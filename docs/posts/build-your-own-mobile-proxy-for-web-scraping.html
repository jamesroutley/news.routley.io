<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://scrapingfish.com/blog/byo-mobile-proxy-for-web-scraping">Original</a>
    <h1>Build Your Own Mobile Proxy for Web Scraping</h1>
    
    <div id="readability-page-1" class="page"><div id="post-content" itemprop="articleBody"><p><img alt="Build Your Own Mobile Proxy for Web Scraping" src="https://d33wubrfki0l68.cloudfront.net/ccc24c4dbfdcc3839346fe49d8ee68b71a2cedf8/8bea5/assets/images/splash-b3595fce33af626d5f885c967c813f4d.jpg" width="2596" height="1576"/></p><p>In this guide, we show how you can build your own mobile proxy pool step by step.
The most common use case for mobile proxies is web scraping.
If you have low success rate and keep getting blocked by websites you want to scrape, this guide is for you.</p><div><p><h5><span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></p><div><p>This guide is only applicable for a small, home-scale mobile proxy setup and does not cover some advanced intricacies of running mobile proxies, recovery from various modem failures, rotating proxies, etc.</p><p>If you need access to a reliable production-grade mobile proxy pool for web scraping, consider using our <a href="https://scrapingfish.com" target="_blank" rel="noopener noreferrer">product</a>.</p></div></div><h2 id="what-is-a-mobile-proxy">What is a mobile proxy<a href="#what-is-a-mobile-proxy" title="Direct link to heading">​</a></h2><p>One of the most important factors affecting success rate of web scraping is proxy quality.
There are three main types of proxies:</p><ul><li>Datacenter: offer large pool of cheap IP addresses belonging to datacenters and cloud server providers that are often blacklisted and usually not suitable for web scraping</li><li>Residential: provide IP addresses from Internet Service Providers (ISP) pool that are shared with other users</li><li><strong>Mobile</strong>: the best class of proxies for web scraping that is based on ephemeral IP addresses which are frequently exchanged with mobile network users who move between Base Transceiver Stations (BTS)</li></ul><p>Mobile proxies are the most expensive ones, but it can pay off to build your own pool by following this guide.
We will show you how to change the IP address on demand so that you can generate thousands of IP addresses daily.</p><h2 id="hardware">Hardware<a href="#hardware" title="Direct link to heading">​</a></h2><p>Let&#39;s start with the hardware and tools which you&#39;re going to need.</p><ol><li>Raspberry Pi for hosting the proxy service.</li><li>nanoSD memory card for Raspberry Pi OS and SD card adapter for installation.</li><li>A computer with SD card slot to install Raspberry Pi OS on nanoSD card and USB-A port to initialize 4G USB modem.</li><li>An Ethernet cable to connect Raspberry Pi to a local network.</li><li>A 4G USB modem with a SIM card.</li><li>Optionally, USB hub if you want to connect more than 2 dongles.</li></ol><h2 id="raspberry-pi">Raspberry Pi<a href="#raspberry-pi" title="Direct link to heading">​</a></h2><p>In the first step, you have to set up Raspberry Pi.
Install <a href="https://www.raspberrypi.com/software/" target="_blank" rel="noopener noreferrer">Raspberry Pi Imager</a> on your computer and insert the SD card.
Using Raspberry Pi Imager, set operating system to Raspberry Pi OS (32-bit) and select your SD card as storage.
Then, in the advanced options window (gear icon), make sure you enabled SSH with password authentication and set up an account username and password.</p><p><img alt="Raspberry Pi installation" src="https://d33wubrfki0l68.cloudfront.net/e47d1886bdb4dd54942fdf2e82d8d9dbf012a89f/0c419/assets/images/rpi-install-628228311353698357783c25c451ea1c.png" width="1488" height="984"/></p><p>Click &#34;Write&#34; to install the OS on selected storage.
Once the process is done, eject the card and insert it into the Raspberry Pi.
Plug in Ethernet and power cables into the Raspberry Pi and wait until it starts.
Find Raspberry Pi address in your local network (e.g. in your router admin panel).
For me, it was <code>192.168.0.10</code>.
Now, verify that you are able to ssh into it from your computer using the account from system installation step: <code>ssh pi:192.168.0.10</code>.</p><h2 id="4g-usb-modem">4G USB modem<a href="#4g-usb-modem" title="Direct link to heading">​</a></h2><p>You can use any USB modem that works in your region.
We recommend Huawei modems with HiLink interface (e.g. <a href="https://consumer.huawei.com/en/routers/e3372/" target="_blank" rel="noopener noreferrer">4G Dongle E3372</a>) because there is an open source API to interact with them that will let you change the IP on demand: <a href="https://pypi.org/project/huawei-lte-api/" target="_blank" rel="noopener noreferrer">huawei-lte-api</a>.</p><p>Insert a SIM card with active Internet plan into the modem and plug it in to your computer.
Wait for the modem to start up, find the network and open HiLink interface in the browser.
You will be prompted to accept ToS, choose update schedule and provide the PIN code for your SIM card.</p><p>Once you are done with this set-up, go to the DHCP section in Advanced setting and set modem IP to a unique value to distinguish it from other connected modems.
If you want to build a proxy with only one modem, you can skip this step.</p><p>Connect the modem to the Raspberry Pi and, after it&#39;s initialized, verify that you can see a network interface corresponding to your modem IP address set during configuration in the output of <code>ifconfig</code> command.</p><h2 id="proxy">Proxy<a href="#proxy" title="Direct link to heading">​</a></h2><h3 id="installation">Installation<a href="#installation" title="Direct link to heading">​</a></h3><p>For running the proxy service, you&#39;re going to use <a href="https://github.com/3proxy/3proxy" target="_blank" rel="noopener noreferrer">3proxy - tiny free proxy server</a>.
Login to the Raspberry Pi and download 3proxy Debian package:</p><div><div><pre tabindex="0"><code><span><span>wget</span><span> https://github.com/3proxy/3proxy/releases/download/0.9.4/3proxy-0.9.4.arm.deb</span><br/></span></code></pre></div></div><div><p><h5><span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></p><p>If you want to run the proxy service on a different device or operating system, you have to choose appropriate binaries/package from <a href="https://github.com/3proxy/3proxy/releases/tag/0.9.4" target="_blank" rel="noopener noreferrer">the release assets</a>.</p></div><p>Now, install downloaded package: <code>sudo dpkg -i 3proxy-0.9.4.arm.deb</code>.
Once it&#39;s finished, create admin user:</p><div><div><pre tabindex="0"><code><span><span>sudo</span><span> </span><span>echo</span><span> admin:</span><span>`</span><span>mycrypt </span><span>$RANDOM</span><span> </span><span>&lt;</span><span>YOUR_ADMIN_PASSWORD</span><span>&gt;</span><span>`</span><span> </span><span>|</span><span> </span><span>sudo</span><span> </span><span>tee</span><span> --append /usr/local/3proxy/conf/passwd </span><span>&gt;</span><span> /dev/null</span><br/></span></code></pre></div></div><h3 id="filesystem-set-up">Filesystem set-up<a href="#filesystem-set-up" title="Direct link to heading">​</a></h3><p>First, you have to set up some folders and files with appropriate permissions for proxy user.
Create a placeholder for 3proxy configuration file and folder for logs:</p><div><div><pre tabindex="0"><code><span><span>sudo</span><span> </span><span>mkdir</span><span> -p /usr/local/3proxy/conf</span><br/></span><span><span></span><span>sudo</span><span> </span><span>chown</span><span> </span><span>13</span><span>:13 /usr/local/3proxy/conf</span><br/></span><span><span></span><span>sudo</span><span> </span><span>touch</span><span> /usr/local/3proxy/conf/3proxy.cfg</span><br/></span><span><span></span><span>sudo</span><span> </span><span>chmod</span><span> </span><span>660</span><span> /usr/local/3proxy/conf/3proxy.cfg</span><br/></span><span><span></span><span>sudo</span><span> </span><span>mkdir</span><span> -p /usr/local/3proxy/logs</span><br/></span><span><span></span><span>sudo</span><span> </span><span>chown</span><span> </span><span>13</span><span>:13 /usr/local/3proxy/logs</span><br/></span></code></pre></div></div><h3 id="routing">Routing<a href="#routing" title="Direct link to heading">​</a></h3><p>To configure routing for modems, append route table entries for them in <code>/etc/iproute2/rt_tables</code> file.
For each modem you have, add <code>{i} gateway{i}</code> line, where <code>{i}</code> is the modem number.
For example, if you want to use 2 modems:</p><div><p><h5><span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></p><p>Do not change reserved values in the <code>rt_tables</code> file. Append route tables at the end of the file as local entries.</p></div><p>Now, you can configure IP routing rules for each modem.
For that, you need to know modems&#39;:</p><ul><li>interface name</li><li>IP address</li><li>network</li><li>gateway</li></ul><p>You can get this information from the output of <code>ifconfig</code> command.
In my case, for one example modem, it shows:</p><div><div><pre tabindex="0"><code><span><span>eth1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br/></span><span><span>        inet 192.168.8.101  netmask 255.255.255.0  broadcast 192.168.8.255</span><br/></span><span><span>        ...</span><br/></span></code></pre></div></div><p>This translates to the following values:</p><ul><li>interface name: <code>eth1</code></li><li>IP address: <code>192.168.8.101</code></li><li>network: <code>192.168.8.0/24</code></li><li>gateway: <code>192.168.8.1</code></li></ul><p>For the network, replace the last byte in the IP address with <code>0/24</code> mask, i.e. <code>192.168.8.101</code> <!-- -->→<!-- --> <code>192.168.8.0/24</code>, and for the gateway set it to <code>1</code>: <code>192.168.8.101</code> <!-- -->→<!-- --> <code>192.168.8.1</code>.</p><p>To configure IP routing, execute the following commands for each modem:</p><div><div><pre tabindex="0"><code><span><span>sudo ip route replace {{ network }} dev {{ name }} src {{ ip }} table gateway{{ index }}</span><br/></span><span><span>sudo ip route replace default via {{ gateway }} dev {{ i.name }} table gateway{{ index }}</span><br/></span><span><span>sudo ip rule add from {{ ip }}/32 table gateway{{ index }}</span><br/></span><span><span>sudo ip rule add to {{ ip }}/32 table gateway{{ index }}</span><br/></span></code></pre></div></div><p>For the example modem above with IP <code>192.168.8.101</code> it will be:</p><div><div><pre tabindex="0"><code><span><span>sudo</span><span> </span><span>ip</span><span> route replace </span><span>192.168</span><span>.8.0/24 dev eth1 src </span><span>192.168</span><span>.8.101 table gateway1</span><br/></span><span><span></span><span>sudo</span><span> </span><span>ip</span><span> route replace default via </span><span>192.168</span><span>.8.1 dev eth1 table gateway1</span><br/></span><span><span></span><span>sudo</span><span> </span><span>ip</span><span> rule </span><span>add</span><span> from </span><span>192.168</span><span>.8.101/32 table gateway1</span><br/></span><span><span></span><span>sudo</span><span> </span><span>ip</span><span> rule </span><span>add</span><span> to </span><span>192.168</span><span>.8.101/32 table gateway1</span><br/></span></code></pre></div></div><h3 id="3proxy-configuration">3proxy configuration<a href="#3proxy-configuration" title="Direct link to heading">​</a></h3><p>To start 3proxy service, you have to provide a configuration file.
You&#39;ve already initialized a placeholder <code>/usr/local/3proxy/conf/3proxy.cfg</code> with correct permissions, and now you can fill it with the following content:</p><div><div><pre tabindex="0"><code><span><span>#! /usr/local/bin/3proxy</span><br/></span><span><span>daemon</span><br/></span><span><span></span><br/></span><span><span>config /usr/local/3proxy/conf/3proxy.cfg</span><br/></span><span><span></span><br/></span><span><span># logging</span><br/></span><span><span>log /usr/local/3proxy/logs/3proxy-%y%m%d.log D</span><br/></span><span><span>rotate 60</span><br/></span><span><span></span><br/></span><span><span># users passwd file</span><br/></span><span><span>users $/usr/local/3proxy/conf/passwd</span><br/></span><span><span></span><br/></span><span><span># proxy user and group ids</span><br/></span><span><span>setgid 13</span><br/></span><span><span>setuid 13</span><br/></span><span><span></span><br/></span><span><span>auth iponly strong</span><br/></span><span><span></span><br/></span><span><span># allow proxy access for local network</span><br/></span><span><span>allow * 192.168.0.0/24</span><br/></span><span><span># assign weights (probabilities) to modems by their IP address</span><br/></span><span><span>parent 500 extip 192.168.8.101 0</span><br/></span><span><span>parent 500 extip 192.168.9.101 0</span><br/></span><span><span></span><br/></span><span><span># run proxy on port 2000</span><br/></span><span><span>proxy -a -p2000</span><br/></span><span><span></span><br/></span><span><span>flush</span><br/></span><span><span></span><br/></span><span><span># allow admin panel access to the admin user on port 8080</span><br/></span><span><span>allow admin</span><br/></span><span><span>admin -p8080</span><br/></span></code></pre></div></div><p>You will have to adjust parents for your set-up.
Each parent corresponds to a single modem which is connected to the Raspberry Pi and has configured routing.
Parents&#39; weights must sum up to 1000.
An example configuration for a set-up with 4 modems could be:</p><div><div><pre tabindex="0"><code><span><span>parent 100 extip 192.168.6.101 0</span><br/></span><span><span>parent 200 extip 192.168.7.101 0</span><br/></span><span><span>parent 300 extip 192.168.8.101 0</span><br/></span><span><span>parent 400 extip 192.168.9.101 0</span><br/></span></code></pre></div></div><p>You can read more about 3proxy configuration options in the package <a href="https://3proxy.ru/doc/man3/3proxy.cfg.3.html" target="_blank" rel="noopener noreferrer">documentation</a>.</p><h3 id="test">Test<a href="#test" title="Direct link to heading">​</a></h3><p>If your configuration is valid, you will be able to start proxy with the following command:</p><div><div><pre tabindex="0"><code><span><span>sudo</span><span> 3proxy /usr/local/3proxy/conf/3proxy.cfg</span><br/></span></code></pre></div></div><p>To verify that your proxy works, make a request to <code>https://eth0.me</code> using curl to check your external IP address:</p><div><div><pre tabindex="0"><code><span><span>curl</span><span> --proxy </span><span>192.168</span><span>.0.10:2000 https://eth0.me</span><br/></span></code></pre></div></div><p>Try it a few times and, if you have multiple modems connected, you should get different IP addresses with probability according to parent set-up in 3proxy configuration file.</p><p>To stop proxy, simply kill the <code>3proxy</code> process:</p><div><div><pre tabindex="0"><code><span><span>sudo</span><span> </span><span>kill</span><span> -9 </span><span>`</span><span>pidof 3proxy</span><span>`</span><br/></span></code></pre></div></div><h2 id="change-ip">Change IP<a href="#change-ip" title="Direct link to heading">​</a></h2><p>The best part about mobile proxy is that it lets you change the IP address on demand.
This is a superpower in web scraping world.
The easiest and fastest way to change the IP address is to change the network setting.
It should take just a few seconds to get the new IP address assigned.</p><p>If you&#39;re using a modem with HiLink interface, you can use <a href="https://pypi.org/project/huawei-lte-api/" target="_blank" rel="noopener noreferrer">huawei-lte-api</a> python package to interact with it.
First, install the package: <code>python -m pip install huawei-lte-api</code>.
Then, create <code>main.py</code> file with the following content:</p><div><div><pre tabindex="0"><code><span><span>import</span><span> time</span><br/></span><span><span></span><br/></span><span><span></span><span>from</span><span> huawei_lte_api</span><span>.</span><span>Client </span><span>import</span><span> Client</span><br/></span><span><span></span><span>from</span><span> huawei_lte_api</span><span>.</span><span>Connection </span><span>import</span><span> Connection</span><br/></span><span><span></span><span>from</span><span> huawei_lte_api</span><span>.</span><span>enums</span><span>.</span><span>net </span><span>import</span><span> LTEBandEnum</span><span>,</span><span> NetworkBandEnum</span><span>,</span><span> NetworkModeEnum</span><br/></span><span><span></span><br/></span><span><span></span><br/></span><span><span></span><span>def</span><span> </span><span>main</span><span>(</span><span>gateway</span><span>:</span><span> </span><span>str</span><span>,</span><span> timeout</span><span>:</span><span> </span><span>float</span><span> </span><span>=</span><span> </span><span>5.0</span><span>)</span><span>:</span><span></span><br/></span><span><span>    </span><span>print</span><span>(</span><span>f&#34;Connecting to </span><span>{</span><span>gateway</span><span>}</span><span>&#34;</span><span>)</span><span></span><br/></span><span><span>    </span><span>with</span><span> Connection</span><span>(</span><span>url</span><span>=</span><span>f&#34;http://</span><span>{</span><span>gateway</span><span>}</span><span>/&#34;</span><span>,</span><span> timeout</span><span>=</span><span>timeout</span><span>)</span><span> </span><span>as</span><span> connection</span><span>:</span><span></span><br/></span><span><span>        lte_client </span><span>=</span><span> Client</span><span>(</span><span>connection</span><span>)</span><span></span><br/></span><span><span>        </span><span>print</span><span>(</span><span>&#34;Resetting network...&#34;</span><span>)</span><span></span><br/></span><span><span>        net_mode_response </span><span>=</span><span> lte_client</span><span>.</span><span>net</span><span>.</span><span>net_mode</span><span>(</span><span>)</span><span></span><br/></span><span><span>        net_mode </span><span>=</span><span> net_mode_response</span><span>.</span><span>get</span><span>(</span><span></span><br/></span><span><span>            </span><span>&#34;NetworkMode&#34;</span><span>,</span><span> NetworkModeEnum</span><span>.</span><span>MODE_4G_3G_AUTO</span><span>.</span><span>value</span><br/></span><span><span>        </span><span>)</span><span></span><br/></span><span><span>        new_net_mode </span><span>=</span><span> </span><span>(</span><span></span><br/></span><span><span>            NetworkModeEnum</span><span>.</span><span>MODE_4G_ONLY</span><br/></span><span><span>            </span><span>if</span><span> </span><span>not</span><span> net_mode </span><span>==</span><span> NetworkModeEnum</span><span>.</span><span>MODE_4G_ONLY</span><span>.</span><span>value</span><br/></span><span><span>            </span><span>else</span><span> NetworkModeEnum</span><span>.</span><span>MODE_4G_3G_AUTO</span><br/></span><span><span>        </span><span>)</span><span></span><br/></span><span><span>        time</span><span>.</span><span>sleep</span><span>(</span><span>0.1</span><span>)</span><span></span><br/></span><span><span>        lte_client</span><span>.</span><span>net</span><span>.</span><span>set_net_mode</span><span>(</span><span></span><br/></span><span><span>            lteband</span><span>=</span><span>LTEBandEnum</span><span>.</span><span>ALL</span><span>,</span><span></span><br/></span><span><span>            networkband</span><span>=</span><span>NetworkBandEnum</span><span>.</span><span>ALL</span><span>,</span><span></span><br/></span><span><span>            networkmode</span><span>=</span><span>new_net_mode</span><span>,</span><span></span><br/></span><span><span>        </span><span>)</span><span></span><br/></span><span><span>        time</span><span>.</span><span>sleep</span><span>(</span><span>3.0</span><span>)</span><span></span><br/></span><span><span>        </span><span>print</span><span>(</span><span>&#34;Done&#34;</span><span>)</span><span></span><br/></span><span><span></span><br/></span><span><span></span><br/></span><span><span></span><span>if</span><span> __name__ </span><span>==</span><span> </span><span>&#34;__main__&#34;</span><span>:</span><span></span><br/></span><span><span>    </span><span>import</span><span> argparse</span><br/></span><span><span></span><br/></span><span><span>    parser </span><span>=</span><span> argparse</span><span>.</span><span>ArgumentParser</span><span>(</span><span></span><br/></span><span><span>        description</span><span>=</span><span>&#34;Reset IP address of a 4G modem with HiLink interface&#34;</span><span></span><br/></span><span><span>    </span><span>)</span><span></span><br/></span><span><span>    parser</span><span>.</span><span>add_argument</span><span>(</span><span></span><br/></span><span><span>        </span><span>&#34;--gateway&#34;</span><span>,</span><span> </span><span>type</span><span>=</span><span>str</span><span>,</span><span> required</span><span>=</span><span>True</span><span>,</span><span> </span><span>help</span><span>=</span><span>&#34;modem gateway address&#34;</span><span></span><br/></span><span><span>    </span><span>)</span><span></span><br/></span><span><span>    parser</span><span>.</span><span>add_argument</span><span>(</span><span></span><br/></span><span><span>        </span><span>&#34;--timeout&#34;</span><span>,</span><span></span><br/></span><span><span>        </span><span>type</span><span>=</span><span>float</span><span>,</span><span></span><br/></span><span><span>        required</span><span>=</span><span>False</span><span>,</span><span></span><br/></span><span><span>        default</span><span>=</span><span>5.0</span><span>,</span><span></span><br/></span><span><span>        </span><span>help</span><span>=</span><span>&#34;modem connection timeout in seconds (default=5.0)&#34;</span><span>,</span><span></span><br/></span><span><span>    </span><span>)</span><span></span><br/></span><span><span>    args </span><span>=</span><span> parser</span><span>.</span><span>parse_args</span><span>(</span><span>)</span><span></span><br/></span><span><span>    main</span><span>(</span><span>gateway</span><span>=</span><span>args</span><span>.</span><span>gateway</span><span>,</span><span> timeout</span><span>=</span><span>args</span><span>.</span><span>timeout</span><span>)</span><br/></span></code></pre></div></div><details data-collapsed="true"><summary>Code explanation</summary><div><div><p>IP change happens in the <code>main</code> function.
First, we connect to the modem using a client from <code>huawei_lte_api</code> package:</p><div><div><pre tabindex="0"><code><span><span>with</span><span> Connection</span><span>(</span><span>url</span><span>=</span><span>f&#34;http://</span><span>{</span><span>gateway</span><span>}</span><span>/&#34;</span><span>,</span><span> timeout</span><span>=</span><span>timeout</span><span>)</span><span> </span><span>as</span><span> connection</span><span>:</span><span></span><br/></span><span><span>    lte_client </span><span>=</span><span> Client</span><span>(</span><span>connection</span><span>)</span><br/></span></code></pre></div></div><p>Then, we use it to get the current network mode and, based on that, we infer the new one to change for:</p><div><div><pre tabindex="0"><code><span><span>net_mode_response </span><span>=</span><span> lte_client</span><span>.</span><span>net</span><span>.</span><span>net_mode</span><span>(</span><span>)</span><span></span><br/></span><span><span>net_mode </span><span>=</span><span> net_mode_response</span><span>.</span><span>get</span><span>(</span><span></span><br/></span><span><span>    </span><span>&#34;NetworkMode&#34;</span><span>,</span><span> NetworkModeEnum</span><span>.</span><span>MODE_4G_3G_AUTO</span><span>.</span><span>value</span><br/></span><span><span></span><span>)</span><span></span><br/></span><span><span>new_net_mode </span><span>=</span><span> </span><span>(</span><span></span><br/></span><span><span>    NetworkModeEnum</span><span>.</span><span>MODE_4G_ONLY</span><br/></span><span><span>    </span><span>if</span><span> </span><span>not</span><span> net_mode </span><span>==</span><span> NetworkModeEnum</span><span>.</span><span>MODE_4G_ONLY</span><span>.</span><span>value</span><br/></span><span><span>    </span><span>else</span><span> NetworkModeEnum</span><span>.</span><span>MODE_4G_3G_AUTO</span><br/></span><span><span></span><span>)</span><br/></span></code></pre></div></div><p>After we set the new network mode, we have to wait at least a couple of seconds before the modem is ready to accept new connections:</p><div><div><pre tabindex="0"><code><span><span>lte_client</span><span>.</span><span>net</span><span>.</span><span>set_net_mode</span><span>(</span><span></span><br/></span><span><span>    lteband</span><span>=</span><span>LTEBandEnum</span><span>.</span><span>ALL</span><span>,</span><span></span><br/></span><span><span>    networkband</span><span>=</span><span>NetworkBandEnum</span><span>.</span><span>ALL</span><span>,</span><span></span><br/></span><span><span>    networkmode</span><span>=</span><span>new_net_mode</span><span>,</span><span></span><br/></span><span><span></span><span>)</span><span></span><br/></span><span><span>time</span><span>.</span><span>sleep</span><span>(</span><span>3.0</span><span>)</span><br/></span></code></pre></div></div></div></div></details><p>Now, to change the IP address for a modem with IP <code>192.168.8.101</code>, simply run:</p><div><div><pre tabindex="0"><code><span><span>python main.py --gateway </span><span>192.168</span><span>.8.1</span><br/></span></code></pre></div></div><p>To verify that it worked, check the external IP address for modem network interface (in my case, it&#39;s <code>eth1</code>):</p><div><div><pre tabindex="0"><code><span><span>curl</span><span> --interface eth1 https://eth0.me</span><br/></span></code></pre></div></div><h2 id="web-scraping-use-case">Web scraping use case<a href="#web-scraping-use-case" title="Direct link to heading">​</a></h2><p>Congratulations, at this point, you have your own web scraping infrastructure with mobile proxy that lets you change the IP address on demand every time you get blocked.
Your web scraping workflow could be to scrape the desired website until you detect that you got blocked, then change the IP address and continue scraping.</p><h2 id="limitations">Limitations<a href="#limitations" title="Direct link to heading">​</a></h2><p>Using Raspberry Pi, you are limited to around a dozen of modems if you have a USB hub with its own power supply.
With more than that, you are likely to run into various software and hardware issues.</p><p>For more advanced web scraping use cases, mobile proxy alone does not make it possible to scrape websites that have sophisticated bot detection mechanisms.
You often need headless browsers, JavaScript rendering, and other solutions that let you peacefully sleep at night while your web scraping job is running.</p><h2 id="scraping-fish-api">Scraping Fish API<a href="#scraping-fish-api" title="Direct link to heading">​</a></h2><p>To avoid all the hassles related to large scale web scraping and maintenance of a mobile proxy pool, <a href="https://scrapingfish.com" target="_blank" rel="noopener noreferrer">try Scraping Fish</a>.
Get access to our production grade mobile proxy, cluster of headless browsers and all the <a href="https://scrapingfish.com/docs/intro" target="_blank" rel="noopener noreferrer">API features</a> for just $2.</p><p>If you enjoyed this content, consider <a href="https://twitter.com/ScrapingF" target="_blank" rel="noopener noreferrer">following us on Twitter</a> for more!</p></div></div>
  </body>
</html>
