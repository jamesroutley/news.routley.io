<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://forum.hackliberty.org/t/why-we-abandoned-matrix-the-dark-truth-about-user-security-and-safety/224">Original</a>
    <h1>We Abandoned Matrix: The Dark Truth About User Security and Safety (2024)</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="text">
              
<p>Anyone that agrees to our <a href="https://git.hackliberty.org/hackliberty.org/hackliberty.org-legal/src/branch/main/code-of-conduct.md">Code of Conduct</a> is welcome to join our Simplex <a href="https://simplex.chat/contact#/?v=2-5&amp;smp=smp%3A%2F%2FPQUV2eL0t7OStZOoAsPEV2QYWt4-xilbakvGUGOItUo%3D%40smp6.simplex.im%2Fm_GjmB7OCRlv9un-75clOjChzWiT3AZX%23%2F%3Fv%3D1-2%26dh%3DMCowBQYDK2VuAyEAHC830iH16xdofGIOxTS46_BGX-lrfHQqhLaEb680Ygs%253D%26srv%3Dbylepyau3ty4czmn77q4fglvperknl4bi2eb2fdy2bh4jxtf32kf73yd.onion&amp;data=%7B%22type%22%3A%22group%22%2C%22groupLinkId%22%3A%22G-5UKmDf5uIs08KTY-Tf8g%3D%3D%22%7D">Hack Liberty Community Room</a> and our <a href="https://simplex.hackliberty.org">Simplex server</a>, a decentralized, metadata resistant alternative to Matrix! Incognito profiles welcome!</p>
<ul>
<li>
<p><strong>Hack Liberty SMP Server</strong></p>
<ul>
<li><code>smp://esPsfRFGZd2TRyKijJDorCMo3Ld-QD8Cq8ASx8qrY_Q=@simplex.hackliberty.org,gstc5w42xawazcr4txrcyhitmkhiyu2vkkwy2xhwovbhlapzrccjeyad.onion</code></li>
</ul>
</li>
<li>
<p><strong>Hack Liberty XFTP Server</strong></p>
<ul>
<li><code>xftp://DfK0yVcc9P5NgfaRR4retNWDDTKFa9g_NqF11maM87Q=@xftp.hackliberty.org,kf25i7slt6skypu47j5kzl4s4nlt3aw3baiocanygf6gprrrbft4dyqd.onion:5233</code></li>
</ul>
</li>
<li>
<p><strong>Hack Liberty Community Room</strong></p>
</li>
</ul>

<p>The appeal of federation lies in its potential to empower individuals, groups, and communities by enabling the use of open-source software and facilitating decentralized interactions across servers. This model offers a degree of censorship resistance, as the messages or images are replicated across multiple servers, making it difficult for any single entity to censor or control the content.</p>
<p>However, after over two years of administrating public federated services (Matrix, Lemmy), I’ve learned first hand the fundamental problems associated with the design of all federated protocols.</p>

<h2><a name="p-1003-metadata-leakage-4" href="#p-1003-metadata-leakage-4"></a><strong>Metadata Leakage</strong></h2>
<p><em>From <a href="https://web.archive.org/web/20210202175947/https://serpentsec.1337.cx/matrix">serpentsec.1337.cx/matrix</a>:</em></p>
<blockquote>
<p>Federated networks are naturally more vulnerable to metadata leaks than P2P or centralized networks. These leaks can be fixed, at the expense of increased complexity of the protocol (thus making it more vulnerable to faulty implementations). Matrix’s failure to prevent these leaks is necessary for proper functioning of the protocol.</p>
<p>Some metadata must be leaked due to features Matrix provides. For example, Matrix’s message verification requires knowing which user and device sent a message (to know which key to verify with). In other cases (such as global profile pictures and nicknames), the information is considered public anyway, and therefore has no need to be encrypted. Matrix’s failure to prevent these leaks is a triviality.</p>
<p>Some metadata leaks are accepted for performance requirements. For example, message reactions and read receipts might not be encrypted because Matrix’s E2EE is slower than normal (non-E2EE) messaging. Encrypting reactions and read receipts could provide a painful user experience (UX). Matrix’s failure to prevent these leaks is a design feature.</p>
<p>Some metadata leaks are simply a matter of the protocol’s failure to consider them. For example, room-specific nicknames, room-specific profile pictures, and message edit events could all be encrypted without breaking the protocol. Matrix’s failure to prevent these leaks is a design flaw.</p>
<p>Matrix’s E2EE does not, however, encrypt everything. The following information is not encrypted:</p>
<ul>
<li>Message senders are never encrypted</li>
<li>Due to Matrix’s design, encrypting session/device IDs would break verification</li>
<li>It’s impossible to prevent timestamps from leaking, since the server can simply note when an event is received anyway</li>
<li>Join/leave/invite and other room events are never encrypted</li>
<li>While contents are not leaked, an attacker can know when messages are edited</li>
<li>Reactions are never encrypted</li>
<li>Read receipts are never encrypted</li>
<li>Nicknames are never encrypted</li>
<li>Profile pictures are never encrypted</li>
</ul>
</blockquote>
<blockquote>
<p>To demonstrate some examples of these leaks, I have made some examples available: <a href="https://web.archive.org/web/20210202175947/https://snippets.serpentsec.1337.cx/matrix-metadata-leaks">https://snippets.serpentsec.1337.cx/matrix-metadata-leaks</a></p>
</blockquote>
<h2><a name="p-1003-admin-in-the-middle-5" href="#p-1003-admin-in-the-middle-5"></a><strong>Admin in the Middle</strong></h2>
<p><em>From <a href="https://blog.erethon.com/blog/2022/07/13/what-a-malicious-matrix-homeserver-admin-can-do/">What a malicious matrix homeserver admin can do</a></em>:</p>
<blockquote>
<h3><strong>Passive information gathering</strong></h3>
<p>There’s a lot of passive information gathering a malicious admin can do just by querying the Synapse database and this can happen retroactively. Some of the (meta)data include:</p>
<ol>
<li>Chat history of any unencrypted room (duh!)</li>
<li>Information about the users of their homeserver (duh!), like devices, IPs, etc.</li>
<li>Reactions to end-to-end-encrypted (e2ee) messages, because reactions aren’t encrypted.</li>
<li>Room related metadata (even for e2ee rooms), room participants and their avatars/nicks, the room topic, power levels, number of messages people sent and when, etc.</li>
<li>URL previews of shared links (if enabled on a per room setting)</li>
</ol>
<h3><strong>Active attacks</strong></h3>
<p>A malicious admin can perform active attacks against their users and the rooms they participate in if they want. Some of them might be easy to spot from the client’s perspective, others might not.</p>
<h4>Messing with rooms</h4>
<p>Matrix has the notion of <a href="https://matrix.org/docs/guides/implementing-stateres/">state events</a> which are the events that specify what a room looks like. They specify which users are part of the room, which users are banned, the power levels of users, the name and the topic of the room, etc. These events aren’t e2ee and so, a malicious admin can both read them and send their own events by impersonating a user of their homeserver. This can mainly lead to social engineering attacks. I’ll list a few ways to social engineer and exploit people, as there are multiple ways to do so. I’ll be using <span>@victim</span>:example.com as the account the malicious admin is impersonating.</p>
<ul>
<li>React to messages as the user being impersonated. The malicious admin won’t know the content of the message they’re reacting to, but they’ll be able to see others’ reactions to it.</li>
<li>Set the room topic to an attacker controlled URL. Every participant in the room, regardless of homeserver, will see this as being set by <code>@victim:example.com</code>, a user they personally trust. A drive-by attack or a leak of the IP address of third party users is possible this way.</li>
<li>Invite accounts into the room. The newly joined account won’t be able to read past e2ee messages, but any messages sent after they joined will be visible given the default settings of most clients.</li>
<li>Kick and ban people out of the room, which isn’t that bad in itself, but can be disruptive. Similarly, they can increase the power level of other users in the room.</li>
<li>Send <a href="https://spec.matrix.org/v1.1/client-server-api/#mroomtombstone">tombstone events</a>, marking the room as being replaced for most clients and prevent further message sending to it.</li>
</ul>
<h4>Messing with the user’s devices</h4>
<p>The above attacks can be performed simply by impersonating users without adding any new devices to their account. However, a malicious admin can simply add a new device on a user’s account, thus allowing the sending and receiving of e2ee messages.</p>
<p>In most clients, this will show up as an unverified device, resulting in a red shield icon to be added in the room to showcase the presence of the unverified device. My personal experience is that most people, even privacy minded tech savvy ones, simply ignore this for various reasons. I’m guilty of ignoring this as well. There’s however a per session and per room setting to disable your client from sending messages to unverified devices, if one wants to be completely safe.</p>
<p>In most cases, the attacked user will get a popup in their client that a new unverified device was added. There are ways to circumvent this by not reporting this new device to the user, however I don’t know if encryption will continue working properly for the user in this case.</p>
</blockquote>
<h2><a name="p-1003-protocol-weaknesses-6" href="#p-1003-protocol-weaknesses-6"></a><strong>Protocol Weaknesses</strong></h2>
<p><em>AI Summarized From <a href="https://telegra.ph/why-not-matrix-08-07">why not matrix? – Telegraph</a></em></p>
<p>Matrix is a complex communication protocol that serves as the foundation for chat applications, functioning as a distributed partially-replicated graph database. A “room” in Matrix is structured as a directed acyclic graph (DAG) composed of events, which can include messages, user states, and bans. The servers in a room aim for eventual consistency, meaning they should replicate enough state for all participants to see a similar view.</p>
<p>To send an event into a room, a participating server appends it to the graph. Each server must verify incoming events based on defined authentication rules, with events cryptographically signed to confirm their origin. However, there are several significant issues and risks associated with using Matrix:</p>
<ol>
<li><strong>Append-only Design</strong>: Events cannot be deleted, leading to potentially endless history accumulation, which can compromise user deniability.</li>
<li><strong>Redaction Limitations</strong>: Redaction events are advisory; poorly behaving servers may ignore them, retaining the original content.</li>
<li><strong>Data Leakage</strong>: Servers that ignore redactions can inadvertently share supposedly deleted data with new servers joining the room.</li>
<li><strong>Irreversible Events</strong>: Certain events, like membership changes, cannot be deleted as they become part of the room’s auth chain.</li>
<li><strong>Spam Vulnerability</strong>: Bots can be used to spam rooms, complicating the graph and consuming server resources, necessitating room recreation to eliminate spam.</li>
<li><strong>History Linearization Challenges</strong>: Linearizing history is difficult, leading to different servers potentially seeing messages in varying orders.</li>
<li><strong>Message Forging</strong>: It is possible to insert messages into history by crafting plausible events, which may go unnoticed by users.</li>
<li><strong>Optional Encryption</strong>: End-to-end encryption is not mandatory, risking exposure of unencrypted messages in federated rooms.</li>
<li><strong>Fragile Encryption</strong>: Encryption relies on reliable device list updates; failures can lead to broken encryption.</li>
<li><strong>Device Information Leakage</strong>: Device list updates may inadvertently reveal user device information.</li>
<li><strong>API Interoperability Issues</strong>: The lack of a strict definition for canonical JSON can lead to signature mismatches between different server implementations.</li>
<li><strong>Signature Check Failures</strong>: Different programming languages used for homeservers can cause JSON interoperability issues, leading to failed signature checks.</li>
<li><strong>Arbitrary Signing Key Expiry</strong>: Signing keys can expire arbitrarily, causing new servers to reject events from the original server, leading to split-brained rooms.</li>
<li><strong>Common Split-Brained Rooms</strong>: The consensus algorithm for resolving conflicting states is not foolproof, leading to frequent state resets.</li>
<li><strong>State Reset Chaos</strong>: State resets can occur more often with servers written in different languages, causing significant disruptions.</li>
<li><strong>Loss of Admin Powers</strong>: State resets can strip room admins of their powers, making it difficult to manage rooms effectively.</li>
<li><strong>Room Shutdown Limitations</strong>: A room cannot be universally shut down across the federation, which can lead to abuse.</li>
<li><strong>Moderation Challenges</strong>: Effective moderation is hindered by the event auth system’s reliance on accurate state resolution.</li>
<li><strong>Unauthenticated Media Uploads</strong>: Users can upload media without authentication, potentially leading to misuse of the media repository.</li>
<li><strong>Media Replication Risks</strong>: Homeservers can replicate media from other servers, which could lead to denial-of-service issues.</li>
<li><strong>Unverified Media Uploads</strong>: Media uploads are unverified by default, posing risks if harmful content is uploaded.</li>
<li><strong>Liability for Illegal Media</strong>: Homeservers could unknowingly host illegal media due to eager replication from undesirable rooms.</li>
</ol>
<h2><a name="p-1003-dubious-encryption-protocols-megolm-7" href="#p-1003-dubious-encryption-protocols-megolm-7"></a><strong>Dubious Encryption Protocols (Megolm)</strong></h2>
<p><em>From: <a href="https://nebuchadnezzar-megolm.github.io">https://nebuchadnezzar-megolm.github.io</a></em></p>
<blockquote>
<p>We report several practically-exploitable cryptographic vulnerabilities in the end-to-end encryption in <a href="https://en.wikipedia.org/wiki/Matrix_(protocol)">Matrix</a> and describe proof-of-concept attacks exploiting these vulnerabilities. When relying on implementation specific behaviour, these attacks target the Matrix standard as implemented by the <code>matrix-react-sdk</code> and <code>matrix-js-sdk</code> libraries.<a href="https://nebuchadnezzar-megolm.github.io/#fn:1">1</a> These libraries provide the basis for the flagship <a href="https://element.io/">Element</a> client. The vulnerabilities we exploit differ in their nature (insecure by design, protocol confusion, lack of domain separation, implementation bugs) and are distributed broadly across the different subprotocols and libraries that make up the cryptographic core of Matrix.</p>
<p>We target the setting where encrypted messaging and verification are enabled, i.e. in the presence of the strongest protections offered by the protocol. Furthermore, all attacks require cooperation of the homeserver. This is a natural threat model to consider, given that end-to-end encryption aims to provide protections against such untrusted third parties. We report the following vulnerabilities and attacks:</p>
<ul>
<li>Simple confidentiality break</li>
<li>Attack against out-of-band verification</li>
<li>Semi-trusted impersonation</li>
<li>Trusted impersonation</li>
<li>Impersonation to confidentiality break</li>
<li>IND-CCA break</li>
</ul>
</blockquote>
<p>The Megolm protocol, while designed for secure group messaging within the Matrix framework, exhibits several critical weaknesses that can compromise user confidentiality and security.</p>
<h2><a name="p-1003-resource-consumption-8" href="#p-1003-resource-consumption-8"></a><strong>Resource Consumption</strong></h2>
<p>Running a public Matrix server is not cheap. Depending on the number of users, there must be multiple worker containers, effectively requiring that you run between 4 and 12 instances of synapse.</p>
<p>Synapse is hard drive hungry, memory hungry, relatively CPU hungry, and also uses a lot of bandwidth.  Don’t expect to run this pile of bloat without throwing money at it.</p>

<h2><a name="p-1003-data-collection-10" href="#p-1003-data-collection-10"></a><strong>Data Collection</strong></h2>
<p><em>From: <a href="https://hackea.org/notas/matrix.html">https://hackea.org/notas/matrix.html</a>:</em></p>
<blockquote>
<p>Summary of the <a href="https://gist.github.com/maxidorius/5736fd09c9194b7a6dc03b6b8d7220d0">Notes on privacy and data collection of Matrix.org</a></p>
<p><strong><a href="http://matrix.org">matrix.org</a></strong> <em>and</em> <strong>vector.im</strong> <em>receive a lot of private, personal and identifiable data on a regular basis, or metadata that can be used to precisely identify and/or track users/server, their social graph, usage pattern and potential location. This is possible both by the default configuration values in synapse/Riot that do not promote privacy, and by specific choices made by their developers to not disclose, inform users or resolve in a timely manner several known behaviors of the software.</em></p>
<p><em>Data sent on a potential regular basis based on a common web/desktop+smartphone usage even with a self-hosted client and Homeserver:</em></p>
<ul>
<li><em>The Matrix ID of users, usually including their username.</em></li>
<li><em>Email addresses, phone numbers of the user and their contacts.</em></li>
<li><em>Associations of Email, phone numbers with Matrix IDs.</em></li>
<li><em>Usage patterns of the user.</em></li>
<li><em>IP address of the user, which can give more or less precise geographical location information.</em></li>
<li><em>The user’s devices and system information.</em></li>
<li><em>The other servers that users talks to.</em></li>
<li><em>Room IDs, potentially identifying the Direct chat ones and the other user/server.</em></li>
</ul>
<p><em>With default settings, they allow unrestricted, non-obfuscated public access to the following potentially personal data/info:</em></p>
<ul>
<li><em>Matrix IDs mapped to Email addresses/phone numbers added to a user’s settings.</em></li>
<li><em>Every file, image, video, audio that is uploaded to the Homeserver.</em></li>
<li><em>Profile name and avatar of users.</em></li>
</ul>
</blockquote>
<blockquote>
<p>This time, with such an <strong>impressive collection of private data being sent to Matrix central servers, even when you use your own instance</strong>, we have to face the facts: Something is seriously wrong.</p>
</blockquote>
<p>Read more at: <a href="https://gitlab.com/libremonde-org/papers/research/privacy-matrix.org/-/blob/master/part1/README.md">https://gitlab.com/libremonde-org/papers/research/privacy-matrix.org/-/blob/master/part1/README.md</a></p>
<h2><a name="p-1003-pedophiles-11" href="#p-1003-pedophiles-11"></a><strong>Pedophiles</strong></h2>
<div><a href="https://forum.hackliberty.org/uploads/default/original/2X/b/bbc0640a5899788a643ad6e7efbb2bba49606f39.jpeg" data-download-href="https://forum.hackliberty.org/uploads/default/bbc0640a5899788a643ad6e7efbb2bba49606f39" title="1000042609"><img src="https://forum.hackliberty.org/uploads/default/optimized/2X/b/bbc0640a5899788a643ad6e7efbb2bba49606f39_2_505x500.jpeg" alt="1000042609" data-base62-sha1="qMVtU3BSsGzrQiCjKiW1IvDgOVj" width="505" height="500" srcset="https://forum.hackliberty.org/uploads/default/optimized/2X/b/bbc0640a5899788a643ad6e7efbb2bba49606f39_2_505x500.jpeg, https://forum.hackliberty.org/uploads/default/optimized/2X/b/bbc0640a5899788a643ad6e7efbb2bba49606f39_2_757x750.jpeg 1.5x, https://forum.hackliberty.org/uploads/default/optimized/2X/b/bbc0640a5899788a643ad6e7efbb2bba49606f39_2_1010x1000.jpeg 2x" data-dominant-color="F8F8F9"/></a></div></div></div>
  </body>
</html>
