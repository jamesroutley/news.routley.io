<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://macroscopicentric.net/blog/zsh-prompt-config/">Original</a>
    <h1>Zsh Prompt Editing</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div>
         <div>
  
  
  <p>March 14, 2023 | <span>4</span> Minute Read</p>
  
  <p>I finally switched my default shell on my laptop (Mac) from bash to zsh. Iâ€™d never bothered tinkering with a more sophisticated shell before this, so it was interesting to figure out what zsh could do. But I was frustrated because I had a nice prompt in bash, and it took me a while to recreate it.</p>

<p>My bash prompt was pretty simple, it included my current directory, then my git branch, then status indicators for different types of dirty state in a git repo (specifically, staged vs. unstaged changes). It also used to have a unicode crown emoji, but after working with bash on a lot of hosts with older versions of bash that didnâ€™t do well with unicode, Iâ€™d pulled the crown out years ago. (I was hopeful that I could add it back in, at least for my personal computer!)</p>

<p>(Sidenote: I looked into oh-my-zsh and then decided it was too complicated as a framework for my needs, so Iâ€™ll be ignoring it here.)</p>

<p>Replicating my current directory with color-coding was very easy in zsh. It was actually even easier than in bash, since zsh accepts some strings for colors rather than codepoints. After reading <a href="https://zsh.sourceforge.io/Doc/Release/Prompt-Expansion.html#Prompt-Expansion">the zsh prompt expansion docs</a> and <a href="https://scriptingosx.com/2019/07/moving-to-zsh-06-customizing-the-zsh-prompt/">this 2019 blog post about customizing your zsh prompt</a>, I ended up with:</p>

<div><div><pre><code><span>PROMPT</span><span>=</span><span>&#34;%B%F{magenta}%1/%f%b ðŸ‘‘ &#34;</span>

</code></pre></div></div>

<p>Here I initiate bolded and magenta-colored text (<code>%B%F{magenta}</code>), then print one directory out of my working directory, using an absolute path regardless of whether Iâ€™m inside my home directory (<code>%1/</code>), then undo the magenta color and bolding (<code>%f%b</code>).</p>

<p>Next I wanted to replicate the git-related part of my bash prompt. Here zsh is, again, more sophisticated than bash, and has a bunch of basic out-of-the-box git functionality. If you just want to display your branch name and/or dirty state, zsh can do it right out of the box. I found <a href="https://git-scm.com/book/en/v2/Appendix-A%3A-Git-in-Other-Environments-Git-in-Zsh">gitâ€™s own documentation of how to display git info in the zsh prompt</a> super helpful, and it also linked directly to <a href="https://zsh.sourceforge.io/Doc/Release/User-Contributions.html#Version-Control-Information">another section of the zsh docs on zsh and version control systems</a>. After some trial and error (and more help from other peopleâ€™s blog posts), I had this:</p>

<div><div><pre><code><span># grab current branch and display in prompt</span>
<span># source: https://git-scm.com/book/en/v2/Appendix-A%3A-Git-in-Other-Environments-Git-in-Zsh</span>
autoload <span>-Uz</span> vcs_info add-zsh-hook
precmd_vcs_info<span>()</span> <span>{</span> vcs_info <span>}</span>
precmd_functions+<span>=(</span> precmd_vcs_info <span>)</span>
setopt prompt_subst

<span># These lines are specifically for staged + unstaged changes</span>
<span># source: https://salferrarello.com/zsh-git-status-prompt/</span>
add-zsh-hook precmd vcs_info
zstyle <span>&#39;:vcs_info:*&#39;</span> check-for-changes <span>true
</span>zstyle <span>&#39;:vcs_info:*&#39;</span> unstagedstr <span>&#39; *&#39;</span>
zstyle <span>&#39;:vcs_info:*&#39;</span> stagedstr <span>&#39; +&#39;</span>

zstyle <span>&#39;:vcs_info:git:*&#39;</span> formats <span>&#39;(%b%u%c)&#39;</span>

<span>PROMPT</span><span>=</span><span>&#39;%B%F{magenta}%1/%f%b ${vcs_info_msg_0_} ðŸ‘‘ &#39;</span>
</code></pre></div></div>

<p>This did everything described above (show the git branch and all dirty states using different symbols), which was almost what I wanted. But I also really wanted part or all of the git part of my prompt to be color-coded red if there was <em>any</em> type of dirty state. After some spelunking through the git and zsh documentation, I decided that <code>vcs_info</code> was neat but just didnâ€™t have enough power to allow me to conditionally format the magic <code>vcs_info_msg_0</code> variable. So I switched tactics, and went back to an old and reliable standby: <a href="https://github.com/git/git/blob/master/contrib/completion/git-prompt.sh">the <code>git-prompt.sh</code> script in the git repo itself</a>.</p>

<p>Iâ€™d used this script before, to do the same things in bash, but I hadnâ€™t yet installed or used it with zsh. So I explicitly included that in my .zshrc:</p>



<p>And then I did something Iâ€™ve honestly never done before, and I went and read that scriptâ€™s whole dang docstring to figure out if there was an easy way to do what I wanted. And there was! Hereâ€™s the final draft of my prompt, which felt very simple in the end:</p>

<div><div><pre><code><span>source</span> ~/.git-prompt.sh

<span># allow prompt substitution, show dirty state in color (incl. untracked files), define prompt</span>
<span># source: the git-prompt.sh (above) docstring</span>
setopt prompt_subst
<span>GIT_PS1_SHOWDIRTYSTATE</span><span>=</span>1
<span>GIT_PS1_SHOWCOLORHINTS</span><span>=</span>1
<span>GIT_PS1_SHOWUNTRACKEDFILES</span><span>=</span>1
precmd <span>()</span> <span>{</span> __git_ps1 <span>&#34;%B%F{magenta}%1/%f%b &#34;</span> <span>&#34;ðŸ‘‘ &#34;</span> <span>&#34;| %s &#34;</span> <span>}</span>
</code></pre></div></div>

<p>(Second sidenote: I did switch from assigning to <code>PROMPT</code> to using <code>precmd ()</code> here because the git-prompt.sh docstring recommended it as faster, but Iâ€™m not convinced itâ€™s faster for me. I havenâ€™t looked into whether this is user error, or zsh being different, or something else I havenâ€™t thought of.)</p>


  <!-- POST NAVIGATION -->
  
</div>

      </div>
   </div></div>
  </body>
</html>
