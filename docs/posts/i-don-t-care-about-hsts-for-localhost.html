<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost">Original</a>
    <h1>I don&#39;t care about HSTS for localhost</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">Helps ease the pain of newer Chrome versions forcing HTTP Strict Transport Security for localhost, then caching via dynamic domain security policies if it ever works once, forcing HTTPS on local dev servers until &#34;localhost&#34; is manually reset via chrome://net-internals/#hsts every single time this happens. This installable policy for macOS fixes that via adding localhost to HSTSPolicyBypassList and CertificateTransparencyEnforcementDisabledForURLs.</p>
<h2 dir="auto"><a id="user-content-tldr" aria-hidden="true" href="#tldr"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>TL;DR</h2>
<p dir="auto">If you&#39;re seeing this on localhost dev servers:
<a target="_blank" rel="noopener noreferrer" href="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/blob/main/img/sadface.png?raw=true"><img src="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/raw/main/img/sadface.png?raw=true" alt="img/sadface.png" title="img/sadface.png"/></a>
... and you&#39;re sick of deleting <code>localhost</code> from chrome://net-internals/#hsts:
<a target="_blank" rel="noopener noreferrer" href="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/blob/main/img/net-internals.png?raw=true"><img src="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/raw/main/img/net-internals.png?raw=true" alt="img/net-internals.png" title="img/net-internals.png"/></a>
...install the <a href="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/blob/main/com.google.Chrome.mobileconfig">com.google.Chrome.mobileconfig</a> profile from this repo, restart Chrome, and it should work.</p>
<h2 dir="auto"><a id="user-content-compatability" aria-hidden="true" href="#compatability"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Compatability</h2>
<p dir="auto">This is designed to work with Chrome &gt;=78 on macOS (tested with macOS Monterey 12.3.1). Similar methods of setting this are available for Windows and Linux; see the official docs under <a href="#references-and-further-reading">References and Further Reading</a> for more details on how to set those on each OS. <a href="https://appuals.com/how-to-clear-or-disable-hsts-for-chrome-firefox-and-internet-explorer/" rel="nofollow">https://appuals.com/how-to-clear-or-disable-hsts-for-chrome-firefox-and-internet-explorer/</a> also has some suggestions on permanent fixes for Firefox and Internet Explorer on Windows.</p>
<h2 dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installation</h2>
<ol dir="auto">
<li>Clone this repo</li>
<li>In a terminal in the cloned directory, run <code>open com.google.Chrome.mobileconfig</code>. Alternatively, in a Finder window, double-click the file <code>com.google.Chrome.mobileconfig</code></li>
<li>You should see a notification in the upper-right that reads <code>Review the profile in System Preferences if you want to install it</code></li>
<li>Navigate to ï£¿ -&gt; System Preferences -&gt; Profiles</li>
<li>You should see the policy called <code>I Don&#39;t Care About HSTS for Localhost!</code> in the <code>Downloaded</code> section of the Profiles preferences pane. Click <code>Install...</code> and follow the prompts to authenticate and install the profile.
<a target="_blank" rel="noopener noreferrer" href="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/blob/main/img/policy.png?raw=true"><img src="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/raw/main/img/policy.png?raw=true" alt="img/policy.png" title="img/policy.png"/></a></li>
<li>Quit all Google Chrome windows. One easy way to do this is to select the <code>Chrome</code> menu on the top bar and select <code>Quit Google Chrome</code>.</li>
<li>Verify that the policies are installed: re-open Google Chrome and navigate to chrome://policy/</li>
<li>In the upper-right corner of the chrome://policy page, in the <code>Filter Policies by name</code> textbox, enter <code>hsts</code> and you should see the following:
<a target="_blank" rel="noopener noreferrer" href="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/blob/main/img/hstspolicybypasslist.png?raw=true"><img src="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/raw/main/img/hstspolicybypasslist.png?raw=true" alt="img/hstspolicybypasslist.png" title="img/hstspolicybypasslist.png"/></a></li>
<li>In that same <code>Filter Policies by name</code> textbox, enter <code>url</code> and you should see the following:
<a target="_blank" rel="noopener noreferrer" href="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/blob/main/img/certificatetransparencyenforcementdisabledforurls.png?raw=true"><img src="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/raw/main/img/certificatetransparencyenforcementdisabledforurls.png?raw=true" alt="img/certificatetransparencyenforcementdisabledforurls.png" title="img/certificatetransparencyenforcementdisabledforurls.png"/></a></li>
</ol>
<h2 dir="auto"><a id="user-content-references-and-further-reading" aria-hidden="true" href="#references-and-further-reading"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>References and Further Reading</h2>
<ul dir="auto">
<li>chrome://flags/#allow-insecure-localhost <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=714287" rel="nofollow">https://bugs.chromium.org/p/chromium/issues/detail?id=714287</a></li>
<li>StackOverflow about this issue: <a href="https://stackoverflow.com/questions/38968510/how-to-permanently-exclude-localhost-from-hsts-list-in-google-chrome" rel="nofollow">https://stackoverflow.com/questions/38968510/how-to-permanently-exclude-localhost-from-hsts-list-in-google-chrome</a></li>
<li>Chromium bug with details on why <code>defaults write com.google.Chrome HSTSPolicyBypassList -string &#34;localhost&#34;</code> doesn&#39;t work: <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=859185" rel="nofollow">https://bugs.chromium.org/p/chromium/issues/detail?id=859185</a></li>
<li>The <em>right</em> way to fix this by generating a cert for use with local dev servers <a href="https://scatteredcode.net/debugging-on-localhost-with-hsts" rel="nofollow">https://scatteredcode.net/debugging-on-localhost-with-hsts</a></li>
<li>Official docs on HSTSPolicyBypassList: <a href="https://chromeenterprise.google/policies/?policy=HSTSPolicyBypassList" rel="nofollow">https://chromeenterprise.google/policies/?policy=HSTSPolicyBypassList</a></li>
<li>Official docs on CertificateTransparencyEnforcementDisabledForUrls: <a href="https://chromeenterprise.google/policies/?policy=CertificateTransparencyEnforcementDisabledForUrls" rel="nofollow">https://chromeenterprise.google/policies/?policy=CertificateTransparencyEnforcementDisabledForUrls</a></li>
<li>Python tool to convert a plist to a Configuration Profile <a href="https://github.com/timsutton/mcxToProfile">https://github.com/timsutton/mcxToProfile</a></li>
<li>Source file that <a href="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/blob/main/com.google.Chrome.mobileconfig">com.google.Chrome.mobileconfig</a> was generated from using mcxToProfile: <a href="https://github.com/ip2k/I-Dont-Care-About-HSTS-For-Localhost/blob/main/src/com.google.Chrome.plist">src/com.google.Chrome.plist</a></li>
<li>Some background on the problem and other ways to fix this in Chrome, Firefox, and Internet Explorer: <a href="https://appuals.com/how-to-clear-or-disable-hsts-for-chrome-firefox-and-internet-explorer/" rel="nofollow">https://appuals.com/how-to-clear-or-disable-hsts-for-chrome-firefox-and-internet-explorer/</a></li>
<li>Chrome DevTools Protocol <code>Security.setIgnoreCertificateErrors</code> <a href="https://chromedevtools.github.io/devtools-protocol/tot/Security/#method-setIgnoreCertificateErrors" rel="nofollow">https://chromedevtools.github.io/devtools-protocol/tot/Security/#method-setIgnoreCertificateErrors</a></li>
</ul>
</article>
          </div></div>
  </body>
</html>
