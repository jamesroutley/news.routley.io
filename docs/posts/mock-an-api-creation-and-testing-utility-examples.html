<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://dhuan.github.io/mock/latest/examples.html">Original</a>
    <h1>Mock – An API creation and testing utility: Examples</h1>
    
    <div id="readability-page-1" class="page"><article role="main" id="furo-main-content">
          <section id="how-tos-examples">

<section id="delaying-specific-endpoints">
<h2>Delaying specific endpoints<a href="#delaying-specific-endpoints" title="Link to this heading">¶</a></h2>
<p>Making an existing API slow can be easily accomplished combining mock’s
<a href="https://dhuan.github.io/mock/latest/base_apis.html#base-api"><span>Base APIs</span></a> and the <a href="https://dhuan.github.io/mock/latest/cmd_reference.html#cmd-options-reference-delay"><span>delay option.</span></a></p>
<div><div><pre><span></span>$<span> </span>mock<span> </span>serve<span> </span>-p<span> </span><span>8000</span><span> </span>--base<span> </span>example.com<span> </span>--delay<span> </span><span>2000</span>
</pre></div>
</div>
<p>You may want however to make a specific endpoint slow instead of the whole API.
This can be achieved using <a href="https://dhuan.github.io/mock/latest/middlewares.html#middlewares"><span>middlewares</span></a>:</p>
<div><div><pre><span></span>$<span> </span>mock<span> </span>serve<span> </span>-p<span> </span><span>8000</span><span> </span>--base<span> </span>example.com<span> </span>--middleware<span> </span><span>&#39;</span>
<span>if [ &#34;${MOCK_REQUEST_ENDPOINT}&#34; = &#34;some/endpoint&#34; ]</span>
<span>then</span>
<span>    sleep 2 # wait two seconds</span>
<span>fi</span>
<span>&#39;</span>
</pre></div>
</div>
<p>With that last example, our API at <code><span>localhost:8000</span></code> will act as a proxy to
<code><span>example.com</span></code>. All requests will be responded immediately except
<code><span>some/endpoint</span></code> which will have a delay of 2 seconds.</p>
</section>
<section id="an-api-powered-by-multiple-languages">
<h2>An API powered by multiple languages<a href="#an-api-powered-by-multiple-languages" title="Link to this heading">¶</a></h2>
<div><div><pre><span></span>$<span> </span>mock<span> </span>serve<span> </span>-p<span> </span><span>3000</span><span> </span><span>\</span>
<span>    </span>--route<span> </span>js<span> </span><span>\</span>
<span>    </span>--exec<span> </span><span>&#39;</span>
<span>node &lt;&lt;EOF | mock write</span>
<span>console.log(&#34;Hello from Node.js!&#34;)</span>
<span>EOF</span>
<span>&#39;</span><span> </span><span>\</span>
<span>    </span>--route<span> </span>python<span> </span><span>\</span>
<span>    </span>--exec<span> </span><span>&#39;</span>
<span>python3 &lt;&lt;EOF | mock write</span>
<span>print(&#34;Hello from Python!&#34;)</span>
<span>EOF</span>
<span>&#39;</span><span> </span><span>\</span>
<span>    </span>--route<span> </span>php<span> </span><span>\</span>
<span>    </span>--exec<span> </span><span>&#39;</span>
<span>php &lt;&lt;EOF | mock write</span>
<span>&lt;?php</span>
<span>echo &#34;Hello from PHP!\n&#34;;</span>
<span>?&gt;</span>
<span>EOF</span>
<span>&#39;</span>
</pre></div>
</div>
<p>Let’s test it:</p>
<div><div><pre><span></span>$<span> </span>curl<span> </span>localhost:3000/js
<span># Prints out: Hello from Node.js!</span>
$<span> </span>curl<span> </span>localhost:3000/python
<span># Prints out: Hello from Python!</span>
$<span> </span>curl<span> </span>localhost:3000/php
<span># Prints out: Hello from PHP!</span>
</pre></div>
</div>
</section>
<section id="a-stateful-api">
<h2>A stateful API<a href="#a-stateful-api" title="Link to this heading">¶</a></h2>
<div><div><pre><span></span>$<span> </span><span>export</span><span> </span><span>TMP</span><span>=</span><span>$(</span>mktemp<span>)</span>
$<span> </span><span>printf</span><span> </span><span>&#34;0&#34;</span><span> </span>&gt;<span> </span><span>&#34;</span><span>${</span><span>TMP</span><span>}</span><span>&#34;</span>

$<span> </span>mock<span> </span>serve<span> </span>-p<span> </span><span>3000</span><span> </span><span>\</span>
<span>    </span>--route<span> </span><span>&#39;/hello&#39;</span><span> </span><span>\</span>
<span>    </span>--exec<span> </span><span>&#39;</span>
<span>printf &#34;%s + 1\n&#34; &#34;$(cat ${TMP})&#34; | bc | sponge &#34;${TMP}&#34;</span>

<span>printf &#34;This server has received %s request(s) so far.&#34; &#34;$(cat &#39;</span><span>&#34;</span><span>${</span><span>TMP</span><span>}</span><span>&#34;</span><span>&#39;)&#34; | mock write</span>
<span>&#39;</span>
</pre></div>
</div>
<p>Let’s test it:</p>
<div><div><pre><span></span>$<span> </span>curl<span> </span>localhost:3000/hello
<span># Prints out: This server has received 1 request(s) so far.</span>
$<span> </span>curl<span> </span>localhost:3000/hello
<span># Prints out: This server has received 2 request(s) so far.</span>
$<span> </span>curl<span> </span>localhost:3000/hello
<span># Prints out: This server has received 3 request(s) so far.</span>
</pre></div>
</div>
</section>
</section>

        </article></div>
  </body>
</html>
