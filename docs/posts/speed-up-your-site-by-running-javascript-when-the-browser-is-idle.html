<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.npmjs.com/package/idle-task">Original</a>
    <h1>Show HN: Speed up your site by running JavaScript when the browser is idle</h1>
    
    <div id="readability-page-1" class="page"><div><article> <div id="readme">
<p><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/40714517/202905619-b2319b98-d81a-4cc2-9eac-c88702daf45b.png"><img src="https://user-images.githubusercontent.com/40714517/202905619-b2319b98-d81a-4cc2-9eac-c88702daf45b.png" alt="idle-task"/></a></p>
<p><a href="https://badge.fury.io/js/idle-task" rel="nofollow"><img src="https://camo.githubusercontent.com/d3e4e6aa09c77060381b06d31cc660168f666f506f19376a1d9dc4872cd73306/68747470733a2f2f62616467652e667572792e696f2f6a732f69646c652d7461736b2e737667" alt="npm version" data-canonical-src="https://badge.fury.io/js/idle-task.svg"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/b758505e392fc5be0c39fa272a99478aae287c16dc707df13dc09975149516f4/68747470733a2f2f696d672e736869656c64732e696f2f62756e646c6570686f6269612f6d696e7a69702f69646c652d7461736b"><img src="https://camo.githubusercontent.com/b758505e392fc5be0c39fa272a99478aae287c16dc707df13dc09975149516f4/68747470733a2f2f696d672e736869656c64732e696f2f62756e646c6570686f6269612f6d696e7a69702f69646c652d7461736b" alt="npm bundle size" data-canonical-src="https://img.shields.io/bundlephobia/minzip/idle-task"/></a>
<a href="https://github.com/hiroki0525/idle-task/actions/workflows/test.yml"><img src="https://github.com/hiroki0525/idle-task/actions/workflows/test.yml/badge.svg" alt="Test"/></a>
<a href="https://opensource.org/licenses/MIT" rel="nofollow"><img src="https://camo.githubusercontent.com/78f47a09877ba9d28da1887a93e5c3bc2efb309c1e910eb21135becd2998238a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d49542d79656c6c6f772e737667" alt="License: MIT" data-canonical-src="https://img.shields.io/badge/License-MIT-yellow.svg"/></a>
<a href="https://github.com/semantic-release/semantic-release"><img src="https://camo.githubusercontent.com/5ecd36e2cb7b781bf44c590ec289d9cf613669b950513396f8370274d90c6cb3/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f73656d616e7469632d2d72656c656173652d636f6d6d69746c696e745f636f6e76656e74696f6e616c2d6531303037393f6c6f676f3d73656d616e7469632d72656c65617365" alt="semantic-release: angular" data-canonical-src="https://img.shields.io/badge/semantic--release-commitlint_conventional-e10079?logo=semantic-release"/></a></p>
<p>Improve your website performance by executing JavaScript during a browser&#39;s idle periods.</p>


<p><strong>Table of Contents</strong></p>
<ul>
<li>
<a href="#what-is-difference-between-idle-task-and-requestidlecallback">What is difference between <code>idle-task</code> and <code>requestIdleCallback</code></a>
<ul>
<li><a href="#manage-tasks-priority">Manage tasks priority</a></li>
<li><a href="#get-result-by-using-promise-based-api">Get result by using Promise based API</a></li>
<li><a href="#cache">Cache</a></li>
<li><a href="#optimize-executing-tasks">Optimize executing tasks</a></li>
<li><a href="#analyze-tasks-execution-time">Analyze tasks execution time</a></li>
</ul>
</li>
<li><a href="#install">Install</a></li>
<li><a href="#quick-start">Quick Start</a></li>
<li>
<a href="#api">API</a>
<ul>
<li>
<a href="#setidletask"><code>setIdleTask</code></a>
<ul>
<li><a href="#priority-low--high"><code>priority?: &#39;low&#39; | &#39;high&#39;</code></a></li>
<li><a href="#cache-boolean"><code>cache?: boolean</code></a></li>
</ul>
</li>
<li>
<a href="#waitforidletask"><code>waitForIdleTask</code></a>
<ul>
<li><a href="#cache-boolean-1"><code>cache?: boolean</code></a></li>
<li><a href="#timeout-number"><code>timeout?: number</code></a></li>
</ul>
</li>
<li><a href="#getresultfromidletask"><code>getResultFromIdleTask</code></a></li>
<li><a href="#cancelidletask"><code>cancelIdleTask</code></a></li>
<li><a href="#cancelallidletasks"><code>cancelAllIdleTasks</code></a></li>
<li><a href="#isrunidletask"><code>isRunIdleTask</code></a></li>
<li>
<a href="#configureidletask"><code>configureIdleTask</code></a>
<ul>
<li><a href="#interval-number"><code>interval?: number</code></a></li>
<li><a href="#debug-boolean"><code>debug?: boolean</code></a></li>
<li><a href="#timeout-number-1"><code>timeout?: number</code></a></li>
<li><a href="#cache-false"><code>cache?: false</code></a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#recipes">Recipes</a>
<ul>
<li><a href="#vanilla-js">Vanilla JS</a></li>
<li><a href="#react">React</a></li>
</ul>
</li>
<li><a href="#license">License</a></li>
</ul>

<h2><a id="user-content-what-is-difference-between-idle-task-and-requestidlecallback" aria-hidden="true" href="#what-is-difference-between-idle-task-and-requestidlecallback"><span aria-hidden="true"></span></a>What is difference between <code>idle-task</code> and <code>requestIdleCallback</code>
</h2>
<p>Why you should use <code>idle-task</code> instead of <code>requestIdleCallback</code> ?</p>
<h3><a id="user-content-manage-tasks-priority" aria-hidden="true" href="#manage-tasks-priority"><span aria-hidden="true"></span></a>Manage tasks priority</h3>
<div><pre><span>import</span> <span>{</span> <span>setIdleTask</span> <span>}</span> <span>from</span> <span>&#39;idle-task&#39;</span><span>;</span>
<span>setIdleTask</span><span>(</span><span>yourLowPrioryFunction</span><span>,</span> <span>{</span> <span>prioriy</span>: <span>&#39;low&#39;</span> <span>}</span><span>)</span><span>;</span>
<span>setIdleTask</span><span>(</span><span>yourHighPrioryFunction</span><span>,</span> <span>{</span> <span>prioriy</span>: <span>&#39;high&#39;</span> <span>}</span><span>)</span><span>;</span></pre></div>
<h3><a id="user-content-get-result-by-using-promise-based-api" aria-hidden="true" href="#get-result-by-using-promise-based-api"><span aria-hidden="true"></span></a>Get result by using Promise based API</h3>
<div><pre><span>import</span> <span>{</span> <span>getResultFromIdleTask</span> <span>}</span> <span>from</span> <span>&#39;idle-task&#39;</span><span>;</span>
<span>// get result asynchronously</span>
<span>const</span> <span>result</span> <span>=</span> <span>await</span> <span>getResultFromIdleTask</span><span>(</span><span>yourFunction</span><span>)</span><span>;</span></pre></div>
<h3><a id="user-content-cache" aria-hidden="true" href="#cache"><span aria-hidden="true"></span></a>Cache</h3>
<div><pre><span>import</span> <span>{</span> <span>setIdleTask</span><span>,</span> <span>waitForIdleTask</span> <span>}</span> <span>from</span> <span>&#39;idle-task&#39;</span><span>;</span>
<span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>yourFunction</span><span>)</span><span>;</span>
<span>const</span> <span>result1</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>)</span><span>;</span>
<span>// from cache</span>
<span>const</span> <span>result2</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>)</span><span>;</span></pre></div>
<h3><a id="user-content-optimize-executing-tasks" aria-hidden="true" href="#optimize-executing-tasks"><span aria-hidden="true"></span></a>Optimize executing tasks</h3>
<div><pre><span>import</span> <span>{</span> <span>setIdleTask</span> <span>}</span> <span>from</span> <span>&#39;idle-task&#39;</span><span>;</span>
<span>setIdleTask</span><span>(</span><span>longTask</span><span>)</span><span>;</span>
<span>// these functions will be executed during next browser&#39;s idle time.</span>
<span>setIdleTask</span><span>(</span><span>shortTask</span><span>)</span><span>;</span>
<span>setIdleTask</span><span>(</span><span>shortTask</span><span>)</span><span>;</span></pre></div>
<h3><a id="user-content-analyze-tasks-execution-time" aria-hidden="true" href="#analyze-tasks-execution-time"><span aria-hidden="true"></span></a>Analyze tasks execution time</h3>
<div><pre><span>import</span> <span>{</span> <span>setIdleTask</span><span>,</span> <span>configureIdleTask</span> <span>}</span> <span>from</span> <span>&#39;idle-task&#39;</span><span>;</span>
<span>configureIdleTask</span><span>(</span><span>{</span> <span>debug</span>: <span>true</span> <span>}</span><span>)</span>
<span>// output the execution time to the web console.</span>
<span>setIdleTask</span><span>(</span><span>yourFunction1</span><span>)</span><span>;</span></pre></div>
<h2><a id="user-content-install" aria-hidden="true" href="#install"><span aria-hidden="true"></span></a>Install</h2>

<h2><a id="user-content-quick-start" aria-hidden="true" href="#quick-start"><span aria-hidden="true"></span></a>Quick Start</h2>
<p>The simplest way is to use <code>setIdleTask</code> .</p>
<div><pre><span>import</span> <span>{</span> <span>setIdleTask</span> <span>}</span> <span>from</span> <span>&#39;idle-task&#39;</span><span>;</span>

<span>const</span> <span>sendAnalyticsData</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span>
        <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;send analytics data during a browser&#39;s idle periods.&#34;</span><span>)</span><span>;</span>
<span>setIdleTask</span><span>(</span><span>sendAnalyticsData</span><span>)</span><span>;</span></pre></div>
<p>If you want to get the result of a task, please use <code>waitForIdleTask</code> .</p>
<div><pre><span>import</span> <span>{</span> <span>setIdleTask</span><span>,</span> <span>waitForIdleTask</span> <span>}</span> <span>from</span> <span>&#39;idle-task&#39;</span><span>;</span>

<span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>yourFunction</span><span>)</span><span>;</span>
<span>const</span> <span>result</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>)</span><span>;</span></pre></div>
<h2><a id="user-content-api" aria-hidden="true" href="#api"><span aria-hidden="true"></span></a>API</h2>
<h3><a id="user-content-setidletask" aria-hidden="true" href="#setidletask"><span aria-hidden="true"></span></a><code>setIdleTask</code></h3>
<div><pre><span>const</span> <span>sendAnalyticsData</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;send analytics data&#34;</span><span>)</span><span>;</span>
<span>const</span> <span>options</span> <span>=</span> <span>{</span>
    <span>priority</span>: <span>&#39;high&#39;</span><span>,</span>
    <span>cache</span>: <span>false</span>
<span>}</span><span>;</span>
<span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>sendAnalyticsData</span><span>,</span> <span>options</span><span>)</span><span>;</span></pre></div>
<p><code>idle-task</code> has a FIFO(First-In-First-Out) queue.</p>
<p><code>setIdleTask</code> enqueues a task which <code>idle-task</code> will dequeue and run when the browser is idle.</p>
<p><code>setIdleTask</code> returns task id which is necessary for <code>cancelIdleTask</code> , <code>isRunIdleTask</code> and <code>waitForIdleTask</code>.</p>
<p>I recommend less than <strong>50 ms</strong> to execute a task because of <a href="https://web.dev/i18n/en/rail/" rel="nofollow">RAIL model</a> .
If you want to know how long did it take to finish a task, please use <a href="#debug-boolean">debug mode</a> .</p>
<p><code>setIdleTask</code> can also be set options as below.</p>
<h4><a id="user-content-priority-low--high" aria-hidden="true" href="#priority-low--high"><span aria-hidden="true"></span></a><code>priority?: &#39;low&#39; | &#39;high&#39;</code></h4>
<p>You can run a task preferentially using <code>priority: &#39;high&#39;</code> (default is <code>false</code>) option.
<code>setIdleTask</code> adds it to the head of the queue.</p>
<h4><a id="user-content-cache-boolean" aria-hidden="true" href="#cache-boolean"><span aria-hidden="true"></span></a><code>cache?: boolean</code></h4>
<p>This option is to improve performance.</p>
<p><strong><code>idle-task</code> caches the results of tasks by default</strong> .</p>
<p>I recommend to set <code>false</code> if you don&#39;t need the result of idle task.</p>
<p><code>waitForIdleTask</code> will return <code>undefined</code> when <code>cache</code> is <code>false</code> .</p>
<div><pre><span>import</span> <span>{</span><span>waitForIdleTask</span><span>}</span> <span>from</span> <span>&#34;idle-task&#34;</span><span>;</span>

<span>const</span> <span>sendAnalyticsData</span> <span>=</span> <span>(</span><span>)</span>: <span><span>void</span></span> <span>=&gt;</span> <span>{</span>
    <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;send analytics data&#34;</span><span>)</span>
<span>}</span><span>;</span>
<span>// Recommend: sendAnalyticsData result is not needed</span>
<span>setIdleTask</span><span>(</span><span>sendAnalyticsData</span><span>,</span> <span>{</span><span>cache</span>: <span>false</span><span>}</span><span>)</span><span>;</span>

<span>const</span> <span>generateRandomNumber</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>Math</span><span>.</span><span>floor</span><span>(</span><span>Math</span><span>.</span><span>random</span><span>(</span><span>)</span> <span>*</span> <span>100</span><span>)</span><span>;</span>
<span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>generateRandomNumber</span><span>,</span> <span>{</span><span>cache</span>: <span>false</span><span>}</span><span>)</span><span>;</span>
<span>// result is undefined</span>
<span>const</span> <span>result</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>)</span><span>;</span></pre></div>
<h3><a id="user-content-waitforidletask" aria-hidden="true" href="#waitforidletask"><span aria-hidden="true"></span></a><code>waitForIdleTask</code></h3>
<div><pre><span>const</span> <span>generateRandomNumber</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>Math</span><span>.</span><span>floor</span><span>(</span> <span>Math</span><span>.</span><span>random</span><span>(</span><span>)</span> <span>*</span> <span>100</span> <span>)</span><span>;</span>
<span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>generateRandomNumber</span><span>)</span><span>;</span>
<span>const</span> <span>randomNumber</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>,</span> <span>{</span>
    <span>cache</span>: <span>false</span>
<span>}</span><span>)</span><span>;</span></pre></div>
<p>You can get the result of the task by using <code>waitForIdleTask</code> .</p>
<p><code>waitForIdleTask</code> can also be set options as below.</p>
<h4><a id="user-content-cache-boolean-1" aria-hidden="true" href="#cache-boolean-1"><span aria-hidden="true"></span></a><code>cache?: boolean</code></h4>
<p><strong><code>idle-task</code> caches the results of tasks by default</strong> .</p>
<div><pre><span>const</span> <span>generateRandomNumber</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>Math</span><span>.</span><span>floor</span><span>(</span> <span>Math</span><span>.</span><span>random</span><span>(</span><span>)</span> <span>*</span> <span>100</span> <span>)</span><span>;</span>
<span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>generateRandomNumber</span><span>)</span><span>;</span>
<span>const</span> <span>firstRandomNumber</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>)</span><span>;</span>
<span>// this result from cache</span>
<span>const</span> <span>secondRandomNumber</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>)</span><span>;</span>
<span>// same objects</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>Object</span><span>.</span><span>is</span><span>(</span><span>firstRandomNumber</span><span>,</span> <span>secondRandomNumber</span><span>)</span><span>)</span><span>;</span>
<span>// =&gt; true</span></pre></div>
<p>If you get the result of a task <strong>only once</strong>, please set <code>{ cache: false }</code> .
This will improve memory in JavaScript.</p>
<div><pre><span>const</span> <span>generateRandomNumber</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>Math</span><span>.</span><span>floor</span><span>(</span> <span>Math</span><span>.</span><span>random</span><span>(</span><span>)</span> <span>*</span> <span>100</span> <span>)</span><span>;</span>
<span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>generateRandomNumber</span><span>)</span><span>;</span>
<span>// delete cache</span>
<span>const</span> <span>firstRandomNumber</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>,</span> <span>{</span> <span>cache</span>: <span>false</span> <span>}</span><span>)</span><span>;</span>
<span>// this is undefined</span>
<span>const</span> <span>secondRandomNumber</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>)</span><span>;</span>
<span>// not same objects</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>Object</span><span>.</span><span>is</span><span>(</span><span>firstRandomNumber</span><span>,</span> <span>secondRandomNumber</span><span>)</span><span>)</span><span>;</span>
<span>// =&gt; false</span></pre></div>
<h4><a id="user-content-timeout-number" aria-hidden="true" href="#timeout-number"><span aria-hidden="true"></span></a><code>timeout?: number</code></h4>
<p><code>waitForIdleTask</code> maybe wait for the task eternally because it will be finished when the browser is idle.
<code>timeout</code> option can prevent it.</p>
<div><pre><span>const</span> <span>generateRandomNumber</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>Math</span><span>.</span><span>floor</span><span>(</span> <span>Math</span><span>.</span><span>random</span><span>(</span><span>)</span> <span>*</span> <span>100</span> <span>)</span><span>;</span>
<span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>generateRandomNumber</span><span>)</span><span>;</span>
<span>try</span> <span>{</span>
    <span>const</span> <span>firstRandomNumber</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>,</span> <span>{</span> <span>timeout</span>: <span>1000</span> <span>}</span><span>)</span><span>;</span>
<span>}</span> <span>catch</span> <span>(</span><span>e</span><span>)</span> <span>{</span>
    <span>if</span> <span>(</span><span>e</span> <span>instanceof</span> <span>WaitForIdleTaskTimeoutError</span><span>)</span> <span>{</span>
        <span>console</span><span>.</span><span>error</span><span>(</span><span>&#39;this is timeout error&#39;</span><span>)</span>
    <span>}</span>
<span>}</span></pre></div>
<p>In this case, <code>waitForIdleTask</code> will throw <code>WaitForIdleTaskTimeoutError</code> if the task can&#39;t be finished within 1000 ms.</p>
<h3><a id="user-content-getresultfromidletask" aria-hidden="true" href="#getresultfromidletask"><span aria-hidden="true"></span></a><code>getResultFromIdleTask</code></h3>
<div><pre><span>const</span> <span>generateRandomNumber</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>Math</span><span>.</span><span>floor</span><span>(</span> <span>Math</span><span>.</span><span>random</span><span>(</span><span>)</span> <span>*</span> <span>100</span> <span>)</span><span>;</span>
<span>const</span> <span>randomNumber</span> <span>=</span> <span>await</span> <span>getResultFromIdleTask</span><span>(</span><span>generateRandomNumber</span><span>,</span> <span>{</span>
    <span>priority</span>: <span>&#39;high&#39;</span><span>,</span>
    <span>timeout</span>: <span>3000</span><span>,</span>
<span>}</span><span>)</span><span>;</span>

<span>// same</span>
<span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>generateRandomNumber</span><span>,</span> <span>{</span> <span>priority</span>: <span>&#39;high&#39;</span> <span>}</span><span>)</span><span>;</span>
<span>const</span> <span>randomNumber</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>,</span> <span>{</span> <span>timeout</span>: <span>3000</span><span>,</span> <span>cache</span>: <span>false</span> <span>}</span><span>)</span><span>;</span></pre></div>
<p>You can get the result by using <code>getResultFromIdleTask</code> if you don&#39;t need the task id.</p>
<p><code>getResultFromIdleTask</code> can also be set options which is <code>SetIdleTaskOptions.priority</code> and  <code>WaitForIdleTaskOptions.timeout</code> .</p>
<h3><a id="user-content-cancelidletask" aria-hidden="true" href="#cancelidletask"><span aria-hidden="true"></span></a><code>cancelIdleTask</code></h3>
<div><pre><span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;task will be canceled.&#34;</span><span>)</span><span>)</span><span>;</span>
<span>cancelIdleTask</span><span>(</span><span>taskId</span><span>)</span><span>;</span></pre></div>
<p>You can stop to run a task by using <code>cancelIdleTask</code> if it is not executed.</p>
<h3><a id="user-content-cancelallidletasks" aria-hidden="true" href="#cancelallidletasks"><span aria-hidden="true"></span></a><code>cancelAllIdleTasks</code></h3>
<div><pre><span>setIdleTask</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;task 1 will be canceled.&#34;</span><span>)</span><span>)</span><span>;</span>
<span>setIdleTask</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;task 2 will be canceled.&#34;</span><span>)</span><span>)</span><span>;</span>
<span>setIdleTask</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;task 3 will be canceled.&#34;</span><span>)</span><span>)</span><span>;</span>
<span>cancelAllIdleTasks</span><span>(</span><span>)</span><span>;</span></pre></div>
<p>You can stop to run all tasks by using <code>cancelAllIdleTasks</code> if they are not executed.</p>
<h3><a id="user-content-isrunidletask" aria-hidden="true" href="#isrunidletask"><span aria-hidden="true"></span></a><code>isRunIdleTask</code></h3>
<div><pre><span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;task&#34;</span><span>)</span><span>)</span><span>;</span>
<span>const</span> <span>isRun</span> <span>=</span> <span>isRunIdleTask</span><span>(</span><span>taskId</span><span>)</span><span>;</span>
<span>if</span> <span>(</span><span>isRun</span><span>)</span> <span>{</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;the task was completed&#34;</span><span>)</span><span>;</span>
<span>}</span></pre></div>
<p><strong>deprecated</strong> : This function will be replaced alternative one.</p>
<p>You can know whether the task is executed or not by using <code>isRunIdleTask</code> .</p>
<h3><a id="user-content-configureidletask" aria-hidden="true" href="#configureidletask"><span aria-hidden="true"></span></a><code>configureIdleTask</code></h3>
<div><pre><span>configureIdleTask</span><span>(</span><span>{</span>
  <span>interval</span>: <span>1000</span><span>,</span> <span>// ms</span>
  <span>debug</span>: <span>false</span><span>,</span>
  <span>timeout</span>: <span>3000</span><span>,</span>
<span>}</span><span>)</span><span>;</span></pre></div>
<p><code>configureIdleTask</code> configures <code>idle-task</code> .
You can set properties as below.</p>
<h4><a id="user-content-interval-number" aria-hidden="true" href="#interval-number"><span aria-hidden="true"></span></a><code>interval?: number</code></h4>
<p><code>idle-task</code> checks tasks which was registered by <code>setIdleTask</code> during a browser&#39;s idle periods, so <strong>they will not always be executed</strong> .</p>
<p>Please set <code>interval</code> if you want to guarantee to run tasks as much as possible.</p>
<p>Even if the browser is not idle, <code>idle-task</code> checks tasks every 1000 ms when <code>interval</code> is <code>1000</code> and <strong>will execute tasks without negative impact on performance</strong>.</p>
<h4><a id="user-content-debug-boolean" aria-hidden="true" href="#debug-boolean"><span aria-hidden="true"></span></a><code>debug?: boolean</code></h4>
<p>If <code>debug</code> is <code>true</code>, you can know how long did it take to finish the task via the web console.</p>
<p>I recommend less than <strong>50 ms</strong> to execute a task because of <a href="https://web.dev/i18n/en/rail/" rel="nofollow">RAIL model</a> .</p>
<p>The default is <code>process.env.NODE_ENV === &#39;development&#39;</code> .</p>
<h4><a id="user-content-timeout-number-1" aria-hidden="true" href="#timeout-number-1"><span aria-hidden="true"></span></a><code>timeout?: number</code></h4>
<p>This option configures <code>timeout</code> of <code>waitForIdleTask</code> and <code>getResultFromIdleTask</code> as <strong>default</strong> setting.</p>
<div><pre><span>configureIdleTask</span><span>(</span><span>{</span> <span>timeout</span>: <span>3000</span> <span>}</span><span>)</span><span>;</span>

<span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>yourFunction</span><span>)</span><span>;</span>
<span>// timeout is 3000</span>
<span>const</span> <span>result</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>)</span><span>;</span>

<span>// timeout is 5000 if you set timeout as option</span>
<span>const</span> <span>result</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>,</span> <span>{</span> <span>timeout</span>: <span>5000</span> <span>}</span><span>)</span><span>;</span></pre></div>
<h4><a id="user-content-cache-false" aria-hidden="true" href="#cache-false"><span aria-hidden="true"></span></a><code>cache?: false</code></h4>
<p>This option configures <code>cache</code> of <code>setIdleTask</code> as <strong>default</strong> setting. Default is <code>true</code> .
You should set <code>false</code> if it is make sure not to need all the results of tasks when using <code>setIdleTask</code> .</p>
<div><pre><span>configureIdleTask</span><span>(</span><span>{</span> <span>cache</span>: <span>false</span> <span>}</span><span>)</span><span>;</span>

<span>// cache option is false</span>
<span>setIdleTask</span><span>(</span><span>yourFunction</span><span>)</span><span>;</span>
<span>// same</span>
<span>setIdleTask</span><span>(</span><span>yourFunction</span><span>,</span> <span>{</span> <span>cache</span>: <span>false</span> <span>}</span><span>)</span>

<span>// cache is true if you set cache as option</span>
<span>setIdleTask</span><span>(</span><span>yourFunction</span><span>,</span> <span>{</span> <span>cache</span>: <span>true</span> <span>}</span><span>)</span><span>;</span></pre></div>
<h2><a id="user-content-recipes" aria-hidden="true" href="#recipes"><span aria-hidden="true"></span></a>Recipes</h2>
<h3><a id="user-content-vanilla-js" aria-hidden="true" href="#vanilla-js"><span aria-hidden="true"></span></a>Vanilla JS</h3>
<div><pre><span>import</span> <span>{</span> <span>setIdleTask</span> <span>}</span> <span>from</span> <span>&#39;idle-task&#39;</span><span>;</span>

<span>// this module is loaded during a browser&#39;s idle periods because it is not important for UI.</span>
<span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>import</span><span>(</span><span>&#39;./sendAnalyticsData&#39;</span><span>)</span><span>)</span>

<span>const</span> <span>button</span> <span>=</span> <span>document</span><span>.</span><span>getElementById</span><span>(</span><span>&#39;button&#39;</span><span>)</span><span>;</span>
<span>button</span><span>.</span><span>addEventListener</span><span>(</span><span>&#39;click&#39;</span><span>,</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>{</span> <span>default</span>: <span>sendAnalyticsData</span> <span>}</span> <span>=</span> <span>await</span> <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>)</span><span>;</span>
    <span>// Send analytics data to server when the browser is idle.</span>
    <span>setIdleTask</span><span>(</span><span>sendAnalyticsData</span><span>,</span> <span>{</span> <span>cache</span>: <span>false</span> <span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span></pre></div>
<div><pre><span>import</span> <span>{</span> <span>getResultFromIdleTask</span> <span>}</span> <span>from</span> <span>&#39;idle-task&#39;</span><span>;</span>

<span>const</span> <span>checkAccessTokenWhenIdle</span> <span>=</span> <span>(</span><span>accessToken</span>: <span>string</span><span>)</span>: <span>Promise</span><span>&lt;</span><span>any</span><span>&gt;</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>fetchCheckAccessToken</span> <span>=</span> <span>async</span> <span>(</span><span>)</span>: <span>Promise</span><span>&lt;</span><span>any</span><span>&gt;</span> <span>=&gt;</span> <span>{</span>
        <span>const</span> <span>response</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>`https://yourdomain/api/check?accessToken=<span><span>${</span><span>accessToken</span><span>}</span></span>`</span><span>)</span><span>;</span>
        <span>// Promise callback will execute immediately after fetching completely even if the browser is busy.</span>
        <span>// One of the solutions is to run it when next browser&#39;s idle time.</span>
        <span>return</span> <span>getResultFromIdleTask</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>response</span><span>.</span><span>json</span><span>(</span><span>)</span><span>)</span><span>;</span>
    <span>}</span><span>;</span>
    <span>return</span> <span>getResultFromIdleTask</span><span>(</span><span>fetchCheckAccessToken</span><span>)</span><span>;</span>
<span>}</span>

<span>const</span> <span>{</span> isSuccess <span>}</span> <span>=</span> <span>await</span> <span>checkAccessTokenWhenIdle</span><span>(</span><span>&#39;1234&#39;</span><span>)</span><span>;</span></pre></div>
<h3><a id="user-content-react" aria-hidden="true" href="#react"><span aria-hidden="true"></span></a>React</h3>
<div><pre><span>import</span> <span>{</span><span>useState</span><span>,</span> <span>useEffect</span><span>}</span> <span>from</span> <span>&#39;react&#39;</span><span>;</span>
<span>import</span> <span>{</span><span>setIdleTask</span><span>}</span> <span>from</span> <span>&#39;idle-task&#39;</span><span>;</span>
<span>import</span> <span>{</span><span>cancelIdleTask</span><span>,</span> <span>waitForIdleTask</span><span>}</span> <span>from</span> <span>&#34;./index&#34;</span><span>;</span>

<span>const</span> <span>fetchNewsList</span> <span>=</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>response</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#39;https://yourdomain/api/news&#39;</span><span>)</span><span>;</span>
  <span>return</span> <span>response</span><span>.</span><span>json</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>// this is not important UI for the website main content like e-commerce sites.</span>
<span>export</span> <span>default</span> <span>function</span> <span>WebsiteNewsList</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>newsList</span><span>,</span> <span>setNewsList</span><span>]</span> <span>=</span> <span>useState</span><span>(</span><span>[</span><span>]</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>isLoading</span><span>,</span> <span>setIsLoading</span><span>]</span> <span>=</span> <span>useState</span><span>(</span><span>true</span><span>)</span><span>;</span>

  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>// fetch news list when the browser is idle and cache it.</span>
    <span>const</span> <span>taskId</span> <span>=</span> <span>setIdleTask</span><span>(</span><span>fetchNewsList</span><span>)</span>
    <span>waitForIdleTask</span><span>(</span><span>taskId</span><span>)</span>
        <span>.</span><span>then</span><span>(</span><span>setNewsList</span><span>)</span>
        <span>.</span><span>finally</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>setIsLoading</span><span>(</span><span>false</span><span>)</span><span>)</span><span>;</span>
    <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>// stop to fetch news list and remove the cache when the component re-render.</span>
        <span>cancelIdleTask</span><span>(</span><span>taskId</span><span>)</span>
    <span>}</span><span>;</span>
  <span>}</span><span>,</span> <span>[</span><span>]</span><span>)</span>
  
  <span>if</span> <span>(</span><span>isLoading</span><span>)</span> <span>{</span>
      <span>return</span> <span>&lt;</span><span>div</span><span>&gt;</span>Loading...<span>&lt;</span><span>/</span><span>div</span><span>&gt;</span>
  <span>}</span>
  <span>return</span> <span>newsList</span><span>.</span><span>map</span><span>(</span><span>news</span> <span>=&gt;</span> <span>(</span>
      <span>&lt;</span><span>div</span> <span>id</span><span>=</span><span>{</span><span>news</span><span>.</span><span>id</span><span>}</span><span>&gt;</span>
        <span>{</span><span>news</span><span>.</span><span>publiedDate</span><span>}</span>
        <span>{</span><span>news</span><span>.</span><span>title</span><span>}</span>
        <span>{</span><span>news</span><span>.</span><span>description</span><span>}</span>
      <span>&lt;</span><span>/</span><span>div</span><span>&gt;</span>
  <span>)</span><span>)</span>
<span>}</span></pre></div>
<h2><a id="user-content-license" aria-hidden="true" href="#license"><span aria-hidden="true"></span></a>License</h2>
<p>Released under the MIT license.</p>
</div></article></div></div>
  </body>
</html>
