<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/alurm/lua-match">Original</a>
    <h1>I made a tiny library for switches and sum types in Lua</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">How? With a tagging function.</p>
<p dir="auto">A minimal usage example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="local tag = dofile&#39;tag.lua&#39;
local a_rectangle = tag(&#39;rectangle&#39;, { width = 10, height = 20 })

local switch = {
  rectangle = function(s) return print(&#39;Got a rectangle shape with the width of &#39; .. s.width) end,
  -- An optional default case.
  [false] = function() return print(&#39;Shape type is not known&#39;) end,
}

-- Will print &#34;Got a rectangle shape with the width of 10&#34;.
a_rectangle(switch)"><pre><span>local</span> <span>tag</span> <span>=</span> <span>dofile</span><span><span>&#39;</span>tag.lua<span>&#39;</span></span>
<span>local</span> <span>a_rectangle</span> <span>=</span> <span>tag</span>(<span><span>&#39;</span>rectangle<span>&#39;</span></span>, { <span>width</span> <span>=</span> <span>10</span>, <span>height</span> <span>=</span> <span>20</span> })

<span>local</span> <span>switch</span> <span>=</span> {
  <span>rectangle</span> <span>=</span> <span>function</span>(<span>s</span>) <span>return</span> <span>print</span>(<span><span>&#39;</span>Got a rectangle shape with the width of <span>&#39; </span></span><span>..</span> <span>s</span>.<span>width</span>) <span>end</span>,
  <span><span>--</span> An optional default case.</span>
  [<span>false</span>] <span>=</span> <span>function</span>() <span>return</span> <span>print</span>(<span><span>&#39;</span>Shape type is not known<span>&#39;</span></span>) <span>end</span>,
}

<span><span>--</span> Will print &#34;Got a rectangle shape with the width of 10&#34;.</span>
<span>a_rectangle</span>(<span>switch</span>)</pre></div>
<p dir="auto">For a more thorough example, see <a href="https://github.com/alurm/lua-match/blob/main/example.lua">example.lua</a>.</p>
<p dir="auto">Tags are implemented by setting the <code>__call</code> metamethod on a table. The implementation (<a href="https://github.com/alurm/lua-match/blob/main/tag.lua">tag.lua</a>) is so small, I&#39;ll just show it here in full:</p>
<div dir="auto" data-snippet-clipboard-copy-content="return function(tag, value)
  setmetatable(value, {
    __call = function(value, switch)
      local case = switch[tag]
      if case then return case(value) end
      local default = switch[false]
      if default then return default() end
      error(&#39;no match for tag &#39; .. tag)
    end
  })
  return value
end"><pre><span>return</span> <span>function</span>(<span>tag</span>, <span>value</span>)
  <span>setmetatable</span>(<span>value</span>, {
    <span>__call</span> <span>=</span> <span>function</span>(<span>value</span>, <span>switch</span>)
      <span>local</span> <span>case</span> <span>=</span> <span>switch</span>[<span>tag</span>]
      <span>if</span> <span>case</span> <span>then</span> <span>return</span> <span>case</span>(<span>value</span>) <span>end</span>
      <span>local</span> <span>default</span> <span>=</span> <span>switch</span>[<span>false</span>]
      <span>if</span> <span>default</span> <span>then</span> <span>return</span> <span>default</span>() <span>end</span>
      <span>error</span>(<span><span>&#39;</span>no match for tag <span>&#39; </span></span><span>..</span> <span>tag</span>)
    <span>end</span>
  })
  <span>return</span> <span>value</span>
<span>end</span></pre></div>
<p dir="auto">The license used for this project is MIT.</p>
</article></div></div>
  </body>
</html>
