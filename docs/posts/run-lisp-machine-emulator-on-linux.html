<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://archives.loomcom.com/genera/genera-install.html">Original</a>
    <h1>Run Lisp machine emulator on Linux</h1>
    
    <div id="readability-page-1" class="page"><div id="text-6">
<p>
If you downloaded the file <code>Genera-8-5-xlib-patched.vlod</code> you can
safely ignore this step. This procedure will modify an un-patched
<code>Genera-8-5.vlod</code> file and make it usable.
</p>

<p>
Open Genera 2.0 has a pretty nasty bug in its X11 implementation that
will prevent it from running on modern X implementations, <i>UNLESS</i> you
follow this procedure to patch it.
</p>

<p>
The purpose of this procedure is to patch the <code>Genera-8-5.vlod</code> world
file so that it can be run without crashing on Ubuntu 15.10 and higher.
</p>

<p>
<b>NOTE:</b> The <code>time</code> and <code>daytime</code> services MUST NOT BE RUNNING. Shut
them down as a first step. Otherwise, genera will get the time from
the system and start running. We don’t want that!
</p>

<p>
To get started, type
</p>

<pre id="org200ffcf">$ ./genera
</pre>

<p>
(The VLM needs to create the appropriate network <code>tun0</code> interface, so
it <b>MUST</b> be run as root!)
</p>

<p>
This will bring up the cold load debugger window. Note, however, that
it will be minimized, so you’ll have to open it. After about ten
seconds, it will prompt you for a date and time. At the prompt, enter
the date in the form <code>MM/DD/YYYY HH:MM</code>, for example
</p>

<pre id="org3bd14ed">2/1/2016 17:58
</pre>

<p>
This will fail, but we WANT it to fail. You should see the prompt:
</p>

<pre id="org11dd635">Error: Unable to set calendar clock.

TIME:SET-CALENDAR-CLOCK
   Arg 0 (TIME:NEW-TIME): 3663356280
s-A, &lt;Abort&gt;: Exit process Initialize Genera
→
</pre>

<p>
At the “→” prompt, you can enter just about any Lisp expression.
We’re going to use this fact to replace the body of a function,
<code>xlib:set-modifier-mapping</code>, with a no-op. This is to prevent X11 from
just barfing and failing to render Genera at all.
</p>

<p>
So, at the → prompt, type:
</p>

<div>
<pre>(defun xlib:set-modifier-mapping (display &amp;rest args) (values))
</pre>
</div>

<p>
<b>Note:</b> When you type the first open parenthesis, the cold load debugger will
respond with:
</p>

<pre id="org4e31c26">Eval (program):
</pre>

<p>
This is normal!
</p>

<p>
When you type the final closing parenthesis, you will be prompted
with:
</p>

<pre id="orgd55c18e">Warning: Function XLIB:SET-MODIFIER-MAPPING, being redefined,
was previously defined by file SYS:X11;CLX;TEXT. OK? (Y, P, or N)
</pre>

<p>
Just type <code>Y</code> here.
</p>

<p>
Now, type <code>:Return</code>, <i>with the colon</i>, to exit and continue on. You’ll
be prompted with:
</p>

<pre id="org8ddb0ac">Return from TIME:SET-CALENDAR-CLOCK? (Y or N)
</pre>

<p>
Just type <code>Y</code> here.
</p>

<p>
At this point, Genera should load. You’ll need to save the modified
world right away. To do so, at the <code>Command:</code> prompt, type:
</p>

<pre id="org68ac1e7">Save World Genera-8-5-xlib-patched.vlod
</pre>

<p>
The world will be saved in the new file <code>Genera-8-5-xlib-patched.vlod</code>
</p>

<p>
Now type
</p>

<pre id="org8565221">Halt Genera :shutdown
</pre>

<p>
and answer <code>Y</code> to a few prompts.
</p>

<p>
Finally, edit the <code>$HOME/genera/.VLM</code> configuration file to point at
the new world:
</p>

<pre id="orgad0897a">...
#genera.world: Genera-8-5.vlod
genera.world: Genera-8-5-xlib-patched.vlod
...
</pre>
</div></div>
  </body>
</html>
