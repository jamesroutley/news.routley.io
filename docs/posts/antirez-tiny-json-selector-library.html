<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://notes.billmill.org/link_blog/2023/11/antirez__tiny_JSON_selector_library.html">Original</a>
    <h1>Antirez&#39; tiny JSON selector library</h1>
    
    <div id="readability-page-1" class="page"><div>
    
    <p>Nov 27, 2023</p>
    <p>Salvatore Sanfilippo, aka <a href="https://github.com/antirez">antirez</a> released a <a href="https://github.com/antirez/botlib">telegram bot library in C</a> recently. While I&#39;m not at all interested in a telegram bot library, I always like to read Salvatore&#39;s code, which is uniformly superb.</p>
<p>The bit of code that caught my eye in this release is in <a href="https://github.com/antirez/botlib/blob/ca2f977deeb3455e69e9a8f6b8ba711798dba6e6/json_wrap.c">this file</a>, which implements a simple selector library on top of the <a href="https://github.com/DaveGamble/cJSON">json library he&#39;s using</a>. In about 100 lines of code, it implements a function that parses and executes a tiny <a href="https://notes.billmill.org/programming/json/jq.html">jq</a>-like language:</p>
<pre><code><div><pre><span></span><span>/* You can select things like this:</span>
<span> *</span>
<span> * cJSON *json = cJSON_Parse(myjson_string);</span>
<span> * cJSON *width = cJSON_Select(json,&#34;.features.screens[*].width&#34;,4);</span>
<span> * cJSON *height = cJSON_Select(json,&#34;.features.screens[4].*&#34;,&#34;height&#34;);</span>
<span> * cJSON *price = cJSON_Select(json,&#34;.features.screens[4].price_*&#34;,</span>
<span> *                  price_type == EUR ? &#34;eur&#34; : &#34;usd&#34;);</span>
</pre></div>
</code></pre>
<p>It&#39;s a really nice example of just how simple you can make a parser for a tiny language.</p>
<p>I think it&#39;d be fun to re-implement this in another language to understand it better, and I might give it a go at some point.</p>

    
    
  </div></div>
  </body>
</html>
