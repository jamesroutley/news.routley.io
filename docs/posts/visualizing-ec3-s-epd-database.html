<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mclare.blog/posts/visualizing-ec3s-epd-database">Original</a>
    <h1>Visualizing EC3&#39;s EPD Database</h1>
    
    <div id="readability-page-1" class="page"><div><h2 id="the-data"><a href="#the-data" aria-label="the data permalink"></a>The data</h2>
<p>I wanted to create a <a href="https://mclare.blog/visuals/ec3epds/" target="_blank" rel="nofollow noopener noreferrer">data visualization</a> of the current state of the <a href="https://www.buildingtransparency.org/ec3-resources/ec3-user-guide/" target="_blank" rel="nofollow noopener noreferrer">EC3</a> Environmental Product Declaration (EPD) database (provided by <a href="https://www.buildingtransparency.org/" target="_blank" rel="nofollow noopener noreferrer">Building Transparency</a>) to allow users to get a better overview of their current offerings (their current landing page provides a broad count of EPDs by country, only differentiated by “concrete” vs “non-concrete” in a global map).</p>
<div><figure>
    <span>
      <a href="https://matklad.github.io/static/7e8ea9507761f267baa166e78c61074d/9f9a4/buildingTransparencyMap.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/7e8ea9507761f267baa166e78c61074d/8ac56/buildingTransparencyMap.webp 240w,
/static/7e8ea9507761f267baa166e78c61074d/d3be9/buildingTransparencyMap.webp 480w,
/static/7e8ea9507761f267baa166e78c61074d/e46b2/buildingTransparencyMap.webp 960w,
/static/7e8ea9507761f267baa166e78c61074d/f992d/buildingTransparencyMap.webp 1440w,
/static/7e8ea9507761f267baa166e78c61074d/9fbc2/buildingTransparencyMap.webp 1560w" sizes="(max-width: 960px) 100vw, 960px" type="image/webp"/>
          <source srcset="/static/7e8ea9507761f267baa166e78c61074d/8ff5a/buildingTransparencyMap.png 240w,
/static/7e8ea9507761f267baa166e78c61074d/e85cb/buildingTransparencyMap.png 480w,
/static/7e8ea9507761f267baa166e78c61074d/d9199/buildingTransparencyMap.png 960w,
/static/7e8ea9507761f267baa166e78c61074d/07a9c/buildingTransparencyMap.png 1440w,
/static/7e8ea9507761f267baa166e78c61074d/9f9a4/buildingTransparencyMap.png 1560w" sizes="(max-width: 960px) 100vw, 960px" type="image/png"/>
          <img src="https://matklad.github.io/static/7e8ea9507761f267baa166e78c61074d/d9199/buildingTransparencyMap.png" alt="Building Transparency&#39;s Concrete EPD Map" title="Building Transparency&#39;s Concrete EPD Map" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span>
    <figcaption>Building Transparency&#39;s Concrete EPD Map</figcaption>
  </figure></div>
<p>Environmental Product Declarations are crucial for estimating the embodied carbon in building construction, as they provide information about the cradle-to-gate (<a href="https://carbonleadershipforum.org/introduction-to-lca/" target="_blank" rel="nofollow noopener noreferrer">Life Cycle Assessment</a> A1-A3 stage) environmental impact of building materials on a plant/manufacturer and product specific level. I thought it would be interesting to allow users to see how many EPDs have been provided on a manufacturer and plant level basis, as well as some overall metrics of the EPDs being provided by a given plant.</p>
<p>Here are some of the questions I wanted to answer via the visualization:</p>
<ul>
<li>How dominant are certain manufacturers in providing EC3 with EPDs?</li>
<li>How diversified are manufacturers? Are they providing EPDs in multiple material categories and subcategories?</li>
<li>How do the EPD embodied carbon values at a given plant for a material stack up against manufacturer and category averages?</li>
<li>Where are there EPD “deserts”? Are only plants in specific parts of the country currently providing EPDs to Building Transparency?</li>
</ul>
<h2 id="data-collection"><a href="#data-collection" aria-label="data collection permalink"></a>Data collection</h2>
<p>The first challenge for this project was retrieving all the data. It’s no surprise that the EC3 API is rate limited, and that the limit is unpublished. I ended up using the <a href="https://www.npmjs.com/package/bottleneck" target="_blank" rel="nofollow noopener noreferrer">Bottleneck</a> package to prevent API calls from happening more than once every 2 seconds (I was unable to get concurrent requests to work in any capacity). I also limited the fields to return, as I didn’t want to get everything out of the EPD (each one has nearly 100 fields, many of which are null). Even so, with 9 fields and about 90k EPDS, I ended up with a json file of about 400 mb. This was largely because two of the fields I retrieved (“manufacturer” and “plant_or_group”) also contained a number of subfields that I didn’t necesarily want. There’s no way to prevent retrieving all of the nested subfields (one of the pitfalls of overfetching with a REST api), so I needed to do a bit of postprocessing to reduce the file size to <em>only</em> the fields necessary for the data visualization.</p>
<div><div><figure>
    <span>
      <a href="https://matklad.github.io/static/c5c91d44f89768a9b7da608218e258b1/508ef/overallCount.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/c5c91d44f89768a9b7da608218e258b1/8ac56/overallCount.webp 240w,
/static/c5c91d44f89768a9b7da608218e258b1/d3be9/overallCount.webp 480w,
/static/c5c91d44f89768a9b7da608218e258b1/03fb9/overallCount.webp 578w" sizes="(max-width: 578px) 100vw, 578px" type="image/webp"/>
          <source srcset="/static/c5c91d44f89768a9b7da608218e258b1/8ff5a/overallCount.png 240w,
/static/c5c91d44f89768a9b7da608218e258b1/e85cb/overallCount.png 480w,
/static/c5c91d44f89768a9b7da608218e258b1/508ef/overallCount.png 578w" sizes="(max-width: 578px) 100vw, 578px" type="image/png"/>
          <img src="https://matklad.github.io/static/c5c91d44f89768a9b7da608218e258b1/508ef/overallCount.png" alt="Total EPD Count by Category" title="Total EPD Count by Category" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span>
    <figcaption>Total EPD Count by Category</figcaption>
  </figure></div></div>
<h2 id="initial-exploration"><a href="#initial-exploration" aria-label="initial exploration permalink"></a>Initial exploration</h2>
<p>To get a general idea of the data, I used the ‘categories/root’ endpoint to get an overview of which material categories and subcategories existed, and how many EPDs were in each of those. A cluster dendrogram revealed that concrete and its subcategories make up the vast majority of EPDs submitted to EC3 (which shouldn’t be a surprise, since there are infinite possibilities for concrete mix designs). The dendrogram also revealed that there are some unused categories within EC3 (either deprecated or reserved for potential future use).</p>
<div><figure>
    <span>
      <a href="https://matklad.github.io/static/8c001ebc6ef355eab69431a09f459544/21cdd/dendriteOverview.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/8c001ebc6ef355eab69431a09f459544/8ac56/dendriteOverview.webp 240w,
/static/8c001ebc6ef355eab69431a09f459544/d3be9/dendriteOverview.webp 480w,
/static/8c001ebc6ef355eab69431a09f459544/e46b2/dendriteOverview.webp 960w,
/static/8c001ebc6ef355eab69431a09f459544/f992d/dendriteOverview.webp 1440w,
/static/8c001ebc6ef355eab69431a09f459544/21b4e/dendriteOverview.webp 1680w" sizes="(max-width: 960px) 100vw, 960px" type="image/webp"/>
          <source srcset="/static/8c001ebc6ef355eab69431a09f459544/8ff5a/dendriteOverview.png 240w,
/static/8c001ebc6ef355eab69431a09f459544/e85cb/dendriteOverview.png 480w,
/static/8c001ebc6ef355eab69431a09f459544/d9199/dendriteOverview.png 960w,
/static/8c001ebc6ef355eab69431a09f459544/07a9c/dendriteOverview.png 1440w,
/static/8c001ebc6ef355eab69431a09f459544/21cdd/dendriteOverview.png 1680w" sizes="(max-width: 960px) 100vw, 960px" type="image/png"/>
          <img src="https://matklad.github.io/static/8c001ebc6ef355eab69431a09f459544/d9199/dendriteOverview.png" alt="D3 Dendrogram Overview" title="D3 Dendrogram Overview" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span>
    <figcaption>D3 Dendrogram Overview</figcaption>
  </figure></div>
<h2 id="choosing-a-visualization-scheme"><a href="#choosing-a-visualization-scheme" aria-label="choosing a visualization scheme permalink"></a>Choosing a visualization scheme</h2>
<p>Once I had an overview of the data, I utilized a <a href="https://observablehq.com/@d3/pack" target="_blank" rel="nofollow noopener noreferrer">circle packing</a> visualization to display the overall EPD information, and to group the EPDs by material category, material subcategor(ies), and by plant. Circle packing visualizations are not the most efficient data visualizations, but I wanted something with visual impact where additional information could be discovered from interactive features on the larger visualization.</p>
<p>While the overall plant was of interest, I wanted to have some way of teasing additional information out of the individual EPDs. I used a box plot to allow users to compare the Global Warming Potential (GWP in kgCO2 equivalent per category unit) of a product at a particular plant vs. that type of product at all plants for the given manufacturer, vs. the product category overall. I didn’t like the <a href="https://observablehq.com/@d3/box-plot" target="_blank" rel="nofollow noopener noreferrer">base implementation</a> of a box plot from D3, but I found a great example by <a href="https://observablehq.com/@mukhtyar/box-plot" target="_blank" rel="nofollow noopener noreferrer">Shruti Mukhtar</a> to further tweak. To emphasize the difference in companies contributing EPDs, I also integrated a fade out upon hover to indicate all of the relevant plants for a given manufacturer.</p>
<div><figure>
    <span>
      <a href="https://matklad.github.io/static/b7f4a397cde62683888dd53bd9da6733/d3b46/concreteHUD.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/b7f4a397cde62683888dd53bd9da6733/8ac56/concreteHUD.webp 240w,
/static/b7f4a397cde62683888dd53bd9da6733/d3be9/concreteHUD.webp 480w,
/static/b7f4a397cde62683888dd53bd9da6733/e46b2/concreteHUD.webp 960w,
/static/b7f4a397cde62683888dd53bd9da6733/f992d/concreteHUD.webp 1440w,
/static/b7f4a397cde62683888dd53bd9da6733/3802d/concreteHUD.webp 1690w" sizes="(max-width: 960px) 100vw, 960px" type="image/webp"/>
          <source srcset="/static/b7f4a397cde62683888dd53bd9da6733/8ff5a/concreteHUD.png 240w,
/static/b7f4a397cde62683888dd53bd9da6733/e85cb/concreteHUD.png 480w,
/static/b7f4a397cde62683888dd53bd9da6733/d9199/concreteHUD.png 960w,
/static/b7f4a397cde62683888dd53bd9da6733/07a9c/concreteHUD.png 1440w,
/static/b7f4a397cde62683888dd53bd9da6733/d3b46/concreteHUD.png 1690w" sizes="(max-width: 960px) 100vw, 960px" type="image/png"/>
          <img src="https://matklad.github.io/static/b7f4a397cde62683888dd53bd9da6733/d9199/concreteHUD.png" alt="Concrete By Plant" title="Concrete By Plant" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span>
    <figcaption>Concrete By Plant</figcaption>
  </figure></div>
<h2 id="adapting-for-mobile"><a href="#adapting-for-mobile" aria-label="adapting for mobile permalink"></a>Adapting for mobile</h2>
<p>Making dense data visualizations work on mobile is <em>hard</em>. To facilitate use on mobile, I added some zooming and recentering features and made sure that the hover actions on desktop worked as touch selections on mobile. I also added dynamic text resizing to improve readability on mobile.</p>
<div><figure>
    <span>
      <a href="https://matklad.github.io/static/20e66147a0d9a073d7a7326db68eab71/a4f52/cmuHUD.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/20e66147a0d9a073d7a7326db68eab71/8ac56/cmuHUD.webp 240w,
/static/20e66147a0d9a073d7a7326db68eab71/d3be9/cmuHUD.webp 480w,
/static/20e66147a0d9a073d7a7326db68eab71/e46b2/cmuHUD.webp 960w,
/static/20e66147a0d9a073d7a7326db68eab71/f992d/cmuHUD.webp 1440w,
/static/20e66147a0d9a073d7a7326db68eab71/882b9/cmuHUD.webp 1920w,
/static/20e66147a0d9a073d7a7326db68eab71/f2636/cmuHUD.webp 2024w" sizes="(max-width: 960px) 100vw, 960px" type="image/webp"/>
          <source srcset="/static/20e66147a0d9a073d7a7326db68eab71/8ff5a/cmuHUD.png 240w,
/static/20e66147a0d9a073d7a7326db68eab71/e85cb/cmuHUD.png 480w,
/static/20e66147a0d9a073d7a7326db68eab71/d9199/cmuHUD.png 960w,
/static/20e66147a0d9a073d7a7326db68eab71/07a9c/cmuHUD.png 1440w,
/static/20e66147a0d9a073d7a7326db68eab71/29114/cmuHUD.png 1920w,
/static/20e66147a0d9a073d7a7326db68eab71/a4f52/cmuHUD.png 2024w" sizes="(max-width: 960px) 100vw, 960px" type="image/png"/>
          <img src="https://matklad.github.io/static/20e66147a0d9a073d7a7326db68eab71/d9199/cmuHUD.png" alt="CMU By Plant" title="CMU By Plant" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span>
    <figcaption>CMU By Plant</figcaption>
  </figure></div>
<h2 id="other-features-i-added-to-the-visualization"><a href="#other-features-i-added-to-the-visualization" aria-label="other features i added to the visualization permalink"></a>Other features I added to the visualization</h2>
<ul>
<li><a href="https://css-tricks.com/svg-path-syntax-illustrated-guide/" target="_blank" rel="nofollow noopener noreferrer">Creating custom paths</a> (including text paths) for adding context to the large categories</li>
<li>Adding a dumb version of geo-filtering by U.S. zip code based on <a href="https://gist.github.com/philngo/14d02e53b23a1d085d84#file-zipcode_to_lat_lng-json" target="_blank" rel="nofollow noopener noreferrer">this dataset</a>, since the raw data file size wasn’t <em>too</em> taxing</li>
</ul>
<h2 id="updating-the-plot"><a href="#updating-the-plot" aria-label="updating the plot permalink"></a>Updating the plot</h2>
<p>I completed the first “draft” of this data visualization in August 2022 and wanted to update the data to align with this blog post. The number of “active” EPDs in the EC3 database has nearly doubled since I last pulled information. My guess is a lot of the “date validity” fields in the dataset have been revised. Previously I was getting about 50k “active” EPDs, and now I’m getting over 90k “active” EPDs. EC3 has also revamped its developer experience (and changed the base API url).</p>
<p>However, the API is still definitely in a beta stage, and changes to the API aren’t published in a newsletter or easily accessible to developers. I found the core id hashes for some of the encompassing material categories (e.g. steel) have changed in the past six months, which broke my current data processing pipeline. As it stands, I’m still finding 26 EPDs over six category hashes that don’t match the current hierarcy from the API endpoint. There are also some underlying data quality issues, as a few errant EPDs have unexpected null fields (like the estimated GPW per category unit, which I would assume should never be null for a given EPD).</p>
<h2 id="future-improvements"><a href="#future-improvements" aria-label="future improvements permalink"></a>Future Improvements</h2>
<p>Some of the data could use additional cleanup work and filtering on the display of box plots. A number of the smaller categories have a small sample size, and the “whiskers” of the box plot can be confusing as a result (maybe a <a href="https://d3-graph-gallery.com/violin" target="_blank" rel="nofollow noopener noreferrer">violin plot</a> would be a better representation for these comparisons). I’d also like to have the chart “resize” when filtering geographically, rather than just fading out the irrelevant plants, as the large amount of empty space makes it difficult to navigate a filtered data set.</p>
<p>The number of individual svg elements in this visualization is pushing the bounds of “good” practice within D3, with ~3000 plant circles, plus a similar number of text representation as well as the heads up display. While I was working on this project, I started reading the excellent <a href="https://www.datasketch.es/" target="_blank" rel="nofollow noopener noreferrer">Data Sketches</a> book, and found that one of the authors, Nadieh Bremer, had a similar challenge with a <a href="https://www.visualcinnamon.com/2015/11/learnings-from-a-d3-js-addict-on-starting-with-canvas/" target="_blank" rel="nofollow noopener noreferrer">packing visualization</a>. She ended up working with the canvas, which I think might be the next step for me.</p>
<div><figure>
    <span>
      <a href="https://matklad.github.io/static/af0dc0d96b90573dc8e882bd527e0845/1ffbd/ec3epds.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/af0dc0d96b90573dc8e882bd527e0845/8ac56/ec3epds.webp 240w,
/static/af0dc0d96b90573dc8e882bd527e0845/d3be9/ec3epds.webp 480w,
/static/af0dc0d96b90573dc8e882bd527e0845/e46b2/ec3epds.webp 960w,
/static/af0dc0d96b90573dc8e882bd527e0845/f992d/ec3epds.webp 1440w,
/static/af0dc0d96b90573dc8e882bd527e0845/882b9/ec3epds.webp 1920w,
/static/af0dc0d96b90573dc8e882bd527e0845/d21eb/ec3epds.webp 2108w" sizes="(max-width: 960px) 100vw, 960px" type="image/webp"/>
          <source srcset="/static/af0dc0d96b90573dc8e882bd527e0845/8ff5a/ec3epds.png 240w,
/static/af0dc0d96b90573dc8e882bd527e0845/e85cb/ec3epds.png 480w,
/static/af0dc0d96b90573dc8e882bd527e0845/d9199/ec3epds.png 960w,
/static/af0dc0d96b90573dc8e882bd527e0845/07a9c/ec3epds.png 1440w,
/static/af0dc0d96b90573dc8e882bd527e0845/29114/ec3epds.png 1920w,
/static/af0dc0d96b90573dc8e882bd527e0845/1ffbd/ec3epds.png 2108w" sizes="(max-width: 960px) 100vw, 960px" type="image/png"/>
          <img src="https://matklad.github.io/static/af0dc0d96b90573dc8e882bd527e0845/d9199/ec3epds.png" alt="Final Visualization" title="Final Visualization" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span>
    <figcaption>Final Visualization</figcaption>
  </figure></div>
<p><a href="https://mclare.blog/visuals/ec3epds" target="_blank" rel="nofollow noopener noreferrer">Packing EC3 EPDs</a></p></div></div>
  </body>
</html>
