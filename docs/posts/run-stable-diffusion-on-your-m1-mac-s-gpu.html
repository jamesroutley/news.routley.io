<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://replicate.com/blog/run-stable-diffusion-on-m1-mac">Original</a>
    <h1>Run Stable Diffusion on Your M1 Macâ€™s GPU</h1>
    
    <div id="readability-page-1" class="page"><div>
    <p>Stable Diffusion is open source, so anyone can run and modify it. That&#39;s what has caused the <a href="https://multimodal.art/news/1-week-of-stable-diffusion">abundance</a> of <a href="https://twitter.com/simonw/status/1563555645453848581">creations</a> over the past week.</p>
<p>You can <a href="https://replicate.com/stability-ai/stable-diffusion">run Stable Diffusion in the cloud on Replicate</a>, but it&#39;s also possible to run it locally. As well as generating predictions, you can hack on it, modify it, and build new things. Getting it working on an M1 Mac&#39;s GPU is a little fiddly, so we&#39;ve created this guide to show you how to do it.</p>
<p>All credit for this goes to everyone who contributed to <a href="https://github.com/magnusviri/stable-diffusion">this fork of stable-diffusion on GitHub</a> and figured it all out in <a href="https://github.com/CompVis/stable-diffusion/issues/25">this GitHub thread</a>. We&#39;re merely messengers of their great work.</p>
<p>One thing we&#39;ve done on top of previous work: use pip instead of Conda to install dependencies. It&#39;s much easier to set up and shouldn&#39;t need to compile anything because it uses binary wheels.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>A Mac with an M1 or M2 chip.</li>
<li>macOS 12.3 or higher.</li>
</ul>
<h2 id="set-up-python">Set up Python</h2>
<p>You need Python 3.10 to run Stable Diffusion. Run <code>python -V</code> to see what Python version you have installed:</p>
<pre><code>$ python3 -V                                                                                       !11338
Python 3.10.6
</code></pre>
<p>If it&#39;s 3.10 or above, like here, you&#39;re good to go! Skip on over to the next step.</p>
<p>Otherwise, you&#39;ll need to install Python 3.10. The easiest way to do that is with Homebrew. First, <a href="https://brew.sh/">install Homebrew</a> if you haven&#39;t already.</p>
<p>Then, install the latest version of Python:</p>
<pre><code>brew update
brew install python
</code></pre>
<p>Now if you run <code>python3 -V</code> you should have 3.10 or above. You might need to reopen your console to make it work.</p>
<h2 id="clone-the-repository-and-install-the-dependencies">Clone the repository and install the dependencies</h2>
<p>Run this to clone the fork of Stable Diffusion:</p>
<pre><code>git clone -b apple-silicon-mps-support https://github.com/bfirsh/stable-diffusion.git
cd stable-diffusion
mkdir -p models/ldm/stable-diffusion-v1/
</code></pre>
<p>Then, set up a virtualenv to install the dependencies:</p>
<pre><code>python3 -m pip install virtualenv
python3 -m virtualenv venv
</code></pre>
<p>Activate the virtualenv:</p>
<pre><code>. venv/bin/activate
</code></pre>
<p>(You&#39;ll need to run this command again any time you want to run Stable Diffusion.)</p>
<p>Then, install the dependencies:</p>
<pre><code>pip install -r requirements.txt
</code></pre>
<p>If you&#39;re seeing errors like <code>Failed building wheel for onnx</code> you might need to install these packages:</p>
<pre><code>brew install Cmake protobuf rust
</code></pre>
<h2 id="download-the-weights">Download the weights</h2>
<p>Go to the <a href="https://huggingface.co/CompVis/stable-diffusion-v-1-4-original">Hugging Face repository</a>, have a read and understand the license, then click &#34;Access repository&#34;.</p>
<p>Download <code>sd-v1-4.ckpt</code> (~4 GB) on that page and save it as <code>models/ldm/stable-diffusion-v1/model.ckpt</code> in the directory you created above.</p>
<h2 id="run-it">Run it!</h2>
<p>Now, you can run Stable Diffusion:</p>
<pre><code>python scripts/txt2img.py \
  --prompt &#34;a red juicy apple floating in outer space, like a planet&#34; \
  --n_samples 1 --n_iter 1 --plms
</code></pre>
<p>Your output&#39;s in <code>outputs/txt2img-samples/</code>. That&#39;s it.</p>
<p><img alt="" src="https://replicate.com/static/blog/run-stable-diffusion-on-m1-mac/grid-0002.png"/></p>
<h2 id="next-steps">Next steps</h2>
<p>If you&#39;re struggling to get this set up, <a href="https://discord.gg/replicate">ask in our Discord for some help</a>.</p>
<p>You might want to dig into the source code to see what you can modify. For inspiration, take a look at <a href="https://colab.research.google.com/github/deforum/stable-diffusion/blob/main/Deforum_Stable_Diffusion.ipynb">Deforum&#39;s Colab notebook</a> which can do a whole bunch of stuff, like image-to-image, interpolation, videos, and so on.</p>
<p>Happy hacking!</p>
  </div></div>
  </body>
</html>
