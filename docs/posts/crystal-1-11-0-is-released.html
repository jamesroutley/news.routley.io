<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://crystal-lang.org/2024/01/08/1.11.0-released/">Original</a>
    <h1>Crystal 1.11.0 Is Released</h1>
    
    <div id="readability-page-1" class="page"><div>
        <p>We are announcing a new Crystal release with several new features and bug fixes.</p>

<p>Pre-built packages are available on <a href="https://github.com/crystal-lang/crystal/releases/tag/1.11.0">GitHub Releases</a>
and our official distribution channels.
See <a href="https://crystal-lang.org/install/">crystal-lang.org/install</a> for
installation instructions.</p>

<h2 id="stats">Stats</h2>

<p>This release includes <a href="https://github.com/crystal-lang/crystal/pulls?q=is%3Apr+milestone%3A1.11.0">178 changes since 1.10.1</a>
by 28 contributors. We thank all the contributors for all the effort put into
improving the language! ‚ù§Ô∏è</p>

<h2 id="changes">Changes</h2>

<p>Below we list the most remarkable changes in the language, compiler and stdlib.
This is a pretty big release with lots of things going on, so hold tight üöÄ</p>

<p>For details, visit the <a href="https://github.com/crystal-lang/crystal/releases/tag/1.11.0">full changelog</a>.</p>

<h3 id="llvm-18">LLVM 18</h3>

<p>One of the biggest steps forward is support for upcoming LLVM 18 which allows linking LLVM dynamically on Windows (<a href="https://github.com/crystal-lang/crystal/pull/14101">#14101</a>).
Additionally, LLVM 18 now provides everything we need in the upstream C API, removing the need for our wrapper extension <code><span>llvm_ext</span></code>. It‚Äôs still necessary for older LLVM versions, so we‚Äôll keep it around for a while. But the future tool chain is getting simplified. Read more in <a href="https://github.com/crystal-lang/crystal/issues/13946">#13946</a>.</p>

<p><em>Thanks <a href="https://github.com/HertzDevil">@HertzDevil</a></em></p>

<h3 id="compiler-optimization-levels">Compiler Optimization Levels</h3>

<p>The compiler gains four distinct optimization levels:</p>

<ul>
  <li><code><span>-</span><span>O0</span></code>: No optimization</li>
  <li><code><span>-</span><span>O1</span></code>: Low optimization</li>
  <li><code><span>-</span><span>O2</span></code>: Middle optimization</li>
  <li><code><span>-</span><span>O3</span></code>: High optimization</li>
</ul>

<p>Each level activates the respective LLVM <code><span>RunPasses</span></code> and <code><span>CodeGenOptLevel</span></code> optimizations.</p>

<p><code><span>-</span><span>O3</span></code> corresponds to the existing release mode and <code><span>-</span><span>O0</span></code> corresponds to the default non-release mode. <code><span>-</span><span>O0</span></code> remains the default and <code><span>--</span><span>release</span></code> is equivalent to <code><span>-</span><span>O3</span> <span>--</span><span>single</span><span>-</span><span>module</span></code>.</p>

<p>Effectively, this introduces two optimization choices between the previous full or nothing. And it‚Äôs now possible to use high optimization without <code><span>--</span><span>single</span><span>-</span><span>module</span></code>.</p>

<p>Read more in <a href="https://github.com/crystal-lang/crystal/pull/13464">#13464</a>.</p>

<p><em>Thanks <a href="https://github.com/kostya">@kostya</a></em></p>

<h3 id="alignment-primitives">Alignment primitives</h3>

<p>The language has two new reflection primitives: <a href="https://crystal-lang.org/reference/1.11/syntax_and_semantics/alignof.html"><code><span>alignof</span></code></a> and <a href="https://crystal-lang.org/reference/1.11/syntax_and_semantics/instance_alignof.html"><code><span>instance_alignof</span></code></a> return a type‚Äôs memory alignment (<a href="https://github.com/crystal-lang/crystal/pull/14087">#14087</a>). This allows implementing type-aware allocators in native Crystal with properly aligned pointers.
They are siblings of <code><span>sizeof</span></code> and <code><span>instance_sizeof</span></code> and can be used in the same way.</p>

<div><div><pre><code><span>class</span> <span>Foo</span>
  <span>def</span> <span>initialize</span><span>(</span><span>@x</span> <span>:</span> <span>Int8</span><span>,</span> <span>@y</span> <span>:</span> <span>Int64</span><span>,</span> <span>@z</span> <span>:</span> <span>Int16</span><span>)</span>
  <span>end</span>
<span>end</span>

<span>Foo</span><span>.</span><span>new</span><span>(</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>)</span>

<span>instance_alignof</span><span>(</span><span>Foo</span><span>)</span> <span># =&gt; 8</span>
</code></pre></div></div>

<div>
  
    <h4>Effect on existing code</h4>
  
  <p>The introduction of these primitives makes it impossible to define methods of the same names. So <code><span>def</span> <span>alignof</span></code> or <code><span>def</span> <span>instance_alignof</span></code> are now invalid syntax.
 We don‚Äôt expect there to be a big impact in practice.</p>
</div>

<p><em>Thanks <a href="https://github.com/HertzDevil">@HertzDevil</a></em></p>

<h3 id="dll-parameter-in-link-annotation"><code><span>dll</span></code> parameter in <code><span>Link</span></code> annotation</h3>

<p>The <a href="https://crystal-lang.org/api/1.11.0/Link.html"><code><span>Link</span></code></a> annotation has a new parameter <code><span>dll</span></code> for specifying dynamic link libraries on Windows (<a href="https://github.com/crystal-lang/crystal/pull/14131">#14131</a>).</p>

<div><div><pre><code><span>@[Link(dll: &#34;foo.dll&#34;)]</span>
<span>lib</span> <span>LibFoo</span>
<span>end</span>
</code></pre></div></div>

<p><em>Thanks <a href="https://github.com/HertzDevil">@HertzDevil</a></em></p>

<h3 id="macro-caller-context">Macro <code><span>@caller</span></code> context</h3>

<p>Macros now have a reference to their calling context via the special instance variable <a href="https://crystal-lang.org/reference/1.11/syntax_and_semantics/macros/index.html#call-information"><code><span>@caller</span></code></a> (<a href="https://github.com/crystal-lang/crystal/issues/14055">#14055</a>).</p>

<div><div><pre><code><span>macro</span> <span>foo</span>
  <span>{{</span> <span>@caller</span><span>.</span><span>line_number</span> <span>}}</span>
<span>end</span>

<span>foo</span> <span># =&gt; 5</span>
</code></pre></div></div>

<p><em>Thanks <a href="https://github.com/Blacksmoke16">@Blacksmoke16</a></em></p>

<h3 id="new-collection-methods">New collection methods</h3>

<p><a href="https://crystal-lang.org/api/1.11.0/Enumerable.html#present?:Bool-instance-method"><code><span>Enumerable</span><span>#present?</span></code></a> is a direct inversion of <code><span>#empty?</span></code> avoiding some quirks with the similar, but not-quite, <code><span>#any?</span></code> (<a href="https://github.com/crystal-lang/crystal/issues/13847">#13847</a>).</p>

<p><em>Thanks <a href="https://github.com/straight-shoota">@straight-shoota</a></em></p>

<p><a href="https://crystal-lang.org/api/1.11.0/Enumerable.html#each_step(n:Int,*,offset:Int=0,&amp;:T-%3E):Nil-instance-method"><code><span>Enumerable</span><span>#each_step</span></code></a> and <a href="https://crystal-lang.org/api/1.11.0/Iterable.html#each_step(n:Int)-instance-method"><code><span>Iterable</span><span>#each_step</span></code></a> are direct methods for creating step iterators (<a href="https://github.com/crystal-lang/crystal/pull/13610">#13610</a>).</p>

<p><em>Thanks <a href="https://github.com/baseballlover723">@baseballlover723</a></em></p>

<p><a href="https://crystal-lang.org/api/1.11.0/Enumerable.html#to_set(&amp;block:T-%3EU):Set(U)forallU-instance-method"><code><span>Enumerable</span><span>(</span><span>T</span><span>)</span><span>#to_set(&amp; : T -&gt; U) : Set(U) forall U</span></code></a> and <a href="https://crystal-lang.org/api/1.11.0/Enumerable.html#to_a%28%26%3AT-%3EU%29%3AArray%28U%29forallU-instance-method"><code><span>#to_a(&amp; : T -&gt; U) forall U</span></code></a> allow materialising an <code><span>Enumerable</span></code> into a pre-defined collection, which gives more flexibility than the standard <code><span>#to_set</span></code> and <code><span>#to_a</span></code> methods (<a href="https://github.com/crystal-lang/crystal/pull/12654">#12654</a>, <a href="https://github.com/crystal-lang/crystal/pull/12653">#12653</a>).</p>

<p><em>Thanks <a href="https://github.com/caspiano">@caspiano</a></em></p>

<h3 id="numeric-enhancements">Numeric enhancements</h3>

<p><a href="https://crystal-lang.org/api/1.11.0/BigFloat.html#%2A%2A%28other%3ABigInt%29%3ABigFloat-instance-method"><code><span>BigFloat</span><span>#**</span></code></a> now works for all <code><span>Int</span><span>::</span><span>Primitive</span></code> arguments and supports the full exponent range for <code><span>BitInt</span></code> arguments (<a href="https://github.com/crystal-lang/crystal/pull/13971">#13971</a>, <a href="https://github.com/crystal-lang/crystal/pull/13881">#13881</a>)</p>

<p>Floating point to string conversion in <code><span>printf</span></code> uses the Ryu algorithm (<a href="https://github.com/crystal-lang/crystal/issues/8441">#8441</a>).</p>

<p>New methods <a href="https://crystal-lang.org/api/1.11.0/Float64.html#to_hexfloat:String-instance-method"><code><span>Float</span><span>::</span><span>Primitive</span><span>.</span><span>to_hexfloat</span></code></a>, <a href="https://crystal-lang.org/api/1.11.0/Float64.html#parse_hexfloat(str:String):self-class-method"><code><span>.</span><span>parse_hexfloat</span></code></a>, and <a href="https://crystal-lang.org/api/1.11.0/Float64.html#parse_hexfloat(str:String):self-class-method"><code><span>.</span><span>parse_hexfloat?</span></code></a> allow conversion to and from the hexfloat format (<a href="https://github.com/crystal-lang/crystal/pull/14027">#14027</a>).</p>

<p>More math features:</p>

<ul>
  <li><a href="https://crystal-lang.org/api/1.11.0/Math.html#fma(value1,value2,value3)-instance-method"><code><span>Math</span><span>.</span><span>fma</span></code></a> (<a href="https://github.com/crystal-lang/crystal/pull/13934">#13934</a>)</li>
  <li><a href="https://crystal-lang.org/api/1.11.0/Number.html#integer?:Bool-instance-method"><code><span>Number</span><span>#integer?</span></code></a> (<a href="https://github.com/crystal-lang/crystal/pull/13936">#13936</a>)</li>
  <li><a href="https://crystal-lang.org/api/1.11.0/Int32.html#abs_unsigned:UInt32-instance-method"><code><span>Int32</span><span>#abs_unsigned</span></code></a>, <a href="https://crystal-lang.org/api/1.11.0/Int32.html#neg_signed:self-instance-method"><code><span>#neg_signed</span></code></a> (<a href="https://github.com/crystal-lang/crystal/pull/13938">#13938</a>)</li>
  <li><a href="https://crystal-lang.org/api/1.11.0/Int32.html#to_signed:Int32-instance-method"><code><span>Int</span><span>::</span><span>Primitive</span><span>#to_signed</span></code></a>, <a href="https://crystal-lang.org/api/1.11.0/Int32.html#to_signed%21%3AInt32-instance-method"><code><span>#to_signed!</span></code></a>, <a href="https://crystal-lang.org/api/1.11.0/Int32.html#to_unsigned:UInt32-instance-method"><code><span>#to_unsigned</span></code></a>, <a href="https://crystal-lang.org/api/1.11.0/Int32.html#to_unsigned%21%3AUInt32-instance-method"><code><span>#to_unsigned!</span></code></a> (<a href="https://github.com/crystal-lang/crystal/pull/13960">#13960</a>)</li>
</ul>

<p><em>Thanks <a href="https://github.com/HertzDevil">@HertzDevil</a></em></p>

<h3 id="enhancements-for-crystal-spec">Enhancements for <code><span>crystal</span> <span>spec</span></code></h3>

<p><code><span>crystal</span> <span>spec</span></code> gets two new commands for introspection:</p>

<p><code><span>crystal</span> <span>spec</span> <span>--</span><span>dry</span><span>-</span><span>run</span></code> prints all active specs without actually executing any spec code (<a href="https://github.com/crystal-lang/crystal/pull/13804">#13804</a>).</p>

<p><em>Thanks <a href="https://github.com/nobodywasishere">@nobodywasishere</a></em></p>

<p><code><span>crystal</span> <span>spec</span> <span>--</span><span>list</span><span>-</span><span>tags</span></code> lists all tags defined in the spec suite (<a href="https://github.com/crystal-lang/crystal/pull/13616">#13616</a>).</p>

<p><em>Thanks <a href="https://github.com/baseballlover723">@baseballlover723</a></em></p>

<h3 id="enhancements-for-crystal-tool-unreachable">Enhancements for <code><span>crystal</span> <span>tool</span> <span>unreachable</span></code></h3>

<p>The basic implementation of <code><span>crystal</span> <span>tool</span> <span>unreachable</span></code> from Crystal 1.10 gets some useful enhancements.</p>

<ul>
  <li>The <code><span>--</span><span>tallies</span></code> option prints all methods and the total number of calls. Those with a zero tally are unreachable (<a href="https://github.com/crystal-lang/crystal/pull/13969">#13969</a>).</li>
  <li>The <code><span>--</span><span>check</span></code> flag exits with a failure status if there is any unreachable code (<a href="https://github.com/crystal-lang/crystal/pull/13930">#13930</a>).</li>
  <li>Annotations show up in the output (<a href="https://github.com/crystal-lang/crystal/pull/13927">#13927</a>).</li>
  <li>New output format: CSV (<a href="https://github.com/crystal-lang/crystal/pull/13926">#13926</a>).</li>
  <li>Paths in the output are relativized, making it more succinct (<a href="https://github.com/crystal-lang/crystal/pull/13929">#13929</a>).</li>
</ul>

<p><em>Thanks <a href="https://github.com/straight-shoota">@straight-shoota</a></em></p>

<h3 id="inherited-macros-in-api-docs">Inherited macros in API docs</h3>

<p>Inherited macros are now exposed in the API docs. They had previously been hidden, in contrast to inherited defs (<a href="https://github.com/crystal-lang/crystal/pull/13810">#13810</a>).</p>

<p><em>Thanks <a href="https://github.com/Blacksmoke16">@Blacksmoke16</a></em></p>

<h3 id="text">Text</h3>

<ul>
  <li><a href="https://crystal-lang.org/api/1.11.0/Regex/MatchData.html#to_s:String-instance-method"><code><span>Regex</span><span>::</span><span>MatchData</span><span>#to_s</span></code></a> returns the matched substring (<a href="https://github.com/crystal-lang/crystal/pull/14115">#14115</a>).
  <em>Thanks <a href="https://github.com/Vendicated">@Vendicated</a></em></li>
  <li>The new <a href="https://crystal-lang.org/api/1.11.0/toplevel.html#EOL"><code><span>EOL</span></code></a>constant (End-Of-Line) is a portable reference to the system-specific new line character sequence (<a href="https://github.com/crystal-lang/crystal/pull/11303">#11303</a>). <em>Thanks <a href="https://github.com/postmodern">@postmodern</a></em></li>
  <li>We got new version-specific constructors for <a href="https://crystal-lang.org/api/1.11.0/UUID.html"><code><span>UUID</span></code></a>: <a href="https://crystal-lang.org/api/1.11.0/UUID.html#v1%28%2A%2Cclock_seq%3AUInt16%7CNil%3Dnil%2Cnode_id%3AMAC%7CNil%3Dnil%29%3Aself-class-method"><code><span>.</span><span>v1</span></code></a>, <a href="https://crystal-lang.org/api/1.11.0/UUID.html#v2%28domain%3ADomain%2Cid%3AUInt32%2Cnode_id%3AMAC%7CNil%3Dnil%29%3Aself-class-method"><code><span>.</span><span>v2</span></code></a>, <a href="https://crystal-lang.org/api/1.11.0/UUID.html#v3%28name%3AString%2Cnamespace%3AUUID%29%3Aself-class-method"><code><span>.</span><span>v3</span></code></a>, <a href="https://crystal-lang.org/api/1.11.0/UUID.html#v4%28randomr%3ARandom%3DRandom%3A%3ASecure%29%3Aself-class-method"><code><span>.</span><span>v4</span></code></a>, and <a href="https://crystal-lang.org/api/1.11.0/UUID.html#v5%28name%3AString%2Cnamespace%3AUUID%29%3Aself-class-method"><code><span>.</span><span>v5</span></code></a> (<a href="https://github.com/crystal-lang/crystal/pull/13693">#13693</a>).
  <em>Thanks <a href="https://github.com/threez">@threez</a></em></li>
  <li><a href="https://crystal-lang.org/api/1.11.0/StringScanner.html"><code><span>StringScanner</span></code></a> now supports <code><span>String</span></code> and <code><span>Char</span></code> patterns (<a href="https://github.com/crystal-lang/crystal/pull/13806">#13806</a>).
  <em>Thanks <a href="https://github.com/funny-falcon">@funny-falcon</a></em></li>
  <li><code><span>Char</span><span>::</span><span>Reader</span></code> got some nilable character accessors: <a href="https://crystal-lang.org/api/1.11.0/Char/Reader.html#current_char%3F%3AChar%7CNil-instance-method"><code><span>#current_char?</span></code></a>, <a href="https://crystal-lang.org/api/1.11.0/Char/Reader.html#next_char%3F%3AChar%7CNil-instance-method"><code><span>#next_char?</span></code></a>, <a href="https://crystal-lang.org/api/1.11.0/Char/Reader.html#previous_char%3F%3AChar%7CNil-instance-method"><code><span>#previous_char?</span></code></a> (<a href="https://github.com/crystal-lang/crystal/pull/14012">#14012</a>).
  <em>Thanks <a href="https://github.com/HertzDevil">@HertzDevil</a></em></li>
  <li><a href="https://crystal-lang.org/api/1.11.0/String.html#matches_full?(regex:Regex):Bool-instance-method"><code><span>String</span><span>#matches_full?</span></code></a> is a simple API when you need a regular expression to match the entire string (<a href="https://github.com/crystal-lang/crystal/pull/13968">#13968</a>).
  <em>Thanks <a href="https://github.com/straight-shoota">@straight-shoota</a></em></li>
</ul>

<h3 id="misc">Misc</h3>

<ul>
  <li>The capacity of <code><span>String</span><span>::</span><span>Buffer</span></code> and <code><span>IO</span><span>::</span><span>Memory</span></code> was unintentionally limited to 1GB. They now support the full range up to <code><span>Int32</span><span>::</span><span>MAX</span></code>, i.e. 2GB (<a href="https://github.com/crystal-lang/crystal/pull/13989">#13989</a>).
  <em>Thanks <a href="https://github.com/straight-shoota">@straight-shoota</a></em></li>
  <li>There was a nasty bug in <code><span>Number</span><span>#format</span></code> which could mess with the integral part. It is now fixed in <a href="https://github.com/crystal-lang/crystal/pull/14061">#14061</a>.
  <em>Thanks <a href="https://github.com/HertzDevil">@HertzDevil</a></em></li>
  <li>Vendored shards <code><span>markd</span></code> and <code><span>reply</span></code> are no longer referenced by paths relative to the compiler source tree. This means they can be local dependencies (i.e. in <code><span>lib</span></code>) when using the compiler as a library (<a href="https://github.com/crystal-lang/crystal/pull/13992">#13992</a>).
  <em>Thanks <a href="https://github.com/nobodywasishere">@nobodywasishere</a></em></li>
  <li>There are two new constants which provide information on the compiler host and target: <code><span>Crystal</span><span>::</span><span>HOST_TRIPLE</span></code> and <code><span>TARGET_TRIPLE</span></code> (<a href="https://github.com/crystal-lang/crystal/pull/13823">#13823</a>).
  <em>Thanks <a href="https://github.com/HertzDevil">@HertzDevil</a></em></li>
</ul>

<h3 id="shards-0174">Shards 0.17.4</h3>

<p>The bundled shards release was updated to <a href="https://github.com/crystal-lang/shards/releases/tag/v0.17.4">0.17.4</a> which brings a couple minor bugfixes. (<a href="https://github.com/crystal-lang/crystal/pull/14133">#14133</a>).</p>

<p><em>Thanks <a href="https://github.com/straight-shoota">@straight-shoota</a></em></p>

<h3 id="experimental-referencestorage-and-pre_initialize">Experimental: <code><span>ReferenceStorage</span></code> and <code><span>.</span><span>pre_initialize</span></code></h3>

<p>We‚Äôve started an effort to make it easier to use custom allocation mechanisms in Crystal and decouple allocation from initialization.
The main tool is <a href="https://crystal-lang.org/api/1.11.0/Reference.html#pre_initialize(address:Pointer)-class-method"><code><span>Reference</span><span>.</span><span>pre_initialize</span></code></a> which performs the rudimentary object initialization, before actually calling <code><span>#initialize</span></code>.</p>

<p><a href="https://crystal-lang.org/api/1.11.0/Reference.html#unsafe_construct%28address%3APointer%2C%2Aargs%2C%2A%2Aopts%29%3Aself-class-method"><code><span>Reference</span><span>.</span><span>unsafe_construct</span></code></a> is a higher level API on top of that.
<a href="https://crystal-lang.org/api/1.11.0/ReferenceStorage.html"><code><span>ReferenceStorage</span></code></a> represents a static buffer for a reference allocation.</p>

<p>These APIs are experimental and might be subject to change. We expect more features in this direction in future releases. Join the discussion about custom reference allocation at <a href="https://github.com/crystal-lang/crystal/issues/13481">#13481</a>.</p>

<blockquote>
  <p><em>NOTE:</em> <code><span>ReferenceStorage</span></code> was removed again in 1.11.1 due to compatibility issues with older versions of the standard library (<a href="https://github.com/crystal-lang/crystal/pull/14207">#14207</a>). It will come back with an improved implementation.</p>
</blockquote>

<p><em>Thanks <a href="https://github.com/HertzDevil">@HertzDevil</a></em></p>

<h2 id="deprecations">Deprecations</h2>

<ul>
  <li>Splat operators in macro expressions are deprecated. Use <code><span>.</span><span>splat</span></code> instead (<a href="https://github.com/crystal-lang/crystal/pull/13939">#13939</a>)</li>
  <li><code><span>LLVM</span><span>.</span><span>start_multithreaded</span></code> and <code><span>.</span><span>stop_multithreaded</span></code>. They have no effect (<a href="https://github.com/crystal-lang/crystal/pull/13949">#13949</a>)</li>
  <li><code><span>LLVMExtSetCurrentDebugLocation</span></code> from <code><span>llvm_ext</span><span>.</span><span>cc</span></code> for LLVM 9+ (<a href="https://github.com/crystal-lang/crystal/pull/13965">#13965</a>)</li>
  <li><code><span>Char</span><span>::</span><span>Reader</span><span>#@end</span></code> (<a href="https://github.com/crystal-lang/crystal/pull/13920">#13920</a>)</li>
</ul>

<hr/>

<p>We have been able to do all of this thanks to the continued support of <a href="https://www.84codes.com/">84codes</a> and every other <a href="https://crystal-lang.org/sponsors">sponsor</a>.
To maintain and increase the development pace, donations and sponsorships are
essential. <a href="https://opencollective.com/crystal-lang">OpenCollective</a> is
available for that. Reach out to <a href="mailto:crystal@manas.tech">crystal@manas.tech</a>
if you‚Äôd like to become a direct sponsor or find other ways to support Crystal.
We thank you in advance!</p>

      </div></div>
  </body>
</html>
