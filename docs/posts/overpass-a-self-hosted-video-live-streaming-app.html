<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/GOATS2K/overpass">Original</a>
    <h1>Show HN: Overpass â€“ a self-hosted video live streaming app</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text">
<p dir="auto">Overpass makes it easy to host your own live streaming server with features such as authentication via Discord, stream playback in your web browser, and an easy way to archive your streams for your users to rewatch!</p>
<p dir="auto">Overpass also lets you run a private instance for a users on a single Discord server. Simply add the server ID of your Discord server to the configuration file and Overpass will take care of the rest.</p>
<p dir="auto">Powered by nginx-rtmp.</p>

<ul dir="auto">
<li>Python 3.8+</li>
<li>Nginx with the <a href="https://github.com/arut/nginx-rtmp-module">nginx-rtmp module</a> installed</li>
<li>FFmpeg</li>
<li>A Discord app</li>
</ul>

<h2 dir="auto"><a id="user-content-creating-the-discord-app-for-overpass" aria-hidden="true" href="#creating-the-discord-app-for-overpass"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Creating the Discord app for Overpass</h2>
<p dir="auto">Navigate to <a href="https://discord.com/developers/applications" rel="nofollow">Discord&#39;s Developer Portal</a>.</p>
<ul dir="auto">
<li>Select &#34;New Application&#34; in the top left corner</li>
<li>Choose a name for your application</li>
<li>Select the &#34;OAuth2&#34; tab</li>
<li>Find the &#34;Client Information&#34; section of the page, and copy your &#34;Client ID&#34; and your &#34;Client Secret&#34; and save these for use in the configuration file</li>
<li>Click &#34;Add redirect&#34; and type in a URI like so:</li>
</ul>
<p dir="auto"><code>https://overpass.dev/auth/callback</code> - replacing <code>overpass.dev</code> with your domain name.</p>
<p dir="auto"><strong>Note:</strong> If you wish to develop on Overpass, you will have to add <code>http://localhost:5000/auth/callback</code> to your list of redirect URIs.</p>

<h2 dir="auto"><a id="user-content-docker-usage" aria-hidden="true" href="#docker-usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Docker Usage</h2>
<p dir="auto">There is a Docker image for Overpass, which you can either build yourself with the Dockerfile, or <a href="https://hub.docker.com/r/goats2k/overpass" rel="nofollow">download from the Docker Hub</a>.</p>
<p dir="auto">This image is pre-configured to run Overpass in production mode with Gunicorn, so if you wish to develop on Overpass, you may need to change <code>docker/startup.sh</code> to execute <code>flask run</code>, and modifying the route to Overpass&#39; API in the nginx configuration.</p>
<p dir="auto"><em>Continue reading if you wish to run Overpass on bare-metal, otherwise, you can use the <a href="https://github.com/GOATS2K/overpass/blob/master/docker-compose.example">example Docker Compose file</a>.</em></p>
<h2 dir="auto"><a id="user-content-creating-a-config-file" aria-hidden="true" href="#creating-a-config-file"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Creating a config file</h2>
<p dir="auto"><strong>Note: If you are using Docker, set these values as environment variables. See the <a href="https://github.com/GOATS2K/overpass/blob/master/docker-compose.example">example Docker Compose file</a>. You will <em>not</em> have to create the <code>.env</code> file.</strong></p>
<h3 dir="auto"><a id="user-content-generate-a-secret-key" aria-hidden="true" href="#generate-a-secret-key"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Generate a secret key</h3>
<p dir="auto">Run <code>python -c &#34;import os; print(os.urandom(16))&#34;</code> and copy the output <strong>after the byte symbol</strong> into <code>OVERPASS_SECRET_KEY</code></p>
<p dir="auto"><strong>Create an empty <code>.env</code> file, in the projects&#39; root directory</strong> which contains the following:</p>
<div data-snippet-clipboard-copy-content="DISCORD_CLIENT_ID =
DISCORD_CLIENT_SECRET = &#34;&#34;
DISCORD_REDIRECT_URI = &#34;&#34;
DISCORD_GUILD_ID = (if you want to restrict access to the tool to users from a certain guild ID - set one here)


OVERPASS_SECRET_KEY = &#34;your generated key here&#34;

HLS_PATH = &#34;&#34;
REC_PATH = &#34;&#34;
RTMP_SERVER = (IP address and port of your RTMP server - as a string)"><pre><code>DISCORD_CLIENT_ID =
DISCORD_CLIENT_SECRET = &#34;&#34;
DISCORD_REDIRECT_URI = &#34;&#34;
DISCORD_GUILD_ID = (if you want to restrict access to the tool to users from a certain guild ID - set one here)


OVERPASS_SECRET_KEY = &#34;your generated key here&#34;

HLS_PATH = &#34;&#34;
REC_PATH = &#34;&#34;
RTMP_SERVER = (IP address and port of your RTMP server - as a string)
</code></pre></div>
<h3 dir="auto"><a id="user-content-example-config" aria-hidden="true" href="#example-config"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Example config</h3>
<div data-snippet-clipboard-copy-content="DISCORD_CLIENT_ID = 31040105101013151
DISCORD_CLIENT_SECRET = &#34;1251XXXXXXXXXXXXXXXXXXXXX&#34;
DISCORD_REDIRECT_URI = &#34;https://overpass.dev/auth/callback&#34;
DISCORD_GUILD_ID = 05105010105619519

OVERPASS_SECRET_KEY = &#34;#\x1an\x1an\x1an\x1an\x1an&#34;

HLS_PATH = &#34;/storage/overpass/hls&#34;
REC_PATH = &#34;/storage/overpass/archive&#34;

RTMP_SERVER = &#34;overpass.dev:1935/live&#34;"><pre><code>DISCORD_CLIENT_ID = 31040105101013151
DISCORD_CLIENT_SECRET = &#34;1251XXXXXXXXXXXXXXXXXXXXX&#34;
DISCORD_REDIRECT_URI = &#34;https://overpass.dev/auth/callback&#34;
DISCORD_GUILD_ID = 05105010105619519

OVERPASS_SECRET_KEY = &#34;#\x1an\x1an\x1an\x1an\x1an&#34;

HLS_PATH = &#34;/storage/overpass/hls&#34;
REC_PATH = &#34;/storage/overpass/archive&#34;

RTMP_SERVER = &#34;overpass.dev:1935/live&#34;
</code></pre></div>
<h2 dir="auto"><a id="user-content-streaming-server-setup" aria-hidden="true" href="#streaming-server-setup"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Streaming server setup</h2>
<ul dir="auto">
<li>Create the directories you defined in <code>HLS_PATH</code> and <code>REC_PATH</code> and make sure to give <code>www-data</code> write permissions to said folder.</li>
</ul>
<p dir="auto"><em>Make sure the user the Overpass is running as also has read and write access to the same folders.</em></p>
<p dir="auto"><em>Remember to change the <code>on_publish</code> and <code>on_done</code> URIs, <code>record_path</code> and <code>hls_path</code> variables to match your environment</em></p>
<p dir="auto">Edit your <code>nginx.conf</code> file to contain the following information.</p>
<div data-snippet-clipboard-copy-content="rtmp {
    server {
        listen 1935;
        on_publish http://127.0.0.1:5000/api/rtmp/connect;
        on_done http://127.0.0.1:5000/api/rtmp/done;

        application live {
            deny play all;
            live on;
            record all;
            record_path /storage/overpass/archive;
            record_append on;

            hls on;
            hls_path /storage/overpass/hls;
            hls_fragment 2;
            hls_playlist_length 10;
            exec_record_done bash -c &#34;/usr/bin/ffmpeg -i $path -acodec copy -vcodec copy -movflags +faststart /your/recording/path/$basename.mp4 &amp;&amp; rm $path&#34;;
         }
    }
}

"><pre><span>rtmp</span> {
    <span>server</span> {
        <span>listen</span> <span>1935</span>;
        <span>on_publish</span> http://127.0.0.1:5000/api/rtmp/connect;
        <span>on_done</span> http://127.0.0.1:5000/api/rtmp/done;

        <span>application</span> live {
            <span>deny</span> play<span> all</span>;
            <span>live</span> on;
            <span>record</span> all;
            <span>record_path</span> /storage/overpass/archive;
            <span>record_append</span> on;

            <span>hls</span> on;
            <span>hls_path</span> /storage/overpass/hls;
            <span>hls_fragment</span> 2;
            <span>hls_playlist_length</span> 10;
            <span>exec_record_done</span> bash -c <span>&#34;/usr/bin/ffmpeg -i <span>$path</span> -acodec copy -vcodec copy -movflags +faststart /your/recording/path/<span>$basename</span>.mp4 &amp;&amp; rm <span>$path</span>&#34;</span>;
         }
    }
}

</pre></div>

<ul dir="auto">
<li>Run <code>flask init-db</code> to initialize the database.</li>
</ul>
<h2 dir="auto"><a id="user-content-development-mode" aria-hidden="true" href="#development-mode"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Development mode</h2>
<ul dir="auto">
<li>Run <code>flask run</code></li>
</ul>
<h2 dir="auto"><a id="user-content-deploying-to-production" aria-hidden="true" href="#deploying-to-production"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Deploying to production</h2>
<p dir="auto">In the same folder as Overpass, while in a virtual environment, run the following command:</p>
<p dir="auto"><code>gunicorn -w 10 app:app --timeout 600 --log-level=debug --access-logformat &#34;%({X-Real-IP}i)s %(l)s %(t)s %(b)s &#39;%(f)s&#39; &#39;%(a)s&#39;&#34; --access-logfile &#39;-&#39;</code></p>
<h2 dir="auto"><a id="user-content-nginx-setup" aria-hidden="true" href="#nginx-setup"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>NGINX setup</h2>
<div data-snippet-clipboard-copy-content="location / {
    proxy_pass http://127.0.0.1:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Real-IP $remote_addr;
}"><pre><span>location</span> <span>/ </span>{
    <span>proxy_pass</span> http://127.0.0.1:8000;
    <span>proxy_set_header</span> Host <span>$host</span>;
    <span>proxy_set_header</span> X-Forwarded-For <span>$proxy_add_x_forwarded_for</span>;
    <span>proxy_set_header</span> X-Real-IP <span>$remote_addr</span>;
}</pre></div>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/e43b07d67352f07f533875fba0cdea65e241b1a2ea095801da79d04d08041055/68747470733a2f2f692e696d6775722e636f6d2f335576674262682e706e67"><img src="https://camo.githubusercontent.com/e43b07d67352f07f533875fba0cdea65e241b1a2ea095801da79d04d08041055/68747470733a2f2f692e696d6775722e636f6d2f335576674262682e706e67" alt="Homepage" data-canonical-src="https://i.imgur.com/3UvgBbh.png"/></a>
<a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/1185f4b69de34d6954392d5b1f72ac97c84a7a2d9b61c1fd3eb2bdac2692f60f/68747470733a2f2f692e696d6775722e636f6d2f683179563372312e706e67"><img src="https://camo.githubusercontent.com/1185f4b69de34d6954392d5b1f72ac97c84a7a2d9b61c1fd3eb2bdac2692f60f/68747470733a2f2f692e696d6775722e636f6d2f683179563372312e706e67" alt="Web Player" data-canonical-src="https://i.imgur.com/h1yV3r1.png"/></a>
<a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/1ca1637c11ae5c0a71cbb1e7290ae9cebd252193b6c5f6a3cc135fe4d4465a17/68747470733a2f2f692e696d6775722e636f6d2f545962487a6b6d2e706e67"><img src="https://camo.githubusercontent.com/1ca1637c11ae5c0a71cbb1e7290ae9cebd252193b6c5f6a3cc135fe4d4465a17/68747470733a2f2f692e696d6775722e636f6d2f545962487a6b6d2e706e67" alt="Archive" data-canonical-src="https://i.imgur.com/TYbHzkm.png"/></a>
<a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/c3ae197409abbe4f69bd20bde50993256930442cada4ba250e12b63dda8ebd15/68747470733a2f2f692e696d6775722e636f6d2f4b7743396850742e706e67"><img src="https://camo.githubusercontent.com/c3ae197409abbe4f69bd20bde50993256930442cada4ba250e12b63dda8ebd15/68747470733a2f2f692e696d6775722e636f6d2f4b7743396850742e706e67" alt="Profile Page" data-canonical-src="https://i.imgur.com/KwC9hPt.png"/></a></p>
</article>
        </div></div>
  </body>
</html>
