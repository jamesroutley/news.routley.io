<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://adamhl.dev/blog/largest-number-in-npm-package/">Original</a>
    <h1>Which NPM package has the largest version number?</h1>
    
    <div id="readability-page-1" class="page"><article>  <p>I was recently working on a project that uses the <a href="https://github.com/aws/aws-sdk-js-v3">AWS SDK for JavaScript</a>. When updating the dependencies in said project, I noticed that the version of that dependency was <code>v3.888.0</code>. Eight hundred eighty eight. That’s a big number as far as versions go.</p>
<p>That got me thinking: I wonder what package in the <a href="https://www.npmjs.com">npm registry</a> has the largest number in its version. It could be a major, minor, or patch version, and it doesn’t have to be the latest version of the package. In other words, out of the three numbers in <code>&lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;</code> for each version for each package, what is the largest number I can find?</p>
<p><strong>TL;DR? <a href="#results">Jump to the results</a></strong> to see the answer.</p>
<section data-heading-rank="2"><h2 id="the-npm-api">The npm API</h2>
<p>Obviously npm has some kind of API, so it shouldn’t be too hard to get a list of all… <a href="https://www.npmjs.com/#:~:text=Packages-,3%2C639%2C812,-Downloads%20%C2%B7%20Last">3,639,812 packages</a>. Oh. That’s a lot of packages. Well, considering npm had 374 <em>billion</em> package downloads in the past <em>month</em>, I’m sure they wouldn’t mind me making a few million HTTP requests.</p>
<p>Doing a quick search for “npm api” leads me to a readme in the <a href="https://github.com/npm/registry/blob/main/docs/REGISTRY-API.md">npm/registry repo</a> on GitHub. There’s a <code>/-/all</code> endpoint listed in the table of contents which seems promising. That section doesn’t actually exist in the readme, but maybe it still works?</p>
<div><figure><figcaption><span></span><span>Terminal window</span></figcaption><pre data-language="sh"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>curl</span><span> </span><span>&#39;https://registry.npmjs.org/-/all&#39;</span></p></div><div><div><p>2</p></div><p><span>{</span><span>&#34;code&#34;</span><span>:</span><span>&#34;ResourceNotFound&#34;</span><span>,</span><span>&#34;message&#34;</span><span>:</span><span>&#34;/-/all does not exist&#34;</span><span>}</span></p></div></code></pre></figure></div>
<p>Whelp, maybe npm packages have an ID and I can just start at 1 and count up? It looks like packages have an <code>_id</code> field… never mind, the <code>_id</code> field is the package <em>name</em>. Okay, let’s try to find something else.</p>
<p>A little more digging brings me to this <a href="https://github.com/orgs/community/discussions/152515">GitHub discussion</a> about the npm replication API. So npm replicates package info in CouchDB at <code>https://replicate.npmjs.com</code>, and conveniently, they support the <a href="https://docs.couchdb.org/en/stable/api/database/bulk-api.html#db-all-docs"><code>_all_docs</code> endpoint</a>. Let’s give that a try:</p>
<div><figure><figcaption><span></span><span>Terminal window</span></figcaption><pre data-language="sh"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>curl</span><span> </span><span>&#39;https://replicate.npmjs.com/registry/_all_docs&#39;</span></p></div><div><div><p>2</p></div><p><span>{</span></p></div><div><div><p>3</p></div><p><span>   </span><span>&#34;total_rows&#34;</span><span> </span><span>:</span><span> </span><span>3628088,</span></p></div><div><div><p>4</p></div><p><span>   </span><span>&#34;offset&#34;</span><span> </span><span>:</span><span> </span><span>0,</span></p></div><div><div><p>5</p></div><p><span>   </span><span>&#34;rows&#34;</span><span> </span><span>:</span><span> [</span></p></div><div><div><p>6</p></div><p><span><span>      </span></span><span>{</span></p></div><div><div><p>7</p></div><p><span>         </span><span>&#34;id&#34;</span><span> </span><span>:</span><span> </span><span>&#34;-&#34;,</span></p></div><div><div><p>8</p></div><p><span>         </span><span>&#34;key&#34;</span><span> </span><span>:</span><span> </span><span>&#34;-&#34;,</span></p></div><div><div><p>9</p></div><p><span>         </span><span>&#34;value&#34;</span><span> </span><span>:</span><span> </span><span>{</span></p></div><div><div><p>10</p></div><p><span>            </span><span>&#34;rev&#34;</span><span> </span><span>:</span><span> </span><span>&#34;5-f0890cdc1175072e37c43859f9d28403&#34;</span></p></div><div><div><p>11</p></div><p><span><span>         </span></span><span>}</span></p></div><div><div><p>12</p></div><p><span><span>      </span></span><span>},</span></p></div><div><div><p>13</p></div><p><span><span>      </span></span><span>{</span></p></div><div><div><p>14</p></div><p><span>         </span><span>&#34;id&#34;</span><span> </span><span>:</span><span> </span><span>&#34;--------------------------------------------------------------------------------------------------------------------------------whynunu&#34;,</span></p></div><div><div><p>15</p></div><p><span>         </span><span>&#34;key&#34;</span><span> </span><span>:</span><span> </span><span>&#34;--------------------------------------------------------------------------------------------------------------------------------whynunu&#34;,</span></p></div><div><div><p>16</p></div><p><span>         </span><span>&#34;value&#34;</span><span> </span><span>:</span><span> </span><span>{</span></p></div><div><div><p>17</p></div><p><span>            </span><span>&#34;rev&#34;</span><span> </span><span>:</span><span> </span><span>&#34;1-1d26131b0f8f9702c444e061278d24f2&#34;</span></p></div><div><div><p>18</p></div><p><span><span>         </span></span><span>}</span></p></div><div><div><p>19</p></div><p><span><span>      </span></span><span>},</span></p></div><div><div><p>20</p></div><p><span><span>      </span></span><span>{</span></p></div><div><div><p>21</p></div><p><span>         </span><span>&#34;id&#34;</span><span> </span><span>:</span><span> </span><span>&#34;-----hsad-----&#34;,</span></p></div><div><div><p>22</p></div><p><span>         </span><span>&#34;key&#34;</span><span> </span><span>:</span><span> </span><span>&#34;-----hsad-----&#34;,</span></p></div><div><div><p>23</p></div><p><span>         </span><span>&#34;value&#34;</span><span> </span><span>:</span><span> </span><span>{</span></p></div><div><div><p>24</p></div><p><span>            </span><span>&#34;rev&#34;</span><span> </span><span>:</span><span> </span><span>&#34;1-47778a3a6f9d8ce1e0530611c78c4ab4&#34;</span></p></div><div><div><p>25</p></div><p><span><span>         </span></span><span>}</span></p></div><div><div><p>26</p></div><p><span><span>      </span></span><span>},</span></p></div><div><div><p>27</p></div><p><span>      </span><span># 997 more packages...</span></p></div></code></pre></figure></div>
<p>Those are some interesting package names. Looks like this data is paginated and by default I get 1,000 packages at a time. When I write the final script, I can set the <code>limit</code> query parameter to the max of 10,000 to make pagination a little less painful.</p>
<p>Fortunately, the CouchDB docs have a <a href="https://docs.couchdb.org/en/latest/ddocs/views/pagination.html#paging">guide for pagination</a>, and it looks like it’s as simple as using the <code>skip</code> query parameter.</p>
<div><figure><figcaption><span></span><span>Terminal window</span></figcaption><pre data-language="sh"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>curl</span><span> </span><span>&#39;https://replicate.npmjs.com/registry/_all_docs?skip=1000&#39;</span></p></div><div><div><p>2</p></div><p><span>&#34;Bad Request&#34;</span></p></div></code></pre></figure></div>
<p>Never mind. According to the GitHub discussion linked above, <code>skip</code> is no longer supported. The “Paging (Alternate Method)” section of the same page says that I can use <code>startkey_docid</code> instead. If I grab the <code>id</code> of the last row, I should be able to use that to return the next set of rows. Fun fact: The 1000th package (alphabetically) on npm is <code>03-webpack-number-test</code>.</p>
<div><figure><figcaption><span></span><span>Terminal window</span></figcaption><pre data-language="sh"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>curl</span><span> </span><span>&#39;https://replicate.npmjs.com/registry/_all_docs?startkey_docid=&#34;03-webpack-number-test&#34;&#39;</span></p></div><div><div><p>2</p></div><p><span>{</span></p></div><div><div><p>3</p></div><p><span>    </span><span>&#34;total_rows&#34;</span><span> </span><span>:</span><span> </span><span>3628102,</span></p></div><div><div><p>4</p></div><p><span>    </span><span>&#34;offset&#34;</span><span> </span><span>:</span><span> </span><span>999,</span></p></div><div><div><p>5</p></div><p><span>    </span><span>&#34;rows&#34;</span><span> </span><span>:</span><span> [</span></p></div><div><div><p>6</p></div><p><span>    </span><span># another 1000 packages...</span></p></div></code></pre></figure></div>
<p>Nice. Also, another <code>3628102 - 3628088 = 14</code> packages have been published in the ~15 minutes since I ran the last query.</p>
<p>Now, there’s one more piece of the puzzle to figure out. How do I get all the versions for a given package? Unfortunately, it doesn’t seem like I can get package version information along with the base info returned by <code>_all_docs</code>. I have to <em>separately</em> fetch each package’s metadata from <code>https://registry.npmjs.org/&lt;package_id&gt;</code>. Let’s see what good ol’ trusty <code>03-webpack-number-test</code> looks like:</p>
<div><figure><figcaption><span></span><span>Terminal window</span></figcaption><pre data-language="sh"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>curl</span><span> </span><span>&#39;https://registry.npmjs.org/03-webpack-number-test&#39;</span></p></div><div><div><p>2</p></div><p><span>{</span></p></div><div><div><p>3</p></div><p><span>    </span><span># i&#39;ve omitted some fields here</span></p></div><div><div><p>4</p></div><p><span>    </span><span>&#34;_id&#34;</span><span> </span><span>:</span><span> </span><span>&#34;03-webpack-number-test&#34;,</span></p></div><div><div><p>5</p></div><p><span>    </span><span>&#34;versions&#34;</span><span> </span><span>:</span><span> </span><span>{</span></p></div><div><div><p>6</p></div><p><span>      </span><span>&#34;1.0.0&#34;</span><span> </span><span>:</span><span> </span><span>{</span><span> </span><span>...</span><span> </span><span>},</span></p></div><div><div><p>7</p></div><p><span>      </span><span># the rest of the versions...</span></p></div></code></pre></figure></div>
<p>Alright, I have everything I need. Now I just need to write a bash script that— just kidding. A wise programmer once said, “if your shell script is more than 10 lines, it shouldn’t be a shell script” (that was me, I said that). I like TypeScript, so let’s use that.</p>
<p>The biggest bottleneck is going to be waiting on the <code>GET</code>s for each package’s metadata. My plan is this:</p>
<ul>
<li>Grab all the package IDs from the replication API and save that data to a file (I don’t want to have to refetch everything if the something goes wrong later in the script)</li>
<li>Fetch package data in batches so we’re not just doing 1 HTTP request at a time</li>
<li>Save the package data to a file (again, hopefully I only have to fetch everything once)</li>
</ul>
<p>Once I have all the package data, I can answer the original question of “largest number in version” and look at a few other interesting things.</p>
<p>(A few hours and many iterations later…)</p>
<div><figure><figcaption><span></span><span>Terminal window</span></figcaption><pre data-language="sh"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>bun</span><span> </span><span>npm-package-versions.ts</span></p></div><div><div><p>2</p></div><p><span>Fetching</span><span> </span><span>package</span><span> </span><span>IDs...</span></p></div><div><div><p>3</p></div><p><span>Fetched</span><span> </span><span>10000</span><span> </span><span>packages</span><span> </span><span>IDs</span><span> </span><span>starting</span><span> </span><span>from</span><span> </span><span>offset</span><span> </span><span>0</span></p></div><div><div><p>4</p></div><p><span># this goes on for a while...</span></p></div><div><div><p>5</p></div><p><span>Finished</span><span> </span><span>fetching</span><span> </span><span>package</span><span> </span><span>IDs</span></p></div><div><div><p>6</p></div><p><span>Fetched</span><span> </span><span>50</span><span> </span><span>packages</span><span> </span><span>in</span><span> </span><span>884ms</span><span> (57 </span><span>packages/s</span><span>)</span></p></div><div><div><p>7</p></div><p><span>Fetched</span><span> </span><span>50</span><span> </span><span>packages</span><span> </span><span>in</span><span> </span><span>852ms</span><span> (59 </span><span>packages/s</span><span>)</span></p></div><div><div><p>8</p></div><p><span># this goes on for a really long while...</span></p></div></code></pre></figure></div>
<p>See the <a href="#script">script section</a> at the end if you want to see what it looks like.</p>
</section><section data-heading-rank="2"><h2 id="results">Results</h2>
<p>Some stats:</p>
<ul>
<li>Time to fetch all ~3.6 million package <em>IDs</em>: <strong>A few minutes</strong></li>
<li>Time to fetch version data for each one of those packages: <strong>~12 hours</strong> (yikes)</li>
<li>Packages fetched per second: <strong>~84 packages/s</strong></li>
<li>Size of <code>package-ids.json</code>: <strong>~78MB</strong></li>
<li>Size of <code>package-data.json</code>: <strong>~886MB</strong></li>
</ul>
<p><strong>And the winner is…</strong> (not really) <a href="https://www.npmjs.com/package/latentflip-test?activeTab=versions">latentflip-test</a> at version <code>1000000000000000000.1000000000000000000.1000000000000000000</code>. And no, there haven’t actually been one quintillion major versions of this package published. Disappointing, I know.</p>
<p>Okay, I feel like that shouldn’t count. I think we can do better and find a “real” package that actually follows semantic versioning. I think a better question to ask is this:</p>
<p><strong>For packages that <em>follow semantic versioning</em>, which package has the <em>largest number</em> from <code>&lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;</code> in <em>any</em> of its versions?</strong></p>
<p>So, what does it mean to “follow semantic versioning”? Should we “disqualify” a package for skipping a version number? In this case, I think we’ll just say that a package has to have more versions published than the largest number we find for that package. For example, a package with a version of <code>1.888.0</code> will have had <em>at least</em> 888 versions published if it actually followed semver.</p>
<p>Before we get to the real winner, here are the top 10 packages <em>by total number of versions published</em>:</p>
<div><figure><figcaption></figcaption><pre data-language="plaintext"><code><div><div><p>1</p></div><p><span>electron-remote-control -&gt; 37328 total versions</span></p></div><div><div><p>2</p></div><p><span>@npm-torg/public-scoped-free-org-test-package-2 -&gt; 37134 total versions</span></p></div><div><div><p>3</p></div><p><span>public-unscoped-test-package -&gt; 27719 total versions</span></p></div><div><div><p>4</p></div><p><span>carrot-scan -&gt; 27708 total versions</span></p></div><div><div><p>5</p></div><p><span>@npm-torg/public-test-package-2 -&gt; 27406 total versions</span></p></div><div><div><p>6</p></div><p><span>@octopusdeploy/design-system-components -&gt; 26724 total versions</span></p></div><div><div><p>7</p></div><p><span>@octopusdeploy/type-utils -&gt; 26708 total versions</span></p></div><div><div><p>8</p></div><p><span>@octopusdeploy/design-system-tokens -&gt; 22122 total versions</span></p></div><div><div><p>9</p></div><p><span>@mahdiarjangi/phetch-cli -&gt; 19498 total versions</span></p></div><div><div><p>10</p></div><p><span>@atlassian-test-prod/hello-world -&gt; 19120 total versions</span></p></div></code></pre></figure></div>
<p>Top 10 packages that (probably) follow semver <em>by largest number in one of its versions</em>:</p>
<div><figure><figcaption></figcaption><pre data-language="plaintext"><code><div><div><p>1</p></div><p><span>@mahdiarjangi/phetch-cli -&gt; 19494 (1.0.19494)</span></p></div><div><div><p>2</p></div><p><span>electron-remote-control -&gt; 19065 (1.2.19065)</span></p></div><div><div><p>3</p></div><p><span>@quip/collab -&gt; 16999 (1.16999.0)</span></p></div><div><div><p>4</p></div><p><span>@atlassian-test-prod/hello-world -&gt; 16707 (9.7.16707)</span></p></div><div><div><p>5</p></div><p><span>@wix/wix-code-types -&gt; 14720 (2.0.14720)</span></p></div><div><div><p>6</p></div><p><span>@octopusdeploy/design-system-components -&gt; 14274 (2025.3.14274)</span></p></div><div><div><p>7</p></div><p><span>@octopusdeploy/type-utils -&gt; 14274 (2025.3.14274)</span></p></div><div><div><p>8</p></div><p><span>@octopusdeploy/design-system-tokens -&gt; 14274 (2025.3.14274)</span></p></div><div><div><p>9</p></div><p><span>@atlassian-test-staging/test -&gt; 13214 (49.4.13214)</span></p></div><div><div><p>10</p></div><p><span>binky -&gt; 9906 (3.4.9906)</span></p></div></code></pre></figure></div>
<p>So it seems like the winner is <a href="https://github.com/DinoscapeProgramming/Remote-Control">@mahdiarjangi/phetch-cli</a> with <code>19494</code>, right? Unfortunately, I’m not going to count that either. It only has so many versions because of a <a href="https://github.com/arjangimahdi/phetch-cli/actions/runs/11531682007/workflow">misconfigured GitHub action</a> that published new versions in a loop.</p>
<p>I manually went down the above list, disqualifying any packages that had similar issues. I also checked that “new” versions actually differed from previous versions in terms of content. Overall, I looked for a package that was actually publishing new versions on purpose with <em>some</em> kind of change to the package content.</p>
<p><strong>The real winner (#19 on the list) is:</strong> <a href="https://github.com/nice-registry/all-the-package-names">all-the-package-names</a> with <code>2401</code> from version <code>2.0.2401</code>.</p>
<p>Well, that’s sort of disappointing, but also kind of funny. I don’t know what I was expecting to be honest. If you’re curious, you can see <a href="#more-results">more results</a> at the bottom of this post.</p>
<p>What you do with all of this extremely important and useful information is up to you.</p>
</section><section data-heading-rank="2"><h2 id="script">Script</h2>
<div><figure><figcaption></figcaption><pre data-language="ts"><code><div><div><p>1</p></div><p><span>/* This script uses Bun specific APIs and should be executed directly with Bun */</span></p></div><div><div><p>2</p></div></div><div><div><p>3</p></div><p><span>import</span><span> fs </span><span>from</span><span> </span><span>&#34;node:fs/promises&#34;</span></p></div><div><div><p>4</p></div><p><span>import</span><span> process </span><span>from</span><span> </span><span>&#34;node:process&#34;</span></p></div><div><div><p>5</p></div></div><div><div><p>6</p></div><p><span>async</span><span> </span><span>function</span><span> </span><span>main</span><span>() {</span></p></div><div><div><p>7</p></div><p><span>  </span><span>const</span><span> </span><span>NUM_TO_PRINT</span><span> </span><span>=</span><span> </span><span>50</span></p></div><div><div><p>8</p></div></div><div><div><p>9</p></div><p><span>  </span><span>const</span><span> </span><span>packageIds</span><span> </span><span>=</span><span> </span><span>await</span><span> </span><span>fetchPackageIds</span><span>()</span></p></div><div><div><p>10</p></div><p><span>  </span><span>const</span><span> </span><span>packageData</span><span> </span><span>=</span><span> </span><span>await</span><span> </span><span>fetchAllPackageData</span><span>(packageIds)</span></p></div><div><div><p>11</p></div><p><span>  </span><span>const</span><span> </span><span>normalizedPackageData</span><span> </span><span>=</span><span> </span><span>normalizePackageData</span><span>(packageData)</span></p></div><div><div><p>12</p></div></div><div><div><p>13</p></div><p><span>  </span><span>const</span><span> </span><span>packagsByNumOfVersions</span><span> </span><span>=</span><span> packageData.</span><span>toSorted</span><span>((</span><span>a</span><span>, </span><span>b</span><span>) </span><span>=&gt;</span><span> b.versions.</span><span>length</span><span> </span><span>-</span><span> a.versions.</span><span>length</span><span>) </span><span>// don&#39;t use normalizedPackageData here because it *only* includes valid semver versions</span></p></div><div><div><p>14</p></div><p><span>  </span><span>const</span><span> </span><span>packagesByLargestNumber</span><span> </span><span>=</span><span> normalizedPackageData.</span><span>toSorted</span><span>((</span><span>a</span><span>, </span><span>b</span><span>) </span><span>=&gt;</span><span> b.largestNumber.num </span><span>-</span><span> a.largestNumber.num)</span></p></div><div><div><p>15</p></div></div><div><div><p>16</p></div><p><span>  </span><span>// Ignore packages where the number of versions isn&#39;t greater than the largest number.</span></p></div><div><div><p>17</p></div><p><span>  </span><span>// For example, a package with a version of 1.888.0 will have had *at least* 888 versions published if it actually followed semver.</span></p></div><div><div><p>18</p></div><p><span>  </span><span>const</span><span> </span><span>packagesWithSemverByLargestNumber</span><span> </span><span>=</span><span> packagesByLargestNumber.</span><span>filter</span><span>(</span></p></div><div><div><p>19</p></div><p><span><span>    </span></span><span>(</span><span>pkg</span><span>) </span><span>=&gt;</span><span> pkg.versions.</span><span>length</span><span> </span><span>&gt;=</span><span> pkg.largestNumber.num,</span></p></div><div><div><p>20</p></div><p><span><span>  </span></span><span>)</span></p></div><div><div><p>21</p></div><p><span>  </span><span>const</span><span> </span><span>packagesWithoutKnownBadByLargestNumber</span><span> </span><span>=</span><span> packagesWithSemverByLargestNumber.</span><span>filter</span><span>((</span><span>pkg</span><span>) </span><span>=&gt;</span></p></div><div><div><p>22</p></div><p><span>    </span><span>KNOWN_BAD_PACKAGES</span><span>.</span><span>every</span><span>((</span><span>badId</span><span>) </span><span>=&gt;</span><span> </span><span>!</span><span>pkg.id.</span><span>startsWith</span><span>(badId)),</span></p></div><div><div><p>23</p></div><p><span><span>  </span></span><span>)</span></p></div><div><div><p>24</p></div></div><div><div><p>25</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>`</span><span>\n</span><span>Top ${</span><span>NUM_TO_PRINT</span><span>} packages by total number of versions published:`</span><span>)</span></p></div><div><div><p>26</p></div><p><span><span>  </span></span><span>packagsByNumOfVersions.</span><span>slice</span><span>(</span><span>0</span><span>, </span><span>NUM_TO_PRINT</span><span>).</span><span>forEach</span><span>(({ </span><span>id</span><span>, </span><span>versions</span><span> }, </span><span>i</span><span>) </span><span>=&gt;</span><span> {</span></p></div><div><div><p>27</p></div><p><span><span>    </span></span><span>console.</span><span>log</span><span>(</span><span>`${</span><span>i</span><span> </span><span>+</span><span> </span><span>1</span><span>}. ${</span><span>id</span><span>} -&gt; ${</span><span>versions</span><span>.</span><span>length</span><span>} total versions`</span><span>)</span></p></div><div><div><p>28</p></div><p><span><span>  </span></span><span>})</span></p></div><div><div><p>29</p></div></div><div><div><p>30</p></div><p><span>  </span><span>const</span><span> </span><span>logPackagesByLargestNumber</span><span> </span><span>=</span><span> (</span><span>packages</span><span>:</span><span> </span><span>NormalizedPackageData</span><span>[]) </span><span>=&gt;</span><span> {</span></p></div><div><div><p>31</p></div><p><span><span>    </span></span><span>packages.</span><span>slice</span><span>(</span><span>0</span><span>, </span><span>NUM_TO_PRINT</span><span>).</span><span>forEach</span><span>(({ </span><span>id</span><span>, </span><span>largestNumber</span><span> }, </span><span>i</span><span>) </span><span>=&gt;</span><span> {</span></p></div><div><div><p>32</p></div><p><span><span>      </span></span><span>console.</span><span>log</span><span>(</span><span>`${</span><span>i</span><span> </span><span>+</span><span> </span><span>1</span><span>}. ${</span><span>id</span><span>} -&gt; ${</span><span>largestNumber</span><span>.</span><span>num</span><span>} (${</span><span>largestNumber</span><span>.</span><span>version</span><span>})`</span><span>)</span></p></div><div><div><p>33</p></div><p><span><span>    </span></span><span>})</span></p></div><div><div><p>34</p></div><p><span><span>  </span></span><span>}</span></p></div><div><div><p>35</p></div></div><div><div><p>36</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>`</span><span>\n</span><span>Top ${</span><span>NUM_TO_PRINT</span><span>} packages by largest number in version:`</span><span>)</span></p></div><div><div><p>37</p></div><p><span>  </span><span>logPackagesByLargestNumber</span><span>(packagesByLargestNumber)</span></p></div><div><div><p>38</p></div></div><div><div><p>39</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>`</span><span>\n</span><span>Top ${</span><span>NUM_TO_PRINT</span><span>} packages that follow semver by largest number in version:`</span><span>)</span></p></div><div><div><p>40</p></div><p><span>  </span><span>logPackagesByLargestNumber</span><span>(packagesWithSemverByLargestNumber)</span></p></div><div><div><p>41</p></div></div><div><div><p>42</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span></p></div><div><div><p>43</p></div><p><span>    </span><span>`</span><span>\n</span><span>Top ${</span><span>NUM_TO_PRINT</span><span>} packages that follow semver by largest number in version (excluding known bad packages):`</span><span>,</span></p></div><div><div><p>44</p></div><p><span><span>  </span></span><span>)</span></p></div><div><div><p>45</p></div><p><span>  </span><span>logPackagesByLargestNumber</span><span>(packagesWithoutKnownBadByLargestNumber)</span></p></div><div><div><p>46</p></div></div><div><div><p>47</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>&#34;</span><span>\n</span><span>Done!&#34;</span><span>)</span></p></div><div><div><p>48</p></div><p><span>}</span></p></div><div><div><p>49</p></div></div><div><div><p>50</p></div><p><span>/**</span></p></div><div><div><p>51</p></div><p><span><span> </span></span><span>* These are packages that have a large number of versions because of some automation (e.g. GitHub Action), where each &#34;new&#34; version was identical to the last.</span></p></div><div><div><p>52</p></div><p><span><span> </span></span><span>* For example, &#39;electron-remote-control&#39; was publishing a version every hour for a long time due to a configuration mistake.</span></p></div><div><div><p>53</p></div><p><span><span> </span></span><span>*/</span></p></div><div><div><p>54</p></div><p><span>const</span><span> </span><span>KNOWN_BAD_PACKAGES</span><span> </span><span>=</span><span> [</span></p></div><div><div><p>55</p></div><p><span>  </span><span>&#34;@mahdiarjangi/phetch-cli&#34;</span><span>,</span></p></div><div><div><p>56</p></div><p><span>  </span><span>&#34;electron-remote-control&#34;</span><span>,</span></p></div><div><div><p>57</p></div><p><span>  </span><span>&#34;@quip/collab&#34;</span><span>,</span></p></div><div><div><p>58</p></div><p><span>  </span><span>&#34;@atlassian-test&#34;</span><span>,</span></p></div><div><div><p>59</p></div><p><span>  </span><span>&#34;@wix/wix-code-types&#34;</span><span>,</span></p></div><div><div><p>60</p></div><p><span>  </span><span>&#34;@octopusdeploy&#34;</span><span>,</span></p></div><div><div><p>61</p></div><p><span>  </span><span>&#34;binky&#34;</span><span>,</span></p></div><div><div><p>62</p></div><p><span>  </span><span>&#34;carrot-scan&#34;</span><span>,</span></p></div><div><div><p>63</p></div><p><span>  </span><span>&#34;terrapin-test-1&#34;</span><span>,</span></p></div><div><div><p>64</p></div><p><span>  </span><span>&#34;@prisma/language-server&#34;</span><span>,</span></p></div><div><div><p>65</p></div><p><span>  </span><span>&#34;kse-visilia&#34;</span><span>,</span></p></div><div><div><p>66</p></div><p><span>  </span><span>&#34;intraactive-sdk-ui&#34;</span><span>,</span></p></div><div><div><p>67</p></div><p><span>  </span><span>&#34;@idxdb/promised&#34;</span><span>,</span></p></div><div><div><p>68</p></div><p><span>  </span><span>&#34;wix-style-react&#34;</span><span>,</span></p></div><div><div><p>69</p></div><p><span>  </span><span>&#34;botfather&#34;</span><span>,</span></p></div><div><div><p>70</p></div><p><span>]</span></p></div><div><div><p>71</p></div></div><div><div><p>72</p></div><p><span>/**</span></p></div><div><div><p>73</p></div><p><span><span> </span></span><span>* Fetches every single package ID from the npm replicate API and writes the data to a file.</span></p></div><div><div><p>74</p></div><p><span><span> </span></span><span>*/</span></p></div><div><div><p>75</p></div><p><span>async</span><span> </span><span>function</span><span> </span><span>fetchPackageIds</span><span>()</span><span>:</span><span> </span><span>Promise</span><span>&lt;</span><span>string</span><span>[]&gt; {</span></p></div><div><div><p>76</p></div><p><span>  </span><span>const</span><span> </span><span>packageIdsFile</span><span> </span><span>=</span><span> Bun.</span><span>file</span><span>(</span><span>&#34;package-ids.json&#34;</span><span>)</span></p></div><div><div><p>77</p></div><p><span>  </span><span>// return the existing package IDs if they exist</span></p></div><div><div><p>78</p></div><p><span>  </span><span>if</span><span> (</span><span>await</span><span> packageIdsFile.</span><span>exists</span><span>()) {</span></p></div><div><div><p>79</p></div><p><span><span>    </span></span><span>console.</span><span>log</span><span>(</span><span>&#34;Using existing package IDs&#34;</span><span>)</span></p></div><div><div><p>80</p></div><p><span>    </span><span>return</span><span> (</span><span>await</span><span> packageIdsFile.</span><span>json</span><span>()) </span><span>as</span><span> </span><span>string</span><span>[]</span></p></div><div><div><p>81</p></div><p><span><span>  </span></span><span>}</span></p></div><div><div><p>82</p></div></div><div><div><p>83</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>&#34;Fetching package IDs...&#34;</span><span>)</span></p></div><div><div><p>84</p></div><p><span>  </span><span>let</span><span> firstFetch </span><span>=</span><span> </span><span>true</span></p></div><div><div><p>85</p></div><p><span>  </span><span>let</span><span> startKeyPackageId</span><span>:</span><span> </span><span>string</span><span> </span><span>|</span><span> </span><span>undefined</span></p></div><div><div><p>86</p></div><p><span>  </span><span>const</span><span> </span><span>packageIds</span><span>:</span><span> </span><span>string</span><span>[] </span><span>=</span><span> []</span></p></div><div><div><p>87</p></div></div><div><div><p>88</p></div><p><span>  </span><span>// We use the last package ID of current fetch as the start key for the next fetch. Once the start key is the same as the last package ID, we&#39;ve fetched all packages and can break out of the loop.</span></p></div><div><div><p>89</p></div><p><span>  </span><span>while</span><span> (</span><span>true</span><span>) {</span></p></div><div><div><p>90</p></div><p><span>    </span><span>const</span><span> </span><span>LIMIT</span><span> </span><span>=</span><span> </span><span>10_000</span></p></div><div><div><p>91</p></div><p><span>    </span><span>const</span><span> </span><span>startKeyQueryParam</span><span> </span><span>=</span><span> firstFetch </span><span>?</span><span> </span><span>&#34;&#34;</span><span> </span><span>:</span><span> </span><span>`&amp;startkey_docid=&#34;${</span><span>startKeyPackageId</span><span>}&#34;`</span></p></div><div><div><p>92</p></div><p><span>    </span><span>const</span><span> </span><span>json</span><span> </span><span>=</span><span> </span><span>await</span><span> </span><span>fetchJson</span><span>&lt;{ </span><span>rows</span><span>:</span><span> { </span><span>id</span><span>:</span><span> </span><span>string</span><span> }[]; </span><span>offset</span><span>:</span><span> </span><span>number</span><span> }&gt;(</span></p></div><div><div><p>93</p></div><p><span>      </span><span>`https://replicate.npmjs.com/registry/_all_docs?limit=${</span><span>LIMIT</span><span>}${</span><span>startKeyQueryParam</span><span>}`</span><span>,</span></p></div><div><div><p>94</p></div><p><span><span>    </span></span><span>)</span></p></div><div><div><p>95</p></div><p><span>    </span><span>if</span><span> (</span><span>!</span><span>json) process.</span><span>exit</span><span>(</span><span>1</span><span>) </span><span>// Stop the script if we fail to fetch package IDs. The error will have already been logged.</span></p></div><div><div><p>96</p></div></div><div><div><p>97</p></div><p><span>    </span><span>const</span><span> { </span><span>rows</span><span>, </span><span>offset</span><span> } </span><span>=</span><span> json</span></p></div><div><div><p>98</p></div><p><span><span>    </span></span><span>console.</span><span>log</span><span>(</span><span>`Fetched ${</span><span>rows</span><span>.</span><span>length</span><span>} package IDs starting from offset ${</span><span>offset</span><span>}`</span><span>)</span></p></div><div><div><p>99</p></div></div><div><div><p>100</p></div><p><span>    </span><span>for</span><span> (</span><span>const</span><span> { </span><span>id</span><span>: </span><span>packageId</span><span> } </span><span>of</span><span> rows) {</span></p></div><div><div><p>101</p></div><p><span>      </span><span>if</span><span> (startKeyPackageId </span><span>===</span><span> packageId) </span><span>continue</span><span> </span><span>// Skip the startKeyPackageId. The startKeyPackageId is already in the list because it&#39;s the same as the last package ID from the previous fetch</span></p></div><div><div><p>102</p></div><p><span><span>      </span></span><span>packageIds.</span><span>push</span><span>(packageId)</span></p></div><div><div><p>103</p></div><p><span><span>    </span></span><span>}</span></p></div><div><div><p>104</p></div></div><div><div><p>105</p></div><p><span>    </span><span>const</span><span> </span><span>lastPackageId</span><span> </span><span>=</span><span> rows.</span><span>at</span><span>(</span><span>-</span><span>1</span><span>)?.id</span></p></div><div><div><p>106</p></div><p><span>    </span><span>if</span><span> (startKeyPackageId </span><span>===</span><span> lastPackageId) </span><span>break</span><span> </span><span>// we&#39;ve reached the end of the package IDs</span></p></div><div><div><p>107</p></div></div><div><div><p>108</p></div><p><span><span>    </span></span><span>startKeyPackageId </span><span>=</span><span> lastPackageId</span></p></div><div><div><p>109</p></div></div><div><div><p>110</p></div><p><span><span>    </span></span><span>firstFetch </span><span>&amp;&amp;=</span><span> </span><span>false</span></p></div><div><div><p>111</p></div><p><span><span>  </span></span><span>}</span></p></div><div><div><p>112</p></div></div><div><div><p>113</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>&#34;Finished fetching package IDs&#34;</span><span>)</span></p></div><div><div><p>114</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>`Writing package IDs to &#39;${</span><span>packageIdsFile</span><span>.</span><span>name</span><span>}&#39;...`</span><span>)</span></p></div><div><div><p>115</p></div><p><span>  </span><span>await</span><span> packageIdsFile.</span><span>write</span><span>(</span><span>JSON</span><span>.</span><span>stringify</span><span>(packageIds))</span></p></div><div><div><p>116</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>`Finished writing package IDs to &#39;${</span><span>packageIdsFile</span><span>.</span><span>name</span><span>}&#39;`</span><span>)</span></p></div><div><div><p>117</p></div></div><div><div><p>118</p></div><p><span>  </span><span>return</span><span> packageIds</span></p></div><div><div><p>119</p></div><p><span>}</span></p></div><div><div><p>120</p></div></div><div><div><p>121</p></div><p><span>interface</span><span> </span><span>PackageData</span><span> {</span></p></div><div><div><p>122</p></div><p><span>  </span><span>id</span><span>:</span><span> </span><span>string</span></p></div><div><div><p>123</p></div><p><span>  </span><span>versions</span><span>:</span><span> </span><span>string</span><span>[]</span></p></div><div><div><p>124</p></div><p><span>}</span></p></div><div><div><p>125</p></div></div><div><div><p>126</p></div><p><span>/**</span></p></div><div><div><p>127</p></div><p><span><span> </span></span><span>* Fetches all package metadata from the npm registry API and writes the data to a file.</span></p></div><div><div><p>128</p></div><p><span><span> </span></span><span>*/</span></p></div><div><div><p>129</p></div><p><span>async</span><span> </span><span>function</span><span> </span><span>fetchAllPackageData</span><span>(</span><span>packageIds</span><span>:</span><span> </span><span>string</span><span>[])</span><span>:</span><span> </span><span>Promise</span><span>&lt;</span><span>PackageData</span><span>[]&gt; {</span></p></div><div><div><p>130</p></div><p><span>  </span><span>/** The number of packages to fetch at once */</span></p></div><div><div><p>131</p></div><p><span>  </span><span>const</span><span> </span><span>BATCH_SIZE</span><span> </span><span>=</span><span> </span><span>50</span></p></div><div><div><p>132</p></div></div><div><div><p>133</p></div><p><span>  </span><span>interface</span><span> </span><span>FetchedPackageData</span><span> {</span></p></div><div><div><p>134</p></div><p><span>    </span><span>_id</span><span>:</span><span> </span><span>string</span></p></div><div><div><p>135</p></div><p><span>    </span><span>versions</span><span>?:</span><span> </span><span>Record</span><span>&lt;</span><span>string</span><span>, </span><span>unknown</span><span>&gt; </span><span>// when we fetch package data, sometimes the versions object is missing</span></p></div><div><div><p>136</p></div><p><span><span>  </span></span><span>}</span></p></div><div><div><p>137</p></div></div><div><div><p>138</p></div><p><span>  </span><span>const</span><span> </span><span>packageDataFile</span><span> </span><span>=</span><span> Bun.</span><span>file</span><span>(</span><span>&#34;package-data.json&#34;</span><span>)</span></p></div><div><div><p>139</p></div><p><span>  </span><span>// return the existing package data if it exists</span></p></div><div><div><p>140</p></div><p><span>  </span><span>if</span><span> (</span><span>await</span><span> packageDataFile.</span><span>exists</span><span>()) {</span></p></div><div><div><p>141</p></div><p><span><span>    </span></span><span>console.</span><span>log</span><span>(</span><span>&#34;Using existing package data&#34;</span><span>)</span></p></div><div><div><p>142</p></div><p><span>    </span><span>return</span><span> (</span><span>await</span><span> packageDataFile.</span><span>json</span><span>()) </span><span>as</span><span> </span><span>PackageData</span><span>[]</span></p></div><div><div><p>143</p></div><p><span><span>  </span></span><span>}</span></p></div><div><div><p>144</p></div></div><div><div><p>145</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>&#34;Fetching package data...&#34;</span><span>)</span></p></div><div><div><p>146</p></div><p><span>  </span><span>const</span><span> </span><span>allPackageData</span><span>:</span><span> </span><span>PackageData</span><span>[] </span><span>=</span><span> []</span></p></div><div><div><p>147</p></div></div><div><div><p>148</p></div><p><span>  </span><span>while</span><span> (packageIds.</span><span>length</span><span> </span><span>&gt;</span><span> </span><span>0</span><span>) {</span></p></div><div><div><p>149</p></div><p><span>    </span><span>const</span><span> </span><span>startTime</span><span> </span><span>=</span><span> Date.</span><span>now</span><span>()</span></p></div><div><div><p>150</p></div></div><div><div><p>151</p></div><p><span>    </span><span>const</span><span> </span><span>batch</span><span> </span><span>=</span><span> packageIds.</span><span>splice</span><span>(</span><span>0</span><span>, </span><span>BATCH_SIZE</span><span>)</span></p></div><div><div><p>152</p></div></div><div><div><p>153</p></div><p><span>    </span><span>const</span><span> </span><span>packageDataPromises</span><span> </span><span>=</span><span> batch.</span><span>map</span><span>(</span><span>async</span><span> (</span><span>packageId</span><span>) </span><span>=&gt;</span><span> {</span></p></div><div><div><p>154</p></div><p><span>      </span><span>const</span><span> </span><span>fetchedPackageData</span><span> </span><span>=</span><span> </span><span>await</span><span> </span><span>fetchJson</span><span>&lt;</span><span>FetchedPackageData</span><span>&gt;(</span></p></div><div><div><p>155</p></div><p><span>        </span><span>`https://registry.npmjs.org/${</span><span>encodeURIComponent</span><span>(</span><span>packageId</span><span>)</span><span>}`</span><span>,</span></p></div><div><div><p>156</p></div><p><span><span>      </span></span><span>)</span></p></div><div><div><p>157</p></div><p><span>      </span><span>if</span><span> (</span><span>!</span><span>fetchedPackageData) </span><span>return</span></p></div><div><div><p>158</p></div><p><span>      </span><span>const</span><span> { </span><span>_id</span><span>, </span><span>versions</span><span> </span><span>=</span><span> {} } </span><span>=</span><span> fetchedPackageData </span><span>// default versions to an empty object if it doesn&#39;t exist</span></p></div><div><div><p>159</p></div><p><span>      </span><span>const</span><span> </span><span>packageData</span><span>:</span><span> </span><span>PackageData</span><span> </span><span>=</span><span> { id: _id, versions: Object.</span><span>keys</span><span>(versions).</span><span>reverse</span><span>() } </span><span>// reverse the versions array so the newest version is first</span></p></div><div><div><p>160</p></div><p><span>      </span><span>return</span><span> packageData</span></p></div><div><div><p>161</p></div><p><span><span>    </span></span><span>})</span></p></div><div><div><p>162</p></div><p><span>    </span><span>const</span><span> </span><span>packageData</span><span> </span><span>=</span><span> (</span><span>await</span><span> </span><span>Promise</span><span>.</span><span>all</span><span>(packageDataPromises)).</span><span>filter</span><span>((</span><span>data</span><span>) </span><span>=&gt;</span><span> data </span><span>!==</span><span> </span><span>undefined</span><span>)</span></p></div><div><div><p>163</p></div></div><div><div><p>164</p></div><p><span><span>    </span></span><span>allPackageData.</span><span>push</span><span>(</span><span>...</span><span>packageData)</span></p></div><div><div><p>165</p></div></div><div><div><p>166</p></div><p><span>    </span><span>const</span><span> </span><span>endTime</span><span> </span><span>=</span><span> Date.</span><span>now</span><span>()</span></p></div><div><div><p>167</p></div><p><span>    </span><span>const</span><span> </span><span>duration</span><span> </span><span>=</span><span> endTime </span><span>-</span><span> startTime</span></p></div><div><div><p>168</p></div><p><span><span>    </span></span><span>console.</span><span>log</span><span>(</span></p></div><div><div><p>169</p></div><p><span>      </span><span>`Fetched ${</span><span>packageData</span><span>.</span><span>length</span><span>} packages in ${</span><span>duration</span><span>}ms (${</span><span>Math</span><span>.</span><span>round</span><span>((</span><span>packageData</span><span>.</span><span>length</span><span> </span><span>/</span><span> </span><span>duration</span><span>) </span><span>*</span><span> </span><span>1000</span><span>)</span><span>} packages/s)`</span><span>,</span></p></div><div><div><p>170</p></div><p><span><span>    </span></span><span>)</span></p></div><div><div><p>171</p></div><p><span><span>  </span></span><span>}</span></p></div><div><div><p>172</p></div></div><div><div><p>173</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>&#34;Finished fetching package data&#34;</span><span>)</span></p></div><div><div><p>174</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>`Writing package data to &#39;${</span><span>packageDataFile</span><span>.</span><span>name</span><span>}&#39;...`</span><span>)</span></p></div><div><div><p>175</p></div><p><span>  </span><span>await</span><span> packageDataFile.</span><span>write</span><span>(</span><span>JSON</span><span>.</span><span>stringify</span><span>(allPackageData))</span></p></div><div><div><p>176</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>`Finished writing package data to &#39;${</span><span>packageDataFile</span><span>.</span><span>name</span><span>}&#39;`</span><span>)</span></p></div><div><div><p>177</p></div></div><div><div><p>178</p></div><p><span>  </span><span>return</span><span> allPackageData</span></p></div><div><div><p>179</p></div><p><span>}</span></p></div><div><div><p>180</p></div></div><div><div><p>181</p></div><p><span>type</span><span> </span><span>SemverNumbers</span><span> </span><span>=</span><span> [</span><span>number</span><span>, </span><span>number</span><span>, </span><span>number</span><span>]</span></p></div><div><div><p>182</p></div><p><span>interface</span><span> </span><span>NormalizedPackageData</span><span> {</span></p></div><div><div><p>183</p></div><p><span>  </span><span>id</span><span>:</span><span> </span><span>string</span></p></div><div><div><p>184</p></div><p><span>  </span><span>largestNumber</span><span>:</span><span> {</span></p></div><div><div><p>185</p></div><p><span>    </span><span>num</span><span>:</span><span> </span><span>number</span></p></div><div><div><p>186</p></div><p><span>    </span><span>version</span><span>:</span><span> </span><span>string</span></p></div><div><div><p>187</p></div><p><span><span>  </span></span><span>}</span></p></div><div><div><p>188</p></div><p><span>  </span><span>versions</span><span>:</span><span> </span><span>SemverNumbers</span><span>[]</span></p></div><div><div><p>189</p></div><p><span>}</span></p></div><div><div><p>190</p></div></div><div><div><p>191</p></div><p><span>/**</span></p></div><div><div><p>192</p></div><p><span><span> </span></span><span>* Transforms package data so that it includes the largest number from all of its versions.</span></p></div><div><div><p>193</p></div><p><span><span> </span></span><span>* In each `versions` array, only valid semver versions are kept.</span></p></div><div><div><p>194</p></div><p><span><span> </span></span><span>*/</span></p></div><div><div><p>195</p></div><p><span>function</span><span> </span><span>normalizePackageData</span><span>(</span><span>packageData</span><span>:</span><span> </span><span>PackageData</span><span>[])</span><span>:</span><span> </span><span>NormalizedPackageData</span><span>[] {</span></p></div><div><div><p>196</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>&#34;Getting normalized package data...&#34;</span><span>)</span></p></div><div><div><p>197</p></div><p><span>  </span><span>const</span><span> </span><span>normalizedPackageData</span><span> </span><span>=</span><span> packageData</span></p></div><div><div><p>198</p></div><p><span><span>    </span></span><span>.</span><span>map</span><span>((</span><span>pkg</span><span>) </span><span>=&gt;</span><span> {</span></p></div><div><div><p>199</p></div><p><span>      </span><span>const</span><span> </span><span>semverVersions</span><span> </span><span>=</span><span> pkg.versions</span></p></div><div><div><p>200</p></div><p><span><span>        </span></span><span>.</span><span>map</span><span>((</span><span>version</span><span>) </span><span>=&gt;</span><span> </span><span>splitSemver</span><span>(version))</span></p></div><div><div><p>201</p></div><p><span><span>        </span></span><span>.</span><span>filter</span><span>((</span><span>version</span><span>) </span><span>=&gt;</span><span> version </span><span>!==</span><span> </span><span>undefined</span><span>)</span></p></div><div><div><p>202</p></div><p><span>      </span><span>if</span><span> (semverVersions.</span><span>length</span><span> </span><span>===</span><span> </span><span>0</span><span>) </span><span>return</span><span> </span><span>// if the package didn&#39;t have any valid semver versions, don&#39;t include it</span></p></div><div><div><p>203</p></div></div><div><div><p>204</p></div><p><span>      </span><span>let</span><span> largestNumber </span><span>=</span><span> { num: </span><span>0</span><span>, version: </span><span>&#34;&#34;</span><span> }</span></p></div><div><div><p>205</p></div><p><span>      </span><span>for</span><span> (</span><span>const</span><span> </span><span>semver</span><span> </span><span>of</span><span> semverVersions) {</span></p></div><div><div><p>206</p></div><p><span>        </span><span>const</span><span> [</span><span>major</span><span>, </span><span>minor</span><span>, </span><span>patch</span><span>] </span><span>=</span><span> semver</span></p></div><div><div><p>207</p></div><p><span>        </span><span>const</span><span> </span><span>num</span><span> </span><span>=</span><span> Math.</span><span>max</span><span>(major, minor, patch)</span></p></div><div><div><p>208</p></div><p><span>        </span><span>if</span><span> (num </span><span>&gt;</span><span> largestNumber.num) largestNumber </span><span>=</span><span> { num, version: semver.</span><span>join</span><span>(</span><span>&#34;.&#34;</span><span>) }</span></p></div><div><div><p>209</p></div><p><span><span>      </span></span><span>}</span></p></div><div><div><p>210</p></div></div><div><div><p>211</p></div><p><span>      </span><span>const</span><span> </span><span>normalizedPackage</span><span> </span><span>=</span><span> { id: pkg.id, largestNumber, versions: semverVersions }</span></p></div><div><div><p>212</p></div><p><span>      </span><span>return</span><span> normalizedPackage</span></p></div><div><div><p>213</p></div><p><span><span>    </span></span><span>})</span></p></div><div><div><p>214</p></div><p><span><span>    </span></span><span>.</span><span>filter</span><span>((</span><span>pkg</span><span>) </span><span>=&gt;</span><span> pkg </span><span>!==</span><span> </span><span>undefined</span><span>)</span></p></div><div><div><p>215</p></div></div><div><div><p>216</p></div><p><span><span>  </span></span><span>console.</span><span>log</span><span>(</span><span>&#34;Finished getting normalized package data&#34;</span><span>)</span></p></div><div><div><p>217</p></div></div><div><div><p>218</p></div><p><span>  </span><span>return</span><span> normalizedPackageData</span></p></div><div><div><p>219</p></div><p><span>}</span></p></div><div><div><p>220</p></div></div><div><div><p>221</p></div><p><span>await</span><span> </span><span>main</span><span>()</span></p></div><div><div><p>222</p></div></div><div><div><p>223</p></div><p><span>/* UTILS */</span></p></div><div><div><p>224</p></div></div><div><div><p>225</p></div><p><span>/**</span></p></div><div><div><p>226</p></div><p><span><span> </span></span><span>*</span></p></div><div><div><p>227</p></div><p><span><span> </span></span><span>* Splits a valid semver string into an array of three number: `[major, minor, patch]`</span></p></div><div><div><p>228</p></div><p><span><span> </span></span><span>* If the string is not a valid semver, `undefined` is returned.</span></p></div><div><div><p>229</p></div><p><span><span> </span></span><span>*/</span></p></div><div><div><p>230</p></div><p><span>function</span><span> </span><span>splitSemver</span><span>(</span><span>version</span><span>:</span><span> </span><span>string</span><span>)</span><span>:</span><span> </span><span>SemverNumbers</span><span> </span><span>|</span><span> </span><span>undefined</span><span> {</span></p></div><div><div><p>231</p></div><p><span>  </span><span>const</span><span> </span><span>versionParts</span><span> </span><span>=</span><span> version</span></p></div><div><div><p>232</p></div><p><span><span>    </span></span><span>.</span><span>split</span><span>(</span><span>&#34;.&#34;</span><span>)</span></p></div><div><div><p>233</p></div><p><span><span>    </span></span><span>.</span><span>slice</span><span>(</span><span>0</span><span>, </span><span>3</span><span>)</span></p></div><div><div><p>234</p></div><p><span><span>    </span></span><span>.</span><span>map</span><span>((</span><span>part</span><span>) </span><span>=&gt;</span><span> (Number.</span><span>isInteger</span><span>(</span><span>Number</span><span>(part)) </span><span>?</span><span> Number.</span><span>parseInt</span><span>(part, </span><span>10</span><span>) </span><span>:</span><span> </span><span>undefined</span><span>))</span></p></div><div><div><p>235</p></div><p><span><span>    </span></span><span>.</span><span>filter</span><span>((</span><span>part</span><span>) </span><span>=&gt;</span><span> part </span><span>!==</span><span> </span><span>undefined</span><span>)</span></p></div><div><div><p>236</p></div><p><span>  </span><span>if</span><span> (versionParts.</span><span>length</span><span> </span><span>!==</span><span> </span><span>3</span><span>) </span><span>return</span></p></div><div><div><p>237</p></div><p><span>  </span><span>const</span><span> [</span><span>major</span><span>, </span><span>minor</span><span>, </span><span>patch</span><span>] </span><span>=</span><span> versionParts </span><span>as</span><span> </span><span>SemverNumbers</span></p></div><div><div><p>238</p></div><p><span>  </span><span>return</span><span> [major, minor, patch]</span></p></div><div><div><p>239</p></div><p><span>}</span></p></div><div><div><p>240</p></div></div><div><div><p>241</p></div><p><span>/**</span></p></div><div><div><p>242</p></div><p><span><span> </span></span><span>* Calls `console.error` with the message and appends the message to a `error.log` file.</span></p></div><div><div><p>243</p></div><p><span><span> </span></span><span>*/</span></p></div><div><div><p>244</p></div><p><span>function</span><span> </span><span>logError</span><span>(</span><span>message</span><span>:</span><span> </span><span>string</span><span>) {</span></p></div><div><div><p>245</p></div><p><span><span>  </span></span><span>console.</span><span>error</span><span>(message)</span></p></div><div><div><p>246</p></div><p><span><span>  </span></span><span>fs.</span><span>appendFile</span><span>(</span><span>&#34;error.log&#34;</span><span>, message)</span></p></div><div><div><p>247</p></div><p><span>}</span></p></div><div><div><p>248</p></div></div><div><div><p>249</p></div><p><span>/**</span></p></div><div><div><p>250</p></div><p><span><span> </span></span><span>* Fetches the url and returns the JSON response object. Calls </span><span>{</span><span>@link</span><span> </span><span>logError</span><span>}</span><span> and returns `undefined` instead of throwing if an error occurs.</span></p></div><div><div><p>251</p></div><p><span><span> </span></span><span>*/</span></p></div><div><div><p>252</p></div><p><span>async</span><span> </span><span>function</span><span> </span><span>fetchJson</span><span>&lt;</span><span>T</span><span>&gt;(</span><span>url</span><span>:</span><span> </span><span>string</span><span>)</span><span>:</span><span> </span><span>Promise</span><span>&lt;</span><span>T</span><span> </span><span>|</span><span> </span><span>undefined</span><span>&gt; {</span></p></div><div><div><p>253</p></div><p><span>  </span><span>try</span><span> {</span></p></div><div><div><p>254</p></div><p><span>    </span><span>const</span><span> </span><span>response</span><span> </span><span>=</span><span> </span><span>await</span><span> </span><span>fetch</span><span>(url)</span></p></div><div><div><p>255</p></div><p><span>    </span><span>if</span><span> (</span><span>!</span><span>response.ok) </span><span>throw</span><span> </span><span>new</span><span> </span><span>Error</span><span>(</span><span>`(${</span><span>response</span><span>.</span><span>status</span><span>}) ${</span><span>await</span><span> </span><span>response</span><span>.</span><span>text</span><span>()</span><span>}`</span><span>)</span></p></div><div><div><p>256</p></div><p><span>    </span><span>return</span><span> (</span><span>await</span><span> response.</span><span>json</span><span>()) </span><span>as</span><span> </span><span>T</span></p></div><div><div><p>257</p></div><p><span><span>  </span></span><span>} </span><span>catch</span><span> (error) {</span></p></div><div><div><p>258</p></div><p><span>    </span><span>const</span><span> </span><span>errorMessage</span><span> </span><span>=</span><span> error </span><span>instanceof</span><span> </span><span>Error</span><span> </span><span>?</span><span> error.message </span><span>:</span><span> </span><span>String</span><span>(error)</span></p></div><div><div><p>259</p></div><p><span>    </span><span>logError</span><span>(</span><span>`something went wrong fetching json for &#39;${</span><span>url</span><span>}&#39;: ${</span><span>errorMessage</span><span>}`</span><span>)</span></p></div><div><div><p>260</p></div><p><span><span>  </span></span><span>}</span></p></div><div><div><p>261</p></div></div><div><div><p>262</p></div><p><span>  </span><span>return</span></p></div><div><div><p>263</p></div><p><span>}</span></p></div></code></pre></figure></div>
</section><section data-heading-rank="2"><h2 id="more-results">More Results</h2>
<p>This is from the script:</p>
<div><figure><figcaption></figcaption><pre data-language="plaintext"><code><div><div><p>1</p></div><p><span>Top 50 packages by total number of versions published:</span></p></div><div><div><p>2</p></div><p><span>1. electron-remote-control -&gt; 37328 total versions</span></p></div><div><div><p>3</p></div><p><span>2. @npm-torg/public-scoped-free-org-test-package-2 -&gt; 37134 total versions</span></p></div><div><div><p>4</p></div><p><span>3. public-unscoped-test-package -&gt; 27719 total versions</span></p></div><div><div><p>5</p></div><p><span>4. carrot-scan -&gt; 27708 total versions</span></p></div><div><div><p>6</p></div><p><span>5. @npm-torg/public-test-package-2 -&gt; 27406 total versions</span></p></div><div><div><p>7</p></div><p><span>6. @octopusdeploy/design-system-components -&gt; 26724 total versions</span></p></div><div><div><p>8</p></div><p><span>7. @octopusdeploy/type-utils -&gt; 26708 total versions</span></p></div><div><div><p>9</p></div><p><span>8. @octopusdeploy/design-system-tokens -&gt; 22122 total versions</span></p></div><div><div><p>10</p></div><p><span>9. @mahdiarjangi/phetch-cli -&gt; 19498 total versions</span></p></div><div><div><p>11</p></div><p><span>10. @atlassian-test-prod/hello-world -&gt; 19120 total versions</span></p></div><div><div><p>12</p></div><p><span>11. @quip/collab -&gt; 17004 total versions</span></p></div><div><div><p>13</p></div><p><span>12. @gitpod/gitpod-protocol -&gt; 16145 total versions</span></p></div><div><div><p>14</p></div><p><span>13. ricos-build-cache -&gt; 15867 total versions</span></p></div><div><div><p>15</p></div><p><span>14. @wix/wix-code-types -&gt; 15030 total versions</span></p></div><div><div><p>16</p></div><p><span>15. @gitpod/supervisor-api-grpc -&gt; 14364 total versions</span></p></div><div><div><p>17</p></div><p><span>16. @atlassian-test-staging/test -&gt; 13330 total versions</span></p></div><div><div><p>18</p></div><p><span>17. @yuming2022/app-dnpkg-beta -&gt; 12995 total versions</span></p></div><div><div><p>19</p></div><p><span>18. nocodb-sdk-daily -&gt; 12512 total versions</span></p></div><div><div><p>20</p></div><p><span>19. @dais/sdk-minimal -&gt; 12090 total versions</span></p></div><div><div><p>21</p></div><p><span>20. nc-lib-gui-daily -&gt; 11874 total versions</span></p></div><div><div><p>22</p></div><p><span>21. binky -&gt; 11460 total versions</span></p></div><div><div><p>23</p></div><p><span>22. nocodb-daily -&gt; 11283 total versions</span></p></div><div><div><p>24</p></div><p><span>23. construct-hub-probe -&gt; 10822 total versions</span></p></div><div><div><p>25</p></div><p><span>24. renovate -&gt; 10369 total versions</span></p></div><div><div><p>26</p></div><p><span>25. @primer/react -&gt; 10320 total versions</span></p></div><div><div><p>27</p></div><p><span>26. @codecademy/styleguide -&gt; 10186 total versions</span></p></div><div><div><p>28</p></div><p><span>27. @prisma/client -&gt; 10064 total versions</span></p></div><div><div><p>29</p></div><p><span>28. @prisma/migrate -&gt; 9994 total versions</span></p></div><div><div><p>30</p></div><p><span>29. @prisma/generator-helper -&gt; 9847 total versions</span></p></div><div><div><p>31</p></div><p><span>30. decentraland-renderer -&gt; 9640 total versions</span></p></div><div><div><p>32</p></div><p><span>31. gfcdn.startpage -&gt; 9580 total versions</span></p></div><div><div><p>33</p></div><p><span>32. @prisma/debug -&gt; 9521 total versions</span></p></div><div><div><p>34</p></div><p><span>33. @codecademy/gamut -&gt; 9411 total versions</span></p></div><div><div><p>35</p></div><p><span>34. @coral-xyz/xnft-cli -&gt; 9397 total versions</span></p></div><div><div><p>36</p></div><p><span>35. @birdeye-so/tokenswap -&gt; 9382 total versions</span></p></div><div><div><p>37</p></div><p><span>36. @pdftron/webviewer -&gt; 9373 total versions</span></p></div><div><div><p>38</p></div><p><span>37. @gitpod/supervisor-api-grpcweb -&gt; 9274 total versions</span></p></div><div><div><p>39</p></div><p><span>38. @gitpod/local-app-api-grpcweb -&gt; 9177 total versions</span></p></div><div><div><p>40</p></div><p><span>39. kse-visilia -&gt; 9150 total versions</span></p></div><div><div><p>41</p></div><p><span>40. @prisma/fetch-engine -&gt; 8988 total versions</span></p></div><div><div><p>42</p></div><p><span>41. @coral-xyz/common -&gt; 8946 total versions</span></p></div><div><div><p>43</p></div><p><span>42. @prisma/get-platform -&gt; 8926 total versions</span></p></div><div><div><p>44</p></div><p><span>43. @materializeinc/sql-lexer -&gt; 8868 total versions</span></p></div><div><div><p>45</p></div><p><span>44. xnft -&gt; 8846 total versions</span></p></div><div><div><p>46</p></div><p><span>45. @prisma/language-server -&gt; 8826 total versions</span></p></div><div><div><p>47</p></div><p><span>46. prisma -&gt; 8675 total versions</span></p></div><div><div><p>48</p></div><p><span>47. @stoplight/cli -&gt; 8455 total versions</span></p></div><div><div><p>49</p></div><p><span>48. electron-apps -&gt; 8445 total versions</span></p></div><div><div><p>50</p></div><p><span>49. @knapsack/schema-utils -&gt; 8332 total versions</span></p></div><div><div><p>51</p></div><p><span>50. @knapsack/utils -&gt; 8323 total versions</span></p></div></code></pre></figure></div>
</section>  </article></div>
  </body>
</html>
