<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.cybertec-postgresql.com/en/debugging-postgresql-more-easily/">Original</a>
    <h1>Debugging PostgreSQL More Easily</h1>
    
    <div id="readability-page-1" class="page"><div id="inner_content-3-44712">
<p>PostgreSQL is the foundation for thousands and thousands of applications. The system has long proven its worth and is operating reliably. However, the question people often ask is: What is the best way to actually debug a database application? </p>




<p>For a couple of years now, I have been using a simple method that greatly speeds up the debugging process of typical applications.</p>



<h2 id="h-using-inheritance-to-store-data"><span id="using-inheritance-to-store-data"></span>Using inheritance to store data<span></span></h2>



<p>One of the core features of PostgreSQL, which has been around for decades already, is the idea of <a href="https://www.postgresql.org/docs/current/tutorial-inheritance.html" target="_blank" rel="noreferrer noopener">&#34;inheritance&#34;</a>. So what does that mean, exactly? Simply speaking, tables can inherit columns from each other. A child table will simply have all the columns of the parent table, plus its own additional ones.</p>



<p>But what does this mean in real life, and what does it have to do with debugging? Let us take a closer look:</p>



<div><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67dd11d2321fc056915801" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>CREATE</span><span> </span><span>TABLE</span><span> </span>t_global<span> </span></p><p>(</p><p><span>	</span>id<span> 		</span><span>serial</span>,<span> </span></p><p><span>	</span>tstamp<span> 		</span><span>timestamptz</span><span> 	</span><span>DEFAULT</span><span> </span><span>now</span>()<span> </span></p><p>);</p><p><span>CREATE</span><span> </span><span>TABLE</span><span> </span>t_product<span> </span></p><p>(</p><p><span>	</span><span>name</span><span> 		</span><span>text</span>,<span> </span></p><p><span>	</span>price<span> 		</span><span>numeric</span></p><p>)<span> </span><span>INHERITS</span><span> </span>(t_global);</p><p><span>INSERT</span><span> </span><span>INTO</span><span> </span>t_product<span> </span>(<span>name</span>,<span> </span>price)<span> </span></p><p><span>	</span><span>VALUES</span><span> 	</span>(<span>&#39;Shoes&#39;</span>,<span> </span>113.98),<span> </span></p><p><span>		</span>(<span>&#39;Sausage&#39;</span>,<span> </span>4.58);</p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0024 seconds] -->
</div>



<p>The t_global table contains a sequence including a timestamp. Those two columns are passed on to t_product. What this means is that the sequence now also applies to the child table.</p>



<p>Here is a second table:</p>



<div><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67dd11d232203817183964" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>CREATE</span><span> </span><span>TABLE</span><span> </span>t_country<span> </span></p><p>(<span>	</span></p><p><span>	</span>country_name<span> 	</span><span>text</span></p><p>)<span> </span><span>INHERITS</span><span> </span>(t_global);</p><p><span>INSERT</span><span> </span><span>INTO</span><span> </span>t_country<span> </span>(country_name)<span> </span></p><p><span>	</span><span>VALUES</span><span> 	</span>(<span>&#39;Austria&#39;</span>),<span> </span></p><p><span>		</span>(<span>&#39;Germany&#39;</span>),<span> </span></p><p><span>		</span>(<span>&#39;Japan&#39;</span>);</p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
</div>



<p>We are now using the same parent table for the country table. What does it matter? What we have just produced is two things: First of all, there is ONE global sequence for all tables, which means that all IDs across the entirety of the systems are unique (we will need this later). Also: All tables have a timestamp that has an identical default value. </p>



<h2 id="h-using-the-parent-table-for-debugging-applications"><span id="using-the-parent-table-for-debugging-applications"></span>Using the parent table for debugging applications<span></span></h2>



<p>Let us now imagine for a second that we want to debug an application, and we want to know two things:</p>



<ul>
<li>In which table is the ID we are looking for located?</li>



<li>Which operations have happened inside the same transaction?</li>
</ul>



<p>The structure we have just created makes answering these two questions really easy:</p>



<div><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67dd11d232205518738950" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p>test=#<span> </span><span>SELECT</span><span> </span>tableoid::regclass,<span> </span>*<span> </span><span>FROM</span><span> </span>t_global;</p><p><span> </span>tableoid<span>  </span>|<span> </span>id<span> </span>|<span>            </span>tstamp<span>             </span></p><p><span>-----------+----+-------------------------------</span></p><p><span> </span>t_product<span> </span>|<span>  </span>1<span> </span>|<span> </span>2025<span>-</span>01<span>-</span>24<span> </span>12:02:07.295524<span>+</span>01</p><p><span> </span>t_product<span> </span>|<span>  </span>2<span> </span>|<span> </span>2025<span>-</span>01<span>-</span>24<span> </span>12:02:07.295524<span>+</span>01</p><p><span> </span>t_country<span> </span>|<span>  </span>3<span> </span>|<span> </span>2025<span>-</span>01<span>-</span>24<span> </span>12:02:07.295524<span>+</span>01</p><p><span> </span>t_country<span> </span>|<span>  </span>4<span> </span>|<span> </span>2025<span>-</span>01<span>-</span>24<span> </span>12:02:07.295524<span>+</span>01</p><p><span> </span>t_country<span> </span>|<span>  </span>5<span> </span>|<span> </span>2025<span>-</span>01<span>-</span>24<span> </span>12:02:07.295524<span>+</span>01</p><p>(5<span> </span><span>rows</span>)</p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</div>



<p>Remember, there is just one single sequence that feeds all the ID columns, so we can rely on the fact that the ID is unique all across the database. But there is more: In PostgreSQL, every table supports a virtual column called &#34;tableoid&#34;. It shows the object ID of a table. The trick now is as follows: If we cast this object ID to a special data type (= regclass), it will give us a string representation of the table name. In other words, we can run a single SQL statement and it will give us all the IDs in the entire system, including the tablename containing this ID. Supported by the fact that everything in your entire application is unique, we can easily figure out where to find anything we might be looking for.</p>



<p>However, we might want to take a closer look at the second column: The timestamp. Note that all timestamps are the same. This is the case because all data has been written by the same transaction. At one glance, we can see in which order data has been inserted, and, at the same time, we can see if this has happened inside the same transaction. All the while, we still have full visibility of the order in which data has changed across ALL tables. </p>



<p>The method outlined in this post has served me well for many years, and has made my work of debugging the database side of things a lot easier. Therefore, I hope that this can help other people out there as well.</p>



<p>Do you need support for your PostgreSQL request? We will be happy to help you. <a href="https://www.cybertec-postgresql.com/en/contact">Contact us</a> directly.</p>
</div></div>
  </body>
</html>
