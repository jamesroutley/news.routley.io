<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.deusinmachina.net/p/c-strings-and-my-slow-descent-to">Original</a>
    <h1>C Strings and my slow descent to madness</h1>
    
    <div id="readability-page-1" class="page"><div><div><article><div class=""><div><div dir="auto"><div><p><span>Credit to </span></p><p><span> For pointing out that &#34;Êúâ„ÇäÈõ£„ÅÜ&#34; means &#34;thank you&#34; instead of &#34;hello&#34;. I got my examples mixed up when I was coding and missed this. Thanks for the correction!</span></p></div><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Feb539b15-11cc-4f0e-9986-c481edbb636f_483x247.png" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Feb539b15-11cc-4f0e-9986-c481edbb636f_483x247.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Feb539b15-11cc-4f0e-9986-c481edbb636f_483x247.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Feb539b15-11cc-4f0e-9986-c481edbb636f_483x247.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Feb539b15-11cc-4f0e-9986-c481edbb636f_483x247.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Feb539b15-11cc-4f0e-9986-c481edbb636f_483x247.png" width="483" height="247" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/eb539b15-11cc-4f0e-9986-c481edbb636f_483x247.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:247,&#34;width&#34;:483,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:197065,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Feb539b15-11cc-4f0e-9986-c481edbb636f_483x247.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Feb539b15-11cc-4f0e-9986-c481edbb636f_483x247.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Feb539b15-11cc-4f0e-9986-c481edbb636f_483x247.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Feb539b15-11cc-4f0e-9986-c481edbb636f_483x247.png 1456w" sizes="100vw"/></picture></div></a></figure></div><p>I‚Äôve been on a C kick recently as I learn the intricacies involved in low level programming. As a Data Scientist/Python Programmer I work with strings all the time. People say that handling strings in C range anywhere from tricky to downright awful. I was curious so I decided to see how deep the rabbit hole went.</p><p><span>C strings are an array of characters that end with a null terminator, </span><code>\0</code><span>. When C manipulates strings the null terminator is what tells functions that the end of the string has been reached. In C we declare a string in two different ways. The first and most difficult way is as a literal character array.</span></p><pre><code><span>#include &lt;stdio.h&gt;

int main() {
  </span><strong>char myString[] = {&#39;H&#39;, &#39;e&#39;, &#39;l&#39;, &#39;l&#39;, &#39;o&#39;, &#39;,&#39;, &#39; &#39;, &#39;W&#39;, &#39;o&#39;, &#39;r&#39;, &#39;l&#39;, &#39;d&#39;,&#39;!&#39;,&#39;\n&#39;,&#39;\0&#39;};</strong><span>
    printf(&#34;%s&#34;, myString);
    return 0;
}</span></code></pre><p>This is error prone and requires you to insert the null terminator yourself. It also takes forever to write for long words, 0/10. The second way is as a string enclosed in double quotes.</p><pre><code><span>#include &lt;stdio.h&gt;

int main() {
    </span><strong>char myString[] = &#34;Hello, World!\n&#34;;</strong><span>
    printf(&#34;%s&#34;, myString);
    return 0;
}</span></code></pre><p>In this situation C knows exactly how long the string is and can automatically insert the null terminator. </p><p><span>Once you have properly encoded a string, there are many operations you can perform. Common functions on strings include </span><code>strcpy</code><span>, </span><code>strlen</code><span>, and </span><code>strcmp</code><span>. </span><code>strcpy </code><span>copies the string stored in one variable to another. </span><code>strlen </code><span>gets the length of a string (minus the null terminator), and </span><code>strcmp </code><span>takes two strings and returns 0 when they are true. Unfortunately, there is a lot of nuances when working with string functions. First, let‚Äôs take a look at an example of each starting with </span><code>strcpy</code><span>.</span></p><pre><code><span>int main() {
  char source[] = &#34;Hello, world!&#34;;
  char destination[20];

  </span><strong>strcpy(destination, source);</strong><span> // Copy the source string to the destination string

  printf(&#34;Source: %s\n&#34;, source);
  printf(&#34;Destination: %s\n&#34;, destination);

  return 0;
}</span></code></pre><p>Here is the output of our code from above.</p><pre><code>Source: Hello, world!
Destination: Hello, world!</code></pre><p><span>As you might have expected </span><code>strcpy </code><span>works by copying a string and putting its contents in another string. But you might be asking. ‚ÄúWhy can‚Äôt I just assign the source variable directly to the destination variable?‚Äù</span></p><pre><code><span>int main() {
  char source[] = &#34;Hello, world!&#34;;
  </span><strong>char* destination = source;</strong><span>

  strcpy(destination, source); // Copy the source string to the destination string

  printf(&#34;Source: %s\n&#34;, source);
  printf(&#34;Destination: %s\n&#34;, destination);

  return 0;
}</span></code></pre><p><span>You can. It‚Äôs just that </span><code>destination </code><span>now becomes a </span><code>char*</code><span> and exists as a pointer to the </span><code>source </code><span>character array. If that isn‚Äôt what you want them this will almost certainly cause issues. </span></p><p><span>Our next string operation is </span><code>strlen</code><span>, which gets the size of the string minus the null terminator.</span></p><pre><code><span>#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main() {
  char str[] = &#34;Hello, world!&#34;; // The string to find the length of

  </span><strong>int length = strlen(str);</strong><span> // Find the length of the string

  printf(&#34;The length of the string &#39;%s&#39; is %d.\n&#34;, str, length);

  return 0;
}
</span></code></pre><p><span>The output of our print function for </span><code>strlen</code><span> looks like this.</span></p><pre><code>The length of the string &#39;Hello, world!&#39; is 13.</code></pre><p>This is pretty straightforward. It just counts the characters until it hits the null terminator. </p><p><span>Our last function is </span><code>strcmp.</code><span> It looks at two strings and determines whether they are equal to each other or not. If they are it returns 0. If they aren‚Äôt it returns 1</span></p><p><span>.</span></p><pre><code><span>#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main() {
  char str1[] = &#34;Hello, world!&#34;; 
  char str2[] = &#34;hello, world!&#34;; 

  </span><strong>int result = strcmp(str1, str2);</strong><span> // Compare the two strings

  if (result == 0) {
    printf(&#34;The strings are equal.\n&#34;);
  } else {
    printf(&#34;The %s is not equal to %s\n&#34;, str1, str2);
  }

  return 0;
}
</span></code></pre><p><span>The output of our </span><code>strcmp </code><span>function‚Ä¶.</span></p><pre><code>The strings are not equal</code></pre><p><span>Now that we know how to copy, get the length, and compare our strings I‚Äôll drop the bombshell. None of these are safe operations, and it‚Äôs easy to create undefined behavior. This mostly revolves around the use of </span><code>\0</code><span> as the null terminator. In the case of the above C functions as well as others, C expects to find a \0 which tells the function to stop reading the area in memory where the string lives. But what if there is no null terminator? Well, C will happily keep reading the contents in memory after the string should have ended. If our program‚Äôs function was supposed to verify the user‚Äôs supplied password, a bad actor could potentially skip the area in memory where the password check happens and go right into the function that is called for password successes, by exploiting a buffer overflow with the string. This would circumvent the entire authorization process. So how do we handle this?</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5a3766e-66e0-4263-b2e4-e79b1605cfc9_498x280.gif" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5a3766e-66e0-4263-b2e4-e79b1605cfc9_498x280.gif 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5a3766e-66e0-4263-b2e4-e79b1605cfc9_498x280.gif 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5a3766e-66e0-4263-b2e4-e79b1605cfc9_498x280.gif 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5a3766e-66e0-4263-b2e4-e79b1605cfc9_498x280.gif 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5a3766e-66e0-4263-b2e4-e79b1605cfc9_498x280.gif" width="498" height="280" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/f5a3766e-66e0-4263-b2e4-e79b1605cfc9_498x280.gif&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:280,&#34;width&#34;:498,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:2285434,&#34;alt&#34;:&#34;Gif of someone pointing, putting on the helmet and saying safety first on a bicycle&#34;,&#34;title&#34;:null,&#34;type&#34;:&#34;image/gif&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="Gif of someone pointing, putting on the helmet and saying safety first on a bicycle" title="Gif of someone pointing, putting on the helmet and saying safety first on a bicycle" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5a3766e-66e0-4263-b2e4-e79b1605cfc9_498x280.gif 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5a3766e-66e0-4263-b2e4-e79b1605cfc9_498x280.gif 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5a3766e-66e0-4263-b2e4-e79b1605cfc9_498x280.gif 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5a3766e-66e0-4263-b2e4-e79b1605cfc9_498x280.gif 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>You sweet summer child</figcaption></figure></div><p><span>If you do some poking around, you might find a function called </span><code>strncpy</code><span>. When you look at its definition, you‚Äôll see that it copies a source string into a destination string and allows you to specify the number of bytes to copy. ‚ÄúThis looks perfect!‚Äù you might say. I can make sure that my destination string only receives as many bytes as it can handle. Here is some code below that illustrates that as well as its output.</span></p><pre><code><span>#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

#define dest_size 12
int main(){
    char source[] = &#34;Hello, World!&#34;;
    char dest[dest_size];
    
    // Copy at most 12 characters from source to dest
    </span><strong>strncpy(dest, source, dest_size)</strong><span>;
    
    printf(&#34;Source string: %s\n&#34;, source);
    printf(&#34;Destination string: %s\n&#34;, dest);
    
    return 0;
}
</span></code></pre><pre><code>Source string: Hello, World!
Destination string: Hello, World</code></pre><p><span>At first this looks great, but there is a problem. What happens when the source string minus the null terminator is as long as the size of the destination string? The answer is that the destination gets filled with all the characters of the source string with no room left for the null terminator. A non-null terminated string will most certainly cause you headaches later on. ‚ÄúOkay‚Äù you might say. But at least it can handle the case where the source string is smaller than the destination string? And yes, it can handle that case, but so can </span><code>strcpy</code><span>. And if the source string is smaller than the destination string, all the extra space in the destination string that isn‚Äôt used is still reserved and padded. So, if the destination string is 20 characters long but the source string is only 13 you get a destination string that effectively looks like this.</span></p><pre><code>char destination[20] = {&#39;H&#39;, &#39;e&#39;, &#39;l&#39;, &#39;l&#39;, &#39;o&#39;, &#39;,&#39;, &#39; &#39;, &#39;W&#39;, &#39;o&#39;, &#39;r&#39;, &#39;l&#39;, &#39;d&#39;, &#39;!&#39;, &#39;\0&#39;, &#39;\0&#39;, &#39;\0&#39;, &#39;\0&#39;, &#39;\0&#39;, &#39;\0&#39;, &#39;\0&#39;};</code></pre><p><span>So no proper null termination and excessive padding. That isn‚Äôt great. If you happen to be on Windows and use the </span><code>strncpy </code><span>function, the Microsoft Visual C++ (MSVC) Compiler won‚Äôt even compile the program. You have to manually set a flag to allow using deprecated features, which is a hint you should probably not be using it.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31328df4-fd0c-42a4-8b09-5ac258120b47_1004x290.png" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31328df4-fd0c-42a4-8b09-5ac258120b47_1004x290.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31328df4-fd0c-42a4-8b09-5ac258120b47_1004x290.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31328df4-fd0c-42a4-8b09-5ac258120b47_1004x290.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31328df4-fd0c-42a4-8b09-5ac258120b47_1004x290.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31328df4-fd0c-42a4-8b09-5ac258120b47_1004x290.png" width="1004" height="290" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/31328df4-fd0c-42a4-8b09-5ac258120b47_1004x290.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:290,&#34;width&#34;:1004,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:10986,&#34;alt&#34;:&#34;&#34;,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" title="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31328df4-fd0c-42a4-8b09-5ac258120b47_1004x290.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31328df4-fd0c-42a4-8b09-5ac258120b47_1004x290.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31328df4-fd0c-42a4-8b09-5ac258120b47_1004x290.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31328df4-fd0c-42a4-8b09-5ac258120b47_1004x290.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p><span>It suggests using </span><code>strncpy_s </code><span>instead. Let‚Äôs look at that now. </span><code>strncpy_s </code><span>accepts these parameters‚Ä¶</span></p><ul><li><p><code>char *restrict dest</code><span>: The destination string</span></p></li><li><p><code>rsize_t destsz</code><span>: The size of the destination string</span></p></li><li><p><code>const char *restrict src</code><span>: The source string to be copied</span></p></li><li><p><code>rsize_t count</code><span>: The maximum number of bytes to copy from the source string</span></p></li></ul><p><span>If the destination string is longer than the source string than everything gets copied fine. But if the destination is smaller than the source, then only the size of the destination -1 is copied over. The additional check that </span><code>strncpy_s </code><span>makes is that it ensures that even when a source string is copied into a destination string, the resulting string is always null terminated. This is great, but again we have two problems.</span></p><ol><li><p>strncpy_s does not handle excessive padding</p></li><li><p>strncpy_s is not portable to macOS or Linux</p></li></ol><p>Now if at this point you are shaking your fist at the sky cursing the C standards committee for dragging their feet on implementing portable safer string operations for 34 years, I don‚Äôt blame you. </p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7412898f-ad7e-4e85-8bda-41d5c09fab5b_348x220.gif" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7412898f-ad7e-4e85-8bda-41d5c09fab5b_348x220.gif 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7412898f-ad7e-4e85-8bda-41d5c09fab5b_348x220.gif 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7412898f-ad7e-4e85-8bda-41d5c09fab5b_348x220.gif 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7412898f-ad7e-4e85-8bda-41d5c09fab5b_348x220.gif 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7412898f-ad7e-4e85-8bda-41d5c09fab5b_348x220.gif" width="348" height="220" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/7412898f-ad7e-4e85-8bda-41d5c09fab5b_348x220.gif&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:220,&#34;width&#34;:348,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:1520501,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/gif&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7412898f-ad7e-4e85-8bda-41d5c09fab5b_348x220.gif 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7412898f-ad7e-4e85-8bda-41d5c09fab5b_348x220.gif 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7412898f-ad7e-4e85-8bda-41d5c09fab5b_348x220.gif 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7412898f-ad7e-4e85-8bda-41d5c09fab5b_348x220.gif 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p>So how can we handle this case safely? There are a few ways I can think of.</p><ol><li><p><span>If you are working with strings of a known length like in our contrived example it could be as simple as initializing our destination string to the </span><code>sizeof()</code><span> source string. </span></p></li><li><p>You could just work with a pointer to the source string and forgo copying completely. So long as the source string is properly terminated you won‚Äôt have to deal with mismatched buffer sizes.</p></li><li><p>You could forgo portability and use the _s versions of string functions on Windows, or ‚Äúl‚Äù versions of them on macOS.</p></li><li><p>You could use a different language üôä</p></li></ol><p><span>By this point you may have noticed that I‚Äôve spent a lot of time talking about </span><code>strcpy </code><span>but have only briefly talked about </span><code>strcmp </code><span>and </span><code>strlen</code><span>. They all suffer from the same issue that stems from the way C strings are terminated. Because the length of a string is unknown until you hit a null terminator you get all sorts of undefined behavior and attack vectors. This is in contrast to C++ which treats strings as objects and encodes the length of the string along with the number of characters. This is one of the reasons why people tend to write C in C++. Use all the bits you consider ‚Äúgood‚Äù and ignore everything else. </span></p><p>To handle these properly in pure C requires carefully implementing checks around string operations. This is error prone, and harder as the program gets larger. This is one of the reasons why C is considered an unsafe language.</p><p><span>Unicode was an important step in text encoding for computers. Today, UTF-8 is the dominate encoding for text. I briefly summarize its history in this article </span><a href="https://www.deusinmachina.net/i/94311629/a-brief-history-of-text-encoding" rel="">Breaking the Snake: How Python went from 2 to 3</a><span>, so I won‚Äôt belabor the point here. C didn‚Äôt gain Unicode support until C99, and even if you handle it properly in C you can run into issues in other ways as you will see in a moment. If we try to print out some Japanese characters‚Ä¶</span></p><pre><code><span>#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main() {
    </span><strong>printf(&#34;Êúâ„ÇäÈõ£„ÅÜ\n&#34;);</strong><span>
    return 0;
}</span></code></pre><p>The output isn‚Äôt what we expect.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa467485-6db7-499c-8a01-cb8f46c67045_786x124.png" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa467485-6db7-499c-8a01-cb8f46c67045_786x124.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa467485-6db7-499c-8a01-cb8f46c67045_786x124.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa467485-6db7-499c-8a01-cb8f46c67045_786x124.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa467485-6db7-499c-8a01-cb8f46c67045_786x124.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa467485-6db7-499c-8a01-cb8f46c67045_786x124.png" width="786" height="124" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/fa467485-6db7-499c-8a01-cb8f46c67045_786x124.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:124,&#34;width&#34;:786,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:13372,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa467485-6db7-499c-8a01-cb8f46c67045_786x124.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa467485-6db7-499c-8a01-cb8f46c67045_786x124.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa467485-6db7-499c-8a01-cb8f46c67045_786x124.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa467485-6db7-499c-8a01-cb8f46c67045_786x124.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p>This is because we aren‚Äôt interpreting the characters as Unicode characters. Let‚Äôs rewrite the code to fix that.</p><pre><code><span>#include &lt;stdio.h&gt;
</span><strong>#include &lt;wchar.h&gt;</strong><span>
</span><strong>#include &lt;locale.h&gt;</strong><span>

int main() { 
  </span><strong>setlocale(LC_ALL, &#34;&#34;);</strong><span> // Set the locale to the user&#39;s default locale
  </span><strong>wchar_t hello[] = L&#34;Êúâ„ÇäÈõ£„ÅÜ&#34;;</strong><span>
  </span><strong>wprintf(L&#34;Hello in Japanese is: %ls\n&#34;, hello);</strong><span>
  return 0;
}</span></code></pre><p><span>I added the string</span><code> </code><span>‚ÄúHello in Japanese is:‚Äù for a good reason. If you look at the screenshot below you can see why. The output still isn‚Äôt shown.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc05e3a02-8289-4bab-8108-252a97449724_793x403.png" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc05e3a02-8289-4bab-8108-252a97449724_793x403.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc05e3a02-8289-4bab-8108-252a97449724_793x403.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc05e3a02-8289-4bab-8108-252a97449724_793x403.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc05e3a02-8289-4bab-8108-252a97449724_793x403.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc05e3a02-8289-4bab-8108-252a97449724_793x403.png" width="793" height="403" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/c05e3a02-8289-4bab-8108-252a97449724_793x403.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:403,&#34;width&#34;:793,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:30137,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc05e3a02-8289-4bab-8108-252a97449724_793x403.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc05e3a02-8289-4bab-8108-252a97449724_793x403.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc05e3a02-8289-4bab-8108-252a97449724_793x403.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc05e3a02-8289-4bab-8108-252a97449724_793x403.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p><span>Checking the encoding of the PowerShell Console we see that it‚Äôs in ASCII. Okay let‚Äôs change the encoding with </span><code>$OutputEncoding = [System.Text.Encoding]::UTF8</code><span>. Now it‚Äôs in UTF-8. It still doesn‚Äôt work. Maybe it‚Äôs because the font doesn‚Äôt support Japanese. Some quick Googling later I see that the MS Gothic font does, and I switch my font to that. </span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9b34a60f-a262-4fa0-8912-b25b8476160b_720x290.png" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9b34a60f-a262-4fa0-8912-b25b8476160b_720x290.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9b34a60f-a262-4fa0-8912-b25b8476160b_720x290.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9b34a60f-a262-4fa0-8912-b25b8476160b_720x290.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9b34a60f-a262-4fa0-8912-b25b8476160b_720x290.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9b34a60f-a262-4fa0-8912-b25b8476160b_720x290.png" width="720" height="290" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/9b34a60f-a262-4fa0-8912-b25b8476160b_720x290.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:290,&#34;width&#34;:720,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:9537,&#34;alt&#34;:&#34;Screenshot of PowerShell in MS gothic&#34;,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="Screenshot of PowerShell in MS gothic" title="Screenshot of PowerShell in MS gothic" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9b34a60f-a262-4fa0-8912-b25b8476160b_720x290.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9b34a60f-a262-4fa0-8912-b25b8476160b_720x290.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9b34a60f-a262-4fa0-8912-b25b8476160b_720x290.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9b34a60f-a262-4fa0-8912-b25b8476160b_720x290.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>output of dir in PowerShell</figcaption></figure></div><p><span>My ‚Äú\‚Äù are now ‚Äú¬•‚Äù but I can live with that if this works. I named a test folder Êúâ„ÇäÈõ£„ÅÜ to make sure that PowerShell displays it correctly. If we look at the test folder now, we see kanji are now being displayed correctly. But even with that change the code still doesn‚Äô t print the characters! I try setting the locale to </span><code>ja_JP.UTF8</code><span>, but still can‚Äôt get an output. Some more googling and I come across an article title </span><em>PowerShell console characters are garbled for Chinese, Japanese, and Korean languages on Windows Server 2022</em></p><p><span> which states....</span></p><blockquote><p>By default, Windows PowerShell .lnk shortcut is hardcoded to use the &#34;Consolas&#34; font. The &#34;Consolas&#34; font doesn&#39;t have the glyphs for CJK characters, so the characters aren&#39;t rendered correctly. Changing the font to &#34;MS Gothic&#34; explicitly fixes the issue because the &#34;MS Gothic&#34; font has glyphs for CJK characters.</p><p>The Command Prompt (cmd.exe) doesn&#39;t have this issue, because the cmd .lnk shortcut doesn&#39;t specify a font. The console chooses the right font at runtime depending on the system language.</p><h2><strong>Resolution</strong></h2><p><strong>The issue will be fixed in Windows 11 and Windows Server 2022 very soon, but the fix won&#39;t be backported to lower versions.</strong></p><p>To work around the issue, use either of the following two workarounds.</p></blockquote><p><span>Okay cool this doesn‚Äôt seem like my exact issue, but it seems like PowerShell doesn‚Äôt handle Japanese characters well by default. I try using the Command Prompt with MS Gothic but that doesn‚Äôt solve it either. Everything that I‚Äôve Googled shows that this </span><em>should</em><span> work In C. I switch the code back to‚Ä¶</span></p><pre><code><code>#include &lt;stdio.h&gt;
#include &lt;wchar.h&gt;
#include &lt;locale.h&gt;

int main() { 
  setlocale(LC_ALL, &#34;&#34;); // Set the locale to the user&#39;s default locale
  wchar_t hello[] = L&#34;Êúâ„ÇäÈõ£„ÅÜ&#34;;
  wprintf(L&#34;Hello in Japanese is: %ls\n&#34;, hello);
  return 0;
}</code></code></pre><p>and I run it on my Raspberry PI and‚Ä¶ It works! </p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb6617ba-320d-4c11-a9e2-3394bdabb4a8_990x342.png" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb6617ba-320d-4c11-a9e2-3394bdabb4a8_990x342.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb6617ba-320d-4c11-a9e2-3394bdabb4a8_990x342.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb6617ba-320d-4c11-a9e2-3394bdabb4a8_990x342.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb6617ba-320d-4c11-a9e2-3394bdabb4a8_990x342.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb6617ba-320d-4c11-a9e2-3394bdabb4a8_990x342.png" width="990" height="342" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/fb6617ba-320d-4c11-a9e2-3394bdabb4a8_990x342.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:342,&#34;width&#34;:990,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:48709,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb6617ba-320d-4c11-a9e2-3394bdabb4a8_990x342.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb6617ba-320d-4c11-a9e2-3394bdabb4a8_990x342.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb6617ba-320d-4c11-a9e2-3394bdabb4a8_990x342.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffb6617ba-320d-4c11-a9e2-3394bdabb4a8_990x342.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p>I try it on my Macbook Pro and it works as well. I fire up PowerShell on my Macbook Pro and‚Ä¶ It still works‚Ä¶ So thankfully this isn‚Äôt a bug in C, but it does look like an issue with the way Windows handles non-Latin characters in its terminals. Alls I can say is‚Ä¶ Go easy on Microsoft. They are a small indie dev‚Ä¶. But for real if anyone knows how to get this to work on Windows 10 let me know!</p><p><span>Now that we can print Japanese characters correctly in C, lets look at one final case before this article gets too long. As we saw earlier getting the length of a string can be done with </span><code>strlen</code><span>. If we modify our naive C code from the beginning to get the </span><code>strlen </code><span>of the Japanese string it looks like this‚Ä¶</span></p><pre><code><span>#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main() {
  printf(&#34;The length of the string is %d characters\n&#34;, </span><strong>strlen(&#34;Êúâ„ÇäÈõ£„ÅÜ&#34;)</strong><span>);
  return 0;
}</span></code></pre><p>and the output is‚Ä¶</p><pre><code>The length of the string is 12 characters</code></pre><p>If we go back to our original print output, we can see this string of characters that is printed out incorrectly.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd35588aa-0e3e-43a8-84b7-1be79bec5d32_786x124.png" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd35588aa-0e3e-43a8-84b7-1be79bec5d32_786x124.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd35588aa-0e3e-43a8-84b7-1be79bec5d32_786x124.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd35588aa-0e3e-43a8-84b7-1be79bec5d32_786x124.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd35588aa-0e3e-43a8-84b7-1be79bec5d32_786x124.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd35588aa-0e3e-43a8-84b7-1be79bec5d32_786x124.png" width="786" height="124" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/d35588aa-0e3e-43a8-84b7-1be79bec5d32_786x124.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:124,&#34;width&#34;:786,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:9079,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd35588aa-0e3e-43a8-84b7-1be79bec5d32_786x124.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd35588aa-0e3e-43a8-84b7-1be79bec5d32_786x124.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd35588aa-0e3e-43a8-84b7-1be79bec5d32_786x124.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd35588aa-0e3e-43a8-84b7-1be79bec5d32_786x124.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p><span>You‚Äôll notice there are 12 characters. The reason for this is we are interpreting the string as ascii. Since kanji take more than one byte to encode, each byte in a 4 kanji word is being interpreted as an individual letter, as opposed to each cluster of bytes being associated as a kanji. If we change the string to a w_char instead of a char by prefixing it with a ‚ÄúL‚Äù, and use </span><code>wcslen </code><span>instead of </span><code>strlen </code><span>we get the code below‚Ä¶</span></p><pre><code><span>#include &lt;stdio.h&gt;
#include &lt;wchar.h&gt;
#include &lt;locale.h&gt;

int main() {
  printf(&#34;The length of the string is %d characters\n&#34;, </span><strong>wcslen(L&#34;Êúâ„ÇäÈõ£„ÅÜ&#34;)</strong><span>);
  return 0;
}
</span></code></pre><p>which prints out‚Ä¶</p><pre><code>The length of the string is 4 characters</code></pre><p>Joy.</p><p>This article only scratches the surface when it comes to working with C strings. We didn‚Äôt even have time to touch on the Unicode literals introduced in C11 like ‚Äòu8‚Äô, ‚Äòu‚Äô, and ‚ÄòU‚Äô. Needless to say, when working with C strings you have to be careful. At a minimum you could cause a headache for yourself by creating undefined behavior. On the other hand, you could potentially create an attack vector for someone to exploit. If you‚Äôve only worked in garbage collected programming languages, you might be wondering why go through the trouble to work in C. If you look at a language like Python, and the libraries that is uses in the data science field, most of them are built on top of C and C++. Someone‚Äôs got to do it, and if you have the knowledge, almost all languages have a C foreign function interface that can be leveraged to speed up code, so the benefits will usually carry over to other languages as well. So, learn you some C, but maybe don‚Äôt start with strings first.</p><p><span>If you made it this far thanks for reading! If you are new welcome! I like to talk about technology, niche programming languages, AI, and low-level coding. I‚Äôve recently started a </span><a href="https://twitter.com/deusinmach" rel="">Twitter</a><span> and would love for you to check it out. If you liked the article, consider liking and subscribing. And if you haven‚Äôt why not check out another article of mine! Thank you for your valuable time.</span></p><p data-attrs="{&#34;url&#34;:&#34;https://www.deusinmachina.net/?utm_source=substack&amp;utm_medium=email&amp;utm_content=share&amp;action=share&#34;,&#34;text&#34;:&#34;Share Deus In Machina&#34;,&#34;action&#34;:null,&#34;class&#34;:null}"><a href="https://www.deusinmachina.net/?utm_source=substack&amp;utm_medium=email&amp;utm_content=share&amp;action=share" rel=""><span>Share Deus In Machina</span></a></p></div></div></div></article></div></div></div>
  </body>
</html>
