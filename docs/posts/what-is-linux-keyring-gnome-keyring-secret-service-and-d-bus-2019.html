<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rtfm.co.ua/en/what-is-linux-keyring-gnome-keyring-secret-service-and-d-bus/">Original</a>
    <h1>What is: Linux keyring, gnome-keyring, Secret Service, and D-Bus (2019)</h1>
    
    <div id="readability-page-1" class="page"><div>
												<p><img src="https://rtfm.co.ua/wp-content/uploads/2016/01/What-is-it-e1452250201867.jpg" alt="" width="130" height="110"/>It’s a really long-read post and I wast sure if it’s better to split it into three parts or put them together. On the one side, there are keyrings, from another – D-Bus, and finally, there is a Secret Service.</p>
<p>Eventually, I decided to keep them here together as I googled all it in the same scope and the are related to each other.</p>
<p>So, in this post we will speak about the next:</p>
<ul>
<li>what is the <strong>keyring</strong> at all</li>
<li>what is the difference between the <strong>Linux keyring</strong> and <strong>GNOME keyring</strong>, and do they relate to each other</li>
<li>what keyring implementations are</li>
<li>what is the <code>org.freedesktop</code> <strong>Secret Service</strong> and how it relates to the <strong>GNOME keyring</strong></li>
<li>what is <strong>D-Bus</strong>, and how we can use it to see how a keyring service is working</li>
<li>and a couple of examples with <strong>Linux Keyring</strong>, <strong>GNOME Keyring</strong>, <strong>KWallet</strong>, and <strong>KeePass</strong> as a keyring backend</li>
</ul>
<p>This post is absolutely not kind of “tutorial” with “HowTo Configure it” but instead – just an overview of the components mentioned above to try to understand what they are and how they can be used.</p>
<p>See also:</p>
<ul>
<li><a href="https://rtfm.co.ua/en/linux-the-nextcloud-client-qtkeychain-and-the-the-name-org-freedesktop-secrets-was-not-provided-by-any-service-files-error/" target="_blank" rel="noopener noreferrer">Linux: the Nextcloud client, qtkeychain and the “The name org.freedesktop.secrets was not provided by any .service files” error</a></li>
<li><a href="https://rtfm.co.ua/en/linux-gnome-keyring-setup-as-freedesktop-secretservice/" target="_blank" rel="noopener noreferrer">Linux: gnome-keyring setup as Freedesktop SecretService</a></li>
<li><a href="https://rtfm.co.ua/en/keepass-an-mfa-totp-codes-a-browsers-passwords-ssh-keys-passwords-storage-configuration-and-secret-service-integration/" target="_blank" rel="noopener noreferrer">KeePass: an MFA TOTP codes, a browser’s passwords, SSH keys passwords storage configuration and Secret Service integration</a></li>
<li><a href="https://rtfm.co.ua/en/chromium-linux-keyrings-secret-service-passwords-encryption-and-store/" target="_blank" rel="noopener noreferrer">Chromium: Linux, keyrings &amp;&amp; Secret Service, passwords encryption and store</a></li>
<li><a href="https://rtfm.co.ua/en/keepass-ssh-keys-passwords-storage-and-decryption-on-linux/" target="_blank" rel="noopener noreferrer">KeePass: SSH keys password storage and decryption on Linux</a></li>
</ul>
<p>This post was written by a long-long googling, so here will be a lot of links to documents and other materials that were used.</p>
<p>I may confuse something or even understood in a wrong way, so please welcome to the comments, if you’ll see any errors.</p>
<p>The post’s writing process was like this:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_155939-1.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_155939-1.png" alt="" width="600" height="185" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_155939-1.png 1917w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_155939-1-300x92.png 300w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_155939-1-1024x315.png 1024w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_155939-1-768x236.png 768w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_155939-1-1536x473.png 1536w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_155939-1-660x203.png 660w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>

<h3><span id="What_is_the_Keyring"></span><span>What is the Keyring?</span><span></span></h3>
<p>To start what the “<strong>keyring</strong>” word means at all?</p>
<p>Let’s start with Wikipedia – <a href="https://en.wikipedia.org/wiki/Keyring_(cryptography)" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Keyring_(cryptography)</a>:</p>
<blockquote><p>In cryptography, a keyring stores known encryption keys (and, in some cases, passwords).</p></blockquote>
<p>Then, let’s proceed with the GNOME project documentation – <a href="https://help.gnome.org/users/seahorse/stable/keyring.html.en" target="_blank" rel="noopener noreferrer">https://help.gnome.org/users/seahorse/stable/keyring.html.en</a>:</p>
<blockquote><p>Much like a keyring in real life allows you to keep certain sets of keys together, a keyring in Passwords and Keys allows you to keep passwords and keys in separate groups.</p></blockquote>
<p>And even let’s take a look at the MySQL documentation – <a href="https://dev.mysql.com/doc/refman/5.7/en/keyring-service.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/5.7/en/keyring-service.html</a>:</p>
<blockquote><p>a keyring service that enables internal server components and plugins to securely store sensitive information for later retrieval</p></blockquote>
<p>Finally, take a look at the <em>keyrings(7)</em> man-page – <a href="http://man7.org/linux/man-pages/man7/keyrings.7.html" target="_blank" rel="noopener noreferrer">http://man7.org/linux/man-pages/man7/keyrings.7.html</a>:</p>
<blockquote><p>The Linux key-management facility is primarily a way for various kernel components to retain or cache security data, authentication keys, encryption keys, and other data in the kernel.</p></blockquote>
<p>So, the <strong>keyring</strong> <em>concept</em> – it is some mechanism, or facility, or a concrete application, intended to store some confidential data.</p>
<p>Good, let’s go deeper.</p>
<h4><span id="Linux_keyring_vs_gnome-keyring"></span><span>Linux keyring vs gnome-keyring</span><span></span></h4>
<p>Useful links used:</p>
<ul>
<li><a href="https://www.kernel.org/doc/Documentation/security/keys.txt" target="_blank" rel="noopener noreferrer">KERNEL KEY RETENTION SERVICE</a></li>
<li><a href="http://www.ict.griffith.edu.au/anthony/info/crypto/passwd_caching.txt" target="_blank" rel="noopener noreferrer">http://www.ict.griffith.edu.au/anthony/info/crypto/passwd_caching.txt</a></li>
<li><a href="http://www.ict.griffith.edu.au/anthony/info/crypto/" target="_blank" rel="noopener noreferrer">http://www.ict.griffith.edu.au/anthony/info/crypto/</a></li>
<li><a href="https://wiki.gnome.org/Projects/GnomeKeyring" target="_blank" rel="noopener noreferrer">https://wiki.gnome.org/Projects/GnomeKeyring</a></li>
<li><a href="https://wiki.archlinux.org/index.php/GNOME/Keyring" target="_blank" rel="noopener noreferrer">https://wiki.archlinux.org/index.php/GNOME/Keyring</a></li>
</ul>
<p>Now, let’s speak about the difference between the <strong>Linux kernel keyring</strong> and the <strong>GNOME Keyring</strong>: at first, I was confused as I suggested that GNOME Keyring somehow uses kernel’s keyrings facility, but now – it’s just different things.</p>
<p>Let’s go back to the <a href="http://man7.org/linux/man-pages/man7/keyrings.7.html" target="_blank" rel="noopener noreferrer">man 7 Linux keyrings</a>:</p>
<blockquote><p>keyrings – in-kernel key management and retention facility</p></blockquote>
<p>I.e. <em>Linux keyrings</em> – it’s is kernel’s mechanism providing the ability to store secret information.</p>
<p>Now, let’s read the <a href="https://wiki.gnome.org/Projects/GnomeKeyring" target="_blank" rel="noopener noreferrer"><code>gnome-keyring</code></a> documentation:</p>
<blockquote><p>GNOME Keyring is a collection of components in GNOME that store secrets, passwords, keys, certificates and make them available to applications.</p></blockquote>
<p>So, <em>GNOME Keyring</em> – is a collection of utilities (<code>gnome-keyring-daemon</code>, libraries, the <code>seahorse</code> package, etc) to store confidential data. See also <a href="https://wiki.gnome.org/Projects/GnomeKeyring/Architecture" target="_blank" rel="noopener noreferrer">GNOME Keyring architecture</a>.</p>
<p>Good documents also can be found here – <a href="http://www.ict.griffith.edu.au/anthony/info/crypto/" target="_blank" rel="noopener noreferrer">Tower Floor — Encryption</a>, in particular, see the <a href="http://www.ict.griffith.edu.au/anthony/info/crypto/passwd_caching.txt" target="_blank" rel="noopener noreferrer">Caching Passwords</a> document.</p>
<h5><span id="Summary"></span><span>Summary</span><span></span></h5>
<p>Let’s summarize the key differences between <em>Linux keyrings</em> and <em>GNOME Keyring</em>:</p>
<ul>
<li>main():
<ul>
<li>Linux kernel – is a kernel’s facility for “passwords caching” – it stores them in a computer’s memory during an active user’s/system session</li>
<li><code>gnome-keyring</code> –  is persistent storage with keeping data on a hard disk</li>
</ul>
</li>
<li> storing:
<ul>
<li>Linux keyring – store in RAM, thus passwords are available only during a session, there is no need to store them always</li>
<li><code>gnome-keyring</code> – creates a file on a disk, usually, in the <code>~/.local/share/keyrings/</code></li>
</ul>
</li>
<li>accessing:
<ul>
<li>Linux keyring – via syscalls from the user space into the kernel space</li>
<li><code>gnome-keyring</code> – via DBus</li>
</ul>
</li>
<li>applications to access:
<ul>
<li>Linux kernel – <code>keyctl</code>, <code>systemd-ask-password</code>, etc</li>
<li><code>gnome-keyring</code> – <a href="http://manpages.ubuntu.com/manpages/bionic/man1/secret-tool.1.html" target="_blank" rel="noopener noreferrer"><code>secret-tool</code></a>, libraries like<a href="https://pypi.org/project/keyring/" target="_blank" rel="noopener noreferrer"><code>python-keyring</code></a>, <a href="https://wiki.gnome.org/Apps/Seahorse" target="_blank" rel="noopener noreferrer"><code>seahorse</code></a>, etc</li>
</ul>
</li>
</ul>
<h4><span id="Keyrings_implementations"></span><span>Keyrings implementations</span><span></span></h4>
<ul>
<li><a href="https://utils.kde.org/projects/kwalletmanager/" target="_blank" rel="noopener noreferrer">KWallet</a></li>
<li><a href="https://wiki.gnome.org/Projects/GnomeKeyring" target="_blank" rel="noopener noreferrer">GNOME Keyring</a></li>
</ul>
<p>Beside that, <a href="https://pypi.org/project/keyring/" target="_blank" rel="noopener noreferrer"><code>python-keyring</code></a> mention:</p>
<ul>
<li><a href="https://pypi.org/project/gsheet-keyring" rel="nofollow">gsheet-keyring</a> – a backend that stores secrets in a Google Sheet. For use with <a href="https://pypi.org/project/ipython-secrets" rel="nofollow">ipython-secrets</a>.</li>
<li><a href="https://pypi.org/project/bitwarden-keyring/0.1.0/" rel="nofollow">bitwarden-keyring</a> – a backend that stores secrets in the <a href="https://bitwarden.com/" rel="nofollow">BitWarden</a> password manager.</li>
</ul>
<p>And this list is not full.</p>
<p>Also, there a bunch of client applications to be used with those keyrings, again the list is not full:</p>
<ul>
<li><a href="https://wiki.gnome.org/Projects/Libsecret" target="_blank" rel="noopener noreferrer"><code>libsecret</code></a></li>
<li><a href="https://pypi.org/project/keyring/" target="_blank" rel="noopener noreferrer"><code>python-keyring</code></a></li>
<li>Java-клиент <a href="https://github.com/swiesend/secret-service" target="_blank" rel="noopener noreferrer" data-pjax="#js-repo-pjax-container">secret-service</a></li>
<li><a href="https://inqlude.org/libraries/qtkeychain.html" target="_blank" rel="noopener noreferrer"><code>qtkeychain</code></a></li>
<li><a href="http://manpages.ubuntu.com/manpages/bionic/man1/secret-tool.1.html" target="_blank" rel="noopener noreferrer"><code>secret-tool</code></a></li>
<li>библиотека<a href="https://pypi.org/project/SecretStorage/" target="_blank" rel="noopener noreferrer"><code>SecretStorage</code></a></li>
</ul>
<h4><span id="Passwords_interception_from_the_gnome-keyting"></span><span>Passwords interception from the <code>gnome-keyting</code></span><span></span></h4>
<p>During googling, found an interesting bug discussion here – <a href="https://bugs.launchpad.net/ubuntu/+source/gnome-keyring/+bug/1780365" target="_blank" rel="noopener noreferrer">https://bugs.launchpad.net/ubuntu/+source/gnome-keyring/+bug/1780365</a></p>
<p>In short:</p>
<ol>
<li>a client and a service communicates via D-Bus</li>
<li>a client ask for some data from the Secret Service (<code>gnome-keyring</code> in this case)</li>
<li>the service via D-Bus send a confidential data</li>
<li>another, “bad”, process listens dbus-messages and intercepts a password</li>
</ol>
<h3><span id="What_is_the_Secret_Service"></span><span>What is the Secret Service?</span><span></span></h3>
<p>Another one concept I had to google about: what is the “Secret Service”? How it relates to the GNOME Keyring and to the KWallet?</p>
<p>What is it doing in the Linux and how can I touch it?</p>
<p>Well, let’s go to the documentation again – <a href="https://specifications.freedesktop.org/secret-service/latest/ch01.html" target="_blank" rel="noopener noreferrer">https://specifications.freedesktop.org/secret-service/latest/ch01.html</a>:</p>
<blockquote><p>The Secret Service API allows client applications to store secrets securely in a service running in the user’s login session.</p></blockquote>
<p>Aha, i.e. <em>Secret Service</em> – it’s not some particular service or an application, but it’s a specification, kind of an RFC created by the GNOME and KDE projects to determine how this API must be realized for a client which wants to use GNOME Keyring or KWallet to store their secrets.</p>
<p>Also, the Secret Service API supported not only by the GNOME Keyring and KWallet but also for example by the KeePass and other applications.</p>
<p>IMHO, a bit confusing is the <em>Secret Service</em> name itself – “a hidden service”. If it would be called <em>Secret<strong>s</strong> Service</em>, i.e. “service of a secrets data” – it would be much more clear.</p>
<h4><span id="The_Secret_Service_glossary"></span><span>The Secret Service glossary</span><span></span></h4>
<p>In short terms:</p>
<ul>
<li><a href="https://specifications.freedesktop.org/secret-service/latest/ch02.html" target="_blank" rel="noopener noreferrer">secret</a>:  a password itself, or any other secret data</li>
<li><a href="https://specifications.freedesktop.org/secret-service/latest/ch03.html" target="_blank" rel="noopener noreferrer">item</a>: each such a secret plus its set of attributes makes up an <em>item</em></li>
<li>collection: a set of such items makes a collection (similar to the keyring or wallet concepts)</li>
<li>collections and items represented by D-Bus objects, each with its unique path</li>
<li><a href="https://specifications.freedesktop.org/secret-service/latest/ch12.html" target="_blank" rel="noopener noreferrer">default collection</a>: client applications without special conditions have to save items to the default collection which has to be accessible via the  <code>/org/freedesktop/secrets/aliases/default</code> D-Bus path</li>
</ul>
<h3><span id="D-Bus"></span><span>D-Bus</span><span></span></h3>
<p>Oookay…</p>
<p>Not its time to try to recall with is the D-Bus so often mentioned in the previous parts, and how to deal with it.</p>
<p>So, the D-Bus on of the Linux kernel IPC – <em>Inter-Process Communication</em> – mechanisms, allowing for separate processes inside of an operating system to communicate with each other.</p>
<p>Useful links:</p>
<ul>
<li>documentation – <a href="https://techbase.kde.org/Development/Tutorials/D-Bus/Introduction" target="_blank" rel="noopener noreferrer">https://techbase.kde.org/Development/Tutorials/D-Bus/Introduction</a></li>
<li>one more doc: <a href="https://dbus.freedesktop.org/doc/dbus-tutorial.html" target="_blank" rel="noopener noreferrer">https://dbus.freedesktop.org/doc/dbus-tutorial.html</a></li>
<li>about D-Bus transports: <a href="https://dbus.freedesktop.org/doc/dbus-specification.html#transports" target="_blank" rel="noopener noreferrer">https://dbus.freedesktop.org/doc/dbus-specification.html#transports</a></li>
<li><a href="http://blog.siphos.be/2014/06/d-bus-quick-recap/" target="_blank" rel="noopener noreferrer">D-Bus, quick recap</a></li>
<li><a href="https://lists.freedesktop.org/archives/dbus/2008-July/010019.html" target="_blank" rel="noopener noreferrer">Universal standard mapping between D-Bus and URI namespaces</a></li>
<li><a href="https://developer.gnome.org/gio//2.28/gio-D-Bus-Addresses.html" target="_blank" rel="noopener noreferrer">D-Bus Addresses — D-Bus connection endpoints</a></li>
</ul>
<p>And in short about main concepts and terms in D-Bus:</p>
<ul>
<li><strong>D-Bus in general</strong>: it’s a “bus” for IPC, i.e. if in the previous SSH examples (see the <a href="https://rtfm.co.ua/en/ssh-rsa-keys-and-ssh-agent-for-ssh-keys-and-their-passwords-management/" target="_blank" rel="noopener noreferrer">SSH: RSA keys, and ssh-agent for SSH keys and their passwords management</a> post) a UNIX socket was used, this time we are using the bus mechanism, see the <a href="https://www.kernel.org/doc/html/latest/driver-api/driver-model/bus.html" target="_blank" rel="noopener noreferrer">https://www.kernel.org/doc/html/latest/driver-api/driver-model/bus.html</a>. In its turn, those buses can be
<ul>
<li>a session bus</li>
<li>a system bus</li>
<li>private buses</li>
</ul>
</li>
<li><strong>messages</strong>: a base communication unit, data transfer similar to the TCP/IP, just in the D-Bus all data of a message is included to the message and not split over TCP-packets
<ul>
<li>when a message is sent usually it leads to some method to be called to execute some actions by an application providing this method</li>
<li>a message can be sent by an application to itself</li>
</ul>
</li>
<li><strong>namespaces</strong> and <strong>addresses</strong>:
<ul>
<li>as various applications can be placed on the same bus (or “listen to the same bus”) and during that the same application can provide various objects which can accept messages, then need to have some way to address those messages. In D-Bus, such an address consists of an interface name + service + an object name</li>
<li>a namespace example – <em>org.freedesktop.dbus</em></li>
<li>an address example – <em>unix:tmpdir=/tmp/my-app-name</em></li>
</ul>
</li>
<li><strong>interface</strong>: a set of methods and signals on a particular bus f a particular object. You can think of interfaces as named methods and signals group.
<ul>
<li>most of the interfaces will lead to the concrete construction of a language used for an application, for example, it can be a Java interface or a virtual class in С++</li>
<li>an interface example – <em>org.freedesktop.Introspectable</em></li>
</ul>
</li>
<li><strong>service</strong>: represents a concrete connection of a particular application to a bus
<ul>
<li>under the <em>service</em> here means a bus name (in the <a href="https://techbase.kde.org/Development/Tutorials/D-Bus/Introduction#Namespaces_and_Addresses" target="_blank" rel="noopener noreferrer">origin</a> – <em>“well-known” Bus names</em>), but keep in mind that the “bus name” here implies a particular connection name but not the bus name</li>
<li>if an application has more then one connection to a bus, or if the application is running in multitype instances – expanded by a PID number, for example, to make it unique</li>
<li>a service example – <em>org.kde.screensaver</em></li>
</ul>
</li>
<li><strong>objects</strong>: the same application can provide access to its multiple objects using paths to separate those objects. Each such a path associated with a service represents a dedicated object, for example <code>/MainInterface</code> or <code>/Documents/Doc1</code>. Objects allow access to interfaces and the same object can provide such access to multiple interfaces at the same time
<ul>
<li>see the <a href="https://dbus.freedesktop.org/doc/dbus-tutorial.html#objects" target="_blank" rel="noopener noreferrer">https://dbus.freedesktop.org/doc/dbus-tutorial.html#objects</a></li>
</ul>
</li>
<li><strong>methods</strong>: each object has members of the two types – methods and signals
<ul>
<li>methods – ate messages sent to an object to trigger some action in an application, who created this object</li>
<li>methods can pass data to an application’s input and can return an output with some values from the application</li>
<li>methods always have a sender and receiver addresses</li>
</ul>
</li>
<li><strong>signals</strong>:
<ul>
<li>are similar to the methods, but are not tied to any specific destination and can be accepted by any application on the same bus</li>
<li>are generated by an application which exported an interface</li>
</ul>
</li>
</ul>
<h4><span id="D-Bus_tools"></span><span>D-Bus tools</span><span></span></h4>
<p>CLI:</p>
<ul>
<li><span id="qdbus"><a href="http://manpages.ubuntu.com/manpages/trusty/man1/qdbus.1.html" target="_blank" rel="noopener noreferrer"><code>qdbus</code></a>– watch and send messages via D-Bus</span></li>
<li><a href="https://dbus.freedesktop.org/doc/dbus-monitor.1.html" target="_blank" rel="noopener noreferrer"><code>dbus-monitor</code></a>– view a bus activity</li>
<li><code>dbus-send</code>– <span id="qdbus">send messages via D-Bus</span></li>
</ul>
<p>GUI:</p>
<ul>
<li><span id="qdbus"><a href="https://doc.qt.io/qt-5/qdbusviewer.html" target="_blank" rel="noopener noreferrer"><code>qdbusviewer</code></a> – view objects and messages, is a part of the <code>qt5-tools </code>set</span></li>
<li><a href="https://wiki.gnome.org/Apps/DFeet" target="_blank" rel="noopener noreferrer"><code>d-feet</code></a> – D-Bus debugger</li>
<li><a href="https://gitlab.freedesktop.org/bustle/bustle" target="_blank" rel="noopener noreferrer"><code>bustle</code></a> – D-Bus message analyzer and profiler</li>
</ul>
<p>For example <code>d-feet</code>, install it:</p>

<p>Run it:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_084229.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_084229.png" alt="" width="600" height="262" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_084229.png 1350w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_084229-300x131.png 300w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_084229-1024x447.png 1024w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_084229-768x335.png 768w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_084229-660x288.png 660w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<h3><span id="Keyrings_examples"></span><span>Keyrings examples</span><span></span></h3>
<p>And a few examples of how those backends can be used from a Python or CLI utilities.</p>
<h4><span id="Linux_keyring"></span><span>Linux keyring</span><span></span></h4>
<p>As already mentioned, the Linux keyring is a kind of “caching service” in the kernel.</p>
<p>You can use the <code>keyctl</code> utility from the <code>keyutils</code>, and <code>systemd-ask-password</code>.</p>
<p>To read about:</p>
<ul>
<li><a href="https://www.kernel.org/doc/Documentation/security/keys.txt" target="_blank" rel="noopener noreferrer">Kernel key retention service doc</a></li>
<li><a href="http://man7.org/linux/man-pages/man1/keyctl.1.html" target="_blank" rel="noopener noreferrer"><code>keyctl</code> doc</a></li>
</ul>
<p>And from the documentation:</p>
<blockquote><p>Each process subscribes to three keyrings: a thread-specific keyring, a process-specific keyring, and a session-specific keyring.</p></blockquote>
<p>Let’s see which keyrings are available for my current session:</p>
<div data-title="Terminal">
<p>keyctl show @s</p><p>Session Keyring</p><p>185597501 --alswrv   1000  1000  keyring: _ses</p><p>182944921 --alswrv   1000 65534   \_ keyring: _uid.1000</p>   </div>
<p>Or for my user:</p>
<div data-title="Terminal">
<p>keyctl show @u</p><p>Keyring</p><p>182944921 --alswrv   1000 65534  keyring: _uid.1000</p>   </div>
<p>Also, in the <code>/proc/key-users</code> you can get information about all keyrings and their statistics by each user:</p>
<div data-title="Terminal">
<p>cat /proc/key-users</p><p>0:    43 42/42 34/1000000 768/25000000</p><p>971:     1 1/1 1/200 9/20000</p><p>1000:     4 4/4 4/200 46/20000</p>   </div>
<p>And keys available for reading by our process (the<code>bash</code> which called the <code>cat</code>):</p>
<div data-title="Terminal">
<p>cat /proc/keys</p><p>008f6a74 I--Q---     1 perm 1f3f0000  1000 65534 keyring   _uid_ses.1000: 1</p><p>0ae78499 I--Q---     4 perm 1f3f0000  1000 65534 keyring   _uid.1000: empty</p><p>0b0ffe3d I--Q---   225 perm 3f030000  1000  1000 keyring   _ses: 1</p><p>2a28e4fe I--Q---    33 perm 3f030000  1000  1000 keyring   _ses: 1</p>   </div>
<p>A user’s keyrings in the current session:</p>
<div data-title="Terminal">
<p>keyctl describe @us</p><p>      -5: -lswrvalswrv------------  1000 65534 keyring: _uid_ses.1000</p>   </div>
<p>Keys in the current keyring:</p>
<div data-title="Terminal">
<p>keyctl list @us</p><p>1 key in keyring:</p><p>182944921: --alswrv  1000 65534 keyring: _uid.1000</p>   </div>
<p>Add a key:</p>
<div data-title="Terminal">
<p>keyctl add user example-key example-data @u</p><p>546850615</p>   </div>
<p>Find it:</p>
<div data-title="Terminal">
<p>keyctl request user example-key</p><p>546850615</p>   </div>
<p>Got its ID and now can read its content using this ID:</p>
<div data-title="Terminal">
<p>keyctl print 546850615</p><p>example-data</p>   </div>
<h5><span id="keyctl_syscall"></span><span><code>keyctl()</code> syscall</span><span></span></h5>
<p>Actually, the <code>keyctl</code> utility just executes the <a href="http://man7.org/linux/man-pages/man2/keyctl.2.html" target="_blank" rel="noopener noreferrer"><code>keyctl(2)</code></a> system call:</p>
<div data-title="Terminal">
<p>strace -e keyctl keyctl print 546850615</p><p>keyctl(KEYCTL_READ, 546850615, NULL, 0) = 12</p><p>keyctl(KEYCTL_READ, 546850615, &#34;example-data&#34;, 12) = 12</p><p>example-data</p><p>+++ exited with 0 +++</p>   </div>
<p>In the first call here – <code>keyctl(KEYCTL_READ, 546850615, NULL, 0) = 12</code>   – we performed the <code>keyctl()</code> syscall with passing the <code>KEYCTL_READ</code> operation and a key ID.</p>
<p>Okay – more or less clear here.</p>
<p>Materials used here:</p>
<ul>
<li><a href="https://www.kernel.org/doc/Documentation/security/keys.txt" target="_blank" rel="noopener noreferrer">https://www.kernel.org/doc/Documentation/security/keys.txt</a></li>
<li><a href="https://www.ibm.com/developerworks/library/l-key-retention/" target="_blank" rel="noopener noreferrer">https://www.ibm.com/developerworks/library/l-key-retention/</a></li>
<li><a href="http://man7.org/linux/man-pages/man7/keyrings.7.html" target="_blank" rel="noopener noreferrer">http://man7.org/linux/man-pages/man7/keyrings.7.html</a></li>
<li><a href="http://man7.org/linux/man-pages/man1/keyctl.1.html" target="_blank" rel="noopener noreferrer">http://man7.org/linux/man-pages/man1/keyctl.1.html</a></li>
<li><a href="http://man7.org/linux/man-pages/man2/keyctl.2.html" target="_blank" rel="noopener noreferrer">http://man7.org/linux/man-pages/man2/keyctl.2.html</a></li>
</ul>
<p>Let’s go to the keyring storages.</p>
<h4><span id="gnome-keyring"></span><span><code>gnome-keyring</code></span><span></span></h4>
<p>Really problematic package, as for me, but still it is most widely used.</p>
<p>Install if not present yet:</p>
<div data-title="Terminal">
<p>sudo pacman -S gnome-keyring</p>   </div>
<p>Check D-Bus services – look for the <code>org.freedesktop.secrets</code>:</p>
<div data-title="Terminal">
<p>dbus-send --session --dest=org.freedesktop.DBus --type=method_call --print-reply /org/freedesktop/DBus org.freedesktop.DBus.ListNames</p><p>...</p><p>string &#34;org.freedesktop.secrets&#34;</p><p>...</p>   </div>
<p><em>“Aha, here we are” (c)</em></p>
<p>Now we can get the service description by using the <a href="https://www.gnu.org/software/emacs/manual/html_node/dbus/Introspection.html" target="_blank" rel="noopener noreferrer"><code>org.freedesktop.DBus.Introspectable.Introspect</code></a> method:</p>
<div data-title="Terminal">
<p>dbus-send --session --print-reply --dest=org.freedesktop.DBus /org/freedesktop/secrets org.freedesktop.DBus.Introspectable.Introspect</p><p>...</p><p>&lt;node&gt;</p><p>&lt;interface name=&#34;org.freedesktop.DBus&#34;&gt;</p><p>&lt;method name=&#34;Hello&#34;&gt;</p><p>&lt;arg direction=&#34;out&#34; type=&#34;s&#34;/&gt;</p><p>&lt;/method&gt;</p><p>&lt;method name=&#34;RequestName&#34;&gt;</p><p>&lt;arg direction=&#34;in&#34; type=&#34;s&#34;/&gt;</p><p>&lt;arg direction=&#34;in&#34; type=&#34;u&#34;/&gt;</p><p>&lt;arg direction=&#34;out&#34; type=&#34;u&#34;/&gt;</p><p>&lt;/method&gt;</p><p>&lt;method name=&#34;ReleaseName&#34;&gt;</p><p>&lt;arg direction=&#34;in&#34; type=&#34;s&#34;/&gt;</p><p>&lt;arg direction=&#34;out&#34; type=&#34;u&#34;/&gt;</p><p>&lt;/method&gt;</p><p>...</p>   </div>
<p>Or with the <code>qdbus</code>, fid the service first:</p>
<div data-title="Terminal">
<p>qdbus | grep &#39;secrets\|keyring&#39;</p><p>org.freedesktop.secrets</p><p>org.gnome.keyring</p>   </div>
<p>Read the <code>qdbus</code> help:</p>
<div data-title="Terminal">
<p>qdbus --help</p><p>...</p><p>With 0 arguments, qdbus will list the services available on the bus</p><p>With just the servicename, qdbus will list the object paths available on the service</p><p>With service name and object path, qdbus will list the methods, signals and properties available on the object</p>   </div>
<p>And get the full service’s description:</p>
<div data-title="Terminal">
<p>qdbus org.freedesktop.secrets /org/freedesktop/secrets</p><p>signal void org.freedesktop.DBus.Properties.PropertiesChanged(QString interface_name, QVariantMap changed_properties, QStringList invalidated_properties)</p><p>method QDBusVariant org.freedesktop.DBus.Properties.Get(QString interface_name, QString property_name)</p><p>method QVariantMap org.freedesktop.DBus.Properties.GetAll(QString interface_name)</p><p>method void org.freedesktop.DBus.Properties.Set(QString interface_name, QString property_name, QDBusVariant value)</p><p>method QString org.freedesktop.DBus.Introspectable.Introspect()</p><p>method QString org.freedesktop.DBus.Peer.GetMachineId()</p><p>method void org.freedesktop.DBus.Peer.Ping()</p><p>...</p>   </div>
<h5><span id="D-Bus_GetConnectionUnixProcessID"></span><span>D-Bus <code>GetConnectionUnixProcessID</code></span><span></span></h5>
<p>Actually, I want to see who is listening on the another side of the bus. Let’s use the <a href="https://dbus.freedesktop.org/doc/dbus-java/api/org/freedesktop/DBus.html#GetConnectionUnixProcessID(java.lang.String)" target="_blank" rel="noopener noreferrer"><code>GetConnectionUnixProcessID</code></a> method for this:</p>
<div data-title="Terminal">
<p>qdbus --session org.freedesktop.DBus / org.freedesktop.DBus.GetConnectionUnixProcessID org.freedesktop.secrets</p><p>1278791</p>   </div>
<p>Here we did:</p>
<ul>
<li>a call to the <em>org.freedesktop.DBus</em> service</li>
<li>passing the / path</li>
<li>called the <code>org.freedesktop.DBus.GetConnectionUnixProcessID</code> method</li>
<li>and passing the service <em>org.freedesktop.secrets </em>name to the method to get its PID</li>
</ul>
<p>Check what is the <em>1278791</em> PID:</p>
<div data-title="Terminal">
<p>ps xu | grep 1278791</p><p>setevoy  1278791  0.0  0.0 383876  8092 ?        SLl  Dec03   0:00 /usr/bin/gnome-keyring-daemon --start --foreground --components=secrets</p>   </div>
<p>Nice.</p>
<p>So, now we are knowing that the Secret Service role is played by the <code>gnome-keyring</code> application. Let’s try to add and remove some data using the<code>python-keyring</code> and <code>secret-tool</code>.</p>
<h5><span id="python-keyring"></span><code><span>python-keyring</span></code><span></span></h5>
<p>Start with the <code>python-keyring</code>.</p>
<p>Install it:</p>
<div data-title="Terminal">
<p>sudo pacman -S python-keyring</p>   </div>
<p>Check:</p>
<div data-title="Terminal">
<p>&gt;&gt;&gt; import keyring</p><p>&gt;&gt;&gt; keyring.set_password(&#34;system&#34;, &#34;username&#34;, &#34;password&#34;)</p><p>&gt;&gt;&gt; keyring.get_password(&#34;system&#34;, &#34;username&#34;)</p><p>&#39;password&#39;</p>   </div>
<p>In case of errors like (can happen on the first run after installation on Arch Linux, for example):</p>
<div data-title="Terminal">
<p>&gt;&gt;&gt; keyring.set_password(&#34;system&#34;, &#34;username&#34;, &#34;password&#34;)</p><p>Traceback (most recent call last):</p><p>...</p><p>jeepney.wrappers.DBusErrorResponse: [org.freedesktop.DBus.Error.UnknownMethod] (&#39;No such interface “org.freedesktop.DBus.Properties” on object at path /org/freedesktop/secrets/collection/login&#39;,)</p>   </div>
<p>Or:</p>
<div data-title="Terminal">
<p>Traceback (most recent call last):</p><p>...</p><p>  raise PromptDismissedException(&#39;Prompt dismissed.&#39;)</p><p>secretstorage.exceptions.PromptDismissedException: Prompt dismissed.</p>   </div>
<p>You need to execute the <code>/etc/X11/xinit/xinitrc.d/50-systemd-user.sh</code> script:</p>
<div data-title="Terminal">
<p>. /etc/X11/xinit/xinitrc.d/50-systemd-user.sh</p>   </div>
<p>And create a new keyring and set a password for it:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_085048.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_085048.png" alt="" width="600" height="160" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_085048.png 827w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_085048-300x80.png 300w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_085048-768x204.png 768w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191206_085048-660x176.png 660w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p>Let’s check the <code>dbus-monitor</code>, to see what’s is going on in the D-Bus:</p>
<div data-title="Terminal">
<p>...</p><p>method call time=1575542111.465749 sender=:1.576 -&gt; destination=org.freedesktop.secrets serial=7 path=/org/freedesktop/secrets/aliases/default; interface=org.freedesktop.Secret.Collection; member=CreateItem</p><p>array [</p><p>dict entry(</p><p>string &#34;org.freedesktop.Secret.Item.Attributes&#34;</p><p>variant             array [</p><p>dict entry(</p><p>string &#34;application&#34;</p><p>string &#34;Python keyring library&#34;</p><p>)</p><p>dict entry(</p><p>string &#34;service&#34;</p><p>string &#34;system&#34;</p><p>)</p><p>dict entry(</p><p>string &#34;username&#34;</p><p>string &#34;username&#34;</p><p>)</p><p>]</p><p>)</p><p>dict entry(</p><p>string &#34;org.freedesktop.Secret.Item.Label&#34;</p><p>variant             string &#34;Password for &#39;username&#39; on &#39;system&#39;&#34;</p><p>)</p><p>]</p><p>...</p><p>struct {</p><p>object path &#34;/org/freedesktop/secrets/session/s14&#34;</p><p>}</p><p>...</p><p>signal time=1575542111.476006 sender=:1.220 -&gt; destination=(null destination) serial=689 path=/org/freedesktop/secrets/collection/example_2dkeyring; interface=org.freedesktop.Secret.Collection; member=ItemCreated</p><p>object path &#34;/org/freedesktop/secrets/collection/example_2dkeyring/5&#34;</p><p>...</p>   </div>
<p>Here:</p>
<ol>
<li><em>sender=:1.576</em> – find the 1.576 in the D-Bus services list – it’s our Python (<code>cmd: python</code>):</li>
<li><em>destination=org.freedesktop.secrets</em></li>
</ol>
<p>Check the <code>gnome-keyring</code> storage with the <code>seahorse</code> utility for example:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_124245.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_124245.png" alt="" width="600" height="681" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_124245.png 640w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_124245-264x300.png 264w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p>Okay, <em>“It works!”</em> (c).</p>
<h5><span id="secret-tools"></span><span><code>secret-tools</code></span><span></span></h5>
<p>Another way can be to use <code>secret-tools</code> utility.</p>
<p>Add a new secret:</p>
<div data-title="Terminal">
<p>secret-tool store --label=SecretToolExample username username service secret</p><p>Password:</p>   </div>
<p>Retrieve it:</p>
<div data-title="Terminal">
<p>secret-tool lookup username username service secret</p><p>password</p>   </div>
<p>Check with the Seahorse in the storage:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_125038.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_125038.png" alt="" width="600" height="699" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_125038.png 638w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_125038-258x300.png 258w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<h4><span id="KWallet"></span><span>KWallet</span><span></span></h4>
<p>Install:</p>
<div data-title="Terminal">
<p>sudo pacman -S kwallet</p>   </div>
<p>Check the D-Bus:</p>
<div data-title="Terminal">
<p>qdbus --session org.freedesktop.DBus / org.freedesktop.DBus.GetConnectionUnixProcessID org.freedesktop.secrets</p><p>1278791</p><p>ps aux | grep 1278791</p><p>setevoy  1278791  0.0  0.0 384008  8048 ?        SLl  Dec03   0:00 /usr/bin/gnome-keyring-daemon --start --foreground --components=secrets</p>   </div>
<p>Er…</p>
<p>Why not the <code>kwallet</code>, why still the <code>gnome-keyring</code>?</p>
<p>Try to kill it:</p>

<p>And the service-file is still old:</p>
<div data-title="Terminal">
<p>cat /usr/share/dbus-1/services/org.freedesktop.secrets.service</p><p>[D-BUS Service]</p><p>Name=org.freedesktop.secrets</p><p>Exec=/usr/bin/gnome-keyring-daemon --start --foreground --components=secrets</p>   </div>
<p>Okay, fully delete the <code>gnome-keyring</code>:</p>
<div data-title="Terminal">
<p>sudo pacman -Rsn seahorse</p><p>sudo pacman -Rsn gnome-keyring</p>   </div>
<p>And no service file now:</p>
<div data-title="Terminal">
<p>cat /usr/share/dbus-1/services/org.freedesktop.secrets.service</p><p>2019/12/05 13:15:03 open /usr/share/dbus-1/services/org.freedesktop.secrets.service: no such file or directory</p>   </div>
<p>Reinstall <code>kwallet</code>:</p>
<div data-title="Terminal">
<p>sudo pacman -S kwallet</p><p>warning: kwallet-5.64.0-1 is up to date -- reinstalling</p><p>...</p>   </div>
<p>No new service file:</p>
<div data-title="Terminal">
<p>qdbus --session org.freedesktop.DBus / org.freedesktop.DBus.GetConnectionUnixProcessID org.freedesktop.secrets</p><p>Error: org.freedesktop.DBus.Error.NameHasNoOwner</p><p>Could not get PID of name &#39;org.freedesktop.secrets&#39;: no such name</p>   </div>
<p>That’s weird…</p>
<p>Does D-Bus and Secret Service are supported by the KWallet at all?</p>
<p><a href="https://www.reddit.com/r/kde/comments/d8tjln/is_there_a_orgfreedesktopsecrets_implementation/" target="_blank" rel="noopener noreferrer">Reddit says</a> it’s not:</p>
<blockquote><p>In brief, there is no longer a secret service implementation for KDE that I am aware of</p></blockquote>
<p>And the <code>ksecretsservice</code> <a href="https://community.kde.org/KDE_Utils/ksecretsservice" target="_blank" rel="noopener noreferrer">documentation</a> is just full of  ToDo’s…</p>
<p>It’s a pity. I do like Qt-based KDE applications.</p>
<p>And the more strange is the fact that the Secret Service specification was written by both GNOME and KDE projects together, but it’s supported by the GNOME Keyring only…</p>
<p>Still, we can use KWallet without the Secret Service integration.</p>
<p>Run the KDE’s wallets manager:</p>

<p>Create a wallet:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_132504.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_132504.png" alt="" width="317" height="329" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_132504.png 317w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_132504-289x300.png 289w" sizes="(max-width: 317px) 100vw, 317px"/></a></p>
<p>Set its password:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_133030.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_133030.png" alt="" width="297" height="329" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_133030.png 297w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_133030-271x300.png 271w" sizes="(max-width: 297px) 100vw, 297px"/></a></p>
<p>Obviously, now our Python lib will stop working as no Secret Service now is available:</p>
<div data-title="Terminal">
<p>&gt;&gt;&gt; keyring.set_password(&#34;system&#34;, &#34;username&#34;, &#34;password&#34;)</p><p>Traceback (most recent call last):</p><p>...</p><p>raise value</p><p>jeepney.wrappers.DBusErrorResponse: [org.freedesktop.DBus.Error.ServiceUnknown] (&#39;The name org.freedesktop.secrets was not provided by any .service files&#39;,)</p><p>The above exception was the direct cause of the following exception:</p><p>Traceback (most recent call last):</p><p>...</p><p>raise SecretServiceNotAvailableException(data) from resp</p><p>secretstorage.exceptions.SecretServiceNotAvailableException: The name org.freedesktop.secrets was not provided by any .service files</p><p>During handling of the above exception, another exception occurred:</p><p>Traceback (most recent call last):</p><p>...</p><p>raise RuntimeError(&#34;Unable to initialize SecretService: %s&#34; % e)</p><p>RuntimeError: Unable to initialize SecretService: The name org.freedesktop.secrets was not provided by any .service files</p>   </div>
<p>But you can <a href="https://pypi.org/project/keyring/#id7" target="_blank" rel="noopener noreferrer">configure a <code>keyring</code></a> backend and set the <code>kwallet5</code> directly, googled it <a href="https://github.com/jaraco/keyring/issues/269#issuecomment-288684527" target="_blank" rel="noopener noreferrer">here&gt;&gt;&gt;</a>:</p>
<div data-title="Terminal">
<p>&gt;&gt;&gt; kwallet5 = keyring.backends.kwallet.DBusKeyring()</p><p>&gt;&gt;&gt; keyring.set_keyring(kwallet5)</p><p>&gt;&gt;&gt; keyring.get_keyring()</p><p>&lt;keyring.backends.kwallet.DBusKeyring object at 0x7f7efba66fa0&gt;</p>   </div>
<p>Add a password:</p>
<div data-title="Terminal">
<p>&gt;&gt;&gt; keyring.set_password(&#34;system&#34;, &#34;username&#34;, &#34;password&#34;)</p>   </div>
<p>Check the D-Bus messages:</p>
<div data-title="Terminal">
<p>method call time=1575545736.524015 sender=:1.318 -&gt; destination=:1.269 serial=38 path=/modules/kwalletd5; interface=org.kde.KWallet; member=writePassword</p><p>int32 365838442</p><p>string &#34;system&#34;</p><p>string &#34;username&#34;</p><p>string &#34;password&#34;</p><p>string &#34;Python keyring library&#34;</p>   </div>
<p>And the KWallet:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_133821.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_133821.png" alt="" width="456" height="406" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_133821.png 456w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_133821-300x267.png 300w" sizes="(max-width: 456px) 100vw, 456px"/></a></p>
<h4><span id="KeePass"></span><span>KeePass</span><span></span></h4>
<p>Also, KeePass can act as a keyring backend service using the Secret Storage specification.</p>
<p>If the <code>gnome-keyring</code> is still running – you’ll get the “<em><a href="https://github.com/keepassxreboot/keepassxc/issues/3945" target="_blank" rel="noopener noreferrer">Another secret service is running</a></em>” error from the KeePass:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_130608.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_130608.png" alt="" width="600" height="140" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_130608.png 739w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_130608-300x70.png 300w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_130608-660x154.png 660w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p>Remove the <code>gnome-keyring</code>, and activate Secret Service:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_134003.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_134003.png" alt="" width="600" height="665" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_134003.png 657w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_134003-271x300.png 271w" sizes="(max-width: 600px) 100vw, 600px"/></a>Check the D-Bus activity:</p>
<div data-title="Terminal">
<p>method call time=1575546064.021083 sender=:1.599 -&gt; destination=org.freedesktop.DBus serial=26 path=/org/freedesktop/DBus; interface=org.freedesktop.DBus; member=RequestName</p><p>  string &#34;org.freedesktop.secrets&#34;</p><p>  uint32 4</p><p>signal time=1575546064.021157 sender=org.freedesktop.DBus -&gt; destination=(null destination) serial=258 path=/org/freedesktop/DBus; interface=org.freedesktop.DBus; member=NameOwnerChanged</p><p>  string &#34;org.freedesktop.secrets&#34;</p><p>  string &#34;&#34;</p><p>  string &#34;:1.599&#34;</p><p>signal time=1575546064.021212 sender=org.freedesktop.DBus -&gt; destination=:1.599 serial=16 path=/org/freedesktop/DBus; interface=org.freedesktop.DBus; member=NameAcquired</p><p>  string &#34;org.freedesktop.secrets&#34;</p><p>method return time=1575546064.021245 sender=org.freedesktop.DBus -&gt; destination=:1.599 serial=17 reply_serial=26</p><p>  uint32 1</p>   </div>
<p>Check, who is listening to the <em>org.freedesktop.secrets</em>:</p>
<div data-title="Terminal">
<p>qdbus --session org.freedesktop.DBus / org.freedesktop.DBus.GetConnectionUnixProcessID org.freedesktop.secrets</p><p>4006761</p><p>ps aux | grep 4006761</p><p>setevoy  4006761  2.0  0.5 475888 89656 tty1     SLl  13:40   0:02 keepassxc</p>   </div>
<p>Okay – this is our KeePass.</p>
<p>Add something to the database:</p>
<div data-title="Terminal">
<p>secret-tool store --label=SecretToolExample username username service secret</p><p>Password:</p><p>libsecret-Message: 13:45:13.448: Remote error from secret service: org.freedesktop.DBus.Error.UnknownObject: No such object path &#39;/org/freedesktop/secrets/aliases/default&#39;</p><p>secret-tool: No such object path &#39;/org/freedesktop/secrets/aliases/default&#39;</p>   </div>
<p>Er…</p>
<p>Aha, need to configure an internal path in the KeePass database, see <a href="https://github.com/keepassxreboot/keepassxc/issues/3955#issuecomment-560024175" target="_blank" rel="noopener noreferrer">this&gt;&gt;&gt;</a> comment.</p>
<p>Add a new group in the database:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135329.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135329.png" alt="" width="600" height="432" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135329.png 685w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135329-300x216.png 300w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135329-660x475.png 660w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p>Next, go to the <em>Database &gt; Database settings </em>and specify local path to a directory which will be used to store data when acting as a Secret Service storage:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135357.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135357.png" alt="" width="520" height="578" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135357.png 520w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135357-270x300.png 270w" sizes="(max-width: 520px) 100vw, 520px"/></a></p>
<p>Restart KeePass and check the D-Bus – can see now how the collection was added now:</p>
<div data-title="Terminal">
<p>signal time=1575546948.831195 sender=:1.613 -&gt; destination=(null destination) serial=22 path=/org/freedesktop/secrets; interface=org.freedesktop.Secret.Service; member=CollectionCreated</p><p>object path &#34;/org/freedesktop/secrets/collection/Main&#34;</p>   </div>
<p>Add a record:</p>
<div data-title="Terminal">
<p>secret-tool store --label=SecretToolExample username username service secret</p><p>Password:</p>   </div>
<p>Check the D-Bus:</p>
<div data-title="Terminal">
<p>...</p><p>method call time=1575547056.148892 sender=:1.616 -&gt; destination=org.freedesktop.secrets serial=10 path=/org/freedesktop/secrets/aliases/default; interface=org.freedesktop.Secret.Collection; member=CreateItem</p><p>array [</p><p>dict entry(</p><p>string &#34;org.freedesktop.Secret.Item.Attributes&#34;</p><p>variant             array [</p><p>dict entry(</p><p>string &#34;service&#34;</p><p>string &#34;secret&#34;</p><p>)</p><p>dict entry(</p><p>string &#34;username&#34;</p><p>string &#34;username&#34;</p><p>)</p><p>]</p><p>)</p><p>dict entry(</p><p>string &#34;org.freedesktop.Secret.Item.Label&#34;</p><p>variant             string &#34;SecretToolExample&#34;</p><p>)</p><p>]</p><p>...</p>   </div>
<p>And the KeePass itself:</p>
<p><a href="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135848.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" title="What is: Linux keyring, gnome-keyring, Secret Service, и D-Bus" src="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135848.png" alt="" width="600" height="207" srcset="https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135848.png 1024w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135848-300x104.png 300w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135848-768x266.png 768w, https://rtfm.co.ua/wp-content/uploads/2019/12/Screenshot_20191205_135848-660x228.png 660w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p>That’s all for now.</p>
<h3><span id="Useful_links"></span><span>Useful links</span><span></span></h3>
<h4><span id="keyrings_Secret_Service_etc"></span><span>keyrings, Secret Service, etc</span><span></span></h4>
<ul>
<li><a href="https://wiki.gnome.org/Projects/GnomeKeyring/" target="_blank" rel="noopener noreferrer">GNOME Keyring</a> – GNOME project docs</li>
<li><a href="https://wiki.archlinux.org/index.php/GNOME/Keyring" target="_blank" rel="noopener noreferrer">GNOME/Keyring</a> – Arch Linux Wiki</li>
<li><a href="https://wiki.archlinux.org/index.php/KDE_Wallet" target="_blank" rel="noopener noreferrer">KDE Wallet</a></li>
<li><a href="https://pypi.org/project/keyring/#third-party-backends" target="_blank" rel="noopener noreferrer">Python Keyring Lib</a></li>
<li><a href="https://www.linux.com/tutorials/manage-passwords-encryption-keys-and-more-seahorse/" target="_blank" rel="noopener noreferrer">Manage Passwords, Encryption Keys, And More With Seahorse</a></li>
<li><a href="https://www.mankier.com/1/secret-tool#Examples" target="_blank" rel="noopener noreferrer">secret-tool examples</a></li>
<li><a href="https://www.funtoo.org/Keychain" target="_blank" rel="noopener noreferrer">Keychain</a></li>
<li><a href="https://lzone.de/blog/Using+Linux+keyring+secrets+from+your+scripts" target="_blank" rel="noopener noreferrer">Using Linux keyring secrets from your scripts</a></li>
<li><a href="https://specifications.freedesktop.org/secret-service/latest/" target="_blank" rel="noopener noreferrer">Secret Service API Draft</a></li>
<li><a href="https://pypi.org/project/SecretStorage/" target="_blank" rel="noopener noreferrer">Python bindings to FreeDesktop.org Secret Service API</a></li>
<li><a href="https://keyring.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">Python keyring lib</a></li>
<li><a href="https://developer.gnome.org/libsecret/" target="_blank" rel="noopener noreferrer">Libsecret Library Reference Manual</a></li>
<li><a href="https://bugs.launchpad.net/ubuntu/+source/gnome-keyring/+bug/1780365" target="_blank" rel="noopener noreferrer">Credentials located in gnome-keyring can be compromised easily</a></li>
<li><a href="https://lnx.azurewebsites.net/please-enter-password-for-encrypted-keyring-when-running-python-script-on-ubuntu/" target="_blank" rel="noopener noreferrer">“Please enter password for encrypted keyring” when running Python script on Ubuntu</a></li>
<li><a href="https://alexwlchan.net/2016/11/you-should-use-keyring/" target="_blank" rel="noopener noreferrer">Use keyring to store your credentials</a></li>
<li><a href="https://github.com/jaraco/keyring/issues/273" target="_blank" rel="noopener noreferrer">In KDE Plasma, keyring uses gnome-keyring by default</a> – just for fun</li>
<li><a href="https://www.ibm.com/developerworks/library/l-key-retention/" target="_blank" rel="noopener noreferrer">Get started with the Linux key retention service</a></li>
</ul>
<h4><span id="D-Bus-2"></span><span>D-Bus</span><span></span></h4>
<ul>
<li><a href="https://dbus.freedesktop.org/doc/dbus-tutorial.html" target="_blank" rel="noopener noreferrer">D-Bus Tutorial</a></li>
<li><a href="https://techbase.kde.org/Development/Tutorials/D-Bus/Introduction" target="_blank" rel="noopener noreferrer">D-Bus/Introduction</a></li>
<li><a href="https://dbus.freedesktop.org/doc/dbus-specification.html" target="_blank" rel="noopener noreferrer">D-Bus Specification</a></li>
<li><a href="https://dbus.freedesktop.org/doc/dbus-api-design.html#documentation" target="_blank" rel="noopener noreferrer">D-Bus API Design Guidelines</a></li>
<li><a href="http://www.kaizou.org/2014/06/dbus-command-line.html" target="_blank" rel="noopener noreferrer">Introspecting D-Bus from the command-line</a></li>
<li><a href="https://bootlin.com/pub/conferences/2016/meetup/dbus/josserand-dbus-meetup.pdf" target="_blank" rel="noopener noreferrer">Understanding D-Bus</a></li>
<li><a href="https://dbus.freedesktop.org/doc/dbus-python/tutorial.html" target="_blank" rel="noopener noreferrer">dbus-python tutorial</a></li>
<li><a href="https://lists.freedesktop.org/archives/dbus/2008-July/010019.html" target="_blank" rel="noopener noreferrer">Universal standard mapping between D-Bus and URI namespaces</a></li>
<li><a href="http://blog.siphos.be/2014/06/d-bus-quick-recap/" target="_blank" rel="noopener noreferrer">D-Bus, quick recap</a></li>
</ul>


</div></div>
  </body>
</html>
