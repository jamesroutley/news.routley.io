<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/unix/UnixEarlyFilenameLenghts">Original</a>
    <h1>The length of file names in early Unix</h1>
    
    <div id="readability-page-1" class="page"><div><h2>The length of file names in early Unix</h2>

	<p><small>May 24, 2025</small></p>
</div><div><p>If you use Unix today, you can enjoy relatively long file names on
more or less any filesystem that you care to name. But it wasn&#39;t
always this way. <a href="https://utcc.utoronto.ca/~cks/space/blog/unix/V7WhyItMattersSoMuch">Research V7</a> had 14-byte
filenames, and the <a href="https://utcc.utoronto.ca/~cks/space/blog/unix/SystemIIIBlindSpot">System III/System V</a> lineage
continued this restriction until it merged with BSD Unix, which had
significantly increased this limit as part of moving to a new
filesystem (initially called the &#39;Fast File System&#39;, for good
reasons). You might wonder where this unusual number came from, and
for that matter, what the file name limit was on very early Unixes
(it was 8 bytes, which surprised me; I vaguely assumed that it had
been 14 from the start).</p>

<p>I&#39;ve mentioned before that <a href="https://utcc.utoronto.ca/~cks/space/blog/unix/UnixLinearDirectories">the early versions of Unix had a quite
simple format for directory entries</a>. In V7,
we can find the directory structure specified in <a href="https://www.tuhs.org/cgi-bin/utree.pl?file=V7/usr/include/sys/dir.h">sys/dir.h</a>
(<a href="https://www.tuhs.org/cgi-bin/utree.pl?file=V7/usr/man/man5/dir.5">dir(5)</a>
helpfully directs you to sys/dir.h), which is so short that I will
quote it in full:</p>

<blockquote><pre>#ifndef	DIRSIZ
#define	DIRSIZ	14
#endif
struct	direct
{
    ino_t    d_ino;
    char     d_name[DIRSIZ];
};
</pre>
</blockquote>

<p>To fill in the last blank, ino_t was a 16-bit (two byte) unsigned
integer (and field alignment on PDP-11s meant that this structure
required no padding), for a total of 16 bytes. This directory
structure goes back to <a href="https://www.tuhs.org/cgi-bin/utree.pl?file=V4/man/man5/dir.5">V4 Unix</a>. In
<a href="https://www.tuhs.org/cgi-bin/utree.pl?file=V3/man/man5/dir.5">V3 Unix</a>
and before, directory entries were only ten bytes long, with 8 byte
file names.</p>

<p>(Unix V4 (the Fourth Edition) was when the kernel was rewritten in
C, so that may have been considered a good time to do this change.
I do have to wonder how they handled the move from the old directory
format to the new one, since Unix at this time didn&#39;t have multiple
filesystem types inside the kernel; you just had the filesystem,
plus all of your user tools knew the directory structure.)</p>

<p>One benefit of the change in filename size is that 16-byte directory
entries fit evenly in 512-byte disk blocks (or other powers-of-two
buffer sizes). You never have a directory entry that spans two disk
blocks, so you can deal with directories a block at a time. Ten
byte directory entries don&#39;t have this property; eight-byte ones
would, but then that would leave space for only six character file
names, and presumably that was considered too small even in Unix
V1.</p>

<p>PS: That inode numbers in V7 (and earlier) were 16-bit unsigned
integers does mean what you think it means; there could only be at
most 65,536 inodes in a single classical V7 filesystem. If you
needed more files, you had better make more filesystems. Early Unix
had a lot of low limits like that, some of them quite hard-coded.</p>
</div></div>
  </body>
</html>
