<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.atomic14.com/2025/10/29/CH32V003-talking">Original</a>
    <h1>I made a 10¢ MCU Talk</h1>
    
    <div id="readability-page-1" class="page"><div role="main">
      <article>
        
        <section>
          
          <p><span></span> read
          </p>
          <a name="topofpage"></a>
          <div>
            
<p><a href="https://www.youtube.com/c/atomic14" title="Watch my videos!">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://www.patreon.com/atomic14" title="Help support me on Patreon!">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://twitter.com/mrbananas" title="Follow me on twitter">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://www.facebook.com/atomic14Videos">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://github.com/atomic14" title="Fork me on github">
          <i></i>
        </a>
          ·  
    
  
  <a href="https://www.atomic14.com/index.html">Posts</a>  ·  
  <a href="https://www.atomic14.com/videos/index.html">Videos</a>  ·  
  <a href="https://www.atomic14.com/tags.html">Tags</a>  ·  
  <a href="https://www.atomic14.com/tools/index.html">Tools</a>  ·  
  <a href="https://www.atomic14.com/support/index.html">Support</a>
</p>
          </div>
          




          
          <div>
            <p><small>
                HELP <a href="https://www.atomic14.com/support/index.html">SUPPORT</a> MY WORK: If you&#39;re feeling flush then please stop by <a href="https://www.patreon.com/atomic14">Patreon</a> Or you can make a one off donation via <a href="https://ko-fi.com/atomic14">ko-fi</a>
              </small>
            </p>
            
            
            <div data-pagefind-body="">
            
            <blockquote>
  <p>TLDR: Yes, you can fit about 7 seconds of audio into 16K of flash and still have room for code. And you can even play LPC encoded audio on a 10 cent MCU.</p>
</blockquote>

<p>There’s quite a lot more detail in this video (and of course you can hear the audio!).</p>

<lite-youtube videoid="RZvX95aXSdM" playlabel="Talking 10 Cent MCU"></lite-youtube>

<p>In the <a href="https://www.atomic14.com/2025/10/12/CH32V003-music">previous project</a>, I had this ultra-cheap CH32V003 microcontroller playing simple tunes on a tiny SMD buzzer. It was just toggling a GPIO pin at musical note frequencies – 1-bit audio output – and it sounded surprisingly decent. That was a fun start, but now it’s time to push this little $0.10 MCU even further: can we make it actually talk?</p>

<p><img src="https://www.atomic14.com/assets/article_images/2025-11-01/ic.webp" alt="CH32V003"/></p>

<p>Spoiler: Yes, we can! (well, there wouldn’t be much of a blog post if we couldn’t) This 8-pin RISC-V chip is now producing sampled audio data and spoken words. We’re really stretching the limits of what you can fit in 16 KB of flash.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2025-11-01/16k.webp" alt="16K Flash, 2K RAM"/></p>

<h2 id="from-beeps-to-actual-audio">From Beeps to Actual Audio</h2>

<p>Moving from simple beeps to real audio meant using the microcontroller’s PWM output as a rudimentary DAC. Instead of just on/off beeping, I’m driving a waveform at an 8 kHz sample rate using a high-frequency PWM on the output pin. The hardware is the same tiny board as before
 – but I’ve swapped the small SMD buzzer for a small speaker. The buzer works too, but it’s quieter and very tinny.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2025-11-01/speaker.webp" alt="New Speaker"/></p>

<p>The sample I wanted to test with is just over 6 seconds in length - it’s the iconic “Open the pod bay doors HAL…” sequence from 2001.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2025-11-01/pod-bay-doors.webp" alt="Open the pod bay doors"/></p>

<p>If we keep this audio at 16-bit PCM, 8kHZ, we’d need about 96KB – way beyond our 16 KB flash! And remember, that 16 KB has to hold both the audio data and our playback code. Clearly some aggressive compression is required.</p>

<table>
  <thead>
    <tr>
      <th>Format</th>
      <th>Sample Rate</th>
      <th>Bits/Sample</th>
      <th>Size</th>
      <th><strong>Fits in 16KB?</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CD Quality</td>
      <td>44.1 kHz</td>
      <td>16-bit</td>
      <td>529 KB</td>
      <td>❌ 33× too big!</td>
    </tr>
    <tr>
      <td>Phone Quality</td>
      <td>16 kHz</td>
      <td>16-bit</td>
      <td>192 KB</td>
      <td>❌ 12× too big!</td>
    </tr>
    <tr>
      <td>Basic PCM</td>
      <td>8 kHz</td>
      <td>8-bit</td>
      <td>48 KB</td>
      <td>❌ 3× too big!</td>
    </tr>
    <tr>
      <td><strong>4-bit ADPCM (IMA)</strong></td>
      <td><strong>8 kHz</strong></td>
      <td><strong>4-bit</strong></td>
      <td><strong>24 KB</strong></td>
      <td>❌ <strong>1.5× too big</strong></td>
    </tr>
    <tr>
      <td><strong>QOA (Quite OK Audio)</strong></td>
      <td><strong>8 kHz</strong></td>
      <td><strong>3.2-bit</strong></td>
      <td><strong>19 KB</strong></td>
      <td>❌ <strong>Still too big!</strong></td>
    </tr>
    <tr>
      <td><strong>2-bit ADPCM</strong></td>
      <td><strong>8 kHz</strong></td>
      <td><strong>2-bit</strong></td>
      <td><strong>12 KB</strong></td>
      <td>✅ <strong>Fits!</strong></td>
    </tr>
  </tbody>
</table>

<p>I considered a few encoding options for compressing the audio.</p>

<ul>
  <li><strong>8-bit PCM:</strong> Simply using 8-bit samples at 8 kHz cuts size in half (to ~47 KB for 6s), but that’s still about 3× too large for our flash.</li>
  <li><strong>4-bit ADPCM:</strong> Adaptive Differential PCM is a simple lossy compression that could quarter the size. In theory 6 seconds would be ~24 KB – much closer to fitting,</li>
  <li><strong><a href="https://qoaformat.org/">“Quite OK Audio” (QOA)</a>:</strong> This is nice codec that packs audio into about 3.2 bits per sample (roughly 1/5 the size of 16-bit PCM)</li>
  <li><strong>2-bit ADPCM:</strong> Going even further with ADPCM, using only 2 bits per sample gives a 4:1 compression relative to 8-bit audio – that’s 75% storage savings.</li>
</ul>

<p>2-bit ADPCM is definitely the winner here. Our 6-second clip shrinks to under 12 KB, which comfortably fits in flash with room for code. This looked like the winner, provided the audio quality was acceptable. The decoder for 2-bit ADPCM is also very lightweight (my implementation compiled to under just over 1K of code - 1340 bytes!). It’s definitely low quality - but it actually sounds surprisingly ok.</p>

<h2 id="how-does-2-bit-adpcm-work">How does 2-bit ADPCM work?</h2>

<p>It’s actually a very simple algorithm. Both the encoder and decoder maintain a predicted signal value and a step size index into a predefined table. Each 2-bit code tells the decoder how to adjust the current prediction and the step size index. In essence, we’re coding the difference between the real audio and our prediction, with only four possible levels (since 2 bits gives 4 values). After each sample, the algorithm adapts: if the prediction error was large, we move to a bigger step size (to allow larger changes); if the error was small, we use a smaller step size for finer resolution. This adaptive step is what makes it ADPCM (Adaptive Differential PCM).</p>

<p>Our codes are as follows:</p>

<ul>
  <li><code>00</code> (0): Go down by 1 step - subtract the step size from our current prediction</li>
  <li><code>01</code> (1): Go up by 1 step - add the step size to our current prediction</li>
  <li><code>10</code> (2): Go down by 2 steps - subtract the 2 x step size from our current prediction</li>
  <li><code>11</code> (3): Go up by 2 steps - add the 2 x step size to our current prediction</li>
</ul>

<p><img src="https://www.atomic14.com/assets/article_images/2025-11-01/audio.webp" alt="2-bit ADPCM Compression"/></p>

<p>Even with this very high level of compression, the predicted waveform manages to track the original audio surprisingly well. The above graph shows a small snippet of the audio: the blue line is the original waveform and the yellow line is the ADPCM decoder’s output.</p>

<p>They’re not identical (and we wouldn’t expect them to be), but the general shape is preserved. When you play it back through the little speaker, it’s recognizable and surprisingly good.</p>

<p>To make my life easier, I built a quick conversion <a href="https://buzzer-studio.atomic14.com">tool</a> to encode WAV files into this 2-bit ADPCM format. The tool lets me drag-and-drop a WAV, and it gives you the files with the data that can ve dropped into the firmware code.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2025-11-01/buzzer-2-adpcm.webp" alt="2-bit ADPCM Buzzer Studio"/></p>

<h2 id="lpc-speech-synthesis">LPC Speech Synthesis</h2>

<p>Six seconds of audio is cool, but what about longer phrases or even arbitrary speech? Storing anything much longer with raw or ADPCM audio would quickly fill the 16K of flash.</p>

<p>For my second experiment, I tried something different: instead of recorded waveform audio, I used an <a href="https://en.wikipedia.org/wiki/Texas_Instruments_LPC_Speech_Chips">old-school speech synthesis approach</a>. This leverages the fact that spoken language can be encoded very compactly by modeling the human voice, rather than storing the raw sound. Specifically, I integrated a library called <a href="https://github.com/going-digital/Talkie/tree/master/Talkie">Talkie</a>.</p>

<p>Talkie is a software implementation of the Texas Instruments LPC speech synthesis architecture from the late 1970s. This was implemented in a variety of chips, most commonly the TMS5220 and TMS5100 speech chips.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2025-11-01/TMS_types.webp" alt="TMS5220 and TMS5100 Variants"/></p>

<p>These were used in things like the original Speak &amp; Spell, arcade games like early Star Wars, and speech add-ons for home computers (e.g. the BBC Micro).</p>

<p><img src="https://www.atomic14.com/assets/article_images/2025-11-01/speak-spell.webp" alt="Speak and Spell"/></p>

<p>The Talkie library (originally by <a href="https://github.com/going-digital/Talkie/tree/master/Talkie">Peter Knight</a>, later added to by <a href="https://learn.adafruit.com/bringing-back-the-voice-of-speak-spell/software">Adafruit</a>) comes with a big set of examples and vocabulary. It’s also possible to extract examples from old ROMs from arcade games.</p>

<p>Each phrase or word only takes a few hundred bytes or even less, so you can fit quite a lot of speech into a few kilobytes of flash. The trade-off is that the voice has a very computer-esque timbre – think of the Speak &amp; Spell’s voice. It’s clearly synthetic, but still understandable.</p>

<p>To say custom sentences not in the library, you either concatenate the available words/phonemes (which can be clunky), or you need to generate new LPC data. The original tools for this are a bit obscure – there’s BlueWizard (a classic Mac app) and PythonWizard (a command-line tool with TK GUI) which can analyze WAV files and produce LPC data.</p>

<p>I gave both a try with some success (and a few headaches setting them up). In the end, I cheated a bit and used an AI coding assistant to help me create a streamlined online tool for this.</p>

<p>The result is a little <a href="http://buzzer-studio.atomic14.com">web app</a> where I can upload a recording of, say, my own voice, and it outputs the LPC data. It even lets me play back the synthesized voice in-browser to check it.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2025-11-01/buzzer-lpc.webp" alt="LPC Encoder"/></p>

<p>So there we have it – our 10¢ microcontroller now has a voice! By using 2-bit ADPCM compression, we can store short audio clips (up to around 8 seconds) even in 16 KB of flash, and play them back via PWM with decent fidelity.</p>

<p>And with the Talkie LPC speech synthesis, we can make the device “speak” lots of words and phrases with only a tiny memory footprint.</p>

<p>If you want to hear it for yourself, check out the video demo linked at the top of this post. In the video, you’ll see (and hear) the WarGames clip and the Star Wars quotes running on the hardware. It’s honestly amazing what these cheap little MCUs can do. We’re really pushing the boundaries of cheap hardware here.</p>

<p>You can find all my code on GitHub in this <a href="https://github.com/atomic14/ch32v003-audio">repository</a>.</p>

<lite-youtube videoid="RZvX95aXSdM" playlabel="Talking 10 Cent MCU"></lite-youtube>

            </div>
            
            
            
              <h2>Related Posts</h2>
                              
                
                <a href="https://www.atomic14.com/2025/10/12/CH32V003-music.html">
                
                </a>
                              
                
                <a href="https://www.atomic14.com/2024/01/05/esp32-s3-no-pins.html">
                
                </a>
                              
                
                <a href="https://www.atomic14.com/2024/01/26/16bit-handheld-teardown.html">
                
                </a>
                              
                
                <a href="https://www.atomic14.com/2023/09/26/decoding-avi-files-for-fun-and-0-profit.html">
                
                </a>
                              
                
                <a href="https://www.atomic14.com/2022/08/19/a-life-in-tech-part1.html">
                
                </a>
              
            
            
              <h2>Related Videos</h2>
                              
                
                <a href="https://www.atomic14.com/videos/posts/RZvX95aXSdM.html">
                
                </a>
                              
                
                <a href="https://www.atomic14.com/videos/posts/RiiS4jjG6ME.html">
                
                </a>
                              
                
                <a href="https://www.atomic14.com/videos/posts/LhZ9pWwnn6s.html">
                
                </a>
                              
                
                <a href="https://www.atomic14.com/videos/posts/oZ39VCUvKjw.html">
                
                </a>
                              
                
                <a href="https://www.atomic14.com/videos/posts/G6MROvlLeKE.html">
                
                </a>
              
            
            <p><small>
                HELP <a href="https://www.atomic14.com/support/index.html">SUPPORT</a> MY WORK: If you&#39;re feeling flush then please stop by <a href="https://www.patreon.com/atomic14">Patreon</a> Or you can make a one off donation via <a href="https://ko-fi.com/atomic14">ko-fi</a>
              </small>
            </p>
          </div>
          <div>
            
<p><a href="https://www.youtube.com/c/atomic14" title="Watch my videos!">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://www.patreon.com/atomic14" title="Help support me on Patreon!">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://twitter.com/mrbananas" title="Follow me on twitter">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://www.facebook.com/atomic14Videos">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://github.com/atomic14" title="Fork me on github">
          <i></i>
        </a>
          ·  
    
  
  <a href="https://www.atomic14.com/index.html">Posts</a>  ·  
  <a href="https://www.atomic14.com/videos/index.html">Videos</a>  ·  
  <a href="https://www.atomic14.com/tags.html">Tags</a>  ·  
  <a href="https://www.atomic14.com/tools/index.html">Tools</a>  ·  
  <a href="https://www.atomic14.com/support/index.html">Support</a>
</p>
          </div>
        </section>
        
        <div>
          <div>
            <h5><span>Written by</span></h5>
            <section>
              
              <h4>Chris Greening</h4>
              
              <hr/>
              <p>Published <time datetime="2025-10-29 00:00">29 Oct 2025</time></p>
            </section>
          </div>
          
          
        </div>
      </article>
    </div></div>
  </body>
</html>
