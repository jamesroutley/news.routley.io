<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://transitivebullsh.it/oss-twitter-algorithm-part-1">Original</a>
    <h1>What would open sourcing the Twitter algorithm actually look like?</h1>
    
    <div id="readability-page-1" class="page"><article><blockquote><em>This is the first in a series of posts exploring what “open sourcing Twitter’s algorithm” would look like from a more practical perspective.</em></blockquote><h2 data-id="a162e3eb309a480f9abfc550044a5feb"><span><a href="#a162e3eb309a480f9abfc550044a5feb" title="Intro"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Intro</span></span></h2><p>As a experienced software engineer with a passion for open source, Elon Musk’s recent appeal to open source the Twitter algorithm inspired me to start researching this space. My goal was to try and answer one main question:</p><div><p><span role="img" aria-label="💡">💡</span></p><p><span>What would open sourcing the Twitter algorithm actually look like?</span></p></div><p>In order to answer this question, there are some related questions we’ll need to answer first:</p><ul><li>Why would we want to open source the Twitter algorithm?</li></ul><ul><li>What do we mean when talking about the “Twitter algorithm”?</li></ul><ul><li>What does Twitter’s core data model look like?</li></ul><ul><li>What does Twitter’s network graph look like?</li></ul><ul><li>How does Twitter’s algorithmic feed work?</li></ul><ul><li>What are the main engineering challenges that we should keep in mind?</li></ul><h2 data-id="e6515e82b10b43d9b3f94be540bc1411"><span><a href="#e6515e82b10b43d9b3f94be540bc1411" title="Motivation"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Motivation</span></span></h2><p>What’s behind Elon’s bid to take over Twitter? In his own words:</p><blockquote>“Civilizational risk is decreased the more we can increase the trust in Twitter as a public platform.”</blockquote><p>Elon’s motivation is clear and consistent with his modus operandi. It’s the same reason he’s working so hard to build a sustainable colony on Mars, why he’s devoted resources to understanding the potential dangers of AI super-intelligence, and why he’s so insistent on combatting climate change.</p><p>His guiding motivation is to <b>improve humanity’s chances at a positive future</b>.</p><p>And unlike most of us, he’s capable of putting massive skin in the game to get shit done. Whether it be by investing his personal fortune or by investing his vast experience as the world’s most successful serial entrepreneur, it’s really hard to argue with the purity of his goals, dedication, and real-world results.</p><p>Elon and Jack both believe that the world would benefit from greater transparency and optionality around Twitter’s core algorithms. There are just too many valid concerns around free speech, censorship, privacy, bot armies, echo chambers, ... the list goes on. These are all so fundamentally difficult and nuanced topics, that the only way to attempt meaningful improvements to them — while maximizing the public’s perception of trust in the platform and in each other — will be to provide more transparency around how they’re handled.</p><p>So we’re left with the goal of “open sourcing Twitter’s algorithm,” which sounds really great in theory and <a target="_blank" rel="noopener noreferrer" href="https://interconnected.blog/why-open-sourcing-twitter-is-good-for-humanity-and-business/">may actually benefit Twitter’s core business</a>, but that’s where the conversation starts to get really hand wavy. So let’s draw back the curtains a bit and see if we can add some clarity to this conversation from an engineering perspective.</p><h2 data-id="3ff6fed76f624a0f9335374e0d58d9d3"><span><a href="#3ff6fed76f624a0f9335374e0d58d9d3" title="How Twitter Works"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>How Twitter Works</span></span></h2><h3 data-id="1c2abc3a153043138a5ebc811611ef3d"><span><a href="#1c2abc3a153043138a5ebc811611ef3d" title="Main Timeline View"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Main Timeline View</span></span></h3><figure><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271125%27%20height=%272436%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p></figure><p>Twitter provides users with two versions of its main timeline view: the default algorithmic feed “Home” and “Latest Tweets”. The latest tweets view is a much simpler, reverse-chronological list of tweets from accounts you directly follow. This used to be the default until <a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/official/en_us/a/2016/never-miss-important-tweets-from-people-you-follow.html">Twitter introduced its algorithmic feed in 2016</a>.</p><p>The algorithmic feed is how most people use Twitter because <a target="_blank" rel="noopener noreferrer" href="https://behavioralscientist.org/defaults-are-not-the-same-by-default/">defaults matter — a lot</a>. Twitter describes their algorithmic feed as follows:</p><blockquote>“A stream of Tweets from accounts you have chosen to follow on Twitter, as well as recommendations of other content we think you might be interested in based on accounts you interact with frequently, Tweets you engage with, and more.”</blockquote><p>There’s a lot of complexity hiding in that “and more.” We’ll dig deeper on that in a bit, but first let’s understand why Twitter use an algorithmic feed at all. The UX reasoning is simple:</p><blockquote>“You follow hundreds of people on Twitter — maybe thousands — and when you open Twitter, it can feel like you’ve missed some of their most important Tweets. Today, we’re excited to share a new timeline feature that helps you catch up on the best Tweets from people you follow.” (<a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/official/en_us/a/2016/never-miss-important-tweets-from-people-you-follow.html">source; 2016</a>)</blockquote><p>This explanation makes sense from a UX standpoint, and an algorithmic feed certainly gives Twitter a lot more freedom to experiment with the product.</p><p>The real motivation, however, is because using an algorithmic feed is incentivized by Twitter’s currrent ad-driven business model. More relevant content in your feed ⇒ higher engagement ⇒ more ad revenue. <a target="_blank" rel="noopener noreferrer" href="https://www.socialmediatoday.com/social-networks/truth-about-algorithms-and-why-you-should-expect-see-more-them">This is a classic social network strategy that’s proven to work</a>.</p><p>Okay, so now that we understand Twitter’s algorithmic feed at a high level, let’s dig deeper to try and understand how it works under the hood.</p><h3 data-id="46e6016573ef4dfdbca0ae5ff97d8f99"><span><a href="#46e6016573ef4dfdbca0ae5ff97d8f99" title="Core Data Model"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Core Data Model</span></span></h3><p>A great way to approach understanding a complex system like Twitter is to start by understanding its core data model and working our way up from there. These resource models and the relations between them form the foundation that all of Twitter’s higher-level business logic builds upon.</p><div><p>We’ll be focusing on <a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api">the latest version of Twitter’s public API (v2)</a>, which was initially released in 2020.</p></div><h4 data-id="ad738219095345fea337d8bc60565d67"><span><a href="#ad738219095345fea337d8bc60565d67" title="Core Resource Models"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Core Resource Models</span></span></h4><ul><li><a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/data-dictionary/object-model/tweet">Tweet</a> — A short post that may reference other tweets, users, entities, and attachments.</li></ul><ul><li><a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/data-dictionary/object-model/user">User</a> — An account on the Twitter platform.</li></ul><h4 data-id="32fcd2262899490ab33718770affcf41"><span><a href="#32fcd2262899490ab33718770affcf41" title="Core Tweet Relations"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Core Tweet Relations</span></span></h4><ul><li><a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/tweets/timelines/">Timelines</a> — Reverse-chronological stream of tweets from a specific account.</li></ul><ul><li><a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/tweets/likes/">Likes</a> — Liking tweets is a core user interaction to express interest in a tweet. Note that likes are historically also referred to as favorites.</li></ul><ul><li><a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/tweets/retweets/">Retweets</a> — Retweeting allows you to amplify another user’s tweet to your own audience.</li></ul><h4 data-id="f8c73692ba9a46e6844d1634322f6d7c"><span><a href="#f8c73692ba9a46e6844d1634322f6d7c" title="Core User Relations"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Core User Relations</span></span></h4><ul><li><a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/users/follows/">Follows</a> — Following a user creates a directed edge in the network graph subscribing you to their tweets and opting in to receiving <a target="_blank" rel="noopener noreferrer" href="https://help.twitter.com/en/using-twitter/direct-messages">direct messages</a> from them.</li></ul><ul><li><a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/users/blocks/">Blocks</a> — Blocking helps people restrict specific accounts from contacting them, seeing their Tweets, and following them.</li></ul><ul><li><a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/users/mutes/">Mutes</a> — Muting an account allows you to remove an account&#39;s Tweets from your timeline without unfollowing or blocking that account. Muted accounts will not know that you&#39;ve muted them and you can unmute them at any time.</li></ul><h4 data-id="3031ed87e4654971a70d8562d34473dd"><span><a href="#3031ed87e4654971a70d8562d34473dd" title="Turtles All The Way Down"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Turtles All The Way Down</span></span></h4><p>Twitter’s public API exposes additional resource models (like <a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/data-dictionary/object-model/space">Space</a>, <a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/data-dictionary/object-model/lists">List</a>, <a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/data-dictionary/object-model/media">Media</a>, <a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/data-dictionary/object-model/poll">Poll</a>, <a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/data-dictionary/object-model/place">Place</a>, etc) and additional relations (like <a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/tweets/timelines/api-reference/get-users-id-mentions">Mentions</a>, <a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/tweets/quote-tweets/introduction">Quote Tweets</a>, <a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/tweets/bookmarks/introduction">Bookmarks</a>, <a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/tweets/hide-replies/introduction">Hidden Replies</a>, etc). We’re going to ignore these for now in order to keep our exploration as focused as possible.</p><p>Keep in mind this is also just the public API. Internally, platforms like Twitter are a complex web of services, databases, caches, workflows, <em>people</em>, and all the glue that holds them together. I have no doubt that Twitter use different abstractions for different layers of their public and internal APIs depending on a variety of factors such as who the API is meant for, performance requirements, privacy requirements, etc. For a brief glimpse into this complexity, check out <a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/engineering/en_us/topics/infrastructure/2017/the-infrastructure-behind-twitter-scale">The Infrastructure Behind Twitter: Scale (2017)</a>.</p><p>In other words, it’s <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Turtles_all_the_way_down">turtles all the way down</a> and we’re purposefully restricting ourselves to only considering a few turtles — but those other turtles exist, and it’s important to keep that in mind as we move forwards.</p><figure><div><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27478%27%20height=%27634%27/%3e"/></span><img alt="Turtles All the Way Down by Sam Hollingsworth (source)" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption><em>Turtles All the Way Down by Sam Hollingsworth (</em><a target="_blank" rel="noopener noreferrer" href="https://oldschoolrecordreview.wordpress.com/2015/04/03/yeah-but-do-you-know-what-that-song-is-actually-about-2-turtles-all-the-way-down/"><em>source</em></a><em>)</em></figcaption></div></figure><h3 data-id="9939fc3eadce408ba408c5284c4025da"><span><a href="#9939fc3eadce408ba408c5284c4025da" title="Network Graph"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Network Graph</span></span></h3><p>Social networks like Twitter are examples of very large-scale graphs, with the nodes modeling users and tweets, and the edges modeling interactions such as replies, retweets, and likes. (<a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/engineering/en_us/topics/insights/2020/graph-ml-at-twitter#:~:text=Social%20networks%20like%20Twitter%20are%20examples%20of%20very%20large%2Dscale%20complex%20graphs%20where%20the%20nodes%20model%20users%20and%20Tweets%2C%20while%20the%20edges%20model%20interactions%20such%20as%20replies%2C%20Retweets%2C%20or%20favs.">source; 2020</a>)</p><figure></figure><p>A large part of Twitter’s core business value comes from this massive underlying data set of users, tweets, and interactions. Whenever you log in, view a tweet, click on a tweet, view a user’s profile, post a tweet, reply to a tweet, etc — just about every single interaction you take on Twitter gets logged to an internal database.</p><p>The data available from Twitter’s public API represents just a fraction of the data that Twitter tracks under the hood. This is important to keep in mind because Twitter’s internal recomendation algorithms have access to all of this rich interaction data, whereas any open source efforts would likely be required to work with a much more limited data set.</p><h3 data-id="a05520140baf407da4d94b47e436e86c"><span><a href="#a05520140baf407da4d94b47e436e86c" title="Feed Algorithm"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Feed Algorithm</span></span></h3><div><p><a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/engineering/en_us/topics/insights/2017/using-deep-learning-at-scale-in-twitters-timelines">From Using Deep Learning at Scale in Twitter’s Timelines (2017)</a>:</p><div><p>“Your timeline composition before the introduction of the ranking algorithm is easy to describe: all the Tweets from the people you follow since your last visit were gathered and shown in reverse-chronological order. Although the concept is simple to grasp, reliably serving this experience to the hundreds of millions of people on Twitter is an enormous infrastructural and operational challenge.</p><p>With ranking, we add an extra twist. Right after gathering all Tweets, each is scored by a relevance model. The model’s score predicts how interesting and engaging a Tweet would be specifically to you. A set of highest-scoring Tweets is then shown at the top of your timeline, with the remainder shown directly below.”</p></div></div><p>Twitter’s algorithmic feed is powered by a <a target="_blank" rel="noopener noreferrer" href="https://towardsdatascience.com/recommendation-systems-explained-a42fc60591ed">personalized recommendation system</a> for predicting which tweets and users you’re most likely to interact with. The two most important aspects of this recommendation system are:</p><ol start="1"><li>The underlying data that’s used to train ML models. This is Twitter’s massive, proprietary network graph that we described above.</li></ol><ol start="2"><li>The ranking signals that it considers when determining relevancy.</li></ol><p>Let’s dive into these ranking signals to understand what Twitter means by “relevancy.”</p><h4 data-id="99e9d78cddbd4f36b478fc49bbaded9b"><span><a href="#99e9d78cddbd4f36b478fc49bbaded9b" title="Ranking Signals"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Ranking Signals</span></span></h4><div><p><a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/engineering/en_us/topics/insights/2017/using-deep-learning-at-scale-in-twitters-timelines">From Using Deep Learning at Scale in Twitter’s Timelines (2017)</a>:</p><div><p>“In order to predict whether a particular Tweet would be engaging to you, our models consider characteristics (or features) of:</p><ul><li>The Tweet itself: its recency, presence of media cards (image or video), total interactions (e.g. number of retweets and likes)</li></ul><ul><li>The Tweet’s author: your past interactions with this author, the strength of your connection to them, the origin of your relationship</li></ul><ul><li>You: Tweets you found engaging in the past, how often and how heavily you use Twitter</li></ul><p>Our list of considered features and their varied interactions keeps growing, informing our models of ever more nuanced behavior patterns.”</p></div></div><p>This description of ranking signals from 2017 may be a bit dated, but I have no doubt that these core signals are still highly relevant in 2022. This list has likely expanded to dozens if not hundreds of focused machine learning models that Twitter uses to power its algorithmic feed.</p><figure><div><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271023%27%20height=%27686%27/%3e"/></span><img alt="A visualization of a deep learning model used to determine the likelihood that one user will follow another user in the future. This model represents one small piece of Twitter’s various internal recommendation systems. Source: Deep Learning on Dynamic Graphs; 2021" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption>A visualization of a deep learning model used to determine the likelihood that one user will follow another user in the future. This model represents one small piece of Twitter’s various internal recommendation systems. <a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/engineering/en_us/topics/insights/2021/temporal-graph-networks">Source: Deep Learning on Dynamic Graphs; 2021</a></figcaption></div></figure><h4 data-id="17cf7e782f114d9a9a73e8e47b6ac643"><span><a href="#17cf7e782f114d9a9a73e8e47b6ac643" title="Algorithmic Feed Pseudocode"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Algorithmic Feed Pseudocode</span></span></h4><p>If you’re a developer, then this TypeScript peudocode may be more helpful in clarifying how Twitter’s algorithmic feed works:</p><pre><code>export abstract class TwitterAlgorithmicFeed {
  /**
   * Pseudo-code for understanding how Twitter&#39;s algorithmic feed works.
   */
  async getAlgorithmicTimelineForUser(user: User): Promise&lt;Timeline&gt; {
    const rawTimeline = await this.getRawTimelineForUser(user)
    const relevantTweets = await this.getPotentiallyRelevantTweetsForUser(user)

    const mergedTimeline = await this.mergeTimelinesForUserBasedOnRelevancy(
      user,
      rawTimeline,
      relevantTweets
    )

    return this.injectAdsForUserIntoTimeline(user, mergedTimeline)
  }

  /**
   * Returns a reverse-chronological stream of tweets from users directly
   * followed by a given user.
   */
  abstract getRawTimelineForUser(user: User): Promise&lt;Timeline&gt;

  /**
   * Returns a stream of tweets ordered by relevancy for a given user at a
   * given time.
   *
   * This will only consider tweets from users the given user is not already
   * following.
   */
  abstract getPotentiallyRelevantTweetsForUser(user: User): Promise&lt;Timeline&gt;

  /**
   * Returns a stream of tweets ordered by relevancy to a given user, taking
   * into account both their raw timeline of latest tweets and a subset of
   * the network graph timeline containing potentially relevant tweets.
   */
  abstract mergeTimelinesForUserBasedOnRelevancy(
    user: User,
    rawTimeline: Timeline,
    relevantTweets: Timeline
  ): Promise&lt;Timeline&gt;

  /**
   * Returns a stream of tweets which injects ads into the timeline for a
   * given user.
   */
  abstract injectAdsForUserIntoTimeline(
    user: User,
    timeline: Timeline
  ): Promise&lt;Timeline&gt;
}</code></pre><figcaption>TypeScript pseudocode for understanding how Twitter&#39;s algorithmic feed works. Note that this is a drastic simplification and is meant for demonstration purposes only. <a target="_blank" rel="noopener noreferrer" href="https://github.com/transitive-bullshit/twitter-feed-algorithm/blob/master/src/algorithmic-feed.ts">The full source is available on GitHub</a>.</figcaption><h3 data-id="41284377b6c5489092e6cb6b170573c5"><span><a href="#41284377b6c5489092e6cb6b170573c5" title="Engineering Considerations"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Engineering Considerations</span></span></h3><p>Open sourcing aspects of Twitter’s algorithmic feed would inherently run into a few major engineering challenges.</p><figure><div><p><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271836%27%20height=%271716%27/%3e"/></span><img alt="A senior engineering manager at Twitter reacting to the idea of open sourcing Twitter’s algorithmic feed." src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></p><figcaption>A senior engineering manager at Twitter reacting to the idea of open sourcing Twitter’s algorithmic feed.</figcaption></div></figure><h4 data-id="4d667997dd324f298ee018e04d31d3a3"><span><a href="#4d667997dd324f298ee018e04d31d3a3" title="Scale"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Scale</span></span></h4><p>The first challenge is scale. Twitter’s network graph is massive. The engineering and operational challenges involved in guaranteeing a good user experience tend to outweigh other considerations out of necessity.</p><p>To give you an idea of the scale we’re talking about:</p><ul><li>Twitter’s network graph contains hundreds of millions of nodes and billions of edges. (<a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/engineering/en_us/topics/insights/2021/simple-scalable-graph-neural-networks">source; 2021</a>)</li></ul><ul><li>Twitter has over 300M worldwide monthly active users. (<a target="_blank" rel="noopener noreferrer" href="https://www.statista.com/statistics/282087/number-of-monthly-active-twitter-users/">source; 2019</a>)</li></ul><ul><li>Every second, an average of ~6K tweets are posted and over 6M queries are made to fetch timelines. (<a target="_blank" rel="noopener noreferrer" href="https://www.brandwatch.com/blog/twitter-stats-and-statistics/#:~:text=Twitter%20usage%20statistics,That&#39;s%206%2C000%20tweets%20every%20second.">source; 2020</a>)</li></ul><ul><li>“Public conversations happening on Twitter typically generate hundreds of millions of Tweets and Retweets every day. This makes Twitter perhaps one of the largest producers of graph-structured data in the world, second perhaps only to the <a target="_blank" rel="noopener noreferrer" href="https://home.cern/science/computing/processing-what-record">Large Hadron Collider</a>.” (<a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/engineering/en_us/topics/insights/2020/graph-ml-at-twitter#:~:text=Social%20networks%20like,Large%20Hadron%20Collider.%C2%A0%C2%A0">source; 2020</a>)</li></ul><p>Simply put, most developers and even most companies aren’t equipped to handle this amount of data in an experimental setting, much less in anything resembling a production setting.</p><div><p>To deal with this challenge, Twitter provides select API partners with a <a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/tweets/volume-streams/introduction">1% sampled version of their public tweet firehose</a> as well as the ability to listen to <a target="_blank" rel="noopener noreferrer" href="https://developer.twitter.com/en/docs/twitter-api/tweets/filtered-stream/introduction">smaller subsets of filtered streams</a>.</p></div><div><p>Additionally, Twitter’s scale introduces some unique challenges when building <a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/engineering/en_us/topics/insights/2020/graph-ml-at-twitter">graph machine learning algorithms</a> because <a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/engineering/en_us/a/2016/strong-consistency-in-manhattan">their network graph is forced to be very selective</a> about where they choose to use <a target="_blank" rel="noopener noreferrer" href="https://www.geeksforgeeks.org/eventual-vs-strong-consistency-in-distributed-databases/">strong vs eventual consistency</a>. This complicates things since there are no guarantees that <a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/engineering/en_us/topics/insights/2022/graph-machine-learning-with-missing-node-features">every node in the graph has the same features applied to it</a>.</p></div><h4 data-id="44b9a0a014d94ff8b42b189c29cee4dc"><span><a href="#44b9a0a014d94ff8b42b189c29cee4dc" title="Real-Time"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Real-Time</span></span></h4><p>Twitter’s real-time nature presents another unique challenge. Users expect Twitter to be as close to real-time as possible, which means that <a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/engineering/en_us/topics/insights/2021/temporal-graph-networks">the underlying network graph is very dynamic</a> and latency becomes a real UX concern. When users refresh their feeds, they expect near instantaneous results that are globally refreshed up-to-the-second. This is incredibly difficult to do efficiently when the underlying network graph is constantly changing.</p><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/twitter-research/tgn">Temporal Graph Networks</a> are an interesting related open source project from Twitter research. They present a framework for deep learning on highly dynamic graphs which change over time by representing them as sequences of timed events.</p><h4 data-id="3ccc858e16244f638d71a1660b033069"><span><a href="#3ccc858e16244f638d71a1660b033069" title="Reliability"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Reliability</span></span></h4><p>Another major challenge is platform reliability. Hundreds of millions of people rely on Twitter as a core component of their online digital identity. The engineering and operational challenges inherent in running a global platform like Twitter with a reliably good user experience and <a target="_blank" rel="noopener noreferrer" href="https://api.twitterstat.us/">Twitter’s uptime expectations</a> are mind boggling.</p><h4 data-id="5348e91c246d4c2d964f970fd3969960"><span><a href="#5348e91c246d4c2d964f970fd3969960" title="Security &amp; Privacy"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Security &amp; Privacy</span></span></h4><div><p><a target="_blank" rel="noopener noreferrer" href="https://blog.twitter.com/engineering/en_us/topics/infrastructure/2020/rebuild_twitter_public_api_2020#:~:text=One%20aspect%20of,through%20the%20API.">From Rebuilding Twitter’s public API (2020)</a>:</p><div><p>“One aspect of the platform that has been top of mind since the beginning is the importance of serving the health of the public conversation and protecting the personal data of people using Twitter.

The new platform takes a strong stance on where related business logic should live by pushing all security and privacy related logic to backend services. The result is that the API layer is agnostic to this logic and privacy decisions are applied uniformly across all of the Twitter clients and the API.

By isolating where these decisions are made, we can limit inconsistent data exposure so that what you see in the iOS app will be the same as what you get from programmatic querying through the API.”</p></div></div><h2 data-id="78f526ccba7c452d9c91717c6f2b72fd"><span><a href="#78f526ccba7c452d9c91717c6f2b72fd" title="Conclusion (for now)"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Conclusion (for now)</span></span></h2><p>Hopefully this post has helped you understand how Twitter’s algorithmic feed works, what it’s underlying network graph looks like, and some of the main engineering considerations which make it such a challenging problem to deal with at scale.</p><p>Here are some high-level questions that I hope to answer in a follow-up post:</p><ul><li>What would open sourcing the Twitter algorithm actually look like?</li></ul><ul><li>Would it be possible to abstract away all of the engineering complexity that it takes to run a global, production system like Twitter and produce an OSS spec or API that is actually useful?</li></ul><ul><li>Would it be possible to produce meaningful results without access to Twitter’s full data set?</li></ul><ul><li>What does meaningful even mean here? How would we define success?</li></ul><ul><li>What would need to happen in order to make this a reality?</li></ul><ul><li>What are some practical proposals that would help improve the status quo? (since we don’t all have $43B to try and buy Twitter 😂)</li></ul><h3 data-id="14f2f0b9bd9441bd94db5a5a77e17290"><span><a href="#14f2f0b9bd9441bd94db5a5a77e17290" title="Further Reading"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span>Further Reading</span></span></h3><hr/><div><div><p><span role="img" aria-label="👉">👉</span></p><p>Follow me on twitter for more awesome stuff like this <span><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/transitive_bs">@transitive_bs</a></span></p></div></div></article></div>
  </body>
</html>
