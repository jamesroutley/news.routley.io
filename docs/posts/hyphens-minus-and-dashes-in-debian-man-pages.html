<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lwn.net/Articles/947941/">Original</a>
    <h1>Hyphens, minus, and dashes in Debian man pages</h1>
    
    <div id="readability-page-1" class="page"><div>
<center>
           <div><b>Did you know...?</b><p>LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a href="https://lwn.net/subscribe/">buying a subscription</a> and keeping LWN on the
       net.</p></div>
           </center>
           <p>
It is probably fair to say that most Linux users spend little time thinking
about the troff typesetting program, despite that application&#39;s
groundbreaking role in computing history.  Troff (along with nroff) is
still with us, though, even if they are called <a href="https://www.gnu.org/software/groff/">groff</a> these days, and every
now and then they make their presence known.  A recent groff change created
a bit of a tempest within the Debian community, and has effectively been
reverted there.  It all comes down to the question of what, exactly, is the
character used to mark command-line options on Unix systems?
</p><p>
Last July, Sven Joachim <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1041731">filed a
bug report</a> regarding a change in groff, and in how it renders man pages
for terminals in particular.  A change to the handling of the character
often referred to as &#34;hyphen&#34;, &#34;minus&#34;, or &#34;dash&#34; (&#34;<tt>-</tt>&#34;) made many
man pages rather harder to work with.  To understand the problem, it&#39;s
worth noting that Unicode provides a plethora of similar characters, some
of which are:
</p><blockquote>
<table>
<tbody><tr><th>Name</th><th>Codepoint</th><th></th></tr>
<tr><td>Hyphen-Minus</td><td>002D</td><td>-</td></tr>
<tr><td>Hyphen</td><td>2010</td><td>‐</td></tr>
<tr><td>En Dash</td><td>2013</td><td>–</td></tr>
<tr><td>Em Dash</td><td>2014</td><td>—</td></tr>
<tr><td>Minus Sign</td><td>2212</td><td>−</td></tr>
</tbody></table>
</blockquote>
<p>
There are many more — Unicode is nothing if not generous in this regard.
The term &#34;dashes&#34; will be used to refer to this class of glyphs here.
</p><p>
The specified behavior of groff is that an ASCII
&#34;<tt>-</tt>&#34; (Hyphen-Minus) in the input becomes a Hyphen in the output.
If the desire is to use Hyphen-Minus in the output, then the input should
use the sequence &#34;<tt>\-</tt>&#34; instead.  If the author of a man page types
&#34;<tt>--frobnicate</tt>&#34; as an option name, the output will read
&#34;<tt>‐‐frobnicate</tt>&#34; (with Hyphen) rather than
&#34;<tt>--frobnicate</tt>&#34; (with Hyphen-Minus).  The two look the same, but
there is a crucial difference.  A user who searches for
&#34;<tt>--frobnicate</tt>&#34; in a man page will not find it if the wrong type of
dash is used and, if that user cuts-and-pastes an example with the wrong
dash, it will not work.
</p><p>
As an example, one can try pasting these two lines into a shell:
</p><pre>    /usr/bin/echo --help
    /usr/bin/echo ‐‐help
</pre>
<p>
The results from one will be rather more helpful than from the other.  Use
of the wrong type of dash can also break URLs and corrupt file names.
</p><p>
Developers of free software are, of course, diligent about writing man
pages; they do the job promptly, take their time to get every detail right,
and can be expected to use the right kind of dash in every situation, even
though the output from using the wrong kind looks exactly the same.  They
will surely not be bothered by the fact that a format designed to document
command-line options contains a trap whereby the failure to add backslashes
silently introduces problems for users who are distant in time and space.
</p><p>
Shockingly, this turns out not to be the case, and Linux man pages are
overflowing with unescaped dashes.  Years ago, the Debian project tried to
address this problem by adding a check to its <a href="https://wiki.debian.org/Lintian">Lintian</a> tool that would issue a
warning when unescaped dashes were used.  That check was <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=785353">dropped in
2015</a>, though, after Niels Thykier concluded that it was simply being
ignored: &#34;<q>The tag has existed since 2004 (commit fb2e7de).  To date
there are still 2000 packages with the issue.</q>&#34; Since then, there has
been no warning shown to Debian developers when man pages contain unescaped
dashes.
</p><p>
Given the prevalence of this problem, it would arguably make sense to apply
a fix at the processing level.  And, indeed, groff has, for many years,
duly remapped the Hyphen-Minus character (and a few others) in the man-page
macros, making dash characters simply work as many would expect.  That
helpful behavior ended with the <a href="https://lists.gnu.org/archive/html/info-gnu/2023-07/msg00001.html">groff
1.23.0 release</a> in July:
</p><blockquote>
	The an (man) and doc (mdoc) macro packages no longer remap the -,
  	&#39;, and ` input characters to Basic Latin code points on UTF-8
  	devices, but treat them as groff normally does (and AT&amp;T troff
  	before it did) for typesetting devices, where they become the
  	hyphen, apostrophe or right single quotation mark, and left single
  	quotation mark, respectively.  This change is expected to expose
  	glyph usage errors in man pages.  See the &#34;<a href="https://git.savannah.gnu.org/cgit/groff.git/tree/PROBLEMS#n64">PROBLEMS</a>&#34;
  	file for a recipe that will conceal these errors.  A better
  	long-term approach is for man pages to adopt correct input
  	practices
</blockquote>
<p>
Problems were indeed exposed, and users began to complain; bugs were filed
and the topic <a href="https://lwn.net/ml/debian-devel/e21c0729-0789-4079-b9a2-b9a4b1843e05@aerusso.net/">showed
up on the debian-devel mailing list</a> as well.  G. Branden Robinson, the
upstream maintainer of groff and author of this change, <a href="https://lwn.net/ml/debian-devel/20231015063029.xryij737yegdzdc2@illithid/">defended
the new behavior</a>:
</p><blockquote>
	Mapping all hyphens and minus signs to a single character, as
	people whose blood pressure spikes over this issue tend to promote
	as a first resort, is an ineluctably information-discarding
	operation.  In my opinion, man page source documents are not the
	correct place to discard that information.
</blockquote>
<p>
Among other things, the information being discarded by this change includes
whether line-breaking is allowed; Hyphen-minus does not allow it, while
Hyphen does.
</p><p>
Others disagreed with Robinson&#39;s position; Russ Allbery <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1041731#74">said</a>:
</p><blockquote>
	My opinion is that the world of documents that are handled by man
	do not encode meaningful distinctions between - and \-, and man
	should therefore unify those characters.
</blockquote>
<p>
Colin Watson, who maintains Debian&#39;s groff package, <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1041731#10">admitted</a>
that he had overlooked this problem when he updated Debian to the 1.23.0
release:
</p><blockquote>
	I was aware of the change, but it somehow fell off my list of
	things to make a positive decision about when packaging 1.23.0.
	I&#39;m rather inclined to revert this by adding the rest of the recipe
	above to debian/mandoc.local (while I agree with the idealized
	typographical point being made, I have approximately negative
	appetite for the Sisyphean task of fixing an entire distribution&#39;s
	manual pages in practice).
</blockquote>
<p>
A few weeks later, he <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1041731#62">said</a>
that his plan was to leave the change in place during the current
Debian 13 (&#34;Trixie&#34;) development cycle, but then to revert it prior to
the pre-release freeze to avoid inflicting problems on Debian&#39;s users.
That would, in theory, give developers time to fix as many of the problems
as possible.  After the discussion went on for a while, though, he <a href="https://lwn.net/ml/debian-devel/ZS0aV4XyJH+O1o%2Fc@riva.ucam.org/">changed his
mind</a>, stating that he was unwilling to have his inbox filled with this
discussion for the next year.  So the remapping of &#34;<tt>-</tt>&#34; has been
reinstated into Debian&#39;s version of groff.
</p><p>
This little episode may well be repeated in other distributions as they
catch up with the groff 1.23.0 release.  It also is probably not finished
within Debian.  This situation brings together the problems of
documentation writing, typographic correctness, and Unicode look-alike code
points, all of which are fertile ground for disagreement.  The hopes that
removing the remapping in groff would lead to the fixing of all those man
pages may have been dashed, but that does not bar another attempt in the
future.<br clear="all"/></p><hr/><p>
           (<a href="https://lwn.net/Login/?target=/Articles/947941/">Log in</a> to post comments)
           </p></div></div>
  </body>
</html>
