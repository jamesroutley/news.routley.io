<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/exaloop/codon">Original</a>
    <h1>A high-performance, zero-overhead, extensible Python compiler using LLVM</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto">
 <a target="_blank" rel="noopener noreferrer" href="https://github.com/exaloop/codon/blob/develop/docs/img/codon.png?raw=true"><img src="https://github.com/exaloop/codon/raw/develop/docs/img/codon.png?raw=true" width="600" alt="Codon"/></a>
</p>

<a href="https://github.com/exaloop/codon/actions/workflows/ci.yml">
  <img src="https://github.com/exaloop/codon/actions/workflows/ci.yml/badge.svg" alt="Build Status"/>
</a>

<p dir="auto">Codon is a high-performance Python implementation that compiles to native machine code without
any runtime overhead. Typical speedups over vanilla Python are on the order of 10-100x or more, on
a single thread. Codon&#39;s performance is typically on par with (and sometimes better than) that of
C/C++. Unlike Python, Codon supports native multithreading, which can lead to speedups many times
higher still.</p>
<p dir="auto"><em>Think of Codon as Python reimagined for static, ahead-of-time compilation, built from the ground
up with best possible performance in mind.</em></p>

<ul dir="auto">
<li>üí° <strong>No learning curve:</strong> Be as close to CPython as possible in terms of syntax, semantics and libraries</li>
<li>üöÄ <strong>Top-notch performance:</strong> At <em>least</em> on par with low-level languages like C, C++ or Rust</li>
<li>üíª <strong>Hardware support:</strong> Full, seamless support for multicore programming, multithreading (no GIL!), GPU and more</li>
<li>üìà <strong>Optimizations:</strong> Comprehensive optimization framework that can target high-level Python constructs
and libraries</li>
<li>üîã <strong>Interoperability:</strong> Full interoperability with Python&#39;s ecosystem of packages and libraries</li>
</ul>

<ul dir="auto">
<li>
<p dir="auto">‚ùå <em>Drop-in replacement for CPython:</em> Codon is not a drop-in replacement for CPython. There are some
aspects of Python that are not suitable for static compilation ‚Äî we don&#39;t support these in Codon.
There are ways to use Codon in larger Python codebases via its <a href="https://docs.exaloop.io/codon/interoperability/decorator" rel="nofollow">JIT decorator</a>
or <a href="https://docs.exaloop.io/codon/interoperability/pyext" rel="nofollow">Python extension backend</a>. Codon also supports
calling any Python module via its <a href="https://docs.exaloop.io/codon/interoperability/python" rel="nofollow">Python interoperability</a>.
See also <a href="https://docs.exaloop.io/codon/general/differences" rel="nofollow"><em>&#34;Differences with Python&#34;</em></a> in the docs.</p>
</li>
<li>
<p dir="auto">‚ùå <em>New syntax and language constructs:</em> We try to avoid adding new syntax, keywords or other language
features as much as possible. While Codon does add some new syntax in a couple places (e.g. to express
parallelism), we try to make it as familiar and intuitive as possible.</p>
</li>
</ul>

<p dir="auto">Pre-built binaries for Linux (x86_64) and macOS (x86_64 and arm64) are available alongside <a href="https://github.com/exaloop/codon/releases">each release</a>.
Download and install with:</p>
<div dir="auto" data-snippet-clipboard-copy-content="/bin/bash -c &#34;$(curl -fsSL https://exaloop.io/install.sh)&#34;"><pre>/bin/bash -c <span><span>&#34;</span><span><span>$(</span>curl -fsSL https://exaloop.io/install.sh<span>)</span></span><span>&#34;</span></span></pre></div>
<p dir="auto">Or you can <a href="https://docs.exaloop.io/codon/advanced/build" rel="nofollow">build from source</a>.</p>

<p dir="auto">Codon is a Python-compatible language, and many Python programs will work with few if any modifications:</p>
<div dir="auto" data-snippet-clipboard-copy-content="def fib(n):
    a, b = 0, 1
    while a &lt; n:
        print(a, end=&#39; &#39;)
        a, b = b, a+b
    print()
fib(1000)"><pre><span>def</span> <span>fib</span>(<span>n</span>):
    <span>a</span>, <span>b</span> <span>=</span> <span>0</span>, <span>1</span>
    <span>while</span> <span>a</span> <span>&lt;</span> <span>n</span>:
        <span>print</span>(<span>a</span>, <span>end</span><span>=</span><span>&#39; &#39;</span>)
        <span>a</span>, <span>b</span> <span>=</span> <span>b</span>, <span>a</span><span>+</span><span>b</span>
    <span>print</span>()
<span>fib</span>(<span>1000</span>)</pre></div>
<p dir="auto">The <code>codon</code> compiler has a number of options and modes:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# compile and run the program
codon run fib.py
# 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987

# compile and run the program with optimizations enabled
codon run -release fib.py
# 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987

# compile to executable with optimizations enabled
codon build -release -exe fib.py
./fib
# 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987

# compile to LLVM IR file with optimizations enabled
codon build -release -llvm fib.py
# outputs file fib.ll"><pre><span><span>#</span> compile and run the program</span>
codon run fib.py
<span><span>#</span> 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987</span>

<span><span>#</span> compile and run the program with optimizations enabled</span>
codon run -release fib.py
<span><span>#</span> 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987</span>

<span><span>#</span> compile to executable with optimizations enabled</span>
codon build -release -exe fib.py
./fib
<span><span>#</span> 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987</span>

<span><span>#</span> compile to LLVM IR file with optimizations enabled</span>
codon build -release -llvm fib.py
<span><span>#</span> outputs file fib.ll</span></pre></div>
<p dir="auto">See <a href="https://docs.exaloop.io/codon/general/intro" rel="nofollow">the docs</a> for more options and examples.</p>
<p dir="auto">You can import and use any Python package from Codon. For example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="from python import matplotlib.pyplot as plt
data = [x**2 for x in range(10)]
plt.plot(data)
plt.show()"><pre><span>from</span> <span>python</span> <span>import</span> <span>matplotlib</span>.<span>pyplot</span> <span>as</span> <span>plt</span>
<span>data</span> <span>=</span> [<span>x</span><span>**</span><span>2</span> <span>for</span> <span>x</span> <span>in</span> <span>range</span>(<span>10</span>)]
<span>plt</span>.<span>plot</span>(<span>data</span>)
<span>plt</span>.<span>show</span>()</pre></div>
<p dir="auto">(Just remember to set the <code>CODON_PYTHON</code> environment variable to the CPython shared library,
as explained in the <a href="https://docs.exaloop.io/codon/interoperability/python" rel="nofollow">the docs</a>.)</p>
<p dir="auto">This prime counting example showcases Codon&#39;s <a href="https://www.openmp.org/" rel="nofollow">OpenMP</a> support, enabled
with the addition of one line. The <code>@par</code> annotation tells the compiler to parallelize the
following <code>for</code>-loop, in this case using a dynamic schedule, chunk size of 100, and 16 threads.</p>
<div dir="auto" data-snippet-clipboard-copy-content="from sys import argv

def is_prime(n):
    factors = 0
    for i in range(2, n):
        if n % i == 0:
            factors += 1
    return factors == 0

limit = int(argv[1])
total = 0

@par(schedule=&#39;dynamic&#39;, chunk_size=100, num_threads=16)
for i in range(2, limit):
    if is_prime(i):
        total += 1

print(total)"><pre><span>from</span> <span>sys</span> <span>import</span> <span>argv</span>

<span>def</span> <span>is_prime</span>(<span>n</span>):
    <span>factors</span> <span>=</span> <span>0</span>
    <span>for</span> <span>i</span> <span>in</span> <span>range</span>(<span>2</span>, <span>n</span>):
        <span>if</span> <span>n</span> <span>%</span> <span>i</span> <span>==</span> <span>0</span>:
            <span>factors</span> <span>+=</span> <span>1</span>
    <span>return</span> <span>factors</span> <span>==</span> <span>0</span>

<span>limit</span> <span>=</span> <span>int</span>(<span>argv</span>[<span>1</span>])
<span>total</span> <span>=</span> <span>0</span>

<span>@<span>par</span>(<span>schedule</span><span>=</span><span>&#39;dynamic&#39;</span>, <span>chunk_size</span><span>=</span><span>100</span>, <span>num_threads</span><span>=</span><span>16</span>)</span>
<span>for</span> <span>i</span> <span>in</span> <span>range</span>(<span>2</span>, <span>limit</span>):
    <span>if</span> <span>is_prime</span>(<span>i</span>):
        <span>total</span> <span>+=</span> <span>1</span>

<span>print</span>(<span>total</span>)</pre></div>
<p dir="auto">Codon supports writing and executing GPU kernels. Here&#39;s an example that computes the
<a href="https://en.wikipedia.org/wiki/Mandelbrot_set" rel="nofollow">Mandelbrot set</a>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import gpu

MAX    = 1000  # maximum Mandelbrot iterations
N      = 4096  # width and height of image
pixels = [0 for _ in range(N * N)]

def scale(x, a, b):
    return a + (x/N)*(b - a)

@gpu.kernel
def mandelbrot(pixels):
    idx = (gpu.block.x * gpu.block.dim.x) + gpu.thread.x
    i, j = divmod(idx, N)
    c = complex(scale(j, -2.00, 0.47), scale(i, -1.12, 1.12))
    z = 0j
    iteration = 0

    while abs(z) &lt;= 2 and iteration &lt; MAX:
        z = z**2 + c
        iteration += 1

    pixels[idx] = int(255 * iteration/MAX)

mandelbrot(pixels, grid=(N*N)//1024, block=1024)"><pre><span>import</span> <span>gpu</span>

<span>MAX</span>    <span>=</span> <span>1000</span>  <span># maximum Mandelbrot iterations</span>
<span>N</span>      <span>=</span> <span>4096</span>  <span># width and height of image</span>
<span>pixels</span> <span>=</span> [<span>0</span> <span>for</span> <span>_</span> <span>in</span> <span>range</span>(<span>N</span> <span>*</span> <span>N</span>)]

<span>def</span> <span>scale</span>(<span>x</span>, <span>a</span>, <span>b</span>):
    <span>return</span> <span>a</span> <span>+</span> (<span>x</span><span>/</span><span>N</span>)<span>*</span>(<span>b</span> <span>-</span> <span>a</span>)

<span>@<span>gpu</span>.<span>kernel</span></span>
<span>def</span> <span>mandelbrot</span>(<span>pixels</span>):
    <span>idx</span> <span>=</span> (<span>gpu</span>.<span>block</span>.<span>x</span> <span>*</span> <span>gpu</span>.<span>block</span>.<span>dim</span>.<span>x</span>) <span>+</span> <span>gpu</span>.<span>thread</span>.<span>x</span>
    <span>i</span>, <span>j</span> <span>=</span> <span>divmod</span>(<span>idx</span>, <span>N</span>)
    <span>c</span> <span>=</span> <span>complex</span>(<span>scale</span>(<span>j</span>, <span>-</span><span>2.00</span>, <span>0.47</span>), <span>scale</span>(<span>i</span>, <span>-</span><span>1.12</span>, <span>1.12</span>))
    <span>z</span> <span>=</span> <span>0j</span>
    <span>iteration</span> <span>=</span> <span>0</span>

    <span>while</span> <span>abs</span>(<span>z</span>) <span>&lt;=</span> <span>2</span> <span>and</span> <span>iteration</span> <span>&lt;</span> <span>MAX</span>:
        <span>z</span> <span>=</span> <span>z</span><span>**</span><span>2</span> <span>+</span> <span>c</span>
        <span>iteration</span> <span>+=</span> <span>1</span>

    <span>pixels</span>[<span>idx</span>] <span>=</span> <span>int</span>(<span>255</span> <span>*</span> <span>iteration</span><span>/</span><span>MAX</span>)

<span>mandelbrot</span>(<span>pixels</span>, <span>grid</span><span>=</span>(<span>N</span><span>*</span><span>N</span>)<span>//</span><span>1024</span>, <span>block</span><span>=</span><span>1024</span>)</pre></div>
<p dir="auto">GPU programming can also be done using the <code>@par</code> syntax with <code>@par(gpu=True)</code>.</p>

<p dir="auto">Please see <a href="https://docs.exaloop.io/codon" rel="nofollow">docs.exaloop.io</a> for in-depth documentation.</p>
</article></div></div>
  </body>
</html>
