<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://grafana.com/blog/2021/12/08/an-update-on-0day-cve-2021-43798-grafana-directory-traversal/">Original</a>
    <h1>An update on 0day CVE-2021-43798: Grafana directory traversal</h1>
    
    <div id="readability-page-1" class="page"><div>
<p><strong>Note:</strong> <em>We released fixes for CVE-2021-41090 and CVE-2021-43798 within 24 hours and mixed them up in one of the three blog posts. To make it clear: CVE-2021-41090 is for the Grafana <strong>Agent</strong> and CVE-2021-43798 is for Grafana <strong>the software</strong>. Only CVE-2021-43798 was a 0day exploit.</em></p>
<p><strong>Note:</strong> <em>A previous version of this blog post included the wrong CVE. It has been corrected. The timeline has also been updated.</em></p>
<p>Yesterday, we <a href="https://grafana.com/blog/2021/12/07/grafana-8.3.1-8.2.7-8.1.8-and-8.0.7-released-with-high-severity-security-fix/">released an update to Grafana</a> fixing a directory traversal attack tracked under <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-43798" target="_blank" rel="noopener noreferrer">CVE-2021-43798</a>.</p>
<p>We wanted to blog about it again today for two reasons: First, we wanted to give more insight into our timeline as external events forced us to deviate from our planned timeline. On the “positive” side, we had our first 0day!</p>
<p>Second, given the <a href="https://www.reuters.com/markets/commodities/amazons-prime-ring-other-apps-down-thousands-users-2021-12-07/" target="_blank" rel="noopener noreferrer">AWS outage</a> yesterday, we wanted to re-amplify the message that <strong>all users should upgrade their Grafana 8.x instances as soon as possible</strong>.</p>
<p>We are releasing this update in coordination with Jordy Versmissen, the researcher who notified us of the vulnerability. You can find the story of how he found the vulnerability in his <a href="https://j0vsec.com/post/cve-2021-43798/" target="_blank" rel="noopener noreferrer">blog post</a>.</p>
<h2 id="please-upgrade-your-grafana-8x-instances">Please upgrade your Grafana 8.x instances</h2>
<p>Again, we are re-releasing this information largely to raise awareness and get all users to upgrade their Grafana 8.x instances. If you have any of those, please <strong>UPGRADE RIGHT NOW</strong>. This blog post will wait for you until you’re done — promise!</p>
<p>For a description of the vulnerability and download links, please <a href="https://grafana.com/blog/2021/12/07/grafana-8.3.1-8.2.7-8.1.8-and-8.0.7-released-with-high-severity-security-fix/">see our advisory</a>.</p>
<h2 id="normal-mode">Normal mode</h2>
<p>Our internal vulnerability handling procedure follows these steps:</p>
<ol>
<li>Discovery / reporting</li>
<li>Confirmation &amp; assessment</li>
<li>Incident declared</li>
<li>Mitigate vulnerability in Grafana Cloud</li>
<li>Bugfix</li>
<li>Testing</li>
<li>Creation of release plan</li>
<li>Deployment of fix on Cloud (if applicable)</li>
<li>Limited release for customers</li>
<li>Public release</li>
<li>Postmortem finalized</li>
</ol>
<p>And we happily followed these steps until yesterday, when we realized that a 0day was out in the wild.</p>
<h2 id="more-detailed-timeline">More detailed timeline</h2>
<p>It’s important to note that we’re listing this timeline in the spirit of full transparency. We also strongly believe in <a href="https://sre.google/sre-book/postmortem-culture" target="_blank" rel="noopener noreferrer">blameless postmortems</a>, internally and externally. Mistakes happen, in particular when you’re happy and excited. The good thing about mistakes that are treated respectfully and transparently is that the maximum amount of people can learn from them.</p>
<p>As such, onwards! All times in UTC:</p>
<ul>
<li>2021-12-03 02:51: We received and escalated a ticket at <a href="mailto:security@grafana.com">security@grafana.com</a></li>
<li>2021-12-03 07:57: Vulnerability confirmed</li>
<li>2021-12-03 08:41: Incident declared</li>
<li>2021-12-03 08:42: Grafana Cloud confirmed not to be vulnerable</li>
<li>2021-12-03 08:42: Jordy tweets and deletes about “read arbitrary files on the host, no authentication needed” (<strong>Editor’s note</strong>: We were not aware of this until 2021-12-07.)</li>
<li>2021-12-03 09:37: v8.0.0-beta1 to v8.3.0 are affected</li>
<li>2021-12-03 09:57: Identified PR introducing vulnerability</li>
<li>2021-12-03 09:58: CVE Request sent; Provisional assessment 7.5 High CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N</li>
<li>2021-12-03 10:57: Root cause found</li>
<li>2021-12-03 02:49: Release plan set: 2021-12-07 for private customer release, 2021-12-14 for public release (<strong>Editor’s note</strong>: We never release on Monday or Friday to spare the weekends of customers and users. Customers get a week to upgrade under strict embargo.)</li>
<li>2021-12-03 18:13: Patches ready</li>
<li>2021-12-06 11:26: Second report about the vulnerability received. Follow-up determines that it’s coming through a bug bounty program. Jordy confirms that he submitted to a bug bounty program in parallel to us</li>
<li>2021-12-07 09:04: We become aware of public discussion around the vulnerability. This is now a 0day</li>
<li>2021-12-07 09:07: Emergency release plan started</li>
<li>2021-12-07 09:07: Decision to maintain complete radio silence to avoid increasing visibility</li>
<li>2021-12-07 14:18: Private release with reduced 2-hour grace period, not the usual 1-week timeframe</li>
<li>2021-12-07 16:14: Full public release</li>
</ul>
<h2 id="lessons-learned">Lessons learned</h2>
<p>The vulnerability Jordy found is one of the problem types I personally like the most (at least when not directly affected myself): The obvious-in-hindsight ones. It took someone to do the work, and once they’ve done the work, others will claim how trivial it all is. <strong>But it did take someone to do the actual work first</strong>.</p>
<p>Unfortunately, in this case, this meant that once people knew what to look for, find it they did — and quickly. We will add boilerplate language asking for radio silence to both our reporting how to guidelines and to our <a href="mailto:security@grafana.com">security@grafana.com</a> response and will incentivize this with a formal bug bounty (see below).</p>
<p>We had to build an impressive amount of release artifacts in a rather short amount of time. Eight releases, four private and four public ones, multiplied by all the platforms and deployment models we support. In total, we ended up releasing dozens and dozens of full artifacts within mere hours. Plus, we had some build failures during release. We will have a release engineering sprint within the next few weeks to allow us to seamlessly build private releases and to massively speed up overall release build speed.</p>
<p>We are already working on establishing a bug bounty program for Grafana Labs. While it will take us some more time to release it, if we had it in place by last Friday, we would not have inadvertently created an incentive for Jordy to submit to other third parties. We strongly believe that researchers should be able to live through their work and will introduce a bug bounty program soon. If you have opinions on bug bounty programs, <a href="https://twitter.com/TwitchiH/status/1468603856670109700" target="_blank" rel="noopener noreferrer">please see my Twitter poll</a>.</p>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>We would like to thank <a href="https://twitter.com/j0v0x0" target="_blank" rel="noopener noreferrer">Jordy Versmissen</a> for finding the vulnerability and alerting us to it.</p>
<h2 id="postmortem">Postmortem</h2>
<p>We are currently working on a full postmortem and will publish it on our blog as soon as it’s ready.</p>
</div></div>
  </body>
</html>
