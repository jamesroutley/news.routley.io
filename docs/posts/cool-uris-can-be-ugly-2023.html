<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://unterwaditzer.net/2023/cool-uris.html">Original</a>
    <h1>Cool URIs can be ugly (2023)</h1>
    
    <div id="readability-page-1" class="page"><div>
      
    
<p><time id="post-date">2023-02-05</time></p>
<p>Around last year this blog, a simple static site, was running on
GitHub pages, together with Cloudflare in front of it due to (perceived)
unreliability with GitHub’s SSL provisioning for custom domains. In
order to simplify my stack, I tried running it on <a href="https://pages.cloudflare.com/">Cloudflare Pages</a>.</p>
<p>The setup process was extremely smooth. Connecting to the GitHub
repository where my blog lives worked just as expected, setting up their
CI was painless, and since Cloudflare was already managing my domain’s
DNS, switching over DNS records to point to the new static site was
literally just a button click.</p>
<p>This worked fine for a week or so until I found some pretty
surprising behavior in Cloudflare’s static site hosting that made me
stop using their services immediately.</p>
<p>My blogposts have the following URL format:</p>
<pre>https://unterwaditzer.net/&lt;year&gt;/&lt;slug&gt;.html</pre>
<p>I inherited this decision from the static site generator I started
with, <a href="https://github.com/lepture/liquidluck">liquidluck</a>,
and have since then put a lot of care into ensuring this format never
changes as I moved away from it, even though the format could perhaps be
a little bit cleaner.</p>
<p>The corresponding file on the filesystem is
<code>/&lt;year&gt;/&lt;slug&gt;.html</code>.</p>
<p>Yet as soon as I moved to Cloudflare Pages, I found that suddenly all
blogposts were served under the following format:</p>
<pre>https://unterwaditzer.net/&lt;year&gt;/&lt;slug&gt;</pre>
<p>In fact, all URLs with <code>.html</code> now redirect with
<code>301 Permanent Redirect</code> to the “cleaned up” version! That’s
why navigating my blog was still working fine, as literally every click
on the page was being redirected to the “cleaned up” URL.</p>
<p>Now this is probably closer to the URL format I would start out with
today if I had to start a new blog. But Cloudflare’s redirect is
permanent and has been public for a few weeks, therefore all Google
search results were pointing to the cleaned up URLs. If I wanted to move
to a different static site host, I would have to install additional
redirects so that none of those links break, just to clean up a mess I
didn’t cause.</p>
<p>It turns out, however, that GitHub Pages does something similar, just
in a slightly more conservative way: If you request
<code>/&lt;year&gt;/&lt;slug&gt;</code>, it will serve up
<code>/&lt;year&gt;/&lt;slug&gt;.html</code> just as if you requested it
directly. However, GitHub does not issue any permanent redirects, so it
does not lock me into anything at all.</p>
<p>This made it a rather easy decision for me to switch back to GitHub
pages. Together with adding
<code>&lt;link rel=&#34;canonical&#34; ...&gt;</code> to all my subpages, no
links are broken and the Google search results should eventually
self-correct.</p>
<p>I can only assume that the way that Cloudflare justifies this sort of
URL rewriting is through arguments similar to the ones found in <a href="https://www.w3.org/Provider/Style/URI">Cool URIs don’t
change</a>.</p>
<p>However I think it would be a gross misinterpretation of that article
if your takeaway is to plainly remove <code>.html</code> from all URLs
and issue permanent redirects. If your URL prettification happens in a
way that can easily break when moving between static site hosts, you
have not made URLs more stable, you just made them prettier. In fact,
Cloudflare Pages now made my URLs more brittle and less cool, because
they now not only depend on the choices made by my static site
generator, but also on my choice of static site host.</p>
<p>This blog will continue to serve cool-but-ugly URLs. If I ever
attempt to make them prettier, I will do so with intent, and not on
accident. And probably as part of static site generation, not in the
routing layer of a random cloud service.</p>
</div></div>
  </body>
</html>
