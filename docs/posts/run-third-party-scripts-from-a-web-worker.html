<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://partytown.builder.io/">Original</a>
    <h1>Run Third-Party Scripts from a Web Worker</h1>
    
    <div id="readability-page-1" class="page"><article id="article">
	<section>
		
		<nav>
			<astro-root uid="Z15DFMQ"><h2>On this page</h2><ul></ul></astro-root>
		</nav>
		<p>Partytown is a lazy-loaded library to help relocate resource intensive scripts into a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API">web worker</a>, and off of the <a href="https://developer.mozilla.org/en-US/docs/Glossary/Main_thread">main thread</a>. Its goal is to help speed up sites by dedicating the main thread to your code, and offloading third-party scripts to a web worker.</p><p>Even with a fast and highly tuned website following all of today’s best practices, it’s all too common for your performance wins to be erased the moment third-party scripts are added. By third-party scripts we mean code that is embedded within your site, but not directly under your control. A few examples include: analytics, metrics, ads, A/B testing, trackers, etc.</p><p>Partytown is maintained by <a href="https://www.builder.io/">Builder.io</a> and is currently in <a href="https://www.builder.io/blog/partytown-is-now-in-beta">Beta</a>.</p><p><a href="https://www.smashingmagazine.com/2022/04/partytown-eliminates-website-bloat-third-party-apps/">Smashing Magazine: How Partytown Eliminates Website Bloat From Third-Party Scripts</a></p><h2 id="goals">Goals</h2><p>We set out to solve this situation, so that apps of all sizes will be able to continue to use third-party scripts without the performance hit. Some of Partytown’s goals include:</p><ul>
<li>Free up main thread resources to be used only for the primary web app execution.</li>
<li>Sandbox third-party scripts and allow or deny their access to main thread APIs.</li>
<li>Isolate long-running tasks within the web worker thread.</li>
<li>Reduce layout thrashing coming from third-party scripts by batching DOM setters/getter into group updates.</li>
<li>Throttle third-party scripts’ access to the main thread.</li>
<li>Allow third-party scripts to run exactly how they’re coded and without any alterations.</li>
<li>Read and write main thread DOM operations <em>synchronously</em> from within a web worker, allowing scripts running from the web worker to execute as expected.</li>
</ul><h2 id="web-workers">Web Workers</h2><p>Partytown’s philosophy is that the main thread should be dedicated to your code, and any scripts that are not required to be in the <a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path">critical path</a> should be moved to a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API">web worker</a>. Main thread performance is, without question, more important than web worker thread performance. Please see the <a href="https://partytown.builder.io/tests/">test pages</a> for some live demos.</p><p><img src="https://user-images.githubusercontent.com/452425/152363590-89d3b9a5-35c7-4c12-8f3e-c8b5ce4bb267.png" alt="Without Partytown and With Partytown: Your code and third-party code compete for main thread resources"/></p><h2 id="negative-impacts-from-third-party-scripts">Negative Impacts from Third-Party Scripts</h2><p>Below is a summary of potential issues after add third-party scripts, referenced from <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/loading-third-party-javascript">Loading Third-Party JavaScript</a>:</p><ul>
<li>Firing too many network requests to multiple servers. The more requests a site has to make, the longer it can take to load.</li>
<li>Sending too much JavaScript which keeps the main thread busy. Too much JavaScript can block DOM construction, delaying how quickly pages can render.</li>
<li>CPU-intensive script parsing and execution can delay user interaction and cause battery drain.</li>
<li>Third-party scripts that were loaded without care can be a single-point of failure (SPOF).</li>
<li>Insufficient HTTP caching, forcing resources to be fetched from the network often.</li>
<li>The use of legacy APIs (e.g <code>document.write()</code>), which are known to be harmful to the user experience.</li>
<li>Excessive DOM elements or expensive CSS selectors.</li>
<li>Including multiple third-party embeds that can lead to multiple frameworks and libraries being pulled in several times, which exacerbates the performance issues.</li>
<li>Third-party scripts also often use embed techniques that can block <code>window.onload</code>, even if the embed is using async or defer.</li>
</ul><h2 id="use-cases">Use-Cases</h2><p>While full webapps “can” run from within Partytown, it’s actually best intended for code that doesn’t need to be in the <a href="https://developer.mozilla.org/en-US/docs/Web/Performance/Critical_rendering_path">critical rendering path</a>. Most third-party scripts fall into this category, as they’re not required for the first-paint. Additionally, the asynchronous nature of most third-party script works well with Partytown, as they can lazily receive user events and post data to their respective services.</p><p>Below are just a few examples of third-party scripts that might be a good candidate to run from within a web worker. The goal is to continue validating commonly used services to ensure Partytown has the correct API, but Partytown itself does not hardcode to any specific services. Help us test and join the conversation in <a href="https://discord.gg/bNVSQmPzqy">Partytown’s Discord</a>!</p><ul>
<li><a href="https://marketingplatform.google.com/about/tag-manager/">Google Tag Manager (GTM)</a></li>
<li><a href="https://analytics.google.com/">Google Analytics (GA)</a></li>
<li><a href="https://www.facebook.com/business/learn/facebook-ads-pixel">Facebook Pixel</a></li>
<li><a href="https://mixpanel.com/">Mixpanel</a></li>
<li><a href="https://www.hubspot.com/">Hubspot</a></li>
<li><a href="https://segment.com/">Segment</a></li>
<li><a href="https://amplitude.com/">Amplitude</a></li>
</ul><h2 id="ready-to-party-plugins--libraries">“Ready to Party” Plugins / Libraries</h2><p>We try and keep a list of all the plugins and libraries that we know of that works out-of-the-box in Partytown, but we would love your help as plugin &amp; library authors and contributors to keep this list growing.</p><p>We have <a href="https://github.com/BuilderIO/partytown/blob/main/DEVELOPER.md#plugin-authors--developers">some documentation</a> on how you could create and check-in an integration test that shows how your library / plugin works on Partytown. And if it works, then we would love to have the configuration needed (if any) on our <a href="https://partytown.builder.io/common-services">Common Services page</a></p><h2 id="articles">Articles</h2><ul>
<li>
<a href="https://www.smashingmagazine.com/2022/04/partytown-eliminates-website-bloat-third-party-apps/" target="_blank" rel="noopener">
Smashing Magazine: How Partytown Eliminates Website Bloat From Third-Party Scripts
</a>
</li>
<li>
<a href="https://dev.to/adamdbradley/introducing-partytown-run-third-party-scripts-from-a-web-worker-2cnp" target="_blank" rel="noopener">
Introducing Partytown: Run Third-Party Scripts From a Web Worker
</a>
</li>
<li>
<a href="https://dev.to/adamdbradley/how-partytown-s-sync-communication-works-4244" target="_blank" rel="noopener">
How Partytown’s Sync Communication Works
</a>
</li>
<li>
<a href="https://www.builder.io/blog/how-we-cut-99-percent-js-with-qwik-and-partytown" target="_blank" rel="noopener">
How we cut 99% of our JavaScript with Qwik + Partytown
</a>
</li>
<li>
<a href="https://www.builder.io/blog/partytown-is-now-in-beta" target="_blank" rel="noopener">
Partytown is now in Beta
</a>
</li>
<li>
<a href="https://www.patterns.dev/posts/third-party/" target="_blank" rel="noopener">
Patterns: Optimize loading third-parties
</a>
</li>
</ul>
	</section>
	<nav>
		<ul>
	 
</ul> 



	</nav>
</article></div>
  </body>
</html>
