<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.michielborkent.nl/new-clojure-project-quickstart.html">Original</a>
    <h1>New Clojure Project Quickstart</h1>
    
    <div id="readability-page-1" class="page"><div>

      
<p>Clojure beginners sometimes struggle with setting up a new Clojure <code>deps.edn</code> project compared to setting up a <a href="https://leiningen.org/">lein</a> project. This is one of the reasons I&#39;ve built <a href="https://github.com/babashka/neil">neil</a>. But not only for beginners, I&#39;ve been using <code>neil</code> myself a ton too, to add common features to existing <code>deps.edn</code> projects. You may think that <code>neil</code> is a pun on <code>lein</code>. Of course it is. But the name is also an hommage to <a href="https://en.wikipedia.org/wiki/Neil_Peart">Neil
Peart</a>, one of the greatest progressive rock drummers to have ever lived.</p><p>The intent of this post is to give you a starting point from where you can figure out things further. This post isn&#39;t going to explain any details of how <code>deps.edn</code> and related tooling works. For that I&#39;m going to refer you to <a href="https://clojure.org/guides/deps_and_cli">here</a>.</p><p>Let&#39;s install <code>neil</code> which is available for <a href="https://github.com/babashka/neil#homebrew-linux-and-macos">brew</a>, <a href="https://github.com/babashka/neil#scoop-windows">scoop</a> (Windows), <a href="https://github.com/babashka/neil#nix">nix</a>, <a href="https://github.com/babashka/neil#clojure">Clojure
JVM</a> or can easily be installed <a href="https://github.com/babashka/neil#manual">manually</a>. Unless you use clojure JVM, neil runs with <a href="https://babashka.org/">babashka</a> for fast startup time.</p><p>If you&#39;ve already installed <code>babashka</code> (perhaps indirectly by installing <code>neil</code>) but didn&#39;t yet install the <a href="https://clojure.org/guides/deps_and_cli">clojure
CLI</a> or have problems doing so, then you can run <code>bb clojure</code> instead of <code>clojure</code> for launching Clojure. Instead of <code>clj</code>, on linux/macOS you&#39;ll want to use <code>rlwrap bb clojure</code>. If you are on Windows and struggle with the official <code>clojure</code> Powershell-based installation, <code>bb clojure</code> may come in handy too.</p><h2>New</h2><p>To start a new Clojure project, run <code>neil new --name myproject</code>. This produces a <code>myproject</code> directory with a very basic project layout based on the <a href="https://github.com/seancorfield/deps-new">deps-new</a> <code>scratch</code> template. Now we are are going to incrementally add some functionality to this project. If you like to skip most of these steps, you can start from the more fully featured <code>app</code> template with <code>neil new app --name myproject</code>.</p><h2>Adding library</h2><p>Let&#39;s decide that we&#39;re going to need a library to deal with files. Let&#39;s search for one:</p><pre><code>$ neil dep search &#34;file system&#34;
:lib fs/fs :version 1.3.3 :description &#34;File system utilities for clojure&#34;
:lib me.raynes/fs :version 1.4.6 :description &#34;File system utilities for clojure&#34;
:lib babashka/fs :version 0.1.6 :description &#34;Babashka file system utilities.&#34;
</code></pre><p>Let&#39;s go with the <a href="https://github.com/babashka/fs">babashka/fs</a> library:</p><pre><code>$ neil dep add :lib babashka/fs :version 0.1.6
</code></pre><p>Now the library is added to <code>deps.edn</code> and we can use it in our project:</p><pre><code>$ clj
Clojure 1.11.0
user=&gt; (require &#39;[babashka.fs :as fs])
nil
</code></pre><h2>Test</h2><p>Let&#39;s start by adding a test runner. Type: <code>neil add test</code>. After doing this, you will be able to run:</p><pre><code>clojure -M:test
</code></pre><p>We don&#39;t have any tests in this project, so let&#39;s add one by adding a file:</p><p><code>test/myproject/core_test.clj</code></p><pre><code>(ns myproject.core-test
  (:require [clojure.test :as t :refer [deftest is testing]]))

(deftest failing-test
  (testing &#34;TODO: fix test&#34;
    (is (= 3 4))))
</code></pre><p>Now run <code>clojure -M:test</code> again:</p><pre><code>$ clojure -M:test

Running tests in #{&#34;test&#34;}

Testing myproject.core-test

FAIL in (failing-test) (core_test.clj:6)
TODO: fix test
expected: (= 3 4)
  actual: (not (= 3 4))

Ran 1 tests containing 1 assertions.
1 failures, 0 errors.
</code></pre><p>The test runner we added is the Cognitect Labs <a href="https://github.com/cognitect-labs/test-runner">test-runner</a> so check out the README of that project if you need to know more.</p><h2>REPL</h2><p>Run:</p><pre><code>neil add nrepl
</code></pre><p>to add a <code>:nrepl</code> alias to your project. Now you can run <code>clj -M:nrepl</code> to get a console REPL, but also a running nREPL server that you can connect to from your editor. Note that many editors also support <code>jack-in</code> and if you prefer to use that, you won&#39;t need this.</p><h2>Uberjar</h2><p>What&#39;s the equivalent of <code>lein uberjar</code> in the <code>deps.edn</code> world? You&#39;re going to need <a href="https://github.com/clojure/tools.build">tools.build</a>. To create a <code>build.clj</code> file (the program that is going to build your uberjar), run:</p><pre><code>neil add build
</code></pre><p>Since the default <code>build.clj</code> file is going to assume your project is under <code>git</code> version control, let&#39;s initialize a git repo first:</p><pre><code>git init
git add deps.edn src test
git commit -m &#34;initial commit&#34;
</code></pre><p>Before creating the uberjar, we have to add <code>:gen-class</code> to <code>src/scratch.clj</code>:</p><pre><code>(ns scratch
  (:gen-class))
</code></pre><p>and we add <code>:main &#39;scratch</code> in the call to <code>b/uber</code>:</p><pre><code>(b/uber {:class-dir class-dir
         :uber-file uber-file
         :basis basis
         :main &#39;scratch})
</code></pre><p>Now let&#39;s compile the uberjar:</p><pre><code>clojure -T:build uber
</code></pre><p>And then let&#39;s run it:</p><pre><code>$ java -jar target/lib1-1.2.1-standalone.jar 1 2 3
-main with (1 2 3)
</code></pre><h2>Babashka tasks</h2><p>If you have difficulty remembering the above invocations, you can write a <code>bb.edn</code> with some <a href="https://book.babashka.org/#tasks">tasks</a>:</p><p><code>bb.edn</code>:</p><pre><code>{:tasks
 {:requires ([babashka.fs :as fs])

  test {:doc &#34;Run tests&#34;
        :task (apply clojure &#34;-M:test&#34; *command-line-args*)}

  nrepl {:doc &#34;Start REPL&#34;
         :task (if (fs/windows?)
                 (clojure &#34;-M:nrepl&#34;)
                 (shell &#34;rlwrap bb clojure -M:nrepl&#34;))}

  uber {:doc &#34;Build uberjar&#34;
        :task (clojure &#34;-T:build uber&#34;)}}}
</code></pre><p>The <code>clojure</code> function is built into babashka and is a drop-in replacement for the clojure CLI which does not require any installation. With</p><pre><code>(apply ... *command-line-args*)
</code></pre><p>we send any args you pass to a task invocation to clojure. So to run a specific test, you can write:</p><pre><code>bb test -v myproject.core-test/failing-test
</code></pre><p>If you prefer to use the installed clojure CLI, you can do this by using:</p><pre><code>(apply shell &#34;clojure&#34; ... *command-line-args*)
</code></pre><p>Now whenever you forget what to do in the current project, run <code>bb tasks</code>:</p><pre><code>$ bb tasks
The following tasks are available:

test  Run tests
nrepl Start REPL
uber  Build uberjar
</code></pre><p>Hope this helps!</p>
<p>Discuss this post <a href="https://github.com/borkdude/blog/discussions/categories/posts">here</a>.</p>
<p><i>Published: 2022-07-31</i></p>

<p>
  <i>
  Tagged:
  
  <span>
    <a href="https://blog.michielborkent.nl/tags/clojure.html">clojure</a>
  </span>
  
  </i>
</p>



      
      
      
    </div></div>
  </body>
</html>
