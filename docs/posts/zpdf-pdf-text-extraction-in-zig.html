<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Lulzx/zpdf">Original</a>
    <h1>Zpdf: PDF text extraction in Zig</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">A PDF text extraction library written in Zig.</p>

<ul dir="auto">
<li>Memory-mapped file reading for efficient large file handling</li>
<li>Streaming text extraction with efficient arena allocation</li>
<li>Multiple decompression filters: FlateDecode, ASCII85, ASCIIHex, LZW, RunLength</li>
<li>Font encoding support: WinAnsi, MacRoman, ToUnicode CMap</li>
<li>XRef table and stream parsing (PDF 1.5+)</li>
<li>Configurable error handling (strict or permissive)</li>
<li>Multi-threaded parallel page extraction</li>
</ul>

<p dir="auto">Text extraction performance vs MuPDF 1.26 (<code>mutool convert -F text</code>) on Apple M4 Pro:</p>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Document</th>
<th>Pages</th>
<th>Size</th>
<th>zpdf</th>
<th>MuPDF</th>
<th>Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://open-std.org/jtc1/sc22/wg21/docs/papers/2023/n4950.pdf" rel="nofollow">C++ Standard Draft</a></td>
<td>2,134</td>
<td>8 MB</td>
<td>250 ms</td>
<td>968 ms</td>
<td><strong>3.9x</strong></td>
</tr>
<tr>
<td><a href="https://pandas.pydata.org/pandas-docs/version/1.4/pandas.pdf" rel="nofollow">Pandas Documentation</a></td>
<td>3,743</td>
<td>15 MB</td>
<td>395 ms</td>
<td>1,112 ms</td>
<td><strong>2.8x</strong></td>
</tr>
<tr>
<td><a href="https://cdrdv2.intel.com/v1/dl/getContent/671200" rel="nofollow">Intel SDM</a></td>
<td>5,252</td>
<td>25 MB</td>
<td>451 ms</td>
<td>2,099 ms</td>
<td><strong>4.7x</strong></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Document</th>
<th>Pages</th>
<th>Size</th>
<th>zpdf</th>
<th>MuPDF</th>
<th>Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td>C++ Standard Draft</td>
<td>2,134</td>
<td>8 MB</td>
<td>131 ms</td>
<td>966 ms</td>
<td><strong>7.4x</strong></td>
</tr>
<tr>
<td>Pandas Documentation</td>
<td>3,743</td>
<td>15 MB</td>
<td>218 ms</td>
<td>1,117 ms</td>
<td><strong>5.1x</strong></td>
</tr>
<tr>
<td>Intel SDM</td>
<td>5,252</td>
<td>25 MB</td>
<td>117 ms</td>
<td>2,098 ms</td>
<td><strong>17.9x</strong></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">Peak throughput: <strong>45,000 pages/sec</strong> (Intel SDM, parallel)</p>
<p dir="auto">Build with <code>zig build -Doptimize=ReleaseFast</code> for these results.</p>

<p dir="auto">zpdf uses SIMD-accelerated routines for hot paths:</p>
<ul dir="auto">
<li>Whitespace skipping (content streams are whitespace-heavy)</li>
<li>Delimiter detection (tokenization)</li>
<li>Keyword search (<code>stream</code>, <code>endstream</code>, <code>startxref</code>)</li>
<li>String boundary scanning</li>
</ul>
<p dir="auto">Auto-detects: NEON (ARM64), AVX2/SSE4.2 (x86_64), or scalar fallback.</p>
<p dir="auto"><em>Note: MuPDF&#39;s threading (<code>-T</code> flag) is for rendering/rasterization only. Text extraction via <code>mutool convert -F text</code> is single-threaded by design. zpdf parallelizes text extraction across pages.</em></p>

<p dir="auto">Text extraction accuracy vs MuPDF (reference) on US Constitution (85 pages):</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Tool</th>
<th>Char Accuracy</th>
<th>WER</th>
<th>Time</th>
<th>vs MuPDF</th>
</tr>
</thead>
<tbody>
<tr>
<td>zpdf</td>
<td>99.6%</td>
<td>2.1%</td>
<td>2 ms</td>
<td><strong>24x faster</strong></td>
</tr>
<tr>
<td>MuPDF</td>
<td>100%</td>
<td>0%</td>
<td>54 ms</td>
<td>1x</td>
</tr>
<tr>
<td>Tika</td>
<td>97.4%</td>
<td>10.6%</td>
<td>1,307 ms</td>
<td>24x slower</td>
</tr>
<tr>
<td>pdftotext</td>
<td>57.0%</td>
<td>19.8%</td>
<td>90 ms</td>
<td>1.7x slower</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<ul dir="auto">
<li><strong>Char Accuracy</strong>: Sequence similarity vs MuPDF baseline (higher = better)</li>
<li><strong>WER</strong>: Word Error Rate vs MuPDF baseline (lower = better)</li>
</ul>
<p dir="auto">MuPDF is the accuracy baseline (100%). zpdf is 650x faster than Tika with better accuracy.</p>
<p dir="auto">Run <code>PYTHONPATH=python python benchmark/accuracy.py</code> to reproduce.</p>

<ul dir="auto">
<li>Zig 0.15.2 or later</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="zig build              # Build library and CLI
zig build test         # Run tests"><pre>zig build              <span><span>#</span> Build library and CLI</span>
zig build <span>test</span>         <span><span>#</span> Run tests</span></pre></div>


<div dir="auto" data-snippet-clipboard-copy-content="const zpdf = @import(&#34;zpdf&#34;);

pub fn main() !void {
    var gpa = std.heap.GeneralPurposeAllocator(.{}){};
    defer _ = gpa.deinit();
    const allocator = gpa.allocator();

    const doc = try zpdf.Document.open(allocator, &#34;file.pdf&#34;);
    defer doc.close();

    var buf: [4096]u8 = undefined;
    var writer = std.fs.File.stdout().writer(&amp;buf);
    defer writer.interface.flush() catch {};

    for (0..doc.pages.items.len) |page_num| {
        try doc.extractText(page_num, &amp;writer.interface);
    }
}"><pre><span>const</span> <span>zpdf</span> <span>=</span> <span>@import</span>(<span>&#34;zpdf&#34;</span>);

<span>pub</span> <span>fn</span> <span>main</span>() <span>!</span><span>void</span> {
    <span>var</span> <span>gpa</span> <span>=</span> <span>std</span>.<span>heap</span>.<span>GeneralPurposeAllocator</span>(.{}){};
    <span>defer</span> <span>_</span> <span>=</span> <span>gpa</span>.<span>deinit</span>();
    <span>const</span> <span>allocator</span> <span>=</span> <span>gpa</span>.<span>allocator</span>();

    <span>const</span> <span>doc</span> <span>=</span> <span>try</span> <span>zpdf</span>.<span>Document</span>.<span>open</span>(<span>allocator</span>, <span>&#34;file.pdf&#34;</span>);
    <span>defer</span> <span>doc</span>.<span>close</span>();

    <span>var</span> <span>buf</span>: [<span>4096</span>]<span>u8</span> <span>=</span> <span>undefined</span>;
    <span>var</span> <span>writer</span> <span>=</span> <span>std</span>.<span>fs</span>.<span>File</span>.<span>stdout</span>().<span>writer</span>(<span>&amp;</span><span>buf</span>);
    <span>defer</span> <span>writer</span>.<span>interface</span>.<span>flush</span>() <span>catch</span> {};

    <span>for</span> (0<span>..</span><span>doc</span>.<span>pages</span>.<span>items</span>.<span>len</span>) <span>|</span><span>page_num</span><span>|</span> {
        <span>try</span> <span>doc</span>.<span>extractText</span>(<span>page_num</span>, <span>&amp;</span><span>writer</span>.<span>interface</span>);
    }
}</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="zpdf extract document.pdf           # Extract all pages to stdout
zpdf extract -p 1-10 document.pdf   # Extract pages 1-10
zpdf extract -o out.txt document.pdf # Output to file
zpdf info document.pdf              # Show document info
zpdf bench document.pdf             # Run benchmark"><pre>zpdf extract document.pdf           <span><span>#</span> Extract all pages to stdout</span>
zpdf extract -p 1-10 document.pdf   <span><span>#</span> Extract pages 1-10</span>
zpdf extract -o out.txt document.pdf <span><span>#</span> Output to file</span>
zpdf info document.pdf              <span><span>#</span> Show document info</span>
zpdf bench document.pdf             <span><span>#</span> Run benchmark</span></pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="import zpdf

with zpdf.Document(&#34;file.pdf&#34;) as doc:
    print(doc.page_count)

    # Single page
    text = doc.extract_page(0)

    # All pages (parallel by default)
    all_text = doc.extract_all()

    # Page info
    info = doc.get_page_info(0)
    print(f&#34;{info.width}x{info.height}&#34;)"><pre><span>import</span> <span>zpdf</span>

<span>with</span> <span>zpdf</span>.<span>Document</span>(<span>&#34;file.pdf&#34;</span>) <span>as</span> <span>doc</span>:
    <span>print</span>(<span>doc</span>.<span>page_count</span>)

    <span># Single page</span>
    <span>text</span> <span>=</span> <span>doc</span>.<span>extract_page</span>(<span>0</span>)

    <span># All pages (parallel by default)</span>
    <span>all_text</span> <span>=</span> <span>doc</span>.<span>extract_all</span>()

    <span># Page info</span>
    <span>info</span> <span>=</span> <span>doc</span>.<span>get_page_info</span>(<span>0</span>)
    <span>print</span>(<span>f&#34;<span><span>{</span><span>info</span>.<span>width</span><span>}</span></span>x<span><span>{</span><span>info</span>.<span>height</span><span>}</span></span>&#34;</span>)</pre></div>
<p dir="auto">Build the shared library first:</p>
<div dir="auto" data-snippet-clipboard-copy-content="zig build -Doptimize=ReleaseFast
PYTHONPATH=python python3 examples/basic.py"><pre>zig build -Doptimize=ReleaseFast
PYTHONPATH=python python3 examples/basic.py</pre></div>

<div data-snippet-clipboard-copy-content="src/
├── root.zig         # Document API and core types
├── capi.zig         # C ABI exports for FFI
├── parser.zig       # PDF object parser
├── xref.zig         # XRef table/stream parsing
├── pagetree.zig     # Page tree resolution
├── decompress.zig   # Stream decompression filters
├── encoding.zig     # Font encoding and CMap parsing
├── interpreter.zig  # Content stream interpreter
├── simd.zig         # SIMD string operations
└── main.zig         # CLI

python/zpdf/         # Python bindings (cffi)
examples/            # Usage examples"><pre><code>src/
├── root.zig         # Document API and core types
├── capi.zig         # C ABI exports for FFI
├── parser.zig       # PDF object parser
├── xref.zig         # XRef table/stream parsing
├── pagetree.zig     # Page tree resolution
├── decompress.zig   # Stream decompression filters
├── encoding.zig     # Font encoding and CMap parsing
├── interpreter.zig  # Content stream interpreter
├── simd.zig         # SIMD string operations
└── main.zig         # CLI

python/zpdf/         # Python bindings (cffi)
examples/            # Usage examples
</code></pre></div>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Feature</th>
<th>zpdf</th>
<th>MuPDF</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Text Extraction</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Reading order / layout analysis</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Two-column detection</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Paragraph grouping</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Word/line bounding boxes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Font Support</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>WinAnsi/MacRoman</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>ToUnicode CMap</td>
<td>Partial*</td>
<td>Yes</td>
</tr>
<tr>
<td>CID fonts (Type0)</td>
<td>Partial*</td>
<td>Yes</td>
</tr>
<tr>
<td>Embedded fonts</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Compression</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>FlateDecode, LZW, ASCII85/Hex</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>JBIG2, JPEG2000</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>PDF Features</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Incremental updates</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Encrypted PDFs</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Forms / Annotations</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Rendering</td>
<td>No</td>
<td>Yes</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><em>*ToUnicode/CID fonts: Works when CMap is embedded directly. References to compressed object streams not yet supported (affects some Greek, Chinese, Japanese, Korean PDFs).</em></p>
<p dir="auto"><strong>Use zpdf when:</strong> Speed matters, simple layouts, batch processing raw text.</p>
<p dir="auto"><strong>Use MuPDF when:</strong> Complex layouts, encrypted PDFs, non-Latin scripts.</p>

<p dir="auto">WTFPL</p>
</article></div></div>
  </body>
</html>
