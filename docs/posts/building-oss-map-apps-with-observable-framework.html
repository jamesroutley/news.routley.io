<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mclare.blog/posts/building-oss-map-apps-with-observable-framework">Original</a>
    <h1>Building OSS Map Apps With Observable Framework</h1>
    
    <div id="readability-page-1" class="page"><div><h2 id="motivation"><a href="#motivation" aria-label="motivation permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Motivation</h2>
<p>I‚Äôve been a pretty heavy user of <a href="https://observablehq.com" target="_blank" rel="nofollow noopener noreferrer">Observable</a> since 2021. It was my initial entry point to learning and working with D3, and I still use the notebook interface heavily for prototyping and exploring public datasets. When I saw the announcement for <a href="https://observablehq.com/blog/observable-2-0" target="_blank" rel="nofollow noopener noreferrer">Observable Framework</a>, it seemed like a no brainer that would support a <a href="https://mclare.blog/visuals/ec3epds/" target="_blank" rel="nofollow noopener noreferrer">lot</a> <a href="https://mclare.dev/soft-stories/" target="_blank" rel="nofollow noopener noreferrer">of</a> <a href="https://observablehq.com/@m-clare/sustainable-design-in-communities" target="_blank" rel="nofollow noopener noreferrer">the</a> <a href="https://bridge.watch/" target="_blank" rel="nofollow noopener noreferrer">visualizations</a> I like to build (and help me do so quickly). I‚Äôve been working with open source mapping lately, and I saw in the initial documentation that there was <a href="https://observablehq.com/framework/lib/mapbox-gl" target="_blank" rel="nofollow noopener noreferrer">Mapbox support</a>. I wanted to see how difficult it would be to build maps with Observable Framework using open source libraries (my preferred stack of <a href="https://maplibre.org" target="_blank" rel="nofollow noopener noreferrer">Maplibre</a> and <a href="https://protomaps.com/" target="_blank" rel="nofollow noopener noreferrer">Protomaps</a>), so I prototyped this <a href="https://m-clare.observablehq.cloud/boston-building-retrofits/" target="_blank" rel="nofollow noopener noreferrer">interactive map of potential energy efficient retrofits of Boston buildings</a> over the past few weekends.</p>
<p><span><figure>
    <span>
      <a href="https://umarbutler.com/static/f8579020f78ad917d5feee99622b3366/5f78c/boston-retrofits-example.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/f8579020f78ad917d5feee99622b3366/8ac56/boston-retrofits-example.webp 240w,
/static/f8579020f78ad917d5feee99622b3366/d3be9/boston-retrofits-example.webp 480w,
/static/f8579020f78ad917d5feee99622b3366/e46b2/boston-retrofits-example.webp 960w,
/static/f8579020f78ad917d5feee99622b3366/f992d/boston-retrofits-example.webp 1440w,
/static/f8579020f78ad917d5feee99622b3366/0ace6/boston-retrofits-example.webp 1606w" sizes="(max-width: 960px) 100vw, 960px" type="image/webp"/>
          <source srcset="/static/f8579020f78ad917d5feee99622b3366/8ff5a/boston-retrofits-example.png 240w,
/static/f8579020f78ad917d5feee99622b3366/e85cb/boston-retrofits-example.png 480w,
/static/f8579020f78ad917d5feee99622b3366/d9199/boston-retrofits-example.png 960w,
/static/f8579020f78ad917d5feee99622b3366/07a9c/boston-retrofits-example.png 1440w,
/static/f8579020f78ad917d5feee99622b3366/5f78c/boston-retrofits-example.png 1606w" sizes="(max-width: 960px) 100vw, 960px" type="image/png"/>
          <img src="https://umarbutler.com/static/f8579020f78ad917d5feee99622b3366/d9199/boston-retrofits-example.png" alt="Boston Building Retrofits" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span>
    <figcaption>Boston Building Retrofits</figcaption>
  </figure></span></p><h2 id="dataset-selection"><a href="#dataset-selection" aria-label="dataset selection permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Dataset Selection</h2>
<p>The city of <a href="https://data.boston.gov/" target="_blank" rel="nofollow noopener noreferrer">Boston</a> has a number of great datasets about its buildings, including an aggregated view around its efforts in sustainability and energy efficiency, called the <a href="https://data.boston.gov/dataset/boston-buildings-inventory" target="_blank" rel="nofollow noopener noreferrer">Boston Building Inventory</a>. From the docs:</p>
<blockquote>
<p>‚ÄúThis dataset pulls from many different data sources to identify individual building characteristics of all buildings in Boston. It also identifies high-potential retrofit options to reduce carbon emissions in multifamily buildings, using the best available data and assumptions from building experts.‚Äù</p>
</blockquote>
<p>There are a few different components included with the dataset, including explanations of the potential retrofits, as well as a presentation providing further motivation for the project. I first took a look at the raw data using <a href="https://www.visidata.org/" target="_blank" rel="nofollow noopener noreferrer">Visidata</a> before deciding to focus on mapping a subset of the data, only looking at the envelope retrofit strategies (which I have more familiarity with as a structural engineer).</p>
<h2 id="starting-an-observable-framework-project"><a href="#starting-an-observable-framework-project" aria-label="starting an observable framework project permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Starting an Observable Framework Project</h2>
<p>I started my Observable Framework project with default settings to launch the initial template application (I chose <span><code>npm</code></span> for my package management setup because I have very few opinions on the js package management hellscape). I did appreciate that Observable allows you to opt in on telemetry data given that the Framework library is open source.</p>
<h2 id="data-loaders"><a href="#data-loaders" aria-label="data loaders permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Data Loaders</h2>
<p>The key differentiator for me with Observable Framework vs. other static site generators is the <a href="https://observablehq.com/framework/loaders" target="_blank" rel="nofollow noopener noreferrer">data loader</a> functionality. Most of the datasets that I work with are around building data, which is updated at most once a day (and in some cases, like <a href="https://bridge.watch/?plot_type=percent_poor" target="_blank" rel="nofollow noopener noreferrer">Bridge.watch</a>, only once a year!) The language-agnostic implementation means that I can easily build loaders in whichever programming language I need to (maybe even Rust üòà‚Ä¶), and then make a cron job on my server that would run the loader and deploy the static site once a day. For this visualization, I could just use NodeJS for my loader, but quite often I‚Äôll do data cleaning in Visidata and export the list of commands used within Visidata to generate a Python/Pandas script.</p>
<p>For the Boston Buildings Inventory, I  needed to stitch two data sets together. The retrofit potential data only had parcel numbers, not actual latitudes and longitudes to impose markers on buildings on the map. I utilized the <a href="https://data.boston.gov/dataset/parcels-2022/resource/023f4a54-9a73-492a-8489-3ae0f99dbf92" target="_blank" rel="nofollow noopener noreferrer">parcel map from 2022</a> for Boston with its shapefiles (unfortunately 2023 is not available yet from ARCGis). I wanted to keep the map a bit lighter, so I used the <a href="https://www.npmjs.com/package/polylabel?activeTab=code" target="_blank" rel="nofollow noopener noreferrer">polylabel</a> library to find a ‚Äúcenter‚Äù of a building that was within its boundaries, rather than centroid which could exist outside. I wrote a <a href="https://github.com/m-clare/boston-map/blob/main/docs/data/buildings_data.csv.js" target="_blank" rel="nofollow noopener noreferrer">loader script</a> that  zipped the parcel lat/long data together with the subset of fields I wanted from the buildings data set, and output the new dataset as a zip file. Also, don‚Äôt be like me and <a href="https://observablehq.com/framework/routing" target="_blank" rel="nofollow noopener noreferrer">read the docs</a> that say that the loader file name needs to match the <span><code>FileAttachment</code></span> name you put into your components or Markdown doc.</p>
<h2 id="the-markdown-file"><a href="#the-markdown-file" aria-label="the markdown file permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>The Markdown File</h2>
<p>Within <span><code>index.md</code></span>, I ran afoul of some async commands and had to split my javascript across a few cells. I‚Äôd like to go back and figure out exactly what triggered the bad behavior, or if it‚Äôs more of a hot reloading symptom/issue because of the map. The aforementioned issue with the loader file name did introduce some questions about what you‚Äôd do if your data loader needed to have multiple output files. As far as I could tell, you would need to have a single output zipped archive and then unpack each individual file with <span><code>${unzipped_object}.file(${filename}).csv()</code></span>. Because I had zipped the loader data as a csv to make it lighter than JSON or GeoJSON, I needed to handle transformation to GeoJSON client side and load it as a data source within my map.</p>
<p><span><div data-language="js"><pre><code><span>const</span> geoBuildingData <span>=</span> <span>{</span>
  <span>type</span><span>:</span> <span>&#34;FeatureCollection&#34;</span><span>,</span>
  <span>name</span><span>:</span> <span>&#34;geoBuildings&#34;</span><span>,</span>
  <span>crs</span><span>:</span> <span>{</span> <span>type</span><span>:</span> <span>&#34;name&#34;</span><span>,</span> <span>properties</span><span>:</span> <span>{</span> <span>name</span><span>:</span> <span>&#34;urn:ogc:def:crs:OGC:1.3:CRS84&#34;</span> <span>}</span> <span>}</span><span>,</span>
  <span>features</span><span>:</span> <span>[</span><span>]</span><span>,</span>
<span>}</span><span>;</span>

<span>const</span> bldData <span>=</span> <span>await</span> buildingData<span>.</span><span>file</span><span>(</span><span>&#34;buildings_data.csv&#34;</span><span>)</span><span>.</span><span>csv</span><span>(</span><span>)</span><span>;</span>

<span>const</span> buildingTypologies <span>=</span> <span>new</span> <span>Set</span><span>(</span>
  bldData<span>.</span><span>map</span><span>(</span><span>(</span><span>feature</span><span>)</span> <span>=&gt;</span> feature<span>.</span>building_typology<span>)</span>
<span>)</span><span>;</span>

bldData<span>.</span><span>map</span><span>(</span><span>(</span><span>feature</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>{</span> <span>point</span><span>:</span> rawPoint<span>,</span> <span>...</span>rest <span>}</span> <span>=</span> feature<span>;</span>
  <span>const</span> point <span>=</span> rawPoint<span>.</span><span>split</span><span>(</span><span>&#34;,&#34;</span><span>)</span><span>.</span><span>map</span><span>(</span><span>(</span><span>value</span><span>)</span> <span>=&gt;</span> <span>parseFloat</span><span>(</span>value<span>)</span><span>)</span><span>;</span>
  geoBuildingData<span>.</span>features<span>.</span><span>push</span><span>(</span><span>{</span>
    <span>type</span><span>:</span> <span>&#34;Feature&#34;</span><span>,</span>
    <span>properties</span><span>:</span> <span>{</span> <span>...</span>rest <span>}</span><span>,</span>
    <span>geometry</span><span>:</span> <span>{</span> <span>type</span><span>:</span> <span>&#34;Point&#34;</span><span>,</span> <span>coordinates</span><span>:</span> point <span>}</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

<span>...</span>

map<span>.</span><span>on</span><span>(</span><span>&#34;load&#34;</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  map<span>.</span><span>addSource</span><span>(</span><span>&#34;bld-data&#34;</span><span>,</span> <span>{</span>
    <span>type</span><span>:</span> <span>&#34;geojson&#34;</span><span>,</span>
    <span>data</span><span>:</span> geoBuildingData<span>,</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span>
</code></pre></div></span></p><p>I also got <em>real</em> sloppy with some CSS to try and recreate the look and feel of some of the <a href="https://mclare.dev/nyc-building-complaints/" target="_blank" rel="nofollow noopener noreferrer">other</a> <a href="https://mclare.dev/soft-stories/" target="_blank" rel="nofollow noopener noreferrer">maps</a> I‚Äôve built. It was a bit painful to figure out what to target and how to override the styles. I know that when you create an Observable Framework project, you can select a style, but I do wish it was a bit easier to customize after that first step.</p>
<p>For this prototype I used project hosting with Observable because I wanted to see what the deploy process would look like. It was easy! The only hiccup I ran into was that I couldn‚Äôt figure out how to set access to the map as public once I had deployed (it defaulted to private), but it turns out a newer version of Observable Framework allows you to set the project up as public when you‚Äôre initially configuring the project from the CLI. The Observable team is also responsive, so I had an answer on the <a href="https://talk.observablehq.com/t/no-option-for-public-access-provided-upon-deploy/8950/2" target="_blank" rel="nofollow noopener noreferrer">forum</a> less than two hours after I asked!</p>
<p><img src="https://umarbutler.com/static/bldg-map-36c8b4852005f351fd1b98c221cd9b6c.gif" alt="Boston Building Inventory Map"/></p>
<p><a href="https://m-clare.observablehq.cloud/boston-building-retrofits/" target="_blank" rel="nofollow noopener noreferrer">Boston Building Retrofits</a></p>
<p><a href="https://github.com/m-clare/boston-map" target="_blank" rel="nofollow noopener noreferrer">Github</a></p>
<h2 id="things-this-prototype-is-not"><a href="#things-this-prototype-is-not" aria-label="things this prototype is not permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Things This Prototype is Not</h2>
<ul>
<li>optimized for performance - in a world where I have an infinite amount of time for side projects, I‚Äôd build my loader to directly make map tiles based on the building data layer.</li>
<li>the cleanest code - I could probably separate out all the map data into a component. Maybe I will do that later (I took a stab at it and had some issues with the Runtime library)</li>
<li>optimized for mobile - I didn‚Äôt extend zoom levels far enough for the basemap (only to level 15) to be able to use fat fingers to select individual markers easily.</li>
<li>bug-free - The heads up display seems to duplicate or come in the wrong order on some devices/browsers so it becomes difficult to read the text (#worksonmymachine)</li>
</ul>
<h2 id="takeaways"><a href="#takeaways" aria-label="takeaways permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Takeaways</h2>
<p>I could definitely see myself moving away from <a href="https://www.gatsbyjs.com/" target="_blank" rel="nofollow noopener noreferrer">Gatsby</a> (which is what I currently use for this blog) and rewriting using Observable Framework. I‚Äôm currently working off of a custom fork of my <a href="https://github.com/alxshelepenok/gatsby-starter-lumen" target="_blank" rel="nofollow noopener noreferrer">Gatsby theme</a> to support mdx specifically because I want to be able to load in React components and visualizations both from Observable notebooks, as well as local components. I break things a lot with Gatsby, and more often than not, I get some new whack-a-mole issue with GraphQL when I <span><code>gatsby develop</code></span> a new blog post after a few months. I think Observable Framework might make this easier for me to do, but I‚Äôd have to give some thought as to how to change over the existing work which utilizes React to manage some state for the interactive visuals (but even in some of those cases, I was using Observable‚Äôs  cell takeout so it seems like that shouldn‚Äôt be too onerous).</p>
<p>The original plan for this project was to also include marker filters via a select input based on the building type (which is currently used to color code markers). However, I couldn‚Äôt figure out how to pass an event handler to the <a href="https://observablehq.com/framework/inputs/select" target="_blank" rel="nofollow noopener noreferrer">Observable Input</a> that would update the map. I know how to do this in React using <span><code>useRef</code></span> hooks for libraries that require manipulating the canvas (ThreeJs, Maplibre-GL-JS), but outside of working directly with <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Input" target="_blank" rel="nofollow noopener noreferrer">html inputs</a>, I didn‚Äôt know how to accomplish this with Observable components (wrestling with styling raw HTML inputs is not how I want to spend my free time). I created a div in the markdown file and then used that as the container for the map, but I couldn‚Äôt access that reference in a different <span><code>js</code></span> cell. I also had to host my map font files elsewhere, rather than in the same location as the <span><code>pmtiles</code></span> file.</p>
<p><span><div data-language="js"><pre><code><span>const</span> features <span>=</span> <span>display</span><span>(</span>document<span>.</span><span>createElement</span><span>(</span><span>&#34;div&#34;</span><span>)</span><span>)</span><span>;</span>
features<span>.</span>id <span>=</span> <span>&#34;features&#34;</span><span>;</span>
features<span>.</span>style <span>=</span> <span>&#34;z-index: 100&#34;</span><span>;</span>
<span>const</span> mapContainer <span>=</span> <span>display</span><span>(</span>document<span>.</span><span>getElementById</span><span>(</span><span>&#34;mapContainer&#34;</span><span>)</span><span>)</span><span>;</span>
mapContainer<span>.</span><span>appendChild</span><span>(</span>features<span>)</span><span>;</span>

<span>const</span> div <span>=</span> <span>display</span><span>(</span>document<span>.</span><span>getElementById</span><span>(</span><span>&#34;mapContainer&#34;</span><span>)</span><span>)</span><span>;</span>
<span>const</span> windowHeight <span>=</span> window<span>.</span>innerHeight<span>;</span>
<span>const</span> windowWidth <span>=</span> window<span>.</span>innerWidth<span>;</span>
div<span>.</span>style <span>=</span> <span><span>`</span><span>position: relative; height: </span><span><span>${</span>windowHeight <span>-</span> <span>50</span><span>}</span></span><span>px; width: 100%</span><span>`</span></span><span>;</span>
<span>const</span> map <span>=</span> <span>new</span> <span>maplibregl<span>.</span>Map</span><span>(</span><span>{</span>
  <span>container</span><span>:</span> div<span>,</span>
  <span>zoom</span><span>:</span> <span>12</span><span>,</span>
  <span>maxZoom</span><span>:</span> <span>14</span><span>,</span>
  <span>minZoom</span><span>:</span> <span>10</span><span>,</span>
  <span>maxBounds</span><span>:</span> <span>[</span>
    <span>[</span><span>-</span><span>71.191247</span><span>,</span> <span>42.227911</span><span>]</span><span>,</span>
    <span>[</span><span>-</span><span>70.648072</span><span>,</span> <span>42.450118</span><span>]</span><span>,</span>
  <span>]</span><span>,</span>
  <span>center</span><span>:</span> <span>[</span><span>-</span><span>71.08936258403622</span><span>,</span> <span>42.3181973483706</span><span>]</span><span>,</span>
  <span>style</span><span>:</span> <span>{</span>
    <span>version</span><span>:</span> <span>8</span><span>,</span>
    <span>sources</span><span>:</span> <span>{</span>
      <span>openmaptiles</span><span>:</span> <span>{</span>
        <span>type</span><span>:</span> <span>&#34;vector&#34;</span><span>,</span>
        <span>tiles</span><span>:</span> <span>[</span><span>&#34;pmtiles://&#34;</span> <span>+</span> mapFile<span>.</span>source<span>.</span><span>getKey</span><span>(</span><span>)</span> <span>+</span> <span>&#34;/{z}/{x}/{y}&#34;</span><span>]</span><span>,</span>
      <span>}</span><span>,</span>
    <span>}</span><span>,</span>
    <span>layers</span><span>:</span> mapStyle<span>.</span>layers<span>,</span>
    <span>glyphs</span><span>:</span>
      <span>&#34;https://m-clare.github.io/map-glyphs/fonts/{fontstack}/{range}.pbf&#34;</span><span>,</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span><span>;</span></code></pre></div></span></p><p>Outside of these issues, this was a pretty fun way to test some of the edges of Observable Framework. Next steps will be testing out self-hosting with Digital Ocean, trying to refactor the map into its own reuseable component, and (maybe) mucking around with inputs again.</p>
<h2 id="acknowledgements"><a href="#acknowledgements" aria-label="acknowledgements permalink"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a>Acknowledgements</h2>
<p>Thanks to Brandon Liu, the creator of <a href="https://protomaps.com/" target="_blank" rel="nofollow noopener noreferrer">Protomaps</a> for quickly troubleshooting the initial issues with loading <span><code>pmtiles</code></span>, and creating a <a href="https://bdon.github.io/observable-framework-maps/example-map#interaction%3A-maplibre-gl-js" target="_blank" rel="nofollow noopener noreferrer">sample map example</a> which I used to develop this project.</p></div></div>
  </body>
</html>
