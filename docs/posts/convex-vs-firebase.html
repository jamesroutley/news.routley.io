<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://docs.convex.dev/understanding/convex-vs-firebase">Original</a>
    <h1>Convex vs. Firebase</h1>
    
    <div id="readability-page-1" class="page"><div><header></header><p>Convex and Google&#39;s Cloud Firestore are both platforms for managing global state
in modern serverless applications. Both platforms store documents and notify
applications of document changes in realtime without requiring application
developers to manage their own infrastructure.</p><p>At Convex we have a lot of respect for Firebase. We&#39;re building this product
because we also believe that developers deserve a comprehensive platform for
global state management. Firebase was one of the first teams to work on this
problem and has done a lot of innovation in this space.</p><p>That being said, there are some important differences between the two platforms:</p><ul><li>Backend API</li><li>React Integration</li><li>End-to-End Correctness Philosophy</li></ul><div><p><h5><span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></p><p>&#34;Firebase&#34; actually refers to two separate products: Firebase Realtime Database
and Cloud Firestore. This discussion focuses on Cloud Firestore because it&#39;s the
newer, more scalable Firebase offering.</p></div><h2 id="backend-api-documents-or-functions">Backend API: Documents or Functions?<a href="#backend-api-documents-or-functions" title="Direct link to heading">​</a></h2><p>The biggest architectural difference between Convex and Cloud Firestore is <strong>how
your application interacts with its data.</strong></p><p>With Cloud Firestore, the client interacts with its data by loading documents
straight from the database. If you&#39;re building a chat application and you store
users and messages in Cloud Firestore, your application code will also interact
with those same user and message documents.</p><p>In Convex, all access to documents is mediated through
<a href="https://docs.convex.dev/understanding/convex-fundamentals/functions">Convex functions</a>. These functions can
return documents straight from the database, but also can return data derived
from these documents.</p><p>Having this additional layer on the server is important for 2 reasons:</p><ol><li>Avoiding serial request waterfalls.</li><li>Encapsulating business logic.</li></ol><h3 id="avoiding-serial-request-waterfalls">Avoiding Serial Request Waterfalls<a href="#avoiding-serial-request-waterfalls" title="Direct link to heading">​</a></h3><p><em>Serial request waterfalls</em> happen when an application uses multiple, serial
requests to load its data. This harms page load performance because rendering
your site will now require multiple network round trips to the backend, one
after another, to render the core content.</p><p>With Cloud Firestore, a chat app might do one query from the client to load the
messages in the app and then a subsequent query for each message to load the
user that wrote it:</p><div><div><pre tabindex="0"><code><span><span></span><br/></span><span><span></span><span></span><br/></span><span><span></span><span>const</span><span> querySnapshot </span><span>=</span><span> </span><span>await</span><span> </span><span>getDocs</span><span>(</span><span>collection</span><span>(</span><span>db</span><span>,</span><span> </span><span>&#34;messages&#34;</span><span>)</span><span>)</span><span>;</span><span></span><br/></span><span><span></span><span>const</span><span> userSnapshots </span><span>=</span><span> </span><span>await</span><span> </span><span>Promise</span><span>.</span><span>all</span><span>(</span><span></span><br/></span><span><span>  querySnapshot</span><span>.</span><span>docs</span><span>(</span><span>)</span><span>.</span><span>map</span><span>(</span><span>async</span><span> messageSnapshot </span><span>=&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>    </span><span>return</span><span> </span><span>await</span><span> </span><span>getDoc</span><span>(</span><span>docSnapshot</span><span>.</span><span>data</span><span>(</span><span>)</span><span>.</span><span>creator</span><span>)</span><span>;</span><span></span><br/></span><span><span>  </span><span>}</span><span>)</span><span></span><br/></span><span><span></span><span>)</span><span>;</span><br/></span></code></pre></div></div><p>The key thing to notice here is <strong>this is happening client-side</strong>. This code is
doing serial queries to load data over the user&#39;s slow network connection. In a
complex application, you will end up with many round trips and a slow,
multi-step loading experience.</p><p>Even if you model your Cloud Firestore data using subcollections (which require
your data to be hierarchical) you still can&#39;t do a deep query to load a document
and its subcollection documents.</p><p>In Convex you have full control over the data you send the client because it&#39;s
just the result of JavaScript/TypeScript functions. It&#39;s easy to bundle the
messages in a chat app along with the author that wrote each one. Our
<a href="https://docs.convex.dev/understanding/getting-started/basics/users-and-auth">Users and Auth tutorial</a> does exactly
that!</p><div><div><pre tabindex="0"><code><span><span></span><br/></span><span><span></span><span></span><br/></span><span><span></span><span>const</span><span> messages </span><span>=</span><span> </span><span>useQuery</span><span>(</span><span>&#34;listMessages&#34;</span><span>)</span><span>;</span><br/></span></code></pre></div></div><p>Here the messages and users are all being loaded on the server inside of the
<code>listMessages.js</code> query function so there is only a single round trip from the
client.</p><p>In Cloud Firestore the only option to avoid request waterfalls is to load your
data in a Cloud Function but that involves sacrificing reactivity and optimistic
updates.</p><h3 id="encapsulating-business-logic">Encapsulating Business Logic<a href="#encapsulating-business-logic" title="Direct link to heading">​</a></h3><p>Another important feature of Convex functions is that they can serve as a
business logic layer. While sending raw documents to the client can be a great
way to get started on an app, as your app grows in complexity you&#39;ll want to put
logic on the server. Here are a few common examples of where server-side logic
is necessary:</p><ul><li>Your mobile, web apps, and public API all need to share common logic like
rendering notifications into a human-readable string.</li><li>Some mutations require custom validation like checking that an email address
is formatted correctly.</li><li>You want to change your database schema to support more complex queries but
want to present the same API to your apps to avoid migrating application code
as well.</li></ul><p>Convex functions serve as a natural place to put all of this logic. As a
developer, you can share logic between all of your platforms and ensure that
even malicious users only interact with your data through this layer.</p><p>Once again, with Cloud Firestore you <em>could</em> put this code into Cloud Functions
and use them as a business logic layer, but it&#39;s messy and requires giving up
some of the platform&#39;s other features like reactivity and optimistic updates.</p><h2 id="react-integration">React Integration<a href="#react-integration" title="Direct link to heading">​</a></h2><p><strong>Convex was designed to be used with React.</strong></p><p>All of our <a href="https://docs.convex.dev/getting-started/hello-convex">tutorials</a> are React apps. Our
<a href="https://docs.convex.dev/generated-api/react#react-hooks">React Hooks</a> make it dead simple to load and
edit data within React components.</p><p><strong>Cloud Firestore was not designed with React in mind.</strong></p><p>Cloud Firestore has a JavaScript SDK, but it leaves getting your data into your
React components up to the developer. In particular, Cloud Firestore supports
listening for realtime updates with <code>onSnapshot</code> but correctly binding those
snapshots to React components is complex enough that many developers give up on
end-to-end reactivity.</p><h2 id="end-to-end-correctness-philosophy">End-to-End Correctness Philosophy<a href="#end-to-end-correctness-philosophy" title="Direct link to heading">​</a></h2><p>Convex has an almost fanatical obsession with correctness.</p><p>We don&#39;t just want it to be possible to build a correct app but we want it to be
impossible not to build your app correctly. Developers should
<a href="https://blog.codinghorror.com/falling-into-the-pit-of-success/" target="_blank" rel="noopener noreferrer">fall into the pit of success</a>.</p><p>Correctness doesn&#39;t stop at the backend API. At Convex we believe correctness
should extend all the way to the users of the application. Users should always
see consistent, up-to-date state. When users modify state, their modifications
should always occur transactionally and exactly once.</p><p>Here are a few places where our philosophy around correctness differs from Cloud
Firestore&#39;s:</p><h3 id="reactivity">Reactivity<a href="#reactivity" title="Direct link to heading">​</a></h3><p>In the <a href="https://docs.convex.dev/api/classes/react.ConvexReactClient"><code>ConvexReactClient</code></a>, all queries
are
<a href="https://docs.convex.dev/understanding/convex-fundamentals/client-libraries#reactivity">fully reactive</a>
and receive realtime updates.</p><p>In Cloud Firestore, you <em>can</em> receive realtime updates but it&#39;s extra work to
manage the <code>onUpdate</code> callbacks (especially in React) so developers normally
choose whether they want to load reactive or non-reactive data on a case-by-case
basis. This leads to applications that show users a mix of fresh and stale data.</p><h3 id="transactions">Transactions<a href="#transactions" title="Direct link to heading">​</a></h3><p>In Convex, every mutation is a
<a href="https://docs.convex.dev/understanding/convex-fundamentals/functions#transactions">transaction</a> running
on a consistent database snapshot.</p><p>In Cloud Firestore, you <em>can</em> run transactions but they have complex
requirements. All of the reads in a transaction must proceed all of the writes
and you must always remember not to edit application state in the transaction.
Often developers instead opt to use the simpler APIs to update documents and are
surprised down the road when one logical user action was only partially saved to
the database.</p><h3 id="consistent-views">Consistent Views<a href="#consistent-views" title="Direct link to heading">​</a></h3><p>In Convex, all of the data loaded with <code>useQuery</code> are from a
<a href="https://docs.convex.dev/understanding/convex-fundamentals/client-libraries#consistent-views">consistent database snapshot</a>.</p><p>In Cloud Firestore, the data on the client are loaded from the database at
different points in time. Even if you listen for realtime updates, results from
separate queries will not remain in sync. This creates consistency anomalies and
bugs in your app.</p><h2 id="bottom-line">Bottom Line<a href="#bottom-line" title="Direct link to heading">​</a></h2><p>Convex is designed to both make it easy to get started on the platform and
support you as your app grows.</p><p>Our React integration makes it a breeze to start interacting with your global
shared state and loading fully reactive data. As your app grows, you&#39;ll
appreciate the ability to push logic into query and mutation functions and keep
your app fast by avoiding serial request waterfalls.</p><p>On Cloud Firestore, you&#39;ll have to do some acrobatics to integrate with React
and listen for realtime updates. Down the road, you&#39;ll find your app full of
slow loading experiences from request waterfalls and your database full of
half-committed mutations.</p><p>Convex is designed to help you evolve your application as it grows, not to push
you onto another platform. Soon we&#39;ll be adding support for enforcing
<a href="https://docs.convex.dev/understanding/deep-dive/schema-philosophy">database schemas</a> and running
<a href="https://docs.convex.dev/understanding/beta-state#schema-enforcement-and-migrations">database migrations</a>
so that you&#39;ll be able to seamlessly grow your app on Convex.</p><p>What are you waiting for?
<a href="https://docs.convex.dev/getting-started/hello-convex">Get started with Convex!</a></p></div></div>
  </body>
</html>
