<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://hypodyne.net/tunnels-within-tunnels/">Original</a>
    <h1>Tunnels Within Tunnels: One Weird Trick for Free IP Transit</h1>
    
    <div id="readability-page-1" class="page"><div><p>Imagine you took your homelab hobby to the next level by acquiring an ASN. You don&#39;t have much money, but you&#39;ve still managed to connect to an IXP and peer with other ASs over the exchange fabric. You&#39;d like to connect your network back to sites scattered across a metro region, often with only consumer internet connections because other types of service are too expensive.</p><p>You may want to network the sites together and may also want the sites&#39; internet-bound traffic to exit through your own AS (there are a number of reasons you might want to do this --see the last section). Hence, you decide to set up VPN tunnels between your sites and your network equipment at the IXP.</p><p>Unfortunately, the large regional ISPs servicing your sites will not peer with you because you are small fry, so the tunneled traffic doesn&#39;t reach your router at the IXP via settlement-free peering relationships, instead it goes through a paid <a href="https://www.thousandeyes.com/learning/techtorials/transit-provider" rel="noopener" target="_blank">upstream transit provider</a>. You don&#39;t want to double the traffic through your transit provider because it&#39;s expensive and limited. Is there a solution?</p><p>Recently, while tinkering with VPN tunnels with other volunteers from the <a href="https://seattlecommunitynetwork.org" rel="noopener" target="_blank">Seattle Community Network</a> (eg. <a href="https://johnelliott.org/" rel="noopener" target="_blank">John Elliott</a>), I had a sudden flash of inspiration. An <em>absurd</em> idea emerges...</p><h2 id="enter-the-hurricane-electric-free-ipv6-tunnel-broker">Enter the Hurricane Electric Free IPv6 Tunnel Broker</h2><p><a href="https://tunnelbroker.net/" rel="noopener" target="_blank">The Hurricane Electric Free IPv6 Tunnel Broker</a> is a free service that HE provides out of the goodness of their hearts. If your ISP&#39;s IPv6 service is sub-par or nonexistent, no problem! HE will generously lend you a /64 IPv6 address block and provide you with a tunnel endpoint where you can send IPv6 using RFC-compliant 6to4 technology!</p><p>For costing nothing, this IPv6 service is <em>amazing</em>. Here in Seattle on a Centurylink connection, HE&#39;s tunnel broker generally outperforms Centurylink&#39;s own 6rd service, and unlike 6rd, the HE IPv6 block is static, making it far more useful for running servers at home.</p><p>Besides providing free IPv6 forwarding, Hurricane Electric also freely peers with other networks at exchange points. <a href="https://bgp.he.net/AS54429#_peers6" rel="noopener" target="_blank">They even peered with our network at the SIX!</a></p><p><strong>In other words, HE&#39;s network is directly connected to ours and traffic passes between our networks free of charge.</strong></p><p><strong>Simultaneously, anyone using HE&#39;s free IPv6 tunnel broker on their home connection also has a zero-cost connection into HE&#39;s network.</strong></p><p>Hmm... What if we could take advantage of these two facts and use HE&#39;s network to avoid the upstream transit provider?</p><p>It turns out <em>yes, this does work and the performance is much better than any of us expected.</em></p><p><em><strong>A disclaimer: Should you do this with for real, beyond a few experiments? Probably not. This could be an abuse of HE&#39;s generosity and ToS, for starters. There are also some details about why this is kind of iffy. But we had to see whether it worked and how badly, if it did.</strong></em></p><p>Read on...</p><h2 id="the-initial-configuration-via-paid-upstream-transit-provider">The Initial Configuration (via Paid Upstream Transit Provider)</h2><p>Our tunneling config is pretty straightforward. We&#39;re planning to run a VPN tunnel endpoint on one of our servers at the IXP. Internet-bound traffic will be NATted with an address from our public IPv4 block.</p><p>At the remote sites, the routers will connect to the VPN endpoint at the IXP. Internet-bound user traffic will sent via the tunnel, unless the tunnel is down because we messed something up, in which case traffic bypasses the tunnel and directly egresses via the consumer ISP connection as a fail-over.</p><p>We&#39;re using <a href="https://www.wireguard.com/" rel="noopener" target="_blank">WireGuard</a> for these tunnels. So far WireGuard has been simple to configure (though there are a few quirks), fast, and ...fast. MikroTik&#39;s RouterOS 7, released in the last year, supports WireGuard, allowing us to finally use it on our MikroTik hardware. Other volunteers, <a href="https://johnelliott.org/" rel="noopener" target="_blank">John Elliott</a> and <a href="https://homes.cs.washington.edu/~infrared/" rel="noopener" target="_blank">Esther Jang</a>, did the bulk of the work figuring out the WireGuard and firewall configurations.</p><p>Recently, John used iperf to achieve a respectable 860 Mbps over the tunnel between his home 940 Mbps GPON connection to the VPN server.</p><p>These are two traceroutes from different consumer ISPs showing that the path taken includes a hop through an upstream transit provider (AS1299):</p><pre><code><span>$ mtr -w -r -z -c 5 23.146.168.1
</span><span>HOST: foo                                        Loss%   Snt   Last   Avg  Best  Wrst StDev
</span><span>1. AS???    rb5000.home.arpa                      0.0%     5    2.1   1.0   0.7   2.1   0.6
</span><span>2. AS209    tukw-dsl-gw69.tukw.qwest.net          0.0%     5    3.2   3.0   2.9   3.2   0.2
</span><span>3. AS209    63-226-198-33.tukw.qwest.net          0.0%     5    3.0   3.3   2.1   5.1   1.1
</span><span>4. AS???    ???                                  100.0     5    0.0   0.0   0.0   0.0   0.0
</span><span>5. AS3356   4.69.219.210                          0.0%     5    3.5   3.6   3.3   3.9   0.3
</span><span>6. AS1299   sea-b1-link.ip.twelve99.net           0.0%     5    3.5   3.8   3.5   4.3   0.3
</span><span>7. AS1299   doof-ic-375811.ip.twelve99-cust.net   0.0%     5    3.5   3.4   3.1   3.6   0.2
</span><span>8. AS54429  seattlecommunitynetwork.org           0.0%     5    3.8   3.6   3.5   3.8   0.1
</span></code></pre><p><em>A traceroute from a Centurylink residential connection to our router at the SIX transits 1299.</em></p><pre><code><span>$ mtr -w -r -z -c 5 23.146.168.1
</span><span>HOST: bar                                                       Loss%   Snt   Last   Avg  Best  Wrst StDev
</span><span>  1. AS???    router.asus.com                                    0.0%     5    1.2   3.2   1.2   9.2   3.4
</span><span>  2. AS???    100.92.123.67                                      0.0%     5    8.9  11.6   8.9  16.6   3.0
</span><span>  3. AS7922   po-323-406-rur302.seattle.wa.seattle.comcast.net   0.0%     5   13.1  11.8   9.6  14.1   2.0
</span><span>  4. AS7922   po-300-xar02.seattle.wa.seattle.comcast.net        0.0%     5    9.9  11.4   8.6  15.4   2.6
</span><span>  5. AS7922   be-304-arsc1.seattle.wa.seattle.comcast.net        0.0%     5    9.7  17.4   9.7  29.9   7.8
</span><span>  6. AS7922   be-36131-cs03.seattle.wa.ibone.comcast.net         0.0%     5   10.2  15.0  10.2  31.1   9.0
</span><span>  7. AS7922   be-2313-pe13.seattle.wa.ibone.comcast.net          0.0%     5   12.5  10.9  10.1  12.5   1.0
</span><span>  8. AS7922   50.208.233.194                                    40.0%     5   32.0  25.1  20.8  32.0   6.0
</span><span>  9. AS???    ???                                               100.0     5    0.0   0.0   0.0   0.0   0.0
</span><span> 10. AS1299   doof-ic-375811.ip.twelve99-cust.net                0.0%     5   15.1  14.7  10.4  25.1   6.1
</span><span> 11. AS54429  seattlecommunitynetwork.org                        0.0%     5    9.8  15.2   9.8  35.5  11.3
</span></code></pre><p><em>A traceroute from a Comcast residential connection to our router at the SIX hops through 1299 too.</em></p><p>This cutesy diagram shows roughly the same information as the traceroutes but with a larger font and some arrows.</p><p><svg viewBox="0 0 673.857 278.463" xmlns="http://www.w3.org/2000/svg"><defs></defs><path d="M73.8 118.797c9.26-.51 19.96 3.72 28.59 8.64 8.63 4.91 17.87 12.65 23.18 20.85 5.31 8.2 7.99 18.78 8.68 28.35.68 9.57-.85 20.3-4.59 29.05-3.73 8.76-10.43 17.45-17.84 23.47s-17.28 10.54-26.63 12.66c-9.35 2.12-20.16 2.58-29.47.05-9.31-2.53-19.49-8.52-26.37-15.23-6.89-6.7-11.75-16.03-14.95-24.99-3.2-8.97-5.5-19.27-4.26-28.81 1.25-9.54 5.97-20.66 11.73-28.43 5.76-7.76 13.61-14.04 22.83-18.14 9.22-4.1 26.54-5.57 32.47-6.44 5.93-.87 3.01.18 3.09 1.21m-24.04-.03c8.44-3.15 20.65-2.37 30.32.01 9.67 2.37 20.52 8.03 27.72 14.25 7.2 6.22 12.16 14.11 15.5 23.07 3.33 8.96 5.4 20.99 4.49 30.69-.92 9.71-4.68 19.55-9.97 27.56-5.28 8.02-13.17 16.13-21.76 20.53-8.58 4.39-19.89 6.08-29.75 5.83s-20.83-3.02-29.41-7.34c-8.57-4.31-16.38-10.82-22.07-18.55-5.68-7.73-11-18.14-12.06-27.84-1.05-9.69 2.04-21.48 5.75-30.34s9.57-16.41 16.52-22.8c6.96-6.39 20.9-13.24 25.21-15.53 4.31-2.29.25.79.67 1.81" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(36.06 146.556)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="36.225">user</text><text transform="translate(36.06 146.556)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="36.225" y="35">site</text><path d="M230.068 20.527c10.56 2.37 21.68 9.38 29.74 15.7 8.07 6.33 15.32 14.25 18.66 22.26 3.34 8 3.33 17.16 1.36 25.76-1.96 8.59-6.64 18.49-13.14 25.81-6.5 7.32-15.82 13.69-25.83 18.09-10.01 4.4-22.7 7.6-34.23 8.32-11.52.72-24.44-.67-34.92-4.01s-20.16-9.69-27.94-16.01c-7.78-6.32-15.28-13.68-18.71-21.89-3.44-8.22-3.44-18.83-1.92-27.42 1.52-8.59 4.78-17.17 11.04-24.13 6.26-6.97 16.54-13.14 26.54-17.64 9.99-4.5 20.67-9.16 33.43-9.38 12.76-.22 34.82 6.09 43.13 8.07 8.31 1.98 7.13 3.02 6.75 3.8m-41.58-12.36c10.96-.74 24.68 3.52 35.16 7.76 10.47 4.25 20.82 11.04 27.68 17.71 6.86 6.67 11.21 14.03 13.47 22.3 2.27 8.27 3.04 18.7.13 27.33-2.91 8.62-10.43 17.82-17.58 24.43-7.16 6.61-15.31 11.83-25.34 15.22-10.02 3.4-22.97 5.27-34.81 5.16-11.84-.11-25.43-1.91-36.23-5.8-10.81-3.89-21.56-10.56-28.6-17.53-7.04-6.96-11.6-15.72-13.63-24.27-2.04-8.55-1.55-18.89 1.42-27.04 2.96-8.15 9.19-15.23 16.35-21.87 7.15-6.64 16.19-14.21 26.57-17.97 10.38-3.75 29.66-4.15 35.71-4.54 6.05-.39.38 1.25.57 2.2" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(151.411 38.99)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="20" style="white-space:pre" text-anchor="middle" x="49.833">centurylink</text><text transform="translate(151.411 38.99)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="20" style="white-space:pre" text-anchor="middle" x="49.833" y="25">or</text><text transform="translate(151.411 38.99)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="20" style="white-space:pre" text-anchor="middle" x="49.833" y="50">something</text><path d="M355.099 140.623c11.58 2.25 24.68 10.23 33.61 16.86 8.93 6.63 15.76 14.51 19.98 22.93 4.23 8.42 6.81 18.44 5.38 27.59-1.43 9.16-7.01 19.64-13.94 27.33-6.93 7.69-16.71 14.22-27.64 18.81-10.92 4.59-25.23 8-37.92 8.74-12.68.75-26.27-1.18-38.19-4.26-11.93-3.09-24.49-7.83-33.38-14.26-8.88-6.43-15.99-15.75-19.93-24.32-3.94-8.56-5.19-18.05-3.7-27.05 1.48-9.01 5.82-19.39 12.6-26.99 6.79-7.61 17.36-14.12 28.1-18.64 10.73-4.52 21.49-8.31 36.31-8.49 14.82-.18 42.09 5.11 52.6 7.43 10.5 2.32 11.21 5.78 10.44 6.49m-15.4-9.96c11.82 2.62 24.05 10.89 31.85 18.1 7.8 7.21 12.12 16.08 14.95 25.17 2.84 9.08 4.69 20.48 2.06 29.34-2.63 8.85-9.84 16.87-17.86 23.79-8.02 6.91-18.94 13.73-30.26 17.7-11.32 3.98-24.86 6.16-37.66 6.15-12.81-.01-27.51-2.24-39.17-6.2-11.67-3.96-22.77-10.73-30.83-17.56-8.06-6.83-14.97-14.67-17.53-23.43-2.56-8.76-.81-19.93 2.18-29.12 2.98-9.19 8.08-19.06 15.71-26.02 7.64-6.95 18.48-11.95 30.09-15.71 11.61-3.76 26.6-6.73 39.56-6.85 12.95-.13 32.17 5.08 38.17 6.11 6 1.04-1.57-.87-2.17.1" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(271.369 165.563)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="54.75">as1299</text><text transform="translate(271.369 165.563)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="54.75" y="35">(arelion)</text><path d="M504.542 12.46c13.52.86 27.44 4.55 38.95 9.22 11.51 4.67 22.42 11.85 30.13 18.83 7.71 6.98 13.57 15.17 16.12 23.05 2.55 7.88 2.48 16.32-.81 24.21-3.29 7.89-10.53 16.42-18.94 23.13-8.42 6.72-19.42 12.95-31.56 17.15-12.14 4.2-27.33 6.71-41.27 8.05-13.94 1.34-28.81 1.78-42.37-.03-13.56-1.81-27.28-5.99-38.99-10.81-11.72-4.83-23.55-11.43-31.29-18.12-7.75-6.69-12.95-14.17-15.2-22.03-2.26-7.87-1.68-17.19 1.67-25.16 3.35-7.97 10.15-15.83 18.44-22.68 8.29-6.84 19.43-13.87 31.3-18.41 11.87-4.53 25.1-7.67 39.93-8.79 14.84-1.11 40.05 1.3 49.1 2.1 9.06.8 5.73 1.55 5.24 2.71m1.35-1.04c13.42 1.69 28.44 6.27 38.97 11.89 10.54 5.61 18.28 14.29 24.25 21.82 5.98 7.52 10.64 15.2 11.61 23.31.96 8.12-1.06 17.62-5.82 25.36-4.76 7.74-13.26 15.1-22.72 21.06-9.46 5.96-20.98 11.14-34.04 14.7-13.06 3.57-30.1 6.19-44.32 6.69-14.22.5-27.57-1.02-41.02-3.7-13.44-2.68-29.07-7.01-39.64-12.37-10.58-5.37-18-12.32-23.81-19.8-5.82-7.48-9.95-16.54-11.09-25.1-1.13-8.56-.55-18.51 4.27-26.28 4.82-7.77 14.8-14.4 24.65-20.32 9.86-5.91 21.63-11.69 34.49-15.16 12.86-3.47 28.77-5.15 42.67-5.67 13.9-.51 33.77 1.67 40.75 2.57 6.98.9 1.52 1.85 1.11 2.86" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(405.758 38.697)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="73.858">as395823</text><text transform="translate(405.758 38.697)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="73.858" y="35">(doof)</text><path d="M536.832 154.777c11.06-3.19 26.69-3.24 39.78-2.7 13.08.54 27.3 2.19 38.73 5.94 11.44 3.74 22.35 10.1 29.87 16.54 7.52 6.43 12.56 14.4 15.26 22.07 2.7 7.67 3.37 16.27.95 23.94-2.42 7.67-8.34 15.54-15.47 22.08-7.12 6.54-16.53 12.9-27.28 17.17-10.75 4.27-24.39 7.43-37.22 8.44-12.83 1-27.22-.1-39.76-2.42s-25.72-6.42-35.47-11.53c-9.74-5.11-17.67-11.96-23-19.15-5.34-7.18-8.88-16.08-9-23.95-.13-7.87 3.33-15.85 8.24-23.25 4.92-7.4 11.66-15.45 21.26-21.13 9.59-5.68 29.69-10.97 36.3-12.96 6.6-2 2.81.16 3.32.97m50.89-1.23c12.25 1.53 24.97 7.43 34.98 12.31 10.01 4.88 19.56 9.86 25.08 16.97 5.52 7.11 7.63 17.64 8.03 25.69.4 8.06-.82 15.32-5.62 22.65-4.81 7.32-14.13 15.51-23.2 21.31-9.08 5.8-19.19 10.88-31.26 13.49-12.07 2.62-28.41 3.1-41.15 2.19-12.74-.92-24.35-3.83-35.3-7.66-10.95-3.83-22.44-9.15-30.41-15.34-7.97-6.19-13.97-14.2-17.4-21.82-3.43-7.62-5.44-16.01-3.19-23.9 2.26-7.89 9.15-16.97 16.7-23.46 7.55-6.5 18.14-11.4 28.6-15.51 10.46-4.11 21.5-8.06 34.17-9.14 12.68-1.08 35.1 2.23 41.88 2.64 6.78.42-.7-1.07-1.21-.14" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(506.882 174.793)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="62">as54429</text><text transform="translate(506.882 174.793)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="62" y="35">(us)</text><g stroke-linecap="round"><path d="M100.124 126.087c5.22-4.07 25.46-19.85 30.57-23.71m-31 24.58c5.4-3.8 26.53-19.93 31.87-24.06" fill="none" stroke="#1e1e1e" stroke-width="2"></path><path d="M120.514 118.817c2.28-3.24 5.34-6.6 10.98-16.25m-10.18 16.9c2.39-4.36 4.61-8.08 10.11-16.85" fill="none" stroke="#1e1e1e" stroke-width="2"></path><path d="M112.344 108.157c3.97-1.11 8.68-2.33 19.15-5.59m-18.34 6.24c4.45-1.71 8.7-2.77 18.27-6.19" fill="none" stroke="#1e1e1e" stroke-width="2"></path></g><g stroke-linecap="round"><path d="M242.94 118.633c5.91 4.95 29.34 25.26 35.2 30.24m-35.83-29.28c5.89 4.8 29.68 23.65 35.61 28.58" fill="none" stroke="#1e1e1e" stroke-width="2"></path><path d="M255.66 141.513c7.29 1.8 12.31 2.75 21.94 6.29m-21.01-7.01c7.96 2.34 15.67 5.37 21.51 7.71" fill="none" stroke="#1e1e1e" stroke-width="2"></path><path d="M265.46 129.403c4.74 4.98 7.18 9.11 12.14 18.4m-11.21-19.12c4.29 6.85 8.37 14.37 11.71 19.82" fill="none" stroke="#1e1e1e" stroke-width="2"></path></g><g stroke-linecap="round"><path d="M367.86 141.427c4.59-4.06 22.99-20.33 27.52-24.41m-27.95 24.2c4.54-4.02 23.18-19.71 27.73-23.7" fill="none" stroke="#1e1e1e" stroke-width="2"></path><path d="M386.88 133.867c2.08-6.07 4.98-11.79 8.21-15.85m-8.62 15.02c1.98-3.94 4.4-8.17 8.6-15.6" fill="none" stroke="#1e1e1e" stroke-width="2"></path><path d="M378.78 124.417c4.91-2.82 10.61-5.27 16.31-6.4m-16.72 5.57c4.1-1.46 8.66-3.19 16.7-6.15" fill="none" stroke="#1e1e1e" stroke-width="2"></path></g><g stroke-linecap="round"><path d="M507.048 132.108c2.72 4.55 13.53 22.79 16.33 27.4m-16.75-27.62c2.64 4.59 13.55 22.43 16.4 26.99" fill="none" stroke="#1e1e1e" stroke-width="2"></path><path d="M510.808 148.838c4.09 4 8.69 6.15 12.38 9.9m-12.93-9.97c4.62 3.77 9.17 7.22 12.82 10.04" fill="none" stroke="#1e1e1e" stroke-width="2"></path><path d="M520.138 143.078c.99 5.93 2.47 10.01 3.05 15.66m-3.59-15.74c1.3 5.8 2.53 11.3 3.48 15.81" fill="none" stroke="#1e1e1e" stroke-width="2"></path></g></svg></p><h2 id="the-path-to-the-hurricane-electric-ipv6-tunnel-broker">The Path to the Hurricane Electric IPv6 Tunnel Broker</h2><p>Let&#39;s do a few more traceroutes to see how the traffic routes. We&#39;ll start with an IPv6 traceroute over the HE IPv6 tunnel broker to Seattle Community Network&#39;s router (2602:fd94::1) at the Seattle Internet Exchange:</p><pre><code><span>[asdf@rb5] &gt; /tool/traceroute 2602:fd94::1
</span><span>Columns: ADDRESS, LOSS, SENT, LAST, AVG, BEST, WORST, STD-DEV
</span><span>#  ADDRESS            LOSS  SENT  LAST     AVG  BEST  WORST  STD-DEV
</span><span>1  2001:470:a:f00::1  0%     101  4ms      4.4  2.8   31.9   2.9
</span><span>2                     100%   101  timeout
</span><span>3  2602:fd94::1       0%     100  3.2ms    4    2.1   67.7   6.5
</span></code></pre><p><em>(First hop IP address slightly redacted)</em></p><p>This version of traceroute doesn&#39;t look up hostnames or AS numbers, but that&#39;s ok. What&#39;s notable is that this traffic seems to hop right into our network, after a mystery hop at hop #2 that I suspect is some HE-internal stuff we can&#39;t see. It appears traffic enters HE&#39;s network via their IPv6 tunnel broker then passes through the peering connection between HE and our router at the IXP. It makes sense the traffic would take this path because the peering link has fewer hops than going through a transit provider.</p><p>This traceroute was run inside the tunnel, so it doesn&#39;t show any of the hops that happen before the packets reach HE (it appears as though there&#39;s only a single hop, #2, between the origin and destination). To see the path taken by the tunnel itself (the outside view), we can run traceroute to the IPv4 address of the HE tunnel broker endpoint 216.218.226.238 (the endpoint IP is provided by HE when you sign up).</p><p>Here&#39;s an example of an outside-the-tunnel traceroute to the HE tunnel broker endpoint taken from a Comcast residential connection. Pay attention to the AS numbers, you can see that Comcast (AS7922) connects to Hurricane Electric (AS6939) without an intermediate hop. Maybe they&#39;re peers!</p><pre><code><span>$ mtr -w -r -z -c 5 216.218.226.238
</span><span>HOST: bar                                                       Loss%   Snt   Last   Avg  Best  Wrst StDev
</span><span>  1. AS???    router.asus.com                                    0.0%     5    2.3   3.0   1.2   7.5   2.6
</span><span>  2. AS???    100.92.123.67                                      0.0%     5   10.2  11.1   8.7  14.4   2.1
</span><span>  3. AS7922   po-323-406-rur302.seattle.wa.seattle.comcast.net   0.0%     5   16.0  11.5   9.8  16.0   2.6
</span><span>  4. AS7922   po-300-xar02.seattle.wa.seattle.comcast.net        0.0%     5   12.1  10.9   9.0  12.2   1.4
</span><span>  5. AS7922   be-304-arsc1.seattle.wa.seattle.comcast.net        0.0%     5   11.9  13.7   9.8  20.1   3.9
</span><span>  6. AS7922   be-36131-cs03.seattle.wa.ibone.comcast.net        60.0%     5   13.6  12.1  10.5  13.6   2.1
</span><span>  7. AS7922   be-2313-pe13.seattle.wa.ibone.comcast.net          0.0%     5   21.9  14.0  10.2  21.9   5.0
</span><span>  8. AS7922   50.208.233.194                                    20.0%     5   28.1  20.7  10.5  31.1  10.4
</span><span>  9. AS6939   tserv1.sea1.he.net                                 0.0%     5   11.7  10.4   9.8  11.7   0.8
</span></code></pre><p><em>An <code>mtr</code> traceroute from a Comcast residential connection to the Hurricane Electric Free IPv6 Tunnel Broker</em></p><h2 id="cramming-tunnels-inside-tunnels">Cramming Tunnels Inside Tunnels</h2><p>The last piece is getting the user traffic to take the path through HE shown above. Briefly, we</p><ul><li>Set up HE free IPv6 tunnels at user sites.</li><li>Now send site traffic over an <strong>IPv6-addressed</strong> VPN to our network.</li></ul><p>In other words, we put our VPN tunnel <em>inside</em> HE&#39;s 6to4 tunnel. The inner VPN tunnel must be destined to an IPv6 tunnel endpoint so that it uses the HE 6to4 tunnel (the traffic inside our tunnel can still use IPv4).</p><p>That traffic takes a path that looks something like this:</p><p><svg viewBox="0 0 674 466" xmlns="http://www.w3.org/2000/svg"><defs></defs><path d="M74 306c9 0 20 4 28 9 9 5 18 13 24 21 5 8 8 19 8 28 1 10-1 21-4 29-4 9-11 18-18 24a67 67 0 0 1-56 12c-10-2-20-8-27-15-7-6-11-16-15-25-3-9-5-19-4-29 1-9 6-20 12-28s13-14 23-18c9-4 26-6 32-7 6 0 3 1 3 2m-24 0c9-4 21-3 31 0 9 2 20 8 27 14s12 14 16 23c3 9 5 21 4 31a70 70 0 0 1-31 48c-9 4-20 6-30 6-10-1-21-3-30-8a62 62 0 0 1-34-46 67 67 0 0 1 23-53c6-7 20-14 25-16 4-2 0 1 0 2" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(36 334)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="36">user</text><text transform="translate(36 334)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="36" y="35">site</text><path d="M230 208c11 3 22 10 30 16s15 14 18 22c4 8 4 17 2 26a61 61 0 0 1-39 44 100 100 0 0 1-69 4c-11-3-20-10-28-16s-16-14-19-22-3-19-2-27c2-9 5-17 11-24s17-14 27-18c10-5 20-9 33-9 13-1 35 6 43 8 9 2 7 3 7 3m-42-12a94 94 0 0 1 63 26c7 6 11 14 14 22 2 8 3 19 0 27a72 72 0 0 1-43 40 116 116 0 0 1-71-1c-11-4-22-10-29-17s-11-16-13-25c-2-8-2-18 1-27 3-8 9-15 16-21 8-7 17-15 27-18 10-4 30-5 36-5s0 1 0 2" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(151 227)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="20" style="white-space:pre" text-anchor="middle" x="50">centurylink</text><text transform="translate(151 227)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="20" style="white-space:pre" text-anchor="middle" x="50" y="25">or</text><text transform="translate(151 227)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="20" style="white-space:pre" text-anchor="middle" x="50" y="50">something</text><path d="M355 328c12 2 25 10 34 17s15 15 20 23c4 8 6 18 5 28-1 9-7 19-14 27s-17 14-28 19c-10 4-25 8-37 8a127 127 0 0 1-72-18c-9-6-16-16-20-24-4-9-5-18-4-27 2-9 6-20 13-27 7-8 17-15 28-19 11-5 22-8 36-9 15 0 42 6 53 8 10 2 11 6 10 6m-15-10c12 3 24 11 32 19 8 7 12 16 15 25s5 20 2 29-10 17-18 24a98 98 0 0 1-68 24c-13 0-27-3-39-7-12-3-23-10-31-17s-15-15-17-23c-3-9-1-20 2-30 3-9 8-19 15-26a141 141 0 0 1 70-23c13 1 32 6 38 7h-2" fill="none" stroke="#ced4da" stroke-linecap="round" stroke-width="2"></path><text transform="translate(271 353)" dominant-baseline="text-before-edge" fill="#ced4da" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="55">as1299</text><text transform="translate(271 353)" dominant-baseline="text-before-edge" fill="#ced4da" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="55" y="35">(arelion)</text><path d="M505 197c14 1 28 5 39 10 12 4 23 11 31 18 7 7 13 16 16 23 2 8 2 17-1 25s-11 16-19 23a138 138 0 0 1-73 25c-14 1-29 2-42 0a161 161 0 0 1-71-29c-7-7-13-14-15-22s-1-17 2-25 10-16 18-23c9-7 20-14 32-18 12-5 25-8 40-9 14-1 40 1 49 2s5 2 5 3m1-1c14 1 29 6 39 12 11 5 19 14 24 21 6 8 11 16 12 24s-1 17-6 25c-4 8-13 15-22 21-10 6-21 11-34 15a175 175 0 0 1-85 3c-14-3-30-7-40-13-11-5-18-12-24-19-6-8-10-17-11-25-2-9-1-19 4-27a138 138 0 0 1 102-41c14 0 33 2 40 3s2 2 2 3" fill="none" stroke="#ced4da" stroke-linecap="round" stroke-width="2"></path><text transform="translate(407 224)" dominant-baseline="text-before-edge" fill="#ced4da" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="74">as395823</text><text transform="translate(407 224)" dominant-baseline="text-before-edge" fill="#ced4da" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="74" y="35">(doof)</text><path d="M537 342c11-3 27-3 40-2 13 0 27 2 38 6 12 3 23 10 30 16 8 7 13 15 15 22 3 8 4 17 1 24-2 8-8 16-15 22-7 7-17 13-27 17a134 134 0 0 1-77 6c-13-2-26-6-36-11s-17-12-23-19c-5-7-9-16-9-24s4-16 8-23c5-8 12-16 22-22 9-5 29-11 36-13s3 1 3 1m51-1c12 2 25 8 35 13 10 4 20 9 25 17 6 7 8 17 8 25 1 8 0 16-5 23s-14 15-23 21c-10 6-20 11-32 14-12 2-28 3-41 2a135 135 0 0 1-66-23c-8-6-14-14-17-22s-5-16-3-24 9-17 16-23c8-7 19-12 29-16 11-4 22-8 34-9 13-1 35 2 42 3h-1" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(507 362)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="62">as54429</text><text transform="translate(507 362)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="62" y="35">(us)</text><path d="m100 314 31-24m-31 25 32-24m-11 15c2-3 5-6 10-16m-10 17 10-17m-19 6 19-6m-18 6 18-6" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><path d="m243 306 35 30m-36-29 36 29m-22-7 22 6m-21-7 21 8m-13-19c5 5 8 9 13 18m-12-19 12 20m90-7 29-27m-30 27 30-26m-9 18c2-7 5-13 9-18m-9 17 9-17m-18 8c6-4 12-6 18-8m-18 7 18-7m110 17 8 26m-8-26 8 25m-8-11 8 11m-9-11 9 11m1-14-1 14m0-14v14" fill="none" stroke="#ced4da" stroke-linecap="round" stroke-width="2"></path><path d="M521 31c11 5 19 16 24 26 6 9 8 18 9 28 0 10-2 23-6 33s-12 18-20 26c-9 7-20 14-32 19a140 140 0 0 1-80 6c-13-3-26-10-36-17s-17-15-23-24c-6-10-13-23-14-33-1-11 5-21 9-31 5-10 10-20 18-28a127 127 0 0 1 73-26c14-1 27-1 42 4 16 5 40 20 50 26 9 7 10 14 8 15m-7-8c9 8 13 19 16 30a62 62 0 0 1-14 61c-8 8-17 14-28 21-11 6-26 13-40 15s-29-2-42-4-25-4-36-10a80 80 0 0 1-44-55 64 64 0 0 1 17-59c7-8 16-18 27-24s25-8 38-9c14-1 29-1 42 1s25 3 36 9c12 6 28 23 33 27s-1-3-2-3" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(384 39)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="66">as6939</text><text transform="translate(384 39)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="66" y="35">(hurricane</text><text transform="translate(384 39)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="66" y="70">electric)</text><g stroke-linecap="round"><path d="M545 131c8 14 39 49 52 85 12 35 21 106 25 128m-79-211c9 14 40 46 53 81 13 36 21 109 25 131m-14-26 14 26m-14-26c3 7 10 16 14 26" fill="none" stroke="#1e1e1e" stroke-width="2"></path><path d="M627 315c-3 8-2 18-6 30m6-30c-3 9-3 19-6 30" fill="none" stroke="#1e1e1e" stroke-width="2"></path></g><path d="M294 122c8-1 19 2 26 6 8 4 15 11 19 18 4 8 6 18 5 26s-6 17-12 23c-6 5-15 10-23 12-9 3-19 3-28 1a50 50 0 0 1-36-35c-1-8 0-18 4-25 4-8 11-15 19-20 8-4 23-6 29-7 5-1 4 1 4 2m-24 2a55 55 0 0 1 53 9c6 6 11 14 13 22 2 7 1 16-2 24a54 54 0 0 1-44 30c-9 1-18-2-26-6s-16-11-20-18c-5-7-7-16-6-24s6-18 11-24c6-7 18-13 22-15s1 2 2 3" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(275 148)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="28" style="white-space:pre" text-anchor="middle" x="20">???</text><path d="m252 220 16-19m-16 19 16-19m-5 12 5-12m-5 12 5-12m-11 7 11-7m-11 7 11-7m57-71 24-18m-24 18 23-19m-7 13c3-5 6-9 7-13m-7 13 7-13m-13 5 13-5m-13 5 13-5" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path></svg></p><p>The &#34;???&#34; network represents hops between a residential ISP&#39;s network and HE. In our case on Centurylink and Comcast there&#39;s a direct connection to HE (AS6939) but other ISPs might go through a transit provider. Also, AS1299 and AS395823 aren&#39;t part of the traffic&#39;s path anymore, so they&#39;re grayed out now.</p><p>At this point, we&#39;ve discovered a path from our disparate user sites back to our network at the SIX that doesn&#39;t involve the transit provider. This traffic doesn&#39;t cost us anything (because we peer with HE) and it <em>likely</em> doesn&#39;t cost HE anything either (because they&#39;re probably peering freely with big ISPs).</p><h2 id="performance">Performance</h2><p>With WireGuard as the innermost tunnel, the packets look something like this mess:</p><p><svg viewBox="0 0 1152 435" xmlns="http://www.w3.org/2000/svg"><title>a diagram of user packets tunnelled via Wireguard via Hurricane Electric IPv6 Tunnel Broker via Centurylink PPPoE</title>eyJ2ZXJzaW9uIjoiMSIsImVuY29kaW5nIjoiYnN0cmluZyIsImNvbXByZXNzZWQiOnRydWUsImVuY29kZWQiOiJ4nO1dW1NcdTAwMWK7sn7Pr6DYXHUwMDBm55yqPbN1v6w3ICFcdOGWcE1O7aKMPYDvxjZcdTAwMThYlf++NVx1MDAwNjwjzdhSXHUwMDAzJiTbWatSwe5m1FJ3f909Lenvd0tLy8PbXrL819JyclOttOq1fmW0/M/08+ukP6h3O+YrMv550L3qV8eUXHUwMDE3w2Fv8Ne//pVxxNVu+54raSXtpDNcdTAwMWNcdTAwMTi6/zc/Ly39Pf4795x+Ulx1MDAxZFY6561kzDD+KntcdTAwMTRl2P10u9tcdTAwMTk/VjElXHUwMDExxVpNXGLqg/fmccOkZr49q7RcdTAwMDZJ9k360fJqv7JWu904PTq7XFxZu/x6c9ZtVqrZU8/qrdbe8LY1XHUwMDFl1aBrJMm+XHUwMDFiXGb73WZyVK9cci9cdTAwMWUnIPf5NK5+9+r8opNcZlx1MDAwNlx1MDAxNk+3V6nWh7fmM4zQ5NP7KfhrKfvkJqXAgk0+SFlcdTAwMTiVMXdcdTAwMWW/1m11++nj/4GT9L9sXHUwMDAwp5Vq89yMolOb0Fxm+5XOoFfpm0XJ6EaPguHs8Vx1MDAxN0n9/GKYTrSItfUne3wynmssXHUwMDA0XHUwMDEzVGmZXHI1fWjvc2287P/OZrhfaSefU5bOVauVn6ZO7WGaXHUwMDFl1SNTXHUwMDEw+vDJz0yqlP6Dq1h55bJcdTAwMTRsmNxkoubU4Xg9+XLcxtUjcnlyd7GxwvYjsrs8ofv58K9s+Fe9WmX4ILFWWFGdaiCdfN+qd5qubK1utZkp5LucIFx1MDAwNUOwxpm3XHUwMDAxOtVcdTAwMDZcYlx1MDAxMlx1MDAxY0spSLBccpRcdTAwMGL9tm2AIFx1MDAxMkujZEJiyYmmtkFwNUeDwJTE3DxZcME0w1xmiaJ9MF4wXGIsXGLlhDPxfIOwviho/ksqZzaqbme4V79cdTAwMWJcdTAwMWKfsD5dr7TrrfGqTT5cdTAwMWVrrZnGXuW21a3kXHUwMDE2Pv1ipVU/T1V4uWpcdTAwMDac9C3tXHUwMDFl1lxyWkxcYtr1Wi1cdTAwMGZcdTAwMDFV87RKvZP0P4e47m6/fl7vVFr701x1MDAwNmOkTz49Llx1MDAxOI5cdM9pxCBJv02FJTPtcyZQccrdT1x1MDAxZo1cdTAwMTRrLTVnKptKn5Fer3VuOz++XHUwMDFmjLa3vzTY6NPlzYhtvnEjRTKT71x1MDAxZajmaZcqQ/1cZqeYXHUwMDBmpyjHWlx1MDAxMkyzof9cdTAwMGU4dUjPb1x1MDAxMTtcdTAwMWOtSPLlZO2y3vh+drD3XHUwMDA2cUqQqSZAMFx1MDAxMZRwXGawgXKp37hccmhcdTAwMWNrwozqXHUwMDExKpFA3LaIuVwiXHUwMDE1XHUwMDE3MeZcYiFscEdJpcOQylx1MDAxMGPNXHUwMDA1Vs+3iN9cdTAwMDWohtXenEDK47ZdkLJcdTAwMDYyd4BcIlx1MDAwNLmfTjIpQZDxiyzcOPeS7e1cdTAwMDHrRntXPzbJsDnCx3XceNvGqbWbSGnn2S+ITjhG+T+ZcufAqphFSVwipaTyXHUwMDA1bPFcdTAwMTXR6dtp9Fx1MDAwNV/yg0uJefLhU5vii87qXHUwMDFiRCeSK1x1MDAxNDj6T7lCXHUwMDE0SVx1MDAxMp5FlVx1MDAwYv2m9d9QoFi+JlwiiXylYla2RFx1MDAxMNZYIPFflC3Ve9dsTijk8c0uXG7ZI5k7XGbR3CS7eZI0KipcZlx1MDAxNlx1MDAwMYLE96e7vd56o9Ho7+1KdrKL3rdv3rZcdTAwMWRKlf38kCfNzVx1MDAwMk2qY6dEXHUwMDE56OSqe649Miy51i9cdTAwMTJcdTAwMTO+XCJcdTAwMGXxjY/y4OZsZf94XVxmLnon36W8XHUwMDFlvEFcdTAwMWOiuVx0L2RJiGKlXHUwMDE0XG5cdTAwMDeicqnftFx1MDAwMSjEY1wieZapvFwiJGFBY5bmZ0IzRVhcdTAwMGXxZ+FcdTAwMTMzK8JcdTAwMTl+garB71x1MDAwMk+jej85v6r051XO8/htXHUwMDE3o0qG81x1MDAxY6C6N51m9fv3m/1ke9Rpk8/HvPtcdTAwMDNdNq9z8k5Hs7FcdTAwMWJHytZbKnJ6+6hvskTBclxuXzSQl1L4X2v4c8WLXHUwMDA3qyQmWOAkfStQ4mQx0e6nkyhDXHUwMDE4XHUwMDA3xDRcdTAwMGWK9l9cYpt0beN9/yQ6Pz5cdTAwMWZcXNCjjVx1MDAwYvxtu3v0XHUwMDBisGnWaFxuim9cdTAwMDPYWOcxi1x1MDAwNVeUXHUwMDEy4zslkjNcdTAwMWP3pCqlYmFcdTAwMTgoo1x1MDAxY3HFy1x1MDAwMpCcw13Ywyy8mLxcXMJMXG6NXHUwMDE1KVP83Ko4is9ccotgKuhdoav31jheXHUwMDEwnFx1MDAxZfHmqpYrhYFcdTAwMTHr6bBkYcU0sPJcdTAwMDCFXHUwMDBiVpYsXHUwMDA1mJphlzt9XTmILn/ojcuv31x1MDAwZprRwfutL8NgQOLMscdSQDJptp1cdTAwMTFkTDmAmla9Wtjn0/FKKSm1wZ1CXHUwMDE1Nlx1MDAxZN+sl4eUSsVMpPx6cHV9e9Xo7P6obKmNr8OGWF2tXHUwMDFjjNZ/XHUwMDE5XFyVjyZcdTAwMDCuuKazXHUwMDBiXsGFqoXeh+CSxFgjJmWphuOp1VeMiDKMNCjrfW1gqveuxdtFJlx1MDAwZmKUlPrE06Dp/da342/75PDL4O68ff3pR/d6pdlcYoYmxjNcdKZDky6xwVx1MDAwNVx1MDAxND2M6UWhiCNjqpSWQ1x1MDAxMZueOVx1MDAxMVx1MDAwM2BSaZxcdTAwMDXxc4einY1et9c8QtVop3FHt5un7Vx1MDAwZjeNX1x1MDAwNkXlo1x0gFwiJvhcdTAwMDKKXHUwMDFlPn1ccihSTGohMSqrXHJcdTAwMTDKpml4Wlx1MDAxNsTkSfr9XG5AxN4uXHUwMDEwefBcdTAwMDH4zmmGXHUwMDA1XjW/ne91WtvN5lx03zjb/2Rysv5tMFx1MDAxMFFcdTAwMTZStMOo7DXJomr3XCLQw1x1MDAxNDFcdFxyL0SDKZMsVDQmXHUwMDFkKoRJgp5cdTAwMTQhPlx1MDAxMXjW23hrd/Sh0cZtPNrD1ZWj/ZMvv1xmeMpHXHUwMDEzXHUwMDAwPJTTmKcvPFx1MDAxZTvSQkBIk1gjVPKCZlx1MDAwMUhPXHUwMDA0JGpCLqowLiBP+l2xkJe9XHUwMDExx0ohJYP2uLw2XCL1er1u8nYhyYNcdTAwMTSFjnFbXHUwMDFhXGImra6J3u5av9Zu3NDT/u6qqu/fdorGedY3uvC4m2r8zX1kmM3K7dhcdGZrPXmNz0p6OXnG92iCNMZcZnNNXHUwMDA0p1xcaZnbKLEwyYJJXHUwMDEyXHUwMDEz6CnFRbEtLP1STC1XSKY0l7nc6ddbZK9bd7Eu+9dS5pnHP0z+/e9/llJHOE+OYeRcZkYuYOTSR25cdTAwMGad+MiJRe5cdTAwMWS7Te5cdTAwMWQ7tciVj5zlyYl3mbhF7lx1MDAxNVVY5NRHLmHkylwi5z5ybZF7J1x1MDAxMiMgvaVcdTAwMDbErzXWwlx1MDAxMu9KYXuptJeeXHUwMDAz6a3Zp15VIFxiSE+A9Fx1MDAxY0ZPMZBcdTAwMWU4XHUwMDFlyoD0lnpSr0ujXHUwMDFh9vtcdTAwMTlw/IxcdTAwMDLpgfPPgPrDXHUwMDE0jJ5cdTAwMDP1jVx1MDAwM+XlQHmF7Vx1MDAxZrz2JYD2K1x1MDAwNIxeXHUwMDAyxyNcdJBcdTAwMWU6XHUwMDFlXHSk1zB6XHUwMDA1lFdcdTAwMDHnX1x1MDAwMeXVwPFoXGakXHUwMDA3rpdcdTAwMDb6f1xylVx1MDAxN2jv2vZvXn+YXHUwMDBiwUNcdTAwMTlsj+iNrDCiUFx1MDAwNlx1MDAxYlx1MDAwM7whXHUwMDA3RrZTXHRcYjqsVaD+KFx1MDAwMtnL4Fx1MDAwZiOQtVx1MDAwZcy7bthcdTAwMGWEmDfow3YkxPyzZIdCzC+Dw+CPbWxcdTAwMDbu1yWHIWCWnjckuNB+1XBcdTAwMThcdTAwMDJcIljyvIXzXHUwMDFikMPgXHLxXYZcdTAwMDDls2yaXHUwMDA1rDSD2oNt01x1MDAwMVx1MDAwYiegXGa2TVx1MDAwN6y0elx1MDAxZUOAamggg5NcdTAwMWVcdTAwMDQw2PG7X/lcYoUyQL23k4JcdTAwMDQw2Cvtt1x1MDAwN6KgXGb2OvhccohcIihcdTAwMDOGMlx1MDAxMChcdTAwMDOFMjAoXHUwMDAzhzJcYiiDhDJAXHUwMDE3jkFcdTAwMTeOQVx1MDAxN45BXHUwMDE3jkGnlUFnyUlcbv3u3snyXHUwMDAyXHUwMDE4XHUwMDE4lEFcdTAwMDBcdTAwMTlcdTAwMDQ0blx1MDAxNVx1MDAxOMrAoVxmXHUwMDEyylx1MDAwMCxeYDubXGZhYFBcdTAwMDao0Fx1MDAxMppwKOjCKahcZlxuKoOCroOGyqChXHUwMDBiZ+eJIVxmUOXTQKFcdFx1MDAwMspAnMQvgFx1MDAwMSg0QUDlI1x1MDAxOLhwXHUwMDA0Q4XGQOUjXHUwMDE4KjRcdTAwMDauNCFQoVx00FVcdTAwMTJcdTAwMDI0UUKgQlx1MDAxM6i2XHUwMDEyqGpQ6CxR6CxRqD1Ai+HEXHSwXHUwMDAyXHUwMDE4oK8j7Hq7v35FKLDg6DJ48zhih3D+V0LEXHUwMDBl4fyvtIhcdTAwMWTC+V/IXHUwMDEx+y1cdTAwMDDxrzSzVlx1MDAxYftnyVx1MDAwZVx1MDAxMnGA0DaDN1N0XHUwMDE5XHUwMDAyZslm8L9ydVx1MDAxOLxxq8tcdTAwMTCwXHUwMDBlNkPAOthcZn57mM7wzmFcXO71k8HgyvxltzhcZurtq1ZlmOw+fG2+XHUwMDFk9q+yXHUwMDA2gFZlMFxc67bb9eEwqe2m3Vx1MDAwMFYzgDWCyfPvn/7z/pu/XHUwMDFmf9V9S8v307Nvoz1+ez6oyUNGVoQ+2rxcbm1poVLHWpqMWlx1MDAxM6mMrdpcci5cZvNYUYqQlFQgnu0/m2xcdTAwMTkt2TMtit2XPNaMXGIuXHUwMDA1libW4lmp81x1MDAwZmx2mSze8vnR7kGzeVT7tvN5rX483L+7XHUwMDFi7pPlglx1MDAxZT29b5pwTmhub3Rua2lxv8CkT41cdG7+z+/F/sO6Yiw4iPypp+Wro1x1MDAwMFfqPMDrSu3CSuSvx9qYXHUwMDE5+cvcttuKuFx1MDAxNz/sXHUwMDFhQySAL54j4fW99pvnSHhnidvTKrzrwInN4J0ll8FcdTAwMGLLM1x1MDAxOF5cdFx1MDAwZfIjyJ4/XHUwMDBiXHUwMDBlblx1MDAwNoefrr+K6uijXHUwMDFhttrseJ81P35cboZcdTAwMDPFY8k4Nb6ecUWzKs5cdTAwMDNcdTAwMWOI2ES9XHUwMDA0U04xY7jY/Vh2JHmWTCzwYI54QIVMXHUwMDBmsS6eWDRcdTAwMWXb9I1iVGGpXHUwMDE1/XPhwPZDfjiwyP3FV9tTe7HDdiher2uR+/2VjWReXHUwMDFmLWx6WGdi5M8hbJDxI6tccnv+tMmm9+dl2NFcdTAwMDW/MjhcZlx1MDAwMc1cdTAwMGVTXHUwMDE5Xlx0MfIjyJ4/XHUwMDBiMZDe2ddcdNrcXFxlqL623/jRuGiQYMTQJJbKYEG6oVxcSY2dky0wjSVhXG5rgrSWNHvRPMFcZlqSQ1x1MDAxNPdcdTAwMGUvIGNcdTAwMGUpRFxu41SS0q0uuZ6A4k1cdTAwMTaaUYQ1f0ubL+eXQsCo/UVcdFx1MDAxMDVcdTAwMDVRXHUwMDBiXHUwMDEwtVx1MDAwNFFj4Fx1MDAxNDpplZeew+jtKnhcdTAwMDA9XHUwMDA20lMgvVx1MDAwNNIrIL1cdTAwMDN2XsVcdTAwMDGmwXZDwnPoX1x06PJcdTAwMDOYPH5cdTAwMTbONe92Vf/bOVx1MDAxNcd7ndWdjc5pb3u7WsS5ko2ZxM6DiC7uw8RaxjQ9019gRDnmolx1MDAwNNVcdTAwMTY7MWH4pJTkjDBdXHUwMDA2T9lL4eJcdTAwMTk1aVwiRFju5pBfj06TXHUwMDBiXHKSVrW7VO1fneWX7MnbMVvJmX1wrb1cdTAwMTlz2O3lXHUwMDE1yL9cdTAwMTPTXHUwMDEypXBcdTAwMDdC2dghmy/F/mirXHUwMDE14Vx1MDAxMX1P2/uDzUq/0ezjoNOhsoaV+42XuWMhJuf4i5imm6dcdTAwMTWT6blcdTAwMTDZhC3M78mHRHFigkNeemqnLnyYnYImkED6SYegzdv8xLD7XCInc7yq3dmDXHUwMDA2XHUwMDE53IEkV5u7/fftteujj/v1o91delx1MDAxZbzbWdmpXHUwMDFjz41+gnolVzvlpnJhZiFmxrikgklaes7G1PNvTMbN0oNF6Vuys5fd3Wy/pveSW1x0h3+7skXufXdcdTAwMTBZ4bq/lFx1MDAxNWFgk0HkbFX1j1xiXHUwMDAzeywjaP+6+4TnMLxzXHUwMDE455RcdTAwMTRYI5g8f1ZWsKOPbkSiRvxcdTAwMDM+k5XNndN1cVx1MDAxZIX7SPtEfJ5zflx1MDAxM1x1MDAxZlmSXHSQhY9cdTAwMDRWqjDDXHUwMDFhXHUwMDEzUfaye/qVq1x1MDAxOGmkXHUwMDE5ybXN/mk+kj2dXHUwMDFhVu332r5F7XVetjdcdTAwMDWW1f1cdTAwMDc0OMdcdTAwMTD46/y2s1x1MDAwZdhRYtFcdTAwMDfs05lG/0p+MT9cdTAwMDBcdTAwMTLiXHUwMDE2+99cdTAwMGV3259vXHUwMDBlaqfH31x1MDAwZmrnq1xun1x1MDAwZlx1MDAwZoPdonTdYsmr4lx1MDAxMreI6dQ7cFx1MDAxNm4yxE1qprjCqLQnaPoxOUSaXHUwMDFjz0DZb1x1MDAxNEk+w+9cdTAwMTlcdTAwMTVjXHUwMDE4S1x1MDAxM3EjrsYn3MGcXHUwMDE1jlV6YfTkl3grt1x1MDAxNjujcZ45oFMnzy1ZrPJP9zoqy1x1MDAwZmpcdTAwMTXnXHUwMDFmrfwnXHUwMDAw2W2sWMWW5MCQvGjdL8f/Sm40P6BJv9EsN3p+OVx1MDAxYcottj48wVfdreZqi3/4kISUvFx1MDAxODGLpTjFgppcdTAwMTSPSLtcdTAwMDBmzDVcdTAwMTYmsNFUSYpcdTAwMTgv1qNcdTAwMTlcdTAwMTGxMT06vjOW5jZlLuphT/WuXHUwMDAya00pKz0zfUY5zGTpnEtO51x1MDAxMIOmf7JFfEI9rJZcZoZ/LX368D+DpeFVp5O0lk7Tqe//djUyvyCQulmlvy5cIr2xc7GSrN983Ti62Dm7qoVcdTAwMDY/3GmiLqublZTN8Fwi1oGdXHSolaZElp9cYjjNXHUwMDE4XHUwMDA1Slx1MDAwZqelQVebv5FI51x1MDAxOc1ufny2z4mAwbG/QGV3I/hHXHUwMDAzTFxup9O/VjSQXHUwMDFiXHUwMDAwXHUwMDBl6bS6a41GlFWvuse1k0azpjc+XHUwMDFjXHUwMDFml9xcdTAwMWE0za/YMVx1MDAwMM+94MyuXGYqOpZFrVx0mkShNFx1MDAxYlwipUlcdTAwMTSZmkRJgrSiVL+lt84v6lpcYojaPlx1MDAxZsZHbVuyv7fILlx1MDAwN/nLNcBcdTAwMDM7XHUwMDFkev/vt09cdTAwMDHzl4Om0r+S58pcdTAwMGYgqFx1MDAxY3SxS9dOXHUwMDA3jY6+OdtcdTAwMWag7ubaXHUwMDE2v1x1MDAwYj43ueC5WNFzlTiubJvmwnEthUREXGJjXCKJ1mVcdMp0x8WEJml77lu60ulcdTAwMTfGRFx1MDAxNrXXkm1HXHUwMDA0fKXpr2NH0HeC0Fx1MDAxN3ZcdTAwMTa9f2PadPpXclxc+Vx1MDAwMbCQpr/19zcnm1x1MDAxZipcdTAwMWZ3hp/1+t7Op/NcdTAwMWFaXHUwMDBmu5FcdTAwMGXz2Fx1MDAwMDoz6ZxQlDO7XHUwMDA1kKviiz6OcKzyLYAlLm1Rclx1MDAwMb73k5jy9Fx1MDAxZF6JSyv2XHUwMDA1ZjWXdCeUVPN476dlvjP+yTWX7lV/aXJV9lLSqY1d3m9ad/FcdFx1MDAwM6m9fLxcdTAwMWX1XHUwMDBmfvCv0ernr3drtZXL5spNLzTSwIjjmDNjtoRcdTAwMGLOc9WB+7ijWImR8fiCZCw4JlRl5zbkXG4zSMVKYqNRgkmmhCxe5rCw4VlcdTAwMWJcdTAwMTNcdTAwMTU2XHUwMDEzy8s3mYhCrDIp1UgtmUbzKNWkXHUwMDE3WKq8cr5QWIJjwYxcdTAwMTZxZZTPRFSwhIlPUcT0XHUwMDBmi1x1MDAwNULE4IpcdTAwMTZUXHUwMDEyIf07nWf8MkxjlWKU4kpjrJD//MRZv43oXHUwMDE4UyaoJoxcbk1FwFx1MDAxMf4zZomJXHUwMDE4JqhcdTAwMWRQSVx1MDAxNVx1MDAxM5TeXk6pScU5XHUwMDA3XHUwMDE2wDSPkUSaKMRcdTAwMTVcdTAwMTXKv6HcXHTnXHUwMDEwi4nBK4aMtmPMkHfzqMvvOpqX43+t8Cw3IFx1MDAxY1x1MDAxNJ9VOndr+nR/q3PGL1f2No/WjmWXh7t75jRcdTAwMWGwYmN4WU0st0994cNDUkujzVx1MDAxMitSflxy6fStXHUwMDE4jFx1MDAxOJcr2Ju6x/5le1RhLVV2yTrgXHUwMDA2XHUwMDFly8ChLaFcdTAwMDH56HSG1/JcdTAwMTj5XHUwMDExXHUwMDA0nXe0tb23drK7sq1cdTAwMWF9+mVcdTAwMTOvXa7I05JtXFxTXHUwMDAzRPtWvbJaVGnH5sJjQFuRsFScXHUwMDE0L8ybWYxKrzFkWopFNeqBIE9ccjsuwustgK/n5t2yabdI+mv0U+lfyXNZLZUhjuukebTzsTnEODnm9WF0e/Dj6HPJfbjFUpSWPMbC5EpcdTAwMDQxpPNZ7LhcdTAwMTeIo9jALKVCUqZJMVx1MDAwMKLahNwmXHUwMDFlxlx1MDAxYWkstVjcXHUwMDEx+lx1MDAwMlvjKCNKsmKnwTjqke6nk7txtclcZqSax0tCo1x1MDAwMOhcdTAwMDV6gXpJf+lqYP4yS3h2Vq/+plx1MDAxNanpYkBqUT3Vfz9I1N7t6fVcdTAwMTFqN3DvsD8qucq3PNSQxH7rxUhJpFFWJOaLUFx1MDAwM1x1MDAxOGpgk3VcdTAwMTNSaoxq6ikm6eXxVMu5VJjeRqhcdTAwMDHdQFx1MDAwNzxcdTAwMDHCofdnMzY9sLpcdTAwMTJB365cdTAwMDWcZ+UywNqpXHUwMDAz6J3fXHUwMDBmPO/LXHUwMDFmNFx0IL1cdTAwMDLSu8dZXHUwMDAxo7JcdTAwMTBcdTAwMDZcdTAwMDZlXHUwMDEwQFx1MDAwNlx1MDAwMpWBQGUgUFx1MDAxOZyzX/xcZlx1MDAxNCpcdTAwMDOFXHUwMDBliUJVg1x1MDAxMShcdTAwMDNUWVx1MDAxOXRIXHUwMDFjOiRcdTAwMGVcdTAwMWSSQFBcdTAwMDbokFx1MDAwNNhcdTAwMDWAZYBOq4TKIKEySOiQXHUwMDE0dEhcbjpLXHUwMDFhKoNzkWJcYlx1MDAwN4Zqk3MpWlx1MDAxMFx1MDAwN9jlu1x1MDAwN2tcdTAwMDVwgCUn4NklYMndXHUwMDAztvxcdTAwMWNcdTAwMTQsOVx1MDAwNctBofCFKVx1MDAxNCycS7BCjrl0nHlcYodcdTAwMDMwXHUwMDAxPZiO5P4uSVx1MDAwN1x1MDAwMEJu+7Y5/Fx1MDAxN2Bg55jqgMvkXFxcdTAwMGW/XHUwMDFjLodfXHUwMDBlXHUwMDA3yVx1MDAwMm5wdDlcdTAwMDLkcDhcdTAwMDLksNc84PbNXHUwMDE5XHUwMDFj71x1MDAxY855VenyQ8hcdTAwMDYwq05cdTAwMTd9XHUwMDFjXHUwMDFkNsngZLB13qqcND7XXHUwMDBmVuonoVm/yf8mP99n/SWn5qCSNpNF1lx1MDAwZsz6Tb5vXHUwMDEy+Nzdv7msP1x1MDAwYlmKR0JgXCJcdTAwMTFiufdcdTAwMTJ/WNZcdTAwMGY879omXHUwMDA3ZsCw/lh/yu9cdTAwMDAwOONcdTAwMDe+r1xyKVx1MDAxMThcZv4qh4AyOHFKwCk70DjFeY9cdTAwMWPEXHUwMDAxjbdcInCkXHUwMDE5gePGXGJcdTAwMWM3RuC4MVx1MDAwMseNXHUwMDExOG6MKFhycKRcdTAwMTlRsOTgXHUwMDFhQMTAkoPLXHUwMDA2XHUwMDExXHUwMDAzS1x1MDAwZa40ROBSQ8TBkoOrXHUwMDEzXHUwMDExXHUwMDA3j1xuXFyfiMBcdTAwMDWKXGJcXKGIwCWKXGJcXKOIJFhycFkjXHUwMDAy1zVcIlx0llx1MDAxY1xcXG6JXHUwMDE0tDZcdTAwMTgpaIEzUtByYuRcdTAwMTRcXFx1MDAwMs6/U1xuyqFcdTAwMWTJ/VDrcvixVlx1MDAxMzCHM1f+XHUwMDE1tC+HXHLIWiPt5LlcdTAwMDFz5XBcdTAwMDT0niFooltkXHSIXHUwMDFhXHUwMDFjXHUwMDE2XHUwMDE20LOGoNlxkSVEfGh+XHUwMDFj5fK6J7OEzJjNwkNmbDrLO4d1bn1++TFkI5iViCtNmvj04jC6vdzVa1u717x5vVx1MDAxOdIwI7TdXHUwMDE2TEuuqlwiWsVcdTAwMDJcdTAwMGIhTNaG00tFJlx1MDAxNIuumCd3xZjUmlwiXnpg+/SdXHUwMDFlSqebtfCbOn7ssSkm29V0kVRqv+HBONNcdTAwMDVcdTAwMDBcdTAwMWQkvS02uu3r5KC6J1x1MDAwNpsnV5s721x1MDAxYsGXylx1MDAxOX1za2LFTlx1MDAxOFJ6dVxcplx1MDAxMlx1MDAwYlx1MDAwM1xmMMDU9jiXpbslZ1x1MDAxY/+HqZZMMfZf0lxiXHUwMDAzrSpBXHUwMDFiW/yoP+9GXHUwMDE4aFx1MDAxOVxy2jdcdTAwMDMtokFLYlxuSO9cdTAwMTbEwFxmwFx1MDAwM1xcQ1x1MDAxOKC3yrpcdTAwMDU3P1x1MDAwM7RuXGIut4GrbeBiXHUwMDFiuNZcdTAwMDYutYErbeCyXHUwMDE5uFx1MDAwNlx1MDAwNi5ogetZ4OJcdTAwMTS8c1x1MDAwNipcdTAwMDO4llx1MDAwNe+cXHUwMDAxN5FAZ0lBn1x1MDAwMG5cItHgNlx1MDAxNXhHXHUwMDFmuFlcdTAwMDPBm07g7Vx1MDAxZOBRuYbt95euZVx1MDAwN/hwMEy4tlxyfqlcdTAwMWWAXW6RN4BcdTAwMDNcbsDYLY5cdTAwMDZwgEHbbeJcbuBcdTAwMDDPlWuyflx1MDAwZVxy1ivXyv1AjKAlW+JYrb84SpySz1x1MDAxMzj83c1cYtrSQ1x1MDAxMLSlZ1x1MDAxNsc7h3NOpStrXGLZXHUwMDAwZlWuPlx1MDAxZpBEvP92KL7sqfVcdTAwMWKxc9n9dNRcbs6XXHS296jSTCdzu9pLekhcdTAwMTZXL0GvXlwiUlx1MDAxM0XLz8ufvnNEKk1cdTAwMTnT5I9NmJ+xSVx1MDAxNbYnXHUwMDAytiNinlx1MDAxYmCB22W9U/i8Iy2BXHUwMDFiLfwpuFx1MDAxZJJcdTAwMDXQXHUwMDAzd1x1MDAwN9vZqJ+eXHUwMDAwx0+A4yHA8diJZVx1MDAwMD1w/Fx1MDAxNDh+XG5cdTAwMWM/XHUwMDAzjp9cdTAwMDH1gVx1MDAwMcfPgfPDgfJcbuB4JFBeXHUwMDA1pNdAeTX090PtXHUwMDExXHUwMDAxXHUwMDE1wklcZkNcdTAwMTiAS4bBPlx1MDAwYupUnL1cdTAwMGIhXGZQt1xi9UNcdTAwMTjqiDDUXHUwMDEzOXltyGnIXHUwMDA0yGDXk0JcdTAwMThcdTAwMTiUXHUwMDAxKoPjL6BZc1xiXHUwMDAz8KxWbDdGgVx1MDAxOUK2PtpcZlx1MDAwMSBcdTAwMGU+yNpmXGKoWtt3K0Fl8HeuuFxm4CH9itO1cyNcYrqEsom1Uud3X798PDyg3YpqdDfkTkinXHUwMDAzRtS+pZeW3EDJXGKKVXpXXGZVWrDSQy5cdTAwMTetXHUwMDBlsMxRmsSRKl56XHUwMDFmpZx6/Fx1MDAwN1x1MDAxNlJcYoTe1v0jj61cdTAwMGXj4zLMzDWT4dL/Jp1q/7ZnnvB/v13Hg1eOKY1cdTAwMGbvXHUwMDFlXHUwMDFjw3Kl19tcdTAwMWKa2TXf3pvp8nU9XHUwMDE5rVx1MDAxNpX8XHUwMDFmZ+M/y+9cdTAwMWXMOlXwsSv5++e7n/9cdTAwMDHV+b4tIn0=<defs></defs><path d="M870 153c55 2 111-4 166 0m-166 0c62 2 129 2 166 0m0 0c12-1 19 10 22 21m-22-21c14 3 23 7 22 21m0 0c-4 10 3 23 0 44m0-44v44m0 0c1 15-4 25-22 22m22-22c-3 14-3 20-22 22m0 0c-67-5-131 2-166 0m166 0c-48-5-95-2-166 0m0 0c-17 2-26-7-22-22m22 22c-18-4-20-4-22-22m0 0c-1-12 3-27 0-44m0 44v-44m0 0c-1-15 11-19 22-21m-22 21c0-13 9-19 22-21" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(887 174)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre" text-anchor="middle" x="66">payload</text><path d="M781 154c13 4 28-1 46 0m-46 0c15 0 32-2 46 0m0 0c13-1 19 8 21 21m-21-21c12 2 24 10 21 21m0 0v42m0-42c-2 16-1 34 0 42m0 0c1 17-9 21-21 22m21-22c3 10-10 25-21 22m0 0c-14 2-22 2-46 0m46 0h-46m0 0c-14 3-25-9-21-22m21 22c-10 3-24-11-21-22m0 0c-2-15 3-30 0-42m0 42v-42m0 0c-4-18 9-22 21-21m-21 21c-1-12 5-19 21-21" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(776 174)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre" text-anchor="middle" x="28">tcp</text><path d="M698 154h41m-41 0h41m0 0c17 1 18 6 20 20m-20-20c11-1 19 6 20 20m0 0c-4 12 0 22 0 44m0-44v44m0 0c-1 17-10 23-20 20m20-20c2 18-2 17-20 20m0 0c-14 1-31 2-41 0m41 0c-15 0-27-2-41 0m0 0c-10-2-20-7-20-20m20 20c-17 1-17-3-20-20m0 0c0-7-3-20 0-44m0 44v-44m0 0c-4-12 8-19 20-20m-20 20c4-15 3-18 20-20" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(685 174)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre" text-anchor="middle" x="34">ipv4</text><path d="M486 153c57 3 120 1 171 0m-171 0h171m0 0c12-4 17 9 21 22m-21-22c13 2 24 8 21 22m0 0c-2 13 3 22 0 43m0-43v43m0 0c3 16-7 18-21 21m21-21c-2 11-5 25-21 21m0 0c-67 2-136 2-171 0m171 0H486m0 0c-16 1-19-10-22-21m22 21c-19 4-19-12-22-21m0 0c1-15 3-23 0-43m0 43c-2-14-2-27 0-43m0 0c-3-14 10-24 22-22m-22 22c-1-19 9-23 22-22" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(489 174)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre" text-anchor="middle" x="82">wireguard</text><path d="M410 152c9-4 26 0 36 0m-36 0c10-2 21-2 36 0m0 0c11 3 19 7 18 18m-18-18c9 3 20 6 18 18m0 0c2 16 2 39 0 53m0-53c-2 15-1 29 0 53m0 0c3 13-5 15-18 18m18-18c-3 12-9 15-18 18m0 0c-17 3-26-1-36 0m36 0h-36m0 0c-8 0-19-9-18-18m18 18c-12 1-21-7-18-18m0 0c-1-10-4-24 0-53m0 53c3-20 1-37 0-53m0 0c3-9 8-17 18-18m-18 18c2-13 3-16 18-18" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(399 174)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre" text-anchor="middle" x="29">udp</text><path d="M253 152c41-2 86 3 117 0m-117 0c46-2 91-4 117 0m0 0c13-4 21 5 22 22m-22-22c12 0 20 5 22 22m0 0v44m0-44v44m0 0c2 16-9 26-22 23m22-23c0 19-7 26-22 23m0 0c-28 2-61 0-117 0m117 0H253m0 0c-13-1-19-10-22-23m22 23c-12 3-24-7-22-23m0 0c1-16-3-31 0-44m0 44v-44m0 0c1-12 9-19 22-22m-22 22c3-17 4-21 22-22" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(278 174)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre" text-anchor="middle" x="34">ipv6</text><path d="M158 152c16-2 34 4 51 0m-51 0h51m0 0c15-3 25 11 22 22m-22-22c15-1 20 9 22 22m0 0c4 14 3 27 0 44m0-44c-1 10-2 24 0 44m0 0c-1 18-6 20-22 23m22-23c2 14-11 18-22 23m0 0c-13-1-27 2-51 0m51 0c-18-3-37-1-51 0m0 0c-12-3-23-10-22-23m22 23c-11 1-20-6-22-23m0 0c3-10-1-16 0-44m0 44v-44m0 0c-2-17 10-23 22-22m-22 22c1-13 8-24 22-22" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(150 174)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre" text-anchor="middle" x="34">ipv4</text><path d="M54 152c13-3 31 1 60 0m-60 0c19-1 35-3 60 0m0 0c13 2 22 3 22 22m-22-22c11 4 26 8 22 22m0 0v44m0-44v44m0 0c2 13-8 23-22 23m22-23c2 17-10 26-22 23m0 0c-14 2-31-4-60 0m60 0c-12-1-26 2-60 0m0 0c-16 3-19-10-22-23m22 23c-17-2-24-7-22-23m0 0c2-11 2-21 0-44m0 44v-44m0 0c-3-14 9-22 22-22m-22 22c-4-11 6-27 22-22" fill="none" stroke="#1e1e1e" stroke-linecap="round" stroke-width="2"></path><text transform="translate(38 174)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre" text-anchor="middle" x="47">pppoe</text><path d="M384 143v-2l-1-4-1-5-2-4-3-4-4-2-5-1h-9l-5-1h-4l-5 1h-13l-7 1h-28l-6-1-5-3-5-3-5-5-3-6-2-6-1-3v-3l1-1 1-2 1-1 2-1h3l2 1h1l1 2 1 1 1 2v9q-1 4-4 7l-4 4-5 2-5 2-5 1h-5l-5 1h-14l-4 1h-71l-4 1q-3 0-4 2l-2 5-1 4v3l-1 2-1 2-2 2h-5l-2-1-2-1-1-2v-5l1-2 2-2 2-1h4l2 1 2 2 1 2v5l-1 2-2 1-2 1h-5l-2-2-1-2-1-2v-4l1-6q0-3 2-5l3-6 3-4q2-2 5-2l5-2h71l5-1h5l6-1 5-1h15q3 0 5-2l2-4v-5l1-1 1-2 1-1 2-1h3l2 1h1l1 2 1 1 1 2v2l1 3 3 4 5 4 6 2h29l5-1h36l5 1 6 2 4 3 3 4 3 4 2 5 1 6 1 5 1 6-1 2v2l-1 1h-1l-1 1h-4l-1-1-1-1-1-1v-3Zm-311-7 3-6 4-11 5-13 5-14 4-11 2-8 1-7 1-8 1-4v-1l1-1 1-1h4l1 1 1 2v4l-1 1h-2l-1 1-1-1h-2l-1-1v-4l1-2 1-1h4l1 1 1 1v6l-3 8-2 7-3 9-3 11-4 14-5 14-4 11-2 6-1 1-1 1h-1l-1 1h-1l-1-1-1-1-1-1v-3Z" fill="#1e1e1e"></path><path d="M69 132v-10l1-6-1-6v-4l1-2 1-2 1-1 2-1h4l2 2 1 1 1 2v2l-1 2-1 2-2 1h-6l-1-2-1-1-1-2v-2l1-2 1-2 2-1h4l2 1 2 2v1l1 1v3l-1 6v6l-1 6-1 4v4l-1 1v1l-1 1h-2l-1 1-1-1h-1l-1-1-1-1-1-1v-2Z" fill="#1e1e1e"></path><path d="m77 129 2-1 4-2 6-3 5-2 4-2 5-2 3-2h2l2 1 1 1 2 1v2l1 2-1 2-1 2-2 1-2 1h-2l-2-1-1-1-1-2-1-2v-2l1-2 1-1 2-1 2-1h2l2 1 1 2 1 2 1 2-1 2-1 1-1 2h-1l-1 1-4 1-6 3-5 2-5 2-4 2-4 1h-5l-1-1-1-1-1-1v-5l1-1h1l1-1h1Z" fill="#1e1e1e"></path><text transform="translate(10 10)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre">telco cruft</text><text transform="translate(237 49)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre">6to4</text><path d="m175 249-1 2-3 6-4 6-3 6-2 6-2 4-1 3 1 1-1 2v1l-1 1-2 1h-1l-2-1h-1l-1-2-1-1v-2l1-1 1-1 1-1 1-1h2l1 1 2 1v1l1 2v1l-1 2-1 1h-1l-2 1h-1l-2-1-1-1-1-2v-3l1-5 3-5 3-6 3-6 3-6 3-6 1-3h1l1-1h1l1-1h1l1 1h1l1 1v1l1 1v1l-1 2Z" fill="#1e1e1e"></path><path d="m177 247 1 2 3 4 3 4 2 5 1 4 2 6 2 4v2l-1 2-1 1-2 1-2 1h-2l-1-1-2-2v-1l-1-2 1-2v-2l2-1 2-1h1l2 1 2 1 1 1 1 2v2l-1 1-1 2-1 1-2 1h-2l-2-1-1-1-1-2-1-1v-1l-1-5-2-6-2-5-3-5-2-2-1-1v-4l1-1v-1h1l1-1h4l1 1h1Z" fill="#1e1e1e"></path><path d="m170 252 1 3q2 4 2 15 1 11-1 24l-2 27-4 23-2 21-2 15v8h-1v1l-1 1h-2l-1-1-1-1v-2l1-1h1v-1h1l1 1h1v1h1v1l-1 1v1h-1l-1 1h-1v-1h-1v-1l-1-1 1-7 1-16 3-20 3-24 2-26 1-23-2-14-1-3v-3h1v-1h4l1 1v1Z" fill="#1e1e1e"></path><text transform="translate(113 380)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre">dest: HE&#39;s tunnel broker</text><path d="m279 249-1 2-2 5-3 5-2 4-2 1h-4l-2-1-1-2v-3l1-2 1-1 1-1h3l2 1 1 1 1 1v4l-1 1-1 1-2 1h-3l-1-1-1-1-1-2v-3l1-1 1-2 3-5 2-4 2-3 1-1h1l1-1h2l1 1h1l1 1v1l1 1v3h-1Z" fill="#1e1e1e"></path><path d="m281 242 2 3 4 5 3 6 3 5 3 5 2 3v3l-1 2-1 1-2 1h-3l-1-1-1-1-1-2v-1l1-2v-1l2-1 1-1h2l1 1 1 1 1 1 1 1v2l-1 1-1 2h-1l-2 1h-1l-2-1-1-1v-1l-2-5-4-7-4-5-3-5-3-4v-1l-1-1v-1l1-1v-1l1-1h1l1-1h1l1 1h1l1 1h1Z" fill="#1e1e1e"></path><path d="M281 255v10l-2 8-2 8-2 8v9l-1 1-1 1-1 1h-2l-1-1-1-1-1-1v-2l1-1 1-1 1-1h1l2 1h1v1l1 1v2l-1 1v1h-1l-2 1h-1l-1-1-1-1-1-1v-1l1-3 1-6 1-8 1-9 1-7 1-6v-4l1-1v-1l1-1h4l1 1v1l1 1v1Z" fill="#1e1e1e"></path><text transform="translate(200 301)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre">dest: our wireguard endpoint</text><path d="M741 256v4l2 11-1 14-2 20-2 22-1 17v22l-1 1v1l-1 1h-2l-1-1h-1v-1l-1-1 1-1v-1l1-1h3l1 1 1 1v1l-1 1v1l-1 1h-3l-1-1v-2h-1l1-3v-19l1-17 2-23 2-19 1-13-2-10-1-5v-2l1-1h4l1 1v1h1Z" fill="#1e1e1e"></path><path d="m735 263-3 2-6 4-5 3-2 1h-4l-1-1-1-2v-2l1-2 1-1h4l1 1 1 1v4l-1 1-1 1h-4l-1-1-1-1v-4l1-1 1-1 2-1 4-2 6-4 4-3h4l1 1 1 1v5h-1l-1 1Z" fill="#1e1e1e"></path><path d="m744 253 1 2 2 4 3 6 4 5 2 2v6l-1 1-2 1h-5l-1-1-1-2-1-2 1-1v-2l2-1 1-1 2-1 2 1 1 1 2 1v2l1 1-1 2-1 2-1 1h-5l-2-1v-1l-3-4-4-6-2-4-2-4-2-3v-4l1-1 1-1h1l1-1h2l1 1h1l1 1 1 1Z" fill="#1e1e1e"></path><text transform="translate(659 365)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre">dest: per user traffic</text><path d="m402 136-1-2-1-5v-6l1-4 3-3 3-3 6-2 6-2 5-1h12l5 1 6 1h39l7 1h7l7 1h20l5-1 7-1 5-2 3-2 3-4 1-6 3-8 2-5 2-2h2l2-1 2 1 2 1 1 2 1 2v2l-1 2-1 2-2 1-2 1h-2l-2-1-2-2-1-1-1-3 1-2v-2l2-1 2-1 2-1 2 1 2 1 1 1 1 2 1 2-1 2v1l-1 1-1 4-1 5-2 6-3 5-3 4-5 3-5 2-6 2-8 1-5-1h-20l-7 1h-7l-7 1h-26l-7-1h-10l-5-1h-11l-5-1-7 2q-4 1-4 4l1 4v6l-1 1v1l-2 1h-4l-1-1-1-1-1-1v-1Z" fill="#1e1e1e"></path><path d="M660 137v-2q0-3-2-5-1-3-4-4l-5-1h-6l-5 1h-47l-5-1-6-2-6-2-4-3-4-5-4-4-2-4-2-6-2-5-2-4v-6l2-2 1-1 2-1h5l2 2 1 2 1 2v2l-1 2-1 2-2 1-2 1h-2l-3-1-1-1-2-2v-5l1-2 2-2 2-1h4l2 1 2 2 1 2v1h-1l1 4 3 5 2 4 2 4 5 5 6 3 6 1h46l5 1h11l6 3 6 5 3 7 1 7v4l-1 1-1 1-1 1h-4l-1-1-1-1-1-1v-2Z" fill="#1e1e1e"></path><text transform="translate(383 33)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre">wireguard header</text><path d="m680 136-1-2-1-5 1-4 4-5 5-3 4-2q2-2 5-2l6-1 6-1 4-1h32l9 1 9 1h35l8 1 8 1h10l6 1 7 1h30l6-1 6-3 4-4 4-3 2-3 2-1h4l2 1 1 2 1 1v2l-1 2-1 2-1 1-2 1h-2l-2-1-1-1-1-1-1-2v-2l1-2 1-1 2-1 1-1h2l2 1 2 1 1 2v4l-1 1-1 1-2 2-5 4-4 3-6 3-7 2-6 1h-6l-6-1h-19l-7-1h-6l-4-1h-6l-7-1h-43l-9 1-7 1h-44l-7 1-5 3q-2 1-1 3v6l-1 1v1l-2 1h-4l-1-1-1-1-1-1v-1Z" fill="#1e1e1e"></path><path d="m903 104 2 2 2 4q2 3 5 3h10l5-1h17l6 1h14l8 1 9 1h6l6-1h24l6-1 6 1 6 1h17l7 2 7 4q2 2 2 5l1 6v14l-2 2-1 1h-6l-2-2-1-2v-4l1-2 1-1 2-1h4l2 1 1 1 1 2v4l-1 2-2 1-2 1h-4l-1-1-2-2v-2l-1-1 1-3v-6l-1-5q-1-2-4-2l-6-1h-13l-5-1h-5l-6-1h-24l-6-1h-6l-9 1-8 1h-14l-5 1h-15l-5-1h-12l-6-2q-4-1-5-3l-3-4-3-4-2-3v-5l1-1h1l1-1h4l1 1 1 1Z" fill="#1e1e1e"></path><text transform="translate(721 51)" dominant-baseline="text-before-edge" fill="#1e1e1e" font-family="Virgil" font-size="36" style="white-space:pre">user packet (encrypted)</text></svg></p><p>Surprisingly, this hack only increases overhead by <strong>100 bytes</strong> (okay, that is a lot, but I was expecting more). Here&#39;s the breakdown:</p><ul><li><p>The 6to4 tunnel contributes 60 bytes of overhead from a 20-byte IPv4 and a 40-byte IPv6 header.</p></li><li><p><a href="https://lists.zx2c4.com/pipermail/wireguard/2017-December/002201.html" rel="noopener" target="_blank">WireGuard adds another 40 bytes via its 8-byte UDP header and 32 bytes of protocol-specific data (4-byte type + 4-byte key index + 8-byte nonce + 16-byte authentication tag)</a></p></li></ul><p>I&#39;m not counting overhead from the outer PPPoE connection and the TCP/IP headers in the user data because these headers are present regardless.</p><p>The performance of putting a tunnel inside another tunnel will probably not be as good as <em>not</em> putting a tunnel inside another tunnel. But how bad is it?</p><p>John, who did the majority of the implementation, set out to investigate just how bad this idea actually was.</p><p>He initially squeezed a measly 230 Mbps over a connection sold as being capable of 940 Mbps, but with some careful tuning of the MTU and iperf parameters, pushed through 680 Mbps of UDP traffic through this double tunnel setup (see the middle pane in the screenshot below).</p><p><img alt="" src="https://hypodyne.net/iperf-double-tunnel.jpg"/> <em>Top pane: pushing the maximum 940 Mbps of traffic outbound from John&#39;s home Centurylink GPON service. Middle Pane: 680 Mbps of UDP traffic received at our router at the SIX! Bottom pane: Graph of traffic through Bond0.510 --our router&#39;s connection with the SIX fabric, and where we peer with HE, indicating this traffic is going over a peering link rather than a transit link.</em></p><p><em>Image credit: John Elliott</em></p><p>His MikroTik RB5009 sat around 70% CPU during this abuse, indicating the hardware is sufficient to make line rate (at least for large packet sizes).</p><h2 id="why-tunnel-at-all">Why Tunnel at All?</h2><p>Even straightforward VPN tunnels cut into performance. One must wonder why tunnel at all?</p><p>The main reason to use VPN tunnels is financial. Virtual layer 2 circuits, eg. via <a href="https://en.wikipedia.org/wiki/Metro_Ethernet" rel="noopener" target="_blank">metro ethernet</a> or similar technologies, are expensive (let&#39;s not even mention running our own fiber or fixed wireless). Consumer-grade internet connections are cheap by comparison.</p><p>However, this begs the question that we&#39;d want to network our sites together at all, if they already have internet connections. One reason is to monitor equipment, allow secure remote management, and provide network services (dns, ntp, etc.) to both our equipment and user devices.</p><p>I mentioned that we want traffic from these sites to exit from our AS, opposed to the consumer ISP connection. Among other things, this allows us to receive and handle DMCA complaints ourselves (look for a link here to our 2021 City of Seattle report that describes the issue). We may use <a href="https://en.wikipedia.org/wiki/Split_tunneling" rel="noopener" target="_blank">split tunneling</a> to shed load from the VPN by routing popular streaming services outside of the tunnel, for example.</p><h2 id="acknowledgments">Acknowledgments</h2><p>Thanks to <a href="https://seattlecommunitynetwork.org/" rel="noopener" target="_blank">Seattle Community Network</a> for providing the infrastructure necessary to explore this interesting hypothetical.</p><p>Thanks to <a href="https://johnelliott.org/" rel="noopener" target="_blank">John Elliott</a> for doing the hands-on-keyboard work configuring the network gear for tunneling, running performance tests, and providing the traceroutes and screenshots.</p><p>Thanks to <a href="https://homes.cs.washington.edu/~infrared/" rel="noopener" target="_blank">Esther Jang</a> for pre-work in scoping the problem, helping set up the Seattle Community Network infrastructure on which these experiments were run, and editing and giving feedback on this article.</p><p>Thanks to <a href="https://doof.net/" rel="noopener" target="_blank">doof.net</a> for providing hosting and support to Seattle Community Network.</p><p>Also thanks to the numerous other volunteers and donors to Seattle Community Network whose contributions of money, rackspace, bandwidth, physical space, etc. make the project possible.</p><hr/></div></div>
  </body>
</html>
