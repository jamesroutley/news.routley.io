<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.lambda.cx/posts/freecad-and-git/">Original</a>
    <h1>Versioning FreeCAD Files with Git (2021)</h1>
    
    <div id="readability-page-1" class="page"><div>
        <p><img src="https://blog.lambda.cx/posts/freecad-and-git/cover.png" alt="FreeCAD and git" title="FreeCAD and git"/></p><p>
I&#39;ve been working a lot with <a href="https://freecadweb.org/">FreeCAD</a> since I got my 3D printer. It&#39;s
been a mostly excellent experience, but I&#39;ve run a couple issues.</p>
<p>
Between the MacOS and Linux version of FreeCAD (both 0.19, maybe
different builds?), and transferring files between machines using
Nextcloud, a project that I&#39;d been working on for a couple days became
broken to the point where I could no longer modify the sketches,
rendering it useless.</p>
<p>
This has led me to find out how I can manage these files through
version control like <a href="https://git-scm.com/"><code>git</code></a>.</p>
<p>
It would seem that FreeCAD files are nothing more than zip files
containing text documents, which should make this rather easy.</p>
<p>
Unfortunately there isn&#39;t a standard process to git control a
zipped folder, though I have come across a couple methods which
when used together, result in an adequate solution.</p>
<p>
The main component of this workaround is a great little script called
<a href="https://bitbucket.org/sippey/zippey/src/master/">zippey</a>, which allows git to efficiently store zip files using
something called a <a href="https://git-scm.com/docs/gitattributes#_filter"><code>filter</code> attribute</a>.</p>
<p>
The second isn&#39;t as much a tool as it is a snippet from a <a href="https://tante.cc/2010/06/23/managing-zip-based-file-formats-in-git/">blog post</a>
about diffing zip files using the <a href="https://git-scm.com/docs/gitattributes#_diff"><code>diff</code> attribute</a>. By combining both
these methods we can arrive at a pretty good method of handling
FreeCAD save data.</p>
<p>
The first step is to download the zippy python program. Since I
keep all source repositories under <code>~/src</code> in directories based on
the website and user who created them, I&#39;ll be cloning it to
<code>~/src/bitbucket.org/sippey/zippey</code>.</p>
<p>
Then I configure my <code>~/.gitconfig</code> to so that the <code>diff</code> and <code>filter</code>
attribute settings are used globally. I&#39;ll also setup a global git
<a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Attributes">attributes</a> file so that I don&#39;t need to set the association with
<code>.FCStd</code> files in each repo individually.</p>
<p>
I add the following lines to my <code>~/.gitconfig</code>.</p>
<div>
<div><pre tabindex="0"><code data-lang="conf"><span><span><span>[</span>diff <span>&#34;zip&#34;</span><span>]</span>
</span></span><span><span>textconv <span>=</span> unzip -c -a
</span></span><span><span><span>[</span>core<span>]</span>
</span></span><span><span>    attributesfile <span>=</span> <span>~/</span>.gitattributes
</span></span><span><span><span>[</span>filter <span>&#34;zippey&#34;</span><span>]</span>
</span></span><span><span>    smudge <span>=</span> <span>/</span>home<span>/</span>dante<span>/</span>src<span>/</span>bitbucket.org<span>/</span>sippey<span>/</span>zippey<span>/</span>zippey.py d
</span></span><span><span>    clean <span>=</span> <span>/</span>home<span>/</span>dante<span>/</span>src<span>/</span>bitbucket.org<span>/</span>sippey<span>/</span>zippey<span>/</span>zippey.py e</span></span></code></pre></div>
</div>
<p>
Then I create a <code>~/.gitattributes</code> file with the following content.</p>
<div>
<div><pre tabindex="0"><code data-lang="conf"><span><span><span>*</span>.FCStd filter<span>=</span>zippey
</span></span><span><span><span>*</span>.FCStd diff<span>=</span>zip</span></span></code></pre></div>
</div>
<p>
With this, <code>git</code> should be now be able to effectively diff and store
proper deltas when FreeCAD files are modified.</p>
<p>
Keep in mind you need to redo this process on each computer you
plan on using this with, otherwise the files git produces won&#39;t
make any sense.</p>

    </div></div>
  </body>
</html>
