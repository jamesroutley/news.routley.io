<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://materializedview.io/p/s3-is-showing-its-age">Original</a>
    <h1>S3 is showing its age</h1>
    
    <div id="readability-page-1" class="page"><div><div dir="auto"><p><span>There’s no denying that S3 is a feat of engineering. </span><a href="https://www.youtube.com/watch?v=sc3J4McebHE" rel="">Building and Operating a Pretty Big Storage System</a><span> is a top-tier technology flex. But S3’s feature set is falling behind its competitors. Notably, S3 has no compare-and-swap (CAS) operation—something every single other competitor has. It also lacks multi-region buckets and object appends. Even </span><a href="https://aws.amazon.com/s3/storage-classes/express-one-zone/" rel="">S3 Express</a><span> is proving to be lackluster.</span></p><p><span>These missing features haven’t mattered much for data lakes and offline use cases. But new infrastructure is using object storage as their primary persistence layer—</span><a href="https://materializedview.io/p/cloud-storage-triad-latency-cost-durability" rel="">something</a><span> </span><a href="https://materializedview.io/i/138849066/transactional-key-value-stores-on-s" rel="">I’m</a><span> </span><a href="https://materializedview.io/i/138956120/you-should-be-streaming-data-on-s" rel="">excited</a><span> </span><a href="https://materializedview.io/i/139272203/s-express-one-zone-roundup" rel="">about</a><span>. Here, S3’s feature gaps are a bigger problem.</span></p><p><span>Preconditions (also known as </span><a href="https://en.wikipedia.org/wiki/Compare-and-swap" rel="">compare-and-swap</a><span> (CAS), conditionals, If-None-Match, If-Match, and so on) allow a client to write an object only if a certain condition is met. A client might wish to write an object only if it doesn’t exist, or update an object only if it hasn’t changed since the client last read it. CAS makes this possible. Such operations are used often for locks and transactions in distributed systems. </span></p><p><span>S3 is the only object store that doesn’t support preconditions. Every other object store—</span><a href="https://cloud.google.com/storage" rel="">Google Cloud Storage</a><span> (GCS), </span><a href="https://azure.microsoft.com/en-us/products/storage/blobs" rel="">Azure Blob Store</a><span> (ABS), Cloudflare </span><a href="https://developers.cloudflare.com/r2/" rel="">Ridiculously Reliable</a><span> (R2) storage, </span><a href="https://www.tigrisdata.com/" rel="">Tigris</a><span>, </span><a href="https://min.io/" rel="">MinIO</a><span>—all have this feature.</span></p><p><span>Instead, developers are forced to use a separate transactional store such as </span><a href="https://aws.amazon.com/dynamodb/" rel="">DynamoDB</a><span> to enforce transactional operations. Building a two-phase write between DynamoDB and S3 is not technically difficult, but it’s annoying and </span><a href="https://docs.rs/object_store/latest/object_store/aws/enum.S3CopyIfNotExists.html" rel="">leads to ugly abstractions</a><span>.</span></p><p><span>I was </span><a href="https://x.com/criccomini/status/1729546140163395698" rel="">really excited</a><span> about S3 Express One Zone (S3E1Z) when it first came out. The more time I spend with it, the less impressed I am. The first wart that surfaced was a new </span><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/directory-buckets-overview.html" rel="">directory bucket</a><span> type, which Amazon introduced for Express.</span></p><p><span>But the gaps don’t stop here. S3E1Z is </span><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-express-differences.html#s3-express-differences-unsupported-features" rel="">missing a </a><em><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-express-differences.html#s3-express-differences-unsupported-features" rel="">ton</a></em><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-express-differences.html#s3-express-differences-unsupported-features" rel=""> of standard S3 features</a><span> including object version support, bucket tags, object locks, object tags, and MD5 checksum ETags. The </span><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-express-differences.html#s3-express-differences-unsupported-features" rel="">complete list</a><span> is pretty staggering.</span></p><p><span>S3E1Z buckets can’t be treated like a normal S3 buckets. As with CAS operations, developers must design around these deficiencies. And because S3E1Z is not multi-zonal, developers are left to build </span><a href="https://x.com/richardartoul/status/1756808229542051902" rel="">quorum writes</a><span> to multiple availability zones for higher availability.</span></p><p>Factor in S3E1Z’s high storage cost of $0.16/gig—twice elastic block store’s (EBS)  general purpose SSD (gp3) cost—and S3E1Z looks more like an expensive EBS with a half-implemented S3 API.</p><p><span>S3’s availability feature gaps go beyond S3E1Z. S3 doesn’t have dual-region or multi-region buckets. Such buckets are useful for higher availability. Google offers </span><a href="https://cloud.google.com/storage/docs/availability-durability#cross-region-redundancy" rel="">a wide range of options</a><span> in this area.</span></p><p>While not a must-have, higher availability buckets are certainly nice to have.</p><p>The dream is that developers are offered an object store with all of these features: low latency, preconditions, dual-region/multi-region, and so on. But we live in reality, where engineers face a choice: abandon S3 or build around these gaps.</p><p><a href="https://turbopuffer.com/" rel="">Turbopuffer</a><span> is my favorite example of a company that’s gone all-in on abandoning S3.</span></p><p><span>The gamble they’ve made is that S3 will eventually get preconditions. This gamble seems reasonable since Amazon has all of the required building blocks (DynamoDB and S3) and every competitor is beating them here. I’m making the same gamble with the </span><a href="https://materializedview.io/p/cloud-storage-triad-latency-cost-durability" rel="">cloud native LSM I’m working on</a><span>.</span></p><p><span>The challenge with this approach is inter-cloud network cost. All cloud providers charge for network egress. Data transferred to infrastructure running outside amazon web services (AWS) will incur network egress fees. But the inter-cloud cost for AWS users isn’t as bad as you might think. </span><a href="https://sirupsen.com/" rel="">Simon Eskildsen</a><span>, Turbopuffer’s founder and CEO, has </span><a href="https://x.com/Sirupsen/status/1766459050378551611" rel="">written about this extensively</a><span>.</span></p><p><span>The benefit of this is that Turbopuffer has built a beautiful and minimalist design with </span><a href="https://turbopuffer.com/architecture" rel="">just three components</a><span>: a Turbopuffer binary, a RAM/SSD cache, and Google Cloud Storage.</span></p><p>For many, this will seem extreme. The alternative is to house metadata in a transactional store outside of S3.</p><p><span>Once you open yourself up to a separate metadata plane, you’ll find other use cases for it. The path to the </span><a href="https://www.gartner.com/en/research/methodologies/gartner-hype-cycle" rel="">slope of enlightenment</a><span> is to recognize that S3 is an object store not a file system. By embracing DynamoDB as your metadata layer, systems stand to gain a lot.</span></p><p>Ultimately, the decision to abandon S3 or embrace its shortcomings depends on a system’s use cases and design goals. Preconditions on S3 and a unified S3E1Z API would make this decision a lot easier, though.</p><p><span>Support this newsletter by purchasing </span><a href="https://www.amazon.com/Missing-README-Guide-Software-Engineer/dp/1718501838" rel="">The Missing README: A Guide for the New Software Engineer</a><span> for yourself or gifting it to someone.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde442631-41a6-4119-a99a-62957cd53edb_870x978.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde442631-41a6-4119-a99a-62957cd53edb_870x978.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde442631-41a6-4119-a99a-62957cd53edb_870x978.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde442631-41a6-4119-a99a-62957cd53edb_870x978.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde442631-41a6-4119-a99a-62957cd53edb_870x978.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde442631-41a6-4119-a99a-62957cd53edb_870x978.png" width="146" height="164.12413793103448" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/de442631-41a6-4119-a99a-62957cd53edb_870x978.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:978,&#34;width&#34;:870,&#34;resizeWidth&#34;:146,&#34;bytes&#34;:null,&#34;alt&#34;:&#34;&#34;,&#34;title&#34;:&#34;&#34;,&#34;type&#34;:null,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" title="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde442631-41a6-4119-a99a-62957cd53edb_870x978.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde442631-41a6-4119-a99a-62957cd53edb_870x978.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde442631-41a6-4119-a99a-62957cd53edb_870x978.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde442631-41a6-4119-a99a-62957cd53edb_870x978.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p data-attrs="{&#34;url&#34;:&#34;https://www.amazon.com/Missing-README-Guide-Software-Engineer/dp/1718501838&#34;,&#34;text&#34;:&#34;Buy Now&#34;,&#34;action&#34;:null,&#34;class&#34;:&#34;button-wrapper&#34;}" data-component-name="ButtonCreateButton"><a href="https://www.amazon.com/Missing-README-Guide-Software-Engineer/dp/1718501838" rel=""><span>Buy Now</span></a></p><p><span>I occasionally invest in infrastructure startups. Companies that I’ve invested in are marked with a [$] in this newsletter. See my </span><a href="https://www.linkedin.com/in/riccomini/" rel="">LinkedIn profile</a><span> for a complete list.</span></p></div></div></div>
  </body>
</html>
