<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tylercipriani.com/blog/2023/07/31/git-files-hidden-in-plain-sight/">Original</a>
    <h1>Git files hidden in plain sight</h1>
    
    <div id="readability-page-1" class="page"><article class="page">







<div id="pagebody">

<section id="content" role="main">
<blockquote>
<p>I doubt that it is a good practice to ship the public key used to
sign things in the repository in the repository itself</p>
<p>â€“ Junio C Hamano, <a href="https://lore.kernel.org/git/20210907204100.ptapvn4wrqn3qrzq@meerkat.local/T/">git@vger.kernel.org:
expired key in junio-gpg-pub</a></p>
</blockquote>
<p>Git ships with the maintainerâ€™s public key.</p>
<p>But you wonâ€™t find it in your worktreeâ€”itâ€™s hidden in plain
sight.</p>
<p>Junio Hamanoâ€™s public key is a blob in the <code>git</code> object
database. Itâ€™s tagged with <code>junio-gpg-pub</code>, so you can only
see it with <code>git cat-file</code>:</p>
<pre><code>(/^ãƒ®^)/*:ãƒ»ï¾Ÿâœ§ git cat-file blob junio-gpg-pub
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1
...</code></pre>
<p>In 2021, Junio pretty much said that this was a <a href="https://lore.kernel.org/git/20210907204100.ptapvn4wrqn3qrzq@meerkat.local/T/">bad
idea</a>.</p>
<p>But it led me to think about some other wonderful bad ideas.</p>
<section id="fake-empty-github-repos">
<h2>Fake empty GitHub repos <span aria-role="hidden">ðŸ“¦</span></h2>
<p>I made an empty GitHub repo called <a href="https://github.com/thcipriani/hidden-zangief">hidden-zangief</a>.</p>
<figure>
<img src="https://photos.tylercipriani.com/2023-07-31_empty-github.png" alt="hidden-zangief"/>
<figcaption aria-hidden="true">hidden-zangief</figcaption>
</figure>
<p>Except itâ€™s not empty.</p>
<p>Instead, itâ€™s chockfull of sweet ANSI artâ€”Zangief from Street Fighter
II.</p>
<figure>
<img src="https://photos.tylercipriani.com/2023-07-31_zangief-ansii.png" alt="Zangief + Figlet = magic"/>
<figcaption aria-hidden="true">Zangief + Figlet = magic</figcaption>
</figure>
<p>And if you clone it, after an initial warning, you can see Zangief is
still in there:</p>
<pre><code>(/^ãƒ®^)/*:ãƒ»ï¾Ÿâœ§ git clone https://github.com/thcipriani/hidden-zangief &amp;&amp; cd hidden-zangief
Cloning into &#39;hidden-zangief&#39;...
warning: You appear to have cloned an empty repository.
(/^ãƒ®^)/*:ãƒ»ï¾Ÿâœ§ git fetch origin refs/atomic/piledriver
remote: Enumerating objects: 1, done.
remote: Counting objects: 100% (1/1), done.
remote: Total 1 (delta 0), reused 1 (delta 0), pack-reused 0
Unpacking objects: 100% (1/1), 1.71 KiB | 1.71 MiB/s, done.
From https://github.com/thcipriani/hidden-zangief
 * branch            refs/atomic/piledriver -&gt; FETCH_HEAD
(/^ãƒ®^)/*:ãƒ»ï¾Ÿâœ§ git show FETCH_HEAD

                        [...sweet zangief ansi art...]
                        _____                 _       __ 
                       |__  /__ _ _ __   __ _(_) ___ / _|
                         / // _` | &#39;_ \ / _` | |/ _ \ |_ 
                        / /| (_| | | | | (_| | |  __/  _|
                       /____\__,_|_| |_|\__, |_|\___|_|  
                                        |___/        </code></pre>
</section>
<section id="dubious-git-plumbing-hacks">
<h2>Dubious git plumbing hacks <span aria-role="hidden">ðŸª“</span></h2>
<p>Inspired by Junio, I misused and finagled a couple of <a href="https://git-scm.com/book/en/v2/Git-Internals-Plumbing-and-Porcelain">git
plumbing commands</a> to make this fake empty repo:</p>
<ol type="1">
<li><code>git hash-object</code></li>
<li><code>git update-ref</code></li>
</ol>
<p>First, I used <code>hash-object</code> to create a dangling git
object with the <code>~/zangief.txt</code> contents.</p>
<pre><code>(/^ãƒ®^)/*:ãƒ»ï¾Ÿâœ§ mkdir /tmp/hidden-zangief &amp;&amp; cd /tmp/hidden-zangief
(/^ãƒ®^)/*:ãƒ»ï¾Ÿâœ§ git init
(/^ãƒ®^)/*:ãƒ»ï¾Ÿâœ§ git hash-object -w ~/zangief.txt
7dd9e2d2d2d8b5107d225b4708e1177abb08e7c8</code></pre>
<p>Now Zangief is lurking in your git plumbing, atomic-suplexing your
other git objects.</p>
<p>I imagine this is how Junio added his public key to the git object
database. Then he tagged it with <code>junio-gpg-pub</code> and pushed
it to the <code>git</code> repo.</p>
<p>But a tag would appear in the GitHub UI, and I wondered whether I
could hide it.</p>
<p>So I opted to abuse the wide-open git ref namespace, imagining a ref
beyond tags and branches: <code>refs/atomic/piledriver</code>.</p>
<p>Then I schlepped that ref to GitHub.</p>
<pre><code>(/^ãƒ®^)/*:ãƒ»ï¾Ÿâœ§ git update-ref refs/atomic/piledriver 7dd9e2d2d2d8b5107d225b4708e1177abb08e7c8
(/^ãƒ®^)/*:ãƒ»ï¾Ÿâœ§ git remote add origin https://github.com/thcipriani/hidden-zangief
(/^ãƒ®^)/*:ãƒ»ï¾Ÿâœ§ git push origin refs/atomic/piledriver:refs/atomic/piledriver</code></pre>
<p>And, of course, Microsoft GitHub foolishly neglects the
<code>refs/atomic/*</code> namespace in their UI, rendering our 400 lb
wrestler friend invisible.</p>
<p>Infinite magic awaits the intrepid developer willing to abuse
<code>git</code> plumbing. After all, git is just a database with a
terrible interface.</p>
</section>

</section>









</div>



</article></div>
  </body>
</html>
