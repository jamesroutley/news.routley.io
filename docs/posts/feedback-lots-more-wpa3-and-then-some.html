<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rachelbythebay.com/w/2024/02/07/feedback/">Original</a>
    <h1>Feedback: lots more WPA3, and then some</h1>
    
    
<p>
It&#39;s time for me to respond to some recent feedback.  As usual, this is 
a mix of topics and the responses are pretty much off the cuff, so strap 
in and hold on tight.
</p>
<p>
...
</p>
<p>
At least one person mentioned the 11 hour WPA3 problem on my Raspberry 
Pis and asked if I was experiencing clock drift.  This is kind of funny 
to me since I&#39;ve been 
<a href="https://rachelbythebay.com/w/2019/08/01/reliability/">picky</a>
about 
<a href="https://rachelbythebay.com/w/2018/03/22/time/">keeping</a>
<a href="https://rachelbythebay.com/w/2014/06/14/time/">clocks</a>
synced in my personal and professional lives these past few years.  So, 
no, not really.  All of those Pis have chrony installed, and it&#39;s doing 
a great job of keeping their clocks disciplined.  
</p>
<p>
I was the crazy person who spent $300 of my own money to buy a 
GPS-to-NTP box when the unmaintained corporate infrastructure at a 
certain job was down to its last &#34;proper&#34; time server and was in danger 
of failing itself.  It never came to that, but we got mighty close that 
winter.  If it had fallen over, then I would have &#34;backfed&#34; time into 
production from the corporate network using a little GPS antenna puck in 
the window by my desk.  How crazy is that?
</p>
<p>
I&#39;ve gone to lengths to make things right, put it that way.
</p>
<p>
...
</p>
<p>
Also regarding the WPA3/Pi stuff, someone said &#34;if it is truly cursed, 
it will be 11 hours and 360 seconds&#34;.  That would be, what... 11:06:00?  
I don&#39;t think that joke landed with me.  I was hoping it would involve 
&#34;666&#34; somehow, but (11 * 60) + 360 is 39960.
</p>
<p>
They did mention that an 11:06:40 period is a rollover from 9999999 to 
10000000 jiffies with Hz set at 250.  That is, if you tick at 250 Hz, 
after 11 hours, you&#39;ll be at 9900000 ticks, and another 100000 ticks 
past that is 400 seconds, hence the 06:40 part.
</p>
<p>
Of course, for that to break something, some clown would have to be 
expressing the time as ASCII digits, and then breaking when it got &#34;too 
wide&#34;.  I mean, it happens.  It happened to KDE back in September 2001 
when time_t went from 999999999 to 1000000000.  That was a &#34;fun&#34; one to 
deal with.
</p>
<p>
...
</p>
<p>
Niels asks how I keep my posts &#34;so level-headed&#34;.  I guess that&#39;s in the 
eye of the beholder, to be honest.  I&#39;ve had 
<a href="https://rachelbythebay.com/w/2011/12/04/meeting/">situations</a>
where I&#39;ve deliberately taken every bit of emotion out of my actions, 
and *still* had people calling it out after the fact.
</p>
<p>
After a few decades of this, I&#39;ve concluded that a lot of these results 
were decided long before I opened my mouth or started writing.  They 
basically have a problem with the overall concept of me saying stuff, 
and exactly what gets said doesn&#39;t matter a whole lot.  They just use 
the words I choose in order to sprinkle it throughout their takedowns.
</p>
<p>
The way you can know this is happening is when the same words come from 
someone else who has a different *ahem* &#34;presence&#34; in the same space, 
and then nothing bad happens, or perhaps it&#39;s taken as good.  That 
happens too, and it&#39;s really irritating since it serves to confirm to 
you that it may be the 2020s, but it&#39;s really just a number in terms of 
people being narrow-minded and generally pig-headed.
</p>
<p>
...
</p>
<p>
A reader writes that I should try wpa_supplicant 2.10 on my RPI, and, 
well, I&#39;m sorry to say that I&#39;ve done that and then some, and it didn&#39;t 
help.  Check it out - wpa_supplicant as built from upstream (hostap&#39;s 
git repo) *does* bring the link up... for about 10 seconds.  Then it 
throws an error and kills it.  It looks like this:
</p>
<pre class="terminal">Jan 28 13:32:24 rpi5b NetworkManager[847]: &lt;info&gt;  [1706477544.7638] device (p2p-dev-wlan0): supplicant management interface state: associating -&gt; associated
...
Jan 28 13:32:34 rpi5b wpa_supplicant[1209]: wlan0: Authentication with &lt;AP&gt; timed out.
</pre>
<p>
It&#39;s a consistent 10 seconds.  I was feeling like torturing myself that 
afternoon, so I started screwing around with the code.  It took a while 
to find where things were happening, but I finally just extended the 
timeout.  It would hold on there a bit longer, then it would die after 
the new timeout.
</p>
<p>
So, finally, I just commented out the part where it complains about that 
and tears down the link, and you know what?  It stayed up.  So, I went 
back a little bit, and just let it bring the link up, then suspended it 
with ^Z and went about my day.
</p>
<p>
Three hours later, it was fine.  Two hours after that, same thing.  I 
kept checking on it into the night.  Then, finally, it died early the 
next morning, even with wpa_supplicant *still suspended*.  Here&#39;s what 
it looked like from the AP side:
</p>
<pre class="terminal">Mon Jan 29 01:19:23 2024 daemon.info hostapd[6371]: ath1: STA &lt;pi 5&#39;s mac address&gt; IEEE 802.11: disassociated
</pre>
<p>
And yeah, that&#39;s about 11 hours after I started the last experiment.  (I 
should mention that having to wait 11 hours to verify things absolutely 
sucks.)
</p>
<p>
What I gather from this and what a few people have told me so far is 
that the actual association is kept running by the device itself, and 
whatever you have running on the host machine (iwd or wpa_supplicant) is 
basically along for the ride.
</p>
<p>
Also, I could swear I found a patch from someone to one of those 
projects that basically says &#34;it&#39;s gonna die after 12 hours anyway, so 
just let it happen and restart the connection then&#34;.  I can&#39;t find it 
while writing this, but it doesn&#39;t matter.  Here&#39;s what&#39;s wrong with 
&#34;just let it fail&#34;: NetworkManager has a limit for exactly how much crap 
it&#39;ll accept, and after the default of 3 retries, it&#39;ll just leave the 
link down.
</p>
<p>
Sure, you can override this, but now you&#39;re stuck with Yet Another 
Behavioral Patch for any of your machines which might be affected by 
this.  Have fun with that.
</p>
<p>
Oh, and, obviously, forget about actually DOING anything over that link 
while it&#39;s being restarted.  If you care about reliability, this is not 
a tenable situation.
</p>
<p>
Once again, if you care about having decent &#34;modern&#34; (as in 2020) wifi 
on a Pi, go get yourself a little USB barnacle that&#39;s supported 
upstream and go on with life.  Or, better yet, just use hardwired 
Ethernet and forget that the thing even has a radio on board.
</p>
<p>
I&#39;ll pour one out for the sanity of anyone who doesn&#39;t have a choice in 
the matter.  At least you&#39;re not suffering by yourself.
</p>

  </body>
</html>
