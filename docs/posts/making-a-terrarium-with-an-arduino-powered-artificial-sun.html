<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://twiddlingbits.net/artificial-sun">Original</a>
    <h1>Making a terrarium with an Arduino-powered artificial sun</h1>
    
    <div id="readability-page-1" class="page"><div id="post-content-parent"><div id="post-content-wrapper"><p>There is something fascinating about observing a miniature world, be it swimming in an aquarium, simulated on a screen, or planted in a terrarium. With this in mind, I decided to build a terrarium with an immersive twist: a programmable set of LEDs whose brightness and color mimic that of the sun.</p>
<p>Let&#39;s explore the hardware, software, and terrarium setup that bring this world to life! üåç</p>

<p>This project uses several hardware components:</p>
<ul>
<li><p>An Arduino board capable of running <a target="_blank" href="https://circuitpython.org/">CircuitPython</a> (<a target="_blank" href="https://www.adafruit.com/product/4900">Adafruit QT Py RP2040</a>)</p>
</li>
<li><p>A compatible real-time clock (<a target="_blank" href="https://www.adafruit.com/product/5189">Adafruit PCF8523</a>)</p>
<ul>
<li>This will also require an appropriate battery</li>
</ul>
</li>
<li><p>A means of connecting them (<a target="_blank" href="https://www.adafruit.com/product/4399">STEMMA QT cable</a>)</p>
</li>
<li><p>A <a target="_blank" href="https://learn.adafruit.com/adafruit-neopixel-uberguide/neopixel-rings">NeoPixel LED ring</a> (<a target="_blank" href="https://www.adafruit.com/product/1586">NeoPixel Ring 24 x 5050</a>)</p>
</li>
<li><p>A means of connecting that to the Arduino board</p>
<ul>
<li>I wanted a way to detach the LED ring from the rest of the assembly so I used a pair of matching Molex PicoBlade-compatible 3-pin cables (such as <a target="_blank" href="https://www.adafruit.com/product/4721">these</a>)</li>
</ul>
</li>
<li><p>An external power supply for the LEDs</p>
</li>
<li><p>A &#34;project box&#34; capable of holding these components</p>
</li>
</ul>
<p>I power both the LED ring and Arduino board via a 5V 2A power supply with a DC power adapter. This requires additional components:</p>
<ul>
<li>A 1000 ¬µF capacitor used across the + and - terminals of the DC adapter, as noted <a target="_blank" href="https://learn.adafruit.com/adafruit-neopixel-uberguide/basic-connections">here</a>:</li>
</ul>
<blockquote>
<p>When using a DC power supply, or an especially large battery, we recommend adding a large capacitor (100 to 1000 ¬µF, 6.3V or higher) across the + and ‚Äì terminals.</p>
</blockquote>
<ul>
<li>A diode (such as the common 1N4007 rectifier diode) between the 5V pin on your board and the power supply, as noted <a target="_blank" href="https://learn.adafruit.com/adafruit-qt-py-2040/pinouts">here</a>:</li>
</ul>
<blockquote>
<p><strong>5V</strong> - This is 5v out from the USB port. <strong>You can also use this as a voltage <em>input</em> but you must have some sort of diode (schottky, signal, power, really anything) between your external power source and this pin with anode to battery, cathode to 5V pin.</strong></p>
</blockquote>
<p>Solder the LED ring input (labeled &#34;DIN&#34; or &#34;DI&#34;) to the <strong>digital pin 5</strong> (labeled &#34;SCL&#34;) on your board, and run the power and ground wires to their appropriate DC adapter terminals. Power the Arduino board with a wire to ground and the diode mentioned above. Make sure the capacitor is connected as required. Lastly, hook up the real-time clock using the STEMMA QT cable. My finished assembly looks like this:</p>
<p><img loading="lazy" src="https://cdn.hashnode.com/res/hashnode/image/upload/v1676230470268/7b818bef-d8ae-43f4-847d-983403d57358.jpeg?auto=compress,format&amp;format=webp" alt=""/></p>
<p>To prepare the project box, I drilled out a hole for the female DC connector and sawed a slot on the opposite side for the LED ring wires:</p>
<p><img loading="lazy" src="https://cdn.hashnode.com/res/hashnode/image/upload/v1676230933808/ca12eb7e-91bc-41b1-9ad8-0f95288e4043.jpeg?auto=compress,format&amp;format=webp" alt=""/></p>
<p>Fit the assembly into the project box:</p>
<p><img loading="lazy" src="https://cdn.hashnode.com/res/hashnode/image/upload/v1676330705945/0133cdce-0d8b-49bd-9356-15eb5e1d3b7b.jpeg?auto=compress,format&amp;format=webp" alt=""/></p>

<blockquote>
<p>This process assumes use of a Linux system and basic experience working with Arduino boards and the command line.</p>
</blockquote>
<p>The software controlling the artificial sun is written in <a target="_blank" href="https://circuitpython.org/">CircuitPython</a>. Follow <a target="_blank" href="https://learn.adafruit.com/adafruit-qt-py-2040/circuitpython">this guide</a> to set it up on a QT Py RP2040 board.</p>
<p>Make sure you <a target="_blank" href="https://github.com/adafruit/Adafruit_CircuitPython_Bundle#use">install the library bundle</a>, then obtain the <a target="_blank" href="https://github.com/jcrd/artificial-sun">source code</a>:</p>
<pre><code>git <span>clone</span> https://github.com/jcrd/artificial-sun
</code></pre>
<p>Assuming the name of your device is <code>CIRCUITPY</code>, you can use an included update script to set the correct current time of your real-time clock and install the code file:</p>
<pre><code><span>cd</span> artificial-sun
./update.sh
</code></pre>
<p>Your sun should now be radiating light (and a little warmth for good measure üåû).</p>
<h2 id="heading-how-does-it-work">How does it work?</h2>
<p>The main logic of the code is in the linear interpolation of a small set of data relating time-of-day to LED light brightness and color.</p>
<pre><code>light_data = [
    
    (<span>0.0</span>, (<span>0.0</span>, (<span>0</span>, <span>0</span>, <span>0</span>, <span>0</span>))),
    (<span>7.0</span>, (<span>0.1</span>, (<span>244</span>, <span>254</span>, <span>169</span>, <span>0</span>))),
    (<span>8.0</span>, (<span>0.2</span>, (<span>243</span>, <span>254</span>, <span>174</span>, <span>0</span>))),
    (<span>13.0</span>, (<span>1.0</span>, (<span>234</span>, <span>254</span>, <span>202</span>, <span>0</span>))),
    (<span>18.0</span>, (<span>0.2</span>, (<span>243</span>, <span>254</span>, <span>174</span>, <span>0</span>))),
    (<span>19.0</span>, (<span>0.1</span>, (<span>244</span>, <span>254</span>, <span>169</span>, <span>0</span>))),
    (<span>24.0</span>, (<span>0.0</span>, (<span>0</span>, <span>0</span>, <span>0</span>, <span>0</span>))),
]
</code></pre>
<p>Its meant to be an approximation of sunrise, midday, and sunset. I expect the data to change as I continue experimenting with it over time.</p>
<p>The lerp function itself is straightforward:</p>
<pre><code><span><span>def</span> <span>lerp</span>(<span>begin, end, t</span>):</span>
    <span>return</span> begin + t * (end - begin)
</code></pre>
<p>It calculates a position between the <code>begin</code> and <code>end</code> values given a percentage <code>t</code>. For example: let&#39;s start at 0 and end at 20; a <code>t</code> value of 0.4 is the value 8.</p>
<p>This function is used to interpolate between the brightness and color values associated with each time-of-day set:</p>
<pre><code><span><span>def</span> <span>get_light_lerp</span>(<span>daytime</span>):</span>
    pt, (pb, pc) = (<span>0</span>, (<span>0</span>, (<span>0</span>, <span>0</span>, <span>0</span>, <span>0</span>)))

    <span>for</span> t, (b, c) <span>in</span> light_data:
        <span>if</span> t == daytime:
            print(<span>&#34;{}: {} @ {}&#34;</span>.format(t, c, b))
            <span>return</span> (b, c)
        <span>if</span> t &lt; daytime:
            pt, pb, pc = t, b, c
            <span>continue</span>
        lt = (daytime - pt) / (t - pt)
        lb = lerp(pb, b, lt)
        lc = tuple(int(lerp(pc[i], v, lt)) <span>for</span> i, v <span>in</span> enumerate(c))
        print(<span>&#34;{} -&gt; {} ({}): {} @ {}&#34;</span>.format(pt, t, lt, lc, lb))
        <span>return</span> (lb, lc)
</code></pre>
<p>Let&#39;s explore the logic imagining its 11 o&#39;clock:</p>
<ul>
<li><p>If the current time matches a set exactly, return the associated data.</p>
</li>
<li><p>Otherwise, loop through the data recording each set with a time less than 11.</p>
</li>
<li><p>When a time greater than 11 is encountered, the last recorded set will be the beginning of the lerp function, while the current set is the end.</p>
<ul>
<li>Given the above data, the beginning and end sets will be at 8 and 13 o&#39;clock respectively.</li>
</ul>
</li>
<li><p>With this, calculate the percentage that describes 11 o&#39;clock:</p>
</li>
</ul>
<p>$$(11 - 8) / (13 - 8) = 0.6$$</p>
<ul>
<li>Now the brightness and color values can be individually interpolated between the two sets using the percentage! ü§Ø</li>
</ul>

<p>The first step of building a terrarium is to select the enclosure itself. I used a generic pentagonal &#34;geometric&#34; terrarium, readily available online and in local hobby stores. The design of your enclosure will also determine if your terrarium is &#34;open&#34; or &#34;closed&#34;:</p>
<ul>
<li><p>An open terrarium allows air to circulate throughout, meaning moisture will evaporate;</p>
</li>
<li><p>A closed terrarium will have a lid of some sort (think: mason jar), meaning moisture will be sealed inside.</p>
</li>
</ul>
<p>This critical difference determines the plants most suitable for your terrarium. I recommend you check out one of the many online guides that go into detail about which plants to select and the ideal makeup of your substrate. As my enclosure is open, I collected the appropriate substrate materials, picked out some succulents, and got to work assembling my world. üåµ</p>
<p>Next, it was time to give it light by attaching the LED ring. There are many ways to go about this. After some failed experimentation, I settled on using corkboard to construct a &#34;lid&#34; for the open face of my enclosure made of two layers glued together with a hole the size of the inner diameter of the LED ring cut out of each so that air is still able to circulate. This only required the use of scissors, a precision knife, and a hot glue gun. Finally, I pushed pins through the LED ring&#39;s PCB holes to fix it to the underside of the corkboard assembly so that it can be easily detached if necessary.</p>
<p>Here&#39;s the final product:</p>
<p><img loading="lazy" src="https://cdn.hashnode.com/res/hashnode/image/upload/v1676231176364/ada8dba7-6411-4c11-9d1c-c71e57737bc0.jpeg?auto=compress,format&amp;format=webp" alt=""/></p>
<p>For more pizzazz, you might consider building something similar out of wood!</p>
<p>Finally, I cut a piece of adhesive hook and loop tape (commonly known by the brand name Velcro) to fit the project box which I attached to the back of the terrarium:</p>
<p><img loading="lazy" src="https://cdn.hashnode.com/res/hashnode/image/upload/v1676330849042/a6c2c0b8-d776-48d9-a21f-d6837519e4c0.jpeg?auto=compress,format&amp;format=webp" alt=""/></p>
<p>Supply power to the DC adapter and step back to revel in the miniature majesty!</p>
<p><img loading="lazy" src="https://cdn.hashnode.com/res/hashnode/image/upload/v1676332096895/a8050cee-78d9-4fe6-b883-82c814cdae06.jpeg?auto=compress,format&amp;format=webp" alt=""/></p>
</div></div></div>
  </body>
</html>
