<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.jetify.com/blog/automated-dev-envs-with-devbox-and-direnv/">Original</a>
    <h1>Automate Project Environments with Devbox and Direnv</h1>
    
    <div id="readability-page-1" class="page"><div id="site-main">
    <article>

        <header>

            

            

            <p>Learn why having an isolated environment is useful, why setting up an environment with Direnv can be tough, and walk through an example of Direnv + Devbox for a sample NodeJS application.</p>

            <div>
                <section>

                    <ul>
                        <li>
                            <a href="https://www.jetify.com/blog/author/mohsen/">
                                <img src="https://res-5.cloudinary.com/jetpack-io/image/upload/q_auto/v1/blog/profile.jpg" alt="Mohsen Ansari"/>
                            </a>
                        </li>
                    </ul>

                    <div>
                        
                        <p><time datetime=" 2023-06-07">Jun 7, 2023</time>
                            <span><span>•</span> 4 min read</span>
                        </p>
                    </div>

                </section>
            </div>

            <figure>
                <img srcset="https://res-5.cloudinary.com/jetpack-io/image/upload/q_auto/v1/blog/tech-group-meeting-flatlay.jpg 300w, https://res-5.cloudinary.com/jetpack-io/image/upload/q_auto/v1/blog/tech-group-meeting-flatlay.jpg 600w,
                    https://res-5.cloudinary.com/jetpack-io/image/upload/q_auto/v1/blog/tech-group-meeting-flatlay.jpg 1000w, https://res-5.cloudinary.com/jetpack-io/image/upload/q_auto/v1/blog/tech-group-meeting-flatlay.jpg 2000w" sizes="(min-width: 1400px) 1400px, 92vw" src="https://res-5.cloudinary.com/jetpack-io/image/upload/q_auto/v1/blog/tech-group-meeting-flatlay.jpg" alt="Group meeting with multiple people working on multiple laptops"/>
            </figure>

        </header>

        <section>
            <p>The challenge of managing multiple projects in the same operating system has been met with many different solutions over the years. We&#39;ve progressed from virtual machines (VirtualBox) to container systems (Docker), and even isolated shells (nix-shell). We built <a href="https://github.com/jetpack-io/devbox">Devbox</a> to make isolated shell environments easy to learn, use, and configure. The combination of easy shell environments with Devbox, combined with convenient environment switching with Direnv makes it simple to manage multiple projects without having their setups interfere or leak into one another.</p><p>In this blog we’re going to explore why having an isolated environment is useful, explain why setting up an environment with Direnv can be tough, and showcase an example with our optimal combination: Direnv + Devbox for a sample NodeJS application.</p><h2 id="why-have-an-isolated-environment-per-project">Why have an isolated environment per project?</h2><p>There are 4 main reasons why an isolated environment is needed:</p><ul><li><strong>Dependency version mismatching</strong>: Each application has its own dependency packages meaning two applications may need two different versions of the same dependency. For example, an enterprise developer may use a stable version of NodeJS for work projects but use an edge version of NodeJS which has newer features for a personal project. In this case, some languages have a version manager (e.g., <code>nvm</code> for NodeJS) but with Devbox there is no need to install a version manager per programming language.</li><li><strong>Application settings</strong>: Each stack might have at least one or two settings that may be different from other applications. For example, you might have <code>DATABASE_PORT</code> and <code>DATABASE_PASSWORD</code> as env variables that are specific to your app.</li><li><strong>Secrets</strong>: Similar to applications settings, your app might have secrets that are required to access 3rd party tools and platforms such as <code>API_KEY</code> and <code>API_SECRET</code></li><li><strong>Compiler options</strong>: Depending on the programming language, your app might need to have specific compiler options to compile for a target CPU architecture, or look for libraries in a specific directory. For example, in C++ you may need to setup <code>LDFLAGS</code> or <code>CPPFLAGS</code> and in Java, you may need to setup <code>JAVA_HOME</code>.</li></ul><p>The listed items above are not the only reasons why you might want to have an isolated environment. Based on the use case, there might be other motivations but regardless, setting up isolated environments can be cumbersome and time-consuming. Let’s explore setting up an environment with Direnv below.</p><h2 id="direnv">Direnv</h2><p><a href="https://direnv.net/">Direnv</a> is a tool that automates configuring environments on a per-directory basis. So that when you <code>cd</code> into a directory, it triggers Direnv to activate a pre-configured environment. It makes it very convenient in managing different environments and easily switching between them just by doing <code>cd dir_name</code> .</p><p>The problem with using Direnv is that despite it being a very useful tool, its setup requires investing time and getting over the Nix ecosystem&#39;s learning curve. In addition to that, each project requires the developer to spend some time writing a <code>.envrc</code> file and maintaining it as the requirements for the project change.</p><h2 id="automatic-devbox-environments-with-direnv">Automatic Devbox Environments with Direnv</h2><p>We at Jetpack loved the convenience of Direnv. So following our philosophy of simplifying complicated tools to make them easy to adopt, we developed an integration between Devbox and Direnv. With this integration, there is no need to setup any <code>.envrc</code> files to use Direnv. Just having Direnv and Devbox installed on your system is enough to initiate a project environment with Devbox, add its dependencies, and integrate it with Direnv just by running <code>devbox generate direnv</code> . That way, whenever you <code>cd</code> to a Devbox + Direnv project, the Devbox environment is automatically setup and ready to go.</p><p>Take a look at the example below to see the simple steps required to setup a sample project with Devbox and Direnv:</p><ol><li>Make sure to have both <a href="https://www.jetpack.io/devbox/docs/quickstart/">Devbox</a> and <a href="https://direnv.net/docs/installation.html#from-binary-builds">Direnv</a> installed.</li><li>In a project directory (or empty dir) run <code>devbox init</code></li><li>Add dependencies to Devbox. For example, <code>devbox add nodejs yarn</code></li><li>Add Direnv integration <code>devbox generate direnv</code></li></ol><p>That’s it! You have a working Devbox environment integrated with Direnv. Now any change done to your Devbox environment via <code>devbox.json</code> is applied by Direnv. Now that we’ve setup the environment, let’s see how we can automate starting a sample NodeJS project:</p><ol><li>Start a yarn project by running <code>yarn init</code> and follow the prompts.</li><li>Add a small web server to your NodeJS project <code>yarn add http-server</code>.</li><li>Edit the <code>&#34;init_hook&#34;</code> section of <code>devbox.json</code> so that it looks like the following:</li></ol><pre><code>{
  &#34;packages&#34;: [
    &#34;nodejs@latest&#34;,
    &#34;yarn@latest&#34;
  ],
  &#34;shell&#34;: {
    &#34;init_hook&#34;: [
      &#34;yarn install&#34;,
      &#34;yarn run http-server&#34;
     ]
  }
}
</code></pre><p>This sets up this project so that every time you cd into this project, all NodeJS dependencies get installed and http-server runs. To test this, <code>cd ..</code> and then <code>cd</code> back into your project directory and see how Direnv setups up your Devbox environment and runs <code>http-server</code>. Use Ctrl+C to stop <code>http-server</code>.</p><h2 id="next-steps">Next Steps</h2><p>Devbox makes creating and working in isolated dev environments simple and easy. Direnv makes switching between multiple environments convenient. So combining the two provides a great experience for setting up and using your dev environments.</p><p>We liked using Direnv so much that we started using it in our development of Devbox. In fact, we use both Devbox and Direnv to develop Devbox! To see it in action check out <code>devbox.json</code> and <code>.envrc</code> files in our <a href="https://github.com/jetify-com/devbox/">Github repo</a>. </p><h2 id="stay-up-to-date-with-jetify">Stay up to Date with Jetify</h2><p>If you&#39;re reading this, we&#39;d love to hear from you about how you&#39;ve been using Devbox for your projects. You can follow us on <a href="https://twitter.com/jetify_com">Twitter</a>, or chat with our developers live on our <a href="https://discord.gg/jetify">Discord Server</a>. We also welcome issues and pull requests on our <a href="https://github.com/jetify-com/devbox">Github Repo</a>.</p>
        </section>


    </article>
    </div></div>
  </body>
</html>
