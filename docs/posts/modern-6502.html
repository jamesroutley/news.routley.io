<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.mikekohn.net/micro/modern_6502.php">Original</a>
    <h1>Modern 6502</h1>
    
    <div id="readability-page-1" class="page"><div><center>
</center>
<p><i>Posted: March 27, 2016</i></p>
<p><b>Introduction</b></p>
<p>
A few years ago while searching for electronic parts, I stumbled on the
<a href="https://www.westerndesigncenter.com">Western Design Center W65C02</a>
processor.  Even though it&#39;s in a DIP packaging, which makes it easy for
a hobbyist like me to breadboard, it would still have required RAM and
other chips to make it useful.  Considering this chip was the first processor
I learned to program on, the 6502 is more like a religious thing for me
so I got two of them.  I ended up mounting one of them on the side of the
door at the entrance to my house for spiritual protection.
</p>

<p>
<a href="https://www.mikekohn.net/micro/pics/misc/6502.jpeg"><img src="https://www.mikekohn.net/micro/pics/misc/6502_thumb.jpeg" alt="6502 chip"/></a>
</p>

<p>A few years later while doing my daily <a href="https://hackaday.com/2015/07/29/review-single-board-65c02-and-65c816-computers/">hackaday.com</a>
reading, I discovered the
<a href="https://wdc65xx.com/65xx-store/sxb-boards/w65c265sxb-engineering-development-system/">W65C265SXB</a>
board, a modern microcontroller with a 6502 (actually 65C816) at its core.
I did a really good job resisting buying one for a while, but eventually
gave in.  To put this board to use I decided to put up this page
with 3 small projects (added a 4th more recently)
to show off some things that can be done with this
newer 6502 chip:</p>

<ul>
<li>LED Blinking (assembly)</li>
<li>Music Playing (Java)</li>
<li>Software SPI DAC Sound Player (assembly)</li>
<li>More Tone Generator (assembly)</li>
</ul>

<p>Besides the 4 projects on this page, this board was also used this board to
record and read data from audio cassettes on my
<a href="https://www.mikekohn.net/micro/tape_data_recorder.php">Tape Data Recorder</a> page and
read chocolate data off a Swedish pancake on my
<a href="https://www.mikekohn.net/micro/pancake_rom.php">PANCAKE-ROM</a> page.</p>

<p>There&#39;s also a <a href="https://www.mikekohn.net/micro/w65c832_fpga.php">W65C832 FPGA</a> project
on this site which is a 32 bit version of a 6502.</p>

<p><b>Boards</b></p>

<p>So there are actually 4 SXB boards to choose from.
I chose the 16 bit 65C816 based board since it can also run 8 bit 6502
programs in emulation mode. There is a version with a pure 6502 core too.
This board is actually pretty loaded...
4 UARTs, lots of IO, 2 tone generators, and a ROM chip
full of routines to make talking to the hardware simpler. Anyone
wanting to play with the programs on this page should get the
<a href="https://wdc65xx.com/65xx-store/sxb-boards/w65c265sxb-engineering-development-system/">W65C265SXB</a> board.
</p>

<p>The tools used to assemble / compile / upload these programs:</p>

<ul>
<li><a href="https://www.mikekohn.net/micro/naken_asm.php">naken_asm</a></li>
<li><a href="https://www.mikekohn.net/micro/java_grinder.php">Java Grinder</a></li>
<li><a href="https://joedavisson.com/">Joe Davisson&#39;s</a>
<a href="https://joedavisson.com/software/easysxb/easysxb.html">EasySXB</a></li>
</ul>

<p>
Need to give Joe +1 for writing the 6502 / 65C816 modules
for <a href="https://www.mikekohn.net/micro/naken_asm.php">naken_asm</a> and
<a href="https://www.mikekohn.net/micro/java_grinder.php">Java Grinder</a>, and for the
nice GUI for uploading software to the board.
</p>

<p><b>Related Projects @mikekohn.net</b></p>


<p><b>LED Blinking</b></p>
<p>It&#39;s an unwritten rule that every first microcontroller project
must be an LED blinking program. This program was written in two different
ways here. The first way is using 65C816 instructions and the second puts
the chip into 65C02 emulation mode (using the instructions &#34;sec&#34; and &#34;xce&#34;)
and is written in 6502 assembly. One thing to not forget is the
&#34;sei&#34; instruction at the top of the program to stop the chip&#39;s interrupt
routine from running. The software does some pretty odd things if this
isn&#39;t done.</p>

<p>To assemble the programs, <a href="https://www.mikekohn.net/micro/naken_asm.php">naken_asm</a> is used
and then
<a href="https://github.com/JoeDavisson">Joe&#39;s</a>
<a href="https://hackaday.io/project/9462-easysxb">EasySXB</a> GUI
is used to upload them to the board.
After uploading the hex files for the LED blinking program to the
SXB board, simply need to put 0x1000 (the .org starting address of
the software) in the textbox labeled &#34;Address:&#34; and press the JML (jump long)
button. Before trying to upload any new software to the board, just
need to remember to push the reset button on the board.</p>

<p>
Source code:</p>

<p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/E936wkrpAgs" frameborder="0" allowfullscreen=""></iframe>
</p>

<p>
Here&#39;s a video of how to start up
<a href="https://hackaday.io/project/9462-easysxb">EasySXB</a>
and upload the led_blink_65c816.hex LED blinking demo to a board.
<a href="https://youtu.be/E936wkrpAgs">https://youtu.be/E936wkrpAgs</a>.
</p>

<p><b>Music Player</b></p>
<p>The W65C265 chip has 2 tone generators built in, so I decided for
a second project to play some music. The tone generators, unlike
toggling an I/O pin with a timer, generates a sine wave. Since this
project is pretty similar to a previous
<a href="https://www.mikekohn.net/micro/midi_to_sn76489.php">SN76489 MIDI player</a> project
I ended up
using the same C program to play the .mid files. The idea is, the
C program on the PC parses the .mid file and sends 2 bytes over to
the chip, the first byte tells it which channel and volume to play at
and the second byte tells the frequency using a MIDI representation.
</p>

<p>The C .mid player was designed for the original
<a href="https://www.mikekohn.net/micro/midi_to_sn76489.php">SN76489 MIDI player</a>
circuit, so it really wants to talk to a circuit with 2 sound chips that
have 3 voices each.  In this case, the SXB board appears as 2 channels with
one voice each.  So only having 2 voices heavily limited the .mid files
that would sound nice.  It ended up the Bach Invention 13 sounds good with
just two channels, so I used that one in the video below.  It is possible
that I could have used the extra timers on the chip to get more
voices with a square waveforms, but I didn&#39;t want to create extra hardware
for mixing channels.</p>

<p>Unlike the LED blinking programs which are written in assembly, I
wanted to show off the capability of
<a href="https://www.mikekohn.net/micro/java_grinder.php">Java Grinder</a> for the 65C816 so
this program is written in Java. I can already imagine all the odd
comments about writing Java for a 65C816, but it&#39;s actually pretty slick.
There&#39;s even an
Atari 2600 game <a href="https://joedavisson.com/software/java/java.html">Space Revenge</a>
written in Java with <a href="https://www.mikekohn.net/micro/java_grinder.php">Java Grinder</a> for the 6502.
</p>

<p>The thing I find most interesting is quality of the sound.  Those tone
generators sound really nice with the sine waveform.  I still like the
sound of the <a href="https://www.mikekohn.net/micro/midi_to_sn76489.php">SN76489</a> (see the video and mp3&#39;s
on that page to compare) but the
W65CSXB is really nice on the ears (minus having to turn those guitar
amps up a little too high in order to capture the sound with my
camera).</p>

<p>
Source code:</p>

<p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/MCuxZxErThU" frameborder="0" allowfullscreen=""></iframe>
</p>

<p>
Here&#39;s a video of the software playing Bach&#39;s Invention 13 (aka, the Commodore
64 theme song).
<a href="https://youtu.be/MCuxZxErThU">https://youtu.be/MCuxZxErThU</a>.
</p>

<p><b>Software SPI</b></p>
<p>There are at least two famous robots that run on 6502:
<a href="https://spectrum.ieee.org/semiconductors/processors/the-truth-about-benders-brain">Futurama&#39;s Bender</a>
and
<a href="https://en.wikipedia.org/wiki/File:Terminator_HUD_with_6502_assembly_language.jpg">The Terminator</a>.
I thought it might be fun to write some 6502 code for part of one of these
robots, so I downloaded a sound sample of The Terminator and loaded it
on this chip along with some code to communicate with an MCP4921 DAC
chip.</p>

<p>I wrote two programs here, one with a very generic software SPI and
one optimized for playing sound.  I&#39;m not sure if anyone would care
if I used a sound sample from The Terminator, so I left it out of the
git repository.  To assemble this project, download a .wav file and
run the following commands:</p>

<p>
sox ill_be_back.wav -b 16 -r 4000 out.wav</p>

<p>The convert_sound program is included in the
<a href="https://hackaday.io/project/9462-easysxb">EasySXB</a>
git repository.  It
converts 16 bit sound samples from a .wav file to 12 bit DAC format
(a big endian 16 bit number where the upper 4 bits are always 0x3 and
lower 12 bits are the sound sample).
In the play_sound.asm source file, uncomment the .binfile line and
comment out the .db line.  Type make.</p>

<p>To hook up the MCP4921 SPI DAC chip, connect:</p>
<ul>
<li>1) Vdd to +5v (P4x Pin 1)</li>
<li>2) /CS to P40 (P4x Pin 3)</li>
<li>3) SCK to P41 (P4x Pin 4)</li>
<li>4) SDI to P42 (P4x Pin 5)</li>
<li>5) /LDAC to GND (P4x Pin 2)</li>
<li>6) VrefA to +5v (P4x Pin 1)</li>
<li>7) AVss to GND (P4x Pin 2)</li>
<li>8) VoutA to 10uF cap to amplifier</li>
</ul>

<p>
Source:</p>

<p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/di7iV8C51F4" frameborder="0" allowfullscreen=""></iframe>
</p>

<p>
Here&#39;s a 6502 programmed to be a part of The Terminator. Note that when
I&#39;m running this program I press JSL instead of JML. JML jumps to the
location while JSL jumps to the location as a subroutine. The rts
instruction should bring control back to the ROM when speech stops.
<a href="https://youtu.be/di7iV8C51F4">https://youtu.be/di7iV8C51F4</a>.
</p>

<p><b>More Tone Generator</b></p>

<p>I took a box that SparkFun sent me and installed
<a href="https://www.sparkfun.com/products/10302">4 buttons</a>
I got on their website.  I soldered wires to the button, connected to
a breadboard, and connected the I/O pins of Port 5 of the W65C265SXB
board to the buttons. Each input line is pulled up with a 10k
resistor and will short to ground when the buttons are pushed.
</p>

<p>
<a href="https://www.mikekohn.net/micro/pics/misc/synthy502.jpeg"><img src="https://www.mikekohn.net/micro/pics/misc/synthy502_thumb.jpeg" alt="W65C265SXB and MiniMarshall amps"/></a>
</p>

<p>The firmware is written in 65C816 assembly and is programmed to be the
first 2 notes (dyads) of the chords F major, B diminished, G major, and
E minor. Buttons can be pushed with my foot while playing guitar (not as
as easy as I thought it would be).</p>

<p>
Source code:</p>

<p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/zBqONTSSqWk" frameborder="0" allowfullscreen=""></iframe>
</p>

<p>
Video of me playing guitar over the tone generator sounds.
<a href="https://youtu.be/zBqONTSSqWk">https://youtu.be/zBqONTSSqWk</a>
</p>

<p>
Copyright 1997-2025 - <a href="https://www.mikekohn.net/">Michael Kohn</a>
</p>

</div></div>
  </body>
</html>
