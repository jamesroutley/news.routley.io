<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/randoneering/pgFirstAid">Original</a>
    <h1>PgFirstAid: PostgreSQL function for improving stability and performance</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<blockquote>
<p dir="auto">Easy-to-deploy, open source PostgreSQL function that provides a prioritized list of actions to improve database stability and performance.</p>
</blockquote>
<p dir="auto">Inspired by Brent Ozar&#39;s <a href="https://github.com/BrentOzarUK/SQL-Server-First-Responder-Kit">FirstResponderKit</a> for SQL Server, <strong>pgFirstAid</strong> is designed for everyone to use—not just DBAs! Get actionable health insights from your PostgreSQL database in seconds.</p>

<ul dir="auto">
<li><strong>Zero Dependencies</strong> - Single SQL function, no external tools required</li>
<li><strong>Comprehensive Checks</strong> - 12 (and growing!) built-in health checks covering critical performance and stability issues</li>
<li><strong>Prioritized Results</strong> - Issues ranked by severity (CRITICAL → HIGH → MEDIUM → LOW → INFO)</li>
<li><strong>Actionable Recommendations</strong> - Each issue includes specific remediation steps</li>
<li><strong>Documentation Links</strong> - Direct links to official PostgreSQL documentation for deeper learning</li>
</ul>


<div dir="auto" data-snippet-clipboard-copy-content="-- Copy and paste the function definition into your PostgreSQL database
-- Then run it:
SELECT * FROM pg_firstAid();"><pre><span><span>--</span> Copy and paste the function definition into your PostgreSQL database</span>
<span><span>--</span> Then run it:</span>
<span>SELECT</span> <span>*</span> <span>FROM</span> pg_firstAid();</pre></div>
<p dir="auto">That&#39;s it! No configuration needed. Deploy as a user with the highest possible priviledges (in your environment) to avoid issues.</p>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>severity</th>
<th>category</th>
<th>check_name</th>
<th>object_name</th>
<th>issue_description</th>
<th>current_value</th>
<th>recommended_action</th>
<th>documentation_link</th>
</tr>
</thead>
<tbody>
<tr>
<td>CRITICAL</td>
<td>Table Structure</td>
<td>Missing Primary Key</td>
<td>public.users</td>
<td>Table missing a primary key...</td>
<td>No primary key defined</td>
<td>Add a primary key or unique constraint...</td>
<td><a href="https://www.postgresql.org/" rel="nofollow">https://www.postgresql.org/</a>...</td>
</tr>
<tr>
<td>HIGH</td>
<td>Statistics</td>
<td>Missing Statistics</td>
<td>public.orders</td>
<td>Table has never been analyzed...</td>
<td>Last analyze: Never</td>
<td>Run ANALYZE on this table...</td>
<td><a href="https://www.postgresql.org/" rel="nofollow">https://www.postgresql.org/</a>...</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>


<ol dir="auto">
<li><strong>Missing Primary Keys</strong> - Tables without primary keys that can cause replication issues and poor performance</li>
<li><strong>Unused Large Indexes</strong> - Indexes consuming significant disk space but never used (&gt;10MB, 0 scans)</li>
</ol>

<ol start="3" dir="auto">
<li><strong>Table Bloat</strong> - Tables with &gt;20% bloat affecting performance (tables &gt;100MB)</li>
<li><strong>Missing Statistics</strong> - Tables never analyzed, leaving the query planner without statistics</li>
<li><strong>Duplicate Indexes</strong> - Multiple indexes with identical or overlapping column sets</li>
</ol>

<ol start="6" dir="auto">
<li><strong>Outdated Statistics</strong> - Table statistics older than 7 days with significant modifications</li>
<li><strong>Low Index Efficiency</strong> - Indexes with poor selectivity (scan-to-tuple ratio &gt;1000)</li>
<li><strong>Excessive Sequential Scans</strong> - Tables with high sequential scan activity that may benefit from indexes</li>
<li><strong>High Connection Count</strong> - More than 50 active connections potentially impacting performance</li>
</ol>

<ol start="10" dir="auto">
<li><strong>Missing Foreign Key Indexes</strong> - Foreign key constraints without supporting indexes for efficient joins</li>
</ol>

<ol start="11" dir="auto">
<li><strong>Database Size</strong> - Current database size and growth monitoring</li>
<li><strong>PostgreSQL Version</strong> - Version information and configuration details</li>
</ol>


<div dir="auto" data-snippet-clipboard-copy-content="-- Show only critical issues
SELECT * FROM pg_firstAid() WHERE severity = &#39;CRITICAL&#39;;

-- Show critical and high priority issues
SELECT * FROM pg_firstAid() WHERE severity IN (&#39;CRITICAL&#39;, &#39;HIGH&#39;);"><pre><span><span>--</span> Show only critical issues</span>
<span>SELECT</span> <span>*</span> <span>FROM</span> pg_firstAid() <span>WHERE</span> severity <span>=</span> <span><span>&#39;</span>CRITICAL<span>&#39;</span></span>;

<span><span>--</span> Show critical and high priority issues</span>
<span>SELECT</span> <span>*</span> <span>FROM</span> pg_firstAid() <span>WHERE</span> severity <span>IN</span> (<span><span>&#39;</span>CRITICAL<span>&#39;</span></span>, <span><span>&#39;</span>HIGH<span>&#39;</span></span>);</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="-- Focus on index-related issues
SELECT * FROM pg_firstAid() WHERE category LIKE &#39;%Index%&#39;;

-- Check table maintenance issues
SELECT * FROM pg_firstAid() WHERE category = &#39;Table Maintenance&#39;;"><pre><span><span>--</span> Focus on index-related issues</span>
<span>SELECT</span> <span>*</span> <span>FROM</span> pg_firstAid() <span>WHERE</span> category <span>LIKE</span> <span><span>&#39;</span>%Index%<span>&#39;</span></span>;

<span><span>--</span> Check table maintenance issues</span>
<span>SELECT</span> <span>*</span> <span>FROM</span> pg_firstAid() <span>WHERE</span> category <span>=</span> <span><span>&#39;</span>Table Maintenance<span>&#39;</span></span>;</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="SELECT severity, COUNT(*) as issue_count
FROM pg_firstAid()
GROUP BY severity
ORDER BY MIN(CASE severity
    WHEN &#39;CRITICAL&#39; THEN 1
    WHEN &#39;HIGH&#39; THEN 2
    WHEN &#39;MEDIUM&#39; THEN 3
    WHEN &#39;LOW&#39; THEN 4
    ELSE 5 END);"><pre><span>SELECT</span> severity, <span>COUNT</span>(<span>*</span>) <span>as</span> issue_count
<span>FROM</span> pg_firstAid()
<span>GROUP BY</span> severity
<span>ORDER BY</span> <span>MIN</span>(CASE severity
    WHEN <span><span>&#39;</span>CRITICAL<span>&#39;</span></span> THEN <span>1</span>
    WHEN <span><span>&#39;</span>HIGH<span>&#39;</span></span> THEN <span>2</span>
    WHEN <span><span>&#39;</span>MEDIUM<span>&#39;</span></span> THEN <span>3</span>
    WHEN <span><span>&#39;</span>LOW<span>&#39;</span></span> THEN <span>4</span>
    ELSE <span>5</span> END);</pre></div>

<ul dir="auto">
<li><strong>Daily</strong> - Quick health check as part of morning routine</li>
<li><strong>Before Deployment</strong> - Catch potential issues before they impact production</li>
<li><strong>After Major Changes</strong> - Verify database health after schema modifications or data migrations</li>
<li><strong>Performance Troubleshooting</strong> - First step when investigating slow queries or system issues</li>
<li><strong>Capacity Planning</strong> - Regular monitoring to track database growth trends</li>
</ul>

<p dir="auto"><strong>Read Before Acting</strong></p>
<ul dir="auto">
<li>Always review recommendations carefully before making changes. I have been supporting Postgres databases for close to a decade, but I learn something new each day</li>
<li>Test in a non-production environment first</li>
<li>Some operations (like VACUUM FULL) require maintenance windows</li>
<li>Never drop an index without validating its usage patterns over time</li>
</ul>
<p dir="auto"><strong>Permissions</strong></p>
<ul dir="auto">
<li>Requires read access to system catalogs (<code>pg_catalog</code>)</li>
<li>Works with standard user permissions for most checks</li>
<li>Some checks may return fewer results for non-superuser accounts</li>
</ul>

<p dir="auto">pgFirstAid is designed to be lightweight and safe to run on production systems:</p>
<ul dir="auto">
<li>Read-only operations (no modifications to your data or schema)</li>
<li>Uses system catalog views that are already cached</li>
<li>Typical execution time: &lt;1 second on most databases</li>
<li>No locking or blocking of user queries</li>
</ul>

<ul dir="auto">
<li><strong>PostgreSQL 10+</strong> - Fully supported, but only testing on 15+. This will change as versions are deprecated</li>
<li><strong>PostgreSQL 9.x</strong> - Most features work (minor syntax adjustments may be needed)</li>
<li>Works with all PostgreSQL-compatible databases (Amazon RDS, Aurora, Azure Database, etc.)</li>
</ul>

<p dir="auto">Found a bug? Have an idea for a new health check? Let me know! I want this to grow to be a tool that is available for all, accidental DBA or not.</p>

<p dir="auto">GPLv3</p>

<p dir="auto">Inspired by <a href="https://github.com/BrentOzarUK/SQL-Server-First-Responder-Kit">Brent Ozar&#39;s FirstResponderKit</a> for SQL Server. Thank you to the SQL Server community for pioneering accessible database health monitoring!</p>
<p dir="auto">Dave-IYKYK</p>
<hr/>
<p dir="auto"><strong>Made with ☕ for the PostgreSQL and Open Source community</strong></p>
</article></div></div>
  </body>
</html>
