<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/rorosen/zeekstd">Original</a>
    <h1>Show HN: Zeekstd â€“ Rust Implementation of the ZSTD Seekable Format</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://github.com/rorosen/zeekstd/actions/workflows/nix.yaml"><img src="https://github.com/rorosen/zeekstd/actions/workflows/nix.yaml/badge.svg" alt="Nix"/></a>
<a href="https://github.com/rorosen/zeekstd/actions/workflows/rust.yaml"><img src="https://github.com/rorosen/zeekstd/actions/workflows/rust.yaml/badge.svg" alt="Rust"/></a>
<a href="https://crates.io/crates/zeekstd" rel="nofollow"><img src="https://camo.githubusercontent.com/75043795470df7afca005536a269a9cb3211873754eca95ee957f2e9cd744cf9/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f7a65656b7374642e737667" alt="Crates.io" data-canonical-src="https://img.shields.io/crates/v/zeekstd.svg"/></a>
<a href="https://docs.rs/zeekstd" rel="nofollow"><img src="https://camo.githubusercontent.com/641cbaa75bddc07afc31e93ed7d798e3b6efcbbaf0ce1f6aa6baff7289be9a0b/68747470733a2f2f646f63732e72732f7a65656b7374642f62616467652e737667" alt="Documentation" data-canonical-src="https://docs.rs/zeekstd/badge.svg"/></a></p>
<p dir="auto">A Rust implementation of the Zstandard Seekable Format.</p>
<p dir="auto">The seekable format splits compressed data into a series of independent &#34;frames&#34;, each compressed
individually, so that decompression of a section in the middle of an archive only requires zstd to
decompress at most a frame&#39;s worth of extra data, instead of the entire archive.</p>
<p dir="auto">Zeekstd makes additions to the seekable format by implementing an updated version of the
<a href="https://github.com/rorosen/zeekstd/blob/main/seekable_format.md">specification</a>, however, it is fully compatible with the
<a href="https://github.com/facebook/zstd/blob/dev/contrib/seekable_format/zstd_seekable_compression_format.md">initial version of the seekable format</a>.</p>

<p dir="auto">A seekable <code>Encoder</code> will start new frames automatically at 2MiB of uncompressed data. See
<code>EncodeOptions</code> to change this and other compression parameters.</p>
<div dir="auto" data-snippet-clipboard-copy-content="use std::{fs::File, io};
use zeekstd::Encoder;

fn main() -&gt; zeekstd::Result&lt;()&gt; {
    let mut input = File::open(&#34;data&#34;)?;
    let output = File::create(&#34;seekable.zst&#34;)?;
    let mut encoder = Encoder::new(output)?;
    io::copy(&amp;mut input, &amp;mut encoder)?;
    // End compression and write the seek table to the end of the seekable
    encoder.finish()?;

    Ok(())
}"><pre><span>use</span> std<span>::</span><span>{</span>fs<span>::</span><span>File</span><span>,</span> io<span>}</span><span>;</span>
<span>use</span> zeekstd<span>::</span><span>Encoder</span><span>;</span>

<span>fn</span> <span>main</span><span>(</span><span>)</span> -&gt; zeekstd<span>::</span><span>Result</span><span>&lt;</span><span>(</span><span>)</span><span>&gt;</span> <span>{</span>
    <span>let</span> <span>mut</span> input = <span>File</span><span>::</span><span>open</span><span>(</span><span>&#34;data&#34;</span><span>)</span>?<span>;</span>
    <span>let</span> output = <span>File</span><span>::</span><span>create</span><span>(</span><span>&#34;seekable.zst&#34;</span><span>)</span>?<span>;</span>
    <span>let</span> <span>mut</span> encoder = <span>Encoder</span><span>::</span><span>new</span><span>(</span>output<span>)</span>?<span>;</span>
    io<span>::</span><span>copy</span><span>(</span><span>&amp;</span><span>mut</span> input<span>,</span> <span>&amp;</span><span>mut</span> encoder<span>)</span>?<span>;</span>
    <span>// End compression and write the seek table to the end of the seekable</span>
    encoder<span>.</span><span>finish</span><span>(</span><span>)</span>?<span>;</span>

    <span>Ok</span><span>(</span><span>(</span><span>)</span><span>)</span>
<span>}</span></pre></div>

<p dir="auto">By default, the seekable <code>Decoder</code> decompresses everything, from the first to the last frame, but
can also be configured to decompress only specific frames.</p>
<div dir="auto" data-snippet-clipboard-copy-content="use std::{fs::File, io};
use zeekstd::Decoder;

fn main() -&gt; zeekstd::Result&lt;()&gt; {
    let input = File::open(&#34;seekable.zst&#34;)?;
    let mut output = File::create(&#34;decompressed&#34;)?;
    let mut decoder = Decoder::new(input)?;
    // Decompress everything
    io::copy(&amp;mut decoder, &amp;mut output)?;

    let mut partial = File::create(&#34;partial&#34;)?;
    // Decompress only specific frames
    decoder.set_lower_frame(2);
    decoder.set_upper_frame(5);
    io::copy(&amp;mut decoder, &amp;mut partial)?;

    Ok(())
}"><pre><span>use</span> std<span>::</span><span>{</span>fs<span>::</span><span>File</span><span>,</span> io<span>}</span><span>;</span>
<span>use</span> zeekstd<span>::</span><span>Decoder</span><span>;</span>

<span>fn</span> <span>main</span><span>(</span><span>)</span> -&gt; zeekstd<span>::</span><span>Result</span><span>&lt;</span><span>(</span><span>)</span><span>&gt;</span> <span>{</span>
    <span>let</span> input = <span>File</span><span>::</span><span>open</span><span>(</span><span>&#34;seekable.zst&#34;</span><span>)</span>?<span>;</span>
    <span>let</span> <span>mut</span> output = <span>File</span><span>::</span><span>create</span><span>(</span><span>&#34;decompressed&#34;</span><span>)</span>?<span>;</span>
    <span>let</span> <span>mut</span> decoder = <span>Decoder</span><span>::</span><span>new</span><span>(</span>input<span>)</span>?<span>;</span>
    <span>// Decompress everything</span>
    io<span>::</span><span>copy</span><span>(</span><span>&amp;</span><span>mut</span> decoder<span>,</span> <span>&amp;</span><span>mut</span> output<span>)</span>?<span>;</span>

    <span>let</span> <span>mut</span> partial = <span>File</span><span>::</span><span>create</span><span>(</span><span>&#34;partial&#34;</span><span>)</span>?<span>;</span>
    <span>// Decompress only specific frames</span>
    decoder<span>.</span><span>set_lower_frame</span><span>(</span><span>2</span><span>)</span><span>;</span>
    decoder<span>.</span><span>set_upper_frame</span><span>(</span><span>5</span><span>)</span><span>;</span>
    io<span>::</span><span>copy</span><span>(</span><span>&amp;</span><span>mut</span> decoder<span>,</span> <span>&amp;</span><span>mut</span> partial<span>)</span>?<span>;</span>

    <span>Ok</span><span>(</span><span>(</span><span>)</span><span>)</span>
<span>}</span></pre></div>

<p dir="auto">This repo also contains a <a href="https://github.com/rorosen/zeekstd/blob/main/cli">CLI tool</a> that uses the library.</p>

<ul dir="auto">
<li>The zstd C library is under a dual BSD/GPLv2 license.</li>
<li>Zeekstd is under a BSD 2-Clause License.</li>
</ul>
</article></div></div>
  </body>
</html>
