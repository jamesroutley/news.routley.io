<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.blog/changelog/2022-08-04-commit-comments-no-longer-appear-in-the-pull-request-timeline/">Original</a>
    <h1>Commit comments no longer appear in the pull request timeline</h1>
    
    <div id="readability-page-1" class="page"><div id="changelog-single-content-66405">
        
<p><code>npm query</code> is a new top-level command as of <a href="https://github.com/npm/cli/releases/tag/v8.16.0">npm v8.16.0</a> which accepts a <strong>Dependency Selector</strong> (as defined in the <a href="https://docs.npmjs.org/cli/v8/using-npm/dependency-selectors#dependency-selector-syntax-v100">Dependency Selector Syntax Specification</a>) &amp; returns a filtered JSON Array/NodeList of dependencies from your project. We believe this capability has been a missing piece of the package management ecosystem; With its introduction we hope to unlock the potential for developers to self-serve in asking new, complex questions about their dependencies, their relationships &amp; associative metadata.</p>
<p>For many JavaScript developers, the <strong>Dependency Selector Syntax</strong> will look <em>very</em> familiar as it is actually an adapted form of <strong>CSS</strong>. We leveraged this existing, known language &amp; its operators to make disparate package information broadly accessible.</p>
<h4 id="example-uses" id="example-uses">Example Uses:<a href="#example-uses" aria-label="Example Uses:"></a></h4>
<p>If I wanted to list all of my dependencies (similar to <code>npm list --all</code>) I can run:</p>
<pre><code>npm query &#34;*&#34;</code></pre>
<p>If I wanted to find every version of <code>react</code> &amp; <code>lodash</code> in my project I can run:</p>
<pre><code>npm query &#34;#react, #lodash&#34;</code></pre>
<p>If I wanted to find all <code>react</code> versions not-defined as a peer dependency I can run:</p>
<pre><code>npm query &#34;#react:not(.peer)&#34;</code></pre>
<p>If I wanted to find all the dependencies in my project that used an <code>MIT</code> license I&#39;d change that query to be:</p>
<pre><code>npm query &#34;[license=MIT]&#34;</code></pre>
<p>If I wanted to find <strong>all</strong> the git dependencies in my project I can run:</p>
<pre><code>npm query &#34;:type(git)&#34;</code></pre>
<p>If I wanted to find out which of my transitive dependencies used a <code>postinstall</code> script I could run:</p>
<pre><code>npm query &#34;:attr(scripts, [postinstall]):not(:root &gt; *)&#34;</code></pre>
<hr/>
<h3 id="programmatic-usage" id="programmatic-usage">Programmatic Usage<a href="#programmatic-usage" aria-label="Programmatic Usage"></a></h3>
<p>We know many developers in the ecosystem will also want to leverage this new syntax themselves, so we&#39;ve built it right into the programmatic brain of the CLI. Under the hood, we’ve added a new <code>.querySelectorAll()</code> method to the existing <code>Node</code> Class we use in the <a href="https://github.com/npm/cli/tree/latest/workspaces/arborist"><code>@npmcli/arborist</code></a> library. Tooling authors can now load up &amp; query their dependencies just like we do.</p>
<pre><code>// index.js
const Arborist = require(&#39;@npmcli/arborist&#39;)
const arb = new Arborist({})

arb.loadActual((tree) =&gt; {
  // query all workspaces
  const results = await tree.querySelectorAll(&#39;.workspace&#39;)
  console.log(results)
})</code></pre>
<p>You can learn more about the syntax &amp; usage in our documentation here: <a href="https://docs.npmjs.org/cli/v8/using-npm/dependency-selectors">https://docs.npmjs.org/cli/v8/using-npm/dependency-selectors</a></p>
<h3 id="whats-next" id="whats-next">What&#39;s next?<a href="#whats-next" aria-label="What&#39;s next?"></a></h3>
<p>Looking ahead we’ve got work planned to add new pseudo states &amp; selectors based on registry metadata that should unlock another host of capabilities aimed at auditing (examples include: <code>:outdated</code> <code>:deprecated</code> <code>:vulnerable</code> <code>:cve()</code> &amp; <code>:cwe()</code>). As documented in the <a href="https://github.com/npm/rfcs/blob/3d5b2130504139bdc8a3b599923aa07d2ff79c96/accepted/0000-dependency-selector-syntax.md">original RFC proposal</a> we will also consider supporting a <code>query</code> flag or reading from <code>stdin</code> to existing commands.</p>

      </div></div>
  </body>
</html>
