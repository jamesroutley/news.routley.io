<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jakob.space/blog/i-love-my-pinephone.html">Original</a>
    <h1>I Love My PinePhone</h1>
    
    <div id="readability-page-1" class="page"><div id="text-org855bfb3">
<p>
What one might expect to follow from &#34;it&#39;s easy to develop for the PinePhone
because you&#39;re writing applications as if you were writing them for your
workstation&#34; is that it should be relatively easy to port existing applications
as well. And this is indeed the case. The compile times can be painful, but I
was successful in cross-compiling <a href="https://github.com/diamondburned/gtkcord4">diamondburned&#39;s gtkcord4</a> â€“ which has no
existing Alpine package to my knowledge â€“ to run on the PinePhone.
</p>

<div>
<pre>


<span>pkgname</span>=gtkcord4
<span>pkgver</span>=0.0.2
<span>pkgrel</span>=0
<span>pkgdesc</span>=<span>&#34;GTK4 Discord client in Go&#34;</span>
<span>url</span>=<span>&#34;https://github.com/diamondburned/gtkcord4&#34;</span>
<span>arch</span>=<span>&#34;all&#34;</span>
<span>license</span>=<span>&#34;GPL-3.0&#34;</span>
<span>makedepends</span>=<span>&#34;gtk4.0-dev gobject-introspection-dev libcanberra-dev go&#34;</span>
<span>source</span>=<span>&#34;$pkgname-$pkgver.tar.gz::https://github.com/diamondburned/gtkcord4/archive/refs/tags/v${pkgver}.tar.gz&#34;</span>

<span>build</span>() {
    go build
}

<span>package</span>() {
    install -D -m755 $<span>pkgname</span> <span>&#34;$pkgdir&#34;</span>/usr/bin/$<span>pkgname</span>
}

<span>sha512sums</span>=<span>&#34;</span>
<span>1c0465f4c2d54794551811c0a536b610a51d3f795c403af3cf10954a46770b42d1aadef4709818f935aa54e2b413052546bdde5214f44e89d5ad2e2d7cbdf514  gtkcord4-0.0.2.tar.gz</span>
<span>&#34;</span>
</pre>
</div>

<p>
The above is all it took. I initialized <code>pmbootstrap</code>, made a directory named
<code>gtkcord4</code> under <code>cache_git/pmaports/main</code>, ran <code>pmbootstrap build --arch,=aarch64
gktcord4</code>, and a couple hours later and I had a <code>gtkcord4-0.0.2-r0.apk</code> sitting
under <code>packages/v21.12/aarch64</code>.
</p>

<p>
I&#39;m not sure diamondburned ever anticipated that gtkcord4 would be running on a
mobile device, but thanks to their choice to use GTK4, I didn&#39;t have to make any
changes to the code and it still runs great on my device.
</p>


<figure id="org63babd3">
<img src="https://jakob.space/static/image/gtkcord4-on-pinephone.png" alt="[10:46 AM] Jakob: If you managed to get enough samples, do you think you could do a TEMPEST-like attack on USB? [Line Break] [10:47 AM] Ergodic: I don&#39;t see why not [Line Break] [10:47 AM] Jakob: Or serial, or any other standard where the connection doesn&#39;t have a lot to keep it from being leaky [Line Break] [10:47 AM] Ergodic: I think Israel can dump ram from far away right? [Line Break] [10:47 AM] Ergodic: So pretty much anything [Line Break] [10:47 AM] Ergodic: Well [Line Break] [10:48 AM] Ergodic: Actually [Line Break] [10:48 AM] Ergodic: Wait [Line Break] [10:48 AM] Ergodic: With um [Line Break] [10:48 AM] Ergodic: A HdMI it doesn&#39;t matter if some data is wrong cuz you can keep resampling, same with ram [Line Break] [10:48 AM] Ergodic: But you can&#39;t with USB unless they&#39;re doing the same thing 40 times in a row ðŸ‘€ [Line Break] [10:49 AM] Ergodic: Like depending on the protocol, how accurate do you wanna be"/>

<figcaption><span>Figure 15: </span>gtkcord4 running on the PinePhone, showing a conversation between myself and my friend.</figcaption>
</figure>

<p>
Some applications might need to be modified to work well on a touchscreen. I
haven&#39;t had to do that yet, and even if I did, I would expect it to be a
difficult topic to cover in this (already quite long) article. The part that I
will elaborate on is how we got to that magic code block above. The gtkcord4
example is a little boring because of how little it takes to invoke the Go build
system,<sup><a role="doc-backlink" id="fnr.15" href="#fn.15">15</a></sup> so let&#39;s port <a href="https://openxcom.org/">OpenXCOM</a> instead. I&#39;ll start from scratch and
document my process as I go.
</p>

<p>
Speaking of process, this is basically what I follow:
</p>

<ol>
<li>Determine if the software in question is already packaged in another
source-based distribution (basically Gentoo or the Arch AUR).
<ol>
<li>If so, translate the recipe to APKBUILD. In the case of Gentoo, figure out
what set of <code>USE</code> flags &#34;make sense&#34; as a default.</li>
<li>Use <a href="https://pkgs.alpinelinux.org/packages">pkgs.alpinelinux.org</a> to map each dependency in the original package
spec to an Alpine dependency.</li>
</ol></li>
<li>If it isn&#39;tâ€¦
<ol>
<li>Find a skeleton APKBUILD (like the &#34;hello world&#34; example in the
<a href="#orga9caf4c">&#34;Building and Installing the Application on PostmarketOS&#34;</a> section).</li>
<li>Fill it in with the instructions to compile from upstream. I find you need
to specify <code>build</code> and <code>package</code> as the bare minimum if you explicitly disable
<code>check</code>.</li>
<li>Guess-and-check for dependencies. Sometimes upstream will be good about
enumerating them, sometimes not so much.</li>
</ol></li>
</ol>

<p>
I know that <a href="https://packages.gentoo.org/packages/games-engines/openxcom">openxcom is packaged in Gentoo</a>, so we&#39;ll start there.
</p>

<div>
<pre>



<span>EAPI</span>=7

inherit cmake xdg-utils

<span>DESCRIPTION</span>=<span>&#34;Open-source reimplementation of the popular UFO: Enemy Unknown&#34;</span>
<span>HOMEPAGE</span>=<span>&#34;https://openxcom.org/&#34;</span>

<span>if</span> [[ ${<span>PV</span>} == *9999 ]]; <span>then</span>
    inherit git-r3
    <span>EGIT_REPO_URI</span>=<span>&#34;https://github.com/SupSuper/OpenXcom.git&#34;</span>
<span>else</span>
    <span>COMMIT</span>=<span>&#34;ea9ac466221f8b4f8974d2db1c42dc4ad6126564&#34;</span>
    <span>SRC_URI</span>=<span>&#34;https://github.com/SupSuper/OpenXcom/archive/${COMMIT}.tar.gz -&gt; ${P}.tar.gz&#34;</span>
    <span>KEYWORDS</span>=<span>&#34;~amd64 ~arm64 ~x86&#34;</span>
    <span>S</span>=<span>&#34;${WORKDIR}/OpenXcom-${COMMIT}&#34;</span>
<span>fi</span>

<span>LICENSE</span>=<span>&#34;GPL-3+ CC-BY-SA-4.0&#34;</span>
<span>SLOT</span>=<span>&#34;0&#34;</span>
<span>IUSE</span>=<span>&#34;doc&#34;</span>

<span>RDEPEND</span>=<span>&#34;</span>
<span>    &gt;=dev-cpp/yaml-cpp-0.5.1</span>
<span>    media-libs/libsdl[opengl,video]</span>
<span>    media-libs/sdl-gfx</span>
<span>    media-libs/sdl-image[png]</span>
<span>    media-libs/sdl-mixer[flac,mikmod,vorbis]&#34;</span>
<span>DEPEND</span>=<span>&#34;${RDEPEND}&#34;</span>
<span>BDEPEND</span>=<span>&#34;doc? ( app-doc/doxygen )&#34;</span>

<span>DOCS</span>=( README.md )

<span>src_compile</span>() {
    cmake_src_compile
    use doc &amp;&amp; cmake_build doxygen
}

<span>src_install</span>() {
    use doc &amp;&amp; <span>local</span> <span>HTML_DOCS</span>=( <span>&#34;${BUILD_DIR}&#34;</span>/docs/html/. )
    cmake_src_install
}

<span>pkg_postinst</span>() {
    xdg_icon_cache_update

    elog <span>&#34;In order to play you need copy GEODATA, GEOGRAPH, MAPS, ROUTES, SOUND,&#34;</span>
    elog <span>&#34;TERRAIN, UFOGRAPH, UFOINTRO, UNITS folders from original X-COM game to&#34;</span>
    elog <span>&#34;/usr/share/${PN}/UFO&#34;</span>
    elog
    elog <span>&#34;If you want to play the TFTD mod, you need to copy ANIMS, FLOP_INT,&#34;</span>
    elog <span>&#34;GEODATA, GEOGRAPH, MAPS, ROUTES, SOUND, TERRAIN, UFOGRAPH, UNITS folders&#34;</span>
    elog <span>&#34;from the original Terror from the Deep game to&#34;</span>
    elog <span>&#34;/usr/share/${PN}/TFTD&#34;</span>
    elog
    elog <span>&#34;If you need or want text in some language other than english, download:&#34;</span>
    elog <span>&#34;https://openxcom.org/translations/latest.zip and uncompress it in&#34;</span>
    elog <span>&#34;/usr/share/${PN}/common/Language&#34;</span>
}

<span>pkg_postrm</span>() {
    xdg_icon_cache_update
}
</pre>
</div>

<p>
Although I probably should, I&#39;m not going to bother with <code>postinst</code> or <code>postrm</code>
right now. I&#39;m also not going to build the docs. What we can tell immediately is
that this is a CMake project (so we should find an <code>APKBUILD</code> for something else
that uses CMake â€“ I used <code>gzdoom</code>) and the dependencies are the following:
</p>

<ul>
<li><code>yaml-cpp</code></li>
<li><code>sdl</code></li>
<li><code>sdl_gfx</code></li>
<li><code>sdl_image</code></li>
<li><code>sdl_mixer</code></li>
</ul>

<p>
All of these are packaged in Alpine except <code>sdl_mixer</code>, so we&#39;ll need to port that
ourselves. I was able to take the <code>APKBUILD</code> for <code>sdl_mixer</code> and use that as a
skeleton. The packages are packaged very similarly, so I was able to fill in the
blanks with some of the info from the <a href="https://packages.gentoo.org/packages/media-libs/sdl-gfx">Gentoo package</a>.
</p>

<div>
<pre>


<span>pkgname</span>=sdl_gfx
<span>pkgver</span>=2.0.26
<span>pkgrel</span>=3
<span>pkgdesc</span>=<span>&#34;Graphics drawing primitives library for SDL&#34;</span>
<span>url</span>=<span>&#34;https://www.ferzkopp.net/wordpress/2016/01/02/sdl_gfx-sdl2_gfx/&#34;</span>
<span>arch</span>=<span>&#34;all&#34;</span>
<span>license</span>=<span>&#34;zlib&#34;</span>
<span>makedepends</span>=<span>&#34;sdl-dev&#34;</span>
<span>subpackages</span>=<span>&#34;$pkgname-dev&#34;</span>
<span>source</span>=<span>&#34;http://www.ferzkopp.net/Software/SDL_gfx-2.0/SDL_gfx-$pkgver.tar.gz&#34;</span>
<span>builddir</span>=<span>&#34;$srcdir&#34;</span>/SDL_gfx-$<span>pkgver</span>

<span>prepare</span>() {
    default_prepare
    update_config_sub
    update_config_guess
}

<span>build</span>() {
    ./configure <span>\</span>
        --build=$<span>CBUILD</span> <span>\</span>
        --host=$<span>CHOST</span> <span>\</span>
        --prefix=/usr <span>\</span>
        --sysconfdir=/etc <span>\</span>
        --mandir=/usr/share/man <span>\</span>
        --infodir=/usr/share/info
    make
}

<span>package</span>() {
    make <span>DESTDIR</span>=<span>&#34;$pkgdir&#34;</span> install
}

<span>sha512sums</span>=<span>&#34;e571caa0d7575683efd4cf8f0a41ab10f4acf913f9ece216ac823af11da22c8734fc2c0ea049009a3e1a53715e49622f5bfcfdbdafb95e5151990d0a4eb69c01  SDL_gfx-2.0.26.tar.gz&#34;</span>
</pre>
</div>

<p>
It took a little bit of trial and error to arrive at the <code>APKBUILD</code> above. I first
ran into an issue with autotools not recognizing the target platform.
</p>

<div>
<pre>&gt;&gt;&gt; sdl_gfx: Building pmos/sdl_gfx 2.0.26-r3 (using abuild 3.9.0-r0) started Tue, 23 Aug 2022 01:28:27 +0000
&gt;&gt;&gt; sdl_gfx: Checking sanity of /home/pmos/build/APKBUILD...
&gt;&gt;&gt; sdl_gfx: Cleaning up srcdir
&gt;&gt;&gt; sdl_gfx: Cleaning up pkgdir
&gt;&gt;&gt; sdl_gfx: Fetching http://www.ferzkopp.net/Software/SDL_gfx-2.0/SDL_gfx-2.0.26.tar.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   251  100   251    0     0   1764      0 --:--:-- --:--:-- --:--:--  2127
100 1729k  100 1729k    0     0  2103k      0 --:--:-- --:--:-- --:--:-- 2103k
&gt;&gt;&gt; sdl_gfx: Fetching http://www.ferzkopp.net/Software/SDL_gfx-2.0/SDL_gfx-2.0.26.tar.gz
&gt;&gt;&gt; sdl_gfx: Checking sha512sums...
SDL_gfx-2.0.26.tar.gz: OK
&gt;&gt;&gt; sdl_gfx: Unpacking /var/cache/distfiles/SDL_gfx-2.0.26.tar.gz...
checking build system type... Invalid configuration `aarch64-alpine-linux-musl&#39;: machine `aarch64-alpine-linux&#39; not recognized
configure: error: /bin/sh ./config.sub aarch64-alpine-linux-musl failed
&gt;&gt;&gt; ERROR: sdl_gfx: build failed
(011680) [21:28:30] ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
(011680) [21:28:30] NOTE: The failed command&#39;s output is above the ^^^ line in the log file: /home/jakob/Containers/pmbootstrap/pmbootstrap/log.txt
(011680) [21:28:30] ERROR: Command failed (exit code 1): (buildroot_aarch64) % cd /home/pmos/build; busybox su pmos -c CARCH=aarch64 SUDO_APK=&#39;abuild-apk --no-progress&#39; PATH=/native/usr/lib/crossdirect/aarch64:/usr/lib/ccache/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin HOME=/home/pmos abuild -D postmarketOS -d
(011680) [21:28:30] See also: <a href="https://postmarketos.org/troubleshooting">&lt;https://postmarketos.org/troubleshooting&gt;</a>
(011680) [21:28:30] Traceback (most recent call last):
  File &#34;/home/jakob/Containers/pmbootstrap/.venv/lib/python3.10/site-packages/pmb/__init__.py&#34;, line 49, in main
    getattr(frontend, args.action)(args)
  File &#34;/home/jakob/Containers/pmbootstrap/.venv/lib/python3.10/site-packages/pmb/helpers/frontend.py&#34;, line 114, in build
    if not pmb.build.package(args, package, arch_package, force,
  File &#34;/home/jakob/Containers/pmbootstrap/.venv/lib/python3.10/site-packages/pmb/build/_package.py&#34;, line 520, in package
    (output, cmd, env) = run_abuild(args, apkbuild, arch, strict, force, cross,
  File &#34;/home/jakob/Containers/pmbootstrap/.venv/lib/python3.10/site-packages/pmb/build/_package.py&#34;, line 447, in run_abuild
    pmb.chroot.user(args, cmd, suffix, &#34;/home/pmos/build&#34;, env=env)
  File &#34;/home/jakob/Containers/pmbootstrap/.venv/lib/python3.10/site-packages/pmb/chroot/user.py&#34;, line 26, in user
    return pmb.chroot.root(args, cmd, suffix, working_dir, output,
  File &#34;/home/jakob/Containers/pmbootstrap/.venv/lib/python3.10/site-packages/pmb/chroot/root.py&#34;, line 76, in root
    return pmb.helpers.run_core.core(args, msg, cmd_sudo, None, output,
  File &#34;/home/jakob/Containers/pmbootstrap/.venv/lib/python3.10/site-packages/pmb/helpers/run_core.py&#34;, line 347, in core
    check_return_code(args, code, log_message)
  File &#34;/home/jakob/Containers/pmbootstrap/.venv/lib/python3.10/site-packages/pmb/helpers/run_core.py&#34;, line 219, in check_return_code
    raise RuntimeError(f&#34;Command failed (exit code {str(code)}): &#34; +
RuntimeError: Command failed (exit code 1): (buildroot_aarch64) % cd /home/pmos/build; busybox su pmos -c CARCH=aarch64 SUDO_APK=&#39;abuild-apk --no-progress&#39; PATH=/native/usr/lib/crossdirect/aarch64:/usr/lib/ccache/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin HOME=/home/pmos abuild -D postmarketOS -d
</pre>
</div>

<p>
Fortunately, it wasn&#39;t too difficult to find the issue online. Someone had tried
(unsuccessfully) to <a href="https://gitlab.alpinelinux.org/alpine/aports/-/merge_requests/15673">add sdl_ttf to aports</a> and ran into the same issue. The
recommendation in the MR comments was to include the <code>prepare</code> block above.
</p>

<p>
When that was sorted, I had a <code>sdl_gfx</code> package that I could use as a dependency
for <code>openxcom</code>.
</p>

<div>
<pre>


<span>_commit</span>=<span>&#34;ea9ac466221f8b4f8974d2db1c42dc4ad6126564&#34;</span>
<span>pkgname</span>=openxcom
<span>pkgver</span>=1.0.0
<span>pkgrel</span>=1
<span>pkgdesc</span>=<span>&#34;Open-source reimplementation of the popular UFO: Enemy Unknown&#34;</span>
<span>url</span>=<span>&#34;https://openxcom.org/&#34;</span>
<span>arch</span>=<span>&#34;all&#34;</span>
<span>license</span>=<span>&#34;GPL-3.0-or-later&#34;</span>
<span>makedepends</span>=<span>&#34;cmake ninja yaml-cpp-dev sdl-dev sdl_gfx-dev sdl_image-dev sdl_mixer-dev glu-dev libexecinfo-dev&#34;</span>
<span>depends</span>=<span>&#34;libexecinfo&#34;</span>
<span>source</span>=<span>&#34;openxcom-$pkgver.tar.gz::https://github.com/OpenXcom/OpenXcom/archive/$_commit.tar.gz</span>
<span>0001-Link-execinfo-unconditionally.patch&#34;</span>
<span>builddir</span>=<span>&#34;$srcdir&#34;</span>/OpenXcom-$<span>_commit</span>

<span>build</span>() {
    <span>if</span> [ <span>&#34;$CBUILD&#34;</span> != <span>&#34;$CHOST&#34;</span> ]; <span>then</span>
        <span>CMAKE_CROSSOPTS</span>=<span>&#34;-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux&#34;</span>
    <span>fi</span>
    cmake -B build -G Ninja <span>\</span>
        -DCMAKE_BUILD_TYPE=Release <span>\</span>
        -DCMAKE_INSTALL_PREFIX=/usr <span>\</span>
        -DBUILD_SHARED_LIBS=True <span>\</span>
        $<span>CMAKE_CROSSOPTS</span>
    cmake --build build
}

<span>package</span>() {
    <span>DESTDIR</span>=<span>&#34;$pkgdir&#34;</span> cmake --install build
}

<span>sha512sums</span>=<span>&#34;57ff9a9cbbbf48b8c4f792458edf0590d7d0df9a5805eab13a4c984713311e98587afca00778e82bd66fb2f330b354ca80703b87922a92f9ae48e5bdecf68442  openxcom-1.0.0.tar.gz</span>
<span>de4cc52530200992fef0e723acd59fef1b214f5b12baabec4dcca03820fbbc38c30033c0707f918fccc29e7d0d67ddef0c2a7be56d21b2bba7221899c759c282  0001-Link-execinfo-unconditionally.patch&#34;</span>
</pre>
</div>

<p>
where <code>0001-Link-execinfo-unconditionally.patch</code> is the following:
</p>

<div>
<pre><span>From 2fe3e39c90086c7e3953d83ce75b0686ee4f5813 Mon Sep 17 00:00:00 2001</span>
<span>From: &#34;Jakob L. Kreuze&#34; &lt;[REDACTED]&gt;</span>
<span>Date: Tue, 23 Aug 2022 20:11:16 -0400</span>
<span>Subject: [PATCH] Link execinfo unconditionally</span>


<span> src/CMakeLists.txt | 4 +---</span>
<span> 1 file changed, 1 insertion(+), 3 deletions(-)</span>





<span> if ( WIN32 )</span>
<span> endif ()</span>

<span> # backtrace(3) requires libexecinfo on some *BSD systems</span>
<span>-</span><span><span>if (${CMAKE_SYSTEM_NAME} MATCHES FreeBSD OR ${CMAKE_SYSTEM_NAME} MATCHES NetBSD OR ${CMAKE_SYSTEM_NAME} MATCHES OpenBSD)</span></span><span>
</span><span><span>-</span></span><span>  set ( system_libs -lexecinfo </span><span><span>)</span></span><span>
</span><span><span>-</span></span><span><span>endif (</span></span><span>)</span>
<span>+</span><span>set ( system_libs -lexecinfo )</span>

<span> target_link_libraries ( openxcom ${system_libs} ${SDLIMAGE_LIBRARY} ${SDLMIXER_LIBRARY} ${SDLGFX_LIBRARY} ${SDL_LIBRARY} ${OPENGL_LIBRARIES} debug ${YAMLCPP_LIBRARY_DEBUG} optimized ${YAMLCPP_LIBRARY} )</span>

<span>-</span><span>- </span>
<span>2.37.2</span>

</pre>
</div>

<p>
The first error I got was about a missing <code>mmintrin.h</code>. I opened up the source
code and found that was under an <code>IFDEF</code> for <code>MMX</code> support, so I did a <code>./configure
--help</code> to figure out how to disable that. After that, I was getting a message
about a missing <code>glu.h</code>.
</p>

<div>
<pre>[63/313] Building CXX object src/CMakeFiles/openxcom.dir/Mod/RuleVideo.cpp.o
ninja: job failed: /native/usr/lib/crossdirect/aarch64/g++ -DDATADIR=\&#34;/usr/share/openxcom/\&#34; -DGIT_BUILD=1 -I/usr/include/SDL -I/usr/include/yaml-cpp -I/home/pmos/build/src/OpenXcom-ea9ac466221f8b4f8974d2db1c42dc4ad6126564/build -Os -fomit-frame-pointer -O3 -DNDEBUG -std=gnu++11 -MD -MT src/CMakeFiles/openxcom.dir/Mod/RuleVideo.cpp.o -MF src/CMakeFiles/openxcom.dir/Mod/RuleVideo.cpp.o.d -o src/CMakeFiles/openxcom.dir/Mod/RuleVideo.cpp.o -c /home/pmos/build/src/OpenXcom-ea9ac466221f8b4f8974d2db1c42dc4ad6126564/src/Mod/RuleVideo.cpp
In file included from /home/pmos/build/src/OpenXcom-ea9ac466221f8b4f8974d2db1c42dc4ad6126564/src/Mod/../Engine/OpenGL.h:15,
                 from /home/pmos/build/src/OpenXcom-ea9ac466221f8b4f8974d2db1c42dc4ad6126564/src/Mod/../Engine/Screen.h:22,
                 from /home/pmos/build/src/OpenXcom-ea9ac466221f8b4f8974d2db1c42dc4ad6126564/src/Mod/RuleVideo.cpp:21:
/usr/include/SDL/SDL_opengl.h:47:10: fatal error: GL/glu.h: No such file or directory
   47 | #include &lt;GL/glu.h&gt; /* Header File For The GLU Library */
      |          ^~~~~~~~~~
compilation terminated.
ninja: subcommand failed
&gt;&gt;&gt; ERROR: openxcom: build failed
</pre>
</div>

<p>
I went ahead and added the <code>glu-dev</code> dependency, after which point I was getting
some warnings about redefinitions. So I have a feeling this might have been
another thing that was behind an <code>IFDEF</code>, but that&#39;s a problem for later.
</p>

<div>
<pre>[218/313] Building CXX object src/CMakeFiles/openxcom.dir/Engine/AdlibMusic.cpp.o
ninja: job failed: /native/usr/lib/crossdirect/aarch64/g++ -DDATADIR=\&#34;/usr/share/openxcom/\&#34; -DGIT_BUILD=1 -I/usr/include/SDL -I/usr/include/yaml-cpp -I/home/pmos/build/src/OpenXcom-ea9ac466221f8b4f8974d2db1c42dc4ad6126564/build -Os -fomit-frame-pointer -O3 -DNDEBUG -std=gnu++11 -MD -MT src/CMakeFiles/openxcom.dir/Engine/CrossPlatform.cpp.o -MF src/CMakeFiles/openxcom.dir/Engine/CrossPlatform.cpp.o.d -o src/CMakeFiles/openxcom.dir/Engine/CrossPlatform.cpp.o -c /home/pmos/build/src/OpenXcom-ea9ac466221f8b4f8974d2db1c42dc4ad6126564/src/Engine/CrossPlatform.cpp
/home/pmos/build/src/OpenXcom-ea9ac466221f8b4f8974d2db1c42dc4ad6126564/src/Engine/CrossPlatform.cpp:68:10: fatal error: execinfo.h: No such file or directory
   68 | #include &lt;execinfo.h&gt;
      |          ^~~~~~~~~~~~
compilation terminated.
ninja: subcommand failed
&gt;&gt;&gt; ERROR: openxcom: build failed
</pre>
</div>

<p>
The last errors I got were related to <code>execinfo</code>. This is, to my knowledge, a
<code>glibc</code> thing. Fortunately, Alpine being a popular base image in Docker land means
<a href="https://github.com/ddopson/node-segfault-handler/issues/70">the workarounds</a> are easy to find on the &#39;net. The missing header file was one,
thing, but then I was getting some linker errors about a missing symbol for
<code>backtrace</code>. Searching came up with an <a href="https://discuss.pytorch.org/t/compiling-master-from-source-on-alpine-fails-with-undefined-reference-to-backtrace/64676">issue in PyTorch</a> which gave me some
insight, and then I found a <a href="https://github.com/OpenXcom/OpenXcom/pull/1123">pull request upstream</a> related to it. My patch above
just makes the fix in that pull request unconditional (in <code>master</code>, it&#39;s only
applied on BSD); we get all the <code>backtrace</code> symbols from <code>execinfo</code>, but we need to
make sure it&#39;s actually linked into the binary.
</p>

<p>
Then.. shit. It built correctly, but my <code>pmbootstrap</code> setup was a version behind
the PostmarketOS on my phone (<code>v21.12</code> vs <code>v22.06</code>), so I was getting some
dependency resolution errors. I re-initialized <code>pmbootstrap</code> and then learned that
<code>sdl-dev</code> is no longer supported, so I had to backport it from <code>edge/testing</code>. It
was at least smooth sailing after that.
</p>


<figure id="orgb5e5f25">
<img src="https://jakob.space/static/image/openxcom-on-pinephone.png" alt="openxcom-on-pinephone.png"/>

<figcaption><span>Figure 16: </span>OpenXcom running on the PinePhone. It performs surprisingly well.</figcaption>
</figure>

<p>
So porting software to the PinePhone is relatively easy.
</p>

<p>
You don&#39;t even have to go through half of the mess that I did if you don&#39;t care
about cross-compiling or having things tracked by the package manager. You could
probably just install the <code>gcc</code> toolchain and do a <code>make &amp;&amp; sudo make install</code> on
your phone; Alpine/PostmarketOS have <a href="https://wiki.alpinelinux.org/wiki/Running_glibc_programs">glibc compatibility</a>. Or, hell, use a
Flatpak/AppImage/Snap if you want to.
</p>

<p>
However you do it, the end result is the same. You get to use the same Linux
applications on your phone that you would on your desktop, and I think that&#39;s
great.
</p>
</div></div>
  </body>
</html>
