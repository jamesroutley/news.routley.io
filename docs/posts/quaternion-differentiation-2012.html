<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://fgiesen.wordpress.com/2012/08/24/quaternion-differentiation/">Original</a>
    <h1>Quaternion Differentiation (2012)</h1>
    
    <div id="readability-page-1" class="page"><div>
								<p>I wanted to point someone to a short explanation of this today and noticed, with some surprise, that I couldn’t find something concise within 5 minutes of googling. So it seems worth writing up. I’m assuming you know what quaternions are and what they’re used for.</p>
<p>First, though, it seems important to point one thing out: Actually, there’s nothing special at all about either integration or differentiation of quaternion-valued functions. If you have a quaternion-valued function of one variable q(t), then</p>
<p><img src="https://s0.wp.com/latex.php?latex=%5Cdisplaystyle+%5Cdot%7Bq%7D%28t%29+%3D+q%27%28t%29+%3D+%5Cfrac%7B%5Cmathrm%7Bd%7Dq%7D%7B%5Cmathrm%7Bd%7Dt%7D+%3D+%5Clim_%7Bh+%5Crightarrow+0%7D+%5Cfrac%7Bq%28t%2Bh%29+-+q%28t%29%7D%7Bh%7D&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cdisplaystyle+%5Cdot%7Bq%7D%28t%29+%3D+q%27%28t%29+%3D+%5Cfrac%7B%5Cmathrm%7Bd%7Dq%7D%7B%5Cmathrm%7Bd%7Dt%7D+%3D+%5Clim_%7Bh+%5Crightarrow+0%7D+%5Cfrac%7Bq%28t%2Bh%29+-+q%28t%29%7D%7Bh%7D&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cdisplaystyle+%5Cdot%7Bq%7D%28t%29+%3D+q%27%28t%29+%3D+%5Cfrac%7B%5Cmathrm%7Bd%7Dq%7D%7B%5Cmathrm%7Bd%7Dt%7D+%3D+%5Clim_%7Bh+%5Crightarrow+0%7D+%5Cfrac%7Bq%28t%2Bh%29+-+q%28t%29%7D%7Bh%7D&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\displaystyle \dot{q}(t) = q&#39;(t) = \frac{\mathrm{d}q}{\mathrm{d}t} = \lim_{h \rightarrow 0} \frac{q(t+h) - q(t)}{h}"/></p>
<p>same as for any real- or complex-valued function.</p>
<p>So what, then, is this post about? Simple: unit quaternions are commonly used to represent rotations (or orientation of rigid bodies), and rigid-body dynamics require integration of orientation over time. Almost all sources I could find just magically pull a solution out of thin air, and those that give a derivation tend to make it way more complicated than necessary. So let’s just do this from first principles. I’m assuming you know that multiplying two unit quaternions quaternions q<sub>1</sub>q<sub>0</sub> gives a unit quaternion representing the composition of the two rotations. Now say we want to describe the orientation q(t) of a rigid body rotating at constant angular velocity. Then we can write</p>
<p><img src="https://s0.wp.com/latex.php?latex=q%280%29+%3D+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=q%280%29+%3D+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=q%280%29+%3D+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="q(0) = q_0"/></p>
<p>where <img src="https://s0.wp.com/latex.php?latex=q_%5Comega&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=q_%5Comega&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=q_%5Comega&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="q_\omega"/> describes the rotation the body undergoes in one time step. Since we have constant angular velocity, we will have <img src="https://s0.wp.com/latex.php?latex=q%282%29+%3D+q_%5Comega+q_%5Comega+q_0+%3D+q_%5Comega%5E2+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=q%282%29+%3D+q_%5Comega+q_%5Comega+q_0+%3D+q_%5Comega%5E2+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=q%282%29+%3D+q_%5Comega+q_%5Comega+q_0+%3D+q_%5Comega%5E2+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="q(2) = q_\omega q_\omega q_0 = q_\omega^2 q_0"/>, and more generally <img src="https://s0.wp.com/latex.php?latex=q%28k%29+%3D+q_%5Comega%5Ek+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=q%28k%29+%3D+q_%5Comega%5Ek+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=q%28k%29+%3D+q_%5Comega%5Ek+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="q(k) = q_\omega^k q_0"/> for all nonnegative integer k by induction. So for even more general t we’d expect something like</p>
<p><img src="https://s0.wp.com/latex.php?latex=q%28t%29+%3D+q_%5Comega%5Et+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=q%28t%29+%3D+q_%5Comega%5Et+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=q%28t%29+%3D+q_%5Comega%5Et+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="q(t) = q_\omega^t q_0"/>.</p>
<p>Now, q<sub>ω</sub> is a unit quaternion, which means it can be written in <em>polar form</em></p>
<p><img src="https://s0.wp.com/latex.php?latex=q_%5Comega+%3D+%5Ccos%28%5Ctheta%2F2%29+%2B+%5Csin%28%5Ctheta%2F2%29+%28%5Cmathbf%7Bn%7D_x+i+%2B+%5Cmathbf%7Bn%7D_y+j+%2B+%5Cmathbf%7Bn%7D_z+k%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=q_%5Comega+%3D+%5Ccos%28%5Ctheta%2F2%29+%2B+%5Csin%28%5Ctheta%2F2%29+%28%5Cmathbf%7Bn%7D_x+i+%2B+%5Cmathbf%7Bn%7D_y+j+%2B+%5Cmathbf%7Bn%7D_z+k%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=q_%5Comega+%3D+%5Ccos%28%5Ctheta%2F2%29+%2B+%5Csin%28%5Ctheta%2F2%29+%28%5Cmathbf%7Bn%7D_x+i+%2B+%5Cmathbf%7Bn%7D_y+j+%2B+%5Cmathbf%7Bn%7D_z+k%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="q_\omega = \cos(\theta/2) + \sin(\theta/2) (\mathbf{n}_x i + \mathbf{n}_y j + \mathbf{n}_z k)"/></p>
<p>where θ is some angle and n is a unit vector denoting the axis of rotation. That part is usually mentioned in every quaternion tutorial. Embedding real 3-vectors as the corresponding pure imaginary quaternion, i.e. writing just <img src="https://s0.wp.com/latex.php?latex=%5Cmathbf%7Bn%7D&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cmathbf%7Bn%7D&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cmathbf%7Bn%7D&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\mathbf{n}"/> for the quaternion <img src="https://s0.wp.com/latex.php?latex=%5Cmathbf%7Bn%7D_x+i+%2B+%5Cmathbf%7Bn%7D_y+j+%2B+%5Cmathbf%7Bn%7D_z+k&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cmathbf%7Bn%7D_x+i+%2B+%5Cmathbf%7Bn%7D_y+j+%2B+%5Cmathbf%7Bn%7D_z+k&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cmathbf%7Bn%7D_x+i+%2B+%5Cmathbf%7Bn%7D_y+j+%2B+%5Cmathbf%7Bn%7D_z+k&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\mathbf{n}_x i + \mathbf{n}_y j + \mathbf{n}_z k"/>, is usually also mentioned somewhere. What usually isn’t mentioned is the crucial piece of information that the polar form of a quaternion, in fact, just the quaternion version of Euler’s formula: Any unit complex number <img src="https://s0.wp.com/latex.php?latex=z&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=z&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=z&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="z"/> can be written as the complex exponential of a pure imaginary number <img src="https://s0.wp.com/latex.php?latex=z%3D%5Cexp%28it%29%3D%5Ccos%28t%29+%2B+i+%5Csin%28t%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=z%3D%5Cexp%28it%29%3D%5Ccos%28t%29+%2B+i+%5Csin%28t%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=z%3D%5Cexp%28it%29%3D%5Ccos%28t%29+%2B+i+%5Csin%28t%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="z=\exp(it)=\cos(t) + i \sin(t)"/>, and similarly any unit-length quaternion (and q<sub>ω</sub> in particular) can be written as the exponential of a pure imaginary quaternion</p>
<p><img src="https://s0.wp.com/latex.php?latex=q_%5Comega+%3D+%5Cexp%28%5Cfrac%7B%5Ctheta%7D%7B2%7D%5Cmathbf%7Bn%7D%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=q_%5Comega+%3D+%5Cexp%28%5Cfrac%7B%5Ctheta%7D%7B2%7D%5Cmathbf%7Bn%7D%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=q_%5Comega+%3D+%5Cexp%28%5Cfrac%7B%5Ctheta%7D%7B2%7D%5Cmathbf%7Bn%7D%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="q_\omega = \exp(\frac{\theta}{2}\mathbf{n})"/></p>
<p>which gives us a natural definition for</p>
<p><img src="https://s0.wp.com/latex.php?latex=q_%5Comega%5Et+%3D+%5Cexp%28t+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=q_%5Comega%5Et+%3D+%5Cexp%28t+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=q_%5Comega%5Et+%3D+%5Cexp%28t+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="q_\omega^t = \exp(t \frac{\theta}{2} \mathbf{n})"/>.</p>
<p>Now, what if we want to write a differential equation for the behavior of q(t) over time? Just compute the derivative of q(t) as you would for any other function of t. Using the chain and product rules we get:</p>
<p><img src="https://s0.wp.com/latex.php?latex=%5Cdot%7Bq%7D%28t%29+%3D+%5Cfrac%7B%5Cmathrm%7Bd%7D%7D%7B%5Cmathrm%7Bd%7Dt%7D+%28q_%5Comega%5Et+q_0%29+%3D+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cexp%28t+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D%29+%5Cmathbf%7Bn%7D+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cdot%7Bq%7D%28t%29+%3D+%5Cfrac%7B%5Cmathrm%7Bd%7D%7D%7B%5Cmathrm%7Bd%7Dt%7D+%28q_%5Comega%5Et+q_0%29+%3D+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cexp%28t+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D%29+%5Cmathbf%7Bn%7D+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cdot%7Bq%7D%28t%29+%3D+%5Cfrac%7B%5Cmathrm%7Bd%7D%7D%7B%5Cmathrm%7Bd%7Dt%7D+%28q_%5Comega%5Et+q_0%29+%3D+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cexp%28t+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D%29+%5Cmathbf%7Bn%7D+q_0&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\dot{q}(t) = \frac{\mathrm{d}}{\mathrm{d}t} (q_\omega^t q_0) = \frac{\theta}{2} \exp(t \frac{\theta}{2} \mathbf{n}) \mathbf{n} q_0"/></p>
<p>Now t and θ are real numbers, so the exponential is of a real number times n; exp is defined as a power series, and for arbitrary c real we have</p>
<p><img src="https://s0.wp.com/latex.php?latex=%5Cdisplaystyle+%5Cexp%28c+%5Cmathbf%7Bn%7D%29+%3D+%5Csum_%7Bk%3D0%7D%5E%7B%5Cinfty%7D+%5Cfrac%7B%28c+%5Cmathbf%7Bn%7D%29%5Ek%7D%7Bk%21%7D+%3D+%5Csum_%7Bk%3D0%7D%5E%7B%5Cinfty%7D+%5Cfrac%7Bc%5Ek+%5Cmathbf%7Bn%7D%5Ek%7D%7Bk%21%7D&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cdisplaystyle+%5Cexp%28c+%5Cmathbf%7Bn%7D%29+%3D+%5Csum_%7Bk%3D0%7D%5E%7B%5Cinfty%7D+%5Cfrac%7B%28c+%5Cmathbf%7Bn%7D%29%5Ek%7D%7Bk%21%7D+%3D+%5Csum_%7Bk%3D0%7D%5E%7B%5Cinfty%7D+%5Cfrac%7Bc%5Ek+%5Cmathbf%7Bn%7D%5Ek%7D%7Bk%21%7D&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cdisplaystyle+%5Cexp%28c+%5Cmathbf%7Bn%7D%29+%3D+%5Csum_%7Bk%3D0%7D%5E%7B%5Cinfty%7D+%5Cfrac%7B%28c+%5Cmathbf%7Bn%7D%29%5Ek%7D%7Bk%21%7D+%3D+%5Csum_%7Bk%3D0%7D%5E%7B%5Cinfty%7D+%5Cfrac%7Bc%5Ek+%5Cmathbf%7Bn%7D%5Ek%7D%7Bk%21%7D&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\displaystyle \exp(c \mathbf{n}) = \sum_{k=0}^{\infty} \frac{(c \mathbf{n})^k}{k!} = \sum_{k=0}^{\infty} \frac{c^k \mathbf{n}^k}{k!}"/></p>
<p>n commutes with powers of n, and real numbers commute with everything; therefore, n commutes with exp(cn) for arbitrary c, and thus</p>
<p><img src="https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cexp%28t+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D%29+%5Cmathbf%7Bn%7D+q_0+%3D+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D+%5Cexp%28t+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D%29+q_0+%3D+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D+q%28t%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cexp%28t+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D%29+%5Cmathbf%7Bn%7D+q_0+%3D+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D+%5Cexp%28t+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D%29+q_0+%3D+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D+q%28t%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cexp%28t+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D%29+%5Cmathbf%7Bn%7D+q_0+%3D+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D+%5Cexp%28t+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D%29+q_0+%3D+%5Cfrac%7B%5Ctheta%7D%7B2%7D+%5Cmathbf%7Bn%7D+q%28t%29&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\frac{\theta}{2} \exp(t \frac{\theta}{2} \mathbf{n}) \mathbf{n} q_0 = \frac{\theta}{2} \mathbf{n} \exp(t \frac{\theta}{2} \mathbf{n}) q_0 = \frac{\theta}{2} \mathbf{n} q(t)"/></p>
<p>The vector θ<b>n</b> is in fact just the angular velocity ω, which yields the oft-cited but seldom-derived equation:</p>
<p><img src="https://s0.wp.com/latex.php?latex=%5Cdot%7Bq%7D+%3D+%5Cfrac%7B%5Cmathrm%7Bd%7Dq%7D%7B%5Cmathrm%7Bd%7Dt%7D+%3D+%5Cfrac%7B1%7D%7B2%7D+%5Comega+q&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002" srcset="https://s0.wp.com/latex.php?latex=%5Cdot%7Bq%7D+%3D+%5Cfrac%7B%5Cmathrm%7Bd%7Dq%7D%7B%5Cmathrm%7Bd%7Dt%7D+%3D+%5Cfrac%7B1%7D%7B2%7D+%5Comega+q&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cdot%7Bq%7D+%3D+%5Cfrac%7B%5Cmathrm%7Bd%7Dq%7D%7B%5Cmathrm%7Bd%7Dt%7D+%3D+%5Cfrac%7B1%7D%7B2%7D+%5Comega+q&amp;bg=f9f7f5&amp;fg=444444&amp;s=0&amp;c=20201002&amp;zoom=4.5 4x" alt="\dot{q} = \frac{\mathrm{d}q}{\mathrm{d}t} = \frac{1}{2} \omega q"/></p>
<p>This is usually quoted completely without context. In particular, it’s not usually mentioned that q(t) describes the orientation of a body with constant angular velocity, and similar for the crucial link to the exponential function.</p>
											</div></div>
  </body>
</html>
