<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/FransFaase/MES-replacement">Original</a>
    <h1>Show HN: C-compiler to compile TCC for live-bootstrap</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">The goal of this project is to simplify stage0 of
<a href="https://github.com/fosslinux/live-bootstrap">live-bootstrap</a>,
which involves implementing a replacement for the
<a href="https://www.gnu.org/software/mes/" rel="nofollow">GNU Mes compiler</a>
by implementing a C-compiler in C that can compile the
<a href="https://en.wikipedia.org/wiki/Tiny_C_Compiler" rel="nofollow">Tiny C Compiler</a> version 0.9.26.</p>
<p dir="auto">The motivation for this project is given in the presentation
<a href="https://www.iwriteiam.nl/WHY2025_talk.html" rel="nofollow">Reviewing live-bootstrap</a>.</p>
<p dir="auto">For blog article related to reviewing the live bootstrap project and this
project see the section &#39;Live-bootstrap&#39; on <a href="https://www.iwriteiam.nl/Software.html" rel="nofollow">this page</a>.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Task 1: Compile the Tiny C Compiler correctly</h2><a id="user-content-task-1-compile-the-tiny-c-compiler-correctly" aria-label="Permalink: Task 1: Compile the Tiny C Compiler correctly" href="#task-1-compile-the-tiny-c-compiler-correctly"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The first stage of this project is to implement said C-compiler for i386.
The source of the <a href="https://github.com/FransFaase/MES-replacement/blob/main/tcc_cc.md">C-compiler</a> is the file <a href="https://github.com/FransFaase/MES-replacement/blob/main/tcc_cc.c"><code>tcc_cc.c</code></a>.
This compiler produces intermediate code for a stack based language
called <a href="https://github.com/FransFaase/MES-replacement/blob/main/Stack_C.md">Stack-C</a>. The compiler also includes the file
<a href="https://github.com/FransFaase/MES-replacement/blob/main/stdlib.c"><code>stdlib.c</code></a>, that contains a minimal version of the
C standard library.</p>
<p dir="auto">The intermediage code can be compiled with the program
<a href="https://github.com/FransFaase/MES-replacement/blob/main/stack_c.c"><code>stack_c.c</code></a> to M1 assembly or interpreted with the
program <a href="https://github.com/FransFaase/MES-replacement/blob/main/stack_c_interpreter.c"><code>stack_c_interpreter.c</code></a>.</p>
<p dir="auto">This stage depends on a number of executables from stage0. Namely:</p>
<ul dir="auto">
<li>hex2</li>
<li>M1</li>
<li>blood-elf</li>
<li>catm</li>
<li>match</li>
<li>sha256sum</li>
</ul>
<p dir="auto">These need to be present in the directory of the repository.</p>
<p dir="auto">Furthermore it requires the usual Linux commands and the GNU C compiler.
<a href="https://github.com/FransFaase/MES-replacement/blob/main/Makefile">A makefile</a> is included to build and test the
C-compiler <code>tcc_cc</code>.</p>
<p dir="auto">The sources of the Tiny C Compiler should be placed in a directory
with the name <code>tcc_sources</code> that should also have sub directory
<code>lib</code>.</p>
<p dir="auto">There should also be a directory <code>mes</code> with the contents of the
GNU Mes compiler, which is needed to build the standard library
that the Tiny C Compiler needs.</p>
<p dir="auto">To build and test the Tiny C Compiler, the <a href="https://github.com/FransFaase/MES-replacement/blob/main/test.sh"><code>test.sh</code></a>
shell script is provided. This script first compiles the Tiny C
Compiler with GNU C-compiler, resulting in <code>tcc_g</code> and with
tcc_cc compiler, resulting in <code>tcc_s</code>. Next is uses these to
bootstrap the Tiny C Compiler from the sources. The script
compares the results for the various steps using <code>tcc_g</code> and
<code>tcc_c</code>.</p>
<p dir="auto">Remark: The <code>test.sh</code> script assumes that this repository is cloned
in the <code>git</code> directory in the home directory. Please update the
<code>BINDIR</code> to point to the repository containing the repository.</p>
<p dir="auto">This stage has been implemented.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Task 2: Compile the required utilities</h2><a id="user-content-task-2-compile-the-required-utilities" aria-label="Permalink: Task 2: Compile the required utilities" href="#task-2-compile-the-required-utilities"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This task will focus on removing the dependency of the
executables from stage0 by building these with the C-compiler.
These also include compiling some utilities, such as ungz and untar,
from C sources that are needed, for example, to unpack the sources
of the Tiny C Compiler, such that they can be compiled.</p>

<p dir="auto">Develop the kaem scripts for the new C compiler. This probably have
to be done in parallel with Task 2, because it is not clear which
utilities exactly will be needed.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Task 4: versions for hex0 and M1</h2><a id="user-content-task-4-versions-for-hex0-and-m1" aria-label="Permalink: Task 4: versions for hex0 and M1" href="#task-4-versions-for-hex0-and-m1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Write a C version for M1 that retains the comments to facilitate
the review of the generated intermediate files. Write a C version
for hex0, that might be a bit longer than the current &#39;minimal&#39; hex0,
but might be more easily to review.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Task 5: Implement support for other targets</h2><a id="user-content-task-5-implement-support-for-other-targets" aria-label="Permalink: Task 5: Implement support for other targets" href="#task-5-implement-support-for-other-targets"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Write versions of the program converting the intermediate stack language
for other targets besides x86. For x86_64 this will be relatively simply.
For the other targets this requires some investigation, also figuring out
how to test this, for example, using some form of emulation, such as QEMU.</p>
<p dir="auto">Targets:</p>
<ul dir="auto">
<li>x86_64</li>
<li>arm</li>
<li>riscv64</li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">Taks 6: Presentation and documentation</h2><a id="user-content-taks-6-presentation-and-documentation" aria-label="Permalink: Taks 6: Presentation and documentation" href="#taks-6-presentation-and-documentation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Write the necessary MarkDown/HTML files with the alternative git repository
for stage0 and add comments to the source files where needed. Write or
give a presentation about the achievements.</p>

<p dir="auto">For a first feasability study to analyzing what part of the C-grammar
that is needed for compiling TCC. For this I wrote a minimal C preprocessor:
<code>min_tcc_preprocessor.cpp</code> and <code>CParser.c</code> that is heavily based on
<a href="https://github.com/FransFaase/RawParser">RawParser</a>.</p>

<p dir="auto">The work in this repository falls under the project
<a href="https://nlnet.nl/project/live-bootstrap/" rel="nofollow">Verifying and documenting live-bootstrap</a>,
which was funded through the <a href="https://nlnet.nl/core/" rel="nofollow">NGI0 Core</a> Fund, a fund established by
<a href="https://nlnet.nl" rel="nofollow">NLnet</a> with financial support from the European Commission&#39;s
<a href="https://ngi.eu" rel="nofollow">Next Generation Internet</a> programme, under the aegis of
<a href="https://commission.europa.eu/about-european-commission/departments-and-executive-agencies/communications-networks-content-and-technology_en" rel="nofollow">DG Communications Networks, Content and Technology</a> under grant agreement
Nâ‚’ <a href="https://cordis.europa.eu/project/id/101092990%22" rel="nofollow">101092990</a>.</p>
</article></div></div>
  </body>
</html>
