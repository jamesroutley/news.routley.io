<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://dgl.cx/wikipedia-dns">Original</a>
    <h1>Wikipedia over DNS (2008)</h1>
    
    <div id="readability-page-1" class="page"><div>

<p>I had written some code to take wikipedia articles and summarise them. I wanted
to offer this for use in various places, now the obvious way to offer it is
just a web service (via REST, XMLRPC, etc), but that&#39;s boring and I had a cunning
plan. Why not offer it over DNS - it is basically a huge associative array and
DNS is designed for this stuff.</p>

<p>So I wrote a little nameserver which returns the results as TXT records. There
are some obvious limitations for example responses are limited to around 430
bytes (it only does UDP and no EDNS). It has advantages too, it gets cached at
your nameserver and it also has slightly lower latency than HTTP (because
there&#39;s no need to setup a TCP session).</p>

<p>Here&#39;s an example:</p>

<p><code>$ host -t txt foo.wp.dg.cx</code></p><p>Using it from Perl is fairly easy too, with a little help from <a href="http://search.cpan.org/dist/Net-DNS">Net::DNS</a>:</p>

<pre><code>use Net::DNS;
my $res = Net::DNS::Resolver-&gt;new;

sub wikipedia {
  my($name) = @_;
  my $q = $res-&gt;query(&#34;$name.wp.dg.cx&#34;, &#34;TXT&#34;);
  if($q) {
    for my $rr($q-&gt;answer) {
      next unless $rr-&gt;type eq &#34;TXT&#34;;
      return join &#34;&#34;, $rr-&gt;char_str_list;
    }
  }
}

print wikipedia($ARGV[0]);
</code></pre>

<p>Unicode should be supported, all DNS queries are expected to be in UTF-8 (this
assumes your resolver is happy with 8 bit characters, some aren&#39;t---I might
support IDN one day). See the example below (the perl is just there to unescape the escaping
dig does). The result is returned in UTF-8, which everything can handle. For example:</p>

<p><code>$ dig +short txt &#39;新疆.wp.dg.cx&#39; | perl -pe&#39;s/\\(\d{1,3})/chr $1/eg&#39;</code></p><p>I did a talk on this at <a href="http://conferences.yapceurope.org/lpw2008">London Perl Workshop 2008</a>, the slides are <a href="https://dgl.cx/2008/11/wpdns-pres/">here</a>.</p>
</div><div>
    <p><span title="Sat Feb 28 2009 17:28:18+0000, updated: Sun Mar 01 2009 05:00:16+0000">
          28<sup>th</sup> February 2009</span>
    in <span><a href="https://dgl.cx/tag/code">code</a>, <a href="https://dgl.cx/tag/dns">dns</a>, <a href="https://dgl.cx/tag/wikipedia">wikipedia</a>
  </span></p></div></div>
  </body>
</html>
