<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/maharmstone/ntfs2btrfs">Original</a>
    <h1>Ntfs2btrfs does in-place conversion of NTFS filesystem to the open-source Btrfs</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Ntfs2btrfs is a tool which does in-place conversion of Microsoft&#39;s NTFS
filesystem to the open-source filesystem Btrfs, much as <code>btrfs-convert</code>
does for ext2. The original image is saved as a reflink copy at
<code>image/ntfs.img</code>, and if you want to keep the conversion you can delete
this to free up space.</p>
<p dir="auto">Although I believe this tool to be stable, please note that I take no
responsibility if something goes awry!</p>
<p dir="auto">You&#39;re probably also interested in <a href="https://github.com/maharmstone/btrfs">WinBtrfs</a>,
which is a Btrfs filesystem driver for Windows.</p>
<p dir="auto">Thanks to <a href="https://github.com/ebiggers">Eric Biggers</a>, who <a href="https://github.com/ebiggers/ntfs-3g-system-compression/">successfully reverse-engineered</a> Windows 10&#39;s
&#34;WOF compressed data&#34;, and whose code I&#39;ve used here.</p>

<p dir="auto">On Windows, from an Administrator command prompt:</p>
<p dir="auto"><code>ntfs2btrfs.exe D:\</code></p>
<p dir="auto">Bear in mind that it won&#39;t work with your boot drive or a drive containing a
pagefile that&#39;s currently in use.</p>
<p dir="auto">If you are using WinBtrfs, you will need to clear the readonly flag on the
<code>image</code> subvolume before you can delete it.</p>
<p dir="auto">On Linux, as root:</p>
<p dir="auto"><code>ntfs2btrfs /dev/sda1</code></p>

<p dir="auto">On Windows, go to the <a href="https://github.com/maharmstone/ntfs2btrfs/releases">Releases page</a> and
download the latest Zip file, or use <a href="https://github.com/ScoopInstaller/Main/blob/master/bucket/ntfs2btrfs.json">Scoop</a>.</p>
<p dir="auto">For Linux:</p>
<ul dir="auto">
<li><a href="https://aur.archlinux.org/packages/ntfs2btrfs" rel="nofollow">Arch</a></li>
<li><a href="https://src.fedoraproject.org/rpms/ntfs2btrfs" rel="nofollow">Fedora</a> (thanks to <a href="https://github.com/Conan-Kudo">Conan-Kudo</a>)</li>
<li>Gentoo - available as sys-fs/ntfs2btrfs in the guru repository</li>
<li><a href="https://packages.debian.org/ntfs2btrfs" rel="nofollow">Debian</a> (thanks to <a href="https://github.com/alexmyczko">alexmyczko</a>)</li>
<li><a href="https://packages.ubuntu.com/ntfs2btrfs" rel="nofollow">Ubuntu</a> (thanks to <a href="https://github.com/alexmyczko">alexmyczko</a>)</li>
<li><a href="https://build.opensuse.org/package/show/filesystems/ntfs2btrfs" rel="nofollow">openSUSE</a> (thanks to David Sterba)</li>
</ul>
<p dir="auto">For other distributions or operating systems, you will need to compile it yourself - see
below.</p>

<ul dir="auto">
<li>
<p dir="auto">20240115</p>
<ul dir="auto">
<li>Fixed compilation on GCC 14 (<code>-Werror=incompatible-pointer-types</code> now enabled by default)</li>
</ul>
</li>
<li>
<p dir="auto">20230501</p>
<ul dir="auto">
<li>Fixed inline extent items being written out of order (not diagnosed by <code>btrfs check</code>)</li>
<li>Fixed metadata items being written with wrong level value (not diagnosed by <code>btrfs check</code>)</li>
<li>ADSes with overly-long names now get skipped</li>
</ul>
</li>
<li>
<p dir="auto">20220812</p>
<ul dir="auto">
<li>Added --no-datasum option, to skip calculating checksums</li>
<li>LXSS / WSL metadata is now preserved</li>
<li>Fixed lowercase drive letters not being recognized</li>
<li>Fixed crash due to iterator invalidation (thanks to nyanpasu64)</li>
<li>Fixed corruption when NTFS places file in last megabyte of disk</li>
</ul>
</li>
<li>
<p dir="auto">20210923</p>
<ul dir="auto">
<li>Added (Btrfs) compression support (zlib, lzo, and zstd)</li>
<li>Added support for other hash algorithms: xxhash, sha256, and blake2</li>
<li>Added support for rolling back to NTFS</li>
<li>Added support for NT4-style security descriptors</li>
<li>Increased conversion speed for volume with many inodes</li>
<li>Fixed bug when fragmented file was in superblock location</li>
<li>Fixed buffer overflow when reading security descriptors</li>
<li>Fixed bug where filesystems would be corrupted in a way that <code>btrfs check</code> doesn&#39;t pick up</li>
</ul>
</li>
<li>
<p dir="auto">20210523</p>
<ul dir="auto">
<li>Improved handling of large compressed files</li>
</ul>
</li>
<li>
<p dir="auto">20210402 (source code only release)</p>
<ul dir="auto">
<li>Fixes for compilation on non-amd64 architectures</li>
</ul>
</li>
<li>
<p dir="auto">20210105</p>
<ul dir="auto">
<li>Added support for NTFS compression</li>
<li>Added support for &#34;WOF compressed data&#34;</li>
<li>Fixed problems caused by sparse files</li>
<li>Miscellaneous bug fixes</li>
</ul>
</li>
<li>
<p dir="auto">20201108</p>
<ul dir="auto">
<li>Improved error handling</li>
<li>Added better message if NTFS is corrupted or unclean</li>
<li>Better handling of relocations</li>
</ul>
</li>
<li>
<p dir="auto">20200330</p>
<ul dir="auto">
<li>Initial release</li>
</ul>
</li>
</ul>

<p dir="auto">On Windows, open the source directory in a recent version of MSVC, right-click
on CMakeLists.txt, and click Compile.</p>
<p dir="auto">On Linux:</p>
<div data-snippet-clipboard-copy-content="mkdir build
cd build
cmake ..
make"><pre><code>mkdir build
cd build
cmake ..
make
</code></pre></div>
<p dir="auto">You&#39;ll also need <a href="https://github.com/fmtlib/fmt">libfmt</a> installed - it should be
in your package manager.</p>
<p dir="auto">Compression support requires zlib, lzo, and/or zstd - again, they will be in your
package manager. See also the cmake options WITH_ZLIB, WITH_LZO, and WITH_ZSTD,
if you want to disable this.</p>

<ul dir="auto">
<li>Files</li>
<li>Directories</li>
<li>Symlinks</li>
<li>Other reparse points</li>
<li>Security descriptors</li>
<li>Alternate data streams</li>
<li>DOS attributes (hidden, system, etc.)</li>
<li>Rollback to original NTFS image</li>
<li>Preservation of LXSS metadata</li>
</ul>

<ul dir="auto">
<li>Windows&#39; old extended attributes (you&#39;re not using these)</li>
<li>Large (i.e &gt;16KB) ADSes (you&#39;re not using these either)</li>
<li>Preservation of the case-sensitivity flag</li>
<li>Unusual cluster sizes (i.e. not 4 KB)</li>
<li>Encrypted files</li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">Can I boot Windows from Btrfs with this?</h2><a id="user-content-can-i-boot-windows-from-btrfs-with-this" aria-label="Permalink: Can I boot Windows from Btrfs with this?" href="#can-i-boot-windows-from-btrfs-with-this"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Yes, if the stars are right. See <a href="https://github.com/maharmstone/quibble">Quibble</a>.</p>
</article></div></div>
  </body>
</html>
