<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://arcan-fe.com/2024/09/16/a-spreadsheet-and-a-debugger-walks-into-a-shell/">Original</a>
    <h1>A Spreadsheet and a Debugger Walk into a Shell</h1>
    
    <div id="readability-page-1" class="page"><div>
						
<p>Here we continue the series of posts on the development of a command-line shell which defies terminal emulation by using the display server API locally and a purpose built network protocol remotely.</p>



<p>Previous episodes include: <a href="https://arcan-fe.com/2022/04/02/the-day-of-a-new-command-line-interface-shell/">The Day of a new Command-Line Interface: Shell</a> (high level) <a href="https://arcan-fe.com/2022/10/15/whipping-up-a-new-shell-lashcat9/">Whipping up a new Shell – Lash#Cat9</a> (technical demo), <a href="https://arcan-fe.com/2024/05/17/cat9-microdosing-stash-and-list/">Cat9 Microdosing: Stash and List</a> (feature highlight), <a href="https://arcan-fe.com/2024/08/05/cat9-microdosing-each-and-contain/">Cat9 Microdosing: Each and Contain</a> (feature highlight)</p>



<p>For this round we have added an interactive spreadsheet representation and a <a href="https://microsoft.github.io/debug-adapter-protocol//">Debug Adapter Protocol</a> implementation. These come as two discrete sets of builtins (groups of commands), ‘dev’ and ‘spreadsheet’ with a surprise interaction or two.</p>



<p>The intent for the dev builtin is to eventually collect more and more useful tools for managing all aspects of software development, from source control management to building, testing and fuzzing.</p>



<p>Starting with the spreadsheet. By typing:</p>



<pre>builtin spreadsheet</pre>



<p>You would get something like the following screenshot:</p>



<figure><img data-attachment-id="8924" data-permalink="https://arcan-fe.com/2024/09/16/a-spreadsheet-and-a-debugger-walks-into-a-shell/spread1/" data-orig-file="https://arcan-fe.com/wp-content/uploads/2024/09/spread1.png" data-orig-size="936,520" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="spread1" data-image-description="" data-image-caption="" data-medium-file="https://arcan-fe.com/wp-content/uploads/2024/09/spread1.png?w=300" data-large-file="https://arcan-fe.com/wp-content/uploads/2024/09/spread1.png?w=640" tabindex="0" role="button" width="936" height="520" src="https://arcan-fe.com/wp-content/uploads/2024/09/spread1.png?w=936" alt=""/></figure>



<p>The following clip shows how I spawn new spreadsheet, populated by a CSV source and using the mouse cursor to interact with the layout.</p>



<figure></figure>



<p>This complements the form intended for media processing that was presented a few years ago as “<a href="https://arcan-fe.com/2021/04/12/introducing-pipeworld/">Pipeworld</a>” and re-uses the same language and parsing logic.</p>



<p>Cells can be populated with static contents, expressions like <code>=max(A1:A4)</code> or even shell commands through the ! prefix, e.g. <code>!date +%Y:%M:%S</code>. The following clip shows some basic expression use, as well as forced reprocessing of expressions and shell commands.</p>



<figure><figcaption>Combining shell commands with expressions that are re-executed on request</figcaption></figure>



<p>More useful is to populate the sheet with outputs from some command and processed by Lua patterns. The following screenshot shows the result of running <code>insert #0 4 separate &#34;%s+:&#34; !cat /proc/cpuinfo</code></p>



<figure><img data-attachment-id="8933" data-permalink="https://arcan-fe.com/2024/09/16/a-spreadsheet-and-a-debugger-walks-into-a-shell/cpuinfo/" data-orig-file="https://arcan-fe.com/wp-content/uploads/2024/09/cpuinfo.png" data-orig-size="936,442" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="cpuinfo" data-image-description="" data-image-caption="" data-medium-file="https://arcan-fe.com/wp-content/uploads/2024/09/cpuinfo.png?w=300" data-large-file="https://arcan-fe.com/wp-content/uploads/2024/09/cpuinfo.png?w=640" tabindex="0" role="button" width="936" height="442" src="https://arcan-fe.com/wp-content/uploads/2024/09/cpuinfo.png?w=936" alt=""/><figcaption>Populating a spreadsheet at some insertion point using a shell command split and separated with Lua patterns</figcaption></figure>



<p>Exporting can be done using the existing <code>copy</code> builtin with control over output format, subrange and so on: copy <code>#4(csv, compact, a1:b5)</code> to export the resolved values of a1,b1,a2,b2 … as CSV.</p>



<p>There is still more to be done for this to be a complete replacement for the likes of <a href="https://github.com/andmarti1424/sc-im">sc-im,</a> and to add things like plotting via gnuplot (if I can ever get their plot language to behave) and graphviz, as well more experimental things like importing Makefiles – — but at least for my, admittedly humble, spreadsheet uses it is good enough for daily driving.</p>



<h2><em>Onwards to the Debugger</em> </h2>



<p>To start things you would do something like the following:</p>



<pre><code><code>builtin dev</code>
debug launch ./test</code></pre>



<p>The ‘dev’ builtin set is used as it will eventually accumulate all developer task related commands like building, deployment, source control management and so on.</p>



<p>The following clip shows the default behaviour for that in action. In it you can see how multiple discrete jobs are created for managing threads, breakpoints and so on, detachable and with mouse cursor handling in place.</p>



<figure><figcaption>Basic debugger use and navigation</figcaption></figure>



<p>In the clip I also showed the process of stepping through threads, spawning source view, setting and toggling breakpoints, inspecting registers and modifying target variables.</p>



<p>I have spent thousands of hours staring at the GDB CLI prompt, and hated nearly every second of it. Not because of the relaxing task of debugging code or exploring software state itself, but for the absolutely atrocious terminal thrashing interface even with mitigation layers such as <a href="https://github.com/pwndbg/pwndbg">pwndbg</a>. In fairness, a debugger TUI is in the deepest end of the complexity pool to get going.</p>



<p>There is a lot that goes into handling the protocol, and quite a few telltale signs of its designers, so we have just passed the point of basic bring-up. Importantly it is all composable with the data manipulation, filtering and transfer tools we already have elsewhere.</p>



<p>As an example of that we have ‘contain’ from the <a href="https://arcan-fe.com/2024/08/05/cat9-microdosing-each-and-contain/">previous article</a>, for instance, to bunch all the subwindows together into one contained job, useful when running multiple debug sessions side by side to step through multi-process issues.</p>



<p>We do have some other conveniences in place. Stepping controls are defined by the granularity of the job it represents, so stepping in the disassembly view would step instructions, while stepping in the source view would go by line or statement and so on.</p>



<p>Now to close the loop and mix in the spreadsheet part. In the following clip you see me picking a few registers and thread source location that gets added to a watch set. Whenever thread execution is stopped, these will be resampled and updated.</p>



<p>I then click the ‘spreadsheet’ option which will create a spreadsheet and populate it with the contents of the watchset as I go.</p>



<figure><figcaption>Live mapping watched dataset to spreadsheet</figcaption></figure>



<p>With all this in place we can almost start stitching the many other related projects together, from the data visualization from <a href="https://arcan-fe.com/2015/02/08/next-experiment-senseye/">Senseye</a> (closing in on 10 years…) with the window management from <a href="https://arcan-fe.com/2021/04/12/introducing-pipeworld/">Pipeworld</a> to the harnessing and setup from <a href="https://arcan-fe.com/2020/02/10/leveraging-the-display-server-to-improve-debugging/">Leveraging the Display Server to Improve Debugging</a> and build the panopticon of debugging from the plan presented in “Retooling and Securing Systemic Debugging” (2012, doi:10.1007/978-3-642-34210-3_10). But that is for another time.</p>
											</div></div>
  </body>
</html>
