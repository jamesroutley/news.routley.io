<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/tech/SSDWritePerfMetricsWish">Original</a>
    <h1>I wish SSDs gave you CPU performance style metrics about their activity</h1>
    
    <div id="readability-page-1" class="page"><div><h2>I wish SSDs gave you CPU performance style metrics about their activity</h2>

	<p><small>October 18, 2025</small></p>
</div><div><p>Modern CPUs have an impressive collection of performance counters
for detailed, low level information on things like cache misses,
branch mispredictions, various sorts of stalls, and so on; on Linux
you can use &#39;perf list&#39; to see them all. Modern SSDs (NVMe, SATA,
and SAS) are all internally quite complex, and their behavior under
load depends on a lot of internal state. It would be nice to have
CPU performance counter style metrics to expose some of those
details. For a relevant example that&#39;s on my mind (<a href="https://utcc.utoronto.ca/~cks/space/blog/tech/JournalCanSerializeFsyncWrites">cf</a>), it certainly would be interesting
to know how often flash writes had to stall while blocks were hastily
erased, or the current erase rate.</p>

<p>Having written this, I checked some of our SSDs (the ones I&#39;m most
interested in at the moment) and I see that our SATA SSDs do expose
some of this information as (vendor specific) <a href="https://en.wikipedia.org/wiki/S.M.A.R.T.">SMART</a> attributes, with things
like &#39;block erase count&#39; and &#39;NAND GB written&#39; to TLC or SLC (as
well as the host write volume and so on stuff you&#39;d expect). <a href="https://utcc.utoronto.ca/~cks/space/blog/tech/NVMeAndSMART">NVMe
does this in a different way</a> that doesn&#39;t have the
sort of easy flexibility that <a href="https://utcc.utoronto.ca/~cks/space/blog/tech/SMARTAttributeNamesMadeUp">SMART attributes</a> do, so a random one of <a href="https://support.cs.toronto.edu/">ours</a> that I checked doesn&#39;t seem to
provide this sort of lower level information.</p>

<p>It&#39;s understandable that SSD vendors don&#39;t necessarily want to
expose this sort of information, but it&#39;s quite relevant if you&#39;re
trying to understand unusual drive performance. For example, for
your workload do you need to <a href="https://utcc.utoronto.ca/~cks/space/blog/tech/SSDsAndBlockDiscardTrim">TRIM your drives</a>
more often, or do they have enough pre-erased space available when
you need it? Since TRIM has an overhead, you may not want to blindly
do it on a frequent basis (and its full effects aren&#39;t entirely
predictable since they depend on how much the drive decides to
actually erase in advance).</p>

<p>(Having looked at SMART &#39;block erase count&#39; information on one of
our servers, it&#39;s definitely doing something when the server is
under heavy fsync() load, but I need to cross-compare the numbers
from it to other systems in order to get a better sense of what&#39;s
exceptional and what&#39;s not.)</p>

<p>I&#39;m currently more focused on write related metrics, but there&#39;s
probably important information that could be exposed for reads and
for other operations. I&#39;d also like it if SSDs provided counters
for how many of various sorts of operations they saw, because while
your operating system can in theory provide this, it often doesn&#39;t
(or doesn&#39;t provide them at the granularity of, say, how many writes
with &#39;Force Unit Access&#39; or how many &#39;Flush&#39; operations were done).</p>

<p>(In Linux, I think I&#39;d have to extract this low level operation
information in an ad-hoc way with eBPF tracing.)</p>
</div></div>
  </body>
</html>
