<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://radicle.xyz/2025/08/14/jujutsu-with-radicle">Original</a>
    <h1>Jujutsu and Radicle</h1>
    
    <div id="readability-page-1" class="page"><div>
      
      <p>How I use Jujutsu in tandem with Radicle</p>
      
      <ul><li><a href="#radicle-and-git">Radicle and Git</a><ul><li><a href="#my-gitconfig">My <code>.git/config</code></a></li><li><a href="#git-fetch-rad-and-git-push-rad"><code>git fetch rad</code> and <code>git push rad</code></a></li></ul></li><li><a href="#jujutsu-and-git">Jujutsu and Git</a><ul><li><a href="#jj-new"><code>jj new</code></a></li><li><a href="#jj-edit"><code>jj edit</code></a></li><li><a href="#jj-squash"><code>jj squash</code></a></li><li><a href="#jj-rebase"><code>jj rebase</code></a></li><li><a href="#my-jjconfig">My <code>.jj/config</code></a><ul><li><a href="#user-config">User Config</a></li><li><a href="#repository-config">Repository Config</a></li></ul></li></ul></li><li><a href="#radicle-and-jujutsu">Radicle and Jujutsu</a><ul><li><a href="#contributing-patches">Contributing Patches</a><ul><li><a href="#creating-a-new-patch">Creating a New Patch</a></li><li><a href="#updating-a-patch">Updating a Patch</a></li></ul></li><li><a href="#maintaining-patches">Maintaining Patches</a></li></ul></li></ul>
      <p>Roughly a year ago at the first ever <a href="https://www.localfirstconf.com/">Local First Conference</a>, a friend and
previous colleague – <a href="https://patternist.xyz">Alex Good</a> – told me about this tool called
<code>jj</code> (<a href="https://jj-vcs.github.io/jj/v0.30.0/">Jujutsu</a>). We did the usual thing and I sat down beside him as he
explained it to me. My brain did the usual thing and took in some of the
information but not enough of it, and so I didn’t touch <code>jj</code> for quite some time
after that – but what’s good enough for Alex Good is good enough for me.</p>

<p>After that, I feel like I saw a post about <code>jj</code> once every couple of months on
Hacker News – confirmation bias anyone? It was a constant talking point during
Git Merge 2024, and now it’s a third Git tool that uses the concept of change
identifiers, so it’s a talking point on the <a href="https://lore.kernel.org/git/CAESOdVAspxUJKGAA58i0tvks4ZOfoGf1Aa5gPr0FXzdcywqUUw@mail.gmail.com/">Git mailing list</a>.</p>

<p>So, fast-forward a year or so, and I’ve been using <code>jj</code> for quite some time
while contributing to and maintaining the <code>heartwood</code> repository – the home of
the Radicle protocol – as well as some others. Did I have to convince my whole
team that <code>jj</code> should be used by all of us and we all switch to this new
workflow? No. The first piece of “magic” of <code>jj</code> is that it is essentially a
version control system that has a transparent layer on top of Git itself. A
change in <code>jj</code> will always point to a Git commit. The beauty of its
implementation is that the underlying commit can change as much as it wants,
while the <code>jj</code> change remains the same. This unlocks a lot of nice flows for
managing changes using <code>jj</code>.</p>

<p>So, you must be wondering by now, “How do I blend Radicle with <code>jj</code>?” Well,
let’s dance between the three worlds of <code>jj</code>, Git, and Radicle, to see how they
have melted together to form a beautiful (<em>almost</em>) branch-less workflow.</p>

<h3 id="radicle-and-git">Radicle and Git</h3>

<p>I won’t spend too much time here, but if you don’t know by now, Radicle works on
top of Git to allow people to use this ubiquitous tool, while we benefit from
its storage and protocol. When you start a Radicle repository, it’s essentially
a Git repository where we use some special references and extension points of
Git to cryptographically secure your commits, and store all your
<a href="https://radicle.xyz/guides/user#2-collaborating-the-radicle-way">social, collaborative artifacts</a>. If you haven’t yet, go
<a href="https://radicle.xyz/download">download</a> Radicle and try it yourself using our <a href="https://radicle.xyz/guides">guides</a>.</p>

<p>Note that if you’re already familiar with <code>jj</code> this might not be that
interesting for you, and you can skip to <a href="#user-config">User Config</a>.</p>

<h4 id="my-gitconfig">My <code>.git/config</code></h4>

<p>As a maintainer of a few repositories using Radicle, I naturally need to push to
and fetch from the repository in Radicle <a href="https://app.radicle.xyz/nodes/ash.radicle.garden/rad:z3trNYnLWS11cJWC6BbxDs5niGo82/tree/0003-storage-layout.md">storage</a>. This means
that I’ll need a remote – this is set up for you when you run <code>rad init</code> or <code>rad
clone</code>. This looks like:</p>

<div><div><pre><code><span>[remote &#34;rad&#34;]</span>
	<span>url</span> <span>=</span> <span>rad://z371PVmDHdjJucejRoRYJcDEvD5pp</span>
	<span>fetch</span> <span>=</span> <span>+refs/heads/*:refs/remotes/rad/*</span>
	<span>fetch</span> <span>=</span> <span>+refs/tags/*:refs/remotes/rad/tags/*</span>
	<span>pushurl</span> <span>=</span> <span>rad://z371PVmDHdjJucejRoRYJcDEvD5pp/z6MkireRatUThvd3qzfKht1S44wpm4FEWSSa4PRMTSQZ3voM</span>
<span>[branch &#34;master&#34;]</span>
	<span>remote</span> <span>=</span> <span>rad</span>
	<span>merge</span> <span>=</span> <span>refs/heads/master</span>
</code></pre></div></div>

<p>The <code>rad://</code> URL tells <code>git</code> which <a href="https://git-scm.com/docs/gitremote-helpers">remote helper</a> to use
by trying to find <code>git-remote-rad</code>. This will handle fetching/pushing from/to
the repository identified by <code>z371PVmDHdjJucejRoRYJcDEvD5pp</code>. The string
<code>z6MkireRatUThvd3qzfKht1S44wpm4FEWSSa4PRMTSQZ3voM</code> is my Node ID, and
identifies my machine
which makes sure that when I push, my references get stored under that
<a href="https://app.radicle.xyz/nodes/ash.radicle.garden/rad:z3trNYnLWS11cJWC6BbxDs5niGo82/tree/0003-storage-layout.md#layout">namespace</a>. Then when have the usual upstream branch setup
for <code>master</code> for the <code>rad</code> remote – you may be familiar with this Git config entry
when you have your <code>origin</code> set up for another Git forge.</p>

<p>There’s one last piece of the puzzle in config that is an alias for easily
creating a Radicle <a href="https://radicle.xyz/guides/user#working-with-patches">patch</a>.</p>

<div><div><pre><code><span>[alias]</span>
    <span>patch</span> <span>=</span> <span>push rad HEAD:refs/patches</span>
</code></pre></div></div>

<p>When you push to the special reference <code>refs/patches</code>, the remote helper will
catch this and create a new patch for you, and in this case it will use whatever
<code>HEAD</code> is for the head of the patch. Note that it will use whatever <code>rad/master</code>
is as the base of the patch – that is to say, whatever commits are between
<code>rad/master</code> and <code>HEAD</code> (including <code>HEAD</code>) are the commits being proposed by the
patch. So, whenever I’m ready to make a patch, I use <code>git patch</code> and my
<code>$EDITOR</code> pops open to make my well-crafted message describing what changes I’m
making.</p>

<h4 id="git-fetch-rad-and-git-push-rad"><code>git fetch rad</code> and <code>git push rad</code></h4>

<p>This is going to be brief. All I do with <code>git</code> now is <code>git fetch rad</code> (or my
peer’s remotes) to fetch any new work in Radicle storage. For pushing I will use
<code>git push rad</code> to create or update patches (coming up), update my version of
<code>master</code>, and, on the rare occasion, push a branch. That’s it! No more <code>commit</code>,
no more <code>rebase</code>, no more <code>merge</code> – ok I still use <code>git log</code> – but that’s pretty
much it. So how did I ditch all of these commands? Let’s take a look <code>jj</code>.</p>

<h3 id="jujutsu-and-git">Jujutsu and Git</h3>

<p>Let’s see how I’m using <code>jj</code> by visiting several of its commands and seeing how
I can use them in different scenarios.</p>

<h4 id="jj-new"><code>jj new</code></h4>

<p>It’s only natural to start off with <code>jj new</code>. This command creates a new change
in <code>jj</code>, as well as creating a new, empty commit for that change. Whenever I’m
going to make a new change that’s based on the <code>master</code> branch, I run:</p>

<pre>$ jj new master@rad
Working copy  (@) now at: <span></span><span>qx</span><span>uvyurn</span><span> </span><span>8e</span><span>711a87</span><span> </span><span>(empty)</span><span> </span><span>(no description set)</span>
Parent commit (@-)      : <span></span><span>xsl</span><span>qmmsl</span> <span></span><span>62</span><span>cdaf6d</span> <span>master@rad</span><span> | </span>deployment: Vercel → Cloudflare Workers
Added 0 files, modified 0 files, removed 1 files
</pre>

<p>You’ll notice that <code>jj</code> spits out a Change ID and a Commit ID. You may also
notice that a prefix is highlighted – this is the unique prefix for the change
and the commit at this time! Which means that I can use <code>qx</code> or <code>8e</code> to refer to
this particular change or commit without any ambiguity; an amazing UX, if you
ask me.</p>

<p>At this point, I might know what I’m going to be working on so I use <code>jj
describe</code> to give this change a message.</p>

<pre>$ jj describe -m <span>&#34;blog: Radicle and JJ&#34;</span>
Working copy  (@) now at: <span></span><span>qx</span><span>uvyurn</span><span> </span><span>40</span><span>8133a5</span><span> </span><span>(empty)</span><span> blog: Radicle and JJ</span>
Parent commit (@-)      : <span></span><span>xsl</span><span>qmmsl</span> <span></span><span>62</span><span>cdaf6d</span> <span>master@rad</span><span> | </span>deployment: Vercel → Cloudflare Workers
</pre>

<p>I’ve now changed the description so that it no longer says <code>(no description
yet)</code>, and it now reads <code>blog: Radicle and JJ</code>.</p>

<p>So let’s see what we have here:</p>

<pre>$ jj show qx
Commit ID: <span>408133a5e54c80d2398be0c78cccabbd6063902d</span>
Change ID: <span>qxuvyurnqsvupzlpzsvzzpqlmlqvoxwq</span>
Author   : <span>Fintan Halpenny</span> &lt;<span>fintan.halpenny@radicle.xyz</span>&gt; (<span>2025-06-10 07:52:34</span>)
Committer: <span>Fintan Halpenny</span> &lt;<span>fintan.halpenny@radicle.xyz</span>&gt; (<span>2025-06-10 07:52:34</span>)

    blog: Radicle and JJ
</pre>

<p>We can see that it looks similar to a Git commit, which we can also inspect
using:</p>

<pre>$ git show 408133a5e54c80d2398be0c78cccabbd6063902d
<span>commit 408133a5e54c80d2398be0c78cccabbd6063902d</span>
Author: Fintan Halpenny &lt;fintan.halpenny@radicle.xyz&gt;
Date:   2025-06-10 07:52:34 +0200

    blog: Radicle and JJ
</pre>

<p>This leaves us in a position to do our usual changes within our working copy of
the Git repository.</p>

<p>At any point where I’m looking to separate changes, I can use <code>jj new</code> again,
specifying any change to make a new change after the given change:</p>

<pre>$ jj new qx
Working copy  (@) now at: <span></span><span>w</span><span>msmovxx</span><span> </span><span>c5</span><span>0301c1</span><span> </span><span>(empty)</span><span> </span><span>(no description set)</span>
Parent commit (@-)      : <span></span><span>qx</span><span>uvyurn</span> <span></span><span>40</span><span>8133a5</span> blog: Radicle and JJ
</pre>

<pre>$ jj describe -m <span>&#34;blog: Radicle an JJ - add body&#34;</span>
Working copy  (@) now at: <span></span><span>w</span><span>msmovxx</span><span> </span><span>a3</span><span>d195ad</span><span> </span><span>(empty)</span><span> blog: Radicle and JJ – add body</span>
Parent commit (@-)      : <span></span><span>qx</span><span>uvyurn</span> <span></span><span>40</span><span>8133a5</span> blog: Radicle and JJ
</pre>

<p>If I ever think I’m about to make some changes before the change I’m on, then I
can use the <code>-B</code> option:</p>

<pre>$ jj new -B @
Rebased 1 descendant commits
Working copy  (@) now at: <span></span><span>zv</span><span>rmpyox</span><span> </span><span>f0</span><span>635336</span><span> </span><span>(empty)</span><span> </span><span>(no description set)</span>
Parent commit (@-)      : <span></span><span>xsl</span><span>qmmsl</span> <span></span><span>62</span><span>cdaf6d</span> <span>master@rad</span><span> | </span>deployment: Vercel → Cloudflare Workers
Added 0 files, modified 0 files, removed 1 files
</pre>

<h4 id="jj-edit"><code>jj edit</code></h4>

<p>At any point in time, I can also decide to go back to an old change and edit it,
specifying the change that I want to edit:</p>

<pre>$ jj edit qx
Working copy  (@) now at: <span></span><span>qx</span><span>uvyurn</span><span> </span><span>40</span><span>8133a5</span><span> blog: Radicle and JJ</span>
Parent commit (@-)      : <span></span><span>xsl</span><span>qmmsl</span> <span></span><span>62</span><span>cdaf6d</span> <span>master@rad</span><span> | </span>deployment: Vercel → Cloudflare Workers
</pre>

<p>You can now forget about all those <code>fixup!</code> commits you were making to add
changes into previous commits. No longer are you at the mercy of making a commit
that is ahead of some other changes and you need to reorder it using <code>git
rebase</code>. You taste that? It tastes like victory…</p>

<h4 id="jj-squash"><code>jj squash</code></h4>

<p>Ok, so you’ve made some changes that are not related to the current change? This
happens, or at least it does to me – I’m not perfect, (un)fortunately. I can use
the power of <code>jj new</code>, whether after or before the current change, and combine
it with <code>jj squash</code>:</p>

<pre>$ jj squash -u --from w --to qx
Rebased 1 descendant commits
Working copy  (@) now at: <span></span><span>qx</span><span>uvyurn</span><span> </span><span>1e</span><span>2b0ccc</span><span> </span><span>(empty)</span><span> blog: Radicle and JJ</span>
Parent commit (@-)      : <span></span><span>xsl</span><span>qmmsl</span> <span></span><span>62</span><span>cdaf6d</span> <span>master@rad</span><span> | </span>deployment: Vercel → Cloudflare Workers
</pre>

<p>This says that I’m squashing the changes from the change identified by <code>w</code> into
the change <code>qx</code>, and I want to keep the description of <code>qx</code> and drop the
description of <code>w</code> (the <code>-u</code> option).</p>

<p>For extra points, <code>jj</code> even includes the beautiful <code>-i</code> option for <em>choosing</em>
which changes you’re taking from the source change – via a TUI. I cannot
begin to describe how useful this is for moving around file changes and keeping
my history clean and linear.</p>

<h4 id="jj-rebase"><code>jj rebase</code></h4>

<p>The final piece of the puzzle, at least for my workflow, is <code>jj rebase</code>. I can
move around changes and put them on top of a destination change:</p>

<pre>$ jj rebase -d qx -r sm
Working copy  (@) now at: <span></span><span>sm</span><span>vvuqzo</span><span> </span><span>42</span><span>0180e8</span> blog: relevant blog material
Parent commit (@-)      : <span></span><span>qx</span><span>uvyurn</span> <span></span><span>1e</span><span>2b0ccc</span> blog: Radicle and JJ
Added 1 files, modified 0 files, removed 0 files
</pre>

<p>This rebases the change <code>sm</code> onto the change <code>qx</code>. In fact, the <code>-r</code> can take a
set of changes (see <a href="https://jj-vcs.github.io/jj/v0.30.0/revsets">revsets</a>) and graft them all on top of the
destination.</p>

<h4 id="my-jjconfig">My <code>.jj/config</code></h4>

<p>The final part I’ll touch on is my <code>jj</code> config, which can be split into the user
and repo config. Thanks to Bruno, who wrote a lot of this on Zulip, and I
cribbed it from him.</p>

<h5 id="user-config">User Config</h5>

<p>Here is my user config, and we’ll discuss a couple of the entries, and I’ll
leave the rest as homework.</p>

<div><div><pre><code><span>[aliases]</span>
<span>dlog</span> <span>=</span> <span>[</span><span>&#34;log&#34;</span><span>,</span> <span>&#34;-r&#34;</span><span>]</span>
<span>l</span> <span>=</span> <span>[</span><span>&#34;log&#34;</span><span>,</span> <span>&#34;-r&#34;</span><span>,</span> <span>&#34;(trunk()..@):: | (trunk()..@)-&#34;</span><span>]</span>
<span>fresh</span> <span>=</span> <span>[</span><span>&#34;new&#34;</span><span>,</span> <span>&#34;trunk()&#34;</span><span>]</span>
<span>tug</span> <span>=</span> <span>[</span>
    <span>&#34;bookmark&#34;</span><span>,</span>
    <span>&#34;move&#34;</span><span>,</span>
    <span>&#34;--from&#34;</span><span>,</span>
    <span>&#34;closest_bookmark(@)&#34;</span><span>,</span>
    <span>&#34;--to&#34;</span><span>,</span>
    <span>&#34;closest_pushable(@)&#34;</span><span>,</span>
<span>]</span>

<span>[revset-aliases]</span>
<span>&#34;closest_bookmark(to)&#34;</span> <span>=</span> <span>&#34;heads(::to &amp; bookmarks())&#34;</span>
<span>&#34;closest_pushable(to)&#34;</span> <span>=</span> <span>&#34;heads(::to &amp; mutable() &amp; ~description(exact:</span><span>\&#34;\&#34;</span><span>) &amp; (~empty() | merges()))&#34;</span>
<span>&#34;desc(x)&#34;</span> <span>=</span> <span>&#34;description(x)&#34;</span>
<span>&#34;pending()&#34;</span> <span>=</span> <span>&#34;.. ~ ::tags() ~ ::remote_bookmarks() ~ @ ~ private()&#34;</span>
<span>&#34;private()&#34;</span> <span>=</span> <span>&#34;description(glob:&#39;wip:*&#39;) | </span><span>\
</span><span>    description(glob:&#39;private:*&#39;) | </span><span>\
</span><span>    description(glob:&#39;WIP:*&#39;) | </span><span>\
</span><span>    description(glob:&#39;PRIVATE:*&#39;) | </span><span>\
</span><span>    conflicts() | </span><span>\
</span><span>    (empty() ~ merges()) | </span><span>\
</span><span>    description(&#39;substring-i:</span><span>\&#34;</span><span>DO NOT MAIL</span><span>\&#34;</span><span>&#39;)&#34;</span>
</code></pre></div></div>

<ul>
  <li><code>fresh</code>: this allows me to have an alias for <code>jj new master@rad</code> and use <code>jj
fresh</code>.</li>
  <li><code>tug</code>: this allows me to tug the closest <a href="https://jj-vcs.github.io/jj/v0.30.0/bookmarks">bookmark</a> to a change
that can be pushed – we’ll see an example of this later.</li>
</ul>

<h5 id="repository-config">Repository Config</h5>

<p>And here is my repository config, which we’ll discuss a bit more in detail.</p>

<div><div><pre><code><span>[revset-aliases]</span>
<span>&#34;trunk()&#34;</span> <span>=</span> <span>&#34;master@rad&#34;</span>
<span>&#34;immutable_heads()&#34;</span> <span>=</span> <span>&#34;present(trunk()) | </span><span>\
</span><span>    tags() | </span><span>\
</span><span>    ( </span><span>\
</span><span>        untracked_remote_bookmarks() ~ </span><span>\
</span><span>        untracked_remote_bookmarks(remote=&#39;rad&#39;) ~ </span><span>\
</span><span>        untracked_remote_bookmarks(regex:&#39;^patch(es)/&#39;,remote=&#39;rad&#39;) </span><span>\
</span><span>    )&#34;</span>

<span>[git]</span>
<span>write-change-id-header</span> <span>=</span> <span>true</span>
</code></pre></div></div>

<p>We want to change the <code>trunk()</code> alias from its default in <code>jj</code> so that it points
to <code>master@rad</code>, the default branch in this particular Radicle repository. The
<code>trunk()</code> revset is used in a few place, for example, we saw it above in
<code>fresh</code>, but it is also in the next revset alias.</p>

<p>Some changes in <code>jj</code> will be marked as <a href="https://jj-vcs.github.io/jj/v0.30.0/config/#set-of-immutable-commits">immutable</a>. <code>jj</code>
will prevent you from changing certain changes if they are marked as immutable,
and its default value for this can be very restrictive, so instead we change it
here. First we mark changes that are <code>present</code> in <code>trunk()</code> or <code>tags()</code> as
immutable. Then we have untracked remote bookmarks with the set difference
operator <code>~</code>. What are not marking as immutable are bookmarks that are in <code>rad</code>
or that <code>patch</code>/<code>patches</code>. That is, if the changes are ours or from patches,
then they’re safe to edit. You might think, “Why are patches safe?”” Well, let’s
finally get into Radicle and Jujutsu.</p>

<h3 id="radicle-and-jujutsu">Radicle and Jujutsu</h3>

<p>So here we are, a lot of build up to get to the point where I can describe how I
can avoid using branches (as much as possible).</p>

<h4 id="contributing-patches">Contributing Patches</h4>

<p>We will first dive into contributing a new patch using Radicle. As described in
<a href="#jujutsu-and-git">Jujutsu and Git</a>, I can start making a set of changes using
<code>jj new</code>, editing them just how I like using <code>jj edit</code>, and ordering them just
the way I want with <code>jj rebase</code> and <code>jj squash</code>. During this whole time, I’m in
that, initially scary, <a href="https://wizardzines.com/comics/detached-head-state/">detached HEAD state</a>. Here it comes,
we’re going to make a patch!</p>

<h5 id="creating-a-new-patch">Creating a New Patch</h5>



<p>That’s it. Well, the <code>$EDITOR</code> opens and I write a title and a body describing
my wonderful changes, and when I’m done, the remote helper will create the patch
and announce it to the network.</p>

<pre><span>✓</span> Patch <span>e5f0a5a5adaa33c3b931235967e4930ece9bb617</span> opened
<span>✓</span> Synced with <span>8</span> node(s)

To rad://z3cyotNHuasWowQ2h4yF9c3tFFdvc/z6MkvZwzK64f3GuDcAs6dEcje89ddfHkBjS1v9Dkh7aCGq3C
 * [new reference]   HEAD -&gt; refs/patches
</pre>

<h5 id="updating-a-patch">Updating a Patch</h5>

<p>Let’s be honest though, my wonderful changes are rarely wonderful from the
get-go. They need some polishing, and my peers always have great suggestions
that I should integrate into the patch.</p>

<p>From here, I can find the patch using <code>rad patch</code>:</p>

<pre>$ rad patch
<span>╭</span><span>───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><span>╮</span>
<span>│ </span>●  <span>ID</span>       <span>Title</span>                                                  <span>Author</span>                          <span>Reviews</span>    <span>Head</span>     <span>+</span>      <span>-</span>      <span>Updated</span>     <span> │</span>
<span>├</span><span>───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><span>┤</span>
<span>│ </span><span>●</span>  <span>18a71ad</span>  radicle-cli: Warn when using old names of nodes        <span>self</span>           <span>(you)</span>            - - - - -  <span>552f4af</span>  <span>+146</span>   <span>-3</span>     <span>4 days ago</span>  <span> │</span>
<span>│ </span><span>●</span>  <span>ed450c9</span>  node, profile, ssh: Make key location configurable     <span>self</span>           <span>(you)</span>            - - - - -  <span>d2f7b89</span>  <span>+376</span>   <span>-74</span>    <span>1 month ago</span> <span> │</span>
<span>│ </span><span>●</span>  <span>12bc851</span>  node, cli: Refactor test environment                   <span>self</span>           <span>(you)</span>            - - - - -  <span>d059957</span>  <span>+826</span>   <span>-1214</span>  <span>1 month ago</span> <span> │</span>
<span>│ </span><span>●</span>  <span>3219ef8</span>  Remove predefined bootstrap nodes                      <span>istankovic</span>     <span>z6MkmiJ…mkTV5sS</span>  - - - - -  <span>7322e3a</span>  <span>+138</span>   <span>-108</span>   <span>2 days ago</span>  <span> │</span>
<span>│ </span><span>●</span>  <span>058586b</span>  Suggest the git configured default branch during init  <span>stemporus</span>      <span>z6MkqLa…jr8xo5K</span>  - - - - -  <span>6a1147f</span>  <span>+16</span>    <span>-8</span>     <span>2 weeks ago</span> <span> │</span>
<span>│ </span><span>●</span>  <span>1015e51</span>  build: Rewrite tagging script                          <span>fintohaps</span>      <span>z6Mkire…SQZ3voM</span>  - - - - -  <span>149de0b</span>  <span>+24</span>    <span>-12</span>    <span>3 weeks ago</span> <span> │</span>
<span>│ </span><span>●</span>  <span>e85ff9a</span>  node: clean up `UploadError`                           <span>fintohaps</span>      <span>z6Mkire…SQZ3voM</span>  - - - - -  <span>b408e44</span>  <span>+15</span>    <span>-13</span>    <span>3 weeks ago</span> <span> │</span>
<span>│ </span><span>●</span>  <span>c54883e</span>  Canonical References                                   <span>fintohaps</span>      <span>z6Mkire…SQZ3voM</span>  - - - - -  <span>34014a6</span>  <span>+4642</span>  <span>-1575</span>  <span>1 month ago</span> <span> │</span>
<span>│ </span><span>●</span>  <span>e500399</span>  radicle: improve inline comments                       <span>fintohaps</span>      <span>z6Mkire…SQZ3voM</span>  - - - - -  <span>e7cab63</span>  <span>+924</span>   <span>-244</span>   <span>1 month ago</span> <span> │</span>
<span>│ </span><span>●</span>  <span>6080c3c</span>  Add issue instructions                                 <span>yorgos-laptop</span>  <span>z6MkrnX…CPFSFS3</span>  - - - - -  <span>1877285</span>  <span>+32</span>    <span>-15</span>    <span>1 month ago</span> <span> │</span>
<span>│ </span><span>●</span>  <span>40a8d72</span>  radicle: introduce COB stream                          <span>fintohaps</span>      <span>z6Mkire…SQZ3voM</span>  - - - - -  <span>ec00acb</span>  <span>+1178</span>  <span>-9</span>     <span>4 months ago</span><span> │</span>
<span>│ </span><span>●</span>  <span>8ab3f9c</span>  Add document on how to implement a new COB type        <span>liw</span>            <span>z6MkgEM…1b2w2FV</span>  - - - - -  <span>5a3b095</span>  <span>+314</span>   <span>-0</span>     <span>1 year ago</span>  <span> │</span>
<span>╰</span><span>───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><span>╯</span>
</pre>

<p>Let’s say I received feedback on my <code>Canonical References</code> patch, I can use its
<code>ID</code>, the shortened version above, to inspect it:</p>

<pre>$ rad patch show c54883e
<span>╭</span><span>──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><span>╮</span>
<span>│ </span><span>Title</span>     <span>Canonical References</span>                                                                                                                  <span> │</span>
<span>│ </span><span>Patch</span>     c54883e5ffb1f8a99f432e3ac79c0b728cd0dab3                                                                                              <span> │</span>
<span>│ </span><span>Author</span>    <span>fintohaps</span> <span>z6Mkire…SQZ3voM</span>                                                                                                             <span> │</span>
<span>│ </span><span>Head</span>      <span>34014a67b0ddc859d95e17ffc71c1ae61aff5758</span>                                                                                              <span> │</span>
<span>│ </span><span>Branches</span>  <span>patch/c54883e, sync-goal</span>                                                                                                              <span> │</span>
<span>│ </span><span>Commits</span>   ahead <span>6</span>, behind <span>49</span>                                                                                                                    <span> │</span>
<span>│ </span><span>Status</span>    <span>open</span>                                                                                                                                  <span> │</span>
<span>│ </span>                                                                                                                                                <span> │</span>
<span>│ </span>See RIP-0004[^0] for the specification.                                                                                                         <span> │</span>
<span>│ </span>                                                                                                                                                <span> │</span>
<span>│ </span>This patch is an implementation of RIP-0004. It implements the rules mechanism                                                                  <span> │</span>
<span>│ </span>within the `rules` module. This is interplays with the existing `canonical`                                                                     <span> │</span>
<span>│ </span>mechanisms, already defined (but slightly refactored).                                                                                          <span> │</span>
<span>│ </span>                                                                                                                                                <span> │</span>
<span>│ </span>The `rules` are then used in pushing and fetching references. A test is added to                                                                <span> │</span>
<span>│ </span>illustrate the canonical references in action via tags.                                                                                         <span> │</span>
<span>│ </span>                                                                                                                                                <span> │</span>
<span>│ </span>There were some incidental changes that were made to ensure the tags use case is                                                                <span> │</span>
<span>│ </span>easy for users. The first change was to add a tags refspec to remotes in order                                                                  <span> │</span>
<span>│ </span>to easily fetch tags from peers -- as well ensuring those tags do not pollute                                                                   <span> │</span>
<span>│ </span>the `refs/tags` namespace in the working copy.                                                                                                  <span> │</span>
<span>│ </span>                                                                                                                                                <span> │</span>
<span>│ </span>This had a knock on change where there was a bug `libgit2` that didn&#39;t allow for                                                                <span> │</span>
<span>│ </span>deleting `multivar` entries, which the new remote setup fell under. This was                                                                    <span> │</span>
<span>│ </span>fixed and so we update to `git2-0.19`.                                                                                                          <span> │</span>
<span>│ </span>                                                                                                                                                <span> │</span>
<span>│ </span>As well this, the `rad id update` command would error if the payload identifier                                                                 <span> │</span>
<span>│ </span>was not the project identifier. This would stop adding new payloads to extend                                                                   <span> │</span>
<span>│ </span>the identity -- which was needed for introducing canonical references.                                                                          <span> │</span>
<span>│ </span>                                                                                                                                                <span> │</span>
<span>│ </span>[^0]:                                                                                                                                           <span> │</span>
<span>│ </span>https://app.radicle.xyz/nodes/seed.radicle.garden/rad:z3trNYnLWS11cJWC6BbxDs5niGo82/patches/1d1ce874f7c39ecdcd8c318bbae46ffd02fe1ea8?tab=changes<span> │</span>
<span>├</span><span>──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><span>┤</span>
<span>│ </span><span>34014a6</span> radicle: refactor rule matching                                                                                                         <span> │</span>
<span>│ </span><span>0e0b77e</span> radicle: add canonical refs to identity                                                                                                 <span> │</span>
<span>│ </span><span>bbe019c</span> radicle: canonical reference rules                                                                                                      <span> │</span>
<span>│ </span><span>b3ad6f2</span> radicle: refactor Canonical                                                                                                             <span> │</span>
<span>│ </span><span>04277b4</span> radicle: store threshold in Canonical                                                                                                   <span> │</span>
<span>│ </span><span>312c6a4</span> meta: relax radicle-git dependencies                                                                                                    <span> │</span>
<span>├</span><span>──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><span>┤</span>
<span>│ </span><span>●</span> opened by <span>fintohaps</span> <span>z6Mkire…SQZ3voM</span> <span>(3e97837)</span> 10 months ago                                                                                   <span> │</span>
<span>│ </span><span>↑</span> updated to c1a2cc5787f44c0a835c1deae375be04c399dd7e <span>(58e932c)</span> 9 months ago                                                                    <span> │</span>
<span>│ </span><span>↑</span> updated to c55494efc2e780cd6c91a1f90efdae8a3eb1c7ef <span>(1b07774)</span> 8 months ago                                                                    <span> │</span>
<span>│ </span><span>↑</span> updated to 583e6b3366c36cc7e67910c29a66750397a60484 <span>(fdd5277)</span> 7 months ago                                                                    <span> │</span>
<span>│ </span><span>↑</span> updated to d54ddef216909bdd3e54e33e4f82c45df79c00d3 <span>(f24f9d8)</span> 7 months ago                                                                    <span> │</span>
<span>│ </span><span>↑</span> updated to ac48ae6e75d4eaa13daed657eed24dfeabb9be94 <span>(7d8e461)</span> 7 months ago                                                                    <span> │</span>
<span>│ </span><span>↑</span> updated to 2b31e460db7451376dc3e346ee02b5fd597fa5c6 <span>(040cfb7)</span> 7 months ago                                                                    <span> │</span>
<span>│ </span><span>↑</span> updated to e1c360a1311a0a215bed6eb42e4b0c8c5c44e611 <span>(f0dec88)</span> 6 months ago                                                                    <span> │</span>
<span>│ </span><span>↑</span> updated to 492cfbafd31e4bac85ee73af519ddc6254b47f82 <span>(f9cb27f)</span> 4 months ago                                                                    <span> │</span>
<span>│ </span><span>↑</span> updated to fbdf18d7683bdac7a76149777eed5cf9bbbf5bd5 <span>(2a64755)</span> 4 months ago                                                                    <span> │</span>
<span>│ </span><span>↑</span> updated to 4baf32afd65f2c4b374d8f21fed6877aa804a003 <span>(0cecae6)</span> 4 months ago                                                                    <span> │</span>
<span>│ </span>  └─ ⋄ reviewed by <span>self</span> <span>(you)</span> 1 month ago                                                                                                       <span> │</span>
<span>│ </span><span>↑</span> updated to d2ebc70caca54a8ba508d72862c1e1c79d718129 <span>(4515d45)</span> 1 month ago                                                                     <span> │</span>
<span>│ </span><span>↑</span> updated to 13e9ba641c624db26b6bfe85870daf064f90e9ab <span>(045e465)</span> 1 month ago                                                                     <span> │</span>
<span>│ </span><span>↑</span> updated to 47495c408ccf5eec49b61c7bdb339e5f2d695a30 <span>(a6be355)</span> 1 month ago                                                                     <span> │</span>
<span>│ </span><span>↑</span> updated to e3bdb65d3adb94360dd3449744792f6ecb1f451f <span>(8d08215)</span> 1 month ago                                                                     <span> │</span>
<span>│ </span>  └─ ⋄ reviewed by <span>erikli</span> <span>z6MkgFq…FGAnBGz</span> 1 month ago                                                                                           <span> │</span>
<span>│ </span><span>↑</span> updated to 9f779028704b4c022cbe25c0e4a9bb46dc8463ba <span>(49fcea7)</span> 1 month ago                                                                     <span> │</span>
<span>│ </span><span>↑</span> updated to 86ebfcaaf986edba5e77ede1be4d3c4ce33bd27c <span>(2df7cd9)</span> 1 month ago                                                                     <span> │</span>
<span>│ </span><span>↑</span> updated to fa9bdff35d76903f72cf24f1cccca812ae26e98c <span>(34014a6)</span> 1 month ago                                                                     <span> │</span>
<span>╰</span><span>──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><span>╯</span>
</pre>

<p>You can see here how non-perfect my changes are, I’m being vulnerable here.</p>

<p>I can now grab the value <code>Head</code> in the above table, and use it in <code>jj</code>, by
running <code>jj new 34014a67b0ddc859d95e17ffc71c1ae61aff5758</code>. This will drop me
onto a new change after <code>34014a67b0ddc859d95e17ffc71c1ae61aff5758</code>, and then I
can use <code>jj log -r ::@</code> to see all the previous changes.</p>

<p>Again, I use the wonderful <code>jj edit</code> command, or perhaps I make new changes that
I then <code>jj squash</code> into the relevant changes – it all depends on the scope of
the change!</p>

<p>Once I’m done, I push <code>HEAD</code> to another special <a href="https://git-scm.com/book/en/v2/Git-Internals-The-Refspec">refspec</a>, using
the patch’s full identifier:</p>

<div><div><pre><code>git push rad HEAD:patches/c54883e5ffb1f8a99f432e3ac79c0b728cd0dab3 <span>-f</span>
</code></pre></div></div>

<p>We use <code>-f</code> if we are editing the changes since this will change the underlying
commits and <code>git</code> will reject this. Once again, this will open my <code>$EDITOR</code> and
I will add a message about the changes that were made in this update.</p>

<p>This creates a new “revision” for the patch, preserving the older revisions.
So essentially, patches in Radicle are append-only. This makes it safe for us to
make edits to changes, marking them as mutable – the Git history will be
preserved!</p>

<h4 id="maintaining-patches">Maintaining Patches</h4>

<p>From the maintaining perspective, the flow starts off similar to updating, where
I would look up the patch that I want to merge. If I made the patch, things are
a bit easier because the Git objects are easily accessible and I can do <code>jj new</code>
using the commit. If I attempt to do this with a patch that came from another
contributor, then I may run into this issue:</p>

<pre>$ jj new 7322e3ac61669ba6dbde16bb0f7d30edf1ee85ce
<span></span><span>Error: </span><span>Revision `7322e3ac61669ba6dbde16bb0f7d30edf1ee85ce` doesn&#39;t exist</span>
</pre>

<p>The way to do this instead, is to use the remote syntax and the special
<code>patches</code> reference:</p>

<pre>$ jj new patches/3219ef871dd44c7ef51693f4aeba4c2c5c0c5c7b@rad
Working copy  (@) now at: <span></span><span>oo</span><span>xzsqoy</span><span> </span><span>eb</span><span>9e0803</span><span> </span><span>(empty)</span><span> </span><span>(no description set)</span>
Parent commit (@-)      : <span></span><span>s</span><span>wpyssrk</span> <span></span><span>73</span><span>22e3ac</span> <span>patches/3219ef871dd44c7ef51693f4aeba4c2c5c0c5c7b patches/3219ef871dd44c7ef51693f4aeba4c2c5c0c5c7b@rad</span><span> | </span>node, cli: remove predefined bootstrap nodes
</pre>

<p>At this point, I can also look at what commits are in the patch via <code>rad patch
show</code>, or by using <code>jj log -r ::@</code>. If they’re already on top <code>master@rad</code>, then
to merge the patch I can simply <code>git push rad master</code> – and the remote helper
marks the patch as merged if the canonical reference of <code>master</code> is update (a
topic for another time).</p>

<p>If the patch isn’t on top of <code>master@rad</code> then I can rebase the changes using
<code>jj rebase -d master@rad -r &lt;base&gt;::&lt;head&gt;</code> to get the series of changes on top
of our latest. It’s then necessary to push a new revision to the patch so that
the patch can know it is being merged with the new commits – remember that I
rebased, so this changes the underlying commits.</p>

<p>We should update our <code>master</code> bookmark, and this is where the <code>tug</code> alias comes
in. When I run <code>jj tug</code>, it figures out that <code>master</code> is the closest bookmark
and pulls it up to the latest change that can be pushed. I can then push to
update the patch:</p>

<div><div><pre><code>git push rad master:patches/3219ef871dd44c7ef51693f4aeba4c2c5c0c5c7b <span>-f</span>
</code></pre></div></div>

<p>Here I’m using <code>master</code> instead of <code>HEAD</code> – this gets around a little issue I’ve
been seeing for patches that I do not own, where the remote helper rejects the
push because it cannot resolve <code>HEAD</code> (a mystery left for another day).</p>

<p>Once the patch has been rebased, I can do the usual <code>git push rad master</code> to
update the canonical reference and have the patch marked as merged.</p>

<h2 id="conclusion">Conclusion</h2>

<p>And our adventure ends here. We dived into how Radicle works with Git, how
Jujutsu works Git, and how I use Jujutsu to have a branch-less flow in Radicle.
This is has been a dream to work with. This type of tooling feels like it
enables me a lot more when managing my changes and keeping a clean history. I
was <em>able</em> to do this with <code>git rebase</code>, but it felt like it got in the way more
than it enabled me – and I haven’t even touched on how <a href="https://jj-vcs.github.io/jj/v0.30.0/conflicts">conflicts</a>
are easy in Jujutsu!</p>

<p>There is plenty of room for improvements here, some things on my list are:</p>
<ul>
  <li>Keeping track of Jujutsu change IDs in Radicle data, which is already being
looked at!</li>
  <li>Not needing to use <code>rad patch show</code> to get metadata for managing patches, and
perhaps even bookmarking patch identifiers automatically.</li>
</ul>

<p>Come help in discussion on our <a href="https://radicle.zulipchat.com">Zulip</a>, and enjoy being Radicle 🌱👾</p>

<!-- Other people and events. --->

<!-- Jujutsu -->

<!-- Git -->

<!-- Radicle -->

    </div></div>
  </body>
</html>
