<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://wiki.postmarketos.org/wiki/Dual_Booting/WiP">Original</a>
    <h1>Android/Linux Dual Boot</h1>
    
    <div id="readability-page-1" class="page"><div id="mw-content-text"><div lang="en" dir="ltr"><p>For a lot of the methods, you will need <a href="https://wiki.postmarketos.org/wiki/Pmbootstrap" title="Pmbootstrap">pmbootstrap</a>
</p>
<meta property="mw:PageProp/toc"/>

<h2><span id="Booting_with_a_computer">Booting with a computer</span></h2>
<p>This is the simplest option, but you will need a computer to boot pmOS.
If used with an SD card to store data, then nothing is going to be modified on the phone.
</p><p>After entering fastboot mode on your phone, run <code>pmbootstrap flasher boot</code> to start pmOS.
</p>
<h2><span id="Recovery_partition">Recovery partition</span></h2>
<table role="text container"><tbody><tr>
<td><span><span typeof="mw:File"><span title="Warning"><img alt="Warning" src="https://wiki.postmarketos.org/images/9/9d/Red_warning_icon.svg" decoding="async" width="20" height="20"/></span></span></span></td>
<td><b>WARNING:</b> Doing this will make you lose the Android recovery mode, and will overwrite any recovery OS/software installed on the recovery partition(e.g. TWRP)</td>
</tr></tbody></table>
<p>If the pmOS kernel is written to the recovery partition, then your device will boot into pmOS when you enter recovery mode.
You can get the image of the kernel by running <code>pmbootstrap export</code>. And
<code>fastboot flash recovery /tmp/postmarketOS-export/boot.img</code> to flash it to recovery.
</p><p>Under this method, you would require to find a way to store pmOS because userdata is used by Android (However, you can share userdata between pmOS and android with <a href="#Stowaway">#Stowaway</a>).
</p>
<h2><span id="A.2FB_slots"></span><span id="A/B_slots">A/B slots</span></h2>
<p>On phones that have A/B slots, you can flash pmOS to system partition of slot B, and leave slot A and userdata for Android. 
If you want a bigger partition for pmOS, Please refer to <a href="#Custom_Partition">#Custom Partition</a>.
</p><p>Switching slots can be done with a computer using <code>fastboot --set-active=[a/b]</code> while the phone is in fastboot mode.
</p><p>Alternatively, you can use any of the following android apps to switch to pmOS:
</p>
<ul><li><a rel="nofollow" href="https://github.com/likeadragonmaid/Switch-My-Slot-Android">Switch My Slot</a> (does not work on android 14)</li>
<li><a rel="nofollow" href="https://github.com/capntrips/BootControl">BootControl</a> (does work on FP5)</li></ul>
<p>On pmOS you can use <a rel="nofollow" href="https://wiki.postmarketos.org/wiki/Android_AB_Slots#Qbootctl">qbootctl</a> to switch back to Android.
</p>
<h2><span id="U-boot">U-boot</span></h2>
<p><a href="https://wiki.postmarketos.org/wiki/U-Boot_porting#Implement_multiboot_involving_Android_in_a_device_aport" title="U-Boot porting">U-Boot_porting#Implement_multiboot_involving_Android_in_a_device_aport</a>
</p><p>On the <a href="https://wiki.postmarketos.org/wiki/Nokia_N900" title="Nokia N900">Nokia N900</a> and other devices that use U-boot (like <a href="https://wiki.postmarketos.org/wiki/MangoPi_MQ-Pro_(mangopi-mq-pro)" title="MangoPi MQ-Pro (mangopi-mq-pro)">MangoPi MQ-Pro (mangopi-mq-pro)</a>, <a href="https://wiki.postmarketos.org/wiki/Xunlong_Orange_Pi_3_(xunlong-orangepi3)" title="Xunlong Orange Pi 3 (xunlong-orangepi3)">Xunlong Orange Pi 3 (xunlong-orangepi3)</a>), U-boot provides a mechanism to select the OS. See <a href="https://wiki.postmarketos.org/wiki/Nokia_N900#Installation" title="Nokia N900">Nokia N900#Installation</a> and <a rel="nofollow" href="https://u-boot.readthedocs.io/en/latest/usage/cmd/bootmenu.html%7CSee">bootmenu on U-boot doc</a> 
</p><p>On some Amlogic devices with U-boot, there is a multi-boot mode: <a href="https://wiki.postmarketos.org/wiki/Amlogic#Boot_process" title="Amlogic">Amlogic#Boot process</a>
</p>
<h2><span id="lk2nd.2Flk1st"></span><span id="lk2nd/lk1st">lk2nd/lk1st</span></h2>
<p><a href="https://wiki.postmarketos.org/wiki/Lk2nd/lk1st" title="Lk2nd/lk1st">lk2nd/lk1st</a>
</p><p>On devices with lk2nd the boot image is loaded from an ext2 boot partition either on eMMC or SD card. Since lk2nd keeps backwards compatibility with Android boot images, you can flash your Android boot.img via lk2nd, and it will boot that image unless an SD card with postmarketOS is inserted.
</p>
<h2><span id="kexec">kexec</span></h2>
<p>never tried but kexec could potentially work. Either your android need to support it or your postmarketos. the other direction can be solved by a plain old reboot as well.
</p>

<h2><span id="Stowaway">Stowaway</span></h2>
<p>Some devices (like the Pixel 3) use metadata/FBE encryption to encrypt the data partition. This is not supported in pmOS, and will cause failure.
Devices launched with Android 9 or higher have their metadata /FBE encrypted.
To check if your phone has it, run <code>dmctl table userdata</code>. If it outputs an error, then you can use stowaways.
</p><p>It is possible to disable the encryption <a rel="nofollow" href="https://xdaforums.com/t/pie-10-11-system-as-root-multidisabler-disables-encryption-vaultkeeper-auto-flash-of-stock-recovery-proca-wsm-cass-etc.3919714/">Multidisabler (for Samsung device)</a> or <a rel="nofollow" href="https://xdaforums.com/t/a-b-a-only-script-read-only-erofs-android-10-disable-force-encryption-native-early-override-dfe-neo-v2-disable-encryption-data-userdata.4454017/">[1]</a>.
</p><p>Read everything before doing anything. This only works on edge.
</p><p>The end result is going to be that a folder(<code>.stowaway/pmos/</code>) in a partition will be used for root.
This is useful for Android devices where modifying the partition table is not recommended.
</p>
<h3><span id="Preparation">Preparation</span></h3>
<p>To use this method, you will need to put files from root into a <code>.stowaway/pmos/</code> on your phone. 
To transfer these files, we will use tar. 
And to boot with this method, you need to force pmOS to boot the partition which contains the stowaway.
</p><p>Here is a simple script that will make a pmos.tar and force booting to userdata.
</p>
<div dir="ltr"><pre><span></span>pmbootstrap<span> </span>init

<span># Modify deviceinfo to force booting on userdata</span>
pmbootstrap<span> </span>install<span> </span>--split
pmbootstrap<span> </span>shutdown
<span>cd</span><span> </span>~/.local/var/pmbootstrap/chroot_rootfs_*/
<span># Change userdata if you want to use a different partition</span>
<span>echo</span><span> </span><span>&#34;deviceinfo_kernel_cmdline_append=\&#34;pmos.stowaway pmos_root=/dev/disk/by-partlabel/userdata\&#34;&#34;</span><span> </span><span>|</span><span> </span>sudo<span> </span>tee<span> </span>-a<span> </span>etc/deviceinfo
sudo<span> </span>sed<span> </span>-i<span> </span><span>&#39;3,0s/^/#/&#39;</span><span> </span>etc/fstab<span> </span><span># don&#39;t mount /boot</span>
pmbootstrap<span> </span>install<span> </span>--split

<span># Make pmos.tar</span>
pmbootstrap<span> </span><span>export</span>
mkdir<span> </span>/tmp/PMOS_ROOT
sudo<span> </span>mount<span> </span>-o<span> </span>loop<span> </span>/tmp/postmarketOS-export/*-root.img<span> </span>/tmp/PMOS_ROOT
sudo<span> </span>mount<span> </span>-o<span> </span>loop<span> </span>/tmp/postmarketOS-export/*-boot.img<span> </span>/tmp/PMOS_ROOT/boot/
<span>cd</span><span> </span>/tmp/PMOS_ROOT
sudo<span> </span>tar<span> </span>-cf<span> </span>../pmos.tar<span> </span>*
<span>cd</span><span> </span>/tmp
sudo<span> </span>umount<span> </span>/tmp/PMOS_ROOT/boot/
sudo<span> </span>umount<span> </span>/tmp/PMOS_ROOT

<span>#fastboot flash boot /tmp/postmarketOS-export/boot.img</span>
</pre></div>
<p>Flash command is commented out because, I don&#39;t want to override someone&#39;s android install
</p>
<h3><span id="Unpacking_pmos.tar_on_your_phone">Unpacking pmos.tar on your phone</span></h3>
<p>Now move <code>/tmp/pmos.tar</code> to your phone, using the command <code>adb push /tmp/pmos.tar /sdcard</code>
</p><p>You will need root or TWRP for this part, run <code>mkdir /data/.stowaways/pmos</code> and <code>mv /sdcard/pmos.tar /data/.stowaways/pmos</code>. This will make a directory and move our tar into it. To unpack it, we need to run <code>cd /data/.stowaways/pmos</code> and <code>tar -xf pmos.tar</code>. Now we can remove pmos.tar with <code>rm pmos.tar</code>.
</p>
<div dir="ltr"><pre><span></span>mkdir<span> </span>-p<span> </span>/data/.stowaways/pmos
mv<span> </span>/sdcard/pmos.tar<span> </span>/data/.stowaways/pmos
<span>cd</span><span> </span>/data/.stowaways/pmos
tar<span> </span>-xf<span> </span>pmos.tar
rm<span> </span>pmos.tar
</pre></div>
<h2><span id="SD_card">SD card</span></h2>
<p>You can flash the file system to a SD card. Then pmOS will be able to use it.
</p>
<div dir="ltr"><pre><span></span>pmbootstrap<span> </span>install
pmbootstrap<span> </span><span>export</span><span> </span>--no-install<span> </span><span>#the generated root and boot FSes are linked together, export would regenerate (reinstall) them (unless you pass --no-install) which might be undesired if you used pmbootstrap install --sdcard=... in the previous step</span>
<span># flash /tmp/postmarketOS-export/[device].img to SD card</span>
</pre></div>
<p>when flashing the target should be the complete drive and not a partition (e.g. <code>/dev/sdb</code> instead of <code>/dev/sdb1</code>). Alternatively <code>pmbootstrap install --sdcard=...</code> can be used instead
</p>
<h2><span id="Custom_Partition">Custom Partition</span></h2>
<table role="text container"><tbody><tr>
<td><span><span typeof="mw:File"><span title="Warning"><img alt="Warning" src="https://wiki.postmarketos.org/images/9/9d/Red_warning_icon.svg" decoding="async" width="20" height="20"/></span></span></span></td>
<td><b>WARNING:</b> THIS PROCESS CAN BRICK YOUR PHONE IF DONE INCORRECTLY! IF YOU DON&#39;T FEEL COMFORTABLE RECOVERING YOUR PHONE VIA DEEP FLASHING, DO NOT ATTEMPT THIS</td>
</tr></tbody></table>
<p>On certain device, it may be possible to do custom partition.
</p>
<h4><span id="Shrink_Userdata">Shrink Userdata</span></h4>
<table role="text container"><tbody><tr>
<td><span><span typeof="mw:File"><span title="Warning"><img alt="Warning" src="https://wiki.postmarketos.org/images/9/9d/Red_warning_icon.svg" decoding="async" width="20" height="20"/></span></span></span></td>
<td><b>WARNING:</b> THIS PROCESS WILL DESTROY YOUR PHONE DATA.</td>
</tr></tbody></table>
<p>1. Shrink userdata in the partition table
</p><p>2. Boot up to TWRP to format userdata
</p><p>Then, depending on partition scheme, you may need to follow <a href="#Creating_Custom_Partition_for_&#34;Subpartitions&#34;_partition_scheme">#Creating Custom Partition for &#34;Subpartitions&#34; partition scheme</a> or <a href="#Creating_Custom_Partition_for_&#34;Use_the_whole_storage_device&#34;_partition_scheme">#Creating Custom Partition for &#34;Use the whole storage device&#34; partition scheme</a> to create a custom partition for pmOS.
</p>
<h4><span id="Creating_Custom_Partition_for_.22Subpartitions.22_partition_scheme"></span><span id="Creating_Custom_Partition_for_&#34;Subpartitions&#34;_partition_scheme">Creating Custom Partition for &#34;Subpartitions&#34; partition scheme</span></h4>
<table role="text container"><tbody><tr>
<td><span><span typeof="mw:File"><span title="Note"><img alt="Note" src="https://wiki.postmarketos.org/images/6/6d/Reference_icon.svg" decoding="async" width="20" height="20"/></span></span></span></td>
<td>Under the Subpartitions partition scheme, pmOS would looking for Subpartitions in partition that is labelled as userdata or system* (any partition that has system prefix in the name) in the partition table, thus the partition have to have a system prefix in the label. However, In order to not confuse the bootloader. DO NOT LABEL THE PARTITION WITH NAME LIKE system_a system_b system_c userdata. For example, systempmos is a perfect name that would work.</td>
</tr></tbody></table>
<p>1. Create a partition that named as systempmos in the partition table.
</p>
<h4><span id="Creating_Custom_Partition_for_.22Use_the_whole_storage_device.22_partition_scheme"></span><span id="Creating_Custom_Partition_for_&#34;Use_the_whole_storage_device&#34;_partition_scheme">Creating Custom Partition for &#34;Use the whole storage device&#34; partition scheme</span></h4>
<table role="text container"><tbody><tr>
<td><span><span typeof="mw:File"><span title="Note"><img alt="Note" src="https://wiki.postmarketos.org/images/6/6d/Reference_icon.svg" decoding="async" width="20" height="20"/></span></span></span></td>
<td>Under the Use the whole storage device&#34; partition scheme, pmOS_boot and pmOS_root has to be labelled in the file system. The postmarketOS initramfs checks those partition label via file system, not the partition table. However, It is recommended to label those partition in the partition table if you want them to be flashable in fastboot.(It doesn&#39;t matter what you have labelled them in partition table. As long as fastboot is able to read those label.)</td>
</tr></tbody></table>
<table role="text container"><tbody><tr>
<td><span><span typeof="mw:File"><span title="Note"><img alt="Note" src="https://wiki.postmarketos.org/images/6/6d/Reference_icon.svg" decoding="async" width="20" height="20"/></span></span></span></td>
<td>The disk image the generated by pmbootstrap has already been labelled</td>
</tr></tbody></table>
<p>1. Create a new boot partition that labelled as pmOS_boot in the file system 
</p><p>2. Create a new root partition that labelled as pmOS_root in the file system
</p>

<ul><li>On UEFI / BIOS based devices, grub can be used for dual booting (see <a rel="nofollow" href="https://wiki.archlinux.org/title/Dual_boot_with_Windows">Dual boot with Windows on arch wiki</a>)</li>
<li><a rel="nofollow" href="https://source.android.com/docs/security/features/encryption/file-based">FBE encryption</a></li>
<li><a rel="nofollow" href="https://source.android.com/docs/security/features/encryption/metadata">Metadata Encryption</a></li>
<li><a rel="nofollow" href="https://postmarketos.org/faq/#is-dual-boot-supported">FAQ Entry</a>.</li>
<li><a rel="nofollow" href="https://youtube.com/watch?v=pI3ek2C0Ca8">Dual booting PMOS and netbsd demo video</a></li>
<li>Some UEFI Implementations for Android smartphones like (<a rel="nofollow" href="https://efidroid.org">efidroid</a>,<a href="https://wiki.postmarketos.org/wiki/Renegade_Project" title="Renegade Project">Renegade Project</a>) can be used together with postmarketOS (see <a href="https://wiki.postmarketos.org/wiki/OnePlus_6_(oneplus-enchilada)/Multi_Booting_and_Custom_Partitioning" title="OnePlus 6 (oneplus-enchilada)/Multi Booting and Custom Partitioning"> Guides for dual booting pmOS on OnePlus 6/6T, but some part of it can be reused on some other devices.</a>)</li></ul>
<!-- 
NewPP limit report
Cached time: 20251120190608
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc]
CPU time usage: 0.018 seconds
Real time usage: 0.350 seconds
Preprocessor visited node count: 486/1000000
Post‐expand include size: 10972/2097152 bytes
Template argument size: 3632/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 3/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 3954/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%  338.800      1 -total
  0.82%    2.779      6 Template:Icon_box
  0.78%    2.650      3 Template:Warning
  0.51%    1.734      3 Template:Note
-->

<!-- Saved in parser cache with key pmoswiki:pcache:idhash:6239-0!canonical and timestamp 20251120190608 and revision id 79296. Rendering was triggered because: page-view
 -->
</div>
</div></div>
  </body>
</html>
