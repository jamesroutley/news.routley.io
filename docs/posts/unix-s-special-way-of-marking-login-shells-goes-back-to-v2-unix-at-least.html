<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/unix/LoginShellMarkerHistory">Original</a>
    <h1>Unix&#39;s special way of marking login shells goes back to V2 Unix (at least)</h1>
    
    <div id="readability-page-1" class="page"><div><h2>Unix&#39;s special way of marking login shells goes back to V2 Unix (at least)</h2>

	<p><small>December 10, 2022</small></p>
</div><div><p>Many Unix shells have some command line argument that tells them
that they are a login shell; for example, Bash has &#39;-l&#39; (also
&#39;--login&#39;), and I think that &#39;-l&#39; has become the de facto standard.
However, this argument is not how Unix programs like <code>sshd</code> and
<code>login</code> actually tell your shell that it&#39;s a login shell; instead,
for a long time, <a href="https://utcc.utoronto.ca/~cks/space/blog/unix/UsingAlternateShell">a login shell has a &#39;<code>-</code>&#39; as the first character
of its program name</a>, or to put it another
way, argv[0][0] is &#39;-&#39;.</p>

<p><a href="https://mastodon.social/@cks/109487734258545265">Recently I wound up wondering how far back this approach goes</a>. The answer turns
out to be more interesting than I expected, and what exactly is
done has changed over time. First, as you might expect, this behavior
is in V7 Unix, where <a href="https://minnie.tuhs.org/cgi-bin/utree.pl?file=V7/usr/src/cmd/login.c">login.c</a>
sticks a &#39;-&#39; on the front of your shell&#39;s name (and is confident
that your /etc/passwd shell entry will never be more than 14
characters long). In V6 and V5, we have the C source for <code>login</code>
(<a href="https://minnie.tuhs.org/cgi-bin/utree.pl?file=V6/usr/source/s1/login.c">V6</a>,
<a href="https://minnie.tuhs.org/cgi-bin/utree.pl?file=V5/usr/source/s1/login.c">V5</a>),
and both versions simply set argv[0] to &#39;-&#39;. I don&#39;t think we have
user level source for V4 or V3, but it turns out that we do have
assembly source for V2&#39;s <a href="https://minnie.tuhs.org/cgi-bin/utree.pl?file=V2/cmd/login.s">login.s</a>, and
to my surprise, it is still following the same approach of having
argv[0] be &#39;-&#39; (visible in the definitions of &#39;mshell&#39; and &#39;shellp&#39;).</p>

<p>So this approach to marking login shells goes back to pretty much
the dawn of Unix, and might even be in V1 (again, I don&#39;t think we
have user level source for V1). Unix has been doing it this way
since at least mid 1972, or fifty years now, and for incremental
historical compatibility, your system is probably still doing it
today.</p>

<p>(Even OpenBSD, the modern Unix I would most expect to have modernized
how login shells are marked, has left this intact in their <code>login</code>
source code.)</p>

<p>PS: To my surprise, as late as 4.3 BSD, <a href="https://minnie.tuhs.org/cgi-bin/utree.pl?file=4.3BSD/usr/src/bin/login.c">login.c</a>
is still assuming that your /etc/passwd shell is 14 characters or
less (or otherwise it will overflow a buffer). This finally gets
fixed in 4.4 BSD. This is also not fixed in <a href="https://minnie.tuhs.org/cgi-bin/utree.pl?file=SysIII/usr/src/cmd/login.c">the System III login.c</a>.
I haven&#39;t looked at System V, since source for that is less readily
accessible.</p>
</div></div>
  </body>
</html>
