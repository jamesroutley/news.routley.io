<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://discourse.julialang.org/t/let-it-snow/72950">Original</a>
    <h1>Let it snow()</h1>
    
    <div id="readability-page-1" class="page"><div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
      <meta itemprop="headline" content="Let it snow()"/>
        <meta itemprop="articleSection" content="Community"/>
      <meta itemprop="keywords" content="snow, repl"/>
      

          <div id="post_1">
            <div>
              

                

              <p><span>
                  <time itemprop="datePublished" datetime="2021-12-11T21:54:56Z">
                    December 11, 2021,  9:54pm
                  </time>
                  <meta itemprop="dateModified" content="2021-12-13T06:00:28Z"/>
              <span itemprop="position">1</span>
              </span>
            </p></div>
            <div itemprop="articleBody">
              <p>Let it <code>snow()</code></p>
<p><img src="https://global.discourse-cdn.com/julialang/original/3X/a/0/a07fe4045ac536651537252f6c51b5b1e5a5236a.gif" alt="juliasnow" data-base62-sha1="mTQoMT0uTOZIUvR6GhZ7MLAXJQm" width="600" height="426"/></p>
<p>The code could definitely be golfed…</p>
<pre><code>function snow(io = stdout)
    h, w = displaysize(io)
    iob = IOBuffer()
    ioc = IOContext(IOContext(iob, io), :displaysize=&gt;(h,w))
    print(io, repeat(&#34;\n&#34;, h), &#34;\e[&#34;, h, &#34;A\e[1G&#34;) # new lines and move back up
    air = ones(Int, w, h)
    flakes = [&#34; &#34;, &#34;*&#34;, &#34;❄︎&#34;, &#34;❅&#34;, &#34;❆&#34;]
    scsin(t) = ((sin(t) / 2) + 0.5) * (0.1 / 3)
    likelihood(t) = scsin(t) + scsin(t * 1.00001) + scsin(t * 0.9999)
    try
        while true
            for x in 1:w, y in h:-1:1
                air[x,y] = if y == 1 # new flakes
                    rand() &lt; likelihood(time()) ? rand(2:length(flakes)) : 1
                elseif y == h # accumulate bottom
                    ((rand() &lt; 0.95 &amp;&amp; air[x,y] &gt; 1) || (air[x, y-1] &gt; 1 &amp;&amp; rand() &lt; 0.2)) ? 2 : 1
                elseif all(&gt;(1), air[x, y:end]) # melt pile sometimes
                    rand() &lt; 0.95 ? 2 : 1
                elseif (air[x, y-1] &gt; 1 &amp;&amp; all(&gt;(1), air[x, (y+1):end])) # if flake coming and piled up below
                    rand() &lt; 0.1 ? 2 : 1
                else # fall downwards otherwise
                    air[x, y-1]
                end
            end
            print(ioc, &#34;\e[&#34;, h, &#34;A\e[1G&#34;) # move back to start
            print.((ioc,), flakes[air])
            print(ioc, &#34;\e[&#34;, h, &#34;A\e[1G&#34;) # move back to start
            Base.banner(ioc)
            printstyled(ioc, &#34;julia&gt; &#34;, color = :green, bold = true)
            println(ioc, &#34;snow()&#34;)
            print(io, String(take!(iob)))
            sleep(1/8)
        end
    catch e
        isa(e,InterruptException) || rethrow()
    end
    nothing
end
</code></pre>
            </div>

            

            

          </div>
          <div id="post_2" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            
            <p><code>❄︎❅❆</code>  options? <img src="https://emoji.discourse-cdn.com/twitter/rofl.png?v=12" title=":rofl:" alt=":rofl:" loading="lazy" width="20" height="20"/></p>

            

            

          </div>
          <div id="post_3" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            
            <p>This is awesome! Please share it on Twitter and Tag the Julia account. I also want to set my REPL up to show this in the background when I am running code <img src="https://emoji.discourse-cdn.com/twitter/smile.png?v=12" title=":smile:" alt=":smile:" loading="lazy" width="20" height="20"/></p>

            

            

          </div>
          
          <div id="post_5" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            
            <div itemprop="text">
              <p>This could be a perfect Easter Egg for Julia 1.8…</p>
<p>EDIT: By the way, does Julia have any ?</p>
            </div>

            

            

          </div>
          <div id="post_6" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            
            <p><code>julia --lisp</code> might count.</p>

            

            

          </div>
          <div id="post_7" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            
            <div itemprop="text">
              <p>The first snowflakes <code>*</code> were falling vertically on my REPL.</p>
<p>However, the last ones <code> *, ❄︎, ❅, ❆</code> seem to fall with strong side winds…</p>
<p>Aren’t the JuliaMono fonts mono-flake?</p>
            </div>

            

            

          </div>
          <div id="post_8" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            
            <p>Might be that your terminal app is struggling with the adverse weather conditions - it looks good in my MacOS Terminal.</p>

            

            

          </div>
          <div id="post_9" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            
            <p>If you want to control the wind, change the width of the terminal window after starting it.</p>

            

            

          </div>
          <div id="post_10" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            
            <p>I was just trying to find this! Just in time for that time of year! <img src="https://emoji.discourse-cdn.com/twitter/snowflake.png?v=12" title=":snowflake:" alt=":snowflake:" loading="lazy" width="20" height="20"/> <img src="https://emoji.discourse-cdn.com/twitter/christmas_tree.png?v=12" title=":christmas_tree:" alt=":christmas_tree:" loading="lazy" width="20" height="20"/> <img src="https://emoji.discourse-cdn.com/twitter/santa.png?v=12" title=":santa:" alt=":santa:" loading="lazy" width="20" height="20"/> <img src="https://emoji.discourse-cdn.com/twitter/coffee.png?v=12" title=":coffee:" alt=":coffee:" loading="lazy" width="20" height="20"/></p>

            

            

          </div>
          <div id="post_11" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            <div>
              <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
                <a itemprop="url" href="https://discourse.julialang.org/u/mcreel"><span itemprop="name">mcreel</span></a>
                
              </span></p>


              <p><span>
                  <time itemprop="datePublished" datetime="2023-12-02T07:06:26Z">
                    December 2, 2023,  7:06am
                  </time>
                  <meta itemprop="dateModified" content="2023-12-02T07:06:26Z"/>
              <span itemprop="position">11</span>
              </span>
            </p></div>
            <p>Hah, that’s great, thanks for the bump.</p>

            

            

          </div>
          <div id="post_12" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            
            <div itemprop="text">
              <p>Adding a tree under the snow:</p>
<pre data-code-wrap="julia"><code>using Printf
foreach(i-&gt; @printf(&#34;%19s%-19s\n&#34;, &#34;❅&#34;.^(i,i-1)...), 1:9)
foreach(_-&gt; @printf(&#34;%19s\n&#34;, &#34;❅&#34;), 1:3)
</code></pre>
<p>Happy Holidays!</p>
            </div>

            

            

          </div>
          <div id="post_13" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            
            <div itemprop="text">
              <p>Adding the tree to the scene (and making it work on 1.11 given the banner moved to REPL)</p>
<pre data-code-wrap="julia"><code>using REPL, Printf
function snow(io = stdout)
    h, w = displaysize(io)
    iob = IOBuffer()
    ioc = IOContext(IOContext(iob, io), :displaysize=&gt;(h,w))
    print(io, repeat(&#34;\n&#34;, h), &#34;\e[&#34;, h, &#34;A\e[1G&#34;) # new lines and move back up
    air = ones(Int, w, h)
    flakes = [&#34; &#34;, &#34;*&#34;, &#34;❄︎&#34;, &#34;❅&#34;, &#34;❆&#34;]
    scsin(t) = ((sin(t) / 2) + 0.5) * (0.1 / 3)
    likelihood(t) = scsin(t) + scsin(t * 1.00001) + scsin(t * 0.9999)
    try
        while true
            for x in 1:w, y in h:-1:1
                air[x,y] = if y == 1 # new flakes
                    rand() &lt; likelihood(time()) ? rand(2:length(flakes)) : 1
                elseif y == h # accumulate bottom
                    ((rand() &lt; 0.95 &amp;&amp; air[x,y] &gt; 1) || (air[x, y-1] &gt; 1 &amp;&amp; rand() &lt; 0.2)) ? 2 : 1
                elseif all(&gt;(1), air[x, y:end]) # melt pile sometimes
                    rand() &lt; 0.95 ? 2 : 1
                elseif (air[x, y-1] &gt; 1 &amp;&amp; all(&gt;(1), air[x, (y+1):end])) # if flake coming and piled up below
                    rand() &lt; 0.1 ? 2 : 1
                else # fall downwards otherwise
                    air[x, y-1]
                end
            end
            print(ioc, &#34;\e[H&#34;) # move back to home
            foreach(space -&gt; print(ioc, flakes[space]), air)
            print(ioc, &#34;\e[H&#34;) # move back to home
            print(ioc, &#34;\e[$(h-13)B\e[1G&#34;) # move to 12th row from bottom, col 1
            foreach(i-&gt; @printf(ioc, &#34;%19s%-19s\n&#34;, &#34;❅&#34;.^(i,i-1)...), 1:9) # tree
            foreach(_-&gt; @printf(ioc, &#34;%19s\n&#34;, &#34;❅&#34;), 1:3) # trunk
            print(ioc, &#34;\e[H&#34;) # move back to home
            @static VERSION &gt; v&#34;1.11.0-0&#34; ? REPL.banner(ioc) : Base.banner(ioc)
            printstyled(ioc, &#34;julia&gt; &#34;, color = :green, bold = true)
            println(ioc, &#34;snow()&#34;)
            print(io, String(take!(iob)))
            sleep(1/8)
        end
    catch e
        isa(e,InterruptException) || rethrow()
    end
    nothing
end
</code></pre>
            </div>

            

            

          </div>
          <div id="post_14" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            <div>
              <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
                <a itemprop="url" href="https://discourse.julialang.org/u/GHTaarn"><span itemprop="name">GHTaarn</span></a>
                
              </span></p>


              <p><span>
                  <time itemprop="datePublished" datetime="2023-12-25T04:40:15Z">
                    December 25, 2023,  4:40am
                  </time>
                  <meta itemprop="dateModified" content="2023-12-25T04:40:15Z"/>
              <span itemprop="position">14</span>
              </span>
            </p></div>
            <p>This is cool, wouldn’t it be worthy of being released as a Julia package on Github or even the General registry?</p>

            

            

          </div>
          <div id="post_15" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
            <div>
              <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
                <a itemprop="url" href="https://discourse.julialang.org/u/GHTaarn"><span itemprop="name">GHTaarn</span></a>
                
              </span></p>


              <p><span>
                  <time itemprop="datePublished" datetime="2023-12-25T17:14:35Z">
                    December 25, 2023,  5:14pm
                  </time>
                  <meta itemprop="dateModified" content="2023-12-25T17:14:35Z"/>
              <span itemprop="position">15</span>
              </span>
            </p></div>
            <div itemprop="text">
              <p>Removing the snowless rectangle around the tree:</p>
<pre data-code-wrap="julia"><code>using REPL

function snow(io = stdout)
    h, w = displaysize(io)
    iob = IOBuffer()
    ioc = IOContext(IOContext(iob, io), :displaysize=&gt;(h,w))
    print(io, repeat(&#34;\n&#34;, h), &#34;\e[&#34;, h, &#34;A\e[1G&#34;) # new lines and move back up
    air = ones(Int, w, h)
    flakes = [&#34; &#34;, &#34;*&#34;, &#34;❄︎&#34;, &#34;❅&#34;, &#34;❆&#34;]
    scsin(t) = ((sin(t) / 2) + 0.5) * (0.1 / 3)
    likelihood(t) = scsin(t) + scsin(t * 1.00001) + scsin(t * 0.9999)
    try
        while true
            for x in 1:w, y in h:-1:1
                air[x,y] = if y == 1 # new flakes
                    rand() &lt; likelihood(time()) ? rand(2:length(flakes)) : 1
                elseif y == h # accumulate bottom
                    ((rand() &lt; 0.95 &amp;&amp; air[x,y] &gt; 1) || (air[x, y-1] &gt; 1 &amp;&amp; rand() &lt; 0.2)) ? 2 : 1
                elseif all(&gt;(1), air[x, y:end]) # melt pile sometimes
                    rand() &lt; 0.95 ? 2 : 1
                elseif (air[x, y-1] &gt; 1 &amp;&amp; all(&gt;(1), air[x, (y+1):end])) # if flake coming and piled up below
                    rand() &lt; 0.1 ? 2 : 1
                else # fall downwards otherwise
                    air[x, y-1]
                end
            end
            foreach(space -&gt; print(ioc, flakes[space]), air)
            for itree in 1:12
                print(ioc, &#34;\e[H&#34;) # move back to home
                if itree &lt;= 9
                    print(ioc, &#34;\e[$(h-14+itree)B\e[$(19-itree)G&#34;)
                    printstyled(ioc, &#34;x&#34;^(2*itree-1), color=:green)
                else # Trunk
                    print(ioc, &#34;\e[$(h-14+itree)B\e[18G&#34;)
                    printstyled(ioc, &#34;-&#34;, color=:reverse)
                end
            end
            print(ioc, &#34;\e[H&#34;) # move back to home
            @static VERSION &gt; v&#34;1.11.0-0&#34; ? REPL.banner(ioc) : Base.banner(ioc)
            printstyled(ioc, &#34;julia&gt; &#34;, color = :green, bold = true)
            println(ioc, &#34;snow()&#34;)
            print(io, String(take!(iob)))
            sleep(1/8)
        end
    catch e
        isa(e,InterruptException) || rethrow()
    end
    nothing
end
</code></pre>
            </div>

            

            

          </div>
    </div></div>
  </body>
</html>
