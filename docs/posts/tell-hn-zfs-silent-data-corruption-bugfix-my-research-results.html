<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://news.ycombinator.com/item?id=38553008">Original</a>
    <h1>Tell HN: ZFS silent data corruption bugfix â€“ my research results</h1>
    
    <div id="readability-page-1" class="page"><div><div><p>Hey HN,</p><p>since I&#39;m personally affected by this bug[1] and this scared me somehow, I thought I&#39;d post my research results to have a discussion about the details.</p><p>I must say I lost a bit of trust in ZFS, since it was &#39;sold&#39; as rock solid unbreakable file system and now what... the sheer complexity of ZFS let&#39;s me think that this was not the only bug of this kind existing undetected in the source code.</p><p>However the communication was clear and precise, other filesystems had similar problems and I just love the feature set of zfs. So I&#39;ll give it another shot hoping that future revisions will be safe(r).</p><p>Here are my conclusions so far:</p><pre><code>  1. ZFS had a silent data corruption bug recently discussed on HN [6][7]
  2. `Silent` means, you can&#39;t do anything about it without upgrading zfs (scrubs, checks, etc. don&#39;t help)
  3. There is no tool to check if your data has been corrupted
  4. Only once written and untouched data should be relatively safe (e.g. backups), the bug mainly affects reading data [4]
  5. Setting `zfs_dmu_offset_next_sync=0` reduces probability of being affected, but no guarantee [4]
  6. The bug affected any version before 2.2.2 and 2.1.14[2], but were more likely between 2.1.4 and 2.2.1 because a behaviour change in coreutils
  7. The causing problem already existed much longer (since 2006?) - this is a question mark [4]
  8. do a `zfs version` to see the version number
  9. If you&#39;re scared (I was), please read this comment: https://news.ycombinator.com/item?id=38553342

</code></pre><p>
So the only way to ENSURE your data is ok is checksumming all files on another filesystem at file level and compare or re-transfering all data from another filesystem after upgrading zfs to the latest version.</p><p>Please let me know, if I missed something or got something wrong.</p><p>Sources:</p><p>[1]: <a href="https://www.phoronix.com/news/OpenZFS-Data-Corruption-Battle" rel="nofollow noreferrer">https://www.phoronix.com/news/OpenZFS-Data-Corruption-Battle</a></p><p>[2]: <a href="https://www.phoronix.com/news/OpenZFS-2.2.2-Released" rel="nofollow noreferrer">https://www.phoronix.com/news/OpenZFS-2.2.2-Released</a></p><p>[3]: <a href="https://www.theregister.com/2023/12/04/two_new_versions_of_openzfs/" rel="nofollow noreferrer">https://www.theregister.com/2023/12/04/two_new_versions_of_o...</a></p><p>[4]: <a href="https://www.reddit.com/r/zfs/comments/1826lgs/psa_its_not_block_cloning_its_a_data_corruption/" rel="nofollow noreferrer">https://www.reddit.com/r/zfs/comments/1826lgs/psa_its_not_bl...</a></p><p>[5]: <a href="https://news.ycombinator.com/item?id=38519382">https://news.ycombinator.com/item?id=38519382</a></p><p>[6]: <a href="https://news.ycombinator.com/item?id=38405731">https://news.ycombinator.com/item?id=38405731</a></p><p>[7]: <a href="https://news.ycombinator.com/item?id=38380240">https://news.ycombinator.com/item?id=38380240</a></p></div></div></div>
  </body>
</html>
