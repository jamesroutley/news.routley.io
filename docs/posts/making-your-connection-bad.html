<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.5snb.club/posts/2024/making-your-connection-bad/">Original</a>
    <h1>Making Your Connection Bad</h1>
    
    <div id="readability-page-1" class="page"><div>
    <div>
      






<p>This is directly inspired by <a href="https://brr.fyi/posts/engineering-for-slow-internet">Engineering for Slow
Internet</a>. I figured I’d give running with
dogshit internet on my desktop and phone a go to see how poorly (or well!) specific applications behave.</p>
<p>This is not an in-depth review of the behavior, but just my general impressions running for a few
hours on 200kbit internet with significant packet loss.</p>
<p>F-Droid doesn’t have a download pause feature, but <em>does</em> resume interrupted downloads. Well done
:) Though it does seem to crash sometimes (I have reported this).</p>
<p>Steam has a download pause feature, and does seem to resume interrupted downloads across steam restarts.</p>
<p>Telegram is quite usable. Images are slow, but for chat, I’d be perfectly happy with it.</p>
<p>Discord will sometimes just kick you to a loading screen if it thinks your internet isn’t working.
If it <em>doesn’t</em> do that, it works pretty okay.</p>
<p><code>git</code> fetches/clones simply <em>do not</em> have any resumption, as far as I can see. But if you fetch
often enough, the transferred data might be small enough to be able to finish in one transfer. The
kernel <a href="https://kernel.org/cloning-linux-from-a-bundle.html" title="Cloning Linux from a bundle">has instructions to clone from a
bundle</a>, which
is one workaround for this issue. Doesn’t help you with pushes, though.</p>
<h2 id="how-to-do-this-on-linux">How to do this on linux</h2>
<p>Your name for <code>enp3s0</code> may be different. Change it to whatever your network adapter is.</p>
<pre data-lang="bash"><code data-lang="bash"><span>sudo</span><span> modprobe ifb
</span><span>
</span><span>sudo</span><span> ip link add name ifb0 type ifb
</span><span>sudo</span><span> ip link set dev ifb0 up
</span><span>
</span><span>sudo</span><span> tc qdisc add dev enp3s0 ingress
</span><span>sudo</span><span> tc filter add dev enp3s0 parent ffff: </span><span>\
</span><span>    u32 match u32 0 0 flowid 1:1 action mirred egress redirect dev ifb0
</span><span>
</span><span>sudo</span><span> tc qdisc add dev ifb0 root netem </span><span>\
</span><span>    delay 200ms 50ms 50 loss random 2% rate 200kbit
</span><span>sudo</span><span> tc qdisc add dev enp3s0 root netem </span><span>\
</span><span>    delay 200ms 50ms 50 loss random 2% rate 200kbit
</span></code></pre>
<p>If you want to test services running on <code>localhost</code>, replace <code>enp3s0</code> with <code>lo</code>. Though some other
programs on your system may Not Like It if <code>localhost</code> is slow, so do that at your own risk :3 (Be sure to replace
<code>enp3s0</code> with <code>lo</code> on the undo script!)</p>
<p>The post says</p>
<blockquote>
<p>If you’re an app developer reading this, can you tell me, off the top of your head, how your app
behaves on a link with 40 kbps available bandwidth, 1,000 ms latency, occasional jitter of up to
2,000 ms, packet loss of 10%, and a complete 15-second connectivity dropout every few minutes?</p>
</blockquote>
<p>If you want to change the settings to those, do:</p>
<p>(I can’t seem to emulate the connection dropout, but the 10% packet loss should be harsh enough.
Also, this is 40kbit up, and 40kbit down. Still, it’s Bad Enough.)</p>
<pre data-lang="bash"><code data-lang="bash"><span>sudo</span><span> tc qdisc change dev ifb0 root netem </span><span>\
</span><span>    delay 1000ms 2000ms 90 loss random 10% reorder 10% rate 40kbit
</span><span>sudo</span><span> tc qdisc change dev enp3s0 root netem </span><span>\
</span><span>    delay 1000ms 2000ms 90 loss random 10% reorder 10% rate 40kbit
</span></code></pre>
<p>To undo:</p>
<pre data-lang="bash"><code data-lang="bash"><span>sudo</span><span> tc qdisc delete dev ifb0 root
</span><span>sudo</span><span> tc qdisc delete dev enp3s0 root
</span><span>sudo</span><span> tc qdisc delete dev enp3s0 ingress
</span><span>sudo</span><span> modprobe</span><span> --remove</span><span> ifb
</span></code></pre>
<h2 id="how-to-do-this-on-android">How to do this on android</h2>
<p>And on an android device, it’s even easier to set up, but it only affects incoming download rate.
But for testing “Hey, does this application utterly shit itself if it doesn’t have a fast
network?”, that’s just fine. You need to enable developer options, though.</p>




<figure>
<a href="https://www.5snb.club/posts/2024/making-your-connection-bad/android-incoming-limit.png">
<picture>
<source srcset="https://www.5snb.club/processed_images/android-incoming-limit.ee93792abb6c4f30.webp" type="image/webp" height="1000" width="450"/>

<img src="https://www.5snb.club/processed_images/android-incoming-limit.13b19bb6aad57a07.jpg" alt="Inside Android Developer Options, Configure network rate limit set to 128kbps" height="1000" width="450"/>
</picture>
</a>
<figcaption>
<a href="https://www.5snb.club/posts/2024/making-your-connection-bad/android-incoming-limit.png">android-incoming-limit.png 144.86 kB
(864x1920)</a><br/>

</figcaption>
</figure>
<h2 id="how-to-do-this-on-the-web">How to do this on the web</h2>




<figure>
<a href="https://www.5snb.club/posts/2024/making-your-connection-bad/firefox-limit.png">
<picture>
<source srcset="https://www.5snb.club/processed_images/firefox-limit.b47959fa6c856d7e.webp" type="image/webp" height="389" width="792"/>

<img src="https://www.5snb.club/processed_images/firefox-limit.621d59fb8cd57959.jpg" alt="Firefox developer tools, network tab, GPRS limiting selected" height="389" width="792"/>
</picture>
</a>
<figcaption>
<a href="https://www.5snb.club/posts/2024/making-your-connection-bad/firefox-limit.png">firefox-limit.png 57.96 kB
(792x389)</a></figcaption>
</figure>
<h2 id="further-reading">Further Reading</h2>
<ul>
<li><a href="https://bravenewgeek.com/sometimes-kill-9-isnt-enough/">Sometimes Kill -9 Isn’t Enough</a></li>
<li><a href="https://web.archive.org/web/20190410224615/https://wiki.linuxfoundation.org/networking/netem#how_can_i_use_netem_on_incoming_traffic">Linux wiki networking:netem “How can I use netem on incoming traffic?”</a></li>
<li><a href="https://firefox-source-docs.mozilla.org/devtools-user/network_monitor/throttling/index.html">Firefox Throttling docs</a></li>
<li><a href="https://man7.org/linux/man-pages/man8/tc-netem.8.html">tc-netem(8)</a></li>
</ul>


    </div>
  </div></div>
  </body>
</html>
