<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://alexanderell.is/posts/rpc-from-scratch/">Original</a>
    <h1>Writing an RPC from Scratch (2021)</h1>
    
    <div id="readability-page-1" class="page"><section id="wrapper">
            <article>
                <header>
                    
                    <h2>
                        ...so you can appreciate the libraries that do it for you
                    </h2>
                    <h2>
                    Apr 18, 2021
                    · 3092 words
                    · 15 minutes read
                      <span>
                            
                      </span>
                    </h2>
                </header>
                
                <section id="post-body">
                    <p>There are many ways for computers to talk to other computers. A commonly used approach is a Remote Procedure Call, or an RPC. An RPC allows for the abstraction of calling another computer’s procedure as if it were a local one with all of the transmission and communication taken care of.</p>
<p>Let’s say we’re writing some math program on a single computer and we have some procedure or function that handles checking if a number is prime. We can use this function as we’d like, passing it numbers and getting an answer, and it can live in our computer.</p>
<p><img src="https://alexanderell.is/posts/rpc-from-scratch/is-prime-as-library.png" alt="The is_prime function as a library"/></p>
<p>This is fine, and for doing many things, it’s very helpful to keep things nearby. It’s easy to call, and since it’s right alongside the rest of our code, there’s nearly no delay when we have to send it numbers.</p>
<p>But, there are cases when it isn’t as helpful to keep it local. Maybe we want to have it run on a really powerful computer with many cores and lots of memory so it can check really, really big numbers. Well, that’s not so bad. We can run our main program on this big computer as well, so even though the rest of the program might not need it, the prime finder can use as much of the computer as it can.  What if we want to let other programs reuse the prime finder? We could make it a library that we can share between programs, but we might need a lot of memory resources for every computer that runs the prime finding library.</p>
<p>What if we just ran the prime function on a separate computer, then talked to that computer when we needed to check a number? That way, we can beef up this prime finder computer, and we can share it with other programs running on other computers.</p>
<p><img src="https://alexanderell.is/posts/rpc-from-scratch/is-prime-on-big-computer.png" alt="The is_prime function living on a powerful computer as part of a distributed network "/></p>
<p>The downside here is more complexity. Computers fail, networks are unreliable, and we have to worry about sending the answer back and forth. If you’re just writing a math program, you may not want to worry about network details, resending lost packets, or even how to find the computer that’s running the prime finder. If your job is writing the best prime-finding program, you may not want to worry about how to listen for requests or check for closed sockets.</p>
<p>This is where remote procedure calls come into play. We can wrap the complexity of inter-computer communication in the center, and we can surface a simple interface, called a <em>stub</em>, to either side of the conversation. To the math-program writer, we can make it look like you’re just calling the function that lives on the other computer. To the prime-finding program writer, we can just make it look like your function is being called. If we abstract away the middle, each side can focus on their respective details while still being able to enjoy the benefit of splitting this computation across multiple computers.</p>
<p><img src="https://alexanderell.is/posts/rpc-from-scratch/is-prime-distributed-with-stubs.png" alt="The is_prime function living on a powerful computer as part of a distributed network "/></p>
<p>The main job of an RPC call is to handle this middle section. Part of it has to live on the math program computer, where it has to take the arguments, package them, and send them to the other computer. When it gets a response, it has to unpackage it and pass it back. The part that lives on the prime finder computer has to wait for requests, unpackage the arguments, pass them to the function, get the result, package it, and send it back to whoever asked for it. Importantly, both the math program and the prime finder program have a clean interface between them and their respective stubs that allows for this abstraction.</p>
<p><img src="https://alexanderell.is/posts/rpc-from-scratch/RPC-diagram.png" alt="RPC components."/></p>
<center>
<em>Diagram from Implementing Remote Procedure Calls, Birrell &amp; Nelson, 1981</em>
</center>
</section>
            </article>

            

            

            

            

        </section></div>
  </body>
</html>
