<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.djhaskin.com/blog/mutt-on-windows-without-wsl/">Original</a>
    <h1>Mutt on Windows Without WSL</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
            <h2 id="introduction">Introduction</h2>
<p>I have this weird hobby of trying to get good unix tools to run natively on
Windows. I find this is the most efficient use of my laptop&#39;s resources, and therefore the nicest experience. WSL is nice, but it takes up
a lot of RAM on my system. I prefer to use <a href="https://www.msys2.org/docs/what-is-msys2/">MSYS2</a>. Getting unix tools to work
correctly under MSYS2 is a challenge, as we&#39;ll see, and for me, that&#39;s part of
the fun.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>These prerequisites are not just to use mutt, but to use msys2 successfully in any capacity for development or other work. These are the steps I follow to maximize my chances of success with msys2.</p>
<ul>
<li>Msys2 needs to be installed. I like to use <a href="https://scoop.sh/">scoop</a> to install it (and everything else on Windows, preferably). Just be sure to run <code>scoop hold msys2</code>. You do NOT want scoop reinstalling msys2 every half second for &#34;updates&#34; when you can just run <code>pacman -Syu</code> inside msys2 to get all the needed updates from there.</li>
<li>There should be no spaces in your USERPROFILE path. I know this is hard, but
  it&#39;s worth it. I usually do this by creating a local user named <code>nospaces</code> or
  something, logging in to that user, and only THEN logging into my Microsoft
  Windows account after my <code>C:\Users\&lt;me&gt;</code> folder has been created, etc.</li>
<li>Your MSYS2 installation should have this as its <code>/etc/fstab</code>, as the One True
  Way of ensuring your MSYS2 home directory is also your <code>USERPROFILE</code>
  directory:</li>
</ul>
<pre><code># For a description of the file format, see the Users Guide
# https://cygwin.com/cygwin-ug-net/using.html#mount-table

# DO NOT REMOVE NEXT LINE. It remove cygdrive prefix from path
none / cygdrive binary,posix=0,noacl,user 0 0
C:/Users    /home   ntfs    binary,posix=0,noacl,user 0 0
</code></pre>
<p>If you used scoop to install msys2, you can put the above file under <code>C:\Users\&lt;you&gt;\scoop\apps\msys2\current\etc\fstab</code> and it should work.</p>
<h2 id="instructions">Instructions</h2>
<ul>
<li>From a mingw64 MSYS2 prompt, type the following to install gpg, mux and msmtp:</li>
</ul>
<pre><code>pacman -S gnupg mutt mingw64/mingw-w64-x86_64-msmtp w3m
</code></pre>
<ul>
<li>We configure mutt as per usual, but I found that mutt can&#39;t send emails
   for some reason. So configure it to use <a href="https://marlam.de/msmtp/">msmtp</a> for that part, and then
   everything works. Here is my gmail config (found under <code>~/.mutt/home.account</code>):</li>
</ul>
<pre><code>set imap_user = &#34;djhaskin987@gmail.com&#34;
set folder = &#34;imaps://imap.gmail.com/&#34;
set spoolfile=&#34;+INBOX&#34;
set postponed = &#34;+[Gmail]/Drafts&#34;
set record = &#34;+[Gmail]/Sent Mail&#34;
set trash = &#34;+[Gmail]/Trash&#34;
set imap_pass = `multipass imaps://imap.gmail.com:993/`

set realname = &#34;Daniel Jay Haskin&#34;
set from=&#34;djhaskin987@gmail.com&#34;
set sendmail=&#34;/mingw64/bin/msmtp -a home&#34;

set crypt_use_gpgme
set pgp_default_key=&#34;443A163BD11CEAE798BAAB94D7268D49D06594F4&#34;

source ~/.muttrc
</code></pre>
<p>In this file, I use a shell script called
    <a href="https://git.sr.ht/~skin/dotfiles/tree/main/item/dot-local/bin/multipass">multipass</a>
    that looks up passwords from <a href="https://keepassxc.org/">KeePassXC</a> using
    <a href="https://github.com/Frederick888/git-credential-keepassxc">git-credential-keepassxc</a>.</p>
<p>We also see that I use <code>msmtp</code> configured to send using the home account.</p>
<p>Here is my <code>msmtp</code> config:</p>
<pre><code>defaults
auth on
tls on
tls_trust_file C:/Users/bhw/scoop/apps/msys2/current/usr/ssl/certs/ca-bundle.crt
logfile ~/.msmtp.log

account home
host smtp.gmail.com
port 465
tls_starttls off
from djhaskin987@gmail.com
user djhaskin987@gmail.com
passwordeval &#34;C:\Users\bhw\Executables\multipass.bat smtps://smtp.gmail.com:465/ djhaskin987@gmail.com&#34;

account migadu
host smtp.migadu.com
port 465
tls_starttls off
from dan@djhaskin.com
user dan@djhaskin.com
passwordeval &#34;C:\Users\bhw\Executables\multipass.bat smtps://smtp.migadu.com:465/ dan@djhaskin.com&#34;

account default: home
</code></pre>
<p>The <code>msmtp</code> program has to use a <a href="https://git.sr.ht/~skin/dotfiles/tree/main/item/Windows/Executables/multipass.bat"><em>different</em>
    multipass</a>
    because it is &#34;Windows aware&#34; and NOT &#34;msys2 aware&#34;,
    having not been compiled with <a href="https://www.msys2.org/wiki/MSYS2-introduction/">the &#34;msys2&#34; subsystem</a>, but rather with the
    &#34;mingw64&#34; subsystem. While we&#39;re on that subject, that file (above) must be
    written to <code>~/msmtprc.txt</code> on Windows, another gotcha I had. It&#39;s this
    back-and-forth windows-not-windows fence upon which msys2 teeters that makes
    it so important to have the msys2 home directory the same as the &#34;windows&#34;
    home directory. I find it makes things less confusing at times.</p>
<p>Finally, here is my <code>~/.muttrc</code>:</p>
<pre><code>set move = no
set confirmappend = no
alternative_order text/plain text/html
auto_view text/html
set mailcap_path = ~/.mailcap

set envelope_from=yes
</code></pre>
<p>Anyway, then I&#39;m able to fire up and use mutt in the msys2 mingw64 terminal:</p>
<pre><code>mutt -F ~/.mutt/home.account
</code></pre>
        </div></div>
  </body>
</html>
