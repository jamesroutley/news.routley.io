<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://hturan.com/writing/apple-watch-continuous-glucose-monitoring">Original</a>
    <h1>Continuous glucose monitoring on the Apple Watch</h1>
    
    <div id="readability-page-1" class="page"><div id="__next" data-reactroot=""><div><p><img src="https://hturan.com/img/writing/apple-watch-continuous-glucose-monitoring/header.jpg"/></p><p>Hi! üëã I&#39;m Harley, and I&#39;m a type 1 diabetic.</p><p>Type 1 diabetes (<em>diabetes mellitus type 1</em>, often shortened to <em>T1D</em>) is a chronic auto-immune disease with no conclusive known cause. The disease causes the body&#39;s immune system to attack and destroy the insulin-creating cells in your pancreas (the <a href="https://en.wikipedia.org/wiki/Pancreatic_islets">islets of Langerhans</a>).</p><p>Now, that&#39;s not great, because it turns out insulin is fairly important for the day-to-day functioning of the human body. It&#39;s used by the body to allow muscles, fat, and the liver to absorb glucose out of the bloodstream. Without it, glucose remains in your bloodstream until your blood turns into strawberry Kool-Aid and you die.</p><p>Type 1 diabetics like myself make up between 5 and 10% of all diabetics (around 0.015% of the world&#39;s population), and the disease is managed by effectively becoming a walking, talking pancreas ‚Äî we constantly measure our blood glucose levels, calculate the number of grams of carbohydrate in any food or drink we consume, identify the glycemic index of different parts of a meal, and make thousands of calculations per day regarding our activity, future plans, stress levels, caffeine levels, body temperature, injection site scar tissue, amount of sleep, and current insulin resistance (among <a href="https://diatribe.org/42-factors-affect-blood-glucose-surprising-update">dozens of other variables</a>).</p><p>When a type 1 diabetic consumes any food, they will use a ratio of the number of grams of carbohydrate in the food and the number of units of fast-acting insulin required and inject to attempt to offset the amount by which their blood glucose will rise. If you inject too little, your blood glucose levels rise, resulting in <a href="https://en.wikipedia.org/wiki/Hyperglycemia">hyperglycemia</a>. Inject too much, and your blood glucose levels drop, resulting in <a href="https://en.wikipedia.org/wiki/Hypoglycemia">hypoglycemia</a>.</p><p><img src="https://hturan.com/img/writing/apple-watch-continuous-glucose-monitoring/blood-glucose-factors.png"/></p><p>The <a href="https://diatribe.org/42-factors-affect-blood-glucose-surprising-update">dozens of factors</a> that affect blood glucose and insulin uptake mean that there&#39;s no such thing as perfect blood glucose management for a type 1 diabetic; eating and injecting the exact same thing on two subsequent days can have wildly varying results. It&#39;s a constant game of push-and-pull between insulin being injected and glucose being consumed. If your blood sugar is low (hypoglycemia), you take fast-acting glucose to bring it up, and if your blood sugar is high (hyperglycemia), you take fast-acting insulin to bring it down. It&#39;s a feedback loop that requires constant manual intervention, and you can&#39;t afford to not keep the loop running.</p><blockquote data-conversation="none" data-dnt="true"><a href="https://twitter.com/Keg_Melly/status/1374746687227461634"></a></blockquote><p>Luckily for me, I was diagnosed with T1D at the fairly late age of 16, so I&#39;ve only had to go to sleep roughly 5,110 times worrying about my blood glucose levels. I&#39;m currently hitting a ~0.9994 wake-up-without-being-surrounded-by-paramedics-after-having-a-diabetic-seizure batting average too, which I&#39;m quite proud of. I&#39;ve had an accidental insulin overdose (injecting insulin during the confusion of severe hypoglycemia), called emergency services for assistance, and then been classed as a suicide risk by the UK&#39;s National Health Service.</p><p>I won&#39;t touch too much on the mental toll this can have, but it&#39;s <em>a lot</em> to think about on a daily basis ‚Äî not only for myself, but for everyone I hold dear. <a href="https://www.cdc.gov/diabetes/library/spotlights/diabetes-burnout.html">Diabetic burnout</a> is a real thing. If you&#39;re reading this and suffering with T1D, or have someone close to you who suffers from T1D, just know that regardless of all the other current stresses of day-to-day life, you&#39;re doing an incredible job keeping going.</p><p>So, when a 20% mis-calculation when injecting insulin for an evening meal can be enough to mean that you don&#39;t wake up the next morning, and there are hundreds of variables that can affect your blood glucose on any given day, there&#39;s only one real way to live your life as normal ‚Äî monitoring your blood glucose <em>constantly</em>.</p><hr/><h2>Monitoring</h2><p>The primary way by which type-one diabetics measure their blood glucose readings is by pricking your finger, squeezing out a drop of blood, dropping that blood onto a stick, and waiting for a pocket-sized machine to give you a number ‚Äî what you might have heard of as a &#34;finger prick&#34; test. This number will be the amount of glucose in your blood at that point in time.</p><p>There have been a number of innovations in glucose monitoring over the previous couple of decades, but for me the <a href="https://www.freestyle.abbott/us-en/home.html">Abbott FreeStyle Libre</a> changed everything. A coin-sized sensor that gets applied to your arm, the Libre has a small filament which measures the glucose levels in your subcutaneous fat layer. With a simple NFC scan from a pocket reader (and later, a smartphone) you could now test your blood glucose levels without drawing blood and managing the disposal of biohazardous waste. The Libre is available on the NHS for all UK citizens, or is available privately for ~¬£57 per sensor. Each sensor lasts for two weeks and is non-removable for the duration.</p><p>Because of this convenience and lack of disposable resources, the key innovation with the Libre (known as a <em>flash glucose monitor</em>) is the giant increase in the <em>data resolution</em> available. Diabetics can now check their blood glucose dozens of times <em>per hour</em> if they want, rather than the usual six times <em>per day</em> with fingerpick tests. This increased resolution gives us far, far more insight into how our bodies react to insulin, and lets us have detailed insight into the trends as our glucose levels drop and spike throughout the day.</p><p><img src="https://hturan.com/img/writing/apple-watch-continuous-glucose-monitoring/chart-resolution.png"/></p><p>Think about this ‚Äî with six data points of resolution, you have no clue as to <em>the direction your blood glucose is travelling</em>. If you&#39;re off to bed, take a finger-prick test, and see 6.0, that could mean that your blood glucose levels are perfect, that your glucose levels are dropping rapidly, or that your glucose levels are rising rapidly. The main innovation of the Libre is being able to easily determine the <em>direction</em> of your blood glucose at any moment in time.</p><p>Of course, each of those checks still requires us to unlock the phone, open the LibreView app, navigate through a couple of three-year-old memory leaks, rub the phone against our arm through a layer or two of clothing (best of luck in the Winter here in London), and then view the result. Again, a huge, <em>huge</em> leap forward in convenience, but once you&#39;re used to this, it&#39;s not convenient enough. Measuring blood glucose is still a reactive process, rather than a proactive one.</p><p>What&#39;s better than monitoring your blood glucose <em>dozens</em> of times per day?</p><p>Monitoring your blood glucose <em>hundreds</em> of times per day.</p><hr/><h2><em>Continuous</em> Monitoring</h2><p>The entire purpose of Continuous Glucose Monitoring (CGM) is to move from a <em>reactive</em> to a <em>proactive</em> way of monitoring. As you can guess from the name, CGM is the process of constantly monitoring and gauging the levels of blood glucose. In the same way that moving from manually checking BG levels to checking with the Libre gave us BG <em>direction</em>, moving from the Libre to continuous blood glucose monitoring gives us BG <em>insight</em>.</p><p>There are many common CGM systems out there ‚Äî</p><p><strong>Dexcom G6</strong> (~¬£1900 per year)
Dexcom is the go-to name in CGM, and has been available in some form for over two decades. The latest version ‚Äî <a href="https://www.dexcom.com/g6-cgm-system">the G6</a> ‚Äî takes the form of a sensor, inserted under the skin, and a transmitter adhered above the skin. Each sensor/transmitter pair lasts for 10 days.</p><p><strong>GlucoMen Day</strong> (~¬£1900 per year)
Similar to the Dexcom but with a stranger name, the <a href="https://glucomenday.co.uk">GlucoMen Day</a> sensors last for 14 days and come as a single needle-free sensor application.</p><p><strong>FreeStyle Libre 3</strong> (~¬£1560 per year, once available)
The latest version of the Libre actually now includes CGM functionality, with the NFC arm sensor also including Bluetooth Low Energy functionality allowing it to communicate directly with a smartphone. It&#39;s only just being approved by regulators and is currently unavailable in the UK (privately or publicly via the NHS).</p><p>All of these systems are great, but expensive and proprietary. The companies responsible for them are limited by regulators as to what they can do, and technological progress is slow ‚Äî the apps can be buggy, the visualizations are not ideal, and they build for the most common use cases.</p><p>What we&#39;ll be doing today is taking our inexpensive Libre NFC flash glucose monitor (which is available to all UK-based type-one diabetics for free via the NHS) and sticking a Bluetooth LE transmitter on top of it, turning it into a customizable and open continuous glucose monitor. With this, we have inexpensive per-minute glucose readings going to any device of our choosing over Bluetooth LE.</p><h2>Using the Libre as a CGM</h2><p>To start with, we&#39;ll need a device to convert our Libre from a <strong>flash</strong> glucose monitor to a <strong>continuous</strong> glucose monitor. Luckily, there are a few to choose from, and we&#39;ll be going with the one with the best name ‚Äî the <a href="https://miaomiaoreader.com">MiaoMiao</a>. It&#39;s a small Bluetooth LE / NFC device that performs a simple task ‚Äî every five minutes, it does an NFC scan on the Libre, and forwards the sensor data over Bluetooth LE to a device. Due to the simple nature and lack of processing, it‚Äôs small, lightweight, waterproof, sits atop the Libre, and the charge lasts longer than a Libre does (~14 days).</p><p>Due to the way that the Libre measures blood glucose levels (through a <em>subcutaneous filament</em> measuring second-order levels of glucose in the fat layer, not the blood itself), it&#39;s not a <em>perfect</em> CGM ‚Äî there‚Äôs still a slight lag of up to 10 minutes between measured and actual blood glucose readings. But once you start getting continuous high resolution data, it‚Äôs more about the slope of the curve, rather than the intercept at any given time. If you can see the direction that your glucose is headed in, you can start to adjust.</p><p>The great thing about this setup with the Libre and MiaoMiao is that it&#39;s now just your glucose data, flowing over Bluetooth LE, free of any proprietary app or API. We can do whatever we want with this data, including building apps, creating novel visualizations, and sending it to family members.</p><p>For example, here&#39;s a quick web-based visualization I made, showing my blood glucose levels for twenty-one days, rendered as a series of stacked violin plots using the <a href="https://airbnb.io/visx"><code>visx</code></a> library ‚Äî</p><p><img src="https://hturan.com/img/writing/apple-watch-continuous-glucose-monitoring/violin-plot.png"/></p><p>You can do what you like with this high-resolution data, and I&#39;ve barely scratched the surface of what&#39;s possible. Imagine taking this dataset, pairing it with timestamps and values of <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4454113/">insulin-on-board</a>, and feeding it into a machine-learning model to reduce the dimensionality of those 42 factors that affect blood glucose levels.</p><p>We now have an NFC chip in our arm that can read blood glucose levels, we have a Bluetooth chip stuck to the top of it, performing continuous readings and sending them to a smartphone, and we have a smartphone that can plot our readings and use notifications to alert us on critical abnormalities.</p><p>Is this enough? Let me check my wrist.</p><h2>Speaking watchOS</h2><p><img src="https://hturan.com/img/writing/apple-watch-continuous-glucose-monitoring/sketch.jpg"/></p><p>If there‚Äôs one device that‚Äôs stuck to your body more than a phone, it‚Äôs a watch.</p><p>Currently, most of the CGM apps from the available providers use the Apple Watch as a notification device for of their main app ‚Äî somewhere to send alarms and notifications rather than somewhere to proactively check glucose levels. This is odd, as WatchOS has contained all the necessary functionality required to communicate with Bluetooth devices directly since watchOS 4 in 2017. With watchOS 8, we now even have the ability to do these things in the background.</p><p>Adding all of the pieces together, this means we can now build a fully-independent Apple Watch app to continuously read blood glucose without the need for any other device. Be it when swimming, out in the ocean, going for a run, headed out to the shops, or any other time you might be without a phone nearby, we‚Äôre now able to shrink our digital pancreas down even further ‚Äî to the size of a watch on our wrist and a coin on our arm.</p><p>Our watchOS app will work by finding the nearest MiaoMiao transmitter via Bluetooth, setting up a regular background request (using <code>scheduleBackgroundRefresh</code>), and using this background request to connect to the found transmitter and reading all values. Once we have these values, we can store them locally on the watch and update any complications, along with firing notifications for rapid glucose changes.</p><h2>Complications</h2><p>As the primary use of this WatchKit app is glanceable data (the ability to determine the current blood glucose level and where it&#39;s headed), <a href="https://developer.apple.com/design/human-interface-guidelines/watchos/overview/complications/">complications</a> will make up the primary interface for our app.</p><p>To get current blood glucose readings showing up on an Apple Watch face, most apps today <a href="https://xdrip4ios.readthedocs.io/en/latest/configure/applewatch/">make use of the calendar</a>, placing blood glucose readings as calendar events and then encouraging the use of one of the calendar complications to provide glanceable data. Obviously this is not ideal, as we‚Äôre limited to complications designed for calendar events, and the syncing mechanisms are unreliable.</p><p>For our complications, let&#39;s start with a couple of example complications for showing the current blood glucose level ‚Äî</p><p>‚Ä¢ A &#34;circular open gauge text&#34; complication for the Modular watch face, showing a circular gauge with a dot indicating the current blood glucose level, some text showing the reading in <code>mmol/L</code>, and a small arrow indicating if blood glucose is trending up, down, or sideways.</p><p>‚Ä¢ A &#34;graphic corner gauge text&#34; complication for the Chronograph watch face, showing similar data, but also some text indicating when the reading took place.</p><p>Apple Watch supports a growing number of complications; you can find the full list in the <a href="https://developer.apple.com/design/human-interface-guidelines/watchos/overview/complications/"><em>Complications</em> section of the Human Interface Guidelines</a>. <a href="https://www.raywenderlich.com/17749320-complications-for-watchos-with-swiftui">This article by Warren Burton</a> has a great overview about creating regular and custom complication.</p><p>Setting up a complication on an Apple Watch app is a fairly simple process, requiring a couple of function calls and some configuration. It can all take place within a subclass of <code>CLKComplicationDataSource</code>.</p><p>We start by describing the complications that our app supports using <code>CLKComplicationDescriptor</code> and the <code>getComplicationDescriptors</code> handler ‚Äî</p><div><div><p><span>swift</span></p><pre><p><span>class</span><span> </span><span>ComplicationController</span><span>:</span><span> </span><span>NSObject</span><span>,</span><span> </span><span>CLKComplicationDataSource</span><span> </span><span>{</span><span></span></p><p><span></span><span>func</span><span> </span><span>getComplicationDescriptors</span><span>(</span><span>handler</span><span>:</span><span> </span><span>@escaping</span><span> </span><span>(</span><span>[</span><span>CLKComplicationDescriptor</span><span>]</span><span>)</span><span> </span><span>-&gt;</span><span> </span><span>Void</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>let</span><span> descriptors </span><span>=</span><span> </span><span>[</span><span></span></p><p><span>        </span><span>CLKComplicationDescriptor</span><span>(</span><span>identifier</span><span>:</span><span> </span><span>&#34;complication&#34;</span><span>,</span><span> displayName</span><span>:</span><span> </span><span>&#34;Glucose&#34;</span><span>,</span><span> supportedFamilies</span><span>:</span><span> </span><span>[</span><span>CLKComplicationFamily</span><span>.</span><span>graphicCircular</span><span>]</span><span>)</span><span></span></p><p><span>    </span><span>]</span><span></span></p><p><span>    </span><span>handler</span><span>(</span><span>descriptors</span><span>)</span><span></span></p><p><span></span><span>}</span><span></span></p><p><span></span><span>}</span></p></pre></div></div><p>Once we&#39;ve registered our <code>graphicCircular</code> complication support, we can then create the complications themselves within <code>getCurrentTimelineEntry</code> / <code>getTimelineEntries</code>. As we&#39;re just showing a latest value for our complications, we don&#39;t have to worry too much about timelines, and can just provide the current date for the latest entry ‚Äî</p><div><div><p><span>swift</span></p><pre><p><span>func</span><span> </span><span>getTimelineEntries</span><span>(</span><span>for</span><span> complication</span><span>:</span><span> </span><span>CLKComplication</span><span>,</span><span> after date</span><span>:</span><span> </span><span>Date</span><span>,</span><span> limit</span><span>:</span><span> </span><span>Int</span><span>,</span><span> withHandler handler</span><span>:</span><span> </span><span>@escaping</span><span> </span><span>(</span><span>[</span><span>CLKComplicationTimelineEntry</span><span>]</span><span>?</span><span>)</span><span> </span><span>-&gt;</span><span> </span><span>Void</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>let</span><span> complicationTemplate </span><span>=</span><span> </span><span>createGraphicCircleTemplate</span><span>(</span><span>forDate</span><span>:</span><span> </span><span>Date</span><span>(</span><span>)</span><span>)</span><span></span></p><p><span>    </span><span>let</span><span> timelineEntry </span><span>=</span><span> </span><span>CLKComplicationTimelineEntry</span><span>(</span><span>date</span><span>:</span><span> </span><span>Date</span><span>(</span><span>)</span><span>,</span><span> complicationTemplate</span><span>:</span><span> complicationTemplate</span><span>)</span><span></span></p><p><span>    </span><span>handler</span><span>(</span><span>[</span><span>timelineEntry</span><span>]</span><span>)</span><span></span></p><p><span></span><span>}</span><span></span></p><p><span></span><span>private</span><span> </span><span>func</span><span> </span><span>createGraphicCircleTemplate</span><span>(</span><span>forDate date</span><span>:</span><span> </span><span>Date</span><span>)</span><span> </span><span>-&gt;</span><span> </span><span>CLKComplicationTemplate</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>let</span><span> latestReading </span><span>=</span><span> </span><span>GlucoseDataStore</span><span>.</span><span>shared</span><span>.</span><span>glucoseDataForDate</span><span>(</span><span>date</span><span>)</span><span></span></p><p><span>    </span><span>var</span><span> value </span><span>=</span><span> </span><span>0.0</span><span></span></p><p><span>    </span><span>if</span><span> </span><span>let</span><span> latestReading </span><span>=</span><span> latestReading </span><span>{</span><span></span></p><p><span>        value </span><span>=</span><span> latestReading</span><span>.</span><span>value </span><span>/</span><span> </span><span>18.0</span><span></span></p><p><span>    </span><span>}</span><span></span></p><p><span>    </span><span>let</span><span> min </span><span>=</span><span> </span><span>2.2</span><span>;</span><span></span></p><p><span>    </span><span>let</span><span> max </span><span>=</span><span> </span><span>12.0</span><span>;</span><span></span></p><p><span>    </span><span>var</span><span> fraction </span><span>=</span><span> </span><span>(</span><span>(</span><span>value </span><span>-</span><span> min</span><span>)</span><span> </span><span>/</span><span> </span><span>(</span><span>max </span><span>-</span><span> min</span><span>)</span><span>)</span><span></span></p><p><span>    </span><span>if</span><span> </span><span>(</span><span>fraction </span><span>&gt;</span><span> </span><span>1.0</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>        fraction </span><span>=</span><span> </span><span>1.0</span><span></span></p><p><span>    </span><span>}</span><span> </span><span>else</span><span> </span><span>if</span><span> </span><span>(</span><span>fraction </span><span>&lt;</span><span> </span><span>0.0</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>        fraction </span><span>=</span><span> </span><span>0.0</span><span></span></p><p><span>    </span><span>}</span><span></span></p><p><span>    </span><span>let</span><span> guage </span><span>=</span><span> </span><span>CLKSimpleGaugeProvider</span><span>(</span><span>style</span><span>:</span><span> </span><span>.</span><span>ring</span><span>,</span><span> gaugeColor</span><span>:</span><span> </span><span>GlucoseDataStore</span><span>.</span><span>shared</span><span>.</span><span>colorForValue</span><span>(</span><span>value</span><span>)</span><span>,</span><span> fillFraction</span><span>:</span><span> </span><span>Float</span><span>(</span><span>fraction</span><span>)</span><span>)</span><span></span></p><p><span>    </span><span>return</span><span> </span><span>CLKComplicationTemplateGraphicCircularOpenGaugeSimpleText</span><span>(</span><span>gaugeProvider</span><span>:</span><span> guage</span><span>,</span><span> bottomTextProvider</span><span>:</span><span> </span><span>CLKSimpleTextProvider</span><span>(</span><span>text</span><span>:</span><span> </span><span>GlucoseDataStore</span><span>.</span><span>shared</span><span>.</span><span>getLatestSlope</span><span>(</span><span>)</span><span>)</span><span>,</span><span> centerTextProvider</span><span>:</span><span> </span><span>CLKSimpleTextProvider</span><span>(</span><span>text</span><span>:</span><span> </span><span>String</span><span>(</span><span>format</span><span>:</span><span> </span><span>&#34;%.1f&#34;</span><span>,</span><span> value</span><span>)</span><span>)</span><span>)</span><span></span></p><p><span></span><span>}</span></p></pre></div></div><p>Here we create a <code>CLKComplicationTemplateGraphicCircularOpenGaugeSimpleText</code> (<em>phew!</em>) with the gauge value based on the current glucose value within a configurable maximum / minimum range.</p><p>Our Circular Open Gauge complication provides the current blood glucose reading and trend (as of +/- 15 mins, depending on when the complication is refreshed), but it doesn&#39;t contain other useful information, such as <em>when</em> the reading occurred, and what our previous values were. To display this information, we&#39;re going to need more room.</p><p>A <code>CLKComplicationTemplateGraphicCornerGaugeText</code> would allow us to see the current glucose reading, the trend, and some further information, such as when the reading occurred.</p><div><div><p><span>swift</span></p><pre><p><span></span><span>let</span><span> guage </span><span>=</span><span> </span><span>CLKSimpleGaugeProvider</span><span>(</span><span>style</span><span>:</span><span> </span><span>.</span><span>ring</span><span>,</span><span> gaugeColor</span><span>:</span><span>  </span><span>GlucoseDataStore</span><span>.</span><span>shared</span><span>.</span><span>colorForValue</span><span>(</span><span>value</span><span>)</span><span>,</span><span> fillFraction</span><span>:</span><span> </span><span>Float</span><span>(</span><span>fraction</span><span>)</span><span>)</span><span></span></p><p><span></span><span>let</span><span> timeFormatter </span><span>=</span><span> </span><span>RelativeDateTimeFormatter</span><span>(</span><span>)</span><span></span></p><p><span></span><span>let</span><span> formattedDate </span><span>=</span><span> timeFormatter</span><span>.</span><span>localizedString</span><span>(</span><span>for</span><span>:</span><span> latestReading</span><span>!</span><span>.</span><span>timeStamp</span><span>,</span><span> relativeTo</span><span>:</span><span> </span><span>Date</span><span>(</span><span>)</span><span>)</span><span></span></p><p><span></span><span>let</span><span> leadingText </span><span>=</span><span> </span><span>CLKSimpleTextProvider</span><span>(</span><span>text</span><span>:</span><span> formattedDate</span><span>)</span><span></span></p><p><span></span><span>let</span><span> valueText </span><span>=</span><span> </span><span>CLKSimpleTextProvider</span><span>(</span><span>text</span><span>:</span><span> </span><span>String</span><span>(</span><span>format</span><span>:</span><span> </span><span>&#34;%@ %@&#34;</span><span>,</span><span> </span><span>GlucoseDataStore</span><span>.</span><span>shared</span><span>.</span><span>getLatestSlope</span><span>(</span><span>)</span><span>,</span><span> valueString</span><span>)</span><span>)</span><span></span></p><p><span></span><span>return</span><span> </span><span>CLKComplicationTemplateGraphicCornerGaugeText</span><span>(</span><span>gaugeProvider</span><span>:</span><span> guage</span><span>,</span><span> leadingTextProvider</span><span>:</span><span> leadingText</span><span>,</span><span> trailingTextProvider</span><span>:</span><span> </span><span>nil</span><span>,</span><span> outerTextProvider</span><span>:</span><span> valueText</span><span>)</span></p></pre></div></div><p>With some further exploration and implementation we can build a full blood glucose watch face, featuring additional complications for our Bluetooth transmitter&#39;s battery, along with the number of days left before our Libre sensor needs replacing. Alongside this, we can build full watchOS apps too!</p><p>I haven&#39;t had time to venture too far down this road, but here&#39;s a quick example showing a list of the latest readings retrieved from the transmitter, along with the two complications we just made ‚Äî</p><p><img src="https://hturan.com/img/writing/apple-watch-continuous-glucose-monitoring/watch-app.png"/><img src="https://hturan.com/img/writing/apple-watch-continuous-glucose-monitoring/open-gauge.png"/><img src="https://hturan.com/img/writing/apple-watch-continuous-glucose-monitoring/corner-gauge.png"/></p><h2>Future ‚Üí</h2><p>Believe it or not, in this post we&#39;ve actually just built the wildest sci-fi dreams of type 1 diabetics from a decade ago ‚Äî</p><p><img src="https://hturan.com/img/writing/apple-watch-continuous-glucose-monitoring/glance-watch.png"/></p><p>Go us! And go the amazing scientists at Abott and beyond who have helped us reach this point. I can now check my wrist before bed, and have confidence that I‚Äôll still be here in the morning.</p><p>What we&#39;ve built here is a tighter safety net. When we talk about <a href="https://notchcommunications.co.uk/type-1-diabetes-walking-the-tightrope/">diabetes as a tightrope</a>, it&#39;s important to remember that every trapeze artist has fallen. Having technology that catches us when we fall is <em>vital</em>.</p><p>All this begs the question ‚Äî where will we be in ten years&#39; time?</p><figure><img src="https://hturan.com/img/writing/apple-watch-continuous-glucose-monitoring/lila-moss.jpg"/><a href="https://www.vogue.co.uk/fashion/article/kate-moss-lila-moss-met-gala-2022">Lila Moss at the 2022 Met Gala<!-- --> </a><em>‚Äî The first person to walk the red carpet at the Met Gala with a bionic pancreas. Dressed by Riccardo Tisci for Burberry, makeup by Charlotte Tilbury, accessorized by Abbott and Omnipod.</em></figure><p>We haven&#39;t talked about it much today, but insulin pumps are the other side of the monitoring story. The pancreas not only monitors blood glucose, but provides insulin and <a href="https://en.wikipedia.org/wiki/Glucagon">glucagon</a> to even out glucose levels in the body. Devices like the <a href="https://www.omnipod.com">Omnipod</a> are filled with insulin and are attached to the body with a cannula to provide a steady stream of insulin, and when paired with a CGM can provide an entire digital pancreas. When CGMs can detect raised glucose levels and automatically tell an insulin pump to provide insulin, we call this a <a href="https://www.diabetes.org.uk/guide-to-diabetes/diabetes-technology/closed-loop-systems">closed-loop system</a>.</p><p>With this, we now have the technology to build a computer-controlled pancreas and stick it to our bodies. We have the ability to continuously measure the body&#39;s blood glucose levels, calculate the slope and rate of change, and automatically inject the correct dosage of fast-acting insulin to offset any variations.</p><p>The next logical step will be to take this technology and productize it. Miniaturize it, and make it available and affordable for all. That&#39;s what <a href="https://www.betabionics.com">Beta Bionics</a>, amongst others, are focusing on. Their iLet¬Æ system literally bills itself as &#34;a fully automated bionic pancreas&#34;.</p><p>Other companies, such as <a href="https://www.senseonics.com">Senseonics</a> have an implantable CGM, which contains a fluorescent chemical that lights up when exposed to glucose which is then read by a sensor mounted on the arm. It requires surgical removal every three months, with an estimated annual cost (including surgery) of over $3,000. Google was working on (<a href="https://www.labiotech.eu/in-depth/contact-lens-glucose-diabetes/">and then cancelled</a>) a contact lens that measured glucose levels in the tears and then communicated those levels with a small LED in the lens itself.</p><p>Rumors have persisted for years about a blood glucose sensor built-in to the Apple Watch itself, too. It&#39;s an incredibly complex feat to have non-invasive blood glucose monitoring that is accurate enough to trust with your life. This has never been done before, but with 1.6 million US citizens alone suffering from T1D, Apple has the desire and capability to be the first to market with a solution. A $400 watch with these capabilities will be a literal life-saver.</p><p>Approaching from the other end of the &#34;how to fix a pancreas&#34; spectrum, we have CRISPR, stem cell research, and islet transplants. Go read <a href="https://www.nature.com/articles/s41587-020-0430-6"><em>‚ÄåTargeting the cytoskeleton to direct pancreatic differentiation of human pluripotent stem cells</em></a> for your daily dose of near future scientific wonderment.</p><p>So the future is bright! Be it in biological or technological advancement, it&#39;s foreseeable (even likely) that within the decade I&#39;ll be cycling around with a single device ‚Äî a digital pancreas ‚Äî strapped to my waist, monitoring my glucose levels and injecting my bloodstream with insulin and glucagon without a care in the world.</p><p>We often think of a cure for a disease being a complete reversal of the effects that disease has on us ‚Äî transplanting cells or organs, performing surgery, taking medication to reverse the effects. In this case, there&#39;s another cure ‚Äî using technology as a means to <em>forget our body&#39;s failings</em>.</p><p>If I can live a day of my life and not think about diabetes, then I&#39;m cured.</p><p>So let&#39;s build.</p><p><span>‚ùã</span></p><h2>References</h2><p><a href="https://maori.geek.nz/the-unreasonable-math-of-type-1-diabetes-8c96bdf5b7fb"><strong>The Unreasonable Math of Type 1 Diabetes</strong></a> <em>by Graham Jenson</em></p><p>This piece by Graham is truly wonderful, and a big inspiration for writing about my experience living with T1D. I can&#39;t recommend it highly enough. If you read one other piece regarding T1D, read this, from the viewpoint of a father of an 18-month-old diabetic son.</p><p><a href="https://github.com/LoopKit/LoopKit"><strong>LoopKit/LoopKit</strong></a></p><p>An incredible library containing Swift code and algorithms for closed-loop systems. See <a href="https://github.com/LoopKit/LoopKit/blob/dev/LoopKit/LoopMath.swift">these algorithms</a> for insulin slope predictions.</p><p><a href="https://github.com/JohanDegraeve/xdripswift"><strong>‚ÄåJohanDegraeve/xdripswift</strong></a></p><p>Fantastic port of xDrip to Swift, including algorithms for <a href="https://github.com/JohanDegraeve/xdripswift/blob/master/xdrip/BluetoothTransmitter/CGM/Libre/MiaoMiao/CGMMiaoMiaoTransmitter.swift">communicating with the MiaoMiao via CoreBluetooth</a> and <a href="https://github.com/JohanDegraeve/xdripswift/blob/master/xdrip/BluetoothTransmitter/CGM/Libre/Utilities/LibreDataParser.swift">decoding Libre data</a>, along with calibrating sensor data over time.</p><hr/><p>My work here builds on many open-source projects, to which I owe a huge debt of gratitude. I&#39;ll be polishing up libraries for visualizing blood glucose levels on the web and iOS in the near future, and will publish them as open-source.</p></div></div></div>
  </body>
</html>
