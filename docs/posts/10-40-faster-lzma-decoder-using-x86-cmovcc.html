<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/ilyakurdyukov/f514418f3affd677e1ac408ec0c09188">Original</a>
    <h1>Show HN: 10-40% faster LZMA decoder using x86 CMOVcc</h1>
    
    <div id="readability-page-1" class="page"><div data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="Diff" data-tagsearch-path="faster_lzma_decoder_x86.patch">
        <tbody><tr>
          <td id="file-faster_lzma_decoder_x86-patch-L1" data-line-number="1"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC1">From db71be5c2f77ae18afc73bba85b9c11c6624d243 Mon Sep 17 00:00:00 2001</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L2" data-line-number="2"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC2">From: Ilya Kurdyukov &lt;jpegqs@gmail.com&gt;</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L3" data-line-number="3"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC3">Date: Mon, 13 Dec 2021 21:25:54 +0700</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L4" data-line-number="4"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC4">Subject: [PATCH] faster lzma_decoder for x86</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L5" data-line-number="5"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC5">
</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L6" data-line-number="6"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC6">Notice: Uses inline assembly with CMOV instruction.</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L7" data-line-number="7"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC7">
</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L8" data-line-number="8"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC8">Another change that removes the comparison with in_size can give a few</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L9" data-line-number="9"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC9">percent speedup for architectures with a small number of registers.</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L10" data-line-number="10"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC10"><span>---</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L11" data-line-number="11"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC11"> src/liblzma/lzma/lzma_decoder.c        | 78 +++++++++++++-------------</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L12" data-line-number="12"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC12"> src/liblzma/rangecoder/range_decoder.h | 51 +++++++++++++++--</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L13" data-line-number="13"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC13"> 2 files changed, 86 insertions(+), 43 deletions(-)</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L14" data-line-number="14"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC14">
</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L15" data-line-number="15"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC15"><span>diff --git a/src/liblzma/lzma/lzma_decoder.c b/src/liblzma/lzma/lzma_decoder.c</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L16" data-line-number="16"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC16">index e605a0a..ecb804b 100644</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L17" data-line-number="17"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC17"><span>--- a/src/liblzma/lzma/lzma_decoder.c</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L18" data-line-number="18"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC18"><span>+++ b/src/liblzma/lzma/lzma_decoder.c</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L19" data-line-number="19"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC19"><span>@@ -415,9 +415,7 @@</span> lzma_decode(void *coder_ptr, lzma_dict *restrict dictptr,</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L20" data-line-number="20"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC20"> 							= offset + match_bit</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L21" data-line-number="21"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC21"> 							+ symbol;</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L22" data-line-number="22"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC22"> </td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L23" data-line-number="23"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC23"><span><span>-</span>					rc_bit(probs[subcoder_index],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L24" data-line-number="24"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC24"><span><span>-</span>							offset &amp;= ~match_bit,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L25" data-line-number="25"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC25"><span><span>-</span>							offset &amp;= match_bit,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L26" data-line-number="26"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC26"><span><span>+</span>					rc_bit_matched(probs[subcoder_index],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L27" data-line-number="27"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC27"> 							SEQ_LITERAL_MATCHED);</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L28" data-line-number="28"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC28"> </td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L29" data-line-number="29"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC29"> 					// It seems to be faster to do this</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L30" data-line-number="30"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC30"><span>@@ -437,10 +435,7 @@</span> lzma_decode(void *coder_ptr, lzma_dict *restrict dictptr,</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L31" data-line-number="31"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC31"> 		case seq: \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L32" data-line-number="32"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC32"> 			match_bit = len &amp; offset; \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L33" data-line-number="33"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC33"> 			subcoder_index = offset + match_bit + symbol; \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L34" data-line-number="34"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC34"><span><span>-</span>			rc_bit(probs[subcoder_index], \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L35" data-line-number="35"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC35"><span><span>-</span>					offset &amp;= ~match_bit, \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L36" data-line-number="36"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC36"><span><span>-</span>					offset &amp;= match_bit, \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L37" data-line-number="37"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC37"><span><span>-</span>					seq)</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L38" data-line-number="38"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC38"><span><span>+</span>			rc_bit_matched(probs[subcoder_index], seq)</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L39" data-line-number="39"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC39"> </td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L40" data-line-number="40"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC40"> 				d(SEQ_LITERAL_MATCHED0);</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L41" data-line-number="41"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC41"> 				len &lt;&lt;= 1;</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L42" data-line-number="42"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC42"><span>@@ -564,40 +559,43 @@</span> lzma_decode(void *coder_ptr, lzma_dict *restrict dictptr,</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L43" data-line-number="43"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC43"> 					probs = coder-&gt;pos_special + rep0</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L44" data-line-number="44"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC44"> 							- symbol - 1;</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L45" data-line-number="45"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC45"> 					symbol = 1;</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L46" data-line-number="46"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC46"><span><span>-</span>					offset = 0;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L47" data-line-number="47"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC47"><span><span>-</span>	case SEQ_DIST_MODEL:</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L48" data-line-number="48"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC48"><span><span>+</span>					offset = 1;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L49" data-line-number="49"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC49"> #ifdef HAVE_SMALL</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L50" data-line-number="50"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC50"><span><span>+</span>					limit = 1 &lt;&lt; limit;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L51" data-line-number="51"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC51"><span><span>+</span>	case SEQ_DIST_MODEL:</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L52" data-line-number="52"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC52"> 					do {</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L53" data-line-number="53"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC53"><span><span>-</span>						rc_bit(probs[symbol], ,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L54" data-line-number="54"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC54"><span><span>-</span>							rep0 += 1U &lt;&lt; offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L55" data-line-number="55"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC55"><span><span>+</span>						rc_bit_dist(probs[symbol],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L56" data-line-number="56"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC56"><span><span>+</span>							offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L57" data-line-number="57"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC57"> 							SEQ_DIST_MODEL);</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L58" data-line-number="58"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC58"><span><span>-</span>					} while (++offset &lt; limit);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L59" data-line-number="59"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC59"><span><span>+</span>						offset &lt;&lt;= 1;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L60" data-line-number="60"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC60"><span><span>+</span>					} while (offset &lt; limit);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L61" data-line-number="61"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC61"> #else</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L62" data-line-number="62"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC62"><span><span>+</span>	case SEQ_DIST_MODEL:</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L63" data-line-number="63"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC63"> 					switch (limit) {</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L64" data-line-number="64"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC64"> 					case 5:</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L65" data-line-number="65"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC65"> 						assert(offset == 0);</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L66" data-line-number="66"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC66"><span><span>-</span>						rc_bit(probs[symbol], ,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L67" data-line-number="67"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC67"><span><span>-</span>							rep0 += 1U,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L68" data-line-number="68"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC68"><span><span>+</span>						rc_bit_dist(probs[symbol],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L69" data-line-number="69"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC69"><span><span>+</span>							offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L70" data-line-number="70"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC70"> 							SEQ_DIST_MODEL);</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L71" data-line-number="71"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC71"><span><span>-</span>						++offset;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L72" data-line-number="72"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC72"><span><span>+</span>						offset &lt;&lt;= 1;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L73" data-line-number="73"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC73"> 						--limit;</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L74" data-line-number="74"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC74"> 					case 4:</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L75" data-line-number="75"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC75"><span><span>-</span>						rc_bit(probs[symbol], ,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L76" data-line-number="76"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC76"><span><span>-</span>							rep0 += 1U &lt;&lt; offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L77" data-line-number="77"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC77"><span><span>+</span>						rc_bit_dist(probs[symbol],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L78" data-line-number="78"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC78"><span><span>+</span>							offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L79" data-line-number="79"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC79"> 							SEQ_DIST_MODEL);</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L80" data-line-number="80"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC80"><span><span>-</span>						++offset;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L81" data-line-number="81"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC81"><span><span>+</span>						offset &lt;&lt;= 1;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L82" data-line-number="82"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC82"> 						--limit;</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L83" data-line-number="83"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC83"> 					case 3:</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L84" data-line-number="84"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC84"><span><span>-</span>						rc_bit(probs[symbol], ,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L85" data-line-number="85"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC85"><span><span>-</span>							rep0 += 1U &lt;&lt; offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L86" data-line-number="86"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC86"><span><span>+</span>						rc_bit_dist(probs[symbol],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L87" data-line-number="87"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC87"><span><span>+</span>							offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L88" data-line-number="88"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC88"> 							SEQ_DIST_MODEL);</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L89" data-line-number="89"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC89"><span><span>-</span>						++offset;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L90" data-line-number="90"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC90"><span><span>+</span>						offset &lt;&lt;= 1;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L91" data-line-number="91"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC91"> 						--limit;</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L92" data-line-number="92"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC92"> 					case 2:</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L93" data-line-number="93"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC93"><span><span>-</span>						rc_bit(probs[symbol], ,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L94" data-line-number="94"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC94"><span><span>-</span>							rep0 += 1U &lt;&lt; offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L95" data-line-number="95"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC95"><span><span>+</span>						rc_bit_dist(probs[symbol],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L96" data-line-number="96"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC96"><span><span>+</span>							offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L97" data-line-number="97"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC97"> 							SEQ_DIST_MODEL);</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L98" data-line-number="98"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC98"><span><span>-</span>						++offset;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L99" data-line-number="99"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC99"><span><span>+</span>						offset &lt;&lt;= 1;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L100" data-line-number="100"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC100"> 						--limit;</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L101" data-line-number="101"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC101"> 					case 1:</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L102" data-line-number="102"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC102"> 						// We need &#34;symbol&#34; only for</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L103" data-line-number="103"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC103"><span>@@ -606,8 +604,8 @@</span> lzma_decode(void *coder_ptr, lzma_dict *restrict dictptr,</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L104" data-line-number="104"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC104"> 						// rc_bit_last() here to omit</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L105" data-line-number="105"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC105"> 						// the unneeded updating of</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L106" data-line-number="106"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC106"> 						// &#34;symbol&#34;.</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L107" data-line-number="107"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC107"><span><span>-</span>						rc_bit_last(probs[symbol], ,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L108" data-line-number="108"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC108"><span><span>-</span>							rep0 += 1U &lt;&lt; offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L109" data-line-number="109"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC109"><span><span>+</span>						rc_bit_dist_last(probs[symbol],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L110" data-line-number="110"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC110"><span><span>+</span>							offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L111" data-line-number="111"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC111"> 							SEQ_DIST_MODEL);</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L112" data-line-number="112"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC112"> 					}</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L113" data-line-number="113"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC113"> #endif</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L114" data-line-number="114"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC114"><span>@@ -630,30 +628,32 @@</span> lzma_decode(void *coder_ptr, lzma_dict *restrict dictptr,</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L115" data-line-number="115"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC115"> 					rep0 &lt;&lt;= ALIGN_BITS;</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L116" data-line-number="116"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC116"> 					symbol = 1;</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L117" data-line-number="117"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC117"> #ifdef HAVE_SMALL</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L118" data-line-number="118"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC118"><span><span>-</span>					offset = 0;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L119" data-line-number="119"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC119"><span><span>+</span>					offset = 1;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L120" data-line-number="120"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC120"> 	case SEQ_ALIGN:</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L121" data-line-number="121"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC121"> 					do {</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L122" data-line-number="122"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC122"><span><span>-</span>						rc_bit(coder-&gt;pos_align[</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L123" data-line-number="123"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC123"><span><span>-</span>								symbol], ,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L124" data-line-number="124"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC124"><span><span>-</span>							rep0 += 1U &lt;&lt; offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L125" data-line-number="125"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC125"><span><span>+</span>						rc_bit_dist(coder-&gt;pos_align[</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L126" data-line-number="126"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC126"><span><span>+</span>								symbol],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L127" data-line-number="127"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC127"><span><span>+</span>							offset,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L128" data-line-number="128"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC128"> 							SEQ_ALIGN);</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L129" data-line-number="129"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC129"><span><span>-</span>					} while (++offset &lt; ALIGN_BITS);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L130" data-line-number="130"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC130"><span><span>+</span>						offset &lt;&lt;= 1;</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L131" data-line-number="131"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC131"><span><span>+</span>					} while (offset &lt; (1 &lt;&lt; ALIGN_BITS));</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L132" data-line-number="132"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC132"> #else</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L133" data-line-number="133"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC133"> 	case SEQ_ALIGN0:</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L134" data-line-number="134"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC134"><span><span>-</span>					rc_bit(coder-&gt;pos_align[symbol], ,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L135" data-line-number="135"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC135"><span><span>-</span>							rep0 += 1, SEQ_ALIGN0);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L136" data-line-number="136"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC136"><span><span>+</span>					rc_bit_dist(coder-&gt;pos_align[symbol],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L137" data-line-number="137"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC137"><span><span>+</span>							1, SEQ_ALIGN0);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L138" data-line-number="138"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC138"> 	case SEQ_ALIGN1:</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L139" data-line-number="139"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC139"><span><span>-</span>					rc_bit(coder-&gt;pos_align[symbol], ,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L140" data-line-number="140"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC140"><span><span>-</span>							rep0 += 2, SEQ_ALIGN1);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L141" data-line-number="141"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC141"><span><span>+</span>					rc_bit_dist(coder-&gt;pos_align[symbol],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L142" data-line-number="142"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC142"><span><span>+</span>							2, SEQ_ALIGN1);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L143" data-line-number="143"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC143"> 	case SEQ_ALIGN2:</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L144" data-line-number="144"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC144"><span><span>-</span>					rc_bit(coder-&gt;pos_align[symbol], ,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L145" data-line-number="145"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC145"><span><span>-</span>							rep0 += 4, SEQ_ALIGN2);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L146" data-line-number="146"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC146"><span><span>+</span>					rc_bit_dist(coder-&gt;pos_align[symbol],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L147" data-line-number="147"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC147"><span><span>+</span>							4, SEQ_ALIGN2);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L148" data-line-number="148"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC148"> 	case SEQ_ALIGN3:</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L149" data-line-number="149"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC149"> 					// Like in SEQ_DIST_MODEL, we don&#39;t</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L150" data-line-number="150"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC150"> 					// need &#34;symbol&#34; for anything else</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L151" data-line-number="151"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC151"> 					// than indexing the probability array.</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L152" data-line-number="152"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC152"><span><span>-</span>					rc_bit_last(coder-&gt;pos_align[symbol], ,</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L153" data-line-number="153"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC153"><span><span>-</span>							rep0 += 8, SEQ_ALIGN3);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L154" data-line-number="154"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC154"><span><span>+</span>					rc_bit_dist_last(coder-&gt;pos_align[</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L155" data-line-number="155"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC155"><span><span>+</span>								symbol],</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L156" data-line-number="156"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC156"><span><span>+</span>							8, SEQ_ALIGN3);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L157" data-line-number="157"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC157"> #endif</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L158" data-line-number="158"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC158"> </td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L159" data-line-number="159"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC159"> 					if (rep0 == UINT32_MAX) {</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L160" data-line-number="160"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC160"><span>diff --git a/src/liblzma/rangecoder/range_decoder.h b/src/liblzma/rangecoder/range_decoder.h</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L161" data-line-number="161"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC161">index e0b051f..baec45c 100644</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L162" data-line-number="162"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC162"><span>--- a/src/liblzma/rangecoder/range_decoder.h</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L163" data-line-number="163"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC163"><span>+++ b/src/liblzma/rangecoder/range_decoder.h</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L164" data-line-number="164"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC164"><span>@@ -53,7 +53,8 @@</span> rc_read_init(lzma_range_decoder *rc, const uint8_t *restrict in,</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L165" data-line-number="165"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC165"> /// variables `in&#39; and `in_size&#39; to be defined.</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L166" data-line-number="166"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC166"> #define rc_to_local(range_decoder, in_pos) \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L167" data-line-number="167"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC167"> 	lzma_range_decoder rc = range_decoder; \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L168" data-line-number="168"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC168"><span><span>-</span>	size_t rc_in_pos = (in_pos); \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L169" data-line-number="169"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC169"><span><span>+</span>	size_t rc_in_pos = in_pos - in_size; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L170" data-line-number="170"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC170"><span><span>+</span>	const uint8_t *restrict rc_end = in + in_size; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L171" data-line-number="171"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC171"> 	uint32_t rc_bound</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L172" data-line-number="172"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC172"> </td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L173" data-line-number="173"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC173"> </td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L174" data-line-number="174"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC174"><span>@@ -61,7 +62,7 @@</span> rc_read_init(lzma_range_decoder *rc, const uint8_t *restrict in,</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L175" data-line-number="175"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC175"> #define rc_from_local(range_decoder, in_pos) \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L176" data-line-number="176"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC176"> do { \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L177" data-line-number="177"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC177"> 	range_decoder = rc; \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L178" data-line-number="178"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC178"><span><span>-</span>	in_pos = rc_in_pos; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L179" data-line-number="179"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC179"><span><span>+</span>	in_pos = rc_in_pos + in_size; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L180" data-line-number="180"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC180"> } while (0)</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L181" data-line-number="181"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC181"> </td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L182" data-line-number="182"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC182"> </td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L183" data-line-number="183"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC183"><span>@@ -87,12 +88,13 @@</span> do { \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L184" data-line-number="184"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC184"> #define rc_normalize(seq) \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L185" data-line-number="185"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC185"> do { \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L186" data-line-number="186"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC186"> 	if (rc.range &lt; RC_TOP_VALUE) { \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L187" data-line-number="187"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC187"><span><span>-</span>		if (unlikely(rc_in_pos == in_size)) { \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L188" data-line-number="188"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC188"><span><span>+</span>		if (unlikely(!rc_in_pos)) { \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L189" data-line-number="189"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC189"> 			coder-&gt;sequence = seq; \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L190" data-line-number="190"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC190"> 			goto out; \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L191" data-line-number="191"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC191"> 		} \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L192" data-line-number="192"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC192"><span><span>+</span>		rc.code &lt;&lt;= RC_SHIFT_BITS; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L193" data-line-number="193"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC193"> 		rc.range &lt;&lt;= RC_SHIFT_BITS; \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L194" data-line-number="194"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC194"><span><span>-</span>		rc.code = (rc.code &lt;&lt; RC_SHIFT_BITS) | in[rc_in_pos++]; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L195" data-line-number="195"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC195"><span><span>+</span>		rc.code |= rc_end[rc_in_pos++]; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L196" data-line-number="196"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC196"> 	} \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L197" data-line-number="197"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC197"> } while (0)</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L198" data-line-number="198"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC198"> </td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L199" data-line-number="199"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC199"><span>@@ -163,8 +165,49 @@</span> do { \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L200" data-line-number="200"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC200"> /// statements. On the other hand this also makes it less readable, since</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L201" data-line-number="201"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC201"> /// spotting the places where the decoder loop may be restarted is less</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L202" data-line-number="202"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC202"> /// obvious.</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L203" data-line-number="203"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC203"><span><span>+</span>#if defined(__GNUC__) &amp;&amp; (defined(__i386__) || defined(__x86_64__))</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L204" data-line-number="204"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC204"><span><span>+</span>#define rc_bit_nobranch(prob, pre0, pre1, action0, action1, seq) \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L205" data-line-number="205"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC205"><span><span>+</span>do { \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L206" data-line-number="206"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC206"><span><span>+</span>	rc_normalize(seq); \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L207" data-line-number="207"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC207"><span><span>+</span>	uint32_t cache = (prob), tmp; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L208" data-line-number="208"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC208"><span><span>+</span>	rc_bound = (rc.range &gt;&gt; RC_BIT_MODEL_TOTAL_BITS) * cache; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L209" data-line-number="209"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC209"><span><span>+</span>	rc.range -= rc_bound; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L210" data-line-number="210"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC210"><span><span>+</span>	/* tmp = rc.code &lt; rc_bound ? rc.range = rc_bound, ~0 : 0; */ \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L211" data-line-number="211"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC211"><span><span>+</span>	__asm__ ( \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L212" data-line-number="212"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC212"><span><span>+</span>		&#34;cmpl %3, %2\n\t&#34; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L213" data-line-number="213"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC213"><span><span>+</span>		&#34;cmovbl %3, %1\n\t&#34; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L214" data-line-number="214"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC214"><span><span>+</span>		&#34;sbbl %0, %0&#34; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L215" data-line-number="215"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC215"><span><span>+</span>		: &#34;=&amp;r&#34;(tmp), &#34;+&amp;r&#34;(rc.range) \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L216" data-line-number="216"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC216"><span><span>+</span>		: &#34;r&#34;(rc.code), &#34;r&#34;(rc_bound) \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L217" data-line-number="217"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC217"><span><span>+</span>	); \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L218" data-line-number="218"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC218"><span><span>+</span>	cache += tmp &amp; ((1 &lt;&lt; RC_MOVE_BITS) - 1 - RC_BIT_MODEL_TOTAL); \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L219" data-line-number="219"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC219"><span><span>+</span>	prob -= cache &gt;&gt; RC_MOVE_BITS; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L220" data-line-number="220"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC220"><span><span>+</span>	pre0; tmp = ~tmp; pre1; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L221" data-line-number="221"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC221"><span><span>+</span>	rc.code -= tmp &amp; rc_bound; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L222" data-line-number="222"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC222"><span><span>+</span>	if (!tmp) { action0; } else { action1; }; \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L223" data-line-number="223"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC223"><span><span>+</span>} while (0)</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L224" data-line-number="224"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC224"><span><span>+</span>#define rc_bit_case(prob, action0, action1, seq) \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L225" data-line-number="225"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC225"><span><span>+</span>	case seq: rc_bit_nobranch(prob, , symbol = (symbol &lt;&lt; 1) - tmp, \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L226" data-line-number="226"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC226"><span><span>+</span>		action0, action1, seq)</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L227" data-line-number="227"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC227"><span><span>+</span>#define rc_bit_matched(prob, seq) \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L228" data-line-number="228"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC228"><span><span>+</span>	rc_bit_nobranch(prob, offset &amp;= match_bit ^ tmp, \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L229" data-line-number="229"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC229"><span><span>+</span>		symbol = (symbol &lt;&lt; 1) - tmp, , , seq)</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L230" data-line-number="230"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC230"><span><span>+</span>#define rc_bit_dist(prob, offset, seq) \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L231" data-line-number="231"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC231"><span><span>+</span>	rc_bit_nobranch(prob, , \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L232" data-line-number="232"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC232"><span><span>+</span>		symbol = (symbol &lt;&lt; 1) - tmp; rep0 += offset &amp; tmp, \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L233" data-line-number="233"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC233"><span><span>+</span>		, , seq);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L234" data-line-number="234"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC234"><span><span>+</span>#define rc_bit_dist_last(prob, offset, seq) \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L235" data-line-number="235"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC235"><span><span>+</span>	rc_bit_nobranch(prob, , rep0 += offset &amp; tmp, , , seq);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L236" data-line-number="236"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC236"><span><span>+</span>#else</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L237" data-line-number="237"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC237"> #define rc_bit_case(prob, action0, action1, seq) \</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L238" data-line-number="238"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC238"> 	case seq: rc_bit(prob, action0, action1, seq)</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L239" data-line-number="239"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC239"><span><span>+</span>#define rc_bit_matched(prob, seq) \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L240" data-line-number="240"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC240"><span><span>+</span>	rc_bit(prob, offset &amp;= ~match_bit, offset &amp;= match_bit, seq)</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L241" data-line-number="241"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC241"><span><span>+</span>#define rc_bit_dist(prob, offset, seq) \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L242" data-line-number="242"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC242"><span><span>+</span>	rc_bit(prob, , rep0 += offset, seq);</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L243" data-line-number="243"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC243"><span><span>+</span>#define rc_bit_dist_last(prob, offset, seq) \</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L244" data-line-number="244"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC244"><span><span>+</span>	rc_bit_last(prob, , rep0 += offset, seq)</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L245" data-line-number="245"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC245"><span><span>+</span>#endif</span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L246" data-line-number="246"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC246"> </td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L247" data-line-number="247"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC247"> </td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L248" data-line-number="248"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC248"> /// Decode a bit without using a probability.</td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L249" data-line-number="249"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC249"><span><span>-</span>- </span></td>
        </tr>
        <tr>
          <td id="file-faster_lzma_decoder_x86-patch-L250" data-line-number="250"></td>
          <td id="file-faster_lzma_decoder_x86-patch-LC250">2.17.1</td>
        </tr>
  </tbody></div></div>
  </body>
</html>
