<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.token.security/blog/aws-built-a-security-tool-it-introduced-a-security-risk">Original</a>
    <h1>AWS Built a Security Tool. It Introduced a Security Risk</h1>
    
    <div id="readability-page-1" class="page"><div fs-richtext-element="rich-text"><p><em>(If you missed the previous parts of this trust policy blog series, we recommend reading parts </em><a href="https://www.token.security/blog/iam-role-trust-policies-misconfigurations-hiding-in-plain-sight" target="_blank"><em>one</em></a><em> and </em><a href="https://www.token.security/blog/secure-cross-account-access-is-tricky-four-common-dangerous-misconceptions" target="_blank"><em>two</em></a><em> first)</em></p><p>In the previous post of this series, we explored four dangerous misconceptions regarding how to securely set up cross-account access in AWS environments.</p><p>In this final post of the series, we’ll walk through a real-world case where even AWS got it wrong. Their <em>Account Assessment for AWS Organizations</em> tool, designed to audit resource-based policies for risky cross-account access, ironically introduced cross-account privilege escalation risks due to flawed deployment instructions. Specifically, customers were effectively encouraged to deploy the tool in lower-sensitivity accounts, creating risky trust paths from insecure environments into highly sensitive ones.</p><p>We’ll share how we discovered the issue, the risks it introduced, how AWS fixed it, and what affected organizations should do to detect and remediate it.</p><h3>How it started</h3><p>While investigating a critical privilege escalation risk involving an IAM role in a customer’s AWS environment, we discovered a role present in both their production and management accounts, each of which trusted two roles in their development account:</p><figure><p><img src="https://cdn.prod.website-files.com/661a822ae40a7d51ecf449bc/680f4186cc6df42ec59bed95_blog3_image1.png" loading="lazy" alt=""/></p><figcaption>The risky IAM role we investigated</figcaption></figure><p>These were the details of the privilege escalation risk (sensitive info redacted):</p><figure><p><img src="https://cdn.prod.website-files.com/661a822ae40a7d51ecf449bc/680f41b07a9e8cd78c0a74ed_blog3_image2.png" loading="lazy" alt=""/></p></figure><p>Examining the permissions of that role in the production and management accounts, we found it had access to several sensitive IAM and data-related API calls, including:</p><ul role="list"><li><code>iam:ListRoles</code> (lists all IAM roles, helping an attacker identify privileged and vulnerable roles)</li><li><code>iam:ListPolicies</code> (reveals all IAM policies, exposing potential misconfigurations)</li><li><code>secretsmanager:ListSecrets</code> (lists all stored secret names, identifying potential targets)</li><li><code>s3:ListAllMyBuckets</code> (enumerates all S3 buckets, exposing potential sensitive data locations)</li><li><code>kms:ListKeys</code> (lists all encryption keys, indicating what is being encrypted)</li><li><code>kms:GetKeyPolicy</code> (retrieves key policies, which could reveal weak or misconfigured access controls)</li><li>… and more (full policy <a href="https://github.com/aws-solutions/account-assessment-for-aws-organizations/blob/eb194bd76d87481c2bc682b7f03321342c5b3cd3/source/infra/lib/account-assessment-spoke-stack.ts#L57" target="_blank">here</a>)</li></ul><p>These permissions were granted on all resources (<code>resource: &#34;*&#34;</code>), making them particularly dangerous if compromised.</p><p>The organization&#39;s dev account had weaker security, making this role assumption path a major risk. An attacker compromising a trusted role in dev could immediately gain these permissions in production and management. Combined with other misconfigurations - such as exposed IAM roles, secret names, KMS keys, or public S3 buckets - this could help lead to compromise of the organization&#39;s most sensitive accounts.</p><p>This was already a serious risk, but what we found next revealed that this misconfiguration was not unique to this organization - it was actually inadvertently encouraged by AWS itself.</p><h3>Account Assessment for AWS Organizations</h3><p>The names of these roles were somewhat quirky, and hinted they were part of some automated system. A quick search led us to <a href="https://aws.amazon.com/solutions/implementations/account-assessment-for-aws-organizations/" target="_blank">Account Assessment for AWS Organizations</a>, a tool developed by AWS and published in the <a href="https://aws.amazon.com/solutions/" target="_blank">AWS Solutions Library</a>.</p><p>According to its official documentation, the tool is designed to “centrally evaluate and manage AWS accounts within your AWS Organizations”, helping users better understand account dependencies. AWS lists its <a href="https://docs.aws.amazon.com/solutions/latest/account-assessment-for-aws-organizations/use-cases.html" target="_blank">primary use cases</a> as mergers and acquisitions, security audits, centralized policy explorer and management account transitions.</p><p><strong>So, why was it deployed insecurely?</strong></p><p>Given that this tool was built by AWS to audit resource-based cross-account access, we initially assumed the misconfiguration was a deployment error by the customer. However, after reviewing the documentation, we realized that AWS’s deployment instructions unintentionally encouraged insecure setups, making it highly likely that users would deploy the tool in a way that introduced privilege escalation risks.</p><p>The tool follows a hub-and-spoke architecture:</p><ul role="list"><li>A hub role is deployed in a designated hub account.</li><li>Spoke roles are deployed in all other accounts to be assessed, trusting the hub role for access.</li></ul><p>This design allows the hub role to assume the spoke roles across all accounts, aggregating security data across the organization.</p><figure><p><img src="https://cdn.prod.website-files.com/661a822ae40a7d51ecf449bc/680f41d9677b48b093129595_blog3_diag1.drawio%20(7).png" loading="lazy" alt=""/></p></figure><p>When checking AWS&#39;s official deployment guidance, we were surprised to see the following instruction:</p><figure><p><img src="https://cdn.prod.website-files.com/661a822ae40a7d51ecf449bc/680f41f4791d880da8a99880_image%20(12).png" loading="lazy" alt=""/></p></figure><p>&#34;Hub stack - Deploy to any member account in your AWS Organization except the Organizations management account.&#34;</p><p>This is the root cause of the issue - AWS explicitly recommended not deploying the hub in the management account, without clarifying the security implications of the other possible choices.</p><h3><strong>Why this is a major security risk</strong></h3><p>Let’s back up a bit and explain why this instruction, without any clarification, was so problematic.</p><p>As we covered in the <a href="https://www.token.security/blog/secure-cross-account-access-is-tricky-four-common-dangerous-misconceptions" target="_blank">previous blog</a>, allowing a role in a less secure account to assume roles in more sensitive accounts creates a privilege escalation risk.</p><p>By design, the hub role must access all spoke accounts. Since AWS prohibited using the management account as the hub, customers were forced to deploy the hub in a less secure account - often a development, sandbox, or similarly low-sensitivity account. In deployed organizations, this led to the creation of a direct trust path from a lower-security account to higher-security accounts like production, PCI-DSS environments, and even the management account itself.</p><p>The following diagram visualizes the problem:</p><figure><p><img src="https://cdn.prod.website-files.com/661a822ae40a7d51ecf449bc/680f420f57a0fb21afc19cd2_blog3_diag2.drawio%20(3).png" loading="lazy" alt=""/></p></figure><p>In the case we investigated, the customer deployed the hub role in their development account, which:</p><ol role="list"><li>(Reasonably) had weaker security controls than production or management.</li><li>Had full access to assume spoke roles across all accounts, including sensitive ones such as the management and production accounts</li></ol><p>This meant that if an attacker compromised the development account, they could pivot into the management account - make it much easier to gain control over the entire AWS organization.</p><p>AWS strongly advises against running workloads in the management account, so simply deploying the hub there is not an ideal solution either. Instead, the only relatively safe option is to choose an account <strong>which is as secure</strong> as the management account, such as a centralized DevOps or Infrastructure account with strict access controls.</p><p>However, some organizations don’t necessarily have such an account, meaning any deployment inherently introduces risk. The problem isn&#39;t just where to deploy the hub - it&#39;s that AWS&#39;s default recommendation pushed organizations into an insecure setup without any reference to the security implications of this choice.</p><h3>Implications for affected organizations</h3><p>Any organization that deployed this tool following AWS’s instructions (before they were fixed on 2025-01-28) with the hub role deployed in an account less secure than the management account - and hasn’t removed it - is at risk.</p><p>For affected orgs, the hub account (where the hub role is deployed) becomes a high-value target. If an attacker compromises this role, whether through direct access or privilege escalation, they can assume spoke roles across all linked accounts - including highly sensitive environments such as management and production.</p><p>Once inside, they can:</p><ul role="list"><li>Enumerate IAM roles, trust policies, and permissions, identifying weak points.</li><li>List all S3 buckets and secret names, mapping out valuable data targets.</li><li>Access KMS key policies, which may reveal misconfigured encryption controls.</li></ul><p>Additionally, the tool’s <a href="https://github.com/aws-solutions/account-assessment-for-aws-organizations/blob/b429bbf2f31dc2f813e903751b8acc5aa3d240ad/source/lib/components/resource-based-policy-component.ts#L10" target="_blank">predefined role names</a> make it even easier for attackers to exploit. If an attacker gains access to any AWS account within an affected organization, they can easily identify whether the tool is deployed and know the exact role names that can be assumed from the hub account. This reduces the effort needed to escalate privileges and pivot into high-value environments.</p><h3>Detecting and remediating</h3><p>Here are two methods to determine if your organization is affected:</p><ul role="list"><li>Use the AWS Console to manually search the IAM role page in any suspected accounts for the hub and spoke roles. These roles contain the strings <code>ScanSpokeResource</code> and <code>AccountAssessment-Spoke-ExecutionRole</code> in their names accordingly.</li><li>Run the following AWS CLI command to check if the tool is deployed in a given account: <code>aws iam list-roles --query &#34;Roles[?contains(RoleName, &#39;ScanSpokeResource&#39;) || contains(RoleName, &#39;AccountAssessment-Spoke-ExecutionRole&#39;)]&#34;</code></li></ul><p><strong>If the tool is deployed -</strong> Check to see when the tool was deployed by examining the roles’ <code>CreateDate</code> property. If deployed before 2025-01-28, we strongly recommend removing the current deployment unless the hub role is already in a high-security account (such as a dedicated Infrastructure or DevOps account).</p><ol role="list"><li>Uninstall the tool by deleting the CloudFormation stacks for the Hub, Spoke, and Org-Management components. See AWS’s <a href="https://docs.aws.amazon.com/solutions/latest/account-assessment-for-aws-organizations/uninstall-the-solution.html" target="_blank">official uninstallation guide</a> for more instructions.</li><li>Redeploy carefully - if the tool is still needed, deploy the hub role in an account with security equivalent to the management account to prevent privilege escalation risks.</li></ol><h3>Reporting and resolution</h3><p>After identifying this issue, we reported it to AWS Security, highlighting the serious risks created by the tool’s deployment guidance. AWS promptly reviewed our findings, acknowledged the security concern, and engaged with us to determine how best to update the documentation to prevent future misconfigurations.</p><p>Based on this engagement, AWS revised the <a href="https://docs.aws.amazon.com/solutions/latest/account-assessment-for-aws-organizations/aws-accounts.html" target="_blank">documentation</a> to explicitly advise customers to deploy the hub role in a high-security account to match the sensitivity of the accounts being assessed:</p><figure><p><img src="https://cdn.prod.website-files.com/661a822ae40a7d51ecf449bc/680f4228ed41b221c8281a94_image%20(13).png" loading="lazy" alt=""/></p><figcaption>Updated documentation page, explicitly instructing to deploy the hub in an account as secure as all scanned accounts</figcaption></figure><p>‍</p><p>We thank the AWS Security team, who were highly responsive, open to feedback, and committed to improving customer security. They took the issue seriously from the start, worked with us to determine the best way to update the documentation, and delivered a clear and effective fix - ensuring organizations deploying this tool can avoid unintended privilege escalation risks in the future.</p><h3><strong>Reporting timeline</strong></h3><ul role="list"><li><strong>2024-12-11</strong> - Discovery of the problematic documentation.</li><li><strong>2024-12-12</strong> - Initial report to AWS Security.</li><li><strong>2025-01-02</strong> - AWS acknowledges the issue and begins considering documentation changes.</li><li><strong>2025-01-05</strong> - We emphasize the importance of correcting the instructions.</li><li><strong>2025-01-07</strong> - AWS confirms documentation updates are needed.</li><li><strong>2025-01-13 - 2025-01-17 -</strong> Discussion on how to revise the documentation.</li><li><strong>2025-01-28</strong> - AWS publishes updated documentation with security fixes.</li><li><strong>2025-04-28</strong> - Findings and resolution publicly shared in this blog post.</li></ul><h3>Wrapping up</h3><p>Throughout this blog series, we explored how trust policy risks can slip into even well-managed AWS environments - sometimes through overlooked technical details, subtle misconceptions, or even official tooling. Securing trust relationships is less about following a checklist and more about developing a deeper understanding of how trust mechanisms actually behave in real-world environments.</p><p>We hope this series helped shed light on some of the hidden challenges around trust policies. Thanks for reading!</p><p>‍</p><p>‍</p><p><em>Token Security&#39;s machine-first identity security platform detects trust policy risks, including risky cross-account trust policies, whether caused by AWS tooling, human error, or overlooked configurations.</em></p><p><em>Want to see how it works? </em><a href="https://www.token.security/book-a-demo"><strong><em>Book a demo</em></strong></a><em> and let us show you how we help organizations stay ahead of these risks.</em></p><p>‍</p></div></div>
  </body>
</html>
