<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ssloy.github.io/tinycompiler/">Original</a>
    <h1>TinyCompiler: A compiler in a week-end</h1>
    
    <div id="readability-page-1" class="page"><div data-md-component="container">
      
      
        
          
        
      
      <main data-md-component="main">
        <div>
          
            
              
              
            
            
              
              
            
          
          
            <div data-md-component="content">
              <article>
                
                  




<h2 id="introduction">Introduction</h2>
<p><img alt="" src="https://ssloy.github.io/tinycompiler/home/compiler.png"/></p>
<p>Have you ever wondered how a compiler works, but you never found courage to find out?
Then this series of articles is for you.
I have never had the chance to look under the hood either, but one week-end I have decided to to write a translator from the esoteric programming language <em>wend</em> (short for week-end),
which I just invented myself, into regular GNU assembly.
The goal is to keep the code as tiny as possible, 500-ish lines of python sounds great.
The main <a href="https://github.com/ssloy/tinycompiler">repository lives on github</a> (don&#39;t forget to check out other <a href="https://github.com/ssloy">tiny* repositories</a> in my profile).</p>
<p><strong>Spoiler alert:</strong> I am currently working on a <a href="https://github.com/ssloy/tinyoptimizer">tinyoptimizer</a>, a minimalist <strong>optimizing</strong> compiler.</p>
<p>So behold, here is a program that uses virtually all concepts in <em>wend</em>:</p>
<details>
<summary>Fixed-point square root</summary>
<div><table><tbody><tr><td></td><td><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span>main</span><span>()</span><span> </span><span>{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span>    </span><span>// square root of a fixed-point number</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span>    </span><span>// stored in a 32 bit integer variable, shift is the precision</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span>    </span><span>int</span><span> </span><span>sqrt</span><span>(</span><span>int</span><span> </span><span>n</span><span>,</span><span> </span><span>int</span><span> </span><span>shift</span><span>)</span><span> </span><span>{</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span>        </span><span>int</span><span> </span><span>x</span><span>;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span>        </span><span>int</span><span> </span><span>x_old</span><span>;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span>        </span><span>int</span><span> </span><span>n_one</span><span>;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span>        </span><span>if</span><span> </span><span>n</span><span> </span><span>&gt;</span><span> </span><span>2147483647</span><span>/</span><span>shift</span><span> </span><span>{</span><span> </span><span>// pay attention to potential overflows</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span>            </span><span>return</span><span> </span><span>2</span><span> </span><span>*</span><span> </span><span>sqrt</span><span>(</span><span>n</span><span> </span><span>/</span><span> </span><span>4</span><span>,</span><span> </span><span>shift</span><span>);</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span>        </span><span>}</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span>        </span><span>x</span><span> </span><span>=</span><span> </span><span>shift</span><span>;</span><span> </span><span>// initial guess 1.0, can do better, but oh well</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span>        </span><span>n_one</span><span> </span><span>=</span><span> </span><span>n</span><span> </span><span>*</span><span> </span><span>shift</span><span>;</span><span> </span><span>// need to compensate for fixp division</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span>        </span><span>while</span><span> </span><span>true</span><span> </span><span>{</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span>            </span><span>x_old</span><span> </span><span>=</span><span> </span><span>x</span><span>;</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span>            </span><span>x</span><span> </span><span>=</span><span> </span><span>(</span><span>x</span><span> </span><span>+</span><span> </span><span>n_one</span><span> </span><span>/</span><span> </span><span>x</span><span>)</span><span> </span><span>/</span><span> </span><span>2</span><span>;</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span>            </span><span>if</span><span> </span><span>abs</span><span>(</span><span>x</span><span> </span><span>-</span><span> </span><span>x_old</span><span>)</span><span> </span><span>&lt;=</span><span> </span><span>1</span><span> </span><span>{</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span>                </span><span>return</span><span> </span><span>x</span><span>;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span>            </span><span>}</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span>        </span><span>}</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span>    </span><span>}</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span>    </span><span>int</span><span> </span><span>abs</span><span>(</span><span>int</span><span> </span><span>x</span><span>)</span><span> </span><span>{</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span>        </span><span>if</span><span> </span><span>x</span><span> </span><span>&lt;</span><span> </span><span>0</span><span> </span><span>{</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span>            </span><span>return</span><span> </span><span>-</span><span>x</span><span>;</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span>        </span><span>}</span><span> </span><span>else</span><span> </span><span>{</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span>            </span><span>return</span><span> </span><span>x</span><span>;</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span>        </span><span>}</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span>    </span><span>}</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span>    </span><span>// 25735 is approximately equal to pi * 8192;</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span>    </span><span>// expected value of the output is sqrt(pi) * 8192 approx 14519</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span>    </span><span>println</span><span> </span><span>sqrt</span><span>(</span><span>25735</span><span>,</span><span> </span><span>8192</span><span>);</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span>}</span>
</span></code></pre></div></td></tr></tbody></table></div>
</details>
<p>Since I am interested in a compiler, the language being implemented is of no importance.
I am not trying to invent yet another C++ killer, that is not the point.
<em>Wend</em> is a simple language similar to C or Java, but with far less features.
<em>Wend</em> is strongly typed, with no pointers, arrays, closures, dynamic memory allocation, garbage collector or parallel computations.
It supports nested functions and function overloading, a bare minimum for the first dive into compiler theory.</p>
<p>By the way, I have spent a lot more time on writing test programs than on the compiler itself :)</p>
<h2 id="graphics">Graphics!</h2>
<p>It is so dull to compute Fibonacci numbers, so here are more eyecandy examples for the compiler, check <a href="https://github.com/ssloy/tinycompiler/tree/main/test-programs/gfx">test-programs/gfx/*.wend</a> files.</p>
<h3 id="mandelbrot-set">Mandelbrot set</h3>
<p><img src="https://ssloy.github.io/tinycompiler/home/mandelbrot.png" width="336"/></p>
<h3 id="zero-player-breakout-game">Zero-player breakout game</h3>
<!--
<video width="320" autoplay="" loop="" muted="" controls=""><source src="home/breakout.mp4" type="video/mp4"></source></video>
-->
<p><img alt="" src="https://ssloy.github.io/tinycompiler/home/breakout.gif"/></p>
<h3 id="fire">Fire</h3>
<!--
<video width="320" autoplay="" loop="" muted="" controls=""><source src="home/fire.mp4" type="video/mp4"></source></video>
-->
<p><img alt="" src="https://ssloy.github.io/tinycompiler/home/fire.gif"/></p>
<h3 id="sunset-race">Sunset race</h3>
<!--
<video width="320" autoplay="" loop="" muted="" controls=""><source src="home/sunset-race.mp4" type="video/mp4"></source></video>
-->
<p><img alt="" src="https://ssloy.github.io/tinycompiler/home/sunset-race.gif"/></p>







  
  



  




                
              </article>
            </div>
          
          

        </div>
        
      </main>
      
        
      
    </div></div>
  </body>
</html>
