<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://en.cppreference.com/w/cpp/language/attributes/likely">Original</a>
    <h1>C&#43;&#43; Attribute: Likely, Unlikely</h1>
    
    <div id="readability-page-1" class="page"><div id="mw-content-text" lang="en" dir="ltr">
<p>Allow the compiler to optimize for the case where paths of execution including that statement are more or less likely than any alternative path of execution that does not include such a statement.
</p>
<h3><span>[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/language/attributes/likely&amp;action=edit&amp;section=1" title="Edit section: Syntax">edit</a>]</span> <span id="Syntax">Syntax</span></h3>
<table>

<tbody><tr>
<td colspan="10">
</td></tr>
<tr>
<td> <code><b><span><span>[</span><span>[</span>likely<span>]</span><span>]</span></span></b></code>
</td>
<td> (1)
</td>
<td>
</td></tr>



<tr>
<td colspan="10">
</td></tr>
<tr>
<td> <code><b><span><span>[</span><span>[</span>unlikely<span>]</span><span>]</span></span></b></code>
</td>
<td> (2)
</td>
<td>
</td></tr>



<tr>
<td colspan="10">
</td></tr></tbody></table>
<h3><span>[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/language/attributes/likely&amp;action=edit&amp;section=2" title="Edit section: Explanation">edit</a>]</span> <span id="Explanation">Explanation</span></h3>
<p>These attributes may be applied to labels and statements (other than declaration-statements). They may not be simultaneously applied to the same label or statement.
</p>
<p><span>1)</span> Applies to a statement to allow the compiler to optimize for the case where paths of execution including that statement are more likely than any alternative path of execution that does not include such a statement.</p>
<p><span>2)</span> Applies to a statement to allow the compiler to optimize for the case where paths of execution including that statement are less likely than any alternative path of execution that does not include such a statement.</p>
<p>A path of execution is deemed to include a label if and only if it contains a jump to that label:
</p>
<div dir="ltr"><div><pre><span>int</span> f<span>(</span><span>int</span> i<span>)</span>
<span>{</span>
    <span>switch</span> <span>(</span>i<span>)</span>
    <span>{</span>
        <span>case</span> <span>1</span><span>:</span> <span>[</span><span>[</span>fallthrough<span>]</span><span>]</span><span>;</span>
        <span>[</span><span>[</span>likely<span>]</span><span>]</span> <span>case</span> <span>2</span><span>:</span> <span>return</span> <span>1</span><span>;</span>
    <span>}</span>
    <span>return</span> <span>2</span><span>;</span>
<span>}</span></pre></div></div>
<p><span><span>i <span>==</span> <span>2</span></span></span> is considered more likely than any other value of <code>i</code>, but the <code>[[<strong>likely</strong>]]</code> has no effect on the <span><span>i <span>==</span> <span>1</span></span></span> case even though it falls through the <span><span><span>case</span> <span>2</span><span>:</span></span></span> label.
</p>
<h3><span>[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/language/attributes/likely&amp;action=edit&amp;section=3" title="Edit section: Example">edit</a>]</span> <span id="Example">Example</span></h3>
<div>
<div dir="ltr"><div><pre><span>#include &lt;chrono&gt;</span>
<span>#include &lt;cmath&gt;</span>
<span>#include &lt;iomanip&gt;</span>
<span>#include &lt;iostream&gt;</span>
<span>#include &lt;random&gt;</span>
 
<span>namespace</span> with_attributes
<span>{</span>
    <span>constexpr</span> <span>double</span> pow<span>(</span><span>double</span> x, <span>long</span> <span>long</span> n<span>)</span> <span>noexcept</span>
    <span>{</span>
        <span>if</span> <span>(</span>n <span>&gt;</span> <span>0</span><span>)</span> <span>[</span><span>[</span>likely<span>]</span><span>]</span>
            <span>return</span> x <span>*</span> pow<span>(</span>x, n <span>-</span> <span>1</span><span>)</span><span>;</span>
        <span>else</span> <span>[</span><span>[</span>unlikely<span>]</span><span>]</span>
            <span>return</span> <span>1</span><span>;</span>
    <span>}</span>
    <span>constexpr</span> <span>long</span> <span>long</span> fact<span>(</span><span>long</span> <span>long</span> n<span>)</span> <span>noexcept</span>
    <span>{</span>
        <span>if</span> <span>(</span>n <span>&gt;</span> <span>1</span><span>)</span> <span>[</span><span>[</span>likely<span>]</span><span>]</span>
            <span>return</span> n <span>*</span> fact<span>(</span>n <span>-</span> <span>1</span><span>)</span><span>;</span>
        <span>else</span> <span>[</span><span>[</span>unlikely<span>]</span><span>]</span>
            <span>return</span> <span>1</span><span>;</span>
    <span>}</span>
    <span>constexpr</span> <span>double</span> cos<span>(</span><span>double</span> x<span>)</span> <span>noexcept</span>
    <span>{</span>
        <span>constexpr</span> <span>long</span> <span>long</span> precision<span>{</span>16LL<span>}</span><span>;</span>
        <span>double</span> y<span>{</span><span>}</span><span>;</span>
        <span>for</span> <span>(</span><span>auto</span> n<span>{</span>0LL<span>}</span><span>;</span> n <span>&lt;</span> precision<span>;</span> n <span>+</span><span>=</span> 2LL<span>)</span> <span>[</span><span>[</span>likely<span>]</span><span>]</span>
            y <span>+</span><span>=</span> pow<span>(</span>x, n<span>)</span> <span>/</span> <span>(</span>n <span>&amp;</span> 2LL <span>?</span> <span>-</span>fact<span>(</span>n<span>)</span> <span>:</span> fact<span>(</span>n<span>)</span><span>)</span><span>;</span>
        <span>return</span> y<span>;</span>
    <span>}</span>
<span>}</span> <span>// namespace with_attributes</span>
 
<span>namespace</span> no_attributes
<span>{</span>
    <span>constexpr</span> <span>double</span> pow<span>(</span><span>double</span> x, <span>long</span> <span>long</span> n<span>)</span> <span>noexcept</span>
    <span>{</span>
        <span>if</span> <span>(</span>n <span>&gt;</span> <span>0</span><span>)</span>
            <span>return</span> x <span>*</span> pow<span>(</span>x, n <span>-</span> <span>1</span><span>)</span><span>;</span>
        <span>else</span>
            <span>return</span> <span>1</span><span>;</span>
    <span>}</span>
    <span>constexpr</span> <span>long</span> <span>long</span> fact<span>(</span><span>long</span> <span>long</span> n<span>)</span> <span>noexcept</span>
    <span>{</span>
        <span>if</span> <span>(</span>n <span>&gt;</span> <span>1</span><span>)</span>
            <span>return</span> n <span>*</span> fact<span>(</span>n <span>-</span> <span>1</span><span>)</span><span>;</span>
        <span>else</span>
            <span>return</span> <span>1</span><span>;</span>
    <span>}</span>
    <span>constexpr</span> <span>double</span> cos<span>(</span><span>double</span> x<span>)</span> <span>noexcept</span>
    <span>{</span>
        <span>constexpr</span> <span>long</span> <span>long</span> precision<span>{</span>16LL<span>}</span><span>;</span>
        <span>double</span> y<span>{</span><span>}</span><span>;</span>
        <span>for</span> <span>(</span><span>auto</span> n<span>{</span>0LL<span>}</span><span>;</span> n <span>&lt;</span> precision<span>;</span> n <span>+</span><span>=</span> 2LL<span>)</span>
            y <span>+</span><span>=</span> pow<span>(</span>x, n<span>)</span> <span>/</span> <span>(</span>n <span>&amp;</span> 2LL <span>?</span> <span>-</span>fact<span>(</span>n<span>)</span> <span>:</span> fact<span>(</span>n<span>)</span><span>)</span><span>;</span>
        <span>return</span> y<span>;</span>
    <span>}</span>
<span>}</span> <span>// namespace no_attributes</span>
 
<span>double</span> gen_random<span>(</span><span>)</span> <span>noexcept</span>
<span>{</span>
    <span>static</span> <a href="http://en.cppreference.com/w/cpp/numeric/random/random_device"><span>std::<span>random_device</span></span></a> rd<span>;</span>
    <span>static</span> <a href="http://en.cppreference.com/w/cpp/numeric/random/mersenne_twister_engine"><span>std::<span>mt19937</span></span></a> gen<span>(</span>rd<span>(</span><span>)</span><span>)</span><span>;</span>
    <span>static</span> <a href="http://en.cppreference.com/w/cpp/numeric/random/uniform_real_distribution"><span>std::<span>uniform_real_distribution</span></span></a><span>&lt;</span><span>double</span><span>&gt;</span> dis<span>(</span><span>-</span><span>1.0</span>, <span>1.0</span><span>)</span><span>;</span>
    <span>return</span> dis<span>(</span>gen<span>)</span><span>;</span>
<span>}</span>
 
<span>volatile</span> <span>double</span> sink<span>{</span><span>}</span><span>;</span> <span>// ensures a side effect</span>
 
<span>int</span> main<span>(</span><span>)</span>
<span>{</span>
    <span>for</span> <span>(</span><span>const</span> <span>auto</span> x <span>:</span> <span>{</span><span>0.125</span>, <span>0.25</span>, <span>0.5</span>, <span>1</span>. <span>/</span> <span>(</span><span>1</span> <span>&lt;&lt;</span> <span>26</span><span>)</span><span>}</span><span>)</span>
        <a href="http://en.cppreference.com/w/cpp/io/cout"><span>std::<span>cout</span></span></a>
            <span>&lt;&lt;</span> <a href="http://en.cppreference.com/w/cpp/io/manip/setprecision"><span>std::<span>setprecision</span></span></a><span>(</span><span>53</span><span>)</span>
            <span>&lt;&lt;</span> <span>&#34;x = &#34;</span> <span>&lt;&lt;</span> x <span>&lt;&lt;</span> <span>&#39;<span>\n</span>&#39;</span>
            <span>&lt;&lt;</span> <a href="http://en.cppreference.com/w/cpp/numeric/math/cos"><span>std::<span>cos</span></span></a><span>(</span>x<span>)</span> <span>&lt;&lt;</span> <span>&#39;<span>\n</span>&#39;</span>
            <span>&lt;&lt;</span> with_attributes<span>::</span><span>cos</span><span>(</span>x<span>)</span> <span>&lt;&lt;</span> <span>&#39;<span>\n</span>&#39;</span>
            <span>&lt;&lt;</span> <span>(</span><a href="http://en.cppreference.com/w/cpp/numeric/math/cos"><span>std::<span>cos</span></span></a><span>(</span>x<span>)</span> <span>==</span> with_attributes<span>::</span><span>cos</span><span>(</span>x<span>)</span> <span>?</span> <span>&#34;equal&#34;</span> <span>:</span> <span>&#34;differ&#34;</span><span>)</span> <span>&lt;&lt;</span> <span>&#39;<span>\n</span>&#39;</span><span>;</span>
 
    <span>auto</span> benchmark <span>=</span> <span>[</span><span>]</span><span>(</span><span>auto</span> fun, <span>auto</span> rem<span>)</span>
    <span>{</span>
        <span>const</span> <span>auto</span> start <span>=</span> <a href="http://en.cppreference.com/w/cpp/chrono/high_resolution_clock/now"><span>std::<span>chrono</span><span>::</span><span>high_resolution_clock</span><span>::</span><span>now</span></span></a><span>(</span><span>)</span><span>;</span>
        <span>for</span> <span>(</span><span>auto</span> size<span>{</span>1ULL<span>}</span><span>;</span> size <span>!</span><span>=</span> <span>10</span><span>&#39;000&#39;</span>000ULL<span>;</span> <span>++</span>size<span>)</span>
            sink <span>=</span> fun<span>(</span>gen_random<span>(</span><span>)</span><span>)</span><span>;</span>
        <span>const</span> <a href="http://en.cppreference.com/w/cpp/chrono/duration"><span>std::<span>chrono</span><span>::</span><span>duration</span></span></a><span>&lt;</span><span>double</span><span>&gt;</span> diff <span>=</span>
            <a href="http://en.cppreference.com/w/cpp/chrono/high_resolution_clock/now"><span>std::<span>chrono</span><span>::</span><span>high_resolution_clock</span><span>::</span><span>now</span></span></a><span>(</span><span>)</span> <span>-</span> start<span>;</span>
        <a href="http://en.cppreference.com/w/cpp/io/cout"><span>std::<span>cout</span></span></a> <span>&lt;&lt;</span> <span>&#34;Time: &#34;</span> <span>&lt;&lt;</span> <a href="http://en.cppreference.com/w/cpp/io/manip/fixed"><span>std::<span>fixed</span></span></a> <span>&lt;&lt;</span> <a href="http://en.cppreference.com/w/cpp/io/manip/setprecision"><span>std::<span>setprecision</span></span></a><span>(</span><span>6</span><span>)</span> <span>&lt;&lt;</span> diff.<span>count</span><span>(</span><span>)</span>
                  <span>&lt;&lt;</span> <span>&#34; sec &#34;</span> <span>&lt;&lt;</span> rem <span>&lt;&lt;</span> <a href="http://en.cppreference.com/w/cpp/io/manip/endl"><span>std::<span>endl</span></span></a><span>;</span> 
    <span>}</span><span>;</span>
 
    benchmark<span>(</span>with_attributes<span>::</span><span>cos</span>, <span>&#34;(with attributes)&#34;</span><span>)</span><span>;</span>
    benchmark<span>(</span>no_attributes<span>::</span><span>cos</span>, <span>&#34;(without attributes)&#34;</span><span>)</span><span>;</span>
    benchmark<span>(</span><span>[</span><span>]</span><span>(</span><span>double</span> t<span>)</span> <span>{</span> <span>return</span> <a href="http://en.cppreference.com/w/cpp/numeric/math/cos"><span>std::<span>cos</span></span></a><span>(</span>t<span>)</span><span>;</span> <span>}</span>, <span>&#34;(std::cos)&#34;</span><span>)</span><span>;</span>
<span>}</span></pre></div></div>
<p>Possible output:
</p>
<div dir="ltr"><div><pre>x = 0.125
0.99219766722932900560039115589461289346218109130859375
0.99219766722932900560039115589461289346218109130859375
equal
x = 0.25
0.96891242171064473343022882545483298599720001220703125
0.96891242171064473343022882545483298599720001220703125
equal
x = 0.5
0.8775825618903727587394314468838274478912353515625
0.8775825618903727587394314468838274478912353515625
equal
x = 1.490116119384765625e-08
0.99999999999999988897769753748434595763683319091796875
0.99999999999999988897769753748434595763683319091796875
equal
Time: 0.579122 sec (with attributes)
Time: 0.722553 sec (without attributes)
Time: 0.425963 sec (std::cos)</pre></div></div> 
</div>

<!-- 
NewPP limit report
Preprocessor visited node count: 4090/1000000
Preprocessor generated node count: 7350/1000000
Post‐expand include size: 187008/2097152 bytes
Template argument size: 32964/2097152 bytes
Highest expansion depth: 16/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mwiki1-mwiki_en_:pcache:idhash:17861-0!*!0!!*!*!* and timestamp 20230930195156 -->
</div></div>
  </body>
</html>
