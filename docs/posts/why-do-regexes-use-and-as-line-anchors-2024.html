<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://buttondown.com/hillelwayne/archive/why-do-regexes-use-and-as-line-anchors/">Original</a>
    <h1>Why do regexes use `$` and `^` as line anchors? (2024)</h1>
    
    <div id="readability-page-1" class="page"><div>
            
            <date>
                
                March 25, 2024
                </date>
            
            
            
            <h2>
                A history that will satisfy nobody.
            </h2>
            

            

            
            
            <p>Next week is <a href="https://www.aprilcools.club/" target="_blank">April Cools</a>! A bunch of tech bloggers will be writing about a bunch of non-tech topics. If you&#39;ve got a blog come join us! You don&#39;t need to drive yourself crazy with a 3000-word hell essay, just write something fun and genuine and out of character for you.</p>
<p>But <em>I</em> am writing a 3000-word hell essay, so I&#39;ll keep this one short. Last week I fell into a bit of a rabbit hole: why do regular expressions use <code>$</code> and <code>^</code> as line anchors?<sup id="fnref:reason"><a href="#fn:reason">1</a></sup></p>
<p><a href="https://www.youtube.com/watch?v=S1pseKYYd4c" target="_blank">This talk</a> brings up that they first appeared in Ken Thompson&#39;s port of the QED text editor. In <a href="https://www.bell-labs.com/usr/dmr/www/qedman.pdf" target="_blank">his manual</a> he writes:</p>
<blockquote>
<p>b) &#34;^&#34; is a regular expression which matches
character at the beginning of a line.</p>
<p>c) &#34;$&#34; is a regular expression which matches
character before the character <code><nl></nl></code> (usually at the end of a line)</p>
</blockquote>
<p>QED was the precursor to ed, which was instrumental in popularizing regexes, so a lot of its design choices stuck.</p>
<p>Okay, but then <em>why</em> did Ken Thompson choose those characters?</p>
<p>I&#39;ll sideline <code>^</code> for now and focus on <code>$</code>. The original QED editor didn&#39;t have regular expressions. Its authors (Butler Lampson and Peter Deutsch) wrote <a href="https://dl.acm.org/doi/pdf/10.1145/363848.363863" target="_blank">an introduction</a> for the ACM. In it they write:</p>
<blockquote>
<p>Two minor devices offer additional convenience. The character &#34;.&#34; refers to the current line and the character &#34;$&#34; to the last line in the buffer. </p>
</blockquote>
<p>So <code>$</code> already meant &#34;the end of the buffer&#34;, and Ken adapted it to mean &#34;the end of the line&#34; in regexes.</p>
<p>Okay, but then why did Deutsch and Lampson use <code>$</code> for &#34;end of buffer&#34;?</p>

<h3>Things get tenuous</h3>
<p>The QED paper mentions they wrote it for the SDS-930 mainframe. Wikipedia <a href="https://en.wikipedia.org/wiki/SDS_930" target="_blank">claims</a> (<em>without references</em><sup id="fnref:history"><a href="#fn:history">2</a></sup>) that the SDS-930 used a Teletype Model 35 as input devices. The <em>only</em> information I can find about the model 35 is <a href="https://www.navy-radio.com/manuals/tty/35-brochure-1966.pdf" target="_blank">this sales brochure</a>, which has a blurry picture of the keyboard:</p>
<p><img alt="Blurry picture of a keyboard" src="https://assets.buttondown.email/images/1f684a60-30f4-400f-a283-cb3ecf432fdb.png?w=960&amp;fit=max"/> </p>
<p>I squinted at it really hard and saw that it&#39;s missing the <code>[]{}\|^_@~</code> symbols. Of the remaining symbols, <code>$</code> is by far the most &#34;useless&#34;: up until programming it <em>exclusively</em> meant &#34;dollars&#34;, whereas even something like <code>#</code> meant three different things. But also, <code>$</code> is so important in business that every typewriter has one. So it&#39;s a natural pick as the &#34;spare symbol&#34;.</p>
<p>Yes this is <em>really</em> tenuous and I&#39;m not happy with it, but it&#39;s the best answer I got.</p>
<p>If we&#39;re willing to stick with it, we can also use it to explain why Ken chose <code>^</code> to mean &#34;beginning of line&#34;. <code>^</code> isn&#39;t used in American English, and the only reason QED wasn&#39;t using it was because it wasn&#39;t on the Teletype Model 35. But Ken&#39;s keyboard did have <code>^</code>, even when it wasn&#39;t standardized at the time, so he was able to use it.</p>
<p>(<em>Why</em> did it have <code>^</code>? My best guess is that&#39;s because ASCII-67 included it as a diacritic and keyboards were <em>just</em> starting to include all of the ASCII characters. The Teletype 35 brochure says &#34;it follows ASCII&#34; but didn&#39;t include many of the symbols, just uses the encoding format.)</p>
<p>So there you have it, an explanation for the regex anchors that kinda makes sense. Remember, April Cools <a href="https://www.aprilcools.club/" target="_blank">next week</a>!</p>
<h3>Update 2025-01-21</h3>
<p>I see this is going around again (thank you, buttondown webmention emails), so I&#39;ll preemptively point out the big flaw with this whole analysis: <em>Thompson and Lampson are still alive and we can just ask them</em>. I just sent emails to both, I&#39;ll update this if I get an answer!</p>

            
            

            
            
            <p><em>If you&#39;re reading this on the web, you can subscribe <a href="https://buttondown.com/hillelwayne" target="_blank">here</a>. Updates are once a week. My main website is <a href="https://www.hillelwayne.com" target="_blank">here</a>.</em></p>
<p><em>My new book, </em>Logic for Programmers<em>, is now in early access! Get it <a href="https://leanpub.com/logic/" target="_blank">here</a>.</em></p>
            
            

        </div></div>
  </body>
</html>
