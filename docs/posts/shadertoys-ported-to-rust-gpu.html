<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rust-gpu.github.io/blog/2025/04/10/shadertoys/">Original</a>
    <h1>Shadertoys Ported to Rust GPU</h1>
    
    <div id="readability-page-1" class="page"><div id="__blog-post-container"><p>We ported a few popular <a href="https://www.shadertoy.com/" target="_blank" rel="noopener noreferrer">Shadertoy</a> shaders over to Rust
using <a href="https://github.com/Rust-GPU/rust-gpu/" target="_blank" rel="noopener noreferrer">Rust GPU</a>. The process was straightforward
and we want to share some highlights.</p>
<p>The code is available on <a href="https://github.com/Rust-GPU/rust-gpu-shadertoys" target="_blank" rel="noopener noreferrer">GitHub</a>.</p>
<p><img decoding="async" loading="lazy" alt="Shadertoy screenshot" src="https://rust-gpu.github.io/assets/images/shadertoys-4d4690ce8c1bc806b4241ff228891daf.jpg" width="2560" height="1572"/></p>
<h2 id="what-is-rust-gpu">What is Rust GPU?<a href="#what-is-rust-gpu" aria-label="Direct link to What is Rust GPU?" title="Direct link to What is Rust GPU?">​</a></h2>
<p><a href="https://rust-gpu.github.io/" target="_blank" rel="noopener noreferrer">Rust GPU</a> is a project that allows you to write code for
GPUs using the Rust programming language. GPUs are typically programmed using
specialized languages like <a href="https://www.w3.org/TR/WGSL/" target="_blank" rel="noopener noreferrer">WGSL</a>,
<a href="https://developer.mozilla.org/en-US/docs/Games/Techniques/3D_on_the_web/GLSL_Shaders" target="_blank" rel="noopener noreferrer">GLSL</a>,
<a href="https://developer.apple.com/documentation/metal/performing_calculations_on_a_gpu" target="_blank" rel="noopener noreferrer">MSL</a>,
or
<a href="https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl" target="_blank" rel="noopener noreferrer">HLSL</a>.
Rust GPU changes this by letting you use Rust to write GPU programs (often called
&#34;shaders&#34; or &#34;kernels&#34;).</p>
<p>These Rust GPU programs are then compiled into <a href="https://www.khronos.org/spir/" target="_blank" rel="noopener noreferrer">SPIR-V</a>,
a low-level format that <a href="https://vulkan.gpuinfo.org/" target="_blank" rel="noopener noreferrer">most GPUs understand</a>. Since
SPIR-V is the format <a href="https://www.vulkan.org/" target="_blank" rel="noopener noreferrer">Vulkan</a> uses, Rust GPU makes it possible
to integrate Rust-based GPU programs into any Vulkan-compatible workflow.</p>
<p>For more details, check out the <a href="http://rust-gpu.github.io/" target="_blank" rel="noopener noreferrer">Rust GPU website</a> or the
<a href="https://github.com/rust-gpu/rust-gpu" target="_blank" rel="noopener noreferrer">GitHub repository</a>.</p>

<p>Sharing data between the CPU and GPU is common in shader programming. This often
requires special tooling or manual effort. Using Rust on both sides made this seamless:</p>
<div><div><pre tabindex="0"><code><span><span>#[repr(C)]</span><span></span><br/></span><span><span></span><span>#[derive(Copy, Clone, Pod, Zeroable)]</span><span></span><br/></span><span><span></span><span>pub</span><span> </span><span>struct</span><span> </span><span>ShaderConstants</span><span> </span><span>{</span><span></span><br/></span><span><span>    </span><span>pub</span><span> width</span><span>:</span><span> </span><span>u32</span><span>,</span><span></span><br/></span><span><span>    </span><span>pub</span><span> height</span><span>:</span><span> </span><span>u32</span><span>,</span><span></span><br/></span><span><span>    </span><span>pub</span><span> time</span><span>:</span><span> </span><span>f32</span><span>,</span><span></span><br/></span><span><span>    </span><span>pub</span><span> cursor_x</span><span>:</span><span> </span><span>f32</span><span>,</span><span></span><br/></span><span><span>    </span><span>pub</span><span> cursor_y</span><span>:</span><span> </span><span>f32</span><span>,</span><span></span><br/></span><span><span>    </span><span>pub</span><span> drag_start_x</span><span>:</span><span> </span><span>f32</span><span>,</span><span></span><br/></span><span><span>    </span><span>pub</span><span> drag_start_y</span><span>:</span><span> </span><span>f32</span><span>,</span><span></span><br/></span><span><span>    </span><span>pub</span><span> drag_end_x</span><span>:</span><span> </span><span>f32</span><span>,</span><span></span><br/></span><span><span>    </span><span>pub</span><span> drag_end_y</span><span>:</span><span> </span><span>f32</span><span>,</span><span></span><br/></span><span><span>    </span><span>pub</span><span> mouse_left_pressed</span><span>:</span><span> </span><span>u32</span><span>,</span><span></span><br/></span><span><span>    </span><span>pub</span><span> mouse_left_clicked</span><span>:</span><span> </span><span>u32</span><span>,</span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div>
<p>Note that on both the CPU and the GPU we are using the
<a href="https://github.com/Lokathor/bytemuck" target="_blank" rel="noopener noreferrer"><code>bytemuck</code></a> crate for the <code>Pod</code> and <code>Zeroable</code>
derives. This crate is unmodified and integrated directly from
<a href="https://crates.io/crates/bytemuck" target="_blank" rel="noopener noreferrer">crates.io</a>. Many <code>no_std</code> + no <code>alloc</code> Rust crates
work on the GPU!</p>
<h2 id="traits-generics-and-macros">Traits, generics, and macros<a href="#traits-generics-and-macros" aria-label="Direct link to Traits, generics, and macros" title="Direct link to Traits, generics, and macros">​</a></h2>
<p>Rust GPU supports traits. We used traits to encapsulate shader-specific operations in
reusable ergonomic abstractions:</p>
<div><div><pre tabindex="0"><code><span><span>pub</span><span> </span><span>trait</span><span> </span><span>FloatExt</span><span> </span><span>{</span><span></span><br/></span><span><span>    </span><span>fn</span><span> </span><span>gl_fract</span><span>(</span><span>self</span><span>)</span><span> </span><span>-&gt;</span><span> </span><span>Self</span><span>;</span><span></span><br/></span><span><span>    </span><span>fn</span><span> </span><span>rem_euclid</span><span>(</span><span>self</span><span>,</span><span> rhs</span><span>:</span><span> </span><span>Self</span><span>)</span><span> </span><span>-&gt;</span><span> </span><span>Self</span><span>;</span><span></span><br/></span><span><span>    </span><span>fn</span><span> </span><span>gl_sign</span><span>(</span><span>self</span><span>)</span><span> </span><span>-&gt;</span><span> </span><span>Self</span><span>;</span><span></span><br/></span><span><span>    </span><span>fn</span><span> </span><span>deg_to_radians</span><span>(</span><span>self</span><span>)</span><span> </span><span>-&gt;</span><span> </span><span>Self</span><span>;</span><span></span><br/></span><span><span>    </span><span>fn</span><span> </span><span>step</span><span>(</span><span>self</span><span>,</span><span> x</span><span>:</span><span> </span><span>Self</span><span>)</span><span> </span><span>-&gt;</span><span> </span><span>Self</span><span>;</span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div>
<p>While there are still some rough edges, generics mostly work as expected. We used them
to support multiple channel types without duplicating logic:</p>
<div><div><pre tabindex="0"><code><span><span>pub</span><span> </span><span>struct</span><span> </span><span>State</span><span>&lt;</span><span>C0</span><span>,</span><span> </span><span>C1</span><span>&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>    inputs</span><span>:</span><span> </span><span>Inputs</span><span>&lt;</span><span>C0</span><span>,</span><span> </span><span>C1</span><span>&gt;</span><span>,</span><span></span><br/></span><span><span>    cam_point_at</span><span>:</span><span> </span><span>Vec3</span><span>,</span><span></span><br/></span><span><span>    cam_origin</span><span>:</span><span> </span><span>Vec3</span><span>,</span><span></span><br/></span><span><span>    time</span><span>:</span><span> </span><span>f32</span><span>,</span><span></span><br/></span><span><span>    ldir</span><span>:</span><span> </span><span>Vec3</span><span>,</span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div>
<p>Rust macros also function normally. Using macros allowed us to reduce repetitive code
further.</p>
<div><div><pre tabindex="0"><code><span><span>macro_rules!</span><span> deriv_impl </span><span>{</span><span></span><br/></span><span><span>    </span><span>(</span><span>$ty</span><span>:</span><span>ty</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>        </span><span>impl</span><span> </span><span>Derivative</span><span> </span><span>for</span><span> </span><span>$ty</span><span> </span><span>{</span><span></span><br/></span><span><span>            </span><span>deriv_fn!</span><span>(</span><span>ddx</span><span>,</span><span> </span><span>OpDPdx</span><span>,</span><span> </span><span>false</span><span>)</span><span>;</span><span></span><br/></span><span><span>            </span><span>deriv_fn!</span><span>(</span><span>ddx_fine</span><span>,</span><span> </span><span>OpDPdxFine</span><span>,</span><span> </span><span>true</span><span>)</span><span>;</span><span></span><br/></span><span><span>            </span><span>deriv_fn!</span><span>(</span><span>ddx_coarse</span><span>,</span><span> </span><span>OpDPdxCoarse</span><span>,</span><span> </span><span>true</span><span>)</span><span>;</span><span></span><br/></span><span><span>            </span><span>deriv_fn!</span><span>(</span><span>ddy</span><span>,</span><span> </span><span>OpDPdy</span><span>,</span><span> </span><span>false</span><span>)</span><span>;</span><span></span><br/></span><span><span>            </span><span>deriv_fn!</span><span>(</span><span>ddy_fine</span><span>,</span><span> </span><span>OpDPdyFine</span><span>,</span><span> </span><span>true</span><span>)</span><span>;</span><span></span><br/></span><span><span>            </span><span>deriv_fn!</span><span>(</span><span>ddy_coarse</span><span>,</span><span> </span><span>OpDPdyCoarse</span><span>,</span><span> </span><span>true</span><span>)</span><span>;</span><span></span><br/></span><span><span>            </span><span>deriv_fn!</span><span>(</span><span>fwidth</span><span>,</span><span> </span><span>OpFwidth</span><span>,</span><span> </span><span>false</span><span>)</span><span>;</span><span></span><br/></span><span><span>            </span><span>deriv_fn!</span><span>(</span><span>fwidth_fine</span><span>,</span><span> </span><span>OpFwidthFine</span><span>,</span><span> </span><span>true</span><span>)</span><span>;</span><span></span><br/></span><span><span>            </span><span>deriv_fn!</span><span>(</span><span>fwidth_coarse</span><span>,</span><span> </span><span>OpFwidthCoarse</span><span>,</span><span> </span><span>true</span><span>)</span><span>;</span><span></span><br/></span><span><span>        </span><span>}</span><span></span><br/></span><span><span>    </span><span>}</span><span>;</span><span></span><br/></span><span><span></span><span>}</span><span></span><br/></span><span><span></span><br/></span><span><span></span><span></span><br/></span><span><span></span><span>deriv_impl!</span><span>(</span><span>f32</span><span>)</span><span>;</span><span></span><br/></span><span><span></span><span>deriv_impl!</span><span>(</span><span>Vec2</span><span>)</span><span>;</span><span></span><br/></span><span><span></span><span>deriv_impl!</span><span>(</span><span>Vec3A</span><span>)</span><span>;</span><span></span><br/></span><span><span></span><span>deriv_impl!</span><span>(</span><span>Vec4</span><span>)</span><span>;</span><br/></span></code></pre></div></div>

<p>Want to typecheck the shaders? <code>cargo check</code>. Build them? <code>cargo build</code>. Run in release
mode? <code>cargo run --release</code>. Gate code at compile time? Use
<a href="https://doc.rust-lang.org/cargo/reference/features.html" target="_blank" rel="noopener noreferrer">features</a>.</p>
<p>If you run <code>clippy</code> on the shaders, you&#39;ll see it complains about many things as we
intentionally kept the Rust versions of shaders similar to their original GLSL versions.</p>
<p>This is one of Rust GPU&#39;s big advantages: you can use all the Rust tools you&#39;re already
familiar with.</p>
<h2 id="improving-the-rust-ecosystem">Improving the Rust ecosystem<a href="#improving-the-rust-ecosystem" aria-label="Direct link to Improving the Rust ecosystem" title="Direct link to Improving the Rust ecosystem">​</a></h2>
<p>While porting shaders, we also contributed back to the ecosystem by identifying and
fixing several issues in <a href="https://github.com/gfx-rs/wgpu" target="_blank" rel="noopener noreferrer"><code>wgpu</code> and <code>naga</code></a>:</p>
<ul>
<li><a href="https://github.com/gfx-rs/wgpu/pull/7397" target="_blank" rel="noopener noreferrer">Fixed a panic while processing SPIR-V</a></li>
<li><a href="https://github.com/gfx-rs/wgpu/pull/7437" target="_blank" rel="noopener noreferrer">Fixed incorrect translation of certain shader literals when targeting
Metal</a></li>
<li><a href="https://github.com/gfx-rs/wgpu/pull/7503" target="_blank" rel="noopener noreferrer">Fixed a regression making it impossible to include raw
SPIR-V</a></li>
</ul>
<p>These fixes help everyone using <code>wgpu</code> and <code>naga</code>, not just users of Rust GPU.</p>
<h2 id="come-join-us">Come join us!<a href="#come-join-us" aria-label="Direct link to Come join us!" title="Direct link to Come join us!">​</a></h2>
<p>While we hit some sharp edges, porting Shadertoy shaders to Rust with Rust GPU was
reasonably straightforward. Rust GPU is definitely ready for shader experimentation.</p>
<p>We&#39;re eager to add more users and contributors! We will be working on revamping the
onboarding and documentation soon. To follow along or get involved, check out the
<a href="https://github.com/rust-gpu/rust-gpu" target="_blank" rel="noopener noreferrer"><code>rust-gpu</code> repo on GitHub</a>.</p></div></div>
  </body>
</html>
