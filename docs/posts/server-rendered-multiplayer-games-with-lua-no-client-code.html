<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://cleoselene.com/">Original</a>
    <h1>Server-rendered multiplayer games with Lua (no client code)</h1>
    
    <div id="readability-page-1" class="page"><p>
        ‚ö†Ô∏è <strong>Active Development:</strong> Cleoselene is currently in an early preview stage. 
        Please reach out to <a href="mailto:help@cleoselene.com">help@cleoselene.com</a> 
        before using it for any serious projects or production work.
    </p><div>
        <div>
            <h3>üïπÔ∏è Multiplayer as Simplicity</h3>
            <p>Code multiplayer games as simple as single-player. No more worrying about client-server state sync or lag compensation. Just one loop, everywhere.</p>
        </div>
        <div>
            <h3>‚ö° Primitive Streaming</h3>
            <p>We stream <strong>drawing primitives</strong> instead of heavy pixels or complex state objects. It&#39;s faster than cloud gaming and lighter than traditional networking.</p>
        </div>
        <div>
            <h3>üöÄ High Performance</h3>
            <p>All performance-critical logic (Physics, Pathfinding) runs in <strong>Native Rust</strong>. Communication is powered by <strong>WebRTC</strong> for sub-frame latency.</p>
        </div>
        <div>
            <h3>üõ°Ô∏è Impossible to Cheat</h3>
            <p>Since the game is entirely <strong>server-rendered</strong>, the client has zero knowledge of the game state. No wallhacks, no aimbots, no compromise.</p>
        </div>
        <div>
            <h3>ü§´ Hide Your Secrets</h3>
            <p>Keep your game&#39;s internal logic and secrets safe. Since your script never leaves the server, players can&#39;t reverse-engineer your code or find hidden content.</p>
        </div>
        <div>
            <h3>üåç Host Anywhere</h3>
            <p>Total freedom. This version of the engine is <strong>free for personal or commercial use</strong> on your own infrastructure. No lock-in, no per-player fees.</p>
        </div>
    </div><div>
<p>A Multiplayer-First Server-Rendered Game Engine with Lua Scripting.</p>
<h2>Game Structure</h2>
<p>A minimal game script (<code>main.lua</code>) must implement these callbacks:</p>
<pre><code>-- Called once when the server starts
function init()
    -- Initialize physics, load assets, setup state
    db = api.new_spatial_db(250)
    phys = api.new_physics_world(db)
    api.load_sound(&#34;jump&#34;, &#34;assets/jump.wav&#34;)
end

-- Called every server frame (typically 30 TPS)
function update(dt)
    -- Advance physics simulation
    phys:step(dt)

    -- Handle collisions
    local events = phys:get_collision_events()
    for _, pair in ipairs(events) do
        -- Handle game logic (damage, score)
    end
end

-- Called for EACH connected client to generate their frame
function draw(session_id)
    api.clear_screen(20, 20, 30)

    -- Draw player-specific view (camera, HUD)
    local p = players[session_id]
    if p then
        api.set_color(255, 255, 255)
        api.draw_text(&#34;HP: &#34; .. p.hp, 10, 10)
        -- Use db:query_rect to draw visible entities
    end
end

-- Network Events
function on_connect(session_id)
    print(&#34;Player joined: &#34; .. session_id)
    -- Spawn player entity
end

function on_disconnect(session_id)
    print(&#34;Player left: &#34; .. session_id)
    -- Despawn entity
end

function on_input(session_id, key_code, is_down)
    -- Handle input (key_code is JS key code)
    -- 37=Left, 38=Up, 39=Right, 40=Down, 32=Space, 90=Z
    if players[session_id] then
        players[session_id].inputs[key_code] = is_down
    end
end
</code></pre>
<h2>API Reference</h2>
<h3>Display &amp; Coordinates</h3>
<p>The engine uses a fixed virtual coordinate system of <strong>800x600</strong>. All drawing commands (<code>api.fill_rect</code>, <code>api.draw_line</code>, etc.) use these coordinates. The engine automatically scales the output to fit the user&#39;s screen while maintaining the logical resolution and aspect ratio.</p>
<h3>Graphics &amp; Sound</h3>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>api.clear_screen(r, g, b)</code></td>
<td>Clears the frame with a background color.</td>
</tr>
<tr>
<td><code>api.set_color(r, g, b, [a])</code></td>
<td>Sets the current drawing color.</td>
</tr>
<tr>
<td><code>api.fill_rect(x, y, w, h)</code></td>
<td>Draws a filled rectangle.</td>
</tr>
<tr>
<td><code>api.draw_line(x1, y1, x2, y2, [width])</code></td>
<td>Draws a line.</td>
</tr>
<tr>
<td><code>api.draw_text(text, x, y)</code></td>
<td>Draws text at position.</td>
</tr>
<tr>
<td><code>api.load_sound(name, url)</code></td>
<td>Preloads a sound from a URL/path (relative to script).</td>
</tr>
<tr>
<td><code>api.play_sound(name, [loop])</code></td>
<td>Plays a loaded sound.</td>
</tr>
<tr>
<td><code>api.stop_sound(name)</code></td>
<td>Stops a sound.</td>
</tr>
<tr>
<td><code>api.set_volume(name, volume)</code></td>
<td>Sets volume (0.0 to 1.0).</td>
</tr>
</tbody>
</table>
<h3>Spatial DB (Geometry)</h3>
<p>The engine provides a high-performance Spatial Hash Grid for broadphase queries.</p>
<h4>Creation</h4>
<pre><code>local db = api.new_spatial_db(cell_size) -- e.g., 250
</code></pre>
<h4>Object Management</h4>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
<th>Returns</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>db:add_circle(x, y, radius, tag)</code></td>
<td>Registers a circular entity.</td>
<td><code>id</code> (int)</td>
</tr>
<tr>
<td><code>db:add_segment(x1, y1, x2, y2, tag)</code></td>
<td>Registers a line segment (wall).</td>
<td><code>id</code> (int)</td>
</tr>
<tr>
<td><code>db:remove(id)</code></td>
<td>Removes an entity from the DB.</td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>db:update(id, x, y)</code></td>
<td>Manually updates position (teleport).</td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>db:get_position(id)</code></td>
<td>Returns <code>x, y</code> of the entity.</td>
<td><code>x, y</code></td>
</tr>
</tbody>
</table>
<h4>Queries (Sensors)</h4>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
<th>Returns</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>db:query_range(x, y, r, [tag])</code></td>
<td>Finds entity IDs within radius <code>r</code>.</td>
<td><code>{id1, id2...}</code></td>
</tr>
<tr>
<td><code>db:query_rect(x1, y1, x2, y2, [tag])</code></td>
<td>Finds entity IDs within AABB (Culling).</td>
<td><code>{id1, id2...}</code></td>
</tr>
<tr>
<td><code>db:cast_ray(x, y, angle, dist, [tag])</code></td>
<td>Casts a ray.</td>
<td><code>id, frac, hit_x, hit_y</code> or <code>nil</code></td>
</tr>
</tbody>
</table>
<h3>Physics Engine (Simulation)</h3>
<p>Handles rigid body dynamics, integration, and collision resolution.</p>
<h4>Creation</h4>
<pre><code>local phys = api.new_physics_world(db)
</code></pre>
<h4>Body Management</h4>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>phys:add_body(id, props)</code></td>
<td>Adds physics to an entity. Props: <code>{mass=1.0, restitution=0.5, drag=0.0}</code>.</td>
</tr>
<tr>
<td><code>phys:set_velocity(id, vx, vy)</code></td>
<td>Sets velocity.</td>
</tr>
<tr>
<td><code>phys:get_velocity(id)</code></td>
<td>Returns <code>vx, vy</code>.</td>
</tr>
<tr>
<td><code>phys:set_gravity(x, y)</code></td>
<td>Sets global gravity vector.</td>
</tr>
<tr>
<td><code>phys:step(dt)</code></td>
<td>Advances simulation. Resolves collisions and updates <code>db</code>.</td>
</tr>
<tr>
<td><code>phys:get_collision_events()</code></td>
<td>Returns list of collisions since last step: <code>{{idA, idB}, ...}</code>.</td>
</tr>
</tbody>
</table>
<h3>Graph Navigation (Pathfinding)</h3>
<p>Native A* implementation on a custom graph.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>nav = api.new_graph()</code></td>
<td>Creates a new navigation graph.</td>
</tr>
<tr>
<td><code>nav:add_node(id, x, y)</code></td>
<td>Adds a node to the graph.</td>
</tr>
<tr>
<td><code>nav:add_edge(u, v)</code></td>
<td>Adds an edge (connection) between nodes.</td>
</tr>
<tr>
<td><code>nav:find_path(start, end)</code></td>
<td>Returns a list of node IDs forming the shortest path.</td>
</tr>
</tbody>
</table></div></div>
  </body>
</html>
