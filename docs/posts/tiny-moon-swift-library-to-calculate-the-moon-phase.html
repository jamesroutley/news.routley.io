<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/mannylopez/TinyMoon">Original</a>
    <h1>Show HN: Tiny Moon â€“ Swift library to calculate the moon phase</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><a href="https://swiftpackageindex.com/mannylopez/TinyMoon" rel="nofollow"><img src="https://camo.githubusercontent.com/99f7e26312727fc3943c3d02b1de928262a0b2016a7583a1272d0b1c217af9d9/68747470733a2f2f696d672e736869656c64732e696f2f656e64706f696e743f75726c3d687474707325334125324625324673776966747061636b616765696e6465782e636f6d2532466170692532467061636b616765732532466d616e6e796c6f70657a25324654696e794d6f6f6e25324662616467652533467479706525334473776966742d76657273696f6e73" alt="" data-canonical-src="https://img.shields.io/endpoint?url=https%3A%2F%2Fswiftpackageindex.com%2Fapi%2Fpackages%2Fmannylopez%2FTinyMoon%2Fbadge%3Ftype%3Dswift-versions"/></a>
<a href="https://swiftpackageindex.com/mannylopez/TinyMoon" rel="nofollow"><img src="https://camo.githubusercontent.com/176a100935ad769a34211c5d174e15ba1c6e2e6122145d7b79fa6c857cb3a87c/68747470733a2f2f696d672e736869656c64732e696f2f656e64706f696e743f75726c3d687474707325334125324625324673776966747061636b616765696e6465782e636f6d2532466170692532467061636b616765732532466d616e6e796c6f70657a25324654696e794d6f6f6e253246626164676525334674797065253344706c6174666f726d73" alt="" data-canonical-src="https://img.shields.io/endpoint?url=https%3A%2F%2Fswiftpackageindex.com%2Fapi%2Fpackages%2Fmannylopez%2FTinyMoon%2Fbadge%3Ftype%3Dplatforms"/></a>
<a href="https://swift.org/package-manager" rel="nofollow"><img src="https://camo.githubusercontent.com/121c6b1e834d014c65b40ac526be59356f3e31a731cb7f24166cb5a28cf330c4/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f53504d2d636f6d70617469626c652d627269676874677265656e2e737667" alt="Swift Package Manager" data-canonical-src="https://img.shields.io/badge/SPM-compatible-brightgreen.svg"/></a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/mannylopez/TinyMoon/blob/main/images/TinyMoonTransparent_256x256.png"><img src="https://github.com/mannylopez/TinyMoon/raw/main/images/TinyMoonTransparent_256x256.png" alt="Tiny Moon icon"/></a></p>

<p dir="auto">A tiny Swift library to calculate the moon phase for any given date, works super fast, and works completely offline.</p>
<p dir="auto">Compatible with iOS and MacOS.</p>

<div dir="auto" data-snippet-clipboard-copy-content="// Get the moon phase for right now
let moon = TinyMoon.calculateMoonPhase()"><pre><span>// Get the moon phase for right now</span>
<span>let</span> <span>moon</span> <span>=</span> <span>TinyMoon</span><span>.</span><span>calculateMoonPhase</span><span>(</span><span>)</span></pre></div>

<ol dir="auto">
<li>Open your existing Xcode project or create a new one</li>
<li>Open the Swift Packages Manager
<ul dir="auto">
<li>In the project navigator, select your project file to open the project settings.</li>
<li>Navigate to the the <strong>Package Dependencies</strong> tab</li>
</ul>
</li>
<li>Add the Tiny Moon Package
<ul dir="auto">
<li>Click the <strong>+</strong> button at the bottom of the tab</li>
<li>In the dialog box that appears, enter the URL for Tiny Moon: <code>https://github.com/mannylopez/TinyMoon.git</code></li>
</ul>
</li>
<li>Specify version rules
<ul dir="auto">
<li>Xcode will prompt you to specify version rules for the package. &#34;Up to Next Major Version&#34; ensures compatibility with future updates that don&#39;t introduce breaking changes.</li>
<li>Click <strong>Add Package</strong></li>
</ul>
</li>
</ol>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/mannylopez/TinyMoon/blob/main/images/XcodePackageDialogBox.png"><img src="https://github.com/mannylopez/TinyMoon/raw/main/images/XcodePackageDialogBox.png" alt="Xcode package dialog box"/></a></p>

<p dir="auto">Now that Tiny Moon is added to your project, import it and simply pass in the the <code>Date</code> and <code>TimeZone</code> for which you&#39;d like to know the Moon phase for. If no date is passed in, then your system&#39;s current <code>Date</code> will be used.</p>
<p dir="auto"><em>An example app using Tiny Moon</em></p>
<div dir="auto" data-snippet-clipboard-copy-content="import SwiftUI
import TinyMoon

struct SimpleMoonView: View {

  private let moon = TinyMoon.calculateMoonPhase()

  var body: some View {
    VStack(spacing: 16) {
      Text(moon.date.toString())
      Text(moon.emoji)
      Text(moon.name)
      Text(&#34;Illumination: \(moon.illuminatedFraction)&#34;)
      Text(&#34;\(moon.ageOfMoon.days) days, \(moon.ageOfMoon.hours) hours, \(moon.ageOfMoon.minutes) minutes&#34;)
      Text(&#34;Full Moon in \(moon.daysTillFullMoon) days&#34;)
      Text(&#34;New Moon in \(moon.daysTillNewMoon) days&#34;)
    }
  }
}

#Preview {
  SimpleMoonView()
}"><pre>import SwiftUI
import TinyMoon

<span>struct</span> <span>SimpleMoonView</span><span>:</span> <span>View</span> <span>{</span>

  <span>private</span> <span>let</span> <span><span>moon</span></span> <span>=</span> <span>TinyMoon</span><span>.</span><span>calculateMoonPhase</span><span>(</span><span>)</span>

  <span>var</span> <span><span>body</span></span><span>:</span> <span>some</span> <span>View</span> <span>{</span>
    <span>VStack</span><span>(</span>spacing<span>:</span> <span>16</span><span>)</span> <span>{</span>
      <span>Text</span><span>(</span>moon<span>.</span>date<span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span>
      <span>Text</span><span>(</span>moon<span>.</span>emoji<span>)</span>
      <span>Text</span><span>(</span>moon<span>.</span>name<span>)</span>
      <span>Text</span><span>(</span><span>&#34;</span><span>Illumination: </span><span>\(</span>moon<span>.</span>illuminatedFraction<span>)</span><span>&#34;</span><span>)</span>
      <span>Text</span><span>(</span><span>&#34;</span><span>\(</span>moon<span>.</span>ageOfMoon<span>.</span>days<span>)</span><span> days, </span><span>\(</span>moon<span>.</span>ageOfMoon<span>.</span>hours<span>)</span><span> hours, </span><span>\(</span>moon<span>.</span>ageOfMoon<span>.</span>minutes<span>)</span><span> minutes</span><span>&#34;</span><span>)</span>
      <span>Text</span><span>(</span><span>&#34;</span><span>Full Moon in </span><span>\(</span>moon<span>.</span>daysTillFullMoon<span>)</span><span> days</span><span>&#34;</span><span>)</span>
      <span>Text</span><span>(</span><span>&#34;</span><span>New Moon in </span><span>\(</span>moon<span>.</span>daysTillNewMoon<span>)</span><span> days</span><span>&#34;</span><span>)</span>
    <span>}</span>
  <span>}</span>
<span>}</span>

#Preview <span>{</span>
  <span>SimpleMoonView</span><span>(</span><span>)</span>
<span>}</span></pre></div>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/mannylopez/TinyMoon/blob/main/images/SimpleMoon.png"><img src="https://github.com/mannylopez/TinyMoon/raw/main/images/SimpleMoon.png" alt="Simple Moon View"/></a></p>


<p dir="auto">The main entry point into the library is the <a href="https://github.com/mannylopez/TinyMoon/blob/main/Sources/TinyMoon/TinyMoon.swift"><code>TinyMoon</code></a> name space.</p>
<p dir="auto">From there, you can access func&#39;s <code>calculateMoonPhase</code> and <code>calculateExactMoonPhase</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="public enum TinyMoon {
  public static func calculateMoonPhase(
    _ date: Date = Date(),
    timeZone: TimeZone = TimeZone.current)
    -&gt; Moon
  {
    Moon(date: date, timeZone: timeZone)
  }

  public static func calculateExactMoonPhase(_ date: Date = Date()) -&gt; ExactMoon {
    ExactMoon(date: date)
  }
}
"><pre><span>public</span> <span>enum</span> <span>TinyMoon</span> <span>{</span>
  <span>public</span> <span>static</span> <span>func</span> calculateMoonPhase<span>(</span>
    _ date<span>:</span> <span>Date</span> <span>=</span> <span>Date</span><span>(</span><span>)</span><span>,</span>
    timeZone<span>:</span> <span>TimeZone</span> <span>=</span> <span>TimeZone</span><span>.</span>current<span>)</span>
    <span>-&gt;</span> <span>Moon</span>
  <span>{</span>
    <span>Moon</span><span>(</span>date<span>:</span> date<span>,</span> timeZone<span>:</span> timeZone<span>)</span>
  <span>}</span>

  <span>public</span> <span>static</span> <span>func</span> calculateExactMoonPhase<span>(</span>_ date<span>:</span> <span>Date</span> <span>=</span> <span>Date</span><span>(</span><span>)</span><span>)</span> <span>-&gt;</span> <span>ExactMoon</span> <span>{</span>
    <span>ExactMoon</span><span>(</span>date<span>:</span> date<span>)</span>
  <span>}</span>
<span>}</span></pre></div>

<p dir="auto">The <code>Moon</code> object prioritizes the major phases (new moon, first quarter, full moon, last quarter) if it happens to land within a specific day.</p>
<p dir="auto">The <code>ExactMoon</code> object always returns the exact values for the specific date and time passed in.</p>
<p dir="auto">For example, given that the full moon occurs on <code>August 19, 2024 at 13:25 UTC</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="import Foundation

// The Date we will query for is August 19, 2024 at 02:00 UTC
let isoFormatter = ISO8601DateFormatter()
isoFormatter.timeZone = TimeZone(secondsFromGMT: 0)
let date = isoFormatter.date(from: &#34;2024-08-19T02:00:00Z&#34;)!

let moon = TinyMoon.calculateMoonPhase(date, timeZone: isoFormatter.timeZone) // If you don&#39;t specify a TimeZone, it will default to the system&#39;s TimeZone
print(moon.name)	// Full Moon
print(moon.emoji)	// ðŸŒ•

let exactMoon = TinyMoon.calculateExactMoonPhase(date)
print(moon.name)	// Waxing Gibbous
print(moon.emoji)	// ðŸŒ”"><pre>import Foundation

<span>// The Date we will query for is August 19, 2024 at 02:00 UTC</span>
<span>let</span> <span>isoFormatter</span> <span>=</span> <span>ISO8601DateFormatter</span><span>(</span><span>)</span>
isoFormatter<span>.</span>timeZone <span>=</span> <span>TimeZone</span><span>(</span>secondsFromGMT<span>:</span> <span>0</span><span>)</span>
<span>let</span> <span>date</span> <span>=</span> isoFormatter<span>.</span><span>date</span><span>(</span>from<span>:</span> <span>&#34;</span><span>2024-08-19T02:00:00Z</span><span>&#34;</span><span>)</span>!

<span>let</span> <span>moon</span> <span>=</span> <span>TinyMoon</span><span>.</span><span>calculateMoonPhase</span><span>(</span>date<span>,</span> timeZone<span>:</span> isoFormatter<span>.</span>timeZone<span>)</span> <span>// If you don&#39;t specify a TimeZone, it will default to the system&#39;s TimeZone</span>
<span>print</span><span>(</span>moon<span>.</span>name<span>)</span>	<span>// Full Moon</span>
<span>print</span><span>(</span>moon<span>.</span>emoji<span>)</span>	<span>// ðŸŒ•</span>

<span>let</span> <span>exactMoon</span> <span>=</span> <span>TinyMoon</span><span>.</span><span>calculateExactMoonPhase</span><span>(</span>date<span>)</span>
<span>print</span><span>(</span>moon<span>.</span>name<span>)</span>	<span>// Waxing Gibbous</span>
<span>print</span><span>(</span>moon<span>.</span>emoji<span>)</span>	<span>// ðŸŒ”</span></pre></div>
<p dir="auto"><code>ExactMoon</code> will return <code>.waxingGibbous</code> because that is a more accurate representation of the moon phase at <code>02:00 UTC</code> time. <code>Moon</code> will return <code>.fullMoon</code> since a Full Moon happens during that day.</p>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>moonPhase</td>
<td>MoonPhase</td>
<td>Enum with all 8 moon phases</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>String representation of MoonPhase case</td>
</tr>
<tr>
<td>emoji</td>
<td>String</td>
<td>Emoji for moon phase</td>
</tr>
<tr>
<td>date</td>
<td>Date</td>
<td>Date passed in for the Moon object</td>
</tr>
<tr>
<td>julianDay</td>
<td>Double</td>
<td>Continuous count of day since the beginning of Julian period. Used in astronomical calculations (<a href="https://en.wikipedia.org/wiki/Julian_day" rel="nofollow">wikipedia</a>)</td>
</tr>
<tr>
<td>daysTillFullMoon</td>
<td>Int</td>
<td>Returns <code>0</code> if the current <code>date</code> is a full moon</td>
</tr>
<tr>
<td>daysTillNewMoon</td>
<td>Int</td>
<td>Returns <code>0</code> if the current <code>date</code> is a new moon</td>
</tr>
<tr>
<td>daysElapsedInCycle</td>
<td>Double</td>
<td>Number of days elapsed into the synodic cycle, represented as a fraction</td>
</tr>
<tr>
<td>ageOfMoon</td>
<td>(days: Int, hours: Int, minutes: Int)</td>
<td>Age of the moon in days, minutes, hours</td>
</tr>
<tr>
<td>illuminatedFraction</td>
<td>Double</td>
<td>Illuminated portion of the Moon, where 0.0 = new and 1.00 = full</td>
</tr>
<tr>
<td>phaseFraction</td>
<td>Double</td>
<td>Phase of the Moon, represented as a fraction. See table below.</td>
</tr>
<tr>
<td>distanceFromCenterOfEarth</td>
<td>Double</td>
<td>Distance of moon from the center of the Earth, in kilometers</td>
</tr>
<tr>
<td>fullMoonName</td>
<td>String?</td>
<td>Returns the coloquial full moon name</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">Values for <code>phaseFraction</code> and corresponding emoji</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>phaseFraction</th>
<th>Name</th>
<th>Emoji</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.0</td>
<td>New Moon</td>
<td>ðŸŒ‘</td>
</tr>
<tr>
<td></td>
<td>Waxing Crescent</td>
<td>ðŸŒ’</td>
</tr>
<tr>
<td>0.25</td>
<td>First Quarter</td>
<td>ðŸŒ“</td>
</tr>
<tr>
<td></td>
<td>Waxing Gibbous</td>
<td>ðŸŒ”</td>
</tr>
<tr>
<td>0.5</td>
<td>Full Moon</td>
<td>ðŸŒ•</td>
</tr>
<tr>
<td></td>
<td>Waning Gibbous</td>
<td>ðŸŒ–</td>
</tr>
<tr>
<td>0.75</td>
<td>Last Quarter</td>
<td>ðŸŒ—</td>
</tr>
<tr>
<td></td>
<td>Waning Crescent</td>
<td>ðŸŒ˜</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<p dir="auto">The following are built with this Tiny Moon Swift Package</p>

<p dir="auto">A MacOS app (available in the <a href="https://apps.apple.com/us/app/tiny-moon/id6502374344" rel="nofollow">App Store</a>) that displays the current moon phase as an emoji in your toolbar.</p>
<p dir="auto">Source code: <a href="https://github.com/mannylopez/TinyMoonApp">https://github.com/mannylopez/TinyMoonApp</a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/mannylopez/TinyMoon/blob/main/images/AppScreenshot_1280x800_toolbar.png"><img src="https://github.com/mannylopez/TinyMoon/raw/main/images/AppScreenshot_1280x800_toolbar.png" alt="Toolbar"/></a>
<a target="_blank" rel="noopener noreferrer" href="https://github.com/mannylopez/TinyMoon/blob/main/images/AppScreenshot_1280x800_DarkMode.png"><img src="https://github.com/mannylopez/TinyMoon/raw/main/images/AppScreenshot_1280x800_DarkMode.png" alt="Detail view"/></a></p>

<p dir="auto">A simple iOS app to showcase how to use Tiny Moon Swift Package</p>
<p dir="auto">Source code: <a href="https://github.com/mannylopez/TinyMoonMobile">https://github.com/mannylopez/TinyMoonMobile</a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/mannylopez/TinyMoon/blob/main/images/MobileApp.png"><img src="https://github.com/mannylopez/TinyMoon/raw/main/images/MobileApp.png" alt="Mobile app"/></a></p>

<p dir="auto">Big thank you to <a href="https://github.com/mourner/suncalc">suncalc</a>, a tiny JavaScript for calculating the moon position and lunar phase for the given time (sun position and sunlight phases as well). It helped me understand the underlying formulas needed for calculating the moon phase.</p>
<p dir="auto">Great resources I found via suncalc include, but are not limited to:</p>
<ul dir="auto">
<li><a href="https://aa.quae.nl/en/reken/hemelpositie.html" rel="nofollow">Astronomy Answers Positions in the Sky</a></li>
<li>NASA&#39;s <a href="https://github.com/wlandsman/IDLAstro/blob/master/pro/mphase.pro">IDL Astronomy User&#39;s Library</a></li>
</ul>
<p dir="auto">A big big thank you to John Walker who wrote <a href="https://www.fourmilab.ch/moontoolw/" rel="nofollow">Moontool for Windows</a> and released the C source code into the public domain. This is where the main formula for calculating the moon phase comes from, and I&#39;ve found it to be extremely accurate.</p>
</article></div></div>
  </body>
</html>
