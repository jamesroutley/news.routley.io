<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://earthly.dev/blog/earthly-v0-6/">Original</a>
    <h1>Show HN: Earthly v0.6</h1>
    
    <div id="readability-page-1" class="page"><section itemprop="text">
        
        <header>
          
          

  <p>
    

    

    
      
      

      <span>
        <i aria-hidden="true"></i>
        
          6 minute read
        
        
         	 <i aria-hidden="true"></i> Updated: <time datetime="2021-12-02T00:00:00-05:00">December 2, 2021</time>
        

      </span>
    
    <span>
      
      
      
      </span></p>
      
    
  


        </header>
      
        
        <p>We are pleased to announce the release of <a href="https://github.com/earthly/earthly/releases/tag/v0.6.0">Earthly v0.6</a> - our 80th release to date! This version promotes a number of features from Experimental, or Beta status, to GA. What this means practically is that they are now enabled by default, their API is now finalized, and they have been tested thoroughly.</p>
<h2 id="repeatability">Repeatability</h2>
<p>At Earthly we’re on a mission to build the standard foundational build layer for automation to be run upon.</p>
<figure>
<img src="https://earthly.dev/blog/assets/images/earthly-v0-6/earthly-foundational-layer.png" alt=""/><figcaption>Earthly is the standard foundational build layer</figcaption>
</figure>
<p>The #1 reason people use Earthly today is to be able to reproduce CI builds locally. Earthly helps create a consistency layer, providing a level of guarantee that the build will run the same on your machine as on your colleagues machine, and as in CI. We call this consistency <strong>repeatability</strong> (note that this is distinct from reproducibility as full determinism is not guaranteed).</p>
<p>This helps avoid cases where tweaks to the CI script take long interaction cycles to test (<code>git commit -m &#34;try again...&#34;</code> anyone?), but it also prevents CI vendor lock-in, as Earthly also helps with maintaining consistency between different CI vendors too.</p>
<h2 id="standardization">Standardization</h2>
<p>Another reason people use Earthly today is because they want builds to be <strong>standardized</strong> across multiple projects. They want to put together a sort of template that allows any engineer from any team to be able to immediately execute the builds of a project they are unfamiliar with.</p>
<p>Running <code>earthly +test</code> always runs the unit tests. Running <code>earthly +lint</code> always runs the linter. Running <code>earthly +docker</code> always builds the image used in production. And so on…</p>
<p>This helps bring down cross-team collaboration barriers and allows for a familiar interface wherever you are in the company’s codebase.</p>
<p>What’s more, Earthly is able to create references across directories and across repositories. Many users leverage Earthly as a bridge between builds of different programming languages. If you need to work with artifacts or container images from varying ecosystems, like JS (NPM, Yarn etc), Java (Maven, Gradle etc), Python (Pip etc), Ruby (Bundler etc) or any other language, you can use Earthly to link these otherwise disconnected worlds.</p>
<p>Beyond that, there may be company-specific ways of doing things. Like tagging the docker images needs to respect a certain format. This is another key use-case that many users accomplish through Earthly.</p>
<h2 id="how-earthly-v0.6-helps">How Earthly V0.6 Helps</h2>
<h3 id="with-docker">WITH DOCKER</h3>
<p>Supporting all of the use-cases of a CI, while being based on containers yourself can have pros and cons. The typical container-based CI, for example, does not allow you to run containers within their container, or if it does, they are limited in functionality (e.g. mounting volumes not being available), or don’t support Docker Compose or Kubernetes well. This makes integration testing a nightmare.</p>
<p>With Earthly v0.6 and the newly GA’d feature <code>WITH DOCKER</code>, Earthly can execute any number of containers in parallel, via an isolated Docker daemon that it starts up within. Because the daemon is local, the user can freely use any local volume mount. What’s more, as the daemon is ephemeral, it is not influenced by previous runs in any way, like a previously leftover image, volume or network configuration. Through this feature, Earthly brings the best of both worlds: a containerized build that can also execute containers within it without any compromises.</p>
<p><code>WITH DOCKER</code> also has builtin support for Docker Compose and it has been tested with <a href="https://kind.sigs.k8s.io/">Kubernetes kind</a> as well. Since it was released as Beta, <code>WITH DOCKER</code> has been an integration testing powerhouse throughout the Earthly community. Today <code>WITH DOCKER</code> becomes GA.</p>
<div id="cb1"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>    <span>FROM</span> earthly/dind:alpine</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>    WITH DOCKER \</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>        --load kvserver:latest=+kvserver-docker \</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>        --load kv-py-client:latest=+kvclient-docker \</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>        --load kv-rb-client:latest=+kv-ruby-client-docker</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>        <span>RUN</span> \</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>            docker run -d kvserver:latest &amp;&amp; \</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>            docker run kv-py-client:latest python3 client.py fish=salmon &amp;&amp; \</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>            docker run kv-py-client:latest python3 client.py fish | grep salmon &amp;&amp; \</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>            docker run kv-rb-client:latest ruby client.rb fish | grep salmon</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>    END</span></code></pre></div>
<p>To get started with integration testing head over to Earthly’s <a href="https://docs.earthly.dev/docs/guides/integration">integration testing guide</a>.</p>
<h3 id="user-defined-commands-udcs">User-Defined Commands (UDCs)</h3>
<p>In order for builds to be standardized across multiple projects, Earthly needed to provide a way for users to specify common, arbitrary ways of performing certain key tasks within a build. This might entail compiling in a specific way, or downloading dependencies from an internal artifactory, or tagging production images using a specific convention, or installing a key dependency (internal CLI tool?) in a standard way.</p>
<p>Whatever the use-case, Earthly’s new user-defined commands (UDCs) got you covered.</p>
<pre><code>MY_COPY:
    COMMAND
    ARG src
    ARG dest=./
    ARG recursive=false
    RUN cp $(if $recursive =  &#34;true&#34;; then printf -- -r; fi) &#34;$src&#34; &#34;$dest&#34;

build:
    FROM alpine:3.13
    WORKDIR /udc-example
    RUN echo &#34;hello&#34; &gt;./foo
    DO +MY_COPY --src=./foo --dest=./bar
    RUN cat ./bar # prints &#34;hello&#34;</code></pre>
<p>UDCs work especially well when they are combined with the remote referencing syntax. For example, calling</p>
<pre><code>DO github.com/earthly/lib+INSTALL_DIND</code></pre>
<p>will install docker-in-docker on top of the current build environment, regardless of whether it’s based on an alpine or a debian base image.</p>
<p>To read more about UDCs, head over to the <a href="https://docs.earthly.dev/docs/guides/udc">UDC guide page in the Earthly documentation</a>.</p>

<p>Many modern CI runners are often ephemeral runners - the environment is wiped clean on every run. Caching in this situation can be challenging and as a result builds can get slow.</p>
<p>Through BuildKit’s remote cache capabilities, Earthly v0.6 now provides shared caching via regular container registries, which helps speed up builds in this situation.</p>
<p>The cache can be uploaded to a registry either embedded as metadata into already uploaded images (inline cache), or as part of a separate image entry that is not meant to be used for anything else (explicit cache). These caches can be used between CI runs, but can also be shared with individual engineers to speed up builds in their local environments.</p>
<p>To get started with shared caching, head over to the <a href="https://docs.earthly.dev/docs/guides/shared-cache">shared cache guide in the Earthly docs</a>.</p>
<h3 id="cross-platform-builds">Cross-Platform Builds</h3>
<p>Consistency of builds is important in cases when different engineers, or CIs are running on different CPU architectures. In Earthly v0.6 we’ve also GA’d cross-platform building, where Earthly will use QEMU to execute parts of the build that are designed for non-native platforms.</p>
<p>In addition, Earthly has been thoroughly tested on the new Apple Silicon (M1) and that platform is now also supported. (<a href="https://earthly.dev/blog/using-apple-silicon-m1-as-a-cloud-engineer-two-months-in/">Please test your environment before buying an M1, though</a>. Emulation isn’t always perfect).</p>
<p>To get started with <a href="https://docs.earthly.dev/docs/guides/multi-platform">multi-platform builds see the Earthly documentation</a>.</p>
<h3 id="and-much-more">And Much More</h3>
<p>Earthly v0.6 packs many other spicy features - such as the ability to execute commands directly on the host via <a href="https://docs.earthly.dev/docs/earthfile#locally"><code>LOCALLY</code></a>, the builtin backwards compatibility with older scripts via <a href="https://docs.earthly.dev/docs/earthfile/features"><code>VERSION</code></a>, support for flow control constructs such as <a href="https://docs.earthly.dev/docs/earthfile#if"><code>IF</code></a> and <a href="https://docs.earthly.dev/docs/earthfile#for"><code>FOR</code></a>, the ability to import Dockerfiles via <a href="https://docs.earthly.dev/docs/earthfile#from-dockerfile"><code>FROM DOCKERFILE</code></a>, dramatically increased speed of image exports, and much more!</p>
<p>To read the full release notes check out the <a href="https://github.com/earthly/earthly/releases/tag/v0.6.0">releases page on GitHub</a>.</p>
<h2 id="next">Next</h2>
<p>With v0.6 in the bag, the next question is “what’s next”. While our <a href="https://github.com/earthly/earthly/projects/1">roadmap is publicly available on GitHub</a> and we have previously written about our <a href="https://earthly.dev/blog/platform-values/">platform values</a>, we are now also working on some exciting unique cloud-based features, which we will launch in 2022. If you’re interested in being part of the closed Beta, please email <a href="mailto:support+cloud-beta@earthly.dev?subject=Earthly%20Cloud%20Beta">support+cloud-beta@earthly.dev</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Much of the work released today could not have been accomplished without the instrumental feedback from the Earthly community and the many code contributions from developers all around the planet! Thank you for making the world of builds a better place!</p>
<p>If you’re new to Earthly, head to our <a href="https://earthly.dev/get-earthly">Get Earthly</a> page and try out <a href="https://docs.earthly.dev/basics">the tutorial</a>. We have recently surpassed <a href="https://github.com/earthly/earthly">5500 stars on GitHub</a>, we’ve been named a top growing GitHub project on numerous occasions, and we’re hearing from community members how tremendously useful Earthly is to their work. And if you haven’t already, come <a href="https://earthly.dev/slack">say hi on Slack</a>!</p>

        
      </section></div>
  </body>
</html>
