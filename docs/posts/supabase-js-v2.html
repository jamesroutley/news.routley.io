<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://supabase.com/blog/supabase-js-v2">Original</a>
    <h1>Supabase-JS v2</h1>
    
    <div id="readability-page-1" class="page"><article><div><p>Today we&#39;re publishing a release candidate for <a href="https://github.com/supabase/supabase-js">supabase-js v2</a>, which focuses on “quality-of-life” improvements for developers.</p><p>Try it out by running <code>npm i @supabase/supabase-js@rc</code></p><p>Nearly 2 years ago we <a href="https://supabase.com/blog/improved-dx">released supabase-js v1</a>.
Since then it has been used in over <a href="https://github.com/supabase/supabase-js/network/dependents?package_id=UGFja2FnZS04MjM3OTUyMDU%3D">17K repositories</a> and has grown
to <a href="https://www.npmjs.com/package/@supabase/supabase-js">50K weekly downloads</a>. Supabase users give a lot of great feedback and we&#39;ve
learned some of the largest pain-points as a result.</p><h2 id="major-updates">Major Updates</h2><p>This release focuses on solving these pain-points. At the same time we want to make the upgrade path for supabase-js as easy as possible,
so we&#39;ve been strategic about the changes we&#39;re making. We plan to follow this model going forward: incremental changes over huge rewrites.</p><h3 id="type-support">Type support</h3><p>If you followed yesterday&#39;s announcement, you will have noticed that we added
<a href="https://supabase.com/docs/reference/cli/usage#supabase-gen-types-typescript">type generators</a> to the CLI.</p><pre></pre><p>These types can now be used to enrich your development experience:</p><pre></pre><details><summary>ℹ️ Differences from v1</summary><p>v1 also supported types, but the types were generated from the API rather than the database, so it
lost a lot of detailed information. The library also required you to specify the definition in
every method call, rather than at the client level.</p><pre></pre></details><hr/><h3 id="new-auth-methods">New Auth methods</h3><p>We&#39;re removing the <code>signIn()</code> method in favor of more explicit method signatures:
<code>signInWithPassword()</code>, <code>signInWithPasswordless()</code>, and <code>signInWithOtp()</code>.</p><pre></pre><p>This helps with type hinting. Previously it was difficult for developers to know what they were missing.
A lot of developers didn&#39;t even realize they could use passwordless magic links.</p><hr/><h3 id="data-methods-return-minimal-by-default">Data methods return minimal by default</h3><p>The <code>insert()</code>, <code>update()</code>, and <code>upsert()</code> methods now require you to explicitly append <code>select()</code> if you want the data to be returned.</p><pre></pre><p>This was another common question in our GitHub Discussions. While the idea of automatically returning data is great,
developers often turn on Row Level Security (which is great), and then they forget to add a <code>select</code> Policy.
It is a bit surprising that you need to add a <code>select</code> policy to do an <code>insert</code>, so we opted for the “principle of least surprise”.
If you don&#39;t append <code>select()</code>, the <code>data</code> value will be an empty object: <code>{}</code>.</p><details><summary>ℹ️ Differences from v1</summary><p>Previously you could pass a <code>returning: &#39;minimal&#39;</code> option to the <code>insert()</code>, <code>update()</code>, and
<code>upsert()</code> statements. We&#39;ve now made this the default behaviour.</p></details><hr/><h3 id="auth-admin-methods">Auth Admin methods</h3><p>We&#39;ve move all server-side Auth methods from <code>supabase.auth.api</code> to <code>supabase.auth.admin</code>:</p><pre></pre><p>All <code>admin</code> methods expect a <code>SERVICE_ROLE</code> key.
This change makes it clear that any methods under the <code>admin</code> namespace should only be used on a trusted server-side environment.</p><hr/><h3 id="async-auth-overhaul">Async Auth overhaul</h3><p>We&#39;ve rebuilt the Auth library, making it async for almost all methods.</p><pre></pre><p>This solves the “getting logged out” issue, which has been a recurring challenge in our GitHub Discussions.</p><details><summary>ℹ️ Improvements from v1</summary><p>The previous implementation had a race condition when refreshing the auth token across multiple tabs. The async re-write forces the library to wait
for a valid/invalid session before taking any action.</p></details><hr/><h3 id="scoped-constructor-config">Scoped constructor config</h3><p>We&#39;re being much more explicit about the modular approach that <code>supabase-js</code> uses:</p><pre></pre><p>This is clearer for developers - if you&#39;re only using some parts of Supabase, you only recieve the hints for those parts.</p><details><summary>ℹ️ Improvements from v1</summary><p>We noticed a lot of confusion for the variable naming between each library.
For example, Auth has a config parameter called &#34;storageKey&#34;, which was was often confused with the <code>storage-js</code> library bundled in the <code>supabase-js</code> library.</p></details><hr/><h3 id="better-errors">Better Errors</h3><p>We&#39;ve created error types for all of the sub-libraries in <code>supabase-js</code>. Here&#39;s a example for Edge Functions:</p><pre></pre><hr/><h3 id="improvements-for-edge-functions">Improvements for Edge Functions</h3><p><code>supabase-js</code> now automatically detects the content type for the request/response bodies for all Edge Function invocations:</p><pre></pre><p>This improvement inspired by a Supabase community member. Thanks <a href="https://github.com/supabase/functions-js/pull/23">@vejja</a>!</p><hr/><h3 id="multiplayer-sneak-peek">Multiplayer Sneak Peek</h3><p>There is a new <code>channel()</code> interface which are releasing in v2.
This is a &#34;preparatory&#34; release for our upcoming <a href="https://supabase.com/blog/supabase-realtime-with-multiplayer-features">multiplayer</a> features.</p><pre></pre><p>As part of this change, the old <code>from().on().subscribe()</code> method for listening to database changes will be changing:</p><pre></pre><p>You can listen to PostgreSQL database changes on any channel you want by subscribing to the <code>&#39;postgres_changes&#39;</code> event.
For now, we will continue to support <code>from().on().subscribe()</code>, but in the future we will deprecate this in favor of the <code>channel().on().subscribe()</code> method.</p><hr/><p>Version 2.0 is the result of the combined work of over 100 contributors to our libraries, and over 450 contributors to our docs and websites.
If you&#39;re one of those contributors, thank you.</p><ul><li><a href="https://github.com/supabase/functions-js/graphs/contributors"><code>functions-js</code></a> (4)</li><li><a href="https://github.com/supabase/gotrue-js/graphs/contributors"><code>gotrue-js</code></a> (47)</li><li><a href="https://github.com/supabase/postgrest-js/graphs/contributors"><code>postgrest-js</code></a> (30)</li><li><a href="https://github.com/supabase/realtime-js/graphs/contributors"><code>realtime-js</code></a> (16)</li><li><a href="https://github.com/supabase/storage-js/graphs/contributors"><code>storage-js</code></a> (17)</li><li><a href="https://github.com/supabase/supabase-js/graphs/contributors"><code>supabase-js</code></a> (39)</li></ul><p>Special shout outs to: <a href="https://github.com/vejja">@vejja</a>, <a href="https://github.com/pixtron">@pixtron</a>, <a href="https://github.com/pixtron">@bnjmnt4n</a>, and <a href="https://github.com/karlseguin">@karlseguin</a>.</p><h2 id="migrating-to-v2">Migrating to v2</h2><p>Update today by running:</p><pre></pre><p>You can find a full list of updates, breaking changes, and a migration guide in our <a href="https://supabase.com/docs/reference/javascript/next/release-notes">Release Notes</a>.</p><p>We&#39;ll continuing merging security fixes to v1, with maintenance patches for the next three months.</p><h2 id="announcement-video-and-discussion">Announcement video and discussion</h2><iframe width="560" height="315" src="https://www.youtube.com/embed/iqZlPtl_b-I" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe><h2 id="links">Links</h2><ul><li><a href="https://supabase.com/docs/reference/javascript/next">v2 Release Candidate Documentation</a></li><li><a href="https://supabase.com/docs/reference/javascript/next/release-notes">Release Notes &amp; Migration Guide</a></li></ul></div></article></div>
  </body>
</html>
