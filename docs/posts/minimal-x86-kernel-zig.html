<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/lopespm/zig-minimal-kernel-x86">Original</a>
    <h1>Minimal x86 Kernel Zig</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">A minimal bare-metal kernel written entirely in Zig (zero assembly files).
It boots on an x86 (i386) machine via the Multiboot 1 protocol and prints a
coloured greeting to the VGA text-mode display, then halts the CPU.</p>
<p dir="auto">The project is designed to be cross-compiled from any host (including Apple
Silicon Macs) and tested instantly with QEMU — no ISO image, no GRUB
installation, no bootloader binaries required.</p>

<ol dir="auto">
<li>QEMU loads the ELF binary using its built-in Multiboot 1 support.</li>
<li>The CPU starts in 32-bit protected mode at the <code>_start</code> entry point.</li>
<li><code>_start</code> sets up a 16 KiB stack and jumps to <code>kmain</code>.</li>
<li><code>kmain</code> clears the VGA text buffer and writes a message to the screen.</li>
<li>The CPU enters an infinite <code>hlt</code> loop.</li>
</ol>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Tool</th>
<th>Version</th>
<th>Install</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Zig</strong></td>
<td>0.14.0+</td>
<td><a href="https://ziglang.org/download/" rel="nofollow">ziglang.org/download</a> or <code>brew install zig</code></td>
</tr>
<tr>
<td><strong>QEMU</strong></td>
<td>any recent</td>
<td><code>brew install qemu</code> / <code>nix-env -iA nixpkgs.qemu</code></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">No other dependencies. Zig bundles its own LLVM back-end and linker, so
cross-compilation to <code>x86-freestanding-none</code> works out of the box on any host
OS and architecture (macOS ARM, Linux x86_64, etc.).</p>

<div dir="auto" data-snippet-clipboard-copy-content="# Build the kernel (produces zig-out/bin/kernel)
zig build

# Boot it in QEMU (opens a graphical VGA window)
zig build run

# Or use the helper script (curses mode, auto-kills after a few seconds)
chmod +x run.sh
./run.sh"><pre><span><span>#</span> Build the kernel (produces zig-out/bin/kernel)</span>
zig build

<span><span>#</span> Boot it in QEMU (opens a graphical VGA window)</span>
zig build run

<span><span>#</span> Or use the helper script (curses mode, auto-kills after a few seconds)</span>
chmod +x run.sh
./run.sh</pre></div>
<p dir="auto">To run QEMU manually with custom flags:</p>
<div dir="auto" data-snippet-clipboard-copy-content="qemu-system-i386 -kernel zig-out/bin/kernel"><pre>qemu-system-i386 -kernel zig-out/bin/kernel</pre></div>
<p dir="auto">You should see this:</p>
<a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/3640622/551244410-e53f6920-c06b-4586-b551-6b916a7b3d5a.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTQ5NzEsIm5iZiI6MTc3MTQxNDY3MSwicGF0aCI6Ii8zNjQwNjIyLzU1MTI0NDQxMC1lNTNmNjkyMC1jMDZiLTQ1ODYtYjU1MS02YjkxNmE3YjNkNWEucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI2MDIxOCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNjAyMThUMTEzNzUxWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NWQ3M2E3N2E2YTQ5MDdiYjY5NjI0YjE0Y2UwNzUxYjliMWZhZjE2ODkyMDY1MWYxZmUxYjAxMWJhNmFiYmY5MiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.sp1qJzR52JH3MCPd3-XDPlLGzPmUHyhaGMHUfcUI_qs"><img width="623" height="239" alt="Screenshot 2026-02-17 at 23 58 16" src="https://private-user-images.githubusercontent.com/3640622/551244410-e53f6920-c06b-4586-b551-6b916a7b3d5a.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE0MTQ5NzEsIm5iZiI6MTc3MTQxNDY3MSwicGF0aCI6Ii8zNjQwNjIyLzU1MTI0NDQxMC1lNTNmNjkyMC1jMDZiLTQ1ODYtYjU1MS02YjkxNmE3YjNkNWEucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI2MDIxOCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNjAyMThUMTEzNzUxWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NWQ3M2E3N2E2YTQ5MDdiYjY5NjI0YjE0Y2UwNzUxYjliMWZhZjE2ODkyMDY1MWYxZmUxYjAxMWJhNmFiYmY5MiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.sp1qJzR52JH3MCPd3-XDPlLGzPmUHyhaGMHUfcUI_qs"/></a>

<div data-snippet-clipboard-copy-content="zig-kernel/
├── build.zig          Zig build script (target, linker, QEMU run step)
├── build.zig.zon      Package manifest
├── linker.ld          Linker script (section layout, entry point)
├── run.sh             Quick-test shell script
└── src/
    └── main.zig       Entire kernel: Multiboot header, VGA driver, kmain"><pre><code>zig-kernel/
├── build.zig          Zig build script (target, linker, QEMU run step)
├── build.zig.zon      Package manifest
├── linker.ld          Linker script (section layout, entry point)
├── run.sh             Quick-test shell script
└── src/
    └── main.zig       Entire kernel: Multiboot header, VGA driver, kmain
</code></pre></div>

<div data-snippet-clipboard-copy-content=" HOST (macOS ARM / any OS)                    EMULATED x86 MACHINE (QEMU)
 ─────────────────────────                    ──────────────────────────────

 ┌──────────────┐   zig build    ┌────────────────────┐
 │  src/main.zig│───────────────▶│  zig-out/bin/kernel│  (i386 ELF binary)
 │  linker.ld   │  cross-compile │  Multiboot 1 magic │
 │  build.zig   │  x86-free-     │  at offset 0       │
 └──────────────┘  standing-none └─────────┬──────────┘
                                          │
                               qemu-system-i386 -kernel
                                          │
                                          ▼
                               ┌──────────────────────┐
                               │      QEMU / TCG      │
                               │  (x86 CPU emulation) │
                               └─────────┬────────────┘
                                          │
                    ┌─────────────────────┼───────────────────────┐
                    │   Emulated i386 hardware                    │
                    │                     │                       │
                    │   1. Multiboot      │                       │
                    │      loader reads   ▼                       │
                    │      ELF, puts   ┌───────────┐              │
                    │      CPU in      │  _start   │  32-bit      │
                    │      protected   │  (naked)  │  protected   │
                    │      mode        └────┬──────┘  mode        │
                    │                       │                     │
                    │              set up   │ stack               │
                    │                       ▼                     │
                    │                 ┌──────────┐                │
                    │                 │  kmain   │                │
                    │                 └────┬─────┘                │
                    │                      │                      │
                    │          ┌───────────┼───────────┐          │
                    │          │           │           │          │
                    │          ▼           ▼           ▼          │
                    │   clearScreen()  print(...)   hlt loop      │
                    │          │           │                      │
                    │          ▼           ▼                      │
                    │   ┌──────────────────────────────────┐      │
                    │   │  VGA Text Buffer at 0xB8000      │      │
                    │   │  80×25 grid, 16-bit per cell     │      │
                    │   │  (ASCII byte + colour attribute) │      │
                    │   └──────────────────────────────────┘      │
                    │                     │                       │
                    └─────────────────────┼───────────────────────┘
                                          │
                                          ▼
                               ┌──────────────────────┐
                               │   QEMU VGA Window    │
                               │                      │
                               │  ════════════════    │
                               │  Hello from the      │
                               │    Zig Kernel!       │
                               │  ════════════════    │
                               │                      │
                               └──────────────────────┘"><pre><code> HOST (macOS ARM / any OS)                    EMULATED x86 MACHINE (QEMU)
 ─────────────────────────                    ──────────────────────────────

 ┌──────────────┐   zig build    ┌────────────────────┐
 │  src/main.zig│───────────────▶│  zig-out/bin/kernel│  (i386 ELF binary)
 │  linker.ld   │  cross-compile │  Multiboot 1 magic │
 │  build.zig   │  x86-free-     │  at offset 0       │
 └──────────────┘  standing-none └─────────┬──────────┘
                                          │
                               qemu-system-i386 -kernel
                                          │
                                          ▼
                               ┌──────────────────────┐
                               │      QEMU / TCG      │
                               │  (x86 CPU emulation) │
                               └─────────┬────────────┘
                                          │
                    ┌─────────────────────┼───────────────────────┐
                    │   Emulated i386 hardware                    │
                    │                     │                       │
                    │   1. Multiboot      │                       │
                    │      loader reads   ▼                       │
                    │      ELF, puts   ┌───────────┐              │
                    │      CPU in      │  _start   │  32-bit      │
                    │      protected   │  (naked)  │  protected   │
                    │      mode        └────┬──────┘  mode        │
                    │                       │                     │
                    │              set up   │ stack               │
                    │                       ▼                     │
                    │                 ┌──────────┐                │
                    │                 │  kmain   │                │
                    │                 └────┬─────┘                │
                    │                      │                      │
                    │          ┌───────────┼───────────┐          │
                    │          │           │           │          │
                    │          ▼           ▼           ▼          │
                    │   clearScreen()  print(...)   hlt loop      │
                    │          │           │                      │
                    │          ▼           ▼                      │
                    │   ┌──────────────────────────────────┐      │
                    │   │  VGA Text Buffer at 0xB8000      │      │
                    │   │  80×25 grid, 16-bit per cell     │      │
                    │   │  (ASCII byte + colour attribute) │      │
                    │   └──────────────────────────────────┘      │
                    │                     │                       │
                    └─────────────────────┼───────────────────────┘
                                          │
                                          ▼
                               ┌──────────────────────┐
                               │   QEMU VGA Window    │
                               │                      │
                               │  ════════════════    │
                               │  Hello from the      │
                               │    Zig Kernel!       │
                               │  ════════════════    │
                               │                      │
                               └──────────────────────┘
</code></pre></div>

<ul dir="auto">
<li><strong>Target:</strong> <code>x86-freestanding-none</code> — 32-bit, no OS, no libc</li>
<li><strong>Boot protocol:</strong> Multiboot 1 — a 12-byte header (magic <code>0x1BADB002</code>,
flags, checksum) placed in the first 8 KiB of the ELF</li>
<li><strong>VGA output:</strong> Direct memory-mapped I/O to <code>0xB8000</code> using Zig&#39;s
<code>volatile</code> pointer semantics — no drivers, no BIOS calls</li>
<li><strong>Red zone:</strong> Disabled — the System V ABI red zone would be corrupted by
hardware interrupts</li>
<li><strong>SSE/AVX:</strong> Disabled — avoids the need to save/restore FPU state</li>
<li><strong>No assembly files:</strong> The Multiboot header is a Zig <code>extern struct</code>
exported to a linker section; the entry point uses inline <code>asm volatile</code></li>
</ul>
</article></div></div>
  </body>
</html>
