<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/nalgeon/redka">Original</a>
    <h1>Redis re-implemented with SQLite</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nalgeon/redka/blob/main/logo.svg"><img alt="Redka" src="https://github.com/nalgeon/redka/raw/main/logo.svg" height="80"/></a></p>
<p dir="auto">Redka aims to reimplement the good parts of Redis with SQLite, while remaining compatible with Redis API.</p>
<p dir="auto">Notable features:</p>
<ul dir="auto">
<li>Data does not have to fit in RAM.</li>
<li>ACID transactions.</li>
<li>SQL views for better introspection and reporting.</li>
<li>Both in-process (Go API) and standalone (RESP) servers.</li>
<li>Redis-compatible commands and wire protocol.</li>
</ul>
<p dir="auto">This is a work in progress. See below for the current status and roadmap.</p>
<p dir="auto"><a href="#commands">Commands</a> •
<a href="#installation">Installation</a> •
<a href="#usage">Usage</a> •
<a href="#persistence">Persistence</a> •
<a href="#performance">Performance</a> •
<a href="#roadmap">Roadmap</a> •
<a href="#more-information">More</a></p>

<p dir="auto">Redka aims to support five core Redis data types: strings, lists, sets, hashes, and sorted sets.</p>

<p dir="auto">Strings are the most basic Redis type, representing a sequence of bytes. Redka supports the following string-related commands:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Go API</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DECR</code></td>
<td><code>DB.Str().Incr</code></td>
<td>Decrements the integer value of a key by one.</td>
</tr>
<tr>
<td><code>DECRBY</code></td>
<td><code>DB.Str().Incr</code></td>
<td>Decrements a number from the integer value of a key.</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>DB.Str().Get</code></td>
<td>Returns the value of a key.</td>
</tr>
<tr>
<td><code>GETSET</code></td>
<td><code>DB.Str().GetSet</code></td>
<td>Sets the key to a new value and returns the prev value.</td>
</tr>
<tr>
<td><code>INCR</code></td>
<td><code>DB.Str().Incr</code></td>
<td>Increments the integer value of a key by one.</td>
</tr>
<tr>
<td><code>INCRBY</code></td>
<td><code>DB.Str().Incr</code></td>
<td>Increments the integer value of a key by a number.</td>
</tr>
<tr>
<td><code>INCRBYFLOAT</code></td>
<td><code>DB.Str().IncrFloat</code></td>
<td>Increments the float value of a key by a number.</td>
</tr>
<tr>
<td><code>MGET</code></td>
<td><code>DB.Str().GetMany</code></td>
<td>Returns the values of one or more keys.</td>
</tr>
<tr>
<td><code>MSET</code></td>
<td><code>DB.Str().SetMany</code></td>
<td>Sets the values of one or more keys.</td>
</tr>
<tr>
<td><code>MSETNX</code></td>
<td><code>DB.Str().SetManyNX</code></td>
<td>Sets the values of one or more keys when all keys don&#39;t exist.</td>
</tr>
<tr>
<td><code>PSETEX</code></td>
<td><code>DB.Str().SetExpires</code></td>
<td>Sets the value and expiration time (in ms) of a key.</td>
</tr>
<tr>
<td><code>SET</code></td>
<td><code>DB.Str().Set</code></td>
<td>Sets the value of a key.</td>
</tr>
<tr>
<td><code>SETEX</code></td>
<td><code>DB.Str().SetExpires</code></td>
<td>Sets the value and expiration (in sec) time of a key.</td>
</tr>
<tr>
<td><code>SETNX</code></td>
<td><code>DB.Str().SetNotExists</code></td>
<td>Sets the value of a key when the key doesn&#39;t exist.</td>
</tr>
</tbody>
</table>
<p dir="auto">The following string-related commands are not planned for 1.0:</p>
<div data-snippet-clipboard-copy-content="APPEND  GETDEL  GETEX  GETRANGE  LCS  SETRANGE  STRLEN  SUBSTR"><pre><code>APPEND  GETDEL  GETEX  GETRANGE  LCS  SETRANGE  STRLEN  SUBSTR
</code></pre></div>

<p dir="auto">Lists are lists of strings sorted by insertion order. Redka aims to support the following list-related commands in 1.0:</p>
<div data-snippet-clipboard-copy-content="LINDEX  LINSERT  LLEN  LPOP  LPUSHX  LRANGE  LREM  LSET
LTRIM  RPOP  RPOPLPUSH  RPUSH  RPUSHX"><pre><code>LINDEX  LINSERT  LLEN  LPOP  LPUSHX  LRANGE  LREM  LSET
LTRIM  RPOP  RPOPLPUSH  RPUSH  RPUSHX
</code></pre></div>

<p dir="auto">Sets are unordered collections of unique strings. Redka aims to support the following set-related commands in 1.0:</p>
<div data-snippet-clipboard-copy-content="SADD  SCARD  SDIFF  SDIFFSTORE  SINTER  SINTERSTORE
SISMEMBER  SMEMBERS  SMOVE  SPOP  SRANDMEMBER  SREM
SUNION  SUNIONSTORE"><pre><code>SADD  SCARD  SDIFF  SDIFFSTORE  SINTER  SINTERSTORE
SISMEMBER  SMEMBERS  SMOVE  SPOP  SRANDMEMBER  SREM
SUNION  SUNIONSTORE
</code></pre></div>

<p dir="auto">Hashes are field-value (hash)maps. Redka supports the following hash-related commands:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Go API</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>HDEL</code></td>
<td><code>DB.Hash().Delete</code></td>
<td>Deletes one or more fields and their values.</td>
</tr>
<tr>
<td><code>HEXISTS</code></td>
<td><code>DB.Hash().Exists</code></td>
<td>Determines whether a field exists.</td>
</tr>
<tr>
<td><code>HGET</code></td>
<td><code>DB.Hash().Get</code></td>
<td>Returns the value of a field.</td>
</tr>
<tr>
<td><code>HGETALL</code></td>
<td><code>DB.Hash().Items</code></td>
<td>Returns all fields and values.</td>
</tr>
<tr>
<td><code>HINCRBY</code></td>
<td><code>DB.Hash().Incr</code></td>
<td>Increments the integer value of a field.</td>
</tr>
<tr>
<td><code>HINCRBYFLOAT</code></td>
<td><code>DB.Hash().IncrFloat</code></td>
<td>Increments the float value of a field.</td>
</tr>
<tr>
<td><code>HKEYS</code></td>
<td><code>DB.Hash().Keys</code></td>
<td>Returns all fields.</td>
</tr>
<tr>
<td><code>HLEN</code></td>
<td><code>DB.Hash().Len</code></td>
<td>Returns the number of fields.</td>
</tr>
<tr>
<td><code>HMGET</code></td>
<td><code>DB.Hash().GetMany</code></td>
<td>Returns the values of multiple fields.</td>
</tr>
<tr>
<td><code>HMSET</code></td>
<td><code>DB.Hash().SetMany</code></td>
<td>Sets the values of multiple fields.</td>
</tr>
<tr>
<td><code>HSCAN</code></td>
<td><code>DB.Hash().Scanner</code></td>
<td>Iterates over fields and values.</td>
</tr>
<tr>
<td><code>HSET</code></td>
<td><code>DB.Hash().SetMany</code></td>
<td>Sets the values of one or more fields.</td>
</tr>
<tr>
<td><code>HSETNX</code></td>
<td><code>DB.Hash().SetNotExists</code></td>
<td>Sets the value of a field when it doesn&#39;t exist.</td>
</tr>
<tr>
<td><code>HVALS</code></td>
<td><code>DB.Hash().Exists</code></td>
<td>Returns all values.</td>
</tr>
</tbody>
</table>
<p dir="auto">The following hash-related commands are not planned for 1.0:</p>


<p dir="auto">Sorted sets are collections of unique strings ordered by each string&#39;s associated score. Redka aims to support the following sorted set related commands in 1.0:</p>
<div data-snippet-clipboard-copy-content="ZADD  ZCARD  ZCOUNT  ZINCRBY  ZINTERSTORE  ZRANGE
ZRANK  ZREM  ZSCORE"><pre><code>ZADD  ZCARD  ZCOUNT  ZINCRBY  ZINTERSTORE  ZRANGE
ZRANK  ZREM  ZSCORE
</code></pre></div>

<p dir="auto">Redka supports the following key management (generic) commands:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Go API</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DEL</code></td>
<td><code>DB.Key().Delete</code></td>
<td>Deletes one or more keys.</td>
</tr>
<tr>
<td><code>EXISTS</code></td>
<td><code>DB.Key().Count</code></td>
<td>Determines whether one or more keys exist.</td>
</tr>
<tr>
<td><code>EXPIRE</code></td>
<td><code>DB.Key().Expire</code></td>
<td>Sets the expiration time of a key (in seconds).</td>
</tr>
<tr>
<td><code>EXPIREAT</code></td>
<td><code>DB.Key().ExpireAt</code></td>
<td>Sets the expiration time of a key to a Unix timestamp.</td>
</tr>
<tr>
<td><code>KEYS</code></td>
<td><code>DB.Key().Keys</code></td>
<td>Returns all key names that match a pattern.</td>
</tr>
<tr>
<td><code>PERSIST</code></td>
<td><code>DB.Key().Persist</code></td>
<td>Removes the expiration time of a key.</td>
</tr>
<tr>
<td><code>PEXPIRE</code></td>
<td><code>DB.Key().Expire</code></td>
<td>Sets the expiration time of a key in ms.</td>
</tr>
<tr>
<td><code>PEXPIREAT</code></td>
<td><code>DB.Key().ExpireAt</code></td>
<td>Sets the expiration time of a key to a Unix ms timestamp.</td>
</tr>
<tr>
<td><code>RANDOMKEY</code></td>
<td><code>DB.Key().Random</code></td>
<td>Returns a random key name from the database.</td>
</tr>
<tr>
<td><code>RENAME</code></td>
<td><code>DB.Key().Rename</code></td>
<td>Renames a key and overwrites the destination.</td>
</tr>
<tr>
<td><code>RENAMENX</code></td>
<td><code>DB.Key().RenameNotExists</code></td>
<td>Renames a key only when the target key name doesn&#39;t exist.</td>
</tr>
<tr>
<td><code>SCAN</code></td>
<td><code>DB.Key().Scanner</code></td>
<td>Iterates over the key names in the database.</td>
</tr>
</tbody>
</table>
<p dir="auto">The following generic commands are not planned for 1.0:</p>
<div data-snippet-clipboard-copy-content="COPY  DUMP  EXPIRETIME  MIGRATE  MOVE  OBJECT  PEXPIRETIME
PTTL  RESTORE  SORT  SORT_RO  TOUCH  TTL  TYPE  UNLINK
WAIT  WAITAOF"><pre><code>COPY  DUMP  EXPIRETIME  MIGRATE  MOVE  OBJECT  PEXPIRETIME
PTTL  RESTORE  SORT  SORT_RO  TOUCH  TTL  TYPE  UNLINK
WAIT  WAITAOF
</code></pre></div>

<p dir="auto">Redka supports the following transaction commands:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Go API</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DISCARD</code></td>
<td><code>DB.View</code> / <code>DB.Update</code></td>
<td>Discards a transaction.</td>
</tr>
<tr>
<td><code>EXEC</code></td>
<td><code>DB.View</code> / <code>DB.Update</code></td>
<td>Executes all commands in a transaction.</td>
</tr>
<tr>
<td><code>MULTI</code></td>
<td><code>DB.View</code> / <code>DB.Update</code></td>
<td>Starts a transaction.</td>
</tr>
</tbody>
</table>
<p dir="auto">Unlike Redis, Redka&#39;s transactions are fully ACID, providing automatic rollback in case of failure.</p>
<p dir="auto">The following transaction commands are not planned for 1.0:</p>

<div dir="auto"><h3 tabindex="-1" dir="auto">Server/connection management</h3><a id="user-content-serverconnection-management" aria-label="Permalink: Server/connection management" href="#serverconnection-management"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Redka supports only a couple of server and connection management commands:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Go API</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ECHO</code></td>
<td>—</td>
<td>Returns the given string.</td>
</tr>
<tr>
<td><code>FLUSHDB</code></td>
<td><code>DB.Key().DeleteAll</code></td>
<td>Remove all keys from the database.</td>
</tr>
</tbody>
</table>
<p dir="auto">The rest of the server and connection management commands are not planned for 1.0.</p>

<p dir="auto">Redka can be installed as a standalone Redis-compatible server, or as a Go module for in-process use.</p>

<p dir="auto">Redka server is a single-file binary. Download it from the <a href="https://github.com/nalgeon/redka/releases">releases</a>.</p>
<p dir="auto">Linux (x86 CPU only):</p>
<div dir="auto" data-snippet-clipboard-copy-content="curl -L -O &#34;https://github.com/nalgeon/redka/releases/download/v0.2.0/redka_linux_amd64.zip&#34;
unzip redka_linux_amd64.zip
chmod +x redka"><pre>curl -L -O <span><span>&#34;</span>https://github.com/nalgeon/redka/releases/download/v0.2.0/redka_linux_amd64.zip<span>&#34;</span></span>
unzip redka_linux_amd64.zip
chmod +x redka</pre></div>
<p dir="auto">macOS (both x86 and ARM/Apple Silicon CPU):</p>
<div dir="auto" data-snippet-clipboard-copy-content="curl -L -O &#34;https://github.com/nalgeon/redka/releases/download/v0.2.0/redka_darwin_amd64.zip&#34;
unzip redka_darwin_amd64.zip
# remove the build from quarantine
# (macOS disables unsigned binaries)
xattr -d com.apple.quarantine redka
chmod +x redka"><pre>curl -L -O <span><span>&#34;</span>https://github.com/nalgeon/redka/releases/download/v0.2.0/redka_darwin_amd64.zip<span>&#34;</span></span>
unzip redka_darwin_amd64.zip
<span><span>#</span> remove the build from quarantine</span>
<span><span>#</span> (macOS disables unsigned binaries)</span>
xattr -d com.apple.quarantine redka
chmod +x redka</pre></div>
<p dir="auto">Or pull with Docker as follows (x86/ARM):</p>
<div dir="auto" data-snippet-clipboard-copy-content="docker pull nalgeon/redka"><pre>docker pull nalgeon/redka</pre></div>
<p dir="auto">Or build from source (requires Go 1.22 and GCC):</p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/nalgeon/redka.git
cd redka
make setup build
# the path to the binary after the build
# will be ./build/redka"><pre>git clone https://github.com/nalgeon/redka.git
<span>cd</span> redka
make setup build
<span><span>#</span> the path to the binary after the build</span>
<span><span>#</span> will be ./build/redka</span></pre></div>

<p dir="auto">Install the module as follows:</p>
<div dir="auto" data-snippet-clipboard-copy-content="go get github.com/nalgeon/redka"><pre>go get github.com/nalgeon/redka</pre></div>
<p dir="auto">You&#39;ll also need an SQLite driver. Use <code>github.com/mattn/go-sqlite3</code> if you don&#39;t mind CGO. Otherwise use a pure Go driver <code>modernc.org/sqlite</code>. Install either with <code>go get</code> like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="go get github.com/mattn/go-sqlite3"><pre>go get github.com/mattn/go-sqlite3</pre></div>

<p dir="auto">Redka can be used as a standalone Redis-compatible server, or as an embeddable in-process server with Go API.</p>

<p dir="auto">Redka server is a single-file binary. After downloading and unpacking the release asset, run it as follows:</p>
<div data-snippet-clipboard-copy-content="redka [-h host] [-p port] [db-path]"><pre><code>redka [-h host] [-p port] [db-path]
</code></pre></div>
<p dir="auto">For example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="./redka
./redka data.db
./redka -h 0.0.0.0 -p 6379 data.db"><pre>./redka
./redka data.db
./redka -h 0.0.0.0 -p 6379 data.db</pre></div>
<p dir="auto">Server defaults are host <code>localhost</code>, port <code>6379</code> and empty DB path.</p>
<p dir="auto">Running without a DB path creates an in-memory database. The data is not persisted in this case, and will be gone when the server is stopped.</p>
<p dir="auto">You can also run Redka with Docker as follows:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# database inside the container
# will be lost when the container stops
docker run --rm -p 6379:6379 nalgeon/redka

# persistent database
# using the /path/to/data host directory
docker run --rm -p 6379:6379 -v /path/to/data:/data nalgeon/redka

# in-memory database, custom post
docker run --rm -p 6380:6380 nalgeon/redka redka -h 0.0.0.0 -p 6380"><pre><span><span>#</span> database inside the container</span>
<span><span>#</span> will be lost when the container stops</span>
docker run --rm -p 6379:6379 nalgeon/redka

<span><span>#</span> persistent database</span>
<span><span>#</span> using the /path/to/data host directory</span>
docker run --rm -p 6379:6379 -v /path/to/data:/data nalgeon/redka

<span><span>#</span> in-memory database, custom post</span>
docker run --rm -p 6380:6380 nalgeon/redka redka -h 0.0.0.0 -p 6380</pre></div>
<p dir="auto">Server defaults in Docker are host <code>0.0.0.0</code>, port <code>6379</code> and DB path <code>/data/redka.db</code>.</p>
<p dir="auto">Once the server is running, connect to it using <code>redis-cli</code> or an API client like <code>redis-py</code> or <code>go-redis</code> — just as you would with Redis.</p>
<div dir="auto" data-snippet-clipboard-copy-content="redis-cli -h localhost -p 6379"><pre>redis-cli -h localhost -p 6379</pre></div>
<div data-snippet-clipboard-copy-content="127.0.0.1:6379&gt; echo hello
&#34;hello&#34;
127.0.0.1:6379&gt; set name alice
OK
127.0.0.1:6379&gt; get name
&#34;alice&#34;"><pre><code>127.0.0.1:6379&gt; echo hello
&#34;hello&#34;
127.0.0.1:6379&gt; set name alice
OK
127.0.0.1:6379&gt; get name
&#34;alice&#34;
</code></pre></div>

<p dir="auto">The primary object in Redka is the <code>DB</code>. To open or create your database, use the <code>redka.Open()</code> function:</p>
<div dir="auto" data-snippet-clipboard-copy-content="package main

import (
    &#34;log&#34;

    _ &#34;github.com/mattn/go-sqlite3&#34;
    &#34;github.com/nalgeon/redka&#34;
)

func main() {
    // Open or create the data.db file.
    db, err := redka.Open(&#34;data.db&#34;, nil)
    if err != nil {
        log.Fatal(err)
    }
    // Always close the database when you are finished.
    defer db.Close()
    // ...
}"><pre><span>package</span> main

<span>import</span> (
    <span>&#34;log&#34;</span>

    _ <span>&#34;github.com/mattn/go-sqlite3&#34;</span>
    <span>&#34;github.com/nalgeon/redka&#34;</span>
)

<span>func</span> <span>main</span>() {
    <span>// Open or create the data.db file.</span>
    <span>db</span>, <span>err</span> <span>:=</span> <span>redka</span>.<span>Open</span>(<span>&#34;data.db&#34;</span>, <span>nil</span>)
    <span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
        <span>log</span>.<span>Fatal</span>(<span>err</span>)
    }
    <span>// Always close the database when you are finished.</span>
    <span>defer</span> <span>db</span>.<span>Close</span>()
    <span>// ...</span>
}</pre></div>
<p dir="auto">Don&#39;t forget to import the driver (here I use <code>github.com/mattn/go-sqlite3</code>). Using <code>modernc.org/sqlite</code> is slightly different, see <a href="https://github.com/nalgeon/redka/blob/main/example/modernc/main.go">example/modernc/main.go</a> for details.</p>
<p dir="auto">To open an in-memory database that doesn&#39;t persist to disk, use the following path:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// All data is lost when the database is closed.
redka.Open(&#34;file:redka?mode=memory&amp;cache=shared&#34;)"><pre><span>// All data is lost when the database is closed.</span>
<span>redka</span>.<span>Open</span>(<span>&#34;file:redka?mode=memory&amp;cache=shared&#34;</span>)</pre></div>
<p dir="auto">After opening the database, call <code>redka.DB</code> methods to run individual commands:</p>
<div dir="auto" data-snippet-clipboard-copy-content="db.Str().Set(&#34;name&#34;, &#34;alice&#34;)
db.Str().Set(&#34;age&#34;, 25)

count, err := db.Key().Count(&#34;name&#34;, &#34;age&#34;, &#34;city&#34;)
slog.Info(&#34;count&#34;, &#34;count&#34;, count, &#34;err&#34;, err)

name, err := db.Str().Get(&#34;name&#34;)
slog.Info(&#34;get&#34;, &#34;name&#34;, name, &#34;err&#34;, err)"><pre><span>db</span>.<span>Str</span>().<span>Set</span>(<span>&#34;name&#34;</span>, <span>&#34;alice&#34;</span>)
<span>db</span>.<span>Str</span>().<span>Set</span>(<span>&#34;age&#34;</span>, <span>25</span>)

<span>count</span>, <span>err</span> <span>:=</span> <span>db</span>.<span>Key</span>().<span>Count</span>(<span>&#34;name&#34;</span>, <span>&#34;age&#34;</span>, <span>&#34;city&#34;</span>)
<span>slog</span>.<span>Info</span>(<span>&#34;count&#34;</span>, <span>&#34;count&#34;</span>, <span>count</span>, <span>&#34;err&#34;</span>, <span>err</span>)

<span>name</span>, <span>err</span> <span>:=</span> <span>db</span>.<span>Str</span>().<span>Get</span>(<span>&#34;name&#34;</span>)
<span>slog</span>.<span>Info</span>(<span>&#34;get&#34;</span>, <span>&#34;name&#34;</span>, <span>name</span>, <span>&#34;err&#34;</span>, <span>err</span>)</pre></div>
<div data-snippet-clipboard-copy-content="count count=2 err=&lt;nil&gt;
get name=&#34;alice&#34; err=&lt;nil&gt;"><pre><code>count count=2 err=&lt;nil&gt;
get name=&#34;alice&#34; err=&lt;nil&gt;
</code></pre></div>
<p dir="auto">See the full example in <a href="https://github.com/nalgeon/redka/blob/main/example/simple/main.go">example/simple/main.go</a>.</p>
<p dir="auto">Use transactions to batch commands. There are <code>View</code> (read-only transaction) and <code>Update</code> (writable transaction) methods for this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="updCount := 0
err := db.Update(func(tx *redka.Tx) error {
    err := tx.Str().Set(&#34;name&#34;, &#34;bob&#34;)
    if err != nil {
        return err
    }
    updCount++

    err = tx.Str().Set(&#34;age&#34;, 50)
    if err != nil {
        return err
    }
    updCount++
    return nil
})
slog.Info(&#34;updated&#34;, &#34;count&#34;, updCount, &#34;err&#34;, err)"><pre><span>updCount</span> <span>:=</span> <span>0</span>
<span>err</span> <span>:=</span> <span>db</span>.<span>Update</span>(<span>func</span>(<span>tx</span> <span>*</span>redka.<span>Tx</span>) <span>error</span> {
    <span>err</span> <span>:=</span> <span>tx</span>.<span>Str</span>().<span>Set</span>(<span>&#34;name&#34;</span>, <span>&#34;bob&#34;</span>)
    <span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
        <span>return</span> <span>err</span>
    }
    <span>updCount</span><span>++</span>

    <span>err</span> <span>=</span> <span>tx</span>.<span>Str</span>().<span>Set</span>(<span>&#34;age&#34;</span>, <span>50</span>)
    <span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
        <span>return</span> <span>err</span>
    }
    <span>updCount</span><span>++</span>
    <span>return</span> <span>nil</span>
})
<span>slog</span>.<span>Info</span>(<span>&#34;updated&#34;</span>, <span>&#34;count&#34;</span>, <span>updCount</span>, <span>&#34;err&#34;</span>, <span>err</span>)</pre></div>
<div data-snippet-clipboard-copy-content="updated count=2 err=&lt;nil&gt;"><pre><code>updated count=2 err=&lt;nil&gt;
</code></pre></div>
<p dir="auto">See the full example in <a href="https://github.com/nalgeon/redka/blob/main/example/tx/main.go">example/tx/main.go</a>.</p>
<p dir="auto">See the <a href="https://pkg.go.dev/github.com/nalgeon/redka" rel="nofollow">package documentation</a> for API reference.</p>

<p dir="auto">Redka stores data in a SQLite database using the following tables:</p>
<div data-snippet-clipboard-copy-content="rkey
---
id       integer primary key
key      text not null
type     integer not null    -- 1 string, 2 list, 3 set, 4 hash, 5 sorted set
version  integer not null    -- incremented when the key value is updated
etime    integer             -- expiration timestamp in unix milliseconds
mtime    integer not null    -- modification timestamp in unix milliseconds

rstring
---
key_id   integer not null    -- FK -&gt; rkey.id
value    blob not null

rhash
---
key_id   integer not null    -- FK -&gt; rkey.id
field    text not null
value    blob not null"><pre><code>rkey
---
id       integer primary key
key      text not null
type     integer not null    -- 1 string, 2 list, 3 set, 4 hash, 5 sorted set
version  integer not null    -- incremented when the key value is updated
etime    integer             -- expiration timestamp in unix milliseconds
mtime    integer not null    -- modification timestamp in unix milliseconds

rstring
---
key_id   integer not null    -- FK -&gt; rkey.id
value    blob not null

rhash
---
key_id   integer not null    -- FK -&gt; rkey.id
field    text not null
value    blob not null
</code></pre></div>
<p dir="auto">To access the data with SQL, use views instead of tables:</p>

<div data-snippet-clipboard-copy-content="┌────────┬──────┬───────┬───────┬─────────────────────┐
│ key_id │ key  │ value │ etime │        mtime        │
├────────┼──────┼───────┼───────┼─────────────────────┤
│ 1      │ name │ alice │       │ 2024-04-03 16:58:14 │
│ 2      │ age  │ 50    │       │ 2024-04-03 16:34:52 │
└────────┴──────┴───────┴───────┴─────────────────────┘"><pre><code>┌────────┬──────┬───────┬───────┬─────────────────────┐
│ key_id │ key  │ value │ etime │        mtime        │
├────────┼──────┼───────┼───────┼─────────────────────┤
│ 1      │ name │ alice │       │ 2024-04-03 16:58:14 │
│ 2      │ age  │ 50    │       │ 2024-04-03 16:34:52 │
└────────┴──────┴───────┴───────┴─────────────────────┘
</code></pre></div>
<p dir="auto"><code>etime</code> and <code>mtime</code> are in UTC.</p>
<p dir="auto">There is a separate view for every data type:</p>


<p dir="auto">I&#39;ve compared Redka with Redis using <a href="https://redis.io/docs/management/optimization/benchmarks/" rel="nofollow">redis-benchmark</a> with the following parameters:</p>
<ul dir="auto">
<li>10 parallel connections</li>
<li>1000000 requests</li>
<li>10000 randomized keys</li>
<li>GET/SET commands</li>
</ul>
<p dir="auto">SQLite settings:</p>
<div data-snippet-clipboard-copy-content="pragma journal_mode = wal;
pragma synchronous = normal;
pragma temp_store = memory;
pragma mmap_size = 268435456;
pragma foreign_keys = on;"><pre><code>pragma journal_mode = wal;
pragma synchronous = normal;
pragma temp_store = memory;
pragma mmap_size = 268435456;
pragma foreign_keys = on;
</code></pre></div>
<p dir="auto">Hardware: Apple M1 8-core CPU, 16GB RAM</p>
<p dir="auto">Results:</p>
<div data-snippet-clipboard-copy-content="redis-server --appendonly no
redis-benchmark -p 6379 -q -c 10 -n 1000000 -r 10000 -t get,set

SET: 133262.25 requests per second, p50=0.055 msec
GET: 139217.59 requests per second, p50=0.055 msec"><pre><code>redis-server --appendonly no
redis-benchmark -p 6379 -q -c 10 -n 1000000 -r 10000 -t get,set

SET: 133262.25 requests per second, p50=0.055 msec
GET: 139217.59 requests per second, p50=0.055 msec
</code></pre></div>
<div data-snippet-clipboard-copy-content="./redka -p 6380 data.db
redis-benchmark -p 6380 -q -c 10 -n 1000000 -r 10000 -t get,set

SET: 22551.47 requests per second, p50=0.255 msec
GET: 56802.05 requests per second, p50=0.119 msec"><pre><code>./redka -p 6380 data.db
redis-benchmark -p 6380 -q -c 10 -n 1000000 -r 10000 -t get,set

SET: 22551.47 requests per second, p50=0.255 msec
GET: 56802.05 requests per second, p50=0.119 msec
</code></pre></div>
<p dir="auto">So while Redka is 2-6 times slower than Redis (not surprising, since we are comparing a relational database to a key-value data store), it can still do 23K writes/sec and 57K reads/sec, which is pretty good if you ask me.</p>
<p dir="auto">Note that running in a container may result in poorer performance.</p>

<p dir="auto">The project is on its way to 1.0.</p>
<p dir="auto">The 1.0 release will include the following features from Redis 2.x (which I consider the &#34;golden age&#34; of the Redis API):</p>
<ul dir="auto">
<li>✅ Strings.</li>
<li>⬜ Lists.</li>
<li>⬜ Sets.</li>
<li>✅ Hashes.</li>
<li>⏳ Sorted sets.</li>
<li>✅ Key management.</li>
<li>✅ Transactions.</li>
</ul>
<p dir="auto">✅ = done, ⏳ = in progress, ⬜ = next in line</p>
<p dir="auto">Future versions may include additional data types (such as streams, HyperLogLog or geo), features like publish/subscribe, and more commands for existing types.</p>
<p dir="auto">Features I&#39;d rather not implement even in future versions:</p>
<ul dir="auto">
<li>Lua scripting.</li>
<li>Authentication and ACLs.</li>
<li>Multiple databases.</li>
<li>Watch/unwatch.</li>
</ul>
<p dir="auto">Features I definitely don&#39;t want to implement:</p>
<ul dir="auto">
<li>Cluster.</li>
<li>Sentinel.</li>
</ul>


<p dir="auto">Contributions are welcome. For anything other than bugfixes, please first open an issue to discuss what you want to change.</p>
<p dir="auto">Be sure to add or update tests as appropriate.</p>

<p dir="auto">Redka would not be possible without these great projects and their creators:</p>
<ul dir="auto">
<li><a href="https://redis.io/" rel="nofollow">Redis</a> (<a href="https://github.com/antirez">Salvatore Sanfilippo</a>). It&#39;s such an amazing idea to go beyond the get-set paradigm and provide a convenient API for more complex data structures.</li>
<li><a href="https://sqlite.org/" rel="nofollow">SQLite</a> (<a href="https://www.sqlite.org/crew.html" rel="nofollow">D. Richard Hipp</a>). The in-process database powering the world.</li>
<li><a href="https://github.com/tidwall/redcon">Redcon</a> (<a href="https://github.com/tidwall">Josh Baker</a>). A very clean and convenient implementation of a RESP server.</li>
</ul>
<p dir="auto">Logo font by <a href="https://ektype.in/" rel="nofollow">Ek Type</a>.</p>

<p dir="auto">Copyright 2024 <a href="https://antonz.org/" rel="nofollow">Anton Zhiyanov</a>.</p>
<p dir="auto">The software is available under the BSD-3-Clause license.</p>

<p dir="auto">★ <a href="https://antonz.org/subscribe/" rel="nofollow">Subscribe</a> to stay on top of new features.</p>
</article></div></div>
  </body>
</html>
