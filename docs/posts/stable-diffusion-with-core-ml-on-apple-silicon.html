<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://machinelearning.apple.com/research/stable-diffusion-coreml-apple-silicon">Original</a>
    <h1>Stable Diffusion with Core ML on Apple Silicon</h1>
    
    <div id="readability-page-1" class="page"><section><div><div><div><p>Today, we are excited to release optimizations to Core ML for <a href="https://stability.ai/blog/stable-diffusion-announcement" target="_blank" aria-label="Stable Diffusion - Opens in a new window" rel="noopener nofollow">Stable Diffusion</a> in macOS 13.1 and iOS 16.2, along with code to get started with deploying to Apple Silicon devices.</p><figure id="figure1" aria-labelledby="figure-figure1-caption"><p><a href="https://mlr.cdn-apple.com/media/sd_fig1_1061c7a1a7.png" aria-label="Figure 1: Images generated with the prompts, &#39;a high quality photo of an astronaut riding a (horse/dragon) in space&#39; using Stable Diffusion and Core ML + diffusers running on-device on Apple Silicon.&#39;" tabindex="-1" target="_blank"><img src="https://mlr.cdn-apple.com/media/sd_fig1_1061c7a1a7.png" alt="Figure 1: Images generated with the prompts, &#39;a high quality photo of an astronaut riding a (horse/dragon) in space&#39; using Stable Diffusion and Core ML + diffusers running on-device on Apple Silicon.&#39;" loading="lazy"/></a></p><figcaption id="figure-figure1-caption" aria-hidden="false">Figure 1: Images generated with the prompts, &#34;a high quality photo of an astronaut riding a (horse/dragon) in space&#34; using Stable Diffusion and Core ML + diffusers running on-device on Apple Silicon.</figcaption></figure><p>Since its public debut in August 2022, Stable Diffusion has been adopted by a vibrant community of artists, developers and hobbyists alike, enabling the creation of unprecedented visual content with as little as a text prompt. In response, the community has built an expansive ecosystem of extensions and tools around this core technology in a matter of weeks. There are already methods that <a href="https://huggingface.co/docs/diffusers/training/dreambooth" target="_blank" aria-label="personalize - Opens in a new window" rel="noopener nofollow">personalize</a> Stable Diffusion, extend it to <a href="https://huggingface.co/rinna/japanese-stable-diffusion" target="_blank" aria-label="languages other than English - Opens in a new window" rel="noopener nofollow">languages other than English</a>, and more, thanks to open-source projects like <a href="https://github.com/huggingface/diffusers" target="_blank" aria-label="Hugging Face diffusers - Opens in a new window" rel="noopener nofollow">Hugging Face diffusers</a>.</p><p>Beyond image generation from text prompts, developers are also discovering other creative uses for Stable Diffusion, such as image editing, in-painting, out-painting, super-resolution, style transfer and even color palette generation. With the growing number of applications of Stable Diffusion, ensuring that developers can leverage this technology effectively is important for creating apps that creatives everywhere will be able to use.</p><p>One of the key questions for Stable Diffusion in any app is where the model is running. There are a number of reasons why on-device deployment of Stable Diffusion in an app is preferable to a server-based approach. First, the privacy of the end user is protected because any data the user provided as input to the model stays on the user&#39;s device. Second, after initial download, users donâ€™t require an internet connection to use the model. Finally, locally deploying this model enables developers to reduce or eliminate their server-related costs.</p><p>Getting to a compelling result with Stable Diffusion can require a lot of time and iteration, so a core challenge with on-device deployment of the model is making sure it can generate results fast enough on device. This requires executing a complex pipeline comprising 4 different neural networks totaling approximately 1.275 billion parameters. To learn more about how we optimized a model of this size and complexity to run on the Apple Neural Engine, you can check out our previous article on <a href="https://machinelearning.apple.com/research/neural-engine-transformers">Deploying Transformers on the Apple Neural Engine</a>. The optimization principles outlined in the article generalize to Stable Diffusion despite the fact that it is 19x larger than the model studied in the previous article. Optimizing Core ML for Stable Diffusion and simplifying model conversion makes it easier for developers to incorporate this technology in their apps in a privacy-preserving and economically feasible way, while getting the best performance on Apple Silicon.</p><p>This release comprises a Python package for converting Stable Diffusion models from PyTorch to Core ML using diffusers and coremltools, as well as a Swift package to deploy the models. To get started, visit the <a href="https://github.com/apple/ml-stable-diffusion" target="_blank" aria-label="Core ML Stable Diffusion - Opens in a new window" rel="noopener nofollow">Core ML Stable Diffusion</a> code repository for detailed instructions on benchmarking and deployment.</p></div></div></div></section></div>
  </body>
</html>
