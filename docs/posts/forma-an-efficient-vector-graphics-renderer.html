<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/google/forma">Original</a>
    <h1>Show HN: forma: An efficient vector-graphics renderer</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/google/forma/blob/main/assets/images/logo.png?raw=true"><img src="https://github.com/google/forma/raw/main/assets/images/logo.png?raw=true" alt="forma logo"/></a></p>
<p dir="auto"><a href="https://crates.io/crates/forma-render" rel="nofollow"><img src="https://camo.githubusercontent.com/096018b4259fa77edcdbddb80a1aa73953025101c87afbf0922dd992155d2d4a/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f666f726d612d72656e6465723f7374796c653d666f722d7468652d6261646765" alt="crates.io badge" data-canonical-src="https://img.shields.io/crates/v/forma-render?style=for-the-badge"/></a> <a href="https://discord.gg/CYtcmqgh" rel="nofollow"><img src="https://camo.githubusercontent.com/63c5b36d9a2c4f37e066c4cbbfb109bbcef2c676c06aff11ac60728f9a7ca1e2/68747470733a2f2f646362616467652e76657263656c2e6170702f6170692f7365727665722f435974636d716768" alt="" data-canonical-src="https://dcbadge.vercel.app/api/server/CYtcmqgh"/></a></p>
<p dir="auto">A (thouroughly) parallelized <strong>experimental</strong> Rust vector-graphics renderer with both a software (CPU) and hardware (GPU)
back-end having the following goals, in this order:</p>
<ol dir="auto">
<li><strong>Portability</strong>; supporting Fuchsia, Linux, macOS, Windows, Android &amp; iOS.</li>
<li><strong>Performance</strong>; making use of compute-focused pipeline that is highly parallelized both at the instruction-level and the thread-level.</li>
<li><strong>Simplicity</strong>; implementing an easy-to-understand 4-stage pipeline.</li>
<li><strong>Size</strong>; minimizing the number of dependencies and focusing on vector-graphics only.</li>
</ol>
<p dir="auto">It relies on Rust&#39;s SIMD auto-vectorization/intrinsics and <a href="https://github.com/rayon-rs/rayon">Rayon</a> to have good performance on the CPU, while using <a href="https://github.com/gpuweb/gpuweb">WebGPU</a> (<a href="https://wgpu.rs/" rel="nofollow">wgpu</a>) to take advantage of the GPU.</p>
<h2 dir="auto"><a id="user-content-getting-started" aria-hidden="true" href="#getting-started"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Getting started</h2>
<p dir="auto">Add the following to your <code>Cargo.toml</code> dependencies:</p>
<div dir="auto" data-snippet-clipboard-copy-content="forma = { version = &#34;0.1.0&#34;, package = &#34;forma-render&#34; }"><pre><span>forma</span> = { <span>version</span> = <span><span>&#34;</span>0.1.0<span>&#34;</span></span>, <span>package</span> = <span><span>&#34;</span>forma-render<span>&#34;</span></span> }</pre></div>
<h2 dir="auto"><a id="user-content-4-stage-pipeline" aria-hidden="true" href="#4-stage-pipeline"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>4-stage Pipeline</h2>
<table>
<thead>
<tr>
<th>1. Curve flattening</th>
<th>2. Line segment rasterization</th>
<th>3. Sorting</th>
<th>4. Painting</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bézier curves</td>
<td>line segments</td>
<td>pixel segments</td>
<td>sorted pixel segments, old tiles</td>
</tr>
<tr>
<td><g-emoji alias="arrow_down" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b07.png">⬇️</g-emoji><g-emoji alias="arrow_down" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b07.png">⬇️</g-emoji><g-emoji alias="arrow_down" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b07.png">⬇️</g-emoji></td>
<td><g-emoji alias="arrow_down" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b07.png">⬇️</g-emoji><g-emoji alias="arrow_down" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b07.png">⬇️</g-emoji><g-emoji alias="arrow_down" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b07.png">⬇️</g-emoji></td>
<td><g-emoji alias="arrow_down" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b07.png">⬇️</g-emoji><g-emoji alias="arrow_down" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b07.png">⬇️</g-emoji><g-emoji alias="arrow_down" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b07.png">⬇️</g-emoji></td>
<td><g-emoji alias="arrow_down" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b07.png">⬇️</g-emoji><g-emoji alias="arrow_down" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b07.png">⬇️</g-emoji><g-emoji alias="arrow_down" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b07.png">⬇️</g-emoji></td>
</tr>
<tr>
<td>line segments</td>
<td>pixel segments</td>
<td>sorted pixel segments</td>
<td>freshly painted tiles</td>
</tr>
</tbody>
</table>
<h2 dir="auto"><a id="user-content-implementation-highlights-" aria-hidden="true" href="#implementation-highlights-"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Implementation Highlights <g-emoji alias="sparkles" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2728.png">✨</g-emoji></h2>
<p dir="auto">Here are a few implementation highlights that make forma stand out from commonly used vector renderers.</p>
<details>
<summary>Curvature-aware flattening</summary>
<p dir="auto">All higher cubic Béziers are approximated by quadratic ones, then, in parallel, flattened to line segments according to their curvature. This <a href="https://raphlinus.github.io/graphics/curves/2019/12/23/flatten-quadbez.html" rel="nofollow">technique</a> was developed by Raph Levien.</p>
</details>
<details>
<summary>Cheap translations and rotations</summary>
<p dir="auto">Translations and rotations can be rendered without having to re-flatten the curves, all the while maintaining full quality.</p>
</details>
<details>
<summary>Parallel pixel grid intersection</summary>
<p dir="auto">Line segments are transformed into pixel segments by intersecting them with the pixel grid. We developed a simple method that performs this computation in <em>O(1)</em> and which is run in parallel.</p>
</details>
<details>
<summary>Efficient sorting</summary>
<p dir="auto">We ported <a href="https://github.com/google/crumsort-rs">crumsort</a> to Rust and parallelized it with Rayon, delivering improved performance over its pdqsort implementation for 64-bit random data. Scattering pixel segments with a sort was inspired from Allan MacKinnon&#39;s work on <a href="https://cs.opensource.google/fuchsia/fuchsia/+/main:src/graphics/lib/compute/spinel/" rel="nofollow">Spinel</a>.</p>
</details>
<details>
<summary>Update only the tiles that change (currently CPU-only)</summary>
<p dir="auto">We implemented a fail-fast per-tile optimizer that tries to skip the painting step entirely. A similar approach could also be tested on the GPU.</p>
</details>
<table>
<thead>
<tr>
<th>Animation as it appears on the screen</th>
<th>Updated tiles only</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/google/forma/blob/main/assets/images/spaceship.webp?raw=true"><img src="https://github.com/google/forma/raw/main/assets/images/spaceship.webp?raw=true" alt=""/></a></td>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/google/forma/blob/main/assets/images/spaceship-damage.webp?raw=true"><img src="https://github.com/google/forma/raw/main/assets/images/spaceship-damage.webp?raw=true" alt="juice animation updated tiles"/></a></td>
</tr>
</tbody>
</table>
<p dir="auto">You can run the demo above with:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo run --release -p demo -- spaceship"><pre>cargo run --release -p demo -- spaceship</pre></div>
<h2 dir="auto"><a id="user-content-similar-projects" aria-hidden="true" href="#similar-projects"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Similar Projects</h2>
<p dir="auto">forma draws heavy inspiration from the following projects:</p>
<ul dir="auto">
<li><a href="https://cs.opensource.google/fuchsia/fuchsia/+/main:src/graphics/lib/compute/spinel/" rel="nofollow">Spinel</a>, with a Vulkan 1.2 back-end</li>
<li><a href="https://github.com/linebender/vello">vello</a>, with a wgpu back-end</li>
</ul>
<h2 dir="auto"><a id="user-content-example" aria-hidden="true" href="#example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Example</h2>
<p dir="auto">You can use the included <code>demo</code> example to render a few examples, one of which is a non-compliant &amp; incomplete SVG renderer:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo run --release -p demo -- svg assets/svgs/paris-30k.svg"><pre>cargo run --release -p demo -- svg assets/svgs/paris-30k.svg</pre></div>
<p dir="auto">It renders enormous SVGs at interactive framerates, even on CPU: (<a href="https://github.com/google/forma/blob/main/assets/svgs/paris-30k.svg?raw=true">compare to your web browser</a>)</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/google/forma/blob/main/assets/images/paris-30k-rendered.png?raw=true"><img src="https://github.com/google/forma/raw/main/assets/images/paris-30k-rendered.png?raw=true" alt="window rendering map of Germany"/></a></p>
<h2 dir="auto"><a id="user-content-currently-missing-pieces-" aria-hidden="true" href="#currently-missing-pieces-"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>(Currently) Missing Pieces <g-emoji alias="jigsaw" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f9e9.png">🧩</g-emoji></h2>
<p dir="auto">Since this project is work-in-progress, breakage in the API, while not drastic, is expected. The performance on the GPU back-end is also expected to improve especially on mobile where performance is known to be poor and where the CPU back-end is currently advised instead.</p>
<p dir="auto">Other than that:</p>
<ul dir="auto">
<li>Automated layer ordering</li>
<li>Strokes</li>
<li>More color spaces for blends &amp; gradients</li>
<li>Faster GPU sorter</li>
<li>Use of <code>f16</code> for great mobile GPU performance</li>
</ul>
<h2 dir="auto"><a id="user-content-note" aria-hidden="true" href="#note"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Note</h2>
<p dir="auto">This is not an officially supported Google product.</p>
</article>
          </div></div>
  </body>
</html>
