<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.datagubbe.se/adosmyst/">Original</a>
    <h1>Well-Known Secrets of AmigaDOS</h1>
    
    <div id="readability-page-1" class="page"><div>


<p>
<b>Documented, undocumented, unfinished and useful</b>
</p>
<p>
<i>Early 2024</i>
</p>

<h3>Table of Contents</h3>
<ul>
  <li><a href="#gotdocs">Got docs?</a> - Introduction</li>
  <li><a href="#wildstar">Wildstar</a> - There&#39;s a new joker in town</li>
  <li><a href="#scripts">Additional scripts</a> - Commodore&#39;s little helpers</li>
  <li><a href="#coned">CON ED</a> - Editing without an editor</li>
  <li><a href="#debug">Flush, flush, wack</a> - Hidden developer tools</li>
  <li><a href="#pchar">Pipe dreams</a> - Undocumented anonymous pipes</li>
</ul>

<h3 id="gotdocs">Got docs?</h3>
<p>
In keeping with the Commodore tradition of cost cutting, most consumer models of their Amiga line of computers came with severely watered down documentation. The Amiga 500 was an exception from this rule, but owners of later machines - such as the A1200 - may not have gotten any documentation for the command line part of AmigaOS at all.
</p>
<p>
And, of course, even if this documentation had shipped with the machines, it wouldn&#39;t have revealed features that were hidden to anyone without access to official developer documentation or even left completely undocumented or unfinished.
</p>

<p>
This is a quick look at a few of these interesting features, some more obscure than others, but all of them decidedly useful. Most of them only apply to versions 2.x and/or 3.x of the OS. With that said, let&#39;s dive right in!
</p>

<h3 id="wildstar">Wildstar</h3>
<p>
In AmigaDOS pattern matching, the two characters <b>#?</b> (hash and question 
mark) are the equivalent of the UNIX and DOS wildcard <b>*</b> (asterisk). The 
hash means &#34;any number of occurances&#34; and the question mark means &#34;any 
character&#34;: match any 
number of occurances of any character. This is all good and well and makes perfect 
sense 
according to the pattern matching rules of AmigaDOS, but it might also feel a bit cumbersome to type for someone used to the instant gratification of just sprinkling their command lines with asterisks.
</p>
<p>
Commodore&#39;s solution to this was to introduce an in-memory flag that could be toggled to enable using an asterisk as a wildcard in AmigaDOS. At the same time, they introduced similar flags to toggle the floppy drive seek behavior. If empty, all Amiga floppy drives make little clicking noises with regular intervals, when the drive mechanism checks to see if a disk has been inserted. When more users bought hard drives (which meant their floppy drives weren&#39;t always occupied), this sound became something of a nuisance and Commodore decided to make it possible to mitigate it somewhat.
</p>
<p>
<img src="https://www.datagubbe.se/adosmyst/pic/wildstar.png"/>
</p>
<p>
The strange thing is that although these flags were introduced in AmigaDOS 2.0, they remained officially unreachable for end users. It would have made perfect sense for Commodore to introduce a Preferences (system settings) program for them, but it just never materialized. Most users had to rely on third party sources and programs to learn about and utilize these nifty features.
</p>

<h3 id="scripts">Additional Scripts</h3>
<p>
Speaking of wildcards, AmigaDOS works completely unlike for example UNIX in this regard. Instead of the shell doing this kind of pattern matching, it&#39;s up to every single command to implement this itself (through a well defined API). This means that some commands - mostly third party ones - simply won&#39;t accept wildcards, because the author decided to omit them for some reason.
</p>
<p>
Luckily, AmigaDOS offers a (for its time) perfectly serviceable scripting language. Commodore used this to create three scripts as part of the standard AmigaDOS distribution: <b>PCD</b>, an wrapper for the CD command that remembers the previously visited directory (sort of like <b>cd -</b> in Bash), <b>SPat</b> and <b>DPat</b>. The latter ones act as wildcard-enabled wrappers for arbitrary commands, letting the user do pattern-matching to their heart&#39;s content.
</p>
<p>
<img src="https://www.datagubbe.se/adosmyst/pic/scripts.png"/>
</p>
<p>
<img src="https://www.datagubbe.se/adosmyst/pic/spathead.png"/>
</p>

<h3 id="coned">CON ED</h3>
<p>
Just like UNIX and DOS, AmigaDOS offers ways of creating text files without the use of an actual text editor. Output redirection is one example, but all the cool kids copy CON: to the desired file.
</p>
<p>
MS-DOS aficionados might recognize this, but the the Amiga 1) multi-tasks and 2) has no real text mode. Thus, a brand new console window is opened in which the user can type the text.
</p>
<p>
<img src="https://www.datagubbe.se/adosmyst/pic/copycon1.png"/>
</p>
<p>
The text is then saved by pressing CTRL-\ to abort, upon which the freshly opened console window also automatically closes itself.
</p>
<p>
<img src="https://www.datagubbe.se/adosmyst/pic/copycon2.png"/>
</p>
<p>
If you don&#39;t want a new console window to open, you can use &#34;*&#34; in place of CON:, like so:
</p>

<h3 id="debug">Flush, flush, wack</h3>
<p>
Although the Amiga has no real text mode, the default behavior is to boot into a CON: window with a command interpreter rather than the Workbench desktop environment. Workbench is started by using the <b>loadwb</b> command, followed by an <b>endcli</b> to close the console. This if of course the standard on all hard drive systems and many a bootable floppy.
</p>
<p>
What&#39;s less known is perhaps that loadwb in fact takes arguments - one of which is the &#34;-debug&#34; flag. This is an interesting flag not just because it follows the UNIX dash standard otherwise not employed in AmigaDOS, but because it adds a whole new pull-down menu to the Workbench.
</p>
<p>
<img src="https://www.datagubbe.se/adosmyst/pic/debug.png"/>
</p>
<p>
The two menu options added, ROMWack and flushlibs, are intended for developers. However, the flushlibs option might be interesting for normal users as well - it performs the equivalent of the AmigaDOS command <b>avail flush</b>, unloading unused shared function libraries from RAM. This is useful if you&#39;re a developer and want to reload them from disk, but it also frees up precious RAM for loading other applications that might not rely on the same libraries.
</p>
<p>
Alas, most users are probably better adviced to simply run &#34;avail flush&#34; when necessary. Flushlibs is dangerously close to ROMWack, and a misclick on this option will freeze the whole computer and launch a debug console on the serial port. Unless you&#39;ve got some kind of terminal already connected, all you can do to abort this is to reboot the machine.
</p>

<h3 id="pchar">Pipe Dreams</h3>
<p>
Later versions of AmigaDOS sports named pipes - that is, you can redirect output 
from one program to, for example, the path &#34;PIPE:SomeName&#34; and then read from the 
same path using another program. It works and it gets the job done, but it lacks 
the simple elegance of UNIX-style anonymous pipes.
</p>
<p>
In my experience, this isn&#39;t much of a problem. My workflow on the Amiga is different from that on UNIX machines - which is one of the things I like about it. There are third party shells for the Amiga that does feature UNIX style pipes, but I&#39;ve never bothered installing one. Also, writing lengthy pipelines may be fun, but executing them on a 7 MHz or 14 MHz computer isn&#39;t equally satisfying.
</p>
<p>
Still. Sometimes, just sometimes, I do yearn for that smooth UNIX pipe feeling. And, apparently, so did the developers at Commodore. Thus, in AmigaDOS 2.04, they invented the undocumented shell variables _PCHAR and _MCHAR.
</p>
<p>
If _PCHAR is set to a specific character (such as &#34;|&#34;), any command line that includes this character will trigger a very specific behavior in the shell: it will look for an executable called <b>pipe</b> in the path and invoke that, passing it the complete triggering command line as an argument. The same goes for _MCHAR.
</p>
<p>
<img src="https://www.datagubbe.se/adosmyst/pic/pchar.png"/>
</p>
<p>
This of course means that a program capable of parsing such a command line (including more or less finicky bits like quoting) and handling all the process spawning and input and output redirection via named pipes must be written. Once people learned about this feature (somehow), such third party software naturally appeared - but just as with the wildstar flag, I personally don&#39;t understand why Commodore didn&#39;t make it more of an official part of their OS distribution in later AmigaDOS releases.
</p>

<h3>Well-known secrets</h3>
<p>
These various features are hardly unknown - some are even thoroughly documented - and yet they fascinate me. As a kid I never had a decent AmigaDOS manual and whenever I got wise to one of its many cool features, it made me feel like a proper Amiga pro. Perhaps this text can spread a bit of that sweet, geeky joy.
In any case, take care and happy hacking!</p>


</div></div>
  </body>
</html>
