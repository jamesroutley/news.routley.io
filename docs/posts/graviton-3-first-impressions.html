<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/">Original</a>
    <h1>Graviton 3: First Impressions</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>In late May of 2022, AWS released Graviton 3 to the general public. Graviton 3 was the first ARM CPU to introduce the SVE instruction set to a widely accessible server CPU. </p>
<p>Before Graviton 3’s general availability, Neoverse N1 dominated the ARM server landscape. AWS’s previous flagship offering, Graviton 2, implements 64 Neoverse N1 cores at 2.5 GHz. Microsoft’s Azure and Oracle’s OCI both use Ampere Altra, which puts 80 Neoverse N1 cores on mesh and clocks them at 3 GHz. We’ll therefore draw comparisons between Graviton 3 and Neoverse N1. We’ll supplement that with data on AMD’s Zen 3 and Intel’s Ice Lake SP (Sunny Cove). As of mid 2022, those are the newest widely deployed x86 chips used in cloud environments and will therefore be Graviton 3’s most immediate competitors.</p>
<p><a href="https://www.nextplatform.com/2022/01/04/inside-amazons-graviton3-arm-server-processor/">TheNextPlatform</a> makes a convincing argument that Graviton 3 is based off a modified Neoverse V1 core. </p>
<div>
<figure><img data-attachment-id="7634" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/graviton3/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3.png?fit=1611%2C1110&amp;ssl=1" data-orig-size="1611,1110" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="graviton3" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3.png?fit=1611%2C1110&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3.png?fit=688%2C474&amp;ssl=1" width="688" height="474" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3.png?resize=688%2C474&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3.png?w=1611&amp;ssl=1 1611w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3.png?resize=768%2C529&amp;ssl=1 768w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3.png?resize=1536%2C1058&amp;ssl=1 1536w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3.png?resize=1200%2C827&amp;ssl=1 1200w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3.png?resize=1600%2C1102&amp;ssl=1 1600w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3.png?resize=1320%2C909&amp;ssl=1 1320w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3.png?w=1376&amp;ssl=1 1376w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<h2>Branch Prediction: A Huge Step Forward</h2>
<p>Compared to N1, ARM has dramatically improved the branch predictor and makes large strides in both speed and accuracy. A quick glance at Graviton 3’s pattern recognition capabilities makes it clear that it’s a completely different class from N1. </p>
<figure><p><img loading="lazy" id="7462" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3_branchhist.png?ssl=1" alt="" width="1155" height="679"/><img loading="lazy" id="7463" src="https://i2.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/n1_branchhist.png?ssl=1" alt="" width="1153" height="678"/></p></figure>
<p>In the cloud market, Graviton 3’s primary x86 competition will be Intel’s Ice Lake SP and AMD’s Zen 3 based Milan. Zen 3 seems to use an overriding predictor with an incredibly capable but slightly slower second level, while Ice Lake’s takes a very similar approach to Graviton 3. Both Intel and ARM appear to use a single level predictor that can recognize very long patterns, though not to the same extent as AMD. </p>
<figure><p><img loading="lazy" id="7462" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3_branchhist.png?ssl=1" alt="" width="1155" height="679"/><img loading="lazy" id="7464" src="https://i1.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/zen3_branchhist.png?ssl=1" alt="" width="1155" height="677"/></p></figure>
<p>When a lot of branches are in play, Ice Lake holds a small advantage over Graviton 3. Graviton 3 can recognize patterns up to 16 long with 512 branches, while Ice Lake can handle patterns twice as long at the same branch count. Again, AMD seems to have a ton of branch history storage, as its able to handle patterns up to 96 long with 512 branches.</p>
<figure><p><img loading="lazy" id="7462" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/graviton3_branchhist.png?ssl=1" alt="" width="1155" height="679"/><img loading="lazy" id="7471" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/icl_branchhist.png?ssl=1" alt="" width="1155" height="682"/></p></figure>
<p>Graviton 3 also has an impressively fast BTB (branch target buffer) setup, letting it handle taken branches with very little penalty. A micro-BTB allows the core to handle two taken branches per cycle, a capability that we’ve only seen on Golden Cove and Rocket Lake so far. But Graviton 3’s micro-BTB capacity is bigger than the equivalent on those Intel CPUs. Golden Cove can only track 32 branches and handle them at two per cycle, while Rocket Lake can do so with eight.</p>
<div>
<figure><img data-attachment-id="7474" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/image-17-12/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-17.png?fit=1095%2C559&amp;ssl=1" data-orig-size="1095,559" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-17" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-17.png?fit=1095%2C559&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-17.png?fit=688%2C351&amp;ssl=1" loading="lazy" width="688" height="351" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-17.png?resize=688%2C351&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-17.png?w=1095&amp;ssl=1 1095w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-17.png?resize=768%2C392&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<p>ARM has also equipped Graviton 3 with a very large main BTB that probably has 4K entries, and a L2 BTB that could have up to 10K entries. The main BTB provides zero-bubble taken branch capability that exceeds Zen 3’s. Even hitting the L2 BTB is not very expensive, with just one or two pipeline bubbles per branch with 10K branches in play. So far, we’ve only seen Golden Cove implement a bigger BTB.</p>
<div>
<figure><img data-attachment-id="7478" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/image-18-11/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-18.png?fit=1094%2C558&amp;ssl=1" data-orig-size="1094,558" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-18" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-18.png?fit=1094%2C558&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-18.png?fit=688%2C351&amp;ssl=1" loading="lazy" width="688" height="351" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-18.png?resize=688%2C351&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-18.png?w=1094&amp;ssl=1 1094w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-18.png?resize=768%2C392&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<p>All in all, Graviton 3 has a branch predictor that’s comparable to the best from Intel and AMD. Each CPU manufacturer makes different tradeoffs, and each branch predictor has its unique advantages, but Graviton 3’s predictor shows ARM’s determination to compete with the best around. It’s a huge step away from the mediocre implementation in Neoverse N1 and should go a long way to making the most out of Graviton 3’s increased reordering capacity. </p>
<h2>Frontend: A Familiar Pattern, with Tricks</h2>
<p>Graviton 2 and 3 both feature a four-wide decoder, but the difference ends there. Behind the decoder, ARM has implemented a large micro-op cache with 3K entries. Graviton 3’s frontend therefore shows a passing resemblance to those of Intel and AMD.</p>
<div>
<figure><a href="https://chipsandcheese.com/?attachment_id=7491"><img data-attachment-id="7491" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/g3_frontend/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_frontend.png?fit=1626%2C366&amp;ssl=1" data-orig-size="1626,366" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="g3_frontend" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_frontend.png?fit=1626%2C366&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_frontend.png?fit=688%2C155&amp;ssl=1" loading="lazy" width="688" height="155" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_frontend.png?resize=688%2C155&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_frontend.png?w=1626&amp;ssl=1 1626w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_frontend.png?resize=768%2C173&amp;ssl=1 768w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_frontend.png?resize=1536%2C346&amp;ssl=1 1536w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_frontend.png?resize=1200%2C270&amp;ssl=1 1200w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_frontend.png?resize=1600%2C360&amp;ssl=1 1600w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_frontend.png?resize=1320%2C297&amp;ssl=1 1320w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_frontend.png?w=1376&amp;ssl=1 1376w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></a></figure></div>
<p>Compared to Neoverse N1, Graviton 3’s decoders are far more capable. They’re capable of fusing a variety of instruction pairs. This includes x86-style jump fusion, where a flag-setting instruction and adjacent conditional jump can be fused into a single micro-op. To make our lives difficult, Graviton 3 also implements CNS-style NOP fusion. Pairs of NOPs can be fused into a single micro-op in the frontend. Because Graviton 3 has micro-op cache capable of caching fused micro-ops, NOPs will execute at 12 per cycle.</p>
<div>
<figure><img data-attachment-id="7495" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/image-19-12/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-19.png?fit=1067%2C492&amp;ssl=1" data-orig-size="1067,492" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-19" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-19.png?fit=1067%2C492&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-19.png?fit=688%2C317&amp;ssl=1" loading="lazy" width="688" height="317" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-19.png?resize=688%2C317&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-19.png?w=1067&amp;ssl=1 1067w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-19.png?resize=768%2C354&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/><figcaption>Graviton 3’s NOP fusion breaks out basic instruction fetch bandwidth test, with hilarious but unrealistic results from the micro-op cache.</figcaption></figure></div>
<p>To get around this, we filled the test array with instructions that simply set a register to zero. These can’t be fused the same way NOPs can, but can pass through the renamer at 6 per cycle and are eliminated there.</p>
<p>In terms of instruction fetch bandwidth, Graviton 3 shows similar characteristics to Zen 3. Both have large micro-op caches, and both can sustain 6 IPC. Beyond L2, Zen 3 has a substantial advantage, because AMD’s architecture prioritizes L3 performance instead of trying to create single unified cache across the chip. Compared to its predecessor on the cloud scene, Neoverse N1, Graviton 3 enjoys increased instruction bandwidth thanks to its micro-op cache. Fetch bandwidth from L1D seems to be equal as both architectures (actually all architectures in this comparison) use 4-wide decoders. But further down the cache hierarchy, Graviton 3 enjoys far better instruction bandwidth.</p>
<div>
<figure><img data-attachment-id="7498" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/image-20-10/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-20.png?fit=1061%2C494&amp;ssl=1" data-orig-size="1061,494" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-20" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-20.png?fit=1061%2C494&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-20.png?fit=688%2C320&amp;ssl=1" loading="lazy" width="688" height="320" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-20.png?resize=688%2C320&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-20.png?w=1061&amp;ssl=1 1061w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-20.png?resize=768%2C358&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<p>ARM has likely given Graviton 3 deeper fetch queues, letting the core use its large BTB to aggressively prefetch instructions. That’s complemented by Graviton 3’s superior L3 implementation, which provides lower latency compared to Ampere Altra and Graviton 2. Fetch bandwidth for very large instruction footprints still isn’t comparable to that of Intel’s Ice Lake SP or AMD’s Milan, but ARM is definitely making progress. </p>
<p>We’ve also seen various sources state that Neoverse V1 has a 5-wide instruction decoder. If Graviton 3 is based off V1, the decoder seems to have been cut down to 4-wide. Once we leave the 3K entry micro-op cache, we don’t see more than 4 instructions per cycle even when the test loop fits within the 64 KB L1 instruction cache. The same test instructions can exceed 4-per-cycle throughput when running from the micro-op cache, pointing to a fetch and decode bandwidth throughput limitation, rather than a pipeline bottleneck further on.</p>
<h2>Graviton 3’s Renamer: Emerging Capabilities</h2>
<p>Graviton 3’s renamer appears to be 6 wide, letting the core match Zen 3 in overall width. In terms of renamer optimizations, Graviton 3 makes improvements over Neoverse N1. But being a CPU maker is hard, because your competitors are always improving too. AMD introduced extremely capable move elimination with Zen, while Intel did the same with Sunny Cove. Both of those x86 CPUs can eliminate register to register move instructions at a rate matching the renamer’s width. </p>
<figure><table><tbody><tr><td></td><td>Graviton 3</td><td>Ampere Altra (Neoverse N1)</td><td>Ice Lake (Sunny Cove)</td><td>Zen 3</td></tr><tr><td>Independent MOV r,r</td><td>3.81</td><td>2.86</td><td>4.77</td><td>5.72</td></tr><tr><td>Dependent MOV r,r</td><td>1.36</td><td>1.38</td><td>4.76</td><td>5.7</td></tr><tr><td>XOR / EOR r,r</td><td>1.00</td><td>1.00</td><td>3.81</td><td>5.72</td></tr><tr><td>MOV r, 0</td><td>5.71</td><td>3.63</td><td>3.82</td><td>3.81</td></tr><tr><td>SUB r,r</td><td>1.00</td><td>1.00</td><td>3.81</td><td>5.7</td></tr></tbody></table></figure>
<p>Graviton 3 cannot do the same. MOVs are clearly not eliminated, because throughput appears limited by ALU port count. Like Neoverse N1, Graviton 3 can sometimes break dependencies between register to register MOVs, but has very limited capabilities in that area. </p>
<p>The rename stage can also break dependencies and/or eliminate instructions that set a register to zero regardless of its previous value. From what we can tell, only move-zero-to-register instructions are completely eliminated, and achieve a throughput equal to the renamer’s width. Graviton 3 has an advantage over Ice Lake in this regard, as Intel’s renamer can break dependencies when zeroing idioms are detected, but cannot eliminate them. Zen 3 has equivalent capability – it can recognize common x86 zeroing idoms and eliminate them. </p>

<h2>Out of Order Structure Sizes</h2>
<p>We’re still busy picking apart AWS’s new cloud CPU. In this preview, we’re going to present some raw test results and plausible explanations, since the results are not always straight forward. </p>
<p>Let’s start with the reorder buffer size. The size of this structure corresponds to how many micro-ops the CPU’s execution engine can track. Normally we’d test this with NOPs, but Graviton 3’s NOP fusion capability complicates result interpretation. A test with NOPs suggests that Graviton 3’s ROB has 512 entries. But the ROB’s actual capacity could be 256 entries, if each entry is storing a fused micro-op that represents two NOPs.</p>
<div>
<figure><img data-attachment-id="7509" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/image-21-10/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-21.png?fit=852%2C424&amp;ssl=1" data-orig-size="852,424" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-21" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-21.png?fit=852%2C424&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-21.png?fit=688%2C342&amp;ssl=1" loading="lazy" width="688" height="342" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-21.png?resize=688%2C342&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-21.png?w=852&amp;ssl=1 852w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-21.png?resize=768%2C382&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<p>So, we ran an additional test that alternates between integer and FP instructions. Reordering capacity with this test exceeds 256 entries, suggesting that Graviton 3 indeed has 512 ROB entries, and fused NOPs are un-fused after they pass the renamer. If this interpretation is correct, ARM has given Graviton 3 an out of order window larger than that of Zen 3 and Ice Lake.</p>
<p>As we move on to reverse engineering register file sizes, another quirk shows up. Graviton 3 seems to have 125 vector registers that are 256-bit wide, but can use a single vector register to track two scalar FP registers. Strangely, it doesn’t seem capable of using a single 256-bit SVE register to track two 128-bit NEON registers. </p>
<div>
<figure><img data-attachment-id="7514" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/image-22-9/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-22.png?fit=857%2C428&amp;ssl=1" data-orig-size="857,428" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-22" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-22.png?fit=857%2C428&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-22.png?fit=688%2C344&amp;ssl=1" loading="lazy" width="688" height="344" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-22.png?resize=688%2C344&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-22.png?w=857&amp;ssl=1 857w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-22.png?resize=768%2C384&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<p>Another strange observation is that Graviton 3’s register files are more appropriately sized for a 256 entry ROB, if we exclude the core’s huge renaming capacity for scalar floating point registers.</p>
<div>
<figure><img data-attachment-id="7529" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/image-24-8/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-24.png?fit=992%2C451&amp;ssl=1" data-orig-size="992,451" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-24" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-24.png?fit=992%2C451&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-24.png?fit=688%2C313&amp;ssl=1" loading="lazy" width="688" height="313" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-24.png?resize=688%2C313&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-24.png?w=992&amp;ssl=1 992w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-24.png?resize=768%2C349&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<p>Graviton 3’s load queue capacity also stands out. Other structure sizes remain modest and roughly in line with what we see on Zen 2 and Zen 3. </p>
<h3>Scheduler Layout</h3>
<div>
<figure><img data-attachment-id="7592" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/g3_mathscheduling/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_mathscheduling.png?fit=1096%2C546&amp;ssl=1" data-orig-size="1096,546" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="g3_mathscheduling" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_mathscheduling.png?fit=1096%2C546&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_mathscheduling.png?fit=688%2C343&amp;ssl=1" loading="lazy" width="688" height="343" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_mathscheduling.png?resize=688%2C343&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_mathscheduling.png?w=1096&amp;ssl=1 1096w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_mathscheduling.png?resize=768%2C383&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/><figcaption>Trying to figure out scheduler sizes takes way too many tests</figcaption></figure></div>
<p>Reverse engineering a distributed scheduler layout is very difficult, time consuming, and error prone. It’s why this is a preview rather than a proper deep dive. Instead of testing a ton of instruction types and combinations to come up with a mostly plausible scheduler layout, we’ll present approximate measured scheduler capacities for a few instruction types.</p>
<figure><table><tbody><tr><td></td><td>Graviton 3 Scheduler Entries</td><td></td></tr><tr><td>Integer Add</td><td>81</td><td></td></tr><tr><td>Integer Multiply</td><td>44</td><td></td></tr><tr><td>Branch (Not Taken)</td><td>43</td><td></td></tr><tr><td>Alternating Integer Multiply and Branch</td><td>82</td><td></td></tr><tr><td>Scalar FP Add</td><td>54</td><td></td></tr><tr><td>Scalar FP Multiply</td><td>54</td><td></td></tr><tr><td>Alternating FP Add and Multiply</td><td>54</td><td></td></tr><tr><td>256-bit SVE FP Add</td><td>56</td><td></td></tr><tr><td>Convert Integer to FP</td><td>22</td><td></td></tr><tr><td>Store, Address Dependency</td><td>28?</td><td></td></tr><tr><td>Store, Data Dependency</td><td>28?</td><td></td></tr><tr><td>Load</td><td>54?</td><td></td></tr><tr><td>Alternating Load/Store, Address Dependency</td><td>54?</td><td></td></tr></tbody></table></figure>
<p>Graviton 3 has plenty of scheduler entries to go around for common operations. While we still aren’t certain about exactly how the scheduler is laid out, it’s clear that Graviton 3 is a big jump over Neoverse N1. At first glance, it seems roughly comparable to Zen 3 and Ice Lake, at least in terms of scheduler entries available for common operations. </p>
<p>Here’s one plausible layout for Graviton 3’s scheduler:</p>
<div>
<figure><img data-attachment-id="7593" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/image-32-6/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-32.png?fit=992%2C159&amp;ssl=1" data-orig-size="992,159" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-32" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-32.png?fit=992%2C159&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-32.png?fit=688%2C110&amp;ssl=1" loading="lazy" width="688" height="110" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-32.png?resize=688%2C110&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-32.png?w=992&amp;ssl=1 992w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-32.png?resize=768%2C123&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<h3>Execution Units</h3>
<p>Graviton 3’s execution units are reasonably powerful and in line with what we expect from a high performance core. There are four integer ALUs compared to Neoverse N1’s three, and three memory pipelines versus Neoverse N1’s two. Graviton 3’s floating point and vector execution side gets the biggest upgrade, and feels like a doubling of Neoverse N1’s vector/FP execution resources with a large unified scheduler. 256-bit SVE floating point adds and multiplies can each execute at up to two per clock, giving Graviton 3 comparable floating point throughput to x86 cores with AVX support.</p>
<p>Graviton 3 also inherits Neoverse N1’s vector and floating point execution latencies, except for slightly dropping integer multiply latency.</p>
<figure><table><tbody><tr><td>Op</td><td>Graviton 3</td><td>Neoverse N1</td><td>Zen 3</td><td>Ice Lake SP (Sunny Cove)</td></tr><tr><td>FP Add</td><td>2</td><td>2</td><td>3</td><td>4</td></tr><tr><td>FP Multiply</td><td>3</td><td>3</td><td>3</td><td>4</td></tr><tr><td>FP Fused Multiply+Add</td><td>4</td><td>4</td><td>5</td><td>4</td></tr><tr><td>Vector Integer Add</td><td>2</td><td>2</td><td>1</td><td>1</td></tr><tr><td>Vector Integer Multiply</td><td>4</td><td>5</td><td>3</td><td>10</td></tr></tbody></table><figcaption>Latency for certain operations in cycles. Latencies appear to be the same regardless of vector width, though we haven’t tested the SVE FMA case</figcaption></figure>
<p>Two cycle floating point addition latency is very impressive, and matches Intel’s Golden Cove. Of course, that’s a lot easier to achieve for ARM, since Graviton 3 runs at very low clocks. FP multiplication latency is roughly comparable with that of other server CPUs, and nothing really stands out. Vector integer execution latency is fine as well, if a bit higher than Zen 3 and probably higher than what it should be given Graviton 3’s low clock speed.</p>
<p>In terms of execution throughput, Graviton 3 probably has four 128-bit vector/FP pipes, since it’s able to do more than one SVE instruction per cycle for all of the operations (FP add, FP multiply, integer add) we tested. Theoretically, this would let Graviton 3 achieve impressive throughput for NEON and scalar FP operations, but we weren’t able to exceed three instruction per cycle throughput for NEON FP add/multiply and integer adds. This could be explained by a register file bandwidth limitation, in terms of inputs per cycle needed.</p>
<figure><table><tbody><tr><td>Test Case</td><td>Graviton 3 IPC</td><td>Vector/FP Register Inputs Per Cycle</td><td>Register Read Bandwidth Used @ 2.6 GHz</td><td>Max IPC with 4 Symmetrical FP/Vec Pipes</td><td>Vec/FP Reg Inputs Needed for Max</td></tr><tr><td>128-bit vector FP32 add</td><td>2.5</td><td>5</td><td>208 GB/s</td><td>4</td><td>8</td></tr><tr><td>Scalar FP32 add</td><td>2.5</td><td>5</td><td>52 GB/s</td><td>4</td><td>8</td></tr><tr><td>128-bit vector FP32 multiply</td><td>1.67</td><td>3.34</td><td>138.94 GB/s</td><td>4</td><td>8</td></tr><tr><td>128-bit vector integer add</td><td>2.5</td><td>5</td><td>208 GB/s</td><td>4</td><td>8</td></tr><tr><td>1:1 mixed 128-bit vector FMA/FADD</td><td>2.5</td><td>6.25</td><td>260 GB/s</td><td>4</td><td>10</td></tr><tr><td>1:1 mixed 128-bit vector FMA/FMUL per clk: 2.50</td><td>2.5</td><td>6.25</td><td>260 GB/s</td><td>4</td><td>10</td></tr><tr><td>Scalar FMA</td><td>2.5</td><td>7.5</td><td>78 GB/s</td><td>4</td><td>12</td></tr><tr><td>SVE FP32 Add</td><td>1.7</td><td>3.4</td><td>282.8 GB/s</td><td>2</td><td>4</td></tr><tr><td>SVE FP32 Multiply</td><td>1.44</td><td>2.88</td><td>239.616 GB/s</td><td>2</td><td>4</td></tr></tbody></table></figure>
<p>Still, more testing has to be done to verify this.</p>
<h2>Cache and Memory Access</h2>
<h3>Latency</h3>
<p>Graviton 3 retains a 4 cycle, 64 KB L1D. However, ARM has improved latency throughout the cache hierarchy. L2 capacity has stayed the same, while latency drops by two cycles. L3 latency was horrible on Ampere Altra, and it’s thankfully much better with Graviton 3. </p>
<div>
<figure><img data-attachment-id="7533" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/arm_g3_latency_hugepages/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/arm_g3_latency_hugepages.png?fit=936%2C430&amp;ssl=1" data-orig-size="936,430" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="arm_g3_latency_hugepages" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/arm_g3_latency_hugepages.png?fit=936%2C430&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/arm_g3_latency_hugepages.png?fit=688%2C316&amp;ssl=1" loading="lazy" width="688" height="316" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/arm_g3_latency_hugepages.png?resize=688%2C316&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/arm_g3_latency_hugepages.png?w=936&amp;ssl=1 936w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/arm_g3_latency_hugepages.png?resize=768%2C353&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<p>Graviton 2 and Ampere Altra use the same core with identical L2 implementations. The two designs mostly differ in the L3, where Graviton 2 achieves slightly less terrible latency, probably thanks to a smaller mesh. If we plot latencies in actual time, Graviton 3’s lowered cycle counts are somewhat countered by Ampere Altra’s higher clocks. </p>
<div>
<figure><img data-attachment-id="7535" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/image-25-10/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-25.png?fit=936%2C430&amp;ssl=1" data-orig-size="936,430" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-25" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-25.png?fit=936%2C430&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-25.png?fit=688%2C316&amp;ssl=1" loading="lazy" width="688" height="316" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-25.png?resize=688%2C316&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-25.png?w=936&amp;ssl=1 936w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-25.png?resize=768%2C353&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<p>Out in memory, Graviton 3 noticeably regress in latency compared to Ampere Altra and Graviton 2. That’s likely due to DDR5, which has worse latency characteristics than DDR4. <a href="https://semianalysis.com/amazon-graviton-3-uses-chiplets-advanced-packaging-to-commoditize-high-performance-cpus-the-first-pcie-5-0-and-ddr5-server-cpu/">Graviton 3 also places memory controllers on separate IO chiplets</a>. That could exacerbate DDR5’s latency issues. </p>
<p>Ice Lake and Graviton 3 take roughly parallel caching strategies. Both implement a chip-wide unified L3. And both give their cores large private L2 caches to insulate them from L3 latency. AMD takes a different approach, giving up a chip-wide cache in favor of giving each core cluster a very fast L3. </p>
<div>
<figure><img data-attachment-id="7545" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/g3_and_x86_hugepages/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_and_x86_hugepages.png?fit=938%2C430&amp;ssl=1" data-orig-size="938,430" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="g3_and_x86_hugepages" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_and_x86_hugepages.png?fit=938%2C430&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_and_x86_hugepages.png?fit=688%2C315&amp;ssl=1" loading="lazy" width="688" height="315" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_and_x86_hugepages.png?resize=688%2C315&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_and_x86_hugepages.png?w=938&amp;ssl=1 938w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_and_x86_hugepages.png?resize=768%2C352&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<p>The x86 competitors also use architectures that are multi-purpose at heart. Sunny Cove (used in Ice Lake) and Zen 3 serve double duty in client platforms, where they can reach clock speeds well over 4 GHz to maximize thread-limited performance. This design characteristic surfaces in the cloud too, where Milan-based Epyc and Ice Lake Xeons clock significantly higher than Graviton 3. We therefore see a huge difference when looking at latency in actual time, instead of clock cycles.</p>
<div>
<figure><img data-attachment-id="7607" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/g3_hugepages_latency/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_hugepages_latency.png?fit=938%2C430&amp;ssl=1" data-orig-size="938,430" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="g3_hugepages_latency" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_hugepages_latency.png?fit=938%2C430&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_hugepages_latency.png?fit=688%2C315&amp;ssl=1" loading="lazy" width="688" height="315" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_hugepages_latency.png?resize=688%2C315&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_hugepages_latency.png?w=938&amp;ssl=1 938w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/g3_hugepages_latency.png?resize=768%2C352&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/><figcaption>The Xeon is running at 3.5 GHz, while Epyc is running at 3.23 GHz, based on register to register addition latency</figcaption></figure></div>
<p>Zen 3 and Ice Lake both have smaller, faster L1 caches. At L2, the pattern repeats. Ice Lake’s higher latency in cycle counts is completely reversed by its higher clocks, letting it edge out Graviton 3. Intel and ARM’s mesh based L3 are roughly comparable, depending on where in the latency plot you look. Again, AMD opts for a very fast, non-unified L3.</p>
<p>DDR5’s latency regression shows up again as we look at larger test sizes. Intel uses DDR4 controllers on a monolithic die, achieving very low memory latency for a server chip. AMD’s Epyc uses chiplets, and is thus a very interesting comparison to Graviton 3. Despite both incurring a cross-chiplet penalty, AMD’s memory access latency is approximately 10 ns lower than Graviton 3’s. I’m chalking up that difference to DDR5.</p>
<h3>Bandwidth</h3>
<p>With core counts matched, Graviton 3’s caches turn in a reasonable performance, providing bandwidth improvements across the board compared to Ampere Altra. If SVE comes into play, Graviton 3’s L1 and L2 cache bandwidth goes miles above Neoverse N1’s.</p>
<div>
<figure><img data-attachment-id="7605" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/image-33-5/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-33.png?fit=1184%2C650&amp;ssl=1" data-orig-size="1184,650" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-33" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-33.png?fit=1184%2C650&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-33.png?fit=688%2C378&amp;ssl=1" loading="lazy" width="688" height="378" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-33.png?resize=688%2C378&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-33.png?w=1184&amp;ssl=1 1184w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-33.png?resize=768%2C422&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/><figcaption>With widely supported NEON instructions, Ampere Altra stays kind of close thanks to its higher clocks, but Graviton 3 can run away if SVE is used</figcaption></figure></div>
<p>But it’s not that impressive compared to its x86 competitors. Thanks to high clocks and similarly wide vector width, Zen 3’s caches pull well ahead of Graviton’s. Ice Lake takes this further with even higher clocks and twice the vector width, giving it unmatched per-core L1D bandwidth. Intel’s server architecture also has a wide 64 byte/cycle path to L2. Using 256-bit SVE load instructions can close the gap a bit, but there’s no getting around low clocks. </p>
<div>
<figure><img data-attachment-id="7560" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/image-28-7/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-28.png?fit=1257%2C648&amp;ssl=1" data-orig-size="1257,648" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-28" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-28.png?fit=1257%2C648&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-28.png?fit=688%2C355&amp;ssl=1" loading="lazy" width="688" height="355" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-28.png?resize=688%2C355&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-28.png?w=1257&amp;ssl=1 1257w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-28.png?resize=768%2C396&amp;ssl=1 768w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-28.png?resize=1200%2C619&amp;ssl=1 1200w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<p>DDR5 didn’t do well in our memory latency tests, but its advantage really shows with bandwidth tests. Graviton 3 has a large memory bandwidth lead over its x86 competitors.</p>
<p>We don’t have much data for whole server chips, mostly because we’re not a large tech site that can easily get our hands on server stuff. But here’s a comparison with the data we have:</p>
<div>
<figure><img data-attachment-id="7563" data-permalink="https://chipsandcheese.com/2022/05/29/graviton-3-first-impressions/image-29-7/" data-orig-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-29.png?fit=1196%2C578&amp;ssl=1" data-orig-size="1196,578" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-29" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-29.png?fit=1196%2C578&amp;ssl=1" data-large-file="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-29.png?fit=688%2C332&amp;ssl=1" loading="lazy" width="688" height="332" src="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-29.png?resize=688%2C332&amp;ssl=1" alt="" srcset="https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-29.png?w=1196&amp;ssl=1 1196w, https://i0.wp.com/chipsandcheese.com/wp-content/uploads/2022/05/image-29.png?resize=768%2C371&amp;ssl=1 768w" sizes="(max-width: 688px) 100vw, 688px" data-recalc-dims="1"/></figure></div>
<p>As expected, Graviton 3 has a massive advantage over Neoverse N1. Compared to Epyc with V-Cache, it’s ahead in L1, L2, and memory bandwidth. However, AMD’s huge, fast L3 still gives it a lead for certain test sizes. </p>
<h2>Initial Thoughts</h2>
<h3>SVE Support</h3>
<p>Graviton 3 is notable because it’s the first 64-bit ARM server CPU for general purpose use with SVE support. Fujitsu’s A64FX came first, but that was a chip specifically designed for supercomputers, and not for general purpose use. We’ve also seen SVE2 support on a few recently released high end cell phones, but not on other server chips.</p>
<p>In the near future, that’s likely to be a limited advantage. There’s practically no software out there with SVE support. GCC will flat out refuse to emit SVE instructions (at least in our limited experience), even if you use assembly, so we used Clang to assemble our test code. And in the next few years, uptake is likely to be slow. SVE market penetration is nowhere near that of AVX(2), making SVE’s situation reminiscent of AVX-512’s when Skylake-X came out in 2017.</p>
<p>So Graviton 3 will have to wait for a few years before we can tell if SVE gives it a notable advantage. But there are problems with that too. SVE2 is already out, and if software uses instructions in SVE2 that aren’t present in SVE, Graviton 3 will be left behind. </p>
<h3>Against the Competition</h3>
<p>AWS’s Graviton 3 uses a much beefier core architecture than Neoverse N1. N1 is the current mainstay of ARM server offerings, which means Graviton 3 is the highest performing, widely available ARM CPU in the cloud. And it’s likely to stay in that spot for the next few years.</p>
<p>Against its x86 competition, Graviton 3’s per core performance is likely to be a lot closer to that of Zen 3 and Ice Lake than <a href="https://chipsandcheese.com/2021/08/05/neoverse-n1-vs-zen-2-arm-in-practice/">N1 was</a>. With respect to branch prediction, reordering capacity, execution resources, and core width, ARM’s V1 microarchitecture (assuming that’s what Graviton 3 is based off) is in the same ballpark as Intel and AMD’s current server offerings. But I don’t expect Graviton 3 to match AMD and Intel. There’s a huge clock speed difference between Graviton 3 and its x86 competitors, and it’s not like V1 is bigger and beefier.</p>
<h3>From Amazon’s Perspective</h3>
<p>The design seems to be very narrowly targeted at maximizing compute density in the cloud. To that end, AWS has chosen very conservative core clocks. At 2.6 GHz, Graviton 3 clocks a mere 100 MHz over its predecessor, Graviton 2, without increasing per-chip core count. Graviton 3 therefore gets almost all of its performance advantage from performance-per-clock gains. </p>
<p>Amazon has thus chosen to use TSMC’s cutting edge 5 nm process to reduce power consumption. TSMC’s 7 nm process already did wonders for low power designs, and 5 nm would take this even further. While Graviton 3 is a beefier core than N1, it’s nowhere near as ambitious as Intel’s Golden Cove, and should still be considered a moderate design. Such a core running at 2.6 GHz on 5 nm should absolutely sip power. That in turn lets AWS pack three of these chips into a single node, increasing compute density. The final result is a chip that lets AWS sell each Graviton 3 core at a lower price, while still delivering a significant performance boost over their previous Graviton 2 chip.</p>
<p>If you like our articles and journalism and you want to support us in our endeavors then consider heading over to our <a href="https://www.patreon.com/ChipsandCheese">Patreon</a> or our <a href="https://www.paypal.com/donate/?hosted_button_id=4EMPH66SBGVSQ">PayPal</a> if you want to toss a few bucks our way or if you would like to talk with the Chips and Cheese staff and the people behind the scenes then consider joining our <a href="https://discord.gg/TwVnRhxgY2">Discord</a>.</p>
<div>

<ul>
<li>
<p><img alt="" src="https://secure.gravatar.com/avatar/eb262496276a5c8c0a375be578f81db9?s=80&amp;d=identicon&amp;r=g" height="80" width="80" loading="lazy" data-lazy-srcset="https://secure.gravatar.com/avatar/eb262496276a5c8c0a375be578f81db9?s=160&amp;d=identicon&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/eb262496276a5c8c0a375be578f81db9?s=80&amp;is-pending-load=1#038;d=identicon&amp;r=g" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/>
</p>

</li>
<li>
<p><img alt="" src="https://secure.gravatar.com/avatar/83de286347cdfc84e1bb10146350467e?s=80&amp;d=identicon&amp;r=g" height="80" width="80" loading="lazy" data-lazy-srcset="https://secure.gravatar.com/avatar/83de286347cdfc84e1bb10146350467e?s=160&amp;d=identicon&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/83de286347cdfc84e1bb10146350467e?s=80&amp;is-pending-load=1#038;d=identicon&amp;r=g" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/>
</p>

</li>
</ul>
</div>



</div></div>
  </body>
</html>
