<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://discuss.haiku-os.org/t/my-progress-in-porting-wine/11741">Original</a>
    <h1>My progress in porting Wine</h1>
    
    <div id="readability-page-1" class="page"><div id="main-outlet">
        

  


      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          


          <p><span>
              <time itemprop="datePublished" datetime="2021-12-30T21:57:17Z">
                December 30, 2021,  9:57pm
              </time>
              <meta itemprop="dateModified" content="2021-12-30T21:57:17Z"/>
          <span itemprop="position">#1</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>I found that TLS registers are different in 64 bit Windows (GS) and Haiku (FS).</p>
<pre><code>NtCurrentTeb()
mov %gs:0x30, %r13

static inline void**
get_tls()
{
	void** tls;
	__asm__ __volatile__ (&#34;movq	%%fs:0, %0&#34; : &#34;=r&#34; (tls));
	return tls;
}
</code></pre>
<p>So I tried to implement setting GS base in kernel and got some success.</p>
<p>Cmd is already working. No GUI yet.</p>
<pre><code>Microsoft Windows 6.1.7601

Z:\Haiku\data\packages\wine-6.23&gt;
Z:\Haiku\data\packages\wine-6.23&gt;
Z:\Haiku\data\packages\wine-6.23&gt;
Z:\Haiku\data\packages\wine-6.23&gt;dir
00c4:fixme:file:get_default_drive_device auto detection of DOS devices not supported on this platform
Volume in drive Z has no label.
Volume Serial Number is 5a00-0000

Directory of Z:\Haiku\data\packages\wine-6.23

12/31/2021   6:47 AM  &lt;DIR&gt;         .
12/30/2021  11:27 PM  &lt;DIR&gt;         ..
 12/4/2021   6:17 AM        16,635  aclocal.m4
 12/4/2021   6:17 AM        33,128  ANNOUNCE
 12/4/2021   6:17 AM        26,847  AUTHORS
12/30/2021  11:32 PM       908,816  config.log
12/30/2021  11:31 PM        71,114  config.status
 12/4/2021   6:17 AM       770,828  configure
 12/4/2021   6:17 AM       161,964  configure.ac
 12/4/2021   6:17 AM        26,434  COPYING.LIB
 12/4/2021   6:17 AM  &lt;DIR&gt;         dlls
 12/4/2021   6:17 AM  &lt;DIR&gt;         documentation
12/30/2021  11:52 PM  &lt;DIR&gt;         fonts
12/30/2021  11:52 PM  &lt;DIR&gt;         include
12/31/2021   6:29 AM  &lt;DIR&gt;         install
 12/4/2021   6:17 AM  &lt;DIR&gt;         libs
 12/4/2021   6:17 AM           824  LICENSE
 12/4/2021   6:17 AM         1,324  LICENSE.OLD
12/30/2021  11:51 PM  &lt;DIR&gt;         loader
 12/4/2021   6:17 AM         8,766  MAINTAINERS
12/31/2021  12:16 AM    16,079,205  Makefile
12/30/2021  11:32 PM  &lt;DIR&gt;         nls
12/30/2021  11:32 PM  &lt;DIR&gt;         po
 12/4/2021   6:17 AM  &lt;DIR&gt;         programs
 12/4/2021   6:17 AM         5,586  README
12/31/2021  12:16 AM  &lt;DIR&gt;         server
12/30/2021  11:42 PM  &lt;DIR&gt;         tools
 12/4/2021   6:17 AM            18  VERSION
 12/4/2021   6:17 AM         2,629  wine
 12/4/2021   6:17 AM         2,629  wine64
      16 files               18,116,747 bytes
      14 directories                  0 bytes free


Z:\Haiku\data\packages\wine-6.23&gt;
</code></pre>
        </div>

        <meta itemprop="headline" content="My progress in porting Wine"/>
          <meta itemprop="keywords" content=""/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discuss.haiku-os.org/u/syd"><span itemprop="name">syd</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2021-12-30T22:56:19Z">
                December 30, 2021, 10:56pm
              </time>
              <meta itemprop="dateModified" content="2021-12-30T22:56:19Z"/>
          <span itemprop="position">#2</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>This is gonna be goodâ€¦</p>
<p>If Wine gets ported to Haiku, it would be interesting to see how much of a jump in interest there would be from the computing community.</p>
        </div>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discuss.haiku-os.org/u/X512"><span itemprop="name">X512</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2021-12-30T23:22:21Z">
                December 30, 2021, 11:22pm
              </time>
              <meta itemprop="dateModified" content="2021-12-30T23:22:21Z"/>
          <span itemprop="position">#3</span>
          </span>
        </p></div>
        

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discuss.haiku-os.org/u/X512"><span itemprop="name">X512</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2021-12-31T00:44:47Z">
                December 31, 2021, 12:44am
              </time>
              <meta itemprop="dateModified" content="2021-12-31T00:44:47Z"/>
          <span itemprop="position">#4</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>I can compile and run programs with MinGW in Wine:</p>
<pre><code>/Haiku/data/packages/wine-6.23&gt; wine cmd
GetCurrentTeb(): 0x67fe0000
002c:fixme:file:get_device_info device info not properly supported on this platform
002c:fixme:ntdll:get_firmware_info info_class SYSTEM_FIRMWARE_TABLE_INFORMATION
002c:fixme:ntdll:get_firmware_info info_class SYSTEM_FIRMWARE_TABLE_INFORMATION
002c:fixme:winsock:unix_getaddrinfo getaddrinfo() not found during build time
002c:err:winediag:getaddrinfo Failed to resolve your host name IP
002c:fixme:winsock:unix_getaddrinfo getaddrinfo() not found during build time
0034:fixme:file:get_device_info device info not properly supported on this platform
003c:fixme:file:get_device_info device info not properly supported on this platform
0048:fixme:file:get_device_info device info not properly supported on this platform
0050:fixme:file:get_device_info device info not properly supported on this platform
0070:fixme:file:get_device_info device info not properly supported on this platform
resolve symbol &#34;XESetCreateGC&#34; returned: -2147478780
0050:err:module:open_builtin_so_file failed to load .so lib &#34;/Haiku/data/packages/wine-6.23/dlls/winex11.drv/winex11.drv.so&#34;
0050:err:explorer:initialize_display_settings Failed to query current display settings for L&#34;\\\\.\\DISPLAY1&#34;.
0050:err:winediag:nodrv_CreateWindow Application tried to create a window, but no driver could be loaded.
0050:err:winediag:nodrv_CreateWindow Unknown error (127).
0050:err:systray:initialize_systray Could not create tray window
0050:err:ole:start_rpcss Failed to start RpcSs service
0050:err:ole:start_rpcss Failed to start RpcSs service
003c:err:service:process_send_command receiving command result timed out
003c:fixme:service:scmdatabase_autostart_services Auto-start service L&#34;wineusb&#34; failed to start: 1053
003c:err:service:process_send_command receiving command result timed out
003c:fixme:service:scmdatabase_autostart_services Auto-start service L&#34;winebus&#34; failed to start: 1053
0090:fixme:file:get_device_info device info not properly supported on this platform
00ac:fixme:file:get_device_info device info not properly supported on this platform
005c:err:dnsapi:DllMain No libresolv support, expect problems
0024:fixme:file:get_device_info device info not properly supported on this platform
GetCurrentTeb(): 0x67fe0000
00c4:fixme:file:get_device_info device info not properly supported on this platform
GetCurrentTeb(): 0x67fe0000
00cc:fixme:file:get_device_info device info not properly supported on this platform
Microsoft Windows 6.1.7601

Z:\Haiku\data\packages\wine-6.23&gt;00d8:fixme:file:get_device_info device info not properly supported on this platform
resolve symbol &#34;XESetCreateGC&#34; returned: -2147478780
00d8:err:module:open_builtin_so_file failed to load .so lib &#34;/Haiku/data/packages/wine-6.23/dlls/winex11.drv/winex11.drv.so&#34;
00d8:err:explorer:initialize_display_settings Failed to query current display settings for L&#34;\\\\.\\DISPLAY1&#34;.
00d8:err:winediag:nodrv_CreateWindow Application tried to create a window, but no driver could be loaded.
00d8:err:winediag:nodrv_CreateWindow Unknown error (127).
00d8:err:systray:initialize_systray Could not create tray window
00e8:fixme:file:get_device_info device info not properly supported on this platform

Z:\Haiku\data\packages\wine-6.23&gt;/boot/home/received/mingw64/bin/x86_64-w64-mingw32-gcc.exe Test.c -o Test.exe
GetCurrentTeb(): 0x3e0000
0110:fixme:file:get_device_info device info not properly supported on this platform
GetCurrentTeb(): 0x3e0000
0118:fixme:file:get_device_info device info not properly supported on this platform
0118:fixme:ntdll:NtQuerySystemInformation info_class SYSTEM_PERFORMANCE_INFORMATION
GetCurrentTeb(): 0x67fe0000
0120:fixme:file:get_device_info device info not properly supported on this platform
GetCurrentTeb(): 0x3e0000
0128:fixme:file:get_device_info device info not properly supported on this platform
0130:fixme:file:get_device_info device info not properly supported on this platform
GetCurrentTeb(): 0x3e0000

Z:\Haiku\data\packages\wine-6.23&gt;Test.exe
GetCurrentTeb(): 0x3e0000
0138:fixme:file:get_device_info device info not properly supported on this platform
C program compiled with Wine on Haiku.

Z:\Haiku\data\packages\wine-6.23&gt;
</code></pre>
        </div>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      
      
      
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discuss.haiku-os.org/u/X512"><span itemprop="name">X512</span></a>
            
          </span></p>

            

          <p><span>
              <time itemprop="datePublished" datetime="2021-12-31T18:26:01Z">
                December 31, 2021,  6:26pm
              </time>
              <meta itemprop="dateModified" content="2021-12-31T18:26:01Z"/>
          <span itemprop="position">#8</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>After fixing dll.so loading problem, GUI is now working:</p>
<p><img src="https://discuss.haiku-os.org/uploads/default/original/2X/a/a79a0cd894f21dd9cba0ad78f846bfdcb3a6bb2e.png" alt="screenshot89" data-base62-sha1="nUFMTcfQ9WyY6wHUpCZNr6XEHzo" width="636" height="500"/></p>
        </div>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discuss.haiku-os.org/u/dcatt"><span itemprop="name">dcatt</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2021-12-31T18:55:10Z">
                December 31, 2021,  6:55pm
              </time>
              <meta itemprop="dateModified" content="2021-12-31T18:55:10Z"/>
          <span itemprop="position">#9</span>
          </span>
        </p></div>
        <p>You are awesome!</p>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discuss.haiku-os.org/u/X512"><span itemprop="name">X512</span></a>
            
          </span></p>

            

          <p><span>
              <time itemprop="datePublished" datetime="2021-12-31T18:58:14Z">
                December 31, 2021,  6:58pm
              </time>
              <meta itemprop="dateModified" content="2021-12-31T18:58:14Z"/>
          <span itemprop="position">#10</span>
          </span>
        </p></div>
        <p>Some applications:</p>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discuss.haiku-os.org/u/rjzak"><span itemprop="name">rjzak</span></a>
            
          </span></p>


          <p><span>
              <meta itemprop="datePublished" content="2021-12-31T19:14:40Z"/>
              <time itemprop="dateModified" datetime="2021-12-31T19:15:12Z">
                December 31, 2021,  7:15pm
              </time>
          <span itemprop="position">#11</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>Beautiful!</p>
<p>With <a href="https://discuss.haiku-os.org/u/waddlesplash">@waddlesplash</a>â€™s <a href="https://discuss.haiku-os.org/t/xlibe-an-xlib-x11-compatibility-layer-for-haiku/11692/">Xlibe</a> work, there wonâ€™t need to be a Freedesktop-dot-org X window then? Itâ€™s nice seeing things coming together <img src="https://discuss.haiku-os.org/images/emoji/twitter/slight_smile.png?v=9" title=":slight_smile:" alt=":slight_smile:"/></p>
        </div>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <p>Yes, thatâ€™s the idea. X512 already sent me an initial log of trying to compile WINE with Xlibe, there are some things that have to be implemented and probably work to do once it compiles. I will look at it down the road.</p>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discuss.haiku-os.org/u/Diver"><span itemprop="name">Diver</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2021-12-31T19:57:35Z">
                December 31, 2021,  7:57pm
              </time>
              <meta itemprop="dateModified" content="2021-12-31T19:57:35Z"/>
          <span itemprop="position">#13</span>
          </span>
        </p></div>
        <p>And this is with just one day of work! Simply amazing!</p>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discuss.haiku-os.org/u/X512"><span itemprop="name">X512</span></a>
            
          </span></p>

            

          <p><span>
              <time itemprop="datePublished" datetime="2021-12-31T20:49:27Z">
                December 31, 2021,  8:49pm
              </time>
              <meta itemprop="dateModified" content="2021-12-31T20:49:27Z"/>
          <span itemprop="position">#14</span>
          </span>
        </p></div>
        <p><img src="https://discuss.haiku-os.org/uploads/default/original/2X/8/8eb59bb979041015a12aee0e6cf38cedca4555f8.png" alt="screenshot91" data-base62-sha1="kmsTtzoYRbJSvBJV17txW4qICYo" width="647" height="500"/></p>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discuss.haiku-os.org/u/x68k"><span itemprop="name">x68k</span></a>
            
          </span></p>


          <p><span>
              <meta itemprop="datePublished" content="2021-12-31T22:00:43Z"/>
              <time itemprop="dateModified" datetime="2021-12-31T22:01:14Z">
                December 31, 2021, 10:01pm
              </time>
          <span itemprop="position">#15</span>
          </span>
        </p></div>
        <p>It cannot be overstated what a huge milestone this is for Haiku. I canâ€™t wait to see this port mature. Great job!</p>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <p>Awesome work! Please try Inkscape and Gimp.</p>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discuss.haiku-os.org/u/X512"><span itemprop="name">X512</span></a>
            
          </span></p>

            

          <p><span>
              <meta itemprop="datePublished" content="2021-12-31T23:32:53Z"/>
              <time itemprop="dateModified" datetime="2021-12-31T23:36:52Z">
                December 31, 2021, 11:36pm
              </time>
          <span itemprop="position">#17</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p><img src="https://discuss.haiku-os.org/uploads/default/original/2X/d/dfd29a54509af938f7abc3b5b77b7d737f7efb04.png" alt="screenshot94" data-base62-sha1="vW1GO1zrMTj76j4tyjqhtTloEF6" width="647" height="500"/></p>
<p><img src="https://discuss.haiku-os.org/uploads/default/original/2X/2/268b6c2a98c475727f37b1272e680b571dfa95e5.png" alt="screenshot95" data-base62-sha1="5uYR1Cd117lBLrFS0FUrZULqnf7" width="647" height="500"/></p>
<p>GTK 3 based Inkscape wonâ€™t run.</p>
        </div>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <p>Perfect !!! <img src="https://discuss.haiku-os.org/images/emoji/twitter/slightly_smiling_face.png?v=9" title=":slightly_smiling_face:" alt=":slightly_smiling_face:"/></p>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <p>Very cool, Iâ€™d be impressed to see a game like Plants vs Zombies run or any other game that doesnâ€™t need hardware accelerated graphics.</p>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discuss.haiku-os.org/u/X512"><span itemprop="name">X512</span></a>
            
          </span></p>

            

          <p><span>
              <time itemprop="datePublished" datetime="2022-01-01T02:23:35Z">
                January 1, 2022,  2:23am
              </time>
              <meta itemprop="dateModified" content="2022-01-01T02:23:35Z"/>
          <span itemprop="position">#20</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>Wine with Xlibe. Wrong stride and input not working.</p>
<p><img src="https://discuss.haiku-os.org/uploads/default/original/2X/e/e28214492644129fe9f889e15277782c5edab898.png" alt="screenshot97" data-base62-sha1="wjMBjmglhgzt5lYXpicWYT7iuSc" width="424" height="500"/></p>
        </div>

        <meta itemprop="headline" content="My progress in porting Wine"/>

        

         

      </div>

    





    </div></div>
  </body>
</html>
