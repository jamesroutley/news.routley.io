<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.alanshawn.com/latex3-tutorial/">Original</a>
    <h1>LaTeX3: Programming in LaTeX with Ease (2020)</h1>
    
    <div id="readability-page-1" class="page"><div class="page">
  
  <p>Many people view LaTeX as a typesetting language and overlook the importance of programming in
document generation process. As a matter of fact, many large and structural documents can benefit
from a programming backend, which enhances layout standardization, symbol coherence, editing speed
and many other aspects. Despite the fact the standard LaTeX (LaTeX2e) is already Turing complete, which
means it is capable of solving any programming task, the design of many programming interfaces is highly
inconsistent due to compatibility considerations. This makes programming with LaTeX2e very challenging and
tedious, even for seasoned computer programmers.</p>

<p>To make programming in LaTeX easier, the LaTeX3 interface is introduced, which aims to provide
modern-programming-language-like syntax and library for LaTeX programmers. Unfortunately, there is
little material regarding this wonderful language. When I started learning it, I had to go through
its complex technical manual, which is time-consuming. Therefore, I decide to write a LaTeX3 tutorial
that is easy-to-understand for generic programmers.</p>

<ul id="markdown-toc">
  <li><a href="#preface" id="markdown-toc-preface">Preface</a></li>
  <li><a href="#why-latex3" id="markdown-toc-why-latex3">Why LaTeX3?</a>    <ul>
      <li><a href="#handle-macro-expansion-like-a-boss" id="markdown-toc-handle-macro-expansion-like-a-boss">Handle macro expansion like a boss</a></li>
      <li><a href="#messy-interfaces-in-latex" id="markdown-toc-messy-interfaces-in-latex">Messy interfaces in LaTeX</a></li>
      <li><a href="#goals-of-latex3" id="markdown-toc-goals-of-latex3">Goals of LaTeX3</a></li>
    </ul>
  </li>
  <li><a href="#latex3-naming-conventions-i-1" id="markdown-toc-latex3-naming-conventions-i-1">LaTeX3 Naming Conventions (I-1)</a>    <ul>
      <li><a href="#category-code-and-command-names" id="markdown-toc-category-code-and-command-names">Category code and command names</a></li>
      <li><a href="#name-of-variables" id="markdown-toc-name-of-variables">Name of variables</a></li>
      <li><a href="#name-of-functions" id="markdown-toc-name-of-functions">Name of functions</a></li>
    </ul>
  </li>
  <li><a href="#reading-latex3-documentation" id="markdown-toc-reading-latex3-documentation">Reading LaTeX3 Documentation</a>    <ul>
      <li><a href="#function-documentation" id="markdown-toc-function-documentation">Function documentation</a></li>
      <li><a href="#scratch-variables" id="markdown-toc-scratch-variables">Scratch variables</a></li>
      <li><a href="#constants" id="markdown-toc-constants">Constants</a></li>
      <li><a href="#summary" id="markdown-toc-summary">Summary</a></li>
    </ul>
  </li>
  <li><a href="#functions--variables" id="markdown-toc-functions--variables">Functions &amp; Variables</a>    <ul>
      <li><a href="#defining-and-using-variables" id="markdown-toc-defining-and-using-variables">Defining and using variables</a></li>
      <li><a href="#declaring-functions-iv-32" id="markdown-toc-declaring-functions-iv-32">Declaring functions (IV-3.2)</a>        <ul>
          <li><a href="#copying-the-definition-of-existing-functions" id="markdown-toc-copying-the-definition-of-existing-functions">Copying the definition of existing functions</a></li>
          <li><a href="#showing-the-definition-of-functions" id="markdown-toc-showing-the-definition-of-functions">Showing the definition of functions</a></li>
        </ul>
      </li>
      <li><a href="#summary-1" id="markdown-toc-summary-1">Summary</a></li>
    </ul>
  </li>
  <li><a href="#macro-expansion-control-v" id="markdown-toc-macro-expansion-control-v">Macro Expansion Control (V)</a>    <ul>
      <li><a href="#method-1-change-argument-specification-of-functions" id="markdown-toc-method-1-change-argument-specification-of-functions">Method 1: change argument specification of functions</a></li>
      <li><a href="#method-2-use-exp_argsn-functions-v4-v5-v6" id="markdown-toc-method-2-use-exp_argsn-functions-v4-v5-v6">Method 2: use <code>\exp_args:N</code> functions (V.4, V.5, V.6)</a></li>
      <li><a href="#summary-2" id="markdown-toc-summary-2">Summary</a></li>
    </ul>
  </li>
  <li><a href="#latex3-token-list-and-string" id="markdown-toc-latex3-token-list-and-string">LaTeX3: Token List and String</a>    <ul>
      <li><a href="#token-list-vii" id="markdown-toc-token-list-vii">Token list (VII)</a>        <ul>
          <li><a href="#constructing-a-command-in-token-list" id="markdown-toc-constructing-a-command-in-token-list">Constructing a command in token list</a></li>
          <li><a href="#student-management-system" id="markdown-toc-student-management-system">Student management system</a></li>
        </ul>
      </li>
      <li><a href="#string-viii" id="markdown-toc-string-viii">String (VIII)</a>        <ul>
          <li><a href="#vertical-text-node-in-tikz" id="markdown-toc-vertical-text-node-in-tikz">Vertical text node in TikZ</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#latex3-numeric-evaluation-and-boolean-logic" id="markdown-toc-latex3-numeric-evaluation-and-boolean-logic">LaTeX3: Numeric Evaluation and Boolean Logic</a>    <ul>
      <li><a href="#boolean-logic-xiii" id="markdown-toc-boolean-logic-xiii">Boolean logic (XIII)</a></li>
      <li><a href="#integer-arithmetic" id="markdown-toc-integer-arithmetic">Integer arithmetic</a>        <ul>
          <li><a href="#implementing-modulo-operation" id="markdown-toc-implementing-modulo-operation">Implementing modulo operation</a></li>
          <li><a href="#implementing-caesar-cipher" id="markdown-toc-implementing-caesar-cipher">Implementing Caesar cipher</a></li>
        </ul>
      </li>
      <li><a href="#integer-based-loop-and-condition" id="markdown-toc-integer-based-loop-and-condition">Integer-based loop and condition</a>        <ul>
          <li><a href="#computing-the-greatest-common-divisor-non-recursive" id="markdown-toc-computing-the-greatest-common-divisor-non-recursive">Computing the greatest common divisor (non-recursive)</a></li>
          <li><a href="#computing-the-greatest-common-divisor-recursive" id="markdown-toc-computing-the-greatest-common-divisor-recursive">Computing the greatest common divisor (recursive)</a></li>
          <li><a href="#student-management-system-1" id="markdown-toc-student-management-system-1">Student management system</a></li>
          <li><a href="#three-ways-to-implement-nested-loop" id="markdown-toc-three-ways-to-implement-nested-loop">Three ways to implement nested loop</a></li>
          <li><a href="#drawing-a-square-number-grid-in-tikz" id="markdown-toc-drawing-a-square-number-grid-in-tikz">Drawing a square number grid in TikZ</a></li>
        </ul>
      </li>
      <li><a href="#floating-point-number-xxiii-and-dimension-xx" id="markdown-toc-floating-point-number-xxiii-and-dimension-xx">Floating point number (XXIII) and dimension (XX)</a>        <ul>
          <li><a href="#drawing-a-rectangular-number-grid-in-tikz" id="markdown-toc-drawing-a-rectangular-number-grid-in-tikz">Drawing a rectangular number grid in TikZ</a></li>
          <li><a href="#drawing-points-on-a-circle-and-connect-them-pairwise" id="markdown-toc-drawing-points-on-a-circle-and-connect-them-pairwise">Drawing points on a circle and connect them pairwise</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#latex3-data-structure" id="markdown-toc-latex3-data-structure">LaTeX3: Data Structure</a>    <ul>
      <li><a href="#queue-x-xv" id="markdown-toc-queue-x-xv">Queue (X, XV)</a>        <ul>
          <li><a href="#student-management-system-2" id="markdown-toc-student-management-system-2">Student management system</a></li>
          <li><a href="#bracket-matching" id="markdown-toc-bracket-matching">Bracket matching</a></li>
        </ul>
      </li>
      <li><a href="#dictionary-xvii" id="markdown-toc-dictionary-xvii">Dictionary (XVII)</a>        <ul>
          <li><a href="#arabic-numerals-to-english-0-99" id="markdown-toc-arabic-numerals-to-english-0-99">Arabic numerals to English (0-99)</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#latex3-regular-expression-xxviii" id="markdown-toc-latex3-regular-expression-xxviii">LaTeX3: Regular Expression (XXVIII)</a>    <ul>
      <li><a href="#check-if-a-character-is-chinese" id="markdown-toc-check-if-a-character-is-chinese">Check if a character is Chinese</a></li>
      <li><a href="#substitute-a-command-with-another" id="markdown-toc-substitute-a-command-with-another">Substitute a command with another</a></li>
      <li><a href="#generate-tikz-picture-based-on-a-template" id="markdown-toc-generate-tikz-picture-based-on-a-template">Generate TikZ picture based on a template</a></li>
      <li><a href="#processing-multi-line-text" id="markdown-toc-processing-multi-line-text">Processing multi-line text</a></li>
    </ul>
  </li>
  <li><a href="#latex3-file-io-xix" id="markdown-toc-latex3-file-io-xix">LaTeX3: File I/O (XIX)</a>    <ul>
      <li><a href="#writing-to-a-file" id="markdown-toc-writing-to-a-file">Writing to a file</a></li>
      <li><a href="#reading-and-parsing-comma-separated-file" id="markdown-toc-reading-and-parsing-comma-separated-file">Reading and parsing comma-separated file</a></li>
    </ul>
  </li>
  <li><a href="#memo" id="markdown-toc-memo">Memo</a></li>
  <li><a href="#end-note" id="markdown-toc-end-note">End Note</a></li>
</ul>



<h2 id="preface">Preface</h2>



<h2 id="why-latex3">Why LaTeX3?</h2>

<h3 id="handle-macro-expansion-like-a-boss">Handle macro expansion like a boss</h3>

<p>Fundamentally, <img src="http://shapr.github.io/media/2020/latex3/tex.svg" alt="TeX"/> works by doing macro substitution: commands are substituted by their definition, which is subsequently replaced by definition’s definition, until something irreplaceable is reached (e.g. text). For example, in the following example, <code><span>\myname</span></code> is substituted by <code><span>\mynameb</span></code>; <code><span>\mynameb</span></code> is then substituted by <code><span>\mynama</span></code>; and eventually, <code><span>\mynamea</span></code> is replaced by <code>John Doe</code>, which cannot be expanded anymore. This process is called <strong>expansion</strong>.</p>

<div><div><pre><code><span>\newcommand</span><span>{</span><span>\mynamea</span><span>}{</span>John Doe<span>}</span>
<span>\newcommand</span><span>{</span><span>\mynameb</span><span>}{</span><span>\mynamea</span><span>}</span>
<span>\newcommand</span><span>{</span><span>\myname</span><span>}{</span><span>\mynameb</span><span>}</span>
My name is <span>\myname</span>.
</code></pre></div></div>

<p>Most <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> command we use everyday has complicated definitions. During compilation, they will be expanded recursively until text or <a href="https://tex.stackexchange.com/questions/267980/what-is-a-primitive-a-macro-and-how-do-they-compare"><img src="http://shapr.github.io/media/2020/latex3/tex.svg" alt="TeX"/> primitive</a> is reached. This process sounds pretty straightforward, until we want to <em>change the order of macro expansion</em>.</p>

<p>Why do we need to change the order of macro expansion? Let’s consider the <code><span>\uppercase</span></code> macro in <img src="http://shapr.github.io/media/2020/latex3/latexe.svg" alt="LaTeX2e"/>, which turns lowercase letters into uppercase ones. But consider the following case, where we try to apply <code><span>\uppercase</span></code> to letters <code>abcd</code> and a command <code><span>\cmda</span></code>. Since <code><span>\cmda</span></code> expands to <code>abcd</code>, we expect the outcome to be <code>ABCDABCD</code>. In reality, <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> gives us <code>ABCDabcd</code>, which means the content of <code><span>\cmda</span></code> is <em>unchanged</em>.</p>

<div><div><pre><code><span>\newcommand</span><span>{</span><span>\cmda</span><span>}{</span>abcd<span>}</span>
<span>\uppercase</span><span>{</span>abcd<span>\cmda</span><span>}</span> <span>%ABCDabcd</span>
</code></pre></div></div>

<p>How can this happen? During the expansion of <code><span>\uppercase</span></code>, the command scans the item inside the adjacent curly braces one by one. If an English letter is encountered, an uppercase counterpart is left in the output stream; otherwise, the original item is left in the input stream. When it’s <code><span>\cmda</span></code>’s turn, because it is a command instead of a letter, it is left <em>untouched</em> in the output stream, which is expanded to <code>abcd</code> later.</p>

<p>What if we want to capitalize <em>everything</em> inside the curly braces? That would require the macro <code><span>\cmda</span></code> to be expanded before <code><span>\uppercase</span></code>, or equivalently, changing the order of macro expansion. The classical way of doing so in <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> is via <code><span>\expandafter</span></code>. Unfortunately, the usage of <code><span>\expandafter</span></code> is extremely complicated<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" rel="footnote">1</a></sup>: in a string of <code>n</code> tokens<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" rel="footnote">2</a></sup>, to expand the <code>i</code>th token, there must be \(2^{n-i}-1\) <code><span>\expandafter</span></code>’s before the <code>i</code>th token. Below is a <a href="https://tex.stackexchange.com/questions/104506/expanding-arguments-before-macro-call">example</a> of how bad this can look like:</p>

<div><div><pre><code><span>\documentclass</span><span>{</span>article<span>}</span>
<span>\begin{document}</span>

<span>\def\x</span>#1#2#3#4<span>{</span><span>%</span>
  <span>\def\arga</span><span>{</span>#2<span>}</span><span>%</span>
  <span>\def\argb</span><span>{</span>#3<span>}</span><span>%</span>
  <span>\def\argc</span><span>{</span>#4<span>}</span><span>%</span>
  <span>\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter</span>#1<span>%</span>
    <span>\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter</span>
      <span>{</span><span>\expandafter\expandafter\expandafter\arga\expandafter\expandafter\expandafter</span><span>}</span><span>%</span>
        <span>\expandafter\expandafter\expandafter</span><span>{</span><span>\expandafter\argb\expandafter</span><span>}</span><span>\expandafter</span>
          <span>{</span><span>\argc</span><span>}}</span>

<span>\def\y</span>#1#2#3<span>{</span><span>\detokenize</span><span>{</span>#1#2#3<span>}}</span>

<span>\x\y</span><span>{</span>arg1<span>}{</span>arg2<span>}{</span>arg3<span>}</span>

<span>\end{document}</span>
</code></pre></div></div>

<p>Clearly, it is nowhere near decency: the excessive number of <code><span>\expandafter</span></code>’s are sometimes referred to as “<code><span>\expandafter</span></code> purgatory”. As a result, one of the features of <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> is to provide simple and reliable expansion control.</p>

<h3 id="messy-interfaces-in-latex">Messy interfaces in LaTeX</h3>

<p>Believe it or not, <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> is able to achieve everything other generic programming languages can do (e.g. C++, Python, Java)<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" rel="footnote">3</a></sup>. However, the function call conventions can be wildly distinct across different tasks; some similar functionalities can be independently implemented various packages. Here are some examples:</p>

<ul>
  <li>File read
    <div><div><pre><code><span>\newread\file</span>
<span>\openin\file</span>=myfilename.txt
<span>\loop\unless\ifeof\file</span>
    <span>\read\file</span> to<span>\fileline</span> <span>% Reads a line of the file into \fileline</span>
    <span>% Do something with \fileline</span>
<span>\repeat</span>
<span>\closein\file</span>
</code></pre></div>    </div>
  </li>
  <li>File write
    <div><div><pre><code><span>\newwrite\file</span>
<span>\immediate\openout\file</span>=myfilename.txt
<span>\immediate\write\file</span><span>{</span>A line of text to write to the file<span>}</span>
<span>\immediate\write\file</span><span>{</span>Another line of text to write to the file<span>}</span>
<span>\closeout\file</span>
</code></pre></div>    </div>
  </li>
  <li>Integer arithmetic
    <div><div><pre><code><span>\newcount\mycount</span>
<span>\mycount</span>=<span>\numexpr</span>(25+5)/3<span>\relax</span>
<span>\advance\mycount</span> by -3
<span>\multiply\mycount</span> by 2
</code></pre></div>    </div>
  </li>
  <li>Condition
    <div><div><pre><code><span>% command-related if statement</span>
<span>\ifx\mycmd\undefined</span>
undefed
<span>\else</span>
  <span>\if\mycmd</span>1
  defed, 1
  <span>\else</span>
  defed
  <span>\fi</span>
<span>\fi</span>

<span>% number-related if statement</span>
<span>\ifdim</span>#1pt=#2pt
    Equal.<span>\\</span>
<span>\else</span><span>%</span>
    Not equal.<span>\\</span>
<span>\fi</span><span>%</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Loop</p>

    <div><div><pre><code><span>% use \loop</span>
<span>\newcount\foo</span>
<span>\foo</span>=10
<span>\loop</span>
  <span>\message</span><span>{</span><span>\the\foo</span><span>}</span>
  <span>\advance</span> <span>\foo</span> -1
<span>\ifnum</span> <span>\foo</span>&gt;0
<span>\repeat</span>

<span>% while loop (provided by `ifthen` package)</span>
<span>\newcounter</span><span>{</span>ct<span>}</span>
<span>\setcounter</span><span>{</span>ct<span>}{</span>1<span>}</span>
<span>\whiledo</span> <span>{</span><span>\value</span><span>{</span>ct<span>}</span> &lt; 5<span>}</span><span>%</span>
<span>{</span>
  <span>\the\ct</span>
  <span>\stepcounter</span> <span>{</span>ct<span>}</span><span>%</span>
<span>}</span>

<span>% for loop (provided by `ifthen` package)</span>
<span>\forloop</span><span>{</span>ct<span>}{</span>1<span>}{</span><span>\value</span><span>{</span>ct<span>}</span> &lt; 5<span>}</span><span>%</span>
<span>{</span><span>%</span>
  <span>\the\ct</span>
<span>}</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>These inconsistencies set a high bar for new <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> users and make it difficult to connect multiple components together, even for experienced <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> programmers. Therefore, <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> aims to provide standardized programming interfaces and documentation for the language.</p>

<h3 id="goals-of-latex3">Goals of LaTeX3</h3>



<h2 id="latex3-naming-conventions-i-1">LaTeX3 Naming Conventions (I-1)</h2>

<p>In the following code snippet, we declare a variable <code><span>\vara</span></code> and a function <code><span>\cmda</span></code>. The way we distinguish between a <em>variable</em> and a <em>function</em> is simply by judging whether the command absorbs arguments or not. However, the fact that they are all called “commands” and created with <code><span>\newcommand</span></code> reflects that they are fundamentally the same for <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> system.</p>

<div><div><pre><code><span>\newcommand</span><span>{</span><span>\vara</span><span>}{</span>this is a variable<span>}</span>
<span>\newcommand</span><span>{</span><span>\cmda</span><span>}</span>[1]<span>{</span>this is a command: #1<span>}</span>
</code></pre></div></div>

<p>From users’ perspective, it is important to separate variables from functions because their usages are different. Therefore, our only option is to encode this information into the name of commands, so that users can differentiate variables and functions with little effort. This is why we need to introduce the <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> naming convention. Before actually elaborating on <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> naming style, I would like to make a small diversion and introduce <em>category code</em> first.</p>

<h3 id="category-code-and-command-names">Category code and command names</h3>

<p>In <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/>, every character that we enter is associated with a category code. Standard category code assignment can be seen in the following <a href="https://www.overleaf.com/learn/latex/Table_of_TeX_category_codes">table</a>:</p>

<table>
  <thead>
    <tr>
      <th>Category code</th>
      <th>Description</th>
      <th>Standard <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/>/<img src="http://shapr.github.io/media/2020/latex3/tex.svg" alt="TeX"/></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>Escape character-tells <img src="http://shapr.github.io/media/2020/latex3/tex.svg" alt="TeX"/> to start looking for a command</td>
      <td><code>\</code></td>
    </tr>
    <tr>
      <td>1</td>
      <td>Start a group</td>
      <td><code>{</code></td>
    </tr>
    <tr>
      <td>2</td>
      <td>End a group</td>
      <td><code>}</code></td>
    </tr>
    <tr>
      <td>3</td>
      <td>Math shift-switch in/out of math mode</td>
      <td><code>$</code></td>
    </tr>
    <tr>
      <td>4</td>
      <td>Alignment tab</td>
      <td><code>&amp;</code></td>
    </tr>
    <tr>
      <td>5</td>
      <td>End of line</td>
      <td>ASCII code 13 (<code>\r</code>)</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Macro parameter</td>
      <td><code>#</code></td>
    </tr>
    <tr>
      <td>7</td>
      <td>Superscript for typesetting math</td>
      <td><code>^</code></td>
    </tr>
    <tr>
      <td>8</td>
      <td>Subscript for typesetting math</td>
      <td><code>_</code></td>
    </tr>
    <tr>
      <td>9</td>
      <td>Ignored character</td>
      <td>ASCII 0 <code>\0</code></td>
    </tr>
    <tr>
      <td>10</td>
      <td>Spacer</td>
      <td>ASCII codes 32 (space) and 9 (tab character)</td>
    </tr>
    <tr>
      <td>11</td>
      <td>Letter</td>
      <td>A…Z, a…z</td>
    </tr>
    <tr>
      <td>12</td>
      <td>Other</td>
      <td>0…9 plus @,.;?” and many others</td>
    </tr>
    <tr>
      <td>13</td>
      <td>Active character</td>
      <td>Special category code for creating single-character macros such as <code>~</code></td>
    </tr>
    <tr>
      <td>14</td>
      <td>Comment character-ignore everything that follows until the end of the line</td>
      <td><code>%</code></td>
    </tr>
    <tr>
      <td>15</td>
      <td>Invalid character, not allowed to appear in the <code>.tex</code> input file</td>
      <td>ASCII code 127 (<code>\127</code>)</td>
    </tr>
  </tbody>
</table>

<p>When <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> encounter a character with category 0 (e.g. <code>\</code>), it continue to scan the subsequent characters, which eventually results in one of the following<sup id="fnref:4" role="doc-noteref"><a href="#fn:4" rel="footnote">4</a></sup>:</p>
<ol>
  <li><em>Multi-letter commands</em>: the character following immediately after the escape character has category code 11 (letter). All subsequent characters that have category code 11 are considered to form the name of a command (control word). <img src="http://shapr.github.io/media/2020/latex3/tex.svg" alt="TeX"/> will stop looking for characters that form part of a command name when it detects any character that does not have category code 11—such as a space character with category code 10.</li>
  <li><em>Single-letter commands</em>: the character following immediately after the escape character does not have category code 11.</li>
</ol>

<p>This mechanism shows why we cannot put Arabic numerals or punctuations into command names. Interestingly, the category code associated with a particular character is <em>mutable</em>. That’s the reason why most hidden commands in <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> have <code>@</code> in their names, because the category code of <code>@</code> is usually 12 (other), which is illegal in command names. In order to access these commands, we need to call <code><span>\makeatletter</span></code>, which just as the name suggests, changes the category code of <code>@</code> to 11 (letter). After using hidden commands, we need to call <code>\makeatother</code> to reset category code assignment.</p>

<p>In <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>, command names are made up of English letters, underline (<code>_</code>) and colon(<code>:</code>). In order to activate the different naming scheme of <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>, one needs to enter <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> mode with <code><span>\ExplSyntaxOn</span></code> and exits with <code><span>\ExplSyntaxOff</span></code>. In general, <code><span>\ExplSyntaxOn</span></code> will make the following changes:</p>
<ul>
  <li>The category code of <code>_</code> and <code>:</code> will be set to 11 (letter)</li>
  <li>All spacers and line breaks will be ignored</li>
</ul>



<h3 id="name-of-variables">Name of variables</h3>

<ul>
  <li>Public variables: <code>\&lt;scope&gt;_&lt;module&gt;_&lt;description&gt;_&lt;type&gt;</code></li>
  <li>
    <p>Private variables: <code>\&lt;scope&gt;__&lt;module&gt;_&lt;description&gt;_&lt;type&gt;</code></p>
  </li>
  <li>Scope
    <ul>
      <li><code>l</code>: local variable</li>
      <li><code>g</code>: global variable</li>
      <li><code>c</code>: constant</li>
    </ul>
  </li>
  <li>Module: the name of module</li>
  <li>Description: the description of variable</li>
  <li>Common types:
    <ul>
      <li><code>clist</code>: comma separated list</li>
      <li><code>dim</code>: dimension</li>
      <li><code>fp</code>: floating point number</li>
      <li><code>int</code>: integer</li>
      <li><code>seq</code>: sequence (similar to <code>queue</code> in other programming languages)</li>
      <li><code>str</code>: string</li>
      <li><code>tl</code>: token list</li>
      <li><code>bool</code>: boolean</li>
      <li><code>regex</code>: regular expression</li>
      <li><code>prop</code>: property list (similar to <code>dict</code> in Python)</li>
      <li><code>ior/iow</code>: IO read/write</li>
    </ul>
  </li>
  <li>Examples
    <div><pre><span></span><span>\g_my_var_int</span>
<span>\l__testa_clist</span>
<span>\c_left_brace_str</span>
</pre></div>
  </li>
</ul>

<h3 id="name-of-functions">Name of functions</h3>

<p>When we write C/C++ code, we need to explicit declare the type of each arguments, for example:</p>

<div><div><pre><code><span>int</span> <span>mult</span><span>(</span><span>int</span> <span>a</span><span>,</span> <span>int</span> <span>b</span><span>){</span>
  <span>return</span> <span>a</span> <span>*</span> <span>b</span><span>;</span>
<span>}</span>
</code></pre></div></div>

<p>To increase the readability of <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> code, a similar design is adopted: detailed information about each argument is specified in <code>&lt;arg-spec&gt;</code>.</p>

<ul>
  <li>Public functions: <code>\&lt;module&gt;_&lt;description&gt;:&lt;arg-spec&gt;</code></li>
  <li>
    <p>Private functions: <code>\__&lt;module&gt;_&lt;description&gt;:&lt;arg-spec&gt;</code></p>
  </li>
  <li>Module: the name of module</li>
  <li>Description: the description of variable</li>
  <li>Argument specification: detailed description of each argument encoded in a string
    <ul>
      <li><code>n</code>: receives a token list (for now, we can treat token lists as contents enclosed by curly braces)</li>
      <li><code>N</code>: receives a command, pass the command itself</li>
      <li><code>V</code>：receives a command, pass the <em>value</em> of the command</li>
      <li><code>o</code>：similar to <code>n</code>, but expands the token list once</li>
      <li><code>x</code>：similar to <code>n</code>, but expands the token list recursively</li>
      <li><code>T</code>/<code>F</code>: usually used in <code>if</code> statements: the corresponding <code>T</code> or <code>F</code> code is executed based on the condition</li>
      <li><code>p</code>: parameter list, usually consists of <code>#1#2</code>…</li>
      <li><code>c</code>: receives a token list, pass the command named after the token list (similar to <code><span>\csname</span></code>…<code><span>\endcsname</span></code>)</li>
    </ul>
  </li>
</ul>

<div>
  
  <p>It is worth mentioning that all these naming conventions are merely a <em>suggestion</em>: in most cases, <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> will not prase the name of the command to acquire information. There is essentially no hard restriction on the name of variables and functions: the scope or public/private identifiers are purely for the sake of users, not the <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> compiler. However, using consistent naming convention can increase code readibility.</p>
</div>

<h2 id="reading-latex3-documentation">Reading LaTeX3 Documentation</h2>

<p>At this moment, most <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> materials are compiled in <a href="http://mirrors.ctan.org/macros/latex/contrib/l3kernel/interface3.pdf">The LaTeX3 Interfaces</a>. The first chapter of this document briefly introduces the fundamentals of <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>. Each subsequent chapter elaborates on a module of <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>. Functions are grouped in different sections based on their purposes.</p>

<h3 id="function-documentation">Function documentation</h3>

<p>Most items in sections are detailed descriptions about <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> functions. Take <code><span>\tl_set</span><span>:Nn</span></code> as an example:</p>

<p><img src="http://shapr.github.io/media/2020/latex3/tl-set.png" alt="tl-set-doc"/>
</p>

<ul>
  <li>All variants of a function is listed in box on the left. According to the screenshot above, the following functions are provided by <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/><sup id="fnref:5" role="doc-noteref"><a href="#fn:5" rel="footnote">5</a></sup>:
    <div><pre><span></span><span>\tl_set</span><span>:Nn</span>
<span>\tl_set</span><span>:NV</span>
<span>\tl_gset</span><span>:Nx</span>
<span>\tl_gset</span><span>:cx</span>
</pre></div>
  </li>
  <li>The syntax of a function is on the top-right.</li>
  <li>The detailed description of a function is on the bottom-right.</li>
</ul>

<h3 id="scratch-variables">Scratch variables</h3>

<p>Many <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> modules come with predefined “scratch variables” so that users do not have to declare any variable when the code is small. In every chapter, their is a dedicated section to document what scratch variables (as well as constants) are defined.</p>

<p><img src="http://shapr.github.io/media/2020/latex3/scratch-token-list.png" alt="tl-set-doc"/>
</p>

<p>When writing serious <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> code, it is recommended to avoid scratch variables to maximize compatibility.</p>

<h3 id="constants">Constants</h3>

<p>Some <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> libraries come with pre-defined constants. They will be introduced in a dedicated section.</p>

<p><img src="http://shapr.github.io/media/2020/latex3/c-pi-fp.png" alt="tl-set-doc"/>
<img src="http://shapr.github.io/media/2020/latex3/constant-string.png" alt="tl-set-doc"/>
</p>

<h3 id="summary">Summary</h3>



<h2 id="functions--variables">Functions &amp; Variables</h2>

<h3 id="defining-and-using-variables">Defining and using variables</h3>

<p>Each module of <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> may use different variable construction format. Therefore, it is important to initialize each variable type with its dedicated function. In general, function ends in <code>new</code> are for declaring new variables; functions that contains <code>set</code> or <code>gset</code> are for modifying variables’ states; functions that contains <code>get</code> are for acquiring variables’ states.</p>

<div>
  
  <p>Consider two specific cases <code><span>\tl_set</span><span>:Nn</span></code> and <code><span>\tl_gset</span><span>:Nn</span></code>, which are both used for modifying a token list’s value. What are the differences? As it turns out, the letter <code>g</code> in <code>gset</code> stands for “global”: usually, <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> only sets the value of a variable <em>locally</em>, i.e. within its own group. That is to say, the modified value will not be visible outside the group. Therefore, if we wish a change to be accessible for all functions, we need to use <code>gset</code> variants.</p>

  <p>A concrete example:</p>
  <div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\tl_set</span><span>:Nn</span> <span>\l_tmpa_tl</span> <span>{</span>A<span>}</span>
<span>\group_begin</span><span>:</span>
<span>\tl_set</span><span>:Nn</span> <span>\l_tmpa_tl</span> <span>{</span>B<span>}</span>
<span>\par</span> value~inside~group:~<span>\tl_use</span><span>:N</span> <span>\l_tmpa_tl</span>
<span>\group_end</span><span>:</span>
<span>\par</span> value~outside~group:~<span>\tl_use</span><span>:N</span> <span>\l_tmpa_tl</span></pre></div>

  <p>The output is:</p>
  <div><div><pre><code>value inside group: B
value outside group: A
value inside group: B
value outside group: B
</code></pre></div>  </div>

  <p>It can be seen that <code><span>\tl_set</span><span>:Nn</span></code> only modifies the value inside the group and leaves the value outside untouched; while <code><span>\tl_gset</span><span>:Nn</span></code> changes both values.</p>

</div>

<p>In general, the principles of using <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> variables are:</p>
<ol>
  <li>Determine the correct variable type and call the corresponding declaration function (if the number of needed variables is small, conside using scratch variables).</li>
  <li>Determine the scope and name the variable according to <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> naming conventions.</li>
  <li>Use <code>set</code> or <code>gset</code> functions to modify a variable’s value.</li>
  <li>Use corresponding library functions to operate on variables.</li>
</ol>

<h3 id="declaring-functions-iv-32">Declaring functions (IV-3.2)</h3>

<p>In <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>, <code><span>\cs_set</span><span>:Npn</span></code> is usually used for declaring functions. Apart from it, there are also other three functions that serve this job, namely <code><span>\cs_set_nopar</span><span>:Npn</span></code>, <code><span>\cs_set_protected</span><span>:Npn</span></code> and <code><span>\cs_set_protected_nopar</span><span>:Npn</span></code>. Because <code><span>\cs_set</span><span>:Npn</span></code> is used in most cases, we mainly put our focus on it. In fact, their usages are extremely close.</p>

<p>The procedure of declaring a function is as follows:</p>
<ol>
  <li>Determine the number of arguments and their corresponding types (<img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> macros can accpet at most 9 arguments)</li>
  <li>Name the function according to <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> naming convention and define the function with one of functions above.</li>
</ol>

<p>For example, suppose we are to create a function that concatenates its two arguments with comma. Therefore, we know the number of arguments is 2, and both arguments are of type <code>n</code>. As a result, we can name the function <code><span>\my_concat</span><span>:nn</span></code>. We can define <code><span>\my_concat</span><span>:nn</span></code> like so:</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>%define \my_concat:nn</span>
<span>\cs_set</span><span>:Npn</span> <span>\my_concat</span><span>:nn</span> #1#2 <span>{</span>
    #1,~#2
<span>}</span>
<span>%use \my_concat:nn</span>
<span>\my_concat</span><span>:nn</span> <span>{</span>a<span>}{</span>b<span>}</span> <span>%result: a, b</span>
<span>\ExplSyntaxOff</span>
</pre></div>



<h4 id="copying-the-definition-of-existing-functions">Copying the definition of existing functions</h4>

<p>Sometimes, it is convenient to copy the definition of existing functions. This can be achieved by invoking <code><span>\cs_set_eq</span><span>:NN</span></code>. In the following example, we create a <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> version of <code><span>\section</span></code> function: <code><span>\my_section</span><span>:n</span></code>, and then use it to declare a new “Hello World” section. As we will show later, <strong>if a function is declared using <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> naming convention, its macro expansion control will be more convenient.</strong></p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\cs_set_eq</span><span>:NN</span> <span>\my_section</span><span>:n</span> <span>\section</span>
<span>\my_section</span><span>:n</span> <span>{</span>Hello~World<span>}</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<h4 id="showing-the-definition-of-functions">Showing the definition of functions</h4>

<p>It is possible to show the definition of a function by using <code><span>\cs_meaning</span><span>:N</span></code>. For example, <code><span>\cs_meaning</span><span>:N</span> <span>\section</span>
</code> gives:</p>

<div><div><pre><code>\long macro:-&gt;\@startsection {section}{1}{\z@ }{-3.5ex \@plus -1ex \@minus
-.2ex}{2.3ex \@plus .2ex}{\normalfont \Large \bfseries }
</code></pre></div></div>

<h3 id="summary-1">Summary</h3>



<h2 id="macro-expansion-control-v">Macro Expansion Control (V)</h2>

<p>Back to the <code><span>\uppercase</span></code> example above:</p>
<div><div><pre><code><span>\newcommand</span><span>{</span><span>\cmda</span><span>}{</span>abcd<span>}</span>
<span>\uppercase</span><span>{</span>abcd<span>\cmda</span><span>}</span> <span>%ABCDabcd</span>
</code></pre></div></div>

<p>To show how macro expansion can be resolved with <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>, we first create a <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> equivalent for the function, namely <code><span>\my_uppercase</span><span>:n</span></code>. At this point, the behavior of <code><span>\my_uppercase</span><span>:n</span></code> is the same as <code><span>\uppercase</span></code>.</p>

<div><pre><span></span><span>\newcommand</span><span>{</span><span>\cmda</span><span>}{</span>abcd<span>}</span>
<span>\ExplSyntaxOn</span>
<span>\cs_set_eq</span><span>:NN</span> <span>\my_uppercase</span><span>:n</span> <span>\uppercase</span>
<span>\my_uppercase</span><span>:n</span> <span>{</span>abcd<span>\cmda</span><span>}</span> <span>% ABCDabcd</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>Now, we discuss two ways to manipulation macro expansion so that the output becomes <code>ABCDABCD</code> (instead of <code>ABCDabcd</code>).</p>

<h3 id="method-1-change-argument-specification-of-functions">Method 1: change argument specification of functions</h3>

<p>At this moment, the argument type of <code><span>\my_uppercase</span><span>:n</span></code> is <code>n</code>, which indicates an unexpanded token list. As a matter of fact, every function has <code>n</code> or <code>N</code> type arguments when first declared. Now, we would like to change to type signature to <code>x</code>, i.e. expanding everything in the token list recursively before being passed to <code><span>\my_uppercase</span></code>. In <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>, there is a function dedicated to changing the argument specification of other functions: <code><span>\cs_generate_variant</span><span>:Nn</span></code>. It takes two arguments: the first one is the function we would like to modify; the second one is the new argument specification. Given <code><span>\my_uppercase</span><span>:n</span></code>, we can generate <code><span>\my_uppercase</span><span>:x</span></code> with the help of <code><span>\cs_generate_variant</span><span>:Nn</span></code> and then invoke the new function variant.</p>

<div><pre><span></span><span>\newcommand</span><span>{</span><span>\cmda</span><span>}{</span>abcd<span>}</span>
<span>\ExplSyntaxOn</span>
<span>\cs_set_eq</span><span>:NN</span> <span>\my_uppercase</span><span>:n</span> <span>\uppercase</span>
<span>\cs_generate_variant</span><span>:Nn</span> <span>\my_uppercase</span><span>:n</span> <span>{</span>x<span>}</span>
<span>\my_uppercase</span><span>:x</span> <span>{</span>abcd<span>\cmda</span><span>}</span> <span>% ABCDABCD</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p><strong>Important Notice</strong>: <code><span>\cs_generate_variant</span><span>:Nn</span></code> only works for functions following <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> naming convention.</p>

<h3 id="method-2-use-exp_argsn-functions-v4-v5-v6">Method 2: use <code>\exp_args:N</code> functions (V.4, V.5, V.6)</h3>

<p>Declaring new variants with <code><span>\cs_generate_variant</span><span>:Nn</span></code> frequently may be a bit inconvenient. Fortunately, <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> provides a series of <code><span>\exp_args</span><span>:N</span></code> functions that can facilitate macro expansion control when the number of arguments in small.</p>

<p>In short, if we use <code><span>\cs_generate_variant</span><span>:Nn</span></code> to generate and use a new variant function:</p>

<div><pre><span></span><span>\cs_generate_variant</span><span>:Nn</span> <span>\func</span><span>:abcd</span> <span>{</span>efgh<span>}</span>
<span>\func</span><span>:efgh</span> <span>{</span>1<span>}{</span>2<span>}{</span>3<span>}{</span>4<span>}</span>
</pre></div>

<p>It will be equivalent to the following <code><span>\exp_args</span><span>:N</span></code> function call:</p>

<div><pre><span></span><span>\exp_args</span><span>:Nefgh</span> <span>\func</span><span>:abcd</span> <span>{</span>1<span>}{</span>2<span>}{</span>3<span>}{</span>4<span>}</span>
</pre></div>

<p>Using <code><span>\exp_args</span><span>:N</span></code> functions, we can also fully expand the argument for <code><span>\my_uppercase</span><span>:n</span></code>:</p>

<div><pre><span></span><span>\newcommand</span><span>{</span><span>\cmda</span><span>}{</span>abcd<span>}</span>
<span>\ExplSyntaxOn</span>
<span>\cs_set_eq</span><span>:NN</span> <span>\my_uppercase</span><span>:n</span> <span>\uppercase</span>
<span>\exp_args</span><span>:Nx</span> <span>\my_uppercase</span><span>:n</span> <span>{</span>abcd<span>\cmda</span><span>}</span> <span>%ABCDABCD</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>It is worth noticing that <code>\exp_args:N</code> functions can be used to control expansion <em>partially</em>. For example, if a function takes three arguments, and we apply <code>\exp_args:Nc</code> to it, then only the first argument will be modified, while the rest are left untouched. In the example below, we apply <code>c</code> type exansion to the first argument of <code><span>\NewDocumentCommand</span></code> from <code>xparse</code> package, which allows us to declare a command named after the content stored in a variable.</p>

<div><pre><span></span><span>% load `xparse` package for this example (will be automatically loaded for newer TeX versions)</span>
<span>\ExplSyntaxOn</span>
<span>% store command name in a variable</span>
<span>\tl_set</span><span>:Nn</span> <span>\l_tmpa_tl</span> <span>{</span>mycmd<span>}</span>

<span>% use \exp_args:Nc to expand the first arguemnt only</span>
<span>% which allows us to declare a command using the content of \l_tmpa_tl</span>
<span>\exp_args</span><span>:Nc</span> <span>\NewDocumentCommand</span><span>{</span><span>\l_tmpa_tl</span><span>}{</span>m<span>}{</span>
  <span>\par</span> you~entered~#1
<span>}</span>

<span>% you entered something</span>
<span>\mycmd</span><span>{</span>something<span>}</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<h3 id="summary-2">Summary</h3>



<h2 id="latex3-token-list-and-string">LaTeX3: Token List and String</h2>

<h3 id="token-list-vii">Token list (VII)</h3>

<p>Everything that is entered in a <code>tex</code> file can be interpreted as a <em>token</em>. Therefore, token lists are collections of all objects recognized by the <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> compiler. In <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>, token lists are the most fundamental and frequently used variable type.</p>

<h4 id="constructing-a-command-in-token-list">Constructing a command in token list</h4>

<p>Suppose we would like to call <code><span>\section*</span><span>{</span>&lt;title&gt;<span>}</span></code>, and the <code>&lt;title&gt;</code> is stored in the token list variable <code><span>\l_tmpa_tl</span></code>. We can do it as follows:</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>% put the title in \l_tmpa_tl</span>
<span>\tl_set</span><span>:Nn</span> <span>\l_tmpa_tl</span> <span>{</span>My~Title<span>}</span>
<span>% construct the command in \l_tmpb_tl</span>
<span>\tl_set</span><span>:Nx</span> <span>\l_tmpb_tl</span> <span>{</span><span>\exp_not</span><span>:N</span> <span>\section*</span> <span>{</span><span>\l_tmpa_tl</span><span>}}</span>
<span>\cs_meaning</span><span>:N</span> <span>\l_tmpb_tl</span> <span>% macro:-&gt;\section *{My Title}</span>
<span>% place the content of \l_tmpb_tl into the input stream</span>
<span>\tl_use</span><span>:N</span> <span>\l_tmpb_tl</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>In this case, we are using <code><span>\tl_set</span><span>:Nx</span></code>, which means everything inside the curly braces will be expanded completely and recursively. As a result, in the definition of <code><span>\l_tmpb_tl</span></code>, the variable name <code><span>\l_tmpa_tl</span></code> will be replaced by its <em>value</em> (expanded recursively). Since we do not want to expand the definition of <code><span>\section</span></code>, we use <code><span>\exp_not</span><span>:N</span></code> to suppress its expansion.</p>

<p>The <code>x</code> expansion might cause problems when the content of <code><span>\l_tmpa_tl</span></code> contains commands. 
If we only want to put the value of <code><span>\l_tmpa_tl</span></code> surrounded by curly braces in <code><span>\l_tmpb_tl</span></code>, we can use <code><span>\exp_not</span><span>:V</span></code> in <code><span>\tl_set</span><span>:Nx</span></code> as follows: 
<code><span>\tl_set</span><span>:Nx</span> <span>\l_tmpb_tl</span> <span>{</span><span>\exp_not</span><span>:N</span> <span>\section*</span> <span>{</span><span>\exp_not</span><span>:V</span><span>\l_tmpa_tl</span><span>}}</span></code>.
When being expanded, the <code><span>\exp_not</span><span>:V</span></code> command will place the value of the next variable in the output and prevent the value from being further expanded.</p>

<h4 id="student-management-system">Student management system</h4>

<p>Suppose we want to set up an internal student management system in <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/>. We would like to implement the following three commands:</p>

<ul>
  <li><code><span>\student</span></code>: add a new student into the system</li>
  <li><code><span>\allstudent</span></code>: show all students, separated by commas</li>
  <li><code><span>\thestudent</span></code>: takes one argument and shows the \(i\)-th student</li>
</ul>

<p>We will reuse this example many times throughout this tutorial, but with different implementation techniques. Here, we use token list related functions to implement the three commands above.</p>

<div><pre><span></span><span>\documentclass</span><span>{</span>article<span>}</span>
<span>\usepackage</span><span>[T1]</span><span>{</span>fontenc<span>}</span>
<span>\usepackage</span><span>{</span>expl3<span>}</span>
<span>\usepackage</span><span>{</span>amsmath, amssymb<span>}</span>

<span>\begin</span><span>{</span>document<span>}</span>

<span>\ExplSyntaxOn</span>
<span>% stores all students, separated by commas</span>
<span>\tl_new</span><span>:N</span> <span>\l_student_comma_tl</span>
<span>% stores the name of each student</span>
<span>\tl_new</span><span>:N</span> <span>\l_student_group_tl</span>
<span>\newcommand</span><span>{</span><span>\student</span><span>}</span>[1]<span>{</span>
    #1<span>% outputs student&#39;s name</span>
    <span>% check if \l_student_comma_tl is empty</span>
    <span>% this is a conditional branch statement</span>
    <span>% which we will discuss in the subsequent sections</span>
    <span>\tl_if_empty</span><span>:NTF</span> <span>\l_student_comma_tl</span> <span>{</span>
        <span>% if empty, do not prepend comma before name</span>
        <span>\tl_put_right</span><span>:Nn</span> <span>\l_student_comma_tl</span> <span>{</span>#1<span>}</span>
    <span>}</span> <span>{</span>
        <span>% otherwise, prepend comma before name</span>
        <span>\tl_put_right</span><span>:Nn</span> <span>\l_student_comma_tl</span> <span>{</span>,~#1<span>}</span>
    <span>}</span>
    <span>% put student name in a group and</span>
    <span>% store it in \l_student_group_tl</span>
    <span>\tl_put_right</span><span>:Nn</span> <span>\l_student_group_tl</span> <span>{{</span>#1<span>}}</span>
<span>}</span>
<span>\newcommand</span><span>{</span><span>\allstudent</span><span>}{</span>
    <span>% outputs \l_student_comma_tl</span>
    <span>\tl_use</span><span>:N</span> <span>\l_student_comma_tl</span>
<span>}</span>
<span>\newcommand</span><span>{</span><span>\thestudent</span><span>}</span>[1]<span>{</span>
    <span>% outputs the #1-th token in \l_student_group_tl</span>
    <span>\tl_item</span><span>:Nn</span> <span>\l_student_group_tl</span> <span>{</span>#1<span>}</span>
<span>}</span>
<span>\ExplSyntaxOff</span>

<span>% John and Lisa and David and Emily</span>
<span>\student</span><span>{</span>John<span>}</span> and <span>\student</span><span>{</span>Lisa<span>}</span> and <span>\student</span><span>{</span>David<span>}</span> and <span>\student</span><span>{</span>Emily<span>}</span>

<span>% John, Lisa, David, Emily</span>
<span>\par\allstudent</span>

<span>% Emily and David and Lisa and John</span>
<span>\par\thestudent</span><span>{</span>4<span>}</span> and <span>\thestudent</span><span>{</span>3<span>}</span> and <span>\thestudent</span><span>{</span>2<span>}</span> and <span>\thestudent</span><span>{</span>1<span>}</span>

<span>\end</span><span>{</span>document<span>}</span>
</pre></div>

<ul>
  <li>In this solution, we store each name twice in <code><span>\l_student_comma_tl</span></code> and <code><span>\l_student_group_tl</span></code>. <code><span>\l_student_comma_tl</span></code> stores the name of all students, joined by commas, which is used by <code><span>\allstudent</span></code>. <code><span>\l_student_group_tl</span></code> allows index access for student names, for each student is saved as a group in the token list. Every time one calls <code><span>\student</span></code>, the new student name will be inserted into the two token lists.</li>
  <li>When inserting into <code><span>\l_student_comma_tl</span></code>, there is no need to prepend comma if it is the first name. Therefore, we need to use the conditional statement <code><span>\tl_if_empty</span><span>:NTF</span></code> to specify this behavior.</li>
  <li>Notice that we surround the student name with curly braces when inserting into <code><span>\l_student_group_tl</span></code>, which effectively encapsulates each student name inside a group. As a result, when calling <code><span>\tl_item</span><span>:Nn</span></code>, the entire group will be returned, which allows us to retrieve the student name as a whole.</li>
</ul>

<h3 id="string-viii">String (VIII)</h3>

<p>A close relative to token list is <em>string</em>. When we apply <code><span>\tl_use</span><span>:N</span></code> to a token list variable, it is equivalent to typing its content directly in the <code>tex</code> file. If we run the following example</p>

<div><pre><span></span><span>\newcommand</span><span>{</span><span>\cmda</span><span>}{</span>efgh<span>}</span>
<span>\ExplSyntaxOn</span>
<span>\tl_set</span><span>:Nn</span> <span>\l_tmpa_tl</span> <span>{</span>abcd<span>\cmda</span><span>}</span>
<span>\tl_use</span><span>:N</span> <span>\l_tmpa_tl</span> <span>%abcdefgh</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>then we will get <code>abcdegfh</code> in the document output, because <code><span>\cmda</span></code> is stored as a command in <code><span>\l_tmpa_tl</span></code>, which is subsequently expanded to <code>efgh</code>. However, If we run the same example with string type, then everything inside the string variable will be interpereted as text instead of command of special character. Consequently, the output in the document becomes <code>abcd\cmda</code>.</p>

<div><pre><span></span><span>\newcommand</span><span>{</span><span>\cmda</span><span>}{</span>efgh<span>}</span>
<span>\ExplSyntaxOn</span>
<span>\str_set</span><span>:Nn</span> <span>\l_tmpa_str</span> <span>{</span>abcd<span>\cmda</span><span>}</span>
<span>\str_use</span><span>:N</span> <span>\l_tmpa_str</span> <span>%abcd\cmda</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>We can use <code><span>\tl_to_str</span><span>:n</span></code> to convert a token list into a string. It is possible to transform strings back to token lists with <code><span>\tl_rescan</span><span>:nn</span></code><sup id="fnref:6" role="doc-noteref"><a href="#fn:6" rel="footnote">6</a></sup>.</p>

<h4 id="vertical-text-node-in-tikz">Vertical text node in TikZ</h4>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\cs_set</span><span>:Npn</span> <span>\my_vert_str</span><span>:n</span> #1 <span>{</span>
  <span>% store argument as string</span>
  <span>\str_set</span><span>:Nn</span> <span>\l_tmpa_str</span> <span>{</span>#1<span>}</span>
  <span>% traverse the string</span>
  <span>\str_map_inline</span><span>:Nn</span> <span>\l_tmpa_str</span> <span>{</span>
      <span>% center each character at their own line</span>
      <span>\centering</span> ##1 <span>\par</span>
  <span>}</span>
<span>}</span>
<span>% declare latex interface</span>
<span>\newcommand</span><span>{</span><span>\vertstr</span><span>}</span>[1]<span>{</span>
  <span>\my_vert_str</span><span>:n</span> <span>{</span>#1<span>}</span>
<span>}</span>
<span>\ExplSyntaxOff</span>

<span>\begin</span><span>{</span>tikzpicture<span>}</span>
<span>\node</span><span>[draw=black, text width=1cm]</span> <span>{</span><span>\vertstr</span><span>{</span>ab<span>$</span><span>c</span><span>$</span>d~<span>\\\\</span><span>}}</span>;
<span>\end</span><span>{</span>tikzpicture<span>}</span>
</pre></div>

<p>Output:</p>

<p><img src="http://shapr.github.io/media/2020/latex3/vert-node.png"/>
</p>

<div>
  
  <p><img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>’s string method is implemented with <code><span>\detokenize</span></code>. As a result, neither <code><span>\tl_to_str</span><span>:n</span></code> nor <code><span>\str_set</span><span>:Nn</span></code> can guarantee that the string output is <strong>exactly the same as users’ input</strong>. For example, <code><span>\detokenize</span></code> adds an extra space after commands.  That is, <code><span>\verb</span>|abc|</code> becomes <code><span>\verb</span> |abc|</code>. This can be tricky in some scenarios.</p>
</div>

<div>
  
  <p>Very frequently, we need to compare if two token lists or strings are equal. Since the token list library and string library both have their own equality functions, we can choose between <code><span>\tl_if_eq</span><span>:</span></code> (from token list library) and <code><span>\str_if_eq</span><span>:</span></code> (from string library). Unless it is absolutely necessary, <strong>it is recommended to use string library’s comparision functions</strong>. That is because <code><span>\tl_if_eq</span><span>:</span></code> not only checks if the characters are the same, but it also checks if the category code of each character is the same. As a result, two seemingly identical variables can result in <code>False</code> outcome when using <code><span>\tl_if_eq</span><span>:</span></code>.</p>
</div>

<h2 id="latex3-numeric-evaluation-and-boolean-logic">LaTeX3: Numeric Evaluation and Boolean Logic</h2>

<p>This section mainly consists of code snippets with detailed comments, for the underlying methodology of these topics are similar to other programming languages. Therefore, it is more beneficial to be able to locate the correct APIs in <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> documentation.</p>

<h3 id="boolean-logic-xiii">Boolean logic (XIII)</h3>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>% declare new boolean value</span>
<span>\bool_new</span><span>:N</span> <span>\l_my_bool</span>
<span>% set to true</span>
<span>\bool_set_true</span><span>:N</span> <span>\l_my_bool</span>
<span>% set to false</span>
<span>\bool_set_false</span><span>:N</span> <span>\l_my_bool</span>
<span>% boolean based conditional statement</span>
<span>\bool_if</span><span>:nTF</span> <span>{</span><span>\l_my_bool</span><span>}</span> <span>{</span>true<span>}</span> <span>{</span>false<span>}</span> <span>%false</span>
<span>% boolean based while loop</span>
<span>\bool_do_while</span><span>:nn</span> <span>{</span><span>\l_my_bool</span><span>}</span> <span>{}</span>
<span>% boolean based until loop</span>
<span>% boolean functions support C/C++</span>
<span>% style !, || and &amp;&amp; operations</span>
<span>\bool_do_until</span><span>:nn</span> <span>{</span>!<span>\l_my_bool</span><span>}</span> <span>{}</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<h3 id="integer-arithmetic">Integer arithmetic</h3>

<h4 id="implementing-modulo-operation">Implementing modulo operation</h4>
<p>It is worth noticing that <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> already has <code><span>\int_mod</span><span>:nn</span></code>. This sample is for demonstration purposes.</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\cs_set</span><span>:Npn</span> <span>\my_mod</span><span>:nn</span> #1#2 <span>{</span>
  <span>% store #1//#2 in \l_tmpa_int</span>
  <span>\int_set</span><span>:Nn</span> <span>\l_tmpa_int</span> <span>{</span> <span>\int_div_truncate</span><span>:nn</span> <span>{</span>#1<span>}{</span>#2<span>}</span> <span>}</span>
  <span>% compute (#1)-\l_tmpa_int*(#2)</span>
  <span>% make sure to surround operands with parentheses</span>
  <span>% so that when #1 is an expression (e.g. 3-2)</span>
  <span>% the order of arithmetic will not change</span>
  <span>\int_eval</span><span>:n</span> <span>{</span> (#1) - <span>\l_tmpa_int</span> * (#2) <span>}</span>
<span>}</span>
<span>% define LaTeX interface</span>
<span>\newcommand</span><span>{</span><span>\mymod</span><span>}</span>[2]<span>{</span>
  <span>\my_mod</span><span>:nn</span> <span>{</span>#1<span>}</span> <span>{</span>#2<span>}</span>
<span>}</span>
<span>\ExplSyntaxOff</span>
<span>\mymod</span><span>{</span>5<span>}{</span>3<span>}</span><span>\mymod</span><span>{</span>6<span>}{</span>3<span>}</span><span>\mymod</span><span>{</span>7<span>}{</span>1+2<span>}</span><span>%201</span>
</pre></div>

<h4 id="implementing-caesar-cipher">Implementing Caesar cipher</h4>

<p><a href="https://en.wikipedia.org/wiki/Caesar_cipher">Caesar cipher</a> is a classic substitution cipher in cryptography.</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\cs_set</span><span>:Npn</span> <span>\my_caesar_cipher</span><span>:n</span> #1 <span>{</span>
  <span>% transform #1 to lower case and store in \l_tmpa_str</span>
  <span>\str_set</span><span>:Nx</span> <span>\l_tmpa_str</span> <span>{</span><span>\tl_lower_case</span><span>:n</span> <span>{</span>#1<span>}}</span>
  <span>% clear \l_tmpb_str to store results</span>
  <span>\str_clear</span><span>:N</span> <span>\l_tmpb_str</span>
  <span>% \str_map_inline:Nn traverses the string</span>
  <span>% and pass each character as first argument</span>
  <span>\str_map_inline</span><span>:Nn</span> <span>\l_tmpa_str</span> <span>{</span>
      <span>% `##1 gives the ASCII code of ##1</span>
      <span>% 91 is the ASCII code of &#39;a&#39;</span>
      <span>% this allows us to compute the offset of ##1</span>
      <span>\int_set</span><span>:Nn</span> <span>\l_tmpa_int</span> <span>{</span> <span>\int_eval</span><span>:n</span> <span>{</span>`##1 - 97<span>}</span> <span>}</span>
      <span>% suppose the shifting of our Ceaser cipher is 3</span>
      <span>\int_set</span><span>:Nn</span> <span>\l_tmpb_int</span> <span>{</span> <span>\int_mod</span><span>:nn</span> <span>{</span><span>\l_tmpa_int</span> + 3<span>}{</span>26<span>}</span> <span>}</span>
      <span>% place new character in \l_tmpb_str</span>
      <span>\str_put_right</span><span>:Nx</span> <span>\l_tmpb_str</span> <span>{</span>
          <span>% this function generates a character given</span>
          <span>% character code and category code</span>
          <span>% because we are dealing with English letters</span>
          <span>% the category code is 11</span>
          <span>\char_generate</span><span>:nn</span> <span>{</span><span>\l_tmpb_int</span> + 97<span>}{</span>11<span>}</span>
      <span>}</span>
  <span>}</span>
  <span>% outputs \l_tmpb_str</span>
  <span>\str_use</span><span>:N</span> <span>\l_tmpb_str</span>
<span>}</span>
<span>\my_caesar_cipher</span><span>:n</span> <span>{</span>helloworld<span>}</span><span>%khoorzruog</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<h3 id="integer-based-loop-and-condition">Integer-based loop and condition</h3>

<p>Common integer-based conditional statements:</p>
<ol>
  <li><code><span>\int_compare_p</span><span>:</span></code> series: compare two integers given a relation and returns a boolean value</li>
  <li><code><span>\int_compare</span><span>:</span></code> series: compare two integers given a relation and execute <code>T</code> code or <code>F</code> code based on the result</li>
</ol>

<p>Common integer-based loops:</p>
<ol>
  <li><code><span>\int_do_while</span><span>:</span></code> series</li>
  <li><code><span>\int_do_until</span><span>:</span></code> series</li>
  <li><code><span>\int_step_function</span><span>:</span></code>, <code><span>\int_step_inline</span><span>:</span></code> and <code><span>\int_step_variable</span><span>:</span></code></li>
</ol>

<p>1, 2 are often used with <code><span>\int_incr</span><span>:N</span></code> (<code><span>\int_gincr</span><span>:N</span></code>) and <code><span>\int_decr</span><span>:N</span></code> (<code><span>\int_gdecr</span><span>:N</span></code>)</p>

<div>
  
  <p>One may have noticed that most integer related comparions provide <code>:n</code> and :nNn` variants. They are different in the following ways:</p>
  <ul>
    <li><code>:nNn</code> only supports three types of comparsion: <code>&lt;</code>, <code>&gt;</code> and <code>=</code></li>
    <li>In addition to <code>&lt;</code>, <code>&gt;</code> and <code>==</code>, <code>:n</code> also supports <code>&gt;=</code>, <code>&lt;=</code> and <code>!=</code></li>
    <li><code>:n</code> supports chained comparison: <code>a&lt;b&lt;c</code></li>
    <li>The speed of <code>:n</code> is about one fifth of the speed of <code>:nNn</code></li>
  </ul>

  <div><pre><span></span><span>\int_compare_p</span><span>:nNn</span> <span>{</span><span>\l_tmpa_int</span><span>}</span> &lt; <span>{</span><span>\l_tmpb_int</span><span>}</span>
<span>% is equivalant to </span>
<span>\int_compare_p</span><span>:n</span> <span>{</span><span>\l_tmpa_int</span> &lt; <span>\l_tmpb_int</span><span>}</span>
</pre></div>

</div>

<h4 id="computing-the-greatest-common-divisor-non-recursive">Computing the greatest common divisor (non-recursive)</h4>

<p>We implement the <a href="https://en.wikipedia.org/wiki/Euclidean_algorithm">Eulidean algorithm</a> to compute the greatest common divisor.</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>% declare one more scratch variable</span>
<span>\int_new</span><span>:N</span> <span>\l_tmpc_int</span>
<span>\cs_set</span><span>:Npn</span> <span>\my_gcd</span><span>:nn</span> #1#2 <span>{</span>
  <span>% put #1 in \l_tmpa_int</span>
  <span>\int_set</span><span>:Nn</span> <span>\l_tmpa_int</span> <span>{</span>#1<span>}</span>
  <span>% put #2 in \l_tmpb_int</span>
  <span>\int_set</span><span>:Nn</span> <span>\l_tmpb_int</span> <span>{</span>#2<span>}</span>
  <span>% loop until \l_tmpb_int equals 0</span>
  <span>\int_do_until</span><span>:nNnn</span> <span>{</span><span>\l_tmpb_int</span><span>}</span> = <span>{</span>0<span>}</span> <span>{</span>
      <span>% update three variables</span>
      <span>\int_set</span><span>:Nn</span> <span>\l_tmpc_int</span> <span>{</span> <span>\l_tmpb_int</span> <span>}</span>
      <span>\int_set</span><span>:Nn</span> <span>\l_tmpb_int</span> <span>{</span> <span>\int_mod</span><span>:nn</span> <span>{</span><span>\l_tmpa_int</span><span>}{</span><span>\l_tmpb_int</span><span>}</span> <span>}</span>
      <span>\int_set</span><span>:Nn</span> <span>\l_tmpa_int</span> <span>{</span><span>\l_tmpc_int</span><span>}</span>
  <span>}</span>
  <span>% outputs \l_tmpa_int</span>
  <span>\int_use</span><span>:N</span> <span>\l_tmpa_int</span>
<span>}</span>
<span>\my_gcd</span><span>:nn</span> <span>{</span>6<span>}{</span>3<span>}</span>~<span>\my_gcd</span><span>:nn</span> <span>{</span>270<span>}{</span>192<span>}</span><span>% 3 6</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<h4 id="computing-the-greatest-common-divisor-recursive">Computing the greatest common divisor (recursive)</h4>

<p>As mentioned above, compared to <code>gset</code> functions, <code>set</code> functions only modify variable values within the current group. Using this mechanism, it is possible to imitate a callstack in other programming languages to implement recursive algorithms. In the following example, it is shown that local varialbles will not be modified by subroutines because each <code>set</code> function is guarded by <code><span>\group_begin</span><span>:</span></code> and <code><span>\group_end</span><span>:</span></code>.</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\cs_set</span><span>:Npn</span> <span>\my_gcd_recursive</span><span>:nn</span> #1#2 <span>{</span>
	<span>\group_begin</span><span>:</span>
	<span>% all variable assignments will be constrained in this group</span>
	<span>\int_compare</span><span>:nNnTF</span> <span>{</span>#2<span>}</span> = <span>{</span>0<span>}</span> <span>{</span>
		<span>\int_gset</span><span>:Nn</span> <span>\g_tmpa_int</span> <span>{</span>#1<span>}</span>
	<span>}</span> <span>{</span>
		<span>\int_set</span><span>:Nn</span> <span>\l_tmpa_int</span> <span>{</span><span>\int_mod</span><span>:nn</span> <span>{</span>#1<span>}{</span>#2<span>}}</span>
		<span>\int_set</span><span>:Nn</span> <span>\l_tmpb_int</span> <span>{</span><span>\int_div_truncate</span><span>:nn</span> <span>{</span>#1<span>}{</span>#2<span>}}</span>
		<span>\exp_args</span><span>:Nnx</span> <span>\my_gcd_recursive</span><span>:nn</span> <span>{</span>#2<span>}</span> <span>{</span><span>\int_use</span><span>:N</span> <span>\l_tmpa_int</span><span>}</span>
		<span>% output debug message</span>
		<span>\par</span> <span>$</span><span>\int</span><span>_use:N </span><span>\l</span><span>_tmpb_int </span><span>\times</span><span> #</span><span>2</span><span> </span><span>+</span><span> </span><span>\int</span><span>_use:N </span><span>\l</span><span>_tmpa_int </span><span>=</span><span> #</span><span>1</span><span>$</span>
	<span>}</span>
	<span>\group_end</span><span>:</span>
<span>}</span>
<span>\my_gcd_recursive</span><span>:nn</span> <span>{</span>12546<span>}{</span>156<span>}</span>
<span>\par</span> <span>$</span><span>\operatorname</span><span>{gcd}</span><span>(</span><span>12546</span><span>, </span><span>156</span><span>)</span><span> </span><span>=</span><span> </span><span>\int</span><span>_use:N </span><span>\g</span><span>_tmpa_int</span><span>$</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>Output:</p>

<div><div><pre><code>3 × 6 + 0 = 18
1 × 18 + 6 = 24
2 × 24 + 18 = 66
2 × 66 + 24 = 156
80 × 156 + 66 = 12546
gcd(12546; 156) = 6
</code></pre></div></div>

<h4 id="student-management-system-1">Student management system</h4>

<p>Now, we implement the aforementioned student management system with integer related functions.</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>% used to store the name of each student</span>
<span>\tl_new</span><span>:N</span> <span>\l_student_group_tl</span>
<span>\newcommand</span><span>{</span><span>\student</span><span>}</span>[1]<span>{</span>
  #1<span>% outputs student name</span>
  <span>% put student name in group and then</span>
  <span>% insert into \l_student_group_tl</span>
  <span>\tl_put_right</span><span>:Nn</span> <span>\l_student_group_tl</span> <span>{{</span>#1<span>}}</span>
<span>}</span>
<span>\newcommand</span><span>{</span><span>\allstudent</span><span>}{</span>
  <span>%\tl_count:N returns the length of a token list</span>
  <span>%\int_step_inline:nn traverses all integers in </span>
  <span>% the range (1, #1) and pass the loop variable as</span>
  <span>% #1</span>
  <span>\int_step_inline</span><span>:nn</span> <span>{</span><span>\tl_count</span><span>:N</span> <span>\l_student_group_tl</span><span>}{</span>
      <span>% get the ##1-th element from \l_student_group_tl</span>
      <span>\tl_item</span><span>:Nn</span> <span>\l_student_group_tl</span> <span>{</span>##1<span>}</span>
      <span>% determine if it is the last element</span>
      <span>% otherwise, append comma</span>
      <span>\int_compare</span><span>:nNnTF</span> <span>{</span>##1<span>}</span> = <span>{</span><span>\tl_count</span><span>:N</span> <span>\l_student_group_tl</span><span>}</span> <span>{}</span> <span>{</span>,~<span>}</span>
  <span>}</span>
<span>}</span>
<span>\newcommand</span><span>{</span><span>\thestudent</span><span>}</span>[1]<span>{</span>
  <span>% outputs the #1-th item in \l_student_group_tl</span>
  <span>\tl_item</span><span>:Nn</span> <span>\l_student_group_tl</span> <span>{</span>#1<span>}</span>
<span>}</span>
<span>\ExplSyntaxOff</span>

<span>% John and Lisa and David and Emily</span>
<span>\student</span><span>{</span>John<span>}</span> and <span>\student</span><span>{</span>Lisa<span>}</span> and <span>\student</span><span>{</span>David<span>}</span> and <span>\student</span><span>{</span>Emily<span>}</span>

<span>% John, Lisa, David, Emily</span>
<span>\par\allstudent</span>

<span>% Emily and David and Lisa and John</span>
<span>\par\thestudent</span><span>{</span>4<span>}</span> and <span>\thestudent</span><span>{</span>3<span>}</span> and <span>\thestudent</span><span>{</span>2<span>}</span> and <span>\thestudent</span><span>{</span>1<span>}</span>
</pre></div>

<h4 id="three-ways-to-implement-nested-loop">Three ways to implement nested loop</h4>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\par</span>
<span>\int_step_variable</span><span>:nNn</span> <span>{</span>4<span>}</span> <span>\l_tmpa_tl</span> <span>{</span>
    <span>\int_step_variable</span><span>:nNn</span> <span>{</span>4<span>}</span> <span>\l_tmpb_tl</span><span>{</span>
        (<span>\l_tmpa_tl</span>,<span>\l_tmpb_tl</span>)
    <span>}</span>
<span>}</span>
<span>\par</span>
<span>\int_step_inline</span><span>:nn</span> <span>{</span>4<span>}</span>  <span>{</span>
    <span>\int_step_inline</span><span>:nn</span> <span>{</span>4<span>}</span>  <span>{</span>
        (#1,##1)
    <span>}</span>
<span>}</span>
<span>\par</span>
<span>\int_set</span><span>:Nn</span> <span>\l_tmpa_int</span> <span>{</span>1<span>}</span>
<span>\int_do_while</span><span>:nNnn</span> <span>{</span><span>\l_tmpa_int</span><span>}</span> &lt; <span>{</span>5<span>}</span> <span>{</span>
    <span>\int_set</span><span>:Nn</span> <span>\l_tmpb_int</span> <span>{</span>1<span>}</span>
    <span>\int_do_while</span><span>:nNnn</span> <span>{</span><span>\l_tmpb_int</span><span>}</span> &lt; <span>{</span>5<span>}</span> <span>{</span>
        (<span>\int_use</span><span>:N</span> <span>\l_tmpa_int</span>,<span>\int_use</span><span>:N</span> <span>\l_tmpb_int</span>)
        <span>\int_incr</span><span>:N</span> <span>\l_tmpb_int</span>
    <span>}</span>
    <span>\int_incr</span><span>:N</span> <span>\l_tmpa_int</span>
<span>}</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>Output:</p>

<div><div><pre><code>(1,1)(1,2)(1,3)(1,4)(2,1)(2,2)(2,3)(2,4)(3,1)(3,2)(3,3)(3,4)(4,1)(4,2)(4,3)(4,4)
(1,1)(1,2)(1,3)(1,4)(2,1)(2,2)(2,3)(2,4)(3,1)(3,2)(3,3)(3,4)(4,1)(4,2)(4,3)(4,4)
(1,1)(1,2)(1,3)(1,4)(2,1)(2,2)(2,3)(2,4)(3,1)(3,2)(3,3)(3,4)(4,1)(4,2)(4,3)(4,4)
</code></pre></div></div>

<h4 id="drawing-a-square-number-grid-in-tikz">Drawing a square number grid in TikZ</h4>

<div><pre><span></span><span>\tikzset</span><span>{</span>
  mynode/.style=<span>{</span>
    minimum height=1cm,
    minimum width=1cm,
    draw,
    anchor=north west
  <span>}</span>
<span>}</span>

<span>\ExplSyntaxOn</span>
<span>\begin</span><span>{</span>tikzpicture<span>}</span>
<span>\int_step_inline</span><span>:nn</span> <span>{</span>6<span>}</span> <span>{</span>
  <span>\int_step_inline</span><span>:nn</span> <span>{</span>8<span>}</span> <span>{</span>
    <span>\node</span><span>[mynode]</span> at (##1, -#1) <span>{</span><span>\tiny</span> <span>\int_eval</span><span>:n</span> <span>{</span>(#1 - 1) * 8 + ##1<span>}}</span>;
  <span>}</span>
<span>}</span>
<span>\end</span><span>{</span>tikzpicture<span>}</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>Output:</p>

<p><img src="http://shapr.github.io/media/2020/latex3/number-grid-1.png"/>
</p>

<h3 id="floating-point-number-xxiii-and-dimension-xx">Floating point number (XXIII) and dimension (XX)</h3>

<p>The usage of floating point numbers is similar to that of integers: they all have their corresponding <code>new</code>, <code>set</code>, <code>eval</code> and <code>compare</code> functions. It is worth noticing that <code><span>\fp_eval</span><span>:n</span></code> supports a series of scientific functions, which is demonstrated below.</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\fp_set</span><span>:Nn</span> <span>\l_tmpa_fp</span> <span>{</span>2.0<span>}</span>
<span>\par\fp_eval</span><span>:n</span> <span>{</span>sqrt(<span>\l_tmpa_fp</span>)<span>}</span><span>% 1.414213562373095</span>
<span>\par\fp_eval</span><span>:n</span> <span>{</span>sin(<span>\l_tmpa_fp</span>)<span>}</span><span>% 0.9092974268256817</span>
<span>\par</span> <span>\fp_eval</span><span>:n</span> <span>{</span>sin(<span>\c_pi_fp</span>)<span>}</span><span>% 0.0000000000000002384626433832795</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>It is worth noticing that <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>’s floating point library is written in pure <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/>, which means it differs from IEEE 754 floating point numbers fundamentally. Nonetheless, after a series of experiments, it is shown that <code>l3fp</code>’s arithmetic accuracy is almost identical to IEEE 754 floating point. The discrapency is neglectable in everyday scenarios <sup id="fnref:7" role="doc-noteref"><a href="#fn:7" rel="footnote">7</a></sup>.</p>

<p>Floating points are similar to dimensions, except that dimensions are floating point numbers with a unit (usually in <code>pt</code>). In <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>, dimension variables are represented using IEEE 754 (single precision) floating point internally. Therefore, their processing speed is much faster than <code>l3fp</code>. Dimension variables and floating point variables can be converted from one another using <code><span>\dim_to_fp</span><span>:n</span></code> and <code><span>\fp_to_dim</span><span>:n</span></code>. It is possible to use dimension varialble directly in <code><span>\fp_eval</span><span>:n</span></code>. In this case, dimensions will be converted into <code>pt</code> and lose their unit.</p>

<h4 id="drawing-a-rectangular-number-grid-in-tikz">Drawing a rectangular number grid in TikZ</h4>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>% set width and height of each cell</span>
<span>\dim_new</span><span>:N</span> <span>\l_w_dim</span>
<span>\dim_set</span><span>:Nn</span> <span>\l_w_dim</span> <span>{</span>1.2cm<span>}</span>
<span>\dim_new</span><span>:N</span> <span>\l_h_dim</span>
<span>\dim_set</span><span>:Nn</span> <span>\l_h_dim</span> <span>{</span>0.5cm<span>}</span>

<span>\tikzset</span><span>{</span>
  mynode/.style=<span>{</span>
    minimum~height=<span>\l_h_dim</span>,
    minimum~width=<span>\l_w_dim</span>,
    draw,
    anchor=north~west
  <span>}</span>
<span>}</span>

<span>\begin</span><span>{</span>tikzpicture<span>}</span>
<span>\int_step_inline</span><span>:nn</span> <span>{</span>6<span>}</span> <span>{</span>
  <span>\int_step_inline</span><span>:nn</span> <span>{</span>8<span>}</span> <span>{</span>
    <span>\node</span><span>[mynode]</span> at 
    (<span>\fp_eval</span><span>:n</span> <span>{</span>##1 * <span>\l_w_dim</span><span>}</span> pt, -<span>\fp_eval</span><span>:n</span> <span>{</span>#1 * <span>\l_h_dim</span><span>}</span> pt) 
    <span>{</span><span>\tiny</span> <span>\int_eval</span><span>:n</span> <span>{</span>(#1 - 1) * 8 + ##1<span>}}</span>;
  <span>}</span>
<span>}</span>
<span>\end</span><span>{</span>tikzpicture<span>}</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>Output:</p>

<p><img src="http://shapr.github.io/media/2020/latex3/number-grid-2.png"/>
</p>

<h4 id="drawing-points-on-a-circle-and-connect-them-pairwise">Drawing points on a circle and connect them pairwise</h4>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\begin</span><span>{</span>tikzpicture<span>}</span>
	<span>% draw points on the circle</span>
	<span>\int_step_inline</span><span>:nn</span> <span>{</span>10<span>}</span> <span>{</span>
		<span>\node</span>[fill=black,
        		circle,
        		inner~sep=0pt,
			outer~sep=0pt,
			minimum~width=1mm] (n#1) at (
			<span>\fp_eval</span><span>:n</span> <span>{</span>cos(#1 * 36 * <span>\c_one_degree_fp</span>)<span>}</span> cm,
			<span>\fp_eval</span><span>:n</span> <span>{</span>sin(#1 * 36 * <span>\c_one_degree_fp</span>)<span>}</span> cm
		) <span>{}</span>;
	<span>}</span>
	<span>% connect points pairwise</span>
	<span>\int_step_inline</span><span>:nn</span> <span>{</span>10<span>}</span> <span>{</span>
		<span>\int_step_inline</span><span>:nn</span> <span>{</span>10<span>}</span> <span>{</span>
			<span>\draw</span> (n#1)--(n##1);
		<span>}</span>
	<span>}</span>
		
	
<span>\end</span><span>{</span>tikzpicture<span>}</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>Output:</p>

<p><img src="http://shapr.github.io/media/2020/latex3/circle-points-connect.png"/>
</p>

<h2 id="latex3-data-structure">LaTeX3: Data Structure</h2>

<h3 id="queue-x-xv">Queue (X, XV)</h3>

<p>Queues are essential in the implementation of many algorithms. Hence, <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> provides its queue implementation: <code>l3seq</code>.</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>% create new queue</span>
<span>\seq_new</span><span>:N</span> <span>\l_my_seq</span>
<span>% empty queue</span>
<span>\seq_clear</span><span>:N</span> <span>\l_my_seq</span>
<span>% push right into queue</span>
<span>\seq_put_right</span><span>:Nn</span> <span>\l_my_seq</span> <span>{</span>hello<span>}</span>
<span>\seq_put_right</span><span>:Nn</span> <span>\l_my_seq</span> <span>{</span>world<span>}</span>
<span>% join elements with &#39;-&#39; and output the result</span>
<span>\seq_use</span><span>:Nn</span> <span>\l_my_seq</span> <span>{</span>-<span>}</span> <span>% hello-world</span>
<span>% get the length of queue</span>
<span>\seq_count</span><span>:N</span> <span>\l_my_seq</span> <span>% 2</span>
<span>% pop the rightmost item and store it in \l_tmpa_tl</span>
<span>\seq_pop_right</span><span>:NN</span> <span>\l_my_seq</span> <span>\l_tmpa_tl</span>
<span>% get the 1st item in the queue</span>
<span>\seq_item</span><span>:Nn</span> <span>\l_my_seq</span> <span>{</span>1<span>}</span>
<span>% traverse items in queue</span>
<span>% similar functions include \seq_map_inline:</span>
<span>% and \seq_map_function:</span>
<span>\seq_map_inline</span><span>:Nn</span> <span>\l_my_seq</span> <span>{</span>
    #1
<span>}</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>We call the <code>l3seq</code> container “queue” or “sequence” instead of “array” or “list”. One of the reasons for this is that index access is <em>read only</em>: one can only access item with <code><span>\seq_item</span><span>:Nn</span></code>, but it is still impossible to modify an item based on index. However, if one wants to create a sequence of integer or floating point numbers, it is possible to take advantage of <code>l3intarray</code> or <code>l3fparray</code>, which allows index-based assignment. As it will be discussed later, they possess some other desirable qualities.</p>

<h4 id="student-management-system-2">Student management system</h4>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>% a queue that stores student names</span>
<span>\seq_new</span><span>:N</span> <span>\l_student_seq</span>
<span>\newcommand</span><span>{</span><span>\student</span><span>}</span>[1]<span>{</span>
  #1<span>% outputs student name</span>
  <span>% push student name to the right</span>
  <span>\seq_put_right</span><span>:Nn</span> <span>\l_student_seq</span> <span>{</span>#1<span>}</span>
<span>}</span>
<span>\newcommand</span><span>{</span><span>\allstudent</span><span>}{</span>
  <span>% join elements in the queue with comma</span>
  <span>% and then output the result</span>
  <span>\seq_use</span><span>:Nn</span> <span>\l_student_seq</span> <span>{</span>,~<span>}</span>
<span>}</span>
<span>\newcommand</span><span>{</span><span>\thestudent</span><span>}</span>[1]<span>{</span>
  <span>% outputs the #1-th element in the queue</span>
  <span>\seq_item</span><span>:Nn</span> <span>\l_student_seq</span> <span>{</span>#1<span>}</span>
<span>}</span>
<span>\ExplSyntaxOff</span>

<span>% John and Lisa and David and Emily</span>
<span>\student</span><span>{</span>John<span>}</span> and <span>\student</span><span>{</span>Lisa<span>}</span> and <span>\student</span><span>{</span>David<span>}</span> and <span>\student</span><span>{</span>Emily<span>}</span>

<span>% John, Lisa, David, Emily</span>
<span>\par\allstudent</span>

<span>% Emily and David and Lisa and John</span>
<span>\par\thestudent</span><span>{</span>4<span>}</span> and <span>\thestudent</span><span>{</span>3<span>}</span> and <span>\thestudent</span><span>{</span>2<span>}</span> and <span>\thestudent</span><span>{</span>1<span>}</span>
</pre></div>

<h4 id="bracket-matching">Bracket matching</h4>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\cs_set</span><span>:Npn</span> <span>\my_paren_match</span><span>:n</span> #1 <span>{</span>
  <span>% convert #1 into string</span>
  <span>\str_set</span><span>:Nn</span> <span>\l_tmpa_str</span> <span>{</span>#1<span>}</span>
  <span>% clear working queue</span>
  <span>\seq_clear</span><span>:N</span> <span>\l_tmpa_seq</span>
  <span>% boolean variable to be set true if parentheses does not match</span>
  <span>\bool_set_false</span><span>:N</span> <span>\l_tmpa_bool</span>
  <span>\str_map_inline</span><span>:Nn</span> <span>\l_tmpa_str</span> <span>{</span>
      <span>% \str_case:nn is like the &#34;switch&#34; statement in C</span>
      <span>\str_case</span><span>:nn</span> <span>{</span>##1<span>}</span> <span>{</span>
          <span>% ------</span>
          <span>% for left brackets, simply push them into the queue</span>
          <span>{</span>(<span>}</span> <span>{</span>
              <span>\seq_put_right</span><span>:Nn</span> <span>\l_tmpa_seq</span> <span>{</span>(<span>}</span>
          <span>}</span>
          <span>{</span>[<span>}</span> <span>{</span>
              <span>\seq_put_right</span><span>:Nn</span> <span>\l_tmpa_seq</span> <span>{</span>[<span>}</span>
          <span>}</span>
          <span>% ------</span>
          <span>% ------</span>
          <span>% more work needs to be done for right brackets</span>
          <span>{</span>)<span>}</span> <span>{</span>
              <span>% pop the rightmost element and store it in \l_tmpb_str</span>
              <span>\seq_pop_right</span><span>:NN</span> <span>\l_tmpa_seq</span> <span>\l_tmpb_str</span>
              <span>% compare it with left round bracket</span>
              <span>% notice that the first argument is passed by value</span>
              <span>\str_if_eq</span><span>:VnF</span> <span>\l_tmpb_str</span> <span>{</span>(<span>}</span> <span>{</span>
                  <span>% this is executed only when equality does not hold</span>
                  <span>% set &#34;not match&#34; to be true</span>
                  <span>\bool_set_true</span><span>:N</span> <span>\l_tmpa_bool</span>
                  <span>% exits current loop</span>
                  <span>\str_map_break</span><span>:</span>
              <span>}</span>
          <span>}</span>
          <span>{</span>]<span>}</span> <span>{</span>
              <span>\seq_pop_right</span><span>:NN</span> <span>\l_tmpa_seq</span> <span>\l_tmpb_str</span>
              <span>\str_if_eq</span><span>:VnF</span> <span>\l_tmpb_str</span> <span>{</span>[<span>}</span> <span>{</span>
                  <span>\bool_set_true</span><span>:N</span> <span>\l_tmpa_bool</span>
                  <span>\str_map_break</span><span>:</span>
              <span>}</span>
          <span>}</span>
          <span>% ------</span>
      <span>}</span>
  <span>}</span>
  <span>% see if &#34;not match&#34; is true</span>
  <span>\bool_if</span><span>:NTF</span> <span>\l_tmpa_bool</span> <span>{</span>Not~Match<span>}</span> <span>{</span>
      <span>% see if the working queue is empty</span>
      <span>\seq_if_empty</span><span>:NTF</span> <span>\l_tmpa_seq</span> <span>{</span>Match<span>}</span> <span>{</span>Not~Match<span>}</span>
  <span>}</span>
<span>}</span>
<span>\par\my_paren_match</span><span>:n</span> <span>{</span>()()<span>}</span> <span>% Match</span>
<span>\par\my_paren_match</span><span>:n</span> <span>{</span>([content()])()[]<span>}</span> <span>% Match</span>
<span>\par\my_paren_match</span><span>:n</span> <span>{</span>([content())()[]<span>}</span> <span>% Not Match</span>
<span>\par\my_paren_match</span><span>:n</span> <span>{</span>([content()])()[<span>}</span> <span>% Not Match</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>A very similar data structure is <code>l3clist</code>, which stands for “comma-separated list”. Most functions provided by <code>l3clist</code> is same as <code>l3seq</code>, except that it provides a convenient constructor that allows one to initialize a sequence with comma-separated content. An example is given below.</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\clist_new</span><span>:N</span> <span>\l_my_clist</span>
<span>\clist_set</span><span>:Nn</span> <span>\l_my_clist</span> <span>{</span>This,is,my,list,1,2,3<span>}</span>
<span>\clist_use</span><span>:Nn</span> <span>\l_my_clist</span> <span>{</span>-<span>}</span> <span>%This-is-my-list-1-2-3</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<h3 id="dictionary-xvii">Dictionary (XVII)</h3>

<p><img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> also provides key-value access dictionary container: <code>l3prop</code>. It is similar to <code>dict</code> in Python or <code>map</code> in C++.</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>% create new dictionary</span>
<span>\prop_new</span><span>:N</span> <span>\l_my_prop</span>
<span>% clear dictionary</span>
<span>\prop_clear</span><span>:N</span> <span>\l_my_prop</span>
<span>% add/update key-value pair</span>
<span>\prop_put</span><span>:Nnn</span> <span>\l_my_prop</span> <span>{</span>key<span>}</span> <span>{</span>val<span>}</span>
<span>% get value given key</span>
<span>\prop_item</span><span>:Nn</span> <span>\l_my_prop</span> <span>{</span>key<span>}</span> <span>% val</span>
<span>% get number of key-value pairs</span>
<span>\prop_count</span><span>:N</span> <span>\l_my_prop</span> <span>%1</span>
<span>% traverse key-value pairs</span>
<span>% similar functions include \prop_map_function:</span>
<span>% and \prop_map_tokens:</span>
<span>\prop_map_inline</span><span>:Nn</span> <span>\l_my_prop</span> <span>{</span>
    (#1, #2)
<span>}</span>
<span>% delete key-value pair</span>
<span>\prop_remove</span><span>:Nn</span> <span>\l_my_prop</span> <span>{</span>key<span>}</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<h4 id="arabic-numerals-to-english-0-99">Arabic numerals to English (0-99)</h4>

<div><pre><span></span><span>\ExplSyntaxOn</span>

<span>\prop_new</span><span>:N</span> <span>\l_english_prop</span>
<span>\prop_set_from_keyval</span><span>:Nn</span> <span>\l_english_prop</span> <span>{</span>
  0=zero,
  1=one,
  2=two,
  3=three,
  4=four,
  5=five,
  6=six,
  7=seven,
  8=eight,
  9=nine,
  10=ten,
  11=eleven,
  12=twelve,
  13=thirteen,
  15=fifteen,
  18=eighteen,
  20=twenty,
  30=thirty,
  40=forty,
  50=fifty,
  80=eighty
<span>}</span>

<span>% extra scratch variable</span>
<span>\tl_new</span><span>:N</span> <span>\l_tmpc_tl</span>

<span>\cs_set</span><span>:Npn</span> <span>\my_arabic_to_eng</span><span>:n</span> #1 <span>{</span>
  <span>\str_set</span><span>:Nn</span> <span>\l_tmpa_str</span> <span>{</span>#1<span>}</span>
  <span>\prop_if_in</span><span>:NVTF</span> <span>\l_english_prop</span> <span>\l_tmpa_str</span> <span>{</span>
    <span>% if the number is in the dictionary, output it directly</span>
    <span>% this works for most numbers under 20</span>
    <span>\exp_args</span><span>:NNV</span> <span>\prop_item</span><span>:Nn</span> <span>\l_english_prop</span> <span>\l_tmpa_str</span>
  <span>}</span> <span>{</span>
    <span>\int_compare</span><span>:nNnTF</span> <span>{</span>#1<span>}</span> &lt; <span>{</span>20<span>}</span> <span>{</span>
      <span>% deal with teens</span>
      <span>\exp_args</span><span>:NNx</span> <span>\prop_item</span><span>:Nn</span> <span>\l_english_prop</span> <span>{</span>
        <span>\int_eval</span><span>:n</span> <span>{</span>#1 - 10<span>}</span>
      <span>}</span>
      teen
    <span>}</span> <span>{</span>
      <span>% deal with numbers between 20-99</span>
      <span>% acquire number in tens</span>
      <span>\int_set</span><span>:Nn</span> <span>\l_tmpa_int</span> <span>{</span>
        <span>\int_div_truncate</span><span>:nn</span> <span>{</span>#1<span>}</span> <span>{</span>10<span>}</span> * 10
      <span>}</span>
      <span>% acquire number in ones</span>
      <span>\int_set</span><span>:Nn</span> <span>\l_tmpb_int</span> <span>{</span>
        #1 - <span>\l_tmpa_int</span>
      <span>}</span>
      <span>% #1 = \l_tmpa_int + \l_tmpb_int</span>
      <span>\tl_set</span><span>:Nx</span> <span>\l_tmpa_tl</span> <span>{</span><span>\int_use</span><span>:N</span> <span>\l_tmpa_int</span><span>}</span>
      
      <span>% outputs the &#34;-ty&#34; word</span>
      <span>\prop_if_in</span><span>:NVTF</span> <span>\l_english_prop</span> <span>\l_tmpa_tl</span> <span>{</span>
        <span>% no need to construct: get from dict directly</span>
        <span>\exp_args</span><span>:NNV</span> <span>\prop_item</span><span>:Nn</span> <span>\l_english_prop</span> <span>\l_tmpa_tl</span>
      <span>}</span> <span>{</span>
        <span>% need to construct the &#34;-ty&#34; word</span>
        <span>\tl_set</span><span>:Nx</span> <span>\l_tmpc_tl</span> <span>{</span><span>\tl_head</span><span>:N</span> <span>\l_tmpa_tl</span><span>}</span>
        <span>\exp_args</span><span>:NNV</span> <span>\prop_item</span><span>:Nn</span> <span>\l_english_prop</span> <span>\l_tmpc_tl</span>
        ty
      <span>}</span>
      <span>% no need to output second digit if it is zero</span>
      <span>\int_compare</span><span>:nNnF</span> <span>{</span><span>\l_tmpb_int</span><span>}</span> = <span>{</span>0<span>}</span> <span>{</span>
        <span>% otherwise, show second digit</span>
        <span>\space</span>
        <span>\tl_set</span><span>:Nx</span> <span>\l_tmpb_tl</span> <span>{</span><span>\int_use</span><span>:N</span> <span>\l_tmpb_int</span><span>}</span>
        <span>\exp_args</span><span>:NNV</span> <span>\prop_item</span><span>:Nn</span> <span>\l_english_prop</span> <span>\l_tmpb_tl</span>
      <span>}</span>
    <span>}</span>
  <span>}</span>
<span>}</span>

<span>\par\my_arabic_to_eng</span><span>:n</span> <span>{</span>0<span>}</span> <span>% zero</span>
<span>\par\my_arabic_to_eng</span><span>:n</span> <span>{</span>18<span>}</span> <span>% eighteen</span>
<span>\par\my_arabic_to_eng</span><span>:n</span> <span>{</span>53<span>}</span> <span>% fifty three</span>
<span>\par\my_arabic_to_eng</span><span>:n</span> <span>{</span>85<span>}</span> <span>% eighty five</span>

<span>\ExplSyntaxOff</span>
</pre></div>

<div>
  
  <p>A number of <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> containers provide item-based access methods. For example, <code><span>\tl_item</span><span>:Nn</span></code>, <code><span>\seq_item</span><span>:Nn</span></code>, <code><span>\prop_item</span><span>:Nn</span></code>, etc. Unlike in most programming languages, where the complexity of these methods are constant time (or in some cases, logarithmic time), these methods takes <strong>linear time</strong> in <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>. That is to say, the larger the container is, the longer the average access time will be.</p>

  <p>Fundamentally, <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> is a text-based macro language. There is no easy way for <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> scripts to access a computer’s memory space directly. As a result, all containers are essentially constructed with text and requires further interpretation when use. This implies that most <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> containers have extremely high time and memory consumption.</p>

  <p>If one wants to store an array of integer or floating point number in <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>, there are two types of high performance containers that allow constant time access, namely <code>l3intarray</code> and <code>l3fparray</code>. In <a href="https://www.alanshawn.com/leetcode/2020/06/05/leetcode-344-latex.html">this article</a>, I discussed how to use <code>l3intarray</code> to speed up string reversal.</p>
</div>

<h2 id="latex3-regular-expression-xxviii">LaTeX3: Regular Expression (XXVIII)</h2>

<p><a href="https://en.wikipedia.org/wiki/Regular_expression">Regular expression</a> is a powerful tool for pattern matching in text documents. In <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>, the <code>l3regex</code> module provides limited support for standard regular expression syntax. These are some of the frequently used functions in <code>l3regex</code>:</p>

<ul>
  <li><code><span>\regex_new</span><span>:N</span></code>: creates new regular expression variable</li>
  <li><code><span>\regex_set</span><span>:Nn</span></code>: set the content of a regular expression variable</li>
  <li>All of the following functions take either a raw regular expression or regular expression variable as the first argument. Raw regular expressions surrounded by braces requires compilation before use. The <code><span>\regex_set</span><span>:Nn</span></code> function will apply both compilation and storage. Therefore, for a regular exression used multiple times, saving it in a variable may save some time.</li>
  <li><code><span>\regex_match</span><span>:nnTF</span></code>: match a string based on the regular expression and execute <code>T</code>/<code>F</code> code based on the outcome</li>
  <li><code><span>\regex_count</span><span>:nnN</span></code>: count the number of matches and store the result in an integer variable</li>
  <li><code><span>\regex_extract_once</span><span>:nnN</span></code>: extract the first match in the string and store it in a token list variable</li>
  <li><code><span>\regex_extract_all</span><span>:nnN</span></code>: extract all matches in the string and store them in a queue</li>
  <li><code><span>\regex_split</span><span>:nnN</span></code>: split the string based on the regular expression and saved the result in a queue</li>
  <li><code><span>\regex_replace_once</span><span>:nnN</span></code>: replace the first match</li>
  <li><code><span>\regex_replace_all</span><span>:nnN</span></code>:replace all matches</li>
</ul>

<p>To allow interaction with <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/>, the syntax of <code>l3regex</code> is slightly different from the standard. For more details, please see <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> documentation.</p>

<h3 id="check-if-a-character-is-chinese">Check if a character is Chinese</h3>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>% create and compile regex</span>
<span>\regex_new</span><span>:N</span> <span>\l_chn_regex</span>
<span>% the regular expression for Chinese characters</span>
<span>\regex_set</span><span>:Nn</span> <span>\l_chn_regex</span> <span>{</span>[<span>\x</span><span>{</span>3400<span>}</span>-<span>\x</span><span>{</span>9FBF<span>}</span>]<span>}</span>

<span>\cs_set</span><span>:Npn</span> <span>\my_is_chn</span><span>:n</span> #1 <span>{</span>
  <span>% store #1 as string</span>
  <span>\str_set</span><span>:Nn</span> <span>\l_tmpa_str</span> <span>{</span>#1<span>}</span>
  <span>% clear result queue</span>
  <span>\seq_clear</span><span>:N</span> <span>\l_tmpa_seq</span>
  <span>% traverse the string</span>
  <span>\str_map_inline</span><span>:Nn</span> <span>\l_tmpa_str</span> <span>{</span>
      <span>% check if the string matches \l_chn_regex</span>
      <span>\regex_match</span><span>:NnTF</span> <span>\l_chn_regex</span> <span>{</span>##1<span>}</span> <span>{</span>
          <span>% if so, output Y</span>
          <span>\seq_put_right</span><span>:Nn</span> <span>\l_tmpa_seq</span> <span>{</span>Y<span>}</span>
      <span>}</span> <span>{</span>
          <span>% otherwise, output N</span>
          <span>\seq_put_right</span><span>:Nn</span> <span>\l_tmpa_seq</span> <span>{</span>N<span>}</span>
      <span>}</span>
  <span>}</span>
  <span>% show all contents in the queue, separated by white space</span>
  <span>\seq_use</span><span>:Nn</span> <span>\l_tmpa_seq</span> <span>{</span><span>\space</span><span>}</span>
<span>}</span>

<span>% Y N Y N</span>
<span>\par\my_is_chn</span><span>:n</span> <span>{</span>中a文b<span>}</span>
<span>% N N N N N N N Y Y Y</span>
<span>\par\my_is_chn</span><span>:n</span> <span>{</span>바탕체ヒラギノ細明體<span>}</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<h3 id="substitute-a-command-with-another">Substitute a command with another</h3>

<p>In the following example, all occurrence of <code><span>\cmda</span></code> is replaced by <code><span>\cmdb</span></code>. This example makes use of <code>l3regex</code>’s special syntax.</p>

<div><pre><span></span><span>\newcommand</span><span>{</span><span>\cmda</span><span>}</span>[1]<span>{</span>(#1)<span>}</span>
<span>\newcommand</span><span>{</span><span>\cmdb</span><span>}</span>[1]<span>{</span>[#1]<span>}</span>
<span>\ExplSyntaxOn</span>
<span>\tl_set</span><span>:Nn</span> <span>\l_tmpa_tl</span> <span>{</span><span>\cmda</span><span>{</span>X<span>}</span>~<span>\cmdb</span><span>{</span>Y<span>}}</span>
<span>\par\tl_use</span><span>:N</span> <span>\l_tmpa_tl</span> <span>% (X) [Y]</span>
<span>% \c will capture command names</span>
<span>\regex_replace_all</span><span>:nnN</span> <span>{</span><span>\c</span><span>{</span>cmda<span>}}</span> <span>{</span><span>\c</span><span>{</span>cmdb<span>}}</span> <span>\l_tmpa_tl</span>
<span>\par</span> <span>\tl_use</span><span>:N</span> <span>\l_tmpa_tl</span> <span>% [X] [Y]</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<h3 id="generate-tikz-picture-based-on-a-template">Generate TikZ picture based on a template</h3>

<div><pre><span></span><span>\tikzset</span><span>{</span>
  mynode/.style=<span>{</span>
    outer sep=0pt
  <span>}</span>
<span>}</span>

<span>\ExplSyntaxOn</span>
<span>% this is the template of each node</span>
<span>% which we will fill with regular expressions</span>
<span>\tl_new</span><span>:N</span> <span>\l_template_tl</span>
<span>\tl_set</span><span>:Nn</span> <span>\l_template_tl</span> <span>{</span>
  <span>\node</span><span>[mynode,@1]</span> (@2) at (@3) <span>{</span>@4<span>}</span>; 
<span>}</span>

<span>% counts the total number of nodes</span>
<span>\int_new</span><span>:N</span> <span>\l_node_counter_int</span>
<span>\int_gset</span><span>:Nn</span> <span>\l_node_counter_int</span> <span>{</span>0<span>}</span>

<span>% #1: style</span>
<span>% #2: angle</span>
<span>% #3: content</span>
<span>\cs_set</span><span>:Npn</span> <span>\my_draw_node</span><span>:nnn</span> #1#2#3 <span>{</span>
  <span>% set our working variable</span>
  <span>\tl_set_eq</span><span>:NN</span> <span>\l_tmpa_tl</span> <span>\l_template_tl</span>
  <span>% fill style</span>
  <span>\regex_replace_once</span><span>:nnN</span> <span>{</span>@1<span>}</span> <span>{</span>#1<span>}</span> <span>\l_tmpa_tl</span>
  
  <span>% increment counter</span>
  <span>\int_gincr</span><span>:N</span> <span>\l_node_counter_int</span>
  <span>% store the name of new node in \l_tmpb_tl</span>
  <span>% node name is generated with \int_to_alph:n</span>
  <span>\tl_set</span><span>:Nx</span> <span>\l_tmpb_tl</span> <span>{</span><span>\int_to_alph</span><span>:n</span> <span>{</span><span>\l_node_counter_int</span><span>}}</span>
  <span>% fill node name</span>
  <span>% use \u to replace with the content of a token list</span>
  <span>\regex_replace_once</span><span>:nnN</span> <span>{</span>@2<span>}</span> <span>{</span><span>\u</span><span>{</span>l<span>_</span>tmpb<span>_</span>tl<span>}}</span> <span>\l_tmpa_tl</span>
  
  <span>% calculate the position of the node based on angle</span>
  <span>\tl_set</span><span>:Nx</span> <span>\l_tmpb_tl</span> <span>{</span>
    <span>\fp_eval</span><span>:n</span> <span>{</span>3 * cos(#2 * <span>\c_one_degree_fp</span>)<span>}</span>, 
    <span>\fp_eval</span><span>:n</span> <span>{</span>3 * sin(#2 * <span>\c_one_degree_fp</span>)<span>}</span>
  <span>}</span>
  <span>% fill position</span>
  <span>\regex_replace_once</span><span>:nnN</span> <span>{</span>@3<span>}</span> <span>{</span><span>\u</span><span>{</span>l<span>_</span>tmpb<span>_</span>tl<span>}}</span> <span>\l_tmpa_tl</span>
  
  <span>% fill content</span>
  <span>\regex_replace_once</span><span>:nnN</span> <span>{</span>@4<span>}</span> <span>{</span>#3<span>}</span> <span>\l_tmpa_tl</span>
  
  <span>% output result</span>
  <span>\tl_use</span><span>:N</span> <span>\l_tmpa_tl</span>
<span>}</span>

<span>\begin</span><span>{</span>tikzpicture<span>}</span>
<span>\my_draw_node</span><span>:nnn</span> <span>{</span>circle,draw<span>}{</span>200<span>}{</span>L<span>}</span>
<span>\my_draw_node</span><span>:nnn</span> <span>{</span>draw<span>}{</span>160<span>}{</span>A<span>}</span>
<span>\my_draw_node</span><span>:nnn</span> <span>{</span>circle,draw<span>}{</span>120<span>}{</span>T<span>}</span>
<span>\my_draw_node</span><span>:nnn</span> <span>{</span>draw<span>}{</span>80<span>}{</span>E<span>}</span>
<span>\my_draw_node</span><span>:nnn</span> <span>{</span>circle,draw<span>}{</span>40<span>}{</span>X<span>}</span>
<span>\my_draw_node</span><span>:nnn</span> <span>{</span>draw<span>}{</span>0<span>}{</span>3<span>}</span>

<span>\draw</span> (a)--(b)--(c)--(d)--(e)--(f)--(a);
<span>\end</span><span>{</span>tikzpicture<span>}</span>

<span>\ExplSyntaxOff</span>
</pre></div>

<p>Output:</p>

<p><img src="http://shapr.github.io/media/2020/latex3/tikz-template-graph.png"/>
</p>

<h3 id="processing-multi-line-text">Processing multi-line text</h3>

<p>We can use regular expressions and the <code>xparse</code> package to process multi-line text.
In this example, we try to implement a code listing command with line numbering.
If we use <code>+v</code> argument specification in <code><span>\NewDocumentCommand</span></code>, the argument will be captured as multi-line verbatim.
Once the argument is captured as <code>#1</code>, we use <code><span>\regex_split</span><span>:nnN</span> <span>{</span><span>\^</span><span>^</span>M<span>}</span> <span>{</span>#1<span>}</span> <span>\l_tmpa_seq</span></code> to split it into multiple lines and save each line in <code><span>\l_tmpa_seq</span></code>.
The <code><span>\^</span><span>^</span>M</code> notation means the carridge return character (ASCII code 13); more details about the <code>^^</code> notation can be found in this <a href="https://tex.stackexchange.com/questions/62725/the-notation-in-various-engines">link</a>.</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\NewDocumentCommand</span><span>{</span><span>\numberedtext</span><span>}{</span>+v<span>}{</span>
    <span>\regex_split</span><span>:nnN</span> <span>{</span><span>\^</span><span>^</span>M<span>}</span> <span>{</span>#1<span>}</span> <span>\l_tmpa_seq</span> <span>% split into lines</span>
    <span>\int_set</span><span>:Nn</span> <span>\l_tmpa_int</span> <span>{</span>1<span>}</span> <span>% line number variable</span>
    <span>\seq_map_inline</span><span>:Nn</span> <span>\l_tmpa_seq</span> <span>{</span>
        <span>\par</span>
        <span>\group_begin</span><span>:</span> <span>% we want to limit \ttfamily in this group</span>
        <span>\int_use</span><span>:N</span> <span>\l_tmpa_int</span> <span>\ttfamily</span> <span>\ </span><span>% extra space between line number and content</span>
        <span>\tl_to_str</span><span>:n</span> <span>{</span>##1<span>}</span> <span>% convert content into string</span>
        <span>\group_end</span><span>:</span>
        <span>\int_incr</span><span>:N</span> <span>\l_tmpa_int</span> <span>% increment line number counter</span>
    <span>}</span>
<span>}</span>
<span>\ExplSyntaxOff</span>

<span>\numberedtext</span><span>{</span><span>\NewDocumentCommand</span><span>{</span><span>\numberedtext</span><span>}{</span>+v<span>}{</span>
    <span>\regex_split</span><span>:nnN</span> <span>{</span><span>\^</span><span>^</span>M<span>}</span> <span>{</span>#1<span>}</span> <span>\l_tmpa_seq</span>
    <span>\int_set</span><span>:Nn</span> <span>\l_tmpa_int</span> <span>{</span>1<span>}</span>
    <span>\seq_map_inline</span><span>:Nn</span> <span>\l_tmpa_seq</span> <span>{</span>
        <span>\par</span>
        <span>\group_begin</span><span>:</span>
        <span>\int_use</span><span>:N</span> <span>\l_tmpa_int</span> <span>\ttfamily</span> <span>\ </span>
        <span>\tl_to_str</span><span>:n</span> <span>{</span>##1<span>}</span>
        <span>\group_end</span><span>:</span>
        <span>\int_incr</span><span>:N</span> <span>\l_tmpa_int</span>
    <span>}</span>
<span>}}</span>
</pre></div>

<p>Output:</p>
<p><img src="http://shapr.github.io/media/2020/latex3/linenos.png"/>
</p>

<h2 id="latex3-file-io-xix">LaTeX3: File I/O (XIX)</h2>

<p>In <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>, the APIs of file operations are standardized.</p>

<p>File reading:</p>
<ul>
  <li><code><span>\ior_new</span><span>:N</span></code>: create new I/O read variable</li>
  <li><code><span>\ior_open</span><span>:Nn</span></code>: open file for reading</li>
  <li><code><span>\ior_close</span><span>:N</span></code>: close file</li>
  <li><code><span>\ior_get</span><span>:NN</span></code>: read one line or a complete group as token list</li>
  <li><code><span>\ior_str_get</span><span>:NN</span></code>: read one line as string</li>
  <li><code><span>\ior_map_inline</span><span>:Nn</span></code>: traverse file as token list</li>
  <li><code><span>\ior_str_map_inline</span><span>:Nn</span></code>: traverse file as string</li>
  <li><code><span>\ior_if_eof_p</span><span>:N</span></code>: check if the tail of a file is reached</li>
</ul>

<p>File writing:</p>

<ul>
  <li><code><span>\iow_new</span><span>:N</span></code>: create new I/O write variable</li>
  <li><code><span>\iow_open</span><span>:Nn</span></code>: open file for writing</li>
  <li><code><span>\iow_close</span><span>:N</span></code>: close file</li>
  <li><code><span>\iow_now</span><span>:Nn</span></code>: immediately write content into the file, followed by a line break</li>
  <li><code><span>\iow_newline</span><span>:</span></code>: line break function-this function must be expanded in order to take effect (e.g. <code><span>\iow_now</span><span>:Nx</span> <span>\l_tmpa_iow</span> <span>{</span><span>\iow_newline</span><span>:</span><span>}</span></code>; if the second argument has type <code>n</code>, nothing will happen)</li>
</ul>

<h3 id="writing-to-a-file">Writing to a file</h3>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>\iow_open</span><span>:Nn</span> <span>\g_tmpa_iow</span> <span>{</span>testfile1.txt<span>}</span>
<span>\iow_now</span><span>:Nx</span> <span>\g_tmpa_iow</span> <span>{</span>hello<span>\iow_newline</span><span>:</span> world<span>}</span>
<span>\iow_close</span><span>:N</span> <span>\g_tmpa_iow</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>The content of <code>testfile1.txt</code>:</p>


<h3 id="reading-and-parsing-comma-separated-file">Reading and parsing comma-separated file</h3>

<p>In the following example, we store a series of decimal numbers in a comma-separated file. Then, we read the file and calculate the sum of all numbers.</p>

<div><pre><span></span><span>\ExplSyntaxOn</span>
<span>% write numbers to testfile2.txt</span>
<span>\iow_open</span><span>:Nn</span> <span>\g_tmpa_iow</span> <span>{</span>testfile2.txt<span>}</span>
<span>\iow_now</span><span>:Nx</span> <span>\g_tmpa_iow</span> <span>{</span>1.2,2.6,3.7,4.9,5.0,6.5,7.4,8.2,9.4,10.8<span>}</span>
<span>\iow_close</span><span>:N</span> <span>\g_tmpa_iow</span>

<span>% open file for reading</span>
<span>\ior_open</span><span>:Nn</span> <span>\g_tmpa_ior</span> <span>{</span>testfile2.txt<span>}</span>
<span>% get the first line</span>
<span>\ior_str_get</span><span>:NN</span> <span>\g_tmpa_ior</span> <span>\l_tmpa_str</span>
<span>% create function variant</span>
<span>\cs_generate_variant</span><span>:Nn</span> <span>\regex_split</span><span>:nnN</span> <span>{</span>nVN<span>}</span>
<span>% split the line into a queue with regular expression</span>
<span>\regex_split</span><span>:nVN</span> <span>{</span>,<span>}</span> <span>\l_tmpa_str</span> <span>\l_tmpa_seq</span>

<span>% initialize the sum variable</span>
<span>\fp_set</span><span>:Nn</span> <span>\l_tmpa_fp</span> <span>{</span>0.0<span>}</span>
<span>% traverse the queue</span>
<span>\seq_map_inline</span><span>:Nn</span> <span>\l_tmpa_seq</span> <span>{</span>
  <span>% sum the numbers</span>
  <span>\fp_add</span><span>:Nn</span> <span>\l_tmpa_fp</span> <span>{</span>#1<span>}</span>
<span>}</span>

<span>% show result in math mode</span>
<span>$</span><span>\seq</span><span>_use:Nn </span><span>\l</span><span>_tmpa_seq {</span><span>+</span><span>} </span><span>=</span><span> </span><span>\fp</span><span>_use:N </span><span>\l</span><span>_tmpa_fp</span><span>$</span>
<span>% close file</span>
<span>\ior_close</span><span>:N</span> <span>\g_tmpa_ior</span>
<span>\ExplSyntaxOff</span>
</pre></div>

<p>Output:</p>
<div><div><pre><code>1.2+2.6+3.7+4.9+5.0+6.5+7.4+8.2+9.4+10.8=59.7
</code></pre></div></div>

<h2 id="memo">Memo</h2>

<p>Useful techniques:</p>


<p>Because the number of <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> modules is huge, it is very difficult to cover most of them in a limited amount of time. Here, I list some other libraries that are worth looking at:</p>
<ul>
  <li><code>l3coffins</code> (XXX), <code>l3box</code> (XXIX): allows one to gauge the width/height of objects</li>
  <li><code>l3intarray</code> (XXII), <code>l3fparray</code> (XXIV): high performance numeric arrays</li>
  <li><code>l3sort</code>: sotring queues/token lists</li>
  <li><code>l3msg</code>: generating exception messages</li>
</ul>

<h2 id="end-note">End Note</h2>

<p>In this article, I try to breifly introduce the naming convention, the usage of variables and functions and some commonly used modules of <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>. I hope that this organization enables readers to understand the basics of <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>, which allows them to write simple <img src="http://shapr.github.io/media/2020/latex3/latex.svg" alt="LaTeX"/> programs quickly.</p>

<p>There is no doubt that many documents can benefit from the programming capabilities of <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/>. It is really pitiful that existing tutorials on <img src="http://shapr.github.io/media/2020/latex3/latex3.svg" alt="LaTeX3"/> is rare, which significantly limits the development of this language. Hopefully, this article can help more people get familar with this powerful tool.</p>





</div></div>
  </body>
</html>
