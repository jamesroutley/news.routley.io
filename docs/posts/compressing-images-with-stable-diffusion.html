<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/">Original</a>
    <h1>Compressing Images with Stable Diffusion</h1>
    
    <div id="readability-page-1" class="page"><div>
        <article>
        <div>
            <div>
                <div>
                    
                    <p>You get the gist</p><p>Images are just too big.
A 3 MB bitmap compresses down to a 500 KB JPEG, which, don’t get me wrong, 16% of the original size is great, but why 500 KB?
That’s still pretty large.</p>
<p>This is 2022, we shouldn’t have to put up with large images.
Our websites might load 60 MB of stuff for a pageview, but that stuff shouldn’t be images, it should be Javascript, as Brendan Eich intended.</p>
<p>We shouldn’t have to put up with fat images, but, until now, <a href="https://en.wikipedia.org/wiki/JPEG_2000">we</a> <a href="https://en.wikipedia.org/wiki/JPEG_XR">had</a> <a href="https://en.wikipedia.org/wiki/WebP">no</a> <a href="https://en.wikipedia.org/wiki/AVIF">choice</a>.</p>
<p>Now we do.</p>
<h2>The solution</h2>
<div><p><a href="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/compressing.jpg" data-lightbox="gallery"><img src="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/compressing.jpg"/></a></p><p><span>a computer compressing data, by Caspar David Friedrich, matte painting trending on artstation HQ</span></p></div><p>A week or so ago, <a href="https://stability.ai/blog/stable-diffusion-public-release">Stable Diffusion was released</a>, and the world <!-- break -->went crazy, and for good reason.
Stable Diffusion, if you haven’t heard, is a new AI that generates realistic images from a text prompt.
You basically give it a description of the image you want, and it generates it.</p>
<p>Now, this alone would be revolutionary, but we got double the revolution this time:
This thing can also <a href="https://replicate.com/methexis-inc/img2prompt">take an image and tell you the prompt you can use to generate it</a>.</p>
<p>Are you thinking what I’m thinking?</p>
<p>That’s right, why compress an image to 500 KB when you can compress it to 50 bytes, where the bytes are the prompt that can be used to generate the <em>exact same image</em> again?</p>
<p>You wouldn’t, of course not.</p>
<p>Instead, what you would do, is ask the image-describing AI to describe the image, take the resulting (very small) prompt, transmit it over the wire, where the recipient would then use it to generate the image again based on the prompt.</p>
<p>I call this technique STAV, or Stable Transcription and Artistic Validation.
Yes, the acronym might not contain any of the words “image”, “compression”, “reconstruction”, or “diffusion”, but Philip Katzip isn’t going to be the only one giving his name to compression techniques.</p>
<h2>Expected gains</h2>
<p>As <a href="https://en.wikipedia.org/wiki/A_picture_is_worth_a_thousand_words">is widely known</a>, a picture is worth 1000 words.
At an <a href="http://norvig.com/mayzner.html">average English word length of 4.7</a>, we can expect each image to take up to 4.7 KB, regardless of its original size.
The corrolary here is that we can use this method to also <em>upscale images</em> without any loss in quality, which I have accepted as a very fortunate side-effect of my technique.</p>
<p>Sure, this may have <em>some</em> loss of quality, but it would generally depend on the number of iterations you ran when generating the image.</p>
<p>Based on the numbers above, here are some rough estimates on the gains we can expect to see:</p>
<table>
<thead><tr>
<th><em>Algorithm</em></th>
<th><em>Max size</em></th>
<th><em>Size compared to STAV</em></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>JPEG</strong></td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>AVIF</strong></td>
<td>∞</td>
<td>∞</td>
</tr>
<tr>
<td><strong>STAV</strong></td>
<td>4.5 KB</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>As we can see, due to the fact that STAV has fixed size, it is easily potentially infinitely smaller than both AVIF and JPEG, which is good.</p>
<h2>Real-world benchmarks</h2>
<p>Of course, no new compression method is complete without real-world benchmark data to back up its claims.
This is why I’ve compiled an extensive analysis of sample images from <a href="https://www.unsplash.com">Unsplash</a>, and am presenting them here.</p>
<p>In the images that follow, the leftmost is the uncompressed (raw) image, the middle image is compressed with JPEG, and the rightmost image is compressed with STAV.
I haven’t bothered to include the raw and JPEG sizes, as they’re thousands of times larger than the sizes of the STAV images.</p>
<p>For your edification, I have also included <em>the entire STAV-compressed data</em> below each image, in the form of the prompt that was recognized by img2prompt.
Let’s analyze them one by one.</p>
<h4>Objects in shot</h4>
<div><p><a href="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/1s.jpg" data-lightbox="gallery"><img src="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/1s-small.jpg"/></a><a href="https://unsplash.com/photos/bad-EArvYtU" title="Photo from https://unsplash.com/photos/bad-EArvYtU" target="_blank" rel="noopener noreferrer"><i></i></a></p><p><span>a person sitting in a chair holding a book and a pen, a stock photo by Chinwe Chukwuogo-Roy, trending on unsplash, art &amp; language, stock photo, stockphoto, depth of field</span></p></div><p>As we can see, the compressor deals with objects in the shot excellently.
There is no visible degradation at all, and the final image is sharp and vibrant.</p>
<p>One interesting note here:
img2prompt has correctly intuited that the image is from Unsplash, and has mentioned that in its generated prompt.
This will doubtless improve compression even further.</p>
<h4>People</h4>
<div><p><a href="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/2s.jpg" data-lightbox="gallery"><img src="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/2s-small.jpg"/></a><a href="https://unsplash.com/photos/j_DlBx9pDe0" title="Photo from https://unsplash.com/photos/j_DlBx9pDe0" target="_blank" rel="noopener noreferrer"><i></i></a></p><p><span>a woman with tattoos and a hat on, a tattoo by James Baynes, featured on unsplash, neo-romanticism, anamorphic lens flare, tattoo, backlight</span></p></div><p>Another excellent performance here.
The lighting is impeccable, the hairs are sharp and well-defined, and the hat looks great on the lady.</p>
<h4>Interior shots</h4>
<div><p><a href="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/3s.jpg" data-lightbox="gallery"><img src="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/3s-small.jpg"/></a><a href="https://unsplash.com/photos/KNr1xv9UjHA" title="Photo from https://unsplash.com/photos/KNr1xv9UjHA" target="_blank" rel="noopener noreferrer"><i></i></a></p><p><span>a living room with a green chair next to a window, a stock photo by Aaron Bohrod, trending on unsplash, light and space, studio light, studio lighting, volumetric lighting</span></p></div><p>Performance here isn’t as stellar as in the other shots, as the colors are imperceptibly more muted than the original, but overall there is almost no difference.
The original and the STAV-compressed images are nearly indistinguishable.
JPEG is disappointing, as there are visible artifacts.</p>
<h4>Food</h4>
<div><p><a href="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/4s.jpg" data-lightbox="gallery"><img src="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/4s-small.jpg"/></a><a href="https://unsplash.com/photos/wRP-a0XFmhI" title="Photo from https://unsplash.com/photos/wRP-a0XFmhI" target="_blank" rel="noopener noreferrer"><i></i></a></p><p><span>three bowls of food on a white table, a stock photo by Kelly Sueda, trending on pinterest, mingei, shallow depth of field, pixel perfect, intricate patterns</span></p></div><p>Somehow, the food in the STAV-compressed image looks even more delicious than the original.
Otherwise, there is no perceptible quality difference.</p>
<h4>Food <em>and</em> people</h4>
<div><p><a href="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/5s.jpg" data-lightbox="gallery"><img src="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/5s-small.jpg"/></a><a href="https://unsplash.com/photos/Sg1vWutVfOY" title="Photo from https://unsplash.com/photos/Sg1vWutVfOY" target="_blank" rel="noopener noreferrer"><i></i></a></p><p><span>a couple of women standing in a kitchen preparing food, a stock photo by Meredith Garniss, pinterest contest winner, private press, stock photo, stockphoto, film grain</span></p></div><p>This particular image posed a challenge for the compressor, with its sharp detail and subtle blur, but the compressor pulled through.
Details are preserved and vibrant, and even the blur is visible.
Why we’d want to keep the blur, I don’t know, but a compressor must be faithful above all.</p>
<h4>Nature</h4>
<div><p><a href="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/6s.jpg" data-lightbox="gallery"><img src="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/6s-small.jpg"/></a><a href="https://unsplash.com/photos/Wv1EbxVG71U" title="Photo from https://unsplash.com/photos/Wv1EbxVG71U" target="_blank" rel="noopener noreferrer"><i></i></a></p><p><span>a pink flower with green leaves on a white background, a macro photograph by Ikuo Hirayama, featured on unsplash, minimalism, shallow depth of field, depth of field, soft light</span></p></div><p>There isn’t much to say here.
STAV blows JPEG out of the water, the flower looks almost alive, even though the original image contains no flower.
If anything, this enhancement showcases a strength of this technique.</p>
<div><p><a href="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/7s.jpg" data-lightbox="gallery"><img src="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/7s-small.jpg"/></a><a href="https://unsplash.com/photos/Ka_Q1pJXwps" title="Photo from https://unsplash.com/photos/Ka_Q1pJXwps" target="_blank" rel="noopener noreferrer"><i></i></a></p><p><span>a person standing on top of a mountain, a tilt shift photo by Paul Bodmer, trending on unsplash, naturalism, sense of awe, shallow depth of field, photo taken with ektachrome</span></p></div><h4>Exterior architecture</h4>
<div><p><a href="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/8s.jpg" data-lightbox="gallery"><img src="https://www.stavros.io/posts/compressing-images-with-stable-diffusion/8s-small.jpg"/></a><a href="https://unsplash.com/photos/MecG7GC4APk" title="Photo from https://unsplash.com/photos/MecG7GC4APk" target="_blank" rel="noopener noreferrer"><i></i></a></p><p><span>an aerial view of a pond in the middle of a forest, a tilt shift photo by Stanley Twardowicz, trending on unsplash, ecological art, high dynamic range, photo taken with nikon d750, isometric</span></p></div><p>We can see here that the compressor has preserved every tiny detail of the original image, except the house, which was, admittedly, kind of ugly.
It’s heartening to see this method go from strength to strength as it even <em>enhances</em> images.</p>
<h4>Conclusions</h4>
<p>As you can see, there is basically no loss in quality, even though the images’s sizes are around a ten-thousandth the original’s.
This is an absolutely astonishing result, and will definitely herald a new era of compression.
There are even some cases where quality is <em>better</em> than the original, and it is astonishing for a compressor to achieve 100%+ quality.</p>
<p>There are some minor kinks that need to be worked out, such as the fact that each image takes around a day to generate on mobile, but this is more than acceptable in certain domains.
Website visitors, for example, are well-accustomed to such loading times, and would barely notice any difference.</p>
<h2>Epilogue</h2>
<p>In conclusion, I really believe that this method can help lower file sizes and make a significant difference in various niches, e.g. the web, or games that come on multiple floppy disks.
I urge you to give it a try and see what kind of results you get.</p>
<p>If you have any feedback, please <a href="https://twitter.com/intent/user?screen_name=Stavros">Tweet</a> or <a href="https://mastodon.social/@stavros">toot</a> at me, or email me directly.
I would especially like to hear of any pathological edge-cases where the final image is somehow significantly different from the original, so I can investigate.</p>
<p>Thank you!</p>

                    
                </div>
            </div>
        </div>
        </article>
    </div></div>
  </body>
</html>
