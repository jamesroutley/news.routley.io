<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://anguscheng.com/post/2023-12-12-wasm-game-in-c-raylib/">Original</a>
    <h1>Building a Web Game in C</h1>
    
    <div id="readability-page-1" class="page"><div><p>Christmas is coming up. When I used to work at a bank the entire month of December and a bit of January we were placed under “Change Freeze”. We weren’t allowed to deploy updates to our applications during this period. The thinking was:</p>
<ol>
<li>A lot of people are away over Christmas</li>
<li>Application changes can lead to crashes</li>
<li>People who know how to fix those crashes might be away</li>
</ol>
<p>To prevent this they just stopped us from deploying updates. That meant December was a pretty relaxing time to be working at a bank, and it was also a good time to do big refactors, clean up //TODOs or mess around with some new technology. So how about learning to code a game in C and build it out to WebAssmebly?</p>
<h3 id="1-install-raylib">1. Install Raylib</h3>
<p>Go <a href="https://github.com/raysan5/raylib#build-and-installation">here</a> to get Raylib installed on your operating system. On Windows I used the installer which is available on itch.io and for MacOS I used Homebrew.</p>
<h3 id="2-create-mainc">2. Create main.c</h3>
<div><pre><code data-lang="C"><span>#include</span> <span>&#34;raylib.h&#34;</span><span>
</span><span></span>
<span>int</span> <span>main</span>(<span>void</span>) {
    InitWindow(<span>512</span>, <span>512</span>, <span>&#34;Raylib WASM Example&#34;</span>);
    Texture2D texture <span>=</span> LoadTexture(<span>&#34;resources/smile.png&#34;</span>);

    <span>while</span> (<span>!</span>WindowShouldClose()) {
        BeginDrawing();
        ClearBackground(BLACK);
        DrawTexture(texture, <span>0</span>, <span>0</span>, WHITE);
        EndDrawing();
    }

    UnloadTexture(texture);
    CloseWindow();
    <span>return</span> <span>0</span>;
}
</code></pre></div><p>Create this file and place it in <code>src/main.c</code></p>
<h3 id="3-copy-this-image">3. Copy this image</h3>
<p><img src="https://anguscheng.com/images/2023-12-12/smile.png" alt=""/></p>
<p>Copy this image and place it in <code>src/resources/smile.png</code></p>
<h3 id="4a-build-macos">4A. Build MacOS</h3>
<pre><code>gcc -Wall -fcolor-diagnostics -fansi-escape-codes -g src/main.c `pkg-config --libs --cflags raylib` -o out/main.out
</code></pre><h3 id="4b-build-windows">4B. Build Windows</h3>
<pre><code>gcc src/main.c -lraylib -lopengl32 -lgdi32 -lwinmm -g -o out/main.exe
</code></pre><h3 id="run-the-build">Run the Build</h3>
<pre><code># Need to run from the src folder because the code wants the resources folder to be in the current working directory.
cd src

# MacOS
../out/main.out

# Windows
../out/main.exe
</code></pre><p><img src="https://anguscheng.com/images/2023-12-12/window.png" alt=""/></p>
<p>You should see this if you did it right. If not, hang your head in shame.</p>
<h3 id="5-download-emscripten">5. Download Emscripten</h3>
<p>Now that we’re building successfully on Windows or Mac, we can get ready to build out to Web Assembly. I recommend you clone emsdk into the same directory where your game directory lives. You don’t have to but it’ll make running the build script we’re going to create easier.</p>
<pre><code># Get the emsdk repo
git clone https://github.com/emscripten-core/emsdk.git

# Enter that directory
cd emsdk

# Fetch the latest version of the emsdk (not needed the first time you clone)
git pull

# Download and install the latest SDK tools.
./emsdk install latest

# Make the &#34;latest&#34; SDK &#34;active&#34; for the current user. (writes .emscripten file)
./emsdk activate latest

# Activate PATH and other environment variables in the current terminal
source ./emsdk_env.sh
</code></pre><h3 id="6-create-shellhtml">6. Create shell.html</h3>
<p><a href="https://anguscheng.com/images/2023-12-12/shell">Download this HTML file</a> and place it in <code>/shell.html</code>. It’s going to wrap around our web assembly game.</p>
<h3 id="7-create-the-build-script">7. Create the build script</h3>
<div><pre><code data-lang="bash"><span>#!/bin/bash
</span><span></span>set -euo pipefail

<span># Get EMSDK on the PATH</span>
cd ../emsdk
source emsdk_env.sh

<span># Get into the /src folder</span>
cd ../raylib-wasm-example
cd src

<span># Build to Web Assembly</span>
emcc -o ../out/index.html <span>\
</span><span></span>    main.c -Os -Wall /Users/anguscheng/workspace/raylib/src/libraylib.a <span>\
</span><span></span>    -I. -I /usr/local/Cellar/raylib/4.5.0/include <span>\
</span><span></span>    -L. -L /Users/anguscheng/workspace/raylib/src <span>\
</span><span></span>    -s USE_GLFW<span>=</span><span>3</span> <span>\
</span><span></span>    -s ASYNCIFY <span>\
</span><span></span>    --shell-file ../shell.html <span>\
</span><span></span>    --preload-file resources <span>\
</span><span></span>    -s TOTAL_STACK<span>=</span>64MB <span>\
</span><span></span>    -s INITIAL_MEMORY<span>=</span>128MB <span>\
</span><span></span>    -s ASSERTIONS <span>\
</span><span></span>    -DPLATFORM_WEB

<span># Get into /out</span>
cd ../out

<span># Run the game</span>
emrun index.html
</code></pre></div><p>Copy this file to <code>/build-wasm.sh</code> you’ll have to change the -I and -L paths.</p>
<p>If it worked a browser should open up and show <a href="https://anguscheng.com/raylib-wasm-example/">this page</a>.</p>
<h3 id="github-repository">Github Repository</h3>
<p>All source files are available <a href="https://github.com/BallerIndustries/raylib-wasm-example">here</a>.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://www.youtube.com/watch?v=j6akryezlzc">https://www.youtube.com/watch?v=j6akryezlzc</a></li>
<li><a href="https://github.com/raysan5/raylib/wiki/Working-for-Web-(HTML5)">https://github.com/raysan5/raylib/wiki/Working-for-Web-(HTML5)</a></li>
<li><a href="https://emscripten.org/docs/getting_started/downloads.html">https://emscripten.org/docs/getting_started/downloads.html</a></li>
</ul>
<ul>
  
</ul>

    </div></div>
  </body>
</html>
