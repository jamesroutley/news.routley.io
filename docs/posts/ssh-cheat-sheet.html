<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.marcobehler.com/guides/ssh-cheat-sheet">Original</a>
    <h1>SSH Cheat Sheet</h1>
    
    <div id="readability-page-1" class="page"><div>
                <p>A cheat sheet for popular SSH commands, key generation, SSH agents that I&#39;m using a lot.</p>
                

                <div>
<h2 id="_ssh_keygen">SSH-Keygen</h2>
<div>
<p>Nowadays, most platforms recommend you to generate keys with the ed25519 algorithm.</p>
<div>
<div>
<pre><code data-lang="console"><span>ssh-keygen -t ed25519 -C &#34;your@email.com&#34;</span></code></pre>
</div>
</div>
<p>If you prefer to go with RSA for compatibility reasons, use the following:</p>
<div>
<div>
<pre><code data-lang="console"><span>ssh-keygen -t rsa -b 4096 -C &#34;your@email.com&#34;</span></code></pre>
</div>
</div>
<p>The <code><em>-C</em></code> file simply puts a comment on your public key, like below, so you can e.g. easily make out which public key belongs to which email address, in a busy <a href="#authorized_keys">Authorized_Keys</a> file.</p>
<div>
<div>
<pre><code data-lang="text">ssh-ed25519 KLAJSDLKSAJKLSJD90182980p1+++ your@email.com</code></pre>
</div>
</div>
<p><strong>Note</strong>: When generating SSH keys, make sure to protect your private key with a passphrase.</p>
</div>
</div>
<div>
<h2 id="_ssh_with_keys">SSH with Keys</h2>
<div>
<p>To use a specific private key to connect to a server, use:</p>
<div>
<div>
<pre><code data-lang="console"><span>ssh -i mykeyfile user@remotehost.com</span></code></pre>
</div>
</div>
<p>Instead of specifying your key files manually with <code><em>-i</em></code>, use an <a href="#ssh-agent">SSH-Agent</a>.</p>
</div>
</div>
<div>

<div>
<p>Any remote host or service, like GitHub, that you want to use your SSH keys with, needs the <code><em>public key</em></code> of your SSH keypair.</p>

<p>With services like GitHub, AWS etc. you would either use the UI to upload your public key, or, if available, command-line tools.</p>
</div>
</div>
<div>
<h2 id="_scp">SCP</h2>
<div>
<p>To upload a file to a remote server:</p>
<div>
<div>
<pre><code data-lang="console"><span>scp myfile.txt user@dest:/path</span></code></pre>
</div>
</div>
<p>To recursively upload a local folder to a remote server:</p>
<div>
<div>
<pre><code data-lang="console"><span>scp -rp sourcedirectory user@dest:/path</span></code></pre>
</div>
</div>
<p>To download a file from a remote server:</p>
<div>
<div>
<pre><code data-lang="console"><span>scp user@dest:/path/myfile.txt localpath</span></code></pre>
</div>
</div>
<p>To recursively download a local folder to a remote server:</p>
<div>
<div>
<pre><code data-lang="console"><span>scp -rp user@dest:/remotedir localpath</span></code></pre>
</div>
</div>
<p><strong>Hint</strong>: When doing things recursively via SCP, you might want to consider rsync, which also runs over SSH and has <a href="https://serverfault.com/a/264606">a couple of advantages over SCP</a>.</p>
<p><strong>Hint 2</strong>: <a href="https://lwn.net/Articles/835962/">SCP has been deprecated</a> and you should consider switching to (the less user-friendly) SFTP.</p>
</div>
</div>
<div>
<h2 id="ssh-agent">SSH-Agent</h2>
<div>
<p>With a running OpenSSH agent (automatically available out of the box on most Linux distributions and macOS) simply use:</p>


<div>
<div>
<pre><code data-lang="console"><span>#</span><span> </span>By default the ssh-agent service is disabled. Allow it to be manually started <span>for </span>the next step to work.
<span>#</span><span> </span>Make sure you<span>&#39;re running as an Administrator.
</span><span>Get-Service ssh-agent | Set-Service -StartupType Automatic

</span><span>#</span><span> </span>Start the service
<span>Start-Service ssh-agent</span></code></pre>
</div>
</div>
<p><strong>Note</strong>: On Windows/Linux adding a key to your ssh-agent once, even with a password, will make sure that the key gets associated with your &#39;login&#39;. Meaning: When you restart your PC and log in again, you’ll have your identity automatically available again.</p>
<p>To get the same behavior on macOS, you’ll need to follow these instructions <a href="https://apple.stackexchange.com/a/250572">on StackExchange</a>.</p>
</div>
</div>
<div>
<h2 id="_ssh_config">SSH Config</h2>
<div>
<p>Create a file  <code><em>~/.ssh/config</em></code> to manage your SSH hosts. Example:</p>
<div>
<div>
<pre><code data-lang="text">Host dev-meta*
    User ec2-user
    IdentityFile ~/.ssh/johnsnow.pem

Host dev-meta-facebook
    Hostname 192.168.178.1

Host dev-meta-whatsapp
    Hostname 192.168.178.2

Host api.google.com
    User googleUser
    IdentityFile ~/.ssh/targaryen.key</code></pre>
</div>
</div>
<p><strong>Note</strong>:</p>
<p>The <code><em>Host</em></code> directive can either</p>
<div>
<ul>
<li>
<p>be a pattern (matching multiple follow-up <code><em>Hosts</em></code>)</p>
</li>
<li>
<p>refer to a made-up hostname (<code><em>dev-facebook</em></code>)</p>
</li>
<li>
<p>be a real hostname.</p>
</li>
</ul>
</div>
<p>If it’s a made-up hostname, you’ll need to specify an additional <code><em>Hostname</em></code> directive, otherwise, you can leave it out. And to add to the overall confusion, a <code><em>Host</em></code> line can actually contain multiple patterns.</p>
<p>With the config file above, you could do a:</p>

<p>Which would effectively do a <code><em>ssh -i ~/.ssh/johnsnow.pem  ec2-user@192.168.178.1</em></code> for you.</p>
<p>For a full overview of all available options, look at <a href="https://linuxize.com/post/using-the-ssh-config-file/">this article</a>.</p>
</div>
</div>
<div>
<h2 id="_git_windows_openssh">Git &amp; Windows OpenSSH</h2>
<div>
<p>To make Git use Window’s OpenSSH (and not the one it bundles), execute the following command:</p>
<div>
<div>
<pre><code data-lang="console"><span>git config --global core.sshcommand &#34;C:/Windows/System32/OpenSSH/ssh.exe&#34;</span></code></pre>
</div>
</div>
</div>
</div>
<div>
<h2 id="_exit_dead_ssh_sessions">Exit Dead SSH Sessions</h2>
<div>
<p>To kill an unresponsive SSH session, hit, subsequently.</p>

</div>
</div>
<div>
<h2 id="_multiple_github_keypairs">Multiple GitHub Keypairs</h2>
<div>
<p>Trying to clone different private GitHub repositories, which have different SSH keypairs associated with them, doesn’t work out of the box.</p>
<p>Add this to your <code><em>.ssh/config</em></code> (this example assumes you have two GitHub keypairs, one for your work account and one for your personal account)</p>
<div>
<div>
<pre><code data-lang="console"><span>Host github-work.com
    Hostname github.com
    IdentityFile ~/.ssh/id_work

Host github-personal.com
    Hostname github.com
    IdentityFile ~/.ssh/id_personal</span></code></pre>
</div>
</div>
<p>Then instead of cloning from <code><em>github.com</em></code>.</p>
<div>
<div>
<pre><code data-lang="console"><span>git clone git@github.com:marcobehlerjetbrains/buildpipelines.git</span></code></pre>
</div>
</div>
<p>Clone from either <code><em>github-work.com</em></code> or <code><em>github-personal.com</em></code>.</p>
<div>
<div>
<pre><code data-lang="console"><span>git clone git@github-work.com:marcobehlerjetbrains/buildpipelines.git</span></code></pre>
</div>
</div>
</div>
</div>
<div>
<h2 id="_ssh_agent_forwarding">SSH Agent Forwarding</h2>
<div>
<p>Ever wanted to use your local SSH keys on a remote server, without copying your keys to that server? For example to <code><em>git clone</em></code> a private repository via SSH on a remote server?</p>
<p>Agent forwarding to the rescue. Edit your local <code><em>.ssh/config</em></code> file like so:</p>
<div>
<div>
<pre><code data-lang="console"><span>Host yourremoteserver.com
    ForwardAgent yes</span></code></pre>
</div>
</div>
<p>Then simply <code><em>ssh</em></code> to your server and execute an <code>_ssh-add -L</code>. The server’s SSH agent should have all local SSH identities available and you can start cloning away!</p>
</div>
</div>
<div>
<h2 id="_ssh_tunnels">SSH Tunnels</h2>
<div>
<p>Want to connect to a server that is hidden from the outside world, but accessible from a box you have SSH access to? Like an Amazon RDS database, which is only reachable from inside an AWS network?</p>
<p>Use SSH forwarding</p>
<div>
<div>
<pre><code data-lang="console"><span>ssh username@jumphost -N -f -L localport:targethost:targetport</span></code></pre>
</div>
</div>
<p>The following command establishes an SSH tunnel between my <code><em>local machine (@port 3307)</em></code> and an <code><em>RDS database (@port 3306)</em></code>, via an <code><em>EC2 jump host (18.11.11.11)</em></code>.</p>
<div>
<div>
<pre><code data-lang="console"><span>ssh ec2-user@18.11.11.11 -N -f -L 3307:marcotestme.12345.eu-central-1.rds.amazonaws.com:3306</span></code></pre>
</div>
</div>
<p>You could now, for example, use the mysql client to connect to <code><em>localhost:3307</em></code>, which will be transparently tunneled to RDS for you.</p>
<div>
<div>
<pre><code data-lang="console"><span>mysql -h localhost -P 3307</span></code></pre>
</div>
</div>
<p><strong>Note</strong>: A lot of tools/IDEs like <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a>, support opening up SSH tunnels by just clicking a checkbox in the UI.</p>
</div>
</div>
<div>
<h2 id="_password_managers_ssh_agents">Password Managers &amp; SSH Agents</h2>
<div>
<p>Password Managers like <a href="https://developer.1password.com/docs/ssh/agent/">1Password</a> or <a href="https://lechnology.com/software/keeagent/">Keepass</a> can not only store your SSH keys, but they also come with their own <code><em>ssh-agent</em></code>, replacing your system’s ssh-agent.</p>
<p>This means, whenever you unlock your password manager on any machine that you have it installed on, you’ll have all your SSH identities instantly available.</p>
<p>Super useful!</p>
</div>
</div>
<div>
<h2 id="_video">Video</h2>
<div>
<p>If you prefer video, you can see the guide in action on YouTube.</p>
<p>
          <iframe src="https://www.youtube.com/embed/UnM4QAumuCQ" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</p>
</div>
</div>


                <div>
                    <h4>There&#39;s more where that came from</h4>
                    <p>I&#39;ll send you an update when I
                        publish new guides. Absolutely no spam, ever. Unsubscribe anytime.</p>


                    


                </div>

                

                

                <h4>Comments</h4>

                



            </div></div>
  </body>
</html>
