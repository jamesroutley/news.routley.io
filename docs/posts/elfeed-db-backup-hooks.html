<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://punchagan.muse-amuse.in/blog/elfeed-db-back-up-hooks/">Original</a>
    <h1>Elfeed DB backup hooks</h1>
    
    <div id="readability-page-1" class="page"><div>
  <section>
    <p>Elfeed DB backup hooks</p>
    <p>
      <time>20 Jan 2026</time> 
      
       | 
      
      
      <span> <a href="https://punchagan.muse-amuse.in/tags/elfeed">elfeed</a> <a href="https://punchagan.muse-amuse.in/tags/emacs">emacs</a> <a href="https://punchagan.muse-amuse.in/tags/git">git</a> <a href="https://punchagan.muse-amuse.in/tags/blag">blag</a>  </span>
      
    </p>
    <div><p>I had a bunch of things running on my laptop – video call with screenshare, my
Windows VM, Firefox with a lot of tabs, etc. And my laptop crashed! I didn’t
have the time to dig into what, why and how.</p>
<p>Later in the day, I discovered my Elfeed’s DB was gone – blown away. :( I’m
guessing the crash happened in the middle of <code>elfeed-db-save</code>, and the data was
lost.</p>
<p>I’ve now added some back-up for the DB, since I intend to use Elfeed regularly.</p>
<div><pre tabindex="0"><code data-lang="emacs-lisp"><span><span><span>(</span><span>defvar</span> <span>pc/elfeed-db-save-timer</span> <span>nil</span>
</span></span><span><span>  <span>&#34;Timer for debounced elfeed database saves.&#34;</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>(</span><span>defun</span> <span>pc/elfeed-db-save-and-backup</span> <span>()</span>
</span></span><span><span>  <span>&#34;Save the elfeed database and commit to git.&#34;</span>
</span></span><span><span>  <span>(</span><span>when</span> <span>(</span><span>and</span> <span>(</span><span>boundp</span> <span>&#39;elfeed-db</span><span>)</span> <span>elfeed-db</span><span>)</span>
</span></span><span><span>    <span>(</span><span>elfeed-db-save</span><span>)</span>
</span></span><span><span>    <span>(</span><span>let</span> <span>((</span><span>default-directory</span> <span>elfeed-db-directory</span><span>))</span>
</span></span><span><span>      <span>(</span><span>when</span> <span>(</span><span>file-exists-p</span> <span>&#34;.git&#34;</span><span>)</span>
</span></span><span><span>        <span>(</span><span>call-process</span> <span>&#34;git&#34;</span> <span>nil</span> <span>&#34;*elfeed-db-backup*&#34;</span> <span>nil</span> <span>&#34;add&#34;</span> <span>&#34;-A&#34;</span><span>)</span>
</span></span><span><span>        <span>(</span><span>call-process</span> <span>&#34;git&#34;</span> <span>nil</span> <span>&#34;*elfeed-db-backup*&#34;</span> <span>nil</span> <span>&#34;commit&#34;</span> <span>&#34;-m&#34;</span> <span>&#34;auto-backup&#34;</span><span>)</span>
</span></span><span><span>        <span>(</span><span>call-process</span> <span>&#34;git&#34;</span> <span>nil</span> <span>&#34;*elfeed-db-backup*&#34;</span> <span>nil</span> <span>&#34;push&#34;</span> <span>&#34;origin&#34;</span> <span>&#34;main&#34;</span><span>)))))</span>
</span></span><span><span>
</span></span><span><span><span>(</span><span>defun</span> <span>pc/elfeed-db-save-soon</span> <span>()</span>
</span></span><span><span>  <span>&#34;Schedule a database save after 10 seconds of idle.&#34;</span>
</span></span><span><span>  <span>(</span><span>interactive</span><span>)</span>
</span></span><span><span>  <span>(</span><span>when</span> <span>pc/elfeed-db-save-timer</span>
</span></span><span><span>    <span>(</span><span>cancel-timer</span> <span>pc/elfeed-db-save-timer</span><span>))</span>
</span></span><span><span>  <span>(</span><span>setq</span> <span>pc/elfeed-db-save-timer</span>
</span></span><span><span>        <span>(</span><span>run-with-idle-timer</span> <span>10</span> <span>nil</span> <span>#&#39;</span><span>pc/elfeed-db-save-and-backup</span><span>)))</span>
</span></span><span><span>
</span></span><span><span><span>;; Save and backup when tags change (elfeed-web usage)</span>
</span></span><span><span><span>(</span><span>add-hook</span> <span>&#39;elfeed-tag-hooks</span>   <span>(</span><span>lambda</span> <span>(</span><span>&amp;rest</span> <span>_</span><span>)</span> <span>(</span><span>pc/elfeed-db-save-soon</span><span>)))</span>
</span></span><span><span><span>(</span><span>add-hook</span> <span>&#39;elfeed-untag-hooks</span> <span>(</span><span>lambda</span> <span>(</span><span>&amp;rest</span> <span>_</span><span>)</span> <span>(</span><span>pc/elfeed-db-save-soon</span><span>)))</span>
</span></span><span><span>
</span></span><span><span><span>;; Save and backup when new entries are added</span>
</span></span><span><span><span>(</span><span>add-hook</span> <span>&#39;elfeed-db-update-hook</span> <span>#&#39;</span><span>pc/elfeed-db-save-soon</span><span>)</span>
</span></span></code></pre></div></div>
  </section>

  <section>
    <p>
  Feel free to send me an <a href="mailto:punchagan+blog@muse-amuse.in">email</a> with your
  comments.
</p>

    




  </section>
</div></div>
  </body>
</html>
