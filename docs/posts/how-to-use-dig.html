<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jvns.ca/blog/2021/12/04/how-to-use-dig/">Original</a>
    <h1>How to use dig</h1>
    
    

<p>Hello! I talked to a couple of friends recently who mentioned they wished they knew
how to use <code>dig</code> to make DNS queries, so here&rsquo;s a quick blog post about it.</p>

<p>When I first started using <code>dig</code> I found it a bit intimidating &ndash; there are so
many options! I&rsquo;m going to leave out most of dig&rsquo;s options in this post and just
talk about the ones I actually use.</p>

<p>Also I learned recently that you can set up a <code>.digrc</code> configuration file to make its output
easier to read and it makes it SO MUCH nicer to use.</p>

<p>I also drew a <a href="https://wizardzines.com/comics/dig/">zine page about dig</a> a few years ago, but I wanted to write this post to include a bit more information.</p>

<h3 id="2-types-of-dig-arguments-query-and-formatting">2 types of dig arguments: query and formatting</h3>

<p>There are 2 main types of arguments you can pass to <code>dig</code>:</p>

<ol>
<li>arguments that tell dig <strong>what DNS query to make</strong></li>
<li>arguments that tell dig how to <strong>format the response</strong></li>
</ol>

<p>First, let&rsquo;s go through the query options.</p>

<h3 id="the-main-query-options">the main query options</h3>

<p>The 3 things you usually want to control about a DNS query are:</p>

<ol>
<li>the <strong>name</strong> (like <code>jvns.ca</code>). The default is a query for the empty name (<code>.</code>).</li>
<li>the <strong>DNS query type</strong> (like <code>A</code> or <code>CNAME</code>). The default is <code>A</code>.</li>
<li>the <strong>server</strong> to send the query to (like <code>8.8.8.8</code>). The default is what&rsquo;s in <code>/etc/resolv.conf</code>.</li>
</ol>

<p>The format for these is:</p>

<pre><code>dig @server name type
</code></pre>

<p>Here are a couple of examples:</p>

<ul>
<li><code>dig @8.8.8.8 jvns.ca</code> queries Google&rsquo;s public DNS server (<code>8.8.8.8</code>) for <code>jvns.ca</code>.</li>
<li><code>dig ns jvns.ca</code> makes an query with type <code>NS</code> for <code>jvns.ca</code></li>
</ul>

<h3 id="x-make-a-reverse-dns-query"><code>-x</code>: make a reverse DNS query</h3>

<p>One other query option I use occasionally is <code>-x</code>, to make a reverse DNS query. Here&rsquo;s what the output looks like.</p>

<pre><code>$ dig -x 172.217.13.174
174.13.217.172.in-addr.arpa. 72888 IN	PTR	yul03s04-in-f14.1e100.net.
</code></pre>

<p><code>-x</code> isn&rsquo;t magic &ndash; <code>dig -x 172.217.13.174</code> just makes a <code>PTR</code> query for
<code>174.13.217.172.in-addr.arpa.</code>. Here&rsquo;s how to make exact the same reverse DNS query
without using <code>-x</code>.</p>

<pre><code>$ dig ptr 174.13.217.172.in-addr.arpa.
174.13.217.172.in-addr.arpa. 72888 IN	PTR	yul03s04-in-f14.1e100.net.
</code></pre>

<p>I always use <code>-x</code> though because it&rsquo;s less typing.</p>

<h3 id="options-for-formatting-the-response">options for formatting the response</h3>

<p>Now, let&rsquo;s talk about arguments you can use to format the response.</p>

<p>I&rsquo;ve found that the way <code>dig</code> formats DNS responses by default is pretty
overwhelming to beginners. Here&rsquo;s what the output looks like:</p>

<pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.20 &lt;&lt;&gt;&gt; -r jvns.ca
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 28629
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: d87fc3022c0604d60100000061ab74857110b908b274494d (good)
;; QUESTION SECTION:
;jvns.ca.			IN	A

;; ANSWER SECTION:
jvns.ca.		276	IN	A	172.64.80.1

;; Query time: 9 msec
;; SERVER: 192.168.1.1#53(192.168.1.1)
;; WHEN: Sat Dec 04 09:00:37 EST 2021
;; MSG SIZE  rcvd: 80
</code></pre>

<p>If you&rsquo;re not used to reading this, it might take you a while to sift through it and find the IP address you&rsquo;re looking for.
And most of the time, you&rsquo;re only interested in one line of this response (<code>jvns.ca.        180 IN  A   172.64.80.1</code>).</p>

<p>Here are my 2 favourite ways to make dig&rsquo;s output more manageable.</p>

<p><strong>way 1: +noall +answer</strong></p>

<p>This tells dig to just print what&rsquo;s in the &ldquo;Answer&rdquo; section of the DNS response. Here&rsquo;s an example of querying for the <code>NS</code> records for <code>google.com</code>.</p>

<pre><code>$ dig +noall +answer ns google.com
google.com.		158564	IN	NS	ns4.google.com.
google.com.		158564	IN	NS	ns1.google.com.
google.com.		158564	IN	NS	ns2.google.com.
google.com.		158564	IN	NS	ns3.google.com.
</code></pre>

<p>The format here is:</p>

<pre><code>NAME         TTL            TYPE   CONTENT
google.com   158564   IN    NS     ns3.google.com.
</code></pre>

<p>By the way: if you&rsquo;ve ever wondered what <code>IN</code> means, it&rsquo;s the &ldquo;query class&rdquo; and
stands for &ldquo;internet&rdquo;. It&rsquo;s basically just a relic from the 80s and 90s when
there were other networks competing with the internet like &ldquo;chaosnet&rdquo;.</p>

<p><strong>way 2: +short</strong></p>

<p>This is like <code>dig +noall +answer</code>, but even shorter &ndash; it just shows the
content of each record. For example:</p>

<pre><code>$ dig +short ns google.com
ns2.google.com.
ns1.google.com.
ns4.google.com.
ns3.google.com.
</code></pre>

<h3 id="you-can-put-formatting-options-in-digrc">you can put formatting options in <code>digrc</code></h3>

<p>If you don&rsquo;t like dig&rsquo;s default format (I don&rsquo;t!), you can tell it
to use a different format by default by creating a <code>.digrc</code> file in your home
directory.</p>

<p>I really like the <code>+noall +answer</code> format, so I put <code>+noall +answer</code> in my
<code>~/.digrc</code>. Here&rsquo;s what it looks like for me when I run <code>dig jvns.ca</code> using that
configuration file.</p>

<pre><code>$ dig jvns.ca
jvns.ca.		255	IN	A	172.64.80.1
</code></pre>

<p>So much easier to read!</p>

<p>And if I want to go back to the long format with all of the output (which I
do sometimes, usually because I want to look at the records in the Authority
section of the response), I can get a long answer again by running:</p>

<pre><code>$ dig +all jvns.ca
</code></pre>

<h3 id="dig-trace">dig +trace</h3>

<p>The last dig option that I use is <code>+trace</code>. <code>dig +trace</code>  mimics what a DNS
resolver does when it looks up a domain &ndash; it starts at the root nameservers,
and then queries the next level of nameservers (like <code>.com</code>), and so on until it reaches the authoritative nameserver for the domain.
So it&rsquo;ll make about 20 DNS queries.</p>

<p>I find this mostly useful for understanding how DNS works though, I don&rsquo;t think
that I&rsquo;ve used it to solve a problem.</p>

<h3 id="that-s-all">that&rsquo;s all!</h3>

<p>I only learned about <code>.digrc</code> recently and I love using it so much, so I hope
it helps some of you spend less time sorting though dig output!</p>

<p>Someone on Twitter pointed out that it would be nice if there were a way to
tell dig to show a short version of the response which also included the
response&rsquo;s status (like <code>NOERROR</code>, <code>NXDOMAIN</code>, <code>SERVFAIL</code>, etc), and I agree! I
couldn&rsquo;t find an option in the man page that does that though.</p>

  </body>
</html>
