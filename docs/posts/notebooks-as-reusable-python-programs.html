<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://marimo.io/blog/python-not-json">Original</a>
    <h1>Notebooks as reusable Python programs</h1>
    
    <div id="readability-page-1" class="page"><div><div><p><em>marimo is free and open source, available on
<a target="_blank" href="https://github.com/marimo-team/marimo">GitHub</a>. This blog post is also
accompanied by a <a target="_blank" href="https://www.youtube.com/watch?v=skuIWdeqMF0">YouTube video</a>.</em></p>
<p>In a previous post, on <a target="_blank" href="https://marimo.io/blog/lessons-learned">lessons learned redesigning the Python
notebook</a>, we wrote:</p>
<blockquote>
<p>A lot of important work happens in notebooks — research, large scale
experimentation, data engineering, and more. <strong>But this kind of work should be
treated as Python software, and it shouldn’t be done in error-prone JSON
scratchpads.</strong></p>
</blockquote>
<p>In that post we described design decisions that allowed us to create a new
kind of notebook (<a target="_blank" href="https://github.com/marimo-team/marimo">marimo</a>), one that
blended the best parts of interactive computing with the maintainability,
reusability, and interoperability of software. Part of our solution was to
represent notebooks as Python programs — not just as flat scripts, but as
reusable modules.</p>
<p>In this post, we dive deep into our representation of notebooks as Python
files — showing how our file format makes notebooks versionable with Git,
importable as modules, testable with pytest, executable as scripts, and much,
more, while still being compatible with other languages like SQL and Markdown.
We also discussing how we design around tradeoffs, such as keeping a record of
visual outputs.</p>

<h2 id="the-status-quo-is-not-working"><a target="_blank" aria-label="Link to section" href="#the-status-quo-is-not-working"><span></span></a>The status quo is not working</h2>
<p>AI developers, data engineers, data scientists, and researchers do <em>a lot</em> of
their work in Python notebooks like Jupyter. We know this from first-hand
experience; we’ve worked as engineers at Google Brain and
Palantir, and lived in notebooks, for better or worse, during PhDs at
Stanford and Johns Hopkins.</p>
<p>Traditional notebooks’ usefulness is severely limited by the JSON-based
<code>ipynb</code> file format (<a target="_blank" href="https://marimo.io/blog/slac-marimo">among other things</a>).
This file format combines code and outputs in what Pydantic creator Samuel
Colvin calls a <a target="_blank" href="https://github.com/samuelcolvin/notbook">“horrid blob”</a>, and is
directly responsible for the following sad state of affairs:</p>
<ul>
<li>small edits to code yield enormous Git diffs;</li>
<li>code is copy-pasted across notebooks, instead of reused;</li>
<li>magic commands limit the portability of notebook code;</li>
<li>logic that would be useful as a script or library gets thrown away;</li>
<li>logic that should be tested almost never is.</li>
</ul>
<details><summary>What about Jupytext or Databricks source notebooks?</summary><p>While it’s true that you can get
cleaner diffs by using Jupytext (if you’re sufficiently motivated) or
Databricks source notebooks (if you’re a paying customer), naively storing
notebooks as flat Python scripts like these tools do won’t solve the other
problems enumerated above. In particular, importing a Jupytext-processed or
Databricks source-format notebook as a module will also run all its cells — a
potentially very expensive side-effect if all you wanted was to import a
function or class.</p></details>
<details><summary>What about nbdev?</summary><p>nbdev is a framework that lets developers “write, test, document, and distribute software packages and technical articles” using Jupyter notebooks, a goal that we
consider orthogonal to our goal of making a new kind of Python notebook that is
a simple software artifact, just like any other Python file. We are not interested
in replacing traditional software development with notebooks.</p></details>
<p>When working with Jupyter, too often you end up with
directories strewn with spaghetti-code notebooks, counting up to
<a target="_blank" href="https://www.youtube.com/watch?v=yXGCKqo5cEY">Untitled12.ipynb</a> or higher. You
the notebook author don’t know what’s in these notebooks, you don’t understand
their Git history, you don’t know what packages were used in each notebook, you
haven’t tested anything because how do you even test notebooks, and you’re
unsure if you — let alone your colleagues — will be able to run them in the
future.</p>
<figure><a href="https://www.youtube.com/watch?v=7jiPeIFXb6U" target="_blank" rel="noopener noreferrer"><img src="https://marimo.io/images/blog/24/idontlikenotebooks.png"/></a><figcaption>Joel Grus <a target="_blank" href="https://www.youtube.com/watch?v=7jiPeIFXb6U">doesn’t like notebooks</a> for these and other reasons; <a target="_blank" href="https://github.com/marimo-team/marimo">marimo</a> largely solves most of Joel’s complaints, while keeping the best parts of notebooks intact.</figcaption></figure>
<p>Despite these problems (and others — by one study, <a target="_blank" href="https://leomurta.github.io/papers/pimentel2019a.pdf">less than four
percent</a> of Jupyter
notebooks on GitHub are reproducible), people continue using traditional
notebooks for production tasks like pipelines (e.g., Databricks
workflows), as well as areas where reproducibility is paramount, like AI
development and science.</p>
<figure><a href="https://x.com/sh_reya/status/1738361345362555259" target="_blank" rel="noopener noreferrer"><img src="https://marimo.io/images/blog/24/shreya_git.png"/></a><figcaption>Small changes to Jupyter notebooks yield enormous, unintelligible Git diffs. </figcaption></figure>
<p>Why? Because, until recently, Jupyter notebooks were the only
programming environment that let you see your data <em>while</em> you worked on it.
Interactivity is so crucial to data work that hundreds of thousands of data
professionals decided the trade-offs were worth it.</p>
<p>Instead of accepting this sad state of affairs, or trying to work around it
with clunky extensions or complicated frameworks, we decided it was worth it to
reinvent notebooks as regular Python programs — we wanted to make something
that <em>just worked</em>. It was from this belief that the marimo notebook was born.</p>
<h2 id="python-not-json-a-new-plaintext-file-format"><a target="_blank" aria-label="Link to section" href="#python-not-json-a-new-plaintext-file-format"><span></span></a>Python, not JSON: a new plaintext file format</h2>
<p>marimo stores notebooks as plaintext Python files (e.g. <code>notebook.py</code>) with the
following properties:</p>
<ol>
<li>Git-friendly: small code change =&gt; small diff</li>
<li>easy for both humans and computers to read</li>
<li>importable as a Python module, without executing notebook cells</li>
<li>executable as a Python script</li>
<li>editable with a text editor</li>
</ol>
<p>After <a target="_blank" href="https://github.com/marimo-team/meps/blob/main/mep-0001.md">a <em>lot</em> of careful
consideration</a>, we landed
on files that look like this:</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="python" data-theme="one-dark-pro"><code data-line-numbers="" data-language="python" data-theme="one-dark-pro" data-line-numbers-max-digits="2"><span data-line=""><span>import</span><span> marimo</span></span>
<span data-line=""> </span>
<span data-line=""><span>__generated_with </span><span>=</span><span> &#34;0.11.17&#34;</span></span>
<span data-line=""><span>app </span><span>=</span><span> marimo.</span><span>App</span><span>()</span></span>
<span data-line=""> </span>
<span data-line=""><span>@app</span><span>.</span><span>cell</span></span>
<span data-line=""><span>def</span><span> defines_x</span><span>() -&gt; </span><span>int</span><span>:</span></span>
<span data-line=""><span>    x </span><span>=</span><span> 0</span></span>
<span data-line=""><span>    return</span><span> x,</span></span>
<span data-line=""> </span>
<span data-line=""><span>@app</span><span>.</span><span>cell</span></span>
<span data-line=""><span>def</span><span> defines_y</span><span>(</span><span>x</span><span>):</span></span>
<span data-line=""><span>    y </span><span>=</span><span> x </span><span>+</span><span> 1</span></span>
<span data-line=""><span>    y</span></span>
<span data-line=""><span>    return</span><span> y,</span></span>
<span data-line=""> </span>
<span data-line=""><span>@app</span><span>.</span><span>function</span></span>
<span data-line=""><span>def</span><span> add_one</span><span>(</span><span>arg</span><span>):</span></span>
<span data-line=""><span>  return</span><span> arg </span><span>+</span><span> 1</span></span>
<span data-line=""> </span>
<span data-line=""><span>@app</span><span>.</span><span>cell</span></span>
<span data-line=""><span>def</span><span> computes_z</span><span>(</span><span>x</span><span>, </span><span>y</span><span>):</span></span>
<span data-line=""><span>    z </span><span>=</span><span> add_one</span><span>(x </span><span>+</span><span> y)</span></span>
<span data-line=""><span>    z</span></span>
<span data-line=""><span>    return</span><span> z,</span></span>
<span data-line=""> </span>
<span data-line=""><span>if</span><span> __name__</span><span> ==</span><span> &#34;__main__&#34;</span><span>:</span></span>
<span data-line=""><span>    app.</span><span>run</span><span>()</span></span></code></pre></div></figure>
<p>This file format encodes how data flows across the notebook: as we explained in
<a target="_blank" href="https://marimo.io/blog/lessons-learned">our previous post</a>, marimo represents
notebooks as dataflow graphs to improve reproducibility (eliminating hidden
state) and enable seamless interactivity with UI elements.</p>
<h3 id="anatomy-of-a-notebook-file"><a target="_blank" aria-label="Link to section" href="#anatomy-of-a-notebook-file"><span></span></a>Anatomy of a notebook file</h3>
<p>marimo automatically generates notebook files on save from the marimo editor,
but developers can also create or edit these files in their text editor of
choice (ours are neovim and Cursor).</p>
<p><strong>Header.</strong> The notebook file starts with a header that imports marimo, notes
the version of marimo that created the file, and instantiates an <code>App</code> object
to which cells are added.</p>
<p><strong>Cells.</strong> Cells are stored in notebook presentation order. Each cell is
serialized as a function that accepts its variable references and return its
definitions; cells are added to the notebook via the <code>app.cell</code> decorator.
Users can optionally name their cells, which become the names of the decorated
functions.</p>
<p>This serialization strategy departs from Jupytext-style (or Databricks-style)
flat scripts, which demarcate cells with comments instead of wrapping them in
functions. Importing Jupytext or Databricks notebook files runs all their
cells, which is expensive and almost never what you want. In contrast, in our
file format, cells are not executed on import because they are wrapped in
functions.</p>
<p><strong>Functions and classes.</strong> <em>This part of our notebook specification is slated
for release in version 0.12.0.</em> Cells that define top-level functions or
classes are serialized directly in the file, so they can be reused by other
Python modules (<code>from my_notebook import my_function</code>). An optional top-level
setup cell, not shown here, can make symbols available to these functions, such
as imported modules and constants.</p>
<p><strong>Footer.</strong> An <code>if __name__ == &#34;__main__&#34;</code> guard protects a call to <code>app.run()</code>,
which executes the notebook’s cells in a topologically sorted order.</p>
<h3 id="examples"><a target="_blank" aria-label="Link to section" href="#examples"><span></span></a>Examples</h3>
<p>Our simple file format makes it possible to treat notebooks like any other
Python program. Here are some examples of what our file format enables:</p>

<h4 id="version-with-git"><a target="_blank" aria-label="Link to section" href="#version-with-git"><span></span></a>Version with Git</h4>
<p>Small changes to notebook code are guaranteed to make small localized changes
to the notebook file, yielding easy-to-read Git diffs. For example, consider
a <strong>one character change</strong>, modifying</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="python" data-theme="one-dark-pro"><code data-language="python" data-theme="one-dark-pro"><span data-line=""><span>plt.</span><span>plot</span><span>(x, x</span><span>**</span><span>2</span><span>)</span></span></code></pre></div></figure>
<p>to</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="python" data-theme="one-dark-pro"><code data-language="python" data-theme="one-dark-pro"><span data-line=""><span>plt.</span><span>plot</span><span>(x, x</span><span>**</span><span>3</span><span>).</span></span></code></pre></div></figure>
<p><strong>marimo notebook diff.</strong> Here’s the Git diff for a marimo notebook file:</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="diff" data-theme="one-dark-pro"><code data-language="diff" data-theme="one-dark-pro"><span data-line=""><span> @app.cell</span></span>
<span data-line=""><span> def _(plt, x):</span></span>
<span data-line=""><span>-    plt.plot(x, x**2)</span></span>
<span data-line=""><span>+    plt.plot(x, x**3)</span></span>
<span data-line=""><span>     return</span></span></code></pre></div></figure>
<p>It corresponds exactly to the code change, with the notebook file changed in
just one place.</p>
<p><strong>Jupyter notebook diff.</strong> In contrast, because ipynb files stores
base64-encoded blobs of outputs, the diff for the equivalent Jupyter notebook
contains <strong>42,571 characters</strong>. Moreover, the notebook contains many changes
unrelated to the actual single character code change. Here is an abbreviated
version of the diff, with truncated blobs.</p>
<details><summary>Expand to see the diff (it’s long!)</summary><div><figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="diff" data-theme="one-dark-pro"><code data-language="diff" data-theme="one-dark-pro"><span data-line=""><span>diff --git a/Untitled.ipynb b/Untitled.ipynb</span></span>
<span data-line=""><span>index 0a76b5f..74b0c08 100644</span></span>
<span data-line=""><span>--- a/Untitled.ipynb</span></span>
<span data-line=""><span>+++ b/Untitled.ipynb</span></span>
<span data-line=""><span>@@ -21,7 +21,7 @@</span></span>
<span data-line=""><span>   },</span></span>
<span data-line=""><span>   {</span></span>
<span data-line=""><span>    &#34;cell_type&#34;: &#34;code&#34;,</span></span>
<span data-line=""><span>-   &#34;execution_count&#34;: 3,</span></span>
<span data-line=""><span>+   &#34;execution_count&#34;: 2,</span></span>
<span data-line=""><span>    &#34;id&#34;: &#34;aa37467f&#34;,</span></span>
<span data-line=""><span>    &#34;metadata&#34;: {},</span></span>
<span data-line=""><span>    &#34;outputs&#34;: [],</span></span>
<span data-line=""><span>@@ -32,7 +32,7 @@</span></span>
<span data-line=""><span>   },</span></span>
<span data-line=""><span>   {</span></span>
<span data-line=""><span>    &#34;cell_type&#34;: &#34;code&#34;,</span></span>
<span data-line=""><span>-   &#34;execution_count&#34;: 4,</span></span>
<span data-line=""><span>+   &#34;execution_count&#34;: 3,</span></span>
<span data-line=""><span>    &#34;id&#34;: &#34;af67d5ab-f313-4b9a-bc44-1c6494b3c2e6&#34;,</span></span>
<span data-line=""><span>    &#34;metadata&#34;: {},</span></span>
<span data-line=""><span>    &#34;outputs&#34;: [],</span></span>
<span data-line=""><span>@@ -42,23 +42,23 @@</span></span>
<span data-line=""><span>   },</span></span>
<span data-line=""><span>   {</span></span>
<span data-line=""><span>    &#34;cell_type&#34;: &#34;code&#34;,</span></span>
<span data-line=""><span>-   &#34;execution_count&#34;: 5,</span></span>
<span data-line=""><span>+   &#34;execution_count&#34;: 4,</span></span>
<span data-line=""><span>    &#34;id&#34;: &#34;fa18649a-45b7-47fe-bfea-8c1f2a3226af&#34;,</span></span>
<span data-line=""><span>    &#34;metadata&#34;: {},</span></span>
<span data-line=""><span>    &#34;outputs&#34;: [</span></span>
<span data-line=""><span>     {</span></span>
<span data-line=""><span>      &#34;data&#34;: {</span></span>
<span data-line=""><span>       &#34;text/plain&#34;: [</span></span>
<span data-line=""><span>-       &#34;[&lt;matplotlib.lines.Line2D at 0x106d57c80&gt;]&#34;</span></span>
<span data-line=""><span>+       &#34;[&lt;matplotlib.lines.Line2D at 0x107e43560&gt;]&#34;</span></span>
<span data-line=""><span>       ]</span></span>
<span data-line=""><span>      },</span></span>
<span data-line=""><span>-     &#34;execution_count&#34;: 5,</span></span>
<span data-line=""><span>+     &#34;execution_count&#34;: 4,</span></span>
<span data-line=""><span>      &#34;metadata&#34;: {},</span></span>
<span data-line=""><span>      &#34;output_type&#34;: &#34;execute_result&#34;</span></span>
<span data-line=""><span>     },</span></span>
<span data-line=""><span>     {</span></span>
<span data-line=""><span>      &#34;data&#34;: {</span></span>
<span data-line=""><span>-      &#34;image/png&#34;: &#34;iVBORw0KGg&lt;Escape&gt;oAAAANSUhEUgAAAh8AAAGdCAYAAACyzRGfAAAAOnRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjEwLjEsIGh0dHBzOi8vbWF0cGxvdGxpYi5vcmcvc2/+5QAAAAlwSFlzAAAPYQAAD2EBqD+naQAAPT9JREFUeJzt3QlYVXX...,</span></span>
<span data-line=""><span>+      &#34;image/png&#34;: &#34;iVBORw0KGgoAAAANSUhEUgAAAigAAAGdCAYAAAA44ojeAAAAOnRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjEwLjEsIGh0dHBzOi8vbWF0cGxvdGxpYi5vcmcvc2/+5QAAAAlwSFlzAAAPYQAAD2EBqD+naQAAOqpJREFUeJzt3Ql4lNXd/vE7e0gg...</span></span>
<span data-line=""><span>       &#34;text/plain&#34;: [</span></span>
<span data-line=""><span>        &#34;&lt;Figure size 640x480 with 1 Axes&gt;&#34;</span></span>
<span data-line=""><span>       ]</span></span>
<span data-line=""><span>@@ -68,7 +68,7 @@</span></span>
<span data-line=""><span>     }</span></span>
<span data-line=""><span>    ],</span></span>
<span data-line=""><span>    &#34;source&#34;: [</span></span>
<span data-line=""><span>-    &#34;plt.plot(x, x**2)&#34;</span></span>
<span data-line=""><span>+    &#34;plt.plot(x, x**3)&#34;</span></span>
<span data-line=""><span>    ]</span></span>
<span data-line=""><span>   }</span></span>
<span data-line=""><span>  ],</span></span></code></pre></div></figure></div></details>
<p>Not only are these diffs impossible to read for an individual, they also make
resolving merge conflicts very difficult.</p>
<h4 id="test-with-pytest"><a target="_blank" aria-label="Link to section" href="#test-with-pytest"><span></span></a>Test with pytest</h4>
<p>Because marimo notebooks are just Python files, they are interoperable
with other tools for Python — <a target="_blank" href="https://docs.marimo.io/guides/testing/pytest/">including
pytest</a>. In contrast, there is
no standard way to test code in Jupyter notebooks, which is part of the reason
why so many traditional notebooks fall over from incorrectness.</p>
<p><strong>Testing cells.</strong> Any cell named as <code>test_*</code> is automatically discoverable
and testable by <code>pytest</code>. The same goes for any cell that contains only <code>test_</code>
functions and <code>Test</code> classes.</p>
<p>Importantly, because cells are wrapped in functions, running <code>pytest test_notebook.py</code>
doesn’t execute the entire notebook — just its tests.</p>
<p><strong>Example.</strong> Consider running <code>pytest</code> on the following code:</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="python" data-theme="one-dark-pro"><code data-language="python" data-theme="one-dark-pro"><span data-line=""><span>import</span><span> marimo</span></span>
<span data-line=""> </span>
<span data-line=""><span>__generated_with </span><span>=</span><span> &#34;0.11.17&#34;</span></span>
<span data-line=""><span>app </span><span>=</span><span> marimo.</span><span>App</span><span>()</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span>@app</span><span>.</span><span>cell</span></span>
<span data-line=""><span>def</span><span> _</span><span>():</span></span>
<span data-line=""><span>    def</span><span> inc</span><span>(</span><span>x</span><span>):</span></span>
<span data-line=""><span>        return</span><span> x </span><span>+</span><span> 1</span></span>
<span data-line=""><span>    return</span><span> (inc,)</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span>@app</span><span>.</span><span>cell</span></span>
<span data-line=""><span>def</span><span> test_fails</span><span>(</span><span>inc</span><span>):</span></span>
<span data-line=""><span>    assert</span><span> inc</span><span>(</span><span>3</span><span>) </span><span>==</span><span> 5</span><span>, </span><span>&#34;This test fails&#34;</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span>@app</span><span>.</span><span>cell</span></span>
<span data-line=""><span>def</span><span> test_sanity</span><span>(</span><span>inc</span><span>):</span></span>
<span data-line=""><span>    assert</span><span> inc</span><span>(</span><span>3</span><span>) </span><span>==</span><span> 4</span><span>, </span><span>&#34;This test passes&#34;</span></span>
<span data-line=""> </span>
<span data-line=""><span>@app</span><span>.</span><span>cell</span></span>
<span data-line=""><span>def</span><span> collection_of_tests</span><span>(</span><span>inc</span><span>, </span><span>pytest</span><span>):</span></span>
<span data-line=""><span>    @pytest</span><span>.</span><span>mark</span><span>.</span><span>parametrize</span><span>(</span><span>&#34;input, expected&#34;</span><span>,</span><span> [(</span><span>3</span><span>,</span><span> 4</span><span>),</span><span> (</span><span>4</span><span>,</span><span> 5</span><span>)])</span></span>
<span data-line=""><span>    def</span><span> test_answer</span><span>(</span><span>x</span><span>, </span><span>y</span><span>):</span></span>
<span data-line=""><span>        assert</span><span> inc</span><span>(x) </span><span>==</span><span> y, </span><span>&#34;These tests should pass.&#34;</span></span>
<span data-line=""> </span>
<span data-line=""><span>@app</span><span>.</span><span>cell</span></span>
<span data-line=""><span>def</span><span> imports</span><span>():</span></span>
<span data-line=""><span>    import</span><span> pytest</span></span>
<span data-line=""><span>    return</span><span> pytest</span></span></code></pre></div></figure>
<p>This prints:</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="bash" data-theme="one-dark-pro"><code data-language="bash" data-theme="one-dark-pro"><span data-line=""><span>============================= </span><span>test session starts ==============================</span></span>
<span data-line=""><span>platform</span><span> linux -- Python </span><span>3.11</span><span>.10, pytest-8.3.4, pluggy-1.5.0</span></span>
<span data-line=""><span>rootdir:</span><span> /notebooks</span></span>
<span data-line=""><span>configfile:</span><span> pyproject.toml</span></span>
<span data-line=""><span>collected</span><span> 4</span><span> items</span></span>
<span data-line=""> </span>
<span data-line=""><span>test_notebook.py::test_fails</span><span> FAILED                                       [ </span><span>25</span><span>%]</span></span>
<span data-line=""><span>test_notebook.py::test_sanity</span><span> PASSED                                      [ </span><span>50</span><span>%]</span></span>
<span data-line=""><span>test_notebook.py::MarimoTestBlock_0::test_parameterized[3-4]</span><span> PASSED       [ </span><span>75</span><span>%]</span></span>
<span data-line=""><span>test_notebook.py::MarimoTestBlock_0::test_parameterized[4-5]</span><span> PASSED       [</span><span>100</span><span>%]</span></span>
<span data-line=""> </span>
<span data-line=""><span>=================================== </span><span>FAILURES ===================================</span></span>
<span data-line=""><span>__________________________________</span><span> test_fails __________________________________</span></span>
<span data-line=""> </span>
<span data-line=""><span>    @app.cell</span></span>
<span data-line=""><span>    def</span><span> test_fails</span><span>(</span><span>inc</span><span>)</span><span>:</span></span>
<span data-line=""><span>&gt;       assert inc(</span><span>3</span><span>) == 5, </span><span>&#34;This test fails&#34;</span></span>
<span data-line=""><span>E</span><span>       AssertionError: This test fails</span></span>
<span data-line=""><span>E</span><span>       assert </span><span>4</span><span> == </span><span>5</span></span>
<span data-line=""><span>E</span><span>        +  where </span><span>4</span><span> = </span><span>&lt;</span><span>function in</span><span>c</span><span>&gt;(</span><span>3</span><span>)</span></span>
<span data-line=""> </span>
<span data-line=""><span>test_notebook.py:17:</span><span> AssertionError</span></span>
<span data-line=""><span>=========================== </span><span>short test summary info ============================</span></span>
<span data-line=""><span>FAILED</span><span> test_notebook.py::test_fails - AssertionError: This test fails</span></span>
<span data-line=""><span>assert</span><span> 4</span><span> == </span><span>5</span></span>
<span data-line=""><span> +</span><span>  where </span><span>4</span><span> = </span><span>&lt;</span><span>function in</span><span>c</span><span>&gt;(</span><span>3</span><span>)</span></span>
<span data-line=""><span>========================= </span><span>1</span><span> failed, </span><span>3</span><span> passed in </span><span>0.65</span><span>s ==========================</span></span></code></pre></div></figure>
<h4 id="test-with-doctests"><a target="_blank" aria-label="Link to section" href="#test-with-doctests"><span></span></a>Test with doctests</h4>
<p>marimo also supports <a target="_blank" href="https://docs.python.org/3/library/doctest.html">doctest</a>
out of the box: just call <code>doctest.testmod()</code> in your notebook, in a cell that
references the functions you’d like to test.</p>
<p>This can be especially helpful when defining and documenting functions in
marimo notebooks that will be used elsewhere.</p>

<h4 id="reuse-functions-and-classes-in-other-python-files"><a target="_blank" aria-label="Link to section" href="#reuse-functions-and-classes-in-other-python-files"><span></span></a>Reuse functions and classes in other Python files</h4>
<p><em>Coming soon, in version 0.12.0.</em></p>
<p>Our file format also makes it easy and natural to reuse functions and classes
defined in your notebook; just import them like you would from a regular notebook
file:</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="python" data-theme="one-dark-pro"><code data-language="python" data-theme="one-dark-pro"><span data-line=""><span>from</span><span> my_notebook </span><span>import</span><span> my_function, my_class</span></span></code></pre></div></figure>
<p>This works for cells that have just a single function definition or class
definition. Additionally, the functions and classes must have no other
references other than imported modules or other symbols that you the notebook
author define in a special setup cell (functions and classes can also refer to
other top-level functions).</p>
<p>For example, the below notebook contains a setup cell that imports <code>numpy</code>, and
a cell that defines a function that uses <code>numpy</code>. Unlike other cells, the setup
cell’s body is at the top-level of the file (it’s not wrapped in a
function), so its variables are made available to the notebook’s functions.</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="python" data-theme="one-dark-pro"><code data-language="python" data-theme="one-dark-pro"><span data-line=""><span>import</span><span> marimo</span></span>
<span data-line=""> </span>
<span data-line=""><span>__generated_with </span><span>=</span><span> &#34;0.11.17&#34;</span></span>
<span data-line=""><span>app </span><span>=</span><span> marimo.</span><span>App</span><span>()</span></span>
<span data-line=""> </span>
<span data-line=""><span>with</span><span> app.setup:</span></span>
<span data-line=""><span>  import</span><span> numpy </span><span>as</span><span> np</span></span>
<span data-line=""> </span>
<span data-line=""><span>@app</span><span>.</span><span>function</span></span>
<span data-line=""><span>def</span><span> my_function</span><span>(</span><span>x</span><span>: np.ndarray):</span></span>
<span data-line=""><span>  return</span><span> np.</span><span>mean</span><span>(x)</span></span></code></pre></div></figure>
<p>You can define the setup cell by simply editing the notebook file in a text editor,
or through the marimo editor.</p>
<h4 id="reuse-cells-and-notebooks-in-other-notebooks"><a target="_blank" aria-label="Link to section" href="#reuse-cells-and-notebooks-in-other-notebooks"><span></span></a>Reuse cells and notebooks in other notebooks</h4>
<p><strong>Cells.</strong> Named cells can be used in other notebooks:</p>
<ul>
<li>Import a cell with <code>from my_notebook import my_cell</code></li>
<li>Run it with <code>defs, output = my_cell.run()</code>, which runs the cell and its ancestors.</li>
</ul>
<p>Here, <code>defs</code> is a dictionary containing the variables the cell defines, and <code>output</code>
the value of the cell’s last expression (i.e., its visual output).</p>
<p>By default, running a cell in this way will also run its ancestors. The <code>run</code>
method can be parametrized to override the values of its references and
prevent ancestor execution. (This API was inspired by Observable notebooks.)
See <a target="_blank" href="https://docs.marimo.io/api/cell/#marimo.Cell.run">our docs</a> for an
example.</p>
<p><strong>Notebooks.</strong> Entire notebooks can be embedded in other notebooks:</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="python" data-theme="one-dark-pro"><code data-language="python" data-theme="one-dark-pro"><span data-line=""><span>from</span><span> my_notebook </span><span>import</span><span> app</span></span></code></pre></div></figure>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="python" data-theme="one-dark-pro"><code data-language="python" data-theme="one-dark-pro"><span data-line=""><span>result </span><span>=</span><span> await</span><span> app.</span><span>embed</span><span>()</span></span>
<span data-line=""><span>result.output</span></span></code></pre></div></figure>
<p>This lets you reuse the user interface of a marimo notebook as a component
(since marimo makes it easy for notebooks to be rendered as <a target="_blank" href="https://docs.marimo.io/guides/interactivity/">interactive web
apps</a>). <a target="_blank" href="https://docs.marimo.io/api/app/#marimo.App.embed">Our
docs</a> include a usage
example.</p>
<h4 id="run-as-python-scripts"><a target="_blank" aria-label="Link to section" href="#run-as-python-scripts"><span></span></a>Run as Python scripts</h4>
<p>Every marimo notebook can be <a target="_blank" href="https://docs.marimo.io/guides/scripts/">run as a script</a>;</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="bash" data-theme="one-dark-pro"><code data-language="bash" data-theme="one-dark-pro"><span data-line=""><span>python</span><span> my_notebook.py</span></span></code></pre></div></figure>
<p>This runs the notebook cells in a topologically sorted order. You can also
pass command-line arguments to your notebook, which can be read with the library
function <a target="_blank" href="https://docs.marimo.io/api/cli_args/"><code>marimo.cli_args()</code></a>:</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="bash" data-theme="one-dark-pro"><code data-language="bash" data-theme="one-dark-pro"><span data-line=""><span>python</span><span> my_notebook.py -- -x=</span><span>1</span></span></code></pre></div></figure>
<p>Since marimo notebooks are just Python, you can also use <code>argparse</code>
to declare and parse arguments. And, since marimo does not support magic
commands (<a target="_blank" href="https://docs.marimo.io/guides/coming_from/jupyter/#converting-jupyter-notebooks-to-marimo-notebooks">we don’t need
them</a>),
your notebook is guaranteed to work as as script.</p>
<h4 id="script-metadata-for-packaging-and-configuration"><a target="_blank" aria-label="Link to section" href="#script-metadata-for-packaging-and-configuration"><span></span></a>Script metadata for packaging and configuration</h4>
<p>Thanks to <a target="_blank" href="https://peps.python.org/pep-0723/">PEP 723</a>, there is now an
<a target="_blank" href="https://packaging.python.org/en/latest/specifications/inline-script-metadata/#inline-script-metadata">agreed-upon Python
specification</a>
for storing metadata in single-file Python scripts. This metadata is similar to
a pyproject.toml and stored as a header comment, such as:</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="bash" data-theme="one-dark-pro"><code data-language="bash" data-theme="one-dark-pro"><span data-line=""><span># /// script</span></span>
<span data-line=""><span># requires-python = &#34;&gt;=3.11&#34;</span></span>
<span data-line=""><span># dependencies = [</span></span>
<span data-line=""><span>#   &#34;requests&lt;3&#34;,</span></span>
<span data-line=""><span>#   &#34;rich&#34;,</span></span>
<span data-line=""><span># ]</span></span>
<span data-line=""><span># ///</span></span></code></pre></div></figure>
<p>Because marimo notebooks are just Python files, we can use this spec to
communicate metadata to other tools in the Python ecosystem.</p>
<p><strong>Package requirements.</strong> For reproducibility, marimo users can document their
notebook’s dependencies in script metadata. When given a notebook with inline
dependencies, marimo uses <a target="_blank" href="https://github.com/astral-sh/uv"><code>uv</code></a> to run it in
an isolated virtual environment. marimo can even <a target="_blank" href="https://docs.marimo.io/guides/package_reproducibility/">automatically
maintain</a> this
dependency list on the user’s behalf.</p>
<p><strong>Configuration overrides.</strong> Users can use script metadata to easily <a target="_blank" href="https://docs.marimo.io/guides/configuration/#script-metadata-configuration">override
marimo configuration</a> on a per-notebook basis.</p>
<h4 id="embed-sql-and-markdown"><a target="_blank" aria-label="Link to section" href="#embed-sql-and-markdown"><span></span></a>Embed SQL and Markdown</h4>
<p>Even though marimo notebooks are stored as pure Python, other languages can be
used by embedding them in Python.</p>
<p>For example, marimo has native support for “<a target="_blank" href="https://docs.marimo.io/guides/working_with_data/sql/">SQL
cells</a>”, powered by
DuckDB or other databases. Though the marimo editor renders these cells as SQL,
under the hood they are represented as</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="python" data-theme="one-dark-pro"><code data-language="python" data-theme="one-dark-pro"><span data-line=""><span>@app</span><span>.</span><span>cell</span></span>
<span data-line=""><span>def</span><span> _</span><span>():</span></span>
<span data-line=""><span>  _df </span><span>=</span><span> mo.</span><span>sql</span><span>(</span><span>f</span><span>&#34;SELECT * FROM my_table&#34;</span><span>)</span></span></code></pre></div></figure>
<p>The marimo parser even statically analyzes SQL code to build a dataflow graph
jointly across Python and SQL.</p>
<p>Markdown is embedded in marimo notebooks in a similar way:</p>
<figure data-rehype-pretty-code-figure=""><div><pre tabindex="0" data-language="python" data-theme="one-dark-pro"><code data-language="python" data-theme="one-dark-pro"><span data-line=""><span>mo.</span><span>md</span><span>(</span><span>f</span><span>&#34;The result of your query is </span><span>{</span><span>mo.</span><span>as_html</span><span>(df)</span><span>}</span><span>&#34;</span><span>)</span></span></code></pre></div></figure>
<p>As you can see above, a benefit of embedding other languages in Python is that
it enables users to interpolate Python values into SQL and Markdown at runtime.</p>
<h4 id="edit-as-plaintext-files"><a target="_blank" aria-label="Link to section" href="#edit-as-plaintext-files"><span></span></a>Edit as plaintext files</h4>
<p>As a final example, our plaintext format makes it easy to edit marimo notebooks
in a <a target="_blank" href="https://docs.marimo.io/guides/editor_features/watching/">text editor of your
choice</a>; marimo will
pick up your changes and reflect them in the browser. The plaintext file format
also means you can lint and format notebook files using your preferred tools.</p>
<p>While you don’t need to maintain the cell arguments and returns, doing so can
help your IDE provide completions. We have changes queued up that will make
this feel like a first-class experience.</p>
<h3 id="output-storage"><a target="_blank" aria-label="Link to section" href="#output-storage"><span></span></a>Output storage</h3>
<p>Our file format has tradeoffs — in particular, storing as a Python file means
that notebook outputs are no longer serialized in the notebook file. We
accommodate output persistence in the following ways:</p>
<ul>
<li>Notebook outputs are cached in the <code>__marimo__</code> directory (similar to <code>__pycache__</code>);
on notebook startup, these outputs are matched with notebook cells, letting you
see where you left off.</li>
<li>Notebooks can be automatically snapshotted as IPython notebook files or HTML,
which are also saved to the <code>__marimo__</code> subdirectory.</li>
<li>An opt-in <a target="_blank" href="https://docs.marimo.io/guides/expensive_notebooks/#caching">caching mechanism</a> lets you pick up from where you left off (a topic large enough for a whole other blog post).</li>
<li>Lightweight notebooks can be opened in our WebAssembly playground using <a target="_blank" href="https://docs.marimo.io/guides/publishing/playground/#open-notebooks-hosted-on-github">our bookmarklet</a>.</li>
</ul>
<h2 id="it-just-works"><a target="_blank" aria-label="Link to section" href="#it-just-works"><span></span></a>It just works</h2>
<p>We regularly get feedback from users telling us how much they appreciate
marimo’s embrace of pure Python.</p>
<p>For example, one user at a large company told
us how marimo’s Python-first design means his notebooks are, for the first
time, actually reusable and reproducible software artifacts:</p>
<blockquote>
<p>My colleagues used to ask me what I did to reach certain conclusions … I would just send them my Jupyter notebook, but rarely did it ever actually run properly without issue, and it was always a mystery what specific order I ran the cells in to get them to work. <strong>I would end up just redoing a lot of the analysis in pure Python to replicate what was done, which was so inefficient. marimo has definitely solved that issue.</strong></p>
</blockquote>
<p>Others tell us they came for marimo’s interactivity, but stayed for the ability
to run notebooks as scripts. Conversely, others tell us they came for
git-versioning, or for the tight integration with <code>uv</code>, and stayed for
reactive execution or rich dataframes. Here’s a quote from a user that
speaks to this:</p>
<blockquote>
<p>I haven‘t touched Jupyter or Pandas for a while now and not regretting it.
My basic data stack is now uv, polars, marimo. <strong>One of my
favourite features is that the notebooks are pure Python files and integrate
uv script headers to make them out-of-the-box executable.</strong></p>
</blockquote>
<p>More generally, when we ask our users why they keep using marimo, we hear
quotes like this one:</p>
<blockquote>
<p>Well it just works!</p>
</blockquote>
<p><em>It just works</em>.</p>
<hr/>
<p>While marimo was originally developed <a target="_blank" href="https://marimo.io/blog/slac-marimo">with input from Stanford
scientists</a>, it is now used by developers
at dozens of companies across the world, including OpenAI, BlackRock, and
Moderna; it is also used by researchers and educators at Berkeley, Stanford,
NASA, CZI, and other institutions.</p>
<p><img alt="GitHub stars" src="https://marimo.io/images/blog/24/star-history-2025310.png"/></p>
<p>marimo is quickly establishing itself as a new standard for interactive
computing. The marimo package is downloaded hundreds of thousands of times a
month, and the marimo <a target="_blank" href="https://github.com/marimo-team/marimo">GitHub
repository</a> has over 11,000 stars, with
over 100 contributors.</p>
<p>Follow along with these links:</p>
<ul>
<li><span role="img" aria-label="" aria-hidden="true">⭐</span> Star us on GitHub: <a target="_blank" href="https://github.com/marimo-team/marimo">https://github.com/marimo-team/marimo</a></li>
<li><span role="img" aria-label="speech balloon">💬</span> Join us on Discord: <a target="_blank" href="https://marimo.io/discord?ref=python-not-json">https://marimo.io/discord?ref=python-not-json</a></li>
<li><span role="img" aria-label="movie camera">🎥</span> Subscribe to our YouTube channel: <a target="_blank" href="https://youtube.com/@marimo-team">https://youtube.com/@marimo-team</a></li>
<li><span role="img" aria-label="open book">📖</span> Read the Docs: <a target="_blank" href="https://docs.marimo.io">https://docs.marimo.io</a></li>
<li><span role="img" aria-label="" aria-hidden="true">🗞️</span> Sign up for our Newsletter: <a target="_blank" href="https://marimo.io/newsletter">https://marimo.io/newsletter</a></li>
<li><span role="img" aria-label="books">📚</span> Contribute notebooks to marimo learn: <a target="_blank" href="https://github.com/marimo-team/learn">https://github.com/marimo-team/learn</a></li>
<li><span role="img" aria-label="butterfly">🦋</span> Follow us on Bluesky: <a target="_blank" href="https://bsky.app/profile/marimo.io">https://bsky.app/profile/marimo.io</a></li>
<li><span role="img" aria-label="" aria-hidden="true">🕴️</span> Follow us on LinkedIn: <a target="_blank" href="https://www.linkedin.com/company/marimo">https://www.linkedin.com/company/marimo</a></li>
<li><span role="img" aria-label="bird">🐦</span> Follow us on Twitter: <a target="_blank" href="https://twitter.com/@marimo_io">https://twitter.com/@marimo_io</a></li>
</ul></div></div></div>
  </body>
</html>
