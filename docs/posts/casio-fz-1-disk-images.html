<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.jacobvosmaer.nl/0057-fz-1-images/">Original</a>
    <h1>Casio FZ-1 disk images</h1>
    
    <div id="readability-page-1" class="page"><div><p><i><a href="https://blog.jacobvosmaer.nl/">Jacob Vosmaer&#39;s blog</a></i></p>

<p>2025-07-23</p>

<p>I have started another project in the intersection of: samplers, obscure disk images and Casio. The work is not 100% done yet but I want to report some initial observations about Casio FZ-1 disk images. You can find the utilities I&#39;m writing on <a href="https://github.com/jacobvosmaer/fz1">GitHub</a>.</p>

<h2>The Casio FZ-1</h2>

<p><img src="https://blog.jacobvosmaer.nl/0057-fz-1-images/assets/MT_87_06_casio_fz1_full.jpg" alt="Photo of Casio FZ-1 keyboard from Music Technology magazine June 1987"/> <i>Image source: <a href="https://www.muzines.co.uk/articles/casio-fz1/2041">mu:zines</a>.</i></p>

<p>The <a href="https://www.muzines.co.uk/articles/casio-fz1/2041">FZ-1</a> was a <a href="https://en.wikipedia.org/wiki/Sampler_(musical_instrument)">sampler</a>/synthesizer keyboard launched by Casio in 1987. It was a breakthrough at the time because it was the first product at its price level to offer 16-bit sampling. At that time 12-bit audio was still the norm for samplers.</p>

<p>Besides recording and playing back samples the FZ-1 can also generate rudimentary waveforms itself that you can then play as samples. This is why Casio called it a &#34;digital sampling <em>synthesizer</em>&#34;.</p>

<h2>The challenge</h2>

<p>Like other instruments of its time, it stores audio data on floppy disks. I enjoy working with audio I recorded directly into the sampler but sometimes it is also useful to load audio files from the computer into the sampler digitally, rather than having to record them as analog audio.</p>

<p>The FZ-1 uses a custom disk format which thankfully is <a href="https://blog.jacobvosmaer.nl/0057-fz-1-images/assets/Casio%20FZ-1%20Data%20Structures.pdf">documented</a>. But I did not find any non-Windows tools that can write to these floppies. Time to write my own!</p>

<p>My ultimate goals are to be able to:</p>

<ul>
<li>Load <a href="https://www.adventurekid.se/akrt/waveforms/">AdventureKid Waveforms</a> into the FZ-1 so I can use it as a synthesizer with 4000 waveforms.</li>
<li>Load drum samples into the FZ-1 so I can use it as a drum machine.</li>
</ul>

<p>As a side goal it would be interesting to be able to load <a href="http://zine.r-massive.com/casio-fz-sampler-archive/">FZF files from the Internet</a> into the machine but I find that less interesting for my own music making.</p>

<h2>Formatting a disk image</h2>

<p>I should point out I&#39;m not actually working with floppy disks. I have replaced the disk drive in my FZ-1 with a floppy drive emulator that presents disk images from a USB stick to the host machine as if they are real floppies. So my task is to create these disk image files.</p>

<p>The Casio FZ disk format uses 1280 sectors of 1024 bytes each. This means that the disk images must be exactly <code>1280*1024=1310720</code> bytes big. There is a nice picture in the documentation:</p>

<p><img src="https://blog.jacobvosmaer.nl/0057-fz-1-images/assets/disk-layout.png" alt="FZ-1 disk layout"/></p>

<p>The &#34;head&#34; sector contains the name (label) of the disk and a bitmap (&#34;Cluster Allocation Table&#34;) which indicates which of the 1280 sectors are in use. The &#34;dir&#34; sector contains up to 64 directory entries. There are no subdirectories in this format; 64 is the maximum number of files on a disk.</p>

<p>Strictly speaking, in order to format a disk I think it is enough to write the &#34;head&#34; and &#34;dir&#34; sectors. But I noticed that in practice the FZ-1 writes &#34;ZZZZZZ...&#34; to all the data sectors so <a href="https://github.com/jacobvosmaer/fz1/blob/master/fzformat.c">my formatting program</a> does the same.</p>

<h2>Directory entries</h2>

<p>All numbers in the filesystem are little-Endian. This is because the FZ-1 uses a <a href="https://en.wikipedia.org/wiki/NEC_V20#V50">NEC V50 CPU</a> which is 8086-compatible and thus little-Endian
A directory entry is a 12-byte ASCII name, followed by a 16-bit integer file type (a number from 0-5) and a 16 bit integer denoting the file head sector of the directory entry.</p>

<p><img src="https://blog.jacobvosmaer.nl/0057-fz-1-images/assets/dir-entry.png" alt="The structure of an FZ-1 directory entry"/></p>

<h2>File heads</h2>

<p>Each file has a head sector which contains 64 &#34;data block pointers&#34;. A data block pointer is a pair of 16-bit integers which denotes a range of disk sectors. The actual file contents are the concatenation of the ranges denoted by the data block pointers. Often there is only 1 range in the file but on a disk with fragmented empty space one may need multiple ranges.</p>

<p>Besides the data block pointers, each file head also contains 3 16-bit integers at the very end which determine the file structure. This turns out to be a pain in the neck because Casio FZ files on the internet omit the file head sector and hence these 3 layout numbers. The format documentation is also wrong about the meaning of the individual numbers but this is easier to fix than files not having these numbers.</p>

<p><img src="https://blog.jacobvosmaer.nl/0057-fz-1-images/assets/file-head.png" alt="An incorrect diagram showing the file head structure"/>
<i>This diagram from the FZ-1 <a href="https://blog.jacobvosmaer.nl/0057-fz-1-images/assets/Casio%20FZ-1%20Data%20Structures.pdf">Data Structures document</a>, and all diagrams like it, states the order of the layout numbers is &#34;vn bn wn&#34;. The actual order (as written by the machine) is &#34;bn vn wn&#34; which is also more logical because that is the order in which the data is laid out in the files themselves.</i></p>

<h2>File types</h2>

<p>There are 3 file types I am interested in.</p>

<ul>
<li>Voice (type 1). PCM audio data together with playback parameters such as amplitude envelope, key range, loop points etc. Computer file extension <code>.FZV</code>.</li>
<li>Bank (type 2). A collection of up to 64 voices spread across the MIDI keyboard and across MIDI channels. A bank file embeds up to 64 voices. Extension <code>.FZB</code>.</li>
<li>Full Dump Data (type 0). A file containing up to 8 banks, followed by up to 64 voices, followed by PCM audio data.  Extension <code>.FZF</code>.</li>
</ul>

<p>The layout numbers I mentioned earlier specify the number of banks (<code>bn</code>), followed by the number of voices (<code>vn</code>), followed by the number of sectors of audio data (<code>wn</code> for &#34;wave&#34;). For a voice file <code>bn=0</code>, <code>vn=1</code> and <code>wn</code> varies. For a bank file <code>bn=1</code> and the other two vary. For a full dump data file all three numbers vary.</p>

<h2>I need to work with Full Dump Data files</h2>

<p>My first thought was to work with voice files and not worry about the rest but this is not user friendly. On the machine you can only load voice files one at a time. You select a file, press &#34;load&#34;, press &#34;yes&#34;, and wait for the floppy to load data. Repeat.</p>

<p>It&#39;s better to use the full dump data (FZF) files because then you load once and then you&#39;re done messing about with floppy disks.</p>

<p>In order to test my code for handling FZF files it makes sense to put &#34;real&#34; FZF files onto disk images with my utilities and check that the FZ-1 will load them. This meant that I had to solve the problem of the missing layout numbers because the <a href="http://zine.r-massive.com/casio-fz-sampler-archive/">FZF files</a> I was able to find on the internet are all missing their layouts. I tried loading them anyway but the FZ-1 then loads nothing and says &#34;LOAD OK&#34;.</p>

<h2>Reconstructing the layout numbers</h2>

<p>The goal is to figure out the layout numbers <code>bn</code>, <code>vn</code> and <code>wn</code>. It is safe to assume that <code>wn</code> is the file size minus <code>bn</code> and <code>vn</code> so the problem reduces to finding those two.</p>

<p>The format of these files is described in the <a href="https://blog.jacobvosmaer.nl/0057-fz-1-images/assets/Casio%20FZ-1%20Data%20Structures.pdf">Data Structures document</a>. Each of them has a &#34;name&#34; field of 12 ASCII bytes followed by 2 zero bytes. Well that is what the documentation says, in reality the voice names are 12 ASCII bytes followed by garbage. Still, 12 ASCII bytes is something we can look for. It&#39;s not fool-proof (you could have a sequence of 12 ASCII bytes inside PCM audio data) but it will have to do.</p>

<p>And it works! My project is now at the point that I can put a pre-existing FZF file onto a virtual floppy image and load it on the FZ-1. The following commands create a disk image file <code>helloworld.img</code> with label <code>Hello World</code> and copy the FZF file <code>Piano.fzf</code> of type 0 (full data dump) onto the image.</p>

<pre><code>./fzformat &#39;Hello World&#39; helloworld.img
./fzputfile helloworld.img 0 Piano.fzf
</code></pre>

<h2>What&#39;s next</h2>

<p>I have already <a href="https://github.com/jacobvosmaer/fz1/blob/master/akwf-fzv">figured out</a> how to get an AKWF single cycle waveform into the FZ-1 as a &#34;wave synth&#34; voice (FZV file) using SoX. The problem is that loading voices one at a time is no fun. I need to write another utility that can pack multiple FZV files into one big FZF file. This is more work than just concatenating the FZV files because that would interleave voice parameters with PCM data and that is not how FZF files work.</p>

<p>I also need to make something that can take an arbitrary WAV file and convert it into a simple FZV voice file that will play back the audio data from start to finish. That would be enough to let me load drum samples.</p>

<p>I&#39;ll report back when I get that working. Thanks for reading!</p>
<p>Tags:  <a href="https://blog.jacobvosmaer.nl/tags/casio.html">casio</a> <a href="https://blog.jacobvosmaer.nl/tags/fz-1.html">fz-1</a> <a href="https://blog.jacobvosmaer.nl/tags/akwf.html">akwf</a></p>
<p><a href="https://blog.jacobvosmaer.nl/">Index</a> — <a href="mailto:contact@jacobvosmaer.nl">Contact</a></p></div></div>
  </body>
</html>
