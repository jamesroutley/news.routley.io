<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://pete.ex-parrot.com/upside-down-ternet.html">Original</a>
    <h1>Upside-Down-Ternet</h1>
    
    <div id="readability-page-1" class="page">

<a href="http://www.mythic-beasts.com/"><img src="http://pete.ex-parrot.com/~pete/mb-button.png" alt="Mythic Beasts, shell accounts, cvs hosting, co-location, virtual servers"/></a>



<p>My neighbours are stealing my wireless internet access. I could encrypt it
or alternately I could have fun.</p>

<h2>Split the network</h2>
<p>
I&#39;m starting here by splitting the network into two parts, the trusted half
and the untrusted half. The trusted half has one netblock, the untrusted a
different netblock. We use the DHCP server to identify mac addresses to give
out the relevant addresses.
</p>

<h3>/etc/dhcpd.conf</h3>
<pre>ddns-updates off;
ddns-update-style interim;
authoritative;

shared-network local {

        subnet *.*.*.* netmask 255.255.255.0 {
                range *.*.*.* *.*.*.*;
                option routers *.*.*.*;
                option subnet-mask 255.255.255.0;
                option domain-name &#34;XXXXX&#34;;
                option domain-name-servers *.*.*.*;
                deny unknown-clients;

                host trusted1 {
                        hardware ethernet *:*:*:*:*:*;
                        fixed-address *.*.*.*;
                }
		}

        subnet 192.168.0.0 netmask 255.255.255.0 {
                range 192.168.0.2 192.168.0.10;
                option routers 192.168.0.1;
                option subnet-mask 255.255.255.0;
                option domain-name-servers 192.168.0.1;
                allow unknown-clients;

        }
}

</pre>

<h3>IPtables is Fun!</h3>
<p>
Suddenly everything is kittens! It&#39;s kitten net.
</p>

<pre>/sbin/iptables -A PREROUTING -s 192.168.0.0/255.255.255.0 -p tcp -j DNAT --to-destination 64.111.96.38
</pre>

<p>For the uninitiated, this redirects all traffic to <a href="http://www.kittenwar.com">kittenwar</a>.
</p>


<p>
For more fun, we set iptables to forward everything to a transparent squid proxy running on port 80 on the machine.
</p>

<pre>/sbin/iptables -A PREROUTING -s 192.168.0.0/255.255.255.0 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.0.1
</pre>

<p>
That machine runs squid with a trivial redirector that downloads images, uses
mogrify to turn them upside down and serves them out of its local webserver.
</p>

<h3>The redirection script</h3>
<pre>#!/usr/bin/perl
$|=1;
$count = 0;
$pid = $$;
while (&lt;&gt;) {
        chomp $_;
        if ($_ =~ /(.*\.jpg)/i) {
                $url = $1;
                system(&#34;/usr/bin/wget&#34;, &#34;-q&#34;, &#34;-O&#34;,&#34;/space/WebPages/images/$pid-$count.jpg&#34;, &#34;$url&#34;);
                system(&#34;/usr/bin/mogrify&#34;, &#34;-flip&#34;,&#34;/space/WebPages/images/$pid-$count.jpg&#34;);
                print &#34;http://127.0.0.1/images/$pid-$count.jpg\n&#34;;
        }
        elsif ($_ =~ /(.*\.gif)/i) {
                $url = $1;
                system(&#34;/usr/bin/wget&#34;, &#34;-q&#34;, &#34;-O&#34;,&#34;/space/WebPages/images/$pid-$count.gif&#34;, &#34;$url&#34;);
                system(&#34;/usr/bin/mogrify&#34;, &#34;-flip&#34;,&#34;/space/WebPages/images/$pid-$count.gif&#34;);
                print &#34;http://127.0.0.1/images/$pid-$count.gif\n&#34;;

        }
        else {
                print &#34;$_\n&#34;;;
        }
        $count++;
}
</pre>

<p>Then the internet looks like this!</p>

<img src="http://pete.ex-parrot.com/shot1.png"/>
<!--img src="shot2.png"-->
<img src="http://pete.ex-parrot.com/shot3.png"/>
<!--img src="shot4.png"-->

<p>And if you replace flip with -blur 4 you get the blurry-net</p>

<img src="http://pete.ex-parrot.com/shot5.png"/>


<hr/>
<p>I made <a href="http://www.xkcd.com">xkcd</a> - how cool is that ?</p>
<img src="http://imgs.xkcd.com/comics/1337_part_1.png"/>

<hr/>

<p>Here&#39;s an email I received from Fraser at kittenwar,</p>

<pre>Hi Pete,
Apologies for the unsolicited mail, but I thought I&#39;d drop you a line to
say how much I like your Upside-Down-Ternet advice for confusing wireless
thieves.

Every so often I receive extremely irate e-mails from people claiming
that my Kittenwar site is playing host to some kind of nefarious virus
preventing them from accessing the web, accusing me of practising all
sorts of dark arts - to which I politely respond that I&#39;m terribly sorry,
but this only usually happens to people who are using someone else&#39;s
wireless connection, and pointing them in the direction of your site.
This has happened dozens of times over the last few years, and you know
what? None of them have ever got back to me after I point this out.

</pre>

<hr/>

<p>It seems that the kernel.org team also turned their bit of the
internet upside down. <a href="http://userweb.kernel.org/~warthog9/april1/2010/">kernel.org</a></p>

<hr/>

<p><a href="http://g0tmi1k.blogspot.com">gotmi1k</a> has redone this page for the Web 2.0 generation and turned the entire technical explanation into a <a href="http://g0tmi1k.blogspot.com/2011/04/video-playing-with-traffic-squid.html">video</a>. They did write some more scripts for messing about with the images and I must confess that the asciiart filter and time machine options are particularly inspired.
</p>

<hr/>

<a name="varunchandak"></a>
<p>
A talentless copyright infringing idiot called <a href="http://www.ex-parrot.com/~pete/upside-down-ternet.html#varunchandak">Varun Chandak</a>
plagarised this page without
any subtlety at all and gave me the opportunity to send my first ever
DMCA takedown notice. It would be awful if this page appeared in Google
as the first search result for his name. Being the complete tool that
he is he added a tiny attribution just like this one <a href="http://www.ex-parrot.com/~pete/upside-down-ternet.html#varunchandak">Varun Chandak is a talentless copyrighting infringing idiot</a> which doesn&#39;t appear in the Google cache for his page and pretended that the retrospective addition makes it definitely not copyright infringement.
</p>




</div>
  </body>
</html>
