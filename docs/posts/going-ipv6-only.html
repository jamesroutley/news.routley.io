<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.brixit.nl/going-ipv6-only/">Original</a>
    <h1>Going IPv6 Only</h1>
    
    <div id="readability-page-1" class="page"><section>
                <div>
                    <p>Since we&#39;re slowly coming up to 25 years of having IPv6, but still not actually having IPv6, I tried making a seperate local network that only has v6 access. In theory quite a few of the popular internet services should have IPv6 connectivity working.</p><p>From previous network configuration mistakes, I&#39;ve learned that it takes quite a while before I notice the loss of IPv4 connectivity if IPv6 is still working. Usually,  I notice that by having the search engine work perfectly fine, but none of the websites I click loading.</p><h2 id="setting-up-the-network">Setting up the network</h2><p>It was quite easy to set up the v6-only network for me. I already have all the network traffic running through a Linux router so I just made a new bridge that gets IPv6 addresses only and drop all IPv4 traffic. I&#39;ve assigned a network interface to this bridge and also an SSID on the wireless network.</p><pre><code>$ brctl addbr v6only
$ iptables -A FORWARD -i v6only -j DROP
$ iptables -A INPUT -i v6only -j DROP
$ ip6tables -A FORWARD -i v6only -j ACCEPT
$ ip6tables -A INPUT -i v6only -j ACCEPT</code></pre><h2 id="first-problems">First problems</h2><p>The first problem didn&#39;t take very long, I had a complete lack of ipv6 reachable nameservers in my network. </p><p>The nameserver in my network is <code>unbound</code> running on a Linux machine. It&#39;s configured to do recursive resolving and caching and I had never set it up for IPv6.</p><p>I ran into a few interesting issues with setting up unbound. I had created an ACL that allowed the IPv6 subnet on my LAN to use the recursive resolver by marking that subnet as a private network. It took quite a bit of debugging to figure out why it refused to return AAAA records for my local services. I had created an AAAA record for my local Matrix server and I could resolve it just fine through third-party nameservers, but got no results at all from unbound. It turns out that marking an IPv6 subnet as private also makes DNS responses that return an address in that subnet dissapear due to the scrubber.</p><p>The scrubber makes a lot of sense. It prevents a website called evil.com to make a DNS record called local.evil.com pointing to 127.0.0.1 or any other local address. The issue with such a record is that browsers will allow JavaScript to connect to services on your machine this way. This works absolutely fine for IPv4 for me, but on IPv6 the public address for the service is the same as my local address for it since there&#39;s no NAT involved. After quite a bunch of searching the fix turned out to be adding a single line to the config:</p><pre><code>private-domain: brixit.nl</code></pre><p>This allowed my matrix.brixit.nl AAAA record to function both inside and outside the network.</p><h2 id="infrastructure-fixes">Infrastructure fixes</h2><p>Now I&#39;ve been connected to the internet again I ran into my second issue. While all the postmarketOS infrastructure has IPv6 addresses, none of it had it&#39;s AAAA records created after the last infrastructure migration.  This was luckily quite easy to fix.</p><p>Beside the infrastructure that postmarketOS runs itself there&#39;s also <a href="https://gitlab.com/postmarketOS">gitlab.com/postmarketOS</a>. Luckily IPv6 is also fully supported on Gitlab. It looks like Github and Sourcehut are behind in this and are not reachable over IPv6 at all.</p><p>This means most postmarketOS work is possible on an IPv6-only connection. Issues are mostly that the sources for quite a lot of project are on github or sourcehut which means builds are failing locally. Also the build infrastructure for postmarketOS is running on Sourcehut builds which means I can&#39;t see the logs of build failures (but the artefacts are on the postmarketOS infrastructure and accessible again)</p><h2 id="inaccessible-websites">Inaccessible websites</h2><p>So in my testing I come across several websites that didn&#39;t work yet.</p><ul><li>Reddit</li><li>Hackernews</li><li>Twitter</li><li>Github</li><li>Sourcehut</li><li>Hackaday</li><li>Stackoverflow</li></ul><p>I guess killing a bunch of the social media would make me a bit more productive. The code forge access is quite a lot more problematic. I can totally understand though that Microsoft doesn&#39;t have the funds to deploy IPv6, it&#39;s a tiny startup after all.</p><figure><img src="https://blog.brixit.nl/content/images/2022/02/image-1.png"/></figure><h2 id="so-is-this-useful-at-all">So is this useful at all</h2><p>Running an IPv6-only network isn&#39;t super useful for daily use. There&#39;s simply too many services that still fully rely on IPv4 to function.</p><p>Occasionally plugging into the IPv6 testnet though is very useful. It&#39;s great for finding bugs, the kinds of bugs that lead to still not being able to use IPv6 after decades. Since practically all IPv6 deployments are dualstack it&#39;s not very noticable when IPv6 is misconfigured because practically all software silently falls back to IPv4.</p><p>Just using this network for an hour was enough to iron all the IPv6 issues on the postmarketOS and my own infrastructure so I&#39;d say this was worth it.</p>
                </div>
            </section></div>
  </body>
</html>
