<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lynn.sh/guix-emacs-file-manager.html">Original</a>
    <h1>Emacs dired-mode as a file manager</h1>
    
    <div id="readability-page-1" class="page"><div id="text-orgdcc4135">
<p>
I&#39;m sure some of you reading this are rolling your eyes or reciting the well-known &#34;Emacs is a great OS, but â€¦&#34; I use it a lot, though. I already use <code>dired-mode</code> to manage my writing  and programming. It&#39;s something that is powerful, and comfortable to use. If you are following along and use something else, it is also quite easy to adjust my code here as well.
</p>

<p>
Ok, with that out of the way let&#39;s look at what we actually want to do: xdg-mime needs to connect &#34;Opening a directory&#34; with &#34;opening emacs in <code>dired-mode</code>.&#34; First, we need the MIME type for directories. A quick search shows that it is called
<code>inode/directory</code>.
</p>
<blockquote>
<p>
I have no idea why it is called inode/directory, and I couldn&#39;t find an explanation. I&#39;ve learned not to ask questions about these names.
</p>
</blockquote>
<p>
Opening emacs in <code>dired-mode</code> is the easy part: if you pass emacs a directory instead of a file, it automatically opens in the appropriate mode. Great! Now we need to tie these two concepts together.
</p>

<p>
If we were using a non-declarative system, such as Debian, I would suggest doing something like creating a <code>.desktop</code> file, running <code>xdg-mime default emacs-dired.desktop inode/directory</code> and that would be it. You could theoretically do this on Guix as well. There is a big downside with this strategy, though: the changes you make are not documented anywhere on your system. If you wanted to duplicate your setup on a new laptop, for example, you would have to either note down this change you made or run into it again, hopefully remember your solution, and then reproduce it. Maybe this works for others, but I know myself. I will not remember, I will run into it again, and then I will get frustrated again. That&#39;s why we have <code>guix-home</code> configuration.
</p>

<p>
<code>home-xdg-mime-applications-service-type</code> is a very helpful service in the <code>guix-home</code> configuration tool. It allows you to create <code>xdg-desktop-entry</code> for each <code>.desktop</code> file you would normally need to create, link those to the MIME type of your choice, and that&#39;s it. It is also all written down explicitly, so there is no confusion on what steps were taken. Let&#39;s look at the most basic example to solve our issue:
</p>

<div>
<pre>(home-environment
 (services
  (list
   (service home-xdg-mime-applications-service-type
            (home-xdg-mime-applications-configuration
             (default &#39;((inode/directory . emacs-dired.desktop)))
             (desktop-entries
              (list (xdg-desktop-entry
                     (file <span>&#34;emacs-dired&#34;</span>)
                     (name <span>&#34;Emacs Dired as a file manager&#34;</span>)
                     (type &#39;application)
                     (config
                      &#39;((exec . <span>&#34;emacsclient -c -a emacs %u&#34;</span>)
                        (mimetype . <span>&#34;inode/directory&#34;</span>)))))))))))
</pre>
</div>
<blockquote>
<p>
If this is nonsense to you, I apologize. I&#39;m definitely not the person who should be teaching you lisp. You should definitely learn it, though!  The configuration language for Guix is called <code>Guile Scheme</code>, read up on it.
</p>
</blockquote>
<p>
I use <code>emacsclient</code> here because I have emacs always running as a daemon. <code>-c</code> tells it to create a new frame, and <code>-a emacs</code> tells it to fall-back to a regular emacs session if there is some reason my daemon has stopped running.
And that&#39;s it! It works perfectly after a quick <code>guix home reconfigure</code>.  To expand, just add a new <code>xdg-desktop-entry</code> that runs whatever script you wish, and then tie it to a MIME type in the <code>default</code> list.
</p>

<p>
I considered adding things for image types, text types, etc. This would be useful to do if you used a regular file manager. With emacs though, I am already in the program I need for these types. Opening them from <code>dired-mode</code> already puts them into emacs, so I decided against the necessity for this. If you are using something other than emacs for this setup, I recommend adding the following MIME types:
</p>
<table>


<colgroup>
<col/>

<col/>
</colgroup>
<tbody>
<tr>
<td>Mime Type</td>
<td>Application Type</td>
</tr>

<tr>
<td>image/jpeg</td>
<td>image viewer</td>
</tr>

<tr>
<td>image/png</td>
<td>image viewer</td>
</tr>

<tr>
<td>image/svg</td>
<td>image viewer</td>
</tr>

<tr>
<td>image/webp</td>
<td>image viewer</td>
</tr>

<tr>
<td>text/plain</td>
<td>text editor</td>
</tr>

<tr>
<td>text/html</td>
<td>text editor</td>
</tr>

<tr>
<td>text/x-makefile</td>
<td>text editor</td>
</tr>

<tr>
<td>application/pdf</td>
<td>pdf viewer</td>
</tr>

<tr>
<td>x-scheme-handler/http</td>
<td>browser</td>
</tr>

<tr>
<td>x-scheme-handler/https</td>
<td>browser</td>
</tr>
</tbody>
</table>

<p>
There are more, but if you are using a minimal system and want full control this will give you a good starting point. Thanks for reading!
</p>
<blockquote>
<p>
If you are learning Guix and need help figuring something out, I highly recommend checking out <a href="https://sr.ht/~abcdw/rde/">rde</a> by abcdw. It is a framework for Guix to help create reproducable systems, and also a wealth of knowledge when it comes to configuring.
</p>
</blockquote>
</div></div>
  </body>
</html>
