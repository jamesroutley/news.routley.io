<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://olivia.website/notes/modelling-indoor-co2-the-rc-model/">Original</a>
    <h1>Modelling indoor CO2, the RC model</h1>
    
    <div id="readability-page-1" class="page"><article data-astro-cid-y7z3oeuj="">   <p><em>Editor’s note: After <a href="https://olivia.website/posts/2024-12-27-indoor-co2">last post</a>, I got multiple requests (like, two) to write up the model, so here we go!</em></p>
<blockquote data-callout="note" data-expandable="false" data-expanded="false">

                
                <p>This is still a work-in-progress as of June 7, 2025, it ends mid-sentence…</p>
              
</blockquote>
<h3 id="quick-recap">Quick recap</h3>
<p>So, we left off with me saying:</p>
<blockquote>
<p>“the number of people in the space controls the derivative of the CO2 levels”.</p>
</blockquote>
<p>Which was backed up by <span title="Sorry dark mode readers">this lovely graph,</span> which shows three attempts to open a window to control the CO2 levels.</p>
<ol>
<li>The first attempt worked, but levels bounced right back up.</li>
<li>the second time, I waited longer and let the levels drop much further, just for the levels to bounce back up again.</li>
<li>The third time actually worked, despite it only reaching as far down as the 2nd attempt… but there were far less people in the space…</li>
</ol>
<p><img src="https://olivia.website/co2-levels_files/figure-markdown_strict/the-next-day-all-of-it-1.png" alt=""/></p>
<h2 id="the-rc-model-for-rc">The RC model, for RC</h2>
<p><em>Editor’s note: I had to dig up my old notebook for this section, most of this work was done on January 23rd, 2024.</em></p>
<p>There are two main effects I wanted to model:</p>
<ul>
<li>indoor air being replaced by outdoor air,</li>
<li>new carbon being emitted by humans.</li>
</ul>
<p>Let’s go through an example, we start with 1,000 units of carbon in the air. (The units here are arbitrary).</p>
<p>Over the next 5 minutes, some amount gets exhausted and replaced with fresh air. Let’s say 20% of that gets exhausted, so we go down to 800 units.</p>
<p>However, outdoor air also has some carbon! Let’s say and in that amount of outside air, there’s 40 units of carbon. So we’re at 840 units of carbon.</p>
<p>Now let’s say that each human emits 50 units of carbon every 5 minutes. If there are 3 humans, that adds an additional 150 units of carbon, bringing us all the way up to 990 units of carbon.</p>


<h2 id="drawing-the-math-out-of-the-drawing">Drawing the math out of the drawing</h2>
<p>So the drawing is pretty, and it’s given me some good intuition about how the system works.
However, there’s work to be done to turn this into an actual formula and model.</p>
<h3 id="the-old-air">The old air</h3>
<p>The part that sticks around corresponds to the previous CO2 level: <code>prev</code>, to which we remove the fraction of air we vented, <code>frac_vented</code>.</p>
<pre tabindex="0" data-language="elm"><code><span><span>co2_from_prev</span><span> =</span><span> prev </span><span>*</span><span> (</span><span>1</span><span> -</span><span> frac_vented)</span></span></code></pre>
<h3 id="the-new-air">The new air</h3>
<p>The blue bar corresponds to the amount of CO2 that comes from the atmosphere.</p>
<p>We know that the <em>concentration</em> of CO2 in the atmostphere is 420ppm, but that’s not a unit of mass.
The amount of CO2 in the fresh air therefore depends on the volume of new air we take in, which we can compute if we know the volume of our room.</p>
<pre tabindex="0" data-language="elm"><code><span><span>co2_from_outside</span><span> =</span><span> CO2_PER_L</span><span> *</span><span> ROOM_VOLUME</span><span> *</span><span> frac_vented</span></span></code></pre>
<p>The value of <code>CO2_PER_L</code> is actually kinda interesting, it’s <em>not</em> 420ppm.</p>
<p>What 420ppm says is that for every million air molecules, there are 420 of CO2.</p>
<p>So to get to <code>CO2_PER_L</code>, we need to know the number of molecules per liter, multiply that by 420ppm (0.000420) (which gives us the number of CO2 molecules per liter), which we can then multiply by the weight of a single CO2 molecule.</p>
<p>Finding the number of molecules per liter is possible through application of the <a href="https://en.wikipedia.org/wiki/Ideal_gas_law">ideal gas law</a> which ends up working out to around 2.7x10^22.
I had to look that up, but the number I do know is that a mole of gas, any gas, in this atmosphere, takes up 22.4L. (And you can check that 1/22.4*N is about 2.7*10^22).</p>
<p>So a good constant to know is that 1 mole of any gas, in a “normal” atmosphere takes up 22.4L of air.
So every liter of air is 1/22. moles.
We know that 420ppm of that is CO2.</p>
<p>Now we need to figure out what CO2 weighs, and we (finally) get to use it’s name: 1 Carbon + 2 Oxygen.
Looking at the weights in our trusty periodic table, we get that CO2 weighs <code>12+2*16 = 44</code> grams per mole.</p>
<p>Bringing it all together, 44g/mole _ 420ppm _ 1/22.4 mole/liter = 0.0008 g of CO2 per liter of air.</p>
<pre tabindex="0" data-language="elm"><code><span><span>CO2_PER_L</span><span> =</span><span> 0.0008</span></span></code></pre>
<p>Phew!</p>
<h3 id="the-people">The people</h3>
<p>Finally, the red amount corresponds to the amount of CO2 released by people who are in the room.</p>
<pre tabindex="0" data-language="elm"><code><span><span>co2_from_people</span><span> =</span><span> n_people </span><span>*</span><span> CO2_PER_PERSON_PER_SECOND</span><span> *</span><span> DT</span></span></code></pre>
<p>Human physiology is harder (at least for me) to derive from first principles, so a quick bit of research tells me that on average, we exhale about 1kg of CO2 every day, so that’s about 0.01 g/s.</p>
<h3 id="bringing-it-together">Bringing it together</h3>
<p>We can put this all together as a function that takes 3 parameters: the previous CO2 levels, the number of people in the room, and the amount vented.</p>
<p>Everything else is a constant, either of the room, or of the atmosphere.</p>
<pre tabindex="0" data-language="elm"><code><span><span>new_co2</span><span> prev n_person frac_vented </span><span>=</span></span>
<span><span>    let</span></span>
<span><span>        co2_from_prev </span><span>=</span><span> prev </span><span>*</span><span> (</span><span>1</span><span> -</span><span> frac_vented)</span></span>
<span><span>        co2_from_outside </span><span>=</span><span> CO2_PER_L</span><span> *</span><span> ROOM_VOLUME</span><span> *</span><span> frac_vented</span></span>
<span><span>        co2_from_people </span><span>=</span><span> n_people </span><span>*</span><span> CO2_PER_PERSON_PER_SECOND</span><span> *</span><span> DT</span></span>
<span><span>    in</span></span>
<span><span>    co2_from_prev </span><span>+</span><span> co2_from_outside </span><span>+</span><span> co2_from_people</span></span>
<span></span></code></pre>
<h2 id="turning-this-into-an-rc-model">Turning this into an RC model</h2>
<p>Okay, so I’ve teased this long enough.</p>
<p>Anytime a model has a component that looks like <code>next = prev * frac</code>, I think “that’s a capacitor discharging”.
So we can think of the CO2 left over as voltage being stored in a capacitor <code>C</code> (the size of which depends on the size of the room).</p>
<p>In this case, the capacitor doesn’t actually discharge all the way to 0: it only discharges to the ever-present 420ppm. This is what our second term is doing.</p>
<p>The rate of discharge is entirely controlled by <code>frac_vented</code>, which we can think of as a resistor. If the room is tightly sealed, it has high resistance, if there’s a good breeze, it’s essentially a wire.</p>
<p>Finally, the amount of CO2 added is a <em>current source</em>.
We breathe CO2 out at a constant rate into the room.</p>
<p>All together, this looks like this:</p> 
---<!-- TODO: backlinks -->   </article></div>
  </body>
</html>
