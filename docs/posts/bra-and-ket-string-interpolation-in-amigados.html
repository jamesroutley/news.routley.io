<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.datagubbe.se/braket/">Original</a>
    <h1>Bra and KET: String Interpolation in AmigaDOS</h1>
    
    <div id="readability-page-1" class="page"><div>



<p><b>Exploring the unnecessary, part 3735928559</b></p>
<p><i>Spring 2025</i></p>

<h3>A Short Word on AmigaDOS Scripts</h3>
<p>
Without getting caught up in semantics, AmigaDOS in this text refers to the command line portion of the Amiga computers&#39; operating system. AmigaDOS is based on TRIPOS, but was expanded and added to by both the original Amiga team and then Commodore. One thing that remains basically the same is the parser for shell scripts, or sequence files as they&#39;re called in TRIPOS. The script parser is reasonably competent for a 1980:s home computer OS and can be used for solving <a href="https://www.datagubbe.se/a20sh">real world made up programming problems</a>.
</p>

<p>
The parser accepts a few special directives, such as <tt>.KEY</tt>, which is used to describe the template for arguments passed to the script file. For example, <code>.KEY FILENAME/A</code> tells the parser that the script accepts a string argument called FILENAME. These directives are placed at the start of the script file. 
</p>

<p>
By default, the parser does string interpolation using the characters <tt>&lt;</tt> (less than) and <tt>&gt;</tt> (greater than). The cleverness of this is debatable: these characters are also used for I/O redirection, which can quickly make things confusing. Luckily, the parser also accepts the directives <tt>.BRA</tt> and <tt>.KET</tt>, each followed by a single character, which lets the programmer override the default interpolation characters. The terms BRA and KET are most likely borrowed from <a href="https://en.wikipedia.org/wiki/Bra%E2%80%93ket_notation">Dirac notation</a>.
</p>

<h3>A Simple Example</h3>

<p>
Usually, AmigaDOS scripts using interpolation replace the default characters with curly braces, <tt>{</tt> and <tt>}</tt>, respectively. This trend may have originated at Commodore. Consider the following script:
</p>

<pre>.BRA {
.KET }
.KEY var
Echo Hello {var}!
</pre>

<p>
Here, <tt>&lt;</tt> and <tt>&gt;</tt> have been substituted with <tt>{</tt> and <tt>}</tt>. The script takes a single argument, <tt>var</tt>, and the string interpolation then replaces <tt>{var}</tt> with the supplied argument. If saved as the file <tt>myscript</tt> and executed, the following AmigaShell session can be achieved:
</p>

<pre>AmigaShell&gt; myscript datagubbe
Hello datagubbe!
AmigaShell&gt; _
</pre>

<h3>Interpolate This!</h3>

<p>
This of course begs the question: What characters can be used for string interpolation in shell scripts? Thanks to the tireless efforts of talented researchers at Datagubbe Labs, an answer can be presented - and programmers worldwide can finally get a good night&#39;s sleep. Without further ado, let&#39;s get down to brass tacks!
</p>

<h3>Test Tooling</h3>

<p>
There are text editors on the Amiga that&#39;ll happily insert any ASCII character into a text file, but why use an existing solution when you can build your own? An ARexx program - <tt>makescript</tt> - was <s>quickly hacked together</s> meticulously constructed for the purpose. This program generates an AmigaDOS script file with arbitrary characters for <tt>.BRA</tt> and <tt>.KET</tt>, supplied either as plain text or ASCII char codes. <a href="https://www.datagubbe.se/braket/makescript">The source code for makescript is available here</a>.
</p>

<h3>Bread and Butter</h3>

<p>
The defaults and the standard curly substitutes both work very well, as expected. Datagubbe Labs has taken the liberty of preparing screenshots, to further emphasize the validity and rigor of this important research. The scripts can also be downloaded, for transparency and reproducibility. Witness:
</p>

<ul>
  <li><a href="https://www.datagubbe.se/braket/default">Default (no .BRA/.KET directives)</a></li>
  <li><a href="https://www.datagubbe.se/braket/standard">Standard (curly braces)</a></li>
</ul>

<p>
<a href="https://www.datagubbe.se/braket/pix/def_std.d.png"><img src="https://www.datagubbe.se/braket/pix/def_std.d.png" alt="A screenshot of an Amiga shell window running the scripts using default and curly bra-kets."/></a>
</p><h3>Odds and Alphas</h3>

<p>
What about non-matching character pairs, such as <tt>[</tt> and <tt>}</tt>? That works, too, which was expected. As does standard letters, such as <tt>A</tt> and <tt>B</tt>.
</p>

<ul>
  <li><a href="https://www.datagubbe.se/braket/odd">Odd pair ([ and })</a></li>
  <li><a href="https://www.datagubbe.se/braket/alpha">Letters (A and B)</a></li>
</ul>

<p>
<a href="https://www.datagubbe.se/braket/pix/odd_alpha.d.png"><img src="https://www.datagubbe.se/braket/pix/odd_alpha.d.png" alt="A screenshot of an Amiga shell window running the scripts using odd and alphabetic bra-kets."/></a>
</p><h3>Bells and Whistles</h3>

<p>
Finally, non-printable characters were introduced. First, shift out (SO, decimal char code 14) and shift in (SI, decimal char code 15) were tested. These worked, too. Then, upping the ante, our relentless researchers decided to try the ASCII BEL character (decimal char code 7). AmigaDOS handles the BEL character by flashing the screen when it&#39;s encountered in a text. How would this fare in script execution? For closing the interpolation, negative acknowledgement (NAK, decimal char code 21), was chosen. This too, proved to work flawlessly - and no screen flashing was encountered when executing the script.
</p>

<ul>
  <li><a href="https://www.datagubbe.se/braket/sosi.txt">Shift In and Shift Out</a></li>
  <li><a href="https://www.datagubbe.se/braket/bel_nak.txt">BEL and NAK</a></li>
</ul>

<p>
<a href="https://www.datagubbe.se/braket/pix/bel_nak.d.png"><img src="https://www.datagubbe.se/braket/pix/bel_nak.d.png" alt="A screenshot of 
an Amiga shell window running the scripts using SO/SI and BEL/NAK
bra-kets."/></a>
</p><h3>Another Job Well Done</h3>

<p>
Naturally, when printing the script file contents to the shell window using the AmigaDOS command <tt>Type</tt>, these characters cause a bit of commotion. BEL, for example, results in a screen flash as expected. In order to verify that the characters are indeed present in the script files, feel free to download them above - or study <a href="https://www.datagubbe.se/braket/pix/bel_nak_emacs.d.png">this screenshot of MicroEMACS</a>, displaying the non-printable characters as control sequences.
</p>

<p>
In conclusion, AmigaDOS string interpolation offers both resilience and a wide variety of choice - a cause for celebration as good as any. Thanks for your attention, and happy hacking!
</p>


</div></div>
  </body>
</html>
