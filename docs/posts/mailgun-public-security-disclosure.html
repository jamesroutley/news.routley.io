<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://news.ycombinator.com/item?id=36678348">Original</a>
    <h1>Mailgun: Public Security Disclosure</h1>
    
    <div id="readability-page-1" class="page"><div><div><p>TLDR: Inbound email routes don&#39;t have SPF/DKIM/DMARC protection, meaning any inbound email sent to a webhook can be trivially spoofed / phished.
Mailgun describe inbound routes as:</p><p>&#34;complex incoming messages are simplified and parsed into all of the data you need with Inbound Routes.&#34; [1]</p><p>Mailgun refers to DKIM/SPF/DMARC with:</p><p>&#34;Mailgun leads the charge in email authentication by requiring DKIM and SPF records by default before you can begin sending.&#34; [2]</p><p>However, nowhere does it say that Mailgun does not provide SPF or DKIM validation checks on inbound emails. Confusingly, these headers appear only for a subset of inbound emails.</p><p>Attack scenario:</p><p>1) Pick any domain using mailgun for inbound email processing (trivially found via MX records).</p><p>2) Spoof an email from any address you want to impersonate (eg. security@mailgun.com).</p><p>If that address is handled via an inbound route to a webhook (eg. CRM system / other), then it will appear as from the spoofed sender without any DKIM/SPF flags. This makes phishing via Inbound Routes trivial.</p><p>Requested fix:</p><p>Include SPF (X-Mailgun-Spf), DKIM (X-Mailgun-Dkim-Check-Result), and Spam Assassin headers (eg. DMARC_QUAR / DMARC_REJECT / DMARC_NONE / DMARC_MISSING) headers for ALL inbound routes to a webhook. The application can then decide what to do.</p><p>Mailgun Response:</p><p>&#34;Our security team has confirmed that our routes act as an open relay and that this is not considered a security vulnerability with Mailgun.&#34;</p><p>Nowhere in the Mailgun documentation / sales pages are inbound routes described like this, and in fact, they pretend to have protection as headers are sometimes present!</p><p>Note A: Using throwaway to not give information away for our own exposed systems.</p><p>Note B: The spoofed email must not trigger above a certain spam assassin threshold (this is fairly trivial to do and openly testable by any attacker), otherwise it might get blocked by higher level Mailgun spam handling.</p><p>[1] - https://www.mailgun.com/products/send/inbound-routing/</p><p>[2] - https://www.mailgun.com/blog/deliverability/implement-dmarc/#chapter-5</p></div></div></div>
  </body>
</html>
