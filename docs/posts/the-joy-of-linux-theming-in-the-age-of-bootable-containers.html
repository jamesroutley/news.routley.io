<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blues.win/posts/joy-of-linux-theming/">Original</a>
    <h1>The Joy of Linux Theming in the Age of Bootable Containers</h1>
    
    <div id="readability-page-1" class="page"><div><div>
        <p>Having spent a couple of decades in the Linux world, I have always had an interest in Linux desktop environments and how they are themed.
I would often come across a post on <a href="https://reddit.com/r/unixporn">/r/unixporn</a> that inspired me to try to customize the look and feel of my desktop environment. So I would install Xfce, LXQt or Sway and try to recreate components that I like from other users or create my own. I would end up installing different kinds of panels, plugins, docks and launchers as well as random themes, fonts and sounds.</p>
<p>A portion of this process would be documented, initially as random shell scripts in my home directory, before graduating to Ansible playbooks – with a brief detour into Nix that I will not elaborate on. Some of the customizations would live in my home directory, but there were often system-wide modifications to <code>/usr</code> required.</p>
<p>Eventually, the constant churn and randomly broken desktop components such as a panel that mysteriously vanished or a non-functional dock led me to stick with the stock configuration of whatever desktop environment I was using at the time.
The major desktop environments, <a href="https://kde.org">KDE Plasma</a> and <a href="https://www.gnome.org">GNOME</a>, are both well polished and great out of the box. The desktop experience that they have delivered over the last few years has contributed to desktop Linux being the best it has ever been, in my opinion.</p>
<p>But the itch to customize and tweak my desktop environment in fun and interesting ways is still there. Eventually, I was introduced to the concept of bootable containers.</p>
<h2 id="bootc-as-a-themers-playground">Bootc As A Themer’s Playground<a href="#bootc-as-a-themers-playground" arialabel="Anchor">⌗</a> </h2>
<p>The <a href="https://github.com/bootc-dev/bootc">bootc</a> project, originally developed by <a href="https://www.redhat.com">Red Hat</a> but now part of the <a href="https://www.cncf.io/">Cloud Native Computing Foundation</a>, is a core component of the <a href="https://containers.github.io/bootable/">Bootable Containers Initiative</a>. Conceptually, it allows you to define your operating system as a Containerfile:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>FROM quay.io/fedora/fedora-bootc:42
</span></span><span><span>RUN dnf install -y my-custom-theme my-custom-fonts my-custom-panel
</span></span></code></pre></div><p>Once written, you can build the container locally and instruct your bootc-aware system to use the new image.</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>sudo podman build -f Containerfile -t my-fedora
</span></span><span><span>sudo bootc switch --transport containers-storage localhost/my-fedora:latest
</span></span></code></pre></div><p>After a reboot, the system’s deployment is defined by the new container.</p>
<p>With Fedora Atomic systems, <code>/usr</code> is mounted read-only and because your operating system is defined by an OCI container, it is incredibly easy to revert to a previous tag of that container. I can easily create a throwaway container where I test out ideas for a theme, reboot into the new deployment and test it out on bare-metal. I can roll back to the previous container if necessary or create a new container with follow-up modifications.</p>
<p>One downside is that this reboot-heavy workflow can obviously cause some friction. This can be mitigated somewhat by enabling “Development Mode” with <code>ostree admin unlock</code>, which creates a temporary writable overlayfs on top of <code>/usr</code>. I often find myself using this mode to temporarily install some package, theme or configuration in <code>/usr</code>. After verifying that it works as expected, I can add that functionality to the Containerfile. If it doesn’t work, I can either reboot to get rid of the changes, or (more likely) just forget about the change and it will remove itself whenever I reboot normally. The lack of cruft that accumulates over time in a typical Linux installation is one of the major advantages of this approach.</p>
<p>Of course, there are other ways to achieve similar results without using a bootable container model:</p>
<ul>
<li>You can write shell scripts or Ansible playbooks and hope that they accurately capture changes to the system so that they can be reliably undone. Typically, configuration drift that occurs as software gets updated is not addressed.</li>
<li>With <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-sysext.html">systemd-sysext(8)</a>, you can create a squashfs image of a filesystem containing your theming changes for <code>/usr</code> and overlay it on top of the root filesystem. An ecosystem around how these images should be created, maintained, deployed and updated has yet to emerge.</li>
<li>You can inscribe your custom theming as runes in an arcane and inscrutable functional language known only to the elders as N̸̘̏͑̕͝į̸̈́̂x̸͙̑̅̒.</li>
</ul>
<p>In my opinion, none of the alternatives provide the same level of flexibility and tooling support as writing a Dockerfile, nor can they achieve bootc’s level of safety and reliability by making it extremely difficult to bork your <code>/usr</code> directory. And if the <code>/usr</code> directory somehow gets borked anyway, rolling back to the previously deployed container is just a reboot away.</p>
<h2 id="what-is-a-distro">What Is A Distro?<a href="#what-is-a-distro" arialabel="Anchor">⌗</a> </h2>

<p>A few weeks ago, an OCI image based on Fedora Xfce Atomic that I made called <a href="https://github.com/winblues/blue95">Blue95</a> was posted to <a href="https://news.ycombinator.com/item?id=43524937">Hacker News</a>. For the most part, the reception was warm but there were some interesting questions that were raised, such as:</p>
<blockquote>
<p>Is it really necessary to spin up an entirely new distro for an XFCE+GTK theme?</p></blockquote>
<p>The original poster made me question the nature of the project I created: is it a distro? In the age of bootc, the distinction between what is considered a Linux distribution and what is simply a Containerfile + CI/CD is, in my opinion, murky at best. Historically, the barrier to entry for creating what has traditionally been called a Linux distribution was orders of magnitude higher than creating and publishing an OCI container. My nights-and-weekends side project of building a bootable container is a far cry from what I imagine a Linux distribution to be.</p>
<p><a href="https://blues.win/95">Blue95</a> is a collection of scripts and YAML files cobbled together to produce a Containerfile, which is built via GitHub Actions and published to the GitHub Container Registry. Which part of this process elevates the project to the status of a Linux distribution? What set of <code>RUN</code> commands in the Containerfile take the project from being merely a Fedora-based OCI image to a full-blown Linux distribution?</p>
<p>Popular bootc-based projects like <a href="https://projectbluefin.io">Project Bluefin</a> and <a href="https://bazzite.gg">Bazzite</a> are often labeled as Linux distributions, much to the consternation of their creators and maintainers. But if you’ve ever used Bazzite and booted directly into Steam’s Big Picture Mode, you might agree that it does indeed feel like its own Linux distribution; it is quite distinct from its twin bases of <a href="https://fedoraproject.org/atomic-desktops/silverblue/">Fedora Silverblue</a> and <a href="https://fedoraproject.org/atomic-desktops/kinoite/">Fedora Kinoite</a>.</p>
<p>Maybe the imprecision of the term “Linux distribution” is most evident when arguments arise over what is and isn’t a distro. It has always been problematic to define a distribution as simply a curated collection of software plus a Linux kernel -— but that definition is now especially lacking, as it could just as easily describe any Containerfile for a bootable container. Ultimately, “I know it when I see it” may be the best we can do when deciding whether a project deserves the label Linux distribution or not.</p>
<p>Finally, to address the original question about the necessity of spinning up a new distro just for a theme: creating a bootable container with a consistent visual design and curated set of applications can bring a bit of <strong>joy and levity</strong>. At this moment, my laptop is booted from a container that I have created myself. The operating system being used to draft these words is the product of my own artistic and creative expression – built on the work of countless other human beings. And that brings me joy.</p>
<hr/>
<figure>
<a href="https://blues.win/images/ty4reading.png"><img src="https://blues.win/images/ty4reading.png"/></a>
</figure>

      </div></div></div>
  </body>
</html>
