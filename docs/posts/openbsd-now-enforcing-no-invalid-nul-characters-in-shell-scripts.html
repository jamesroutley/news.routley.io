<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.undeadly.org/cgi?action=article;sid=20240924105732">Original</a>
    <h1>OpenBSD now enforcing no invalid NUL characters in shell scripts</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>Contributed by
<a href="https://nxdomain.no/~peter/blogposts/">Peter N. M. Hansteen</a>
on <time datetime="2024-09-24T09:46:45Z">2024-09-24</time>
from the feed me NUL, you go POOF dept.</p><p>
Our favorite operating system is now <a href="https://marc.info/?l=openbsd-cvs&amp;m=172712621620348&amp;w=2">changing</a> the default shell (<a href="https://man.openbsd.org/ksh">ksh</a>) to enforce <em>not</em> allowing invalid NUL characters in input that will be parsed as parts of the script.
</p><p>
The <a href="https://marc.info/?l=openbsd-cvs&amp;m=172712621620348&amp;w=2">commit message</a> reads,
</p><blockquote><pre>List:       openbsd-cvs
Subject:    CVS: cvs.openbsd.org: src
From:       Theo de Raadt &lt;deraadt () cvs ! openbsd ! org&gt;
Date:       2024-09-23 21:18:33

CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2024/09/23 15:18:33

Modified files:
	bin/ksh        : shf.c 

Log message:
If during parsing lines in the script, ksh finds a NUL byte on the
line, it should abort (&#34;syntax error: NUL byte unexpected&#34;).  There
appears to be one piece of software which is misinterpreting guidance
of this, and trying to depend upon embedded NUL.  During research,
every shell we tested has one or more cases where a NUL byte in the
input or inside variable contents will create divergent behaviour from
other shells.  (ie. gets converted to a space, is silently skipped, or
aborts script parsing or later execution).  All the shells are written
in C, and majority of them use C strings for everything, which means
they cannot embed a NUL, so this is not surprising.  It is quite
unbelievable there are people trying to rewrite history on a lark, and
expecting the world to follow alone.
</pre></blockquote>

<blockquote><pre>If there is ONE THING the Unix world needs, it is for bash/ksh/sh to
stop diverging further by permitting STUPID INPUT that cannot
plausibly work in all other shells.  We are in a post-Postel world.

It remains possible to put arbitrary bytes *AFTER* the parts of the
shell script that get parsed &amp; executed (like some Solaris patch files
do).  But you can&#39;t put arbirary bytes in the middle, ahead of shell
script parsed lines, because shells can&#39;t jump to arbitrary offsets
inside the input file, they go THROUGH all the &#39;valid shell script
text lines&#39; to get there.

This was in snapshots for more than 2 months, and only spotted one
other program depending on the behaviour (and that test program did
not observe that it was therefore depending in incorrect behaviour!!)

ok ingo.  Softer ok&#39;s from various others.
</pre></blockquote>
<p>
So here it is again, an example of <a href="https://www.openbsd.org">OpenBSD</a> making software behavior saner for all of us.
</p><p>
Please note that to enjoy this <a href="https://marc.info/?l=openbsd-cvs&amp;m=172712621620348&amp;w=2">change</a>, you need to be running <a href="https://www.openbsd.org/faq/current.html">OpenBSD<code>-current</code></a>, since change occurred <em>after</em> <a href="https://www.openbsd.org/76.html">OpenBSD 7.6</a> was tagged.
</p></div></div>
  </body>
</html>
