<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://kennethfriedman.org/thoughts/2021/mit-scheme-on-apple-silicon/">Original</a>
    <h1>MIT Scheme on Apple Silicon</h1>
    
    <div id="readability-page-1" class="page"><article>
				<p>Despite rumors on the internet — from the GNU website, no less —  you can in fact run MIT Scheme on a computer with Apple Silicon (aka, an M1 Mac). This post will provide step-by-step instructions to getting Scheme up and running on a shiny new Mac.</p>
				
				<p>The key is to macOS&#39;s built-in emulation system to run the x86 version of MIT Scheme. Scheme won&#39;t be running natively on Apple Silicon, but it <em>will be running</em> — and sometimes that&#39;s enough.</p>
				
				<p>There are three parts to this setup:</p>
				
				<ol>
				<li>Download x86 Scheme</li>
				<li>Run Terminal in Emulation Mode</li>
				<li>Fix the Source Code</li>
				</ol>
				
				<p>It&#39;s not a pretty solution, but at least it&#39;s fairly straightforward, and I estimate that it should take about 15 minutes to follow the setup steps below.</p>
				
				<p>This guide has been tested on MacOS Monterary, version 12.0.1. I would guess that these instructions will apply to any recent version of MacOS.</p>
				
				<h3>1. Download x86 Scheme</h3>
				
				<section>
				<div>
				    <p>You&#39;ll first need to download Scheme, making sure to download the x86 architecture version.</p>
				    <p><strong>1.1</strong>: Navigate to the <a href="https://www.gnu.org/software/mit-scheme/">MIT Scheme page</a> on the GNU website.</p>
				    <p><strong>1.2</strong>: Scroll down to the <em>Downloads</em> section, look at the <b>Stable Release</b> table, and click or download the &#34;Unix binary&#34; link for the x86-64 architecture.</p>
				    <p>At the time of writing this, the stable version is 11.2.</p>
				</div>
				<p>
				    <img src="https://kennethfriedman.org/thoughts/2021/mit-scheme-on-apple-silicon/img/step1-1.png"/>
				</p>
				</section>
				
				<h3>2. Run Terminal in Emulation Mode</h3>
				
				<section>
				<div>
				    <p>Next, you&#39;ll need to run a version of Terminal in emulation mode, to ensure that the compilation step uses x86 instructions.</p>
				    <p><strong>2.1</strong>: Navigate to Terminal.app in Finder. This is most likely in <code>/Applications/Utilities</code>.</p>
				    <p><strong>2.2</strong>: Duplicate the Terminal app by right clicking and selecting <em>Duplicate</em>.</p>
				</div>
				<p><img src="https://kennethfriedman.org/thoughts/2021/mit-scheme-on-apple-silicon/img/step2-1.png"/></p>
				</section>
				
				<section>
				<div>
				    <p><strong>2.3</strong>: Rename the newly duplicated Terminal app, so that you can differentiate between the two Terminals. I named mine <em>Terminal (Rosetta)</em> – but the name choice is up to you.</p>
				    <p><strong>2.4</strong>: Right click on your new Terminal —  <em>Terminal (Rosetta)</em> — and select <em>Get Info</em>.</p>
				    <p><strong>2.5</strong>: In the <em>Get Info</em> Window, check the box <em>Open With Rosetta</em>.</p>
				</div>
				<p><img src="https://kennethfriedman.org/thoughts/2021/mit-scheme-on-apple-silicon/img/step2-3.png"/></p>
				</section>
				
				<h3>3. Fix the Source Code</h3>
				
				<p>This may sound like the hardest part, but it&#39;s not too bad. The source code as-is does not compile, even in emulation mode. There are two lines of code that need to be changed.</p>
				
				
				
				<p><strong>3.1</strong>: Edit the <code>macosx-starter.c</code> file:</p>
				
				<p>This file should be located at <code>mit-scheme-11.2/src/microcode/macosx-starter.c</code>.
				</p><p>Use the text editor of your choice and navigate to <em>line 58</em>. It should currently read:
				
				</p><pre>pid = (vfork ());</pre>
				
				<p>The <code>vfork</code> command has been deprecated in favor of, simply, <code>fork</code>.</p>
				
				<p>Modify the command by deleting the character &#39;<em>v</em>&#39;. So <em>line 58</em> should now read:</p>
				
				<pre>pid = (fork ());</pre>
				
				
				
				<p><strong>3.2</strong>: Edit the <code>uxsig.c</code> file:</p>
				
				<p>This file should be located at <code>mit-scheme-11.2/src/microcode/uxsig.c</code>.
				</p><p>Use the text editor of your choice and navigate to <em>line 1197</em>. It should currently read:</p>
				
				<pre>debug_back_trace ((outf_channel) to_dump);</pre>
				
				<p>This line won&#39;t compile. I&#39;m not sure why, but it appears safe to comment out. Either delete the line, or simply add two slashes in the front of the line. I prefer commenting out:</p>
				
				<pre>  // debug_back_trace ((outf_channel) to_dump);</pre>
				
				
				
				<p><strong>3.3</strong>: You&#39;ve now made the necessary changes to the source code, and you are ready to compile.</p>
				
				<p>Using the <em>Terminal (Rosetta)</em> app, <code>cd</code> into the <code>mit-scheme-11.2/src</code> folder.</p>
				
				<p>From there, run the following three commands:</p>
				
				<pre>				./configure
				make
				make install</pre>
				
				<p>Scheme should now be properly installed. You will not need to use Rosetta Terminal to run scheme, it was only needed for the compilation steps.</p>
				
				<p>To confirm it&#39;s working, open a normal (non-Rosetta) Terminal window. Type <code>scheme</code> or <code>mit-scheme</code>. You should see the Scheme REPL, and you are on your way.</p>
				
				<p><em>(Note: if you use this guide and run into issues, please feel free to contact me and I can try to help.)</em></p>
			</article></div>
  </body>
</html>
