<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ntietz.com/blog/too-much-of-a-good-thing-the-cost-of-excess-testing/">Original</a>
    <h1>Too much of a good thing: the trade-off we make with tests</h1>
    
    <div id="readability-page-1" class="page"><div><p>I&#39;ve worked places where we aspired to (but did not reach) 100% code coverage.
We used tools like a code coverage ratchet to ensure that the  test coverage always went up and never down.
This had a few effects.</p>
<p>One of them was the intended effect: we wrote more tests.
Another was unintended: we would sometimes write <em>unrelated</em> tests or hack things to &#34;cheat&#34; the ratchet.
For example, if you refactored well-tested code to be smaller, code coverage goes <em>down</em> but the codebase is better, so you have to work around that.</p>
<p>It&#39;s well known that targeting 100% code coverage is a bad idea, but the question is why, and where should we draw the line?</p>
<p>There are many reasons why you don&#39;t want to hit 100% code coverage in a typical scenario.
But one that&#39;s particularly interesting to me is the <em>value trade-off</em> you make when you&#39;re writing tests.</p>
<h2 id="why-do-we-write-tests"><strong>Why do we write tests?</strong></h2>
<p>Tests ultimately exist only to serve the code we write, and that code is there to solve a problem.
If adding a test doesn&#39;t help you solve the problem, it&#39;s not a great use of time and money.</p>
<p>The way that tests help you solve problems is by <strong>mitigating risk</strong>.
They let you check your work and validate that it&#39;s probably reasonably correct (and if you want even higher confidence, you start looking to formal methods).
Each test gives you a bit more confidence in the code that&#39;s tested, because it means that in more configurations and with more inputs, you got the result you expected.</p>
<p>Test code itself does not directly deliver value.
It&#39;s valuable for its loss prevention, both in terms of the real harm of bugs (lost revenue, violated privacy, errors in results) and in terms of the time spent detecting and fixing those bugs.
We don&#39;t like paying that cost, so we pay for tests instead.
It&#39;s an insurance policy.</p>
<h2 id="how-much-risk-do-you-want"><strong>How much risk do you want?</strong></h2>
<p>When you pay for insurance, you are offered a menu of options.
You can get more coverage—a lower deductible, higher limits, and extra services—if you pay a higher premium.
Selecting your policy is selecting how much risk you want to take on, or how much you can afford to avoid.</p>
<p>In the same way that insurance reduces the risk of a sudden outflow of cash, a test suite reduces the risk of a sudden major bug with its direct costs and labor costs.
And just like with insurance, we have different options for how many tests we have.
We can&#39;t afford all the options.
We&#39;re not going to formally verify a web app<sup><a href="#or-are-we">1</a></sup>.
But we <em>are</em> going to write tests, so we have to choose what we pay in the premium and what we pay when an accident happens.</p>
<p>If you aim for 100% code coverage, you&#39;re saying that ultimately <em>any</em> risk of bug is a risk you want to avoid.
And if you have no tests, you&#39;re saying that it&#39;s okay if you have severe bugs with maximum cost.</p>
<h2 id="detecting-when-you-re-paying-too-much-for-tests"><strong>Detecting when you&#39;re paying too much for tests</strong></h2>
<p>The question ultimately becomes, how do we select how much risk we want to take on for tests?
This is often an implicit decision: someone reads an article that says &#34;more code coverage good&#34; and they add in a code ratchet tool<sup><a href="#kyle">2</a></sup> and then people start writing more tests because it&#39;s our culture, man!</p>
<p>The better way is to be deliberate about the decision.
This is something where we as ICs can inform management about the risks and the costs, and ultimately management decides how much to invest in testing and how much risk to mitigate.</p>
<p>Note, however, that <strong>there are some tests we have an ethical obligation to write</strong>.
If you&#39;re working on a pacemaker, you have a <em>much</em> higher minimum bar for testing (and other forms of assurance), because your software <em>will kill people</em> if you get it wrong<sup><a href="#what-about-weapons">3</a></sup>.
It&#39;s unacceptable for management or engineers to try to take on that risk.
For the rest of this discussion, I&#39;m going to assume that we&#39;re <em>above that minimum bar</em> and within the range of risk that it&#39;s both legal and ethical to choose from.</p>
<p>Part of the trouble with communicating the risk-cost trade-off here is that it&#39;s difficult to quantify.
But there are ways that we can make that more clear, and it&#39;s worth it to have that discussion to make the trade-off more explicit.</p>
<p>To measure the trade-off, you ultimately need to have two numbers:</p>
<ul>
<li><em>The cost of writing tests</em>.
To get this number, you have to measure how much time is spent on testing.
If you have a dedicated test team, their time is all counted in this.
You also include the portion of time spent for each task which is spent writing tests.
You don&#39;t need to measure this for every ticket, just a sampling to get the breakdown.</li>
<li><em>The cost of bugs.</em>
Getting this number is more complicated.
Some bugs have a clear cost if they cause a customer to churn in an attributable way, but many bugs are
more implicit in how they erode trust and produce harms.
You <em>can</em> measure the time your engineering team spends on triaging and fixing bugs, and this is one of the primary costs.
The rest of it—the direct costs of bugs—you&#39;ll have to estimate with management and product.
The idea here is just to get close enough to understand the trade-off, not to be exact.</li>
</ul>
<p>Once you have these two numbers, you can start to back into what the right trade-off is for you.
The obvious first thing is that the cost of writing tests should be lower than the cost of bugs, or it&#39;s clearly not worth it and you&#39;ve made a bad trade-off<sup><a href="#vacuous-pacemaker">4</a></sup>!</p>
<p>When you communicate those numbers with management, make sure to highlight also that there&#39;s the opportunity cost of writing tests instead of code.
If your company is in a make-or-break moment it may be a much better idea to go all-hands-on-deck and minimize tests to maximize short-term feature productivity.
This isn&#39;t a free trade-off, because you&#39;ll pay for those bugs later down the road, and it will compound, but for startups with very <em>very</em> short runways, it can make sense.</p>
<p>Another signal that you&#39;re making the wrong trade-off is if you can&#39;t quantify the cost of bugs because you don&#39;t have enough bugs to quantify.
That means that you&#39;re probably spending too much time catching and preventing bugs, and you should spend more time creating or improving features.
(That, or you&#39;re not getting bug reports, which is bad for all sorts of <em>different</em> reasons.)</p>
<hr/>
<p>How do you manage this trade-off on your team?
Have you made it explicit, or is it implicit?</p>
<hr/>
<div id="or-are-we"><p><sup>1</sup></p><p>If you <em>are</em> doing formal verification of web apps, <em>please</em> let me know. I&#39;d love to be a fly on the wall and learn more.</p>
</div>
<div id="kyle"><p><sup>2</sup></p><p>I&#39;m looking at you, Kyle.</p>
</div>
<div id="what-about-weapons"><p><sup>3</sup></p><p>This raises an ethical question: if it&#39;s wrong to write bad code for a pacemaker because that could kill someone, is it also wrong to write good code for a weapon since that would also kill someone?<sup><a href="#yes">5</a></sup></p>
</div>
<div id="vacuous-pacemaker"><p><sup>4</sup></p><p>For things like pacemakers, the cost of bugs is infinite, so this is always satisfied.</p>
</div>
<div id="yes"><p><sup>5</sup></p><p>Yes, but also, it&#39;s complicated. Writing bad code could also kill someone <em>else</em>. The only winning move is to not play (where the game here is &#34;writing code for weapons&#34;).</p>
</div>
</div><p>
    If this post was enjoyable or useful for you, <strong>please share it!</strong>
    If you have comments, questions, or feedback, you can email <a href="mailto:me@ntietz.com">my personal email</a>.
    To get new posts and support my work, subscribe to the <a href="https://helixml.substack.com/newsletter/">newsletter</a>. There is also an <a href="https://helixml.substack.com/atom.xml">RSS feed</a>.
  </p></div>
  </body>
</html>
