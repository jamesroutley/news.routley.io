<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.theregister.com/2025/03/08/kernel_sanders_apple_rearranges_xnu/">Original</a>
    <h1>Apple rearranged its XNU kernel with exclaves</h1>
    
    <div id="readability-page-1" class="page"><div id="body">
<p>Apple has been working to harden the XNU kernel that powers its various operating systems, including iOS and macOS, with a feature called &#34;exclaves.&#34;</p>
<p>The term appears to have first surfaced <a target="_blank" rel="nofollow" href="https://github.com/apple-oss-distributions/Libc/commit/c5a3293354e22262702a3add5b2dfc9bb0b93b85">in a libc file</a> in Apple&#39;s open source software collection in 2023, and subsequently within iOS 17, released in September of that year, as later <a target="_blank" rel="nofollow" href="https://eclecticlight.co/2024/06/15/a-brief-history-of-mac-enclaves-and-exclaves/">noted</a> by Howard Oakley on his Eclectic Light Co blog.</p>
<p>Exclaves, Oakley observed last June, are believed to implement &#34;domains isolated from the kernel that protect key functions in macOS even when the kernel becomes compromised. This in turn suggests that Apple is in the process of refactoring the kernel into a central microkernel with protected exclaves.&#34;</p>

    

<p>Current Apple chips have a <a target="_blank" rel="nofollow" href="https://support.apple.com/guide/security/secure-enclave-sec59b0b31ff/1/web/1">Secure Enclave</a>, a dedicated secure subsystem integrated into the device&#39;s system-on-chip (SoC). It&#39;s separate from the application processor kernel as a defense against compromise. It&#39;s used for operations that need strong security like the processing of encryption keys.</p>

        


        

<p>An <em>enclave</em> is defined as an area within a territorial boundary. So an <em>exclave</em> is an area outside of a boundary with ties to the main territory.</p>
<p>The XNU kernel, as Apple&#39;s <a target="_blank" rel="nofollow" href="https://github.com/apple-oss-distributions/xnu">documentation</a> explains, is &#34;a hybrid kernel combining the Mach kernel developed at Carnegie Mellon University with components from FreeBSD and a C++ API for writing drivers called IOKit.&#34;</p>

        

<p>It is hybrid in the sense that it combines the Mach microkernel with the BSD monolithic kernel.</p>
<p>Each architectural approach has different disadvantages. Microkernel designs face the challenge of dealing with the overhead of inter-process communication (IPC) between user-space servers and the kernel. Monolithic designs operate in a shared address space, so security compromises are potentially more damaging – once defenses have been bypassed, there&#39;s no further barrier to sensitive data.</p>
<p>According to a security researcher who has <a target="_blank" rel="nofollow" href="https://randomaugustine.medium.com/on-apple-exclaves-d683a2c37194">explored Apple&#39;s kernel fiddling</a> under the name Random Augustine, Apple&#39;s development of exclaves represents a major shift in its security architecture. Essentially, Apple is trying to realize the security advantages of a microkernel without tossing the monolithic aspects of XNU.</p>
<ul>

<li><a href="https://www.theregister.com/2025/03/05/apple_m3_ultra_mac_studio/">Run DeepSeek R1 on an Apple M3 Ultra Mac Studio? Sure, it&#39;ll just cost you $9,499-plus</a></li>

<li><a href="https://www.theregister.com/2025/03/05/apple_reportedly_ipt_complaint/">Apple drags UK government to court over &#39;backdoor&#39; order</a></li>

<li><a href="https://www.theregister.com/2025/03/05/outlookcom_ios/">iOS users left refreshing in vain as Microsoft Outlook woes drag on</a></li>

<li><a href="https://www.theregister.com/2025/03/04/apple_iphone_16e_ifixit/">Apple dares users to fix &#39;budget&#39; iPhone 16e themselves</a></li>
</ul>
<p>Based on the references to exclaves in the XNU source for Apple&#39;s Arm-compatible M4 chips and the A18 processors used in iPhone 16, our source argues that exclaves form the basis of a significant redesign of XNU&#39;s security model.</p>
<p>&#34;In iOS 18, exclaves refer to specific resources that are separated from the main iOS kernel (XNU) and cannot be accessed by it, even if the kernel is compromised,&#34; the researcher explained in a document shared with <em>The Register</em>.</p>

        

<p>&#34;These resources are predefined when the OS is built, are identified by name or id, have different types, are initialized at boot time, and are organized into unique domains.&#34;</p>
<p>These resources include:</p>
<ul>
<li>Shared memory buffers that can be accessed by both the kernel and the exclave, with the option to make them read-only or read-write to XNU.</li>

<li>Audio buffers and sensors that are used for securing features like the camera and microphone access indicators.</li>

<li>Conclaves that group multiple resources into their own secure domains.</li>

<li>Services that offer executable code within the exclave space when called upon by threads in XNU.</li>
</ul>
<p>These resources are protected from XNU via enclave-specific page-types via the Secure Page Table Monitor, a hardware security functionality introduced with the arrival of the A15 chip and iOS 17. This makes Apple&#39;s operating systems more secure by compartmentalizing sensitive services, such that the compromise of one doesn&#39;t process access to the entire kernel address space.</p>
<p>Apple has enabled the execution of exclave services via a new Secure Kernel (SK). The researcher Random Augustine has observed that while the SK image file contains a version string for &#34;cL4,&#34; a possible reference to the L4-embedded used with the original SepOS (Secure Enclave Processor OS) cL4 kernel, the IPC structures used by XNU to communicate with SK look more like <a target="_blank" rel="nofollow" href="https://sel4.systems/">seL4</a>, a high-assurance microkernel.</p>
<blockquote>

<p>It&#39;s adding defense in depth and isolating more parts of the OS from each other</p>
</blockquote>
<p>Gernot Heiser, a computer science professor at UNSW Sydney and the founding chairman of the seL4 Foundation, <a target="_blank" rel="nofollow" href="https://bsky.app/profile/microkerneldude.bsky.social/post/3ljhapekfj22u">via Bluesky</a> has suggested that Apple&#39;s SK is probably not an seL4 adaptation, which would be a GPL violation, but rather is a fresh implementation.</p>
<p>The obvious reason Apple would undertake this work is to improve security generally, which benefits the super-corp and its customers. The less obvious reason is that AI workloads running on-device and communicating with Apple&#39;s Private Cloud Compute infrastructure potentially expand the attack surface, so it makes sense to mitigate the blast radius of attacks by adopting microkernel architecture.</p>
<p>&#34;This isn&#39;t aimed at a particular vulnerability – it&#39;s adding defense in depth and isolating more parts of the OS from each other,&#34; Random Augustine opined.</p>
<p>&#34;So an attacker will need to find an extra vulnerability to attack things held in exclaves or to escape an exclave. Exclaves will likely be much harder to escape because they are running in a microkernel environment. Some of the code and libraries over there are also written in Swift which should increase memory safety.&#34;</p>
<p>Our source reports inquiring to an Apple engineer about why the iGiant hasn&#39;t been talking up this technology. The reason is, we&#39;re told, that Apple hasn&#39;t yet finished the project and likely doesn&#39;t yet have the confidence to make security claims.</p>
<p>Apple did not respond to a request for comment. ®</p>                                
                    </div></div>
  </body>
</html>
