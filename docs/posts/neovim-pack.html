<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://neovim.io/doc/user/pack.html#vim.pack">Original</a>
    <h1>Neovim Pack</h1>
    
    <div id="readability-page-1" class="page"><div>
  <a name="pack.txt" href="#packages"></a>
  <p>
    <i>
    Nvim <code>:help</code> pages, <a href="https://github.com/neovim/neovim/blob/master/src/gen/gen_help_html.lua">generated</a>
    from <a href="https://github.com/neovim/neovim/blob/master/runtime/doc/pack.txt">source</a>
    using the <a href="https://github.com/neovim/tree-sitter-vimdoc">tree-sitter-vimdoc</a> parser.
    </i>
  </p>
  <hr/>
  <p>
                                Extending Nvim

</p>
<p>
<h2 id="_using-vim-packages">Using Vim packages</h2>


</p>
<div><p>
A Vim &#34;package&#34; is a directory that contains <a href="https://neovim.io/doc/user/usr_05.html#plugin">plugin</a>s.  Compared to normal
plugins, a package can...
</p><p> be downloaded as an archive and unpacked in its own directory, so the files
  are not mixed with files of other plugins.
</p><p> be a git, mercurial, etc. repository, thus easy to update.
</p><p> contain multiple plugins that depend on each other.
</p><p> contain plugins that are automatically loaded on startup (&#34;start&#34; packages,
  located in &#34;pack/*/start/*&#34;) and ones that are only loaded when needed with
  <a href="https://neovim.io/doc/user/repeat.html#%3Apackadd">:packadd</a> (&#34;opt&#34; packages, located in &#34;pack/*/opt/*&#34;).
</p>
</div>

<div><p>
Note that the &#34;pack/*/start/*&#34; paths are not explicitly included in
<a href="https://neovim.io/doc/user/options.html#&#39;runtimepath&#39;">&#39;runtimepath&#39;</a>, so they will not be reported by &#34;:set rtp&#34; or &#34;echo &amp;rtp&#34;.
Scripts can use <a href="https://neovim.io/doc/user/api.html#nvim_list_runtime_paths()">nvim_list_runtime_paths()</a> to list all used directories, and
<a href="https://neovim.io/doc/user/api.html#nvim_get_runtime_file()">nvim_get_runtime_file()</a> to query for specific files or sub-folders within
the runtime path. Example:</p><pre>&#34; List all runtime dirs and packages with Lua paths.
:echo nvim_get_runtime_file(&#34;lua/&#34;, v:true)</pre>
<p>Using a package and loading automatically</p>

</div>
<div><p>
Let&#39;s assume your Nvim files are in &#34;~/.local/share/nvim/site&#34; and you want to
add a package from a zip archive &#34;/tmp/foopack.zip&#34;:</p><pre>% mkdir -p ~/.local/share/nvim/site/pack/foo
% cd ~/.local/share/nvim/site/pack/foo
% unzip /tmp/foopack.zip</pre><p>
The directory name &#34;foo&#34; is arbitrary, you can pick anything you like.

</p></div>
<div><p>
You would now have these files under ~/.local/share/nvim/site:</p><pre>pack/foo/README.txt
pack/foo/start/foobar/plugin/foo.vim
pack/foo/start/foobar/syntax/some.vim
pack/foo/opt/foodebug/plugin/debugger.vim</pre><p>
On startup after processing your <a href="https://neovim.io/doc/user/starting.html#config">config</a>, Nvim scans all directories in
<a href="https://neovim.io/doc/user/options.html#&#39;packpath&#39;">&#39;packpath&#39;</a> for plugins in &#34;pack/*/start/*&#34;, then loads the plugins.

</p></div>
<p>
To allow for calling into package functionality while parsing your <a href="https://neovim.io/doc/user/starting.html#vimrc">vimrc</a>,
<a href="https://neovim.io/doc/user/syntax.html#%3Acolorscheme">:colorscheme</a> and <a href="https://neovim.io/doc/user/userfunc.html#autoload">autoload</a> will both automatically search under <a href="https://neovim.io/doc/user/options.html#&#39;packpath&#39;">&#39;packpath&#39;</a>
as well in addition to <a href="https://neovim.io/doc/user/options.html#&#39;runtimepath&#39;">&#39;runtimepath&#39;</a>.  See the documentation for each for
details.

</p>
<p>
In the example Nvim will find &#34;pack/foo/start/foobar/plugin/foo.vim&#34; and load
it.

</p>
<p>
If the &#34;foobar&#34; plugin kicks in and sets the <a href="https://neovim.io/doc/user/options.html#&#39;filetype&#39;">&#39;filetype&#39;</a> to &#34;some&#34;, Nvim will
find the syntax/some.vim file, because its directory is in the runtime search
path.

</p>
<p>
Nvim will also load ftdetect files, if there are any.

</p>
<p>
Note that the files under &#34;pack/foo/opt&#34; are not loaded automatically, only the
ones under &#34;pack/foo/start&#34;.  See <a href="https://neovim.io/doc/user/pack.html#pack-add">pack-add</a> below for how the &#34;opt&#34; directory
is used.

</p>
<p>
Loading packages automatically will not happen if loading plugins is disabled,
see <a href="https://neovim.io/doc/user/starting.html#load-plugins">load-plugins</a>.

</p>
<p>
To load packages earlier, so that plugin/ files are sourced:
    :packloadall
This also works when loading plugins is disabled.  The automatic loading will
only happen once.

</p>
<p>
If the package has an &#34;after&#34; directory, that directory is added to the end of
<a href="https://neovim.io/doc/user/options.html#&#39;runtimepath&#39;">&#39;runtimepath&#39;</a>, so that anything there will be loaded later.

</p>
<div>
<p>Using a single plugin and loading it automatically</p>

</div>
<div><p>
If you don&#39;t have a package but a single plugin, you need to create the extra
directory level:</p><pre>% mkdir -p ~/.local/share/nvim/site/pack/foo/start/foobar
% cd ~/.local/share/nvim/site/pack/foo/start/foobar
% unzip /tmp/someplugin.zip</pre><p>
You would now have these files:</p><pre>pack/foo/start/foobar/plugin/foo.vim
pack/foo/start/foobar/syntax/some.vim</pre><p>
From here it works like above.

</p></div>

<p>
This could be done if some conditions are met.  For example, depending on
whether Nvim supports a feature or a dependency is missing.

</p>
<div><p>
You can also load an optional plugin at startup, by putting this command in
your <a href="https://neovim.io/doc/user/starting.html#config">config</a>:</p><pre>:packadd! foodebug</pre><p>
The extra &#34;!&#34; is so that the plugin isn&#39;t loaded if Nvim was started with
<a href="https://neovim.io/doc/user/starting.html#--noplugin">--noplugin</a>.

</p></div>
<p>
It is perfectly normal for a package to only have files in the &#34;opt&#34;
directory.  You then need to load each plugin when you want to use it.

</p>

<p>
Since color schemes, loaded with <code>:colorscheme</code>, are found below
&#34;pack/*/start&#34; and &#34;pack/*/opt&#34;, you could put them anywhere.  We recommend
you put them below &#34;pack/*/opt&#34;, for example
&#34;~/.config/nvim/pack/mycolors/opt/dark/colors/very_dark.vim&#34;.

</p>
<div><p>
Filetype plugins should go under &#34;pack/*/start&#34;, so that they are always
found.  Unless you have more than one plugin for a file type and want to
select which one to load with <code>:packadd</code>.  E.g. depending on the compiler
version:</p><pre>if foo_compiler_version &gt; 34
  packadd foo_new
else
  packadd foo_old
endif</pre><p>
The &#34;after&#34; directory is most likely not useful in a package.  It&#39;s not
disallowed though.

</p></div>

<p>
This assumes you write one or more plugins that you distribute as a package.

</p>
<p>
If you have two unrelated plugins you would use two packages, so that Vim
users can choose what they include or not.  Or you can decide to use one
package with optional plugins, and tell the user to add the preferred ones with
<code>:packadd</code>.

</p>
<p>
Decide how you want to distribute the package.  You can create an archive or
you could use a repository.  An archive can be used by more users, but is a
bit harder to update to a new version.  A repository can usually be kept
up-to-date easily, but it requires a program like &#34;git&#34; to be available.
You can do both, github can automatically create an archive for a release.

</p>
<div><p>
Your directory layout would be like this:</p><pre>start/foobar/plugin/foo.vim          &#34; always loaded, defines commands
start/foobar/plugin/bar.vim          &#34; always loaded, defines commands
start/foobar/autoload/foo.vim        &#34; loaded when foo command used
start/foobar/doc/foo.txt             &#34; help for foo.vim
start/foobar/doc/tags                &#34; help tags
opt/fooextra/plugin/extra.vim        &#34; optional plugin, defines commands
opt/fooextra/autoload/extra.vim      &#34; loaded when extra command used
opt/fooextra/doc/extra.txt           &#34; help for extra.vim
opt/fooextra/doc/tags                &#34; help tags</pre>

</div>
<div><p>
This allows for the user to do:</p><pre>mkdir ~/.local/share/nvim/site/pack
cd ~/.local/share/nvim/site/pack
git clone https://github.com/you/foobar.git myfoobar</pre><p>
Here &#34;myfoobar&#34; is a name that the user can choose, the only condition is that
it differs from other packages.

</p></div>
<div><p>
In your documentation you explain what the plugins do, and tell the user how
to load the optional plugin:</p><pre>:packadd! fooextra</pre><p>
You could add this packadd command in one of your plugins, to be executed when
the optional plugin is needed.

</p></div>
<div><p>
Run the <code>:helptags</code> command to generate the doc/tags file.  Including this
generated file in the package means that the user can drop the package in the
pack directory and the help command works right away.  Don&#39;t forget to re-run
the command after changing the plugin help:</p><pre>:helptags path/start/foobar/doc
:helptags path/opt/fooextra/doc</pre>
<p>Dependencies between plugins</p>
                                                        <p><span id="packload-two-steps"><a href="#packload-two-steps">packload-two-steps</a></span></p></div>
<div><p>
pack/foo/start/one/plugin/one.vim</p><pre>call foolib#getit()</pre><p>
pack/foo/start/two/plugin/two.vim</p><pre>call foolib#getit()</pre><p>
pack/foo/start/lib/autoload/foolib.vim</p><pre>func foolib#getit()</pre><p>
This works, because start packages will be searched for autoload files, when
sourcing the plugins.

</p></div>

<p>
WORK IN PROGRESS built-in plugin manager! Early testing of existing features
is appreciated, but expect breaking changes without notice.

</p>
<p>
Manages plugins only in a dedicated <span id="vim.pack-directory"><a href="#vim.pack-directory">vim.pack-directory</a></span> (see <a href="https://neovim.io/doc/user/pack.html#packages">packages</a>):
<code>$XDG_DATA_HOME/nvim/site/pack/core/opt</code>. <code>$XDG_DATA_HOME/nvim/site</code> needs to
be part of <a href="https://neovim.io/doc/user/options.html#&#39;packpath&#39;">&#39;packpath&#39;</a>. It usually is, but might not be in cases like <a href="https://neovim.io/doc/user/starting.html#--clean">--clean</a>
or setting <a href="https://neovim.io/doc/user/starting.html#%24XDG_DATA_HOME">$XDG_DATA_HOME</a> during startup. Plugin&#39;s subdirectory name matches
plugin&#39;s name in specification. It is assumed that all plugins in the
directory are managed exclusively by <code>vim.pack</code>.

</p>
<p>
Uses Git to manage plugins and requires present <code>git</code> executable of at least
version 2.36. Target plugins should be Git repositories with versions as named
tags following semver convention <code>v&lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;</code>.

</p>

<div><p>
Basic install and management:
</p><div><p> Add <a href="https://neovim.io/doc/user/pack.html#vim.pack.add()">vim.pack.add()</a> call(s) to &#39;init.lua&#39;:
</p><pre><code>vim.pack.add({
  -- Install &#34;plugin1&#34; and use default branch (usually `main` or `master`)
  &#39;https://github.com/user/plugin1&#39;,
  -- Same as above, but using a table (allows setting other options)
  { src = &#39;https://github.com/user/plugin1&#39; },
  -- Specify plugin&#39;s name (here the plugin will be called &#34;plugin2&#34;
  -- instead of &#34;generic-name&#34;)
  { src = &#39;https://github.com/user/generic-name&#39;, name = &#39;plugin2&#39; },
  -- Specify version to follow during install and update
  {
    src = &#39;https://github.com/user/plugin3&#39;,
    -- Version constraint, see |vim.version.range()|
    version = vim.version.range(&#39;1.0&#39;),
  },
  {
    src = &#39;https://github.com/user/plugin4&#39;,
    -- Git branch, tag, or commit hash
    version = &#39;main&#39;,
  },
})
-- Plugin&#39;s code can be used directly after `add()`
plugin1 = require(&#39;plugin1&#39;)</code></pre></div>
</div>
<div>
<p> Restart Nvim (for example, with <a href="https://neovim.io/doc/user/gui.html#%3Arestart">:restart</a>). Plugins that were not yet
  installed will be available on disk in target state after <code>add()</code> call.
</p><p> To update all plugins with new changes:
</p><p> Execute <a href="https://neovim.io/doc/user/pack.html#vim.pack.update()">vim.pack.update()</a>. This will download updates from source and
    show confirmation buffer in a separate tabpage.
</p><p> Review changes. To confirm all updates execute <a href="https://neovim.io/doc/user/editing.html#%3Awrite">:write</a>. To discard
    updates execute <a href="https://neovim.io/doc/user/editing.html#%3Aquit">:quit</a>.
</p>
</div>
<div><p>
Switch plugin&#39;s version:
</p><p> Update &#39;init.lua&#39; for plugin to have desired <code>version</code>. Let&#39;s say, plugin
  named &#39;plugin1&#39; has changed to <code>vim.version.range(&#39;*&#39;)</code>.
</p><p><a href="https://neovim.io/doc/user/gui.html#%3Arestart">:restart</a>. The plugin&#39;s actual state on disk is not yet changed.
</p><p> Execute <code>vim.pack.update({ &#39;plugin1&#39; })</code>.
</p><p> Review changes and either confirm or discard them. If discarded, revert any
  changes in &#39;init.lua&#39; as well or you will be prompted again next time you
  run <a href="https://neovim.io/doc/user/pack.html#vim.pack.update()">vim.pack.update()</a>.
</p>
</div>
<div><p>
Freeze plugin from being updated:
</p><p> Update &#39;init.lua&#39; for plugin to have <code>version</code> set to current commit hash.
  You can get it by running <code>vim.pack.update({ &#39;plugin-name&#39; })</code> and yanking
  the word describing current state (looks like <code>abc12345</code>).
</p>
</div>
<div><p>
Unfreeze plugin to start receiving updates:
</p><p> Update &#39;init.lua&#39; for plugin to have <code>version</code> set to whichever version you
  want it to be updated.
</p>
</div>
<div><p>
Remove plugins from disk:
</p><p> Use <a href="https://neovim.io/doc/user/pack.html#vim.pack.del()">vim.pack.del()</a> with a list of plugin names to remove. Make sure their
  specs are not included in <a href="https://neovim.io/doc/user/pack.html#vim.pack.add()">vim.pack.add()</a> call in &#39;init.lua&#39; or they will
  be reinstalled.
</p>
</div>
<div>
<p>Available events to hook into</p>
<p><span id="PackChanged"><a href="#PackChanged">PackChanged</a></span> - after plugin&#39;s state has changed.
</p>
</div>
<div><p>
Each event populates the following <a href="https://neovim.io/doc/user/api.html#event-data">event-data</a> fields:
</p><p><code>kind</code> - one of &#34;install&#34; (install on disk), &#34;update&#34; (update existing
  plugin), &#34;delete&#34; (delete from disk).
</p><p><code>spec</code> - plugin&#39;s specification with defaults made explicit.
</p><p><code>path</code> - full path to plugin&#39;s directory.
</p>
</div>

<div>
<p>Fields:</p>
<p><code>{src}</code>       (<code>string</code>) URI from which to install and pull updates. Any
                    format supported by <code>git clone</code> is allowed.
</p><p><code>{name}</code>     (<code>string</code>) Name of plugin. Will be used as directory name.
                    Default: <code>src</code> repository name.
</p><p><code>{version}</code>  (<code>string|vim.VersionRange</code>) Version to use for install and
                    updates. Can be:
</p><p><code>nil</code> (no value, default) to use repository&#39;s default
                      branch (usually <code>main</code> or <code>master</code>).
</p><p> String to use specific branch, tag, or commit hash.
</p><p> Output of <a href="https://neovim.io/doc/user/lua.html#vim.version.range()">vim.version.range()</a> to install the
                      greatest/last semver tag inside the version constraint.
</p><p><code>{data}</code>     (<code>any</code>) Arbitrary data associated with a plugin.
</p>
</div>

<div>
<p><b>    Notes:</b></p><p> Installation is done in parallel, but waits for all to finish before
      continuing next code execution.
</p><p> If plugin is already present on disk, there are no checks about its
      present state. The specified <code>version</code> can be not the one actually
      present on disk. Execute <a href="https://neovim.io/doc/user/pack.html#vim.pack.update()">vim.pack.update()</a> to synchronize.
</p><p> Adding plugin second and more times during single session does nothing:
      only the data from the first adding is registered.
</p>
</div>
<div>
<p>Parameters:</p>
<p><code>{specs}</code>  (<code>(string|vim.pack.Spec)[]</code>) List of plugin specifications.
                 String item is treated as <code>src</code>.
</p><p><code>{opts}</code>   (<code>table?</code>) A table with the following fields:
</p><p><code>{load}</code>
                   (<code>boolean|fun(plug_data: {spec: vim.pack.Spec, path: string})</code>)
                   Load <code>plugin/</code> files and <code>ftdetect/</code> scripts. If <code>false</code>,
                   works like <code>:packadd!</code>. If function, called with plugin
                   data and is fully responsible for loading plugin. Default
                   <code>false</code> during startup and <code>true</code> afterwards.
</p><p><code>{confirm}</code> (<code>boolean</code>) Whether to ask user to confirm
                   initial install. Default <code>true</code>.
</p>
</div>

<div>
<p>Parameters:</p>
<p><code>{names}</code>  (<code>string[]</code>) List of plugin names to remove from disk. Must
                 be managed by <a href="https://neovim.io/doc/user/pack.html#vim.pack">vim.pack</a>, not necessarily already added to
                 current session.
</p>
</div>

<div>
<p>Return:</p><p>
        (<code>table[]</code>) A list of objects with the following fields:
</p><p><code>{spec}</code> (<code>vim.pack.SpecResolved</code>) A <a href="https://neovim.io/doc/user/pack.html#vim.pack.Spec">vim.pack.Spec</a> with defaults
          made explicit.
</p><p><code>{path}</code> (<code>string</code>) Plugin&#39;s path on disk.
</p><p><code>{active}</code> (<code>boolean</code>) Whether plugin was added via <a href="https://neovim.io/doc/user/pack.html#vim.pack.add()">vim.pack.add()</a>
          to current session.
</p>
</div>

<div>
<p><b>    Notes:</b></p><p> Every actual update is logged in &#34;nvim-pack.log&#34; file inside &#34;log&#34;
      <a href="https://neovim.io/doc/user/vimfn.html#stdpath()">stdpath()</a>.
</p>
</div>
<div>
<p>Parameters:</p>
<p><code>{names}</code>  (<code>string[]?</code>) List of plugin names to update. Must be managed
                 by <a href="https://neovim.io/doc/user/pack.html#vim.pack">vim.pack</a>, not necessarily already added to current
                 session. Default: names of all plugins added to current
                 session via <a href="https://neovim.io/doc/user/pack.html#vim.pack.add()">vim.pack.add()</a>.
</p><p><code>{opts}</code>   (<code>table?</code>) A table with the following fields:
</p><p><code>{force}</code> (<code>boolean</code>) Whether to skip confirmation and make
                   updates immediately. Default <code>false</code>.
</p>
</div>

  </div></div>
  </body>
</html>
