<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://erock.prose.sh/typescript-terrible-for-library-developers">Original</a>
    <h1>TypeScript is terrible for library developers</h1>
    
    <div id="readability-page-1" class="page"><div>
    <article>
        <p>I love typescript as an end-developer. I feel like it dramatically reduces the
need to manually write automated tests. It cannot be overstated how much work is
involved with writing and maintaining good automated tests so anything that can
reduce its utility is a huge boon to productivity.</p>
<p>However, as a library developer, I hate typescript. There are a lot of reasons
why typescript sucks for library developers, but at the end of the day it
reduces developer productivity. In effect, we are shifting complexity from
end-developers to library developers. This places a huge burden on us to be
experts with how typescript works.</p>
<h2 id="documentation">Documentation</h2>
<p>There&#39;s great documentation and blogs for end-developers but there&#39;s very little
for library-developers. The closest thing I can find targeting library
developers is the section on
<a href="https://www.typescriptlang.org/docs/handbook/2/types-from-types.html" rel="nofollow">Type Manipulation</a>.</p>
<p>I think the underlying assumption here is that there is no difference between a
library developer and an end-developer, which I reject.</p>
<p>Why are there no guides on the typescript site about library developers? What
about a guide on the recommended tools for a library developer?</p>
<p>The kind of hoops I have to jump through to get types &#34;just right&#34; in a web app
versus a library is dramatically different. It&#39;s rare in a web app for me to
need constructs like conditional types, type operators, and overloads. As a
library developer, they are <strong>heavily</strong> used. These constructs are highly
dynamic and embed logic into your types. This leads into my next frustration
with typescript which is debugging.</p>
<h2 id="debugging">Debugging</h2>
<p>How do library developers debug their highly dynamic and heavy use of
conditional types, overloads? They bang their head against the keyboard and hope
it works. It seems like the only debugging tool available is the typescript
compiler itself and expertise. You make a change and see what the end result is
for that type. As far as I know there are no better solutions besides having an
intuition about how it all works.</p>
<p>The only tool that I know library developers use heavily is the
<a href="https://www.typescriptlang.org/play" rel="nofollow">Typescript playground</a> so they can isolate
discrete parts of their type logic to figure out why typescript is resolving to
a certain type. It also lets you change the typescript version and config
easily.</p>
<p>What am I missing here? I&#39;m writing this post not only out of frustration but
also because I&#39;m hoping I&#39;ve missed something.</p>
<h2 id="complexity">Complexity</h2>
<p>I spend a decent amount of time in the redux world so <code>redux-toolkit</code> is a great
library to see how types are done <strong>correctly</strong> in a real codebase. To be clear,
they do a fantastic job with types, but the level of complexity is pretty
startling:</p>
<ul>
<li><a href="https://github.com/reduxjs/redux-toolkit/blob/4ab8c42cb20ae1e6f7b84a8ac0070eee54775b79/packages/toolkit/src/createAction.ts#L58" rel="nofollow">createAction #1</a></li>
<li><a href="https://github.com/reduxjs/redux-toolkit/blob/4ab8c42cb20ae1e6f7b84a8ac0070eee54775b79/packages/toolkit/src/createAction.ts#L193" rel="nofollow">createAction #2</a></li>
</ul>
<p>That is just one example but the codebase is riddled with complex types. Also,
when you look around, note the amount of types vs actual code. Purely for
demonstration purposes -- and ignoring imported code -- <strong>only ~10%</strong> (35/330 LoC)
of that file is code that will be transpiled to js.</p>
<p>It&#39;s pretty common in style guides to never nest ternaries. In typescript,
that&#39;s the only way to narrow types based on other types. It&#39;s a mess!</p>
<h2 id="testing">Testing</h2>
<p>Because types can be generated from other types and the highly dynamic nature of
those types, there&#39;s a new class of tests that are required for any serious
typescript project: testing your types. It&#39;s not enough to test your types
against the latest version of the typescript compiler either, you also need to
test against previous versions.</p>
<p>This new class of tests are in their infancy and there&#39;s a barren wasteland of
tools that are now deprecated or partially maintained. I&#39;ve used these libraries
previously:</p>
<ul>
<li><a href="https://github.com/microsoft/DefinitelyTyped-tools" rel="nofollow">DefinitelyTyped-tools</a></li>
<li><a href="https://github.com/SamVerschueren/tsd" rel="nofollow">tsd</a></li>
<li><a href="https://github.com/microsoft/dtslint" rel="nofollow">dtslint (moved)</a></li>
<li><a href="https://github.com/danvk/typings-checker" rel="nofollow">typings-checker (deprecated)</a></li>
</ul>
<p>There&#39;s a lot of churn in this space and I have projects that are still using
deprecated libraries because it&#39;s a huge pain to migrate.</p>
<p>It also seems like there are two recommended tools to use: dtslint and tsd. Why
do we need two tools to do roughly the same job? It&#39;s confusing to figure out
and frustrating to deal with.</p>
<h2 id="maintenance">Maintenance</h2>
<p>Types add a lot of code to your library. When first attempting to contribute to
a project, one must grok the application logic as well as the type logic. This
adds mental and code overhead to a project which really sucks. As an example, I
help maintain <a href="https://github.com/redux-saga/redux-saga" rel="nofollow">redux-saga</a>, and most
of our latest pull requests and issues are specifically related to types.</p>
<blockquote>
<p>I spend more time tweaking types than I do writing library code.</p>
</blockquote>
<p>I&#39;m proficient with typescript but I&#39;m no expert. It&#39;s frustrating because after
spending years writing typescript, I still do not have the necessary knowledge
to work with typescript as a library developer. Mastery seems like a
prerequisite. Types make it much harder to maintain a js library and especially
difficult to contribute to them.</p>
<h2 id="conclusion">Conclusion</h2>
<p>I love typescript and think the team working on it are incredible. Typescript
has completely changed the FE landscape and wouldn&#39;t want to dismiss its
contributions.</p>
<p>But as a library developer, we need:</p>
<ul>
<li>better documentation,</li>
<li>better tooling, and</li>
<li>to spend less time making <code>tsc</code> happy.</li>
</ul>
<p>I shouldn&#39;t have to read the typescript compiler source code in order to figure
out why it&#39;s resolving a piece of my code to a specific type.</p>

    </article>
</div></div>
  </body>
</html>
