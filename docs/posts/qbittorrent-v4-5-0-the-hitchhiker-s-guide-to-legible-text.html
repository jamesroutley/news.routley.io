<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://datalars.com/2023/01/03/qbittorrent-v450-the-hitchhikers-guide-to-legible-text-2/">Original</a>
    <h1>QBittorrent v4.5.0: The Hitchhiker&#39;s Guide to Legible Text</h1>
    
    <div id="readability-page-1" class="page"><article id="post_5">

<section>
<p><em>The story so far: In the beginning, qBittorrent was created. Then they released v4.5.0. This has made a lot of people very angry and been widely regarded as a bad move.</em></p>
<p><small>(If you just want the theme file with completely white text colors, you can download that <a href="https://www71.zippyshare.com/v/HywJ7uYu/file.html">here</a>. Place it somewhere safe, then open qBT, and go to Tools &gt; Preferences &gt; Behaviour and check the checkbox for &#34;Use custom UI theme&#34;. Then browse to the theme file, click OK, and restart qBT)</small></p>

<p>The very bad move in this case, was hard-coding foreground colours, while simultaneously <em>not</em> hard-coding background colours. Most, if not all, operating systems in use today will let you choose a theme for your apps, so you can probably see how this quickly becomes a problem. If your app&#39;s hard-coded foreground colour has poor contrast with the user&#39;s chosen background colour, the user is gonna have a bad time. Sure, they can change their background colour by changing their theme, but why should the user be forced to change their whole system theme because of one app that disregards user choice? So when the eminent qBT team decided to hard-code only one of these, anyone who uses a dark theme in their OS, immediately got problems. </p>
<p>I am a proud KDE user, and like any proud basement-dwelling nerd, I use a dark theme. This dark theme isn&#39;t even an obscure, home-brewed one, it is Breeze Dark, which ships with KDE. This works exceptionally well, and disregarding the odd Java app, it works for <em>all apps</em>, mostly regardless of the UI toolkit used to make them. GTK apps, check. Qt apps, check. </p>
<p>But wait... qBittorrent is a Qt app, right? That&#39;s right, qBT is built with Qt on all platforms. This is great both for the developers who only have to deal with one toolkit, and for the users who can expect a more or less consistent experience across platforms.</p>
<p>Now let&#39;s move on to the evidence phase. Consider the following. This is a screenshot of qBitTorrent v4.3.9 (or as I like to call it, &#34;pre-<em>fuckening</em>&#34;):</p>
<p><img src="https://datalars.com/includes/thumbnail.php?file=screenshot20230103112556.png" alt=""/></p>
<p>Wow, so legible! White text on a dark gray background has really good contrast, and makes the text stand out, so it&#39;s super readable. If I switch to the normal Breeze theme, the background will turn white, and the text will turn black. So logical! It respects my global OS theme! Yay!</p>
<p>But then, through the magic of <code>sudo pkcon update</code> and restarting my computer, on the next launch of qBT, I am met with this horrible sight:</p>
<p><img src="https://datalars.com/includes/thumbnail.php?file=2023-01-0311-43.png" alt=""/></p>
<p>I&#39;m not gonna lie; when I saw this, I let out an audible &#34;what the fuck is this?&#34;. Like a lot of people, I have astigmatism and am near-sighted. If you sit right next to your monitor and have 20/20 vision, then yeah, sure, you might be able to read this. But the fact is, <a href="https://www.who.int/news-room/fact-sheets/detail/blindness-and-visual-impairment">over a fourth of the global population currently has some sort of visual impairment</a>, and if they live long enough, <a href="https://www.lasereyesurgeryhub.co.uk/data/visual-impairment-blindness-data-statistics/">literally <strong>everyone</strong> will develop a vision impairment during their lifetime</a>. The contrast is non-existent; dark blue against a dark gray (or black) background is absolute dogshit for legibility.</p>
<p>Surely, when they decided that <em>L&#39;ard-core Deep Bleu</em> is the new default text colour for everyone, someone must&#39;ve chimed up with something along the lines of <em>&#34;but let it be optional&#34;</em> or <em>&#34;let&#39;s at least include a colour picker or an option to revert to theme-default colours&#34;</em>. No. Of course not. That would be dumb and they would not get invited to the proverbial open-source Christmas party. </p>
<p>Put briefly: <strong>A normal end user cannot do anything about this without significant effort</strong>. No option to revert, no option to change colours, no option to ignore built-in theming and use the OS theme. A normal end user that now cannot read their app anymore will either a) uninstall and use an alternative client, b) downgrade to a previous version, or c) try to find a workaround. All of which are bad for UX. A user should not be forced to downgrade or replace the app in order to read basic, informational text.</p>

<p>Some web searching will reveal that there are custom themes available for qBT. And that is an okay workaround. The problem is, all these custom themes change the whole look of the application, and thus also ignore the user&#39;s system defined theme. But also, v4.5.0 broke most of these custom themes. So, what do we do about this? After trawling through some poorly documented ways of creating themes, I was finally able to make a simple one that only changes the text colors, nothing else. Here is how I did it.</p>
<p>I started <a href="https://github.com/qbittorrent/qBittorrent/wiki/Create-custom-themes-for-qBittorrent">here</a>. Which has an okay-ish explanation of how themes work and how the markup is written, but not much info about how to make the actual theme file, until you find the link to <a href="https://github.com/jagannatharjun/qbt-theme/blob/master/Builds/make-resource.py">this</a>, which is made, quote, &#34;for the easy creation of .qbttheme files&#34;. So sure, I download the Python script and attempt to run it, only to be barraged by error messages about missing resources.</p>
<p>I think &#34;whatever&#34; and start working on the actual code. I read through the documentation which tells me <code>stylesheet.qss</code> is required and tells me a bunch of the rules to put in there, but at the end tells me &#34;jk lol disregard all that and put this in your config file instead&#34;. What a waste of time. I make an empty <code>stylesheet.qss</code> and populate <code>config.json</code> with the following:</p>
<pre><code>{
    &#34;colors&#34;: {
        &#34;TransferList.Downloading&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.StalledDownloading&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.DownloadingMetadata&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.ForcedDownloading&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.Allocating&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.Uploading&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.StalledUploading&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.ForcedUploading&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.QueuedDownloading&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.QueuedUploading&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.CheckingDownloading&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.CheckingUploading&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.CheckingResumeData&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.PausedDownloading&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.PausedUploading&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.Moving&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.MissingFiles&#34;: &#34;#FFFFFF&#34;,
        &#34;TransferList.Error&#34;: &#34;#FFFFFF&#34;     
    }
}
</code></pre>
<p>As you can probably tell, I copy pasted the list from the documentation and made all the text colours pure white. That&#39;s the only change I want, because it&#39;s the only forced change that made a huge difference to someone who can&#39;t tell a frog from a lawn chair, without glasses.</p>
<p>Great! Now I have a zero-byte <code>stylesheet.qss</code> and a <code>config.json</code> with some actual changes in it. Let&#39;s get it packed up into a <code>.qbtheme</code>!</p>
<p>Oh, right. The python script spat out a bunch of errors. I don&#39;t know Python, but I know other programming languages, and I&#39;m generally able work my way around this sort of stuff. Apparently the errors are because you don&#39;t need just this script, you need to clone the whole repository, which isn&#39;t mentioned anywhere. Fine, one <code>git clone https://github.com/jagannatharjun/qbt-theme</code> later, I have a directory full of god knows what. I <code>cd</code> to the right directory and try again, with the following syntax: </p>
<pre><code>python make-resource.py -style stylesheet.qss -config config.json
</code></pre>
<p>But in return, I get this:</p>
<pre><code>/Builds/tools/rcc -binary -o style.qbtheme resources.qrc
Traceback (most recent call last):
  File &#34;make-resource.py&#34;, line 80, in &lt;module&gt;
    if not subprocess.call(cmd):
  File &#34;/usr/lib/python2.7/subprocess.py&#34;, line 172, in call
    return Popen(*popenargs, **kwargs).wait()
  File &#34;/usr/lib/python2.7/subprocess.py&#34;, line 394, in __init__
    errread, errwrite)
  File &#34;/usr/lib/python2.7/subprocess.py&#34;, line 1047, in _execute_child
    raise child_exception
OSError: [Errno 2] No such file or directory
</code></pre>
<p><em>(Note the beautifully named python function <strong>_execute_child</strong>, which is coincidentally what I want to do when I have to spend time on debugging code for a language I don&#39;t know)</em></p>
<p>Right. Line 80 it says. Line 80 of <code>make-resource.py</code> reads as follows:</p>
<pre><code>if not subprocess.call(cmd):
</code></pre>
<p>Clearly, <code>cmd</code> is a variable, which is coincidentally defined a few lines above, on line 77:</p>
<pre><code>cmd = [os.path.join(os.path.dirname(os.path.realpath(__file__)), &#39;tools/rcc&#39;), &#39;-binary&#39;, &#39;-o&#39;, args.output, &#39;resources.qrc&#39;]
</code></pre>
<p>What I gather from this, is that the script is attempting to call a binary located at <code>tools/rcc</code>. But the error Python spits out is <code>No such file or directory</code>, do I have to supply this mysterious binary myself? Huh? That&#39;s when I decide to look inside the <code>tools</code> directory.</p>
<pre><code>$ ls -lah
total 1,1M
drwxrwxr-x 2 lars lars 4,0K Jan  3 12:34 .
drwxrwxr-x 8 lars lars 4,0K Jan  3 12:35 ..
-rw-rw-r-- 1 lars lars 1,1M Jan  3 12:34 rcc.exe
</code></pre>
<p><strong><code>rcc.exe</code></strong>. Real <em>bruh</em> moment. Instead of checking for OS or giving a useful error message, this repository bundles a Windows binary of <code>rcc</code>. But what is <code>rcc</code> I wonder? A web search tells me that rcc stands for Renal cell carcinoma, and I&#39;m sure if I keep reading, I&#39;ll find out I have it. I have a big brain moment and add &#34;qt&#34; to the search, and find out that RCC is the Qt Resource Compiler. That makes sense, and I probably have this somewhere already since I run KDE, right?</p>
<pre><code>$ whereis rcc
rcc: /usr/bin/rcc
</code></pre>
<p>Yay, I already have it installed on my system! I change line 77 of  <code>make-resource.py</code> to:</p>
<pre><code>cmd = [&#39;rcc&#39;, &#39;-binary&#39;, &#39;-o&#39;, args.output, &#39;resources.qrc&#39;]
</code></pre>
<p>I save <code>make-resource.py</code> as a new file, then run it again with the appropriate arguments, and <em>voilà!</em> It works!</p>
<pre><code>$ python make-resource-linux.py -style stylesheet.qss -config config.json
adding ./make-resource-linux.py
adding ./config.json
adding ./stylesheet.qss
[]
rcc -binary -o style.qbtheme resources.qrc
resources.qrc: Warning: potential duplicate alias detected: &#39;stylesheet.qss&#39;
resources.qrc: Warning: potential duplicate alias detected: &#39;config.json&#39;
</code></pre>
<p>For some reason the script added itself to the resource file, but whatever. I save the resulting <code>.qbtheme</code>-file as <code>~/.local/bin/style.qbtheme</code> for safekeeping, then I apply the theme in qBittorrent.</p>
<p>Tada! It works!</p>
<p><img src="https://datalars.com/includes/thumbnail.php?file=2023-01-0313-09.png" alt=""/></p>
<p>Doesn&#39;t that look just positively <em>lovely</em>?</p>

<p>Now, this task, <strong>making previously white text white again</strong>, took me, a technical person, a non-negligible amount of time to figure out (on the magnitude of an hour or two). How is it expected that a normal, non-technical end user is supposed to accomplish this same task before the heat death of the universe? Why do they have to in the first place?</p>
<p>Please, for the love of all that is good and decent in this world, the next time you force a visual change upon users, include a colour picker option to let the user override your choices, or, you know, respect the system theme. I appreciate that qBT is free and open-source software and that resources are limited, but this is UX 101. If you define one colour, you have to define <em>all</em> colours. The best is to define none and let the user decide. Don&#39;t get me wrong, credit where credit is due: I love qBittorrent with a passion, and it is one of my single most-used pieces of software. Functionally, it is <em>fantastic</em>. That being said, hard-coding colours was a bad move.</p>
<p>You can download the resulting all-white-text <code>.qbtheme</code>-file <a href="https://www71.zippyshare.com/v/HywJ7uYu/file.html">here</a>. Place it somewhere safe, then open qBT, and go to Tools &gt; Preferences &gt; Behaviour and check the checkbox for &#34;Use custom UI theme&#34;. Then browse to the theme file, click OK, and restart qBittorrent.</p>

</section>

</article></div>
  </body>
</html>
