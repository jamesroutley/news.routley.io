<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lwn.net/Articles/1034121/">Original</a>
    <h1>The “impossibly small” Microdot web framework</h1>
    
    <div id="readability-page-1" class="page"><div>

<p>
The <a href="https://github.com/miguelgrinberg/microdot?tab=readme-ov-file#microdot">Microdot</a>
web framework is quite small, as its name would imply; it supports both
standard CPython and <a href="https://micropython.org/">MicroPython</a>,
so it can be used on systems ranging from internet-of-things (IoT) devices
all the way up to large, cloudy servers.  It was developed by Miguel
Grinberg, who gave a presentation about it at <a href="https://ep2025.europython.eu/">EuroPython 2025</a>.  His name
may sound familiar from his well-known <a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">Flask
Mega-Tutorial</a>, which has introduced many to the <a href="https://flask.palletsprojects.com/en/stable/">Flask</a> lightweight Python-based
web framework.  It should come as no surprise, then, that Microdot is
inspired by its rather larger cousin, so Flask enthusiasts will find much
to like in Microdot—and will come up to speed quickly should their needs turn
toward smaller systems.
</p>

<p>
We have looked at various pieces of this software stack along the way: <a href="https://lwn.net/Articles/959067/">Microdot</a> itself in January 2024, <a href="https://lwn.net/Articles/931051/">MicroPython</a> in 2023, and Flask as part of a <a href="https://lwn.net/Articles/792882/">look at Python microframeworks</a> in
2019.
</p>

<p>
Grinberg began his talk with an introduction.  He has been living in
Ireland for a few years and &#34;<q>I make stuff</q>&#34;.  That includes <a href="https://github.com/miguelgrinberg">open-source projects</a>, <a href="https://blog.miguelgrinberg.com/index">blog posts</a> (on a
Flask-based blog platform that he wrote), and &#34;<q>a bunch of <a href="https://blog.miguelgrinberg.com/post/my-courses-and-books">books</a></q>&#34;.
He works for Elastic and is one of the maintainers of the <a href="https://github.com/elastic/elasticsearch-py?tab=readme-ov-file#elasticsearch-python-client">Elasticsearch
Python client</a>, &#34;<q>so maybe you have used some of the things that I
made for money</q>&#34;.
</p>

<h4>Why?</h4>

<p>
With a chuckle, he asked: &#34;<q>Why do we need another web framework?  We
have so many already.</q>&#34;  The story starts with a move that he made to
Ireland from the US in 2018; he rented a house with a &#34;smart&#34; heating
controller and was excited to use it.  There were two thermostats, one for
each level of the house, and he was &#34;<q>really looking forward to the
winter</q>&#34; to see the system in action.
</p>

<p>
As might be guessed, he could set target temperatures in each thermostat;
they would communicate with the controller that would turn the heating on
and off as needed.  In addition, the system had a web server that could be
used to query various parameters or to start and stop the heaters.  You
could even send commands via SMS text messages; &#34;<q>there&#39;s a SIM card
somewhere in that box [...] very exciting stuff</q>&#34;.
</p>

<p>
When winter rolled around, it did not work that well, however; sometimes
the house was too chilly or warm and he had to start and stop the heaters
himself. He did some debugging and found that the thermostats were
reporting temperatures that were off by ±3°C, &#34;<q>which is too much for
trying to keep the house at 20°</q>&#34;.  The owner of the house thought that
he was too used to the US where things just work; &#34;<q>at least she thinks that in America everything is super-efficient,
everything works, and she thought &#39;this is the way things work in
Ireland&#39;</q>&#34;.  So he did not make any progress with the owner.
</p>

<p>
At that point, most people would probably just give up and live with the
problem; &#34;<q>I hacked my heating controller instead</q>&#34;.  He set the
temperatures in both thermostats to zero, which effectively disabled their
ability to affect the heaters at all, and built two small boards running
MicroPython, each connected to a temperature and humidity sensor device.
He wrote code that would check the temperature every five minutes and send
the appropriate commands to start or stop the heaters based on what it
found.
</p>

<p>
So the second half of his first winter in Ireland went great.  The sensors
are accurate to ±0.5°C, so &#34;<q>problem solved</q>&#34;.  But, that led to a new
problem for him.  &#34;<q>I wanted to know things: What&#39;s the temperature right
now?  Is the heating running right now or not?  How many hours did it run
today compared to yesterday?</q>&#34;  And so on.
</p>

<p>
He added a small LCD screen to display some information, but he had to
actually go to the device and look at it; what he really wanted was to be
able to talk to the device over WiFi and get information from the couch
while he was watching TV. &#34;<q>I wanted to host a web server [...]  that
will show me a little dashboard</q>&#34;.
</p>

<p>
So he searched for web frameworks
for MicroPython; in the winter of 2018-2019, &#34;<q>there were none</q>&#34;.
Neither Flask nor <a href="https://bottlepy.org/docs/dev/">Bottle</a>,
which is a good bit smaller, would run on MicroPython; both are too large
for the devices,
but, in addition, the standard library for MicroPython is a subset of that of
CPython, so many things that they need are missing. A &#34;<q>normal
person</q>&#34; would likely have just accepted that and moved on; &#34;<q>I
created a web framework instead.</q>&#34;
</p>

<h4>Demo</h4>

<p>
He brought one of his thermostat devices to Prague for the conference and
did a small demonstration of it operating during the talk.  The device was
connected to his laptop using USB, which provided power, but also a serial
connection to the board.  On the laptop, he used the <a href="https://github.com/dhylands/rshell?tab=readme-ov-file#rshell">rshell</a>
remote MicroPython shell to talk to the board, effectively using the laptop
as a terminal.
</p>

<p><a href="https://lwn.net/Articles/1034456/">
<img src="https://static.lwn.net/images/2025/europy-grinberg-sm.png" alt="[Miguel Grinberg]" title="Miguel Grinberg" width="300" height="216"/>
</a></p><p>
He started the MicroPython read-eval-print loop (REPL) on the board in
order to simulate the normal operation of the board.  When it is plugged
into the wall, rather than a laptop, it will boot to the web server, so he
made that happen with a soft-reboot command.  The device then connected to
the conference WiFi and gave him the IP address (and port) where the server
was running.
</p>

<p>
He switched over to Firefox on his laptop and visited the site, which showed a
dashboard that had the current temperature (24.4°) and relative humidity
(56.9%) of the room.  He also used curl from the laptop to contact the
<tt>api</tt> endpoint of the web application, which returned JSON with the
two values and the time.  There is no persistent clock on the board, so the
application contacts an NTP server to pick up the time when it boots; that
allows it to report the last time a measurement was taken.
</p>

<p>
Grinberg said that he wanted to set the expectations at the right level by
looking at the capabilities of the microcontrollers he often uses with
Microdot.  For example, the ESP8266 in his thermostat device has 64KB of
RAM and up to 4MB of flash.  The ESP8266 is the smallest and least expensive (around €5)
device with WiFi that
he has found; there are many even smaller devices, but they lack
the networking required for running a web server.  The other devices
he uses are the Raspberry Pi Pico W with 2MB of flash and 256KB of RAM and
the ESP32 with up to 8MB of flash and 512KB of RAM.  He contrasted those
with his laptop, which has 32GB of RAM, so &#34;<q>you need 500,000
ESP8266s</q>&#34; to have the same amount of memory.
</p>

<h4>Features</h4>

<p>
The core framework of Microdot is in a single <a href="https://github.com/miguelgrinberg/microdot/blob/main/src/microdot/microdot.py"><tt>microdot.py</tt></a>
file.  It is fully asynchronous, using the <a href="https://docs.micropython.org/en/latest/library/asyncio.html">MicroPython
subset</a> of the <a href="https://docs.python.org/3/library/asyncio.html">CPython
<tt>asyncio</tt> module</a>, so it can run on both interpreters.  It uses
<tt>asyncio</tt> because that is the only way to do concurrency on the
microcontrollers; there is no support for processes or threads on those devices.
</p>

<p>
Microdot has Flask-style <a href="https://microdot.readthedocs.io/en/stable/intro.html#defining-routes">route
decorators</a> to define URLs for the application.  It has <a href="https://microdot.readthedocs.io/en/stable/intro.html#the-request-object"><tt>Request</tt></a>
and <a href="https://microdot.readthedocs.io/en/stable/intro.html#responses"><tt>Response</tt></a>
classes, as well as <a href="https://microdot.readthedocs.io/en/stable/intro.html#before-and-after-request-handlers">hooks
to run before and after requests</a>, he said.  Handling query strings,
form data, and JSON are all available in Microdot via normal Python
dictionaries.  Importantly, it can handle streaming requests and responses;
because of the limited memory of these devices, it may be necessary to split
up the handling of larger requests or responses.
</p>

<p>
It supports <a href="https://microdot.readthedocs.io/en/stable/intro.html#setting-cookies">setting
cookies</a> and sending <a href="https://microdot.readthedocs.io/en/stable/intro.html#file-responses">static
files</a>.  Web applications can be constructed from a set of modules, using <a href="https://microdot.readthedocs.io/en/stable/intro.html#mounting-a-sub-application">sub-applications</a>,
which are similar to <a href="https://flask.palletsprojects.com/en/stable/blueprints/">Flask
blueprints</a>.  It also has its own <a href="https://microdot.readthedocs.io/en/stable/intro.html#a-simple-microdot-web-server">web
server</a> with TLS support.  &#34;<q>I&#39;m very proud of all the stuff I was
able to fit in the core Microdot framework</q>&#34;, Grinberg said.
</p>

<p>
He hoped that attendees would have to think for a minute to come up with
things that are missing from Microdot, but they definitely do exist.  There
are some <a href="https://microdot.readthedocs.io/en/stable/extensions.html">officially
maintained extensions</a>, each in its own single <tt>.py</tt> file, to
fill some of those holes.  They encompass functionality that is important,
but he did not want to add to the core because that would make it too large
to fit on the low-end ESP8266 that he is using.
</p>

<p>
There is an extension for <a href="https://microdot.readthedocs.io/en/stable/extensions.html#multipart-forms">multipart
forms</a>, which includes file uploads; &#34;<q>this is extremely complicated
to parse, it didn&#39;t make sense to add it into the core because most people
don&#39;t do this</q>&#34;.  There is support for <a href="https://microdot.readthedocs.io/en/stable/extensions.html#websocket">WebSocket</a>
and <a href="https://microdot.readthedocs.io/en/stable/extensions.html#server-sent-events">server-sent
events</a> (SSE).  <a href="https://microdot.readthedocs.io/en/stable/extensions.html#templates">Templates</a>
are supported using <a href="https://github.com/pfalcon/utemplate?tab=readme-ov-file#utemplate">utemplate</a>
for both Python implementations or <a href="https://jinja.palletsprojects.com/en/stable/">Jinja</a>, which only
works on CPython.  There are extensions for <a href="https://microdot.readthedocs.io/en/stable/extensions.html#authentication">basic
and token-based authentication</a> and for <a href="https://microdot.readthedocs.io/en/stable/extensions.html#user-logins">secure
user logins with session data</a>; the latter required a replacement for
the CPython-only <a href="https://pyjwt.readthedocs.io/en/stable/">PyJWT</a>, which Grinberg
wrote and contributed to MicroPython as <a href="https://github.com/micropython/micropython-lib/blob/master/python-ecosys/pyjwt/jwt.py"><tt>jwt.py</tt></a>.
There is a small handful of other extensions that he quickly mentioned as well.
</p>

<p>
&#34;<q>I consider the documentation as part of the framework</q>&#34;; he is
&#34;<q>kind of fanatical</q>&#34; about documenting everything.  If there is
something missing or not explained well, &#34;<q>it&#39;s a bug that I need to
fix</q>&#34;.  He writes books, so the documentation is organized similarly;
it comes in at 9,267 words, which equates to around 47 minutes of reading
time.  There is 100% test coverage, he said, and there are around 30
examples, with more coming.
</p>

<p>
A design principle that he follows is &#34;<q>no dark magic</q>&#34;.  An example
of dark magic to him is the <a href="https://flask.palletsprojects.com/en/stable/appcontext/">Flask
application context</a>, &#34;<q>which very few people understand</q>&#34;.  In
Microdot, the request object is explicitly passed to each route function.
Another example is the <a href="https://fastapi.tiangolo.com/tutorial/dependencies/">dependency
injection</a> that is used by the <a href="https://fastapi.tiangolo.com/">FastAPI framework</a> to add
components; Microdot uses explicit decorators instead.
</p>

<p>
He used the <a href="https://github.com/AlDanial/cloc?tab=readme-ov-file#cloc">cloc
utility</a> to count lines of code, while ignoring comments and blank
lines.  Using that, <a href="https://www.djangoproject.com/">Django</a>
comes in at 110,000 lines, Flask plus its essential <a href="https://werkzeug.palletsprojects.com/en/stable/">Werkzeug library</a>
is 15,500 lines, FastAPI with <a href="https://www.starlette.io/">Starlette</a> is 14,900 lines, Bottle is
around 3,000 lines, while the Microdot core has 765 lines (&#34;<q>believe it
or not</q>&#34;) and a full
install with all the extensions on MicroPython comes in at just shy of 1,700
lines of code.
</p>

<p>
He ended with an example of how Microdot can be so small by comparing the
URL matching in Flask with Microdot.  The Flask version does lots more than
Microdot, with more supported types of arguments in a URL and multiple classes
in the <a href="https://werkzeug.palletsprojects.com/en/stable/routing/"><tt>werkzeug.routing</tt>
module</a>; it has 1,362 lines of code.  For Microdot, there is a more
limited set of URL arguments, though there is still the ability to define
custom types, and a <a href="https://microdot.readthedocs.io/en/stable/intro.html#including-dynamic-components-in-the-url-path">single
<tt>URLPattern</tt> class</a>; all of that is done in 63 lines of
code. &#34;<q>I don&#39;t intend to support everything that Flask supports, in
terms of routing, but I intend to support the 20% that covers 80% of the
use cases.</q>&#34;  That is the overall mechanism that he has used to get to
something that is so small.
</p>

<p>
An audience member asked about whether the Microdot code was minified in
order to get it to fit.  Grinberg said that doing so was not all that
useful for MicroPython, but the code is smaller on the board because it is
precompiled on another system; that results in a
<tt>microdot.mpy</tt> file, which is bytecode for MicroPython.  For
example, on the
low-end device he is using for his thermostats, Microdot would not be able
to be compiled on the device itself.  There are some other tricks that can
also be used for reducing the RAM requirements, like putting the code into
the firmware as part of the MicroPython binary.
</p>

<p>
The final question was about performance, and how many requests per second
could be handled. Grinberg said that he did not
have any real numbers, but that the device he demonstrated is &#34;<q>really
really slow</q>&#34;.  That question led to a <a href="https://blog.miguelgrinberg.com/post/benchmarking-micropython">blog
post in late July</a> where Grinberg tried to more fully answer it.
</p>

<p>
[I would like to thank the Linux Foundation, LWN&#39;s travel sponsor, for
travel assistance to Prague for EuroPython.]
</p></div></div>
  </body>
</html>
