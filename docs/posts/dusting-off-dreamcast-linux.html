<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://oldvcr.blogspot.com/2023/02/dusting-off-dreamcast-linux.html">Original</a>
    <h1>Dusting off Dreamcast Linux</h1>
    
    <div id="readability-page-1" class="page"><div id="post-body-242369257611966470" itemprop="description articleBody"><p>
Yes, here at Old VCR we live in the past, when RISC Unix workstations still ruled the earth like large boxy tentaculous Cthulhus. Oh, sure, if you wanted a modern equivalent you could just buy a Raptor POWER9 like the one I&#39;m typing on now. But around here even PowerPC is too pedestrian of an architecture. We need something <em>unique</em>.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhPKs1qSjUCJ-F313PmMKpr6jp88iQTq4jbzDeqEendFolit38GHJZPN3cNLaWpddTAIY-1t_0d0EQIPVEwYXwdk1dL865pp0FrR3y_egoezRb9wduHspOjOoCY59CNW_3vxWgtUFJLVp9GnauaxFkf55bYJ0r43ZTDLcrRgAsaNiU2OOK1aRzLEd5c/s4080/IMG_20230218_195431.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhPKs1qSjUCJ-F313PmMKpr6jp88iQTq4jbzDeqEendFolit38GHJZPN3cNLaWpddTAIY-1t_0d0EQIPVEwYXwdk1dL865pp0FrR3y_egoezRb9wduHspOjOoCY59CNW_3vxWgtUFJLVp9GnauaxFkf55bYJ0r43ZTDLcrRgAsaNiU2OOK1aRzLEd5c/s320/IMG_20230218_195431.jpg" width="320"/></a></p><p>

That&#39;s more like it! A keyboard, mouse, a NIC, VGA output, 16MB of RAM and a whole gig (you wish) of read-only optical drive space with a 200MHz Hitachi SuperH SH-4 CPU faulting its paltry 8K of I-cache and 16K of D-cache non-stop. Now <a href="http://oldvcr.blogspot.com/2022/11/refurb-weekend-sega-dreamcast.html">freshly refurbished</a>, its cooling fan runs louder than my Power Mac Quad G5 at idle and the drive makes more disk seeking noise than when I can&#39;t find a lost floppy. And since the buzzword with Linux distros today is immutability, what could be more immutable than an ephemeral, desperately undersized RAM disk overlaid on a live CD?

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgewFliegf76VBNRlqYWT88WTBYAqt2DQiFqjM1X8YFINkMUzYZZVH3-8OTcfH2TS9LWOaaMJ5YFhIfKx6B_Yjai60Yk2TXl2yK8XuXu3c03ytGjk7nLY2EBqlQkcCJ8dhinVkPSZAi80MTqcYOkx4YbpueW-CPLlMEvrTZoYWz5HAoLhjuD-OXtWmJ/s4080/IMG_20230218_211415.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgewFliegf76VBNRlqYWT88WTBYAqt2DQiFqjM1X8YFINkMUzYZZVH3-8OTcfH2TS9LWOaaMJ5YFhIfKx6B_Yjai60Yk2TXl2yK8XuXu3c03ytGjk7nLY2EBqlQkcCJ8dhinVkPSZAi80MTqcYOkx4YbpueW-CPLlMEvrTZoYWz5HAoLhjuD-OXtWmJ/s320/IMG_20230218_211415.jpg" width="320"/></a></p><p>

Need portability? Well, just load the disc into our handy dandy greymarket clone Treamcast with its built-in LCD display and don&#39;t tell Sega. You can take your Unix on the go with the car power adapter: if you can read the screen, now you can live the dream.
</p><p>
But jokes aside, Dreamcast Linux has something to teach later Johnny-come-latelies with a distro surprisingly well-adapted to its target platform, support for many peripherals, and an all-in-one batteries-included philosophy. Plus, it was one of the earliest Un*xy things for game consoles <a href="http://web.archive.org/web/20060714170358/http://www.m17n.org/linux-sh/dreamcast/">circa 2001</a>, predating <a href="https://en.wikipedia.org/wiki/Linux_for_PlayStation_2">PlayStation 2 Linux</a> by about a year or so, though PS2 Linux was at least <a href="https://web.archive.org/web/20100524023205/http://playstation2-linux.com:80/">Sony-official</a>. (While <a href="https://github.com/CodeAsm/PS1Linux">at least one Linux</a> purports to run on an O.G. PlayStation, this was a later development.)
</p><p>
So I think there&#39;s enough noteworthy about it to merit dusting DC Linux off for a new generation to experience. We&#39;ll add a couple quality of life pieces to smooth out a few rough edges, but we won&#39;t remove anything and largely eschew in-place upgrades such that the flavour of the original experience remains. After all, no one&#39;s running this as a home server (I think). If you like your vintage less aged there are <a href="https://github.com/andersevenrud/dreamcast-linux">newer attempts</a> to put Linux on the Dreamcast, and of course <a href="http://wiki.netbsd.org/ports/dreamcast/">it runs NetBSD</a>, but if you feel like running a refreshingly geriatric Linux kernel on a classic console then this is your blog post. We&#39;ll take a tour of the operating system and the way Linux used to be, talk about what&#39;s unique about the DC port and what&#39;s been added (and what&#39;s missing), and then step through how you can burn a disc to run in yours.
</p><p>
One of the best things about O.G. Dreamcast Linux is that it has very minimal system requirements: you just need a Dreamcast and keyboard. It <em>supports</em> much more than that, most notably the controllers, the Dreamcast mouse and the Dreamcast Broadband Adapter (and if you have the BBA, you might be able to get away without the keyboard by Telnetting in remotely), but pretty much anyone could run it. The first hit is always free.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjAJkdM1cY6WlseXT5-I_DYuU6TYICP6G8gO5Eb3qG4WeJubWc8AEtkrw9gQnsFa_An5fhmnbPDMa2_q0xroYaXLfB-NdwOYfOLhDZPbiqPet9riuMKibcCVAsQ5pS2xacywHhXTz12y4koosVGve-twu0xQjqKNGe8YqUk-TubTps9vyrvFNWvdhWL/s1920/vlcsnap-2023-02-18-09h57m22s091.png"><img alt="" data-original-height="1200" data-original-width="1920" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjAJkdM1cY6WlseXT5-I_DYuU6TYICP6G8gO5Eb3qG4WeJubWc8AEtkrw9gQnsFa_An5fhmnbPDMa2_q0xroYaXLfB-NdwOYfOLhDZPbiqPet9riuMKibcCVAsQ5pS2xacywHhXTz12y4koosVGve-twu0xQjqKNGe8YqUk-TubTps9vyrvFNWvdhWL/s320/vlcsnap-2023-02-18-09h57m22s091.png" width="320"/></a></p><p>

This and the initial set of screenshots are taken with my INOGENI VGA2USB3 capture box connected to a clone DC VGA adapter. Normally I would crop from 16:9 to 4:3 but I&#39;m leaving the full frame on to demonstrate any display irregularities are due to the system, not the capture device or an inartful trim.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgiqspRBpi01ATRUAVDTqBBikCeB0Bk2oOUmU4JkoRVCW5lRT39d7_WoiqMhOwyM5F69MPlLNB080q4qYy3EgEqm1J9tplUa46RMvNRxFTlco28viXFo4l5kCBDlqXyHbjp8vlr3QCJrBClE3qYde1i3kVYg0X7MSMKzWVWlcwnKCy1W94xG9iQwpj_/s1920/vlcsnap-2023-02-18-09h58m05s165.png"><img alt="" data-original-height="1200" data-original-width="1920" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgiqspRBpi01ATRUAVDTqBBikCeB0Bk2oOUmU4JkoRVCW5lRT39d7_WoiqMhOwyM5F69MPlLNB080q4qYy3EgEqm1J9tplUa46RMvNRxFTlco28viXFo4l5kCBDlqXyHbjp8vlr3QCJrBClE3qYde1i3kVYg0X7MSMKzWVWlcwnKCy1W94xG9iQwpj_/s320/vlcsnap-2023-02-18-09h58m05s165.png" width="320"/></a></p><p>

Dreamcast Linux — or indeed any DC homebrew at all — might not have been possible were it not for Sega&#39;s ill-fated attempt at multimedia music CDs, called MIL-CD (Music Interactive Live CD). Recall that the Dreamcast&#39;s normal and preferred medium is the &#34;Gigabyte Disc&#34; GD-ROM, Yamaha&#39;s 1GB CD variant with closer pit spacing but using the same 780nm near-infrared laser. To broaden the third-party catalogue, Sega devised MIL-CD so that enhanced music CDs could feature menus, videos and Internet linkages, something like an <a href="https://en.wikipedia.org/wiki/Enhanced_CD">Enhanced CD</a> Bluebook format specific to the Dreamcast. Unfortunately for Sega, not only was MIL-CD very unsuccessful and only eight actual titles ultimately produced (let alone anything else that could play them), but it also allowed the Dreamcast to be booted from ordinary CD and CD-Rs instead of requiring all titles to be the more expensive GD-ROMs.
</p><p>
The key is the Dreamcast boot process. When the console detects a factory-pressed GD-ROM (GD-Rs officially require a boot disc), most likely from the presence of the special security ring between the low-density CD-readable inner ring and the high-density main section, it reads an boot sector executable conventionally named <tt>IP.BIN</tt> from the first 16 sectors and runs it. <a href="http://mc.pp.se/dc/ip.bin.html">Part of <tt>IP.BIN</tt>&#39;s tasks</a> are to enforce region coding and to also display the Sega copyright message shown here, which on the Genesis became relevant in <a href="https://en.wikipedia.org/wiki/Sega_v._Accolade"><i>Sega v. Accolade</i></a>. It also provides a filename to the Dreamcast ROM (usually <tt>1ST_READ.BIN</tt>) that the DC loads and runs as the main program.
</p><p>
This process is exactly the same for booting MIL-CDs — with two crucial differences. When a MIL-CD starts up, the Dreamcast loads <tt>IP.BIN</tt> as usual, but the Dreamcast ROM will load the filename it provides into memory scrambled by a proprietary algorithm <em>and</em> disable the GD-ROM drive in software. If the second-stage executable were not pre-scrambled in a matching fashion, the result will be garbage, and the console will halt. Even if it could run, however, all it can do is play audio: the executable shouldn&#39;t have any further access to data from the drive.
</p><p>
Sega&#39;s tactical error was making the entire system&#39;s security dependent on these two lockouts despite the overwhelming weight of history. Independent developers noticed the different pathway and used it with their own software developed with the official Sega Katana SDK to provide the obfuscation; probably the first was the Datel GameShark CDX, first developed in early 2000, though Bleemcast! got to market faster using the same method until Sony sued them into grenade shrapnel. Both packages exploited an undocumented reset call to regain control of the GD-ROM drive, allowing them to start games from disc after they themselves had loaded. The notorious Utopia boot disc got around the obfuscation problem with a pirated Katana SDK and used the same reset technique, letting pirated software load by simply booting Utopia and switching discs when instructed. The Utopia crew flamed out quickly as they were stupid enough to put their photographs on the disc, leading to a knock on the door from German police, but the crack circulated widely and the damage was done. When the obfuscation algorithm was eventually cracked too, pirated games could simply boot directly, as could anything else.
</p><p>
Arguably the rampant piracy that resulted was one of the causes of the Dreamcast&#39;s decline, and Sega seemed to confirm this theory by introducing late model Dreamcasts that <a href="https://dreamcast.wiki/MIL-CD_compatibility">had MIL-CD support removed</a>, but in too tardy a fashion to make any difference. These units won&#39;t boot Dreamcast Linux either, but they aren&#39;t extremely common and obviously less desirable.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjv9MkBp6TYCw_fW74_pu4rGRFQkXqBo-it9Wuv1kMaGe-J-USbzk6oMn-6cGwqIomCd5ghJ2JftdU99LugUqRTKmh25JpkgmHarLJK61tpoBo9OUPTZyNhW6s36BnWOUPH3tAlDeaKgbXnl0-BjKkoEc6dRuXIGGXlf2nh9K36HnNPOsJp9L9fvrT_/s1920/vlcsnap-2023-02-18-09h58m32s817.png"><img alt="" data-original-height="1200" data-original-width="1920" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjv9MkBp6TYCw_fW74_pu4rGRFQkXqBo-it9Wuv1kMaGe-J-USbzk6oMn-6cGwqIomCd5ghJ2JftdU99LugUqRTKmh25JpkgmHarLJK61tpoBo9OUPTZyNhW6s36BnWOUPH3tAlDeaKgbXnl0-BjKkoEc6dRuXIGGXlf2nh9K36HnNPOsJp9L9fvrT_/s320/vlcsnap-2023-02-18-09h58m32s817.png" width="320"/></a></p><p>

In our case, the second-stage executable is a pre-scrambled RedBoot bootloader from <a href="http://ecos.sourceware.org/">eCos</a>, a free open source real-time operating system originally developed at Cygnus Solutions in 1997. Red Hat bought Cygnus in 1999 and eventually terminated eCos as a product in 2002, making this 2001 build some of the last official Red Hat builds in use. Dreamcast Linux uniquely uses RedBoot to load the RAM disk image and kernel and start the operating system.
</p><p>
RedBoot listens on both the rear serial port (at 115200bps) and on port 9000 for commands. The IP settings are internal to the Dreamcast and are set by programs such as the Planet Web browser or Quake III Arena. If you connect to port 9000 while it&#39;s waiting, you get this prompt:
</p><div><pre>% telnet sadie 9000
Trying...
Connected to sadie.
Escape character is &#39;^]&#39;.
== Executing boot script in 8.-1612046094 seconds - enter ^C to abort
^C
RedBoot&gt; help
Manage machine caches
   cache [ON | OFF]
Change directory
   cd &lt;directory&gt;
Compute a 32bit checksum [POSIX algorithm] for a range of memory
   cksum -b &lt;location&gt; -l &lt;length&gt;
Print directory
   dir [&lt;directory&gt;]
Display (hex dump) a range of memory
   dump -b &lt;location&gt; [-l &lt;length&gt;]
Execute an image
   exec [-b &lt;parameter block addr&gt;]
        [-m &lt;mount rdonly flags&gt;]
        [-f &lt;ramdisk flags&gt;]
        [-r &lt;root device&gt;]
        [-l &lt;loader type&gt;]
        [-i &lt;initrd start addr&gt;]
        [-j &lt;initrd size&gt;]
        [-c &#34;kernel command line&#34;]
        [&lt;entry point&gt;]
Execute code at a location
   go [-w &lt;timeout&gt;] [entry]
Help about help?
   help [&lt;topic&gt;]
Load a file
   load [-r] [-v] [-h &lt;host&gt;] [-m {FILE | TFTP | xyzMODEM}]
        [-b &lt;base_address&gt;] &lt;file_name&gt;
Mount filesystem
   mount 
Network connectivity test
   ping [-v] [-n &lt;count&gt;] [-l &lt;length&gt;] [-t &lt;timeout&gt;] [-r &lt;rate&gt;]
        [-i &lt;IP_addr&gt;] -h &lt;IP_addr&gt;
Print current working directory
   pwd 
Reset the system
   reset 
Unmount filesystem
   umount 
Display RedBoot version information
   version 
RedBoot&gt; version

RedBoot(tm) bootstrap and debug environment - built 05:27:24, May 29 2001

Copyright (C) 2000, 2001, Red Hat, Inc.

RAM: 0x8c000000-0x8d000000, 0x8c034950-0x8d000000 available
</pre></div>
<p>
Control-C from a connected keyboard won&#39;t do it; while the Maple bus is USB-like, RedBoot doesn&#39;t speak it. If we wanted to boot with custom Linux command line arguments, this is how:
</p><div><pre>RedBoot&gt; mount
RedBoot&gt; load -v /boot/vmlinux
   Type     Offset   VirtAddr PhysAddr FileSiz  MemSiz   Flags    Align
00 00000001 00010000 8c210000 8c210000 000bdfd8 000ca420 00000007 00010000
Entry point is 0x8c210000
RedBoot&gt; load -v -r -b 0x8c400000 /boot/initrd.gz
\
Raw file loaded 0x8c400000-0x8c440725
</pre></div>
<p>
This mounts the Rock Ridge image and loads the kernel and compressed <tt>initrd</tt>. Then, to boot the kernel, we would enter these command line arguments by default, or as you like.
</p><div><pre>RedBoot&gt; exec -c &#34;mem=16M init=/busybox /etc/profile&#34;
Now booting linux kernel (entry 0x8c210000)
MOUNT_RDONLY  : 0x00000000
RAMDISK_FLAGS : 0x00000000
ORIG_ROOT_DEV : 0x00000100
LOADER_TYPE   : 0x00000001
INITRD_START  : 0x00400000
INITRD_SIZE   : 0x00400000
COMMAND LINE  : mem=16M init=/busybox /etc/profile
</pre></div>
<p>
The connection halts at this point since RedBoot&#39;s network connections are then terminated by the new kernel and the console remains on the Dreamcast locally (though a serial port boot should keep the console on the serial port).
</p><p>
The Dreamcast version of RedBoot is one of the components we lack source for. Although the <a href="http://ecos.sourceware.org/ecos/anoncvs.html">eCos CVS server</a> is still active, <a href="http://web.archive.org/web/20060714130044/http://www.m17n.org/linux-sh/dreamcast/ecos">there were apparently pieces</a> that were maintained out of tree, and it&#39;s not clear if the residual SuperH support still supports the Dreamcast BBA. Later versions of LinuxSH used SH-Boot, but remember that part of our brief here at Old VCR is historical preservation, so I&#39;ve retained eCos RedBoot in this build.
</p><p>
The earliest kernel messages don&#39;t seem to go to the screen, though you can get them from <tt>dmesg</tt>, of course.
</p><div><pre>Linux version 2.4.5 (yaegashi@aragorn) (gcc version 3.1 20010501 (experimental)) #27 Thu May 31 07:06:51 JST 2001
SEGA Dreamcast support.
On node 0 totalpages: 4096
zone(0): 4096 pages.
zone(1): 0 pages.
zone(2): 0 pages.
Kernel command line: mem=16M init=/busybox /etc/profile
CPU clock: 200.00MHz
Bus clock: 100.00MHz
Module clock: 50.00MHz
Interval = 125000
Console: colour dummy device 80x25
Calibrating delay loop... 199.47 BogoMIPS
Memory: 10332k/16384k available (1173k kernel code, 6052k reserved, 132k data, 188k init)
Dentry-cache hash table entries: 2048 (order: 2, 16384 bytes)
Inode-cache hash table entries: 1024 (order: 1, 8192 bytes)
Buffer-cache hash table entries: 1024 (order: 0, 4096 bytes)
Page-cache hash table entries: 4096 (order: 2, 16384 bytes)
CPU: SH7750/SH7751
POSIX conformance testing by UNIFIX
PCI: MMIO fixup to Sega Corporation Broadband Adapter
Linux NET4.0 for Linux 2.4
Based upon Swansea University Computer Society NET3.039
Starting kswapd v1.8
devfs: v0.102 (20000622) Richard Gooch (rgooch@atnf.csiro.au)
devfs: boot_options: 0x0
</pre></div>
<p>
But the first visible messages (to feeble human eyes) are these:

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiinEyBZqCSNXua6iGeeveT8AQMcuw-cV7JQN5Gmphz75LWybumKHfqkAZNAlEQ8j_0cGvB8N7BWJVx-YQUdhCsV0K3NVYAki_NUrQAHcAVLtCFZMQk9RJeba1RsnwnCVB7sDpFvgsYS__O--LpNAkJsZrQLIXu2T6hlnGe5FvzXIs4HaNutaDTaMAz/s1920/vlcsnap-2023-02-18-10h45m56s059.png"><img alt="" data-original-height="1200" data-original-width="1920" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiinEyBZqCSNXua6iGeeveT8AQMcuw-cV7JQN5Gmphz75LWybumKHfqkAZNAlEQ8j_0cGvB8N7BWJVx-YQUdhCsV0K3NVYAki_NUrQAHcAVLtCFZMQk9RJeba1RsnwnCVB7sDpFvgsYS__O--LpNAkJsZrQLIXu2T6hlnGe5FvzXIs4HaNutaDTaMAz/s320/vlcsnap-2023-02-18-10h45m56s059.png" width="320"/></a></p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjAqgkOwbsh4mcjlOXJ0xHc4icfyfn1dmFI9GHvQrLe70kl22ShxK-Rj_qu0d-zC8gwyUDd67uEfzrzYp7BGck9XGV4t_FbD-o3mkxDcY3Phmpz8-PQS0DcD35v8eZyFYucJv4ETuUDrZvkyFiCKDpNq45zv4HYpZFvAvmrSnNcBsI8YSoho-5ros8k/s1920/vlcsnap-2023-02-18-09h58m39s700.png"><img alt="" data-original-height="1200" data-original-width="1920" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjAqgkOwbsh4mcjlOXJ0xHc4icfyfn1dmFI9GHvQrLe70kl22ShxK-Rj_qu0d-zC8gwyUDd67uEfzrzYp7BGck9XGV4t_FbD-o3mkxDcY3Phmpz8-PQS0DcD35v8eZyFYucJv4ETuUDrZvkyFiCKDpNq45zv4HYpZFvAvmrSnNcBsI8YSoho-5ros8k/s320/vlcsnap-2023-02-18-09h58m39s700.png" width="320"/></a></p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiLMeIIYxsdLvljCm4j0AgJtAa3uK8KyGkDi-Nex8zdSpPfdJhlO0IfZUI_D6A_XHFD5ObY99dxzE0QsINLTAEkByM5-V7tXjkVeZUZ-aM9eXGflnwwZdjx4wtiFDReBiAEmrfANlUAn5-cCclPGbZfZ-d5LZiIDNPN6nizAJFK7Nrgx7vfD3hJIfWO/s1920/vlcsnap-2023-02-18-09h58m53s373.png"><img alt="" data-original-height="1200" data-original-width="1920" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiLMeIIYxsdLvljCm4j0AgJtAa3uK8KyGkDi-Nex8zdSpPfdJhlO0IfZUI_D6A_XHFD5ObY99dxzE0QsINLTAEkByM5-V7tXjkVeZUZ-aM9eXGflnwwZdjx4wtiFDReBiAEmrfANlUAn5-cCclPGbZfZ-d5LZiIDNPN6nizAJFK7Nrgx7vfD3hJIfWO/s320/vlcsnap-2023-02-18-09h58m53s373.png" width="320"/></a></p><p>

Notice the console framebuffer, the SCI(F) serial port support, Maple bus for input devices, the Realtek 8139-based Broadband Adaptor (connected over a PCI connection) and the GD-ROM. The framebuffer detects whether we&#39;re connected over VGA or NTSC. On my old school CRT TV set, I see </p><tt>fb0: Mode 640x480-32 pitch = 2560 cable: COMPOSITE video output: NTSC</tt><p> instead of </p><tt>cable: VGA video output: VGA</tt><p> (sorry, PAL users, you&#39;ll have to use VGA). The console&#39;s scroll window has been altered so that the Tux SuperH logo is not obliterated by incoming new messages. Although we booted with Busybox, </p><tt>/busybox</tt><p> does not provide the userland; it only serves as </p><tt>init</tt><p>.
</p><p>
With the kernel now booted, we can switch to pixel-precise grabs from the framebuffer for the remaining screenshots. I provide a pre-built copy of <a href="https://github.com/jwilk/fbcat"><tt>fbcat</tt></a> in <tt>/usr/bin</tt> which will read the Linux framebuffer and convert it to a Netpbm pixmap.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjCa7AjqjAAeTNgYyrb2L6Ia0blb_1vXaAbnEa4Wi5GSKqF_c4LuMpFZjf6_F9oa7bvgczWNksMGGmLRqXeAlIpXj3wAP5Sno5K9H7T6gObuBIsZNrcW9KyQRPKfH7y-XucdxMtXDYwz4X-PSIvUZrlMwnsl-F1uFtPE7_e0RDqi-4xgpYtOvi6-EzT/s640/startup.ppm.png"><img alt="" data-original-height="480" data-original-width="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjCa7AjqjAAeTNgYyrb2L6Ia0blb_1vXaAbnEa4Wi5GSKqF_c4LuMpFZjf6_F9oa7bvgczWNksMGGmLRqXeAlIpXj3wAP5Sno5K9H7T6gObuBIsZNrcW9KyQRPKfH7y-XucdxMtXDYwz4X-PSIvUZrlMwnsl-F1uFtPE7_e0RDqi-4xgpYtOvi6-EzT/s320/startup.ppm.png" width="320"/></a></p><p>

Log in as </p><tt>root</tt><p>, no password. The machine listens on Telnet and FTP, and I added a small Gopher server demo. <b><em>Never put a console running DC Linux outside of a firewall: it is an intentionally insecure system. Any bot scanning your network will get <tt>root</tt> immediately.</em></b></p><p>
You&#39;ll notice in the messages that NTP started up using <a href="https://chrony.tuxfamily.org/"><tt>chrony</tt></a>. I&#39;ll talk about what we&#39;ve added to O.G. 2K1 Dreamcast Linux as we go along, but first, let&#39;s discuss the framebuffer since we&#39;re sitting in front of it.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi6oaVPVOQ-EZ4ke5InvRb1Q38nhhofP58leY6j4qDHVLV4QIxXjTfkOPGmzgmcREO1Pj0MO696KUSKCSK5YUr5cno0F6AE1NWi5kr83PYDVF0WxFcc-iaOZUrSlx9oqgeOn0YpzGsAHw55NGooV2y5QwxjlA67vr5gAI2-XfEs9k_ROG_U7bh5_FRa/s4080/IMG_20230218_195700.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi6oaVPVOQ-EZ4ke5InvRb1Q38nhhofP58leY6j4qDHVLV4QIxXjTfkOPGmzgmcREO1Pj0MO696KUSKCSK5YUr5cno0F6AE1NWi5kr83PYDVF0WxFcc-iaOZUrSlx9oqgeOn0YpzGsAHw55NGooV2y5QwxjlA67vr5gAI2-XfEs9k_ROG_U7bh5_FRa/s320/IMG_20230218_195700.jpg" width="320"/></a></p><p>

Logged into our VGA demonstration system, </p><tt>fbset</tt><p> reports a bog-standard 640x480 32bpp console display. That isn&#39;t totally true, though: a popular trick is to copy to and from the framebuffer device (here </p><tt>/dev/fb/0</tt><p> or </p><tt>/dev/fb0</tt><p>) using </p><tt>cp</tt><p> and </p><tt>cat</tt><p>. If you copy </p><tt>/dev/fb0</tt><p> to a file and copy it back, though, you don&#39;t exactly get on-screen what you started with:

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhHUg-ivHcotuCG5wCOCMo7Ddb7c9LmlyGhdnOBuQtCAfT9WsdJsgRQN1rhGiVAToS2lflItTPghWyxFF6Y-ewKnomMkxkNNOZJMkC3D3R85oBMytPJfaXdORmGTGeAR859r8NXEbWqY1TYIgVDAJFXXz58NuqWfBHWmLPLXz_yHjz-w1dM9RSzhGt8/s640/oops.ppm.png"><img alt="" data-original-height="480" data-original-width="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhHUg-ivHcotuCG5wCOCMo7Ddb7c9LmlyGhdnOBuQtCAfT9WsdJsgRQN1rhGiVAToS2lflItTPghWyxFF6Y-ewKnomMkxkNNOZJMkC3D3R85oBMytPJfaXdORmGTGeAR859r8NXEbWqY1TYIgVDAJFXXz58NuqWfBHWmLPLXz_yHjz-w1dM9RSzhGt8/s320/oops.ppm.png" width="320"/></a></p><p>

This puzzled me to no end, because the framebuffer clearly works. I queried the </p><tt>ioctl</tt><p>s for the framebuffer and found a perfectly ordinary looking 32 bit per pixel layout, but writing zeroes or indeed any other kind of character data to the framebuffer device generated this sort of artifacting.
</p><p>
After a lot of pulled hair, I decided to look at how <tt>fbcat</tt> was accessing the framebuffer since it could clearly make sensible grabs. While it was using the same kinds of <tt>ioctl</tt>s, it was doing the actual reading by <tt>mmap()</tt>ing the buffer instead of file reads. I wrote a simple program to <tt>mmap()</tt> the screen like it did and added a <tt>memset()</tt> to zero out the screen — and that worked! I could even <tt>memcpy()</tt> stuff around, since it was all just bytes. But treating the screen as an array of <tt>unsigned char</tt> generated the same kind of frustrating artifacts when I did any sort of writing.
</p><p>
If you know anything about how <tt>memset()</tt> and friends are implemented, you&#39;ve already guessed the answer: the access has to be by whole 32-bit word, which is what those functions do when they&#39;re dealing with quantities of sufficient size. When I changed the code to write entire words for pixels, the screen updated correctly. Since I rather like the Tux SuperH logo, I reconstructed the bitmap data from the framebuffer and created a little demonstration program that clears the Dreamcast framebuffer, paints Tux, and sets the Linux console back to scrolling under it. <tt>tuxclear</tt> is in <tt>/usr/bin</tt> and the source (along with a <tt>gzip</tt>ped header file containing the Tux bitmap data) is in <tt>/usr/src</tt>.
</p><p>
On our NTSC CRT TV set connected to the Dreamcast with a composite video cable, however, we have another little problem.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiWAigJPwJttaY5aHREe7MVaBl5ZjXarno_n5qfM9TQcveoNGZKJUps77TU8HISBBmE6G3HOa6vNle9Cu_r2JtSip7KRV20zD9lVCTK7ADCTqz4_S6dFQlQNzgpan9OH-efoPhgaDF0PCj68hnOGNw5c1Y44w0ZjPMSjDVSiw4Cnw3Uw3ccBsGry4Uo/s4080/IMG_20230218_212701.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiWAigJPwJttaY5aHREe7MVaBl5ZjXarno_n5qfM9TQcveoNGZKJUps77TU8HISBBmE6G3HOa6vNle9Cu_r2JtSip7KRV20zD9lVCTK7ADCTqz4_S6dFQlQNzgpan9OH-efoPhgaDF0PCj68hnOGNw5c1Y44w0ZjPMSjDVSiw4Cnw3Uw3ccBsGry4Uo/s320/IMG_20230218_212701.jpg" width="320"/></a></p><p>

A old school CRT TV or composite display will not be able to display the full 640x480 display. The cutoff on the sides is tolerable but only about 80-85% of the vertical resolution will be visible depending on the exact TV or monitor in use. By default we can&#39;t even see the login prompt!

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgs-MhcSU3qvsvOr4mH5oKhL-WZzEL0IP6EwR_KEB1ocM7lYWso5ozdXGxBzwk4ubBxDV_0-0QFnia9nuGdmj-lamR4i3nqj7VamiDVzxZ7rp8KMcbBA9GjFCcYfwAV3UiO_Uc3QSXTLqfV8pArSL9o1yscZoAzt6LZnlQ7PvTmNdrWREsDSiZxGz4Y/s4080/IMG_20230218_212805.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgs-MhcSU3qvsvOr4mH5oKhL-WZzEL0IP6EwR_KEB1ocM7lYWso5ozdXGxBzwk4ubBxDV_0-0QFnia9nuGdmj-lamR4i3nqj7VamiDVzxZ7rp8KMcbBA9GjFCcYfwAV3UiO_Uc3QSXTLqfV8pArSL9o1yscZoAzt6LZnlQ7PvTmNdrWREsDSiZxGz4Y/s320/IMG_20230218_212805.jpg" width="320"/></a></p><p>

To deal with this (after blindly logging in), I added a little shell script </p><tt>/usr/bin/tvclear</tt><p> that sets a different scroll window, and then looked at </p><tt>fbset</tt><p> again. This time we see two new fields, </p><tt>bcast true</tt><p> and </p><tt>laced true</tt><p>, indicating that the frame buffer is generating broadcast video timings (in this case NTSC, directly supported by the Dreamcast-specific kernel) and interlacing the display. You can use this as a hint to determine if the display you&#39;re connected to is progressive-scan VGA or not. Incidentally, this is also how </p><tt>fbset</tt><p> rats out the little Treamcast&#39;s LCD panel as connected via composite video, not VGA. However — and like modern TVs — there is no overscan region on the Treamcast&#39;s flat panel and the entire 640x480 display is visible. Unfortunately </p><tt>tvclear</tt><p>&#39;s screen window settings are ignored by many programs, so we&#39;ll have to think of a better solution for that which won&#39;t regress modern displays.
</p><p>
If the reduced scroll window bothers you and you just want all 80x30 on the console, I wrote a replacement <tt>/usr/bin/clear</tt> shell script to reset the scroll window from the console (everywhere else it just stubs into <tt>/usr/bin/cls</tt>, which is what I renamed the old <tt>/usr/bin/clear</tt> binary to). This is probably also a good time to mention that the screen will conveniently turn off after a sufficient period of inactivity.
</p><p>
How did we manage to compile <tt>/usr/bin/tuxclear</tt>, by the way?

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjDfh1qIFzx5DWgM8aLmG75svJvhgJJ6xbdwpa_1kWj6hXxJSGAcBc4OA-OuC_pWYXx2ne-bkTuGWwJxr1J9MLtcZlJ5oY2U2LQRo8LfpDySrnim37aqgKz-CffowZllQjLlsQPdKuG7mXbJfYYLOWXvxYXO7gY_xeXe12Zp_5F1wdU55VAcKOQp28G/s640/dev.ppm.png"><img alt="" data-original-height="480" data-original-width="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjDfh1qIFzx5DWgM8aLmG75svJvhgJJ6xbdwpa_1kWj6hXxJSGAcBc4OA-OuC_pWYXx2ne-bkTuGWwJxr1J9MLtcZlJ5oY2U2LQRo8LfpDySrnim37aqgKz-CffowZllQjLlsQPdKuG7mXbJfYYLOWXvxYXO7gY_xeXe12Zp_5F1wdU55VAcKOQp28G/s320/dev.ppm.png" width="320"/></a></p><p>

The kernel and everything else were apparently compiled with a cross-compiler on </p><tt>i386</tt><p>, which doesn&#39;t help me much since I don&#39;t run any Intel system normally (let alone a 32-bit one). However, we do have </p><tt>gcc</tt><p> and </p><tt>g++</tt><p> 3.1 as hosted compilers on the system itself (intriguingly marked </p><tt>experimental</tt><p>), along with period-correct Perl 5.6.0, </p><tt>awk</tt><p>, and no Python. GNU </p><tt>make</tt><p> 3.79 serves as your build system, but unfortunately compiling anything more than trivial small tools will not be possible with the limited space we have in the RAM disk.
</p><p>
The solution is NFS. On my NetBSD NFS server we have this line in <tt>/etc/exports</tt>:
</p><div><pre>/netfs -alldirs -mapall=censored:censored -noresvport -noresvmnt
</pre></div>
<p>
There&#39;s only one UID and GID that matter in DC Linux, i.e., <tt>root</tt>&#39;s, so it&#39;s fine (even necessary) to squash everything to a single unprivileged UID on the server side. Back on the Dreamcast, I created a new <tt>/netfs</tt> mount point in its perilously overfull <tt>/boot/initrd.gz</tt> <tt>ext2</tt> image and then added two new entries to <tt>/etc/fstab</tt>:
</p><div><pre>nfs:/netfs/dreamcast/linux /netfs nfs rw,hard,intr,rsize=4096,wsize=4096 0 0
nfs:/netfs/dreamcast/linux/tmp /tmp nfs rw,hard,intr,rsize=4096,wsize=4096 0 0
</pre></div>
<p>
The upshot is that this revised spin of Dreamcast Linux will automatically try to mount these filesystems to <tt>/netfs</tt> and <tt>/tmp</tt> (because the GNU compiler will put its assembler and parse files here) if a host named <tt>nfs</tt> can be resolved and will answer. The beauty is, on a system without a BBA or a network where there is no NFS server that answers to that name, nothing will be mounted and those mount points will remain as provided by the <tt>initrd</tt>, and the system will still run standalone as before.
</p><p>
The other problem we need to solve is swap. Linux, or at least not this Linux, won&#39;t let you use a swapfile hosted over NFS; <tt>swapon</tt> will give you an illegal argument error and refuse to enable it. The workaround is to attach the swapfile to a loop device and have <tt>swapon</tt> use the loop device as swap. A minor complication here is that Linux 2.4 has a hard limit of eight loop devices but I don&#39;t think that&#39;ll be a major drawback compared to every other limitation we&#39;re currently dealing with!
</p><p>
For swap-over-NFS, create a file of suitable size (I chose 256MB) named <tt>swapfile</tt> on the NFS server in the mount providing <tt>/netfs</tt> and on the Dreamcast then do <tt>mkswap /netfs/swapfile</tt>. Then, whenever you want to start or stop swap-over-NFS, execute one of these:
</p><div><pre>/etc/init.d/nfsswap.sh start
/etc/init.d/nfsswap.sh stop
</pre></div>
<p>
This script handles the dance with the loop device and enabling the swapfile. If <tt>/netfs/swapfile</tt> isn&#39;t present, it won&#39;t do anything.
</p><p>
You&#39;ll notice the script I wrote lives in <tt>/etc/init.d</tt> (DC Linux predates <tt>systemd</tt>, which shall be considered a feature), and I was initially planning on making it facultatively autostart like NFS. However, let me be the first to point out the obvious that NFS can be slow, and swap-over-NFS can be <em>really</em> slow. The read and write sizes in <tt>/etc/fstab</tt> were selected after messing around with various values and seeing what performed best, but some <tt>configure</tt> scripts could take over an hour to execute (!), and some compilation jobs I just left to run overnight. This was a great stress test of the hardware and the buildchain, by the way. I had the Dreamcast running non-stop for days.
</p><p>
But what outright killed the idea of making swap-over-NFS default if available was that some really large packages still couldn&#39;t build. I would go to lunch with the Dreamcast chugging away, come back and find the console had seized up. Invariably on the console would be a whole string of these dreaded messages:
</p><div><pre>eth0: Too much work at interrupt, IntrStatus=0x0010.
</pre></div>
<p>
This message occurs because Linux 2.4.x&#39;s driver for the Realtek 8139 (in the BBA) looked like this:
</p><div><pre>static void rtl8139_interrupt (int irq, void *dev_instance,
                               struct pt_regs *regs)
{
        struct net_device *dev = (struct net_device *) dev_instance;
        struct rtl8139_private *tp = dev-&gt;priv;
        int boguscnt = max_interrupt_work;
        void *ioaddr = tp-&gt;mmio_addr;
        int ackstat, status;
        int link_changed = 0;

        (void)(&amp;tp-&gt;lock);

        do {
                status = readw (ioaddr + (IntrStatus));
                if (status == 0xFFFF)
                        break;
                if (status &amp; RxUnderrun)
                        link_changed = readw (ioaddr + (CSCR)) &amp; CSCR_LinkChangeBit;
                ackstat = status &amp; ~RxAckBits;
                writew ((ackstat), ioaddr + (IntrStatus));
                if ((status &amp;
                     (PCIErr | PCSTimeout | RxUnderrun | RxOverflow |
                      RxFIFOOver | TxErr | TxOK | RxErr | RxOK)) == 0)
                        break;
                if (netif_running (dev) &amp;&amp; (status &amp; RxAckBits))
                        rtl8139_rx_interrupt (dev, tp, ioaddr);
                if (status &amp; (PCIErr | PCSTimeout | RxUnderrun | RxOverflow |
                              RxFIFOOver | TxErr | RxErr))
                        rtl8139_weird_interrupt (dev, tp, ioaddr,
                                                 status, link_changed);
                if (netif_running (dev) &amp;&amp; (status &amp; (TxOK | TxErr)))
                        rtl8139_tx_interrupt (dev, tp, ioaddr);
                boguscnt--;
        } while (boguscnt &gt; 0);
        if (boguscnt &lt;= 0) {
                printk (KERN_WARNING &#34;%s: Too much work at interrupt, &#34;
                        &#34;IntrStatus=0x%4.4x.\n&#34;, dev-&gt;name, status);
                writew ((0xffff), ioaddr + (IntrStatus));
        }
</pre></div>
<p>
By default the value of <tt>max_interrupt_work</tt> is 20, which means this interrupt routine will only permit itself to loop 20 times with back-to-back &#34;work.&#34; If there&#39;s a lot of NFS traffic (like, oh, I dunno, a lot of swapping), then there&#39;ll be a lot of interrupts, and the driver will start dropping some. That means mangled writes, or if the victim operation happens to be a critical section of swap, the console will poop its pants. I tuned the NFS read and write sizes to reduce this as much as possible but I couldn&#39;t eliminate it completely. While I&#39;m told this value can be increased as an option, I&#39;m not sure what the ideal value is, and it would be better to get it to a later kernel where the driver is better written anyway (at least 2.5.something, preferably 2.6).
</p><p>
All this I/O activity also makes the Dreamcast&#39;s clock run slow, and the solution for that is once again <tt>chrony</tt> and NTP. I&#39;ll talk about that at the end of our tour.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj83jiEYDGxRuLLTean8W_y-kqF0V-tAwHrNTWENzhabus7tmoS5Ko8lNiD094C6ZIyoLDmlTFBCMT5kleouLg1_Z6kAlLW1HSHMe5_vkBS2Oq6p_FaN2dJ6hKosC09QTnPknh911h2_MzKDn5-GzbbG-yKt-kujdT4RmSh_KKrmY1pocXOiAARVxoJ/s640/games.ppm.png"><img alt="" data-original-height="480" data-original-width="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj83jiEYDGxRuLLTean8W_y-kqF0V-tAwHrNTWENzhabus7tmoS5Ko8lNiD094C6ZIyoLDmlTFBCMT5kleouLg1_Z6kAlLW1HSHMe5_vkBS2Oq6p_FaN2dJ6hKosC09QTnPknh911h2_MzKDn5-GzbbG-yKt-kujdT4RmSh_KKrmY1pocXOiAARVxoJ/s320/games.ppm.png" width="320"/></a></p><p>

The other fun thing about Dreamcast Linux is that it recognizes it&#39;s running on a game console, for goodness&#39; sake, so there have to be <em>games</em>. So there are some. The high scores don&#39;t save, of course, and most of these are text-based, but among others you&#39;ve got Hack, Mille Bourne, Canfield, Adventure, Boggle, Tetris, Wumpus, Star Trek and ... PrBoom?

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhe3CwG0IPRRbNZ69p22xCVd58t96CF2Mu6ezynt2hJtQUS77qeiXiGROs_hmj3zHtePXSyhAAduojOiQsp0YR5R3rzqhZaihCe4nYs_NLsJrtdPi9bdkeFkEkFBkYYuPgPD9uXuA8rsqS2CTbMfgiEX1bPqnywtQz0kFYctoxFyGaVzqez9WBaexpx/s640/prboom.ppm.png"><img alt="" data-original-height="480" data-original-width="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhe3CwG0IPRRbNZ69p22xCVd58t96CF2Mu6ezynt2hJtQUS77qeiXiGROs_hmj3zHtePXSyhAAduojOiQsp0YR5R3rzqhZaihCe4nYs_NLsJrtdPi9bdkeFkEkFBkYYuPgPD9uXuA8rsqS2CTbMfgiEX1bPqnywtQz0kFYctoxFyGaVzqez9WBaexpx/s320/prboom.ppm.png" width="320"/></a></p><p>

Conveniently, this version of PrBoom (2.2.0) uses SDL to render directly to the Dreamcast console framebuffer. The original documentation for Dreamcast Linux says you should </p><a href="http://web.archive.org/web/20060713154800/http://www.m17n.org/linux-sh/dreamcast/distribution">run it after <tt>fbset -depth 16</tt></a><p> (the default is 32). Frankly, it didn&#39;t seem to make any difference if the depth was 16, 32 or 8192: PrBoom started when it wanted to and bombed out when it didn&#39;t. Swap-over-NFS did seem to help, so maybe it was just a little short on memory, or maybe it was just placebo effect.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj6-S9hu9kqmInUBM2wSZwAJflumNDcxg7Lk24rX88yMi1FAqOS6xJsbFKv4xRdj0C-9i55JMktjLM-GFtIuuLkXTjrTMQtAZPtGtC7RMssUo7EKDKu6YOB7Z21PmiXdtsaHAy3B7doctuBsDbMhXvLnXpqJ4aACInhJfpFa3SFuJi7ilb8DYpbYXJ-/s640/prboom3.ppm.png"><img alt="" data-original-height="480" data-original-width="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj6-S9hu9kqmInUBM2wSZwAJflumNDcxg7Lk24rX88yMi1FAqOS6xJsbFKv4xRdj0C-9i55JMktjLM-GFtIuuLkXTjrTMQtAZPtGtC7RMssUo7EKDKu6YOB7Z21PmiXdtsaHAy3B7doctuBsDbMhXvLnXpqJ4aACInhJfpFa3SFuJi7ilb8DYpbYXJ-/s320/prboom3.ppm.png" width="320"/></a></p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEijfLFKAL0U1oVAm9miNh94rQz3ya1ij8jNyqzF4jvqGLk3UHlrFXPCDQNYLN7EFrRd5t7EaMmCYgA8Ijj3QfUwxCYgUCobnFeHxTSDMKjKwBhe6CQk7x_4y0IcOmspVBji9ELIVBQRhTV7e_Pid5j7IjBsEVZHiWhrwy7jgN8uMwhbf6A9QRnLlmSZ/s640/prboom4.ppm.png"><img alt="" data-original-height="480" data-original-width="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEijfLFKAL0U1oVAm9miNh94rQz3ya1ij8jNyqzF4jvqGLk3UHlrFXPCDQNYLN7EFrRd5t7EaMmCYgA8Ijj3QfUwxCYgUCobnFeHxTSDMKjKwBhe6CQk7x_4y0IcOmspVBji9ELIVBQRhTV7e_Pid5j7IjBsEVZHiWhrwy7jgN8uMwhbf6A9QRnLlmSZ/s320/prboom4.ppm.png" width="320"/></a></p><p>

The artifact here is because the screen was moving while I was capturing, not because the game was defective. That said, performance isn&#39;t great because it&#39;s totally rendered in software (rendering at 640x480 doesn&#39;t help) and there&#39;s no support for the Dreamcast sound hardware either. It gets a little better with transparency off and at a smaller viewport. The Doom shareware WAD is helpfully included on disc.
</p><p>
The other included game engine is an older version of <tt>xmame</tt>. Try as I might, though, I couldn&#39;t get the SDL version to run on the local framebuffer, so that makes a good transition to talking about X support.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgLJPrHZAp0TAHkRGLLAkBh17ZOkyjS0w5bzxweZzCkRPPCSmMYEMLPosrWqax9zCITLZWcMFm5Xbvd9y0N0iehrkxDZdkE-vCBTovpoaBkWaEgA8UMLWaDYnJjBlUkJ6kGmONaVtxF8PzLG9PXq8a4thZ2LKOfpRLMi2ZkKxF-F5oIDSZCtWOy4Uly/s640/xfree86.ppm.png"><img alt="" data-original-height="480" data-original-width="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgLJPrHZAp0TAHkRGLLAkBh17ZOkyjS0w5bzxweZzCkRPPCSmMYEMLPosrWqax9zCITLZWcMFm5Xbvd9y0N0iehrkxDZdkE-vCBTovpoaBkWaEgA8UMLWaDYnJjBlUkJ6kGmONaVtxF8PzLG9PXq8a4thZ2LKOfpRLMi2ZkKxF-F5oIDSZCtWOy4Uly/s320/xfree86.ppm.png" width="320"/></a></p><p>

Yes, you can run X in Dreamcast Linux (Wayland? ha ha ha). The included version is XFree86 3.3.6, interestingly reporting itself as running on </p><tt>i686</tt><p>, probably as a cross-compilation artifact. You&#39;ll definitely need the Dreamcast mouse for this and you really want swap-over-NFS running as well or the GD-ROM will really thrash (it works without it, but alarmingly slowly).

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhpKQXfdS1woDZlNU7_ZvlhHs88KAvYPblAVcIxsOyN0m9legxKxoPZpku4-stw5mUyF48YgrgT9eL9h5nQMAE8Ztd3dfAgtsuBWSGPGklOpbj4nwMfP03DWdmIgXQZXFdXwiLMdAX6uiGFN6_3ikEUKTw10YeTwo6tsI0oPLhRU0Go64zCRQeVWbr4/s640/xfree86b.ppm.png"><img alt="" data-original-height="480" data-original-width="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhpKQXfdS1woDZlNU7_ZvlhHs88KAvYPblAVcIxsOyN0m9legxKxoPZpku4-stw5mUyF48YgrgT9eL9h5nQMAE8Ztd3dfAgtsuBWSGPGklOpbj4nwMfP03DWdmIgXQZXFdXwiLMdAX6uiGFN6_3ikEUKTw10YeTwo6tsI0oPLhRU0Go64zCRQeVWbr4/s320/xfree86b.ppm.png" width="320"/></a></p><p>

You get one resolution, though, and that resolution is 640x480.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg5JlyQa2wPh5cPIvOnM45FXcOSb2btj-1cjwn40wI1WXBmwW8bbeshznuWoRq1J67ERP4eotl6Gl-It1c7XmyDVRJtKwzqCDFuN26yJP0jXffceALByU-0z079W65dLTL3-osCileO3pAGSqoEO0IPXFUh2BsM0tOJNr7MWFAiYqBO-AXw21AEYwyr/s640/xstartup.ppm.png"><img alt="" data-original-height="480" data-original-width="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg5JlyQa2wPh5cPIvOnM45FXcOSb2btj-1cjwn40wI1WXBmwW8bbeshznuWoRq1J67ERP4eotl6Gl-It1c7XmyDVRJtKwzqCDFuN26yJP0jXffceALByU-0z079W65dLTL3-osCileO3pAGSqoEO0IPXFUh2BsM0tOJNr7MWFAiYqBO-AXw21AEYwyr/s320/xstartup.ppm.png" width="320"/></a></p><p>

That stinks because the default session that opens (</p><tt>/root/.xsession</tt><p>) has windows that are clearly too big for the screen (but that&#39;s how it came, so I&#39;m leaving it that way for now), and even worse on the TV set. Fortunately left clicking on the left window button will quickly minimize them. Don&#39;t close the login window, by the way, as that will end your X session.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiA27Tq2b_YvGQuSTYAhqKi_XzqhJ-nxsjysgoEjvwbhhRlWsuqPPHsVEFqsM2GoqI77YDKXDS2xkZz5zpVRGwu9InpNoXQOr_GWLHsf9HorCzLTf3y17Idyd7eUJJr_PEgdxiBFIBqLoIJzZ8YHiRUGOHcgQB2-Dj6KfMud8dTIsHThckWAML-UZIp/s640/xwm.ppm.png"><img alt="" data-original-height="480" data-original-width="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiA27Tq2b_YvGQuSTYAhqKi_XzqhJ-nxsjysgoEjvwbhhRlWsuqPPHsVEFqsM2GoqI77YDKXDS2xkZz5zpVRGwu9InpNoXQOr_GWLHsf9HorCzLTf3y17Idyd7eUJJr_PEgdxiBFIBqLoIJzZ8YHiRUGOHcgQB2-Dj6KfMud8dTIsHThckWAML-UZIp/s320/xwm.ppm.png" width="320"/></a></p><p>

On the other hand, the nice big letters are definitely readable on a TV set or the little Treamcast LCD. The window manager is </p><tt>twm</tt><p>, a good choice for being low-impact.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjeon6ST2bvbUq2PB5lpRRDArQrujtXAWJMmRkhaAqUa67je7Rg68fXRYyTHf9i2YjLg03igNqG-LRHje5oy9rbudoC96HaZOGMj0CnhRuNTrsZTQviMGeO-22ipk3bkU4feQhy4r5arFCesZGgHAP7wjEgjbAnjw-3l6hFKXhBwbA98TCS0D4uCzXM/s640/mame.ppm.png"><img alt="" data-original-height="480" data-original-width="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjeon6ST2bvbUq2PB5lpRRDArQrujtXAWJMmRkhaAqUa67je7Rg68fXRYyTHf9i2YjLg03igNqG-LRHje5oy9rbudoC96HaZOGMj0CnhRuNTrsZTQviMGeO-22ipk3bkU4feQhy4r5arFCesZGgHAP7wjEgjbAnjw-3l6hFKXhBwbA98TCS0D4uCzXM/s320/mame.ppm.png" width="320"/></a></p><p>

With </p><tt>login</tt><p> minimized and the </p><tt>xterm</tt><p> window shrunk to a more manageable size, we start </p><tt>xmame.x11</tt><p>. It&#39;s an old MAME, of course (0.37b15), and the default configuration in </p><tt>/usr/lib/xmame/xmamerc</tt><p> expects its ROMs in </p><tt>/var/lib/xmame</tt><p> which is naturally read-only. I solved this problem by making another NFS mount over that directly and loading ROMs there. This version of MAME plays Pac-Man by default, so I dug up a totally legal copy of the ROMs and renamed the components to the names it was expecting (you&#39;ll get some CRC warnings too, most likely).
</p><p>
With all that in place, there&#39;s no sound, but everything else seemed to work (legally). A really nice touch is that the Dreamcast controller D-pad is enabled as a joystick. Press Y for 1P credit and Start for 1P start.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgJcpZVvay2BlstNl6MLkO0Jii-MnmdNGpAzc6bCe75ZXOTWyXBpNwttXOV7vrZi1tRAgrNEgdYQ6xJLIH_I3MxcpJnQ_tgk1OrKokAuD7pfELb008yUil-qTyxP0DTKt83LbPwbgleULzWl2og2iLLjB19rLzSpu--GVexoatq_HiWlg_hcGiCf48-/s4080/IMG_20230218_210338.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgJcpZVvay2BlstNl6MLkO0Jii-MnmdNGpAzc6bCe75ZXOTWyXBpNwttXOV7vrZi1tRAgrNEgdYQ6xJLIH_I3MxcpJnQ_tgk1OrKokAuD7pfELb008yUil-qTyxP0DTKt83LbPwbgleULzWl2og2iLLjB19rLzSpu--GVexoatq_HiWlg_hcGiCf48-/s320/IMG_20230218_210338.jpg" width="320"/></a></p><p>

There are no included graphical web browsers, and the build of X has some curious omissions like no Motif (possibly due to its licensing at the time) and no </p><tt>Xpm</tt><p> which would make doing so difficult, though there are Athena widgets and other basics (something like Chimera could potentially work in such an environment). However, both Lynx and </p><tt>w3m</tt><p> are included, and they seem to work fine for Gopher and Web access except of course for sites requiring TLS. In fact, there are no cryptography libraries on the system at all, and only a very old </p><tt>zlib</tt><p> (1.1.3).
</p><p>
So that brings us to what else I ended up adding. The first thing was to update <tt>zlib</tt>; the version on board is obviously way too old and also lacks header files, so it couldn&#39;t be compiled against for new software anyway. However, any update should also be done in such a way as to not upset programs linked against the older library since they would doubtlessly not be ABI-compatible. An exhaustive search of the entire filesystem found only three programs linked against the shipped <tt>/usr/lib/libz.so.1</tt>, namely CVS, Lynx and SDL MAME (but oddly not the X11 version). These were preserved by editing them in a hex editor to link them to <tt>/usr/lib/libz.so.0</tt> (note change in version number) and then symlinking that to the 1.1.3 shared library. With those programs preserved, I then built the current <tt>zlib</tt> 1.2.13 and added its header files and libraries.
</p><p>
The natural next step would be to build something like OpenSSL, but modern versions require later build tools (the build attempt turned into a big mess), and older versions don&#39;t support enough to make them worth the effort. Instead, I went the self-contained application route. We need HTTPS support with TLS, and fortunately yours truly maintains a self-contained TLS library for ancient hardware: <a href="http://oldvcr.blogspot.com/2022/07/crypto-ancienne-20-now-brings-tls-13-to.html">Crypto Ancienne</a>. The length of the one-file build really strained the Dreamcast building it, but I finally got it to stick with <tt>-O2</tt>, and <tt>carl</tt> works great on the Dreamcast as a substitute for <tt>curl</tt> for downloading over HTTP and HTTPS. For SSH I selected <a href="https://matt.ucc.asn.au/dropbear/dropbear.html">Dropbear <tt>ssh</tt></a>, a &#34;relatively small&#34; SSH client and server package that&#39;s also completely self-contained and intended for embedded systems. It built with minimal changes which are in <tt>/usr/src</tt> and supports public keys (guess you&#39;ll be storing those on NFS too) and X11 forwarding. It connected to all my local SSH servers just fine.
</p><p>
And since there&#39;s always a need for useful network tools, I also threw in builds of <a href="http://www.dest-unreach.org/socat/"><tt>socat</tt></a> (minus the crypto support), <a href="http://www.acme.com/software/micro_inetd/"><tt>micro_inetd</tt></a> and period-correct <tt>netcat</tt>. Patches for these, mostly because this version of <tt>gcc</tt> doesn&#39;t like directives inside of macros, are all in <tt>/usr/src</tt>. With <tt>micro_inetd</tt> in particular you can run <tt>carl</tt> in proxy mode (something like <tt>micro_inetd 8765 /usr/bin/carl -pt</tt>, which listens on port 8765), or anything else you don&#39;t want to/can&#39;t hack <tt>/etc/inetd.conf</tt> for.
</p><p>
Last but not least: the time. As I mentioned earlier, the clock tends to lose time with lots of I/O, and DC Linux doesn&#39;t support the Dreamcast&#39;s hardware clock (the one that&#39;s always asking you for the time <a href="http://oldvcr.blogspot.com/2022/11/refurb-weekend-sega-dreamcast.html">when the battery runs down</a>), so the best solution is NTP. Although I fashioned a tiny clone <tt>ntpdate</tt> out of <a href="https://github.com/lettier/ntpclient"><tt>ntpclient</tt></a> (source for my changes in <tt>/usr/src</tt>), this wasn&#39;t enough to avoid <tt>make</tt> complaining about clock skew all the time after long jobs, and the timezone data included with this version is of course 22 years out of date with respect to changes in timezones and daylight savings.
</p><p>
Updating the timezone data was simply a matter of copying files from this Fedora 37 workstation, but building David Mills&#39; venerable reference NTP implementation was one of the big packages that made the Dreamcast consistently flip out. Fortunately, <a href="https://chrony.tuxfamily.org/"><tt>chrony</tt></a> compiled with minimal changes. Because the <tt>initrd</tt> was dangerously full, however, my initial attempt to put the configuration file in <tt>/etc/chrony.conf</tt> caused <tt>attempt to access beyond end of device</tt> errors when I restarted. This was solved by changing the configuration to use <tt>/usr/etc/chrony.conf</tt> instead, which has no such limitation. The configuration is very simple:
</p><div><pre>server ntp iburst
pool pool.ntp.org iburst
driftfile /var/lib/chrony/drift
makestep 1 3
</pre></div>
<p>
This causes <tt>chronyd</tt> to try consulting either a (presumably) local timesource named <tt>ntp</tt> or the North American NTP pool, and steps the clock for the first couple updates, slewing thereafter. Only one needs to be accessible (in fact, on my home test network which is not externally routable, only my local stratum-2 NTP timesource is available). The driftfile directive is obviously useless on a read-only filesystem, but it&#39;s there for future consideration. <tt>chronyd</tt> will automatically start with the system, and you can query its status with <tt>chronyc</tt>. Linux does not read or update the Dreamcast hardware clock.
</p><p>
Finally, how to set the local timezone? By default this is JST, the home timezone of DC Linux&#39;s original project leader, which I&#39;ve preserved as an homage but certainly isn&#39;t <em>my</em> local timezone. Irritatingly, relinking <tt>/etc/localtime</tt> will run the risk of incurring the same problems with the <tt>initrd</tt>, but we have a simpler, more flexible way: I added hooks to <tt>/etc/profile</tt>, <tt>/etc/csh.cshrc</tt>, <tt>/etc/csh.login</tt> and <tt>/etc/csh.logout</tt> that, if they exist and are executable, will run <tt>/netfs/profile</tt>, <tt>/netfs/csh.cshrc</tt>, <tt>/netfs/csh.login</tt> and <tt>/netfs/csh.logout</tt> respectively. In the appropriate file just set the <tt>TZ</tt> environment variable to your timezone, which for me is <tt>PST8PDT</tt>. You can use this mechanism as well for things like changing your shell (I have <tt>exec /usr/bin/tcsh</tt> in <tt>/netfs/profile</tt> because I&#39;m one of <em>those</em> people). There&#39;s also a hook during boot in <tt>init.d</tt> to run <tt>/netfs/startup.sh</tt> if it exists and is executable.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg9EcOzc64ybPPg8ibFI04jeff92vt1W4b6zE3967q6BZ-lPLlOkURzQBD2tMyC1kVp53nD_Pb9dQv7AZvLSo7Wz6yI6l8nZyYLGDQ2lK78CpzhIHOhfkuemoER7zu83yL9nOC-Fu8G-6wUa70msy5b8WjM049YbyEIW0EE1e_SpL57QszBzj7IrCdG/s4080/IMG_20230218_212621.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg9EcOzc64ybPPg8ibFI04jeff92vt1W4b6zE3967q6BZ-lPLlOkURzQBD2tMyC1kVp53nD_Pb9dQv7AZvLSo7Wz6yI6l8nZyYLGDQ2lK78CpzhIHOhfkuemoER7zu83yL9nOC-Fu8G-6wUa70msy5b8WjM049YbyEIW0EE1e_SpL57QszBzj7IrCdG/s320/IMG_20230218_212621.jpg" width="320"/></a></p><p>

Total number of useless discs made during the creation of Dusted-off Dreamcast Linux: eight. Several Bothan CD-Rs died to bring you this update.
</p><p>
What&#39;s next? The obvious one is to try to update the kernel, since that should yield more features without (too much) churn to the userland experience, and should fix that obnoxious Realtek 8139 driver problem with dropped interrupts. <a href="https://sourceforge.net/projects/linuxsh/">The LinuxSH project</a> has kernels through at least 2.6, though the latest kernels are all marked as testing, and the source in CVS shows that the Dreamcast hardware was already marked as &#34;attic&#34; even then. We also don&#39;t know if any changes were made to build the userland binaries it comes with. Until I come up with a cross-compiling solution, though, we&#39;d be largely limited to pre-built kernels and wouldn&#39;t be easily able to fix bugs in them.
</p><p>
On the userland side itself a few more games would be nice, as would expanding the available X libraries so that more substantial apps can be run, though the generally slow graphics and low resolution would be a practical limit on many things. And of course trying to set up the included Lynx forwarding through a local self-hosted Crypto Ancienne HTTPS-over-HTTP proxy will neatly solve the TLS problem, assuming this is one of the versions that can still be coerced into doing so (alternatively, building Chimera and its needed image libraries might also do). I should see how much <tt>w3m</tt> can be tricked into doing something similar.
</p><p>
In the meantime, get your Dreamcast out of the closet and feel free to play around. I&#39;ve christened it Dusted-off Dreamcast Linux, or DODCL, which you pronounce &#34;DOH-deckle&#34; (a la Intellivision &#34;decle&#34;). <a href="https://github.com/classilla/dclinux">The components and burning instructions are on Github</a>.
</p>
</div></div>
  </body>
</html>
