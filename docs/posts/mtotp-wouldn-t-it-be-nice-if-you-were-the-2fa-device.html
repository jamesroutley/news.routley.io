<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/VBranimir/mTOTP/tree/develop">Original</a>
    <h1>MTOTP: Wouldn&#39;t it be nice if you were the 2FA device?</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">It takes a special kind of geek to not carry a 2FA device.
One who becomes the 2FA.</p>
<p dir="auto">mTOTP is an experimental, manual variant of TOTP designed to be computed by a human without electronic devices. It explores the limits of time-based authentication under strict human constraints and makes no claims of cryptographic equivalence to standard TOTP.</p>
<hr/>

<ul dir="auto">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#demo">Demo</a>
<ul dir="auto">
<li><a href="#pam-demo">PAM demo</a></li>
</ul>
</li>
<li><a href="#overview">Overview</a></li>
<li><a href="#example-inputs">Example Inputs</a></li>
<li><a href="#step-1---build-time-vector">Step 1 - Build Time Vector</a></li>
<li><a href="#step-2---build-sbox-from-the-secret-key">Step 2 - Build Sbox from the Secret Key</a></li>
<li><a href="#step-3---combine-time-and-key-mod-10">Step 3 - Combine Time and Key (mod 10)</a></li>
<li><a href="#step-4---apply-sbox-substitution">Step 4 - Apply Sbox Substitution</a></li>
<li><a href="#step-5---diffusion-digit-mixing">Step 5 - Diffusion (Digit Mixing)</a></li>
<li><a href="#step-6---fold-to-5-digits">Step 6 - Fold to 5 Digits</a></li>
<li><a href="#step-7---calculate-final-digit-o6">Step 7 - Calculate Final Digit (o6)</a></li>
<li><a href="#final-mtotp">Final mTOTP</a></li>
<li><a href="#invariants--sanity-checks">Invariants &amp; Sanity Checks</a></li>
<li><a href="#testing-tool-usage">Testing tool usage</a></li>
<li><a href="#pam-plugin">PAM plugin</a></li>
<li><a href="#keycloak-plugin---tbd">Keycloak plugin - TBD</a></li>
</ul>

<p dir="auto">mTOTP is a <strong>human‑executable OTP scheme</strong> designed to be:</p>
<ul dir="auto">
<li>deterministic</li>
<li>mentally doable (with practice)</li>
<li>auditable and explainable</li>
<li>reproducible by both humans and software</li>
</ul>
<p dir="auto">This protocol intentionally allows OTPs to be calculated for future times.
Rather than treating this as a limitation, it makes it a requirement: the user must know when they intend to authenticate, and the verifier checks against that agreed moment. Time is therefore not an approximation, but an explicit part of the protocol - Turning authentication time from reactive to intentional.
This document describes the <strong>exact algorithm used by the tool</strong>, written for humans first.</p>
<p dir="auto">This protocol is designed for <strong>human execution first</strong>, with software acting as a helper and verifier.</p>


<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/VBranimir/mTOTP/blob/develop/docs/pam_demo.gif"><img src="https://github.com/VBranimir/mTOTP/raw/develop/docs/pam_demo.gif" alt="pam_mtotp SSH demo" data-animated-image=""/></a></p>

<p dir="auto">An mTOTP is generated from:</p>
<ul dir="auto">
<li>a <strong>secret numeric key</strong></li>
<li>a <strong>planned login time</strong></li>
</ul>
<p dir="auto">The algorithm uses:</p>
<ul dir="auto">
<li>a key‑derived digit S‑box</li>
<li>digitwise modular arithmetic</li>
<li>a simple diffusion step</li>
<li>a deterministic fold into a 6‑digit OTP</li>
</ul>
<p dir="auto">No randomness is involved during generation.</p>
<hr/>

<ul dir="auto">
<li>
<p dir="auto"><strong>Secret key (10 digits):</strong> <code>1234598760</code></p>
</li>
<li>
<p dir="auto"><strong>Planned login time:</strong></p>
</li>
</ul>
<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">Step 1 - Build Time Vector</h2><a id="user-content-step-1---build-time-vector" aria-label="Permalink: Step 1 - Build Time Vector" href="#step-1---build-time-vector"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Convert the planned login time into the format, take into account that you are calculating for the server-side set time:</p>

<p dir="auto">Example:</p>
<div data-snippet-clipboard-copy-content="2026‑01‑17 17:00 → 2601171700"><pre><code>2026‑01‑17 17:00 → 2601171700
</code></pre></div>
<p dir="auto">Result:</p>

<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">Step 2 - Build Sbox from the Secret Key</h2><a id="user-content-step-2---build-sbox-from-the-secret-key" aria-label="Permalink: Step 2 - Build Sbox from the Secret Key" href="#step-2---build-sbox-from-the-secret-key"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The S‑box is a <strong>digit substitution table (0–9 → 0–9)</strong> derived <strong>only from the secret key</strong>.
S-box (Substitution Box) is a digit-remapping table that replaces each digit (0–9) with another digit to introduce non-linearity.
It is derived deterministically from the secret key by writing down each digit the first time it appears in the key, then appending any missing digits (0–9) in order; the position is the input digit and the value is the output digit.</p>

<ol dir="auto">
<li>Read the key <strong>left to right</strong></li>
<li>Write down each digit <strong>the first time it appears</strong></li>
<li>Ignore repeated digits</li>
<li>Append any <strong>missing digits (0–9)</strong> at the end, in normal order</li>
<li>The <strong>position</strong> is the input digit</li>
</ol>

<p dir="auto">Secret key:</p>

<p dir="auto">Unique digits in order:</p>

<p dir="auto">Final S‑box list:</p>

<p dir="auto">S‑box table:</p>
<div data-snippet-clipboard-copy-content="Input :  0 1 2 3 4 5 6 7 8 9
Output:  1 2 3 4 5 9 8 7 6 0"><pre><code>Input :  0 1 2 3 4 5 6 7 8 9
Output:  1 2 3 4 5 9 8 7 6 0
</code></pre></div>
<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">Step 3 - Combine Time and Key (mod 10)</h2><a id="user-content-step-3---combine-time-and-key-mod-10" aria-label="Permalink: Step 3 - Combine Time and Key (mod 10)" href="#step-3---combine-time-and-key-mod-10"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Add the time digits and key digits <strong>position‑by‑position</strong>, using mod 10.</p>
<div data-snippet-clipboard-copy-content="Time: 2601171700
Key : 1234598760
----------------
Result: 3835669460"><pre><code>Time: 2601171700
Key : 1234598760
----------------
Result: 3835669460
</code></pre></div>
<p dir="auto">Call this:</p>

<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">Step 4 - Apply Sbox Substitution</h2><a id="user-content-step-4---apply-sbox-substitution" aria-label="Permalink: Step 4 - Apply Sbox Substitution" href="#step-4---apply-sbox-substitution"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Replace <strong>each digit</strong> of <code>C</code> using the S‑box table.</p>
<p dir="auto">Mapping from Step 2:</p>
<div data-snippet-clipboard-copy-content="0→1  1→2  2→3  3→4  4→5
5→9  6→8  7→7  8→6  9→0"><pre><code>0→1  1→2  2→3  3→4  4→5
5→9  6→8  7→7  8→6  9→0
</code></pre></div>
<p dir="auto">Apply to:</p>

<p dir="auto">Result:</p>

<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">Step 5 - Diffusion (Digit Mixing)</h2><a id="user-content-step-5---diffusion-digit-mixing" aria-label="Permalink: Step 5 - Diffusion (Digit Mixing)" href="#step-5---diffusion-digit-mixing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Diffusion mixes the digits so each position depends on the previous result: starting with the last digit, each digit is replaced by the sum of itself and the previous output (mod 10).
This ensures that changing a single digit affects all following digits while remaining simple enough to do mentally.</p>

<ol dir="auto">
<li>Set:</li>
</ol>

<ol start="2" dir="auto">
<li>For each digit from <strong>left to right</strong>:</li>
</ol>
<div data-snippet-clipboard-copy-content="new_digit = (current_digit + a) mod 10
a = new_digit"><pre><code>new_digit = (current_digit + a) mod 10
a = new_digit
</code></pre></div>

<p dir="auto">Start:</p>

<p dir="auto">Diffused result:</p>

<p dir="auto"><em>(Length is always preserved.)</em></p>
<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">Step 6 - Fold to 5 Digits</h2><a id="user-content-step-6---fold-to-5-digits" aria-label="Permalink: Step 6 - Fold to 5 Digits" href="#step-6---fold-to-5-digits"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Pair digits from the <strong>front and back</strong> and add them mod 10 like folded in half:</p>

<p dir="auto">or:</p>
<div data-snippet-clipboard-copy-content="(c1+c6) (c2+c7) (c3+c8) (c4+c9) (c5+c10)"><pre><code>(c1+c6) (c2+c7) (c3+c8) (c4+c9) (c5+c10)
</code></pre></div>
<p dir="auto">From our last step result:</p>

<p dir="auto">Calculation:</p>
<div data-snippet-clipboard-copy-content="5+0 = 5
1+0 = 1
5+5 = 0
4+3 = 7
2+4 = 6
"><pre><code>5+0 = 5
1+0 = 1
5+5 = 0
4+3 = 7
2+4 = 6

</code></pre></div>
<p dir="auto">Result:</p>

<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">Step 7 - Calculate Final Digit (o6)</h2><a id="user-content-step-7---calculate-final-digit-o6" aria-label="Permalink: Step 7 - Calculate Final Digit (o6)" href="#step-7---calculate-final-digit-o6"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Add the <strong>five OTP digits</strong> and take mod 10:</p>
<div data-snippet-clipboard-copy-content="(5+1+0+7+6) mod 10 = 19 mod 10 = 9"><pre><code>(5+1+0+7+6) mod 10 = 19 mod 10 = 9
</code></pre></div>
<hr/>


<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">Invariants &amp; Sanity Checks</h2><a id="user-content-invariants--sanity-checks" aria-label="Permalink: Invariants &amp; Sanity Checks" href="#invariants--sanity-checks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>S‑box is derived <strong>only from the key</strong></li>
<li>Length stays <strong>10 digits</strong> until folding</li>
<li>S‑box substitution never changes length</li>
<li>Diffusion always uses the <strong>previous result</strong></li>
<li>Final OTP is always <strong>6 digits</strong></li>
</ul>
<hr/>

<p dir="auto"><a href="https://github.com/VBranimir/mTOTP/blob/develop/tools/README.md">Tool README</a></p>

<p dir="auto"><a href="https://github.com/VBranimir/mTOTP/blob/develop/plugins/pam/README.md">PAM module</a></p>

<p dir="auto"><a href="https://github.com/VBranimir/mTOTP/blob/develop/plugins/keycloak/README.md">Keycloak module</a></p>
</article></div></div>
  </body>
</html>
