<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://eaton-works.com/2024/01/17/ttibi-email-hack/">Original</a>
    <h1>Hacking into a Toyota insurance company by exploiting their premium calculator</h1>
    
    <div id="readability-page-1" class="page"><article>
    
    <div>
        <picture><source type="image/avif" srcset="/assets/images/ew-logo-4circle-48.avif?cb=8d6f7828 48w"/><source type="image/webp" srcset="/assets/images/ew-logo-4circle-48.webp?cb=7b24baa4 48w"/><img alt="" loading="lazy" decoding="async" src="https://eaton-works.com/assets/images/ew-logo-4circle-48.png?cb=60093299" width="24"/></picture>
        <p><span title="Author: Eaton">Eaton</span>
        <span>•</span>
        <time title="Published: Wednesday, January 17, 2024 at 11:25:39 AM Eastern Standard Time" datetime="2024-01-17T16:25:39Z">Jan 17, 2024</time>
    </p></div>
    
    
    
<h2><strong>Key Points / Summary</strong></h2>



<ul>
<li>An Eicher Motors premium calculator website on a Toyota Tsusho Insurance Broker India subdomain exposed Microsoft corporate cloud credentials.</li>



<li>The email sending API returned sending logs to the client, which contained the email account’s password.</li>



<li>The password could be used to log into the “noreplyeicher@ttibi.co.in” Microsoft email account. No two-factor authentication was enabled on the account.</li>



<li>The email account had a record of everything they have ever sent to their customers, which is: <strong>657k emails (~25 GB) containing things like customer information, insurance policy PDFs, password reset links, OTPs, and much more.</strong></li>



<li>Other Microsoft cloud resources were also accessible, including but not limited to the corporate directory, SharePoint, and Teams.</li>



<li>Toyota Tsusho Insurance Broker India took down the vulnerable API more than 2 months later after my report, but still have not changed the email account’s password.</li>
</ul>







<p>New year, new automaker industry hack! As part of my automaker research projects last summer, Eicher Motors made its way up my list to investigate. In my efforts to find interesting exploits on Eicher Motors systems, I accidentally ended up compromising a different company in the process: Toyota Tsusho Insurance Broker India (“TTIBI”). A perfect storm of multiple issues culminated in me gaining control over the “noreplyeicher@ttibi.co.in” Microsoft email account, which not only had a record of everything they have ever sent to their customers, but also provided a foothold into their Microsoft cloud.</p>



<h2><strong>Toyota Tsusho Insurance Broker India and Eicher Motors</strong></h2>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/66cbbede-4182-43e8-e5b0-cbeafedf0f00/full" alt=""/></figure>



<p>Everyone knows Toyota, but not everyone knows about <a href="https://ttibi.co.in/" target="_blank" rel="noreferrer noopener">Toyota Tsusho Insurance Broker India (“TTIBI”)</a>. Toyota is comprised of a vast network of different companies. TTIBI is under the Toyota Tsusho Insurance Management Corporation in Japan. TTIBI was established in 2008 and is “<a href="https://ttibi.co.in/?q=company" target="_blank" rel="noreferrer noopener">a leading Insurance Broker across India</a>“.</p>



<p><a href="https://eicher.in/" target="_blank" rel="noreferrer noopener">Eicher Motors</a> is one of India’s leading automakers. They manufacture motorcycles under Royal Enfield Motors and commercial vehicles under VE Commercial Vehicles (VECV), which is a joint venture with Volvo Group.</p>



<p>Both companies have some type of insurance partnership because there is a <a href="https://eicher.ttibi.co.in/" target="_blank" rel="noreferrer noopener">dedicated Eicher subdomain</a> on the TTIBI site.</p>



<h2><strong>The Premium Calculator</strong></h2>



<p>While analyzing the <a href="https://play.google.com/store/apps/details?id=in.here.volvo.android" target="_blank" rel="noreferrer noopener">MY EICHER</a> Android app, I came across an inconspicuous URL inside an API interface Java class that was a link to a premium calculator:</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/e546e650-f76f-4cc6-10d5-1e529f1fc900/full" alt=""/></figure>



<p>Visiting the link in a browser revealed it:</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/ec96c3c3-a0aa-4463-1cbf-372b351d0400/full" alt=""/></figure>



<p>Looking at the source code of the website (literally right-click, view source), I quickly found some very interesting code:</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/8876743e-b45a-489c-074b-83f2e0c50000/full" alt=""/></figure>



<p>This caught my eye because this was a client-side email sending mechanism. If it worked, I could send a email with any subject &amp; body to anyone, and it would come from a genuine Eicher email address. However, seeing the Bearer Authorization put a damper on my excitement because it was clear you needed to be logged in somehow to use this API. Despite that, I decided to try crafting the API request to see what would happen. I was expecting it to come back with “401 – Unauthorized”, but what actually came back surprised me.</p>



<p>Not only did the email <a href="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/74c92be7-f696-462c-c703-09908df3c400/full" target="_blank" rel="noreferrer noopener">successfully send</a>, It came back with a server error that revealed an email sending log:</p>



<figure><img src="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/8bb2c241-9205-466a-9048-8a4d2730a400/full" alt=""/></figure>



<p>If you look closely, you can find the base64 encoded password. Being able to abuse this send email function was serious enough, but the leak of the email account password elevated this to a new level of severity.</p>



<h2><strong>The email account</strong></h2>



<p>This isn’t just any email account – it’s a noreply email account. noreply accounts are generally used for sending automated emails to customers. For example, when you reset a password, the link is likely to come from a noreply account. In many cases it can just be an alias on SendGrid, Postmark, etc, but it can also be an actual account that you can log in to. The noreply account could be the most important account in an organization because it could potentially have a record of everything they have ever sent to customers. In TTIBI’s case, that is exactly what it is and the amount of information revealed is enormous:</p>







<h2><strong>Exploring the impact</strong></h2>



<p>The email account is jam packed with personal/private information. To start, you can see all the insurance policies sent to customers – here’s a few examples from different insurance companies:</p>











<p>You could also view one-time-passwords (OTPs) and password reset links. With this, you could easily take over someone’s insurance account.</p>







<p>And you could of course access resources on their Microsoft cloud, such as the corporate directory, SharePoint, and Teams:</p>







<h2><strong>A perfect storm of security issues</strong></h2>



<p>The vulnerability was so severe because it was enabled by 5 unfortunate security issues/oversights. Developers and IT administrators should take note of all of these and make sure similar issues do not exist in your organization.</p>



<h3><strong>Issue #1: Client-side sending email mechanism</strong></h3>



<p>Don’t create an email sending function that the client has control over. Someone malicious can abuse it to send bad emails from your genuine account, leading to email reputation loss and phishing.</p>



<h3><strong>Issue #2: Missing API authentication</strong></h3>



<p>It looks like the frontend developer knew the email sending API should have been authenticated, but the backend developer missed the memo. If the server had actually checked the token, it might have entirely stopped this exploit.</p>



<h3><strong>Issue #3: Leaky API response</strong></h3>



<p>If something goes wrong when processing an API request, don’t give too much information back to the client. In this case a password managed to leak out, which is one of the worst things that could happen.</p>



<h3><strong>Issue #4: No two-factor authentication</strong></h3>



<p>Logging into the Microsoft account was surprisingly easy. There was no two-factor authentication set up or any other login verification prompts. If there was, it probably would not have been possible for me to successfully login.</p>



<h3><strong>Issue #5: Email retention</strong></h3>



<p>The final issue is that all emails the account had ever sent/received were retained, making it easy to access substantial amounts of customer information. Retention policies vary by industry, but this is a great example where having a policy in place could have softened the customer data exposure impact.</p>



<h2><strong>Password remains unchanged</strong></h2>



<p>More than 5 months later, TTIBI still have not changed the password of the email account despite being aware of the vulnerability. I checked it again today and I am still able to log in (<a href="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/fb9faf44-82d6-46d3-dafc-b7bbcb147a00/full" target="_blank" rel="noreferrer noopener">proof</a>). If I were them, I would not want a random stranger having access to their corporate cloud for 5 months. This is very disappointing, and I hope they improve their security posture so their customers’ data doesn’t leak out.</p>



<p>As an aside, I’m a little surprised that they weren’t alerted by Microsoft in some way to the unusual login. Or maybe they were, and the alert was ignored or not seen.</p>



<h2><strong>Timeline</strong></h2>



<p>TTIBI is not covered under <a href="https://hackerone.com/toyota?view_policy=true" target="_blank" rel="noreferrer noopener">Toyota’s HackerOne vulnerability disclosure program</a>, which is a shame because the team behind that has been quick to resolve <a href="https://eaton-works.com/2023/02/06/toyota-gspims-hack/" target="_blank" rel="noreferrer noopener">several</a> <a href="https://eaton-works.com/2023/03/06/toyota-c360-hack/" target="_blank" rel="noreferrer noopener">issues</a> I have reported to them in the past. I reported the issue to India’s <a href="https://www.cert-in.org.in/">CERT-In</a> instead.</p>



<ul>
<li><strong>August 7, 2023:</strong> I send a comprehensive email to CERT-In to report the vulnerability.</li>



<li><strong>August 8, 2023:</strong> Response received from CERT-In. A case ID was issued, and they stated they will reach out to TTIBI.</li>



<li><strong>September 1, 2023:</strong> I ask for an update.</li>



<li><strong>September 6, 2023:</strong> Response received confirming they reported the vulnerability to TTIBI and will share further updates as they receive them.</li>



<li><strong>October 8, 2023:</strong> I noticed the affected website was taken offline. However, the vulnerable API was not. I inform CERT-In.</li>



<li><strong>October 11, 2023:</strong> Response received confirming TTIBI has fixed the vulnerability. I check this and confirm the vulnerability is <strong>not</strong> fixed.</li>



<li><strong>October 18, 2023:</strong> I noticed the vulnerability is now fixed – the email sending API now requires authentication. I ask CERT-In if TTIBI can offer a bug bounty reward.</li>
</ul>



<p>Everything after October 18 is a back-and-forth between CERT-In and me trying to determine if there would be a bug bounty reward. TTIBI never responded to the question, so I decided to close the case on December 22 and CERT-In sent me a nice <a href="https://eaton-works.com/cdn-cgi/imagedelivery/VwwCqBIYNXeyNQwEQ8uyVQ/9bb02623-f19e-4223-d8e9-005c3d32a100/full" target="_blank" rel="noreferrer noopener">appreciation letter</a>.</p>

</article><div id="subscribe-section">
                <h2>Subscribe to new posts</h2>
                <p>Get an email notification every time something new is published.</p>
                

                
                
            </div></div>
  </body>
</html>
