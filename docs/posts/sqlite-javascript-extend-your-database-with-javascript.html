<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/sqliteai/sqlite-js">Original</a>
    <h1>Show HN: SQLite JavaScript - extend your database with JavaScript</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">SQLite-JS is a powerful extension that brings JavaScript capabilities to SQLite. With this extension, you can create custom SQLite functions, aggregates, window functions, and collation sequences using JavaScript code, allowing for flexible and powerful data manipulation directly within your SQLite database.</p>

<ul dir="auto">
<li><a href="#installation">Installation</a></li>
<li><a href="#functions-overview">Functions Overview</a></li>
<li><a href="#scalar-functions">Scalar Functions</a></li>
<li><a href="#aggregate-functions">Aggregate Functions</a></li>
<li><a href="#window-functions">Window Functions</a></li>
<li><a href="#collation-sequences">Collation Sequences</a></li>
<li><a href="#syncing-across-devices">Sync JavaScript Functions Across Devices</a></li>
<li><a href="#javascript-evaluation">JavaScript Evaluation</a></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#update-functions">Update Functions</a></li>
<li><a href="#building-from-source">Building from Source</a></li>
<li><a href="#license">License</a></li>
</ul>


<p dir="auto">Download the appropriate pre-built binary for your platform from the official <a href="https://github.com/sqliteai/sqlite-js/releases">Releases</a> page:</p>
<ul dir="auto">
<li>Linux: x86 and ARM</li>
<li>macOS: x86 and ARM</li>
<li>Windows: x86</li>
<li>Android</li>
<li>iOS</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="-- In SQLite CLI
.load ./js

-- In SQL
SELECT load_extension(&#39;./js&#39;);"><pre><span><span>--</span> In SQLite CLI</span>
.load .<span>/</span>js

<span><span>--</span> In SQL</span>
<span>SELECT</span> load_extension(<span><span>&#39;</span>./js<span>&#39;</span></span>);</pre></div>

<p dir="auto">SQLite-JS provides several ways to extend SQLite functionality with JavaScript:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Function Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Scalar Functions</td>
<td>Process individual rows and return a single value</td>
</tr>
<tr>
<td>Aggregate Functions</td>
<td>Process multiple rows and return a single aggregated result</td>
</tr>
<tr>
<td>Window Functions</td>
<td>Similar to aggregates but can access the full dataset</td>
</tr>
<tr>
<td>Collation Sequences</td>
<td>Define custom sort orders for text values</td>
</tr>
<tr>
<td>JavaScript Evaluation</td>
<td>Directly evaluate JavaScript code within SQLite</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<p dir="auto">Scalar functions process one row at a time and return a single value. They are useful for data transformation, calculations, text manipulation, etc.</p>

<div dir="auto" data-snippet-clipboard-copy-content="SELECT js_create_scalar(&#39;function_name&#39;, &#39;function_code&#39;);"><pre><span>SELECT</span> js_create_scalar(<span><span>&#39;</span>function_name<span>&#39;</span></span>, <span><span>&#39;</span>function_code<span>&#39;</span></span>);</pre></div>

<ul dir="auto">
<li><strong>function_name</strong>: The name of your custom function</li>
<li><strong>function_code</strong>: JavaScript code that defines your function. Must be in the form <code>function(args) { /* your code here */ }</code></li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="-- Create a custom function to calculate age from birth date
SELECT js_create_scalar(&#39;age&#39;, &#39;function(args) {
  const birthDate = new Date(args[0]);
  const today = new Date();
  let age = today.getFullYear() - birthDate.getFullYear();
  const m = today.getMonth() - birthDate.getMonth();
  if (m &lt; 0 || (m === 0 &amp;&amp; today.getDate() &lt; birthDate.getDate())) {
    age--;
  }
  return age;
}&#39;);

-- Use the function
SELECT name, age(birth_date) FROM people;"><pre><span><span>--</span> Create a custom function to calculate age from birth date</span>
<span>SELECT</span> js_create_scalar(<span><span>&#39;</span>age<span>&#39;</span></span>, <span><span>&#39;</span>function(args) {</span>
<span>  const birthDate = new Date(args[0]);</span>
<span>  const today = new Date();</span>
<span>  let age = today.getFullYear() - birthDate.getFullYear();</span>
<span>  const m = today.getMonth() - birthDate.getMonth();</span>
<span>  if (m &lt; 0 || (m === 0 &amp;&amp; today.getDate() &lt; birthDate.getDate())) {</span>
<span>    age--;</span>
<span>  }</span>
<span>  return age;</span>
<span>}<span>&#39;</span></span>);

<span><span>--</span> Use the function</span>
<span>SELECT</span> name, age(birth_date) <span>FROM</span> people;</pre></div>

<p dir="auto">Aggregate functions process multiple rows and compute a single result. Examples include SUM, AVG, and COUNT in standard SQL.</p>

<div dir="auto" data-snippet-clipboard-copy-content="SELECT js_create_aggregate(&#39;function_name&#39;, &#39;init_code&#39;, &#39;step_code&#39;, &#39;final_code&#39;);"><pre><span>SELECT</span> js_create_aggregate(<span><span>&#39;</span>function_name<span>&#39;</span></span>, <span><span>&#39;</span>init_code<span>&#39;</span></span>, <span><span>&#39;</span>step_code<span>&#39;</span></span>, <span><span>&#39;</span>final_code<span>&#39;</span></span>);</pre></div>

<ul dir="auto">
<li><strong>function_name</strong>: The name of your custom aggregate function</li>
<li><strong>init_code</strong>: JavaScript code that initializes variables for the aggregation</li>
<li><strong>step_code</strong>: JavaScript code that processes each row. Must be in the form <code>function(args) { /* your code here */ }</code></li>
<li><strong>final_code</strong>: JavaScript code that computes the final result. Must be in the form <code>function() { /* your code here */ }</code></li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="-- Create a median function
SELECT js_create_aggregate(&#39;median&#39;, 
  -- Init code: initialize an array to store values
  &#39;values = [];&#39;,
  
  -- Step code: collect values from each row
  &#39;function(args) {
    values.push(args[0]);
  }&#39;,
  
  -- Final code: calculate the median
  &#39;function() {
    values.sort((a, b) =&gt; a - b);
    const mid = Math.floor(values.length / 2);
    if (values.length % 2 === 0) {
      return (values[mid-1] + values[mid]) / 2;
    } else {
      return values[mid];
    }
  }&#39;
);

-- Use the function
SELECT median(salary) FROM employees;"><pre><span><span>--</span> Create a median function</span>
<span>SELECT</span> js_create_aggregate(<span><span>&#39;</span>median<span>&#39;</span></span>, 
  <span><span>--</span> Init code: initialize an array to store values</span>
  <span><span>&#39;</span>values = [];<span>&#39;</span></span>,
  
  <span><span>--</span> Step code: collect values from each row</span>
  <span><span>&#39;</span>function(args) {</span>
<span>    values.push(args[0]);</span>
<span>  }<span>&#39;</span></span>,
  
  <span><span>--</span> Final code: calculate the median</span>
  <span><span>&#39;</span>function() {</span>
<span>    values.sort((a, b) =&gt; a - b);</span>
<span>    const mid = Math.floor(values.length / 2);</span>
<span>    if (values.length % 2 === 0) {</span>
<span>      return (values[mid-1] + values[mid]) / 2;</span>
<span>    } else {</span>
<span>      return values[mid];</span>
<span>    }</span>
<span>  }<span>&#39;</span></span>
);

<span><span>--</span> Use the function</span>
<span>SELECT</span> median(salary) <span>FROM</span> employees;</pre></div>

<p dir="auto">Window functions, like aggregate functions, operate on a set of rows. However, they can access all rows in the current window without collapsing them into a single output row.</p>

<div dir="auto" data-snippet-clipboard-copy-content="SELECT js_create_window(&#39;function_name&#39;, &#39;init_code&#39;, &#39;step_code&#39;, &#39;final_code&#39;, &#39;value_code&#39;, &#39;inverse_code&#39;);"><pre><span>SELECT</span> js_create_window(<span><span>&#39;</span>function_name<span>&#39;</span></span>, <span><span>&#39;</span>init_code<span>&#39;</span></span>, <span><span>&#39;</span>step_code<span>&#39;</span></span>, <span><span>&#39;</span>final_code<span>&#39;</span></span>, <span><span>&#39;</span>value_code<span>&#39;</span></span>, <span><span>&#39;</span>inverse_code<span>&#39;</span></span>);</pre></div>

<ul dir="auto">
<li><strong>function_name</strong>: The name of your custom window function</li>
<li><strong>init_code</strong>: JavaScript code that initializes variables</li>
<li><strong>step_code</strong>: JavaScript code that processes each row. Must be in the form <code>function(args) { /* your code here */ }</code></li>
<li><strong>final_code</strong>: JavaScript code that computes the final result. Must be in the form <code>function() { /* your code here */ }</code></li>
<li><strong>value_code</strong>: JavaScript code that returns the current value. Must be in the form <code>function() { /* your code here */ }</code></li>
<li><strong>inverse_code</strong>: JavaScript code that removes a row from the current window. Must be in the form <code>function(args) { /* your code here */ }</code></li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="-- Create a moving average window function
SELECT js_create_window(&#39;moving_avg&#39;,
  -- Init code
  &#39;sum = 0; count = 0;&#39;,
  
  -- Step code: process each row
  &#39;function(args) {
    sum += args[0];
    count++;
  }&#39;,
  
  -- Final code: not needed for this example
  &#39;function() { }&#39;,
  
  -- Value code: return current average
  &#39;function() {
    return count &gt; 0 ? sum / count : null;
  }&#39;,
  
  -- Inverse code: remove a value from the window
  &#39;function(args) {
    sum -= args[0];
    count--;
  }&#39;
);

-- Use the function
SELECT id, value, moving_avg(value) OVER (ORDER BY id ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) 
FROM measurements;"><pre><span><span>--</span> Create a moving average window function</span>
<span>SELECT</span> js_create_window(<span><span>&#39;</span>moving_avg<span>&#39;</span></span>,
  <span><span>--</span> Init code</span>
  <span><span>&#39;</span>sum = 0; count = 0;<span>&#39;</span></span>,
  
  <span><span>--</span> Step code: process each row</span>
  <span><span>&#39;</span>function(args) {</span>
<span>    sum += args[0];</span>
<span>    count++;</span>
<span>  }<span>&#39;</span></span>,
  
  <span><span>--</span> Final code: not needed for this example</span>
  <span><span>&#39;</span>function() { }<span>&#39;</span></span>,
  
  <span><span>--</span> Value code: return current average</span>
  <span><span>&#39;</span>function() {</span>
<span>    return count &gt; 0 ? sum / count : null;</span>
<span>  }<span>&#39;</span></span>,
  
  <span><span>--</span> Inverse code: remove a value from the window</span>
  <span><span>&#39;</span>function(args) {</span>
<span>    sum -= args[0];</span>
<span>    count--;</span>
<span>  }<span>&#39;</span></span>
);

<span><span>--</span> Use the function</span>
<span>SELECT</span> id, value, moving_avg(value) OVER (<span>ORDER BY</span> id ROWS BETWEEN <span>2</span> PRECEDING <span>AND</span> CURRENT ROW) 
<span>FROM</span> measurements;</pre></div>

<p dir="auto">Collation sequences determine how text values are compared and sorted in SQLite. Custom collations enable advanced sorting capabilities like natural sorting, locale-specific sorting, etc.</p>

<div dir="auto" data-snippet-clipboard-copy-content="SELECT js_create_collation(&#39;collation_name&#39;, &#39;collation_function&#39;);"><pre><span>SELECT</span> js_create_collation(<span><span>&#39;</span>collation_name<span>&#39;</span></span>, <span><span>&#39;</span>collation_function<span>&#39;</span></span>);</pre></div>

<ul dir="auto">
<li><strong>collation_name</strong>: The name of your custom collation</li>
<li><strong>collation_function</strong>: JavaScript code that compares two strings. Must return a negative number if the first string is less than the second, zero if they are equal, or a positive number if the first string is greater than the second.</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="-- Create a case-insensitive natural sort collation
SELECT js_create_collation(&#39;natural_nocase&#39;, &#39;function(a, b) {
  // Extract numbers for natural comparison
  const splitA = a.toLowerCase().split(/(\d+)/);
  const splitB = b.toLowerCase().split(/(\d+)/);
  
  for (let i = 0; i &lt; Math.min(splitA.length, splitB.length); i++) {
    if (splitA[i] !== splitB[i]) {
      if (!isNaN(splitA[i]) &amp;&amp; !isNaN(splitB[i])) {
        return parseInt(splitA[i]) - parseInt(splitB[i]);
      }
      return splitA[i].localeCompare(splitB[i]);
    }
  }
  return splitA.length - splitB.length;
}&#39;);

-- Use the collation
SELECT * FROM files ORDER BY name COLLATE natural_nocase;"><pre><span><span>--</span> Create a case-insensitive natural sort collation</span>
<span>SELECT</span> js_create_collation(<span><span>&#39;</span>natural_nocase<span>&#39;</span></span>, <span><span>&#39;</span>function(a, b) {</span>
<span>  // Extract numbers for natural comparison</span>
<span>  const splitA = a.toLowerCase().split(/(<span>\d</span>+)/);</span>
<span>  const splitB = b.toLowerCase().split(/(<span>\d</span>+)/);</span>
<span>  </span>
<span>  for (let i = 0; i &lt; Math.min(splitA.length, splitB.length); i++) {</span>
<span>    if (splitA[i] !== splitB[i]) {</span>
<span>      if (!isNaN(splitA[i]) &amp;&amp; !isNaN(splitB[i])) {</span>
<span>        return parseInt(splitA[i]) - parseInt(splitB[i]);</span>
<span>      }</span>
<span>      return splitA[i].localeCompare(splitB[i]);</span>
<span>    }</span>
<span>  }</span>
<span>  return splitA.length - splitB.length;</span>
<span>}<span>&#39;</span></span>);

<span><span>--</span> Use the collation</span>
<span>SELECT</span> <span>*</span> <span>FROM</span> files <span>ORDER BY</span> name COLLATE natural_nocase;</pre></div>

<p dir="auto">When used with <a href="https://github.com/sqliteai/sqlite-sync/">sqlite-sync</a>, user-defined functions created via sqlite-js are automatically replicated across the SQLite Cloud cluster, ensuring that all connected peers share the same logic and behavior â€” even offline. To enable automatic persistence and sync the special <code>js_init_table</code> function must be executed.</p>

<div dir="auto" data-snippet-clipboard-copy-content="SELECT js_init_table();         -- Create table if needed (no loading)
SELECT js_init_table(1);        -- Create table and load all stored functions"><pre><span>SELECT</span> js_init_table();         <span><span>--</span> Create table if needed (no loading)</span>
<span>SELECT</span> js_init_table(<span>1</span>);        <span><span>--</span> Create table and load all stored functions</span></pre></div>

<p dir="auto">The extension also provides a way to directly evaluate JavaScript code within SQLite queries.</p>

<div dir="auto" data-snippet-clipboard-copy-content="SELECT js_eval(&#39;javascript_code&#39;);"><pre><span>SELECT</span> js_eval(<span><span>&#39;</span>javascript_code<span>&#39;</span></span>);</pre></div>

<ul dir="auto">
<li><strong>javascript_code</strong>: Any valid JavaScript code to evaluate</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="-- Perform a calculation
SELECT js_eval(&#39;Math.PI * Math.pow(5, 2)&#39;);

-- Format a date
SELECT js_eval(&#39;new Date(1629381600000).toLocaleDateString()&#39;);"><pre><span><span>--</span> Perform a calculation</span>
<span>SELECT</span> js_eval(<span><span>&#39;</span>Math.PI * Math.pow(5, 2)<span>&#39;</span></span>);

<span><span>--</span> Format a date</span>
<span>SELECT</span> js_eval(<span><span>&#39;</span>new Date(1629381600000).toLocaleDateString()<span>&#39;</span></span>);</pre></div>

<div dir="auto"><h3 tabindex="-1" dir="auto">Example 1: String Manipulation</h3><a id="user-content-example-1-string-manipulation" aria-label="Permalink: Example 1: String Manipulation" href="#example-1-string-manipulation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="-- Create a function to extract domain from email
SELECT js_create_scalar(&#39;get_domain&#39;, &#39;function(args) {
  const email = args[0];
  return email.split(&#34;@&#34;)[1] || null;
}&#39;);

-- Use it in a query
SELECT email, get_domain(email) AS domain FROM users;"><pre><span><span>--</span> Create a function to extract domain from email</span>
<span>SELECT</span> js_create_scalar(<span><span>&#39;</span>get_domain<span>&#39;</span></span>, <span><span>&#39;</span>function(args) {</span>
<span>  const email = args[0];</span>
<span>  return email.split(&#34;@&#34;)[1] || null;</span>
<span>}<span>&#39;</span></span>);

<span><span>--</span> Use it in a query</span>
<span>SELECT</span> email, get_domain(email) <span>AS</span> domain <span>FROM</span> users;</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Example 2: Statistical Aggregation</h3><a id="user-content-example-2-statistical-aggregation" aria-label="Permalink: Example 2: Statistical Aggregation" href="#example-2-statistical-aggregation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="-- Create a function to calculate standard deviation
SELECT js_create_aggregate(&#39;stddev&#39;,
  &#39;sum = 0; sumSq = 0; count = 0;&#39;,
  
  &#39;function(args) {
    const val = args[0];
    sum += val;
    sumSq += val * val;
    count++;
  }&#39;,
  
  &#39;function() {
    if (count &lt; 2) return null;
    const variance = (sumSq - (sum * sum) / count) / (count - 1);
    return Math.sqrt(variance);
  }&#39;
);

-- Use it in a query
SELECT department, stddev(salary) FROM employees GROUP BY department;"><pre><span><span>--</span> Create a function to calculate standard deviation</span>
<span>SELECT</span> js_create_aggregate(<span><span>&#39;</span>stddev<span>&#39;</span></span>,
  <span><span>&#39;</span>sum = 0; sumSq = 0; count = 0;<span>&#39;</span></span>,
  
  <span><span>&#39;</span>function(args) {</span>
<span>    const val = args[0];</span>
<span>    sum += val;</span>
<span>    sumSq += val * val;</span>
<span>    count++;</span>
<span>  }<span>&#39;</span></span>,
  
  <span><span>&#39;</span>function() {</span>
<span>    if (count &lt; 2) return null;</span>
<span>    const variance = (sumSq - (sum * sum) / count) / (count - 1);</span>
<span>    return Math.sqrt(variance);</span>
<span>  }<span>&#39;</span></span>
);

<span><span>--</span> Use it in a query</span>
<span>SELECT</span> department, stddev(salary) <span>FROM</span> employees <span>GROUP BY</span> department;</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Example 3: Custom Window Function</h3><a id="user-content-example-3-custom-window-function" aria-label="Permalink: Example 3: Custom Window Function" href="#example-3-custom-window-function"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="-- Create a window function to calculate percentile within a window
SELECT js_create_window(&#39;percentile_rank&#39;,
  &#39;values = [];&#39;,
  
  &#39;function(args) {
    values.push(args[0]);
  }&#39;,
  
  &#39;function() {
    values.sort((a, b) =&gt; a - b);
  }&#39;,
  
  &#39;function() {
    const current = values[values.length - 1];
    const rank = values.indexOf(current);
    return (rank / (values.length - 1)) * 100;
  }&#39;,
  
  &#39;function(args) {
    const index = values.indexOf(args[0]);
    if (index !== -1) {
      values.splice(index, 1);
    }
  }&#39;
);

-- Use it in a query
SELECT name, score, 
       percentile_rank(score) OVER (ORDER BY score) 
FROM exam_results;"><pre><span><span>--</span> Create a window function to calculate percentile within a window</span>
<span>SELECT</span> js_create_window(<span><span>&#39;</span>percentile_rank<span>&#39;</span></span>,
  <span><span>&#39;</span>values = [];<span>&#39;</span></span>,
  
  <span><span>&#39;</span>function(args) {</span>
<span>    values.push(args[0]);</span>
<span>  }<span>&#39;</span></span>,
  
  <span><span>&#39;</span>function() {</span>
<span>    values.sort((a, b) =&gt; a - b);</span>
<span>  }<span>&#39;</span></span>,
  
  <span><span>&#39;</span>function() {</span>
<span>    const current = values[values.length - 1];</span>
<span>    const rank = values.indexOf(current);</span>
<span>    return (rank / (values.length - 1)) * 100;</span>
<span>  }<span>&#39;</span></span>,
  
  <span><span>&#39;</span>function(args) {</span>
<span>    const index = values.indexOf(args[0]);</span>
<span>    if (index !== -1) {</span>
<span>      values.splice(index, 1);</span>
<span>    }</span>
<span>  }<span>&#39;</span></span>
);

<span><span>--</span> Use it in a query</span>
<span>SELECT</span> name, score, 
       percentile_rank(score) OVER (<span>ORDER BY</span> score) 
<span>FROM</span> exam_results;</pre></div>

<p dir="auto">Due to a constraint in <a href="https://www3.sqlite.org/src/info/cabab62bc10568d4" rel="nofollow">SQLite</a>, it is not possible to update or redefine a user-defined function using the same database connection that was used to initially register it. To modify an existing JavaScript function, the update must be performed through a separate database connection.</p>

<p dir="auto">See the included Makefile for building instructions:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Build for your current platform
make

# Build for a specific platform
make PLATFORM=macos
make PLATFORM=linux
make PLATFORM=windows

# Install
make install"><pre><span><span>#</span> Build for your current platform</span>
make

<span><span>#</span> Build for a specific platform</span>
make PLATFORM=macos
make PLATFORM=linux
make PLATFORM=windows

<span><span>#</span> Install</span>
make install</pre></div>

<p dir="auto">This project is licensed under the MIT License - see the LICENSE file for details.</p>
</article></div></div>
  </body>
</html>
