<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/1rgs/jsonformer">Original</a>
    <h1>Jsonformer: Generate structured output from LLMs</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<h3 tabindex="-1" dir="auto"><a id="user-content-problem-getting-models-to-output-structured-json-is-hard" aria-label="Heading link" href="#problem-getting-models-to-output-structured-json-is-hard"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Problem: Getting models to output structured JSON is hard</h3>
<h3 tabindex="-1" dir="auto"><a id="user-content-solution-only-generate-the-content-tokens-and-fill-in-the-fixed-tokens" aria-label="Heading link" href="#solution-only-generate-the-content-tokens-and-fill-in-the-fixed-tokens"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Solution: Only generate the content tokens and fill in the fixed tokens</h3>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/1rgs/jsonformer/blob/main/img/cover4.png"><img src="https://github.com/1rgs/jsonformer/raw/main/img/cover4.png" alt="cover"/></a></p>
<p dir="auto">Generating structured JSON from language models is a challenging task. The
generated JSON must be syntactically correct, and it must conform to a schema
that specifies the structure of the JSON.</p>
<p dir="auto">Current approaches to this problem are brittle and error-prone. They rely on prompt engineering, fine-tuning, and post-processing, but they still fail to generate syntactically correct JSON in many cases.</p>
<p dir="auto">Jsonformer is a new approach to this problem. In structured data, many tokens are fixed and predictable. Jsonformer is a wrapper around HuggingFace models that fills in the fixed tokens during the generation process, and only delegates the generation of content tokens to the language model. This makes it more efficient and bulletproof than existing approaches.</p>
<p dir="auto">This currently supports a subset of JSON Schema. Below is a list of the supported schema types:</p>
<ul dir="auto">
<li>number</li>
<li>boolean</li>
<li>string</li>
<li>array</li>
<li>object</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-example" aria-label="Heading link" href="#example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Example</h2>
<div dir="auto" data-snippet-clipboard-copy-content="from jsonformer import Jsonformer
from transformers import AutoModelForCausalLM, AutoTokenizer

model = AutoModelForCausalLM.from_pretrained(&#34;databricks/dolly-v2-12b&#34;)
tokenizer = AutoTokenizer.from_pretrained(&#34;databricks/dolly-v2-12b&#34;)

json_schema = {
    &#34;type&#34;: &#34;object&#34;,
    &#34;properties&#34;: {
        &#34;name&#34;: {&#34;type&#34;: &#34;string&#34;},
        &#34;age&#34;: {&#34;type&#34;: &#34;number&#34;},
        &#34;is_student&#34;: {&#34;type&#34;: &#34;boolean&#34;},
        &#34;courses&#34;: {
            &#34;type&#34;: &#34;array&#34;,
            &#34;items&#34;: {&#34;type&#34;: &#34;string&#34;}
        }
    }
}

prompt = &#34;Generate a person&#39;s information based on the following schema:&#34;
jsonformer = Jsonformer(model, tokenizer, json_schema, prompt)
generated_data = jsonformer()

print(generated_data)"><pre><span>from</span> <span>jsonformer</span> <span>import</span> <span>Jsonformer</span>
<span>from</span> <span>transformers</span> <span>import</span> <span>AutoModelForCausalLM</span>, <span>AutoTokenizer</span>

<span>model</span> <span>=</span> <span>AutoModelForCausalLM</span>.<span>from_pretrained</span>(<span>&#34;databricks/dolly-v2-12b&#34;</span>)
<span>tokenizer</span> <span>=</span> <span>AutoTokenizer</span>.<span>from_pretrained</span>(<span>&#34;databricks/dolly-v2-12b&#34;</span>)

<span>json_schema</span> <span>=</span> {
    <span>&#34;type&#34;</span>: <span>&#34;object&#34;</span>,
    <span>&#34;properties&#34;</span>: {
        <span>&#34;name&#34;</span>: {<span>&#34;type&#34;</span>: <span>&#34;string&#34;</span>},
        <span>&#34;age&#34;</span>: {<span>&#34;type&#34;</span>: <span>&#34;number&#34;</span>},
        <span>&#34;is_student&#34;</span>: {<span>&#34;type&#34;</span>: <span>&#34;boolean&#34;</span>},
        <span>&#34;courses&#34;</span>: {
            <span>&#34;type&#34;</span>: <span>&#34;array&#34;</span>,
            <span>&#34;items&#34;</span>: {<span>&#34;type&#34;</span>: <span>&#34;string&#34;</span>}
        }
    }
}

<span>prompt</span> <span>=</span> <span>&#34;Generate a person&#39;s information based on the following schema:&#34;</span>
<span>jsonformer</span> <span>=</span> <span>Jsonformer</span>(<span>model</span>, <span>tokenizer</span>, <span>json_schema</span>, <span>prompt</span>)
<span>generated_data</span> <span>=</span> <span>jsonformer</span>()

<span>print</span>(<span>generated_data</span>)</pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-features" aria-label="Heading link" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Features</h2>
<ul dir="auto">
<li>Bulletproof JSON generation: Jsonformer ensures that the generated JSON is always syntactically correct and conforms to the specified schema.</li>
<li>Efficiency: By generating only the content tokens and filling in the fixed tokens, Jsonformer is more efficient than generating a full JSON string and parsing it.</li>
<li>Flexible and extendable: Jsonformer is built on top of the HuggingFace transformers library, making it compatible with any model that supports the HuggingFace interface.</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-installation" aria-label="Heading link" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>

<h2 tabindex="-1" dir="auto"><a id="user-content-license" aria-label="Heading link" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>License</h2>
<p dir="auto">Jsonformer is released under the MIT License. You are free to use, modify, and distribute this software for any purpose, commercial or non-commercial, as long as the original copyright and license notice are included.</p>
</article>
          </div></div>
  </body>
</html>
