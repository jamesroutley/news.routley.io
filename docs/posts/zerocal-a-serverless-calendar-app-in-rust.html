<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://endler.dev/2022/zerocal/">Original</a>
    <h1>Zerocal – A Serverless Calendar App in Rust</h1>
    
    <div id="readability-page-1" class="page"><div><article><p>Published on 5th of October, 2022</p><h3>— How to create a calendar event from the convenience of your command line. 🤖</h3><figure><img height="264" src="https://endler.dev/2022/zerocal/intro.svg" width="487"/></figure><p>Every once in a while my buddies and I meet for dinner. I value these evenings, but the worst part is scheduling these events!</p><p>We send out a message to the group.</p><p>None of that is fun <em>except</em> for the dinner.</p><p>Being the reasonable person you are, you would think: &#34;Why don&#39;t you just use a scheduling app?&#34;.</p><p>I have tried many of them. None of them are any good. They are all... <em>too much</em>!</p><p>Just let me send out an invite and whoever wants can show up.</p><ul><li>I <em>don’t</em> want to have to create an account for your calendar/scheduling/whatever app.</li><li>I <em>don’t</em> want to have to add my friends.</li><li>I <em>don’t</em> want to have to add my friends’ friends.</li><li>I <em>don’t</em> want to have to add my friends’ friends’ friends.</li><li>You get the idea: I just want to send out an invite and get no response from you.</li></ul><h2 id="the-nerdy-introvert-engineer-s-solution"><a href="#the-nerdy-introvert-engineer-s-solution"> <svg viewBox="0 0 24 24" height="22" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path></svg> </a>The nerdy, introvert engineer&#39;s solution</h2><p>💡 What we definitely need is yet another calendar app which allows us to create events and send out an invite with a link to that event! You probably didn&#39;t see that coming now, did you?</p><p>Oh, and I don&#39;t want to use Google Calendar to create the event because <a href="https://www.businessinsider.com/google-users-locked-out-after-years-2020-10">I</a> <a href="https://killedbygoogle.com/">don&#39;t</a> <a href="https://github.com/tycrek/degoogle">trust them</a>.</p><p>Like any reasonable person, I wanted a way to create calendar entries from my <em>terminal</em>.</p><p>That&#39;s how I pitched the idea to my buddies last time. The answer was: &#34;I don’t know, sounds like a solution in search of a problem.&#34; But you know what they say: Never ask a starfish for directions.</p><h2 id="show-don-t-tell"><a href="#show-don-t-tell"> <svg viewBox="0 0 24 24" height="22" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path></svg> </a>Show, don’t tell</h2><p>That night I went home and built a website that would create a calendar entry from <code>GET</code> parameters.</p><p>It allows you to create a calendar event from the convenience of your command line:</p><pre data-lang="bash"><code data-lang="bash"><span>&gt;</span><span> curl https://zerocal.shuttleapp.rs?start</span><span>=</span><span>2022-11-04+20:00&amp;duration=3h&amp;title=Birthday&amp;description=paaarty
</span><span>BEGIN:VCALENDAR
</span><span>VERSION:2.0
</span><span>PRODID:ICALENDAR-RS
</span><span>CALSCALE:GREGORIAN
</span><span>BEGIN:VEVENT
</span><span>DTSTAMP:20221002T123149Z
</span><span>CLASS:CONFIDENTIAL
</span><span>DESCRIPTION:paaarty
</span><span>DTEND:20221002T133149Z
</span><span>DTSTART:20221002T123149Z
</span><span>SUMMARY:Birthday
</span><span>UID:c99dd4bb-5c35-4d61-9c46-7a471de0e7f4
</span><span>END:VEVENT
</span><span>END:VCALENDAR
</span></code></pre><p>You can then save that to a file and open it with your calendar app.</p><pre data-lang="bash"><code data-lang="bash"><span>&gt;</span><span> curl https://zerocal.shuttleapp.rs?start</span><span>=</span><span>2022-11-04+20:00&amp;duration=3h&amp;title=Birthday&amp;description=paaarty </span><span>&gt;</span><span> birthday.ics
</span><span>&gt;</span><span> open </span><span>birthday.ics
</span></code></pre><p>In a sense, it&#39;s a &#34;serverless calendar app&#34;, haha. There is no state on the server, it just generates a calendar event on the fly and returns it.</p><h2 id="how-i-built-it"><a href="#how-i-built-it"> <svg viewBox="0 0 24 24" height="22" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path></svg> </a>How I built it</h2><p>You probably noticed that the URL contains &#34;shuttleapp.rs&#34;. That&#39;s because I&#39;m using <a href="https://github.com/shuttle-hq/shuttle">shuttle.rs</a> to host the website.</p><p>Shuttle is a hosting service for Rust projects and I wanted to try it out for a long time.</p><p>To initialize the project using the awesome <a href="https://github.com/tokio-rs/axum">axum</a> web framework, I’ve used</p><pre><code><span>cargo install cargo-shuttle
</span><span>cargo shuttle init --axum --name zerocal zerocal
</span></code></pre><p>and I was greeted with everything I needed to get started:</p><pre data-lang="rust"><code data-lang="rust"><span>use </span><span>axum</span><span>::</span><span>{routing</span><span>::</span><span>get</span><span>,</span><span> Router}</span><span>;
</span><span>use </span><span>sync_wrapper</span><span>::</span><span>SyncWrapper</span><span>;
</span><span>
</span><span>async </span><span>fn </span><span>hello_world</span><span>() </span><span>-&gt; </span><span>&amp;</span><span>&#39;static str </span><span>{
</span><span>  </span><span>&#34;Hello, world!&#34;
</span><span>}
</span><span>
</span><span>#</span><span>[</span><span>shuttle_service</span><span>::</span><span>main</span><span>]
</span><span>async </span><span>fn </span><span>axum</span><span>() </span><span>-&gt; </span><span>shuttle_service</span><span>::</span><span>ShuttleAxum {
</span><span>  </span><span>let</span><span> router </span><span>= </span><span>Router</span><span>::</span><span>new()</span><span>.</span><span>route</span><span>(</span><span>&#34;/hello&#34;</span><span>, </span><span>get</span><span>(hello_world))</span><span>;
</span><span>  </span><span>let</span><span> sync_wrapper </span><span>= </span><span>SyncWrapper</span><span>::</span><span>new(router)</span><span>;
</span><span>
</span><span>  </span><span>Ok</span><span>(sync_wrapper)
</span><span>}
</span></code></pre><p>Let&#39;s quickly commit the changes:</p><pre data-lang="bash"><code data-lang="bash"><span>git</span><span> add .gitignore Cargo.toml src/
</span><span>git</span><span> commit</span><span> -m </span><span>&#34;Hello World&#34;
</span></code></pre><p>To deploy the code, I needed to sign up for a shuttle account. This can be done over at <a href="https://www.shuttle.rs/login">https://www.shuttle.rs/login</a>.</p><p>It will ask you to authorize it to access your Github account.</p><p>Then:</p><pre data-lang="sh"><code data-lang="sh"><span>cargo</span><span> shuttle login
</span></code></pre><p>and finally:</p><pre data-lang="sh"><code data-lang="sh"><span>cargo</span><span> shuttle deploy
</span></code></pre><p>Now let&#39;s head over to <a href="https://zerocal.shuttleapp.rs">zerocal.shuttleapp.rs</a>:</p><pre><code><span>Hello World!
</span></code></pre><p>Deploying the first version took less than 5 minutes. Neat! We&#39;re all set for our custom calendar app.</p><h2 id="writing-the-app"><a href="#writing-the-app"> <svg viewBox="0 0 24 24" height="22" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path></svg> </a>Writing the app</h2><p>To create the calendar event, I used the <a href="https://github.com/hoodie/icalendar-rs">icalendar</a> crate (shout out to <a href="https://github.com/hoodie">hoodie</a> for creating this nice library!). <a href="https://en.wikipedia.org/wiki/ICalendar">iCalendar</a> is a standard for creating calendar events that is supported by most calendar apps.</p><pre data-lang="sh"><code data-lang="sh"><span>cargo</span><span> add icalendar
</span><span>cargo</span><span> add chrono </span><span># For date and time parsing
</span></code></pre><p>Let&#39;s create a demo calendar event:</p><pre data-lang="rust"><code data-lang="rust"><span>let</span><span> event </span><span>= </span><span>Event</span><span>::</span><span>new()
</span><span>  </span><span>.</span><span>summary</span><span>(</span><span>&#34;test event&#34;</span><span>)
</span><span>  </span><span>.</span><span>description</span><span>(</span><span>&#34;here I have something really important to do&#34;</span><span>)
</span><span>  </span><span>.</span><span>starts</span><span>(Utc</span><span>::</span><span>now())
</span><span>  </span><span>.</span><span>ends</span><span>(Utc</span><span>::</span><span>now() </span><span>+ </span><span>Duration</span><span>::</span><span>days(</span><span>1</span><span>))
</span><span>  </span><span>.</span><span>done</span><span>()</span><span>;
</span></code></pre><p>Simple enough.</p><h2 id="how-to-return-a-file"><a href="#how-to-return-a-file"> <svg viewBox="0 0 24 24" height="22" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path></svg> </a>How to return a file!?</h2><p>Now that we have a calendar event, we need to return it to the user. But how do we return it as a file?</p><p>There&#39;s an example of how to return a file dynamically in axum <a href="https://github.com/tokio-rs/axum/discussions/608">here</a>.</p><pre data-lang="rust"><code data-lang="rust"><span>async </span><span>fn </span><span>calendar</span><span>() </span><span>-&gt;</span><span> impl IntoResponse {
</span><span>  </span><span>let</span><span> ical </span><span>= </span><span>Calendar</span><span>::</span><span>new()
</span><span>    </span><span>.</span><span>push</span><span>(
</span><span>      </span><span>// add an event
</span><span>      Event</span><span>::</span><span>new()
</span><span>        </span><span>.</span><span>summary</span><span>(</span><span>&#34;It works! 😀&#34;</span><span>)
</span><span>        </span><span>.</span><span>description</span><span>(</span><span>&#34;Meeting with the Rust community&#34;</span><span>)
</span><span>        </span><span>.</span><span>starts</span><span>(Utc</span><span>::</span><span>now() </span><span>+ </span><span>Duration</span><span>::</span><span>hours(</span><span>1</span><span>))
</span><span>        </span><span>.</span><span>ends</span><span>(Utc</span><span>::</span><span>now() </span><span>+ </span><span>Duration</span><span>::</span><span>hours(</span><span>2</span><span>))
</span><span>        </span><span>.</span><span>done</span><span>()</span><span>,
</span><span>    )
</span><span>    </span><span>.</span><span>done</span><span>()</span><span>;
</span><span>
</span><span>  CalendarResponse(ical)
</span><span>}
</span></code></pre><p>Some interesting things to note here:</p><ul><li>Every calendar file is a collection of events so we wrap the event in a <code>Calendar</code> object, which represents the collection.</li><li><code>impl IntoResponse</code> is a trait that allows us to return any type that implements it.</li><li><code>CalendarResponse</code> is a <a href="https://rust-unofficial.github.io/patterns/patterns/behavioural/newtype.html">newtype wrapper</a> around <code>Calendar</code> that implements <code>IntoResponse</code>.</li></ul><p>Here is the <code>CalendarResponse</code> implementation:</p><pre data-lang="rust"><code data-lang="rust"><span>/// Newtype wrapper around Calendar for `IntoResponse` impl
</span><span>#</span><span>[</span><span>derive</span><span>(Debug)]
</span><span>pub struct </span><span>CalendarResponse</span><span>(pub Calendar)</span><span>;
</span><span>
</span><span>impl </span><span>IntoResponse </span><span>for </span><span>CalendarResponse </span><span>{
</span><span>  </span><span>fn </span><span>into_response</span><span>(</span><span>self</span><span>) </span><span>-&gt;</span><span> Response {
</span><span>    </span><span>let mut</span><span> res </span><span>= </span><span>Response</span><span>::</span><span>new(</span><span>boxed</span><span>(Full</span><span>::</span><span>from(</span><span>self</span><span>.</span><span>0.</span><span>to_string</span><span>())))</span><span>;
</span><span>    res</span><span>.</span><span>headers_mut</span><span>()</span><span>.</span><span>insert</span><span>(
</span><span>      header</span><span>::</span><span>CONTENT_TYPE</span><span>,
</span><span>      HeaderValue</span><span>::</span><span>from_static(</span><span>&#34;text/calendar&#34;</span><span>)</span><span>,
</span><span>    )</span><span>;
</span><span>    res
</span><span>  }
</span><span>}
</span></code></pre><p>We just create a new <code>Response</code> object and set the <code>Content-Type</code> header to the correct MIME type for iCalendar files: <code>text/calendar</code>. Then we return the response.</p><h2 id="add-date-parsing"><a href="#add-date-parsing"> <svg viewBox="0 0 24 24" height="22" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path></svg> </a>Add date parsing</h2><p>This part is a bit hacky, so feel free to glance over it. We need to parse the date and duration from the query string. I used <a href="https://docs.rs/dateparser">dateparser</a>, because it supports <a href="https://docs.rs/dateparser/latest/dateparser/#accepted-date-formats">sooo many different date formats</a>.</p><pre data-lang="rust"><code data-lang="rust"><span>async </span><span>fn </span><span>calendar</span><span>(Query(</span><span>params</span><span>): Query&lt;HashMap&lt;</span><span>String</span><span>, </span><span>String</span><span>&gt;&gt;) </span><span>-&gt;</span><span> impl IntoResponse {
</span><span>  </span><span>let mut</span><span> event </span><span>= </span><span>Event</span><span>::</span><span>new()</span><span>;
</span><span>  event</span><span>.</span><span>class</span><span>(Class</span><span>::</span><span>Confidential)</span><span>;
</span><span>
</span><span>  </span><span>if let </span><span>Some</span><span>(title) </span><span>=</span><span> params</span><span>.</span><span>get</span><span>(</span><span>&#34;title&#34;</span><span>) {
</span><span>    event</span><span>.</span><span>summary</span><span>(title)</span><span>;
</span><span>  } </span><span>else </span><span>{
</span><span>    event</span><span>.</span><span>summary</span><span>(</span><span>DEFAULT_EVENT_TITLE</span><span>)</span><span>;
</span><span>  }
</span><span>  </span><span>if let </span><span>Some</span><span>(description) </span><span>=</span><span> params</span><span>.</span><span>get</span><span>(</span><span>&#34;description&#34;</span><span>) {
</span><span>    event</span><span>.</span><span>description</span><span>(description)</span><span>;
</span><span>  } </span><span>else </span><span>{
</span><span>    event</span><span>.</span><span>description</span><span>(</span><span>&#34;Powered by zerocal.shuttleapp.rs&#34;</span><span>)</span><span>;
</span><span>  }
</span><span>
</span><span>  </span><span>if let </span><span>Some</span><span>(start) </span><span>=</span><span> params</span><span>.</span><span>get</span><span>(</span><span>&#34;start&#34;</span><span>) {
</span><span>    </span><span>let</span><span> start </span><span>= </span><span>dateparser</span><span>::</span><span>parse(start)</span><span>.</span><span>unwrap</span><span>()</span><span>;
</span><span>    event</span><span>.</span><span>starts</span><span>(start)</span><span>;
</span><span>    </span><span>if let </span><span>Some</span><span>(duration) </span><span>=</span><span> params</span><span>.</span><span>get</span><span>(</span><span>&#34;duration&#34;</span><span>) {
</span><span>      </span><span>let</span><span> duration </span><span>= </span><span>humantime</span><span>::</span><span>parse_duration(duration)</span><span>.</span><span>unwrap</span><span>()</span><span>;
</span><span>      </span><span>let</span><span> duration </span><span>= </span><span>chrono</span><span>::</span><span>Duration</span><span>::</span><span>from_std(duration)</span><span>.</span><span>unwrap</span><span>()</span><span>;
</span><span>      event</span><span>.</span><span>ends</span><span>(start </span><span>+</span><span> duration)</span><span>;
</span><span>    }
</span><span>  }
</span><span>
</span><span>  </span><span>if let </span><span>Some</span><span>(end) </span><span>=</span><span> params</span><span>.</span><span>get</span><span>(</span><span>&#34;end&#34;</span><span>) {
</span><span>    </span><span>let</span><span> end </span><span>= </span><span>dateparser</span><span>::</span><span>parse(end)</span><span>.</span><span>unwrap</span><span>()</span><span>;
</span><span>    event</span><span>.</span><span>ends</span><span>(end)</span><span>;
</span><span>    </span><span>if let </span><span>Some</span><span>(duration) </span><span>=</span><span> params</span><span>.</span><span>get</span><span>(</span><span>&#34;duration&#34;</span><span>) {
</span><span>      </span><span>if</span><span> params</span><span>.</span><span>get</span><span>(</span><span>&#34;start&#34;</span><span>)</span><span>.</span><span>is_none</span><span>() {
</span><span>        </span><span>let</span><span> duration </span><span>= </span><span>humantime</span><span>::</span><span>parse_duration(duration)</span><span>.</span><span>unwrap</span><span>()</span><span>;
</span><span>        </span><span>let</span><span> duration </span><span>= </span><span>chrono</span><span>::</span><span>Duration</span><span>::</span><span>from_std(duration)</span><span>.</span><span>unwrap</span><span>()</span><span>;
</span><span>        event</span><span>.</span><span>starts</span><span>(end </span><span>-</span><span> duration)</span><span>;
</span><span>      }
</span><span>    }
</span><span>  }
</span><span>
</span><span>  </span><span>let</span><span> ical </span><span>= </span><span>Calendar</span><span>::</span><span>new()</span><span>.</span><span>push</span><span>(event</span><span>.</span><span>done</span><span>())</span><span>.</span><span>done</span><span>()</span><span>;
</span><span>
</span><span>  CalendarResponse(ical)
</span><span>}
</span></code></pre><p>Would be nice to support more date formats like <code>now</code> and <code>tomorrow</code>, but I&#39;ll leave that for another time.</p><p>Let&#39;s test it:</p><pre data-lang="bash"><code data-lang="bash"><span>&gt;</span><span> cargo </span><span>shuttle</span><span> run </span><span># This starts a local dev server
</span><span>&gt;</span><span> curl 127.0.0.1:8000?start</span><span>=</span><span>2022-11-04+20:00&amp;duration=3h&amp;title=Birthday&amp;description=Party
</span><span>*🤖</span><span> bleep bloop, calendar file created</span><span>*
</span></code></pre><p>Nice, it works!</p><p>Opening it in the browser creates a new event in the calendar:</p><figure><picture><source srcset="https://endler.dev/2022/zerocal/event.avif" type="image/avif"/><source srcset="https://endler.dev/2022/zerocal/event.webp" type="image/webp"/><img alt="Of course, it also works on Chrome, but you do [support the open web](https://contrachrome.com/), right?" height="193" src="https://endler.dev/2022/zerocal/event.jpg" width="650"/></picture><figcaption>Of course, it also works on Chrome, but you do <a href="https://contrachrome.com/">support the open web</a>, right?</figcaption></figure><p>And for all the odd people who don&#39;t use a terminal to create a calendar event, let&#39;s also add a form to the website.</p><h2 id="add-a-form"><a href="#add-a-form"> <svg viewBox="0 0 24 24" height="22" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path></svg> </a>Add a form</h2><pre data-lang="html"><code data-lang="html"><span>&lt;</span><span>form</span><span>&gt;
</span><span>  </span><span>&lt;</span><span>table</span><span>&gt;
</span><span>    </span><span>&lt;</span><span>tr</span><span>&gt;
</span><span>      </span><span>&lt;</span><span>td</span><span>&gt;
</span><span>        </span><span>&lt;</span><span>label </span><span>for</span><span>=</span><span>&#34;title&#34;</span><span>&gt;</span><span>Event Title</span><span>&lt;/</span><span>label</span><span>&gt;
</span><span>      </span><span>&lt;/</span><span>td</span><span>&gt;
</span><span>      </span><span>&lt;</span><span>td</span><span>&gt;
</span><span>        </span><span>&lt;</span><span>input </span><span>type</span><span>=</span><span>&#34;text&#34; </span><span>id</span><span>=</span><span>&#34;title&#34; </span><span>name</span><span>=</span><span>&#34;title&#34; </span><span>value</span><span>=</span><span>&#34;Birthday&#34; </span><span>/&gt;
</span><span>      </span><span>&lt;/</span><span>td</span><span>&gt;
</span><span>    </span><span>&lt;/</span><span>tr</span><span>&gt;
</span><span>    </span><span>&lt;</span><span>tr</span><span>&gt;
</span><span>      </span><span>&lt;</span><span>td</span><span>&gt;
</span><span>        </span><span>&lt;</span><span>label </span><span>for</span><span>=</span><span>&#34;desc&#34;</span><span>&gt;</span><span>Description</span><span>&lt;/</span><span>label</span><span>&gt;
</span><span>      </span><span>&lt;/</span><span>td</span><span>&gt;
</span><span>      </span><span>&lt;</span><span>td</span><span>&gt;
</span><span>        </span><span>&lt;</span><span>input </span><span>type</span><span>=</span><span>&#34;text&#34; </span><span>id</span><span>=</span><span>&#34;desc&#34; </span><span>name</span><span>=</span><span>&#34;desc&#34; </span><span>value</span><span>=</span><span>&#34;Party&#34; </span><span>/&gt;
</span><span>      </span><span>&lt;/</span><span>td</span><span>&gt;
</span><span>    </span><span>&lt;/</span><span>tr</span><span>&gt;
</span><span>    </span><span>&lt;</span><span>tr</span><span>&gt;
</span><span>      </span><span>&lt;</span><span>td</span><span>&gt;&lt;</span><span>label </span><span>for</span><span>=</span><span>&#34;start&#34;</span><span>&gt;</span><span>Start</span><span>&lt;/</span><span>label</span><span>&gt;&lt;/</span><span>td</span><span>&gt;
</span><span>      </span><span>&lt;</span><span>td</span><span>&gt;
</span><span>        </span><span>&lt;</span><span>input </span><span>type</span><span>=</span><span>&#34;datetime-local&#34; </span><span>id</span><span>=</span><span>&#34;start&#34; </span><span>name</span><span>=</span><span>&#34;start&#34; </span><span>/&gt;
</span><span>      </span><span>&lt;/</span><span>td</span><span>&gt;
</span><span>    </span><span>&lt;/</span><span>tr</span><span>&gt;
</span><span>    </span><span>&lt;</span><span>tr</span><span>&gt;
</span><span>      </span><span>&lt;</span><span>td</span><span>&gt;&lt;</span><span>label </span><span>for</span><span>=</span><span>&#34;end&#34;</span><span>&gt;</span><span>End</span><span>&lt;/</span><span>label</span><span>&gt;&lt;/</span><span>td</span><span>&gt;
</span><span>      </span><span>&lt;</span><span>td</span><span>&gt;
</span><span>        </span><span>&lt;</span><span>input </span><span>type</span><span>=</span><span>&#34;datetime-local&#34; </span><span>id</span><span>=</span><span>&#34;end&#34; </span><span>name</span><span>=</span><span>&#34;end&#34; </span><span>/&gt;
</span><span>      </span><span>&lt;/</span><span>td</span><span>&gt;
</span><span>    </span><span>&lt;/</span><span>tr</span><span>&gt;
</span><span>  </span><span>&lt;/</span><span>table</span><span>&gt;
</span><span>&lt;/</span><span>form</span><span>&gt;
</span></code></pre><p>I modified the <code>calendar</code> function a bit to return the form if the query string is empty:</p><pre data-lang="rust"><code data-lang="rust"><span>async </span><span>fn </span><span>calendar</span><span>(Query(</span><span>params</span><span>): Query&lt;HashMap&lt;</span><span>String</span><span>, </span><span>String</span><span>&gt;&gt;) </span><span>-&gt;</span><span> impl IntoResponse {
</span><span>  </span><span>// if query is empty, show form
</span><span>  </span><span>if</span><span> params</span><span>.</span><span>is_empty</span><span>() {
</span><span>    </span><span>return </span><span>Response</span><span>::</span><span>builder()
</span><span>      </span><span>.</span><span>status</span><span>(</span><span>200</span><span>)
</span><span>      </span><span>.</span><span>body</span><span>(</span><span>boxed</span><span>(Full</span><span>::</span><span>from(</span><span>include_str!</span><span>(</span><span>&#34;../static/index.html&#34;</span><span>))))
</span><span>      </span><span>.</span><span>unwrap</span><span>()</span><span>;
</span><span>  }
</span><span>
</span><span>  </span><span>// ...
</span><span>}
</span></code></pre><p>After some more tweaking, we got ourselves a nice little form in all of its web 1.0 glory:</p><figure><picture><source srcset="https://endler.dev/2022/zerocal/form.avif" type="image/avif"/><source srcset="https://endler.dev/2022/zerocal/form.webp" type="image/webp"/><img alt="The form" height="195" src="https://endler.dev/2022/zerocal/form.jpg" width="650"/></picture><figcaption>The form</figcaption></figure><p>And that&#39;s it! We now have a little web app that can create calendar events. Well, almost. We still need to deploy it.</p><h2 id="deploying"><a href="#deploying"> <svg viewBox="0 0 24 24" height="22" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path></svg> </a>Deploying</h2><pre><code><span>cargo shuttle deploy
</span></code></pre><p>Right, that&#39;s all. It&#39;s that easy. Thanks to the folks over at <a href="https://github.com/shuttle-hq/shuttle">shuttle.rs</a> for making this possible.</p><p>The calendar app is now available at <a href="https://zerocal.shuttleapp.rs">zerocal.shuttleapp.rs</a>.</p><p>Now I can finally send my friends a link to a calendar event for our next pub crawl. They&#39;ll surely appreciate it.<sup>yeah<sup>yeah</sup></sup></p><h2 id="from-zero-to-calendar-in-100-lines-of-rust"><a href="#from-zero-to-calendar-in-100-lines-of-rust"> <svg viewBox="0 0 24 24" height="22" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path></svg> </a>From zero to calendar in 100 lines of Rust</h2><p>Boy it feels good to be writing some plain HTML again.</p><p>Check out the source code on <a href="https://github.com/mre/zerocal">GitHub</a> and help me make it better! 🙏</p><p>Here are some ideas:</p><ul><li>✅ Add location support (e.g. <code>location=Berlin</code> or <code>location=https://zoom.us/test</code>). Thanks to <a href="https://github.com/sigaloid">sigaloid</a>.</li><li>Add support for more human-readable date formats (e.g. <code>now</code>, <code>tomorrow</code>).</li><li>Add support for recurring events.</li><li>Add support for timezones.</li><li>Add Google calendar short-links (<code>https://calendar.google.com/calendar/render?action=TEMPLATE&amp;dates=20221003T224500Z%2F20221003T224500Z&amp;details=&amp;location=&amp;text=</code>).</li><li>Add example bash command to create a calendar event from the command line.</li><li>Shorten the URL (e.g. <code>zerocal.shuttleapp.rs/2022-11-04T20:00/3h/Birthday/Party</code>)?</li></ul><p>Check out the <a href="https://github.com/mre/zerocal">issue tracker</a> and feel free to open a PR!</p><ul><li>💬 Comments on <a href="https://news.ycombinator.com/item?id=33109513">Hacker News</a>, <a href="https://reddit.com/r/rust/comments/xx3gbd/zerocal_a_serverless_calendar_app_in_rust_running/">Reddit</a>.</li></ul><div><p>Thanks for reading! I mostly write about Rust and my (open-source) projects. If you would like to receive future posts automatically, you can subscribe via <a href="https://endler.dev/rss.xml">RSS</a> or email:</p></div><p><a aria-label="Sponsor Matthias on Github" href="https://github.com/sponsors/mre/"> <svg viewBox="0 0 16 16" aria-hidden="true" height="16" version="1.1" width="16"><path d="M4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.565 20.565 0 008 13.393a20.561 20.561 0 003.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.75.75 0 01-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5zM8 14.25l-.345.666-.002-.001-.006-.003-.018-.01a7.643 7.643 0 01-.31-.17 22.075 22.075 0 01-3.434-2.414C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.045 5.231-3.885 6.818a22.08 22.08 0 01-3.744 2.584l-.018.01-.006.003h-.002L8 14.25zm0 0l.345.666a.752.752 0 01-.69 0L8 14.25z" fill-rule="evenodd"></path></svg> <span>Sponsor me on Github</span> </a> <a aria-label="Amazon wishlist" href="https://www.amazon.de/hz/wishlist/ls/361PJ2MNLWL16?ref_=wl_share"> <svg viewBox="0 0 16 16" height="16"><defs></defs><path d="M4.068 2.493c-1.058.005-2.138.354-3.237 1.03v9.231c1.099-.676 2.179-1.025 3.237-1.03 1.058-.006 2.096.33 3.111 1.03v-9.23c-1.015-.7-2.053-1.037-3.111-1.031zm7.864 0c-1.058-.006-2.096.33-3.111 1.03v9.231c1.015-.7 2.053-1.036 3.111-1.03 1.058.005 2.138.354 3.237 1.03v-9.23c-1.099-.677-2.179-1.026-3.237-1.031z" fill="none" stroke="#999" stroke-width="1.668"></path></svg> <span>My Amazon wish list</span> </a></p> Thanks to <a href="https://github.com/m3t0r">Simon Brüggen</a> for reviewing drafts of this article.</article></div></div>
  </body>
</html>
