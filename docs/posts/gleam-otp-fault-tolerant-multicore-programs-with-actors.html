<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/gleam-lang/otp">Original</a>
    <h1>Gleam OTP – Fault Tolerant Multicore Programs with Actors</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Fault tolerant multi-core programs with OTP, the BEAM actor framework.</p>
<p dir="auto"><a href="https://hex.pm/packages/gleam_otp" rel="nofollow"><img src="https://camo.githubusercontent.com/89b1730c6d7abd58ffb4ef6237482e50090391ca72e9197d3f5b41b46a0dc8f3/68747470733a2f2f696d672e736869656c64732e696f2f686578706d2f762f676c65616d5f6f7470" alt="Package Version" data-canonical-src="https://img.shields.io/hexpm/v/gleam_otp"/></a>
<a href="https://hexdocs.pm/gleam_otp/" rel="nofollow"><img src="https://camo.githubusercontent.com/4bb6f0346c92c97533ee101eb333cf8ab3c7c7285aa966aed1ba529e055f398b/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6865782d646f63732d666661666633" alt="Hex Docs" data-canonical-src="https://img.shields.io/badge/hex-docs-ffaff3"/></a></p>

<div dir="auto" data-snippet-clipboard-copy-content="import gleam/erlang/process.{type Subject}
import gleam/otp/actor

pub fn main() {
  // Start an actor
  let assert Ok(actor) =
    actor.new(0)
    |&gt; actor.on_message(handle_message)
    |&gt; actor.start

  // Send some messages to the actor
  actor.send(actor.data, Add(5))
  actor.send(actor.data, Add(3))

  // Send a message and get a reply
  assert actor.call(actor.data, waiting: 10, sending: Get) == 8
}

pub fn handle_message(state: Int, message: Message) -&gt; actor.Next(Int, Message) {
  case message {
    Add(i) -&gt; {
      let state = state + i
      actor.continue(state)
    }
    Get(reply) -&gt; {
      actor.send(reply, state)
      actor.continue(state)
    }
  }
}

pub type Message {
  Add(Int)
  Get(Subject(Int))
}"><pre><span>import</span> <span>gleam/erlang/process</span><span>.</span><span>{</span><span>type</span> <span>Subject</span><span>}</span>
<span>import</span> <span>gleam/otp/actor</span>

<span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
  <span>// Start an actor</span>
  <span>let</span> <span>assert</span> <span>Ok</span><span>(</span><span>actor</span><span>)</span> <span>=</span>
    <span>actor</span><span>.</span><span>new</span><span>(</span><span>0</span><span>)</span>
    <span>|&gt;</span> <span>actor</span><span>.</span><span>on_message</span><span>(</span><span>handle_message</span><span>)</span>
    <span>|&gt;</span> <span>actor</span><span>.</span><span>start</span>

  <span>// Send some messages to the actor</span>
  <span>actor</span><span>.</span><span>send</span><span>(</span><span>actor</span><span>.</span><span>data</span><span>,</span> <span>Add</span><span>(</span><span>5</span><span>)</span><span>)</span>
  <span>actor</span><span>.</span><span>send</span><span>(</span><span>actor</span><span>.</span><span>data</span><span>,</span> <span>Add</span><span>(</span><span>3</span><span>)</span><span>)</span>

  <span>// Send a message and get a reply</span>
  <span>assert</span> <span>actor</span><span>.</span>call<span>(</span>actor<span>.</span>data<span>,</span> waiting<span>:</span> 10<span>,</span> sending<span>:</span> <span>Get</span><span>)</span> == 8
<span>}</span>

<span>pub</span> <span>fn</span> <span>handle_message</span><span>(</span><span>state</span><span>:</span> <span>Int</span><span>,</span> <span>message</span><span>:</span> <span>Message</span><span>)</span> <span>-&gt;</span> <span><span>actor</span><span>.</span><span>Next</span></span><span>(</span><span>Int</span><span>,</span> <span>Message</span><span>)</span> <span>{</span>
  <span>case</span> <span>message</span> <span>{</span>
    <span>Add</span><span>(</span><span>i</span><span>)</span> <span>-&gt;</span> <span>{</span>
      <span>let</span> <span>state</span> <span>=</span> <span>state</span> <span>+</span> <span>i</span>
      <span>actor</span><span>.</span><span>continue</span><span>(</span><span>state</span><span>)</span>
    <span>}</span>
    <span>Get</span><span>(</span><span>reply</span><span>)</span> <span>-&gt;</span> <span>{</span>
      <span>actor</span><span>.</span><span>send</span><span>(</span><span>reply</span><span>,</span> <span>state</span><span>)</span>
      <span>actor</span><span>.</span><span>continue</span><span>(</span><span>state</span><span>)</span>
    <span>}</span>
  <span>}</span>
<span>}</span>

<span>pub</span> <span>type</span> <span>Message</span> <span>{</span>
  <span>Add</span><span>(</span><span>Int</span><span>)</span>
  <span>Get</span><span>(</span><span>Subject</span><span>(</span><span>Int</span><span>)</span><span>)</span>
<span>}</span></pre></div>
<p dir="auto">Gleam’s actor system is built with a few primary goals:</p>
<ul dir="auto">
<li>Full type safety of actors and messages.</li>
<li>Be compatible with Erlang’s OTP actor framework.</li>
<li>Provide fault tolerance and self-healing through supervisors.</li>
<li>Have equivalent performance to Erlang’s OTP.</li>
</ul>
<p dir="auto">This library documents its abstractions and functionality, but you may also wish
to read the documentation or other material on Erlang’s OTP framework to get a
fuller understanding of OTP, the problems it solves, and the motivations for its
design.</p>
<p dir="auto">Not all Erlang/OTP functionality is included in this library. Some is not
possible to represent in a type safe way, so it is not included. Other features
are still in development, such as further process supervision strategies.</p>

<p dir="auto">This library provides several different types of actor that can be used in
Gleam programs.</p>

<p dir="auto">The process is the lowest level building block of OTP, all other actors are
built on top of processes either directly or indirectly. Typically this
abstraction would not be used very often in Gleam applications, favour
other actor types that provide more functionality.</p>
<p dir="auto">Gleam&#39;s <a href="https://hexdocs.pm/gleam_erlang/gleam/erlang/process.html" rel="nofollow">process</a> module is defined in the <code>gleam_erlang</code> library.</p>

<p dir="auto">The <code>actor</code> is the most commonly used process type in Gleam and serves as a good
building block for other abstractions. Like Erlang&#39;s <code>gen_server</code> it handles
OTP&#39;s system messages automatically to enable OTP&#39;s debugging and tracing
functionality.</p>
<p dir="auto"><a href="https://hexdocs.pm/gleam_otp/gleam/otp/actor.html" rel="nofollow">Documentation</a></p>

<p dir="auto">Supervisors are processes that start and then supervise other processes.
They can restart them if they crash, and terminate them when the application is
shutting down.</p>
<p dir="auto">Supervisors can start other supervisors, resulting in a hierarchical process
structure called a supervision tree, providing fault tolerance and monitoring
benefits to a Gleam application.</p>
<ul dir="auto">
<li><a href="https://hexdocs.pm/gleam_otp/gleam/otp/static_supervisor.html" rel="nofollow">gleam/otp/static_supervisor</a> documentation.</li>
<li><a href="https://hexdocs.pm/gleam_otp/gleam/otp/factory_supervisor.html" rel="nofollow">gleam/otp/factory_supervisor</a> documentation.</li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">Limitations and known issues</h2><a id="user-content-limitations-and-known-issues" aria-label="Permalink: Limitations and known issues" href="#limitations-and-known-issues"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Actors do not yet support all OTP system messages, so some of the OTP debugging
APIs may not be fully functional. These unsupported messages are discarded by
actors.</p>
<p dir="auto">If you find that you have a need for one of the unimplemented system messages, open
an issue and we will implement support for it.</p>
</article></div></div>
  </body>
</html>
