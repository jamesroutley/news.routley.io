<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://giannirosato.com/blog/post/image-comparison/">Original</a>
    <h1>JPEG-XL vs. AVIF and Others: 27 Images Compared</h1>
    
    <div id="readability-page-1" class="page"><div>
    <div>
        <p>Image Codec Comparison</p>
        <p><a href="https://giannirosato.com/blog/">back</a></p><p>Mar 16, 2023</p>
        
        <p><a href="https://giannirosato.com/blog/tag/projects/">projects</a>
        
        <a href="https://giannirosato.com/blog/tag/avif/">avif</a>
        
        <a href="https://giannirosato.com/blog/tag/jxl/">jxl</a>
        
    </p></div>
    <h2>Why?</h2>
<p>To start things off, I have been a fan of the AVIF image format since I heard about it, not long after I started learning about the AV1 video codec in 2020. I figured the fact that it was backed by the Alliance for Open Media, was the natural successor to WebP, and was based on a rather powerful video codec that was rapidly growing in popularity was great for users &amp; organizations alike to easily understand what the technology stood for, where it came from, and what benefits it provided over the existing lossy image king, JPEG. Good codecs are open source codecs, so the fact that AVIF was open source was a big deal to me as well. It is also already <a href="https://caniuse.com/avif">widely supported</a> at the time of writing. I thought unequivocally that AVIF would be the future of images on the web when I first learned about it. I don&#39;t think I was entirely wrong, but I hadn&#39;t yet heard of JPEG-XL.</p>
<p><a href="https://jpegxl.info/">JPEG-XL</a> (JXL for short) is an image codec by the JPEG committee (yes, <em>the</em> JPEG committee). Initially I hadn&#39;t thought much of the codec because the compression efficiency was &#34;the same as AVIF,&#34; so I kind of wrote it off, as I&#39;m sure many uninformed people have &amp; continue to do. Upon doing more research, my position flipped and I found myself deeply invested in the future of JXL.</p>
<p>JXL&#39;s fascinating features include the highly efficient variable-blocksize discrete cosine transform (which is superior to JPEG&#39;s DCT), usage of the XYB colorspace which more accurately represents the response our cones in our eyeballs have to different wavelengths of light, &amp; a &#34;modular&#34; mode for efficient lossless or near-lossless coding. It is also used while encoding lossy JPEG-XL images, but I don&#39;t know much about it &amp; I won&#39;t pretend to. Currently the reference encoder also supports patch detection, noise synthesis, and will (probably) eventually support spline detection as it is present in the codec specification. JPEG-XL also supports <em>lossless JPEG transcoding</em> that <em>reduces the filesize of JPEGs</em> which in my opinion is a game-changing feature. That alone could be a revolutionary codec by itself. Progressive decode is also a standout feature of JPEG-XL, and I found <a href="https://opensource.googleblog.com/2021/09/using-saliency-in-progressive-jpeg-xl-images.html">this article</a> very interesting regarding that.</p>
<p>Some more interesting JXL articles &amp; resources:</p>
<p><a href="https://www.roboleary.net/webdev/2023/03/06/next-web-image-format-not-jpegxl.html">www.roboleary.net/webdev/2023/03/06/next-web-image-format-not-jpegxl.html</a></p>
<p><a href="https://tonisagrista.com/blog/2023/jpegxl-vs-avif/">tonisagrista.com/blog/2023/jpegxl-vs-avif</a></p>
<p><a href="https://cloudfour.com/thinks/on-container-queries-responsive-images-and-jpeg-xl/">cloudfour.com/thinks/on-container-queries-responsive-images-and-jpeg-xl</a></p>
<p><a href="https://motionmill.com/2023/02/google-stopt-jpex-xl-gebruiken/">motionmill.com/2023/02/google-stopt-jpex-xl-gebruiken</a></p>
<p><a href="https://ds.jpeg.org/whitepapers/jpeg-xl-whitepaper.pdf">ds.jpeg.org/whitepapers/jpeg-xl-whitepaper.pdf</a></p>
<p><a href="https://cloudinary.com/blog/the-case-for-jpeg-xl">cloudinary.com/blog/the-case-for-jpeg-xl</a></p>
<p>Also worth noting is the format&#39;s most outspoken pioneer <a href="http://sneyers.info/">Jon Sneyers</a> (co-author of the JPEG XL spec) as well as other noteworthy developers are extremely active within the community and value the feedback of the people who are passionate about their work. This should not be as unique as it is, but it is incredibly valuable to have one&#39;s voice heard so easily &amp; frequently by developers who <em>actually care</em>. I commend Sneyers &amp; the other core JXL devs for this.</p>
<p>Anyway, TL;DR: JXL has a lot more to offer than just good compression. But, I still wish to know; how does it stack up against other image formats regarding lossy compression &amp; lossless compression? </p>
<h2>Methodology (Photographic Corpus)</h2>
<p>In order to produce an unbiased test to determine how good JPEG-XL is relative to <em>my</em> needs, I took 27 photos (mostly consisting of landscape/architecture photography) around my seaside hometown using my Sony a5000 at 20.1mp, edited them in <a href="https://www.darktable.org/">Darktable</a>, exported them as 16-bit sRGB PNGs (AdobeRGB had <a href="https://github.com/ImageMagick/ImageMagick/issues/6157">some</a> <a href="https://github.com/libjxl/libjxl/issues/2289">problems</a>), &amp; finally I ran a script written by my friend RootAtCali (check out their <a href="https://autocompressor.net/">cool site</a>) to determine each image format&#39;s SSIMULACRA2 scores for each quality level available via the format&#39;s lossy coding option.</p>
<p>I&#39;ll be certain to make my lossless sources available via an edit to this post, &amp; they&#39;ll be linked at the top. In the meantime, here&#39;s <a href="https://giannirosato.com/blog/post/corpus-lossy/">another page</a> with full resolution lossy JXL photos encoded at <code>-d 1.0</code>. The images are under CC-BY-SA 4.0. </p>
<p>These tests were run using the <a href="https://github.com/cloudinary/ssimulacra2">SSIMULACRA2</a> visual quality metric via <a href="https://github.com/rust-av/ssimulacra2">ssimulacra2_rs</a>. This metric is designed to model human vision far better than VMAF, SSIM, PSNR, &amp; other less effective alternatives. Via the readme on Github:</p>
<blockquote>
<p>Returns a score in range -inf..100, which correlates to subjective visual quality scores as follows:</p>
<ul>
<li>30 = low quality. This corresponds to the p10 worst output of mozjpeg -quality 30.</li>
<li>50 = medium quality. This corresponds to the average output of cjxl -q 40 or mozjpeg -quality 40, or the p10 output of cjxl -q 50 or mozjpeg -quality 60.</li>
<li>70 = high quality. This corresponds to the average output of cjxl -q 65 or mozjpeg -quality 70, p10 output of cjxl -q 75 or mozjpeg -quality 80.</li>
<li>90 = very high quality. Likely impossible to distinguish from the original when viewed at 1:1 from a normal viewing distance. This corresponds to the average output of mozjpeg -quality 95 or the p10 output of cjxl -q 95.</li>
</ul>
</blockquote>
<p>Because of the irrelevance of negative SSIMULACRA2 scores, I stopped the vertical axis on the graph(s) at 0.</p>
<p>For context, here&#39;s an overview of the image formats tested:</p>
<ul>
<li><strong>JPEG</strong>, the reigning champ. has been used for decades. Supports progressive decode</li>
<li><strong>WebP</strong>, based on VP8, an open-source video codec.</li>
<li><strong>JPEG-XL</strong>, the designated successor to JPEG. Designed by the JPEG committee.</li>
<li><strong>AVIF</strong>, based on AV1, a modern open-source video codec.</li>
</ul>
<p>Here&#39;s a <a href="https://jpegxl.info/comparison.png">helpful chart</a> provided by Cloudinary.</p>
<p>Notably absent are JPEG 2000 (J2K) &amp; HEIC. Considering JXL is J2K&#39;s successor &amp; J2K never saw widespread adoption, I&#39;m not sure including it helps anybody. HEIC is being excluded because it sucks, &amp; also is notably not royalty free.</p>
<p>Here are the encoders tested for each format:</p>
<ul>
<li><strong>JPEG</strong> via the mozjpeg encoder</li>
<li><strong>JPEG</strong> via the mozjpeg encoder, tuned for MS-SSIM, using the &#39;Tuned for MS-SSIM on Kodak image set&#39; quantization table &amp; arithmetic coding</li>
<li><strong>JPEG</strong> via the elusive &amp; mysterious jpegli encoder (more on this later)</li>
<li><strong>WebP</strong> via cwebp</li>
<li><strong>JPEG-XL</strong> via the libjxl reference encoder implementation, cjxl</li>
<li><strong>AVIF</strong> via aom-av1-lavish, tuned for SSIM</li>
</ul>
<p>Here&#39;s the encoder parameters I used, along with the encoder version (in the same order as above)</p>
<p><code>cjpeg -q [quality] &#34;input&#34; &gt; &#34;output.jpg&#34;</code> | mozjpeg version 4.1.1 (build 20230217)</p>
<p><code>cjpeg -q [quality] -quant-table 2 -tune-ms-ssim -arithmetic &#34;input&#34; &gt; &#34;output.jpg&#34;</code> | mozjpeg version 4.1.1 (build 20230217)</p>
<p><code>benchmark_xl --input=[input] --codec=jpeg:enc-jpegli:rgb:q[quality] --save_compressed --output_dir=[outdir]</code> | cjxl v0.9.0 c4927fbf</p>
<p><code>cwebp -m 6 -q [quality] &#34;input&#34; -o [output.webp]</code> | 1.3.0 libsharpyuv: 0.2.0</p>
<p><code>cjxl &#34;input&#34; &#34;output.jxl&#34; -q [quality] -e 7 --brotli_effort 11</code> | cjxl v0.9.0 c4927fbf</p>
<p><code>avifenc -c aom -s 6 -j 16 -d 10 -y 444 --min 1 --max 63 -a end-usage=q -a cq-level=[quality] -a tune=ssim &#34;input&#34; &#34;output.avif&#34;</code> | AOMedia Project AV1 Encoder Psy v3.6.0 (default)</p>
<p>WebP is at maximum effort &amp; the JPEG encoders were left stock in terms of effort. cjxl is on effort 7 (the internal default, so I didn&#39;t really need to specify it, &amp; <code>brotli_effort</code> is only for lossless iirc), &amp; we encode avif at speed 6 because it correlates best with JXL&#39;s default speed (&amp; is also rav1e&#39;s default speed internally although we&#39;re not using rav1e). <a href="https://beta.flathub.org/apps/net.natesales.Aviator">Aviator</a>, based on SVT-AV1, consciously defaults to speed 6 for AV1 video encoding, as does rav1e-based <a href="https://giannirosato.com/blog/post/aviator-1/">rAV1ator</a>.</p>
<p>Benchmarking with this image dataset gave us a total of just below 18,000 data points before averaging. For the graph, I calculated the arithmetic mean of the bpp &amp; SSIMULACRA2 score for each quality step for each encoder.</p>
<p>Here are the results:</p>
<p><img alt="photographic_corpus_results" src="https://giannirosato.com/static/images/photographic_corpus_results.svg"/></p>
<p>Now, hold your breath, conclusions come at the end!</p>
<h2>Methodology (Non-photographic)</h2>
<p>This is a shorter test with less going on, but still interesting &amp; worth bringing up. I&#39;m using <a href="https://giannirosato.com/static/images/the_apps.png">this</a> image to test non-photographic encoding using the same parameters as above. Here are the results:</p>
<p><img alt="nonphotographic_results" src="https://giannirosato.com/static/images/nonphotographic_results.svg"/></p>
<p>While this is only one image, I have universally seen AVIF take a rather large lead with every non-photographic image I&#39;ve tested.</p>
<h2>Lossless? Animation?</h2>
<p>Stay tuned! While both AVIF &amp; JXL (as well as WebP) support animation, I&#39;d like to cover that in a different post. I&#39;d like to learn more about how AVIF &amp; JXL work relative to lossless image coding as well before I tackle a test like that.</p>
<h2>Conclusion</h2>
<h3>Where does JPEG-XL win?</h3>
<p>It is clear to me that JPEG-XL is going to be my choice for exporting my amateur photographs. It performs exceptionally well at higher quality, outperforming AVIF &amp; the others by a significant margin. AVIF is stronger as quality decreases, but AVIF is further weakened by the fact that encoding using more threads generally hurts efficiency &amp; encoding an AVIF image is generally slower than encoding a JXL image. As for the other plethora of features JXL has to offer, AVIF can barely compete. AVIF is also hampered by its lower maximum image dimensions compared to competing codecs.</p>
<h3>Where does AVIF win?</h3>
<p>AVIF wins at low to medium (maybe low-medium) quality. This is great for content devilery on the web, as images don&#39;t always need to be high fidelity or retain a ton of high-frequency detail to maintain their appeal; something that looks pleasing and resembles the source can be more desirable. Despite the fact that AVIF lacks progressive decode, its superior coding efficiency at lower quality somewhat makes up for this in my opinion. AVIF is also the winner for our non-photographic image, and if you trust that image isn&#39;t an edge case, it opens up some cool opportunities for sharing digital art as JXL doesn&#39;t have an encoder available with spline detection to compete right now. Being based on the AV1 video codec, AVIF is allegedly easier to implement as well; the codec&#39;s widespread adoption sees it already achieving a degree of success on the Web.</p>
<h3>How about the others?</h3>
<p>WebP isn&#39;t very good in my opinion, plumetting at higher quality &amp; being soundly defeated by AVIF at lower quality. JPEG clearly <em>still</em> has potential even years later, and MS-SSIM tuning seems to do the encoder some favors with the photographic dataset. The jpegli encoder borrows some of JXL&#39;s fancy coding techniques to improve JPEG quality even further, especially at higher quality. I didn&#39;t even test jpegli with the superior XYB colorspace (as this proved hard to do), which to my eyes nets jpegli an even better quality improvement over standard jpeg encoders. There&#39;s a cool <a href="https://nitter.kitsuna.net/jyzg/status/1622900057816145922">Twitter thread</a> about this. According to <a href="https://research.google/people/105344/">Jyrki Alakuijala</a>, &#34;jpegli supports more than 8 bits per channel (around 10.5 bits) and can codify HDR dynamics (HLG/PQ/XYB/etc.) in the old &#39;8-bit&#39; format.&#34; This seems extremely promising.</p>
<h3>Takeaway</h3>
<p>I want a web where both AVIF &amp; JPEG-XL can exist, and developers decide which format to use for its merits. Google&#39;s Chromium team has rejected JXL support for Chrome, and Mozilla remains &#34;neutral,&#34; on JXL, keeping a flag in Firefox Nightly to enable partial support. The Chromium team shouldn&#39;t have the absolute authority to shoot down would-be standards like this, as it seems they are the sole decision-maker in this space &amp; all others must follow their lead. In my opinion, JPEG-XL &amp; AVIF have <em>fundamentally different strengths</em> which lend them to different use cases. Considering JXL has been endorsed by Facebook, Adobe, Intel and the Video Electronics Standards Association, The Guardian, Flickr and SmugMug, Shopify, the Krita Foundation, Serif Ltd, Gaia Sky, and many more, the market is most certainly interested. My current optimistic hope is that JXL takes off outside the web among professionals working with tools like the Adobe suite or alternatives, and camera manufacturers, smartphone OEMS, and others take notice &amp; begin to think about JXL more seriously. The benefits cannot be ignored, and it is (in my opinion) the only image format that is in every way superior to JPEG &amp; offers a concrete future for the many existing JPEGs on the Web &amp; beyond.</p>
<p>While this is a non-scientific test, please share this post if you&#39;d like to see JPEG-XL get more attention for its merits. AVIF is already widely supported, I don&#39;t need to fight for it; JPEG-XL still has a war to be won, and I&#39;d like anyone who wants better images &amp; a better Web to be on JXL&#39;s side as well as AVIF&#39;s, and to understand that JPEG-XL needs our assistance as users to gain widespread adoption. Here&#39;s what I&#39;d recommend doing right now:</p>
<p>Using Chrome or another Chromium-based browser? Consider switching to <a href="https://thorium.rocks/">Thorium</a>. It is available for nearly every platform, including Windows, Linux, macOS, and Android, and has complete JXL support. It will sync with your Google account just like Chrome will. It is also <a href="https://giannirosato.com/blog/post/browser-benchmarks/">faster</a>.</p>
<p>Using Firefox? Not a bad choice. If your workflow permits, switching to Firefox Nightly for casual browsing &amp; enabling the JXL flag for partial JXL support by searching &#39;jxl&#39; in <code>about:config</code> is not a bad option. I&#39;m attached to Firefox myself, &amp; using the flag on my phone works great for most things that don&#39;t employ an alpha channel or HDR.</p>
<p>If you&#39;d like to take a look at some beautiful JXL images, you can head <a href="https://people.csail.mit.edu/ericchan/hdr/hdr-jxl.php">here</a>. You can test your browser&#39;s JXL support <a href="https://jpegxl.info/test-page/">here</a>. Remember, the Web may be the last platform without a proprietor, and we need to keep it that way.</p>
<p><a href="https://elk.zone/disobey.net/@gianni">Mastodon</a> | <a href="https://matrix.to/#/@computerbustr:matrix.org">Matrix</a> | <a href="https://radixproject.org/">The Radix Project</a></p>
</div></div>
  </body>
</html>
