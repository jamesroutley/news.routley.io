<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rachelbythebay.com/w/2021/10/12/break/">Original</a>
    <h1>An UPDATE without a WHERE, or something close to it</h1>
    
    
<p>
I know I&#39;ve already
<a href="https://rachelbythebay.com/w/2021/10/04/callthecops/">commented</a>
on a certain site&#39;s big outage
<a href="https://rachelbythebay.com/w/2021/10/05/cmd/">twice now,</a>
but I have one more bit of rumor to share, and it apparently invalidates 
what I had heard previously.  That is, it may not have been a matter of 
&#34;show X Y&#34; vs. &#34;clear X Y&#34;, but rather some kind of automation that went 
a bit too far.
</p>
<p>
Essentially, the story is now this: let&#39;s say you want to do something 
to a given item, be that a router, switch, server, or whatever.  You go 
to some management interface for it, and say, okay, take this thing out 
of service, shut it down, reboot it, drain it, set it on fire, whatever.  
But, what if the interface only asked you to specify which one somehow?
</p>
<p>
Then, what if you didn&#39;t have to actually type something in to hit the 
button?  Maybe you forgot, or something else happened, and you didn&#39;t 
fill it in, so when you did that, it said &#34;okay, cool then&#34; and 
did
<em>all of them</em>
instead?
</p>
<p>
Go to tool, type in target, hit button, single target is affected.
</p>
<p>
Go to tool, don&#39;t type in target, hit button, ALL targets affected.
</p>
<p>
If true, that sounds like a violation of the principle of least 
surprise, particularly when the impact can be so big.  
</p>
<p>
It sounds like another kind of &#34;footgun&#34; (you know, something you can 
use to shoot yourself in the foot) from the world of databases: an 
UPDATE without a WHERE.
</p>
<p>
For the not-SQL-inclined in the crowd, you can tell a database to do 
something like this:
</p>
<div class="terminal">
<p>
UPDATE my_table SET invalid = true WHERE asset_id = 1012;
</p>
</div>
<p>
It&#39;ll then go and set that bit on any column where asset_id is equal to 
1012.  If that column (asset_id) has unique values, then that&#39;s one row.  
If nothing matches it, then no rows will be changed.
</p>
<p>
Imagine what happens when you forget the WHERE.  It&#39;s the last thing on 
the line as shown, so you could send off the command early and it would 
totally work.  It would look like this:
</p>
<div class="terminal">
<p>
UPDATE my_table SET invalid = true;
</p>
</div>
<p>
And... guess what, without that WHERE, it just set that bit everywhere.  
Everything is marked invalid, and your business might suffer for it.
</p>
<p>
There&#39;s plenty more on this topic that I won&#39;t go into here, like the &#34;I 
am a dummy&#34; thing in MySQL, adding a limit (to the query or otherwise), 
and so on.  Just know that it&#39;s a pattern, and you will see it again.
</p>
<p>
Final note on the &#34;do <em>all the things</em>&#34; thing:
maybe the tool actually is supposed to let you do that.  In that 
case, maybe it would be good if it said something like &#34;you are about 
to drain 123,456 devices, so type in that exact number to proceed&#34;.  
You know,
<a href="https://rachelbythebay.com/w/2020/10/26/num/">that</a>
kind of thing.  It tends to add enough of a pause to prevent some 
disasters.
</p>

  </body>
</html>
