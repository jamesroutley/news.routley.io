<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.nulliq.dev/posts/battleship/">Original</a>
    <h1>Battleship</h1>
    
    <div id="readability-page-1" class="page"><div><div><p>I’ve been playing battleship a lot recently. My friends and I have given up on playing pool and are pretty much exclusively playing this game.</p><p>After winning a ton of games by luck, I figured I do could even better using a strategy.</p><p>Since there are a few different rulesets, here’s a quick overview of the ruleset I was playing with on GamePigeon’s iMessage version of the game.</p><ol><li>The board is 10x10 squares.</li><li>There are 1 len-4, 2 len-3, 3 len-2, and 4 len-1 ships.</li><li>You cannot place ships adjacent or diagonal to another ship.</li></ol><p>An obvious strategy for Battleship is to shoot where the ships are most likely to be placed.
To calculate this probability, we can enumerate over all the possible ships on the board.</p><asciinema-player src="/shippositions.cast" autoplay="" cols="19"></asciinema-player><p>While we do this, count the number of times a ship occupies each specific square. Then, we can make that array into a heat map that shows the probability of a ship being in that particular square.</p><asciinema-player src="/shipcounts.cast" autoplay="" cols="29"></asciinema-player><p>Since there are 1 len-4, 2 len-3, 3 len-2, and 4 len-1 ships, we will increment each square by the number of ships that could be placed there. That’s why the squares are incrementing by values other than 1.</p><p>We end up with a heatmap that looks like this:</p><figure><img src="https://blog.veitheller.de/init_heatmap.png"/><figcaption>Dark squares are less likely to have a ship, and pink squares are more likely.</figcaption></figure><p>We can do this mid-game to get a heatmap specific to that board:</p><figure><img src="https://blog.veitheller.de/basic_heatmap.png"/><figcaption>All the dark squares are confirmed hits/misses.</figcaption></figure><p>We’ll be referring to these values as “probability scores” from here on out. Just remember that “probability scores” are the number of ships that could occupy a square.</p><p>Since you cannot place a ship adjacent or diagonal to another ship, all the squares around a hit ship are guaranteed to be a miss. We can exploit this aspect of the game by tracking how many ship positions would be eliminated if a ship occupied that square.</p><figure><img src="https://blog.veitheller.de/sum_board.png"/><figcaption>Add up the probabilities surrounding a hit to get an information gain for that square</figcaption></figure><p>Information gain can be combined with the Naive Strategy in order to calculate both the probability of a hit, along with the value that hit would provide (how many possible positions it would eliminate).</p><figure><img src="https://blog.veitheller.de/sum_board_2.png"/><figcaption>This is what we do for a 2x1 ship</figcaption></figure><p>For each square in each ship position, we add up the surrounding probabilities for that position.</p><asciinema-player src="/shippositions.cast" autoplay="" cols="19"></asciinema-player>
<asciinema-player src="/infosum.cast" autoplay="" cols="59"></asciinema-player><p>As a heatmap:</p><figure><img src="https://blog.veitheller.de/infosum_heatmap.png"/><figcaption>With this heatmap, the center 4 squares are the best place for your first shot</figcaption></figure><p>Again, we can do this process mid-game to get a recommendation on where to fire next.</p><figure><img src="https://blog.veitheller.de/infosum_midgame.png"/><figcaption>Compared to the naive strategy, this new strategy shows stronger preferences for certain squares</figcaption></figure><p>Once we have a hit, what do we do next?</p><p>We already know the squares surrounding our hit are eliminated, so let’s pick the next square by only looking at the probability scores for the squares that weren’t already eliminated.</p><figure><img src="https://blog.veitheller.de/single_square_hit.png"/><figcaption>Get the sum of these squares to find the most promising second shot.</figcaption></figure><p>Add them together to get the scores for each direction.</p><p>Since the upper pink squares are the brightest, they have the best probability. Let’s fire in the upper direction.</p><figure><img src="https://blog.veitheller.de/double_square_hit.png"/><figcaption>That was a hit. Now that we know the ship is vertically oriented, only consider up and down as valid directions.</figcaption></figure><p>Continue until we discover the whole ship.</p><figure><img src="https://blog.veitheller.de/compilicated_board_2.png"/><figcaption>The Sinking Ships step says we should fire upwards.</figcaption></figure><p>We can adjust the previous step to account for the remaining ships. For example, in a situation like the one above, a hit says we should fire upwards. However, if we know there are only len 3 ships left, we can instead fire directly to the right twice for the maximum info gain.</p><p>Implementing the relative probability of each ship length occupying the n+1th square, we get the best possible algorithm that I can come up with.</p><figure><img src="https://blog.veitheller.de/compilicated_board_3.png"/><figcaption>Firing to the right is the best shot according to the algorithm.</figcaption></figure><p>This was a fun hobby project. Feel free to try out the code on your own and make pull requests to improve it.</p><p><a href="https://github.com/Carbocarde/battleship">Github Repo</a></p><p>A wish-list item I have is to create a simulator that implements these strategies and measure how well they do against random board layouts. Feel free to tackle this if you have a spare weekend. I’d love to add it to the repo.</p></div></div></div>
  </body>
</html>
