<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ntietz.com/blog/three-days-of-advent-of-code-in-hurl/">Original</a>
    <h1>Three days of Advent of Code in Hurl</h1>
    
    <div id="readability-page-1" class="page"><div><p>Every year I do some of <a href="https://adventofcode.com/">Advent of Code</a>.
One year I completed it, but usually I just do some of it as a social thing with friends and then taper off as interest wanes.
This year, I did three days of it, and stopped because I really truly did not want to write more solutions in the language I chose.</p>
<p>See, previous years I made a reasonable choice, like <a href="https://github.com/ntietz/advent-of-code-2021">Rust</a>.
But this year, since I <a href="https://www.tokyodev.com/blog/lessons-from-implementing-hurl/">wrote a programming language</a>, I decided to do at least three days of Advent of Code in it, and more if I wanted to.
(Dear reader, I did not want to.)</p>
<p>These three days of it were very useful in getting comfortable with Hurl and they were also critical in developing Hurl&#39;s built-ins and standard library to a reasonable point.
I&#39;m pretty confident now that you could do all of Advent of Code in it.
And I&#39;m also now <em>free</em> from Hurl, and so are you: this is the last either of us need to think about it.</p>
<p>If you want to see all the solutions I&#39;ve implemented, they&#39;re <a href="https://git.sr.ht/~ntietz/hurl-lang/tree/main/item/aoc">in Hurl&#39;s repo</a> as examples and tests.
For now, I&#39;ll walk through <em>one</em> solution and how it works.</p>

<p>Day 1 part 2 had some interesting flair to it where it is short but also interesting enough.
The premise is that you have a document where each line contains characters and you&#39;re trying to find the numbers on each line.
You take the first and last single-digit number, then concatenate them together, then sum all such numbers from all the lines.
But they also might be written <em>as English words</em>.</p>
<p>Here&#39;s a short example of a document.</p>
<pre data-lang="text"><code data-lang="text">zoneight234
7pqrstsixteen
</code></pre>
<p>From the first line we get &#34;one&#34; and &#34;4&#34;, so that becomes 14, and the second line gives us &#34;7&#34; and &#34;six&#34;, which becomes 76.
The solution for this document then is 14 + 76 = 90.</p>
<p>The first thing we do is import the standard library functionality we will need.
The paths here are relative to the source file you run, so they may change for different users.</p>
<pre data-lang="hurl"><code data-lang="hurl">include &#34;../lib/loop.hurl&#34;;
include &#34;../lib/if.hurl&#34;;
</code></pre>
<p>Then we can read in our input.
We use built-ins for reading the file&#39;s input and breaking it into lines.
Breaking it into lines could have been done in Hurl, but I made it a built-in to save time.</p>
<pre data-lang="hurl"><code data-lang="hurl">let input = read_file(&#34;./aoc/input/day1.txt&#34;);
let lines = str_lines(input);
</code></pre>
<p>Now we can iterate over the lines and extract the solution, once we define the <code>extract_nums</code> function.</p>
<pre data-lang="hurl"><code data-lang="hurl">let total = 0;

for_each(lines, func(line) {
    try {
        extract_nums(line);
    } catch as val {
        total = total + val;
    };
});

println(&#34;solution: &#34;, total);
</code></pre>
<p>The <code>for_each</code> here is defined in Hurl&#39;s standard library, only using Hurl itself (exceptions and recursion).
It accepts a list or string as its first argument and a function to call on each element as its second argument.
Inside of there, we use a try-catch to get the value of each line via the <code>extract_nums</code> function and add it into the running total, which we&#39;ll then print out.</p>
<p>Now let&#39;s define <code>extact_nums</code>.
We know basically what it needs to do: find the first and last single-digit number on each line.
Some may be a literal digit, others may be an English word representing that digit.</p>
<p>Here&#39;s the basic structure.
We break the string into its individual characters, then we find the first and last numbers.
We convert the numbers to strings, concatenate them together, then cast them <em>back</em> to a number.
Finally we can hurl the result to our caller.</p>
<pre data-lang="hurl"><code data-lang="hurl">let extract_nums = func(line) {
    let chars = str_chars(line);

    let first = 0;
    # TODO: find the first number

    let last = 0;
    # TODO: find the last number

    let first = &#34;&#34; + first;
    let last = &#34;&#34; + last;

    hurl as_num(first + last);
};
</code></pre>
<p>Finding the first and last number are essentially the same, just one starts from the end, so I&#39;ll skip one here.
To find the first number, we use <a href="https://git.sr.ht/~ntietz/hurl-lang/tree/main/item/lib/loop.hurl"><code>until</code></a> (defined in Hurl in the standard library) to iterate through the list until we find a number, then we break.
The index is tracked in an element of a list, passed in as <code>[0]</code> here to start iteration at the beginning.</p>
<p>For each element of the list, our condition for stopping is &#34;is this a number?&#34; and if so, we save it and halt iteration.
Otherwise we run the loop body, which increments our index for the next iteration.</p>
<pre data-lang="hurl"><code data-lang="hurl">try {
    until(func(locals) {
        try {
            is_number(line, locals.1);
            # TODO: define is_number
        } catch as result {
            if(func() {
                hurl result.1;
            }, func() {
                first = result.2;
            });

            hurl result.1;
        };
    }, func(locals) {
        hurl [locals.1 + 1];
    }, [0]);
} catch as val {
};
</code></pre>
<p>And that just leaves the last bit, which is defining our <code>is_number</code> function.
This one leverages the <a href="https://example.com">if_else</a>(https://git.sr.ht/~ntietz/hurl-lang/tree/main/item/lib/if.hurl) also defined in the standard library, and also takes advantage of Hurl&#39;s lists being 1-indexed.
We keep track of the result as a list of <code>[boolean, int]</code> to indicate whether it is a number and, if so, what the number is.</p>
<p>The first thing we do is check the condition for whether the current index points to a digit.
If so, we go to the true case, and we set the result to the character at that position cast to a number.
Otherwise, we loop through a list of the first 9 numbers written as English words, and check whether or not they&#39;re contained as a substring starting at our index.
If so, we set the result.</p>
<p>And at the end, we just hurl what we found!</p>
<pre><code>let is_number = func(line, index) {
    let result = [false, 0];
    if_else(func() {
        hurl is_digit(at(line, index));
    }, func() {
        result = [true, as_num(at(line, index))];
    }, func() {
        try {
            for(9, func(locals) {
                let target = at(word_numbers, locals.1);
                let slice = slice(line, index, index + len(target));
                if(func() {
                    hurl slice == target;
                }, func() {
                    result = [true, locals.1];
                });

                hurl [];
            }, []);
        } catch as default {
        };
    });

    hurl result;
};
</code></pre>
<p>Then it can all be put together into one listing, and we run it and it works!
It gets the right answer and takes a good long time to compute it, but it does get there eventually.</p>
<p>You can see the <a href="https://git.sr.ht/~ntietz/hurl-lang/tree/main/item/aoc/day1.2.hurl">full listing</a> in the repo.
I&#39;ve changed the order of things here and skipped a few pieces here to present it more easily, but otherwise it&#39;s the same code.</p>

<p>So, this was fun.
Honestly, it was enjoyable to do a few days of Advent of Code in this, uh, treat of a language.
(It was my penance.)
But I only really wanted to do it for a few days.
Next year, what will I do?</p>
<p>There are a few options I&#39;m considering for next year:</p>
<ul>
<li><em>Assembly:</em> this seems like a fun challenge for a few days, although probably fairly mind bending! That could be a benefit.</li>
<li><em>Languages made by other Recurse Center people:</em> this could be a fun way to storm through multiple languages, like one of my RC friends did one year.</li>
<li><em>Next year&#39;s language:</em> I intend to make another language next year (something more normal, to focus on some of the &#34;make it nice to use&#34; aspects). If I follow through, I&#39;ll have to use it at least some!</li>
<li><em>Something... normal?</em> I could always use Python or Rust and do some of it the normal way! It&#39;s fun to go through it with friends, so I could go back to doing it socially next year!</li>
</ul>
<p>Advent of Code is a lot of fun, and it&#39;s a nice way to get exposure to different ideas and new languages and new technologies, so I&#39;m excited to see what penance I bring on myself for the next one!</p>
<hr/>


</div><p>
    If this post was enjoyable or useful for you, <strong>please share it!</strong>
    If you have comments, questions, or feedback, you can email <a href="mailto:me@ntietz.com">my personal email</a>.
    To get new posts, subscribe to the <a href="https://www.tokyodev.com/newsletter">newsletter</a> or use the <a href="https://www.tokyodev.com/atom.xml">RSS feed</a>.
  </p></div>
  </body>
</html>
