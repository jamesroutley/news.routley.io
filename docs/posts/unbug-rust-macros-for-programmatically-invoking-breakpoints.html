<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/greymattergames/unbug">Original</a>
    <h1>Show HN: Unbug â€“ Rust macros for programmatically invoking breakpoints</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto">
    <a href="https://docs.rs/unbug" rel="nofollow">
        <img src="https://raw.githubusercontent.com/greymattergames/unbug/main/assets/unbug.svg" width="200" alt="Unbug logo"/>
    </a>
</p>

<p dir="auto">A crate to programmatically invoke debugging breakpoints with helping macros.</p>
<p dir="auto">These macros are designed to help developers catch errors during debugging sessions that would otherwise be a panic (which may not be desirable in certain contexts) or simply a log message (which may go unnoticed).</p>
<p dir="auto">This crate&#39;s internals are disabled by default, there are shims provided so breakpoints will not be compiled outside of a debugging context. This means that the macros in this crate can be used freely throughout your code without having to conditionally compile them out yourself.</p>
<blockquote>

<p dir="auto">You must use the <code>enable</code> feature of this crate (deactivated by default) to activate the breakpoints. This crate cannot detect the presence of a debugger.</p>
<p dir="auto"><strong>BREAKPOINTS REQUIRE NIGHTLY RUST</strong></p>
<p dir="auto"><strong>BREAKPOINTS REQUIRE ENABLING THE EXPERIMENTAL <a href="https://doc.rust-lang.org/core/intrinsics/fn.breakpoint.html" rel="nofollow"><code>core_intrinsics</code></a> FEATURE</strong></p>
<p dir="auto">Additonally, debugging may not land on the macro statements themselves. This can have the consequence that the debgger may pause on an internal module. To avoid this, <code>return</code> or <code>continue</code> immediately following a macro invocation. Alternatively, use your debugger&#39;s &#34;step-out&#34; feature until you reenter the scope of your code.</p>
</blockquote>
<p dir="auto">Error messages are logged when used in conjuction with <a href="https://github.com/tokio-rs/tracing">Tracing</a></p>


<div dir="auto" data-snippet-clipboard-copy-content="// trigger the debugger
unbug::breakpoint!();

for i in 0..5 {
    // ensure! will only trigger the debugger once
    // when the expression argument is false
    unbug::ensure!(false);
    unbug::ensure!(false, &#34;Ensure can take an optional log message&#34;);
    unbug::ensure!(false, &#34;{}&#34;, i);

    // ensure_always! will trigger the debugger every time
    // when the expression argument is false
    unbug::ensure_always!(i % 2 == 0);

    // Use the tracing_subscriber crate to log error messages
    // from the fail! and fail_always! macros.
    tracing_subscriber::fmt::init();

    // fail! pauses and logs an error message
    // will also only trigger once
    unbug::fail!(&#34;fail! will continue to log in non-debug builds&#34;);

    if i &lt; 3 {
        // fail! and fail_always! can be formatted just like error!
        // from the Tracing crate
        unbug::fail!(&#34;{}&#34;, i);
    }

    let Some(_out_var) = some_option else {
        unbug::fail_always!(&#34;fail_always! will trigger every time&#34;);
    };
}
"><pre><span>// trigger the debugger</span>
unbug<span>::</span>breakpoint!<span>(</span><span>)</span><span>;</span>

<span>for</span> i <span>in</span> <span>0</span>..<span>5</span> <span>{</span>
    <span>// ensure! will only trigger the debugger once</span>
    <span>// when the expression argument is false</span>
    unbug<span>::</span>ensure!<span>(</span><span>false</span><span>)</span><span>;</span>
    unbug<span>::</span>ensure!<span>(</span><span>false</span>, <span>&#34;Ensure can take an optional log message&#34;</span><span>)</span><span>;</span>
    unbug<span>::</span>ensure!<span>(</span><span>false</span>, <span>&#34;{}&#34;</span>, i<span>)</span><span>;</span>

    <span>// ensure_always! will trigger the debugger every time</span>
    <span>// when the expression argument is false</span>
    unbug<span>::</span>ensure_always!<span>(</span>i % <span>2</span> == <span>0</span><span>)</span><span>;</span>

    <span>// Use the tracing_subscriber crate to log error messages</span>
    <span>// from the fail! and fail_always! macros.</span>
    tracing_subscriber<span>::</span>fmt<span>::</span><span>init</span><span>(</span><span>)</span><span>;</span>

    <span>// fail! pauses and logs an error message</span>
    <span>// will also only trigger once</span>
    unbug<span>::</span>fail!<span>(</span><span>&#34;fail! will continue to log in non-debug builds&#34;</span><span>)</span><span>;</span>

    <span>if</span> i &lt; <span>3</span> <span>{</span>
        <span>// fail! and fail_always! can be formatted just like error!</span>
        <span>// from the Tracing crate</span>
        unbug<span>::</span>fail!<span>(</span><span>&#34;{}&#34;</span>, i<span>)</span><span>;</span>
    <span>}</span>

    <span>let</span> <span>Some</span><span>(</span>_out_var<span>)</span> = <span>some_option</span> else <span>{</span>
        <span>unbug</span><span>:</span><span>:</span><span>fail_always</span><span>!</span><span>(</span><span>&#34;fail_always! will trigger every time&#34;</span><span>)</span><span>;</span>
    <span>}</span><span>;</span>
<span>}</span></pre></div>

<p dir="auto">Prepare your environment for debugging Rust.</p>
<blockquote>
<p dir="auto">If you are using VSCode you will need the <a href="https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer" rel="nofollow">Rust Analyzer</a> and <a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb" rel="nofollow">Code LLDB</a>  (Linux/Mac) or the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools" rel="nofollow">C/C++</a> (Windows) extensions. <a href="https://code.visualstudio.com/docs/languages/rust#_debugging" rel="nofollow">See Microsoft&#39;s Documentation on Rust Debugging in VSCode</a>.</p>
</blockquote>
<p dir="auto"><strong>1.</strong> Enable Nightly Rust:</p>
<p dir="auto">You can set a workspace toolchain override by adding a <code>rust-toolchain.toml</code> file at the root of your project with the following contents:</p>
<div dir="auto" data-snippet-clipboard-copy-content="[toolchain]
channel = &#34;nightly&#34;"><pre>[<span>toolchain</span>]
<span>channel</span> = <span><span>&#34;</span>nightly<span>&#34;</span></span></pre></div>
<p dir="auto">OR you can set cargo to default to nightly globally:</p>
<div dir="auto" data-snippet-clipboard-copy-content="rustup install nightly
rustup default nightly"><pre>rustup install nightly
rustup default nightly</pre></div>
<p dir="auto"><strong>2.</strong> Create a debug feature in your project that will only be active in the context of a debugger, i.e. not enabled by default.</p>
<p dir="auto"><code>Cargo.toml</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="[features]
default = []
my_debug_feature = [
    &#34;unbug/enable&#34;
]"><pre>[<span>features</span>]
<span>default</span> = []
<span>my_debug_feature</span> = [
    <span><span>&#34;</span>unbug/enable<span>&#34;</span></span>
]</pre></div>
<p dir="auto"><strong>3.</strong> enable the core_intrinsics feature in the root of your crate (<code>src/main.rs</code> or <code>src/lib.rs</code>)</p>
<p dir="auto"><code>src/main.rs</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="#![cfg_attr(
    // this configuration will conditionally activate core_intrinsics
    // only when in a dev build and your debug feature is active
    all(
        debug_assertions,
        feature = &#34;my_debug_feature&#34;,
    ),
    feature(core_intrinsics),
    // Optionally allow internal_features to suppress the warning
    allow(internal_features),
)]"><pre><span>#!<span>[</span>cfg_attr<span>(</span></span>
<span>    <span>// this configuration will conditionally activate core_intrinsics</span></span>
<span>    <span>// only when in a dev build and your debug feature is active</span></span>
<span>    all<span>(</span></span>
<span>        debug_assertions<span>,</span></span>
<span>        feature = <span>&#34;my_debug_feature&#34;</span><span>,</span></span>
<span>    <span>)</span><span>,</span></span>
<span>    feature<span>(</span>core_intrinsics<span>)</span><span>,</span></span>
<span>    <span>// Optionally allow internal_features to suppress the warning</span></span>
<span>    allow<span>(</span>internal_features<span>)</span><span>,</span></span>
<span><span>)</span><span>]</span></span></pre></div>
<p dir="auto"><strong>4.</strong> Pass your feature flag to cargo during your debug build.</p>
<p dir="auto">Sample VSCode <code>.vscode/launch.json</code> with LLDB (Linux/Mac):</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
    &#34;version&#34;: &#34;0.2.0&#34;,
    &#34;configurations&#34;: [
        {
            &#34;type&#34;: &#34;lldb&#34;,
            &#34;request&#34;: &#34;launch&#34;,
            &#34;name&#34;: &#34;LLDB Debug (nightly)&#34;,
            &#34;cargo&#34;: {
                &#34;args&#34;: [
                    &#34;build&#34;,
                    &#34;--bin=my_project&#34;,
                    &#34;--package=my_project&#34;,
                    &#34;--features=my_debug_feature&#34;
                ],
                &#34;filter&#34;: {
                    &#34;name&#34;: &#34;my_project&#34;,
                    &#34;kind&#34;: &#34;bin&#34;
                }
            },
            &#34;args&#34;: [],
            &#34;cwd&#34;: &#34;${workspaceFolder}&#34;,
            &#34;env&#34;: {
                &#34;CARGO_MANIFEST_DIR&#34;: &#34;${workspaceFolder}&#34;
            }
        }
    ]
}"><pre>{
    <span>&#34;version&#34;</span>: <span><span>&#34;</span>0.2.0<span>&#34;</span></span>,
    <span>&#34;configurations&#34;</span>: [
        {
            <span>&#34;type&#34;</span>: <span><span>&#34;</span>lldb<span>&#34;</span></span>,
            <span>&#34;request&#34;</span>: <span><span>&#34;</span>launch<span>&#34;</span></span>,
            <span>&#34;name&#34;</span>: <span><span>&#34;</span>LLDB Debug (nightly)<span>&#34;</span></span>,
            <span>&#34;cargo&#34;</span>: {
                <span>&#34;args&#34;</span>: [
                    <span><span>&#34;</span>build<span>&#34;</span></span>,
                    <span><span>&#34;</span>--bin=my_project<span>&#34;</span></span>,
                    <span><span>&#34;</span>--package=my_project<span>&#34;</span></span>,
                    <span><span>&#34;</span>--features=my_debug_feature<span>&#34;</span></span>
                ],
                <span>&#34;filter&#34;</span>: {
                    <span>&#34;name&#34;</span>: <span><span>&#34;</span>my_project<span>&#34;</span></span>,
                    <span>&#34;kind&#34;</span>: <span><span>&#34;</span>bin<span>&#34;</span></span>
                }
            },
            <span>&#34;args&#34;</span>: [],
            <span>&#34;cwd&#34;</span>: <span><span>&#34;</span>${workspaceFolder}<span>&#34;</span></span>,
            <span>&#34;env&#34;</span>: {
                <span>&#34;CARGO_MANIFEST_DIR&#34;</span>: <span><span>&#34;</span>${workspaceFolder}<span>&#34;</span></span>
            }
        }
    ]
}</pre></div>
<p dir="auto">Sample VSCode <code>.vscode/launch.json</code> with msvc (Windows):</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
    &#34;version&#34;: &#34;0.2.0&#34;,
    &#34;configurations&#34;: [
		{
            &#34;name&#34;: &#34;Windows debug (nightly)&#34;,
            &#34;type&#34;: &#34;cppvsdbg&#34;,
            &#34;request&#34;: &#34;launch&#34;,
            &#34;program&#34;: &#34;${workspaceRoot}/target/debug/unbug_basic_example.exe&#34;,
            &#34;stopAtEntry&#34;: false,
            &#34;cwd&#34;: &#34;${workspaceRoot}&#34;,
            &#34;preLaunchTask&#34;: &#34;win_build_debug&#34;
        }
    ]
}"><pre>{
    <span>&#34;version&#34;</span>: <span><span>&#34;</span>0.2.0<span>&#34;</span></span>,
    <span>&#34;configurations&#34;</span>: [
		{
            <span>&#34;name&#34;</span>: <span><span>&#34;</span>Windows debug (nightly)<span>&#34;</span></span>,
            <span>&#34;type&#34;</span>: <span><span>&#34;</span>cppvsdbg<span>&#34;</span></span>,
            <span>&#34;request&#34;</span>: <span><span>&#34;</span>launch<span>&#34;</span></span>,
            <span>&#34;program&#34;</span>: <span><span>&#34;</span>${workspaceRoot}/target/debug/unbug_basic_example.exe<span>&#34;</span></span>,
            <span>&#34;stopAtEntry&#34;</span>: <span>false</span>,
            <span>&#34;cwd&#34;</span>: <span><span>&#34;</span>${workspaceRoot}<span>&#34;</span></span>,
            <span>&#34;preLaunchTask&#34;</span>: <span><span>&#34;</span>win_build_debug<span>&#34;</span></span>
        }
    ]
}</pre></div>
<p dir="auto">and complimentary <code>.vscode/tasks.json</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="{
	&#34;version&#34;: &#34;2.0.0&#34;,
	&#34;tasks&#34;: [
		{
			&#34;type&#34;: &#34;cargo&#34;,
			&#34;command&#34;: &#34;build&#34;,
			&#34;args&#34;: [
				&#34;--bin=my_project&#34;,
				&#34;--package=my_project&#34;,
				&#34;--features=my_debug_feature&#34;
			],
			&#34;problemMatcher&#34;: [
				&#34;$rustc&#34;
			],
			&#34;group&#34;: {
				&#34;kind&#34;: &#34;build&#34;,
				&#34;isDefault&#34;: true
			},
			&#34;label&#34;: &#34;win_build_debug&#34;
		}
	]
}"><pre>{
	<span>&#34;version&#34;</span>: <span><span>&#34;</span>2.0.0<span>&#34;</span></span>,
	<span>&#34;tasks&#34;</span>: [
		{
			<span>&#34;type&#34;</span>: <span><span>&#34;</span>cargo<span>&#34;</span></span>,
			<span>&#34;command&#34;</span>: <span><span>&#34;</span>build<span>&#34;</span></span>,
			<span>&#34;args&#34;</span>: [
				<span><span>&#34;</span>--bin=my_project<span>&#34;</span></span>,
				<span><span>&#34;</span>--package=my_project<span>&#34;</span></span>,
				<span><span>&#34;</span>--features=my_debug_feature<span>&#34;</span></span>
			],
			<span>&#34;problemMatcher&#34;</span>: [
				<span><span>&#34;</span>$rustc<span>&#34;</span></span>
			],
			<span>&#34;group&#34;</span>: {
				<span>&#34;kind&#34;</span>: <span><span>&#34;</span>build<span>&#34;</span></span>,
				<span>&#34;isDefault&#34;</span>: <span>true</span>
			},
			<span>&#34;label&#34;</span>: <span><span>&#34;</span>win_build_debug<span>&#34;</span></span>
		}
	]
}</pre></div>
<p dir="auto"><strong>5.</strong> Select the debug launch configuration for your platform and start debugging</p>
<p dir="auto">In VSCode, open the &#34;Run and Debug&#34; panel from the left sidebar.</p>
<p dir="auto">launch configurations can be now found in the dropdown menu next to the green &#34;Start Debugging&#34; button.</p>

<p dir="auto">Unbug is free and open source. All code in this repository is dual-licensed under either:</p>
<ul dir="auto">
<li>MIT License (<a href="https://github.com/greymattergames/unbug/blob/main/LICENSE-MIT">LICENSE-MIT</a> or <a href="http://opensource.org/licenses/MIT" rel="nofollow">http://opensource.org/licenses/MIT</a>)</li>
<li>Apache License, Version 2.0 (<a href="https://github.com/greymattergames/unbug/blob/main/LICENSE-APACHE">LICENSE-APACHE</a> or <a href="http://www.apache.org/licenses/LICENSE-2.0" rel="nofollow">http://www.apache.org/licenses/LICENSE-2.0</a>)</li>
</ul>
<p dir="auto">at your option.</p>
</article></div></div>
  </body>
</html>
