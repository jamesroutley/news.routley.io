<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.righto.com/2025/11/unusual-386-standard-cell-circuits.html">Original</a>
    <h1>Unusual circuits in the Intel 386&#39;s standard cell logic</h1>
    
    <div id="readability-page-1" class="page"><div id="post-body-3467012800646079318" itemprop="description articleBody">
<p>I&#39;ve been studying the standard cell circuitry in the Intel 386 processor recently.
The 386, introduced in 1985, was Intel&#39;s most complex processor at the time, containing 285,000 transistors.
Intel&#39;s existing design techniques couldn&#39;t handle this complexity and the chip began to fall behind schedule.
To meet the schedule, the 386 team started using a technique called standard cell logic.
Instead of laying out each transistor manually, the layout process was performed by a computer.</p>
<p>The idea behind standard cell logic is to create standardized circuits (standard cells) for each type of logic element, such
as an inverter, NAND gate, or latch.
You feed your circuit description into software that selects the necessary cells, 
positions these cells into columns, and then routes the wiring between the cells.
This &#34;automatic place and route&#34; process creates the chip layout much faster than manual layout.
However, switching to standard cells was a risky decision since if the software couldn&#39;t create a
dense enough layout, the chip couldn&#39;t be manufactured.
But in the end, the 386 finished ahead of schedule, an almost unheard-of accomplishment.<span id="fnref:oral-history"><a href="#fn:oral-history">1</a></span></p>
<p>The 386&#39;s standard cell circuitry contains a few circuits that I didn&#39;t expect.
In this blog post, I&#39;ll take a quick look at some of these circuits:
surprisingly large multiplexers, a transistor that doesn&#39;t fit into the standard cell layout,
and inverters that turned out not to be inverters.
(If you want more background on standard cells in the 386, see my earlier post,
&#34;<a href="https://www.righto.com/2024/01/intel-386-standard-cells.html">Reverse engineering standard cell logic in the Intel 386 processor</a>&#34;.)</p>
<p>The photo below shows the 386 die with the automatic-place-and-route regions highlighted; I&#39;m focusing
on the red region in the lower right.
These blocks of logic have cells arranged in rows, giving them a characteristic striped appearance.
The dark stripes are the transistors that make up the logic gates, while the lighter regions between the stripes are the
&#34;routing channels&#34; that hold the wiring that connects the cells.
In comparison,
functional blocks
such as the datapath on the left
and the microcode ROM in the lower right
were designed manually to optimize density and performance, giving them a more solid appearance.</p>
<p><a href="https://static.righto.com/images/386-curiosities/die-labeled.jpg"><img alt="The 386 die with the standard-cell regions highlighted." height="530" src="https://static.righto.com/images/386-curiosities/die-labeled-w500.jpg" title="The 386 die with the standard-cell regions highlighted." width="500"/></a></p><p>The 386 die with the standard-cell regions highlighted.</p>
<p>As for other features on the chip,
the black circles around the border are bond wire connections that go to the chip&#39;s external pins.
The chip has two metal layers, a small number by modern
standards, but a jump from the single metal layer of earlier processors such as the 286.
(Providing two layers of metal made automated routing practical: one layer can hold horizontal wires while the other layer
can hold vertical wires.)
The metal appears white in larger areas, but
purplish where circuitry underneath roughens its surface.
The underlying silicon and the polysilicon wiring are obscured by the metal layers.</p>
<h2>The giant multiplexers</h2>
<p>The standard cell circuitry that I&#39;m examining (red box above) is part of the control logic that selects registers
while executing an instruction.
You might think that it is easy to select which registers take part in an instruction, but
due to the complexity of the x86 architecture, it is more difficult.
One problem is that a 32-bit register such as EAX can also be treated as the 16-bit register AX,
or two 8-bit registers AH and AL.
A second problem is that some instructions include a &#34;direction&#34; bit that switches the source and
destination registers.
Moreover, sometimes the register is specified by bits in the instruction, but in other cases,
the register is specified by the microcode.
Due to these factors, selecting the registers for an operation is a complicated process with many
cases, using control bits from the instruction, from the microcode, and from other sources.</p>
<p>Three registers need to be selected for an operation—two source registers and a destination register—and there
are about 17 cases that need to be handled.
Registers are specified with 7-bit control signals that select one of the 30 registers and control
which part of the register is accessed.
With three control signals, each 7 bits wide, and about 17 cases for each, you can see that
the register control logic is large and complicated.
(I wrote more about the 386&#39;s registers <a href="https://www.righto.com/2025/05/intel-386-register-circuitry.html">here</a>.)</p>
<p>I&#39;m still reverse engineering the register control logic, so I won&#39;t go into details.
Instead, I&#39;ll discuss how the register control circuit uses multiplexers, implemented with standard cells.
A multiplexer is a circuit that combines multiple
input signals into a single output by selecting one of the inputs.<span id="fnref:one-hot"><a href="#fn:one-hot">2</a></span>
A multiplexer can be implemented with logic gates, for instance, by ANDing each input with the
corresponding control line, and then ORing the results together.
However, the 386 uses a different approach—CMOS switches—that avoids a large AND/OR gate.</p>
<p><a href="https://static.righto.com/images/386-curiosities/cmos-switch.jpg"><img alt="Schematic of a CMOS switch." height="169" src="https://static.righto.com/images/386-curiosities/cmos-switch-w200.jpg" title="Schematic of a CMOS switch." width="200"/></a></p><p>Schematic of a CMOS switch.</p>
<p>The schematic above shows how a CMOS switch is constructed from two MOS transistors.
When the two transistors are on, the output is connected to the input, but when the two transistors are
off, the output is isolated.
An NMOS transistor is turned on when its input is high, but a PMOS transistor is turned on when its
input is <em>low</em>. Thus, the switch uses two control inputs, one inverted.
The motivation for using two transistors is that an NMOS transistor is better at pulling the output
low, while a PMOS transistor is better at pulling the output high, so combining them yields the best performance.<span id="fnref:6502"><a href="#fn:6502">3</a></span>
Unlike a logic gate, the CMOS switch has no amplification, so a signal is weakened as it passes through the switch.
As will be seen below, inverters can be used to amplify the signal.</p>
<p>The image below shows how CMOS switches appear under the microscope.
This image is very hard to interpret because the two layers of metal on the 386 are packed together densely, but you
can see that some wires run horizontally and others run vertically.
The bottom layer of metal (called M1) runs vertically in the routing area, as well as providing internal
wiring for a cell.
The top layer of metal (M2) runs horizontally; unlike M1, the M2 wires can cross a cell.
The large circles are vias that connect the M1 and M2 layers, while the small circles are connections
between M1 and polysilicon or M1 and silicon.
The central third of the image is a column of standard cells with two CMOS switches outlined in green.
The cells are bordered by the vertical ground rail and
+5V rail that power the cells. 
The routing areas are on either side of the cells, holding the wiring that connects the cells.</p>
<p><a href="https://static.righto.com/images/386-curiosities/switch-metal.jpg"><img alt="Two CMOS switches, highlighted in green. The lower switch is flipped vertically compared to the upper switch." height="465" src="https://static.righto.com/images/386-curiosities/switch-metal-w400.jpg" title="Two CMOS switches, highlighted in green. The lower switch is flipped vertically compared to the upper switch." width="400"/></a></p><p>Two CMOS switches, highlighted in green. The lower switch is flipped vertically compared to the upper switch.</p>
<p>Removing the metal layers reveals the underlying silicon with a layer of polysilicon wiring on top.
The doped silicon regions show up as dark outlines.
I&#39;ve drawn the polysilicon in green; it forms a transistor (brighter green) when it crosses doped silicon.
The metal ground and power lines are shown in blue and red, respectively, with other metal wiring in purple.
The black dots are vias between layers.
Note how metal wiring (purple) and polysilicon wiring (green) are combined to route signals within
the cell.
Although this standard cell is complicated, the important thing is that it only needs to be designed once.
The standard cells for different functions are all designed to have the same width, so the cells can be arranged in
columns, snapped together like Lego bricks.</p>
<p><a href="https://static.righto.com/images/386-curiosities/switch-diagram.jpg"><img alt="A diagram showing the silicon for a standard-cell switch. The polysilicon is shown in green. The bottom metal is shown in blue, red, and purple." height="289" src="https://static.righto.com/images/386-curiosities/switch-diagram-w400.jpg" title="A diagram showing the silicon for a standard-cell switch. The polysilicon is shown in green. The bottom metal is shown in blue, red, and purple." width="400"/></a></p><p>A diagram showing the silicon for a standard-cell switch. The polysilicon is shown in green. The bottom metal is shown in blue, red, and purple.</p>
<p>To summarize, this switch circuit allows the input to be connected to the output or disconnected, controlled by the select signal.
This switch is more complicated than the earlier schematic because it includes two inverters to amplify
the signal.
The data input and the two select lines are connected to the polysilicon (green); the cell is designed so
these connections can be made on either side.
At the top, the input goes through a standard two-transistor inverter.
The lower left has two transistors, combining the NMOS half of an inverter with the NMOS half of the switch.
A similar circuit on the right combines the PMOS part of an inverter and switch.
However, because PMOS transistors are weaker, this part of the circuit is duplicated.</p>
<p>A multiplexer is constructed by combining multiple switches, one for each input.
Turning on one switch will select the corresponding input.
For instance, a four-to-one multiplexer has four switches, so it can select one of the four inputs.</p>
<p><a href="https://static.righto.com/images/386-curiosities/mux4.jpg"><img alt="A four-way multiplexer constructed from CMOS switches and individual transistors." height="430" src="https://static.righto.com/images/386-curiosities/mux4-w200.jpg" title="A four-way multiplexer constructed from CMOS switches and individual transistors." width="200"/></a></p><p>A four-way multiplexer constructed from CMOS switches and individual transistors.</p>
<p>The schematic above shows a hypothetical multiplexer with four inputs.
One optimization is that if an input is always 0, the PMOS transistor can be omitted. Likewise,
if an input is always 1, the NMOS transistor can be omitted.
One set of select lines is activated at a time to select the corresponding input.
The pink circuit selects 1,
green selects input A, yellow selects input B, and blue selects 0.
The multiplexers in the 386 are similar, but have more inputs.</p>
<p>The diagram below shows how much circuitry is devoted to multiplexers in this block of standard cells.
The green, purple, and red cells correspond to the multiplexers driving the three register control
outputs.
The yellow cells are inverters that generate the inverted control signals for the CMOS switches.
This diagram also shows how the automatic layout of cells results in a layout that appears random.</p>
<p><a href="https://static.righto.com/images/386-curiosities/muxes.jpg"><img alt="A block of standard-cell logic with multiplexers highlighted. The metal and polysilicon layers were removed for this photo, revealing the silicon transistors." height="452" src="https://static.righto.com/images/386-curiosities/muxes-w400.jpg" title="A block of standard-cell logic with multiplexers highlighted. The metal and polysilicon layers were removed for this photo, revealing the silicon transistors." width="400"/></a></p><p>A block of standard-cell logic with multiplexers highlighted. The metal and polysilicon layers were removed for this photo, revealing the silicon transistors.</p>
<h2>The misplaced transistor</h2>
<p>The idea of standard-cell logic is that standardized cells are arranged in columns.
The space between the cells is the &#34;routing channel&#34;, holding the wiring that links the cells.
The 386 circuitry follows this layout, except for one single transistor, sitting between two columns
of cells.</p>
<p><a href="https://static.righto.com/images/386-curiosities/extra-transistor.jpg"><img alt="The &#34;misplaced&#34; transistor, indicated by the arrow. The irregular green regions are oxide that was incompletely removed." height="433" src="https://static.righto.com/images/386-curiosities/extra-transistor-w500.jpg" title="The &#34;misplaced&#34; transistor, indicated by the arrow. The irregular green regions are oxide that was incompletely removed." width="500"/></a></p><p>The &#34;misplaced&#34; transistor, indicated by the arrow. The irregular green regions are oxide that was incompletely removed.</p>
<p>I wrote some software tools to help me analyze the standard cells. Unfortunately, my tools
assumed that all the cells were in columns, so this one wayward transistor caused me considerable inconvenience.</p>
<p>The transistor turns out to be a PMOS transistor, pulling a signal high as part of a multiplexer.
But why is this transistor out of place?
My hypothesis is that the transistor is a bug fix.
Regenerating the cell layout was very costly, taking many hours on an IBM mainframe computer.
Presumably, someone found that they could just stick the necessary transistor into an unused spot in the
routing channel, manually add the necessary wiring, and avoid the delay of regenerating all the cells.</p>
<h2>The fake inverter</h2>
<p>The simplest CMOS gate is the inverter, with an NMOS transistor to pull the output low and a
PMOS transistor to pull the output high.
The standard cell circuitry that I examined contains over a hundred inverters of various
sizes.
(Performance is improved by using inverters that aren&#39;t too small but also aren&#39;t
larger than necessary for a particular circuit. Thus, the standard cell library includes inverters of multiple sizes.)</p>
<p>The image below shows a medium-sized standard-cell inverter under the microscope.
For this image, I removed the two metal layers with acid to show the underlying polysilicon
(bright green) and silicon (gray).
The quality of this image is
poor—it is difficult to remove the metal without destroying the polysilicon—but the diagram below
should clarify the circuit.
The inverter has two transistors: a PMOS transistor connected to +5 volts to pull the output high when
the input is 0, and an NMOS transistor connected to ground to pull the output low when the input is 1.
(The PMOS transistor needs to be larger because PMOS transistors don&#39;t function as well as NMOS transistors due to
silicon physics.)</p>
<p><a href="https://static.righto.com/images/386-curiosities/inverter-diagram.jpg"><img alt="An inverter as seen on the die. The corresponding standard cell is shown below." height="347" src="https://static.righto.com/images/386-curiosities/inverter-diagram-w450.jpg" title="An inverter as seen on the die. The corresponding standard cell is shown below." width="450"/></a></p><p>An inverter as seen on the die. The corresponding standard cell is shown below.</p>
<p>The polysilicon input line plays a key role: where it crosses the doped silicon, a transistor gate is
formed.
To make the standard cell more flexible, the input to the inverter
can be connected on either the left or the right; in this case, the input
is connected on the right and there is no connection on the left.
The inverter&#39;s output can be taken from the polysilicon on the upper left or the right, but in this case, it
is taken from the upper metal layer (not shown).
The power, ground, and output lines are in the lower metal layer, which I have represented by
the thin red, blue, and yellow lines. The black circles are connections between the metal layer and
the underlying silicon.</p>
<p>This inverter appears dozens of times in the circuitry.
However, I came across a few inverters that didn&#39;t make sense. The problem was
that the inverter&#39;s output was connected to the output of a multiplexer.
Since an inverter is either on or off, its value would clobber the output of the multiplexer.<span id="fnref:latch"><a href="#fn:latch">4</a></span>
This didn&#39;t make any sense.
I double- and triple-checked the wiring to make sure I hadn&#39;t messed up.
After more investigation, I found another problem: the input to a &#34;bad&#34; inverter didn&#39;t make sense
either. The input consisted of two signals shorted together, which doesn&#39;t work.</p>
<p>Finally, I realized what was going on. A &#34;bad inverter&#34; has the exact silicon layout of an inverter,
but it wasn&#39;t an inverter: it was independent NMOS and PMOS transistors with separate inputs.
Now it all made sense.
With two inputs, the input signals were independent, not shorted together.
And since the transistors were controlled separately, the NMOS transistor could pull the output
low in some circumstances, the PMOS transistor could pull the output high in other circumstances,
or both transistors could be off, allowing the multiplexer&#39;s output to be used undisturbed.
In other words, the &#34;inverter&#34; was just two more cases for the multiplexer.</p>
<p><a href="https://static.righto.com/images/386-curiosities/transistors-die.jpg"><img alt="The &#34;bad&#34; inverter. (Image is flipped vertically for comparison with the previous inverter.)" height="177" src="https://static.righto.com/images/386-curiosities/transistors-die-w450.jpg" title="The &#34;bad&#34; inverter. (Image is flipped vertically for comparison with the previous inverter.)" width="450"/></a></p><p>The &#34;bad&#34; inverter. (Image is flipped vertically for comparison with the previous inverter.)</p>
<p>If you compare the &#34;bad inverter&#34; cell below with the previous cell, they look <em>almost</em> the same, but
there are subtle differences.
First, the gates of the two transistors are connected in the real inverter, but disconnected
by a small gap in the transistor pair.
I&#39;ve indicated this gap in the photo above; it is hard to tell if the gap is real or just an imaging
artifact, so I didn&#39;t spot it.
The second difference is that the &#34;fake&#34; inverter has two input connections, one to each transistor,
while the inverter has a single input connection.
Unfortunately, I assumed that the two connections were just a trick to route the signal across
the inverter without requiring an extra wire.
In total, this cell was used 32 times as a real inverter and 9 times
as independent transistors.</p>
<h2>Conclusions</h2>
<p>Standard cell logic and automatic place and route have a long history before the 386,
back to the early 1970s, so this isn&#39;t an Intel invention.<span id="fnref:standard-cell-history"><a href="#fn:standard-cell-history">5</a></span>
Nonetheless, the 386 team deserves the credit for deciding to use this technology at a time when it
was a risky decision.
They needed to develop custom software for their placing and routing needs, so this wasn&#39;t a trivial undertaking.
This choice paid off and they completed the 386 ahead of schedule.
The 386 ended up being a huge success for Intel, moving the x86 architecture to 32 bits and defining the dominant computer
architecture for the rest of the 20th century.</p>
<p>If you&#39;re interested in standard cell logic, I also wrote about <a href="https://www.righto.com/2021/03/reverse-engineering-standard-cell-logic.html">standard cell logic in an IBM chip</a>.
I plan to write more about the 386, so 
follow me on
<a href="https://oldbytes.space/@kenshirriff">Mastodon</a>, <a href="https://bsky.app/profile/righto.com">Bluesky</a>,
or RSS for updates.
Thanks to Pat Gelsinger and Roxanne Koester for providing helpful papers.</p>
<p>For more on the 386 and other chips, follow me on
Mastodon (<a href="https://oldbytes.space/@kenshirriff">@<span data-cfemail="c3a8a6adb0abaab1b1aaa5a583acafa7a1bab7a6b0edb0b3a2a0a6">[email protected]</span></a>),
Bluesky (<a href="https://bsky.app/profile/righto.com">@righto.com</a>),
or <a href="https://www.righto.com/feeds/posts/default">RSS</a>.  (I&#39;ve given up on Twitter.)
If you want to read more about the 386, I&#39;ve written about the <a href="https://www.righto.com/2023/11/intel-386-clock-circuit.html">clock pin</a>,
<a href="https://www.righto.com/2025/05/386-prefetch-circuitry-reverse-engineered.html">prefetch queue</a>, <a href="https://www.righto.com/2023/10/intel-386-die-versions.html">die versions</a>, <a href="https://www.righto.com/2025/08/intel-386-package-ct-scan.html">packaging</a>, and <a href="https://www.righto.com/2025/08/static-latchup-metastability-386.html">I/O circuits</a>.</p>
<h2>Notes and references</h2>


</div></div>
  </body>
</html>
