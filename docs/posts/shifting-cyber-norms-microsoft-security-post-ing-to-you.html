<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://berthub.eu/articles/posts/shifting-cyber-norms-microsoft-post/">Original</a>
    <h1>Shifting Cyber Norms: Microsoft security POST-ing to you</h1>
    
    <div id="readability-page-1" class="page"><article>
  

  
  

  <div>
  <blockquote>
<p>tl;dr: Microsoft and other email security scanners will visit the links in email you transmit, and run the JavaScript in those links, including calls that lead to POSTs going out. This used to be unacceptable, since POSTs have side effects. Yet here we are. This breaks even somewhat sophisticated single-use sign-on / email confirmation messages. Read on for how to deal with this, and some thoughts on how we should treat gatekeepers like Microsoft that can randomly break things &amp; get away with it.</p>
</blockquote>
<p>On my Mastodon profile I have <a href="https://fosstodon.org/@bert_hubert/111765180339350988">pinned this quote</a>:</p>
<blockquote>
<p>“Writing has been called the process by which you find out you don’t know what you are talking about. Actually doing stuff meanwhile is the process by which you find out you also did not know what you were writing about.” - from <a href="https://berthub.eu/articles/posts/a-2024-plea-for-lean-software/">A 2024 Plea for Lean Software (with running code)</a></p>
</blockquote>
<p>Recently I’ve been actually <em>doing</em> some things again, namely, <a href="https://opentk.nl">building a site that monitors Dutch parliament</a> where users can configure monitors that inform them of parliamentary happenings. This involves having people sign up, sending email, getting users to log in and out etc.</p>
<p>From this I learned yesterday that a user could no longer perform a password-less sign-on to my site, instead always being told that the single-use link had been used already. How come?</p>

<p>“Cyber norms” on the Internet have always been shifting. When I started online in 1992, it was still the case that ‘port numbers below 1024’ were special. Only root (UNIX administrator) users could operate on such a port, and some software would only respond to packets coming from such low port numbers, since these were more trusted. These days, the administrative restrictions on <a href="https://www.w3.org/Daemon/User/Installation/PrivilegedPorts.html">privileged ports</a> remain, but it is not considered a useful security barrier anymore. Anyone can run on port 123.</p>
<p>Similarly, and you may find this hard to believe, but back when the first spam filters were invented, there were arduous discussions among mail server operators if they should even be allowed to do that, even if users wanted it. Was it ethical to have algorithms study email &amp; possibly block transmission? Blocking and inspecting email was considered highly controversial in the 1990s.</p>
<p>Also, software “phoning home” was regarded as reprehensible, even for such things as checking the availability of new versions with possible security updates. Over time, we found out that <a href="https://blog.powerdns.com/2014/10/22/powerdns-security-status-polling">checking for security updates was a very good thing</a>. However, these days commonly used software “phones home” to the tune of <a href="https://www.tcd.ie/news_events/articles/trinity-study-raises-privacy-fears-over-data-collection-by-google-apps/">dozens of megabytes per day</a>, which we call “telemetry” but it is actually spying.</p>
<p>The problem also is that no one announces it when they transgress norms and establish new de-facto boundaries of what is acceptable. We just find out about it “as we go along”.</p>

<p>Seasoned developers know that <a href="https://developer.mozilla.org/en-US/docs/Glossary/Idempotent">HTTP GET requests need to be idempotent</a>. Or in other words, a GET request should not alter the state of anything. Browsers and basically everyone in the chain should be free to do a GET request to a URL, and it should not matter.</p>
<p>If you want to actually change a state or make something happen that is not idempotent, <a href="https://en.wikipedia.org/wiki/POST_(HTTP)">you should use a POST request</a>. There is therefore this norm that no software should be doing or repeating POSTs without making sure that this is what the user wanted.</p>
<p>Meanwhile, miscreants like to spread malware. We’re fine with folks scanning email attachments for badness. Over time, it also became OK for software to visit <em>links</em> in email to find out what was behind them. This involved GET requests, so this was acceptable.</p>
<p>This did already break a few workflows over the past few years. <a href="https://answers.microsoft.com/en-us/msoffice/forum/all/one-time-use-link-not-working-with-safe-links/ecd11bb3-2e85-4293-b8c2-c8d8d04d8e5d">Single-use magic (sign-on) links got “consumed”</a>. Once the user saw the email &amp; they clicked on the sign-on link, <a href="https://techcommunity.microsoft.com/discussions/microsoftdefenderforoffice365/possible-major-problem-with-ms-defender-scanningclicking-links/3874918">the link would be dead already</a>. Microsoft had already automatically eaten the single-use link for you, before you could use it.</p>
<blockquote>
<p>This, by the way, also massively confuses some phishing tests - making it look like all users click on all links. However, recently, it has been Microsoft that is doing the “clicking”.</p>
</blockquote>
<p>However, we could argue that these people had it coming - GET requests should not have side effects, and Microsoft was in their rights to perform these requests for security purposes. To prevent this, wise operators of single-use sign-on links make the actual sign-on be a POST, something scanners aren’t supposed to do, for reasons outlined above.</p>
<p>Lately however, operators of services (like me) have found that the links they send to users to sign in, or confirm their accounts, actually lead to POST requests coming from Microsoft. Microsoft’s security scanning will now not only visit the links you mail out, they will also run the JavaScript on your page, and will also send out any POSTs generated by that JavaScript:</p>
<center>
<p><img loading="lazy" src="https://berthub.eu/articles/microsoft-post.png"/></p>
</center>
<p>Now, this is a strong violation of the norm we had: you can GET all you want, but <a href="https://datatracker.ietf.org/doc/html/rfc7231#section-4.2.2">POSTs have side-effects, and it is dangerous to do them “to see what happens”</a>. Not only is Microsoft transgressing an important norm here, but as far as I can tell, they also didn’t tell anyone about this or warn us in any way.</p>
<p>A charitable read of this is that this is OK since Microsoft performed a GET request to get our link, and <em>our link</em> then caused a POST to be performed. So you could argue that it is us that was in the wrong, we caused side-effects based on a GET. There is maybe some truth to this.</p>
<p>However, the new ‘cyber norm’ now appears to be: we’ll visit your page, run your JavaScript, and perform any POSTs requested by it. It appears that <em>for now</em>, the security software will not virtually click on an actual “sign-up” button to see what happens then. But this is probably only a matter of time.</p>
<blockquote>
<p>We may wonder also what fun a determined hacker could have with Microsoft running random bits of JavaScript on their servers and allowing these to talk to the world (or to Microsoft itself even).</p>
</blockquote>

<p>If you send any kind of sign-on or email confirmation link, you must assume that security scanners will <em>eventually</em> do anything they can to execute that sign-on or confirmation.</p>
<p>In other words, your software can no longer have links that work just once. You must deal with Microsoft (and other security scanners) finishing an account sign-on on behalf of your user.</p>
<p>So what your site must do is deal with a user finishing their sign-up or email confirmation a second (or third..) time. The earlier confirmations were fake. Now, some operators have <a href="https://github.com/FusionAuth/fusionauth-issues/issues/629">attempted to put a captcha on the link to prevent such fake confirmations</a> but that will likely 1) annoy your users and 2) get you on the Microsoft naughty list, <a href="https://berthub.eu/articles/posts/who-controls-the-internet/">from which there is no escaping</a>.</p>
<p>Some might argue that these confirmation / single-use sign-on links are no good anyhow, but for now, they are what we have to get people to sign up for services.</p>

<p>It would be nice if the big dominant operators were forced to be more transparent about the norms they transgress. I understand the security dilemma, trust me, I really do. You can’t tell the bad people of the world your exact security practices.</p>
<p>But you can’t also silently break all kinds of things.</p>
<p>The <a href="https://digital-markets-act.ec.europa.eu/gatekeepers_en">EU Digital Markets Act recognizes that some players are “designated gatekeepers”</a>, with such market force that they must adhere to additional rules. This currently includes Alphabet, Amazon, Apple, ByteDance, Meta and Microsoft.</p>
<p>These gatekeepers should be more accountable about what they do online, and I hope we can make that happen.</p>
<p>Because who knows what they might break next, without giving us time to prepare.</p>

</div>

  



</article></div>
  </body>
</html>
