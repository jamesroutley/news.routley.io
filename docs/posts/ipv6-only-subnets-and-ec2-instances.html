<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://aws.amazon.com/blogs/networking-and-content-delivery/introducing-ipv6-only-subnets-and-ec2-instances/">Original</a>
    
    <div id="readability-page-1" class="page"><article vocab="http://schema.org/" typeof="TechArticle"> 
      <meta property="inLanguage" content="en-US"/> 
      <meta property="image" content="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2021/11/23/ipv6-blog_2.jpg"/> 
       
       
      <section property="articleBody"> 
       <p>In June 2021, we <a href="https://aws.amazon.com/blogs/publicsector/aws-enables-us-federal-governments-move-ipv6/" target="_blank" rel="noopener noreferrer">announced</a> our continued commitment and innovation towards the enablement of IPv6 on AWS. Today, we take a monumental step forward with the ability to create an IPv6-only architecture on AWS. With this launch, <a href="https://aws.amazon.com/vpc/" target="_blank" rel="noopener noreferrer">Amazon Virtual Private Cloud</a> (VPC) now allows you to create IPv6-only subnets in your dual-stack VPCs and launch EC2 instances built on the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-types.html#ec2-nitro-instances" target="_blank" rel="noopener noreferrer">Nitro System</a> in these subnets. This capability is ideal if you have workloads, such as serverless and container applications, that consume a large number of IP addresses. Workloads that are constrained by the limited size of the IPv4 address space can now migrate to an IPv6-only environment on AWS to scale up. Additionally, with this launch, you will be able to meet the requirements for adoption of IPv6-only network environments set by US federal government agencies and minimize the need for translation software or systems, thereby creating a simplified IPv6-only architecture.</p> 
       <p>Within a VPC, the size of the IPv6 CIDR block for IPv6-only subnets has a fixed prefix length of /64. This provides 2^64 (approximately 18 quintillion) IPv6 addresses and allows you to scale your deployments on AWS without requiring any IPv4 addressing in the subnet. The EC2 instances launched in the IPv6-only subnet and the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html" target="_blank" rel="noopener noreferrer">Elastic Network Interfaces</a> (ENI) attached to them are assigned an IPv6 address through <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_DHCP_Options.html" target="_blank" rel="noopener noreferrer">Dynamic Host Configuration Protocol version 6 (DHCPv6) options set</a> from the IPv6 CIDR block of your subnet. These instances do not require private IPv4 addresses to be assigned. The instances can access the <a href="https://aws.amazon.com/about-aws/whats-new/2021/08/Ipv6-amazon-ec2-metadata-time-sync-vpc-dns/" target="_blank" rel="noopener noreferrer">local instance services</a> such as <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html" target="_blank" rel="noopener noreferrer">Amazon EC2 Instance Metadata Service</a>, <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/set-time.html">Amazon Time Sync Service</a>, and <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-dns.html#vpc-dns-support">Amazon VPC DNS server</a> (also known as Amazon Route 53 Resolver) over IPv6 Unique Local Addresses (ULA). Additionally, we are also introducing a new naming scheme called <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-naming.html" target="_blank" rel="noopener noreferrer">Resource-based naming (RBN)</a> that allows you to configure the EC2 instance guest OS hostname. This also includes the functionality to allow privately resolving the instance to IPv6 addresses.</p> 
       <p>In this blog post, you will learn how to create an IPv6-only subnets within a dual-stack VPC and launch an EC2 instance into this subnet. You will also learn about Resource-based naming and how to access local instance services over the IPv6 endpoint.</p> 
       <p>Now let’s get started by creating an IPv6-only subnet and launch an EC2 instance within this subnet.</p> 
       <h2><strong>Pre-requisites</strong></h2> 
       <p>Before we get into any of the setup, you need to make sure that the following prerequisite is fulfilled:</p> 
       <ul> 
        <li>You have created a new VPC in any region and associated a secondary IPv6 CIDR block with your VPC. Optionally, you can also choose an existing VPC that has an associated secondary IPv6 CIDR block. We will refer to this VPC as dual-stack VPC for the rest of the blog.</li> 
       </ul> 
       <h2><strong>Create an IPv6-only subnet within a dual-stack VPC</strong></h2> 
       <p>You can create a IPv6-only subnet using the <a href="https://console.aws.amazon.com/" target="_blank" rel="noopener noreferrer">AWS Management Console</a> or <a href="https://aws.amazon.com/cli/" target="_blank" rel="noopener noreferrer">Command Line Interface</a> (CLI). In this blog post, we’ll do it by using the console.</p> 
       <ol> 
        <li>Open the <a href="https://console.aws.amazon.com/vpc/" target="_blank" rel="noopener noreferrer">Amazon VPC console</a> and navigate to <strong>Subnets</strong> and then click on <strong>Create subnet</strong> as shown in Figure 1 below.</li> 
        <li>Choose the VPC for which you’re creating the subnet, specify the subnet name, select an Availability Zone, select the checkbox to enable <strong>“IPv6-only” </strong>and then specify the hexadecimal pair for one of the 256 possible /64 subnets out of the /56 VPC CIDR (for example, select 20) and confirm the entry by choosing the tick icon. This is shown in Figure 1 below.</li> 
        <li>Once you have specified the subnet details as necessary, you can choose <strong>Create</strong>.</li> 
       </ol> 
       <div id="attachment_10017"> 
        <p><a href="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2021/11/22/Screen-Shot-2021-11-22-at-1.29.35-PM.png" target="_blank" rel="noopener noreferrer"><img aria-describedby="caption-attachment-10017" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2021/11/22/Screen-Shot-2021-11-22-at-1.29.35-PM.png" alt="Create IPv6-only Subnet" width="659" height="767"/></a></p><p id="caption-attachment-10017">Figure 1: Create IPv6-only Subnet</p> 
       </div> 
       <p>You need the subnet ID later so note it now. Please note that the IPv6 CIDR 2001:db8:1234:1a00::/56 used in Figure 1 above belongs to the documentation-only prefix 2001:db8::/32 reserved by IANA, which is used for documentation purposes only. In your case, you can use either AWS provided IPv6 addresses or <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-byoip.html" target="_blank" rel="noopener noreferrer">Bring your own IPv6 addresses</a> (BYOIPv6) for your VPC, so the CIDRs will differ. You can now verify that the subnet is IPv6-only by navigating to Subnets and selecting your specific subnet. Under the <strong>Details </strong>(refer to figure 2 below), look for these fields:</p> 
       <p>a. <strong>IPv4 CIDR</strong> should NOT be defined since this is a IPv6-only subnet</p> 
       <div id="attachment_10018"> 
        <p><a href="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2021/11/22/Screen-Shot-2021-11-22-at-1.30.55-PM.png" target="_blank" rel="noopener noreferrer"><img aria-describedby="caption-attachment-10018" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2021/11/22/Screen-Shot-2021-11-22-at-1.30.55-PM.png" alt="IPv6-only subnet details" width="1965" height="734"/></a></p><p id="caption-attachment-10018">Figure 2: IPv6-only subnet details</p> 
       </div> 
       <h2><strong>Resource-based naming (RBN)</strong></h2> 
       <p>Resource-based naming (RBN) is a new private DNS name for instances in place of IP based naming (IPBN). When you launch an instance, <em>the EC2 instance ID</em> is included in the hostname of the instance. The resource-based name exists for the life of the EC2 instance. When you use RBN as the Private DNS hostname for an IPv6-only instance, it returns the IPv6 Global Unicast Address (AAAA record).</p> 
       <p>When you launch an EC2 instance with a Resource-based hostname type, the guest OS hostname is configured to use the EC2 instance ID. A resource based name (RBN) looks like the following:</p> 
       <p>Format for an instance in us-east-1: <code><span><em>ec2-instance-id</em></span><span>.ec2.internal</span></code></p> 
       <p>As mentioned above, let’s understand these new fields:</p> 
       <p><strong>Hostname type</strong> – This field determines the options for the guest OS hostname of the EC2 instance. It can be either Resource name (RBN) or IP name (IPBN). An instance hostname is based on the IPv4 address or ID of the instance. The default values are inherited from the subnet.</p> 
       <p>The<strong> DNS Hostname</strong> field shows two attributes <strong>Enable resource-based IPv4 (A record) DNS requests </strong>and <strong>Enable resource-based IPv6 (AAAA record) DNS requests</strong>.</p> 
       <ul> 
        <li><strong>Enable resource-based IPv4 (A record) DNS requests</strong> – Indicates whether to respond to DNS queries for a hostname that is based on a resource ID with DNS A records.</li> 
        <li><strong>Enable resource-based IPv6 (AAAA record) DNS requests</strong> – Indicates whether to respond to DNS queries for a hostname that is based on a resource ID with DNS AAAA records.</li> 
       </ul> 
       <p>When you launch an EC2 instance into an IPv6-only subnet, Resource-based naming is used automatically and “Resource-based IPv6 (AAAA record) DNS requests” is enabled as we will see in the below section.</p> 
       <h2><strong>Launch an IPv6-only EC2 instance into the IPv6-only subnet</strong></h2> 
       <p>After you’ve created your subnet, you can launch an IPv6-only EC2 instance into your IPv6-only subnet using the Amazon EC2 console.</p> 
       <ol> 
        <li>Open the <a href="https://console.aws.amazon.com/ec2/" target="_blank" rel="noopener noreferrer">Amazon EC2 console</a> and choose <strong>Launch Instance</strong>.</li> 
        <li>Follow the directions in the wizard. Select an AMI and a Nitro instance type (for example, t3.micro) and choose Next: <strong>Configure Instance Details</strong>.</li> 
        <li>On the <strong>Configure Instance Details</strong> page, ensure that you have selected the required dual-stack VPC in the <strong>Network</strong> list, then select the IPv6-only subnet in to which to launch the instance as shown in figure 3 below. Here, you can notice the following fields:</li> 
        <li>On the <strong>Configure Security Group</strong> page, choose from any existing security group that you own, or follow the wizard directions to create a new security group to allow SSH from a specific IPv6 address or range of IPv6 addresses to access your instance. Choose <strong>Review </strong>and<strong> Launch</strong> when you’re done.</li> 
       </ol> 
       <p>To connect to your IPv6-only instance using Secure Shell (SSH), you need to add inbound rules in your security group to allow access from a specific IPv6 address or range of IPv6 addresses on the Internet to access your EC2 instance. For more information, please refer to the documentation on <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-security-groups.html" target="_blank" rel="noopener noreferrer">adding rules in your security groups</a>. You will also need to modify the route table associated with the IPv6-only subnet and add a route to allow access from a specific IPv6 address or range of IPv6 addresses on the Internet to access your EC2 instance. Once you have configured your route table, you can then SSH into the IPv6-only instance using the following command. For more information, please refer to the documentation on <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html" target="_blank" rel="noopener noreferrer">Connect to your Linux instance using SSH</a><em>.</em></p> 
       <p><code><span>ssh -i /path/my-key-pair.pem my-instance-user-name@my-instance-IPv6-address</span></code></p> 
       <p>If the end user is located in a corporate network that doesn’t support IPv6 address space, you need to launch a dual-stack instance in a dual-stack subnet which the user can SSH into via public IPv4 address first. Then, from that dual-stack instance, the user can SSH into the IPv6-only instance.</p> 
       <h2><strong>Accessing local instance services over IPv6 Endpoints</strong></h2> 
       <p>Once you have SSH’d into the IPv6-only EC2 instance, you can now access Amazon EC2 Instance Metadata Service, Amazon Time Sync Service, and Amazon VPC DNS server over IPv6 endpoints using instances built on the Nitro System.</p> 
       <ol> 
        <li>The Amazon EC2 Instance Metadata Service is available at fd00:ec2::254 IPv6 address. To access the IMDS IPv6 endpoint from within the IPv6-only EC2 instance, you need to enable it. The IPv6 address of the instance metadata service is compatible with IMDSv2 commands. Today, you can modify the instance metadata options on existing instances using AWS SDK or AWS CLI only. You can’t use the Amazon EC2 console for modifying instance metadata options. If you have already launched an IPv6-only EC2 instance, you can use the modify-instance-metadata-options API call to enable access for IMDS IPv6 Endpoint as mentioned <a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/modify-instance-metadata-options.html" target="_blank" rel="noopener noreferrer">here</a>.</li> 
       </ol> 
       <p><code><span>aws ec2 modify-instance-metadata-options --instance-id <em><span>&lt;your-instance-id&gt;</span></em> --http-protocol-ipv6 enabled</span></code></p> 
       <p>Additionally, if you are launching EC2 instance using API or CLI, you can use the run-instances API call to enable access to the IMDS IPv6 endpoint.</p> 
       <p><code><span>aws --region <span><em>&lt;region&gt;</em></span> ec2 run-instances --instance-type <span><em>&lt;instance-type&gt;</em></span> --image-id <span><em>&lt;ami-id&gt;</em></span> --subnet-id <em><span>&lt;your-ipv6-only-subnet-id&gt;</span></em> --key-name <span><em>&lt;your-keyname&gt;</em></span> --ipv6-address-count 1 --security-group-ids <span><em>&lt;your-security-group-id&gt;</em></span> --metadata-options &#34;HttpEndpoint=enabled,HttpProtocolIpv6=enabled&#34;</span></code></p> 
       <p>Once you have enabled access to the IMDS IPv6 Endpoint, you can then access it from within the IPv6-only EC2 instance using the following curl command:</p> 
       <p><code><span>curl -w &#34;\n&#34; --connect-timeout 10 &#39;http://[fd00:ec2::254]/latest/meta-data/hostname&#39;</span></code></p> 
       <p>Check if the output includes the following:</p> 
       <p>For instance in us-east-1 region: <code><span><em>ec2-instance-id</em></span>.<span>compute.internal</span></code></p> 
       <ol start="2"> 
        <li>The Amazon Time Sync Service is available through NTP at the fd00:ec2::123 IPv6 address. To configure your IPv6-only EC2 instance to use the Amazon Time Sync Service over IPv6 address, please refer to the documentation on</li> 
       </ol> 
       <p>To test the Amazon Time Sync Service through NTP, you can run the following command (make sure to install ntpdate on your distribution):</p> 
       <p><code><span>ntpdate -q fd00:ec2::123</span></code></p> 
       <ol start="3"> 
        <li>The Amazon VPC DNS server is available at fd00:ec2::253 IPv6 address. To perform a DNS name lookup using Amazon VPC DNS server over IPv6 endpoint, you can run the following command:</li> 
       </ol> 
       <p><code><span>dig @fd00:ec2::253 -6 AAAA</span> <em><span>&lt;domain-name&gt;</span></em></code></p> 
       <p>Verify if you get IPv6 address(es) in the Answer section of your dig output.</p> 
       <h2><strong>Things to keep in mind </strong></h2> 
       <ol> 
        <li>You can launch Amazon EC2 instances based on the Nitro system only in the IPv6-only subnets.</li> 
        <li>Resource-based naming is only supported for Private DNS hostnames. Public DNS hostnames are not supported.</li> 
        <li>You can access the local instance services over both IPv4 and IPv6 endpoints from an EC2 instance launched within the IPv6-only subnet.</li> 
       </ol> 
       <h2><strong>Now Available</strong></h2> 
       <p>IPv6-only subnets, IPv6-only EC2 instances and Resource-based naming are available in all public AWS Regions, AWS GovCloud (US-West), AWS GovCloud (US-East), Amazon Web Services China (Beijing) Region operated by Sinnet, and Amazon Web Services China (Ningxia) Region operated by NWCD, at no additional cost. You can start using them today. Please send feedback to the <a href="https://forums.aws.amazon.com/forum.jspa?forumID=30">AWS forum</a> for Amazon EC2 or through your usual AWS support contacts. To get started with these new features, visit the following documentation links:</p> 
       <p>Creating an IPv6-only subnet – <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html" target="_blank" rel="noopener noreferrer">VPCs and subnets</a></p> 
       <p>Understanding Resource-based naming – <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-naming.html" target="_blank" rel="noopener noreferrer">Amazon EC2 instance hostname types</a></p> 
       <p>Launching an EC2 instance within IPv6-only subnet – <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/LaunchingAndUsingInstances.html" target="_blank" rel="noopener noreferrer">Launch your EC2 instance</a></p> 
       <div> 
        <p><img src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2021/09/22/raaswani.jpg" alt="raaswani.jpg" width="125" height="125"/></p> 
        <h3>Rohit Aswani</h3> 
        <p>Rohit is a Senior Specialist Solutions Architect focused on Networking at AWS, where he helps customers build and design scalable, highly-available, secure, resilient and cost effective networks. He holds a MS in Telecommunication Systems Management from Northeastern University, specializing in Computer Networking.</p> 
       </div> 
       <div> 
        <p><img src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2021/11/19/adisanta.jpg" alt="adisanta.jpg" width="125" height="125"/></p> 
        <h3>Aditya Santhanam</h3> 
        <p>Aditya Santhanam is a Senior Product Manager at AWS in the VPC product team. He is passionate about improving AWS cloud networking experience and accelerate IPv6 adoption across various customer verticals. Before joining AWS, he has spent over decade working in the areas of Telco Cloud, Content Delivery Networks and Cybersecurity. In his spare time, he likes to spend time with his family and enjoys outdoor activities.</p> 
       </div> 
       <!-- '"` --> 
      </section> 
       
       
     </article></div>
  </body>
</html>
