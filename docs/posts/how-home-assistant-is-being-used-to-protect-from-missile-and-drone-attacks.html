<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://denysdovhan.com/home-assistant-config/config/war/">Original</a>
    <h1>How Home Assistant is being used to protect from missile and drone attacks</h1>
    
    <div id="readability-page-1" class="page"><div data-md-component="container">
<main data-md-component="main">
<div>

<div data-md-component="content">
<article>
<a href="https://github.com/denysdovhan/home-assistant-config/edit/main/docs/config/war.md" title="Edit this page">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"></path></svg>
</a>
<a href="https://github.com/denysdovhan/home-assistant-config/raw/main/docs/config/war.md" title="View source of this page">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"></path></svg>
</a>

<p>In 2022, <a href="https://en.wikipedia.org/wiki/Russo-Ukrainian_War">Russia launched a full-scale invasion of Ukraine</a>, waging a genocidal war against my country. Ukraine is being hit by all types of weapons (except nuclear) daily. Home Assistant helps me stay safe and notifies me about incoming threats.</p>
<p>We hear the siren a few times a day. Life would completely stop if we went to the shelter every time the siren goes off. So, people adapt.</p>
<p>In Ukraine, we tend to differentiate the levels of danger. When the siren goes off, practically everyone starts checking their phones: &#34;What is going on?&#34;</p>
<p>We have <a href="https://alerts.in.ua/">various applications</a> and <a href="https://t.me/s/war_monitor">Telegram channels</a> for monitoring the type of danger, missile paths, and understanding whether we are in direct danger or can continue with our lives for another minute.</p>
<p>This is what war in the 21st century looks like: you can practically monitor a missile or a drone that is trying to kill you right from your phone. This is like a Black Mirror episode in real life. 😅</p>
<p>There are different kinds of air alarms with varying levels of danger:</p>
<ul>
<li><strong>MiG-31K take off</strong> – This can happen multiple times during the day. The <a href="https://en.wikipedia.org/wiki/Mikoyan_MiG-31">MiG-31K</a> can carry a very dangerous <a href="https://en.wikipedia.org/wiki/Kh-47M2_Kinzhal">Kh-47M2 Kinzhal hypersonic missile</a>. Although it happens rarely, you can&#39;t predict when the missile is attached and when it is not, so most people tolerate this level of danger.</li>
<li><strong>Suicide drones attack</strong> – Usually carried out by <a href="https://en.wikipedia.org/wiki/HESA_Shahed_136">Iranian Shahed 136 drones</a>. Most of them get shot down, but they are still dangerous and scary. We call them &#34;mopeds&#34; or &#34;lawn-mowers&#34; because of the sound of their engine.</li>
<li><strong>Ballistic missile attack</strong> – This can happen multiple times a day. Ballistic missiles, like the <a href="https://en.wikipedia.org/wiki/9K720_Iskander">9K720 Iskander</a>, are extremely fast (2 km/s). You have only up to 10 minutes to hide somewhere. Usually, the fastest way is to hide behind two walls (corridor or a bathroom).</li>
<li><strong>Cruise missile attack</strong> – Cruise missiles, like the <a href="https://en.wikipedia.org/wiki/Kalibr_(missile_family)">Kalibr</a>, are relatively slow and fly like a plane. Nevertheless, they can fly a long distance and easily reach any point in the country.</li>
</ul>
<p>Of course, the most dangerous type of attack is a combined one. This means all of the above are raining down on Ukrainian cities simultaneously. These usually happen overnight at 4:00 in the morning. The drones and cruise missiles are used to exhaust air defenses, followed by ballistic and/or hypersonic strikes.</p>

<p>Home Assistant has a built-in <a href="https://www.home-assistant.io/integrations/ukraine_alarm/">Ukraine Alarm</a> integration. It monitors the nation-wide system of air alarms and toggles safety sensors in HA.</p>
<p>When there is any type of danger, I send a critical notification and announce the message on my smart speakers.</p>
<p>Of course, the air siren goes off on the streets, roaring across the city, so everyone hears the danger is approaching. But I made an automation to send a critical notification and speak at home speakers, so I certainly wake up to check what is going on.</p>
<div><pre><span></span><code><span>id</span><span>:</span><span> </span><span>air_siren_kyiv</span>
<span>alias</span><span>:</span><span> </span><span>&#39;Alert:</span><span> </span><span>Air</span><span> </span><span>Siren</span><span> </span><span>in</span><span> </span><span>Kyiv&#39;</span>
<span>description</span><span>:</span>
<span>  </span><span>Air Alert announcement when we are in Kyiv. Sends critical notifications</span>
<span>  </span><span>and announces on speakers.</span>
<span>trigger</span><span>:</span>
<span>  </span><span>-</span><span> </span><span>platform</span><span>:</span><span> </span><span>state</span>
<span>    </span><span>entity_id</span><span>:</span><span> </span><span>binary_sensor.alerts_kyiv_air</span>
<span>    </span><span>to</span><span>:</span><span> </span><span>&#39;on&#39;</span>
<span>    </span><span>from</span><span>:</span><span> </span><span>&#39;off&#39;</span>
<span>    </span><span>variables</span><span>:</span>
<span>      </span><span>title</span><span>:</span><span> </span><span>Air Alert goes off!</span>
<span>  </span><span>-</span><span> </span><span>platform</span><span>:</span><span> </span><span>state</span>
<span>    </span><span>entity_id</span><span>:</span><span> </span><span>binary_sensor.alerts_kyiv_air</span>
<span>    </span><span>to</span><span>:</span><span> </span><span>&#39;off&#39;</span>
<span>    </span><span>from</span><span>:</span><span> </span><span>&#39;on&#39;</span>
<span>    </span><span>variables</span><span>:</span>
<span>      </span><span>title</span><span>:</span><span> </span><span>It is safe now!</span>
<span>condition</span><span>:</span>
<span>  </span><span>-</span><span> </span><span>alias</span><span>:</span><span> </span><span>Someone is in Kyiv</span>
<span>    </span><span>condition</span><span>:</span><span> </span><span>state</span>
<span>    </span><span>entity_id</span><span>:</span><span> </span><span>sensor.family_in_kyiv</span>
<span>    </span><span>state</span><span>:</span><span> </span><span>&#39;on&#39;</span>
<span>action</span><span>:</span>
<span>  </span><span>-</span><span> </span><span>service</span><span>:</span><span> </span><span>script.announcement</span>
<span>    </span><span>data</span><span>:</span>
<span>      </span><span>title</span><span>:</span><span> </span><span>&#39;{{</span><span> </span><span>title</span><span> </span><span>}}&#39;</span>
<span>      </span><span>force_speak</span><span>:</span><span> </span><span>true</span><span> </span><span># Speaks even in DND mode</span>
<span>      </span><span>notify_data</span><span>:</span>
<span>        </span><span>group</span><span>:</span><span> </span><span>air-alerts</span>
<span>        </span><span>push</span><span>:</span>
<span>          </span><span>sound</span><span>:</span>
<span>            </span><span>name</span><span>:</span><span> </span><span>default</span>
<span>            </span><span>critical</span><span>:</span><span> </span><span>1</span>
<span>            </span><span>volume</span><span>:</span><span> </span><span>0.75</span>
</code></pre></div>

<p>I already mentioned we have various Telegram channels for monitoring the situation during an attack. Those channels provide live updates on dangers, flight paths, and the type of attack.</p>
<p>So often I found myself constantly checking my phone to understand whether I am in direct danger or can sleep for a few hours. <em>I know it sounds crazy, and normal people would go straight to the nearby shelter, but this is life in Ukraine. You don&#39;t have to follow my reckless example. If you are in Ukraine, GO TO THE SHELTER!</em></p>
<p>I decided to automate it. Instead of reading these channels myself, I delegate this task to HA.</p>
<p>I use the <a href="https://github.com/danieldotnl/ha-multiscrape">HA Multiscrape</a> custom integration for that. You may ask, &#34;why do you need a custom component when <a href="https://www.home-assistant.io/integrations/scrape/">HA has a built-in scraping component</a>?&#34; Yes, it does, but I need multiple sensors from a single scrape, and I need to work with lists of data. The built-in component has some limitations with that.</p>
<h2 id="monitoring-imminent-danger">Monitoring Imminent Danger<a href="#monitoring-imminent-danger" title="Permanent link">¶</a></h2>
<p>Cruise missiles are usually carried and launched by <a href="https://en.wikipedia.org/wiki/Tupolev_Tu-95">Tu-95 bombers</a>.</p>
<p>They fly to the missile launch sites for about 3 hours, launch their missiles, then it takes about 1-2 hours for missiles to fly to Kyiv. So there&#39;s some time to prepare a hideout (in my case, it&#39;s the bathroom), gather documents, and sleep for a few hours before the &#34;show&#34; begins.</p>
<figure>
<img alt="Tu-95 takes off notification" src="https://github.com/denysdovhan/home-assistant-config/assets/3459374/eb24f547-8ef6-47b4-a60c-97995dfaf02c"/>
<figcaption>Notification about Tu-95 bombers taking off</figcaption>
</figure>
<p>Usually, it happens in the evening and means tonight will be a massive missile attack.</p>
<p>I have a sensor that checks the Telegram channels, scrapes the list of messages every 5 seconds, and checks if the latest message contains a specific set of words, like <em>&#34;take off&#34; <strong>and</strong> &#34;plane&#34; <strong>and</strong> &#34;tu-95&#34;</em>. It also stores the latest message as an attribute.</p>
<div><pre><span></span><code><span>multiscrape</span><span>:</span>
<span>  </span><span>-</span><span> </span><span>name</span><span>:</span><span> </span><span>War Monitor</span>
<span>    </span><span>resource</span><span>:</span><span> </span><span>https://t.me/s/war_monitor</span>
<span>    </span><span>scan_interval</span><span>:</span><span> </span><span>5</span>
<span>    </span><span>list_separator</span><span>:</span><span> </span><span>&#39;|||&#39;</span>
<span>    </span><span>binary_sensor</span><span>:</span>
<span>      </span><span>-</span><span> </span><span>unique_id</span><span>:</span><span> </span><span>imminent_attack_in_war_monitor</span>
<span>        </span><span>name</span><span>:</span><span> </span><span>Imminent Attack in War Monitor</span>
<span>        </span><span>icon</span><span>:</span><span> </span><span>mdi:airplane-clock</span>
<span>        </span><span>device_class</span><span>:</span><span> </span><span>safety</span>
<span>        </span><span>select_list</span><span>:</span><span> </span><span>&#39;.js-message_text&#39;</span>
<span>        </span><span>value_template</span><span>:</span><span> </span><span>&gt;-</span>
<span>          </span><span>{% set message = value.split(&#34;|||&#34;) | last | lower %}</span>
<span>          </span><span>{{ &#34;зліт&#34; in message and &#34;бортів&#34; in message and &#34;ту-95&#34; in message }}</span>
<span>        </span><span>attributes</span><span>:</span>
<span>          </span><span>-</span><span> </span><span>name</span><span>:</span><span> </span><span>latest_message</span>
<span>            </span><span>select_list</span><span>:</span><span> </span><span>&#39;.js-message_text&#39;</span>
<span>            </span><span>value_template</span><span>:</span><span> </span><span>&#34;{{</span><span> </span><span>value.split(&#39;|||&#39;)</span><span> </span><span>|</span><span> </span><span>last</span><span> </span><span>}}&#34;</span>
</code></pre></div>
<p>So when the sensor turns on, it means the bombers are airborne and it&#39;s time to get ready. A notification is sent:</p>
<div><pre><span></span><code><span>alias</span><span>:</span><span> </span><span>&#39;Alert:</span><span> </span><span>Imminent</span><span> </span><span>Attack</span><span> </span><span>by</span><span> </span><span>Strategic</span><span> </span><span>Bombers&#39;</span>
<span>description</span><span>:</span>
<span>  </span><span>Send a notification when Tu-95 strategic bombers take off from Russian</span>
<span>  </span><span>airfields. This means an attack by cruise missiles is imminent. Prepare a hideout.</span>
<span>trigger</span><span>:</span>
<span>  </span><span>-</span><span> </span><span>platform</span><span>:</span><span> </span><span>state</span>
<span>    </span><span>entity_id</span><span>:</span>
<span>      </span><span>-</span><span> </span><span>binary_sensor.imminent_attack_in_war_monitor</span>
<span>      </span><span>-</span><span> </span><span>binary_sensor.imminent_attack_in_operinform</span>
<span>    </span><span>from</span><span>:</span><span> </span><span>&#39;off&#39;</span>
<span>    </span><span>to</span><span>:</span><span> </span><span>&#39;on&#39;</span>
<span>action</span><span>:</span>
<span>  </span><span>-</span><span> </span><span>service</span><span>:</span><span> </span><span>script.announcement</span>
<span>    </span><span>data</span><span>:</span>
<span>      </span><span>service</span><span>:</span><span> </span><span>notify.all</span>
<span>      </span><span>speak</span><span>:</span><span> </span><span>false</span>
<span>      </span><span>notify</span><span>:</span><span> </span><span>true</span>
<span>      </span><span>title</span><span>:</span><span> </span><span>&#39;Bombers</span><span> </span><span>take</span><span> </span><span>off</span><span> </span><span>🛫&#39;</span>
<span>      </span><span>messages</span><span>:</span>
<span>        </span><span>-</span><span> </span><span>&#39;{{</span><span> </span><span>trigger.to_state.attributes.latest_message</span><span> </span><span>}}&#39;</span>
</code></pre></div>
<h2 id="direct-danger-alert">Direct Danger Alert<a href="#direct-danger-alert" title="Permanent link">¶</a></h2>
<p>This is the most interesting sensor, which notifies me right when there&#39;s a direct threat to my location.</p>
<figure>
<img alt="Direct danger notification" src="https://github.com/denysdovhan/home-assistant-config/assets/3459374/05f1821c-89f5-474e-bf95-fffb3ea459d8"/>
<figcaption>Notification about direct danger</figcaption>
</figure>
<p>When an attack happens at night, you need to decide:</p>
<ul>
<li>Are you going to the shelter to get a sleepless night somewhere in a basement or in the subway?</li>
<li>Or are you going to stay in bed as long as possible to get some sleep, because you need to go to work tomorrow?</li>
</ul>
<p>Every normal person would go to the shelter. But when you live in these conditions for some time, you try to calculate the risk:</p>
<ul>
<li>You need to get proper sleep to be able to work.</li>
<li>The air defenses are titans; they do their job excellently. Flying threats are getting shot down regularly.</li>
<li>In Kyiv, the risk of a direct hit or hit by debris is relatively tolerable: I guess like being hit by a car (this estimate is completely unscientific!).</li>
<li>If you are unlucky to catch a direct hit – you are dead anyway. There&#39;s very little chance to survive that.</li>
<li>If the missile/drone gets shot down nearby, the shockwave will blow your windows.</li>
</ul>
<p>So what do you do? It&#39;s up to you, but most of the time, I decide to sleep in bed. When things get hot, I hide in a bathroom so that when something blows up nearby, <a href="https://visitukraine.today/blog/990/list-of-things-to-put-in-an-emergency-suitcase-and-basic-rules-that-will-save-lives-during-missile-strikes">I will be behind two walls</a> from glass shards and shockwaves.</p>
<p>I have a sensor that watches for specific keywords like <em>&#34;Kyiv&#34;</em> or a neighborhood name, for <em>&#34;warning&#34; <strong>or</strong> &#34;be in a safe place&#34; <strong>or</strong> &#34;fast target&#34;</em>.</p>
<div><pre><span></span><code><span>multiscrape</span><span>:</span>
<span>  </span><span>-</span><span> </span><span>name</span><span>:</span><span> </span><span>War Monitor</span>
<span>    </span><span>resource</span><span>:</span><span> </span><span>https://t.me/s/war_monitor</span>
<span>    </span><span>scan_interval</span><span>:</span><span> </span><span>5</span>
<span>    </span><span>list_separator</span><span>:</span><span> </span><span>&#39;|||&#39;</span>
<span>    </span><span>binary_sensor</span><span>:</span>
<span>      </span><span>-</span><span> </span><span>unique_id</span><span>:</span><span> </span><span>danger_in_war_monitor</span>
<span>        </span><span>name</span><span>:</span><span> </span><span>Danger in War Monitor</span>
<span>        </span><span>icon</span><span>:</span><span> </span><span>mdi:rocket-launch</span>
<span>        </span><span>device_class</span><span>:</span><span> </span><span>safety</span>
<span>        </span><span>select_list</span><span>:</span><span> </span><span>&#39;.js-message_text&#39;</span>
<span>        </span><span>value_template</span><span>:</span><span> </span><span>&gt;-</span>
<span>          </span><span>{% set message = value.split(&#34;|||&#34;) | last | lower %}</span>
<span>          </span><span>{% set in_kyiv = &#34;київ&#34; in message or &#34;святошин&#34; in message %}</span>
<span>          </span><span>{% set danger_now = &#34;уважно&#34; in message</span>
<span>              </span><span>or &#34;швидкісна ціль&#34; in message</span>
<span>              </span><span>or &#34;подалі від зовнішніх стін&#34; in message</span>
<span>              </span><span>or &#34;безпечних місцях&#34; in message</span>
<span>          </span><span>%}</span>
<span>          </span><span>{{ danger_now and in_kyiv }}</span>
<span>        </span><span>attributes</span><span>:</span>
<span>          </span><span>-</span><span> </span><span>name</span><span>:</span><span> </span><span>latest_message</span>
<span>            </span><span>select_list</span><span>:</span><span> </span><span>&#39;.js-message_text&#39;</span>
<span>            </span><span>value_template</span><span>:</span><span> </span><span>&#34;{{</span><span> </span><span>value.split(&#39;|||&#39;)</span><span> </span><span>|</span><span> </span><span>last</span><span> </span><span>}}&#34;</span>
</code></pre></div>
<p>When this sensor turns on, it means there&#39;s a direct danger to me and I should hide immediately. I send a critical notification, speak a danger message on speakers, so I can quickly wake up and go to the hideout.</p>
<div><pre><span></span><code><span>alias</span><span>:</span><span> </span><span>&#39;Alert:</span><span> </span><span>Danger</span><span> </span><span>in</span><span> </span><span>Kyiv&#39;</span>
<span>description</span><span>:</span><span> </span><span>Danger of missile/drone strike in Kyiv RIGHT NOW. Critical alert to</span>
<span>  </span><span>hide immediately.</span>
<span>trigger</span><span>:</span>
<span>  </span><span>-</span><span> </span><span>platform</span><span>:</span><span> </span><span>state</span>
<span>    </span><span>entity_id</span><span>:</span>
<span>      </span><span>-</span><span> </span><span>binary_sensor.danger_in_war_monitor</span>
<span>      </span><span>-</span><span> </span><span>binary_sensor.danger_in_operinform</span>
<span>    </span><span>from</span><span>:</span><span> </span><span>&#39;off&#39;</span>
<span>    </span><span>to</span><span>:</span><span> </span><span>&#39;on&#39;</span>
<span>action</span><span>:</span>
<span>  </span><span>-</span><span> </span><span>alias</span><span>:</span><span> </span><span>Send a critical notification</span>
<span>    </span><span>service</span><span>:</span><span> </span><span>script.announcement</span>
<span>    </span><span>data</span><span>:</span>
<span>      </span><span>service</span><span>:</span><span> </span><span>notify.all</span>
<span>      </span><span>speak</span><span>:</span><span> </span><span>false</span>
<span>      </span><span>notify</span><span>:</span><span> </span><span>true</span>
<span>      </span><span>title</span><span>:</span><span> </span><span>Direct Danger ⚠️</span>
<span>      </span><span>messages</span><span>:</span>
<span>        </span><span>-</span><span> </span><span>&#39;{{</span><span> </span><span>trigger.to_state.attributes.latest_message</span><span> </span><span>}}&#39;</span>
<span>      </span><span>notify_data</span><span>:</span>
<span>        </span><span>group</span><span>:</span><span> </span><span>air-alerts</span>
<span>        </span><span>push</span><span>:</span>
<span>          </span><span>sound</span><span>:</span>
<span>            </span><span>name</span><span>:</span><span> </span><span>default</span>
<span>            </span><span>critical</span><span>:</span><span> </span><span>1</span>
<span>            </span><span>volume</span><span>:</span><span> </span><span>1</span>
<span>  </span><span>-</span><span> </span><span>variables</span><span>:</span>
<span>      </span><span>messages</span><span>:</span>
<span>        </span><span>-</span><span> </span><span>Увага! Пряма загроза удару!</span>
<span>        </span><span>-</span><span> </span><span>Увага загроза удару по Києву!</span>
<span>        </span><span>-</span><span> </span><span>Увага! Негайно перейдіть до сховку!</span>
<span>        </span><span>-</span><span> </span><span>Увага! Негайно сховайтесь!</span>
<span>        </span><span>-</span><span> </span><span>Увага! Пряма загроза!</span>
<span>        </span><span>-</span><span> </span><span>Увага! Негайно сховайтесь!</span>
<span>        </span><span>-</span><span> </span><span>Увага! Атака на Київ!</span>
<span>  </span><span>-</span><span> </span><span>service</span><span>:</span><span> </span><span>media_player.volume_set</span>
<span>    </span><span>entity_id</span><span>:</span>
<span>    </span><span>data</span><span>:</span>
<span>      </span><span>volume_level</span><span>:</span><span> </span><span>0.6</span>
<span>    </span><span>target</span><span>:</span>
<span>      </span><span>device_id</span><span>:</span><span> </span><span>media_player.bedroom_homepod</span>
<span>  </span><span>-</span><span> </span><span>alias</span><span>:</span><span> </span><span>Speak in Bedroom</span>
<span>    </span><span>service</span><span>:</span><span> </span><span>script.announcement</span>
<span>    </span><span>data</span><span>:</span>
<span>      </span><span>speak</span><span>:</span><span> </span><span>true</span>
<span>      </span><span>speaker</span><span>:</span><span> </span><span>media_player.bedroom_homepod</span>
<span>      </span><span>notify</span><span>:</span><span> </span><span>false</span>
<span>      </span><span>force_speak</span><span>:</span><span> </span><span>true</span>
<span>      </span><span>messages</span><span>:</span><span> </span><span>&#39;{{</span><span> </span><span>messages</span><span> </span><span>}}&#39;</span>
<span>  </span><span>-</span><span> </span><span>delay</span><span>:</span>
<span>      </span><span>hours</span><span>:</span><span> </span><span>2</span>
</code></pre></div>
</article>
</div>

</div>

</main>

</div></div>
  </body>
</html>
