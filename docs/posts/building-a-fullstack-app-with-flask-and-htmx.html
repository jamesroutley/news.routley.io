<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://codecapsules.io/docs/tutorials/build-flask-htmx-app/">Original</a>
    <h1>Building a fullstack app with Flask and HTMx</h1>
    
    <div id="readability-page-1" class="page"><div data-md-component="main">
        <div>
          
            
              
              
            
            
              
              
            
          
          <div data-md-component="content">
            <article>
              
                



<p><img alt="cover image" src="https://donnywinston.com/assets/tutorials/build-flask-htmx/flask-htmx-cover.png"/></p>
<p>[This tutorial explains how to build an application with Flask and HTMx. If you want to host an HTMx and Flask application on our PaaS, you can find a short deployment guide <a href="https://donnywinston.com/deployment/how-to-deploy-flask-htmx-application-to-production/">here</a> that uses the same project.]</p>
<p>Recent trends in the modern web saw single page frameworks like React.js and Angular take over traditional multipage websites, mainly due to the lack of interactivity offered by HTML. It is worth noting however, that single page applications (SPAs) brought this interactivity at the cost of added complexity. </p>
<p>This is where a new HTML extension called HTMx enters and shines. HTMx gives traditional HTML sites more interactivity while keeping things simple, as it allows you to make requests from any HTML element and not just <code>&lt;a&gt;</code> and <code>&lt;form&gt;</code> tags. But this is not HTMx’s only benefit. Other benefits include: </p>
<ul>
<li>Making it possible to perform partial page reloads in HTML</li>
<li>Support for PUT and DELETE methods in addition to GET and POST</li>
<li>Not being limited to click and submit event triggers only</li>
<li>Lightweight set up – no additional dependencies need to be installed to get it working</li>
</ul>
<p>In this tutorial, we’ll explore the benefits of HTMx by building a full stack application using Flask and HTMx. Our application will be a book recommendation app that supports CRUD functionality. The final app will look a bit like this:</p>
<p><img alt="Flask HTMx Application" src="https://donnywinston.com/assets/tutorials/build-flask-htmx/flask-htmx.png"/></p>
<h2 id="overview-and-requirements">Overview and Requirements</h2>
<p>After building our application, you’ll want to deploy it to production so you can show it to friends and family. You will therefore need the following to complete the tutorial:</p>
<ul>
<li>Git set up and installed, and a registered GitHub account</li>
<li>Python3 installed </li>
<li>An IDE or text editor of your choice</li>
</ul>
<h2 id="setting-up-the-project">Setting up the Project</h2>
<p>With all the requirements in place, we can go ahead and set up our project. Let’s start by creating the project folder and then we can set up a virtual environment within the project folder. </p>
<h3 id="create-project-folder">Create Project Folder</h3>
<p>Next, let’s create a folder to house our application’s source code. Run the commands below in the terminal to create the folder and navigate into it.</p>
<div><pre><span></span><code>mkdir flask-htmx
cd flask-htmx
</code></pre></div>
<p>From here onwards, the <code>flask-htmx</code> directory will be referred to as the project’s root folder.</p>
<h3 id="creating-a-virtual-environment">Creating a Virtual Environment</h3>
<p>A virtual environment allows you to isolate the packages required to develop Python applications from your computer system. We recommend you use a new virtual environment for every application you develop so as to not corrupt dependencies for other applications. </p>
<p>In the terminal run the following command to create a virtual environment within the project&#39;s root folder:</p>

<p>To activate the virtual environment, enter either of the following:</p>
<p><strong>MacOS</strong></p>

<p><strong>Windows</strong></p>

<p>After activating the virtual environment, the name <code>env</code> should appear in brackets on the leftmost part of your terminal in your current line. This signals that the activation was successful. </p>
<p><img alt="Virtual environmeent active" src="https://donnywinston.com/assets/tutorials/build-flask-htmx/venvactive.png"/></p>
<h3 id="installing-dependencies">Installing Dependencies</h3>
<p>We can now install our required packages to the virtual environment we activated in the previous step. Run the command below:</p>
<div><pre><span></span><code>pip3 install flask flask-sqlalchemy gunicorn
</code></pre></div>
<p>You might notice there’s no dependency for HTMx in our dependency list. This is because it will be added as a script tag inside the head of our HTML templates.</p>
<h3 id="initialize-an-empty-git-repository">Initialize an Empty Git Repository</h3>
<p>While in the project’s root folder, enter the command, <code>git init</code> to initialize a <code>git</code> repository. This will allow you to track changes to your app as you build it. </p>
<p>Create a <code>.gitignore</code> file and within the file add the line below:</p>

<p>This excludes the <code>env</code> folder from being tracked by git as we only want to track changes in our project files.</p>
<h3 id="linking-to-github">Linking to GitHub</h3>
<p>Head over to <a href="https://github.com/">GitHub</a> and create a new repository. Then in your project&#39;s root folder run the command below from the terminal replacing the <code>username</code> and <code>repository_name</code> with your own values from GitHub.</p>
<div><pre><span></span><code>git remote add origin git@github.com:username/repository_name.git
</code></pre></div>
<p>This will link your local repository to the one on GitHub.</p>
<h2 id="building-the-htmx-frontend">Building the HTMx Frontend</h2>
<p>With the setup complete, we can now begin building our app. We will start with the HTMx frontend, and for this you need to create an <code>app/templates</code> folder inside the project’s root folder.</p>
<p>Next, create an <code>index.html</code> file inside the <code>templates</code> folder, and populate it with the code below:</p>
<div><pre><span></span><code><span>&lt;!DOCTYPE html&gt;</span>
<span>&lt;</span><span>html</span> <span>lang</span><span>=</span><span>&#34;en&#34;</span><span>&gt;</span>
<span>&lt;</span><span>head</span><span>&gt;</span>
    <span>&lt;</span><span>title</span><span>&gt;</span>Flask HTMX ALPINE App<span>&lt;/</span><span>title</span><span>&gt;</span>
    <span>&lt;</span><span>link</span> <span>href</span><span>=</span><span>&#34;https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css&#34;</span> <span>rel</span><span>=</span><span>&#34;stylesheet&#34;</span>
        <span>integrity</span><span>=</span><span>&#34;sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1&#34;</span> <span>crossorigin</span><span>=</span><span>&#34;anonymous&#34;</span><span>&gt;</span>
    <span>&lt;!-- HTMX --&gt;</span>
    <span>&lt;</span><span>script</span> <span>src</span><span>=</span><span>&#34;https://unpkg.com/htmx.org@1.5.0&#34;</span><span>&gt;&lt;/</span><span>script</span><span>&gt;</span>
    <span>&lt;</span><span>style</span><span>&gt;</span><span></span>
<span>        </span><span>body</span><span>{</span><span></span>
<span>            </span><span>padding</span><span>:</span><span> </span><span>20</span><span>px</span><span>;</span><span></span>
<span>        </span><span>}</span><span></span>
<span>        </span><span>table</span><span> </span><span>{</span><span></span>
<span>            </span><span>font-family</span><span>:</span><span> </span><span>arial</span><span>,</span><span> </span><span>sans-serif</span><span>;</span><span></span>
<span>            </span><span>border-collapse</span><span>:</span><span> </span><span>collapse</span><span>;</span><span></span>
<span>            </span><span>width</span><span>:</span><span> </span><span>100</span><span>%</span><span>;</span><span></span>
<span>        </span><span>}</span><span></span>

<span>        </span><span>tr</span><span>.</span><span>htmx-swapping</span><span> </span><span>td</span><span> </span><span>{</span><span></span>
<span>            </span><span>opacity</span><span>:</span><span> </span><span>0</span><span>;</span><span></span>
<span>            </span><span>transition</span><span>:</span><span> </span><span>opacity</span><span> </span><span>0.5</span><span>s</span><span> </span><span>ease-out</span><span>;</span><span></span>
<span>        </span><span>}</span><span></span>

<span>        </span><span>td</span><span>,</span><span> </span><span>th</span><span> </span><span>{</span><span></span>
<span>            </span><span>border</span><span>:</span><span> </span><span>1</span><span>px</span><span> </span><span>solid</span><span> </span><span>#383737</span><span>;</span><span></span>
<span>            </span><span>text-align</span><span>:</span><span> </span><span>left</span><span>;</span><span></span>
<span>            </span><span>padding</span><span>:</span><span> </span><span>8</span><span>px</span><span>;</span><span></span>
<span>        </span><span>}</span><span></span>

<span>        </span><span>tr</span><span>:</span><span>nth-child</span><span>(</span><span>even</span><span>)</span><span> </span><span>{</span><span></span>
<span>            </span><span>background-color</span><span>:</span><span> </span><span>#dddddd</span><span>;</span><span></span>
<span>        </span><span>}</span><span></span>
<span>    </span><span>&lt;/</span><span>style</span><span>&gt;</span>
<span>&lt;/</span><span>head</span><span>&gt;</span>

<span>&lt;!-- Place &lt;body&gt; &lt;/body&gt; code here --&gt;</span>

<span>&lt;/</span><span>html</span><span>&gt;</span>
</code></pre></div>
<p>There’s not much going on in the code snippet above, except for line 5 and 8, which are responsible for loading Bootstrap and HTMx into our <code>index.html</code> page. This gives you the power to build an interactive page just by including the <code>&lt;script&gt;</code> tag that links to HTMx, without needing to install any <code>npm</code> packages like with most SPAs. This is how HTMx allows you to build more lightweight sites compared to SPA frameworks. </p>
<p>The code in between the <code>&lt;style&gt;</code> tag adds CSS to style our frontend to make it more visually appealing. Now let’s add code that will be rendered in the body tag of our page. Copy and paste the code below underneath the <code>&lt;/head&gt;</code> tag:</p>
<div><pre><span></span><code><span>&lt;</span><span>body</span><span>&gt;</span>
    <span>&lt;</span><span>h1</span><span>&gt;</span>Book Recommendations<span>&lt;/</span><span>h1</span><span>&gt;</span>
    <span>&lt;</span><span>form</span> <span>hx-post</span><span>=</span><span>&#34;/submit&#34;</span> <span>hx-swap</span><span>=</span><span>&#34;beforeend&#34;</span> <span>hx-target</span><span>=</span><span>&#34;#new-book&#34;</span> <span>class</span><span>=</span><span>&#34;mb-3&#34;</span><span>&gt;</span>
        <span>&lt;</span><span>input</span> <span>type</span><span>=</span><span>&#34;text&#34;</span> <span>placeholder</span><span>=</span><span>&#34;Book Title&#34;</span> <span>name</span><span>=</span><span>&#34;title&#34;</span> <span>class</span><span>=</span><span>&#34;form-control mb-3&#34;</span> <span>/&gt;</span>
        <span>&lt;</span><span>input</span> <span>type</span><span>=</span><span>&#34;text&#34;</span> <span>placeholder</span><span>=</span><span>&#34;Book Author&#34;</span> <span>name</span><span>=</span><span>&#34;author&#34;</span> <span>class</span><span>=</span><span>&#34;form-control mb-3&#34;</span> <span>/&gt;</span>
        <span>&lt;</span><span>button</span> <span>type</span><span>=</span><span>&#34;submit&#34;</span> <span>class</span><span>=</span><span>&#34;btn btn-primary&#34;</span><span>&gt;</span>Submit<span>&lt;/</span><span>button</span><span>&gt;</span>
    <span>&lt;/</span><span>form</span><span>&gt;</span>

    <span>&lt;</span><span>table</span> <span>class</span><span>=</span><span>&#34;table&#34;</span><span>&gt;</span>
        <span>&lt;</span><span>thead</span><span>&gt;</span>
          <span>&lt;</span><span>tr</span><span>&gt;</span>
            <span>&lt;</span><span>th</span> <span>scope</span><span>=</span><span>&#34;col&#34;</span><span>&gt;</span>Book Title<span>&lt;/</span><span>th</span><span>&gt;</span>
            <span>&lt;</span><span>th</span> <span>scope</span><span>=</span><span>&#34;col&#34;</span><span>&gt;</span>Book Author<span>&lt;/</span><span>th</span><span>&gt;</span>
          <span>&lt;/</span><span>tr</span><span>&gt;</span>
        <span>&lt;/</span><span>thead</span><span>&gt;</span>
        <span>&lt;</span><span>tbody</span> <span>id</span><span>=</span><span>&#34;new-book&#34;</span> <span>hx-target</span><span>=</span><span>&#34;closest tr&#34;</span> <span>hx-swap</span><span>=</span><span>&#34;outerHTML swap:0.5s&#34;</span><span>&gt;</span> 
            {%for book in books%}
            <span>&lt;</span><span>tr</span><span>&gt;</span>
                <span>&lt;</span><span>td</span><span>&gt;</span>{{book.Book.title}}<span>&lt;/</span><span>td</span><span>&gt;</span>
                <span>&lt;</span><span>td</span><span>&gt;</span>{{book.Author.name}}<span>&lt;/</span><span>td</span><span>&gt;</span>
                <span>&lt;</span><span>td</span><span>&gt;</span>
                    <span>&lt;</span><span>button</span> <span>class</span><span>=</span><span>&#34;btn btn-primary&#34;</span> 
                        <span>hx-get</span><span>=</span><span>&#34;/get-edit-form/{{book.Book.book_id}}&#34;</span><span>&gt;</span>
                        Edit Title
                    <span>&lt;/</span><span>button</span><span>&gt;</span>
                <span>&lt;/</span><span>td</span><span>&gt;</span>
                <span>&lt;</span><span>td</span><span>&gt;</span>
                    <span>&lt;</span><span>button</span> <span>hx-delete</span><span>=</span><span>&#34;/delete/{{book.Book.book_id}}&#34;</span> <span>class</span><span>=</span><span>&#34;btn btn-primary&#34;</span><span>&gt;</span>Delete<span>&lt;/</span><span>button</span><span>&gt;</span>
                <span>&lt;/</span><span>td</span><span>&gt;</span>
            <span>&lt;/</span><span>tr</span><span>&gt;</span>
            {%endfor%}
        <span>&lt;/</span><span>tbody</span><span>&gt;</span>
    <span>&lt;/</span><span>table</span><span>&gt;</span>
<span>&lt;/</span><span>body</span><span>&gt;</span>
</code></pre></div>
<p>There are a couple of attributes here that aren’t used in traditional HTML. Let’s go over them one by one:</p>
<ul>
<li>
<p><strong>hx-[http method]</strong> – Examples of this attribute include <strong><code>hx-post</code></strong>, <strong><code>hx-get</code></strong>, <strong><code>hx-put</code></strong> and <strong><code>hx-delete</code></strong>. This is the HTMx way of denoting what type of request should be sent on form submission or when a request firing event is triggered. These attributes accept the request route as an argument. In the case of our form, we use the <code>/submit</code> route, while the table buttons send requests to the <code>/delete</code> and <code>/get-edit-form</code> routes.</p>
</li>
<li>
<p><strong>hx-target</strong> – This attribute accepts the <code>id</code> of the element you want to update after a successful request or when an event is triggered. Take note of the preceding <code>#</code> that’s written before the <code>id</code> value. </p>
<ul>
<li>You might have noticed that we didn’t use an <code>id</code> value in the table, but used a value of <code>closest tr</code> instead. This swaps the closest table row with the HTML that’ll be returned by the request when an action is triggered. The closest row will always be the same row in which an event or request was triggered either by the “Edit Title” button or the “Delete” button. </li>
</ul>
</li>
<li>
<p><strong>hx-swap</strong> – The <a href="https://htmx.org/docs/#swapping">hx-swap</a> attribute allows you to specify how you want to partially reload the page or swap elements with new ones. It updates the UI in the section specified in the <code>hx-target</code> attribute.</p>
<ul>
<li>In our form, we used the <code>beforeend</code> value to tell HTMx that we want to append the result of the request after the last child in the target element, which is the table with <code>id=new-book</code>. </li>
<li>In the table however, we used the <code>outerHTML</code> value to denote that we want to swap the entire <code>&lt;tr&gt;</code> element with the returned content.</li>
<li>A full list of acceptable <code>hx-swap</code> values can be viewed <a href="https://htmx.org/docs/#swapping">here</a>.</li>
</ul>
</li>
</ul>
<h2 id="building-the-flask-backend">Building the Flask Backend</h2>
<p>We can now dive into building the backend of our app. Start by creating a <code>run.py</code> file in the project’s root folder and populate it with the code below:</p>
<div><pre><span></span><code><span>from</span> <span>app</span> <span>import</span> <span>app</span>

<span>if</span> <span>__name__</span> <span>==</span> <span>&#34;__main__&#34;</span><span>:</span>
    <span>app</span><span>.</span><span>run</span><span>()</span>
</code></pre></div>
<p>This is the point of entry for any server wishing to run our app.</p>
<h3 id="declare-and-initialize-app-module">Declare and Initialize <code>app</code> Module</h3>
<p>Create an <code>__init__.py</code> file in the <code>app</code> folder and populate it with the code below:</p>
<div><pre><span></span><code><span>from</span> <span>flask</span> <span>import</span> <span>Flask</span>
<span>from</span> <span>flask_sqlalchemy</span> <span>import</span> <span>SQLAlchemy</span>

<span>app</span> <span>=</span> <span>Flask</span><span>(</span><span>__name__</span><span>)</span>

<span>app</span><span>.</span><span>config</span><span>[</span><span>&#34;SQLALCHEMY_DATABASE_URI&#34;</span><span>]</span> <span>=</span> <span>&#39;sqlite:///sqlite.db&#39;</span>
<span>app</span><span>.</span><span>config</span><span>[</span><span>&#34;SQLALCHEMY_ECHO&#34;</span><span>]</span> <span>=</span> <span>False</span>
<span>app</span><span>.</span><span>config</span><span>[</span><span>&#34;SQLALCHEMY_TRACK_MODIFICATIONS&#34;</span><span>]</span> <span>=</span> <span>False</span>

<span>db</span> <span>=</span> <span>SQLAlchemy</span><span>(</span><span>app</span><span>)</span>

<span>from</span> <span>app</span> <span>import</span> <span>views</span>
<span>from</span> <span>app</span> <span>import</span> <span>models</span>

<span>db</span><span>.</span><span>init_app</span><span>(</span><span>app</span><span>)</span>
<span>db</span><span>.</span><span>create_all</span><span>()</span> 
</code></pre></div>
<p>Here we declare our app object using the Flask package we installed earlier. We’ll be using a SQLite database, which we configure using the <code>app.config</code> lines. </p>
<p>We use SQLAlchemy to declare the database object we’ll interact with, as it allows us to read and write to the database using object notation, which is more familiar than raw SQL statements. It is important to import the models only after declaring the db object so that their respective tables are included in the database when it’s created. The last two lines handle the initialization of the database and the creation of all relevant tables in the database based on the models that are imported. </p>
<h3 id="register-app-models">Register App Models</h3>
<p>The next step is to create the <code>models.py</code> module we imported earlier in the <code>__init__.py</code> file. Create a file named <code>models.py</code> inside the app folder and populate it with the code below:</p>
<div><pre><span></span><code><span>from</span> <span>app</span> <span>import</span> <span>db</span>

<span>class</span> <span>Author</span><span>(</span><span>db</span><span>.</span><span>Model</span><span>):</span>
    <span>author_id</span> <span>=</span> <span>db</span><span>.</span><span>Column</span><span>(</span><span>db</span><span>.</span><span>Integer</span><span>,</span> <span>primary_key</span><span>=</span><span>True</span><span>)</span>
    <span>name</span> <span>=</span> <span>db</span><span>.</span><span>Column</span><span>(</span><span>db</span><span>.</span><span>String</span><span>)</span>
    <span>books</span> <span>=</span> <span>db</span><span>.</span><span>relationship</span><span>(</span><span>&#34;Book&#34;</span><span>,</span> <span>backref</span><span>=</span><span>&#34;author&#34;</span><span>)</span>

    <span>def</span> <span>__repr__</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>&#39;&lt;Author: </span><span>{}</span><span>&gt;&#39;</span><span>.</span><span>format</span><span>(</span><span>self</span><span>.</span><span>books</span><span>)</span>

<span>class</span> <span>Book</span><span>(</span><span>db</span><span>.</span><span>Model</span><span>):</span>
    <span>book_id</span> <span>=</span> <span>db</span><span>.</span><span>Column</span><span>(</span><span>db</span><span>.</span><span>Integer</span><span>,</span> <span>primary_key</span><span>=</span><span>True</span><span>)</span>
    <span>author_id</span> <span>=</span> <span>db</span><span>.</span><span>Column</span><span>(</span><span>db</span><span>.</span><span>Integer</span><span>,</span> <span>db</span><span>.</span><span>ForeignKey</span><span>(</span><span>&#34;author.author_id&#34;</span><span>))</span>
    <span>title</span> <span>=</span> <span>db</span><span>.</span><span>Column</span><span>(</span><span>db</span><span>.</span><span>String</span><span>)</span>
</code></pre></div>
<p>Here we declare the two models we’re going to be saving in our database, which are <code>Author</code> and <code>Book</code>. It is worth noting the one-to-many relationship between an Author and Books, as an Author can have many Books but each Book can only have a single Author in the context of this application. We denote this relationship by using a foreign key in the <code>author_id</code> field of the Book and a <code>backref</code> in the books field of an Author.</p>
<h3 id="create-views">Create Views</h3>
<p>The last part in building the backend of our app is to create the views or routes that the frontend will be interacting with. Create a <code>views.py</code> file inside the app folder and add the code below to it:</p>
<div><pre><span></span><code><span>from</span> <span>app</span> <span>import</span> <span>app</span><span>,</span> <span>db</span>
<span>from</span> <span>flask</span> <span>import</span> <span>render_template</span><span>,</span> <span>request</span><span>,</span> <span>jsonify</span>
<span>from</span> <span>app.models</span> <span>import</span> <span>Author</span><span>,</span> <span>Book</span>

<span>@app</span><span>.</span><span>route</span><span>(</span><span>&#34;/&#34;</span><span>,</span> <span>methods</span><span>=</span><span>[</span><span>&#34;GET&#34;</span><span>])</span>
<span>def</span> <span>home</span><span>():</span>
    <span>books</span> <span>=</span> <span>db</span><span>.</span><span>session</span><span>.</span><span>query</span><span>(</span><span>Book</span><span>,</span> <span>Author</span><span>)</span><span>.</span><span>filter</span><span>(</span><span>Book</span><span>.</span><span>author_id</span> <span>==</span> <span>Author</span><span>.</span><span>author_id</span><span>)</span><span>.</span><span>all</span><span>()</span>
    <span>return</span> <span>render_template</span><span>(</span><span>&#34;index.html&#34;</span><span>,</span> <span>books</span><span>=</span><span>books</span><span>)</span>
</code></pre></div>
<p>In the code snippet above, we’ve added the index route and bound the home function to it. The home function first queries the database to get a list of all books before returning the <code>index.html</code> template that’s populated with the list of books. </p>
<p>Add the code below to add the <code>/submit</code> route to our app’s <code>views.py</code> file. </p>
<div><pre><span></span><code><span>@app</span><span>.</span><span>route</span><span>(</span><span>&#34;/submit&#34;</span><span>,</span> <span>methods</span><span>=</span><span>[</span><span>&#34;POST&#34;</span><span>])</span>
<span>def</span> <span>submit</span><span>():</span>
    <span>global_book_object</span> <span>=</span> <span>Book</span><span>()</span>

    <span>title</span> <span>=</span> <span>request</span><span>.</span><span>form</span><span>[</span><span>&#34;title&#34;</span><span>]</span>
    <span>author_name</span> <span>=</span> <span>request</span><span>.</span><span>form</span><span>[</span><span>&#34;author&#34;</span><span>]</span>

    <span>author_exists</span> <span>=</span> <span>db</span><span>.</span><span>session</span><span>.</span><span>query</span><span>(</span><span>Author</span><span>)</span><span>.</span><span>filter</span><span>(</span><span>Author</span><span>.</span><span>name</span> <span>==</span> <span>author_name</span><span>)</span><span>.</span><span>first</span><span>()</span>
    <span>print</span><span>(</span><span>author_exists</span><span>)</span>
    <span># check if author already exists in db</span>
    <span>if</span> <span>author_exists</span><span>:</span>
        <span>author_id</span> <span>=</span> <span>author_exists</span><span>.</span><span>author_id</span>
        <span>book</span> <span>=</span> <span>Book</span><span>(</span><span>author_id</span><span>=</span><span>author_id</span><span>,</span> <span>title</span><span>=</span><span>title</span><span>)</span>
        <span>db</span><span>.</span><span>session</span><span>.</span><span>add</span><span>(</span><span>book</span><span>)</span>
        <span>db</span><span>.</span><span>session</span><span>.</span><span>commit</span><span>()</span>
        <span>global_book_object</span> <span>=</span> <span>book</span>
    <span>else</span><span>:</span>
        <span>author</span> <span>=</span> <span>Author</span><span>(</span><span>name</span><span>=</span><span>author_name</span><span>)</span>
        <span>db</span><span>.</span><span>session</span><span>.</span><span>add</span><span>(</span><span>author</span><span>)</span>
        <span>db</span><span>.</span><span>session</span><span>.</span><span>commit</span><span>()</span>

        <span>book</span> <span>=</span> <span>Book</span><span>(</span><span>author_id</span><span>=</span><span>author</span><span>.</span><span>author_id</span><span>,</span> <span>title</span><span>=</span><span>title</span><span>)</span>
        <span>db</span><span>.</span><span>session</span><span>.</span><span>add</span><span>(</span><span>book</span><span>)</span>
        <span>db</span><span>.</span><span>session</span><span>.</span><span>commit</span><span>()</span>
        <span>global_book_object</span> <span>=</span> <span>book</span>

    <span>response</span> <span>=</span> <span>f</span><span>&#34;&#34;&#34;</span>
<span>    &lt;tr&gt;</span>
<span>        &lt;td&gt;</span><span>{</span><span>title</span><span>}</span><span>&lt;/td&gt;</span>
<span>        &lt;td&gt;</span><span>{</span><span>author_name</span><span>}</span><span>&lt;/td&gt;</span>
<span>        &lt;td&gt;</span>
<span>            &lt;button class=&#34;btn btn-primary&#34;</span>
<span>                hx-get=&#34;/get-edit-form/</span><span>{</span><span>global_book_object</span><span>.</span><span>book_id</span><span>}</span><span>&#34;&gt;</span>
<span>                Edit Title</span>
<span>            &lt;/button&gt;</span>
<span>        &lt;/td&gt;</span>
<span>        &lt;td&gt;</span>
<span>            &lt;button hx-delete=&#34;/delete/</span><span>{</span><span>global_book_object</span><span>.</span><span>book_id</span><span>}</span><span>&#34;</span>
<span>                class=&#34;btn btn-primary&#34;&gt;</span>
<span>                Delete</span>
<span>            &lt;/button&gt;</span>
<span>        &lt;/td&gt;</span>
<span>    &lt;/tr&gt;</span>
<span>    &#34;&#34;&#34;</span>
    <span>return</span> <span>response</span>
</code></pre></div>
<p>When a person submits a new book, this is the route that’s called. The logic first checks if the author already exists in the database and if so, saves the book with the author’s <code>author_id</code>. Otherwise it creates a new author and then saves the book. As HTMx expects an HTML response, the submit method responds with an HTML table row that updates the list of books on the frontend. The new entry will be for the recently added book. </p>
<p>Next, let’s add the code for the <code>/delete</code> route. Copy and paste the code below:</p>
<div><pre><span></span><code><span>@app</span><span>.</span><span>route</span><span>(</span><span>&#34;/delete/&lt;int:id&gt;&#34;</span><span>,</span> <span>methods</span><span>=</span><span>[</span><span>&#34;DELETE&#34;</span><span>])</span>
<span>def</span> <span>delete_book</span><span>(</span><span>id</span><span>):</span>
    <span>book</span> <span>=</span> <span>Book</span><span>.</span><span>query</span><span>.</span><span>get</span><span>(</span><span>id</span><span>)</span>
    <span>db</span><span>.</span><span>session</span><span>.</span><span>delete</span><span>(</span><span>book</span><span>)</span>
    <span>db</span><span>.</span><span>session</span><span>.</span><span>commit</span><span>()</span>

    <span>return</span> <span>&#34;&#34;</span>
</code></pre></div>
<p>The first thing you may have noticed about this route is the <code>id</code> query parameter it accepts. This allows us to know which object to delete. After deleting the book, we return an empty string, which causes the row we deleted in the frontend to disappear, as it is swapped for “nothing”. </p>
<p>We now have routes for creating, reading, and deleting books. It’s time to add views associated with updating book entries in order to complete our app’s CRUD functionality. Add the code below to <code>views.py</code> to add logic for updating book entries to your app:</p>
<div><pre><span></span><code><span>@app</span><span>.</span><span>route</span><span>(</span><span>&#34;/get-edit-form/&lt;int:id&gt;&#34;</span><span>,</span> <span>methods</span><span>=</span><span>[</span><span>&#34;GET&#34;</span><span>])</span>
<span>def</span> <span>get_edit_form</span><span>(</span><span>id</span><span>):</span>
    <span>book</span> <span>=</span> <span>Book</span><span>.</span><span>query</span><span>.</span><span>get</span><span>(</span><span>id</span><span>)</span>
    <span>author</span> <span>=</span> <span>Author</span><span>.</span><span>query</span><span>.</span><span>get</span><span>(</span><span>book</span><span>.</span><span>author_id</span><span>)</span>

    <span>response</span> <span>=</span> <span>f</span><span>&#34;&#34;&#34;</span>
<span>    &lt;tr hx-trigger=&#39;cancel&#39; class=&#39;editing&#39; hx-get=&#34;/get-book-row/</span><span>{</span><span>id</span><span>}</span><span>&#34;&gt;</span>
<span>  &lt;td&gt;&lt;input name=&#34;title&#34; value=&#34;</span><span>{</span><span>book</span><span>.</span><span>title</span><span>}</span><span>&#34;/&gt;&lt;/td&gt;</span>
<span>  &lt;td&gt;</span><span>{</span><span>author</span><span>.</span><span>name</span><span>}</span><span>&lt;/td&gt;</span>
<span>  &lt;td&gt;</span>
<span>    &lt;button class=&#34;btn btn-primary&#34; hx-get=&#34;/get-book-row/</span><span>{</span><span>id</span><span>}</span><span>&#34;&gt;</span>
<span>      Cancel</span>
<span>    &lt;/button&gt;</span>
<span>    &lt;button class=&#34;btn btn-primary&#34; hx-put=&#34;/update/</span><span>{</span><span>id</span><span>}</span><span>&#34; hx-include=&#34;closest tr&#34;&gt;</span>
<span>      Save</span>
<span>    &lt;/button&gt;</span>
<span>  &lt;/td&gt;</span>
<span>    &lt;/tr&gt;</span>
<span>    &#34;&#34;&#34;</span>
    <span>return</span> <span>response</span>

<span>@app</span><span>.</span><span>route</span><span>(</span><span>&#34;/get-book-row/&lt;int:id&gt;&#34;</span><span>,</span> <span>methods</span><span>=</span><span>[</span><span>&#34;GET&#34;</span><span>])</span>
<span>def</span> <span>get_book_row</span><span>(</span><span>id</span><span>):</span>
    <span>book</span> <span>=</span> <span>Book</span><span>.</span><span>query</span><span>.</span><span>get</span><span>(</span><span>id</span><span>)</span>
    <span>author</span> <span>=</span> <span>Author</span><span>.</span><span>query</span><span>.</span><span>get</span><span>(</span><span>book</span><span>.</span><span>author_id</span><span>)</span>

    <span>response</span> <span>=</span> <span>f</span><span>&#34;&#34;&#34;</span>
<span>    &lt;tr&gt;</span>
<span>        &lt;td&gt;</span><span>{</span><span>book</span><span>.</span><span>title</span><span>}</span><span>&lt;/td&gt;</span>
<span>        &lt;td&gt;</span><span>{</span><span>author</span><span>.</span><span>name</span><span>}</span><span>&lt;/td&gt;</span>
<span>        &lt;td&gt;</span>
<span>            &lt;button class=&#34;btn btn-primary&#34;</span>
<span>                hx-get=&#34;/get-edit-form/</span><span>{</span><span>id</span><span>}</span><span>&#34;&gt;</span>
<span>                Edit Title</span>
<span>            &lt;/button&gt;</span>
<span>        &lt;/td&gt;</span>
<span>        &lt;td&gt;</span>
<span>            &lt;button hx-delete=&#34;/delete/</span><span>{</span><span>id</span><span>}</span><span>&#34;</span>
<span>                class=&#34;btn btn-primary&#34;&gt;</span>
<span>                Delete</span>
<span>            &lt;/button&gt;</span>
<span>        &lt;/td&gt;</span>
<span>    &lt;/tr&gt;</span>
<span>    &#34;&#34;&#34;</span>
    <span>return</span> <span>response</span>

<span>@app</span><span>.</span><span>route</span><span>(</span><span>&#34;/update/&lt;int:id&gt;&#34;</span><span>,</span> <span>methods</span><span>=</span><span>[</span><span>&#34;PUT&#34;</span><span>])</span>
<span>def</span> <span>update_book</span><span>(</span><span>id</span><span>):</span>
    <span>db</span><span>.</span><span>session</span><span>.</span><span>query</span><span>(</span><span>Book</span><span>)</span><span>.</span><span>filter</span><span>(</span><span>Book</span><span>.</span><span>book_id</span> <span>==</span> <span>id</span><span>)</span><span>.</span><span>update</span><span>({</span><span>&#34;title&#34;</span><span>:</span> <span>request</span><span>.</span><span>form</span><span>[</span><span>&#34;title&#34;</span><span>]})</span>
    <span>db</span><span>.</span><span>session</span><span>.</span><span>commit</span><span>()</span>

    <span>title</span> <span>=</span> <span>request</span><span>.</span><span>form</span><span>[</span><span>&#34;title&#34;</span><span>]</span>
    <span>book</span> <span>=</span> <span>Book</span><span>.</span><span>query</span><span>.</span><span>get</span><span>(</span><span>id</span><span>)</span>
    <span>author</span> <span>=</span> <span>Author</span><span>.</span><span>query</span><span>.</span><span>get</span><span>(</span><span>book</span><span>.</span><span>author_id</span><span>)</span>

    <span>response</span> <span>=</span> <span>f</span><span>&#34;&#34;&#34;</span>
<span>    &lt;tr&gt;</span>
<span>        &lt;td&gt;</span><span>{</span><span>title</span><span>}</span><span>&lt;/td&gt;</span>
<span>        &lt;td&gt;</span><span>{</span><span>author</span><span>.</span><span>name</span><span>}</span><span>&lt;/td&gt;</span>
<span>        &lt;td&gt;</span>
<span>            &lt;button class=&#34;btn btn-primary&#34;</span>
<span>                hx-get=&#34;/get-edit-form/</span><span>{</span><span>id</span><span>}</span><span>&#34;&gt;</span>
<span>                Edit Title</span>
<span>            &lt;/button&gt;</span>
<span>        &lt;/td&gt;</span>
<span>        &lt;td&gt;</span>
<span>            &lt;button hx-delete=&#34;/delete/</span><span>{</span><span>id</span><span>}</span><span>&#34;</span>
<span>                class=&#34;btn btn-primary&#34;&gt;</span>
<span>                Delete</span>
<span>            &lt;/button&gt;</span>
<span>        &lt;/td&gt;</span>
<span>    &lt;/tr&gt;</span>
<span>    &#34;&#34;&#34;</span>
    <span>return</span> <span>response</span>
</code></pre></div>
<p>There’s more than one view for the update logic, and we’ll see why shortly. The <code>/get-edit-form</code> route is called when a user clicks on the “Edit Title” button on the frontend, and it returns a form for updating the selected book. If the user decides to cancel this action, the <code>/get-book-row</code> route is called and it returns a table row with the unedited book entry. </p>
<p>If the user goes through with updating the book title, then the <code>/update</code> route is called. The <code>update_book</code> function that’s bound to the <code>/update</code> route will update the book title based on the <code>id</code> supplied to it as a query parameter. When the update is complete, the method returns an HTML table row with the updated book title.</p>
<h2 id="running-our-app">Running our App</h2>
<p>Our app is ready to be tested. Navigate to the project’s root folder in a terminal and run the following command: <code>python3 run.py</code>. This should start up a development server on port 5000. Open your browser at <code>http://127.0.0.1:5000/</code> and you should see your app running:</p>
<p><img alt="Flask HTMx Application" src="https://donnywinston.com/assets/tutorials/build-flask-htmx/flask-htmx.png"/></p>
<p>Once you are satisfied with the app, you can commit and push your changes to GitHub with the following commands.</p>
<div><pre><span></span><code>git add . 
git commit -m <span>&#39;commit message&#39;</span>
git push origin
</code></pre></div>
<p>We’ve shown you how to build a full stack Flask HTMx application from scratch and you should be able to deploy this basic version, but you may like to consider adding more functionality to enhance our app’s features. We recommend you check out <a href="https://alpinejs.dev/">Alpine.js</a>, a lightweight JavaScript framework that works well with <code>HTMx</code> to make sites that are more powerful yet still lightweight. </p>
<p>You can find the complete code shown above in <a href="https://github.com/codecapsules-io/demo-flask-htmx">this GitHub repository</a>.</p>

  



  


              
            </article>
            
          </div>
        </div>
        
      </div></div>
  </body>
</html>
