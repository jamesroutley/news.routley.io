<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sql-flow.com/docs/tutorials/intro/">Original</a>
    <h1>Show HN: DuckDB for Kafka Stream Processing</h1>
    
    <div id="readability-page-1" class="page"><div><header></header>
<p>Create a stream processor that reads data from Kafka <strong>in less than 5 minutes</strong>.</p>
<h2 id="getting-started">Getting Started<a href="#getting-started" aria-label="Direct link to Getting Started" title="Direct link to Getting Started">​</a></h2>
<p>Get started by <strong>running a stream processor that executes SQL against a kafka stream and writes the output to the console</strong>.</p>
<h3 id="what-youll-need">What you&#39;ll need<a href="#what-youll-need" aria-label="Direct link to What you&#39;ll need" title="Direct link to What you&#39;ll need">​</a></h3>
<ul>
<li>Docker</li>
<li>A copy of turbolytics/sql-flow cloned on your local machine (<a href="https://github.com/turbolytics/sql-flow" target="_blank" rel="noopener noreferrer">https://github.com/turbolytics/sql-flow</a>)</li>
<li>turbolytics/sql-flow Python dependencies installed</li>
</ul>
<div><div><pre tabindex="0"><code><span><span>cd path/to/turbolytics/sql-flow/github/repo &amp;&amp; pip install -r requirements.txt</span><br/></span></code></pre></div></div>
<ul>
<li>The turbolytics/sql-flow docker image</li>
</ul>
<div><div><pre tabindex="0"><code><span><span>docker pull turbolytics/sql-flow:latest</span><br/></span></code></pre></div></div>
<ul>
<li>Kafka running on your local machine</li>
</ul>
<div><div><pre tabindex="0"><code><span><span>cd path/to/turbolytics/sql-flow/github/repo &amp;&amp; docker-compose -f dev/kafka-single.yml up -d</span><br/></span></code></pre></div></div>
<h2 id="test-the-sqlflow-configuration-file">Test the SQLFlow configuration file<a href="#test-the-sqlflow-configuration-file" aria-label="Direct link to Test the SQLFlow configuration file" title="Direct link to Test the SQLFlow configuration file">​</a></h2>
<p>SQLFlow ships with cli support to test a stream configuration against any fixture file of test data. The goal is to support testing and linting of a configuration file before executing in a stream environment.</p>
<p>Run the invoke command to test the configuration file against a set of test data:</p>
<div><div><pre tabindex="0"><code><span><span>docker run -v $(pwd)/dev:/tmp/conf -v /tmp/sqlflow:/tmp/sqlflow turbolytics/sql-flow:latest dev invoke /tmp/conf/config/examples/basic.agg.mem.yml /tmp/conf/fixtures/simple.json</span><br/></span></code></pre></div></div>
<p>The following output should show:</p>
<div><div><pre tabindex="0"><code><span><span>[{&#39;city&#39;: &#39;New York&#39;, &#39;city_count&#39;: 28672}, {&#39;city&#39;: &#39;Baltimore&#39;, &#39;city_count&#39;: 28672}]</span><br/></span></code></pre></div></div>
<h2 id="run-sqlflow-against-a-kafka-stream">Run SQLFlow against a Kafka stream<a href="#run-sqlflow-against-a-kafka-stream" aria-label="Direct link to Run SQLFlow against a Kafka stream" title="Direct link to Run SQLFlow against a Kafka stream">​</a></h2>
<p>This section runs SQLFlow as a stream processor that reads data from a Kafka topic and writes the output to the console. SQLFow runs as a daemon and will continuously read data from kafka, execute the SQL and write the output to the console.</p>
<ul>
<li>Publish test messages to the Kafka topic</li>
</ul>
<div><div><pre tabindex="0"><code><span><span>python3 cmd/publish-test-data.py --num-messages=10000 --topic=&#34;input-simple-agg-mem&#34;</span><br/></span></code></pre></div></div>
<ul>
<li>Start the Kafka Console Consumer, to view the SQLFlow output</li>
</ul>
<div><div><pre tabindex="0"><code><span><span>docker exec -it kafka1 kafka-console-consumer --bootstrap-server=kafka1:9092 --topic=output-simple-agg-mem</span><br/></span></code></pre></div></div>
<ul>
<li>Start SQLFlow</li>
</ul>
<div><div><pre tabindex="0"><code><span><span>docker run -v $(pwd)/dev:/tmp/conf -v /tmp/sqlflow:/tmp/sqlflow -e SQLFLOW_KAFKA_BROKERS=host.docker.internal:29092 turbolytics/sql-flow:latest run /tmp/conf/config/examples/basic.agg.mem.yml --max-msgs-to-process=10000</span><br/></span></code></pre></div></div>
<p>The following output should begin to show in the kafka console consumer:</p>
<div><div><pre tabindex="0"><code><span><span>...</span><br/></span><span><span>...</span><br/></span><span><span>{&#34;city&#34;:&#34;San Francisco504&#34;,&#34;city_count&#34;:1}</span><br/></span><span><span>{&#34;city&#34;:&#34;San Francisco735&#34;,&#34;city_count&#34;:1}</span><br/></span><span><span>{&#34;city&#34;:&#34;San Francisco533&#34;,&#34;city_count&#34;:1}</span><br/></span><span><span>{&#34;city&#34;:&#34;San Francisco556&#34;,&#34;city_count&#34;:1}</span><br/></span><span><span>...</span><br/></span></code></pre></div></div></div></div>
  </body>
</html>
