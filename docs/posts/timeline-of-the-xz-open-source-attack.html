<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://research.swtch.com/xz-timeline">Original</a>
    <h1>Timeline of the xz open source attack</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div>
        
        

<p>
Over a period of over two years, an attacker using the name “Jia Tan”
worked as a diligent, effective contributor to the xz compression library,
eventually being granted commit access and maintainership.
Using that access, they installed a very subtle, carefully hidden backdoor into liblzma,
a part of xz that also happens to be a dependency of OpenSSH sshd
on Debian, Ubuntu, Fedora, and other systemd-based Linux systems.
That backdoor watches for the attacker sending hidden commands at the start of an SSH session,
giving the attacker the ability to run an arbitrary command on the target system without logging in:
unauthenticated, targeted remote code execution.

</p><p>
The attack was <a href="https://www.openwall.com/lists/oss-security/2024/03/29/4">publicly disclosed on March 29, 2024</a> and
appears to be the first serious known supply chain attack on widely used open source software.
It marks a watershed moment in open source supply chain security, for better or worse.

</p><p>
This post is a detailed timeline that I have constructed of the
social engineering aspect of the attack, which appears to date
back to late 2021.
Key events have bold times.

</p><p>
Corrections or additions welcome on <a href="https://bsky.app/profile/swtch.com/post/3kp4my7wdom2q">Bluesky</a>, <a href="https://hachyderm.io/@rsc/112199506755478946">Mastodon</a>, or <a href="mailto:rsc@swtch.com">email</a>.
<a href="#prologue"></a></p><h2 id="prologue"><a href="#prologue">Prologue</a></h2>


<p>
<b>2005–2008</b>: <a href="https://github.com/kobolabs/liblzma/blob/87b7682ce4b1c849504e2b3641cebaad62aaef87/doc/history.txt">Lasse Collin, with help from others</a>, designs the .xz file format using the LZMA compression algorithm, which compresses files to about 70% of what gzip did [1]. Over time this format becomes widely used for compressing tar files, Linux kernel images, and many other uses.
<a href="#jia_tan_arrives_on_scene_with_supporting_cast"></a></p><h2 id="jia_tan_arrives_on_scene_with_supporting_cast"><a href="#jia_tan_arrives_on_scene_with_supporting_cast">Jia Tan arrives on scene, with supporting cast</a></h2>


<p>
<b>2021-10-29</b>: Jia Tan sends <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00512.html">first, innocuous patch</a> to the xz-devel mailing list, adding “.editorconfig” file.

</p><p>
<b>2021-11-29</b>: Jia Tan sends <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00519.html">second innocuous patch</a> to the xz-devel mailing list, fixing an apparent reproducible build problem. More patches that seem (even in retrospect) to be fine follow.

</p><p>
<b>2022-04-19</b>: Jia Tan sends <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00553.html">yet another innocuous patch</a> to the xz-devel mailing list.

</p><p>
<b>2022-04-22</b>: “Jigar Kumar” sends <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00557.html">first of a few emails</a> complaining about Jia Tan’s patch not landing. (“Patches spend years on this mailing list. There is no reason to think anything is coming soon.”) At this point, Lasse Collin has already landed four of Jia Tan’s patches, marked by “Thanks to Jia Tan” in the commit message.

</p><p>
<b>2022-05-19</b>: “Dennis Ens” sends <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00562.html">mail to xz-devel</a> asking if XZ for Java is maintained.

</p><p>
<b>2022-05-19</b>: Lasse Collin <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00563.html">replies</a> apologizing for slowness and adds “Jia Tan has helped me off-list with XZ Utils and he might have a bigger role in the future at least with XZ Utils. It&#39;s clear that my resources are too limited (thus the many emails waiting for replies) so something has to change in the long term.”

</p><p>
<b>2022-05-27</b>: Jigar Kumar sends <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00565.html">pressure email</a> to patch thread. “Over 1 month and no closer to being merged. Not a surprise.”

</p><p>
<b>2022-06-07</b>: Jigar Kumar sends <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00566.html">pressure email</a> to Java thread. “Progress will not happen until there is new maintainer. XZ for C has sparse commit log too. Dennis you are better off waiting until new maintainer happens or fork yourself. Submitting patches here has no purpose these days. The current maintainer lost interest or doesn&#39;t care to maintain anymore. It is sad to see for a repo like this.”

</p><p>
<b>2022-06-08</b>: Lasse Collin <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00567.html">pushes back</a>. “I haven&#39;t lost interest but my ability to care has been fairly limited mostly due to longterm mental health issues but also due to some other things. Recently I&#39;ve worked off-list a bit with Jia Tan on XZ Utils and perhaps he will have a bigger role in the future, we&#39;ll see. It&#39;s also good to keep in mind that this is an unpaid hobby project.”

</p><p>
<b>2022-06-10</b>: Lasse Collin merges <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=aa75c5563a760aea3aa23d997d519e702e82726b">first commit with Jia Tan as author in git metadata</a> (“Tests: Created tests for hardware functions”).

</p><p>
<b>2022-06-14</b>: Jugar Kumar sends <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00568.html">pressure email</a>. “With your current rate, I very doubt to see 5.4.0 release this year. The only progress since april has been small changes to test code. You ignore the many  patches bit rotting away on this mailing list. Right now you choke your repo. Why wait until 5.4.0 to change maintainer? Why delay what your repo needs?”

</p><p>
<b>2022-06-21</b>: Dennis Ens sends <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00569.html">pressure email</a>. “I am sorry about your mental health issues, but its important to be aware of your own limits. I get that this is a hobby project for all contributors, but the community desires more. Why not pass on maintainership for XZ for C so you can give XZ for Java more attention? Or pass on XZ for Java to someone else to focus on XZ for C? Trying to maintain both means that neither are maintained well.”

</p><p>
<b>2022-06-21</b>: Lasse Collin <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00571.html">replies</a>: “As I have hinted in earlier emails, Jia Tan may have a bigger role in the project in the future. He has been helping a lot off-list and is practically a co-maintainer already. :-) I know that not much has happened in the git repository yet but things happen in small steps. In any case some change in maintainership is already in progress at least for XZ Utils.”

</p><p>
<b>2022-06-22</b>: Jigar Kumar sends <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00570.html">pressure email</a> to C patch thread. “Is there any progress on this? Jia I see you have recent commits. Why can&#39;t you commit this yourself?”
<a href="#jia_tan_becomes_maintainer"></a></p><h2 id="jia_tan_becomes_maintainer"><a href="#jia_tan_becomes_maintainer">Jia Tan becomes maintainer</a></h2>


<p>
At this point Lasse seems to have started working even more closely with Jia Tan. Evan Boehs <a href="https://boehs.org/node/everything-i-know-about-the-xz-backdoor">observes</a> that Jigar Kumar and Dennis Ens both had nameNNN@mailhost email addresses that never appeared elsewhere on the internet, nor again in xz-devel. It seems likely that they were fakes created to push Lasse to give Jia more control. It worked. Over the next few months, Jia started replying to threads on xz-devel authoritatively about the upcoming 5.4.0 release.

</p><p>
<b>2022-09-27</b>: Jia Tan gives <a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00593.html">release summary</a> for 5.4.0. (“The 5.4.0 release that will contain the multi threaded decoder is planned for December. The list of open issues related to 5..4.0 [sic] in general that I am tracking are...”)

</p><p>
<b>2022-11-30</b>: Lasse Collin <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=764955e2d4f2a5e8d6d6fec63af694f799e050e7">changes bug report email</a> from his personal address to an alias that goes to him and Jia Tan, notes in README that “the project maintainers Lasse Collin and Jia Tan can be reached via <a href="mailto:xz@tukaani.org">xz@tukaani.org</a>”.

</p><p>
<b>2022-12-30</b>: Jia Tan merges <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=8ace358d65059152d9a1f43f4770170d29d35754">first commit directly into the xz repo</a> (“CMake: Update .gitignore for CMake artifacts from in source build”). At this point we know they have commit access.

</p><p>
<b>2023-01-11</b>: Lasse Collin <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=18b845e69752c975dfeda418ec00eda22605c2ee">tags and builds his final release</a>, v5.4.1.

</p><p>
<b>2023-03-18</b>: Jia Tan <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=6ca8046ecbc7a1c81ee08f544bfd1414819fb2e8">tags and builds their first release</a>, v5.4.2.

</p><p>
<b>2023-03-20</b>: Jia Tan <a href="https://github.com/google/oss-fuzz/commit/6403e93344476972e908ce17e8244f5c2b957dfd">updates Google oss-fuzz configuration</a> to send bugs to them.

</p><p>
<b>2023-06-22</b>: Hans Jansen sends a pair of patches, merged by Lasse Collin, that use the “<a href="https://maskray.me/blog/2021-01-18-gnu-indirect-function">GNU indirect function</a>” feature to select a fast CRC function at startup time. This change is important because it provides a hook by which the backdoor code can modify the global function tables before they are remapped read-only. While this change could be an innocent performance optimization by itself, Hans Jansen returns in 2024 to promote the backdoored xz and otherwise does not exist on the internet.

</p><p>
<b>2023-07-07</b>: Jia Tan <a href="https://github.com/google/oss-fuzz/commit/d2e42b2e489eac6fe6268e381b7db151f4c892c5">disables ifunc support during oss-fuzz builds</a>, claiming ifunc is incompatible with address sanitizer. This may well be innocuous on its own, although it is also more groundwork for using ifunc later.

</p><p>
<b>2024-01-19</b>: Jia Tan <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=c26812c5b2c8a2a47f43214afe6b0b840c73e4f5">moves web site to GitHub pages</a>, giving them control over the XZ Utils web page. Lasse Collin presumably created the DNS records for the xz.tukaani.org subdomain that points to GitHub pages. After the attack was discovered, Lasse Collin deleted this DNS record to move back to <a href="https://erikarow.land/notes/tukaani.org">tukaani.org</a>, which he controls.
<a href="#attack_begins"></a></p><h2 id="attack_begins"><a href="#attack_begins">Attack begins</a></h2>


<p>
<b>2024-02-23</b>: Jia Tan <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=cf44e4b7f5dfdbf8c78aef377c10f71e274f63c0">merges hidden backdoor binary code</a> well hidden inside some binary test input files. The associated README claims “This directory contains bunch of files to test handling of .xz, .lzma (LZMA_Alone), and .lz (lzip) files in decoder implementations. Many of the files have been created by hand with a hex editor, thus there is no better &#34;source code&#34; than the files themselves.”

</p><p>
<b>2024-02-24</b>: Jia Tan <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=2d7d862e3ffa8cec4fd3fdffcd84e984a17aa429">tags and builds v5.6.0</a> and publishes an xz-5.6.0.tar.gz distribution with an extra, malicious build-to-host.m4 that adds the backdoor when building a deb/rpm package. This m4 file is not present in the source repository, but many other legitimate ones are added during package as well, so it’s not suspicious by itself. But the script has been modified from the usual copy to add the backdoor. See my <a href="https://erikarow.land/notes/xz-script">xz attack shell script walkthrough post</a> for more.

</p><p>
<b>2024-02-24</b>: Gentoo <a href="https://bugs.gentoo.org/925415">starts seeing crashes in 5.6.0</a>. This seems to be an actual ifunc bug, rather than a bug in the hidden backdoor, since this is the first xz with Hans Jansen’s ifunc changes.

</p><p>
<b>2024-02-26</b>: Debian <a href="https://tracker.debian.org/news/1506761/accepted-xz-utils-560-01-source-into-unstable/">adds xz-utils 5.6.0-0.1</a> to unstable.

</p><p>
<b>2024-02-28</b>: Debian <a href="https://tracker.debian.org/news/1507917/accepted-xz-utils-560-02-source-into-unstable/">adds xz-utils 5.6.0-0.2</a> to unstable.

</p><p>
<b>2024-02-29</b>: On GitHub, @teknoraver <a href="https://github.com/systemd/systemd/pull/31550">sends pull request</a> to stop linking liblzma into libsystemd. It appears that this would have defeated the attack. <a href="https://doublepulsar.com/inside-the-failed-attempt-to-backdoor-ssh-globally-that-got-caught-by-chance-bbfe628fafdd">Kevin Beaumont speculates</a> that knowing this was on the way may have accelerated the attacker’s schedule. It is unclear whether any earlier discussions exist that would have tipped them off.

</p><p>
<b>2024-02-28</b>: Jia Tan <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=a100f9111c8cc7f5b5f0e4a5e8af3de7161c7975">breaks landlock detection</a> in configure script by adding a subtle typo in the C program used to check for <a href="https://docs.kernel.org/userspace-api/landlock.html">landlock support</a>. The configure script tries to build and run the C program to check for landlock support, but since the C program has a syntax error, it will never build and run, and the script will always decide there is no landlock support. Lasse Collin is listed as the committer; he may have missed the subtle typo, or the author may be forged. Probably the former, since Jia Tan did not bother to forge committer on his many other changes. This patch seems to be setting up for something besides the sshd change, since landlock support is part of the xz command and not liblzma. Exactly what is unclear.

</p><p>
<b>2024-03-04</b>: RedHat distributions <a href="https://bugzilla.redhat.com/show_bug.cgi?id=2267598">start seeing Valgrind errors</a> in liblzma’s <code>_get_cpuid</code> (the entry to the backdoor).

</p><p>
<b>2024-03-05</b>: The <a href="https://github.com/systemd/systemd/commit/3fc72d54132151c131301fc7954e0b44cdd3c860">libsystemd PR is merged</a> to remove liblzma.

</p><p>
<b>2024-03-05</b>: Debian <a href="https://tracker.debian.org/news/1509743/xz-utils-560-02-migrated-to-testing/">adds xz-utils 5.6.0-0.2</a> to testing.

</p><p>
<b>2024-03-05</b>: Jia Tan commits <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=ed957d39426695e948b06de0ed952a2fbbe84bd1">two ifunc</a> <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=4e1c97052b5f14f4d6dda99d12cbbd01e66e3712">bug fixes</a>. These seem to be real fixes for the actual ifunc bug. One commit links to the Gentoo bug and also typos an <a href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=114115">upstream GCC bug</a>.

</p><p>
<b>2024-03-08</b>: Jia Tan <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=82ecc538193b380a21622aea02b0ba078e7ade92">commits purported Valgrind fix</a>. This is a misdirection, but an effective one.

</p><p>
<b>2024-03-09</b>: Jia Tan <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=74b138d2a6529f2c07729d7c77b1725a8e8b16f1">commits updated backdoor files</a>. This is the actual Valgrind fix, changing the two test files containing the attack code. “The original files were generated with random local to my machine. To better reproduce these files in the future, a constant seed was used to recreate these files.”

</p><p>
<b>2024-03-09</b>: Jia Tan <a href="https://git.tukaani.org/?p=xz.git;a=commitdiff;h=fd1b975b7851e081ed6e5cf63df946cd5cbdbb94">tags and build v5.6.1</a> and publishes xz 5.6.1 distribution, containing new backdoor. To date I have not seen any analysis of how the old and new backdoors differ.

</p><p>
<b>2024-03-20</b>: Lasse Collin sends LKML a patch set <a href="https://lkml.org/lkml/2024/3/20/1009">replacing his personal email</a> with <a href="https://lkml.org/lkml/2024/3/20/1008">both himself and Jia Tan</a> as maintainers of the xz compression code in the kernel. There is no indication that Lasse Collin was acting nefariously here, just cleaning up references to himself as sole maintainer. Of course, Jia Tan may have prompted this, and being able to send xz patches to the Linux kernel would have been a nice point of leverage for Jia Tan&#39;s future work. We&#39;re not at <a href="https://erikarow.land/notes/nih">trusting trust</a> levels yet, but it would be one step closer.

</p><p>
<b>2024-03-25</b>: Hans Jansen is back (!), <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1067708">filing a Debian bug</a> to get xz-utils updated to 5.6.1. Like in the 2022 pressure campaign, more name###@mailhost addresses that don’t otherwise exist on the internet show up to advocate for it.

</p><p>
<b>2024-03-28</b>: Jia Tan <a href="https://bugs.launchpad.net/ubuntu/+source/xz-utils/+bug/2059417">files an Ubuntu bug</a> to get xz-utils updated to 5.6.1 from Debian.
<a href="#attack_detected"></a></p><h2 id="attack_detected"><a href="#attack_detected">Attack detected</a></h2>


<p>
<b>2024-03-28</b>: Andres Freund discovers bug, privately notifies Debian and distros@openwall. RedHat assigns CVE-2024-3094.

</p><p>
<b>2024-03-28</b>: Debian <a href="https://tracker.debian.org/news/1515519/accepted-xz-utils-561really545-1-source-into-unstable/">rolls back 5.6.1</a>, introducing 5.6.1+really5.4.5-1.

</p><p>
<b>2024-03-29</b>: Andres Freund <a href="https://www.openwall.com/lists/oss-security/2024/03/29/4">posts backdoor warning</a> to public oss-security@openwall list, saying he found it “over the last weeks”.

</p><p>
<b>2024-03-29</b>: RedHat <a href="https://www.redhat.com/en/blog/urgent-security-alert-fedora-41-and-rawhide-users">announces that the backdoored xz shipped</a> in Fedora Rawhide and Fedora Linux 40 beta.

</p><p>
<b>2024-03-30</b>: Debian <a href="https://fulda.social/@Ganneff/112184975950858403">shut down builds</a> to rebuild their build machines using Debian stable (in case the malware xz escaped their sandbox?).
<a href="#further_reading"></a></p>
<ul>
<li>
Evan Boehs, <a href="https://boehs.org/node/everything-i-know-about-the-xz-backdoor">Everything I know about the XZ backdoor</a> (2024-03-29).
</li><li>
Filippo Valsorda, <a href="https://bsky.app/profile/filippo.abyssdomain.expert/post/3kowjkx2njy2b">Bluesky</a> re backdoor operation (2024-03-30).
</li><li>
Michał Zalewski, <a href="https://lcamtuf.substack.com/p/technologist-vs-spy-the-xz-backdoor">Techies vs spies: the xz backdoor debate</a> (2024-03-30).
</li><li>
Michał Zalewski, <a href="https://lcamtuf.substack.com/p/oss-backdoors-the-allure-of-the-easy">OSS backdoors: the folly of the easy fix</a> (2024-03-31).
</li><li>
Connor Tumbleson, <a href="https://connortumbleson.com/2024/03/31/watching-xz-unfold-from-afar/">Watching xz unfold from afar</a> (2024-03-31).
</li><li>
nugxperience, <a href="https://twitter.com/nugxperience/status/1773906926503591970">Twitter</a> re awk and rc4 (2024-03-29)
</li><li>
birchb0y, <a href="https://twitter.com/birchb0y/status/1773871381890924872">Twitter</a> re time of day of commit vs level of evil (2024-03-29)
</li><li>
Dan Feidt, <a href="https://unicornriot.ninja/2024/xz-utils-software-backdoor-uncovered-in-years-long-hacking-plot/">&#39;xz utils&#39; Software Backdoor Uncovered in Years-Long Hacking Plot</a> (2024-03-30)
</li><li>
smx-smz, <a href="https://gist.github.com/smx-smx/a6112d54777845d389bd7126d6e9f504">[WIP] XZ Backdoor Analysis and symbol mapping</a>
</li><li>
Dan Goodin, <a href="https://arstechnica.com/security/2024/04/what-we-know-about-the-xz-utils-backdoor-that-almost-infected-the-world/">What we know about the xz Utils backdoor that almost infected the world</a> (2024-04-01) <br/>
</li><li>
Akamai Security Intelligence Group, <a href="https://www.akamai.com/blog/security-research/critical-linux-backdoor-xz-utils-discovered-what-to-know">XZ Utils Backdoor — Everything You Need to Know, and What You Can Do</a> (2024-04-01)
</li><li>
Kevin Beaumont, <a href="https://doublepulsar.com/inside-the-failed-attempt-to-backdoor-ssh-globally-that-got-caught-by-chance-bbfe628fafdd">Inside the failed attempt to backdoor SSH globally — that got caught by chance</a> (2024-03-31)
</li><li>
amlweems, <a href="https://github.com/amlweems/xzbot">xzbot: notes, honeypot, and exploit demo for the xz backdoor</a> (2024-04-01)
</li><li>
Rhea&#39;s Substack, <a href="https://rheaeve.substack.com/p/xz-backdoor-times-damned-times-and">XZ Backdoor: Times, damned times, and scams</a> (2024-03-30)</li></ul>

      </div>
    </div></div>
  </body>
</html>
