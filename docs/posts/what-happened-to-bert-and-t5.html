<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.yitay.net/blog/model-architecture-blogpost-encoders-prefixlm-denoising">Original</a>
    <h1>What happened to BERT and T5?</h1>
    
    <div id="readability-page-1" class="page"><div data-block-type="2" data-border-radii="{&#34;topLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;topRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0}}" id="block-0370f11da47205b70fe2"><div>

<div>
  <p>The people who worked on language and NLP about 5+ years ago are left scratching their heads about where all the encoder models went. If BERT worked so well, why not scale it? What happened to encoder-decoders or encoder-only models? </p><p>Today I try to unpack all that is going on, in this new era of LLMs. I Hope this post will be helpful. </p>
</div>




















  
  



</div></div><div data-block-type="2" data-border-radii="{&#34;topLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;topRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomLeft&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0},&#34;bottomRight&#34;:{&#34;unit&#34;:&#34;px&#34;,&#34;value&#34;:0.0}}" id="block-yui_3_17_2_1_1721063358593_12105"><div>

<div>
  <p>Few months ago I was also writing a long tweet-reply to this <a href="https://x.com/srush_nlp/status/1779938508578165198" target="_blank">tweet</a> by <a href="https://x.com/srush_nlp" target="_blank">@srush_nlp</a> at some point. Then the tweet got deleted because I closed the tab by accident.¯\_(ツ)_/¯  I promised to write it as a blog post some day. <br/></p><p>So here it is!</p><h4><strong>A quick primer  (Skip connection to next section if you feel confident)</strong></h4><p>There are mainly three overarching paradigms of model architectures in the past couple of years. Encoder-only models (<em>e.g., BERT</em>), Encoder-Decoder models (<em>e.g., T5</em>) and decoder-only models (e.g., <em>GPT series</em>). People get confused a lot about this and people often have tons of misconceptions about these dichotomies and architectures so I’m hoping this post will help.</p><p>The first thing to really understand is that encoder-decoder models are actually still autoregressive models. A decoder in an encoder-decoder model is literally and fundamentally still a causal decoder. Instead of pre-filling a decoder model, some text can be offloaded to an encoder, which is then sent to the decoder via cross-attention. Yes, T5 models are also language models!</p><p>A variant of this is a Prefix Language model or PrefixLM <strong>architecture</strong>, which does almost the same thing minus the cross attention (<em>and some other small details like sharing weights between encoder/decoder plus not having no encoder bottleneck</em>). PrefixLMs are also sometimes known as non-casual decoders. In short, encoder-decoders, decoder-only models and PrefixLMs are not that different altogether!</p><p>In the latest excellent lecture by Hyung Won, he masterfully gave explanations about the relationship between these models. You can check it out <a href="https://x.com/hwchung27/status/1800676312916656592" target="_blank">here</a>. Good stuff.</p><p>Meanwhile, encoder-only models such as the OG BERT does denoising differently (i.e., in-place) and to some extent, rely on classification “task” heads to do anything useful with the base model after pretraining. Denoising objective was later adopted in models like T5 in an “adapted style” using the sequence to sequence format.</p><p>To this end, it is worth noting that denoising in T5 is not exactly a new objective function per se (in the machine learning sense) but rather a data transformation across inputs, i.e., you can also train span corruption objective with a causal decoder too by the way!</p><p>People always assume encoder decoder models have to be denoising models partly because of the <em>overly representative</em> T5 model. However, <em>this is not always true.</em> You can train an encoder-decoder with a regular language modeling task (i.e.m, CLM). Conversely you can also train a causal decoder with the span corruption task. As I’ve said earlier, this is mostly a data transformation.</p><p>It is also worth to note that, generally speaking, an Encoder-Decoders of 2N parameters has the same compute cost as a decoder-only model of N parameters which gives it a different FLOP to parameter count ratio. This is just like “model sparsity” that is split across inputs and targets.</p><p>For now, glad to get this out of the way. Now onto objectives.</p><h4>On the denoising objective (does it not work? does it not scale? is it too easy?)</h4><p>The denoising objective I’m referring to is any variation of the “span corruption” task. This is sometimes known as “infilling” or “fill in the blank”. There are variations on how to express it (i.e., span length, randomness, sentinel tokens etc). But you get the gist. </p><p>While the denoising objective in BERT style models are mostly “in-place”, (e.g., classification head on top of mask tokens), the slightly more modern way is to do it “T5-style”, <em>ala</em> data transformation that can be processed by an encoder-decoder or decoder-only model. In such a data transformation, masked tokens are just “moved to the back” for the model for prediction.</p><p>The primary goal of pretraining is to build a useful internal representation that can be aligned for downstream tasks in the most efficient and effective way possible. The better the internal representations, the easier to use these learned representations for anything useful later. The simple next word prediction  “causal language modeling” objective is known to do this very well and has served as the bread and butter of the LLM revolution. The question now at hand is whether the denoising objective is just as good.</p><p>From publicly available information, we know that T5-11B works pretty well even after being aligned/SFT-ed (Flan-T5 XXL’s MMLU score is 55+, which is more than decent for a model of this scale and of that time). Hence, we can make some conclusion that the transfer process (pretraining -&gt; alignment) of the denoising objective works relatively reasonably well at this scale.</p><p>My take is that denoising objectives are great but pretty insufficient as a standalone objective. A big drawback is because of a reason which we could call less “loss exposure”. In denoising objectives, only a small amount of tokens are being masked and gets learned as a result (i.e., taken into account in the loss). Conversely, in regular language modeling, this is close to 100%. This makes for pretty low sample efficiency per FLOP which makes denoising objectives hugely disadvantaged on a flop-basis comparison. </p><p>Another drawback is that denoising objectives are more unnatural than regular language modeling since it reformats the input/output in a strange way, making them a little awkward for few-shot learning. (It’s still possible to massage these models to do reasonably okay on few-shot tasks though). Hence, I believe denoising objectives should pretty much only be used as a complementary objective to regular language modeling.</p><h4>The early days of unification and why xBERTs went extinct</h4><p>The gradual phasing out of BERT-like models was an interesting phase that not many people talk about these days. It was subtle. This could also explain why we don’t see any mega large scale BERT models running around anymore. The reason? It was largely a matter of unification and shift in task/modeling paradigms. BERT-style models are cumbersome, but the real deprecation of BERT models was because people wanted to do all tasks at once, which led to a better way of doing denoising - using autoregressive models.</p><p>During 2018-2021, there was an implicit paradigm shift of single task finetuning to massively multi-task models. This slowly gravitated us towards the unified “SFT” models that we see today that are universal and general purpose. It was simply so hard to do this with BERT. I don’t think this has anything much to do with “denoising” at all. People simply found a way to re-express denoising pretraining tasks if they wanted to use such a model (i.e., T5) which made BERT-style models pretty much deprecated at this point because there is a strictly better alternative.</p><p>To be even more concrete, encoder-decoder and decoder-only models were able to express multiple tasks at once without the need for task specific classification heads. For Encoder-Decoders, if the decoder was getting in the way, researchers and engineers also began to find out that yanking out the encoder performed just as competitive as a BERT encoder. Moreover, it also retains the same bidirectional attention benefit that made BERT competitive over GPT models at small (often production) scale. </p><h4>The value of denoising objectives</h4><p>Denoising pretraining objective also learns to predict the next word in a similar way to regular language modeling. However, different from regular causal language modeling, a data transformation is applied to the sequence such that the model learns to “fill in the blanks” instead of simply predicting the naturally occuring left-to-right text. </p><p>Notably, denoising objectives are sometimes also called “infilling tasks” that are sometimes mashed together into pretraining together with regular language modeling tasks.</p><p>While the exact configuration and implementation details can vary, modern LLMs today may use a combination of language modeling and infilling in some capacity. It is actually interesting how this mixture of LM + infilling seemed to have been propagated around the same time (e.g., <a href="https://arxiv.org/abs/2205.05131"><span>UL2</span></a>, <a href="https://arxiv.org/pdf/2207.14255"><span>FIM</span></a>, <a href="https://arxiv.org/abs/2210.02414"><span>GLM</span></a>, <a href="https://arxiv.org/abs/2201.07520"><span>CM3</span></a>), with many groups bringing their own flavor of this mixture in some way. On a side note, the largest publicly disclosed &amp; reported model trained in this style is likely the <a href="https://arxiv.org/abs/2305.10403"><span>PaLM-2 model</span></a>.</p><h4>What about bidirectional attention?</h4><p>Bidirectional attention is an interesting “inductive bias” for language models - one that is commonly conflated with objectives and model backbones. The usefulness of inductive biases changes at different compute regions and could have different effects on scaling curves at different compute regions. That said, it could be true that bidirectional doesn’t seem to matter that much at larger scales compared to smaller scales, or have different impacts on different tasks or modalities. For instance, <a href="https://arxiv.org/abs/2407.07726v1" target="_blank">PaliGemma</a> makes use of PrefixLM architectures.</p><h4>Pros and Cons of Encoder-Decoder architectures</h4><p>Encoder-decoder architectures actually have some pros vs regular decoder-only models. The first case is where the encoder side is not restricted by a causal mask. To some extent, you can go crazy with the attention layers by doing aggressive pooling or any form of linear attention without worrying about the autoregressive design restriction. This is a good way to offload not so important “context” to an encoder. You can also make the encoder smaller, which is neat. </p><p>Meanwhile, one negative point of the encoder-decoder versus PrefixLM is that inputs and targets have to have fixed allocated budgets. For instance, if the input budget is 1024 tokens, the encoder side has to be padded to this value which causes a lot of potential for wasted compute. Conversely, in PrefixLM, input and targets can just be directly concatenated which mitigates this problem.</p><h4>Relevance to models today and key takeaways</h4><p>The ability to reason with inductive biases both at architectural and from a pre-training perspective is a critical aspect of being a competent LLM researcher and practitioner today. Understanding the fundamental nuances helps one to extrapolate and continue to innovate.</p><p>Here are my key takeaways:</p><ol data-rte-list="default"><li><p>Encoder-decoder and decoder-only models are both autoregressive models that have implementation-level differences and pros/cons. They are subtly different inductive biases. Optimal usage really depends on downstream use-case and pretty much application constraints. Meanwhile, for most LLM usage and niche use-cases aside, BERT style encoder models are mostly considered deprecated.</p></li><li><p>Denoising objectives are mostly complementary to CLM. They have just found their way as “supporting objectives” in pretraining. Training CLM with denoising objectives usually helps in some way. While this happens very frequently in code models (i.e., code infilling), it is not uncommon (though not mandatory) for general purpose models today still pretrain with CLM with some denoising objective.</p></li><li><p>Bidirectional attention helps a lot at smaller scales but is generally optional at larger scales. This is mostly anecdotal. I see bidirectional attention has a form of inductive bias, just like many other types of modifications to Transformer models.</p></li></ol><p>Finally, on to recap, we don’t see any scaled up xBERTs running around: BERT models got deprecated in favor of more flexible forms of denoising (autoregressive) T5 models. This is largely due to paradigm unification where people would like to perform any task with a general purpose model (as opposed to task specific model). Meanwhile, autoregressive denoising gets sometimes folded as side objectives to casual language models. </p><h4>Final words &amp; Acknowledgements</h4><p>It’s really fun to write about model architecture. I hope to write more about LLMs and AI research in general. </p>
</div>




















  
  



</div></div></div>
  </body>
</html>
