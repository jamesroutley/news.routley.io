<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.theregister.com/2023/09/27/osseu_steam_os_3/">Original</a>
    <h1>Linux interop is maturing fast thanks to a games console</h1>
    
    <div id="readability-page-1" class="page"><div id="body">
<p><span>Open Source Summit</span> Steam OS is the Arch-based distro for a handheld Linux games console, and Valve is aggressively pushing Linux&#39;s usability and Windows interoperability for the device.</p>
<p>Two unusual companies, Valve Software and Igalia, are working together to improve the Linux-based OS of the <a href="https://www.theregister.com/2021/07/16/steam_deck_portable_gaming_pc/">Steam Deck handheld games console</a>. The device runs a Linux distro called Steam OS 3.0, but this is a totally different distro from the original <a href="https://www.theregister.com/2013/09/23/valve_gets_the_linux_feeling_with_steamos_for_gamers/">Steam OS it announced a decade ago</a>. Steam OS 1 and 2 were <a href="https://store.steampowered.com/steamos/buildyourown" rel="nofollow">based</a> on Debian, but Steam OS 3 is based on Arch Linux, as Igalia developer <a href="https://www.igalia.com/team/berto" rel="nofollow">Alberto García</a> described in a talk entitled <a href="https://osseu2023.sched.com/event/1Qv8y/how-steamos-is-contributing-to-the-linux-ecosystem-alberto-garcia-igalia" rel="nofollow"><em>How SteamOS is contributing to the Linux ecosystem</em></a>.</p>
<p>He explained that although Steam OS is built from some fairly standard components – the normal filesystem hierarchy, GNU user space, <code>systemd</code> and <code>dbus</code> – Steam OS has quite a few unique features. It has two distinct user interfaces: by default, it starts with the Steam games launcher, but users can also choose an option called <em>Switch to Desktop</em>, which results in a regular KDE Plasma desktop, with the ability to install anything: a web browser, normal Linux tools, and non-Steam games.</p>

    

<p>Obviously, though, Steam OS&#39;s <em>raison d&#39;être</em> is to run Steam games, and most of those are Windows games which will never get native Linux versions. Valve&#39;s solution is <a href="https://github.com/ValveSoftware/Proton" rel="nofollow">Proton</a>, an open-source tool to run Windows games on Linux. It&#39;s formed from a collection of different FOSS packages, notably:</p>
<ul>
<li>

<p><a href="https://www.winehq.org/" rel="nofollow">Wine</a>, the compatibility layer for Windows APIs.</p>
</li>

<li>
<p><a href="https://github.com/doitsujin/dxvk" rel="nofollow">DXVK</a>, which translates DirectX version 9 to 11 calls into <a href="https://www.vulkan.org/" rel="nofollow">Vulkan</a> calls.</p>
</li>

<li>
<p><a href="https://github.com/HansKristian-Work/vkd3d-proton" rel="nofollow">VKD3D-Proton</a>, which translates DirectX 12 calls to Vulkan.</p>
</li>

<li>
<p>And also the <a href="https://gstreamer.freedesktop.org/" rel="nofollow">GStreamer</a> open source multimedia framework and other libraries.</p>
</li>
</ul>
<p>The result is a remarkable degree of compatibility for some of the most demanding Windows apps around – Proton&#39;s compatibility database, <a href="https://www.protondb.com/" rel="nofollow">ProtonDB</a>, offers these impressive stats:</p>
<blockquote>
<p><strong>Deck Verified Games</strong></p>

<p>▸ verified: 3,886</p>

<p>▸ verified or playable: 11,503</p>

<p><strong>Games on ProtonDB</strong></p>

<p>▸ recommended by three or more: 8,106</p>

<p>▸ recommended by two or more: 11,275</p>

<p>▸ recommended by at least one: 18,760</p>
</blockquote>
<p>Proton was released by Valve in 2018 and is still in very active development. It&#39;s also actively involved in Wine development now, working alongside Codeweavers, whose efforts <em>The Reg</em> <a href="https://www.theregister.com/2000/12/15/corel_linux_selloff_nearly/">first reported on in 2000</a>.</p>
<p>Wherever possible, Wine converts Windows API calls to Linux ones, but sometimes, there is no matching Linux API. If there isn&#39;t, García said, <em>&#34;Wine needs to implement the missing parts. This can result in overhead, and it&#39;s not always easily solvable in userspace. Solution: new Linux features to fill in the missing gaps.&#34;</em></p>

        


        

<p>One recent example is the new <a href="https://docs.kernel.org/userspace-api/futex2.html" rel="nofollow"><code>futex_waitv()</code></a> call in kernel 5.16, which brings a new API to Linux that&#39;s like Win32&#39;s <a href="https://learn.microsoft.com/en-us/windows/win32/api/synchapi/nf-synchapi-waitformultipleobjects" rel="nofollow"><code>WaitForMultipleObjects()</code></a> call, as this Collabora <a href="https://www.collabora.com/news-and-blog/blog/2023/02/17/the-futex-waitv-syscall-gaming-on-linux/" rel="nofollow">blog post</a> explains in depth. Another <a href="https://lore.kernel.org/all/20190719000322.106163-3-drosen@google.com/" rel="nofollow">patch</a> brings <a href="https://lwn.net/Articles/784041/" rel="nofollow"><em>optional</em> case-insensitivity</a> to the F2FS, the <a href="https://docs.kernel.org/filesystems/f2fs.html" rel="nofollow">Flash-friendly file system</a>. As another example, Valve and its partners are also working on more <a href="https://lwn.net/Articles/931789/" rel="nofollow">reliable user-space spinlocks</a>.</p>
<p>A significant way that Steam OS differs from its Arch parent distro is that, like Chrome OS, it uses dual root partitions with failover: the active instance of the OS updates the <em>other</em> instance, so that if the update fails for some reason, it can automatically fail-over back to the original, unmodified instance. The snag is that Steam OS 3 uses Btrfs: Btrfs identifies filesystems by their UUID, and it <em>really</em> doesn&#39;t like it if it finds two partitions with the same UUID. Igalia engineer Guilherme Piccoli wrote a <a href="https://lore.kernel.org/linux-btrfs/20230504170708.787361-1-gpiccoli@igalia.com/" rel="nofollow">patch</a> to make Btrfs able to handle this, as well as another to improve the performance of <a href="https://lwn.net/Articles/911219/" rel="nofollow">split lock detector handling</a>.</p>
<ul>

<li><a href="https://www.theregister.com/2023/09/26/linux_kernel_report_2023/">Long-term support for Linux kernels is about to get a lot shorter</a></li>

<li><a href="https://www.theregister.com/2023/09/20/gnu_turns_40/">GNU turns 40: Stallman&#39;s baby still not ready for prime time, but hey, there&#39;s cake</a></li>

<li><a href="https://www.theregister.com/2023/09/14/pc_xt_with_hdmi/">These days you can teach old tech a bunch of new tricks</a></li>

<li><a href="https://www.theregister.com/2023/08/24/no_wifi7_on_win10/">Intel seems to think Wi-Fi 7 is too cool for old-school Windows 10</a></li>
</ul>
<p>Some of this illustrates the general thrust of the development being done: taking features that do already work, and making them work much faster to improve games performance on a relatively modestly specified device. The Steam Deck is based on an AMD Zen2-based <a href="https://videocardz.com/newz/amd-van-gogh-apu-for-steam-pictured-up-close" rel="nofollow">&#34;Van Gogh&#34;</a> SoC, codenamed <em>Aerith</em> after a <a href="https://finalfantasy.fandom.com/wiki/Aerith_Gainsborough" rel="nofollow">character</a> from <em>Final Fantasy 7</em>. This uses a custom AMD GPU driver called <a href="https://docs.mesa3d.org/drivers/radv.html" rel="nofollow">RADV</a>, as well as a custom shader compiler, <a href="https://steamcommunity.com/games/221410/announcements/detail/1602634609636894200" rel="nofollow">ACO</a>. Igalia engineer Melissa Wen is <a href="https://melissawen.github.io/blog/2023/08/21/amd-steamdeck-colors" rel="nofollow">working</a> with Valve and AMD to improve the Linux <a href="https://bootlin.com/pub/conferences/2017/kr/ripard-drm/ripard-drm.pdf" rel="nofollow">Direct Rendering Manager</a> [PDF] and its handling of high dynamic range (HDR) displays.</p>
<p>Steam OS is also an immutable distro, like <a href="https://www.theregister.com/2022/05/12/fedora_36_released/">Fedora Silverblue</a> and <a href="https://www.theregister.com/2023/01/12/endless_os_5/">Endless OS</a>. So, both its root partitions are normally read-only, and apps can only be installed via Flatpak. As former Elementary OS developer Cassidy Blaede, now with Endless, <a href="https://mastodon.blaede.family/@cassidy/111031129234702967" rel="nofollow">points out</a>, in this way, the very end-user focused Steam Deck is acting as a Trojan horse, persuading desktop users to adopt Flatpak. That too is driving improvements: for instance, while it uses <a href="https://wiki.archlinux.org/title/XDG_Desktop_Portal" rel="nofollow">XDG portals</a> to associate Flatpaks with file types, this is complicated by having two UIs, the Steam one and KDE. The result is additional <a href="https://github.com/flatpak/xdg-desktop-portal/issues/906" rel="nofollow">improvements</a> in portal handling. It&#39;s good that people are <a href="https://knowyourmeme.com/memes/thinking-with-portals" rel="nofollow">thinking</a> about this stuff.</p>

        

<p>There is much too much work going on to fit into a 40 minute session, and García talks quite fast as it is. His 49-page <a href="https://static.sched.com/hosted_files/osseu2023/83/steamos-and-linux-oss-eu-2023.pdf" rel="nofollow">presentation</a> [PDF] is dense and full of links. He skimmed over improvements to removable drive formatting, KDE&#39;s apps, icons, and drives handling, <a href="https://www.libsdl.org/" rel="nofollow">SDL</a>, the <a href="https://www.theregister.com/2022/05/24/new_audio_server_pipewire_coming/">Pipewire audio server</a>, and more.</p>
<p>
  <a href="https://www.youtube.com/watch?v=L98v4epQmrg&amp;t=15124s" data-media="x-videoplayer">Youtube Video</a>
</p>
<p>Valve is a highly atypical company; its uniquely flat <a href="https://blog.inf.ed.ac.uk/sapm/2014/03/14/management-at-valve-an-analysis-of-management-practices-at-valve-software/" rel="nofollow">management structure</a> is even the subject of <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3884844" rel="nofollow">academic study</a>. Igalia, too, is a flat, worker-owned <a href="https://www.igalia.com/about/values" rel="nofollow">cooperative</a>. Although <a href="https://www.theregister.com/2012/12/10/valve_chief_confirms_steam_pc/">Valve&#39;s original plan</a> for the Steam Box wasn&#39;t a big hit, the Steam Deck is proving far more popular, and is literally putting Linux in the hands of one of the most Windows-centric audiences: what&#39;s sometimes called the <a href="https://www.arm.com/glossary/aaa-games" rel="nofollow">AAA games</a> marketplace. Although its firmly aimed at gamers, this is important work. Most of the commercial R&amp;D effort in Linux goes into server-focused work, neglecting the desktop.</p>

        

<p>This vulture maintains that <a href="https://www.theregister.com/2023/07/18/linux_desktop_debate/">ChromeOS is a Linux distro</a>. They&#39;ve been <a href="https://www.theregister.com/2013/07/11/chromebooks_fastest_growing_pc_market/">selling strongly for a decade</a>. When Linux laptops <a href="https://www.theguardian.com/technology/2016/may/23/chromebook-mac-google-pc-sales" rel="nofollow">outsold Macs</a> in 2016, that meant that was the first Year of Linux on the desktop.</p>
<p>But although <a href="https://www.theregister.com/2021/04/22/chromeos_update/">it&#39;s getting there</a>, ChromeOS is admittedly not a general-purpose distro. Even though it has a similarly narrow primary focus, Steam OS definitely can be, and Valve is working hard to ensure that all the improvements and refinements it makes are pushed back upstream, so that any distro on any hardware can make use of them – and the performance and functionality improvements from Steam OS helps all Linux users. ®</p>                                
                    </div></div>
  </body>
</html>
