<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/programming/EmacsMetaXRelevantCommands">Original</a>
    <h1>How to make your GNU Emacs commands &#39;relevant&#39; for M-X</h1>
    
    <div id="readability-page-1" class="page"><div><h2>How to make your GNU Emacs commands &#39;relevant&#39; for M-X</h2>

	<p><small>February 26, 2024</small></p>
</div><div><p>Today I learned about <a href="https://svbck.org/blog/2024-02-24-emacs-find-of-the-day-m-x.html">the M-X command (well, key binding)</a> (<a href="https://fosstodon.org/@svbck/111987384357353958">via</a>), which &#34;[queries
the] user for a command relevant to the current mode, and then
execute it&#34;. In other words it&#39;s like M-x but it restricts what
commands it offers to relevant ones. What is &#39;relevant&#39; here? To
quote the docstring:</p>

<blockquote><p>[...] This includes commands that have been marked as being specially
designed for the current major mode (and enabled minor modes), as well
as commands bound in the active local key maps.</p>
</blockquote>

<p>If you&#39;re someone like me who has written some Lisp commands to
customize your experience in a major mode like <a href="https://www.gnu.org/software/emacs/manual/html_node/mh-e/index.html">MH-E</a>, you
might wonder how you mark your personal Lisp commands as &#39;specially
designed&#39; for the relevant major mode.</p>

<p>In modern Emacs, the answer is that this is an extended part of
&#39;<code>(interactive ...)</code>&#39;, the normal Lisp form you use to mark your
Lisp functions as commands (things which will be offered in M-x and
can be run interactively). As mentioned in the Emacs Lisp manual
section <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Using-Interactive.html">Using <code>interactive</code></a>,
&#39;<code>interactive</code>&#39; takes additional arguments to label what modes your
command is &#39;specially designed&#39; for; more discussion is in <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Command-Modes.html">Specifying
Modes For Commands</a>.
The basic usage is, say, &#39;<code>(interactive &#34;P&#34; mh-folder-mode)</code>&#39;</p>

<p>If your commands already take arguments, life is simple and you can
just put the modes on the end. But not all commands do (especially
for quick little things you do for yourself). If you have just
&#39;<code>(interactive)</code>&#39;, the correct change is to make it &#39;<code>(interactive
nil mh-folder-mode)</code>&#39;; a nil first argument is how you tell
<code>interactive</code> that there is no argument.</p>

<p>(Don&#39;t make my initial mistake and assume that &#39;<code>(interactive &#34;&#34;
mh-folder-mode)</code>&#39; will work. That produced a variety of undesirable
results.)</p>

<p>Is it useful to do this, assuming you have personal commands that
are truly specific to a given mode (as I do for commands that operate
on MH messages and the MH folder display)? My views so far are a
decided maybe in my environment.</p>

<p>First, you don&#39;t need to do this if your commands have keybindings
in your major mode, because M-X (execute-extended-command-for-buffer)
will already offer any commands that have keybindings. Second, <a href="https://utcc.utoronto.ca/~cks/space/blog/programming/EmacsPackages-2023-11">my
assortment of packages</a> already gives me
quite a lot of selection power to narrow in on likely commands in
plain M-x, provided that I&#39;ve named them sensibly. The combination
of <a href="https://github.com/minad/vertico">vertico</a>, <a href="https://github.com/minad/marginalia">marginalia</a>, and <a href="https://github.com/oantolin/orderless">orderless</a> let me search for commands
by substrings, easily see a number of my options, and also see part
of their descriptions. So if I know I want something to do with MH
forwarding I can type &#39;M-x mh forw&#39; and get, among other things,
my function for <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/EmailThreeForwardingFormats">forwarding in &#39;literal plaintext&#39; format</a>.</p>

<p>With that said, adding the mode to &#39;(interactive)&#39; isn&#39;t much work
and it does sort of add some documentation about your intentions
that your future self may find useful. And if you want a more minimal
<a href="https://utcc.utoronto.ca/~cks/space/blog/programming/EmacsUnderstandingCompletion">minibuffer completion</a> experience,
it may be more useful to have a good way to winnow down the selection.
If you use M-X frequently and you have commands you want to be able
to select in it in applicable modes without having them bound to
keys, you really have no choice.</p>
</div></div>
  </body>
</html>
