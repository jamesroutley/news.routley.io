<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tigyog.app/d/L-8D8R2yeXLY/r/an-everyday-look-at-time-series">Original</a>
    <h1>Show HN: Learn time series with a story illustrated by Stable Diffusion</h1>
    
    <div id="readability-page-1" class="page"><div><div aria-hidden="false"><p><img src="https://jvns.ca/api/files/7229ce92fd44cfac408b87a437ecb8eab93d0e06aa160c1e64058577373c1e44.png/image" alt="A table covered with lemonade cocktails. Rainforest canopy in background."/></p></div><p aria-hidden="false"><h2><span><span>or, </span></span><span><i>The Way You Do That Walk</i></span></h2></p><p><span><span>Good morning, sunshine! 😊 Judging from your appearance, it must have been a great party last night. Why are you scrambling through those half-empty glasses of lemonade?</span></span></p><div aria-hidden="false"><div><p><span><span></span></span><span><span>Error: PromptContext provided undefined context</span><span><span>Morning, Andrew. I’m looking for my phone.</span></span></span><span><span></span></span></p></div></div><p><span><span>Hmm, I see. I have bad news: your phone is nowhere to be found! It seems one of your “friends” has left with it. In this lesson, we’ll have to find out who.</span></span></p><p><span><span>But luckily, your phone is still logging data! We can catch the culprit using </span></span><span><b>time series analysis!</b></span><span><span> In this lesson, you’ll learn:</span></span></p><p><span><span>📈 What a time series is, and how to describe one with </span></span><span><b>the ARMA model.</b></span></p><p><span><span>👗 How to fit a model using Python and </span></span><span><b>automatic minimization.</b></span></p><p><span><span>🗂 How to </span></span><span><b>classify</b></span><span><span> time series using their fitted parameters.</span></span></p><p aria-hidden="true"><h2><span><span>Rainfall in Kinshasa ⛈️</span></span></h2></p><p><span><span>Scene change. In your day job at </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>C</mtext><munder accentunder="true"><mtext>ongo</mtext><mo stretchy="true">⏡</mo></munder><mtext>.com</mtext></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\Congo</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>C</span></span><span><span><span><span><span><span></span><span><span><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.342em" viewBox="0 0 400000 342" preserveAspectRatio="xMinYMin slice"><path d="M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z"></path></svg></span><span><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.342em" viewBox="0 0 400000 342" preserveAspectRatio="xMaxYMin slice"><path d="M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z"></path></svg></span></span></span><span><span></span><span><span><span>ongo</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span>.com</span></span></span></span></span></span></span></span><span><span>, you keep the package deliveries running smoothly. Every night, the server calculates the best delivery routes for the next day. To calculate the best routes, it needs a rainfall prediction. If the prediction is wrong, mopeds get stuck on muddy roads, and packages are delayed.</span></span></p><p><span><span>On average, it rains </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.14</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.14</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.14</span></span></span></span></span></span><span><span> inches per day in your area of the Congo. But on the week you arrived at the company, it rained over an inch every day from Monday to Friday. Judging from this week of rain, we should say that Saturday’s rain will probably be ...</span></span></p><p><span><span>Before you joined </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>C</mtext><munder accentunder="true"><mtext>ongo</mtext><mo stretchy="true">⏡</mo></munder><mtext>.com</mtext></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\Congo</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>C</span></span><span><span><span><span><span><span></span><span><span><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.342em" viewBox="0 0 400000 342" preserveAspectRatio="xMinYMin slice"><path d="M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z"></path></svg></span><span><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.342em" viewBox="0 0 400000 342" preserveAspectRatio="xMaxYMin slice"><path d="M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z"></path></svg></span></span></span><span><span></span><span><span><span>ongo</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span>.com</span></span></span></span></span></span></span></span><span><span>, your colleague Eva had written the first rainfall prediction program. No matter what, Eva’s program predicts that tomorrow’s rainfall will be </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.14</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.14</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.14</span></span></span></span></span></span><span><span> inches. After five days of rain, what did Eva’s program predict for Saturday’s rainfall?</span></span></p><p><span><span>But lo and behold, on Saturday it poured down again. The route planner was chaos, and you saw a cheap way to make your mark on the company. What if, instead of predicting that “tomorrow’s rainfall will be the average”, we instead predicted that “tomorrow’s rainfall will be the same as today’s measured rainfall”? How do you think this new method would compare to Eva’s?</span></span></p><p><span><span>You open up Eva’s file </span></span><code><span><span>predict_rainfall.py</span></span></code><span><span> and find:</span></span></p><p><span><span>Here, </span></span><code><span><span>predict</span></span></code><span><span> is a Python function. You give it tomorrow’s date </span></span><code><span><span>t</span></span></code><span><span>, and it returns the predicted rainfall in inches. Eva’s function always returns </span></span><code><span><span>0.14</span></span></code><span><span>.</span></span></p><p><span><span>You first change the program to fetch the true rainfall measurements from the local weather API. You put this in an array </span></span><code><span><span>M</span></span></code><span><span>, where </span></span><code><span><span>M[t]</span></span></code><span><span> is the true rainfall on date </span></span><code><span><span>t</span></span></code><span><span>.</span></span></p><p><span><span>Now you need to edit the </span></span><code><span><span>predict</span></span></code><span><span> function to say: “tomorrow’s rainfall will probably be the same as today’s measured rainfall.” Given date </span></span><code><span><span>t</span></span></code><span><span>, what should your function return?</span></span></p><p aria-hidden="true"><h2><span><span>Evaluating your model 🔬</span></span></h2></p><p><span><span>You pull an all-nighter to make this change, then go to bed. But you wake up to an unpleasant surprise: Eva is reviewing your change, and she’s annoyed that you’ve replaced her code!</span></span></p><p><span><span>So you set about to prove that your model is better, using Science 🔬. You look up the last year of rainfall in Kinshasa, and draw up a table:</span></span></p><p><span><span>Here, </span></span><code><span><span>Eva[t]</span></span></code><span><span> and </span></span><code><span><span>You[t]</span></span></code><span><span> are predictions for day </span></span><code><span><span>t</span></span></code><span><span>. Judging from the days shown, which program is better?</span></span></p><p><span><span>As always, an excellent question! Your boss says the “better” model is the one that “makes </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>C</mtext><munder accentunder="true"><mtext>ongo</mtext><mo stretchy="true">⏡</mo></munder><mtext>.com</mtext></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\Congo</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>C</span></span><span><span><span><span><span><span></span><span><span><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.342em" viewBox="0 0 400000 342" preserveAspectRatio="xMinYMin slice"><path d="M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z"></path></svg></span><span><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.342em" viewBox="0 0 400000 342" preserveAspectRatio="xMaxYMin slice"><path d="M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z"></path></svg></span></span></span><span><span></span><span><span><span>ongo</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span>.com</span></span></span></span></span></span></span></span><span><span> the most money”. However, this is rather hard to determine, so data scientists often use something called </span></span><span><b>mean squared error,</b></span><span><span> or </span></span><span><b>MSE.</b></span></p><p><span><span>For each prediction, you take the difference between the prediction and the true measurement, then square the difference. This gives you a positive number, called </span></span><span><b>squared error.</b></span><span><span> What was Eva’s squared error on Feb 16th?</span></span></p><p><span><span>You need to run  this calculation for every day in the last 12 months. The “best” model is then the one with the lowest mean squared error (MSE).</span></span></p><p><span><span>Fine, I’ll do it. When we look at twelve months of rainfall, your model’s MSE is </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.063</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.063</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.063</span></span></span></span></span></span><span><span>, and Eva’s MSE is </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.049</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.049</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.049</span></span></span></span></span></span><span><span>. So, which is better?</span></span></p><p><span><span>It seems that, although the weather has </span></span><span><i>some</i></span><span><span> tendency to follow yesterday, it has a stronger tendency to “regress to the mean”.</span></span></p><p aria-hidden="true"><h2><span><span>A weird compromise 🤝</span></span></h2></p><p><span><span>You can’t let it go: Eva’s model just looks </span></span><span><i>naïve</i></span><span><span>, and it feels like yours should work better. Eventually, after some bickering, your boss has a word with you both: “Come on, folks. What if we just averaged your two models?”:</span></span></p><p><span><span>Indeed! Surely we have to resolve this argument with science, not with politics! But to prove your point, you find the mean squared error for your manager’s suggestion, too.</span></span></p><p><span><span>To your horror, you find that the compromise model works better than either your model or Eva’s, with an MSE of just </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.044</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.044</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.044</span></span></span></span></span></span><span><span>! This is an example of the “ensemble” phenomenon: when you combine a diverse set of models, the result is often better than any of the individuals. This is particularly true when the set of models is “diverse”, because they tend to cancel out each other’s biases.</span></span></p><p aria-hidden="true"><h2><span><span>Auto-regressive models</span></span></h2></p><p><span><span>After this discovery, you and Eva decide to end your rivalry (“We were both right!”). Visiting the dusty corporate library, you find </span></span><span><i>The Old Time-Series Textbook</i></span><span><span>, where you discover that you’ve re-invented something called the “auto-regressive model”, or </span></span><span><b>AR model.</b></span></p><p><span><span>You’ve been working in Python, but all the textbooks use math notation. In time series notation, the prediction is written </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\X_{\t}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>X</span></span><span><span><span><span><span><span></span><span><span><span><span>t</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span><span><span>, the true value measurement </span></span><code><span><span>M[t]</span></span></code><span><span> can be written as </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\M_{\t}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>M</span></span><span><span><span><span><span><span></span><span><span><span><span>t</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span><span><span>, and the error is written </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϵ</mi><mi>t</mi></msub><mo>=</mo><msub><mi>M</mi><mi>t</mi></msub><mo>−</mo><msub><mi>X</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\E_{\t} = \M_{\t} - \X_{\t}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>ϵ</span></span><span><span><span><span><span><span></span><span><span><span><span>t</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span>M</span></span><span><span><span><span><span><span></span><span><span><span><span>t</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span><span><span>X</span></span><span><span><span><span><span><span></span><span><span><span><span>t</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span><span><span>. </span></span><span><i>The Textbook</i></span><span><span> says an AR model looks like:</span></span></p><p><span><span>The numbers </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\mu</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>μ</span></span></span></span></span></span><span><span> (“mu”) and </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\phi</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>ϕ</span></span></span></span></span></span><span><span> (“phi”) are called </span></span><span><b>parameters.</b></span><span><span> If you write the above “compromise” model in this notation, what are its parameters?</span></span></p><p><span><span>Your rainfall model only looks as far back as the previous day. This is called an </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>AR</mtext><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\text{AR}(1)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>AR</span></span><span>(</span><span>1</span><span>)</span></span></span></span></span></span><span><span> model. But in its general form, an </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>AR</mtext><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\text{AR}(p)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>AR</span></span><span>(</span><span>p</span><span>)</span></span></span></span></span></span><span><span> model looks back at the past </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
p</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>p</span></span></span></span></span></span><span><span> days:</span></span></p><p><span><span>The hyperparameter </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
p</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>p</span></span></span></span></span></span><span><span> is the number of days to look back. So an </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>AR</mtext><mo stretchy="false">(</mo><mi>p</mi><mo>=</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\text{AR}(p=1)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>AR</span></span><span>(</span><span>p</span><span></span><span>=</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span></span><span><span> model has </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
p+1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>p</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span></span><span><span> parameters: one </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\mu</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>μ</span></span></span></span></span></span><span><span> parameter, and then a </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\phi_i</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>ϕ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span><span><span> parameter for each day </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
i</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>i</span></span></span></span></span></span><span><span>. Think back to Eva’s simple model, </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>t</mi></msub><mo>=</mo><mn>0.14</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\X_t = 0.14</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>X</span></span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>0.14</span></span></span></span></span></span><span><span>. What is the value of </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
p</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>p</span></span></span></span></span></span><span><span> for Eva’s model?</span></span></p><p><span><span>Eva’s was an </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>AR</mtext><mo stretchy="false">(</mo><mi>p</mi><mo>=</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\text{AR}(p=0)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>AR</span></span><span>(</span><span>p</span><span></span><span>=</span><span></span></span><span><span></span><span>0</span><span>)</span></span></span></span></span></span><span><span> model, with just one parameter, </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>0.14</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\mu = 0.14</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>μ</span><span></span><span>=</span><span></span></span><span><span></span><span>0.14</span></span></span></span></span></span><span><span>. It doesn’t look back at any previous days.</span></span></p><p aria-hidden="true"><h2><span><span>Moving averages</span></span></h2></p><p><span><span>Forget the phone, we’ll come back to it! Anyway, one night, you woke up in a sweat with an idea. Eva’s simple model of “always estimate the average” turned out to be decent. But it had one weakness: an overly static idea of “the average”. What if the average changes over time? Say, due to climate change? And so what if our model could </span></span><span><i>adjust</i></span><span><span> its estimate of “the average” in response to new data?</span></span></p><p><span><span>Here’s an example. On Sunday, you predicted that on Monday it would rain the average: </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.14</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.14</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.14</span></span></span></span></span></span><span><span> inches. But on Monday, it actually rained </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.24</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.24</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.24</span></span></span></span></span></span><span><span> inches. What went wrong? Perhaps our estimated average, </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.14</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.14</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.14</span></span></span></span></span></span><span><span>, is ...</span></span></p><p><span><span>We want to continue with our strategy of just “estimate the average”, but revise our estimate of the average, closer to </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.24</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.24</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.24</span></span></span></span></span></span><span><span>. We don’t want to move it </span></span><span><i>all</i></span><span><span> the way to </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.24</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.24</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.24</span></span></span></span></span></span><span><span>: this will just result in your first model, and we’ve seen already that this performed worse. But we could move it, say, </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
10\%</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>10%</span></span></span></span></span></span><span><span> closer to </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.24</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.24</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.24</span></span></span></span></span></span><span><span>.</span></span></p><p><span><span>If you did this, what should you update your average to?</span></span></p><p><span><span>In general, we can move </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
10\%</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>10%</span></span></span></span></span></span><span><span> closer to the measurement using a </span></span><span><b>weighted average:</b></span></p><p><span><span>Since we always predict the average, </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\X_{\t}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>X</span></span><span><span><span><span><span><span></span><span><span><span><span>t</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span><span><span> stands for our prediction and our estimate of the average, and the above equation is used both for updating our average, and for making a new prediction.</span></span></p><p><span><span>After running this new model on a year of rainfall data, you find that it’s the best model yet, with an MSE of just </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.037</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.037</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.037</span></span></span></span></span></span><span><span>!</span></span></p><p><span><span>According to </span></span><span><i>The Textbook</i></span><span><span>, you’ve just invented the “moving average” (MA) model. It’s usually combined with the AR model to create the ARMA model. The simplest ARMA model is </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ARMA</mtext><mo stretchy="false">(</mo><mi>p</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mi>q</mi><mo>=</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\text{ARMA}(p=1, q=1)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>ARMA</span></span><span>(</span><span>p</span><span></span><span>=</span><span></span></span><span><span></span><span>1</span><span>,</span><span></span><span>q</span><span></span><span>=</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span></span><span><span>, which can be written as:</span></span></p><p><span><span>This adds a new term, </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><msub><mi>ϵ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\theta \E_{\t-1}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>θ</span><span><span><span>ϵ</span></span><span><span><span><span><span><span></span><span><span><span><span>t</span></span><span>−</span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span><span><span>. As before, </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϵ</mi><mi>t</mi></msub><mo>=</mo><msub><mi>M</mi><mi>t</mi></msub><mo>−</mo><msub><mi>X</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\E_{\t} = \M_{\t} - \X_{\t}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>ϵ</span></span><span><span><span><span><span><span></span><span><span><span><span>t</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span>M</span></span><span><span><span><span><span><span></span><span><span><span><span>t</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span><span><span>X</span></span><span><span><span><span><span><span></span><span><span><span><span>t</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span><span><span> is the error for day </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\t</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>t</span></span></span></span></span></span></span><span><span>. The new parameter </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\theta</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>θ</span></span></span></span></span></span><span><span> says how much to move the average.</span></span></p><p><span><span>To move our average </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
10\%</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>10%</span></span></span></span></span></span><span><span> closer to the measurement, we’ll set </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\mu = 0</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>μ</span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span></span></span><span><span> and </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\phi = 1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>ϕ</span><span></span><span>=</span><span></span></span><span><span></span><span>1</span></span></span></span></span></span><span><span>. But what should our </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\theta</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>θ</span></span></span></span></span></span><span><span> be?</span></span></p><p><span><span>In its general form, the </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ARMA</mtext><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\text{ARMA}(p,q)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>ARMA</span></span><span>(</span><span>p</span><span>,</span><span></span><span>q</span><span>)</span></span></span></span></span></span><span><span> model looks back at the past </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
p</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>p</span></span></span></span></span></span><span><span> measurements, and the last </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
q</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span></span><span><span> errors:</span></span></p><p><span><span>Now for a word of warning. Suppose you wanted to say: “tomorrow’s rainfall will be the average of the previous 31 days.” What kind of model would you express this with?</span></span></p><p aria-hidden="true"><h2><span><span>Walking with your ARMAs 🤳</span></span></h2></p><p><span><span>Snap back to your missing phone. You crack open your laptop, and find that your phone is still broadcasting data! Surely you can use this to discover the culprit. One of the data streams is from the accelerometer. The accelerometer tells you the device’s acceleration (e.g. gravity, used for automatic screen rotation). This can be formed into a time series, with the magnitude of acceleration over time. And when you’re walking, which apparently the thief is doing right now, it looks like this:</span></span></p><p><span><span>That wouldn’t hold up in court, my friend. What did Jacques do to you, anyway? No, we need to be more systematic. Luckily, you have samples of the accelerometer data for the 32 friends who were at your party:</span></span></p><p><span><span>It’s amazing how much data </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>C</mtext><munder accentunder="true"><mtext>ongo</mtext><mo stretchy="true">⏡</mo></munder><mtext>.com</mtext></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\Congo</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>C</span></span><span><span><span><span><span><span></span><span><span><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.342em" viewBox="0 0 400000 342" preserveAspectRatio="xMinYMin slice"><path d="M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z"></path></svg></span><span><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.342em" viewBox="0 0 400000 342" preserveAspectRatio="xMaxYMin slice"><path d="M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z"></path></svg></span></span></span><span><span></span><span><span><span>ongo</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span>.com</span></span></span></span></span></span></span></span><span><span> collects! 🤭 Best not speak any further of it. The question is, which of those friends generated the thief’s data? Notice that each time series repeats as the person walks, but each walk has a different shape. Your walk has enough information to determine who you are!! So, compare the thief’s accelerometer chart to each friend’s accelerometer chart. Which one is the thief most similar to?</span></span></p><p><span><span>But how can we get the computer to see the different shapes, amidst all the random vibrations and noise? Well, we can use an ARMA model to summarize each walk! Then, instead of comparing messy charts with thousands of data points, we’d just be comparing a few numbers.</span></span></p><p aria-hidden="true"><h2><span><span>Fitting the model</span></span></h2></p><p><span><span>So far, you have been finding model parameters by trial and error. This process of finding the best parameters is called </span></span><span><b>fitting.</b></span></p><p><span><span>You really don’t want to fit all 32 models by hand. Luckily, data scientists have a way to make the computer to do the hard work: </span></span><span><b>automatic function minimization.</b></span><span><span> Minimization is the most powerful dark magic in all of data science, and in your career, you will use it for everything.</span></span></p><p><span><span>In this lesson, we’ll use </span></span><a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html" target="_blank"><span><span>the </span></span><code><span><span>minimize</span></span></code><span><span> function from </span></span><code><span><span>scipy</span></span></code><span><span></span></span></a><span><span>. You give it a function, and it tries to find the input that minimizes the output. Consider the function </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>2</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
f(x) = (x-2)^2</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>f</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>x</span><span></span><span>−</span><span></span></span><span><span></span><span>2</span><span><span>)</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span></span><span><span>. Use your brain: what value of </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
x</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span></span></span><span><span> results in a minimum value of </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
f(x)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>f</span><span>(</span><span>x</span><span>)</span></span></span></span></span></span><span><span>?</span></span></p><p><span><span>Perhaps you solved that one by trial-and-error, or some clever calculus. But we can get the computer to do it for us, with no brain required! First, we write the function in Python:</span></span></p><p><span><span>Then we call </span></span><code><span><span>minimize(f, 42)</span></span></code><span><span>. The value </span></span><code><span><span>42</span></span></code><span><span> is an initial guess at the minimum, and any other value will work here. Within a blink of an eye, it will return the minimum, </span></span><code><span><span>1.99999999</span></span></code><span><span>.</span></span></p><p><span><span>No, it didn’t quite return </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
2</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>2</span></span></span></span></span></span><span><span>, but </span></span><code><span><span>1.99999999</span></span></code><span><span> is close enough for jazz. Basically, </span></span><code><span><span>minimize</span></span></code><span><span> uses trial-and-error, and stops when it finds a “good enough” answer.</span></span></p><p><span><span>The </span></span><code><span><span>minimize</span></span></code><span><span> function also works on functions with multiple parameters. Here’s an example of minimizing </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
d(x,y) = x^2 + y^2</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>d</span><span>(</span><span>x</span><span>,</span><span></span><span>y</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>y</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span></span><span><span>:</span></span></p><p><span><span>The function </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
d(x,y)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>d</span><span>(</span><span>x</span><span>,</span><span></span><span>y</span><span>)</span></span></span></span></span></span><span><span> measures the (squared) distance of a point </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
(x,y)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>(</span><span>x</span><span>,</span><span></span><span>y</span><span>)</span></span></span></span></span></span><span><span> from the origin. So what input would minimize this function?</span></span></p><p><span><span>The closest point to the origin is the origin itself, </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
(0,0)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>(</span><span>0</span><span>,</span><span></span><span>0</span><span>)</span></span></span></span></span></span><span><span>. Therefore, </span></span><code><span><span>minimize</span></span></code><span><span> returns the origin: </span></span><code><span><span>[0.000002, -0.000001]</span></span></code><span><span>.</span></span></p><p><span><span>Earlier, we were trying to find the best parameters to minimize a number called “mean squared error”. You were using trial and error. But we can do it automatically using </span></span><code><span><span>minimize</span></span></code><span><span>!</span></span></p><p><span><span>Let’s see how to do this to fit an </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ARMA</mtext><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\text{ARMA}(1,1)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>ARMA</span></span><span>(</span><span>1</span><span>,</span><span></span><span>1</span><span>)</span></span></span></span></span></span><span><span> model to the thief’s time series. First, we write a Python function for the model:</span></span></p><p><span><span>Then we write a function </span></span><code><span><span>MSE</span></span></code><span><span> which, given candidate parameters </span></span><code><span><span>mu</span></span></code><span><span>, </span></span><code><span><span>phi</span></span></code><span><span> and </span></span><code><span><span>theta</span></span></code><span><span>, runs the model on the thief timeseries, and returns the mean squared error:</span></span></p><p><span><span>Which function should we run </span></span><code><span><span>minimize</span></span></code><span><span> on?</span></span></p><p><span><span>So we run </span></span><code><span><span>minimize</span></span></code><span><span> on the </span></span><code><span><span>MSE</span></span></code><span><span> function, with an arbitrary guess at the parameters:</span></span></p><p><span><span>Quickly, it tells us the parameters that minimize the mean squared error: </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\mu = 0</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>μ</span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span></span></span><span><span>, </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mo>=</mo><mn>0.91</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\phi = 0.91</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>ϕ</span><span></span><span>=</span><span></span></span><span><span></span><span>0.91</span></span></span></span></span></span><span><span>, and </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>0.73</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\theta = 0.73</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>θ</span><span></span><span>=</span><span></span></span><span><span></span><span>0.73</span></span></span></span></span></span><span><span>. We’ve got the thief’s walking fingerprint! Now we just need to find a match in the database! 🕵️</span></span></p><p aria-hidden="true"><h2><span><span>Classifying time series</span></span></h2></p><p><span><span>Earlier, we were using the model parameters to predict the future of the time series. But another way we can use the learned parameters is as a kind of summary, signature, or fingerprint. Then we can compare one time series’ signature to the signatures of time series that we have recorded before. This is called </span></span><span><b>time series classification.</b></span></p><p><span><span>Sadly, your phone doesn’t log GPS. But that sure is convenient for me teaching you time series! So for each person’s data you get their fingerprint </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>=</mo><mo stretchy="false">(</mo><mi>μ</mi><mo separator="true">,</mo><mi>ϕ</mi><mo separator="true">,</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
F = (\mu, \phi, \theta)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>F</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>μ</span><span>,</span><span></span><span>ϕ</span><span>,</span><span></span><span>θ</span><span>)</span></span></span></span></span></span><span><span>. You can imagine each person’s fingerprint </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
F</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>F</span></span></span></span></span></span><span><span> as a point in 3D space. Here’s a 3D plot of the parameters for each friend’s fingerprint:</span></span></p><p><span><span>The point </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mtext>thief</mtext></msub><mo>=</mo><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0.91</mn><mo separator="true">,</mo><mn>0.73</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
F_{\text{thief}} = (0, 0.91, 0.73)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>F</span><span><span><span><span><span><span></span><span><span><span><span>thief</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>0</span><span>,</span><span></span><span>0.91</span><span>,</span><span></span><span>0.73</span><span>)</span></span></span></span></span></span><span><span> is plotted above in </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>red</mtext></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\red{\text{red}}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>red</span></span></span></span></span></span></span></span><span><span>. How can you determine which friend’s fingerprint it most closely matches? One way is Euclidean distance: “which known point is it closest to in 3D space?” (We just have to scale the axes a bit. Notice the points are clustered closely around </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\mu=0</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>μ</span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span></span></span><span><span>, but </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\theta</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>θ</span></span></span></span></span></span><span><span> varies much more.)</span></span></p><p><span><span>Okay, here are your friends’ distances to the thief fingerprint:</span></span></p><p><span><span>Yes, it does seem that it was your colleague, Jacques. Well done. As you can see, the computer is quite sure that it was Jacques: his distance to the thief (</span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.36</mn></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
0.36</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>0.36</span></span></span></span></span></span><span><span>) is well below every other friend’s distance. On this basis, </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>C</mtext><munder accentunder="true"><mtext>ongo</mtext><mo stretchy="true">⏡</mo></munder><mtext>.com</mtext></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\Congo</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span>C</span></span><span><span><span><span><span><span></span><span><span><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.342em" viewBox="0 0 400000 342" preserveAspectRatio="xMinYMin slice"><path d="M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z"></path></svg></span><span><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.342em" viewBox="0 0 400000 342" preserveAspectRatio="xMaxYMin slice"><path d="M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z"></path></svg></span></span></span><span><span></span><span><span><span>ongo</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span>.com</span></span></span></span></span></span></span></span><span><span> suspended Jacques pending an investigation.</span></span></p><p aria-hidden="true"><h2><span><span>Conclusion</span></span></h2></p><p><span><span>Whenever you have a problem, try expressing it as a function that </span></span><code><span><span>minimize</span></span></code><span><span> can solve. You’d be surprised how many problems can be solved this way! Even problems like “create an AI that draws amazing illustrations from a text prompt” are essentially solved by running </span></span><code><span><span>minimize</span></span></code><span><span> on a sophisticated function.</span></span></p><p><span><span>You probably noticed the privacy implications of today’s analysis. It’s concerning, although most companies don’t actually track your accelerometer. And there are many less creepy applications of time series analysis. Try applying it to your spending habits; I bet you’ll see interesting trends that you can use to predict your future spending.</span></span></p><p><span><span>Just a word of warning: there are many time series that are extremely hard to predict and can be frustrating if you’re not prepared. It sometimes feels like time series prediction is like laying down the tracks while on the front of a speeding train.</span></span></p><p aria-hidden="true"><h2><span><span>End notes</span></span></h2></p><p><span><span>For an ARMA model to work best, the time series should be stationary (that is, constant mean and variance). And it should not be seasonal (that is, it should not look like that bane of retail workers, </span></span><a href="https://trends.google.com/trends/explore?date=today%205-y&amp;q=All%20I%20Want%20For%20Christmas%20Is%20You" target="_blank"><span><span>&#34;All I Want For Christmas Is You&#34;</span></span></a><span><span>). To model more challenging series, there are many ARMA variants (see </span></span><a href="https://projecteuclid.org/journals/statistics-surveys/volume-4/issue-none/The-ARMA-alphabet-soup--A-tour-of-ARMA-model/10.1214/09-SS060.full" target="_blank"><span><span>&#34;The ARMA alphabet soup&#34;</span></span></a><span><span>), as well as </span></span><a href="https://www.youtube.com/watch?v=jnxqHcObNK4" target="_blank"><span><span>completely different ways</span></span></a><span><span> of modeling time series.</span></span></p><p><span><span>We chose </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ARMA</mtext><mo stretchy="false">(</mo><mi>p</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mi>q</mi><mo>=</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\text{ARMA}(p=1,q=1)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>ARMA</span></span><span>(</span><span>p</span><span></span><span>=</span><span></span></span><span><span></span><span>1</span><span>,</span><span></span><span>q</span><span></span><span>=</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span></span><span><span> here. You might be tempted to use bigger models like </span></span><span><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ARMA</mtext><mo stretchy="false">(</mo><mn>10</mn><mo separator="true">,</mo><mn>10</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\def\Congo{\orange{\text{C}\undergroup{\text{ongo}}\text{.com}}}
\def\t{\green{t}}
\def\X{\red{X}}
\def\M{\blue{M}}
\def\E{\orange{\epsilon}}
\text{ARMA}(10,10)</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>ARMA</span></span><span>(</span><span>10</span><span>,</span><span></span><span>10</span><span>)</span></span></span></span></span></span><span><span>, but this runs the risk of overfitting. Formulas like </span></span><a href="https://en.wikipedia.org/wiki/Akaike_information_criterion" target="_blank"><span><span>AIC</span></span></a><span><span> can help with this tradeoff.</span></span></p><p><span><span>We fitted the model by minimizing squared error. There are other ways to fit a model, such as </span></span><a href="https://en.wikipedia.org/wiki/Maximum_likelihood_estimation" target="_blank"><span><span>maximum likelihood estimation</span></span></a><span><span>. For a pre-packaged solution, see </span></span><a href="https://www.statsmodels.org/devel/generated/statsmodels.tsa.arima.model.ARIMA.fit.html" target="_blank"><span><span></span></span><code><span><span>ARIMA.fit</span></span></code><span><span></span></span></a><span><span>from the </span></span><code><span><span>statsmodels</span></span></code><span><span> package.</span></span></p><p><span><span>The </span></span><code><span><span>minimize</span></span></code><span><span> function worked well for our functions above. But minimization is a gnarly problem: it’s not guaranteed to find a global minimum, or even a local minimum. It can get stuck, or fly off to infinity, or take longer to finish than the lifetime of the universe.</span></span></p></div></div>
  </body>
</html>
