<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://matduggan.com/why-cant-my-mom-email-me/">Original</a>
    <h1>Why can&#39;t my mom email me?</h1>
    
    <div id="readability-page-1" class="page"><section>
<p>An investigation into Proton encrypted email. </p><h3 id="suddenly-silence">Suddenly Silence</h3><p>I&#39;m a big user of email, preferring long chains to messaging apps for a lot of my friends and contacts. It&#39;s nice that it isn&#39;t tied to a single device or platform and since I own my domain, I can move it from service to service whenever I want and the sender doesn&#39;t have to learn some new address. However in the last two months I suddenly stopped getting emails from a percentage of my friends and even my mom. </p><p>What I was getting instead was PGP encrypted emails with blank bodies that looked like the following:</p><figure><img src="https://matduggan.com/content/images/2024/04/image-2.png" alt="" loading="lazy" width="839" height="336" srcset="https://matduggan.com/content/images/size/w600/2024/04/image-2.png 600w, https://matduggan.com/content/images/2024/04/image-2.png 839w" sizes="(min-width: 720px) 720px"/></figure><p>If I inspected the message, it was clearly an encrypted email which Fastmail doesn&#39;t support. They have a whole blog post on why they don&#39;t here: <a href="https://www.fastmail.com/blog/why-we-dont-offer-pgp/">https://www.fastmail.com/blog/why-we-dont-offer-pgp/</a> but up to this point I haven&#39;t really cared one way or the other since nobody sends me encrypted emails. </p><p>Now I knew that Proton would send encrypted emails to <em>other Proton email addresses</em>, but obviously this isn&#39;t a Proton hosted email address which it would be able to tell pretty easily with DNS. Then it got even stranger when I tried my work email and <strong>got the same error. </strong></p><figure><img src="https://matduggan.com/content/images/2024/04/image-3.png" alt="" loading="lazy" width="736" height="364" srcset="https://matduggan.com/content/images/size/w600/2024/04/image-3.png 600w, https://matduggan.com/content/images/2024/04/image-3.png 736w" sizes="(min-width: 720px) 720px"/></figure><p>Checking the raw message and there it is, Proton has encrypted this email. Now this address is hosted on Google Workspaces, so at this point I&#39;m just baffled. Can Proton email users not send emails to people on Google Workspaces email addresses? That can&#39;t possibly be right? My friends and mom using Proton would have noticed that their emails seem to always disappear into the ether for the majority of the people they email. </p><p>I open a ticket with Fastmail hoping they&#39;ve seen this problem before, but no luck. Then I opened a ticket with Proton but didn&#39;t hear back as of the time of me writing this. </p><h3 id="how-proton-seems-to-work">How Proton Seems To Work</h3><p>So the reason why so many people I know are moving to Proton is they seem to be the only game in town that has cracked sending encrypted emails in the least annoying way possible. Their encryption uses asymmetric PGP key pairs with lookup for other users public keys happening on their key server. This in conjunction with their Key Transparency technology that compares lookup requests by the client with requests on the server-side allows for easy encrypted message exchanges with a high degree of safety, at least according to them. </p><p>There seems to be three classes of keys at Proton. </p><ul><li>User keys: encrypt account-specific stuff like contacts. Not shared.</li><li>Address keys: for encrypting messages and data. </li><li>Other keys: part of a key tree that leads back to the address key as the primary external key for people to use. </li></ul><p>So that makes sense that Proton can lookup address keys for users on their system. But where are my keys coming from? So in their Proton Key Transparency whitepaper they have this little snippet on page 10:</p><blockquote>For External Addresses, the server may return email encryption keys that it</blockquote><h3 id="what-the-hell-is-wkd">What The Hell Is WKD?</h3><p>WKD, or OpenPGP Web Key Directory is an IETF draft by Werner Koch. It describes a service where you can lookup OpenPGP keys by mail addresses using a service. It also allows the key owner and the mail provider to publish and revoke keys. The whole thing is very clever, an interesting way to get around the annoying parts of PGP encryption of email. You can read it here: <a href="https://www.ietf.org/archive/id/draft-koch-openpgp-webkey-service-16.txt">https://www.ietf.org/archive/id/draft-koch-openpgp-webkey-service-16.txt</a></p><p>It outlines an enrollment process by which I would signal to a WKD service that I have a key that I want to enroll into the process. The only problem is I never did that, or at least certainly can&#39;t remember doing that. I&#39;m certainly not hosting a page with any key verification stuff. </p><p>There seems to be a way to set a CNAME record to point towards keys.openpgp.org where I do have a key set, but that isn&#39;t set up on my domain. </p><pre><code>nslookup openpgpkey.matduggan.com
Server:		2a01:4f8:c2c:123f::1
Address:	2a01:4f8:c2c:123f::1#53

Non-authoritative answer:
*** Can&#39;t find openpgpkey.matduggan.com: No answer</code></pre><p>Source here: <a href="https://keys.openpgp.org/about/usage">https://keys.openpgp.org/about/usage</a></p><p>I can&#39;t seem to find why Proton thinks they can use this key BUT I can confirm this is the key they&#39;re encrypting the emails with. </p><figure><img src="https://matduggan.com/content/images/2024/04/image-4.png" alt="" loading="lazy" width="744" height="475" srcset="https://matduggan.com/content/images/size/w600/2024/04/image-4.png 600w, https://matduggan.com/content/images/2024/04/image-4.png 744w" sizes="(min-width: 720px) 720px"/></figure><h3 id="what">What?</h3><p>So it seems if your email address returns a key from <code>keys.openpgp.org</code> then Proton will encrypt the message with your public key from there, even though (as far as I can tell) I haven&#39;t opted into them using this service. I also can&#39;t seem to figure out a way to signal to them they shouldn&#39;t do it. </p><p>Alright so what happens if I just remove my key from <code>keys.openpgp.org</code>. The process is pretty simple, just go to: <a href="https://keys.openpgp.org/manage">https://keys.openpgp.org/manage</a> and follow the instructions in the email. It seems to work more or less instantly. </p><figure><img src="https://matduggan.com/content/images/2024/04/image-5.png" alt="" loading="lazy" width="662" height="258" srcset="https://matduggan.com/content/images/size/w600/2024/04/image-5.png 600w, https://matduggan.com/content/images/2024/04/image-5.png 662w"/></figure><p>Alright looks like we figured it out!</p><figure><img src="https://matduggan.com/content/images/2024/04/image-6.png" alt="" loading="lazy" width="870" height="218" srcset="https://matduggan.com/content/images/size/w600/2024/04/image-6.png 600w, https://matduggan.com/content/images/2024/04/image-6.png 870w" sizes="(min-width: 720px) 720px"/></figure><h3 id="proton-seriously-what-the-hell">Proton Seriously What The Hell?</h3><p>I&#39;m at a little bit of a loss here. I totally understand sending me encrypted emails if I&#39;ve gone through the steps to set the CNAME that indicates that I want to do that, but it doesn&#39;t seem like that&#39;s how the service works. As far as I can tell, the act of uploading a OpenPGP-compatible key seems to trigger their service to send it as an end-to-end encrypted message. </p><p>I&#39;ll update this with whatever I hear back from Proton but in the meantime if you stumble across this post after getting blank emails from people for months, you&#39;ll at least be able to fix it. </p><p>Is there some flag I&#39;ve accidentally set somewhere that tells Proton to send me encrypted emails? Let me know at: <a href="https://c.im/@matdevdug">https://c.im/@matdevdug</a></p>
</section></div>
  </body>
</html>
