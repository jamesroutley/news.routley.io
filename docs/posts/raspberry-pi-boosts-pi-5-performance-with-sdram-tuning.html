<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.jeffgeerling.com/blog/2024/raspberry-pi-boosts-pi-5-performance-sdram-tuning">Original</a>
    <h1>Raspberry Pi boosts Pi 5 performance with SDRAM tuning</h1>
    
    <div id="readability-page-1" class="page"><div><p><strong>tl;dr</strong> Raspberry Pi engineers tweaked SDRAM timings and other memory settings on the Pi, resulting in a 10-20% speed boost at the default 2.4 GHz clock. I of course had to test overclocking, which got me a <em>32%</em> speedup at 3.2 GHz! Changes may roll out in a firmware update for all Pi 5 and Pi 4 users soon.</p>

<p><img width="700" height="auto" src="https://www.jeffgeerling.com/sites/default/files/images/pi-5-overclock-desk-mess.jpeg" alt="Raspberry Pi 5 with SDRAM tweaks applied on desk"/></p>

<p>My quest for the <a href="https://browser.geekbench.com/v6/cpu/search?dir=desc&amp;q=Raspberry+Pi+5+Model+B&amp;sort=score">world record Geekbench 6 score on a Pi 5</a> continues, as a couple months ago <a href="https://www.martinrowan.co.uk/2024/09/raspberry-pi-5-overclocking-to-beat-geekbench-record/">Martin Rowan</a> used cooling and <a href="https://www.jeffgeerling.com/blog/2024/numa-emulation-speeds-pi-5-and-other-improvements">NUMA emulation tricks</a> to beat my then-record score.</p>

<p>But Raspberry Pi&#39;s engineers are <a href="https://forums.raspberrypi.com/viewtopic.php?t=378276">tweaking memory timings even further</a>. They&#39;ve talked to Micron and implemented a number of small tweaks that—along with NUMA emulation—really add up to a performance improvement for multi-core workloads. And even a little improvement for single-core!</p>

<blockquote>
  <p>The sdram refresh interval is currently using the default data sheet settings. You can actually monitor the temperature of the sdram and it reports if refresh at half or quarter the rate can be done. That allows the overhead due to refresh to be reduced by a half or a quarter which does improve benchmark results.</p>
  
  <p>We got in contact with Micron, and there is good news. They have said they actually test their 8GB sdram with the 4GB refresh rate timing (rather than the slower jedec timings), and so it was be safe to run the 8GB parts with 4GB timing.</p>
</blockquote>

<p>The tweaks can also give the Pi 4 a boost, but the Pi 5 improves more dramatically:</p>

<blockquote>
  <p>Pi 5 also has faster sdram, better access to sdram (i.e. wider/faster internal buses), so generally the improvements with NUMA are greater.</p>
</blockquote>

<h2>SDRAM Tweaks</h2>

<p>To get the latest RAM speedups <em>for now</em> (this may be default soon):</p>

<ol>
<li>Update the Pi&#39;s firmware to the latest version: <code>sudo rpi-update</code> (confirm with <code>Y</code>)</li>
<li>Edit the bootloader config: <code>sudo rpi-eeprom-config -e</code></li>
<li>Add the configuration <code>SDRAM_BANKLOW=1</code> (for Pi 5... for Pi 4, use <code>3</code>)</li>
<li>Reboot</li>
</ol>

<h2>NUMA Emulation</h2>

<p>Since my <a href="https://www.jeffgeerling.com/blog/2024/numa-emulation-speeds-pi-5-and-other-improvements">first post on NUMA emulation on the Pi 5</a>, the patches required have been added to Raspberry Pi&#39;s OS kernel.</p>

<p>So to use NUMA, all you have to do is make sure you&#39;re on the latest Pi OS (e.g. <code>sudo apt full-upgrade</code>).</p>

<p>To check if NUMA emulation is working, run <code>dmesg | grep NUMA</code> and make sure it says something like <code>mempolicy: NUMA default policy overridden to &#39;interleave:0-7&#39;</code>. You can tweak the settings if you want by adding <code>numa=fake=[n]</code> inside <code>/boot/firmware/cmdline.txt</code>, though the defaults <em>should</em> be appropriate for most use cases.</p>

<h2>Overclocking</h2>

<p>Following my own guide for <a href="https://www.jeffgeerling.com/blog/2023/overclocking-and-underclocking-raspberry-pi-5">overclocking the Pi 5</a>, I set the following inside <code>/boot/firmware/config.txt</code>:</p>

<pre><code>over_voltage_delta=72000
arm_freq=3200
gpu_freq=1000
</code></pre>

<p>After rebooting, I set the fan to 100%, <a href="https://github.com/geerlingguy/pi-overvolt">hacked the kernel with my pi-overvolt project</a> to boost the core voltage, and set the scaling governor to <code>performance</code>:</p>

<pre><code>$ pinctrl FAN_PWM op dl
$ cd pi-overvolt &amp;&amp; sudo ./removelimit &amp;&amp; vcgencmd cache_flush
$ echo performance | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
</code></pre>

<h2>Geekbench World Record, Part 2</h2>

<p>With just the default firmware changes, my Geekbench scores already increase quite a bit (+8% single, +18% multi). Adding a 3.2 GHz overclock on top (using my <a href="https://github.com/geerlingguy/pi-overvolt">pi-overvolt</a> hack to boost voltages), those increases go to +32% single, +31% multi, resulting in yet <a href="https://browser.geekbench.com/v6/cpu/search?dir=desc&amp;q=Raspberry+Pi+5+Model+B&amp;sort=score">another world-record Geekbench 6 score</a>!</p>

<table>
<thead>
<tr>
  <th>Geekbench Result</th>
  <th><a href="https://browser.geekbench.com/v6/cpu/9130658">Pi 5 - defaults</a></th>
  <th><a href="https://browser.geekbench.com/v6/cpu/9202663">SDRAM + NUMA</a></th>
  <th><a href="https://browser.geekbench.com/v6/cpu/9204206">3.2 GHz OC</a></th>
</tr>
</thead>
<tbody>
<tr>
  <td>Single</td>
  <td>833</td>
  <td>899 (+8%)</td>
  <td>1153 (+32%)</td>
</tr>
<tr>
  <td>Multi</td>
  <td>1805</td>
  <td>2169 (+32%)</td>
  <td>2468 (+31%)</td>
</tr>
</tbody>
</table>

<p>I also ran these tests with just an <a href="https://amzn.to/3OAkUo7">Argon THRML 30-AC Active Cooler</a>. To try to keep temps under control, I boosted the fan speed to 100%: <code>pinctrl FAN_PWM op dl</code>.</p>

<blockquote>
  <p><strong>A word on overclocking</strong>: I&#39;ve now overclocked around 20 Pi 5s, and found most to be capable of 2.6 or 2.8 GHz, and many (about half) to be capable of 3.0 GHz. But beyond that, very few can hit 3.1 GHz or beyond. More exotic overclocking (to 3.4 or 3.5 GHz) is much more difficult, and I&#39;ve only had <em>one</em> Pi 5 that even boots reliably at those speeds, with more extensive cooling. RAM timings were already not happy at those speeds, and with the extra SDRAM tweaks, I imagine extreme overclocking will be even <em>more</em> unstable.</p>
</blockquote>

<h2>Conclusion</h2>

<p>These optimizations could become default soon. I started looking into this after someone on Twitter mentioned seeing <a href="https://browser.geekbench.com/search?page=2&amp;q=raspberry+500">Pi 500 Geekbench results</a> starting in September—all seemingly with these tweaks in place already!</p>

<p>Memory speed has been a thorn in the Pi 5&#39;s side in comparison to many RK3588 boards. It&#39;s nice to see the SDRAM tweaks giving it a significant speed boost, over a year post-launch.</p>

<p>And eagle-eyed readers may note I only overclocked to 3.2 GHz instead of 3.4 GHz this time. I&#39;ll leave the door open for someone else to combine all the above tricks to hit another new WR score ;)</p></div></div>
  </body>
</html>
