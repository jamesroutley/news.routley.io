<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ofcr.se/jujutsu-merge-workflow">Original</a>
    <h1>A better merge workflow with Jujutsu</h1>
    
    <div id="readability-page-1" class="page"><div>  <h2 id="introduction">Introduction</h2>
<p>Since reading <a href="https://v5.chriskrycho.com/essays/jj-init/">Chris Krycho’s essay introduction to Jujutsu</a>, I’ve been excited about the possibilities of a more modern, user-friendly Version Control System (VCS) tool. For those of you who aren’t familiar, <a href="https://martinvonz.github.io/jj/">Jujutsu</a> (binary name: <code>jj</code>) is a new VCS which is compatible with existing Git repositories. I’ve been using Jujutsu as my daily Git driver for a while now. Though it’s still experimental software—with its fair share of bugs and unimplemented features, it has made my day-to-day interactions with Git repositories a much more pleasant experience.</p>
<p>There’s a really cool workflow that <a href="https://www.austinseipp.com/">Austin Seipp</a> shared on Jujutsu’s Discord, which I’m beginning to use everywhere, that I thought was worth writing more about. He calls it <em>The Austin™ Mega Merge Strategy<sup>®</sup></em>, but me—I’m just going to call it for what it is: a Better Workflow for Manipulating Merge Commits in Jujutsu<sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup>. This workflow makes it easy to simultaneously activate multiple branches in the same working directory.</p>
<p>Before I go through the workflow, let’s take a look at some of the basics of Jujutsu.</p>
<h2 id="a-quick-primer-on-jujutsu">A quick primer on Jujutsu</h2>
<p>There’s no better way to demonstrate a VCS than by using it on its own repository. Jujutsu is compatible with Git repositories, and <a href="https://github.com/martinvonz/jj">its own repository</a> is a Git repository as well, hosted on GitHub.</p>
<p>Here’s the terminal output of <code>jj log</code>, which displays the graph of commits in the repository:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> log</span><span> -r</span><span> ::@</span></span>
<span data-line=""><span>@  </span><span>ytr</span><span>uvzpy</span><span> benjamin@dev.ofcr.se</span><span> 11 seconds ago</span><span> e1b</span><span>74dba</span></span>
<span data-line=""><span>│  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 1 day ago</span><span> v0.16.0</span><span> HEAD@git</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>◉  </span><span>kyxs</span><span>zyrv</span><span> 49699333+dependabot[bot]@users.noreply.github.com</span><span> 1 day ago</span><span> 6826</span><span>be4a</span></span>
<span data-line=""><span>│  cargo: bump the cargo-dependencies group with 2 updates</span></span>
<span data-line=""><span>◉  </span><span>rxq</span><span>mmmry</span><span> yuya@tcha.org</span><span> 2 days ago</span><span> 363b</span><span>5084</span></span>
<span data-line=""><span>│  cli: ditch Deref, implement AsRef and Display for RevisionArg instead</span></span>
<span data-line=""><span>◉  </span><span>zyn</span><span>ytznv</span><span> yuya@tcha.org</span><span> 2 days ago</span><span> c596</span><span>d457</span></span>
<span data-line=""><span>│  cli: migrate singular parse/resolve revset argument to RevisionArg</span></span>
<span data-line=""><span>◉  </span><span>wnkpl</span><span>mms</span><span> yuya@tcha.org</span><span> 2 days ago</span><span> 311b</span><span>dbf5</span></span>
<span data-line=""><span>│  cli: use RevisionArg type in &#34;resolve -r&#34;, &#34;bench&#34;, and example command</span></span>
<span data-line=""><span>◉  </span><span>usyx</span><span>oklz</span><span> yuya@tcha.org</span><span> 2 days ago</span><span> ae91</span><span>adba</span></span>
<span data-line=""><span>│  cli: preserve RevisionArg type as much as possible</span></span>
<span data-line=""><span>◉  </span><span>prqkm</span><span>mqn</span><span> yuya@tcha.org</span><span> 2 days ago</span><span> 426e</span><span>e1c1</span></span>
<span data-line=""><span>│  cli: abuse Cow to declare RevisionArg(&#34;@&#34;) constant</span></span>
<span data-line=""><span>◉  </span><span>zrp</span><span>qktts</span><span> dev@noahmayr.com</span><span> 2 days ago</span><span> 88a4a</span><span>828</span></span>
<span data-line=""><span>│  cli: add better error message when immutable_heads() cannot be resolved</span></span>
<span data-line=""><span>◉  </span><span>nopsq</span><span>trw</span><span> dev@noahmayr.com</span><span> 2 days ago</span><span> b799</span><span>8488</span></span>
<span data-line=""><span>│  cli: only use default log revset when neither path nor revset is provided</span></span>
<span data-line=""><span>◉  </span><span>rrtls</span><span>uyn</span><span> ilyagr@users.noreply.github.com</span><span> 2 days ago</span><span> 670e</span><span>6ac6</span></span>
<span data-line=""><span>│  cmd `squash`: alias `--to` for the `--into` flag</span></span></code></pre></figure>
<p>There’s a couple of things to note, which differ from Git:</p>
<ol>
<li>
<p>Jujutsu has separate notions of changes and commits. Changes are identified by the alphabetical IDs on the left of the log, whilst commits are identified by the hexadecimal IDs on the right. When using Jujutsu’s Git backend, commits are just Git commits (the ID is the commit SHA), whereas a change is just a constant ID with an associated commit<sup><a href="#user-content-fn-2" id="user-content-fnref-2" data-footnote-ref="" aria-describedby="footnote-label">2</a></sup>.</p>
<p>Change IDs address one of the pain points of Git: what we call “amending a commit” actually creates a brand new commit object with a different ID. After amending a commit, you’d need to check the status message or go back to the commit log to get the new commit ID to address the commit again.</p>
<p>Using Jujutsu, “amending a commit” also produces a new commit object, as in Git, but the new commit has the same change ID as the original. The same ID always represent the same change, and points to the latest version of the commit, no matter how much you amend the commit history. This is really useful if you’re doing a lot of such operations.</p>
<p>(They’re also really helpful in allowing you to understand how your change has evolved over time, although we won’t be going through that much in this article.)</p>
</li>
<li>
<p>Jujutsu has a language called <a href="https://martinvonz.github.io/jj/latest/revsets/">revsets</a> (similar to <a href="https://repo.mercurial-scm.org/hg/help/revsets">Mercurial’s revsets</a>), which allows you to select commits based on given properties. <code>jj log -r [REVSET]</code> only displays the commits in the log which the revset evaluates to. <code>jj log -r ::@</code> shows all ancestors of the current working copy commit (denoted by <code>@</code>), and is the equivalent to <code>git log</code>. Revsets allow for much more succinct and expressive filters than possible in Git.</p>
</li>
<li>
<p>Jujutsu removes the concept of the index by using working copy commits. Changes made in the repository always update the working copy commit, and do not need to be separately staged and committed. Once you’re done working on a change, <code>jj commit</code> will update the commit description and create a new empty change<sup><a href="#user-content-fn-3" id="user-content-fnref-3" data-footnote-ref="" aria-describedby="footnote-label">3</a></sup>, or you can use <code>jj commit -i</code> to interactively select the changes you want and split the working copy commit into two.</p>
</li>
</ol>
<h2 id="creating-a-new-merge-commit">Creating a new merge commit</h2>
<p>In the repository, I’ve been working on a few distinct features, some of which I’ve already pushed to various branches in my fork of the repository. Let’s take a look at the commits that I’m interested in—commits for which I’m the author, and have been pushed to a remote branch:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> log</span><span> -r</span><span> &#34;mine() &amp; remote_branches()&#34;</span></span>
<span data-line=""><span>◉  </span><span>nvy</span><span>mpzuk</span><span> benjamin@dev.ofcr.se</span><span> 1 day ago</span><span> push-nvympzukzzqo</span><span> eba</span><span>c1982</span></span>
<span data-line=""><span>│  rebase: refactor to `MutRepo::set_extracted_commit` API</span></span>
<span data-line=""><span>~</span></span>
<span data-line=""> </span>
<span data-line=""><span>◉  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 2 days ago</span><span> push-uqxvnturzsuu</span><span> 932</span><span>e59d2</span></span>
<span data-line=""><span>│  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>~</span></span>
<span data-line=""> </span>
<span data-line=""><span>◉  </span><span>qkl</span><span>yrnvv</span><span> benjamin@dev.ofcr.se</span><span> 2 days ago</span><span> push-qklyrnvvuksv</span><span> 579e</span><span>cb73</span></span>
<span data-line=""><span>│  cli: print conflicted paths whenever the working copy is changed</span></span>
<span data-line=""><span>~</span></span>
<span data-line=""> </span>
<span data-line=""><span>◉  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 3 days ago</span><span> ssh-openssh</span><span> ea9</span><span>3486e</span></span>
<span data-line=""><span>│  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>~</span></span>
<span data-line=""> </span>
<span data-line=""><span>◉  </span><span>xst</span><span>wkkpp</span><span> benjamin@dev.ofcr.se</span><span> 1 month ago</span><span> push-syolynqvlwsl</span><span> 4d3</span><span>bb253</span></span>
<span data-line=""><span>│  git: Add revset alias for `trunk()` on `git clone`</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>I’d like to create a new merge commit which includes the changes from <code>zoz</code> and <code>qkl</code>. With Jujutsu, you can use <code>jj new</code> to start working on a new change, and specify any number of parent changes:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> new</span><span> zoz</span><span> qkl</span></span>
<span data-line=""><span>Working copy now at: </span><span>orl</span><span>lnptq</span><span> 5ea</span><span>75c06</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>zoz</span><span>vwmow</span><span> ea9</span><span>3486e</span><span> ssh-openssh</span><span> | </span><span>git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>Parent commit      : </span><span>qkl</span><span>yrnvv</span><span> 579e</span><span>cb73</span><span> push-qklyrnvvuksv</span><span> | </span><span>cli: print conflicted paths whenever the working copy is changed</span></span>
<span data-line=""><span>Added 0 files, modified 14 files, removed 0 files</span></span></code></pre></figure>
<p>This creates a new merge commit with the change ID of <code>orl</code>, with the 2 parents specified. Note that you can specify as many parents as you want, and Jujutsu can still merge them. (I’m only specifying 2 here, so I can add more later manually.) Here’s what the commit graph looks like at this point:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@    </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 34 seconds ago</span><span> 5ea</span><span>75c06</span></span>
<span data-line=""><span>├─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>│ ◉  </span><span>qkl</span><span>yrnvv</span><span> benjamin@dev.ofcr.se</span><span> 2 days ago</span><span> push-qklyrnvvuksv</span><span> 579e</span><span>cb73</span></span>
<span data-line=""><span>│ │  cli: print conflicted paths whenever the working copy is changed</span></span>
<span data-line=""><span>│ ~</span></span>
<span data-line=""><span>│</span></span>
<span data-line=""><span>◉  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 3 days ago</span><span> ssh-openssh</span><span> HEAD@git</span><span> ea9</span><span>3486e</span></span>
<span data-line=""><span>│  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>◉  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 3 days ago</span><span> 62</span><span>22cb24</span></span>
<span data-line=""><span>│  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<h2 id="a-new-merge-workflow">A new merge workflow?</h2>
<p><em>Merge commits</em>, you might be wondering. <em>Is that a new workflow? Can’t you just use Git for this?</em></p>
<p>Merge commits definitely aren’t anything new—nearly every modern VCS tool has merge commits. However, Jujutsu’s support for manipulating the commit graph is miles ahead of Git’s. With Jujutsu, you can merge commits without fear of modifying your repository to an unrecoverable state. Jujutsu’s <a href="https://martinvonz.github.io/jj/latest/conflicts/">first-class conflicts</a> and <a href="https://martinvonz.github.io/jj/latest/operation-log/"><code>jj undo</code></a> makes it safe to merge different branches, play around with different configurations of your code, and then restore your original changes.</p>
<p>Whether you find this article useful likely depends on how you’re using your VCS right now. If you’re just building a linear stack of commits, then this is probably not going to be very helpful. However, if you use separate branches to work on different features and group commits together for code review, then you might find this useful. (If you’ve read <a href="https://jg.gg/2018/09/29/stacked-diffs-versus-pull-requests/">Jackson Gabbard’s article on Stacked Diffs vs Pull Requests</a>, I like to think that this workflow allows you to enjoy the benefits of a Stacked Diff-like workflow of working on a single branch, but still allows you to work with code forges like GitHub which expect a Pull Request-style workflow.)</p>
<p>The gist of this workflow is basically: merge all or as many of your branches/commits together as you need, and keep that combined merge commit in your working directory.</p>
<p>Why is this useful? Some good usecases include:</p>
<ul>
<li>Testing a full build of your application with different WIP features together, to see how it operates holistically as a whole</li>
<li>Quickly fixing a bug or making a change without having to do the traditional Git dance of stashing changes and switching branches</li>
</ul>
<p>Modifying existing merge commits is difficult using Git, but is much simpler with Jujutsu. Let’s go through a few examples.</p>
<h2 id="adding-a-new-parent-from-an-existing-commit">Adding a new parent from an existing commit</h2>
<p>Here’s how to add another parent to the merge commit:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> rebase</span><span> -s</span><span> orl</span><span> -d</span><span> &#34;all:orl-&#34;</span><span> -d</span><span> wtm</span></span>
<span data-line=""><span>Rebased 1 commits</span></span>
<span data-line=""><span>Working copy now at: </span><span>orl</span><span>lnptq</span><span> dd20</span><span>e255</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>qkl</span><span>yrnvv</span><span> 579e</span><span>cb73</span><span> push-qklyrnvvuksv</span><span> | </span><span>cli: print conflicted paths whenever the working copy is changed</span></span>
<span data-line=""><span>Parent commit      : </span><span>zoz</span><span>vwmow</span><span> ea9</span><span>3486e</span><span> ssh-openssh</span><span> | </span><span>git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>Parent commit      : </span><span>wtm</span><span>qulxn</span><span> 932</span><span>e59d2</span><span> push-uqxvnturzsuu</span><span> | </span><span>rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>Added 0 files, modified 3 files, removed 0 files</span></span></code></pre></figure>
<p>This command rebases the commit with change ID <code>orl</code> and all its descendants on top of all the given destinations. The given destinations here were <code>all:orl-</code>, which means all of <code>orl</code>’s existing parents, as well as the new destination of <code>wtm</code>. We’ve now got a new merge commit with the 2 original parents and the new one:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@      </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 20 seconds ago</span><span> dd20</span><span>e255</span></span>
<span data-line=""><span>├─┬─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>│ │ ◉  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 2 days ago</span><span> push-uqxvnturzsuu</span><span> 932</span><span>e59d2</span></span>
<span data-line=""><span>│ │ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>│ │ ◉  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 2 days ago</span><span> 2ac</span><span>431c5</span></span>
<span data-line=""><span>│ │ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>│ │ ◉  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 2 days ago</span><span> ecf</span><span>4a6e8</span></span>
<span data-line=""><span>│ │ │  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>│ │ ~</span></span>
<span data-line=""><span>│ │</span></span>
<span data-line=""><span>│ ◉  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 3 days ago</span><span> ssh-openssh</span><span> ea9</span><span>3486e</span></span>
<span data-line=""><span>│ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ ◉  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 3 days ago</span><span> 62</span><span>22cb24</span></span>
<span data-line=""><span>│ │  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>│ ~</span></span>
<span data-line=""><span>│</span></span>
<span data-line=""><span>◉  </span><span>qkl</span><span>yrnvv</span><span> benjamin@dev.ofcr.se</span><span> 2 days ago</span><span> push-qklyrnvvuksv</span><span> HEAD@git</span><span> 579e</span><span>cb73</span></span>
<span data-line=""><span>│  cli: print conflicted paths whenever the working copy is changed</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>If you’ve got any other commits on top of the one you specified for <code>-s</code>, Jujutsu also correctly rebases all of the original commit’s descendants on top of the new commit, so you don’t have to worry about those commits going out of sync.</p>
<h2 id="rebasing-all-parents">Rebasing all parents</h2>
<p>In this case, I realized that all my feature branches were outdated, and I’d like to rebase them on top of <code>main</code>. Here’s the command to do that:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> rebase</span><span> -s</span><span> &#39;all:roots(main..@)&#39;</span><span> -d</span><span> main</span></span>
<span data-line=""><span>Rebased 9 commits</span></span>
<span data-line=""><span>Working copy now at: </span><span>orl</span><span>lnptq</span><span> 6e4</span><span>f5799</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>qkl</span><span>yrnvv</span><span> 28a</span><span>f9083</span><span> push-qklyrnvvuksv*</span><span> | </span><span>cli: print conflicted paths whenever the working copy is changed</span></span>
<span data-line=""><span>Parent commit      : </span><span>zoz</span><span>vwmow</span><span> c6c</span><span>73906</span><span> ssh-openssh*</span><span> | </span><span>git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>Parent commit      : </span><span>wtm</span><span>qulxn</span><span> 867</span><span>3733e</span><span> push-uqxvnturzsuu*</span><span> | </span><span>rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>Added 0 files, modified 3 files, removed 0 files</span></span></code></pre></figure>
<p>The syntax is a bit of a doozy, but can be better understood by breaking it down part-by-part:</p>
<ol>
<li><code>main..@</code>: This finds all ancestors of <code>@</code>, the working copy commit, which are not ancestors of main. (By coincidence, my default configured revset for <code>jj log</code> shows exactly all the commits in the <code>main..@</code> set.)</li>
<li><code>roots(main..@)</code>: This gets the roots of commits in <code>main..@</code> set, which are commits that do not have any ancestors within the set. This evaluates to the first commit of each arm of the merge commit in the log above (<code>qkl</code>, <code>yow</code>, and <code>zoz</code>).</li>
<li><code>all:roots(main..@)</code>: The <code>all</code> prefix is required since <code>-s</code> expects a single commit by default, but <code>roots(main..@)</code> evaluates to multiple commits.</li>
</ol>
<p>Each of these 3 commits are rebased on top of the destination, <code>main</code>, and have their descendants automatically rebased as well. This results in a subgraph where the root is <code>main</code>, and the leaf is the merge commit with its 3 parents:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@      </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> 6e4</span><span>f5799</span></span>
<span data-line=""><span>├─┬─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>│ │ ◉  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> push-uqxvnturzsuu*</span><span> 867</span><span>3733e</span></span>
<span data-line=""><span>│ │ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>│ │ ◉  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> dd7</span><span>454a2</span></span>
<span data-line=""><span>│ │ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>│ │ ◉  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> 0a94</span><span>9714</span></span>
<span data-line=""><span>│ │ │  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>│ ◉ │  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> ssh-openssh*</span><span> c6c</span><span>73906</span></span>
<span data-line=""><span>│ │ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ ◉ │  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> ffe</span><span>c92c9</span></span>
<span data-line=""><span>│ ├─╯  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>◉ │  </span><span>qkl</span><span>yrnvv</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> push-qklyrnvvuksv*</span><span> HEAD@git</span><span> 28a</span><span>f9083</span></span>
<span data-line=""><span>├─╯  cli: print conflicted paths whenever the working copy is changed</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 1 day ago</span><span> main*</span><span> v0.16.0</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>Here, we’ve automatically rebased all the changes we’re interested in with just a single command! 😲</p>
<h2 id="adding-a-new-parent-from-new-changes">Adding a new parent from new changes</h2>
<p>Whilst testing out the features from these different changes, you might want to work on a new change. Instead of having to check out a new branch as you would in Git, you can just work on the new change on top of this merge commit:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> new</span></span>
<span data-line=""><span>Working copy now at: </span><span>rwq</span><span>ywnzl</span><span> 461</span><span>d45c8</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>orl</span><span>lnptq</span><span> 6e4</span><span>f5799</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> nvim</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> commit</span><span> -m</span><span> &#34;new: avoid manual `unwrap()` call&#34;</span></span>
<span data-line=""><span>Working copy now at: </span><span>ovy</span><span>pxnus</span><span> e0c</span><span>160c9</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>rwq</span><span>ywnzl</span><span> 919</span><span>fae76</span><span> new: avoid manual `unwrap()` call</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> show</span><span> rwq</span></span>
<span data-line=""><span>Commit ID: </span><span>919fae76dccba57d1df3df3125f4d4eac6676ce9</span></span>
<span data-line=""><span>Change ID: </span><span>rwqywnzlzmnoqrqkosupxwtyrxumymxs</span></span>
<span data-line=""><span>Author: Benjamin Tan &lt;</span><span>benjamin@dev.ofcr.se</span><span>&gt; (</span><span>23 hours ago</span><span>)</span></span>
<span data-line=""><span>Committer: Benjamin Tan &lt;</span><span>benjamin@dev.ofcr.se</span><span>&gt; (</span><span>23 hours ago</span><span>)</span></span>
<span data-line=""> </span>
<span data-line=""><span>    new: avoid manual `unwrap()` call</span></span>
<span data-line=""> </span>
<span data-line=""><span>diff --git a/cli/src/commands/new.rs b/cli/src/commands/new.rs</span></span>
<span data-line=""><span>index eeeb50aee6...e0defba129 100644</span></span>
<span data-line=""><span>--- a/cli/src/commands/new.rs</span></span>
<span data-line=""><span>+++ b/cli/src/commands/new.rs</span></span>
<span data-line=""><span>@@ -193,7 +193,7 @@</span></span>
<span data-line=""><span>             writeln!(formatter)?;</span></span>
<span data-line=""><span>         }</span></span>
<span data-line=""><span>     } else {</span></span>
<span data-line=""><span>-        tx.edit(&amp;new_commit).unwrap();</span></span>
<span data-line=""><span>+        tx.edit(&amp;new_commit)?;</span></span>
<span data-line=""><span>         // The description of the new commit will be printed by tx.finish()</span></span>
<span data-line=""><span>     }</span></span>
<span data-line=""><span>     if num_rebased &gt; 0 {</span></span></code></pre></figure>
<p>Here’s the updated commit graph, with the new commit (change ID <code>rwq</code>) as a child of the merge commit:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@  </span><span>ovy</span><span>pxnus</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> e0c</span><span>160c9</span></span>
<span data-line=""><span>│  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line="" data-highlighted-line=""><span>◉  </span><span>rwq</span><span>ywnzl</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> HEAD@git</span><span> 919</span><span>fae76</span></span>
<span data-line="" data-highlighted-line=""><span>│  new: avoid manual `unwrap()` call</span></span>
<span data-line=""><span>◉      </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 15 minutes ago</span><span> 6e4</span><span>f5799</span></span>
<span data-line=""><span>├─┬─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>│ │ ◉  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 15 minutes ago</span><span> push-uqxvnturzsuu*</span><span> 867</span><span>3733e</span></span>
<span data-line=""><span>│ │ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>│ │ ◉  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 15 minutes ago</span><span> dd7</span><span>454a2</span></span>
<span data-line=""><span>│ │ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>│ │ ◉  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 15 minutes ago</span><span> 0a94</span><span>9714</span></span>
<span data-line=""><span>│ │ │  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>│ ◉ │  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 15 minutes ago</span><span> ssh-openssh*</span><span> c6c</span><span>73906</span></span>
<span data-line=""><span>│ │ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ ◉ │  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 15 minutes ago</span><span> ffe</span><span>c92c9</span></span>
<span data-line=""><span>│ ├─╯  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>◉ │  </span><span>qkl</span><span>yrnvv</span><span> benjamin@dev.ofcr.se</span><span> 15 minutes ago</span><span> push-qklyrnvvuksv*</span><span> 28a</span><span>f9083</span></span>
<span data-line=""><span>├─╯  cli: print conflicted paths whenever the working copy is changed</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 1 day ago</span><span> main*</span><span> v0.16.0</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>Although this change was made on top of the merge commit, you typically wouldn’t want to leave it there for long. You’d likely want to rebase it to a better location (not on top of the mega merge commit), before sending the change up for code review. For example, you can first rebase the new change onto <code>main</code>:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> rebase</span><span> -r</span><span> rwq</span><span> -d</span><span> main</span></span>
<span data-line=""><span>Also rebased 1 descendant commits onto parent of rebased commit</span></span>
<span data-line=""><span>Working copy now at: </span><span>ovy</span><span>pxnus</span><span> 68ba</span><span>cc1f</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>orl</span><span>lnptq</span><span> 6e4</span><span>f5799</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Added 0 files, modified 1 files, removed 0 files</span></span></code></pre></figure>
<p>The <code>-r</code> option rebases only the given revision on top of the destination; it rebases all of its descendants on top of its parents. Effectively, this is similar to moving a commit to another location in the graph.</p>
<p>After rebasing onto <code>main</code>, you can then add <code>rwq</code> as a new parent of the merge commit to keep the change applied to your working directory:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> rebase</span><span> -s</span><span> orl</span><span> -d</span><span> &#34;all:orl-&#34;</span><span> -d</span><span> rwq</span></span>
<span data-line=""><span>Rebased 2 commits</span></span>
<span data-line=""><span>Working copy now at: </span><span>ovy</span><span>pxnus</span><span> 7f2</span><span>78c0d</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>orl</span><span>lnptq</span><span> 7b0</span><span>28dc9</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Added 0 files, modified 1 files, removed 0 files</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@  </span><span>ovy</span><span>pxnus</span><span> benjamin@dev.ofcr.se</span><span> 18 seconds ago</span><span> 7f2</span><span>78c0d</span></span>
<span data-line=""><span>│  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>◉        </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 18 seconds ago</span><span> HEAD@git</span><span> 7b0</span><span>28dc9</span></span>
<span data-line=""><span>├─┬─┬─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line="" data-highlighted-line=""><span>│ │ │ ◉  </span><span>rwq</span><span>ywnzl</span><span> benjamin@dev.ofcr.se</span><span> 47 seconds ago</span><span> 402</span><span>f7ad8</span></span>
<span data-line="" data-highlighted-line=""><span>│ │ │ │  new: avoid manual `unwrap()` call</span></span>
<span data-line=""><span>│ │ ◉ │  </span><span>qkl</span><span>yrnvv</span><span> benjamin@dev.ofcr.se</span><span> 23 minutes ago</span><span> push-qklyrnvvuksv*</span><span> 28a</span><span>f9083</span></span>
<span data-line=""><span>│ │ ├─╯  cli: print conflicted paths whenever the working copy is changed</span></span>
<span data-line=""><span>│ ◉ │  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 23 minutes ago</span><span> ssh-openssh*</span><span> c6c</span><span>73906</span></span>
<span data-line=""><span>│ │ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ ◉ │  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 23 minutes ago</span><span> ffe</span><span>c92c9</span></span>
<span data-line=""><span>│ ├─╯  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>◉ │  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 23 minutes ago</span><span> push-uqxvnturzsuu*</span><span> 867</span><span>3733e</span></span>
<span data-line=""><span>│ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>◉ │  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 23 minutes ago</span><span> dd7</span><span>454a2</span></span>
<span data-line=""><span>│ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>◉ │  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 23 minutes ago</span><span> 0a94</span><span>9714</span></span>
<span data-line=""><span>├─╯  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 1 day ago</span><span> main*</span><span> v0.16.0</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>This persists the change in the working directory, whilst extracting it to a standalone commit on top of the main branch which can be sent for code review. Here’s how you can create a branch and push to an upstream repository (GitHub in this case):</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> branch</span><span> create</span><span> test</span><span> -r</span><span> rwq</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> git</span><span> push</span><span> --remote</span><span> bnjmnt4n</span><span> --branch</span><span> test</span></span>
<span data-line=""><span>Branch changes to push to bnjmnt4n:</span></span>
<span data-line=""><span>  Add branch test to 402f7ad8b9bd</span></span>
<span data-line=""><span>remote:</span></span>
<span data-line=""><span>remote: Create a pull request for &#39;test&#39; on GitHub by visiting:</span></span>
<span data-line=""><span>remote:      https://github.com/bnjmnt4n/jj/pull/new/test</span></span>
<span data-line=""><span>remote:</span></span></code></pre></figure>
<h2 id="moving-a-change-to-a-parent">Moving a change to a parent</h2>
<p>Another possible scenario is that you’ve made some modifications to your working copy, and want to shift the commit into one of the arms of the merge commit.</p>
<p>This is what the commit graph looks like after making the change:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> nvim</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> commit</span><span> -m</span><span> &#34;test change&#34;</span></span>
<span data-line=""><span>Working copy now at: </span><span>uyl</span><span>louwm</span><span> e9f</span><span>ebf2c</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>ovy</span><span>pxnus</span><span> e99</span><span>d7578</span><span> misc: test change</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@  </span><span>uyl</span><span>louwm</span><span> benjamin@dev.ofcr.se</span><span> 13 seconds ago</span><span> e9f</span><span>ebf2c</span></span>
<span data-line=""><span>│  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line="" data-highlighted-line=""><span>◉  </span><span>ovy</span><span>pxnus</span><span> benjamin@dev.ofcr.se</span><span> 13 seconds ago</span><span> HEAD@git</span><span> e99</span><span>d7578</span></span>
<span data-line="" data-highlighted-line=""><span>│  misc: test change</span></span>
<span data-line=""><span>◉        </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> 7b0</span><span>28dc9</span></span>
<span data-line=""><span>├─┬─┬─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>│ │ │ ◉  </span><span>rwq</span><span>ywnzl</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> test</span><span> 402</span><span>f7ad8</span></span>
<span data-line=""><span>│ │ │ │  new: avoid manual `unwrap()` call</span></span>
<span data-line=""><span>│ │ ◉ │  </span><span>qkl</span><span>yrnvv</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> push-qklyrnvvuksv*</span><span> 28a</span><span>f9083</span></span>
<span data-line=""><span>│ │ ├─╯  cli: print conflicted paths whenever the working copy is changed</span></span>
<span data-line=""><span>│ ◉ │  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> ssh-openssh*</span><span> c6c</span><span>73906</span></span>
<span data-line=""><span>│ │ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ ◉ │  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> ffe</span><span>c92c9</span></span>
<span data-line=""><span>│ ├─╯  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>◉ │  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> push-uqxvnturzsuu*</span><span> 867</span><span>3733e</span></span>
<span data-line=""><span>│ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>◉ │  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> dd7</span><span>454a2</span></span>
<span data-line=""><span>│ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>◉ │  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> 0a94</span><span>9714</span></span>
<span data-line=""><span>├─╯  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 1 day ago</span><span> main*</span><span> v0.16.0</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>There’s a new change <code>ovy</code> which we want to set as the child of our previous change <code>rwq</code>, then update the branch <code>test</code> to point to <code>ovy</code>. There’s two possible ways to do this right now using Jujutsu:</p>
<ol>
<li>Rebase <code>ovy</code> onto <code>rwq</code>, rebase the merge commit to point to <code>ovy</code> instead of <code>rwq</code>, then update the branch <code>test</code> to point to <code>ovy</code>.</li>
<li>Create a new commit after <code>rwq</code>, squash the changes from <code>ovy</code> into it, then update the branch <code>test</code> to point to <code>ovy</code>.</li>
</ol>
<p>The first way is similar to what’s already been done above, so I’ll show the second way of doing this. First, we insert a new commit after <code>rwq</code>, making sure to specify <code>--no-edit</code> to avoid checking out the changes in <code>rwq</code>:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> new</span><span> --after</span><span> rwq</span><span> --no-edit</span></span>
<span data-line=""><span>Created new commit </span><span>lqksr</span><span>tkk</span><span> 6a3</span><span>8dd7a</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Rebased 3 descendant commits</span></span>
<span data-line=""><span>Working copy now at: </span><span>uyl</span><span>louwm</span><span> 355e</span><span>a4ba</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>ovy</span><span>pxnus</span><span> 27b</span><span>af0ef</span><span> misc: test change</span></span></code></pre></figure>
<p>A new, empty commit with change ID <code>lqks</code> was created after <code>rwq</code>. Note how <code>lqks</code> was correctly inserted between <code>orl</code> and <code>rwq</code>, maintaining the ancestry of the merge commit:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@  </span><span>uyl</span><span>louwm</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> 355e</span><span>a4ba</span></span>
<span data-line=""><span>│  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>◉  </span><span>ovy</span><span>pxnus</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> HEAD@git</span><span> 27b</span><span>af0ef</span></span>
<span data-line=""><span>│  misc: test change</span></span>
<span data-line=""><span>◉        </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> 8c48</span><span>6dfd</span></span>
<span data-line=""><span>├─┬─┬─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line="" data-highlighted-line=""><span>│ │ │ ◉  </span><span>lqks</span><span>rtkk</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> 6a3</span><span>8dd7a</span></span>
<span data-line="" data-highlighted-line=""><span>│ │ │ │  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>│ │ │ ◉  </span><span>rwq</span><span>ywnzl</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> test</span><span> 402</span><span>f7ad8</span></span>
<span data-line=""><span>│ │ │ │  new: avoid manual `unwrap()` call</span></span>
<span data-line=""><span>│ │ ◉ │  </span><span>qkl</span><span>yrnvv</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> push-qklyrnvvuksv*</span><span> 28a</span><span>f9083</span></span>
<span data-line=""><span>│ │ ├─╯  cli: print conflicted paths whenever the working copy is changed</span></span>
<span data-line=""><span>│ ◉ │  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> ssh-openssh*</span><span> c6c</span><span>73906</span></span>
<span data-line=""><span>│ │ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ ◉ │  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> ffe</span><span>c92c9</span></span>
<span data-line=""><span>│ ├─╯  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>◉ │  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> push-uqxvnturzsuu*</span><span> 867</span><span>3733e</span></span>
<span data-line=""><span>│ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>◉ │  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> dd7</span><span>454a2</span></span>
<span data-line=""><span>│ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>◉ │  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> 0a94</span><span>9714</span></span>
<span data-line=""><span>├─╯  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 1 day ago</span><span> main*</span><span> v0.16.0</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>Next, we can “squash” or move the changes from <code>ovy</code> into <code>lqks</code>. This is followed by updating the branch <code>test</code> to point to <code>lqks</code>:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> squash</span><span> --from</span><span> ovy</span><span> --into</span><span> lqks</span></span>
<span data-line=""><span>Rebased 2 descendant commits</span></span>
<span data-line=""><span>Working copy now at: </span><span>uyl</span><span>louwm</span><span> 23f</span><span>02b9f</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>orl</span><span>lnptq</span><span> ec8</span><span>3f9fc</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> branch</span><span> set</span><span> test</span><span> -r</span><span> lqks</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@  </span><span>uyl</span><span>louwm</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> 23f</span><span>02b9f</span></span>
<span data-line=""><span>│  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>◉        </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> HEAD@git</span><span> ec8</span><span>3f9fc</span></span>
<span data-line=""><span>├─┬─┬─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line="" data-highlighted-line=""><span>│ │ │ ◉  </span><span>lqks</span><span>rtkk</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> test*</span><span> 07d</span><span>8a576</span></span>
<span data-line="" data-highlighted-line=""><span>│ │ │ │  misc: test change</span></span>
<span data-line=""><span>│ │ │ ◉  </span><span>rwq</span><span>ywnzl</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> test@bnjmnt4n</span><span> 402</span><span>f7ad8</span></span>
<span data-line=""><span>│ │ │ │  new: avoid manual `unwrap()` call</span></span>
<span data-line=""><span>│ │ ◉ │  </span><span>qkl</span><span>yrnvv</span><span> benjamin@dev.ofcr.se</span><span> 2 hours ago</span><span> push-qklyrnvvuksv*</span><span> 28a</span><span>f9083</span></span>
<span data-line=""><span>│ │ ├─╯  cli: print conflicted paths whenever the working copy is changed</span></span>
<span data-line=""><span>│ ◉ │  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 2 hours ago</span><span> ssh-openssh*</span><span> c6c</span><span>73906</span></span>
<span data-line=""><span>│ │ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ ◉ │  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 2 hours ago</span><span> ffe</span><span>c92c9</span></span>
<span data-line=""><span>│ ├─╯  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>◉ │  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 2 hours ago</span><span> push-uqxvnturzsuu*</span><span> 867</span><span>3733e</span></span>
<span data-line=""><span>│ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>◉ │  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 2 hours ago</span><span> dd7</span><span>454a2</span></span>
<span data-line=""><span>│ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>◉ │  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 2 hours ago</span><span> 0a94</span><span>9714</span></span>
<span data-line=""><span>├─╯  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 1 day ago</span><span> main*</span><span> v0.16.0</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>The log now shows that <code>test@bnjmnt4n</code> (the branch <code>test</code> on the remote <code>bnjmnt4n</code>) points to the previous commit, whilst <code>test</code> is pointing to the commit with change ID <code>orl</code>. The <code>*</code> indicator shows that the branch has been updated, but isn’t consistent with the remote.</p>
<p>The biggest downside of the <code>jj squash</code> workflow is that the change ID of the squashed commit is lost. You’ll need to refer to the change ID of the newly created commit instead.</p>
<p>However, there are <a href="https://github.com/martinvonz/jj/issues/1188">plans</a> to improve Jujutsu to make it easier to move commits around the commit graph. In the future, a command like <code>jj rebase -r ovy --after rwq</code> might be able to move the commit whilst maintaining its chnage ID.</p>
<h2 id="removing-parents">Removing parents</h2>
<p>Again, we can use <code>jj rebase</code> (and a small change to the revset) to remove parents from a merge commit:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> rebase</span><span> -s</span><span> orl</span><span> -d</span><span> &#34;all:orl- ~ qkl&#34;</span></span>
<span data-line=""><span>Rebased 2 commits</span></span>
<span data-line=""><span>Working copy now at: </span><span>uyl</span><span>louwm</span><span> 521</span><span>e9749</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>orl</span><span>lnptq</span><span> 090</span><span>ffb0d</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Added 0 files, modified 9 files, removed 0 files</span></span></code></pre></figure>
<p>Previously, when adding new parents, we’ve specified the destinations using the flags <code>-d &#34;all:orl-&#34; -d NEW_PARENT_ID</code>. Now, we’re specifying the destinations using <code>-d &#34;all:orl- ~ qkl&#34;</code>. The new argument for the destination highlights more of the revset language, in particular the set difference operator. As before, <code>orl-</code> evaluates to the set of all parents of <code>orl</code>, but <code>~ qkl</code> now subtracts <code>qkl</code> from that set.</p>
<p>This has the effect of removing <code>qkl</code> from the merge commit:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@  </span><span>uyl</span><span>louwm</span><span> benjamin@dev.ofcr.se</span><span> 14 seconds ago</span><span> 521</span><span>e9749</span></span>
<span data-line=""><span>│  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>◉      </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 14 seconds ago</span><span> HEAD@git</span><span> 090</span><span>ffb0d</span></span>
<span data-line=""><span>├─┬─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>│ │ ◉  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 2 hours ago</span><span> ssh-openssh*</span><span> c6c</span><span>73906</span></span>
<span data-line=""><span>│ │ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ │ ◉  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 2 hours ago</span><span> ffe</span><span>c92c9</span></span>
<span data-line=""><span>│ │ │  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>│ ◉ │  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 2 hours ago</span><span> push-uqxvnturzsuu*</span><span> 867</span><span>3733e</span></span>
<span data-line=""><span>│ │ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>│ ◉ │  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 2 hours ago</span><span> dd7</span><span>454a2</span></span>
<span data-line=""><span>│ │ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>│ ◉ │  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 2 hours ago</span><span> 0a94</span><span>9714</span></span>
<span data-line=""><span>│ ├─╯  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>◉ │  </span><span>lqks</span><span>rtkk</span><span> benjamin@dev.ofcr.se</span><span> 6 minutes ago</span><span> test*</span><span> 07d</span><span>8a576</span></span>
<span data-line=""><span>│ │  misc: test change</span></span>
<span data-line=""><span>◉ │  </span><span>rwq</span><span>ywnzl</span><span> benjamin@dev.ofcr.se</span><span> 1 hour ago</span><span> test@bnjmnt4n</span><span> 402</span><span>f7ad8</span></span>
<span data-line=""><span>├─╯  new: avoid manual `unwrap()` call</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 1 day ago</span><span> main*</span><span> v0.16.0</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>(Likewise, we could also have used set operations to add new parents to the merge commit: <code>jj rebase -d &#34;all:orl- | NEW_PARENT_ID&#34;</code> uses the set union operator to add the new ID to the set of existing parents.)</p>
<h2 id="conflicting-changes">Conflicting changes</h2>
<p>What happens if you update something in the working directory, which you want to shift to a specific parent of the merge commit, but it actually conflicts with another change you made in another parent?</p>
<p>Here, I’ve committed a change which modifies the same lines as the previous commit <code>rwq</code>:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> commit</span><span> -m</span><span> &#34;conflicting change&#34;</span></span>
<span data-line=""><span>Working copy now at: </span><span>ywr</span><span>yozyt</span><span> 7fd</span><span>247f5</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>uyl</span><span>louwm</span><span> 128</span><span>d5444</span><span> conflicting change</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> show</span><span> uyl</span></span>
<span data-line=""><span>Commit ID: </span><span>e8cc1f87020ecfabc4fa4b44a6a8a8d67a5de23c</span></span>
<span data-line=""><span>Change ID: </span><span>uyllouwmkkkkrkvtzynuqwuqvxsrmpvx</span></span>
<span data-line=""><span>Author: Benjamin Tan &lt;</span><span>benjamin@dev.ofcr.se</span><span>&gt; (</span><span>21 hours ago</span><span>)</span></span>
<span data-line=""><span>Committer: Benjamin Tan &lt;</span><span>benjamin@dev.ofcr.se</span><span>&gt; (</span><span>20 minutes ago</span><span>)</span></span>
<span data-line=""> </span>
<span data-line=""><span>    (no description set)</span></span>
<span data-line=""> </span>
<span data-line=""><span>diff --git a/cli/src/commands/new.rs b/cli/src/commands/new.rs</span></span>
<span data-line=""><span>index e0defba129...b946b93769 100644</span></span>
<span data-line=""><span>--- a/cli/src/commands/new.rs</span></span>
<span data-line=""><span>+++ b/cli/src/commands/new.rs</span></span>
<span data-line=""><span>@@ -193,7 +193,8 @@</span></span>
<span data-line=""><span>             writeln!(formatter)?;</span></span>
<span data-line=""><span>         }</span></span>
<span data-line=""><span>     } else {</span></span>
<span data-line=""><span>-        tx.edit(&amp;new_commit)?;</span></span>
<span data-line=""><span>+        let commit = new_commit;</span></span>
<span data-line=""><span>+        tx.edit(&amp;commit).unwrap();</span></span>
<span data-line=""><span>         // The description of the new commit will be printed by tx.finish()</span></span>
<span data-line=""><span>     }</span></span>
<span data-line=""><span>     if num_rebased &gt; 0 {</span></span></code></pre></figure>
<p>Here’s the updated commit graph now, with <code>uyl</code> containing the change and no longer being empty:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@  </span><span>ywr</span><span>yozyt</span><span> benjamin@dev.ofcr.se</span><span> 35 seconds ago</span><span> 7fd</span><span>247f5</span></span>
<span data-line=""><span>│  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line="" data-highlighted-line=""><span>◉  </span><span>uyl</span><span>louwm</span><span> benjamin@dev.ofcr.se</span><span> 35 seconds ago</span><span> HEAD@git</span><span> 128</span><span>d5444</span></span>
<span data-line="" data-highlighted-line=""><span>│  conflicting change</span></span>
<span data-line=""><span>◉      </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 21 hours ago</span><span> 090</span><span>ffb0d</span></span>
<span data-line=""><span>├─┬─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>│ │ ◉  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> ssh-openssh*</span><span> c6c</span><span>73906</span></span>
<span data-line=""><span>│ │ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ │ ◉  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> ffe</span><span>c92c9</span></span>
<span data-line=""><span>│ │ │  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>│ ◉ │  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> push-uqxvnturzsuu*</span><span> 867</span><span>3733e</span></span>
<span data-line=""><span>│ │ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>│ ◉ │  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> dd7</span><span>454a2</span></span>
<span data-line=""><span>│ │ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>│ ◉ │  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> 0a94</span><span>9714</span></span>
<span data-line=""><span>│ ├─╯  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>◉ │  </span><span>lqks</span><span>rtkk</span><span> benjamin@dev.ofcr.se</span><span> 21 hours ago</span><span> test*</span><span> 07d</span><span>8a576</span></span>
<span data-line=""><span>│ │  misc: test change</span></span>
<span data-line=""><span>◉ │  </span><span>rwq</span><span>ywnzl</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> test@bnjmnt4n</span><span> 402</span><span>f7ad8</span></span>
<span data-line=""><span>├─╯  new: avoid manual `unwrap()` call</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 2 days ago</span><span> main*</span><span> v0.16.0</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>I now want to shift this new commit into the arm of the merge commit with <code>zoz</code> (the <code>ssh-openssh</code> branch), so I create a new, empty commit after <code>zoz</code>:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> new</span><span> --after</span><span> zoz</span><span> --no-edit</span></span>
<span data-line=""><span>Created new commit </span><span>txs</span><span>rozwq</span><span> ae4f</span><span>dff5</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Rebased 5 descendant commits</span></span>
<span data-line=""><span>Working copy now at: </span><span>ywr</span><span>yozyt</span><span> e1f</span><span>a0851</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>uyl</span><span>louwm</span><span> 454</span><span>caf02</span><span> conflicting change</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@  </span><span>ywr</span><span>yozyt</span><span> benjamin@dev.ofcr.se</span><span> 5 seconds ago</span><span> e1f</span><span>a0851</span></span>
<span data-line=""><span>│  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>◉  </span><span>uyl</span><span>louwm</span><span> benjamin@dev.ofcr.se</span><span> 6 seconds ago</span><span> HEAD@git</span><span> 454</span><span>caf02</span></span>
<span data-line=""><span>│  conflicting change</span></span>
<span data-line=""><span>◉      </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 6 seconds ago</span><span> fabc</span><span>ecf1</span></span>
<span data-line=""><span>├─┬─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line="" data-highlighted-line=""><span>│ │ ◉  </span><span>txs</span><span>rozwq</span><span> benjamin@dev.ofcr.se</span><span> 6 seconds ago</span><span> ae4</span><span>fdff5</span></span>
<span data-line="" data-highlighted-line=""><span>│ │ │  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>│ │ ◉  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> ssh-openssh*</span><span> c6c</span><span>73906</span></span>
<span data-line=""><span>│ │ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ │ ◉  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> ffe</span><span>c92c9</span></span>
<span data-line=""><span>│ │ │  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>│ ◉ │  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> push-uqxvnturzsuu*</span><span> 867</span><span>3733e</span></span>
<span data-line=""><span>│ │ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>│ ◉ │  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> dd7</span><span>454a2</span></span>
<span data-line=""><span>│ │ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>│ ◉ │  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> 0a94</span><span>9714</span></span>
<span data-line=""><span>│ ├─╯  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>◉ │  </span><span>lqks</span><span>rtkk</span><span> benjamin@dev.ofcr.se</span><span> 21 hours ago</span><span> test*</span><span> 07d</span><span>8a576</span></span>
<span data-line=""><span>│ │  misc: test change</span></span>
<span data-line=""><span>◉ │  </span><span>rwq</span><span>ywnzl</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> test@bnjmnt4n</span><span> 402</span><span>f7ad8</span></span>
<span data-line=""><span>├─╯  new: avoid manual `unwrap()` call</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 2 days ago</span><span> main*</span><span> v0.16.0</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>The new commit has the change ID <code>txs</code>, so I’ll squash my changes from <code>uyl</code> into <code>txs</code>:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> squash</span><span> --from</span><span> uyl</span><span> --into</span><span> txs</span></span>
<span data-line=""><span>Rebased 4 descendant commits</span></span>
<span data-line=""><span>New conflicts appeared in these commits:</span></span>
<span data-line=""><span>  txs</span><span>rozwq</span><span> 0bb</span><span>dad29</span><span> (conflict)</span><span> conflicting change</span></span>
<span data-line=""><span>To resolve the conflicts, start by updating to it:</span></span>
<span data-line=""><span>  jj new txsrozwqlunv</span></span>
<span data-line=""><span>Then use `jj resolve`, or edit the conflict markers in the file directly.</span></span>
<span data-line=""><span>Once the conflicts are resolved, you may want inspect the result with `jj diff`.</span></span>
<span data-line=""><span>Then run `jj squash` to move the resolution into the conflicted commit.</span></span>
<span data-line=""><span>Working copy now at: </span><span>ywr</span><span>yozyt</span><span> 631</span><span>fda4b</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>orl</span><span>lnptq</span><span> 065</span><span>31057</span><span> (empty)</span><span> (no description set)</span></span></code></pre></figure>
<p>Jujutsu now warns that a new conflict appeared in <code>txs</code>, as expected. That’s because <code>txs</code> doesn’t have <code>rwq</code> in its history, which was where the first modification came from. Let’s take a look at the log now:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@  </span><span>ywr</span><span>yozyt</span><span> benjamin@dev.ofcr.se</span><span> 5 seconds ago</span><span> 631</span><span>fda4b</span></span>
<span data-line=""><span>│  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>◉      </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 5 seconds ago</span><span> HEAD@git</span><span> 065</span><span>31057</span></span>
<span data-line=""><span>├─┬─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line="" data-highlighted-line=""><span>│ │ ◉  </span><span>txs</span><span>rozwq</span><span> benjamin@dev.ofcr.se</span><span> 5 seconds ago</span><span> 0bb</span><span>dad29</span><span> conflict</span></span>
<span data-line="" data-highlighted-line=""><span>│ │ │  conflicting change</span></span>
<span data-line=""><span>│ │ ◉  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> ssh-openssh*</span><span> c6c</span><span>73906</span></span>
<span data-line=""><span>│ │ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ │ ◉  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> ffe</span><span>c92c9</span></span>
<span data-line=""><span>│ │ │  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>│ ◉ │  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> push-uqxvnturzsuu*</span><span> 867</span><span>3733e</span></span>
<span data-line=""><span>│ │ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>│ ◉ │  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> dd7</span><span>454a2</span></span>
<span data-line=""><span>│ │ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>│ ◉ │  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> 0a94</span><span>9714</span></span>
<span data-line=""><span>│ ├─╯  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>◉ │  </span><span>lqks</span><span>rtkk</span><span> benjamin@dev.ofcr.se</span><span> 21 hours ago</span><span> test*</span><span> 07d</span><span>8a576</span></span>
<span data-line=""><span>│ │  misc: test change</span></span>
<span data-line=""><span>◉ │  </span><span>rwq</span><span>ywnzl</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> test@bnjmnt4n</span><span> 402</span><span>f7ad8</span></span>
<span data-line=""><span>├─╯  new: avoid manual `unwrap()` call</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 2 days ago</span><span> main*</span><span> v0.16.0</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>The commit <code>txs</code> is marked in the log as containing a conflict. Here’s what <code>txs</code> looks like:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> show</span><span> txs</span></span>
<span data-line=""><span>Commit ID: </span><span>0bbdad290b695b94aab4e973349e1a5dda6ef0ce</span></span>
<span data-line=""><span>Change ID: </span><span>txsrozwqlunvppzymmtrnvotvtrnuwxr</span></span>
<span data-line=""><span>Author: Benjamin Tan &lt;</span><span>benjamin@dev.ofcr.se</span><span>&gt; (</span><span>14 minutes ago</span><span>)</span></span>
<span data-line=""><span>Committer: Benjamin Tan &lt;</span><span>benjamin@dev.ofcr.se</span><span>&gt; (</span><span>13 minutes ago</span><span>)</span></span>
<span data-line=""> </span>
<span data-line=""><span>    conflicting change</span></span>
<span data-line=""> </span>
<span data-line=""><span>diff --git a/cli/src/commands/new.rs b/cli/src/commands/new.rs</span></span>
<span data-line=""><span>index eeeb50aee6...0000000000 100644</span></span>
<span data-line=""><span>--- a/cli/src/commands/new.rs</span></span>
<span data-line=""><span>+++ b/cli/src/commands/new.rs</span></span>
<span data-line=""><span>@@ -193,7 +193,14 @@</span></span>
<span data-line=""><span>             writeln!(formatter)?;</span></span>
<span data-line=""><span>         }</span></span>
<span data-line=""><span>     } else {</span></span>
<span data-line=""><span>-        tx.edit(&amp;new_commit).unwrap();</span></span>
<span data-line=""><span>+&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span>
<span data-line=""><span>+%%%%%%%</span></span>
<span data-line=""><span>+-        tx.edit(&amp;new_commit)?;</span></span>
<span data-line=""><span>++        tx.edit(&amp;new_commit).unwrap();</span></span>
<span data-line=""><span>++++++++</span></span>
<span data-line=""><span>+        let commit = new_commit;</span></span>
<span data-line=""><span>+        tx.edit(&amp;commit).unwrap();</span></span>
<span data-line=""><span>+&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span>
<span data-line=""><span>         // The description of the new commit will be printed by tx.finish()</span></span>
<span data-line=""><span>     }</span></span>
<span data-line=""><span>     if num_rebased &gt; 0 {</span></span></code></pre></figure>
<p>The original line from <code>txs</code>’s parent commit in red is replaced with the new conflicting changes in green. Jujutsu’s <a href="https://martinvonz.github.io/jj/latest/conflicts/#conflict-markers">conflict markers</a> are slightly different from Git: lines following <code>%%%%%%%</code> are a diff between 2 sides, whilst lines following <code>+++++++</code> are a snapshot of the changes a side. Here’s my annotations on what the conflict markers mean:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="plaintext" data-theme="github-dark-dimmed"><code data-language="plaintext" data-theme="github-dark-dimmed"><span data-line=""><span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span>
<span data-line=""><span>%%%%%%% Diff from destination `txs` to base tree of `orl`</span></span>
<span data-line="" data-highlighted-line="" data-highlighted-line-id="del"><span>-        tx.edit(&amp;new_commit)?;</span></span>
<span data-line="" data-highlighted-line="" data-highlighted-line-id="ins"><span>+        tx.edit(&amp;new_commit).unwrap();</span></span>
<span data-line=""><span>+++++++ Snapshot of new changes from source `uyl`</span></span>
<span data-line="" data-highlighted-line=""><span>        let commit = new_commit;</span></span>
<span data-line="" data-highlighted-line=""><span>        tx.edit(&amp;commit).unwrap();</span></span>
<span data-line=""><span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span></code></pre></figure>
<p>Even though <code>txs</code> has a conflict, note that the merge commit <code>orl</code> isn’t in a conflicted state. This is because Jujutsu doesn’t just store conflict markers, but the full metadata of the conflicts, so it can resolve the conflicts by applying all the changes from each of <code>orl</code>’s parents.</p>
<p>However, if we want to update the <code>ssh-openssh</code> branch to include the changes in <code>txs</code>, we can’t just push a conflicted file since it won’t be accepted in any code review. We need to first resolve the conflict in <code>txs</code>. I’m doing this manually here by checking out <code>txs</code> and editing the file in the working directory, but you can also use a graphical tool for conflict resolution.</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> new</span><span> txs</span></span>
<span data-line=""><span>Working copy now at: </span><span>ysw</span><span>ompum</span><span> 3ea</span><span>0e8e9</span><span> (conflict)</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>txs</span><span>rozwq</span><span> 0bb</span><span>dad29</span><span> (conflict)</span><span> conflicting change</span></span>
<span data-line=""><span>Added 0 files, modified 5 files, removed 0 files</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> nvim</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> status</span></span>
<span data-line=""><span>Working copy changes:</span></span>
<span data-line=""><span>M cli/src/commands/new.rs</span></span>
<span data-line=""><span>Working copy : </span><span>ysw</span><span>ompum</span><span> 509</span><span>f7ea1</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit: </span><span>txs</span><span>rozwq</span><span> 0bb</span><span>dad29</span><span> (conflict)</span><span> conflicting change</span></span></code></pre></figure>
<p>The changes are updated in my working copy commit, so I can squash the changes into <code>txs</code> to apply the resolution there as well:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> squash</span></span>
<span data-line=""><span>Rebased 3 descendant commits</span></span>
<span data-line=""><span>Existing conflicts were resolved or abandoned from these commits:</span></span>
<span data-line=""><span>  txs</span><span>rozwq</span><span> hidden </span><span>0bbd</span><span>ad29</span><span> (conflict)</span><span> conflicting change</span></span>
<span data-line=""><span>Working copy now at: </span><span>xmy</span><span>nmysw</span><span> 53a</span><span>37139</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>txs</span><span>rozwq</span><span> a11</span><span>303a3</span><span> conflicting change</span></span></code></pre></figure>
<p>So, <code>txs</code> no longer has any conflicts, and we can update our branch to point to it and push it for review. However, if we go back to our merge commit <code>orl</code>, we can see that the merge commit is now marked as conflicting:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> new</span><span> orl</span></span>
<span data-line=""><span>Working copy now at: </span><span>nlw</span><span>nwups</span><span> 69a</span><span>1f4ce</span><span> (conflict)</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>orl</span><span>lnptq</span><span> 919</span><span>2cf35</span><span> (conflict)</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Added 0 files, modified 5 files, removed 0 files</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@  </span><span>nlw</span><span>nwups</span><span> benjamin@dev.ofcr.se</span><span> 1 minute ago</span><span> 69a</span><span>1f4ce</span><span> conflict</span></span>
<span data-line=""><span>│  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line="" data-highlighted-line=""><span>◉      </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 5 minutes ago</span><span> HEAD@git</span><span> 919</span><span>2cf35</span><span> conflict</span></span>
<span data-line="" data-highlighted-line=""><span>├─┬─╮  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line=""><span>│ │ ◉  </span><span>txs</span><span>rozwq</span><span> benjamin@dev.ofcr.se</span><span> 5 minutes ago</span><span> a11</span><span>303a3</span></span>
<span data-line=""><span>│ │ │  conflicting change</span></span>
<span data-line=""><span>│ │ ◉  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 1 day ago</span><span> ssh-openssh*</span><span> c6c</span><span>73906</span></span>
<span data-line=""><span>│ │ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ │ ◉  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 1 day ago</span><span> ffe</span><span>c92c9</span></span>
<span data-line=""><span>│ │ │  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>│ ◉ │  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 1 day ago</span><span> push-uqxvnturzsuu*</span><span> 867</span><span>3733e</span></span>
<span data-line=""><span>│ │ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>│ ◉ │  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 1 day ago</span><span> dd7</span><span>454a2</span></span>
<span data-line=""><span>│ │ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>│ ◉ │  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 1 day ago</span><span> 0a94</span><span>9714</span></span>
<span data-line=""><span>│ ├─╯  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>◉ │  </span><span>lqks</span><span>rtkk</span><span> benjamin@dev.ofcr.se</span><span> 23 hours ago</span><span> test*</span><span> 07d</span><span>8a576</span></span>
<span data-line=""><span>│ │  misc: test change</span></span>
<span data-line=""><span>◉ │  </span><span>rwq</span><span>ywnzl</span><span> benjamin@dev.ofcr.se</span><span> 1 day ago</span><span> test@bnjmnt4n</span><span> 402</span><span>f7ad8</span></span>
<span data-line=""><span>├─╯  new: avoid manual `unwrap()` call</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 2 days ago</span><span> main*</span><span> v0.16.0</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>~</span></span></code></pre></figure>
<p>This makes sense, because we’ve removed manually resolved the conflicts from <code>txs</code>. Jujutsu no longer has the metadata about how the conflict came about from merging different files, so <code>orl</code> now has a conflict. Typically, this isn’t that big an issue since you can just delay conflict resolution for that individual commit until you’re done working on that branch. You can then remove that branch from the merge commit after that.</p>
<p>If you do want to continue working on both branches, you can also restore the state of the working directory to its original state, before squashing the commit. First, get the commit ID of the change <code>uyl</code> that we wrote originally, before any commit manipulation (<code>128d5444</code> from above), then run <code>jj restore</code>:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> restore</span><span> --from</span><span> 128d5444</span><span> --to</span><span> orl</span></span>
<span data-line=""><span>Created </span><span>orlln</span><span>ptq</span><span> f2388</span><span>131</span><span> (no description set)</span></span>
<span data-line=""><span>Rebased 1 descendant commits</span></span>
<span data-line=""><span>Working copy now at: </span><span>nlw</span><span>nwups</span><span> d37</span><span>fb681</span><span> (empty)</span><span> (no description set)</span></span>
<span data-line=""><span>Parent commit      : </span><span>orl</span><span>lnptq</span><span> f23</span><span>88131</span><span> (no description set)</span></span>
<span data-line=""><span>Added 0 files, modified 1 files, removed 0 files</span></span></code></pre></figure>
<p>This restores all the files in commit <code>orl</code> to their state in commit <code>128d5444</code>—the original files before the conflict occured due to squashing of commits. This has the effect of solving the conflict within the merge commit <code>orl</code>:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="ansi" data-theme="github-dark-dimmed"><code data-language="ansi" data-theme="github-dark-dimmed"><span data-line=""><span>❯</span><span> jj</span><span> log</span></span>
<span data-line=""><span>@  </span><span>nlw</span><span>nwups</span><span> benjamin@dev.ofcr.se</span><span> 39 seconds ago</span><span> d37</span><span>fb681</span></span>
<span data-line=""><span>│  </span><span>(empty)</span><span> (no description set)</span></span>
<span data-line="" data-highlighted-line=""><span>◉      </span><span>orl</span><span>lnptq</span><span> benjamin@dev.ofcr.se</span><span> 39 seconds ago</span><span> HEAD@git</span><span> f23</span><span>88131</span></span>
<span data-line="" data-highlighted-line=""><span>├─┬─╮  </span><span>(no description set)</span></span>
<span data-line=""><span>│ │ ◉  </span><span>txs</span><span>rozwq</span><span> benjamin@dev.ofcr.se</span><span> 3 days ago</span><span> a11</span><span>303a3</span></span>
<span data-line=""><span>│ │ │  conflicting change</span></span>
<span data-line=""><span>│ │ ◉  </span><span>zoz</span><span>vwmow</span><span> benjamin@dev.ofcr.se</span><span> 4 days ago</span><span> ssh-openssh*</span><span> c6c</span><span>73906</span></span>
<span data-line=""><span>│ │ │  git: update error message for SSH error to stop referencing libssh2</span></span>
<span data-line=""><span>│ │ ◉  </span><span>yow</span><span>kkkqn</span><span> benjamin@dev.ofcr.se</span><span> 4 days ago</span><span> ffe</span><span>c92c9</span></span>
<span data-line=""><span>│ │ │  git: use prerelease version of `git2` with OpenSSH support</span></span>
<span data-line=""><span>│ ◉ │  </span><span>wtm</span><span>qulxn</span><span> benjamin@dev.ofcr.se</span><span> 4 days ago</span><span> push-uqxvnturzsuu*</span><span> 867</span><span>3733e</span></span>
<span data-line=""><span>│ │ │  rebase: allow both `--insert-after` and `--insert-before` to be used simultaneously</span></span>
<span data-line=""><span>│ ◉ │  </span><span>uqx</span><span>vntur</span><span> benjamin@dev.ofcr.se</span><span> 4 days ago</span><span> dd7</span><span>454a2</span></span>
<span data-line=""><span>│ │ │  rebase: add `--insert-after` and `--insert-before` options</span></span>
<span data-line=""><span>│ ◉ │  </span><span>nkzsq</span><span>ppm</span><span> benjamin@dev.ofcr.se</span><span> 4 days ago</span><span> 0a94</span><span>9714</span></span>
<span data-line=""><span>│ ├─╯  rebase: extract out some functions from `rebase_revision`</span></span>
<span data-line=""><span>◉ │  </span><span>lqks</span><span>rtkk</span><span> benjamin@dev.ofcr.se</span><span> 4 days ago</span><span> test*</span><span> 07d</span><span>8a576</span></span>
<span data-line=""><span>│ │  misc: test change</span></span>
<span data-line=""><span>◉ │  </span><span>rwq</span><span>ywnzl</span><span> benjamin@dev.ofcr.se</span><span> 4 days ago</span><span> test@bnjmnt4n</span><span> 402</span><span>f7ad8</span></span>
<span data-line=""><span>├─╯  new: avoid manual `unwrap()` call</span></span>
<span data-line=""><span>◉  </span><span>oqtz</span><span>skyx</span><span> martinvonz@google.com</span><span> 5 days ago</span><span> main*</span><span> v0.16.0</span><span> 2dcd</span><span>c7fb</span></span>
<span data-line=""><span>│  release: release version 0.16.0</span></span>
<span data-line=""><span>~</span></span>
<span data-line=""> </span>
<span data-line=""><span>❯</span><span> jj</span><span> show</span><span> orl</span></span>
<span data-line=""><span>Commit ID: </span><span>f2388131cba4be8fe0b267dcef1af8d823184851</span></span>
<span data-line=""><span>Change ID: </span><span>orllnptqzkuqpsonzzkytxlrzpyxmwtn</span></span>
<span data-line=""><span>Author: Benjamin Tan &lt;</span><span>benjamin@dev.ofcr.se</span><span>&gt; (</span><span>4 days ago</span><span>)</span></span>
<span data-line=""><span>Committer: Benjamin Tan &lt;</span><span>benjamin@dev.ofcr.se</span><span>&gt; (</span><span>1 minute ago</span><span>)</span></span>
<span data-line=""> </span>
<span data-line=""><span>    (no description set)</span></span>
<span data-line=""> </span>
<span data-line=""><span>diff --git a/cli/src/commands/new.rs b/cli/src/commands/new.rs</span></span>
<span data-line=""><span>index 0000000000...b946b93769 100644</span></span>
<span data-line=""><span>--- a/cli/src/commands/new.rs</span></span>
<span data-line=""><span>+++ b/cli/src/commands/new.rs</span></span>
<span data-line=""><span>@@ -193,14 +193,8 @@</span></span>
<span data-line=""><span>             writeln!(formatter)?;</span></span>
<span data-line=""><span>         }</span></span>
<span data-line=""><span>     } else {</span></span>
<span data-line=""><span>-&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span>
<span data-line=""><span>-%%%%%%%</span></span>
<span data-line=""><span>--        tx.edit(&amp;new_commit).unwrap();</span></span>
<span data-line=""><span>-+        tx.edit(&amp;new_commit)?;</span></span>
<span data-line=""><span>-+++++++</span></span>
<span data-line=""><span>         let commit = new_commit;</span></span>
<span data-line=""><span>         tx.edit(&amp;commit).unwrap();</span></span>
<span data-line=""><span>-&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span>
<span data-line=""><span>         // The description of the new commit will be printed by tx.finish()</span></span>
<span data-line=""><span>     }</span></span>
<span data-line=""><span>     if num_rebased &gt; 0 {</span></span></code></pre></figure>
<h2 id="conclusion">Conclusion</h2>
<p>I’ve shown how you can use Jujutsu to manipulate merge commits and work on separate logical branches of code, by adding and removing parents using the <code>jj rebase</code> command. Arguably, this workflow might be better visualized with a graphical interface to see how the commit graph is being manipulated. There’s a GUI app for Jujutsu, called <a href="https://github.com/gulbanana/gg">GG</a>, with a <a href="https://www.youtube.com/watch?v=cD9L3Mi1Vy4">pretty convincing demo</a> of this workflow.</p>
<p>Working on multiple branches of code at the same time can be really powerful. Personally, I use this workflow all the time to avoid having to switch branches. This is especially convenient when working on small bugfixes where it’s definitely easier to just work in the current directory.</p>
<p>Merging multiple branches together also allows you to very simply test out various features at the same time, without having to wait for all of them to be merged into the main branch. In fact, I use this to build a custom <code>jj</code> binary which contains various features which haven’t been merged into <code>main</code>.</p>
<p>Even if you aren’t convinced about switching to Jujutsu, I think this workflow is still valuable. In fact, <a href="https://gitbutler.com/">GitButler</a>—a new Git client—was recently launched with a similar end product: making it easy to activate different “virtual branches” in your working directory. Otherwise, alternative tools like <a href="https://github.com/arxanas/git-branchless">git-branchless</a> might allow you to do something similar.</p>
<p>If you are intrigued by Jujutsu, do check out the <a href="https://github.com/martinvonz/jj#introduction">introduction</a> and <a href="https://martinvonz.github.io/jj/latest/tutorial/">tutorial</a>. I’d also recommend <a href="https://v5.chriskrycho.com/essays/jj-init/">Chris’s article</a> and <a href="https://www.youtube.com/playlist?list=PLelyiwKWHHAq01Pvmpf6x7J0y-yQpmtxp">video series</a>. Steve Klabnik also has a <a href="https://steveklabnik.github.io/jujutsu-tutorial/">long-form tutorial</a> on Jujutsu, which includes a <a href="https://steveklabnik.github.io/jujutsu-tutorial/advanced/simultaneous-edits.html">chapter on this workflow</a>.</p>
  </div></div>
  </body>
</html>
