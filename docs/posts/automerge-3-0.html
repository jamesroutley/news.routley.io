<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://automerge.org/blog/automerge-3/">Original</a>
    <h1>Automerge 3.0</h1>
    
    <div id="readability-page-1" class="page"><div id="__blog-post-container"><p>Automerge is a local-first data sync engine that makes it easy to build collaborative apps. Today we&#39;re excited to announce version 3.0 of Automerge!</p>
<p>The main update is a dramatic reduction in memory usage. Automerge stores the full history of documents to facilitate offline collaboration and version control workflows; in previous versions of the library, this could lead to gigabytes of memory usage when working with documents that had long histories. Now, in Automerge 3.0, <strong>we&#39;ve cut that down memory usage by over 10x</strong>, sometimes dramatically more, making Automerge feasible to use in a much wider range of scenarios.</p>
<p>In addition to the memory usage improvements, we&#39;ve also cleaned up some redundant APIs, particularly around the dealing with text strings.</p>
<p>If you&#39;re using Automerge already, you should upgrade today. Automerge 3.0 uses the same file format as Automerge 2 and the API is nearly fully backwards compatible. See <a href="https://automerge.org/docs/migrating-from-automerge-2-to-automerge-3/">the migration guide</a> for more details.</p>
<p>If you&#39;re not using Automerge yet, now&#39;s a great time to take another look, as things have come a long way in performance and reliability.</p>
<p>To learn more about how we achieved these improvements, read on.</p>
<h2 id="improved-memory-use">Improved Memory Use<a href="#improved-memory-use" aria-label="Direct link to Improved Memory Use" title="Direct link to Improved Memory Use">​</a></h2>
<p>Automerge is a data sync engine. As an application developer you work with plain-old-JavaScript-objects and Automerge takes care of persistence, and networking. Unlike most sync engines, Automerge is designed for local-first applications, which means that we need to support working offline, or using multiple independent sync servers, or not having a server at all and doing everything peer-to-peer.</p>
<p>Automerge achieves local first sync by storing every change you make to a document and then when concurrent changes are made - as they will be in a local-first application - we can provide good version control tools for detecting conflicts and reviewing history.  The downside is that we have to store a lot of metadata about changes - we assign a unique ID to every keystroke for example. Most of the technical work in Automerge is making it possible to store and manipulate these increasingly large histories.</p>
<p>Previous versions of Automerge already used a compressed columnar format to store and transmit this metadata. This format achieved a reasonably small metadata overhead &#34;at rest&#34; —  over the raw data for most documents. However, when a document was actually <em>loaded</em> for editing, we used an uncompressed format for the history, so the memory usage would balloon to a significantly larger overhead.</p>
<p>In Automerge 3.0, we&#39;ve rearchitected the library so that it also uses the compressed representation at runtime. This has achieved huge memory savings. For example, pasting Moby Dick into an Automerge 2 document consumes 700Mb of memory, in Automerge 3 it only consumes 1.3Mb!</p>
<p>Beyond the obvious benefits of avoiding high memory usage on client devices, we&#39;ve also seen that reduced memory usage can make it easier to reliably operate busy sync servers that can hold many large documents in memory at once.</p>
<p>Finally, for documents with large histories load times can be much much faster (we recently had an example of a document which hadn&#39;t loaded after 17 hours loading in 9 seconds!).</p>
<h2 id="api-paper-cuts">API Paper Cuts<a href="#api-paper-cuts" aria-label="Direct link to API Paper Cuts" title="Direct link to API Paper Cuts">​</a></h2>
<p>We&#39;ve also cleaned up several APIs in this release, particularly around handling text.</p>
<p>Automerge can manage two kinds of strings: &#34;collaborative strings&#34; that can merge edits from multiple users, and &#34;non-collaborative strings&#34; where edits from different users cannot be merged.</p>
<p>In Automerge 1.0, we used native JavaScript strings to represent non-collaborative strings, and a special <code>Text</code> class to represent collaborative strings. In Automerge 2.0, we released an experimental API under the <code>next</code> namespace, making collaborative text the default case—using <code>string</code>s to represent collaborative text, and a special <code>RawString</code> class to represent the less common case of non-collaborative text.</p>
<p>In Automerge 3.0, we&#39;re fully committing to the new API—we&#39;ve removed the <code>Text</code> API, and made the <code>next</code> API the default behavior of the library. (We&#39;ve also renamed <code>RawString</code> to <code>ImmutableString</code> as a more descriptive name.)</p>
<h2 id="try-it-out">Try it out<a href="#try-it-out" aria-label="Direct link to Try it out" title="Direct link to Try it out">​</a></h2>
<p>Automerge 3.0 is used by default when installing the latest version (<code>2.1.0</code>) of <code>@automerge/automerge-repo</code> or <code>@automerge/react</code>. If you&#39;re new to automerge take a look at the <a href="https://automerge.org/docs/tutorial/">tutorial</a> to get started.</p>
<p>If you already have an Automerge codebase take a look at the <a href="https://automerge.org/docs/migrating-from-automerge-2-to-automerge-3/">migration guide</a> to see if you need to change anything other than the version number of Automerge you depend on. If you just depend on <code>@automerge/automerge-repo</code> you&#39;ll need to run <code>npm update @automerge/automerge</code> (or your package manager&#39;s equivalent) to pull in the new version.</p>
<p>If things aren&#39;t working, please <a href="https://github.com/automerge/automerge-repo/issues/new" target="_blank" rel="noopener noreferrer">create an issue</a> or if you have questions <a href="https://discord.gg/zKGe4DCfgR" target="_blank" rel="noopener noreferrer">join our Discord</a>.</p></div></div>
  </body>
</html>
